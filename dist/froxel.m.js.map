{"mappings":"iTAGA,MAAMA,EAAM,CAACC,EAAOC,IAAoB,YAAbD,EAAQC,GAE7BC,EAAM,CAACF,EAAOC,IAAMD,GAAUC,EAAK;;IAyHzCE,EAjHeC,EAAMC,OACpB,CAIAC,MAAO,KAKPC,MAAO,EAMPC,KAAM,EAKNC,MAAO,EAQPC,OAAQ,SAASF,EAAK,YAErBG,KAAKC,QAAQJ,IASdI,QAAS,SAASZ,GAEjBW,KAAKH,KAAOR,EAEZW,KAAKJ,MAAQ,EACbI,KAAKF,MAAQ,EAEbE,KAAKL,MAAQ,CACZ,WAAY,WAAY,WAAY,WACpC,WAAY,WAAY,WAAY,WACpC,WAAY,WAAY,WAAY,UACpC,WAAY,WAAY,WAAY,YAGrC,IAAK,IAAIO,EAAI,EAAGA,EAAIF,KAAKL,MAAMQ,OAAQD,IACtCF,KAAKL,MAAMO,GAAKd,EAAIY,KAAKL,MAAMO,GAAIF,KAAKH,MAEzC,OAAOG,MAORI,UAAW,WAEV,IAAIC,EAAGC,EAAGC,EAAGC,EAgBb,OAdAR,KAAKF,MAAQE,KAAMF,MAAQ,EAAK,WAEhCO,EAAIL,KAAKL,MAAMK,KAAKJ,OACpBW,EAAIP,KAAKL,MAAMK,KAAMJ,MAAQ,GAAM,IACnCU,EAAIlB,EAAIA,EAAIA,EAAIiB,EAAGE,GAAIhB,EAAIc,EAAG,KAAMd,EAAIgB,EAAG,KAC3CA,EAAIP,KAAKL,MAAMK,KAAMJ,MAAQ,EAAK,IAClCW,EAAInB,EAAImB,EAAOA,IAAG,GAnFuB,YAoFzCF,EAAIL,KAAKL,MAAMK,KAAKJ,OAASR,EAAIkB,EAAGC,GACpCC,EAAIpB,EAAIiB,EAAe,WAAZd,EAAIc,EAAG,IAElBL,KAAKJ,MAAQI,KAAMJ,MAAQ,GAAM,GACjCS,EAAIL,KAAKL,MAAMK,KAAKJ,OAEpBI,KAAKL,MAAMK,KAAKJ,OAASR,EAAIA,EAAIA,EAAIA,EAAIA,EAAIiB,EAAGC,GAAIE,GAAIjB,EAAIc,EAAG,IAAKd,EAAIe,EAAG,KAAMf,EAAIgB,EAAG,KACxD,WAAzBP,KAAKL,MAAMK,KAAKJ,QAOxBa,UAAW,WAEV,OAA0B,MAAnBT,KAAKI,aAObM,SAAU,WAET,OAA0B,IAAnBV,KAAKI,aAObO,UAAW,WAEV,OAAOX,KAAKI,YAAc;;ACnH5BQ,EACA,CACCC,UAAW;;AAEXC,IAAK;;AAELC,MAAO;;AAEPC,MAAO;;AAEPC,KAAM;;AAENC,IAAK;;AAELC,MAAO;;AAGPC,KAAM;;AAENC,KAAM;;AAGNC,IAAK;;AAELC,KAAM;;AAGNC,IAAK;;AAELC,IAAK;;AAGLC,KAAM;;AAENC,GAAI;;AAEJC,MAAO;;AAEPC,KAAM;;AAGNC,SAAU;;AAEVC,UAAW;;AAEXC,aAAc;;AAEdC,UAAW;;AAEXC,QAAS;;AAGTC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAGPC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAGJC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAGHC,UAAW;;AAEXC,MAAO;;AAEPC,MAAO;;AAGPC,SAAU;;AAEVC,SAAU;;AAEVC,UAAW;;AAGXC,UAAW;;AAEXC,MAAO;;AAGPC,MAAO;;AAEPC,IAAK;;AAELC,MAAO,KChLR,MAAMC,EAAsB,GAC5B,IAAIC,EAAoB,EAExB,MAAMC,EAAW,GACjBC,EAAOC,SAAWF,E,IAClBG,EAAeH;qBAkBfA;EAASI,SAAW,SAAUC,EAAaC,EAAY,KAAMC,EAAY,MAExE,IAAKF,EAAYG,UAAUC,UAC1B,MAAM,IAAIC,MAAO,0DAElB,KAAM,WAAYL,EAAYG,WAC7B,MAAM,IAAIE,MAAO,mBAAmBL,EAAYG,UAAUC,UAAU,8BAErE,KAAM,SAAUJ,EAAYG,WAC3B,MAAM,IAAIE,MAAO,mBAAmBL,EAAYG,UAAUC,UAAU,4BAEjD,OAAhBF,IACHA,EAAcI,IAAkB,KAAdL,IAEnBR,EAAoBO,EAAYG,UAAUC,WAAaJ,EAEvDA,EAAYO,aAAe,IAAIC,MAAMP,GAAaQ,KAAK,MACvDT,EAAYU,gBAAkBT,EAE9BD,EAAYG,UAAUQ,SAAW,EACjCX,EAAYG,UAAUS,WAAa,EAEnCZ,EAAYa,qBAAuB,EACnCb,EAAYc,gBAAkB,EAC9Bd,EAAYe,iBAAmB,EAC/Bf,EAAYgB,gBAAkB,EAC9BhB,EAAYiB,eAAiB,EAC7BjB,EAAYkB,eAAiB,EAE7B,IAAIC,GAAe,EAKnBnB,EAAYoB,YAAc,SAAUC,EAAQ,MAE3C,GAAIF,EACH,OAED,IAAIG,EAAgB,OAAZD,EAAmBnB,EAAcqB,KAAKC,IAAIH,EAASnB,GAE3D,IAAK,IAAInG,EAAI,EAAGA,EAAIuH,EAAGvH,IAEtBiG,EAAYO,aAAaP,EAAYiB,kBAAoB,IAAIjB,EAC7DN,IAGDyB,GAAe,GAOhBnB,EAAYyB,SAAW,WAEtB,IAAIC,EAmBJ,OAjB4B,IAAxB7H,KAAKoH,gBAERS,EAAO,IAAI1B,EACXA,EAAYc,oBAIZY,EAAO7H,KAAK0G,eAAe1G,KAAKoH,gBAChCjB,EAAYe,oBAGbf,EAAYkB,iBAEZQ,EAAKf,WAAa9G,KAAKgH,qBACvBa,EAAKd,WAAa,EAElB/G,KAAKgH,sBAAwB,WACtBa,GAQR1B,EAAY2B,MAAQ,SAASC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAEhH,OAAOrC,EAAYyB,WAAWa,KAAKV,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,IAOxErC,EAAYG,UAAUoC,KAAO,WAE5B,OAAI1I,KAAK8G,SAAW,EACZ9G,KAEc,IAAlBA,KAAK8G,UAER6B,QAAQC,MAAO,uCAAyCzC,EAAYG,UAAUC,WACvEvG,SAGFA,KAAK+G,WAAa,IAGxB/G,KAAK6I,SACL7I,KAAK8G,SAAW,EAEZX,EAAYiB,gBAAkBhB,EACjCD,EAAYgB,kBAEZhB,EAAYO,aAAaP,EAAYiB,kBAAoBpH,KAE1DmG,EAAYkB,kBAVJrH,OAmBTmG,EAAYG,UAAUwC,aAAe,SAAUzJ,GAI9C,OAFAW,KAAK8G,SAAWY,KAAKqB,IAAI/I,KAAK8G,UAC1BzH,IAAOW,KAAK8G,UAAY9G,KAAK8G,UAC1B9G,MAQRmG,EAAYG,UAAU0C,YAAc,SAAUlJ,EAAM,GAGnD,OADAE,KAAK+G,YAAcjH,EACZE,OAST8F,EAASmD,UAAY,SAAUC,EAAK,MAEnC,IAAIC,EAAOvD,EAIX,GAFA+C,QAAQS,IAAI,uBAAyBvD,IAExB,IAATqD,EAAJ,CAgBA,GAAa,OAATA,EACJ,CACC,GAAqB,iBAAVA,EACX,CACC,IAAI3I,EAAIqF,EAAoBsD,GAE5B,YADAP,QAAQU,MAAOH,EAAO,MAAW3I,EAAE0G,gBAAgB1G,EAAEsG,gBAAzB,KAA2CyC,QAAQ,GAAG,mBAAqB/I,EAAE0G,gBAAkB,YAAY1G,EAAE8G,eAAe,WAAa9G,EAAEmG,aAAavG,OAAS,cAAgBI,EAAE2G,iBAAmB,iBAAmB3G,EAAE6G,eAAiB,aAAe7G,EAAE4G,gBAAkB,YAAc5G,EAAEsG,gBAAkBtG,EAAE6G,iBAIhV+B,EAAOD,EAGRP,QAAQY,MAAM,wBAEd,IAAK,IAAIrJ,KAAKiJ,EACd,CACC,IAAI5I,EAAI4I,EAAKjJ,GACRK,EAAE0G,iBAEP0B,QAAQU,MAAOnJ,EAAI,MAAWK,EAAE0G,gBAAgB1G,EAAEsG,gBAAzB,KAA2CyC,QAAQ,GAAG,mBAAqB/I,EAAE0G,gBAAkB,YAAY1G,EAAE8G,eAAe,WAAa9G,EAAEmG,aAAavG,OAAS,cAAgBI,EAAE2G,iBAAmB,iBAAmB3G,EAAE6G,eAAiB,aAAe7G,EAAE4G,gBAAkB,YAAc5G,EAAEsG,gBAAkBtG,EAAE6G,iBAG7UuB,QAAQa,eAtCR,CAECb,QAAQY,MAAM,wBAEd,IAAK,IAAIrJ,KAAKiJ,EACd,CACC,IAAI5I,EAAI4I,EAAKjJ,GACRK,EAAE0G,iBAEP0B,QAAQU,MAAOnJ,EAAI,MAAWK,EAAE0G,gBAAgB1G,EAAEsG,gBAAzB,KAA2CyC,QAAQ,GAAG,mBAAqB/I,EAAE0G,gBAAkB,YAAY1G,EAAE8G,eAAe,WAAa9G,EAAEmG,aAAavG,OAAS,cAAgBI,EAAE2G,iBAAmB,iBAAmB3G,EAAE6G,eAAiB,aAAe7G,EAAE4G,gBAAkB,YAAc5G,EAAEsG,gBAAkBtG,EAAE6G,iBAG7UuB,QAAQa,aAuCV1D,EAAS2D,WAAa,SAAUtD,EAAaC,EAAY,KAAMC,EAAY,MAE1E,MAAM6C,EAAO/C,EAAYG,UAAUC,UACnC,IAAK2C,EAAM,MAAM,IAAI1C,MAAO,wDAE5B,MAAMkD,EAAOvD,EAAYzG,OACxB,CACA6G,UAAWJ,EAAYG,UAAUC,UAEjCxG,OAAQ,aAGR0I,KAAM,SAASV,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAGlG,OADAxI,KAAK2J,OAAOT,GAAMnJ,OAAOgI,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,GACtDxI,QAOT,OAHA8F,EAASI,SAASwD,EAAMtD,EAAaC,GACrCF,EAAYuD,KAAOA,EAEZvD,GASRL,EAASyB,YAAc,SAAUqC,EAAyB,MAEzD/D,EAAoB,EAEpB,IAAK,IAAI3F,KAAK0F,EACbA,EAAoB1F,GAAGqH,YAAYqC,GAEpC,OAAO/D;;;AC9PR,MAAMgE,EAAWpK,EAAMC,OACtB,CACA6G,UAAW,WAMXuD,KAAM,KAMNC,KAAM,KAMN1K,MAAO,KAMPU,OAAQ,SAAUV,GAEjBW,KAAKX,MAAQA,EACbW,KAAKgK,SAMNnB,OAAQ,WAEP7I,KAAKiK,UAOND,MAAO,WAGN,OADAhK,KAAK+J,KAAO/J,KAAK8J,KAAO,KACjB9J,MAORkK,UAAW,SAAUC,GAEpBnK,KAAK8J,KAAOK,EACZnK,KAAK+J,KAAOI,EAAMA,EAAIJ,KAAO,KAEzBI,IAECA,EAAIJ,OAAMI,EAAIJ,KAAKD,KAAO9J,MAC9BmK,EAAIJ,KAAO/J,OAQboK,WAAY,SAAUD,GAErBnK,KAAK8J,KAAOK,EAAMA,EAAIL,KAAO,KAC7B9J,KAAK+J,KAAOI,EAERA,IAECA,EAAIL,OAAMK,EAAIL,KAAKC,KAAO/J,MAC9BmK,EAAIL,KAAO9J,OAQbiK,OAAQ,WAKP,OAHIjK,KAAK8J,OAAM9J,KAAK8J,KAAKC,KAAO/J,KAAK+J,MACjC/J,KAAK+J,OAAM/J,KAAK+J,KAAKD,KAAO9J,KAAK8J,MAE9B9J,KAAKgK;;;iBAcd/D;EAASwD,WAAYI,EAAU,MAAO,M,IACtCQ,EAAeR;;;aCxGf;MAAMS,EAAO7K,EAAMC,OAClB,CAIA6G,UAAW,OAMXgE,IAAK,KAMLC,OAAQ,KAMRrK,OAAQ,EAMRJ,OAAQ,WAEPC,KAAKuK,IAAM,KACXvK,KAAKwK,OAAS,KACdxK,KAAKG,OAAS,GAOf0I,OAAQ,WAEP7I,KAAKyK,SAONC,MAAO,WAEN,IAAIvB,EAAOmB,EAAKZ,KAAK5B,QAErB,IAAK,IAAI5H,EAAIF,KAAKuK,IAAKrK,EAAGA,EAAIA,EAAE6J,KAC/BZ,EAAKwB,KAAKC,EAAKF,MAAMxK,EAAEb,QAExB,OAAO8J,GAORa,MAAO,WAEN,IAAI9J,EAAG2K,EAEP,IAAK3K,EAAIF,KAAKuK,IAAKrK,EAAGA,EAAI2K,EAEzBA,EAAK3K,EAAE6J,KACPe,QAAQ5K,EAAEwI,OAAOrJ,OAMlB,OAHAW,KAAKuK,IAAMvK,KAAKwK,OAAS,KACzBxK,KAAKG,OAAS,EAEPH,MAORyK,MAAO,WAEN,IAAIvK,EAAG2K,EAEP,IAAK3K,EAAIF,KAAKuK,IAAU,MAALrK,EAAWA,EAAI2K,EAEjCA,EAAK3K,EAAE6J,KACP7J,EAAEwI,OAMH,OAHA1I,KAAKuK,IAAMvK,KAAKwK,OAAS,KACzBxK,KAAKG,OAAS,EAEPH,MAOR+K,MAAO,WAEN,OAAoB,OAAb/K,KAAKuK,IAAevK,KAAKuK,IAAIlL,MAAQ,MAO7C2L,KAAM,WAEL,OAAuB,OAAhBhL,KAAKwK,OAAkBxK,KAAKwK,OAAOnL,MAAQ,MAOnD4L,MAAO,SAAUrL,GAEhB,IAAIM,EAAI,KACR,IAAKA,EAAIF,KAAKuK,IAAKrK,GAAKN,KAAU,EAAGM,EAAIA,EAAE6J,MAC3C,OAAY,MAAL7J,EAAYA,EAAEb,MAAQ,MAO9B6L,UAAW,SAAUtL,GAEpB,IAAIM,EAAI,KACR,IAAKA,EAAIF,KAAKuK,IAAKrK,GAAKN,IAASM,EAAIA,EAAE6J,MACvC,OAAO7J,GAORiL,SAAU,SAAU9L,GAEnB,IAAK,IAAIa,EAAIF,KAAKuK,IAAKrK,EAAGA,EAAIA,EAAE6J,KAC/B,GAAI7J,EAAEb,QAAUA,EAAO,OAAOa,EAE/B,OAAO,MAORkL,OAAQ,SAAUlL,GAKjB,OAHS,MAALA,GAAcmK,EAASgB,WAAWnL,KACrCA,EAAIF,KAAKmL,SAASjL,IAEdA,GAEAA,EAAE4J,OAAM9J,KAAKuK,IAAMrK,EAAE6J,MACrB7J,EAAE6J,OAAM/J,KAAKwK,OAAStK,EAAE4J,MAE7B9J,KAAKG,SACED,EAAEwI,OAAOrJ,OAND,MAahBiM,aAAc,SAAUnB,EAAK9K,GAE5B,IAAK8K,EAAK,OAAOnK,KAEjB,IAAIE,EAAImK,EAASX,KAAK5B,MAAMzI,GAM5B,OALAa,EAAEkK,WAAYD,GAEVA,GAAOnK,KAAKuK,MAAKvK,KAAKuK,IAAMrK,GAChCF,KAAKG,SAEEd,GAORkM,YAAa,SAAUpB,EAAK9K,GAE3B,IAAK8K,EAAK,OAAOnK,KAEjB,IAAIE,EAAImK,EAASX,KAAK5B,MAAMzI,GAM5B,OALAa,EAAEgK,UAAWC,GAETA,GAAOnK,KAAKwK,SAAQxK,KAAKwK,OAAStK,GACtCF,KAAKG,SAEEd,GAORmM,QAAS,SAAUnM,GAElB,IAAIa,EAAImK,EAASX,KAAK5B,MAAMzI,GAQ5B,OANAa,EAAEkK,WAAYpK,KAAKuK,KACdvK,KAAKwK,SAAQxK,KAAKwK,OAAStK,GAEhCF,KAAKuK,IAAMrK,EACXF,KAAKG,SAEEd,GAORoM,MAAO,WAEN,IAAIvL,EAAIF,KAAKuK,IACb,OAAKrK,IAECF,KAAKuK,IAAMrK,EAAE6J,QAAO/J,KAAKwK,OAAS,MACxCxK,KAAKG,SAEED,EAAEwI,OAAOrJ,OALD,MAYhBsL,KAAM,SAAUtL,GAEf,IAAIa,EAAImK,EAASX,KAAK5B,MAAMzI,GAQ5B,OANAa,EAAEgK,UAAWlK,KAAKwK,QACbxK,KAAKuK,MAAKvK,KAAKuK,IAAMrK,GAE1BF,KAAKwK,OAAStK,EACdF,KAAKG,SAEEd,GAORqM,IAAK,WAEJ,IAAIxL,EAAIF,KAAKwK,OACb,OAAKtK,IAECF,KAAKwK,OAAStK,EAAE4J,QAAO9J,KAAKuK,IAAM,MACxCvK,KAAKG,SAEED,EAAEwI,OAAOrJ,OALD,MAYhBsM,OAAQ,SAAUxC,GAEjB,IAAK,IAAIjJ,EAAIiJ,EAAKoB,IAAKrK,EAAGA,EAAIA,EAAE6J,KAC/B/J,KAAK2K,KAAKzK,EAAEb,OAEb,OAAOW,MAQR4L,QAAS,SAAUC,EAAIC,EAAQ,MAE9B,IAAIjB,EAEJ,IAAK,IAAI3K,EAAIF,KAAKuK,IAAKrK,EAAGA,EAAI2K,EAG7B,GADAA,EAAK3K,EAAE6J,MACgC,IAAnC8B,EAAI3L,EAAEb,MAAOa,EAAGF,KAAM8L,GAAoB,OAAO,EAGtD,OAAO,GAQRC,WAAY,SAAUF,EAAIC,EAAQ,MAEjC,IAAIjB,EAEJ,IAAK,IAAI3K,EAAIF,KAAKwK,OAAQtK,EAAGA,EAAI2K,EAGhC,GADAA,EAAK3K,EAAE4J,MACgC,IAAnC+B,EAAI3L,EAAEb,MAAOa,EAAGF,KAAM8L,GAAoB,OAAO,EAGtD,OAAO,GAORE,KAAM,SAAUH,EAAIC,EAAQ,MAE3B,IAAK,IAAI5L,EAAIF,KAAKuK,IAAKrK,EAAGA,EAAIA,EAAE6J,KAC/B,GAAI8B,EAAG3L,EAAEb,MAAOyM,GAAU,OAAO5L,EAAEb,MAEpC,OAAO,MAOR4M,OAAQ,SAAUJ,EAAIC,EAAQ,MAE7B,IAAI3C,EAAOmB,EAAKZ,KAAK5B,QAErB,IAAK,IAAI5H,EAAIF,KAAKuK,IAAKrK,EAAGA,EAAIA,EAAE6J,KAC3B8B,EAAG3L,EAAEb,MAAOyM,IAAU3C,EAAKwB,KAAKzK,EAAEb,OAEvC,OAAO8J,GAOR+C,QAAS,WAER,IAAIC,EAAQ,GAEZ,IAAK,IAAIjM,EAAIF,KAAKuK,IAAKrK,EAAGA,EAAIA,EAAE6J,KAC/BoC,EAAMxB,KAAKzK,EAAEb,OAEd,OAAO8M;;;iBAcTlG;EAASwD,WAAYa,EAAM,MAAO,M,IAClC8B,EAAe9B;cCnXf;MAAM+B,EAAQ,SAAUC,EAAOC,EAAUC,GAExCxM,KAAKwM,SAAWA,EAChBxM,KAAKuM,SAAWA,EAChBvM,KAAKsM,MAAQA,EACbtM,KAAKyM,OAAS,KAEdzM,KAAK0M,WAAY,EACjB1M,KAAK2M,UAAY,EACjB3M,KAAK4M,MAAQ,EACb5M,KAAK6M,MAAQ,EACb7M,KAAK8M,MAAQ,EACb9M,KAAK+M,OAAS,EAEd/M,KAAKgN,WAAa,KACjBhN,KAAKiN,aAGNjN,KAAKkN,aAAe,KACnBlN,KAAKmN,WAOPd,EAAM/F,UAAU2G,UAAY,WAE3B,IAAKjN,KAAK0M,UAAW,OAErB1M,KAAK4M,MAAQQ,QAAUpN,KAAK2M,UAE5B,IAAIU,EAASrN,KAAK4M,OAAS5M,KAAK6M,MAAQ7M,KAAKuM,UACzCc,EAAS,EAEZrN,KAAKsN,UAAUD,IAIhBrN,KAAK6M,OAAS7M,KAAKuM,UAAY,EAAI9F,IAAI4G,EAASrN,KAAKuM,WAErDvM,KAAK+M,OAASM,EAAS,EAAIrN,KAAKuM,SAAYvM,KAAK4M,MAAQ5M,KAAK8M,MAC9D9M,KAAK8M,MAAQ9M,KAAK4M,MAElB5M,KAAKsN,SAAStN,KAAM6M,MAAQ7M,KAAKuM,UAAaa,QAAUpN,KAAK2M,YAC7D3M,KAAKwM,SAASxM,KAAK+M,OAAQ/M,QAW5BqM,EAAM/F,UAAUiH,MAAQ,SAAUC,GAAU,EAAOC,EAAM,GAEpDzN,KAAK0M,YAET1M,KAAK2M,UAAYS,QACjBpN,KAAK0M,WAAY,EAEjB1M,KAAK6M,MAAQ,EACb7M,KAAK8M,MAAQ,EAEb9M,KAAK0N,YAEDF,GACHxN,KAAKwM,SAAU,EAAGxM,MAEnBA,KAAKsN,SAAStN,KAAKuM,SAASkB,KAQ7BpB,EAAM/F,UAAUgH,SAAW,SAAUK,GAEb3N,KAAKsM,MAE3BsB,sBAAsB5N,KAAKkN,eAIxBlN,KAAKyM,QACRoB,aAAa7N,KAAKyM,QAEnBzM,KAAKyM,OAASqB,WAAW9N,KAAKgN,WAAYW,KAQ3CtB,EAAM/F,UAAU6G,OAAS,WAEpBnN,KAAKyM,QACRoB,aAAa7N,KAAKyM,QAEnBzM,KAAKyM,OAASqB,WAAW9N,KAAKgN,WAAY,IAQ3CX,EAAM/F,UAAUyH,KAAO,WAEjB/N,KAAK0M,YAEN1M,KAAKyM,SAERoB,aAAa7N,KAAKyM,QAClBzM,KAAKyM,OAAS,MAGfzM,KAAK0M,WAAY,EACjB1M,KAAKgO,cAQN3B,EAAM/F,UAAUoH,UAAY,aAS5BrB,EAAM/F,UAAU0H,UAAY,a,IAI5BC,EAAe5B;;aC7If;MAAM6B,EAAOzO,EAAMC,OAClB,CACA6G,UAAW,OAOXjH,EAAG,EAAG6O,EAAG,EAUTpO,OAAQ,SAAUT,EAAE,KAAM6O,EAAE,MAE3B,OAAOnO,KAAKoO,IAAI9O,EAAG6O,IAOpBzD,MAAO,WAEN,OAAOwD,EAAKxE,KAAK5B,MAAM9H,OAWxBoO,IAAK,SAAU9O,EAAG6O,EAAE,MAEnB,GAAU,OAAN7O,EACHA,EAAI,EACJ6O,EAAI,OAEA,GAAU,OAANA,EAAY,CACpB,IAAIE,EAAI/O,EACRA,EAAI+O,EAAE/O,EACN6O,EAAIE,EAAEF,EAMP,OAHAnO,KAAKV,EAAIA,EACTU,KAAKmO,EAAIA,EAEFnO,MAORsO,KAAM,SAAUhP,GAGf,OADAU,KAAKV,EAAIA,EACFU,MAORuO,KAAM,SAAUJ,GAGf,OADAnO,KAAKmO,EAAIA,EACFnO,MAORwO,KAAM,WAEL,OAAOxO,KAAKoO,IAAI,EAAG,IAOpBK,OAAQ,WAEP,OAAiB,GAAVzO,KAAKV,GAAoB,GAAVU,KAAKmO,GAW5BO,OAAQ,SAAUpP,EAAG6O,EAAE,MAEtB,GAAU,OAANA,EACJ,CACC,IAAIE,EAAI/O,EACRA,EAAI+O,EAAE/O,EACN6O,EAAIE,EAAEF,EAGP,OAAOnO,KAAKV,GAAKA,GAAKU,KAAKmO,GAAKA,GAOjCQ,IAAK,WAGJ,OADA3O,KAAKV,GAAKU,KAAKV,EAAGU,KAAKmO,GAAKnO,KAAKmO,EAC1BnO,MAOR4O,IAAK,WAGJ,OADA5O,KAAKV,EAAI,EAAIU,KAAKV,EAAGU,KAAKmO,EAAI,EAAInO,KAAKmO,EAChCnO,MAOR+I,IAAK,WAIJ,OAFA/I,KAAKV,EAAIU,KAAKV,EAAI,GAAKU,KAAKV,EAAIU,KAAKV,EACrCU,KAAKmO,EAAInO,KAAKmO,EAAI,GAAKnO,KAAKmO,EAAInO,KAAKmO,EAC9BnO,MAWR6O,UAAW,SAAUC,EAAIC,EAAG,MAE3B,GAAW,OAAPA,EACJ,CACC,IAAIV,EAAIS,EACRA,EAAKT,EAAE/O,EACPyP,EAAKV,EAAEF,EAIR,OADAnO,KAAKV,GAAKwP,EAAI9O,KAAKmO,GAAKY,EACjB/O,MAWRgP,OAAQ,SAAUC,EAAOC,EAAG,EAAGC,EAAG,GAEjC,IAAI7P,GAAKU,KAAKV,EAAI4P,GAAIxH,KAAK0H,IAAIH,IAAUjP,KAAKmO,EAAIgB,GAAIzH,KAAK2H,IAAIJ,GAC3Dd,GAAKnO,KAAKmO,EAAIgB,GAAIzH,KAAK0H,IAAIH,IAAUjP,KAAKV,EAAI4P,GAAIxH,KAAK2H,IAAIJ,GAK/D,OAHAjP,KAAKV,EAAIA,EAAI4P,EACblP,KAAKmO,EAAIA,EAAIgB,EAENnP,MAWRsP,IAAK,SAAUR,EAAIC,EAAG,MAErB,GAAW,OAAPA,EACJ,CACC,IAAIV,EAAIS,EACRA,EAAKT,EAAE/O,EACPyP,EAAKV,EAAEF,EAIR,OADAnO,KAAKV,GAAKwP,EAAI9O,KAAKmO,GAAKY,EACjB/O,MAWRuP,IAAK,SAAUT,EAAIC,EAAG,MAErB,GAAW,OAAPA,EACJ,CACC,IAAIV,EAAIS,EACRA,EAAKT,EAAE/O,EACPyP,EAAKV,EAAEF,EAIR,OADAnO,KAAKV,GAAKwP,EAAI9O,KAAKmO,GAAKY,EACjB/O,MAeRyN,MAAO,SAAU+B,EAAIC,EAAG,MAEvB,GAAW,OAAPA,EAEH,GAAIvB,EAAK7C,WAAWmE,GAAK,CACxB,IAAInB,EAAImB,EACRA,EAAKnB,EAAE/O,EACPmQ,EAAKpB,EAAEF,OAEPsB,EAAKD,EAKP,OADAxP,KAAKV,GAAKkQ,EAAIxP,KAAKmO,GAAKsB,EACjBzP,MAOR0P,MAAO,WAKN,OAHA1P,KAAKV,EAAImH,IAAIzG,KAAKV,GAClBU,KAAKmO,EAAI1H,IAAIzG,KAAKmO,GAEXnO,MAOR2P,MAAO,WAKN,OAHA3P,KAAKV,EAAIU,KAAKV,EAAImH,IAAIzG,KAAKV,GAC3BU,KAAKmO,EAAInO,KAAKmO,EAAI1H,IAAIzG,KAAKmO,GAEpBnO,MAWR4P,IAAK,SAAUtQ,EAAG6O,EAAE,MAEnB,GAAU,OAANA,EACJ,CACC,IAAIE,EAAI/O,EACRA,EAAI+O,EAAE/O,EACN6O,EAAIE,EAAEF,EAGP,OAAOnO,KAAKV,EAAEA,EAAIU,KAAKmO,EAAEA,GAO1B0B,UAAW,SAAUC,GAAQ,GAE5B,OAAOA,EAAW9P,KAAKV,EAAEU,KAAKV,EAAIU,KAAKmO,EAAEnO,KAAKmO,EAAKzG,KAAKqI,KAAK/P,KAAKV,EAAEU,KAAKV,EAAIU,KAAKmO,EAAEnO,KAAKmO,IAO1F6B,UAAW,WAEV,OAAOhQ,KAAKyO,SAAWzO,KAAOA,KAAKyN,MAAO,EAAIzN,KAAK6P,cAOpDI,UAAW,WAGV,OADIvI,KAAKqB,IAAI/I,KAAKV,GAAKoI,KAAKqB,IAAI/I,KAAKmO,GAAInO,KAAKmO,EAAI,EAAQnO,KAAKV,EAAI,EAC5DU,MAORkQ,UAAW,WAGV,OADIxI,KAAKqB,IAAI/I,KAAKV,GAAKoI,KAAKqB,IAAI/I,KAAKmO,GAAInO,KAAKmO,EAAI,EAAQnO,KAAKV,EAAI,EAC5DU,MAORmQ,KAAM,WAIL,OAFAnQ,KAAKV,EAAKU,KAAKV,EAASU,KAAKV,EAAI,GAAI,EAAK,EAAvB,EACnBU,KAAKmO,EAAKnO,KAAKmO,EAASnO,KAAKmO,EAAI,GAAI,EAAK,EAAvB,EACZnO,MAORoQ,SAAU,WAET,MAAO,IAAIpQ,KAAKV,MAAMU,KAAKmO;;;iBAkB7BlI;EAASwD,WAAYyE,EAAM,KAAM,M,IACjCmC,EAAenC;;oBC7Xf;MAAMoC,EAAO,IAAIC,aAAa,GAAG3J,KAAK,GAChC4J,EAAQ,IAAID,aAAa,GAAG3J,KAAK,GAQjC6J,EAAShR,EAAMC,OACpB,CACA6G,UAAW,SAMXmK,KAAM,KAcN3Q,OAAQ,SAASV,EAAM,MAEJ,OAAdW,KAAK0Q,OACR1Q,KAAK0Q,KAAO,IAAIH,aAAa,IAEhB,OAAVlR,EACHW,KAAKoO,IAAI/O,GAETW,KAAK2Q,YAOPnC,KAAM,WAGL,OADAxO,KAAK0Q,KAAK9J,KAAK,GACR5G,MAOR4G,KAAM,SAAUvH,GAGf,OADAW,KAAK0Q,KAAK9J,KAAKvH,GACRW,MAWRoO,IAAK,SAAU/O,GAad,OAXIoR,EAAOpF,WAAWhM,GAGrBW,KAAK0Q,KAAKtC,IAAI/O,EAAMqR,MAKpB1Q,KAAK0Q,KAAKtC,IAAI/O,GAGRW,MAOR2Q,SAAU,SAAUC,EAAO,MAQ1B,OANe,OAAXA,IACHA,EAAS5Q,KAAK0Q,MAEfE,EAAOhK,KAAK,GACZgK,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAAK,EAE7B5Q,MAOR6Q,OAAQ,SAAUC,GAEjB,IAAK,IAAI5Q,EAAI,EAAGA,EAAI,EAAGA,IAAKF,KAAK0Q,KAAKxQ,IAAM4Q,EAC5C,OAAO9Q,MAOR0K,MAAO,WAEN,OAAO+F,EAAO/G,KAAK5B,MAAM9H,OAO1B2L,OAAQ,SAAUoF,GAkBjB,OAhBIA,aAAgBN,IACnBM,EAAOA,EAAKL,MAGbJ,EAAKlC,IAAIpO,KAAK0Q,MAEd1Q,KAAK0Q,KAAK,GAAKK,EAAK,GAAGT,EAAK,GAAKS,EAAK,GAAGT,EAAK,GAAKS,EAAK,GAAGT,EAAK,GAChEtQ,KAAK0Q,KAAK,GAAKK,EAAK,GAAGT,EAAK,GAAKS,EAAK,GAAGT,EAAK,GAAKS,EAAK,GAAGT,EAAK,GAChEtQ,KAAK0Q,KAAK,GAAKK,EAAK,GAAGT,EAAK,GAAKS,EAAK,GAAGT,EAAK,GAAKS,EAAK,GAAGT,EAAK,GAChEtQ,KAAK0Q,KAAK,GAAKK,EAAK,GAAGT,EAAK,GAAKS,EAAK,GAAGT,EAAK,GAAKS,EAAK,GAAGT,EAAK,GAChEtQ,KAAK0Q,KAAK,GAAKK,EAAK,GAAGT,EAAK,GAAKS,EAAK,GAAGT,EAAK,GAAKS,EAAK,GAAGT,EAAK,GAChEtQ,KAAK0Q,KAAK,GAAKK,EAAK,GAAGT,EAAK,GAAKS,EAAK,GAAGT,EAAK,GAAKS,EAAK,GAAGT,EAAK,GAChEtQ,KAAK0Q,KAAK,GAAKK,EAAK,GAAGT,EAAK,GAAKS,EAAK,GAAGT,EAAK,GAAKS,EAAK,GAAGT,EAAK,GAChEtQ,KAAK0Q,KAAK,GAAKK,EAAK,GAAGT,EAAK,GAAKS,EAAK,GAAGT,EAAK,GAAKS,EAAK,GAAGT,EAAK,GAChEtQ,KAAK0Q,KAAK,GAAKK,EAAK,GAAGT,EAAK,GAAKS,EAAK,GAAGT,EAAK,GAAKS,EAAK,GAAGT,EAAK,GAEzDtQ,MAOR6O,UAAW,SAAUvP,EAAG6O,GAEvB,OAAS,GAAL7O,GAAe,GAAL6O,IAIdmC,EAAKlC,IAAIpO,KAAK0Q,MAEd1Q,KAAK0Q,KAAK,GAAKpR,EAAEgR,EAAK,GAAKnC,EAAEmC,EAAK,GAAKA,EAAK,GAC5CtQ,KAAK0Q,KAAK,GAAKpR,EAAEgR,EAAK,GAAKnC,EAAEmC,EAAK,GAAKA,EAAK,GAC5CtQ,KAAK0Q,KAAK,GAAKpR,EAAEgR,EAAK,GAAKnC,EAAEmC,EAAK,GAAKA,EAAK,IAPpCtQ,MAgBTgP,OAAQ,SAAUC,GAEjB,GAAa,GAATA,EACH,OAAOjP,KAERA,KAAK2Q,SAASH,GAEd,IAAIQ,EAAOtJ,KAAK0H,IAAIH,GAChBgC,EAAOvJ,KAAK2H,IAAIJ,GAOpB,OALAuB,EAAM,GAAKQ,EACXR,EAAM,IAAMS,EACZT,EAAM,GAAKS,EACXT,EAAM,GAAKQ,EAEJhR,KAAK2L,OAAO6E,IAOpB/C,MAAO,SAAUyD,EAAIC,GAEpB,OAAU,GAAND,GAAiB,GAANC,EACPnR,MAERA,KAAK2Q,SAASH,GAEdA,EAAM,GAAKU,EACXV,EAAM,GAAKW,EAEJnR,KAAK2L,OAAO6E,KAWpBY,QAAS,SAAU9R,EAAG6O,EAAE,MAEvB,GAAU,OAANA,EACJ,CACC,MAAME,EAAI/O,EACVA,EAAI+O,EAAE/O,EACN6O,EAAIE,EAAEF,EAGP,IAAIkD,EAAKrR,KAAK0Q,KAAK,GAAGpR,EAAIU,KAAK0Q,KAAK,GAAGvC,EAAInO,KAAK0Q,KAAK,GACjDY,EAAKtR,KAAK0Q,KAAK,GAAGpR,EAAIU,KAAK0Q,KAAK,GAAGvC,EAAInO,KAAK0Q,KAAK,GAErD,OAAOL,EAAK3G,KAAK5B,MAAMuJ,EAAIC,IAO5BC,UAAW,WAEVjB,EAAK1J,KAAK,GAEV,IAAK,IAAI4K,EAAI,EAAGA,EAAI,EAAGA,IACvB,IAAK,IAAItR,EAAI,EAAGA,EAAI,EAAGA,IACtBoQ,EAAO,EAAFkB,EAAItR,GAAKF,KAAK0Q,KAAO,EAAFxQ,EAAIsR,GAK7B,OAFAxR,KAAK0Q,KAAKtC,IAAIkC,GAEPtQ,MAORyR,IAAK,WAEJ,OAAOzR,KAAK0Q,KAAK,IAAM1Q,KAAK0Q,KAAK,GAAG1Q,KAAK0Q,KAAK,GAAK1Q,KAAK0Q,KAAK,GAAG1Q,KAAK0Q,KAAK,IACxE1Q,KAAK0Q,KAAK,IAAM1Q,KAAK0Q,KAAK,GAAG1Q,KAAK0Q,KAAK,GAAK1Q,KAAK0Q,KAAK,GAAG1Q,KAAK0Q,KAAK,IACnE1Q,KAAK0Q,KAAK,IAAM1Q,KAAK0Q,KAAK,GAAG1Q,KAAK0Q,KAAK,GAAK1Q,KAAK0Q,KAAK,GAAG1Q,KAAK0Q,KAAK,KAQtEgB,IAAK,WAmBJ,MAAM,IAAIlL,MAAM,oBAOjBmL,QAAS,WAER,IAAIF,EAAMzR,KAAKyR,MACf,OAAKA,EAEEzR,KAAK0R,MAAMb,OAAO,EAAEY,GAFV,MASlBrB,SAAU,WAET,MAAO,IAAIpQ,KAAK0Q,KAAK,OAAO1Q,KAAK0Q,KAAK,OAAO1Q,KAAK0Q,KAAK,SAAS1Q,KAAK0Q,KAAK,OAAO1Q,KAAK0Q,KAAK,OAAO1Q,KAAK0Q,KAAK,SAAS1Q,KAAK0Q,KAAK,OAAO1Q,KAAK0Q,KAAK,OAAO1Q,KAAK0Q,KAAK,WAQnKD,EAAOmB,aAAe,SAAUhB,GAE/BA,EAAOhK,KAAK,GACZgK,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAAK;;;;AAqBrC3K,EAASwD,WAAYgH,EAAQ,KAAM,M,IACnCoB,EAAepB;;;;;;;;;;;;;;;;YCxTf;MAAMqB,EACN,CACCC,aAAc,GACdC,YAAa,GAMbC,GAAI,KAMJC,WAAY,SAAUpG,GAuBrB,OArBA9L,KAAKiS,GAAKnG,EAEV9L,KAAK+R,aAAaI,aAAenS,KAAKiS,GAAGE,aACzCnS,KAAK+R,aAAaK,qBAAuBpS,KAAKiS,GAAGG,qBACjDpS,KAAK+R,aAAaM,iBAAmBrS,KAAKiS,GAAGI,iBAC7CrS,KAAK+R,aAAaO,kBAAoBtS,KAAKiS,GAAGK,kBAC9CtS,KAAK+R,aAAaQ,0BAA4BvS,KAAKiS,GAAGM,0BACtDvS,KAAK+R,aAAaS,eAAiBxS,KAAKiS,GAAGO,eAC3CxS,KAAK+R,aAAaU,kBAAoBzS,KAAKiS,GAAGQ,kBAC9CzS,KAAK+R,aAAaW,oBAAsB1S,KAAKiS,GAAGS,oBAEhD1S,KAAKgS,YAAYW,YAAc3S,KAAKiS,GAAGU,YACvC3S,KAAKgS,YAAYY,aAAe5S,KAAKiS,GAAGW,aACxC5S,KAAKgS,YAAYa,YAAc7S,KAAKiS,GAAGY,YACvC7S,KAAKgS,YAAYc,YAAc9S,KAAKiS,GAAGa,YACvC9S,KAAKgS,YAAYe,aAAe/S,KAAKiS,GAAGc,aACxC/S,KAAKgS,YAAYgB,YAAchT,KAAKiS,GAAGe,YACvChT,KAAKgS,YAAYiB,YAAcjT,KAAKiS,GAAGgB,YACvCjT,KAAKgS,YAAYkB,aAAelT,KAAKiS,GAAGiB,aACxClT,KAAKgS,YAAYmB,YAAcnT,KAAKiS,GAAGkB,YAEhCnT,MAORoT,aAAc,SAAUlK,GAEvB,OAAOlJ,KAAKiS,GAAGmB,aAAapT,KAAKiS,GAAG/I,KAOrCmK,gBAAiB,SAAU3C,EAAM4C,EAAQnT,GAExC,GAAe,IAAXmT,GAAgBnT,IAAWuQ,EAAKvQ,QAE/BuQ,aAAgBH,aACnB,OAAOG,EAGT,IAAI6C,EAAO,IAAIhD,aAAapQ,GAE5B,IAAK,IAAID,EAAI,EAAGA,EAAIC,EAAQD,IAC3BqT,EAAKrT,GAAKwQ,EAAKxQ,EAAEoT,GAElB,OAAOC,GASRC,iBAAkB,SAAU9C,EAAME,EAAO,KAAM6C,EAAM,KAAMH,EAAO,KAAMnT,EAAO,MAE9EyQ,EAASA,GAAUkB,EAAIC,aAAaI,aACpCsB,EAAQA,GAAS3B,EAAIE,YAAYW,YAEjC,IAAIY,EAAOvT,KAAKiS,GAAGyB,eAKnB,OAJA1T,KAAKiS,GAAG0B,WAAY/C,EAAQ2C,GAC5BvT,KAAKiS,GAAG2B,WAAYhD,EAAQ5Q,KAAKqT,gBAAgB3C,EAAM4C,GAAU,EAAGnT,GAAUuQ,EAAKvQ,QAASsT,GAGrFF,I;AAMTM,EAAe/B;aClHf;MAAMgC,EACN,CAICC,SAAU,GAMV3F,IAAK,SAAUlF,EAAM8K,GAEpBhU,KAAK+T,SAAS7K,GAAQ8K,GAOvBC,IAAK,SAAU/K,GAEd,OAAOlJ,KAAK+T,SAASG,eAAehL,GAAQlJ,KAAK+T,SAAS7K,GAAQ,IAMnEiL,QAAS,SAAUC,EAAMC,GAExBD,EAAOA,EAAKE,MAAM,MAElB,IAAK,IAAIpU,EAAI,EAAGA,EAAIkU,EAAKjU,OAAQD,IACjC,CACC,IAAIb,EAAQ+U,EAAKlU,GAAGqU,OAEpB,GAAIlV,EAAMmV,WAAW,WACrB,CACC,IAAIC,EAAM,GAEV,IAAK,IAAIvL,KAAQ7J,EAAMqV,UAAU,GAAGJ,MAAM,KAEzCpL,EAAOA,EAAKqL,OAERF,EAAgBH,eAAehL,KAGnCmL,EAAgBnL,IAAQ,EAExBuL,GAAOX,EAAKK,QAAQL,EAAKG,IAAI/K,GAAOmL,GAAmB,MAGxDD,EAAKlU,GAAKuU,GAIZ,OAAOL,EAAKO,KAAK,OAYlBC,QAAS,SAAUR,GAUlB,OANkC,KAFlCA,EAAOA,EAAKG,QAEHM,QAAQ,eAChBT,EAAO,2BAA6BA,IAEJ,IAA7BA,EAAKS,QAAQ,cAChBT,EAAO,oBAAsBA,GAEvBpU,KAAKmU,QAAQC,EAAM,M;AAM5BU,EAAehB,EAMfA,EAAK1F,IAAI,YAAa,6QActB0F,EAAK1F,IAAI,YAAa,yNAYtB0F,EAAK1F,IAAI,UAAW,+EAMpB0F,EAAK1F,IAAI,UAAW,+EAOpB0F,EAAK1F,IAAI,OAAQ,kNAejB0F,EAAK1F,IAAI,QAAS,+MAclB0F,EAAK1F,IAAI,aAAc,kOAUvB0F,EAAK1F,IAAI,iBAAkB,+OAS3B0F,EAAK1F,IAAI,WAAY,mKAQrB0F,EAAK1F,IAAI,OAAQ,gHAMjB0F,EAAK1F,IAAI,QAAS,0FAMlB0F,EAAK1F,IAAI,SAAU,gIAMnB0F,EAAK1F,IAAI,OAAQ,uJAUjB0F,EAAK1F,IAAI,YAAa;;;;AC9MtB,MAAM2G,EAAStV,EAAMC,OACpB,CAKAsV,GAAI,KAMJC,KAAM,EAMNC,SAAU,KAkBVnV,OAAQ,SAAUiV,EAAIC,EAAK,KAAMjB,EAAO,MAExB,OAAXA,GAA4B,OAATiB,GAAkC,iBAAVA,IAE9CjB,EAASiB,EACTA,EAAO,MAGK,OAATA,IAEHA,EAAOD,EACPA,EAAK,MAGND,EAAOI,IAAInV,KAAKgV,GAAKA,EAAIhV,MACzBA,KAAKiV,KAAOA,EAEZjV,KAAKkV,SAAW,KAED,OAAXlB,GACHhU,KAAKoV,QAAQpB,IAMfnL,OAAQ,WAEPgL,EAAI5B,GAAGoD,aAAarV,KAAKkV,UACzBH,EAAO3J,OAAOpL,KAAKgV,KAOpBI,QAAS,SAAUpB,GAElB,IAAI/B,EAAK4B,EAAI5B,GACbjS,KAAKkV,SAAWjD,EAAGqD,aAActV,KAAKiV,OAASF,EAAOQ,KAAKC,OAASvD,EAAGwD,cAAiBzV,KAAKiV,OAASF,EAAOQ,KAAKG,SAAWzD,EAAG0D,gBAAkB1D,EAAG2D,iBAErJ5B,EAASc,EAAKF,QAAQZ,GAEtB/B,EAAG4D,aAAa7V,KAAKkV,SAAUlB,GAC/B/B,EAAG6D,cAAc9V,KAAKkV,UAEtB,IAAItM,EAAQqJ,EAAG8D,iBAAiB/V,KAAKkV,UACrC,GAAItM,EAEH,MADAD,QAAQC,MAAMoL,EAAOM,MAAM,MAAM0B,KAAI,CAAC9V,EAAEN,IAAUA,EAAU,KAAOM,IAAGyU,KAAK,OACrE,IAAInO,OAAQxG,KAAKgV,GAAK,IAAMhV,KAAKgV,GAAK,KAAO,IAAMpM,GAG1D,OAAO5I;SAST+U;EAAOkB,QAAU,GAMjBlB,EAAOI,IAAM,SAAUH,EAAIkB,GAEtBlB,IAAIhV,KAAKiW,QAAQjB,GAAMkB,IAO5BnB,EAAOd,IAAM,SAAUe,GAEtB,OAAOhV,KAAKiW,QAAQjB,IAOrBD,EAAO3J,OAAS,SAAU4J,UAElBhV,KAAKiW,QAAQjB;;;AAWrBD,EAAOQ,KAAO,CACbC,OAAQ;;AAERE,SAAU;;AAEVS,SAAU,G;AAMXC,EAAerB;;;;sBChJf;MAAMsB,EAAgB5W,EAAMC,OAC3B,CAIA4W,UAAW,KAMXtB,GAAI,KAMJiB,QAAS,KAMTM,UAAW,KAMXxW,OAAQ,SAAUiV,EAAG,MAEpBhV,KAAKgV,GAAKA,EAEVhV,KAAKiW,QAAU,GACfjW,KAAKuW,UAAY,KAEjBvW,KAAKsW,UAAY,GAEjBtW,KAAKwW,eAAiB,KAEtBH,EAAclB,IAAIH,EAAIhV,OAMvB6I,OAAQ,WAEP,IAAIoJ,EAAK4B,EAAI5B,GACb,IAAKA,EAAI,OAAOjS,KAEhBiS,EAAGwE,cAAczW,KAAKuW,WACtBF,EAAcjL,OAAOpL,KAAKgV,KAS3B0B,cAAe,SAAUA,GAGxB,OADA1W,KAAKwW,eAAiBE,EACf1W,MAOR2W,OAAQ,SAAUT,GAKjB,GAHuB,iBAAZA,IACVA,EAASE,EAAOnC,IAAIiC,KAEhBA,EACJ,MAAM,IAAI1P,MAAO,8CAGlB,OADAxG,KAAKiW,QAAQtL,KAAKuL,GACXlW,MAMR4W,cAAe,WAEd/C,EAAI5B,GAAG4E,mBAAoB7W,KAAKuW,UAAW,EAAG,aAO/CO,kBAAmB,SAAU5N,GAK5B,OAHKlJ,KAAKsW,UAAUpC,eAAehL,KAClClJ,KAAKsW,UAAUpN,GAAQ2K,EAAI5B,GAAG6E,kBAAmB9W,KAAKuW,UAAWrN,IAE3DlJ,KAAKsW,UAAUpN,IAOvB6N,mBAAoB,SAAU7N,GAK7B,OAHKlJ,KAAKsW,UAAUpC,eAAehL,KAClClJ,KAAKsW,UAAUpN,GAAQ2K,EAAI5B,GAAG8E,mBAAoB/W,KAAKuW,UAAWrN,IAE5DlJ,KAAKsW,UAAUpN,IAOvB8N,wBAAyB,SAAU9N,GAKlC,OAHKlJ,KAAKsW,UAAUpC,eAAehL,KAClClJ,KAAKsW,UAAUpN,GAAQ2K,EAAI5B,GAAGgF,qBAAsBjX,KAAKuW,UAAWrN,IAE9DlJ,KAAKsW,UAAUpN,IAOvBgO,oBAAqB,SAAUC,GAK9B,MAH6B,iBAAlBA,IACVA,EAAenX,KAAKgX,wBAAwBG,IAEtCtD,EAAI5B,GAAGmF,+BAA+BpX,KAAKuW,UAAWY,EAActD,EAAI5B,GAAGoF,0BAOnFC,yBAA0B,SAAUH,GAEN,iBAAlBA,IACVA,EAAenX,KAAKgX,wBAAwBG,IAE7C,IAAII,EAAOvX,KAAKkX,oBAAoBC,GAChC5D,EAAOM,EAAIL,iBAAkB,IAAIjD,aAAagH,GAAM3Q,KAAK,GAAIiN,EAAI9B,aAAaS,eAAgBqB,EAAI7B,YAAYY,cAElHiB,EAAI5B,GAAGuF,eAAgB3D,EAAI9B,aAAaS,eAAgB,EAAGe,IAM5DkE,iBAAkB,WAEjBzX,KAAK+W,mBAAmB,UACxB/W,KAAK+W,mBAAmB,WAExB/W,KAAK+W,mBAAmB,eACxB/W,KAAK+W,mBAAmB,aACxB/W,KAAK+W,mBAAmB,UAExB/W,KAAK+W,mBAAmB,gBACxB/W,KAAK+W,mBAAmB,gBAExB/W,KAAK+W,mBAAmB,WACxB/W,KAAK+W,mBAAmB,WACxB/W,KAAK+W,mBAAmB,gBAExB/W,KAAK+W,mBAAmB,YAExB/W,KAAK8W,kBAAkB,aAOxBY,KAAM,WAEL,IAAIzF,EAAK4B,EAAI5B,GACb,IAAKA,EAAI,OAAOjS,KAEhBA,KAAKuW,UAAYtE,EAAG0F,gBAEpB,IAAK,IAAIzB,KAAUlW,KAAKiW,QACvBhE,EAAG2F,aAAc5X,KAAKuW,UAAWL,EAAOhB,UAMzC,OAJAlV,KAAK4W,gBACL3E,EAAG4F,YAAa7X,KAAKuW,WACrBvW,KAAKyX,mBAEEzX,MAOR8X,SAAU,WAET,IAAI7F,EAAK4B,EAAI5B,GACRA,IAELA,EAAG8F,WAAY/X,KAAKuW,WAEQ,OAAxBvW,KAAKwW,gBACRxW,KAAKwW,eAAgBxW,KAAMiS,KAO7B+F,UAAW,WAEV,IAAI/F,EAAK4B,EAAI5B,GACb,OAAKA,GAEEA,EAAGgG,oBAAoBjY,KAAKuW,UAAWtE,EAAGiG,cAOlDC,SAAU,WAET,IAAIlG,EAAK4B,EAAI5B,GACb,OAAKA,EAEkB,OAAnBjS,KAAKuW,UACD,+BAEDtE,EAAGmG,kBAAkBpY,KAAKuW,WALjB,IAYjB8B,UAAW,SAAUC,EAAUC,GAM9B,MAJyB,iBAAdD,IACVA,EAAWtY,KAAK+W,mBAAmBuB,IAEpCzE,EAAI5B,GAAGoG,UAAWC,EAAUC,GACrBvY,MAORwY,WAAY,SAAUF,EAAUjZ,GAM/B,MAJyB,iBAAdiZ,IACVA,EAAWtY,KAAK+W,mBAAmBuB,IAEpCzE,EAAI5B,GAAGuG,WAAYF,EAAUjZ,GACtBW,MAORyY,UAAW,SAAUH,EAAUC,GAM9B,MAJyB,iBAAdD,IACVA,EAAWtY,KAAK+W,mBAAmBuB,IAEpCzE,EAAI5B,GAAGwG,UAAWH,EAAUC,GACrBvY,MAOR0Y,WAAY,SAAUJ,EAAUjZ,GAM/B,MAJyB,iBAAdiZ,IACVA,EAAWtY,KAAK+W,mBAAmBuB,IAEpCzE,EAAI5B,GAAGyG,WAAYJ,EAAUjZ,GACtBW,MAOR2Y,UAAW,SAAUL,EAAUC,EAAIK,GAMlC,MAJyB,iBAAdN,IACVA,EAAWtY,KAAK+W,mBAAmBuB,IAEpCzE,EAAI5B,GAAG0G,UAAWL,EAAUC,EAAIK,GACzB5Y,MAOR6Y,WAAY,SAAUP,EAAUjZ,GAM/B,MAJyB,iBAAdiZ,IACVA,EAAWtY,KAAK+W,mBAAmBuB,IAEpCzE,EAAI5B,GAAG4G,WAAYP,EAAUjZ,GACtBW,MAOR8Y,UAAW,SAAUR,EAAUC,EAAIK,GAMlC,MAJyB,iBAAdN,IACVA,EAAWtY,KAAK+W,mBAAmBuB,IAEpCzE,EAAI5B,GAAG6G,UAAWR,EAAUC,EAAIK,GACzB5Y,MAOR+Y,WAAY,SAAUT,EAAUjZ,GAM/B,MAJyB,iBAAdiZ,IACVA,EAAWtY,KAAK+W,mBAAmBuB,IAEpCzE,EAAI5B,GAAG8G,WAAYT,EAAUjZ,GACtBW,MAORgZ,UAAW,SAAUV,EAAUC,EAAIK,EAAIK,GAMtC,MAJyB,iBAAdX,IACVA,EAAWtY,KAAK+W,mBAAmBuB,IAEpCzE,EAAI5B,GAAG+G,UAAWV,EAAUC,EAAIK,EAAIK,GAC7BjZ,MAORkZ,WAAY,SAAUZ,EAAUjZ,GAM/B,MAJyB,iBAAdiZ,IACVA,EAAWtY,KAAK+W,mBAAmBuB,IAEpCzE,EAAI5B,GAAGiH,WAAYZ,EAAUjZ,GACtBW,MAORmZ,UAAW,SAAUb,EAAUC,EAAIK,EAAIK,GAMtC,MAJyB,iBAAdX,IACVA,EAAWtY,KAAK+W,mBAAmBuB,IAEpCzE,EAAI5B,GAAGkH,UAAWb,EAAUC,EAAIK,EAAIK,GAC7BjZ,MAORoZ,WAAY,SAAUd,EAAUjZ,GAM/B,MAJyB,iBAAdiZ,IACVA,EAAWtY,KAAK+W,mBAAmBuB,IAEpCzE,EAAI5B,GAAGmH,WAAYd,EAAUjZ,GACtBW,MAORqZ,UAAW,SAAUf,EAAUC,EAAIK,EAAIK,EAAIK,GAM1C,MAJyB,iBAAdhB,IACVA,EAAWtY,KAAK+W,mBAAmBuB,IAEpCzE,EAAI5B,GAAGoH,UAAWf,EAAUC,EAAIK,EAAIK,EAAIK,GACjCtZ,MAORuZ,WAAY,SAAUjB,EAAUjZ,GAM/B,MAJyB,iBAAdiZ,IACVA,EAAWtY,KAAK+W,mBAAmBuB,IAEpCzE,EAAI5B,GAAGsH,WAAYjB,EAAUjZ,GACtBW,MAORwZ,UAAW,SAAUlB,EAAUC,EAAIK,EAAIK,EAAIK,GAM1C,MAJyB,iBAAdhB,IACVA,EAAWtY,KAAK+W,mBAAmBuB,IAEpCzE,EAAI5B,GAAGuH,UAAWlB,EAAUC,EAAIK,EAAIK,EAAIK,GACjCtZ,MAORyZ,WAAY,SAAUnB,EAAUjZ,GAM/B,MAJyB,iBAAdiZ,IACVA,EAAWtY,KAAK+W,mBAAmBuB,IAEpCzE,EAAI5B,GAAGwH,WAAYnB,EAAUjZ,GACtBW,QAQTqW,EAAcqD,SAAW,GAOzBrD,EAAcsD,OAAS,SAAU3E,EAAIhB,GAEpC,IAAI4F,EAAK,KAAMC,EAAS,KACpBC,EAAK,KAAMC,EAAS,KACpBC,EAAK,KAAMC,EAAS,KAEpBC,EAAS,KAEb,IAAK,IAAIC,KAAKnG,EAAOM,MAAM,MAC3B,CACC,IAAIjG,EAAI8L,EAAE5F,OAEV,GAAIlG,EAAEmG,WAAW,MACjB,CAGC,GAFAnG,EAAIA,EAAEiG,MAAM,KAAK0B,KAAI9V,GAAKA,EAAEqU,SAEf,YAATlG,EAAE,GAAkB,CACnBA,EAAElO,OAAS,IAAG0Z,EAASxL,EAAE,IAClB,OAAPuL,IAAaA,EAAK,IACtBM,EAASN,EACT,SAGD,GAAa,YAATvL,EAAE,GAAkB,CACnBA,EAAElO,OAAS,IAAG4Z,EAAS1L,EAAE,IAClB,OAAPyL,IAAaA,EAAK,IACtBI,EAASJ,EACT,SAID,GAAa,YAATzL,EAAE,GAAkB,CACnBA,EAAElO,OAAS,IAAG8Z,EAAS5L,EAAE,IAClB,OAAP2L,IAAaA,EAAK,IACtBE,EAASF,EACT,UAIa,OAAXE,GACHA,EAAOvP,KAAKwP,GAGd,IAAIC,EAAM,IAAI/D,EAAcrB,GAQ5B,GALW,OAAP4E,IAAaA,EAAKA,EAAGjF,KAAK,MAAMJ,QACzB,OAAPuF,IAAaA,EAAKA,EAAGnF,KAAK,MAAMJ,QACzB,OAAPyF,IAAaA,EAAKA,EAAGrF,KAAK,MAAMJ,QAGzB,OAAPqF,GAA6B,IAAdA,EAAGzZ,QAGrB,GADAyZ,EAAKxD,EAAOnC,IAAI4F,GACL,OAAPD,EAAa,MAAM,IAAIpT,MAAM,4BAA8BqT,QAEhD,OAAPD,GAA6B,IAAdA,EAAGzZ,SAC1ByZ,EAAK,MAEN,GAAW,OAAPE,GAA6B,IAAdA,EAAG3Z,QAGrB,GADA2Z,EAAK1D,EAAOnC,IAAI8F,GACL,OAAPD,EAAa,MAAM,IAAItT,MAAM,8BAAgCuT,QAElD,OAAPD,GAA6B,IAAdA,EAAG3Z,SAC1B2Z,EAAK,MAEN,GAAW,OAAPE,GAA6B,IAAdA,EAAG7Z,QAGrB,GADA6Z,EAAK5D,EAAOnC,IAAIgG,GACL,OAAPD,EAAa,MAAM,IAAIxT,MAAM,8BAAgCyT,QAElD,OAAPD,GAA6B,IAAdA,EAAG7Z,SAC1B6Z,EAAK,MAqBN,OAlBW,OAAPJ,IAAaA,EAAKxD,EAAOnC,IAAI,aACtB,OAAP6F,IAAaA,EAAK1D,EAAOnC,IAAI,aAGtB,OAAP2F,GAA8B,iBAARA,IACzBA,EAAK,IAAIxD,EAAQyD,EAAQzD,EAAOb,KAAKC,OAAQoE,IAEnC,OAAPE,GAA8B,iBAARA,IACzBA,EAAK,IAAI1D,EAAQ2D,EAAQ3D,EAAOb,KAAKG,SAAUoE,IAErC,OAAPE,GAA8B,iBAARA,IACzBA,EAAK,IAAI5D,EAAQ6D,EAAQ7D,EAAOb,KAAKY,SAAU6D,IAGrC,OAAPJ,GAAaQ,EAAIzD,OAAOiD,GACjB,OAAPE,GAAaM,EAAIzD,OAAOmD,GACjB,OAAPE,GAAaI,EAAIzD,OAAOqD,GAErBI,EAAI1C,QAOZrB,EAAclB,IAAM,SAAUH,EAAIqF,GAE7BrF,IAAIhV,KAAK0Z,SAAS1E,GAAMqF,IAO7BhE,EAAcpC,IAAM,SAAUe,GAE7B,OAAOhV,KAAK0Z,SAAS1E,IAOtBqB,EAAcjL,OAAS,SAAU4J,UAEzBhV,KAAK0Z,SAAS1E,I,IAGtBsF,EAAejE;;;ACtkBfkE,EAAe9a,EAAMC,OACpB,CACA6G,UAAW,UAMXiU,UAAW,KAMXC,MAAO,EAMPC,OAAQ,EAMRC,YAAa,EAMbC,aAAc,EAMdC,OAAQ,EAMR5O,OAAQ,SAMR6O,KAAM,gBAMNC,OAAQ,EAKRC,WAAW,EAKXC,OAAQ,KAMRlb,OAAQ,SAAU0a,EAAOC,EAAQC,EAAY,KAAMC,EAAa,MAE/D5a,KAAKwa,UAAY,KAEjBxa,KAAKya,MAAQA,EACbza,KAAK0a,OAASA,EACd1a,KAAK2a,YAAcA,GAAeF,EAClCza,KAAK4a,aAAeA,GAAgBF,EAEpC1a,KAAK6a,OAAS7a,KAAKya,MAAQza,KAAK2a,YAChC3a,KAAKiM,OAAS,SACdjM,KAAK8a,KAAO,gBACZ9a,KAAK+a,OAAS,GAOfG,KAAM,WAEL,MAAMjJ,EAAK4B,EAAI5B,GAaf,OAXuB,OAAnBjS,KAAKwa,YACRxa,KAAKwa,UAAYvI,EAAGkJ,iBAErBlJ,EAAGmJ,YAAYnJ,EAAGoJ,WAAYrb,KAAKwa,YAEZ,IAAnBxa,KAAKgb,YAERhb,KAAKgb,UAAY,KACjBhb,KAAK4H,YAGCqK,GAORrK,SAAU,WAET,IAAuB,IAAnB5H,KAAKgb,UACR,OAAOhb,KAERA,KAAKgb,WAAY,EAEjB,MAAM/I,EAAKjS,KAAKkb,OAUhB,OARAlb,KAAKsb,YAAYrJ,GACjBjS,KAAKub,UAAUtJ,GAEXjS,KAAK+a,OAAS,EACjB9I,EAAGuJ,aAAavJ,EAAGoJ,WAAYrb,KAAK+a,OAAQ9I,EAAGwJ,MAAOzb,KAAKya,MAAOza,KAAK0a,QAEvEzI,EAAGuJ,aAAavJ,EAAGoJ,WAAY,EAAGpJ,EAAGwJ,MAAOzb,KAAKya,MAAOza,KAAK0a,QAEvD1a,MAORsb,YAAa,SAAUI,EAAI,MAE1B,MAAMzJ,EAAKyJ,GAAO1b,KAAKkb,OA6BvB,OA3BIlb,KAAK+a,OAAS,EAEG,YAAhB/a,KAAKiM,QAERgG,EAAG0J,cAAc1J,EAAGoJ,WAAYpJ,EAAG2J,mBAAoB3J,EAAG4J,uBAC1D5J,EAAG0J,cAAc1J,EAAGoJ,WAAYpJ,EAAG6J,mBAAoB7J,EAAG8J,WAI1D9J,EAAG0J,cAAc1J,EAAGoJ,WAAYpJ,EAAG2J,mBAAoB3J,EAAG+J,sBAC1D/J,EAAG0J,cAAc1J,EAAGoJ,WAAYpJ,EAAG6J,mBAAoB7J,EAAGgK,SAKvC,YAAhBjc,KAAKiM,QAERgG,EAAG0J,cAAc1J,EAAGoJ,WAAYpJ,EAAG2J,mBAAoB3J,EAAG8J,SAC1D9J,EAAG0J,cAAc1J,EAAGoJ,WAAYpJ,EAAG6J,mBAAoB7J,EAAG8J,WAI1D9J,EAAG0J,cAAc1J,EAAGoJ,WAAYpJ,EAAG2J,mBAAoB3J,EAAGgK,QAC1DhK,EAAG0J,cAAc1J,EAAGoJ,WAAYpJ,EAAG6J,mBAAoB7J,EAAGgK,SAIrDjc,MAORub,UAAW,SAAUG,EAAI,MAExB,MAAMzJ,EAAKyJ,GAAO1b,KAAKkb,OAkBvB,MAhBkB,WAAdlb,KAAK8a,MAER7I,EAAG0J,cAAc1J,EAAGoJ,WAAYpJ,EAAGiK,eAAgBjK,EAAGkK,QACtDlK,EAAG0J,cAAc1J,EAAGoJ,WAAYpJ,EAAGmK,eAAgBnK,EAAGkK,SAEhC,oBAAdnc,KAAK8a,MAEb7I,EAAG0J,cAAc1J,EAAGoJ,WAAYpJ,EAAGiK,eAAgBjK,EAAGoK,iBACtDpK,EAAG0J,cAAc1J,EAAGoJ,WAAYpJ,EAAGmK,eAAgBnK,EAAGoK,mBAItDpK,EAAG0J,cAAc1J,EAAGoJ,WAAYpJ,EAAGiK,eAAgBjK,EAAGqK,eACtDrK,EAAG0J,cAAc1J,EAAGoJ,WAAYpJ,EAAGmK,eAAgBnK,EAAGqK,gBAGhDtc,MAORuc,UAAW,SAAUtQ,GAIpB,OAFAjM,KAAKiM,OAASA,EACS,OAAnBjM,KAAKwa,WAAoBxa,KAAKsb,cAC3Btb,MAORwc,QAAS,SAAU1B,GAIlB,OAFA9a,KAAK8a,KAAOA,EACW,OAAnB9a,KAAKwa,WAAoBxa,KAAKub,YAC3Bvb,MAORyc,UAAW,SAAU1B,GAIpB,GAFA/a,KAAK+a,OAASA,EAES,OAAnB/a,KAAKwa,YAAyC,IAAnBxa,KAAKgb,WAAsBhb,KAAK+a,OAAS,EACxE,CACC,MAAM9I,EAAKjS,KAAKkb,OAChBjJ,EAAGyK,eAAezK,EAAGoJ,YAGtB,OAAOrb,MAOR2c,OAAQ,SAAUC,EAAOC,EAAQ,EAAGC,EAAQ,GAE3C,MAAM7K,EAAKjS,KAAKkb,OAOhB,OALAjJ,EAAG8K,cAAc9K,EAAGoJ,WAAY,EAAGwB,EAASC,EAASpV,KAAKC,IAAIiV,EAAMnC,MAAOza,KAAKya,OAAQ/S,KAAKC,IAAIiV,EAAMlC,OAAQ1a,KAAK0a,QAASzI,EAAG+K,KAAM/K,EAAGgL,cAAeL,GAEpJ5c,KAAK+a,OAAS,GACjB9I,EAAGyK,eAAezK,EAAGoJ,YAEfrb,MAORkd,aAAc,SAAUC,EAAQ,MAK/B,OAHoB,OAAhBnd,KAAKib,SACRjb,KAAKib,OAAS,IAAImC,EAAQ,CAAEnL,IAAI,EAAOoL,QAAQ,EAAM5C,MAAOza,KAAKya,MAAOC,OAAQ1a,KAAK0a,OAAQ4C,UAA2B,WAAhBtd,KAAKiM,UAAwBkR,KAE/Hnd,MAORud,UAAW,WAEV,OAAOvd,KAAKib,QAQbuC,aAAc,SAAUhR,EAAS,MAEhC,GAAoB,OAAhBxM,KAAKib,OAGR,OADiB,OAAbzO,GAAmBA,IAChBxM,KAGR,IAAIyd,EAAM,IAAIC,MAUd,OATAD,EAAIE,OAAS,KAEZ3d,KAAK2c,OAAOc,GACZA,EAAM,KAEW,OAAbjR,GAAmBA,KAGxBiR,EAAIG,IAAM5d,KAAKib,OAAO4C,YACf7d,MAOR8d,cAAe,WAQd,OANoB,OAAhB9d,KAAKib,SAERjb,KAAKib,OAAOnQ,UACZ9K,KAAKib,OAAS,MAGRjb,MAcR+d,aAAc,SAAUZ,EAASa,EAAO,MAYvC,MAVwB,mBAAbb,IAEVa,EAASb,EACTA,EAAU,MAGXa,EAAOhe,KAAKkd,aAAaC,IAEzBnd,KAAKwd,eACLxd,KAAK8d,gBACE9d;;;;;;;;;;;;;;;ACvRT,MAAMie,EAAS,SAAUd,EAAQ,MAEhC,IAAIe,EAAO,CACVC,KAAM,KACNlM,IAAI,EACJmM,WAAY,UACZ3D,MAAO,EACPC,OAAQ,EACR2C,QAAQ,EACRgB,UAAU,EACVf,WAAW,KACRH,GAGJ,MAAMmB,GAAWvY,EAAOwY,SAGP,MAAbL,EAAKC,MAERne,KAAKme,KAAQG,EAAqD1T,EAAKF,MAAMuT,EAAOO,gBAA5DzY,EAAOwY,SAASE,cAAc,UAElD1Y,EAAOwY,UAA2B,GAAfL,EAAKb,SAE3BtX,EAAOwY,SAASG,KAAKC,YAAa3e,KAAKme,OAEjB,IAAlBD,EAAKG,WACRre,KAAKme,KAAKS,MAAMC,SAAW,WAC3B7e,KAAKme,KAAKS,MAAME,KAAO,IACvB9e,KAAKme,KAAKS,MAAMrU,IAAM,OAMxBvK,KAAKme,KAAOD,EAAKC,KAGbne,KAAKme,KAAKY,cAEC,IAAZb,EAAKjM,IAAgBqM,GAcxBte,KAAK8L,QAAU9L,KAAKme,KAAKY,WAAW,KAAM,CAAEC,gBAAgB,IAC5Dhf,KAAKiS,GAAK,OAbVjS,KAAKiS,GAAKjS,KAAKme,KAAKY,WAAW,SAAU,CAAEC,gBAAgB,EAAOC,uBAAuB,EAAOC,OAAO,EAAOC,SAAS,IAEpG,OAAfC,EAAQnN,IACX4B,EAAI3B,WAAWkN,EAAQnN,GAAKjS,KAAKiS,IAElCjS,KAAKqa,cAAgB,KACrBra,KAAK8L,QAAU,KAEfuT,EAAIC,MAAMzL,EAAIT,aAAa,WAAa,KAAOS,EAAIT,aAAa,8BASjEpT,KAAKuf,YAAcnT,EAAK1C,KAAK5B,QAC7B9H,KAAKwf,WAAapT,EAAK1C,KAAK5B,QAC5B9H,KAAKyf,eAAiBrT,EAAK1C,KAAK5B,QAChC9H,KAAK0f,mBAAqBtT,EAAK1C,KAAK5B,QAEpC9H,KAAK+Q,KAAOc,EAAOnI,KAAK5B,QACxB9H,KAAK2f,UAAY9N,EAAOnI,KAAK5B,QAG7B9H,KAAK4f,aAAe,EACpB5f,KAAK6f,OAAS,EACd7f,KAAK8f,YAAa,EAGlB9f,KAAK+f,kBACL/f,KAAKggB,YAAY,QACjBhgB,KAAKigB,UAAU,QAEX/B,EAAKzD,OAASyD,EAAKxD,QACvB1a,KAAKkgB,OAAQhC,EAAKzD,MAAOyD,EAAKxD,QAEd,OAAZ1a,KAAKiS,IACRjS,KAAKmgB,SAENngB,KAAKsd,UAAYY,EAAKZ,UACtBtd,KAAKogB,cAAelC,EAAKE,cAG1BH,EAAOO,eACP,CACC6B,WAAY,KAEZC,uBAAuB,EAEvB1B,MAAO,GAGPnE,MAAO,IACPC,OAAQ,IAERqE,WAAY,SAAUwB,GACrB,OAAOvgB,MAGRwgB,SAAU,aAGVC,QAAS,aAGThT,MAAO,SAAUyD,EAAIC,KAGrBnC,OAAQ,SAAUC,KAGlBJ,UAAW,SAAUvP,EAAG6O,KAGxBuS,aAAc,SAAUrgB,EAAGC,EAAGC,EAAGC,EAAGmgB,EAAGC,KAGvCb,gBAAiB,aAGjBc,UAAW,SAAUC,EAAMC,GAC1B,MAAO,IAGRC,UAAW,aAGXC,OAAQ,SAAU3hB,EAAG6O,KAGrB+S,UAAW,aAGXC,OAAQ,aAGRC,KAAM,SAAS9hB,EAAG6O,EAAGkT,EAAGC,KAGxB1a,KAAM,aAGN2a,OAAQ,aAGRC,SAAU,SAASliB,EAAG6O,EAAGkT,EAAGC,KAG5BG,WAAY,SAASniB,EAAG6O,EAAGkT,EAAGC,KAG9BI,KAAM,aAGNC,iBAAkB,SAAUC,EAAKC,EAAKviB,EAAG6O,KAGzC2T,cAAe,SAAUC,EAAKC,EAAKC,EAAKC,EAAK5iB,EAAG6O,KAGhDgU,IAAK,SAAU7iB,EAAG6O,EAAGiU,EAAGC,EAAIC,EAAIC,KAGhCC,MAAO,SAAUC,EAAIC,EAAIC,EAAIC,EAAIR,KAGjCS,SAAU,SAAUC,EAAMxjB,EAAG6O,EAAG4U,KAGhCC,WAAY,SAAUF,EAAMxjB,EAAG6O,EAAG4U,KAGlCE,YAAa,SAAUH,GACtB,MAAO,CAAErI,MAAO,IAGjByI,gBAAiB,SAAU7B,EAAGC,GAC7B,MAAO,CAAE7G,MAAO4G,EAAG3G,OAAQ4G,IAG5B6B,aAAc,SAAU7jB,EAAG6O,EAAGkT,EAAGC,GAChC,MAAO,CAAE7G,MAAO4G,EAAG3G,OAAQ4G,EAAG5Q,KAAM,KAGrC0S,aAAc,SAAU1S,EAAMpR,EAAG6O,KAGjCkV,UAAW,SAAU5F,EAAKvM,EAAG,EAAGC,EAAG,EAAGmS,EAAG,KAAMC,EAAG,KAAMzU,EAAG,KAAMC,EAAG,KAAMyU,EAAG,KAAMC,EAAG,KAAMC,EAAa,KAAMC,EAAc,KAAMC,EAAW,KAAMC,EAAY,QAGhKC,sBAAuB,WACtB,MAAO,CAAEhF,KAAM,EAAGvU,IAAK,KAOzB0T,EAAO3X,UAAU6Z,OAAS,WAEzB,IAAI4D,EAAK/jB,KAAKiS,GAkId,GA7HAjS,KAAKgkB,eAAiB,IAAI1J,EAAc,SAExC,IAAIlE,EAAQ,aAAcA,EAAOb,KAAKC,OACtC,oZAmBA,IAAIY,EAAQ,aAAcA,EAAOb,KAAKG,SACtC,0RAmBA1V,KAAKikB,iBAAmB,IAAI3J,EAAc,OAE1C,IAAIlE,EAAQ,WAAYA,EAAOb,KAAKC,OACpC,2WAmBA,IAAIY,EAAQ,WAAYA,EAAOb,KAAKG,SACpC,2OAgBA1V,KAAKkkB,cAAgB,IAAI5J,EAAc,QAEvC,IAAIlE,EAAQ,YAAaA,EAAOb,KAAKC,OACrC,uUAgBA,IAAIY,EAAQ,YAAaA,EAAOb,KAAKG,SACrC,+JAWA1V,KAAKikB,iBAAiBtN,OAAO,YAC7B3W,KAAKikB,iBAAiBtN,OAAO,YAE7B3W,KAAKgkB,eAAerN,OAAO,cAC3B3W,KAAKgkB,eAAerN,OAAO,cAE3B3W,KAAKkkB,cAAcvN,OAAO,aAC1B3W,KAAKkkB,cAAcvN,OAAO,aAE1B3W,KAAKikB,iBAAiBvM,OACtB1X,KAAKgkB,eAAetM,OACpB1X,KAAKkkB,cAAcxM,QAEd1X,KAAKikB,iBAAiBjM,YAC1B,MAAM,IAAIxR,MAAOxG,KAAKikB,iBAAiBE,gBAExC,IAAKnkB,KAAKgkB,eAAehM,YACxB,MAAM,IAAIxR,MAAOxG,KAAKgkB,eAAeG,gBAEtC,IAAKnkB,KAAKkkB,cAAclM,YACvB,MAAM,IAAIxR,MAAOxG,KAAKkkB,cAAcC,gBAErCnkB,KAAKokB,iBAAiB9J,EAAcrG,IAAI,QAKxCjU,KAAKqkB,KAAON,EAAGO,oBACfP,EAAGQ,gBAAgBvkB,KAAKqkB,MAExBxQ,EAAIL,iBAAiB,CAAE,EAAK,EAAK,EAAM,EAAK,EAAK,EAAM,EAAK,EAAK,EAAM,EAAK,EAAK,GAAOK,EAAI9B,aAAaI,aAAc0B,EAAI7B,YAAYW,aAEvIoR,EAAGS,oBAAoBxkB,KAAKqa,cAAcvD,kBAAkB,YAAa,EAAGiN,EAAGU,MAAOV,EAAGW,MAAO,EAAEnU,aAAaoU,kBAAmB,EAAEpU,aAAaoU,mBACjJZ,EAAGa,wBAAwB5kB,KAAKqa,cAAcvD,kBAAkB,aAKhEiN,EAAGc,WAAY,EAAK,EAAK,EAAK,GAE9Bd,EAAGe,OAAQf,EAAGgB,YACdhB,EAAGiB,WAAY,GACfjB,EAAGkB,UAAWlB,EAAGmB,QAEjBnB,EAAGoB,QAAQpB,EAAGqB,QAGdrB,EAAGe,OAAQf,EAAGsB,OACdtB,EAAGuB,YAAavB,EAAGwB,gCAAgC,GACnDxB,EAAGyB,sBAAuBzB,EAAG0B,SAAU1B,EAAG0B,UAC1C1B,EAAG2B,UAAW3B,EAAG4B,IAAK5B,EAAG6B,qBAOzB5lB,KAAK6lB,OAAS,IAAItV,aAAa,GAAG3J,KAAK,GACvC5G,KAAK8lB,UAAY,IAAIvV,aAAa,GAAG3J,KAAK,GAC1C5G,KAAK+lB,aAAe,IAAIxV,aAAa,GAAG3J,KAAK,GAC7C5G,KAAKgmB,OAAS,EAEdnU,EAAOD,aAAa5R,KAAK6lB,QACzBhU,EAAOD,aAAa5R,KAAK8lB,WAGzB9lB,KAAKqjB,UAAY,SAAU5F,EAAKvM,EAAIC,EAAImS,EAAIC,EAAIzU,EAAIC,EAAIyU,EAAIC,EAAIC,EAAa,KAAMC,EAAc,KAAMC,EAAW,KAAMC,EAAY,MAEnI,IAAKpG,EAAIjD,UACR,OAED,IAAIvI,EAAKjS,KAAKiS,GACVgU,EAAUjmB,KAAKqa,cAEE,OAAjBqJ,IAEHA,EAAejG,EAAIhD,MACnBkJ,EAAgBlG,EAAI/C,QAGF,OAAfkJ,IAEHA,EAAanG,EAAI9C,YACjBkJ,EAAcpG,EAAI7C,cAGnBqL,EAAQ1M,WAAY,eAAgBvZ,KAAK+lB,cACzCE,EAAQ5N,UAAW,SAAU+G,EAAQ8G,MACrCD,EAAQ5N,UAAW,UAAWrY,KAAK4f,cACnCqG,EAAQ5N,UAAW,UAAWrY,KAAK6f,QACnCoG,EAAQ5N,UAAW,UAAWrY,KAAKgmB,QAE/BhmB,KAAKmmB,kBAAoB1I,EAAIjD,WAAaxa,KAAKomB,eAAiBH,IAEnEhU,EAAGoU,cAAepU,EAAGqU,UACrBrU,EAAGmJ,YAAanJ,EAAGoJ,WAAYoC,EAAIjD,WAEnCyL,EAAQxN,UAAW,WAAY,GAC/BwN,EAAQ5M,UAAW,eAAgBuK,EAAWnG,EAAI5C,OAAO6I,EAAcG,EAAYpG,EAAI5C,OAAO8I,EAAeC,EAAYC,GAEzH7jB,KAAKmmB,gBAAkB1I,EAAIjD,UAC3Bxa,KAAKomB,aAAeH,GAGrBjmB,KAAK6lB,OAAO,GAAKrC,EACjBxjB,KAAK6lB,OAAO,GAAKpC,EACjBzjB,KAAK6lB,OAAO,GAAK/W,EACjB9O,KAAK6lB,OAAO,GAAK9W,EAEjB/O,KAAK8lB,UAAU,GAAKxC,EAAKI,EACzB1jB,KAAK8lB,UAAU,GAAKvC,EAAKI,EACzB3jB,KAAK8lB,UAAU,GAAK5U,EAAKwS,EACzB1jB,KAAK8lB,UAAU,GAAK3U,EAAKwS,EAEzB1R,EAAGsU,iBAAkBN,EAAQlP,mBAAmB,gBAAgB,EAAO/W,KAAK2f,UAAUjP,MACtFuB,EAAGsU,iBAAkBN,EAAQlP,mBAAmB,WAAW,EAAO/W,KAAK6lB,QACvE5T,EAAGsU,iBAAkBN,EAAQlP,mBAAmB,cAAc,EAAO/W,KAAK8lB,WAE1E7T,EAAGuU,WAAYvU,EAAGwU,eAAgB,EAAG,IAKtCzmB,KAAK0mB,SAAW,SAAUpnB,EAAG6O,EAAGkT,EAAGC,EAAG7D,EAAI,MAEzC,IAAIxL,EAAKjS,KAAKiS,GACVgU,EAAUjmB,KAAKqa,cAEnB4L,EAAQ1M,WAAY,eAAgBvZ,KAAK+lB,cACzCE,EAAQ5N,UAAW,SAAU+G,EAAQ8G,MACrCD,EAAQ5N,UAAW,UAAWrY,KAAK4f,cACnCqG,EAAQ5N,UAAW,UAAWrY,KAAK6f,QAEnC7f,KAAKmmB,gBAAkB,KAEvBnmB,KAAK6lB,OAAO,GAAKxE,EACjBrhB,KAAK6lB,OAAO,GAAKvE,EACjBthB,KAAK6lB,OAAO,GAAKvmB,EACjBU,KAAK6lB,OAAO,GAAK1X,EAEjBnO,KAAK8lB,UAAU,GAAK,EACpB9lB,KAAK8lB,UAAU,GAAK,EACpB9lB,KAAK8lB,UAAU,GAAK,EACpB9lB,KAAK8lB,UAAU,GAAK,EAEpB7T,EAAGsU,iBAAkBN,EAAQlP,mBAAmB,gBAAgB,EAAO/W,KAAK2f,UAAUjP,MACtFuB,EAAGsU,iBAAkBN,EAAQlP,mBAAmB,WAAW,EAAO/W,KAAK6lB,QACvE5T,EAAGsU,iBAAkBN,EAAQlP,mBAAmB,cAAc,EAAO/W,KAAK8lB,WAC1E7T,EAAGoG,UAAW4N,EAAQlP,mBAAmB,WAAY/W,KAAKgmB,QAC1D/T,EAAGuU,WAAYvU,EAAGwU,eAAgB,EAAG,KAQvCxI,EAAO3X,UAAUqgB,aAAe,SAAU/J,GAIzCnd,EAAMmnB,OAAOrM,EAASqC,EAAO,CAAEnC,MAAOmC,EAAMnC,MAAOC,OAAQkC,EAAMlC,SAAUiC,OAAOC,IAOnFqB,EAAO3X,UAAU6U,cAAgB,SAAUV,EAAOC,EAAQzO,EAAO,UAAW8O,EAAO,GAElF,OAAO,IAAIR,EAASE,EAAOC,GAAQ6B,UAAUtQ,GAAQwQ,UAAU1B,GAAQnT,YAMxEqW,EAAO3X,UAAUugB,YAAc,WAER,GAAlB7mB,KAAKsd,WAEY,MAAhBtd,KAAK8L,UACR9L,KAAK8L,QAAQwU,uBAAwB,GAEtCtgB,KAAKme,KAAKS,MAAMkI,eAAiB,gBAIb,MAAhB9mB,KAAK8L,UACR9L,KAAK8L,QAAQwU,uBAAwB,GAEtCtgB,KAAKme,KAAKS,MAAMkI,eAAiB,SAOnC7I,EAAO3X,UAAUwE,QAAU,WAEtB9K,KAAKme,KAAKkC,YACbrgB,KAAKme,KAAKkC,WAAW0G,YAAa/mB,KAAKme,MAExCne,KAAKuf,YAAY7W,OACjB1I,KAAKwf,WAAW9W,OAChB1I,KAAKyf,eAAe/W,OACpB1I,KAAK0f,mBAAmBhX,OAExB1I,KAAK+Q,KAAO,KACZ/Q,KAAK8L,QAAU,KACf9L,KAAKme,KAAO,MAObF,EAAO3X,UAAU8Z,cAAgB,SAAU4G,GAK1C,GAHAhnB,KAAKme,KAAKS,MAAMR,WAAa4I,EAC7BhnB,KAAKinB,gBAAkBD,EAEP,OAAZhnB,KAAKiS,GACT,CACC,GAAoB,GAAhB+U,EAAM7mB,OACT,MAAM,IAAIqG,MAAO,oFAElB,IAAI4b,EAAI8E,SAASF,EAAMG,OAAO,EAAE,GAAI,IAAM,IACtCC,EAAIF,SAASF,EAAMG,OAAO,EAAE,GAAI,IAAM,IACtC7mB,EAAI4mB,SAASF,EAAMG,OAAO,EAAE,GAAI,IAAM,IAE1CnnB,KAAKiS,GAAG4S,WAAYzC,EAAGgF,EAAG9mB,EAAG,KAQ/B2d,EAAO3X,UAAU4Z,OAAS,SAAUzF,EAAOC,GAE1C,IAAI0G,EAAOphB,KAAKme,KAAK2F,wBAEhBrJ,IAAOA,EAAQ2G,EAAK3G,OACpBC,IAAQA,EAAS0G,EAAK1G,QAE3B1a,KAAKme,KAAK1D,MAAQA,EAClBza,KAAKme,KAAKzD,OAASA,EAEnB1a,KAAKya,MAAQza,KAAKme,KAAK1D,MACvBza,KAAK0a,OAAS1a,KAAKme,KAAKzD,OAExB1a,KAAKqnB,OAAS5gB,IAAIzG,KAAKya,MAAQza,KAAK4f,cACpC5f,KAAKsnB,QAAU7gB,IAAIzG,KAAK0a,OAAS1a,KAAK4f,cAEtC,IAAI3N,EAAKjS,KAAKiS,GAsBd,OArBU,MAANA,IAEHA,EAAG6S,OAAQ7S,EAAGsV,cACdtV,EAAGuV,QAAS,EAAG,EAAGxnB,KAAKya,MAAOza,KAAK0a,QACnCzI,EAAGwV,SAAU,EAAG,EAAGznB,KAAKya,MAAOza,KAAK0a,QAEhC1a,KAAK+lB,eAMR/lB,KAAK+lB,aAAa,GAAK/lB,KAAKya,MAC5Bza,KAAK+lB,aAAa,GAAK/lB,KAAK0a,OAE5B1a,KAAK+lB,aAAa,GAAK/lB,KAAKya,MAC5Bza,KAAK+lB,aAAa,GAAK/lB,KAAK0a,SAI9B1a,KAAK6mB,cACE7mB,MAORie,EAAO3X,UAAUohB,YAAc,SAAUroB,GAaxC,OAXAW,KAAK4f,aAAevgB,EAEpBW,KAAKqnB,OAAS5gB,IAAIzG,KAAKya,MAAQza,KAAK4f,cACpC5f,KAAKsnB,QAAU7gB,IAAIzG,KAAK0a,OAAS1a,KAAK4f,cAEtC5f,KAAK4R,eAIJ5R,KAAKyN,MAAMpO,EAAOA,GAEZW,MAORie,EAAO3X,UAAUqhB,QAAU,SAAUtoB,GAuBpC,OArBIA,GAEHW,KAAKqnB,OAAS5gB,IAAIzG,KAAK0a,OAAS1a,KAAK4f,cACrC5f,KAAKsnB,QAAU7gB,IAAIzG,KAAKya,MAAQza,KAAK4f,gBAIrC5f,KAAKqnB,OAAS5gB,IAAIzG,KAAKya,MAAQza,KAAK4f,cACpC5f,KAAKsnB,QAAU7gB,IAAIzG,KAAK0a,OAAS1a,KAAK4f,eAGxB,MAAX5f,KAAKiS,IAAcjS,KAAK+lB,eAE3B/lB,KAAK+lB,aAAa,GAAK/lB,KAAKya,MAC5Bza,KAAK+lB,aAAa,GAAK/lB,KAAK0a,OAE5B1a,KAAK+lB,aAAa,GAAK1mB,EAAQW,KAAK0a,OAAS1a,KAAKya,MAClDza,KAAK+lB,aAAa,GAAK1mB,EAAQW,KAAKya,MAAQza,KAAK0a,QAGlD1a,KAAK4nB,UAAYvoB,EACVW,MAORie,EAAO3X,UAAUka,SAAW,WAE3B,OAAOxgB,MAORie,EAAO3X,UAAUma,QAAU,WAK1B,OAHe,MAAXzgB,KAAKiS,IACRjS,KAAKiS,GAAGuV,QAAQ,EAAG,EAAGxnB,KAAKya,MAAOza,KAAK0a,QAEjC1a,MAORie,EAAO3X,UAAUuX,UAAY,SAAUiD,EAAK,YAAaC,EAAO,MAE/D,OAAO/gB,KAAKme,KAAK0C,UAAWC,EAAMC,IAOnC9C,EAAO3X,UAAUuhB,YAAc,WAE9B,OAAO7nB,KAAKme,KAAK0C,UAAU,aAAasG,OAAO,KAMhDlJ,EAAO3X,UAAUwhB,kBAAoB,SAAU5e,EAAM7J,EAAM,MAE1D,GAAKW,KAAK8L,QAEV,OAAc,OAAVzM,GAEHW,KAAK8L,QAAQ5C,GAAQ7J,EACdW,MAGDA,KAAK8L,QAAQ5C,IAWrB+U,EAAO3X,UAAU2Z,UAAY,SAAU5gB,GAEtC,OAAOW,KAAK8nB,kBAAmB,YAAazoB,IAW7C4e,EAAO3X,UAAU0Z,YAAc,SAAU3gB,GAExC,OAAOW,KAAK8nB,kBAAmB,cAAezoB,IAW/C4e,EAAO3X,UAAUyhB,QAAU,SAAU1oB,GAEpC,OAAOW,KAAK8nB,kBAAmB,UAAWzoB,IAY3C4e,EAAO3X,UAAU0hB,SAAW,SAAU3oB,GAErC,OAAOW,KAAK8nB,kBAAmB,WAAYzoB,IAW5C4e,EAAO3X,UAAU2hB,UAAY,SAAU5oB,GAEtC,OAAOW,KAAK8nB,kBAAmB,YAAazoB,IAW7C4e,EAAO3X,UAAU4hB,WAAa,SAAU7oB,GAEvC,OAAOW,KAAK8nB,kBAAmB,aAAczoB,IAW9C4e,EAAO3X,UAAU6hB,YAAc,SAAU9oB,GAExC,OAAOW,KAAK8nB,kBAAmB,cAAezoB,IAW/C4e,EAAO3X,UAAU8hB,cAAgB,SAAU/oB,GAE1C,OAAOW,KAAK8nB,kBAAmB,gBAAiBzoB,IAWjD4e,EAAO3X,UAAU+hB,cAAgB,SAAUhpB,GAE1C,OAAOW,KAAK8nB,kBAAmB,gBAAiBzoB,IAWjD4e,EAAO3X,UAAUgiB,WAAa,SAAUjpB,GAEvC,OAAOW,KAAK8nB,kBAAmB,aAAczoB,IAW9C4e,EAAO3X,UAAUiiB,KAAO,SAAUlpB,GAEjC,OAAOW,KAAK8nB,kBAAmB,OAAQzoB,IAWxC4e,EAAO3X,UAAUkiB,UAAY,SAAUnpB,GAEtC,OAAOW,KAAK8nB,kBAAmB,YAAazoB,IAW7C4e,EAAO3X,UAAUmiB,aAAe,SAAUppB,GAEzC,OAAOW,KAAK8nB,kBAAmB,eAAgBzoB,IAWhD4e,EAAO3X,UAAUoiB,YAAc,SAAUrpB,EAAM,MAE9C,OAAc,OAAVA,EAGIW,KAAK6f,QAFZ7f,KAAK6f,OAASxgB,EAIRW,KAAKkf,MAAM,KAWnBjB,EAAO3X,UAAUqiB,yBAA2B,SAAUtpB,GAErD,OAAOW,KAAK8nB,kBAAmB,2BAA4BzoB,IAQ5D4e,EAAO3X,UAAUyZ,gBAAkB,WAGlC,OADA/f,KAAK0gB,aAAc1gB,KAAK+Q,KAAKL,KAAK,GAAI1Q,KAAK+Q,KAAKL,KAAK,GAAI1Q,KAAK+Q,KAAKL,KAAK,GAAI1Q,KAAK+Q,KAAKL,KAAK,GAAI1Q,KAAK+Q,KAAKL,KAAK,GAAI1Q,KAAK+Q,KAAKL,KAAK,IAC1H1Q,MAQRie,EAAO3X,UAAUoa,aAAe,SAAUrgB,EAAGC,EAAGC,EAAGC,EAAGmgB,EAAGC,GAExD,OAAqB,OAAjB5gB,KAAK8L,SAER9L,KAAK2f,UAAUjP,KAAK,GAAKrQ,EACzBL,KAAK2f,UAAUjP,KAAK,GAAKpQ,EACzBN,KAAK2f,UAAUjP,KAAK,GAAK,EACzB1Q,KAAK2f,UAAUjP,KAAK,GAAKnQ,EACzBP,KAAK2f,UAAUjP,KAAK,GAAKlQ,EACzBR,KAAK2f,UAAUjP,KAAK,GAAK,EACzB1Q,KAAK2f,UAAUjP,KAAK,GAAKjK,IAAIka,GAC7B3gB,KAAK2f,UAAUjP,KAAK,GAAKjK,IAAIma,GAC7B5gB,KAAK2f,UAAUjP,KAAK,GAAK,EAElB1Q,OAIRA,KAAK8L,QAAQ4U,aAAcrgB,EAAGC,EAAGC,EAAGC,EAAGiG,IAAIka,GAAIla,IAAIma,IAC5C5gB,OAQRie,EAAO3X,UAAUkb,SAAW,SAAUliB,EAAG6O,EAAGkT,EAAGC,GAG9C,OADAthB,KAAK8L,QAAQ0V,SAAUliB,EAAG6O,EAAGkT,EAAGC,GACzBthB,MAQRie,EAAO3X,UAAUmb,WAAa,SAAUniB,EAAG6O,EAAGkT,EAAGC,GAGhD,OADAthB,KAAK8L,QAAQ2V,WAAYniB,EAAG6O,EAAGkT,EAAGC,GAC3BthB,MAQRie,EAAO3X,UAAUsiB,UAAY,SAAUtpB,EAAG6O,EAAGkT,EAAGC,GAG/C,OADAthB,KAAK8L,QAAQ8c,UAAWtpB,EAAG6O,EAAGkT,EAAGC,GAC1BthB,MAQRie,EAAO3X,UAAU0a,UAAY,WAG5B,OADAhhB,KAAK8L,QAAQkV,YACNhhB,MAQRie,EAAO3X,UAAU2a,OAAS,SAAU3hB,EAAG6O,GAGtC,OADAnO,KAAK8L,QAAQmV,OAAQ3hB,EAAG6O,GACjBnO,MAQRie,EAAO3X,UAAU4a,UAAY,WAG5B,OADAlhB,KAAK8L,QAAQoV,YACNlhB,MAQRie,EAAO3X,UAAU6a,OAAS,SAAU7hB,EAAG6O,GAGtC,OADAnO,KAAK8L,QAAQqV,OAAQ7hB,EAAG6O,GACjBnO,MAQRie,EAAO3X,UAAU8a,KAAO,SAAU9hB,EAAG6O,EAAGkT,EAAGC,GAG1C,OADAthB,KAAK8L,QAAQsV,KAAM9hB,EAAG6O,EAAGkT,EAAGC,GACrBthB,MAQRie,EAAO3X,UAAUM,KAAO,SAAUvH,EAAM,MAIvC,OAFIA,GAAOW,KAAKigB,UAAW5gB,GAC3BW,KAAK8L,QAAQlF,OACN5G,MAQRie,EAAO3X,UAAUib,OAAS,SAAUliB,EAAM,MAIzC,OAFIA,GAAOW,KAAKggB,YAAa3gB,GAC7BW,KAAK8L,QAAQyV,SACNvhB,MAQRie,EAAO3X,UAAUob,KAAO,SAAUpiB,EAAG6O,EAAGsM,EAAOC,GAe9C,OAbgB,OAAZ1a,KAAKiS,KAER3S,GAAKU,KAAK4f,aACVzR,GAAKnO,KAAK4f,aACVnF,GAASza,KAAK4f,aACdlF,GAAU1a,KAAK4f,aAEX5f,KAAK4nB,UACR5nB,KAAKiS,GAAGuV,QAAQxnB,KAAKya,MAAMtM,EAAEuM,EAAO,EAAG1a,KAAK0a,OAAOpb,EAAEmb,EAAM,EAAGC,EAAQD,GAEtEza,KAAKiS,GAAGuV,QAAQloB,EAAGU,KAAK0a,OAAOvM,EAAEuM,EAAO,EAAGD,EAAOC,IAG7C1a,MAQRie,EAAO3X,UAAUqb,iBAAmB,SAAUC,EAAKC,EAAKviB,EAAG6O,GAG1D,OADAnO,KAAK8L,QAAQ6V,iBAAkBC,EAAKC,EAAKviB,EAAG6O,GACrCnO,MAQRie,EAAO3X,UAAUwb,cAAgB,SAAUC,EAAKC,EAAKC,EAAKC,EAAK5iB,EAAG6O,GAGjE,OADAnO,KAAK8L,QAAQgW,cAAeC,EAAKC,EAAKC,EAAKC,EAAK5iB,EAAG6O,GAC5CnO,MAQRie,EAAO3X,UAAU6b,IAAM,SAAU7iB,EAAG6O,EAAGiU,EAAGC,EAAIC,EAAIC,GAGjD,OADAviB,KAAK8L,QAAQqW,IAAK7iB,EAAG6O,EAAGiU,EAAGC,EAAIC,EAAIC,GAC5BviB,MAQRie,EAAO3X,UAAUkc,MAAQ,SAAUC,EAAIC,EAAIC,EAAIC,EAAIR,GAGlD,OADApiB,KAAK8L,QAAQ0W,MAAOC,EAAIC,EAAIC,EAAIC,EAAIR,GAC7BpiB,MAQRie,EAAO3X,UAAUuc,SAAW,SAAUC,EAAMxjB,EAAG6O,EAAG4U,EAAS,KAG1D,OADA/iB,KAAK8L,QAAQ+W,SAAUC,EAAMxjB,EAAG6O,EAAG4U,GAC5B/iB,MAQRie,EAAO3X,UAAU0c,WAAa,SAAUF,EAAMxjB,EAAG6O,EAAG4U,EAAS,KAG5D,OADA/iB,KAAK8L,QAAQkX,WAAYF,EAAMxjB,EAAG6O,EAAG4U,GAC9B/iB,MASRie,EAAO3X,UAAU2c,YAAc,SAAUH,GAExC,OAAO9iB,KAAK8L,QAAQmX,YAAYH,GAAMrI,OASvCwD,EAAO3X,UAAU4c,gBAAkB,SAAU7B,EAAGC,GAE/C,OAAOthB,KAAK8L,QAAQoX,gBAAiB7B,EAAGC,IASzCrD,EAAO3X,UAAU6c,aAAe,SAAU7jB,EAAG6O,EAAGkT,EAAGC,GAElD,OAAOthB,KAAK8L,QAAQqX,aAAc7jB,EAAG6O,EAAGkT,EAAGC,IAS5CrD,EAAO3X,UAAU8c,aAAe,SAAU1S,EAAMpR,EAAG6O,GAGlD,OADAnO,KAAK8L,QAAQsX,aAAc1S,EAAMpR,EAAG6O,GAC7BnO,MAWRie,EAAO3X,UAAU+c,UAAY,SAAU5F,EAAKvM,EAAG,EAAGC,EAAG,EAAGmS,EAAG,KAAMC,EAAG,KAAMzU,EAAG,KAAMC,EAAG,KAAMyU,EAAG,KAAMC,EAAG,MAEvG,GAAW,OAAPH,EAEHtjB,KAAK8L,QAAQuX,UAAW5F,EAAKhX,IAAIyK,GAAKzK,IAAI0K,SAEtC,GAAW,OAAPrC,EAER9O,KAAK8L,QAAQuX,UAAW5F,EAAKhX,IAAIyK,GAAKzK,IAAI0K,GAAK1K,IAAI6c,GAAK7c,IAAI8c,QAG7D,CACC,IAAIrb,EAAKzB,IAAI6c,GACTnb,EAAK1B,IAAI8c,GACb,IAAKrb,IAAOC,EAAI,OAAOnI,KAEvB,IAAIsI,EAAK7B,IAAI+c,GACTjb,EAAK9B,IAAIgd,GACb,IAAKnb,IAAOC,EAAI,OAAOvI,KAEvBA,KAAK8L,QAAQuX,UAAW5F,EAAKhX,IAAIyK,GAAKzK,IAAI0K,GAAKjJ,EAAIC,EAAI1B,IAAIqI,GAAKrI,IAAIsI,GAAKzG,EAAIC,GAG9E,OAAOvI,MAYRie,EAAO3X,UAAU0D,MAAQ,SAAUid,EAAgB,MAElD,OAAe,MAAXjnB,KAAKiS,IAERjS,KAAKiS,GAAGjI,MAAMhK,KAAKiS,GAAG4W,mBAAqB7oB,KAAKiS,GAAG6W,iBAAmB9oB,KAAKiS,GAAG8W,kBAC9E/oB,KAAKmmB,gBAAkB,KAChBnmB,OAGJinB,EAEHjnB,KAAK2oB,yBAAyB,eAAeD,YAAY,GAAKzI,WAA8B,IAApBgH,EAA2BA,EAAkBjnB,KAAKinB,iBAAiBzF,SAAS,EAAG,EAAGxhB,KAAKqnB,OAAQrnB,KAAKsnB,UAI5KtnB,KAAKme,KAAK1D,MAAQza,KAAKya,MACvBza,KAAK6mB,eAGN7mB,KAAK+f,kBACE/f,OAORie,EAAO3X,UAAUiH,MAAQ,aAOzB0Q,EAAO3X,UAAU0iB,IAAM,aAOvB/K,EAAO3X,UAAU2iB,MAAQ,aAezBhL,EAAO3X,UAAU4iB,KAAO,SAAU1O,EAAWC,EAAOC,EAAQL,EAAc,MAEzE,IAAIpI,EAAKjS,KAAKiS,GACH,OAAPA,IAEJoI,EAAgBA,GAAiBra,KAAKkkB,cAEtClkB,KAAKokB,iBAAiB/J,GACtBpI,EAAGkT,QAASlT,EAAG8S,YAEd9S,EAAGoU,cAAepU,EAAGqU,UACrBrU,EAAGmJ,YAAanJ,EAAGoJ,WAAYb,GAC/BH,EAAc5B,UAAW,WAAY,GAErC4B,EAAcd,WAAY,eAAgBvZ,KAAK+lB,cAC/C1L,EAAchC,UAAW,SAAU+G,EAAQ8G,MAC3C7L,EAAchC,UAAW,UAAWrY,KAAK4f,cACzCvF,EAAchC,UAAW,UAAWrY,KAAK6f,QAEzC7f,KAAK6lB,OAAO,GAAK7lB,KAAKya,MACtBza,KAAK6lB,OAAO,GAAK7lB,KAAK0a,OACtB1a,KAAK6lB,OAAO,GAAK,EACjB7lB,KAAK6lB,OAAO,GAAK,EAEjB7lB,KAAK8lB,UAAU,GAAK9lB,KAAKya,MAAQA,EACjCza,KAAK8lB,UAAU,GAAK9lB,KAAK0a,OAASA,EAClC1a,KAAK8lB,UAAU,GAAK,EACpB9lB,KAAK8lB,UAAU,GAAK,EAEpB7T,EAAGsU,iBAAkBlM,EAActD,mBAAmB,WAAW,EAAO/W,KAAK6lB,QAC7E5T,EAAGsU,iBAAkBlM,EAActD,mBAAmB,cAAc,EAAO/W,KAAK8lB,WAChF7T,EAAGuU,WAAYvU,EAAGwU,eAAgB,EAAG,GAEtCzmB,KAAKokB,iBAAiB9J,EAAcrG,IAAI,QACxChC,EAAG6S,OAAQ7S,EAAG8S,cAQf9G,EAAO3X,UAAUmE,MAAQ,SAAU0e,GAAU,GAQ5C,OANAnpB,KAAKigB,UAAU,WAAWD,YAAY,WAAW+H,QAAQ,QAAQC,SAAS,SACzEC,UAAU,KAAKC,WAAW,MAAMC,YAAY,WAAWC,cAAc,KACrEC,cAAc,KAAKC,WAAW,KAAKI,YAAY,OAAOC,yBAAyB,eAE5EQ,GAAWnpB,KAAKghB,YAAYE,YAEzBlhB,MAMRie,EAAO3X,UAAU8iB,WAAa,WAK7B,OAHAppB,KAAKuf,YAAY5U,KAAK3K,KAAK+Q,MAC3B/Q,KAAK+Q,KAAO/Q,KAAK+Q,KAAKrG,QAEf1K,MAMRie,EAAO3X,UAAU+iB,UAAY,WAK5B,OAHArpB,KAAK+Q,KAAKrI,OACV1I,KAAK+Q,KAAO/Q,KAAKuf,YAAY7T,MAEtB1L,KAAK+f,mBAUb9B,EAAO3X,UAAU4Y,MAAQ,SAAU7f,GAOlC,OALAW,KAAK6f,QAAUxgB,EAEXW,KAAK8L,SAAuB,OAAZ9L,KAAKiS,KACxBjS,KAAK8L,QAAQ4c,YAAc1oB,KAAK6f,QAE1B7f,MAMRie,EAAO3X,UAAUgjB,UAAY,WAG5B,OADAtpB,KAAKwf,WAAW7U,KAAM3K,KAAK0oB,eACpB1oB,MAQRie,EAAO3X,UAAUijB,SAAW,WAG3B,OADAvpB,KAAK0oB,YAAY1oB,KAAKwf,WAAW9T,OAC1B1L,MAMRie,EAAO3X,UAAUkjB,aAAe,SAAUnqB,GAEzC,IAAI4S,EAAKjS,KAAKiS,GACH,OAAPA,IAEA5S,GAEH4S,EAAG6S,OAAQ7S,EAAG8S,YACd/kB,KAAK8f,YAAa,IAIlB7N,EAAGkT,QAASlT,EAAG8S,YACf/kB,KAAK8f,YAAa,KAOpB7B,EAAO3X,UAAUmjB,aAAe,WAE/B,OAAOzpB,KAAK8f,YAOb7B,EAAO3X,UAAUojB,cAAgB,SAAUrqB,EAAM,MAEhD,GAAc,OAAVA,EAIH,OAFAA,IAAUA,KAEIW,KAAK8f,aAGnB9f,KAAKyf,eAAe9U,KAAK3K,KAAK8f,YAC9B9f,KAAKwpB,aAAanqB,IAEX,GAGRW,KAAKyf,eAAe9U,KAAK3K,KAAK8f,aAM/B7B,EAAO3X,UAAUqjB,aAAe,WAE/B3pB,KAAKwpB,aAAaxpB,KAAKyf,eAAe/T,QAMvCuS,EAAO3X,UAAU8d,iBAAmB,SAAU6B,GAGlC,OADFjmB,KAAKiS,KAGdjS,KAAKqa,cAAgB4L,EACrBjmB,KAAKqa,cAAcvC,aAMpBmG,EAAO3X,UAAUsjB,iBAAmB,WAEnC,OAAO5pB,KAAKqa,eAOb4D,EAAO3X,UAAUujB,kBAAoB,SAAU5D,EAAQ,MAEtD,GAAgB,OAAZA,EAEH,OAAIA,IAAYjmB,KAAKqa,gBAGrBra,KAAK0f,mBAAmB/U,KAAK3K,KAAKqa,eAClCra,KAAKokB,iBAAiB6B,IAEf,GAGRjmB,KAAK0f,mBAAmB/U,KAAK3K,KAAKqa,gBAMnC4D,EAAO3X,UAAUwjB,iBAAmB,WAEnC9pB,KAAKokB,iBAAiBpkB,KAAK0f,mBAAmBhU,QAU/CuS,EAAO3X,UAAUsL,aAAe,WAG/B,OADA5R,KAAK+Q,KAAKJ,WACH3Q,KAAK+f,mBAUb9B,EAAO3X,UAAUyjB,WAAa,SAAUhZ,GAGvC,OADA/Q,KAAK+Q,KAAK3C,IAAI2C,GACP/Q,KAAK+f,mBAUb9B,EAAO3X,UAAU0jB,UAAY,SAAUtf,GAAM,GAE5C,OAAOA,EAAQ1K,KAAK+Q,KAAKrG,QAAU1K,KAAK+Q,MAUzCkN,EAAO3X,UAAU2jB,aAAe,SAAUlZ,GAGzC,OADA/Q,KAAK+Q,KAAKpF,OAAOoF,GACV/Q,KAAK+f,mBAWb9B,EAAO3X,UAAUmH,MAAQ,SAAUyD,EAAIC,EAAI+Y,GAAU,GAEpD,OAAIA,GACHlqB,KAAK8L,QAAQ2B,MAAOyD,EAAIC,GACjBnR,OAGRA,KAAK+Q,KAAKtD,MAAOyD,EAAIC,GACdnR,KAAK+f,oBAWb9B,EAAO3X,UAAU0I,OAAS,SAAUC,EAAOib,GAAU,GAEpD,OAAIA,GACHlqB,KAAK8L,QAAQkD,OAAQC,GACdjP,OAGRA,KAAK+Q,KAAK/B,OAAOC,GACVjP,KAAK+f,oBAWb9B,EAAO3X,UAAUuI,UAAY,SAAUvP,EAAG6O,EAAG+b,GAAU,GAEtD,OAAIA,GACHlqB,KAAK8L,QAAQ+C,UAAUvP,EAAG6O,GACnBnO,OAGRA,KAAK+Q,KAAKlC,UAAUvP,EAAG6O,GAChBnO,KAAK+f,oBAUb9B,EAAO3X,UAAU6jB,QAAU,SAAU7qB,EAAG6O,EAAGkT,EAAGC,GAE7C,IAAI8I,EAAK/I,EAAG,EAAG,SAAUgJ,EAAK/I,EAAG,EAAG,SAChCgJ,EAAKhrB,EAAE+hB,EAAE,EAAGkJ,EAAKpc,EAAEmT,EAAE,EAAGkJ,EAAKlrB,EAAE+hB,EAAE,EAAGoJ,EAAKtc,EAAEmT,EAAE,EASjD,OAPAthB,KAAKghB,YAAaC,OAAO3hB,EAAGmrB,GAC5BzqB,KAAK8hB,cAAexiB,EAAGmrB,EAAKJ,EAAIG,EAAKJ,EAAIjc,EAAGqc,EAAIrc,GAChDnO,KAAK8hB,cAAe0I,EAAKJ,EAAIjc,EAAGmc,EAAIG,EAAKJ,EAAIC,EAAIG,GACjDzqB,KAAK8hB,cAAewI,EAAIG,EAAKJ,EAAIG,EAAKJ,EAAIG,EAAIC,EAAID,GAClDvqB,KAAK8hB,cAAe0I,EAAKJ,EAAIG,EAAIjrB,EAAGmrB,EAAKJ,EAAI/qB,EAAGmrB,GAChDzqB,KAAKkhB,YAEElhB,MAYRie,EAAO3X,UAAUokB,OAAS,SAAUprB,EAAG6O,EAAGiU,EAAGb,GAQ5C,OANAvhB,KAAKghB,YACLhhB,KAAKmiB,IAAI7iB,EAAG6O,EAAGiU,EAAG,EAAG,EAAE1a,KAAKijB,IAC5B3qB,KAAKkhB,YAEDK,GAAQvhB,KAAKuhB,OAAOA,GAEjBvhB,MAYRie,EAAO3X,UAAUskB,KAAO,SAAUnI,EAAIC,EAAIC,EAAIC,EAAIrB,GAQjD,OANAvhB,KAAKghB,YACLhhB,KAAKihB,OAAOwB,EAAIC,GAChB1iB,KAAKmhB,OAAOwB,EAAIC,GAChB5iB,KAAKkhB,YAEDK,GAAQvhB,KAAKuhB,OAAOA,GACjBvhB,MAYRie,EAAO3X,UAAUukB,oBAAsB,WAEtC,GAAI7qB,KAAK8qB,eAAgB,OAAO9qB,KAEhCA,KAAK+qB,aAAe,CAAE7Z,GAAI,EAAGC,GAAI,GACjCnR,KAAKgrB,cAAgB,CAAE1rB,EAAG,EAAG6O,EAAG,GAEhC,IAAI8c,EAAIjrB,KAEJkrB,EACJ,CACCC,OAAQ,GACRC,QAAS,EAAGC,SAAU,EACtB/rB,EAAG,EAAG6O,EAAG,EAETmd,YAAa,SAAUhsB,EAAG6O,EAAGkT,EAAGC,GAC/B,OAAOthB,KAAKV,GAAKA,GAAKU,KAAKV,GAAMA,EAAE+hB,EAAE,GAAMrhB,KAAKmO,GAAKA,GAAKnO,KAAKmO,GAAMA,EAAEmT,EAAE,IAuD3E,OAnDAthB,KAAKurB,gBAAkB,GAEvBvrB,KAAK8qB,eAAiB,SAAU1W,EAAMoX,GAErC,IAAIpK,EAAOphB,KAAKme,KAAK2F,wBAErBoH,EAAKC,OAAS/W,EACd8W,EAAKE,QAAUI,EAAIJ,QACnBF,EAAK5rB,EAAI4rB,EAAKO,GAAKhlB,IAAI+kB,EAAIE,QAAUtK,EAAKtC,MAC1CoM,EAAK/c,EAAI+c,EAAKS,GAAKllB,IAAI+kB,EAAII,QAAUxK,EAAK7W,KAE1C2gB,EAAK5rB,GAAK4rB,EAAM5rB,EAAI2rB,EAAED,cAAc1rB,EAAK,EAAI2rB,EAAEF,aAAa7Z,IAAM+Z,EAAEF,aAAa7Z,GACjFga,EAAK/c,GAAK+c,EAAM/c,EAAI8c,EAAED,cAAc7c,EAAK,EAAI8c,EAAEF,aAAa5Z,IAAM8Z,EAAEF,aAAa5Z,GAEjF+Z,EAAKW,UAAW,EAEZX,EAAKE,UAAYF,EAAKG,WAEzBH,EAAKha,GAAKga,EAAK5rB,EACf4rB,EAAK/Z,GAAK+Z,EAAK/c,EAEf+c,EAAKY,IAAMZ,EAAKa,IAAM,GAGnBb,EAAKE,SAAWF,EAAKG,WAExBH,EAAKW,UAAW,EAEhBX,EAAKpc,GAAKoc,EAAK5rB,EAAI4rB,EAAKha,GACxBga,EAAKnc,GAAKmc,EAAK/c,EAAI+c,EAAK/Z,GAExB+Z,EAAKc,IAAMd,EAAKpc,GAAKoc,EAAKY,IAC1BZ,EAAKe,IAAMf,EAAKnc,GAAKmc,EAAKa,IAE1Bb,EAAKY,IAAMZ,EAAKpc,GAChBoc,EAAKa,IAAMb,EAAKnc,IAGjBmc,EAAKG,SAAWH,EAAKE,QAErB,IAAK,IAAIlrB,EAAI,EAAGA,EAAIF,KAAKurB,gBAAgBprB,SAE8B,IAAlEH,KAAKurB,gBAAgBrrB,GAAG,GAAIgrB,EAAMlrB,KAAKurB,gBAAgBrrB,GAAG,IAFdA,OAOlDF,KAAKme,KAAK+N,YAAc,SAASV,GAAQP,EAAEH,eAAe,OAAQU,IAClExrB,KAAKme,KAAKgO,UAAY,SAASX,GAAOP,EAAEH,eAAe,KAAMU,IAC7DxrB,KAAKme,KAAKiO,YAAc,SAASZ,GAAOP,EAAEH,eAAe,OAAQU,IAE1DxrB,MAURie,EAAO3X,UAAU+lB,gBAAkB,SAAUnb,EAAIC,GAGhD,OADAnR,KAAK+qB,aAAe,CAAE7Z,GAAIA,EAAIC,GAAIA,GAC3BnR,MAURie,EAAO3X,UAAUgmB,iBAAmB,SAAUhtB,EAAG6O,GAGhD,OADAnO,KAAKgrB,cAAgB,CAAE1rB,EAAGA,EAAG6O,EAAGA,GACzBnO,MAWRie,EAAO3X,UAAUimB,kBAAoB,SAAU/f,EAAUV,GAMxD,OAJA9L,KAAK6qB,sBAEL7qB,KAAKurB,gBAAgB5gB,KAAM,CAAC3K,KAAKurB,gBAAgBprB,OAAO,IAAIsG,IAAkB,IAAdiB,KAAK8kB,UAAehgB,EAAUV,IAEvF9L,KAAKurB,gBAAgBvrB,KAAKurB,gBAAgBprB,OAAO,GAAG,IAU5D8d,EAAO3X,UAAUmmB,qBAAuB,SAAUzX,GAEjD,GAAKhV,KAAKurB,gBAEV,IAAK,IAAIrrB,EAAI,EAAGA,EAAIF,KAAKurB,gBAAgBprB,OAAQD,IAEhD,GAAIF,KAAKurB,gBAAgBrrB,GAAG,IAAM8U,EAClC,CACChV,KAAKurB,gBAAgBmB,OAAOxsB,EAAG,GAC/B,QASH+d,EAAO0O,YAAc,SAAUlS,EAAOC,EAAQkS,EAAMC,GAEnD,IAAIzF,EAAI,IAAInJ,EAAQ,CAAEZ,QAAQ,EAAM5C,MAAOA,EAAOC,OAAQA,EAAQ4C,UAAWwP,EAAO3P,QAAQG,YAE5FsP,EAAKxF,GACL,IAAI2F,EAAM3F,EAAEvJ,YAERJ,EAAM,IAAIC,MACdD,EAAIE,OAAS,KAEZF,EAAIxR,OAAS6gB,EAAO3P,QAAQG,UAAY,SAAW,UACnDG,EAAI5C,OAAS,EACb4C,EAAI9C,YAAcF,EAClBgD,EAAI7C,aAAeF,EAEnBoS,EAAOE,SAASrG,aAAalJ,GAC7BoP,EAAUpP,EAAKsP,IAGhBtP,EAAIG,IAAMmP,EACV3F,EAAEtc,WAQHmT,EAAOgP,kBAAoB,SAAUC,EAAQzS,EAAOC,EAAQkS,EAAMC,GAEjE,IAAIzF,EAAI,IAAInJ,EAAQ,CAAEZ,QAAQ,EAAM5C,MAAOA,EAAOC,OAAQA,EAAQ4C,UAAWwP,EAAO3P,QAAQG,YAE5FsP,EAAKxF,GACL,IAAI2F,EAAM3F,EAAEvJ,YAERJ,EAAM,IAAIC,MACdD,EAAIE,OAAS,KAEZF,EAAIxR,OAAS6gB,EAAO3P,QAAQG,UAAY,SAAW,UACnDG,EAAI5C,OAAS,EACb4C,EAAI9C,YAAcF,EAClBgD,EAAI7C,aAAeF,EACnB+C,EAAI1C,OAASmS,EAEbJ,EAAOE,SAASrG,aAAalJ,GAC7BoP,EAAUpP,EAAKsP,IAGhBtP,EAAIG,IAAMmP,EACV3F,EAAEtc,W,IAGHsS,EAAea;;;;;;uBCn5Df;MAAMkP,EAAS;;;AAOdA,kBAA2B,CAC1BC,SAAU,EACVC,OAAQ;;;AAOTF,iBAA0B,CACzBG,aAAgB,GAChBC,WAAc,GACdC,aAAgB,GAChBC,mBAAoB,GACpBC,kBAAmB,GACnBC,kBAAmB,GACnBC,cAAgB;;;;;;;;;;AA8MlBC,OAAOC,OAAOX,EACd,CAICY,MACA,CACCC,kBAAkB,EAClBC,iBAAiB,GAMlBC,eACA,CACC9P,WAAY,UACZnM,IAAI,EACJ7I,KAAK,EAEL+kB,UAAU,EACV7Q,WAAW,EACX8Q,YAAa,EAEbC,IAAK,IACLC,OAAQ,GACRhiB,OAAO,EAEPiiB,YAAa,KACbC,aAAc,KAEdC,iBAAkB,EAClBC,eAAgB,KAEhBC,YAAY,GAObJ,YAAa,EAMbC,aAAc,EAMdJ,YAAa,EAKbQ,MAAO,EAAGC,MAAO,EAKjBC,iBAAkB,EAAGC,kBAAmB,EAAGC,iBAAkB,EAAGC,kBAAmB,EAAGC,YAAa,EAMnGC,cAAe,KAMfnC,SAAU,KAMVoC,eAAgB,KAMhBC,eAAgB,KAKhBC,kBAAmB,KAMnBC,SAAU,CAAErJ,KAAM,EAAGza,OAAO,EAAO+jB,MAAM,EAAOC,KAAK,EAAOC,QAAS,GAMrEC,SAAU,GAKVC,YAAa,KAKbC,UAAW,KAMXC,UAAW,EAMXC,cAAe,EAMfC,mBAAoB,EAMpBC,iBAAkB,EAMlBC,WAAY,EAMZC,UAAW,EAMXC,YAAa,EAKbC,KACA,CAIC1jB,UAAW,EACX2jB,SAAU,EAKVC,UAAW,EAKXC,WAAY,EAKZC,gBAAiB,EACjBC,cAAe,EACfC,eAAgB,EAChBC,eAAgB,EAKhBvC,IAAK,EACLwC,WAAY,EACZC,kBAAmB,EACnBC,gBAAiB,EACjBC,iBAAkB,EAClBC,iBAAkB,GAOnBxoB,KAAM,SAAU0U,EAAQ,MAEvB,IAAI+T,EAAOlxB,KAEPmxB,EAAI,IAAKnxB,KAAKkuB,kBAAmB/Q,GACrCnd,KAAKmd,QAAUgU,GAGkB,IAA7BnxB,KAAKmd,QAAQ5V,eAEiB,IAA7BvH,KAAKmd,QAAQ5V,YAChBtB,EAASsB,cAETtB,EAASsB,YAAYvH,KAAKmd,QAAQ5V,cAIhC4pB,EAAE5C,aAAe4C,EAAE3C,cAAiC,WAAjB2C,EAAE/C,cACxC+C,EAAE/C,YAAc+C,EAAE5C,YAAc4C,EAAE3C,aAAe,YAAc,YAEhExuB,KAAKouB,YAAc+C,EAAE/C,YAErBpuB,KAAK4vB,YAAcxjB,EAAK1C,KAAK5B,QAC7B9H,KAAK6vB,UAAYzjB,EAAK1C,KAAK5B,QAG3B9H,KAAK+vB,cAAgB,IAAOoB,EAAE9C,IAC9BruB,KAAKiwB,iBAAmB,IAAOkB,EAAE7C,OAEjCvoB,EAAOqrB,SAAW,WAAaF,EAAKG,mBAEpCrxB,KAAKsxB,WAAa,IAAIrjB,EAAOkjB,EAAE7kB,MAAOtM,KAAK+vB,eAAgBwB,GAAUvxB,KAAKwxB,QAAQD,KAGlFvxB,KAAKgtB,SAAW,IAAI5P,EAAQ,CAAEnL,GAAIkf,EAAElf,GAAIkM,KAAM,KAAME,UAAU,EAAMhB,QAAQ,EAAOC,UAAW6T,EAAE7T,UAAWc,WAAY+S,EAAE/S,aAEzHpe,KAAKovB,eAAiB,IAAIhS,EAAQ,CAAEnL,IAAI,EAAOkM,KAAM,KAAME,UAAU,EAAMhB,QAAQ,EAAOC,UAAW6T,EAAE7T,UAAWc,WAAY,SAC9Hpe,KAAKovB,eAAejR,KAAKS,MAAM6S,cAAgB,OAE/CzxB,KAAKqvB,eAAiB,IAAIjS,EAAQ,CAAEnL,IAAI,EAAOkM,KAAM,KAAME,UAAU,EAAMhB,QAAQ,EAAOC,UAAW6T,EAAE7T,UAAWc,WAAY,SAC9Hpe,KAAKqvB,eAAelR,KAAKS,MAAM6S,cAAgB,OAE/CzxB,KAAKsvB,kBAAoB,IAAIlS,EAAQ,CAAEC,QAAQ,EAAMC,UAAW6T,EAAE7T,YAAa4C,OAAO,IAAK,KAE3F,IAAIwR,EAAW1xB,KAAKgtB,SAAS7O,KAG7Bne,KAAK8uB,iBAAmB/oB,EAAO+oB,kBAAoB,EAEnD9uB,KAAK+uB,mBAA6B,IAAToC,EAAElf,GAAc,EAAKjS,KAAKgtB,SAASlhB,QAAQ6lB,8BAC7D3xB,KAAKgtB,SAASlhB,QAAQ8lB,2BACtB5xB,KAAKgtB,SAASlhB,QAAQ+lB,0BACtB7xB,KAAKgtB,SAASlhB,QAAQgmB,yBACtB9xB,KAAKgtB,SAASlhB,QAAQimB,wBAA0B,EAEvD/xB,KAAKgvB,iBAAmBhvB,KAAK8uB,iBAAmB9uB,KAAK+uB,kBAErD5B,EAAOkE,iBAAgB,GAGvBtrB,EAAOisB,UAAY,SAAUxG,GAE5B,GAAIA,EAAI5a,SAAW7K,EAAOwY,SAASG,KAAnC,CAGA,GAAIwS,EAAK3B,SAAS/D,EAAIkE,SACrB,OAAO,EAOR,OALAwB,EAAK3B,SAAS/D,EAAIkE,UAAW,EAE7BwB,EAAK3B,SAASG,QAAUlE,EAAIkE,QAC5BwB,EAAK3B,SAAS5iB,UAAYS,QAElBoe,EAAIkE,SAEX,KAAK,GACJwB,EAAK3B,SAAS9jB,OAAQ,EACtB,MAED,KAAK,GACJylB,EAAK3B,SAASC,MAAO,EACrB,MAED,KAAK,GACJ0B,EAAK3B,SAASE,KAAM,EAKtB,OAAIyB,EAAK3B,SAASC,MAAQhE,EAAIkE,SAAW9uB,EAAQE,KAEhDowB,EAAK3B,SAAS/D,EAAIkE,UAAW,GACtB,IAGmF,IAAvFwB,EAAKe,gBAAiBf,EAAKgB,kBAAkB9E,SAAU5B,EAAIkE,QAASwB,EAAK3B,gBAA7E,IAIDxpB,EAAOosB,QAAU,SAAU3G,GAE1B,GAAIA,EAAI5a,SAAW7K,EAAOwY,SAASG,KAAnC,CAGA,IAAKwS,EAAK3B,SAAS/D,EAAIkE,SACtB,OAAO,EAMR,OAJAwB,EAAK3B,SAAS/D,EAAIkE,UAAW,EAC7BwB,EAAK3B,SAAS6C,QAAUhlB,QACxB8jB,EAAK3B,SAASG,QAAUlE,EAAIkE,QAEpBlE,EAAIkE,SAEX,KAAK,GACJwB,EAAK3B,SAAS9jB,OAAQ,EACtB,MAED,KAAK,GACJylB,EAAK3B,SAASC,MAAO,EACrB,MAED,KAAK,GACJ0B,EAAK3B,SAASE,KAAM,EAItB,OAAyF,IAArFyB,EAAKe,gBAAiBf,EAAKgB,kBAAkB7E,OAAQ7B,EAAIkE,QAASwB,EAAK3B,gBAA3E,IAMD,MAAM8C,EAAe,SAAU/yB,EAAG6O,GAEjC,OAAOgf,EAAOmF,cAAgB7rB,IAAI0mB,EAAOoB,YAAY,GAAKpgB,EAAEgf,EAAO0B,OAAO1B,EAAO8B,mBAAqBxoB,KAAKnH,EAAE6tB,EAAOyB,OAAOzB,EAAO8B,oBAG7HsD,EAAe,SAAUjzB,EAAG6O,GAEjC,OAAOgf,EAAOmF,cAAgB7rB,KAAKnH,EAAE6tB,EAAOyB,OAAOzB,EAAO8B,mBAAqBxoB,KAAK0H,EAAEgf,EAAO0B,OAAO1B,EAAO8B,oBAIxG,iBAAkBlpB,GAErB2rB,EAASc,aAAe,SAAUhH,GAEjCA,EAAIiH,iBAEJ,IAAIC,EAAUlH,EAAImH,eAElB,IAAK,IAAIzyB,EAAI,EAAGA,EAAIwyB,EAAQvyB,OAAQD,IACpC,CACMitB,EAAOwC,SAAS+C,EAAQxyB,GAAG0yB,cAE/BzF,EAAOwC,SAAS+C,EAAQxyB,GAAG0yB,YAAc,CACvC5d,GAAI0d,EAAQxyB,GAAG0yB,WAAYC,UAAU,EAAOC,YAAY,EACxD5hB,GAAI,EAAGC,GAAI,EAAG7R,EAAG,EAAG6O,EAAG,EAAGW,GAAI,EAAGC,GAAI,EAAGgkB,OAAQ,EAChDC,WAAY,EAAGC,WAAY,IAI9B,IAAIC,EAAI/F,EAAOwC,SAAS+C,EAAQxyB,GAAG0yB,YAEnCM,EAAEL,UAAW,EACbK,EAAEJ,YAAa,EACfI,EAAEH,OAAS,EAEXG,EAAEvmB,UAAYS,QAEd8lB,EAAE5zB,EAAI4zB,EAAEhiB,GAAKmhB,EAAaK,EAAQxyB,GAAGwrB,QAASgH,EAAQxyB,GAAG0rB,SACzDsH,EAAE/kB,EAAI+kB,EAAE/hB,GAAKohB,EAAaG,EAAQxyB,GAAGwrB,QAASgH,EAAQxyB,GAAG0rB,SAEzDuB,EAAOgG,eAAgBhG,EAAOiG,iBAAiB9F,aAAc4F,EAAG/F,EAAOwC,UAGxE,OAAO,GAGR+B,EAAS2B,WAAa,SAAU7H,GAE/BA,EAAIiH,iBAEJ,IAAIC,EAAUlH,EAAImH,eAElB,IAAK,IAAIzyB,EAAI,EAAGA,EAAIwyB,EAAQvyB,OAAQD,IACpC,CACC,IAAKitB,EAAOwC,SAAS+C,EAAQxyB,GAAG0yB,YAC/B,SAED,IAAIM,EAAI/F,EAAOwC,SAAS+C,EAAQxyB,GAAG0yB,YAEnCM,EAAEd,QAAUhlB,QACZ8lB,EAAEI,UAAYJ,EAAEd,QAAUc,EAAEvmB,UAE5BumB,EAAE5zB,EAAI+yB,EAAaK,EAAQxyB,GAAGwrB,QAASgH,EAAQxyB,GAAG0rB,SAClDsH,EAAE/kB,EAAIokB,EAAaG,EAAQxyB,GAAGwrB,QAASgH,EAAQxyB,GAAG0rB,SAE9CsH,EAAEJ,YACL3F,EAAOgG,eAAgBhG,EAAOiG,iBAAiBzF,kBAAmBuF,EAAG/F,EAAOwC,UAE7ExC,EAAOgG,eAAgBhG,EAAOiG,iBAAiB7F,WAAY2F,EAAG/F,EAAOwC,UAErEuD,EAAEL,UAAW,EACbK,EAAEJ,YAAa,EAEfI,EAAEH,OAAS,EAGZ,OAAO,GAGRrB,EAAS6B,cAAgB,SAAU/H,GAElCA,EAAIiH,iBAEJ,IAAIC,EAAUlH,EAAImH,eAElB,IAAK,IAAIzyB,EAAI,EAAGA,EAAIwyB,EAAQvyB,OAAQD,IACpC,CACC,IAAKitB,EAAOwC,SAAS+C,EAAQxyB,GAAG0yB,YAC/B,SAED,IAAIM,EAAI/F,EAAOwC,SAAS+C,EAAQxyB,GAAG0yB,YAEnCM,EAAE5zB,EAAI+yB,EAAaK,EAAQxyB,GAAGwrB,QAASgH,EAAQxyB,GAAG0rB,SAClDsH,EAAE/kB,EAAIokB,EAAaG,EAAQxyB,GAAGwrB,QAASgH,EAAQxyB,GAAG0rB,SAElDuB,EAAOgG,eAAgBD,EAAEJ,WAAa3F,EAAOiG,iBAAiBzF,kBAAoBR,EAAOiG,iBAAiB7F,WAAY2F,EAAG/F,EAAOwC,UAEhIuD,EAAEL,UAAW,EACbK,EAAEJ,YAAa,EAEfI,EAAEH,OAAS,EAGZ,OAAO,GAGRrB,EAAS8B,YAAc,SAAUhI,GAEhCA,EAAIiH,iBAEJ,IAAIC,EAAUlH,EAAImH,eAElB,IAAK,IAAIzyB,EAAI,EAAGA,EAAIwyB,EAAQvyB,OAAQD,IACpC,CACC,IAAKitB,EAAOwC,SAAS+C,EAAQxyB,GAAG0yB,YAC/B,SAED,IAAIM,EAAI/F,EAAOwC,SAAS+C,EAAQxyB,GAAG0yB,YAE/BM,EAAEL,WAAaK,EAAEJ,aAEpB3F,EAAOgG,eAAgBhG,EAAOiG,iBAAiB3F,mBAAoByF,EAAG/F,EAAOwC,UAC7EuD,EAAEJ,YAAa,GAGhBI,EAAE5zB,EAAI+yB,EAAaK,EAAQxyB,GAAGwrB,QAASgH,EAAQxyB,GAAG0rB,SAClDsH,EAAE/kB,EAAIokB,EAAaG,EAAQxyB,GAAGwrB,QAASgH,EAAQxyB,GAAG0rB,SAElDsH,EAAEpkB,GAAKokB,EAAE5zB,EAAI4zB,EAAEhiB,GACfgiB,EAAEnkB,GAAKmkB,EAAE/kB,EAAI+kB,EAAE/hB,GAEfgc,EAAOgG,eAAgBD,EAAEJ,WAAa3F,EAAOiG,iBAAiB1F,kBAAoBP,EAAOiG,iBAAiB5F,aAAc0F,EAAG/F,EAAOwC,UAGnI,OAAO,KAMR+B,EAAS+B,cAAgB,SAAUjI,GAGlC,OADAA,EAAIiH,kBACG,GAGRf,EAASgC,QAAU,SAAUlI,GAE5BA,EAAIiH,iBAECtF,EAAOwC,SAAS,KAEpBxC,EAAOwC,SAAS,GAAK,CACnB3a,GAAI,EAAG6d,UAAU,EAAOC,YAAY,EACpC5hB,GAAI,EAAGC,GAAI,EAAG7R,EAAG,EAAG6O,EAAG,EAAGW,GAAI,EAAGC,GAAI,EAAGgkB,OAAQ,EAChDC,WAAY,EAAGC,WAAY,IAI9B,IAAIC,EAAI/F,EAAOwC,SAAS,GAQxB,OANAuD,EAAE5zB,EAAI+yB,EAAa7G,EAAIE,QAASF,EAAII,SACpCsH,EAAE/kB,EAAIokB,EAAa/G,EAAIE,QAASF,EAAII,SACpCsH,EAAEF,WAAaxH,EAAImI,OACnBT,EAAED,YAAczH,EAAImI,OAEpBxG,EAAOgG,eAAgBhG,EAAOiG,iBAAiBxF,cAAesF,EAAG/F,EAAOwC,WACjE,GAGR+B,EAASxF,YAAc,SAAUV,GAEhCA,EAAIiH,iBAECtF,EAAOwC,SAAS,KAEpBxC,EAAOwC,SAAS,GAAK,CACnB3a,GAAI,EAAG6d,UAAU,EAAOC,YAAY,EACpC5hB,GAAI,EAAGC,GAAI,EAAG7R,EAAG,EAAG6O,EAAG,EAAGW,GAAI,EAAGC,GAAI,EAAGgkB,OAAQ,EAChDC,WAAY,EAAGC,WAAY,IAI9B,IAAIC,EAAI/F,EAAOwC,SAAS,GAUxB,OARAuD,EAAEL,UAAW,EACbK,EAAEJ,YAAa,EACfI,EAAEH,OAASvH,EAAIoI,MAEfV,EAAE5zB,EAAI4zB,EAAEhiB,GAAKmhB,EAAa7G,EAAIE,QAASF,EAAII,SAC3CsH,EAAE/kB,EAAI+kB,EAAE/hB,GAAKohB,EAAa/G,EAAIE,QAASF,EAAII,SAE3CuB,EAAOgG,eAAgBhG,EAAOiG,iBAAiB9F,aAAc4F,EAAG/F,EAAOwC,WAChE,GAGR+B,EAASvF,UAAY,SAAUX,GAI9B,GAFAA,EAAIiH,kBAECtF,EAAOwC,SAAS,GACpB,OAAO,EAER,IAAIuD,EAAI/F,EAAOwC,SAAS,GAExBuD,EAAE5zB,EAAI+yB,EAAa7G,EAAIE,QAASF,EAAII,SACpCsH,EAAE/kB,EAAIokB,EAAa/G,EAAIE,QAASF,EAAII,SAEhCsH,EAAEJ,YACL3F,EAAOgG,eAAgBhG,EAAOiG,iBAAiBzF,kBAAmBuF,EAAG/F,EAAOwC,UAE7ExC,EAAOgG,eAAgBhG,EAAOiG,iBAAiB7F,WAAY2F,EAAG/F,EAAOwC,UAErEuD,EAAEL,UAAW,EACbK,EAAEJ,YAAa,EAEfI,EAAEH,OAAS,GAGZrB,EAAStF,YAAc,SAAUZ,GAIhC,GAFAA,EAAIiH,kBAECtF,EAAOwC,SAAS,GACpB,OAAO,EAER,IAAIuD,EAAI/F,EAAOwC,SAAS,GAexB,OAbIuD,EAAEL,WAAaK,EAAEJ,aAEpB3F,EAAOgG,eAAgBhG,EAAOiG,iBAAiB3F,mBAAoByF,EAAG/F,EAAOwC,UAC7EuD,EAAEJ,YAAa,GAGhBI,EAAE5zB,EAAI+yB,EAAa7G,EAAIE,QAASF,EAAII,SACpCsH,EAAE/kB,EAAIokB,EAAa/G,EAAIE,QAASF,EAAII,SAEpCsH,EAAEpkB,GAAKokB,EAAE5zB,EAAI4zB,EAAEhiB,GACfgiB,EAAEnkB,GAAKmkB,EAAE/kB,EAAI+kB,EAAE/hB,GAEfgc,EAAOgG,eAAgBD,EAAEJ,WAAa3F,EAAOiG,iBAAiB1F,kBAAoBP,EAAOiG,iBAAiB5F,aAAc0F,EAAG/F,EAAOwC,WAC3H,KAKK,IAAVwB,EAAE/nB,KAAciW,EAAIyF,UAOzBoB,KAAM,WAEL,OAAOlmB,KAAKmwB,WAOb5iB,MAAO,WAENvN,KAAKqxB,kBAELrxB,KAAK+tB,MAAME,iBAAkB,EAC7BjuB,KAAKsxB,WAAW/jB,SAOjBQ,KAAM,WAEL/N,KAAK+tB,MAAME,iBAAkB,EAC7BjuB,KAAKsxB,WAAWvjB,QAOjB8lB,MAAO,WAEN7zB,KAAK+tB,MAAME,iBAAkB,GAO9B6F,OAAQ,WAEP9zB,KAAK+tB,MAAME,iBAAkB,EAC7BjuB,KAAK+zB,aAONvC,QAAS,SAAUD,GAElB,IACIyC,EADAC,EAAM7mB,QAGNmkB,EAAQvxB,KAAKiwB,mBAChBsB,EAAQvxB,KAAKiwB,kBAEkB,IAA5BjwB,KAAKgwB,qBACRuB,EAAQvxB,KAAKgwB,oBAEThwB,KAAK+tB,MAAMC,mBAAoBhuB,KAAK+tB,MAAME,iBAM/CsD,GAASvxB,KAAK8vB,UAEd9vB,KAAKkwB,WAAaqB,EAAQ,IAC1BvxB,KAAKmwB,WAAanwB,KAAKkwB,WACvB9Q,EAAQ8G,KAAOlmB,KAAKmwB,UAEpBnwB,KAAKowB,cAGL4D,EAAM5mB,QACNpN,KAAKk0B,OAAQl0B,KAAKkwB,YAClBlwB,KAAKqwB,KAAKI,iBAAmBrjB,QAAU4mB,EAGvCA,EAAM5mB,QACNpN,KAAK4sB,OACL5sB,KAAKqwB,KAAKK,eAAiBtjB,QAAU4mB,EAGrCh0B,KAAKqwB,KAAKC,SAAW2D,EACrBj0B,KAAKqwB,KAAKE,YAEVvwB,KAAKqwB,KAAKO,gBAAkBxjB,QAAU6mB,GAEtC1C,EAAQvxB,KAAKqwB,KAAKC,SAAWtwB,KAAKqwB,KAAK1jB,WAC3B,MAEX3M,KAAKqwB,KAAKhC,IAAM5nB,IAAwB,IAApBzG,KAAKqwB,KAAKE,UAAiBgB,GAI/CvxB,KAAKqwB,KAAKQ,WAAapqB,KAAKzG,KAAMqwB,KAAKQ,WAAW7wB,KAAKqwB,KAAKG,WAAcxwB,KAAKqwB,KAAKhC,MAAQruB,KAAKqwB,KAAKG,WAAa,IACnHxwB,KAAKqwB,KAAKS,kBAAoBrqB,KAAKzG,KAAMqwB,KAAKS,kBAAkB9wB,KAAKqwB,KAAKG,WAAyC,IAA1BxwB,KAAKqwB,KAAKI,gBAAuBzwB,KAAKqwB,KAAKE,YAAevwB,KAAKqwB,KAAKG,WAAa,IAC1KxwB,KAAKqwB,KAAKU,gBAAkBtqB,KAAKzG,KAAMqwB,KAAKU,gBAAgB/wB,KAAKqwB,KAAKG,WAAuC,IAAxBxwB,KAAKqwB,KAAKK,cAAqB1wB,KAAKqwB,KAAKE,YAAevwB,KAAKqwB,KAAKG,WAAa,IACpKxwB,KAAKqwB,KAAKW,iBAAmBvqB,KAAKzG,KAAMqwB,KAAKW,iBAAiBhxB,KAAKqwB,KAAKG,WAAwC,IAAzBxwB,KAAKqwB,KAAKM,eAAsB3wB,KAAKqwB,KAAKE,YAAevwB,KAAKqwB,KAAKG,WAAa,IACvKxwB,KAAKqwB,KAAKY,iBAAmBxqB,KAAKzG,KAAMqwB,KAAKY,iBAAiBjxB,KAAKqwB,KAAKG,WAAwC,IAAzBxwB,KAAKqwB,KAAKO,eAAsB5wB,KAAKqwB,KAAKE,YAAevwB,KAAKqwB,KAAKG,WAAa,IACvKxwB,KAAKqwB,KAAKG,aAEVxwB,KAAKqwB,KAAK1jB,UAAYsnB,EACtBj0B,KAAKqwB,KAAKC,SAAW2D,EACrBj0B,KAAKqwB,KAAKE,UAAY,EACtBvwB,KAAKqwB,KAAKI,gBAAkB,EAC5BzwB,KAAKqwB,KAAKK,cAAgB,EAC1B1wB,KAAKqwB,KAAKM,eAAiB,EAC3B3wB,KAAKqwB,KAAKO,eAAiB,IAhD3B5wB,KAAK4sB,QAwDPyE,gBAAiB,SAAU8C,GAAa,GAGvC,GAAI,aAAcpuB,EAEb/F,KAAKmd,QAAQwR,YAEhB3uB,KAAKo0B,aAAe3tB,IAAIV,EAAOsuB,OAAO5Z,OACtCza,KAAKs0B,cAAgB7tB,IAAIV,EAAOsuB,OAAO3Z,UAIvC1a,KAAKo0B,aAAeruB,EAAOwuB,WAC3Bv0B,KAAKs0B,cAAgBvuB,EAAOyuB,kBAQ7B,GAHAx0B,KAAKo0B,aAAep0B,KAAKmd,QAAQoR,YACjCvuB,KAAKs0B,cAAgBt0B,KAAKmd,QAAQqR,aAEF,MAA5BxuB,KAAKmd,QAAQoR,aAAoD,MAA7BvuB,KAAKmd,QAAQqR,aACpD,MAAM,IAAIhoB,MAAO,qEAIfxG,KAAMo0B,aAAep0B,KAAKs0B,eAAqC,aAApBt0B,KAAKouB,aAAgCpuB,KAAKo0B,aAAep0B,KAAKs0B,eAAqC,YAApBt0B,KAAKouB,aAElIpuB,KAAKuuB,YAAcvuB,KAAKs0B,cACxBt0B,KAAKwuB,aAAexuB,KAAKo0B,aAEzBp0B,KAAKsyB,eAAgB,IAIrBtyB,KAAKuuB,YAAcvuB,KAAKo0B,aACxBp0B,KAAKwuB,aAAexuB,KAAKs0B,cAEzBt0B,KAAKsyB,eAAgB,GAItB,IAAImC,EAAoBz0B,KAAKmd,QAAQoR,YACjCmG,EAAqB10B,KAAKmd,QAAQqR,aAEZ,OAAtBiG,GAAqD,OAAvBC,IAEP,OAAtBD,GAAqD,OAAvBC,GAEjCD,EAAoBz0B,KAAKuuB,YACzBmG,EAAqB10B,KAAKwuB,cAEI,OAAtBiG,EAERA,EAAoBhuB,IAAI,GAAMzG,KAAKuuB,aAAevuB,KAAKmd,QAAQqR,aAAexuB,KAAKwuB,eAEpD,OAAvBkG,IAERA,EAAqBjuB,IAAI,GAAMzG,KAAKwuB,cAAgBxuB,KAAKmd,QAAQoR,YAAcvuB,KAAKuuB,gBAKtF,IAAIA,EAAckG,EACdjG,EAAekG,EAEM,cAArB10B,KAAKouB,aAA+BG,GAAeC,IAElDD,EAAeC,GAAgBxuB,KAAKuuB,YAAcvuB,KAAKwuB,cAAkBD,EAAcC,GAAgBxuB,KAAKuuB,YAAcvuB,KAAKwuB,gBAElID,EAAcC,EACdA,EAAeiG,GAKjBz0B,KAAKivB,kBAAoB,EAErBV,GAAeC,EAElBxuB,KAAKivB,kBAAoBvnB,KAAKC,IAAI3H,KAAKuuB,YAAcA,EAAavuB,KAAKwuB,aAAeA,GAE9ED,EAERvuB,KAAKivB,kBAAoBjvB,KAAKuuB,YAAcA,EAEpCC,IAERxuB,KAAKivB,kBAAoBjvB,KAAKwuB,aAAeA,GAI9C,IAAI4F,EAAep0B,KAAKuuB,YACpB+F,EAAgBt0B,KAAKwuB,aAQzB,GANID,IAAavuB,KAAKuuB,YAAcA,GAChCC,IAAcxuB,KAAKwuB,aAAeA,GAEtCxuB,KAAK4uB,MAAQnoB,IAA6D,IAAxD2tB,EAAep0B,KAAKuuB,YAAYvuB,KAAKivB,oBACvDjvB,KAAK6uB,MAAQpoB,IAA+D,IAA1D6tB,EAAgBt0B,KAAKwuB,aAAaxuB,KAAKivB,oBAErDjvB,KAAKsyB,cACT,CACC,IAAI0B,EAAMh0B,KAAK4uB,MACf5uB,KAAK4uB,MAAQ5uB,KAAK6uB,MAClB7uB,KAAK6uB,MAAQmF,EAGdh0B,KAAKkvB,YAAclvB,KAAKivB,kBAAoBjvB,KAAKgvB,iBACjDhvB,KAAKkvB,YAAczoB,IAAI,GAAMzG,KAAKkvB,aAE9BlvB,KAAKmd,QAAQuR,eAAiB,GAAK1uB,KAAKkvB,YAAclvB,KAAKmd,QAAQuR,iBACtE1uB,KAAKkvB,YAAclvB,KAAKmd,QAAQuR,gBAEjC1uB,KAAK+tB,MAAMC,kBAAmB,EAO1B,aAAcjoB,IACjBA,EAAOwY,SAASG,KAAKE,MAAMqI,gBAAkBjnB,KAAKgtB,SAAS/F,iBAKvDjnB,KAAKsyB,eAgBTtyB,KAAKgtB,SAAS9M,OAAQlgB,KAAKwuB,aAAaxuB,KAAKkvB,YAAalvB,KAAKuuB,YAAYvuB,KAAKkvB,aAChFlvB,KAAKgtB,SAAS7O,KAAKS,MAAMnE,MAAQhU,IAAIzG,KAAKwuB,aAAaxuB,KAAKivB,kBAAkB,IAAO,KACrFjvB,KAAKgtB,SAAS7O,KAAKS,MAAMlE,OAASjU,IAAIzG,KAAKuuB,YAAYvuB,KAAKivB,kBAAkB,IAAO,KAErFjvB,KAAKovB,eAAelP,OAAQlgB,KAAKwuB,aAAaxuB,KAAKkvB,YAAalvB,KAAKuuB,YAAYvuB,KAAKkvB,aACtFlvB,KAAKovB,eAAejR,KAAKS,MAAMnE,MAAQhU,IAAIzG,KAAKwuB,aAAaxuB,KAAKivB,kBAAkB,IAAO,KAC3FjvB,KAAKovB,eAAejR,KAAKS,MAAMlE,OAASjU,IAAIzG,KAAKuuB,YAAYvuB,KAAKivB,kBAAkB,IAAO,KAE3FjvB,KAAKqvB,eAAenP,OAAQoU,EAAeF,GAC3Cp0B,KAAKqvB,eAAelR,KAAKS,MAAMnE,MAAQ6Z,EAAgB,KACvDt0B,KAAKqvB,eAAelR,KAAKS,MAAMlE,OAAS0Z,EAAe,OAxBvDp0B,KAAKgtB,SAAS9M,OAAQlgB,KAAKuuB,YAAYvuB,KAAKkvB,YAAalvB,KAAKwuB,aAAaxuB,KAAKkvB,aAChFlvB,KAAKgtB,SAAS7O,KAAKS,MAAMnE,MAAQhU,IAAIzG,KAAKuuB,YAAYvuB,KAAKivB,kBAAkB,IAAO,KACpFjvB,KAAKgtB,SAAS7O,KAAKS,MAAMlE,OAASjU,IAAIzG,KAAKwuB,aAAaxuB,KAAKivB,kBAAkB,IAAO,KAEtFjvB,KAAKovB,eAAelP,OAAQlgB,KAAKuuB,YAAYvuB,KAAKkvB,YAAalvB,KAAKwuB,aAAaxuB,KAAKkvB,aACtFlvB,KAAKovB,eAAejR,KAAKS,MAAMnE,MAAQhU,IAAIzG,KAAKuuB,YAAYvuB,KAAKivB,kBAAkB,IAAO,KAC1FjvB,KAAKovB,eAAejR,KAAKS,MAAMlE,OAASjU,IAAIzG,KAAKwuB,aAAaxuB,KAAKivB,kBAAkB,IAAO,KAE5FjvB,KAAKqvB,eAAenP,OAAQkU,EAAcE,GAC1Ct0B,KAAKqvB,eAAelR,KAAKS,MAAMnE,MAAQ2Z,EAAe,KACtDp0B,KAAKqvB,eAAelR,KAAKS,MAAMlE,OAAS4Z,EAAgB,MAiBzDt0B,KAAKgtB,SAAS7O,KAAKS,MAAM+V,WAAa30B,KAAK4uB,MAAQ,KACnD5uB,KAAKgtB,SAAS7O,KAAKS,MAAMgW,UAAY50B,KAAK6uB,MAAQ,KAElD7uB,KAAKovB,eAAejR,KAAKS,MAAM+V,WAAa30B,KAAK4uB,MAAQ,KACzD5uB,KAAKovB,eAAejR,KAAKS,MAAMgW,UAAY50B,KAAK6uB,MAAQ,KAExD7uB,KAAKgtB,SAASpb,eACd5R,KAAKovB,eAAexd,eACpB5R,KAAKqvB,eAAezd,eAEI,GAApB5R,KAAKkvB,cAERlvB,KAAKgtB,SAAStF,YAAY1nB,KAAKkvB,aAC/BlvB,KAAKovB,eAAe1H,YAAY1nB,KAAKkvB,cAGlClvB,KAAKsyB,eAERtyB,KAAKgtB,SAAShe,OAAOtH,KAAKijB,GAAG,GAC7B3qB,KAAKgtB,SAASne,WAAW7O,KAAKuuB,YAAa,GAC3CvuB,KAAKgtB,SAASrF,SAAQ,GAEtB3nB,KAAKovB,eAAepgB,OAAOtH,KAAKijB,GAAG,GACnC3qB,KAAKovB,eAAevgB,WAAW7O,KAAKuuB,YAAa,GACjDvuB,KAAKovB,eAAezH,SAAQ,GAE5B3nB,KAAKqvB,eAAergB,OAAOtH,KAAKijB,GAAG,GACnC3qB,KAAKqvB,eAAexgB,WAAWulB,EAAc,GAC7Cp0B,KAAKqvB,eAAe1H,SAAQ,KAI5B3nB,KAAKgtB,SAASrF,SAAQ,GACtB3nB,KAAKovB,eAAezH,SAAQ,GAC5B3nB,KAAKqvB,eAAe1H,SAAQ,IAI7B3nB,KAAKkvB,aAAelvB,KAAKmd,QAAQsR,iBAE7BzuB,KAAKmd,QAAQuR,eAAiB,GAAK1uB,KAAKkvB,YAAclvB,KAAKmd,QAAQuR,iBACtE1uB,KAAKkvB,YAAclvB,KAAKmd,QAAQuR,gBAEjC1uB,KAAK60B,mBAAqBpuB,IAAIzG,KAAKkvB,YAAc,IACjDlvB,KAAK+zB,YAED/zB,KAAKmvB,eACRnvB,KAAKmvB,cAAczmB,OAEpB1I,KAAKmvB,cAAgBnvB,KAAKgtB,SAAShD,WAAU,GAEzB,GAAhBmK,IAEHn0B,KAAK+tB,MAAMC,kBAAmB,EAC9BhuB,KAAK80B,gBAAiB90B,KAAKuuB,YAAavuB,KAAKwuB,gBAQ/CsG,gBAAiB,SAAUvG,EAAaC,KAQxCuF,UAAW,WAEV/zB,KAAKqwB,KAAK1jB,UAAYS,QACtBpN,KAAKqwB,KAAKC,SAAWljB,QAErBpN,KAAKqwB,KAAKE,UAAY,EACtBvwB,KAAKqwB,KAAKI,gBAAkB,EAC5BzwB,KAAKqwB,KAAKK,cAAgB,EAC1B1wB,KAAKqwB,KAAKM,eAAiB,EAC3B3wB,KAAKqwB,KAAKO,eAAiB,EAE3B5wB,KAAKqwB,KAAKG,WAAa,EACvBxwB,KAAKqwB,KAAKhC,IAAM,EAChBruB,KAAKqwB,KAAKQ,WAAa,EACvB7wB,KAAKqwB,KAAKS,kBAAoB,EAC9B9wB,KAAKqwB,KAAKU,gBAAkB,EAC5B/wB,KAAKqwB,KAAKW,iBAAmB,EAC7BhxB,KAAKqwB,KAAKY,iBAAmB,GAQ9B8D,eAAgB,SAAUC,GAGzB,OADAh1B,KAAK4vB,YAAYjlB,KAAMqqB,GAChBh1B,KAAK4vB,YAAYplB,QAYzByqB,kBAAmB,SAAUD,GAE5Bh1B,KAAK4vB,YAAYxkB,OAAQf,EAASgB,WAAW2pB,GAAWA,EAAUh1B,KAAK4vB,YAAYzkB,SAAS6pB,KAQ7FE,aAAc,SAAUF,GAGvB,OADAh1B,KAAK6vB,UAAUllB,KAAMqqB,GACdh1B,KAAK6vB,UAAUrlB,QAYvB2qB,gBAAiB,SAAUH,GAE1Bh1B,KAAK6vB,UAAUzkB,OAAQf,EAASgB,WAAW2pB,GAAWA,EAAUh1B,KAAK6vB,UAAU1kB,SAAS6pB,KAQzFI,SAAU,SAAUJ,GAEnBh1B,KAAK4vB,YAAYjlB,KAAMqqB,GACvBh1B,KAAK6vB,UAAUllB,KAAMqqB,IAQtBK,YAAa,SAAUL,GAEtBh1B,KAAK4vB,YAAYxkB,OAAQpL,KAAK4vB,YAAYzkB,SAAS6pB,IACnDh1B,KAAK6vB,UAAUzkB,OAAQpL,KAAK6vB,UAAU1kB,SAAS6pB,KAMhDd,OAAQ,SAAUoB,GAEjB,IAEC,IAAIvrB,EAEJ,IAAK,IAAIoU,EAAOne,KAAK4vB,YAAYrlB,IAAK4T,EAAMA,EAAOpU,EAElDA,EAAOoU,EAAKpU,MAEkB,IAA1BoU,EAAK9e,MAAM60B,OAAOoB,IACrBt1B,KAAKi1B,kBAAkB9W,GAG1B,MAAOwC,GAGN,MADAwM,EAAOpf,OACD4S,IAORiM,KAAM,WAEoB,OAArB5sB,KAAKgtB,SAAS/a,IACjBjS,KAAKgtB,SAASzf,QAEVvN,KAAKmd,QAAQgR,WAEjBnuB,KAAKgtB,SAAShjB,QACdhK,KAAKovB,eAAeplB,QACpBhK,KAAKqvB,eAAerlB,SAGrB,IAEC,IAAID,EAEJ,IAAK,IAAIoU,EAAOne,KAAK6vB,UAAUtlB,IAAK4T,EAAMA,EAAOpU,EAEhDA,EAAOoU,EAAKpU,KACZoU,EAAK9e,MAAMutB,KAAK5sB,KAAKgtB,UAGG,OAArBhtB,KAAKgtB,SAAS/a,KAEjBjS,KAAKgtB,SAAS/D,QACdjpB,KAAKgtB,SAAShE,OAGhB,MAAOrI,GAGN,MADAwM,EAAOpf,OACD4S,IAUR4U,YAAa,SAAU3X,EAAK4X,EAAKC,EAAUC,EAAQlpB,GAGlD,IAAI0Z,EAAO,GACPxV,EAAO,GACP5Q,EAAQ,EAEZ,IAAK,IAAI2iB,KAAK7E,EAEbsI,EAAKzD,GAAK,EACV/R,EAAK+R,GAAK7E,EAAI6E,GACd3iB,IAGD,IAAI61B,EACJ,CACCzB,OAAQ,SAASoB,GAEhB,IAAK,IAAIh2B,KAAK4mB,EACd,CACC,GAAIA,EAAK5mB,IAAMm2B,EAASn2B,GACvB,SAED4mB,EAAK5mB,IAAMg2B,EACPpP,EAAK5mB,IAAMm2B,EAASn2B,KAEvB4mB,EAAK5mB,GAAKm2B,EAASn2B,GACnBQ,KAGD,IAAI81B,EAAIF,EAAOp2B,GAAI4mB,EAAK5mB,GAAKm2B,EAASn2B,IACtCoR,EAAKpR,IAAM,EAAEs2B,GAAGhY,EAAIte,GAAKs2B,EAAEJ,EAAIl2B,GAKhC,GAFAkN,EAAUkE,EAAe,GAAT5Q,GAEH,GAATA,EACH,OAAO,IAIVqtB,EAAO4H,eAAeY,GACtBA,EAAazB,OAAO,IAOrBjC,gBAAiB,SAAU9G,EAAQuE,EAAS/vB,GAE3C,OAAO,GAORwzB,eAAgB,SAAUhI,EAAQ0K,EAASlG,GAE1C,OAAO,K;AAMT7C,EAAeK;;;gBCh3Cf;MAAM2I,EACN,CAKCC,SAAS,EAMTC,QAAQ,EAMRC,QAAS,GAETvlB,KAAMtE,EAAK1C,KAAK5B,QAChBhI,MAAO,EAMPo2B,WAAW,EAMXlP,MAAO,OAMP5I,WAAY,UAMZ+X,KAAM,GAMN7W,MAAO,SAAU8W,GAKhB,IAHAp2B,KAAK0Q,KAAK/F,KAAKyrB,GACfp2B,KAAKF,QAEEE,KAAK0Q,KAAKvQ,OAASH,KAAKi2B,SAC9Bj2B,KAAK0Q,KAAKjF,QAEPzL,KAAKk2B,WACRvtB,QAAQU,MAAMrJ,KAAKF,MAAQ,KAAOs2B,IAOpCpsB,MAAO,WAENhK,KAAK0Q,KAAKjG,QACVzK,KAAKF,MAAQ,GAcdglB,OAAQ,SAAUxlB,EAAE,EAAG6O,EAAE,EAAGkoB,EAAS,IAAKC,GAAQ,EAAMC,GAAU,GAEjE,GAAIv2B,KAAK+1B,QAAS,OAClB/1B,KAAK+1B,SAAU,EAEVO,IAASnoB,GAAK,IACnB,IAAIqoB,EAAKroB,EAET2e,EAAOoI,aAAc,CAAEtI,KAAM,WAE5B,GAAIkJ,EAAIE,OAAQ,OAEhB,IAAIhC,EAAM5mB,QAEV,MAAMga,EAAI0F,EAAOuC,eAEjBjI,EAAEmB,KAAK,QAAQ8N,EAAS,gBACxBjP,EAAEqB,aAAa,OAEf,IAAIgO,EAAI,GAERtoB,EAAIqoB,GAEY,IAAZF,GAAwC,GAAnBxJ,EAAOuD,KAAKhC,MAGpCoI,EAAI,QAAU3J,EAAOuD,KAAKhC,IAAM,IAAMvB,EAAOuD,KAAKQ,WAAa,YAAc/D,EAAOuD,KAAKS,kBAAoB,UAAYhE,EAAOuD,KAAKU,gBAAkB,WAAajE,EAAOuD,KAAKY,iBAE5K6E,EAAI1X,aACPgJ,EAAEnH,UAAU6V,EAAI1X,YAChBgJ,EAAE5F,SAAUliB,EAAE,EAAG6O,EAAE,EAAGiZ,EAAEnE,YAAYwT,GAAG,EAAGJ,EAAS,IAGpDjP,EAAEnH,UAAU6V,EAAI9O,OAChBI,EAAEvE,SAAS4T,EAAGn3B,EAAG6O,IAGlBsoB,EAAI,GAEJ,IAAK,IAAIv2B,KAAK41B,EAAIK,KACjBM,GAAKv2B,EAAI,KAAO41B,EAAIK,KAAKj2B,GAAK,KAErB,KAANu2B,IAEHtoB,GAAK,GAED2nB,EAAI1X,aACPgJ,EAAEnH,UAAU6V,EAAI1X,YAChBgJ,EAAE5F,SAAUliB,EAAE,EAAG6O,EAAE,EAAGiZ,EAAEnE,YAAYwT,GAAG,EAAGJ,EAAS,IAGpDjP,EAAEnH,UAAU6V,EAAI9O,OAChBI,EAAEvE,SAAS4T,EAAGn3B,EAAG6O,IAGlB,IAAIgM,EAAI,EACR,IAAK,IAAIuc,EAAKZ,EAAIplB,KAAKnG,IAAKmsB,EAAIA,EAAKA,EAAG3sB,KAAMoQ,IAE7Csc,GAAKF,EAAY,KAAOT,EAAIh2B,MAAMg2B,EAAIplB,KAAKvQ,OAAOga,EAAE,GAAK,KAAO,MAAQuc,EAAGr3B,MAEvEy2B,EAAI1X,aACPgJ,EAAEnH,UAAU6V,EAAI1X,YAChBgJ,EAAE5F,SAAUliB,EAAE,EAAG6O,EAAE,EAAE,GAAKkoB,EAAS,IAAIlc,EAAE,GAAK,EAAGiN,EAAEnE,YAAYwT,GAAG,EAAGJ,EAAS,IAG/EjP,EAAEnH,UAAU6V,EAAI9O,OAChBI,EAAEvE,SAAS4T,EAAGn3B,EAAG6O,EAAE,EAAE,GAAKkoB,EAAS,IAAIlc,EAAE,IAG1C6Z,EAAO5mB,QAAU4mB,EACjBlH,EAAOuD,KAAKK,eAAiBsD,EAC7BlH,EAAOuD,KAAKM,gBAAkBqD,MAQhCH,MAAO,WAEN7zB,KAAKg2B,QAAS,GAQflC,OAAQ,WAEP9zB,KAAKg2B,QAAS,I,IAKhB3W,EAAeyW;;;;oBChLf;MAAMa,EACN,CAKC1kB,GAAI,KAMJiU,KAAM,EAMNuB,SAAU,KAMVmP,aAAa,EAMbC,YAAY,EASZC,MAAO,IAAIt3B,EACXu3B,MAAO,IAAIv3B,EACXw3B,MAAO,IAAIx3B,G,IAGZ4f,EAAeuX;;iBAUf5wB;EAAOkxB,GAAK,SAAS53B,GAEpB,OAAOA,EAAMoE,EAAEyzB,OAOhBnxB,EAAO+E,QAAU,SAAUqsB,GAE1B,GAAY,OAARA,GAAgC,iBAATA,EAG3B,MAAI,SAAUA,EACNA,EAAIzuB,OAER,YAAayuB,EACTA,EAAIrsB,eAER,WAAYqsB,GACfA,EAAItuB,WAOF,iBAAkB9C,GAErBA,EAAOqxB,aAAe,IAAIC,aAAa,CAAEC,YAAa,cAAeC,WAAY,QACjFlY,EAAIC,MAAM,gCAAkE,IAAhCvZ,EAAOqxB,aAAaI,aAAoB,QAGpFzxB,EAAOqxB,aAAe,KAMvBrxB,EAAO0xB,OAAS,SAAU1K,EAAK5P,GAE9B,OAAO,IAAIua,SAAS,CAACC,EAASC,KAExBza,IAASA,EAAU,IAClB,iBAAkBA,IAAUA,EAAQ0a,aAAe,eAEzD,IAAIC,EAAU,IAAIC,eAClBD,EAAQE,KAAK,MAAOjL,GAAK,GAEzB,IAAK,IAAI7sB,KAAKid,EAAS2a,EAAQ53B,GAAKid,EAAQjd,GAE5C43B,EAAQna,OAAS,WAChBga,EAASG,EAAQG,WAGlBH,EAAQI,QAAU,WACjBN,EAAQ,wCAGTE,EAAQK,WAQVpyB,EAAOqyB,iBAAmB,SAAUrL,GAEnC,OAAO,IAAI2K,SAAQ,CAACC,EAASC,KAEvB7xB,EAAOqxB,aAMZK,OAAO1K,GACNsL,MAAKC,GAAelB,aAAamB,gBAAgBD,KACjDD,MAAKG,GAAeb,EAAQa,KAC5BC,OAAMC,GAAOd,EAAOc,KAPpBd,EAAQ,sCAeX7xB,EAAOU,IAAM,SAAUpH,GAEtB,OAAOA,GAAS,GAOjB0G,EAAO4yB,KAAO,SAAUt5B,GAEvB,OAAc,IAAVA,IAA4B,IAAVA,EACdA,EAEK,QAATA,GAGS,SAATA,KAGMA,GAOX0G,EAAO6yB,MAAQ,SAAUv5B,GAExB,OAAOw5B,WAAWx5B,IAOnB0G,EAAO+yB,OAAS,SAAUz5B,GAEzB,OAAOoH,IAAW,IAANpH,GAAY,KAOzB0G,EAAOgzB,OAAS,SAAU15B,GAEzB,OAAOoH,IAAW,IAANpH,GAAa,KAO1B0G,EAAOizB,OAAS,SAAU35B,GAEzB,OAAOoH,IAAW,IAANpH,GAAc,KAO3B0G,EAAOkzB,IAAM,SAAUC,GAEtB,OAAOA,EAAQxxB,KAAKijB,GAAG,KAOxB5kB,EAAOozB,IAAM,SAAUC,GAEtB,OAAOA,EAAS1xB,KAAKijB,GAAI,KAO1B5kB,EAAOszB,KAAO,WAEb,OAAO1C,EAAQG,MAAMr2B,aAOtBsF,EAAOuzB,MAAQ,WAEd,OAAO3C,EAAQG,MAAMn2B,aAOtBoF,EAAOwzB,OAAS,SAAUl5B,EAAGC,GAE5B,IAAIs1B,EAAIe,EAAQG,MAAMn2B,YACtB,OAAOi1B,EAAEt1B,GAAK,EAAEs1B,GAAGv1B,GAOpB0F,EAAOyzB,MAAQ,SAAUn5B,EAAGC,GAE3B,IAAIs1B,EAAIe,EAAQG,MAAMn2B,YACtB,OAAO+G,KAAK+xB,MAAM7D,EAAEt1B,GAAK,EAAEs1B,GAAGv1B,IAQ/B0F,EAAO2zB,MAAQ,SAAUr5B,EAAGC,EAAGmH,EAAGkyB,GAAiB,GAElD,IAAIC,EAAQ,GAGRC,EAAIx5B,EACR,IAAK,IAAIH,EAAI,EAAGA,EAAIuH,EAAGvH,IAAK25B,IAE3BD,EAAMjvB,KAAKkvB,GACPA,EAAE,EAAIv5B,IAAGu5B,EAAIx5B,EAAE,GAIpB,MAAMy5B,EAAIryB,IAAM,EAChB,IAAK,IAAI0S,EAAI,EAAGA,EAAI2f,EAAG3f,IACvB,CACC9Z,EAAIm5B,MAAMrf,EAAE,EAAG1S,EAAE,GAEjB,IAAIusB,EAAM4F,EAAMzf,GAChByf,EAAMzf,GAAKyf,EAAMv5B,GACjBu5B,EAAMv5B,GAAK2zB,EAIZ,IAAK2F,EAAkB,OAAOC,EAE9B,IAAIpoB,EAAI/J,EAAE,EACV,IAAK,IAAIsyB,EAAI,EAAGA,EAAItyB,EAAGsyB,IACvB,CACC,GAAIH,EAAMG,KAAOH,EAAMG,EAAE,GACxB,SAED,KAAMH,EAAMG,KAAOH,EAAMpoB,MAElBA,EAAI,IACTA,EAAI/J,EAAE,EACNkB,QAAQS,IAAI,OAId,IAAI4qB,EAAM4F,EAAMG,GAChBH,EAAMG,GAAKH,EAAMpoB,GACjBooB,EAAMpoB,GAAKwiB,EAGZ,OAAO4F,GAOR7zB,EAAOi0B,OAAS,SAAU35B,EAAGC,EAAGmH,GAI/B,IAFA,IAAI0B,EAAO,GAEFjJ,EAAI,EAAGA,EAAIuH,EAAGvH,IACtBiJ,EAAKwB,KAAK4uB,OAAOl5B,EAAGC,IAErB,OAAO6I,GAORpD,EAAOqH,MAAQ,WAEd,OAAO6sB,YAAYhG,OAOpBluB,EAAOm0B,QAAU,SAAU75B,EAAGC,GAE7B,OAAO,WAAa,OAAOk5B,MAAMn5B,EAAGC,KAOrCyF,EAAOo0B,SAAW,SAAUC,EAAK/5B,EAAE,KAAMC,EAAE,MAK1C,OAHU,OAAND,IAAYA,EAAI,GACV,OAANC,IAAYA,EAAI85B,EAAIj6B,OAAS,GAE1B,WAAa,OAAOi6B,EAAIZ,MAAMn5B,EAAGC,MAOzCyF,EAAOs0B,2BAA6B,SAAUC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,GAGrG,GAAIP,GAAUI,GAAUH,GAAUI,GAAUH,GAAUI,GAAUH,GAAUI,EACzE,OAAO,EAIR,IAAIC,EAAML,EAASF,EACfQ,EAAMP,EAASF,EACfU,EAAMH,EAASF,EACfM,EAAML,EAASF,EAGnB,GAAW,GAAPI,GAAmB,GAAPE,EAChB,CACC,GAAIT,GAAUI,EAAQ,OAVb,EAYT,IAAIlY,EAAK/a,KAAKwzB,IAAIZ,EAAQI,GAG1B,OAAIjY,EAFK/a,KAAKC,IAAI6yB,EAAQI,GAbjB,GAiBDnY,EAAK6X,GAAUS,EAIxB,GAAW,GAAPA,GAAmB,GAAPE,EAChB,CACC,GAAIX,GAAUI,EAAQ,OAvBb,EAyBT,IAAIhY,EAAKhb,KAAKwzB,IAAIX,EAAQI,GAG1B,OAAIjY,EAFKhb,KAAKC,IAAI8yB,EAAQI,GA1BjB,GA8BDnY,EAAK6X,GAAUO,EAIxB,GAAW,GAAPC,EAGH,OAAI,GADAI,GAAMH,GAAKV,EAASI,GAAUO,GAAKN,EAASJ,KAAYU,EAAMH,KACpDK,EAAK,GAGf,GADAC,GAAMd,EAASI,GAAUO,IACfG,EAAK,EAxCV,EA0CFD,EAIR,IAKIC,EAGAD,EAPA76B,EAAI06B,EAAID,EAAME,EAAIH,EAEtB,OAAS,GAALx6B,GAGA,GADA86B,GALIN,GAAKJ,EAASJ,GAAUS,GAAKR,EAASI,IAKjCr6B,IACC86B,EAAK,GAGf,GADAD,GAAMF,EAAIG,EAAKV,EAASJ,GAAUS,IACxBI,EAAK,EAvDT,EAyDHA,GAORp1B,EAAOs1B,sBAAwB,SAAUf,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,GAEhG,IAAIjF,EAAIyE,2BAA4BC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,GAC5F,OAAOjF,GAAK,GAAKA,GAAK,GAWvB7vB,EAAOu1B,YAAc,SAAUrsB,EAAO3P,EAAG6O,EAAGe,EAAG,EAAGC,EAAG,GAEpD,MAAO,CACN7P,EAAG4P,GAAM5P,EAAE4P,GAAIxH,KAAK0H,IAAIH,IAAUd,EAAEgB,GAAIzH,KAAK2H,IAAIJ,GACjDd,EAAGgB,GAAMhB,EAAEgB,GAAIzH,KAAK0H,IAAIH,IAAU3P,EAAE4P,GAAIxH,KAAK2H,IAAIJ,KAQnDlJ,EAAOw1B,UAAY,SAAUl8B,EAAOm8B,EAAUC,EAAUC,GAEvD,OAAOh0B,KAAO+xB,MAAMiC,GAAYr8B,EAAQm8B,IAAaC,EAAWD,IAAcE,GAAaD,EAAWD,GAAYA,GAOnHz1B,EAAO41B,WAAa,SAAUt8B,EAAOu8B,GAEpC,OAAOl0B,KAAK+xB,MAAMp6B,EAAMu8B,GAAMA,GAO/B71B,EAAO81B,iBAAmB,EAM1B91B,EAAO+1B,QAAU,SAAUz8B,GAE1B,OAAOA,GAAU,GAAKw8B,mBAAsB,GAO7C91B,EAAOg2B,UAAY,SAAU18B,GAE5B,OAAOA,GAASw8B,kBAOjB91B,EAAOi2B,WAAa,SAAU38B,GAE7B,OAAOA,GAAS,GAAKw8B,mBAOtB91B,EAAOk2B,OAAS,SAAU58B,GAEzB,OAAO28B,WAAWF,QAAQz8B,KAO3B0G,EAAO4J,MAAQ,SAAStQ,GAEvB,OAAOA,IAAWA,GAOnB0G,EAAOm2B,OAAS,SAAS77B,EAAGC,GAE3B,OAAOoH,KAAKqB,IAAI1I,GAAKqH,KAAKqB,IAAIzI,GAAKD,EAAIC,GAOxCyF,EAAOo2B,OAAS,SAAS97B,EAAGC,GAE3B,OAAOoH,KAAKqB,IAAI1I,GAAKqH,KAAKqB,IAAIzI,GAAKD,EAAIC,GAOxCyF,EAAOq2B,OAAS,SAAU3nB,EAAK3U,GAE9B,IAAIu8B,EAAM,GAEV,KAAOv8B,KAAU,GAChBu8B,GAAO5nB,EAER,OAAO4nB,GAORt2B,EAAOu2B,KAAO,SAAUC,EAAKhlB,EAAMilB,EAAK,KAGvC,OADAD,EAAMA,EAAInsB,WACHgsB,OAAOI,EAAKC,OAAO,GAAIllB,EAAKglB,EAAIp8B,QAAUo8B,GAOlDx2B,EAAO22B,KAAO,SAAUH,EAAKhlB,EAAMilB,EAAK,KAGvC,OADAD,EAAMA,EAAInsB,YACGgsB,OAAOI,EAAKC,OAAO,GAAIllB,EAAKglB,EAAIp8B,SAO9C4F,EAAO42B,KAAO,SAAUt9B,GAEvB,MAAuB,IAAfA,EAAQ,IAOjB0G,EAAO62B,MAAQ,SAAUv9B,GAExB,OAAe,EAARA,EAAc,GAOtB0G,EAAO82B,MAAQ,SAAUx9B,EAAOy9B,EAAG,EAAKra,EAAG,GAE1C,OAAOpjB,EAAQy9B,EAAKA,EAAMz9B,EAAQojB,EAAKA,EAAKpjB,GAO7C0G,EAAOiQ,IAAM,SAAU3W,EAAO0I,EAAIC,EAAI+0B,EAAIC,GAEzC,OAAS39B,EAAQ0I,IAAKi1B,EAAKD,IAAO/0B,EAAKD,GAAOg1B,GAO/Ch3B,EAAOk3B,IAAM,SAAU39B,EAAG6O,EAAG9N,GAE5B,OAAOf,GAAG,EAAEe,GAAK8N,EAAE9N;;AC5mBpB,MAAM68B,EAAO,SAAUC,EAAWC,EAAc,MAE/Cp9B,KAAK0Q,KAAO,GACZ1Q,KAAKm9B,UAAYA,EAEjBn9B,KAAKo9B,cAAgBA,EAErBp9B,KAAKq9B,SAAW,EAChBr9B,KAAKs9B,WAAa,EAElBt9B,KAAKu9B,OAAS,EACdv9B,KAAKw9B,SAAW,G,IAGjBC,EAAeP,EAMfA,EAAK52B,UAAUo3B,MAAQ,WACtB19B,KAAK2M,UAAYstB,YAAYhG,OAO9BiJ,EAAK52B,UAAU0iB,IAAM,WACpBhpB,KAAK29B,KAAM1D,YAAYhG,MAAQj0B,KAAK2M,YAOrCuwB,EAAK52B,UAAUq3B,KAAO,SAAUt+B,GAE/BW,KAAK0Q,KAAK/F,KAAKtL,GACfW,KAAKq9B,WAEDr9B,KAAK0Q,KAAKvQ,QAAUH,KAAKm9B,YAG7Bn9B,KAAK49B,SACL59B,KAAK0Q,KAAO,KAObwsB,EAAK52B,UAAU4tB,OAAS,WAEvB,IAAIvsB,EAAM,KACNuzB,EAAM,KACN2C,EAAM,EACNC,EAAM,EAEV,IAAK,IAAI59B,EAAI,EAAGA,EAAIF,KAAK0Q,KAAKvQ,OAAQD,IAErCyH,EAAc,OAARA,EAAe3H,KAAK0Q,KAAKxQ,GAAKwH,KAAKC,IAAIA,EAAK3H,KAAK0Q,KAAKxQ,IAC5Dg7B,EAAc,OAARA,EAAel7B,KAAK0Q,KAAKxQ,GAAKwH,KAAKwzB,IAAIA,EAAKl7B,KAAK0Q,KAAKxQ,IAC5D29B,GAAO79B,KAAK0Q,KAAKxQ,GAGlB29B,GAAO79B,KAAK0Q,KAAKvQ,OAEjB,IAAIwgB,EAA2B,OAAvB3gB,KAAKo9B,cAAyBp9B,KAAKo9B,cAAgBS,EAE3D,IAAK,IAAI1jB,EAAI,EAAGA,EAAIna,KAAK0Q,KAAKvQ,OAAQga,IAAK2jB,GAAOp2B,KAAKq2B,IAAI/9B,KAAK0Q,KAAKyJ,GAAKwG,EAAG,GAa7E,OAXAmd,EAAMp2B,KAAKqI,KAAK+tB,EAAM99B,KAAK0Q,KAAKvQ,QAEhCH,KAAKu9B,QAAUO,EACf99B,KAAKw9B,WAELx9B,KAAK2H,IAAMA,EACX3H,KAAKk7B,IAAMA,EACXl7B,KAAK69B,IAAMA,EACX79B,KAAK89B,IAAMA,EAEX99B,KAAKs9B,WAAat9B,KAAKq9B,SAChBr9B,MAORk9B,EAAK52B,UAAUs3B,OAAS,SAAU7P,EAAM,KAEvC,IAAIsO,EAAM,GAaV,OAXIr8B,KAAKs9B,YAAct9B,KAAKq9B,UAC3Br9B,KAAKk0B,SAEFnG,EAAQmP,EAAKc,MAAMC,UAAS5B,GAAO,MAAQr8B,KAAKw9B,UAChDzP,EAAQmP,EAAKc,MAAME,MAAK7B,IAAe,IAAPA,EAAY,KAAO,IAAM,QAAUr8B,KAAK2H,KACxEomB,EAAQmP,EAAKc,MAAMG,MAAK9B,IAAe,IAAPA,EAAY,KAAO,IAAM,QAAUr8B,KAAKk7B,KACxEnN,EAAQmP,EAAKc,MAAMI,MAAK/B,IAAe,IAAPA,EAAY,KAAO,IAAM,QAAUr8B,KAAK69B,IAAIv0B,QAAQ,IACpFykB,EAAQmP,EAAKc,MAAMK,WAAUhC,IAAe,IAAPA,EAAY,KAAO,UAA8BiC,IAAvBt+B,KAAKo9B,cAA8B,MAAQp9B,KAAKo9B,cAAgB,KAC/HrP,EAAQmP,EAAKc,MAAMO,SAAQlC,IAAe,IAAPA,EAAY,KAAO,IAAM,WAAar8B,KAAK89B,IAAIx0B,QAAQ,IAC1FykB,EAAQmP,EAAKc,MAAMQ,aAAYnC,IAAe,IAAPA,EAAY,KAAO,IAAM,gBAAkBr8B,KAAKu9B,OAASv9B,KAAKw9B,UAAUl0B,QAAQ,IAEpH+yB;;;;AAQRa,EAAKc,MAAQ,CACZC,QAAS;;AAETC,IAAK;;AAELC,IAAK;;AAELC,IAAK;;AAELC,SAAU;;AAEVE,OAAQ;;AAERC,WAAY;;AAEZC,IAAK;;;AC/HN,MAAMC,EAAcj/B,EAAMC,OACzB,CAIAi/B,cAAe,KAKfC,YAAa,KAKbC,gBAAiB,KAKjBpkB,MAAO,EAKPC,OAAQ,EAKRokB,YAAa,KACbC,cAAe,KAQfh/B,OAAQ,SAAU0a,EAAM,KAAMC,EAAO,MAEjB,OAAf0E,EAAQnN,KAGkB,OAA1B+sB,EAAmB,IACtBC,EAAuB7f,EAAQnN,IAEhCjS,KAAK2+B,cAAgBvf,EAAQnN,GAAGitB,oBAEhCl/B,KAAK8+B,YAAc,GACnB9+B,KAAK++B,cAAgB,GAMrB/+B,KAAKya,MAAQA,GAASqS,EAAOE,SAASvS,MACtCza,KAAK0a,OAASA,GAAUoS,EAAOE,SAAStS,OAErC1a,KAAK4+B,YAAc,IAAIj4B,MAAM+3B,EAAYS,uBAAuBv4B,KAAK,MACrE5G,KAAK6+B,gBAAkB,IAAIl4B,MAAM+3B,EAAYS,uBAAuBv4B,KAAK,QAM7EiC,OAAQ,WAEP,IAAIoJ,EAAKmN,EAAQnN,GACjB,GAAW,OAAPA,EAAJ,CAEA,IAAK,IAAI/R,EAAI,EAAGA,EAAIF,KAAK4+B,YAAYz+B,OAAQD,IAEhB,OAAxBF,KAAK4+B,YAAY1+B,KAEhBF,KAAK6+B,gBAAgB3+B,KAAOw+B,EAAYU,QAC3CntB,EAAGotB,cAAcr/B,KAAK4+B,YAAY1+B,IAElC+R,EAAGqtB,mBAAmBt/B,KAAK4+B,YAAY1+B,KAI1C+R,EAAGstB,kBAAkBv/B,KAAKw/B,iBAU3B7oB,OAAQ,SAAU8oB,EAAiBC,EAASzqB,EAAK,MAEhD,IAAIhD,EAAKmN,EAAQnN,GACjB,GAAW,OAAPA,EAAa,OAEJ,OAATgD,IACHA,EAAOwqB,EAAkBf,EAAYiB,MAAQjB,EAAYU,QAAUV,EAAYkB,cAEhF5/B,KAAK4+B,YAAYa,GAAmBC,EACpC1/B,KAAK6+B,gBAAgBY,GAAmBxqB,EAEpCwqB,EAAkBf,EAAYiB,QAAuD,IAA9C3/B,KAAK8+B,YAAYjqB,QAAQ4qB,KAEnEz/B,KAAK8+B,YAAYn0B,KAAK80B,GACtBz/B,KAAK++B,cAAcp0B,KAAKq0B,EAAmBS,KAG5C,IAAI31B,EAAOmI,EAAGmB,aAAanB,EAAG4tB,qBAG9B,OAFA5tB,EAAG6tB,gBAAiB7tB,EAAG8tB,YAAa//B,KAAK2+B,eAEjC1pB,GAEP,KAAKypB,EAAYU,QAChBntB,EAAG+tB,qBAAsB/tB,EAAG8tB,YAAaf,EAAmBS,GAAkBxtB,EAAGoJ,WAAYqkB,EAAS,GACtG,MAED,KAAKhB,EAAYkB,aAChB3tB,EAAGguB,wBAAyBhuB,EAAG8tB,YAAaf,EAAmBS,GAAkBxtB,EAAG2tB,aAAcF,GAIpGztB,EAAG6tB,gBAAiB7tB,EAAG8tB,YAAaj2B,IAUrCo2B,kBAAmB,SAAUT,EAAiBhlB,EAAM,KAAMC,EAAO,MAEhE,IAAIzI,EAAKmN,EAAQnN,GACjB,GAAW,OAAPA,EAAa,OAAO,KAEV,OAAVwI,IAAgBA,EAAQza,KAAKya,OAClB,OAAXC,IAAiBA,EAAS1a,KAAK0a,QAEnC,IAAIylB,EAAMluB,EAAGkJ,gBAUb,OATAlJ,EAAGmJ,YAAanJ,EAAGoJ,WAAY8kB,GAE/BluB,EAAGuJ,aAAcvJ,EAAGoJ,WAAY,EAAGpJ,EAAGwJ,MAAOhB,EAAOC,GACpDzI,EAAG0J,cAAe1J,EAAGoJ,WAAYpJ,EAAG2J,mBAAoB3J,EAAG8J,SAC3D9J,EAAG0J,cAAe1J,EAAGoJ,WAAYpJ,EAAG6J,mBAAoB7J,EAAG8J,SAC3D9J,EAAG0J,cAAe1J,EAAGoJ,WAAYpJ,EAAGiK,eAAgBjK,EAAGqK,eACvDrK,EAAG0J,cAAe1J,EAAGoJ,WAAYpJ,EAAGmK,eAAgBnK,EAAGqK,eAEvDtc,KAAK2W,OAAO8oB,EAAiBU,GACtBA,GAURC,kBAAmB,SAAU3lB,EAAM,KAAMC,EAAO,MAE/C,IAAIzI,EAAKmN,EAAQnN,GACjB,GAAW,OAAPA,EAAa,OAAO,KAEV,OAAVwI,IAAgBA,EAAQza,KAAKya,OAClB,OAAXC,IAAiBA,EAAS1a,KAAK0a,QAEnC,IAAIylB,EAAMluB,EAAGouB,qBAKb,OAJApuB,EAAGquB,iBAAkBruB,EAAG2tB,aAAcO,GACtCluB,EAAGsuB,oBAAqBtuB,EAAG2tB,aAAc3tB,EAAGuuB,kBAAmB/lB,EAAOC,GAEtE1a,KAAK2W,OAAO+nB,EAAYiB,MAAOQ,GACxBA,GAURM,oBAAqB,SAAUhmB,EAAM,KAAMC,EAAO,MAEjD,IAAIzI,EAAKmN,EAAQnN,GACjB,GAAW,OAAPA,EAAa,OAAO,KAEV,OAAVwI,IAAgBA,EAAQza,KAAKya,OAClB,OAAXC,IAAiBA,EAAS1a,KAAK0a,QAEnC,IAAIylB,EAAMluB,EAAGkJ,gBAUb,OATAlJ,EAAGmJ,YAAanJ,EAAGoJ,WAAY8kB,GAE/BluB,EAAGuJ,aAAcvJ,EAAGoJ,WAAY,EAAGpJ,EAAGyuB,cAAejmB,EAAOC,GAC5DzI,EAAG0J,cAAe1J,EAAGoJ,WAAYpJ,EAAG2J,mBAAoB3J,EAAG8J,SAC3D9J,EAAG0J,cAAe1J,EAAGoJ,WAAYpJ,EAAG6J,mBAAoB7J,EAAG8J,SAC3D9J,EAAG0J,cAAe1J,EAAGoJ,WAAYpJ,EAAGiK,eAAgBjK,EAAGqK,eACvDrK,EAAG0J,cAAe1J,EAAGoJ,WAAYpJ,EAAGmK,eAAgBnK,EAAGqK,eAEvDtc,KAAK2W,OAAO+nB,EAAYgC,cAAeP,GAChCA,GAORQ,WAAY,SAAUlB,GAErB,OAAIz/B,KAAK6+B,gBAAgBY,KAAqBf,EAAYU,QAClD,KAEDp/B,KAAK4+B,YAAYa,IAOzBmB,gBAAiB,SAAUnB,GAE1B,OAAIz/B,KAAK6+B,gBAAgBY,KAAqBf,EAAYkB,aAClD,KAED5/B,KAAK4+B,YAAYa,IAMzBvkB,KAAM,WAEL,IAAIjJ,EAAKmN,EAAQnN,GACN,OAAPA,IAEJA,EAAG6tB,gBAAiB7tB,EAAG8tB,YAAa//B,KAAK2+B,eAEzC1sB,EAAG6sB,YAAa9+B,KAAK++B,eACrB9sB,EAAGwV,SAAU,EAAG,EAAGznB,KAAKya,MAAOza,KAAK0a,UAMrCmmB,OAAQ,WAEP,IAAI5uB,EAAKmN,EAAQnN,GACN,OAAPA,IAEJA,EAAG6tB,gBAAiB7tB,EAAG8tB,YAAa,MAEpC9tB,EAAG6sB,YAAagC,GAChB7uB,EAAGwV,SAAU,EAAG,EAAGqF,EAAOE,SAASvS,MAAOqS,EAAOE,SAAStS,UAM3DqmB,WAAY,WAEX,IAAI9uB,EAAKmN,EAAQnN,GACjB,GAAW,OAAPA,EAAa,OAAO,EAExB,IAAInI,EAAOmI,EAAGmB,aAAanB,EAAG4tB,qBAC9B5tB,EAAG6tB,gBAAiB7tB,EAAG8tB,YAAa//B,KAAK2+B,eACzC,IAAIqC,EAAS/uB,EAAGgvB,uBAAuBhvB,EAAG8tB,aAG1C,OAFA9tB,EAAG6tB,gBAAiB7tB,EAAG8tB,YAAaj2B,GAE7Bk3B,IAAW/uB,EAAGivB,wBAQvBxC,EAAYU,QAAU,EACtBV,EAAYkB,aAAe,EAK3BlB,EAAYyC,OAAW,EACvBzC,EAAY0C,OAAW,EACvB1C,EAAY2C,OAAW,EACvB3C,EAAY4C,OAAW,EACvB5C,EAAY6C,OAAW,EACvB7C,EAAY8C,OAAW,EACvB9C,EAAY+C,OAAW,EACvB/C,EAAYgD,OAAW,EACvBhD,EAAYiB,MAAW,EACvBjB,EAAYiD,QAAY,EACxBjD,EAAYgC,cAAgB,GAE5BhC,EAAYS,sBAAwB,GAKpC,MAAMH,EAAqB,IAAIr4B,MAAM+3B,EAAYS,uBAAuBv4B,KAAK,MACvEk6B,EAAqB,IAAIn6B,MAAM,GAAGC,KAAK,MAKvCq4B,EAAyB,SAAUhtB,GAExC6uB,EAAmB,GAAK7uB,EAAG2vB,KAE3B5C,EAAmBN,EAAYyC,QAAUlvB,EAAG4vB,kBAC5C7C,EAAmBN,EAAY0C,QAAUnvB,EAAG6vB,kBAC5C9C,EAAmBN,EAAY2C,QAAUpvB,EAAG8vB,kBAC5C/C,EAAmBN,EAAY4C,QAAUrvB,EAAG+vB,kBAC5ChD,EAAmBN,EAAY6C,QAAUtvB,EAAGgwB,kBAC5CjD,EAAmBN,EAAY8C,QAAUvvB,EAAGiwB,kBAC5ClD,EAAmBN,EAAY+C,QAAUxvB,EAAGkwB,kBAC5CnD,EAAmBN,EAAYgD,QAAUzvB,EAAGmwB,kBAC5CpD,EAAmBN,EAAYiB,OAAS1tB,EAAGowB,iBAC3CrD,EAAmBN,EAAYiD,SAAW1vB,EAAGqwB,mBAC7CtD,EAAmBN,EAAYgC,eAAiBzuB,EAAGswB,0B,IAGpDC,EAAe9D,E;;ACvUf,MAAM+D,EAAWhjC,EAAMC,OACtB,CACA6G,UAAW,WAOXm8B,SAAU,KAOVjoB,MAAO,EAOPC,OAAQ,EAORxJ,GAAI,EAOJC,GAAI,EAOJwxB,OAAQ,EAORC,QAAS,EAQT7iC,OAAQ,SAAU2iC,EAAS,KAAMjoB,EAAM,KAAMC,EAAO,MAEnD,GAAI9P,EAAKi4B,aAAaH,EAAUD,GAChC,CACC,IAAIK,EAAWJ,EAEf1iC,KAAK0iC,SAAWI,EAASJ,SACzB1iC,KAAKya,MAAQA,GAASqoB,EAASroB,MAC/Bza,KAAK0a,OAASA,GAAUooB,EAASpoB,OAEjC1a,KAAKkR,GAAK4xB,EAAS5xB,GACnBlR,KAAKmR,GAAK2xB,EAAS3xB,GACnBnR,KAAK2iC,OAASG,EAASH,OACvB3iC,KAAK4iC,QAAUE,EAASF,aAIxB5iC,KAAK0iC,SAAWA,EAEhB1iC,KAAKkR,GAAK,EACVlR,KAAKmR,GAAK,EAENnR,KAAK0iC,UAER1iC,KAAKya,MAAQA,GAASioB,EAAS/nB,YAC/B3a,KAAK0a,OAASA,GAAUgoB,EAAS9nB,aAEjC5a,KAAK2iC,OAASD,EAASjoB,MACvBza,KAAK4iC,QAAUF,EAAShoB,SAIxB1a,KAAKya,MAAQA,EACbza,KAAK0a,OAASA,EAEd1a,KAAK2iC,OAASloB,EACdza,KAAK4iC,QAAUloB,IASlBqoB,YAAa,WAEZ,OAAO/iC,MASRgjC,SAAU,WAET,OAAOhjC,KAAK0iC,UAOb/B,WAAY,WAEX,OAAO3gC,KAAK0iC,UAObxiB,OAAQ,SAAUzF,EAAOC,GAaxB,OAXAD,EAAkB,OAAVA,GAA4B,IAAVA,GAAiBA,EAAgBza,KAAKya,MAChEC,EAAoB,OAAXA,GAA8B,IAAXA,GAAkBA,EAAkB1a,KAAK0a,QAEvD,IAAVD,EACHA,EAAQC,GAAQ1a,KAAKya,MAAMza,KAAK0a,SACb,IAAXA,IACRA,EAASD,GAAOza,KAAK0a,OAAO1a,KAAKya,QAElCza,KAAKya,MAAQA,EACbza,KAAK0a,OAASA,EAEP1a,MAOR4sB,KAAM,SAAUxF,EAAG9nB,EAAG6O,EAAGsM,EAAM,KAAMC,EAAO,MAE3CD,EAAQA,GAASza,KAAKya,MACtBC,EAASA,GAAU1a,KAAK0a,OAExB1a,KAAKijC,MAAM7b,EAAGpnB,KAAKkR,GAAIlR,KAAKmR,GAAInR,KAAK2iC,OAAQ3iC,KAAK4iC,QAAStjC,EAAG6O,EAAGsM,EAAOC,IAOzEuoB,MAAO,SAAU7b,EAAGlW,EAAIC,EAAIwxB,EAAQC,EAASM,EAAIC,EAAIC,EAAQC,EAASC,EAAO,KAAMC,EAAQ,MAE1Fnc,EAAE/D,UAAWrjB,KAAK0iC,SACjBxxB,EAAIC,EAAIwxB,EAAQC,EAChBM,EAAIC,EAAIC,EAAQC,EAChB,KAAM,KAAMC,GAAUF,EAAQG,GAAWF,IAO3CrlB,OAAQ,SAAUoJ,EAAGjJ,GAEpBne,KAAK4sB,KAAMxF,EAAGjJ,EAAKqlB,OAAO/gB,GAAItE,EAAKqlB,OAAO9gB,GAAIvE,EAAKqlB,OAAO/oB,QAAS0D,EAAKqlB,OAAO9oB,aAQ3E+oB,GAAYhB,EAAS/iC,OAC1B,CACA6G,UAAW,oBAEXm9B,GAAI,KACJC,cAAe,EAEf5jC,OAAQ,SAAU6jC,EAAaD,GAI9B,GAFA3jC,KAAK2J,OAAOk6B,SAAS9jC,OAAO6jC,GAER,OAAhBA,IAAyBnkC,EAAMqkC,WAAWF,EAAa,eAC1D,MAAM,IAAIp9B,MAAM,mCAEjBxG,KAAK0jC,GAAKE,EACV5jC,KAAK2jC,cAAgBA,GAGtB96B,OAAQ,WAEPiC,QAAQ9K,KAAK0jC,KAGd/C,WAAY,WAEX,OAAO3gC,KAAK0jC,GAAG/C,cAGhB/T,KAAM,SAAUxF,EAAG9nB,EAAG6O,EAAGsM,EAAOC,GAE/B,MAAMmf,EAAI75B,KAAK2jC,cAEf,IAAII,EAAY/jC,KAAK0jC,GAAGM,SAASnK,EAAE,GAAGpf,MAClCwpB,EAAajkC,KAAK0jC,GAAGM,SAASnK,EAAE,GAAGpf,MACnCypB,EAAWlkC,KAAK0jC,GAAGM,SAASnK,EAAE,GAAGpf,MAEjC0pB,EAAYnkC,KAAK0jC,GAAGM,SAASnK,EAAE,GAAGnf,OAClC0pB,EAAepkC,KAAK0jC,GAAGM,SAASnK,EAAE,GAAGnf,OACrC2pB,EAAYrkC,KAAK0jC,GAAGM,SAASnK,EAAE,GAAGnf,OAElCjT,EAAIhB,KAAKgU,EAAQspB,EAAYE,GAAcC,GAC3CpK,EAAIrzB,KAAKiU,EAASypB,EAAYC,GAAgBC,GAE9C5hB,EAAKnjB,EACLojB,EAAKvU,EAGTnO,KAAK0jC,GAAGM,SAASnK,EAAE,GAAGjN,KAAKxF,EAAG3E,EAAIC,GAClC1iB,KAAK0jC,GAAGM,SAASnK,EAAE,GAAGjN,KAAKxF,EAAG3E,EAAKshB,EAAYt8B,EAAEy8B,EAAUxhB,GAC3D1iB,KAAK0jC,GAAGM,SAASnK,EAAE,GAAGjN,KAAKxF,EAAG3E,EAAIC,EAAKyhB,EAAYrK,EAAEuK,GACrDrkC,KAAK0jC,GAAGM,SAASnK,EAAE,GAAGjN,KAAKxF,EAAG3E,EAAKshB,EAAYt8B,EAAEy8B,EAAUxhB,EAAKyhB,EAAYrK,EAAEuK,GAG9E,IAAK,IAAInkC,EAAI,EAAGA,EAAIuH,EAAGvH,IACtBF,KAAK0jC,GAAGM,SAASnK,EAAE,GAAGjN,KAAKxF,EAAG3E,EAAKshB,EAAY7jC,EAAEgkC,EAAUxhB,GAC3D1iB,KAAK0jC,GAAGM,SAASnK,EAAE,GAAGjN,KAAKxF,EAAG3E,EAAKshB,EAAY7jC,EAAEgkC,EAAUxhB,EAAKyhB,EAAYrK,EAAEuK,GAI/E,IAAK,IAAIlqB,EAAI,EAAGA,EAAI2f,EAAG3f,IACtBna,KAAK0jC,GAAGM,SAASnK,EAAE,GAAGjN,KAAKxF,EAAG3E,EAAIC,EAAKyhB,EAAYhqB,EAAEkqB,GACrDrkC,KAAK0jC,GAAGM,SAASnK,EAAE,GAAGjN,KAAKxF,EAAG3E,EAAKshB,EAAYt8B,EAAEy8B,EAAUxhB,EAAKyhB,EAAYhqB,EAAEkqB,GAI/E,IAAK,IAAI7yB,EAAI,EAAGA,EAAIsoB,EAAGtoB,IACvB,IAAK,IAAIuoB,EAAI,EAAGA,EAAItyB,EAAGsyB,IACtB/5B,KAAK0jC,GAAGM,SAASnK,EAAE,GAAGjN,KAAKxF,EAAG3E,EAAKshB,EAAYhK,EAAEmK,EAAUxhB,EAAKyhB,EAAY3yB,EAAE6yB,MAKjFr+B,SAASyD,WAAWg6B,GAAW,KAM/B,MAAMa,GAAW7B,EAAS/iC,OACzB,CACA6G,UAAW,mBAEXu8B,SAAU,KAEV/iC,OAAQ,SAAU+iC,GAEjB9iC,KAAK2J,OAAOk6B,SAAS9jC,OAAO+iC,GAC5B9iC,KAAK8iC,SAAWA,GAGjBj6B,OAAQ,WAEPiC,QAAQ9K,KAAK8iC,WAGdG,MAAO,SAAU7b,EAAGlW,EAAIC,EAAIwxB,EAAQC,EAASM,EAAIC,EAAIC,EAAQC,EAASC,EAAO,KAAMC,EAAQ,MAE1FvjC,KAAK8iC,SAASG,MAAM7b,EAAGlW,EAAIC,EAAIwxB,EAAQC,EAASM,EAAIC,EAAIC,EAAQC,EAASrjC,KAAKya,MAAOza,KAAK0a,WAI5F1U,SAASyD,WAAW66B,GAAU,KAM9B,MAAMC,GAAU9B,EAAS/iC,OACxB,CACA6G,UAAW,kBAEXu8B,SAAU,KAEV/iC,OAAQ,SAAU+iC,GAEjB9iC,KAAK2J,OAAOk6B,SAAS9jC,OAAO+iC,GAC5B9iC,KAAK8iC,SAAWA,GAGjBj6B,OAAQ,WAEPiC,QAAQ9K,KAAK8iC,WAGdlW,KAAM,SAAUxF,EAAG9nB,EAAG6O,EAAGsM,EAAM,KAAMC,EAAO,MAE3C,IAAI+C,EAAMzd,KAAK2gC,aAEflmB,EAAQA,GAASza,KAAKya,MACtBC,EAASA,GAAU1a,KAAK0a,OAExB1a,KAAK8iC,SAASG,MAAO7b,EACpBpnB,KAAK8iC,SAAS5xB,GAAIlR,KAAK8iC,SAAS3xB,GAAIsJ,EAAMgD,EAAI5C,OAAQH,EAAO+C,EAAI5C,OACjEvb,EAAG6O,EAAGsM,EAAOC,MAIhB1U,SAASyD,WAAW86B,GAAS,KAM7B,MAAMC,GAAW/B,EAAS/iC,OACzB,CACA6G,UAAW,mBAEXu8B,SAAU,KACVlU,MAAO,EACPC,MAAO,EAEP9uB,OAAQ,SAAU+iC,EAAUlU,EAAOC,GAElC7uB,KAAK2J,OAAOk6B,SAAS9jC,OAAO+iC,GAE5B9iC,KAAK8iC,SAAWA,EAChB9iC,KAAK4uB,MAAQA,EACb5uB,KAAK6uB,MAAQA,GAGdhmB,OAAQ,WAEPiC,QAAQ9K,KAAK8iC,WAGdlW,KAAM,SAAUxF,EAAG9nB,EAAG6O,EAAGsM,EAAM,KAAMC,EAAO,MAE3CD,EAAQA,GAASza,KAAKya,MACtBC,EAASA,GAAU1a,KAAK0a,OAExB1a,KAAK8iC,SAASlW,KAAKxF,EAAG9nB,EAAEU,KAAK4uB,MAAyB,IAAlBnU,EAAMza,KAAKya,OAAYtM,EAAEnO,KAAK6uB,MAA2B,IAApBnU,EAAO1a,KAAK0a,QAAa1a,KAAKya,MAAOza,KAAK0a,WAIrH1U,SAASyD,WAAW+6B,GAAU,KAM9B,MAAMC,GAAShC,EAAS/iC,OACvB,CACA6G,UAAW,iBAEXu8B,SAAU,KACVlU,MAAO,EACPC,MAAO,EAEP9uB,OAAQ,SAAU+iC,EAAUlU,EAAOC,GAElC7uB,KAAK2J,OAAOk6B,SAAS9jC,OAAO+iC,GAE5B9iC,KAAK8iC,SAAWA,EAChB9iC,KAAK4uB,MAAQA,EACb5uB,KAAK6uB,MAAQA,GAGdhmB,OAAQ,WAEPiC,QAAQ9K,KAAK8iC,WAGdlW,KAAM,SAAUxF,EAAG9nB,EAAG6O,EAAGsM,EAAM,KAAMC,EAAO,MAE3C1a,KAAK8iC,SAASlW,KAAKxF,EAAG9nB,EAAEU,KAAK4uB,MAAOzgB,EAAEnO,KAAK6uB,MAAOpU,EAAOC,MAI3D1U,SAASyD,WAAWg7B,GAAQ,KAM5B,MAAMC,GAAQjC,EAAS/iC,OACtB,CACA6G,UAAW,gBAEX4C,KAAM,KAENpJ,OAAQ,SAAUoJ,GAEjBnJ,KAAK2J,OAAOk6B,SAAS9jC,SAErBC,KAAKmJ,KAAOA,EAEZnJ,KAAKya,MAAQ,EACbza,KAAK0a,OAAS,EAEd,IAAK,IAAIxa,EAAI,EAAGA,EAAIF,KAAKmJ,KAAKhJ,OAAQD,IAEjCF,KAAKmJ,KAAKjJ,GAAGua,MAAQza,KAAKya,QAAOza,KAAKya,MAAQza,KAAKmJ,KAAKjJ,GAAGua,OAC3Dza,KAAKmJ,KAAKjJ,GAAGwa,OAAS1a,KAAK0a,SAAQ1a,KAAK0a,OAAS1a,KAAKmJ,KAAKjJ,GAAGwa,QAGnE1a,KAAK2iC,OAAS3iC,KAAKya,MACnBza,KAAK4iC,QAAU5iC,KAAK0a,QAGrB7R,OAAQ,WAEP,GAAkB,OAAd7I,KAAKmJ,KACT,CACC,IAAK,IAAIjJ,EAAI,EAAGA,EAAIF,KAAKmJ,KAAKhJ,OAAQD,IACrC4K,QAAQ9K,KAAKmJ,KAAKjJ,IAEnBF,KAAKmJ,KAAO,OAIdyjB,KAAM,SAAUxF,EAAG9nB,EAAG6O,EAAGsM,EAAM,KAAMC,EAAO,MAE3C,IAAK,IAAIxa,EAAI,EAAGA,EAAIF,KAAKmJ,KAAKhJ,OAAQD,IACrCF,KAAKmJ,KAAKjJ,GAAG0sB,KAAKxF,EAAG9nB,EAAG6O,EAAGsM,EAAOC,IAGpCsD,OAAQ,SAAUoJ,EAAGjJ,GAEpB,IAAK,IAAIje,EAAI,EAAGA,EAAIF,KAAKmJ,KAAKhJ,OAAQD,IACrCF,KAAKmJ,KAAKjJ,GAAG8d,OAAOoJ,EAAGjJ,MAI1BnY,SAASyD,WAAWi7B,GAAO,KAM3B,MAAMC,GAAUlC,EAAS/iC,OACxB,CACA6G,UAAW,kBAEXu8B,SAAU,KAEV/iC,OAAQ,SAAU+iC,GAEjB9iC,KAAK2J,OAAOk6B,SAAS9jC,OAAO+iC,GAC5B9iC,KAAK8iC,SAAWA,GAGjBj6B,OAAQ,WAEPiC,QAAQ9K,KAAK8iC,WAGdG,MAAO,SAAU7b,EAAGlW,EAAIC,EAAIwxB,EAAQC,EAASM,EAAIC,EAAIC,EAAQC,EAASC,EAAO,KAAMC,EAAQ,MAE1Fnc,EAAEgC,aACFhC,EAAEvY,UAAUq0B,EAAGE,EAAQD,GACvB/b,EAAE3Z,OAAM,EAAI,GACZzN,KAAK8iC,SAASG,MAAM7b,EAAGlW,EAAIC,EAAIwxB,EAAQC,EAAS,EAAG,EAAGQ,EAAQC,EAASC,EAAQC,GAC/Enc,EAAEiC,eAIJrjB,SAASyD,WAAWk7B,GAAS,KAM7B,MAAMC,GAAUnC,EAAS/iC,OACxB,CACA6G,UAAW,kBAEXu8B,SAAU,KAEV/iC,OAAQ,SAAU+iC,GAEjB9iC,KAAK2J,OAAOk6B,SAAS9jC,OAAO+iC,GAC5B9iC,KAAK8iC,SAAWA,GAGjBj6B,OAAQ,WAEPiC,QAAQ9K,KAAK8iC,WAGdG,MAAO,SAAU7b,EAAGlW,EAAIC,EAAIwxB,EAAQC,EAASM,EAAIC,EAAIC,EAAQC,EAASC,EAAO,KAAMC,EAAQ,MAE1Fnc,EAAEgC,aACFhC,EAAEvY,UAAUq0B,EAAIC,EAAGE,GACnBjc,EAAE3Z,MAAM,GAAG,GACXzN,KAAK8iC,SAASG,MAAM7b,EAAGlW,EAAIC,EAAIwxB,EAAQC,EAAS,EAAG,EAAGQ,EAAQC,EAASC,EAAQC,GAC/Enc,EAAEiC,eAIJrjB,SAASyD,WAAWm7B,GAAS,KAS7BnC,EAASoC,UAAY,SAAUjB,EAAaD,EAAc,GAAK,OAAOF,GAAU/5B,KAAK5B,MAAM87B,EAAaD,IAKxGlB,EAASn8B,UAAUu+B,UAAY,SAASlB,EAAc,GAAK,OAAOF,GAAU/5B,KAAK5B,MAAM9H,KAAM2jC,IAM7FlB,EAASqC,SAAW,SAAUhC,GAAY,OAAOwB,GAAS56B,KAAK5B,MAAMg7B,IAKrEL,EAASn8B,UAAUw+B,SAAW,WAAc,OAAOR,GAAS56B,KAAK5B,MAAM9H,OAMvEyiC,EAASsC,QAAU,SAAUjC,GAAY,OAAOyB,GAAQ76B,KAAK5B,MAAMg7B,IAKnEL,EAASn8B,UAAUy+B,QAAU,WAAc,OAAOR,GAAQ76B,KAAK5B,MAAM9H,OAMrEyiC,EAASuC,SAAW,SAAUlC,EAAUlU,EAAOC,GAAS,OAAO2V,GAAS96B,KAAK5B,MAAMg7B,EAAUlU,EAAOC,IAKpG4T,EAASn8B,UAAU0+B,SAAW,SAAUpW,EAAOC,GAAS,OAAO2V,GAAS96B,KAAK5B,MAAM9H,KAAM4uB,EAAOC,IAMhG4T,EAASwC,OAAS,SAAUnC,EAAUlU,EAAOC,GAAS,OAAO4V,GAAO/6B,KAAK5B,MAAMg7B,EAAUlU,EAAOC,IAKhG4T,EAASn8B,UAAU2+B,OAAS,SAAUrW,EAAOC,GAAS,OAAO4V,GAAO/6B,KAAK5B,MAAM9H,KAAM4uB,EAAOC,IAM5F4T,EAASl5B,MAAQ,YAAa27B,GAAQ,OAAOR,GAAMh7B,KAAK5B,MAAMo9B,IAM9DzC,EAAS0C,QAAU,SAAUrC,GAAY,OAAO6B,GAAQj7B,KAAK5B,MAAMg7B,IAKnEL,EAASn8B,UAAU6+B,QAAU,WAAc,OAAOR,GAAQj7B,KAAK5B,MAAM9H,OAMrEyiC,EAAS2C,QAAU,SAAUtC,GAAY,OAAO8B,GAAQl7B,KAAK5B,MAAMg7B,IAKnEL,EAASn8B,UAAU8+B,QAAU,WAAc,OAAOR,GAAQl7B,KAAK5B,MAAM9H;;;;AAYrEgG,SAASyD,WAAWg5B,EAAU,K,IAC9B4C,GAAe5C,EC7mBf6C,GAAeD,GAAS3lC,OACvB,CACA6G,UAAW,mBAEX6b,EAAG,KAEHriB,OAAQ,SAAUqiB,GAEjB,GAAe,UAAXA,EAAEnN,KACL,MAAM,IAAIzO,MAAO,6BAElBxG,KAAK2J,OAAOk6B,SAAS9jC,OAAOqiB,EAAE1R,KAAM0R,EAAE3H,MAAO2H,EAAE1H,QAE/C1a,KAAKoiB,EAAIA,EACTpiB,KAAKoiB,EAAEmjB,QAAUvlC;ACXnBwlC,GAAeH,GAAS3lC,OACvB,CACA6G,UAAW,iBAEXxG,OAAQ,SAAUqiB,GAEjB,GAAc,UAAVA,EAAEnN,KACL,MAAM,IAAIzO,MAAO,8BAElBxG,KAAK2J,OAAOk6B,SAAS9jC,OAAO,KAAMqiB,EAAE3H,MAAO2H,EAAE1H,QAE7C1a,KAAKoiB,EAAIA,EACTpiB,KAAKoiB,EAAEmjB,QAAUvlC,MAGlByI,KAAM,SAAU+D,GAEf4Q,EAAOuP,YAAY3sB,KAAKoiB,EAAE3H,MAAOza,KAAKoiB,EAAE1H,QACvC0M,IACoB,OAAhBpnB,KAAKoiB,EAAEwK,MAAyC,mBAAjB5sB,KAAKoiB,EAAEwK,KACzC5sB,KAAKoiB,EAAEwK,KAAKxF,EAAGpnB,KAAKoiB,IAGpBgF,EAAEnH,UAAUjgB,KAAKoiB,EAAE4E,OACnBI,EAAE5F,SAAS,EAAG,EAAGxhB,KAAKoiB,EAAE3H,MAAOza,KAAKoiB,EAAE1H,YAGvC+C,IACAzd,KAAK0iC,SAAWjlB,EAChBzd,KAAK2iC,OAAS3iC,KAAK0iC,SAASjoB,MAC5Bza,KAAK4iC,QAAU5iC,KAAK0iC,SAAShoB,OAC7BlO,UChBH,MAAMi5B,GAAgBJ,GAAS3lC,OAC9B,CACAkkC,YAAa,KACb8B,WAAY,EAEZ3lC,OAAQ,SAAU6jC,EAAa8B,EAAYhG,EAASxuB,EAAIC,EAAImS,EAAIC,EAAI9I,EAAM,KAAMC,EAAO,MAEtF1a,KAAK2J,OAAOk6B,SAAS9jC,OAAO,KAAM0a,GAASmpB,EAAYnpB,MAAOC,GAAUkpB,EAAYlpB,QAEpF1a,KAAK4jC,YAAcA,EACnB5jC,KAAK0lC,WAAaA,EAElB1lC,KAAKkR,GAAKA,EACVlR,KAAKmR,GAAKA,EACVnR,KAAK2iC,OAASrf,EACdtjB,KAAK4iC,QAAUrf,EAEfvjB,KAAK0iC,SAAWhD,K,IAIlBiG,GAAeN,GAAS3lC,OACvB,CACA6G,UAAW,cAEXq/B,WAAY,KACZrV,UAAW,EAEX3M,WAAY,EACZC,YAAa,EAEb9jB,OAAQ,SAAUqiB,GAIjB,GAFApiB,KAAK2J,OAAOk6B,SAAS9jC,SAEN,SAAVqiB,EAAEnN,MAA6B,UAAVmN,EAAEnN,KAC3B,MAAM,IAAIzO,MAAO,mCAElB,IAAIq/B,EAASC,EAuCTC,EAASC,EArCb,GAAc,SAAV5jB,EAAEnN,KACN,CACC,KAAKmN,EAAE6jB,OAAOC,YAAgB9jB,EAAE6jB,OAAO1V,WAAcnO,EAAE6jB,OAAOriB,YAAgBxB,EAAE6jB,OAAOE,QACtF,MAAM,IAAI3/B,MAAO4b,EAAEgkB,QAAU,+EAEzBhkB,EAAE6jB,OAAOC,aACb9jB,EAAE6jB,OAAOC,WAAa9jB,EAAE3H,OAEpB2H,EAAE6jB,OAAOpiB,cACbzB,EAAE6jB,OAAOpiB,YAAczB,EAAE1R,KAAKgK,QAE/BmrB,EAAUzjB,EAAE1R,KAAK+J,MAAQ2H,EAAE6jB,OAAOC,WAClCJ,EAAU1jB,EAAE3H,MAAQ2H,EAAE6jB,OAAOC,gBAIxB9jB,EAAE6jB,SAAQ7jB,EAAE6jB,OAAS,IAErB7jB,EAAE6jB,OAAOriB,aACbxB,EAAE6jB,OAAOriB,WAAaxB,EAAE1R,KAAK,GAAG+J,OAE5B2H,EAAE6jB,OAAOpiB,cACbzB,EAAE6jB,OAAOpiB,YAAczB,EAAE1R,KAAK,GAAGgK,QAElCmrB,EAAUzjB,EAAE1R,KAAK,GAAGA,KAAK+J,MAAQ2H,EAAE6jB,OAAOriB,WAC1CkiB,EAAU1jB,EAAE1R,KAAK,GAAG+J,MAAQ2H,EAAE6jB,OAAOriB,WAItC5jB,KAAK4jB,WAAcxB,EAAE6jB,OAAOriB,WAAaiiB,EACzC7lC,KAAK6jB,YAAezB,EAAE6jB,OAAOpiB,YAAcgiB,EAG3C7lC,KAAKya,MAAQ2H,EAAE6jB,OAAOriB,WAAakiB,EACnC9lC,KAAK0a,OAAS0H,EAAE6jB,OAAOpiB,YAAciiB,EAKvB,SAAV1jB,EAAEnN,MAEL8wB,EAAUt/B,IAAI2b,EAAE1R,KAAK+J,MAAQza,KAAK4jB,YAClCoiB,EAAUt+B,KAAK2+B,KAAKjkB,EAAE1R,KAAKgK,OAAS1a,KAAK6jB,aAErCzB,EAAE6jB,OAAOE,OACZnmC,KAAKuwB,UAAYnO,EAAE6jB,OAAOE,OAAOhmC,OAEjCH,KAAKuwB,UAAYnO,EAAE6jB,OAAO1V,WAAcwV,EAAUC,IAInDD,EAAUC,EAAU,EACpBhmC,KAAKuwB,UAAYnO,EAAE1R,KAAKvQ,QAGzBH,KAAKoiB,EAAIA,EACTpiB,KAAKoiB,EAAEmjB,QAAUvlC,KAGjBA,KAAK4lC,WAAa,GAElB,IAAK,IAAI1lC,EAAI,EAAGA,EAAIF,KAAKuwB,UAAWrwB,IACpC,CACC,IAAIomC,EAIHA,EAFGtmC,KAAKoiB,EAAE6jB,OAAOE,OAEH,IAAIV,GAAezlC,KAAME,EAAGF,KAAKoiB,EAAE1R,KAChD1Q,KAAKoiB,EAAE6jB,OAAOE,OAAOjmC,GAAG,GAAG2lC,EAAS7lC,KAAKoiB,EAAE6jB,OAAOE,OAAOjmC,GAAG,GAAG2lC,EAAS7lC,KAAKoiB,EAAE6jB,OAAOE,OAAOjmC,GAAG,GAAG2lC,EAAS7lC,KAAKoiB,EAAE6jB,OAAOE,OAAOjmC,GAAG,GAAG2lC,EACvI7lC,KAAKoiB,EAAE6jB,OAAOE,OAAOjmC,GAAG,GAAG4lC,EAAS9lC,KAAKoiB,EAAE6jB,OAAOE,OAAOjmC,GAAG,GAAG4lC,GAExC,GAAhB9lC,KAAK+lC,QAEC,IAAIN,GAAezlC,KAAME,EAAGF,KAAKoiB,EAAE1R,KAChDxQ,EAAK6lC,EAAW/lC,KAAK4jB,WAAYnd,IAAIvG,EAAI6lC,GAAW/lC,KAAK6jB,YAAa7jB,KAAK4jB,WAAY5jB,KAAK6jB,aAI/E,IAAI4hB,GAAezlC,KAAME,EAAGF,KAAKoiB,EAAE1R,KAAKxQ,GAAGwQ,KACxD,EAAG,EAAG1Q,KAAK4jB,WAAY5jB,KAAK6jB,aAG9B7jB,KAAK4lC,WAAW1lC,GAAKomC,IASvBtC,SAAU,SAAU0B,GAEnB,GAAIA,EAAa,GAAKA,GAAc1lC,KAAKuwB,UACxC,MAAM,IAAI/pB,MAAO,2BAElB,OAAOxG,KAAK4lC,WAAWF,IAOxB/E,WAAY,WAEX,OAAO3gC,KAAKgkC,SAAS,GAAGrD,cAOzBoC,YAAa,WAEZ,OAAO/iC,KAAKgkC,SAAS,MCnJhB,MAAMuC,GAAYlB,GAAS3lC,OACjC,CACA6G,UAAW,YAEXigC,IAAK,KAAMC,MAAO,EAAGC,MAAO,KAC5BC,MAAO,KAEPtY,IAAK,EAAGuY,cAAe,EAAG1gB,KAAM,EAEhCkK,aAAa,EAEbyW,UAAU,EACVC,SAAS,EAETC,iBAAkB,KAClBC,wBAAyB,KACzBC,wBAAyB,KAEzBC,cAAe,KAEfnnC,OAAQ,SAAUonC,EAAMX,EAAKnY,GAE5BruB,KAAK2J,OAAOk6B,SAAS9jC,OAAOonC,EAAKxG,aAAcwG,EAAK1sB,MAAO0sB,EAAKzsB,QAEhE1a,KAAKmnC,KAAOA,EACZnnC,KAAK2mC,MAAQv6B,EAAK1C,KAAK5B,QAEvB9H,KAAKwmC,IAAMA,EACXxmC,KAAKymC,MAAQ,EACbzmC,KAAK0mC,MAAQ,KAEb1mC,KAAKowB,aAAc,EACnBpwB,KAAK6mC,UAAW,EAChB7mC,KAAK8mC,SAAU,EAEf9mC,KAAK+mC,iBAAmB,KACxB/mC,KAAKgnC,wBAA0B,KAC/BhnC,KAAKinC,wBAA0B,KAC/BjnC,KAAKknC,cAAgB,KAErBlnC,KAAKquB,IAAMA,EACXruB,KAAKonC,OAAQpnC,KAAKwmC,IAAInY,KAAOruB,KAAKquB,MAGnCxlB,OAAQ,WAEP7I,KAAK2mC,MAAMj+B,OAEP1I,KAAKgnC,yBACRhnC,KAAKgnC,wBAAwBt+B,OAE1B1I,KAAKinC,yBACRjnC,KAAKinC,wBAAwBv+B,QAG/B0+B,OAAQ,SAAU/Y,GAKjB,OAHAruB,KAAK4mC,cAAgB,EAAMvY,EAC3BruB,KAAKkmB,KAAO,EAELlmB,MAGRg2B,OAAQ,SAAU32B,EAAM,MAEvB,OAAc,OAAVA,EACIW,KAAK8mC,SAEb9mC,KAAK8mC,QAAUznC,EACRW,OAGRqnC,aAAc,SAAU/R,GAGvB,OADAt1B,KAAKkmB,MAAQoP,EACNt1B,MAGRsnC,WAAY,SAAU96B,GAGrB,OADAxM,KAAK+mC,iBAAmBv6B,EACjBxM,MAMRq4B,KAAM,SAAU7rB,EAAUV,EAAQ,MAQjC,OANiB,IAAbU,GAAsBxM,KAAK+mC,mBAAqB/mC,KAAKunC,eAExDvnC,KAAKgnC,wBAAwBh9B,QAC7BhK,KAAKinC,wBAAwBj9B,SAGzBwC,GAEDxM,KAAK+mC,mBAAqB/mC,KAAKunC,eAElCvnC,KAAK+mC,iBAAmB/mC,KAAKunC,aAC7BvnC,KAAKgnC,wBAA0B56B,EAAK1C,KAAK5B,QACzC9H,KAAKinC,wBAA0B76B,EAAK1C,KAAK5B,SAG1C9H,KAAKgnC,wBAAwBr8B,KAAK6B,GAClCxM,KAAKinC,wBAAwBt8B,KAAKmB,GAC3B9L,MAXeA,MAcvBunC,aAAc,WAEb,IAAKvnC,KAAKgnC,wBAAwB7mC,OACjC,OAAO,EAER,IAAI2L,EAAU9L,KAAKinC,wBAAwBx7B,QAC3CzL,KAAKgnC,wBAAwBv7B,OAA7BzL,CAAqCA,KAAM8L,IAG5C0lB,QAAS,SAAU3lB,GAGlB,OADA7L,KAAKknC,cAAgBr7B,EACd7L,MAGRwnC,SAAU,SAAUtnC,GAGnB,OADAF,KAAKymC,MAAQhgC,IAAIvG,GAAKF,KAAKwmC,IAAIj9B,MAAMpJ,OAC9BH,MAGRgkC,SAAU,SAAUyD,GAEnB,OAAsB,IAAfA,EAAuBznC,KAAKymC,OAASzmC,KAAKwmC,IAAIj9B,MAAMpJ,OAAO,GAAMH,KAAKymC,OAG9EiB,UAAW,WAEV,OAAO1nC,KAAKwmC,IAAIj9B,MAAMpJ,QAOvB8iC,MAAO,SAAU7b,EAAGlW,EAAIC,EAAIwxB,EAAQC,EAASM,EAAIC,EAAIC,EAAQC,EAASC,EAAO,KAAMC,EAAQ,MAO1F,GAJKvjC,KAAK8mC,UACT9mC,KAAKkmB,MAAQlmB,KAAKowB,cAAgBtD,EAAOsD,YAAc,EAAItD,EAAOoD,YAG/DlwB,KAAKkmB,KAAO,EAEf,YADAlmB,KAAKowB,YAActD,EAAOsD,aAkB3B,GAbmB,OAAfpwB,KAAK0mC,OAAkB1mC,KAAKowB,cAAgBtD,EAAOsD,cAEtDpwB,KAAKwmC,IAAMxmC,KAAK0mC,MAChB1mC,KAAKymC,MAAQ,EACbzmC,KAAK0mC,MAAQ,KAEb1mC,KAAKkmB,KAAO,EACZlmB,KAAK6mC,UAAW,EAEhB7mC,KAAKonC,OAAQpnC,KAAKwmC,IAAInY,KAAOruB,KAAKquB,MAI/BruB,KAAKkmB,MAAQlmB,KAAK4mC,eAAiB5mC,KAAKowB,cAAgBtD,EAAOsD,cAAgBpwB,KAAK6mC,SACxF,CACC,MAAMnB,EAAa1lC,KAAKymC,MAExBzmC,KAAKkmB,MAAQlmB,KAAK4mC,cAClB5mC,KAAKymC,QAGDzmC,KAAKymC,QAAUzmC,KAAKwmC,IAAIj9B,MAAMpJ,SAG5BH,KAAKwmC,IAAImB,KAWb3nC,KAAKymC,MAAQ,GATbzmC,KAAK6mC,UAAW,EAEZ7mC,KAAK+mC,mBAE4B,IAAhC/mC,KAAK+mC,iBAAiB/mC,QACzBA,KAAK+mC,iBAAmB,OAOvB/mC,KAAK2mC,MAAMxmC,QACdH,KAAK4nC,IAAI5nC,KAAK2mC,MAAMl7B,SAAS,IAI3BzL,KAAKknC,gBAE8D,IAAlElnC,KAAKknC,cAAcxB,EAAY1lC,KAAKwmC,IAAIj9B,MAAMpJ,OAAO,EAAGH,QAC3DA,KAAKknC,cAAgB,MAKxB,IAAItR,EAAI51B,KAAKwmC,IAAIj9B,MAAOvJ,KAAKymC,QAAUzmC,KAAKwmC,IAAIj9B,MAAMpJ,OAASH,KAAKymC,MAAM,EAAIzmC,KAAKymC,OAGnF,IAAK,IAAIvmC,EAAI,EAAGA,EAAI01B,EAAEz1B,OAAQD,IAC9B,CACC,IAAI2nC,EAAQ7nC,KAAKmnC,KAAKnD,SAASpO,EAAE11B,IACjC2nC,EAAM5E,MAAM7b,EAAGygB,EAAM32B,GAAI22B,EAAM12B,GAAI02B,EAAMlF,OAAQkF,EAAMjF,QAASM,EAAIC,EAAIC,EAAQC,EAASC,EAAQC,GAIlGvjC,KAAKowB,YAActD,EAAOsD,aAG3BuQ,WAAY,WAEX,OAAO3gC,KAAKmnC,KAAKxG,cAGlBoC,YAAa,WAEZ,OAAO/iC,MAGR8nC,QAAS,WAER9nC,KAAKg2B,QAAQ,GACbh2B,KAAK4sB,KAAM,KAAM,EAAG,IAGrBmb,gBAAiB,WAEhB,OAAsB,OAAf/nC,KAAK0mC,MAAiB1mC,KAAKwmC,IAAIt9B,KAAOlJ,KAAK0mC,MAAMx9B,MAGzD0+B,IAAK,SAAUI,EAASC,GAAO,GAE9B,QAAIjoC,KAAKwmC,IAAIt9B,OAAS8+B,IAAYhoC,KAAK6mC,WAAuB,IAAXoB,KAGnDjoC,KAAK0mC,MAAQ1mC,KAAKmnC,KAAK9mC,EAAEmmC,IAAIwB,GAC7BhoC,KAAK6mC,UAAW,GAET,IAGRqB,KAAM,SAAUh/B,EAAM++B,GAAO,GAG5B,OADAjoC,KAAK4nC,IAAI1+B,EAAM++B,GACRjoC,MAGRmoC,SAAU,SAAUh/B,GAEnB,IAAKiD,EAAKf,WAAWlC,GACpB,MAAM,IAAI3C,MAAM,mDAEC,MAAdxG,KAAK2mC,OACR3mC,KAAK2mC,MAAM38B,QAAQtB,OAEpB1I,KAAK2mC,MAAQx9B,EACbnJ,KAAK4nC,IAAI5nC,KAAK2mC,MAAMl7B,SAAS,IAG9B28B,QAAS,SAAUJ,EAASK,GAAM,GAEjC,IAAI7B,EAAMxmC,KAAKwmC,IAEX8B,EAAWtoC,KAAK2mC,MAAMxmC,OAAS,EAAIH,KAAK2mC,MAAM3mC,KAAK2mC,MAAMxmC,OAAO,GAAKqmC,EAAIt9B,KAE7E,OAAIs9B,EAAIt9B,OAAS8+B,GAAWxB,EAAImB,KACxB3nC,KAEJsoC,IAAaN,GAAYK,EAGzB7B,EAAImB,MAAQ3nC,KAAK6mC,UAEpB7mC,KAAK4nC,IAAII,GAAS,GACXhoC,OAGRA,KAAK2mC,MAAMh8B,KAAKq9B,GACThoC,MATCA,QAaViG,EAASwD,WAAW88B,I,IAGpBgC,GAAe5C,GAAYjmC,OAC1B,CACA6G,UAAW,uBAEXiiC,gBAAiB,KACjBC,WAAY,KAEZrmB,EAAG,KACH/hB,EAAG,KAEHN,OAAQ,SAAUqiB,GAEjB,IAAKA,EAAE+kB,KAAM,MAAM,IAAI3gC,MAAO,oCAE9BxG,KAAK2J,OAAO++B,YAAY3oC,OAAQqiB,GAEhCpiB,KAAKoiB,EAAIA,EACTpiB,KAAKoiB,EAAEmjB,QAAUvlC,KAEjB,IAAI41B,EAAI51B,KAAKK,EAAIL,KAAKoiB,EAAE+kB,KAExB,GAAIvR,EAAE+S,YAAa,OAMnB,GAJK/S,EAAEgT,MAAKhT,EAAEgT,IAAM,OACfhT,EAAE4Q,MAAK5Q,EAAE4Q,IAAM,KAGf5Q,EAAE4Q,IAAI5Q,EAAEgT,OAAkB,OAAThT,EAAEgT,KAAyB,WAAThT,EAAEgT,KAC1C,CACC,IAAI1V,EAAI,CAAEyU,KAAgB,OAAT/R,EAAEgT,IAA8Br/B,MAAO,IAExD,IAAK,IAAIrJ,EAAI,EAAGA,EAAIF,KAAKuwB,UAAWrwB,IACnCgzB,EAAE3pB,MAAMoB,KAAK,CAACzK,IAGf01B,EAAE4Q,IAAI5Q,EAAEgT,KAAO1V,EAGhB,IAAK0C,EAAE4Q,IAAI5Q,EAAEgT,KACZ,MAAM,IAAIpiC,MAAO,+BAAiCovB,EAAEgT,KAEhDhT,EAAEvH,MAAKuH,EAAEvH,IAAM,IAEpBuH,EAAEgT,IAAMhT,EAAE4Q,IAAI5Q,EAAEgT,KAEhB,IAAIlD,EAAa,EAEjB,IAAK,IAAIxlC,KAAK01B,EAAE4Q,IAOf,GALA5Q,EAAE4Q,IAAItmC,GAAGgJ,KAAOhJ,EAEX01B,EAAE4Q,IAAItmC,GAAGynC,OACb/R,EAAE4Q,IAAItmC,GAAGynC,MAAO,GAEa,iBAAnB/R,EAAE4Q,IAAItmC,GAAGqJ,MACpB,CACC,IAAIlJ,EAAGC,EAAGC,EAEV,IAAmC,GAA/Bq1B,EAAE4Q,IAAItmC,GAAGqJ,MAAMsL,QAAQ,KAC3B,CACCxU,EAAIu1B,EAAE4Q,IAAItmC,GAAGqJ,MAAM+K,MAAM,KACzBshB,EAAE4Q,IAAItmC,GAAGqJ,MAAQ,GAEjB,IAAK,IAAIiI,KAAKnR,EACbu1B,EAAE4Q,IAAItmC,GAAGqJ,MAAMoB,KAAK,CAAClE,IAAIpG,EAAEmR,WAExB,IAAmC,GAA/BokB,EAAE4Q,IAAItmC,GAAGqJ,MAAMsL,QAAQ,KAS/B,GAPAtU,EAAIq1B,EAAE4Q,IAAItmC,GAAGqJ,MAAM+K,MAAM,KAEzBjU,EAAIoG,IAAIlG,EAAE,IACVD,EAAImG,IAAIlG,EAAE,IAEVq1B,EAAE4Q,IAAItmC,GAAGqJ,MAAQ,GAEblJ,EAAIC,EACP,IAAKC,EAAIF,EAAGE,GAAKD,EAAGC,IACnBq1B,EAAE4Q,IAAItmC,GAAGqJ,MAAMoB,KAAK,CAACpK,SAGtB,IAAKA,EAAIF,EAAGE,GAAKD,EAAGC,IACnBq1B,EAAE4Q,IAAItmC,GAAGqJ,MAAMoB,KAAK,CAACpK,SAQvB,IAHAF,EAAIoG,IAAImvB,EAAE4Q,IAAItmC,GAAGqJ,OACjBqsB,EAAE4Q,IAAItmC,GAAGqJ,MAAQ,GAEVlJ,KAAKu1B,EAAE4Q,IAAItmC,GAAGqJ,MAAMoB,KAAK,CAAC+6B,MAGlC9P,EAAE4Q,IAAItmC,GAAGJ,MAAQ81B,EAAE4Q,IAAItmC,GAAGqJ,MAAMpJ,OAIlCy1B,EAAE+S,aAAc,GAGjBE,mBAAoB,SAAUC,EAAW,MAExC,OAAwB,OAApB9oC,KAAKyoC,YAERzoC,KAAKyoC,WAAalC,GAAU78B,KAAK5B,MAAM9H,KAAM8oC,EAAa9oC,KAAKK,EAAEmmC,IAAIsC,GAAc9oC,KAAKK,EAAEuoC,IAAK5oC,KAAKK,EAAEguB,KACtGruB,KAAKyoC,WAAW3/B,cAAa,GAEtB9I,KAAKyoC,YAGNzoC,KAAKyoC,WAAWP,KAAKY,GAA0B9oC,KAAKK,EAAEuoC,IAAI1/B,OAGlE6/B,aAAc,SAAUD,EAAW,KAAMza,EAAI,MAE5C,OAAOkY,GAAU78B,KAAK5B,MAAM9H,KAAM8oC,EAAa9oC,KAAKK,EAAEmmC,IAAIsC,GAAc9oC,KAAKK,EAAEuoC,IAAKva,GAAOruB,KAAKK,EAAEguB,MAGnG2a,YAAa,SAAU9/B,GAEtB,OAAOlJ,KAAKK,EAAEmmC,IAAIt9B,IAGnB65B,YAAa,WAKZ,OAH6B,OAAzB/iC,KAAKwoC,kBACRxoC,KAAKwoC,gBAAkBxoC,KAAK+oC,gBAEtB/oC,KAAKwoC;ACvbdS,GAAexpC,EAAMC,OACpB,CACAK,OAAQ,SAAUqiB,GAEjB,GAAc,SAAVA,EAAEnN,OAAoBmN,EAAEmG,KAC3B,MAAM,IAAI/hB,MAAO,kCAEb4b,EAAEmG,KAAK2d,aACX9jB,EAAEmG,KAAK2d,WAAa9jB,EAAE3H,OAEvB,IAAIorB,EAAUzjB,EAAE1R,KAAK+J,MAAQ2H,EAAEmG,KAAK2d,WAChCJ,EAAU1jB,EAAE3H,MAAQ2H,EAAEmG,KAAK2d,WAE/BlmC,KAAKkpC,YAAe9mB,EAAEmG,KAAK4gB,UAAYtD,EACvC7lC,KAAKopC,aAAgBhnB,EAAEmG,KAAK8gB,WAAaxD,EAEzC7lC,KAAKmpC,UAAa/mB,EAAEmG,KAAK4gB,UAAYrD,EACrC9lC,KAAKqpC,WAAcjnB,EAAEmG,KAAK8gB,WAAavD,EAEvC9lC,KAAKspC,UAAYlnB,EAAEmG,KAAK+gB,UAAY,GAAKxD,EACzC9lC,KAAKupC,UAAYnnB,EAAEmG,KAAKghB,UAAY,GAAKzD,EAEzC9lC,KAAKwpC,UAAYpnB,EAAEmG,KAAKihB,UAAY,GAAK1D,EACzC9lC,KAAKypC,UAAYrnB,EAAEmG,KAAKkhB,UAAY,GAAK3D,EAEzC9lC,KAAK0pC,YAActnB,EAAEmG,KAAKmhB,cAAe,EAEzC,IAAIC,EAAOljC,IAAI2b,EAAEmG,KAAK2d,WAAa9jB,EAAEmG,KAAK4gB,WAE1CnpC,KAAKoiB,EAAIA,EACTpiB,KAAKoiB,EAAEmjB,QAAUvlC,KAEjB,IAAIyH,EAAI2a,EAAEmG,KAAKqhB,QAAQzpC,OACnB05B,EAAI,EACJ1rB,EAAI,EAIR,IAFAnO,KAAK6pC,UAAY,GAEVhQ,EAAIpyB,GACX,CACC,IAAInI,EAAI,EAER,IAAK,IAAIY,EAAI,EAAGA,EAAIypC,GAAQ9P,EAAIpyB,EAAGvH,IACnC,CACC,IAAIK,EAAI6hB,EAAEmG,KAAKqhB,QAAQ/P,KAEvB75B,KAAK6pC,UAAUtpC,GAAK,CAAE8c,QAAQ,EAAO/d,EAAGA,EAAG6O,EAAGA,EAAGg7B,UAAWnpC,KAAKmpC,UAAWD,YAAalpC,KAAKkpC,YAAaM,SAAU,GAErHlqC,GAAKU,KAAKkpC,YAGX/6B,GAAKnO,KAAKopC,aAMX,GAHM,MAAOppC,KAAK6pC,YACjB7pC,KAAK6pC,UAAU,KAAO,CAAExsB,QAAQ,EAAM8rB,UAAW1iC,IAAqC,GAAhCzG,KAAKmpC,UAAYnpC,KAAKspC,UAAY,GAAIJ,YAAalpC,KAAKkpC,YAAaM,SAAU,IAEjIpnB,EAAEmG,KAAKuhB,OAAZ,CAEAriC,EAAI2a,EAAEmG,KAAKuhB,OAAO3pC,OAElB,IAAK,IAAID,EAAI,EAAGA,EAAIuH,EAAGvH,GAAK,EAC5B,CACC,IAAImhB,EAAIe,EAAEmG,KAAKuhB,OAAO5pC,EAAE,GAAK4lC,EACzBrP,EAAIrU,EAAEmG,KAAKuhB,OAAO5pC,GAEJ,iBAAPu2B,IACVA,EAAIsT,OAAOC,aAAavT,IAEzB,IAAK,IAAIjlB,EAAI,EAAGA,EAAIilB,EAAEt2B,OAAQqR,IAEzBilB,EAAEjlB,KAAMxR,KAAK6pC,YAChB7pC,KAAK6pC,UAAUpT,EAAEjlB,IAAIg4B,SAAWnoB,EAAIrhB,KAAK6pC,UAAUpT,EAAEjlB,IAAI23B,cAK7Dc,SAAU,SAAU7iB,EAAG9nB,EAAG6O,EAAG2U,GAE5B,IAAIrb,EAAIqb,EAAK3iB,OAET+pC,GAAK,EAAGlqC,KAAKspC,SAAWtpC,KAAKwpC,SAKjC,GAHAlqC,GAAKU,KAAKspC,SACVn7B,GAAKnO,KAAKupC,SAELvpC,KAAK0pC,YAcV,CACC,IAAK,IAAIxpC,EAAI,EAAGA,EAAIuH,EAAE,EAAGvH,IACzB,CACC,IAAIK,EAAIP,KAAK6pC,UAAU/mB,EAAK5iB,IACvBK,IAELjB,GAAKiB,EAAE4oC,UAAYe,GAGpB,IAAK,IAAI/vB,EAAI1S,EAAE,EAAG0S,GAAK,EAAGA,IAC1B,CACC,IAAI5Z,EAAIP,KAAK6pC,UAAU/mB,EAAK3I,IACvB5Z,IAEAA,EAAE8c,QACN+J,EAAE/D,UAAWrjB,KAAKoiB,EAAE1R,KAAMnQ,EAAEjB,EAAGiB,EAAE4N,EAAG5N,EAAE2oC,YAAalpC,KAAKopC,aAAc9pC,EAAG6O,EAAG5N,EAAE4oC,UAAWnpC,KAAKqpC,WAAY,KAAM,KAAM9oC,EAAE4oC,UAAWnpC,KAAKqpC,YAEzI/pC,GAAKiB,EAAE4oC,UAAYe,EAAK3pC,EAAEipC,gBA7B3B,IAAK,IAAItpC,EAAI,EAAGA,EAAIuH,EAAGvH,IACvB,CACC,IAAIK,EAAIP,KAAK6pC,UAAU/mB,EAAK5iB,IACvBK,IAEAA,EAAE8c,QACN+J,EAAE/D,UAAWrjB,KAAKoiB,EAAE1R,KAAMnQ,EAAEjB,EAAGiB,EAAE4N,EAAG5N,EAAE2oC,YAAalpC,KAAKopC,aAAc9pC,EAAG6O,EAAG5N,EAAE4oC,UAAWnpC,KAAKqpC,WAAY,KAAM,KAAM9oC,EAAE4oC,UAAWnpC,KAAKqpC,YAEzI/pC,GAAKiB,EAAE4oC,UAAYe,EAAK3pC,EAAEipC,YA0B7BW,aAAc,SAAUrnB,GAEvB,IAAIrb,EAAIqb,EAAK3iB,OACTb,EAAI,EAEJ4qC,GAAK,EAAGlqC,KAAKspC,SAAWtpC,KAAKwpC,SAEjC,IAAK,IAAItpC,EAAI,EAAGA,EAAIuH,EAAGvH,IACvB,CACC,IAAIK,EAAIP,KAAK6pC,UAAU/mB,EAAK5iB,IACvBK,IAELjB,GAAKiB,EAAE4oC,UAAYe,EAAK3pC,EAAEipC,UAG3B,OAAOlqC,GAGR8qC,cAAe,SAAUtnB,GAExB,OAAO9iB,KAAKqpC,WAAa,EAAErpC,KAAKupC,SAAWvpC,KAAKypC,YCjJlD,MAAMY,GAAY,GAIlB,IAAIC,IAAW;;;;;kBA4Cfzc;OAAOC,OAAOuc,GACd,CAQCE,uBAAuB,EASvBC,WAAW,EAQXv+B,OAAQ,SASRw+B,UAAU,EAMVxE,OAAQ,SAAU/nB,GAEJ,OAATA,GACH2P,OAAOC,OAAO9tB,KAAMke,IAoBtBwsB,KAAM,SAAUvhC,EAAMwhC,EAAkBC,EAAkBC,EAASjrC,GAElE,IAAKirC,EACL,CACCA,EAAUhd,OAAOid,KAAK3hC,GAEtB,IAAK,IAAIjJ,KAAK2qC,EAEP,aAAc1hC,EAAK0hC,EAAQ3qC,MAChCiJ,EAAK0hC,EAAQ3qC,IAAI6qC,QAAUngC,EAAKF,MAAMvB,EAAK0hC,EAAQ3qC,MAGrDN,EAAQ,EAGT,KAAOA,EAAQirC,EAAQ1qC,QAAW,aAAcgJ,EAAK0hC,EAAQjrC,KAC5DA,IAKD,GAHI+qC,GACHA,EAAkB/qC,EAAOirC,EAAQ1qC,OAAQP,EAAQirC,EAAQ1qC,OAAQP,EAAQirC,EAAQ1qC,OAAS0qC,EAAQjrC,GAAS,MAExGA,GAASirC,EAAQ1qC,OAKpB,YAHIyqC,GACHA,EAAiBzhC,IAKnB,IAGIyU,EAAKotB,EAAIC,EAAIC,EAAIC,EAHjB/oB,EAAIjZ,EAAK0hC,EAAQjrC,IAKrB,OAJAwiB,EAAEgkB,QAAUyE,EAAQjrC,GAIZwiB,EAAEnN,MAET,IAAK,QACJmN,EAAE1R,KAAO,IAAIgN,MACb0E,EAAE1R,KAAKiN,OAASytB,iBAEf,MAAMC,EAAQjpB,EAAE1R,KAAK+J,MAAQ2H,EAAE1R,KAAKgK,OAEhC0H,EAAE3U,QACL2U,EAAE3H,MAAQhU,IAAI2b,EAAE1R,KAAK+J,MAAM2H,EAAE3U,OAC7B2U,EAAE1H,OAASjU,IAAI2b,EAAE1R,KAAKgK,OAAO0H,EAAE3U,QAG3B2U,EAAElO,eAAe,gBACrBkO,EAAEkpB,WAAa,GAEXlpB,EAAE3H,OAAU2H,EAAE1H,OAKV0H,EAAE3H,QAAU2H,EAAE1H,OAEtB0H,EAAE1H,OAASjU,IAAI2b,EAAE3H,MAAQ4wB,IAEhBjpB,EAAE3H,OAAS2H,EAAE1H,SAEtB0H,EAAE3H,MAAQhU,IAAI4kC,EAAQjpB,EAAE1H,UATxB0H,EAAE3H,MAAQ2H,EAAE1R,KAAK+J,MACjB2H,EAAE1H,OAAS0H,EAAE1R,KAAKgK,QAed0H,EAAElO,eAAe,YACrBkO,EAAEnW,OAAUmW,EAAElO,eAAe,eAAmD,IAAhBkO,EAAEooB,UAAqB,UAA3CH,GAAUp+B,QAElDmW,EAAElO,eAAe,eACrBkO,EAAEooB,UAAYH,GAAUG,WAEpBpoB,EAAElO,eAAe,cACrBkO,EAAEqoB,SAAWJ,GAAUI,UAEnBroB,EAAE1R,KAAK+J,OAAS2H,EAAE3H,OAAS2H,EAAE1R,KAAKgK,QAAU0H,EAAE1H,QAA0B,GAAhB0H,EAAEkpB,aAAqC,IAAflpB,EAAEqoB,WAGtFroB,EAAE1R,WAAa25B,GAAUkB,YAAanpB,EAAGA,EAAE3H,OAAS2H,EAAEkpB,YAAclpB,EAAEooB,UAAY1d,EAAO+H,mBAAqB/H,EAAOoC,cAAe9M,EAAE1H,QAAU0H,EAAEkpB,YAAclpB,EAAEooB,UAAY1d,EAAO+H,mBAAqB/H,EAAOoC,cAAe9M,EAAEooB,WAAW,IAI9OpoB,EAAEvH,OAASuH,EAAE1R,KAAK+J,MAAQ2H,EAAE3H,MAE5B2H,EAAE1R,KAAKmK,OAASuH,EAAEvH,OAClBuH,EAAE1R,KAAKzE,OAASmW,EAAEnW,OAClBmW,EAAE1R,KAAKiK,YAAcyH,EAAE3H,MACvB2H,EAAE1R,KAAKkK,aAAewH,EAAE1H,OAEpB0H,EAAElO,eAAe,WAAakO,EAAErH,OAAS,IAC5CqH,EAAE1R,KAAKqK,OAASqH,EAAErH,QAGnB+R,EAAOwC,kBAAkBjM,UAAUjB,EAAE1R,KAAM,EAAG,GAC9Coc,EAAOE,SAASrG,aAAavE,EAAE1R,MAE/B25B,GAAUmB,SAAUriC,EAAM0hC,EAAQjrC,IAAQ,KACzCyqC,GAAUK,KAAMvhC,EAAMwhC,EAAkBC,EAAkBC,EAASjrC,EAAM,OAI3EwiB,EAAE1R,KAAKwnB,QAAU,WAChBvvB,QAAQC,MAAO,0BAA4BwZ,EAAEgkB,UAG9ChkB,EAAE1R,KAAKkN,IAAMwE,EAAExE,IAAM,MAAQlW,KAAK8kB,SAClC,MAED,IAAK,SAMJ,GALA5O,EAAMwE,EAAExE,IACRotB,EAAKptB,EAAI/I,QAAQ,KACjBo2B,EAAKrtB,EAAI6tB,YAAY,KACrBP,EAAKD,EAAKD,EAAK,GAEL,GAANA,EAGH,YADAriC,QAAQC,MAAO,mBAAqBwZ,EAAEgkB,QAAU,gEAIjD,IAAKhkB,EAAEtiB,MAGN,YADA6I,QAAQC,MAAO,mBAAqBwZ,EAAEgkB,QAAU,iDAIjDhkB,EAAEspB,GAAK,EACPtpB,EAAE1R,KAAO,GAETy6B,EAAK,WAEJ,GAAI/oB,EAAEspB,IAAMtpB,EAAEtiB,MAMb,YAJAuqC,GAAUmB,SAAUriC,EAAM0hC,EAAQjrC,IAAQ,KACzCyqC,GAAUK,KAAMvhC,EAAMwhC,EAAkBC,EAAkBC,EAASjrC,EAAQ,MAO7E,IAAIo0B,EAAM,CAAE/e,KAAM,QAASwF,MAAO2H,EAAE3H,MAAOC,OAAQ0H,EAAE1H,OAAQjN,MAAO2U,EAAE3U,OAEtEumB,EAAIpW,IAAMwE,EAAExE,IAAIuJ,OAAO,EAAG6jB,IAAQ5oB,EAAEspB,KAAQhkC,KAAKq2B,IAAI,GAAGmN,IAAK5hC,QAAQ4hC,GAAI/jB,OAAO,GAAK/E,EAAExE,IAAIuJ,OAAO8jB,EAAG,GACrGjX,EAAItjB,KAAO,IAAIgN,MACfsW,EAAIoS,QAAUhkB,EAAEgkB,QAAU,KAAOhkB,EAAEspB,GAAK,GAEpCf,GACHA,EAAkB/qC,EAAOirC,EAAQ1qC,OAAQP,EAASirC,EAAQ1qC,QAAYiiB,EAAEspB,GAAG,GAAGtpB,EAAEtiB,OAAQ,EAAI+qC,EAAQ1qC,QAASiiB,EAAEgkB,QAAU,KAAOhkB,EAAEspB,GAAG,IAEtI1X,EAAItjB,KAAKiN,OAASytB,iBAEjB,IAAIC,EAAQrX,EAAItjB,KAAK+J,MAAQuZ,EAAItjB,KAAKgK,OAElCsZ,EAAIvmB,QAEPumB,EAAIvZ,MAAQhU,IAAIutB,EAAItjB,KAAK+J,MAAMuZ,EAAIvmB,OACnCumB,EAAItZ,OAASjU,IAAIutB,EAAItjB,KAAKgK,OAAOsZ,EAAIvmB,QAGjCumB,EAAIvZ,OAAUuZ,EAAItZ,OAKdsZ,EAAIvZ,QAAUuZ,EAAItZ,OAE1BsZ,EAAItZ,OAASjU,IAAIutB,EAAIvZ,MAAQ4wB,IAEpBrX,EAAIvZ,OAASuZ,EAAItZ,SAE1BsZ,EAAIvZ,MAAQhU,IAAI4kC,EAAQrX,EAAItZ,UAT5BsZ,EAAIvZ,MAAQuZ,EAAItjB,KAAK+J,MACrBuZ,EAAItZ,OAASsZ,EAAItjB,KAAKgK,QAWX,GAAR0H,EAAEspB,KAELtpB,EAAEupB,OAAS3X,EAAItjB,KAAK+J,MACpB2H,EAAEwpB,QAAU5X,EAAItjB,KAAKgK,OAEhB0H,EAAElO,eAAe,YACrBkO,EAAEnW,OAAUmW,EAAElO,eAAe,eAAmD,IAAhBkO,EAAEooB,UAAqB,UAA3CH,GAAUp+B,QAElDmW,EAAElO,eAAe,eACrBkO,EAAEooB,UAAYH,GAAUG,WAEpBpoB,EAAElO,eAAe,cACrBkO,EAAEqoB,SAAWJ,GAAUI,WAGzBzW,EAAIwW,UAAYpoB,EAAEooB,UAClBxW,EAAI/nB,OAASmW,EAAEnW,OACf+nB,EAAIyW,SAAWroB,EAAEqoB,SAEZzW,EAAItjB,KAAK+J,OAASuZ,EAAIvZ,OAASuZ,EAAItjB,KAAKgK,QAAUsZ,EAAItZ,SAA4B,IAAjBsZ,EAAIyW,WAGzEzW,EAAItjB,WAAa25B,GAAUkB,YAAavX,EAAKA,EAAIvZ,OAAS2H,EAAEooB,UAAY1d,EAAO+H,mBAAqB/H,EAAOoC,aAAc8E,EAAItZ,QAAUsZ,EAAIwW,UAAY1d,EAAO+H,mBAAqB/H,EAAOoC,aAAc8E,EAAIwW,WAAW,IAIxNxW,EAAInZ,OAASmZ,EAAItjB,KAAK+J,MAAQuZ,EAAIvZ,MAElCuZ,EAAItjB,KAAKmK,OAASmZ,EAAInZ,OACtBmZ,EAAItjB,KAAKzE,OAAS+nB,EAAI/nB,OACtB+nB,EAAItjB,KAAKiK,YAAcqZ,EAAIvZ,MAC3BuZ,EAAItjB,KAAKkK,aAAeoZ,EAAItZ,OAExB0H,EAAElO,eAAe,WAAakO,EAAErH,OAAS,IAC5CiZ,EAAItjB,KAAKqK,OAASqH,EAAErH,QAET,GAARqH,EAAEspB,KAELtpB,EAAE3H,MAAQuZ,EAAIvZ,MACd2H,EAAE1H,OAASsZ,EAAItZ,OACf0H,EAAEvH,OAASmZ,EAAInZ,QAGhBiS,EAAOwC,kBAAkBjM,UAAU2Q,EAAItjB,KAAM,EAAG,GAChDoc,EAAOE,SAASrG,aAAaqN,EAAItjB,MAEjC0R,EAAE1R,KAAK/F,KAAKqpB,GACZmX,KAGDnX,EAAItjB,KAAKwnB,QAAU,WAClBvvB,QAAQC,MAAM,0BAA4BorB,EAAIoS,UAG/CpS,EAAItjB,KAAKkN,IAAMoW,EAAIpW,IAAM,MAAQlW,KAAK8kB,UAGvC2e,IACA,MAED,IAAK,QAGJ,GAFK/oB,EAAEypB,QAAOzpB,EAAEypB,MAAQ,OAEpB9lC,EAAO+lC,SAAW/lC,EAAO+lC,QAAQC,aAA0B,OAAX3pB,EAAEypB,MACtD,CACMvB,KACJjrB,EAAIC,MAAM,sBACVgrB,IAAW,GAGZloB,EAAE4pB,OAASC,EAASC,MAAMC,mBAC1B/pB,EAAE1R,KAAO,OAAS9Q,EAElBmG,EAAO+lC,QAAQC,YAAYK,cAAchqB,EAAE1R,KAAM0R,EAAExE,KAClD,WACCysB,GAAUmB,SAAUriC,EAAM0hC,EAAQjrC,IAAQ,KACzCyqC,GAAUK,KAAMvhC,EAAMwhC,EAAkBC,EAAkBC,EAASjrC,EAAQ,SAG7E,SAAS+gB,GACRhY,QAAQC,MAAM,gCAAkCwZ,EAAEgkB,QAAU,KAAOzlB,MAIrE,MAGD,GAAI5a,EAAOqxB,aACX,CACMkT,KACJjrB,EAAIC,MAAM,mBACVgrB,IAAW,GAGZloB,EAAE4pB,OAASC,EAASC,MAAMG,gBAE1BjU,iBAAkBhW,EAAExE,IAAM,MAAQlW,KAAK8kB,UACtC6L,MAAMG,IACNpW,EAAE1R,KAAO8nB,EACT6R,GAAUmB,SAAUriC,EAAM0hC,EAAQjrC,IAAQ,KACzCyqC,GAAUK,KAAMvhC,EAAMwhC,EAAkBC,EAAkBC,EAASjrC,EAAQ,SAG5E64B,OAAOC,IACP/vB,QAAQC,MAAM,0BAA4BwZ,EAAEgkB,QAAU,KAAO1N,MAG9D,MAGI4R,KACJjrB,EAAIC,MAAM,gBACVgrB,IAAW,GAGZloB,EAAE1R,KAAO,IAAI47B,MACblqB,EAAE4pB,OAASC,EAASC,MAAMK,aAE1BnqB,EAAE1R,KAAK87B,iBAAmB,WAEzBnC,GAAUmB,SAAUriC,EAAM0hC,EAAQjrC,IAAS,KAC1CyqC,GAAUK,KAAMvhC,EAAMwhC,EAAkBC,EAAkBC,EAASjrC,EAAQ,OAI7EwiB,EAAE1R,KAAKwnB,QAAU,WAEhBvvB,QAAQC,MAAM,0BAA4BwZ,EAAEgkB,UAG7ChkB,EAAE1R,KAAKkN,IAAMwE,EAAExE,IAAM,MAAQlW,KAAK8kB,SAClC,MAED,IAAK,SAMJ,GALA5O,EAAMwE,EAAExE,IACRotB,EAAKptB,EAAI/I,QAAQ,KACjBo2B,EAAKrtB,EAAI6tB,YAAY,KACrBP,EAAKD,EAAKD,EAAK,GAEL,GAANA,EAGH,YADAriC,QAAQC,MAAO,mBAAqBwZ,EAAEgkB,QAAU,gEAIjD,IAAKhkB,EAAEtiB,MAGN,YADA6I,QAAQC,MAAO,mBAAqBwZ,EAAEgkB,QAAU,iDAIjDhkB,EAAEspB,GAAK,EACPtpB,EAAE1R,KAAO,GAETy6B,EAAK,WAEJ,GAAI/oB,EAAEspB,IAAMtpB,EAAEtiB,MAKb,YAHAuqC,GAAUmB,SAAUriC,EAAM0hC,EAAQjrC,IAAQ,KACzCyqC,GAAUK,KAAMvhC,EAAMwhC,EAAkBC,EAAkBC,EAASjrC,EAAQ,MAK7E,IAAIo0B,EAAM,CAAE/e,KAAM,QAAS42B,MAAOzpB,EAAEypB,OAOpC,OALA7X,EAAIpW,IAAMwE,EAAExE,IAAIuJ,OAAO,EAAG6jB,IAAQ5oB,EAAEspB,KAAQhkC,KAAKq2B,IAAI,GAAGmN,IAAK5hC,QAAQ4hC,GAAI/jB,OAAO,GAAK/E,EAAExE,IAAIuJ,OAAO8jB,EAAG,GACrGjX,EAAIoS,QAAUhkB,EAAEgkB,QAAU,KAAOhkB,EAAEspB,GAAK,GAEnC1X,EAAI6X,QAAO7X,EAAI6X,MAAQ,OAExB9lC,EAAO+lC,SAAW/lC,EAAO+lC,QAAQC,aAA4B,OAAb/X,EAAI6X,OAEvD7X,EAAIgY,OAASC,EAASC,MAAMC,mBAC5BnY,EAAItjB,KAAO,OAAS9Q,EAAQ,IAAMwiB,EAAEspB,QAEpC3lC,EAAO+lC,QAAQC,YAAYK,cAAcpY,EAAItjB,KAAMsjB,EAAIpW,KACtD,WACCwE,EAAE1R,KAAK/F,KAAKqpB,GACZmX,OAED,SAASxqB,GACRhY,QAAQC,MAAM,gCAAkCorB,EAAIoS,QAAU,KAAOzlB,OAOpE5a,EAAOqxB,cAEVpD,EAAIgY,OAASC,EAASC,MAAMG,qBAE5BjU,iBAAkBpE,EAAIpW,IAAM,MAAQlW,KAAK8kB,UACxC6L,MAAMG,IACNxE,EAAItjB,KAAO8nB,EACXpW,EAAE1R,KAAK/F,KAAKqpB,GACZmX,OAEA1S,OAAOC,IACP/vB,QAAQC,MAAM,0BAA4BorB,EAAIoS,QAAU,KAAO1N,QAMjE1E,EAAItjB,KAAO,IAAI47B,MACftY,EAAIgY,OAASC,EAASC,MAAMK,aAE5BvY,EAAItjB,KAAK87B,iBAAmB,WAE3BpqB,EAAE1R,KAAK/F,KAAKqpB,GACZmX,KAGDnX,EAAItjB,KAAKwnB,QAAU,WAElBvvB,QAAQC,MAAM,0BAA4BorB,EAAIoS,eAG/CpS,EAAItjB,KAAKkN,IAAMoW,EAAIpW,IAAM,MAAQlW,KAAK8kB,YAGvC2e,IACA,MAED,IAAK,OAEJ1T,OAAQrV,EAAExE,IAAM,MAAQlW,KAAK8kB,SAAU,CAAEqL,aAAc,SAAUQ,MAAK,SAASoU,GAE9ErqB,EAAE1R,KAAO+7B,EAETpC,GAAUmB,SAAUriC,EAAM0hC,EAAQjrC,IAAQ,KACzCyqC,GAAUK,KAAMvhC,EAAMwhC,EAAkBC,EAAkBC,EAASjrC,EAAQ,SAG5E64B,OAAM,SAASC,GAEf/vB,QAAQC,MAAM,0BAA4BwZ,EAAEgkB,QAAU,KAAO1N,MAG9D,MAED,IAAK,OAEJjB,OAAQrV,EAAExE,IAAM,MAAQlW,KAAK8kB,UAAU6L,MAAK,SAASqU,GAEpDtqB,EAAE1R,KAAOg8B,EAETrC,GAAUmB,SAAUriC,EAAM0hC,EAAQjrC,IAAQ,KACzCyqC,GAAUK,KAAMvhC,EAAMwhC,EAAkBC,EAAkBC,EAASjrC,EAAQ,SAG5E64B,OAAM,SAASC,GAEf/vB,QAAQC,MAAM,0BAA4BwZ,EAAEgkB,QAAU,KAAO1N,MAG9D,MAED,IAAK,OAEJjB,OAAQrV,EAAExE,IAAM,MAAQlW,KAAK8kB,UAAU6L,MAAK,SAASC,GAEpDlW,EAAE1R,KAAOq5B,OAAOC,aAAa2C,MAAM,KAAM,IAAIC,WAAWtU,IAExD+R,GAAUmB,SAAUriC,EAAM0hC,EAAQjrC,IAAQ,KACzCyqC,GAAUK,KAAMvhC,EAAMwhC,EAAkBC,EAAkBC,EAASjrC,EAAQ,SAG5E64B,OAAM,SAASC,GAEf/vB,QAAQC,MAAM,0BAA4BwZ,EAAEgkB,QAAU,KAAO1N,MAG9D,MAED,IAAK,SACJtW,EAAE1R,KAAO,GAET25B,GAAUmB,SAAUriC,EAAM0hC,EAAQjrC,IAAQ,KACzCyqC,GAAUK,KAAMvhC,EAAMwhC,EAAkBC,EAAkBC,EAASjrC,EAAQ,QAU/EitC,OAAQ,SAAU1jC,GAEjB,MAAM,IAAI3C,MAAM,wBAoDjBglC,SAAU,SAAUriC,EAAMvJ,EAAO4M,GAEhC,IAAI4V,EAAIjZ,EAAKvJ,GACRwiB,EAAEmjB,SAAanjB,EAAEmjB,WAAW0G,GAMjC9iC,EAAKvJ,GAAS,IAAIqsC,EAAS7pB,EAAEmjB,SAAUnjB,GAEnC,SAAUjZ,EAAKvJ,GAElBuJ,EAAKvJ,GAAO6I,MAAK,KAChBU,EAAKvJ,GAAOktC,UAAW,EACvBtgC,QAIDrD,EAAKvJ,GAAOktC,UAAW,EACvBtgC,MAfAA,KAuBFugC,UAAW,SAAUhgB,GAEpB,OAAO,IAAI2K,SAAQ,CAACC,EAASC,KAC5B,MAAMhb,EAAQ,IAAIc,MAClBd,EAAMe,OAAS,IAAMga,EAAQ/a,GAC7BA,EAAMsb,QAAU,IAAMN,EAAO,IAAIpxB,MAAM,yBACvCoW,EAAMgB,IAAMmP,MAQdwe,YAAaH,eAAgBxuB,EAAO4G,EAAIC,EAAI+mB,EAAWwC,GAEtD,IAAI1pB,EAAK1G,EAAMlM,KAAK+J,MAChB8I,EAAK3G,EAAMlM,KAAKgK,OAKpB,GAHA8I,EAAK/c,IAAI+c,GACTC,EAAKhd,IAAIgd,GAELH,GAAME,GAAMD,GAAME,EACrB,OAAO7G,EAAMlM,KAId,IAFK1Q,KAAKuqC,uBAAyBC,IAAWA,EAAY,MAErDA,EAmCL,CACC,GAAI/jC,IAAI+c,EAAKF,GAAM,EACnB,CACC,IAAI+nB,EAAQ5kC,IAAI+c,EAAMF,EAAM,IAKxB2pB,GAHJzpB,EAAK6nB,EAAQ/nB,GAGIA,EACb4pB,GAHJzpB,EAAK4nB,EAAQ9nB,GAGIA,EAEb4pB,EAAS,IAAI/vB,EAAQ,CAAEC,QAAQ,EAAMC,WAAW,IAAS4C,OAAQsD,EAAIC,GAErE2pB,EAAO,IAAIhwB,EAAQ,CAAEC,QAAQ,EAAMC,WAAW,IAAS4C,OAAQoD,EAAIC,GACvE6pB,EAAK/pB,UAAWzG,EAAMlM,KAAM,EAAG,GAE/B,IAAK,IAAIc,EAAI,EAAGA,EAAI+R,EAAI/R,IACxB,CACC,IAAIilB,EAAI2W,EAAKjqB,aAAa,EAAG3R,EAAG8R,EAAI,GAAG5S,KACnC28B,EAAK,EAET,IAAK,IAAIntC,EAAI,EAAGA,EAAIojB,GAAM+pB,EAAK5W,EAAEt2B,OAAQD,IAAKmtC,GAAM,EAEnDF,EAAOltB,UAAU,QAAQwW,EAAE4W,GAAI,IAAI5W,EAAE4W,EAAG,GAAG,IAAI5W,EAAE4W,EAAG,GAAG,IAAK5W,EAAE4W,EAAG,GAAK,IAAK,KAC3EF,EAAO3rB,SAASthB,EAAE+sC,EAAOz7B,EAAE07B,EAAOD,EAAOC,GAM3C,OAFAE,EAAKtiC,gBAEQ9K,KAAK+sC,UAAUI,EAAOtvB,aAGpC,OAAO7d,KAAKurC,YAAa3uB,EAAO4G,EAAIC,EAAI,KAAMupB,GAnE/C,CAGC,IAAII,EAAO,IAAIhwB,EAAQ,CAAEC,QAAQ,EAAMC,UAFvCktB,EAA0B,OAAdA,IAEmDtqB,OAAQoD,EAAIC,GAG3E,IAFA6pB,EAAK/pB,UAAWzG,EAAMlM,KAAM,EAAG,KAG/B,CACC,IAAI48B,EAAKhqB,GAAM,EACXiqB,EAAKhqB,GAAM,EAEf,GAAI+pB,GAAM9pB,GAAM+pB,GAAM9pB,EACrB,MAED,IAAI0pB,EAAS,IAAI/vB,EAAQ,CAAEC,QAAQ,EAAMC,UAAWktB,IAAatqB,OAAQotB,EAAIC,GAC7EJ,EAAO9pB,UAAW+pB,EAAKjvB,KAAM,EAAG,EAAGmvB,EAAIC,GACvCH,EAAKtiC,UAELwY,EAAKgqB,EACL/pB,EAAKgqB,EAELH,EAAOD,EAGR,IAAIA,EAAS,IAAI/vB,EAAQ,CAAEC,QAAQ,EAAMC,UAAWktB,IAAatqB,OAAQsD,EAAIC,GAO7E,OANA0pB,EAAO9pB,UAAW+pB,EAAKjvB,KAAM,EAAG,EAAGqF,EAAIC,GACvC2pB,EAAKtiC,UAEDkiC,GACHliC,QAAS8R,EAAMlM,YAEH1Q,KAAK+sC,UAAUI,EAAOtvB,eA4CrC2vB,cAAe,SAAU5wB,GAExB,IAAIwwB,EAAO,IAAIhwB,EAAQ,CAAEC,QAAQ,IAAQ6C,OAAQtD,EAAMlM,KAAK+J,MAAOmC,EAAMlM,KAAKgK,QAM9E,OAJA0yB,EAAKv+B,UAAU+N,EAAMlM,KAAK+J,MAAO,GACjC2yB,EAAK3/B,OAAM,EAAI,GAEf2/B,EAAK/pB,UAAWzG,EAAMlM,KAAM,EAAG,GACxB08B,EAAKjvB,MAObsvB,cAAe,SAAU7wB,GAExB,IAAIwwB,EAAO,IAAIhwB,EAAQ,CAAEC,QAAQ,IAAQ6C,OAAQtD,EAAMlM,KAAK+J,MAAOmC,EAAMlM,KAAKgK,QAM9E,OAJA0yB,EAAKv+B,UAAU,EAAG+N,EAAMlM,KAAKgK,QAC7B0yB,EAAK3/B,MAAM,GAAG,GAEd2/B,EAAK/pB,UAAWzG,EAAMlM,KAAM,EAAG,GACxB08B,EAAKjvB,MAObuvB,aAAc,SAAUC,EAAUC,GAEjC,IAAIl2B,EAAO6G,SAASE,cAAc,KAClC/G,EAAKm2B,KAAOD,EAEZl2B,EAAKkH,MAAMkvB,QAAU,OACrBp2B,EAAKq2B,SAAWJ,EAChBj2B,EAAK9G,OAAS,SAEd2N,SAASG,KAAKC,YAAYjH,GAC1BA,EAAKs2B,QACLzvB,SAASG,KAAKqI,YAAYrP,IAO3Bu2B,eAAgB,SAAUC,EAAeC,EAAQ3hC,GAEhD,IAAI4hC,EAAQ7vB,SAASE,cAAc,SAEnC2vB,EAAMn5B,KAAO,OACbm5B,EAAMD,OAASA,EACfC,EAAMxvB,MAAMkvB,QAAU,OACtBM,EAAMC,SAAWH,EAEjB3vB,SAASG,KAAKC,YAAYyvB,GAE1BA,EAAME,SAAW,WAEhB9hC,EAAS4hC,EAAMG,QAGhBhwB,SAASG,KAAK8vB,QAAU,WAEvBjwB,SAASG,KAAK8vB,QAAU,KACxBjwB,SAASG,KAAKqI,YAAYqnB,IAG3BA,EAAMJ,SAOPS,cAAe,SAAUC,EAAMliC,GAE9B,IAAImiC,EAAS,IAAIC,WAEjBD,EAAOhxB,OAAS,SAASgD,GACxBnU,EAAUmU,EAAE/P,OAAOowB,SAGpB2N,EAAOE,cAAcH,IAOtBI,WAAY,SAAUJ,EAAMliC,GAE3B,IAAImiC,EAAS,IAAIC,WAEjBD,EAAOhxB,OAAS,SAASgD,GACxBnU,EAAUmU,EAAE/P,OAAOowB,SAGpB2N,EAAOI,WAAWL,IAOnBM,kBAAmB,SAAUN,EAAMliC,GAElC,IAAImiC,EAAS,IAAIC,WAEjBD,EAAOhxB,OAAS,SAASgD,GACxBnU,EAAUmU,EAAE/P,OAAOowB,SAGpB2N,EAAOM,kBAAkBP,IAO1BQ,iBAAkB,SAAUC,EAAU3iC,GAErC,IAAIw0B,EAAS,GAEb,IAAKmO,IAAaA,EAAShvC,OAG1B,YADAqM,EAASw0B,GAIV,IAAIoO,EAAW,SAAUlvC,GAEpBA,GAAKivC,EAAShvC,OAMlBkqC,GAAUoE,cAAeU,EAASjvC,IAAI,SAAS6sB,GAC9CiU,EAAOr2B,KAAK,CAAEzB,KAAMimC,EAASjvC,GAAGgJ,KAAMqO,KAAM43B,EAASjvC,GAAGqX,KAAMwV,IAAKA,IACnEqiB,EAASlvC,EAAE,MANXsM,EAASw0B,IAUXoO,EAAS,M;AAMXC,GAAehF;yBCp5Bf;MAAMiF,GAAQ7vC,EAAMC,OACnB,CACA0iB,EAAG,KAEHriB,OAAQ,SAAUqiB,GAEjB,GAAc,SAAVA,EAAEnN,KACL,MAAM,IAAIzO,MAAO,0BAElBxG,KAAKoiB,EAAIA,EACTpiB,KAAKoiB,EAAEmjB,QAAUvlC,KAEjBA,KAAK6rC,MAAQyD,GAAMtvC,KAAKoiB,EAAEypB,MAAM0D,gBAGjCrH,KAAM,SAAU17B,EAAUgjC,GAEzB,OAAOF,GAAMpH,KAAMloC,KAAMwM,EAAUgjC,IAGpCC,SAAU,SAAUjjC,EAAUgjC,GAE7B,OAAOF,GAAMG,SAAUzvC,KAAMwM,EAAUgjC,MAIzCF,GAAM/C,aAAe,EACrB+C,GAAMjD,gBAAkB,EACxBiD,GAAMnD,mBAAqB,EAE3Bte,OAAOC,OAAOwhB,GACd,CACCI,OAAQ,CACP3Z,SAAS,EACTyZ,OAAQ,GAGTG,IAAK,CACJ5Z,SAAS,EACTyZ,OAAQ,GAGTI,MAAO,CACN7Z,SAAS,EACTyZ,OAAQ,IAGTK,MAAO,CACN9Z,SAAS,EACTyZ,OAAQ,GAGTM,cAAe,IAEfC,KAAM,GACN71B,OAAQ,GAER81B,SAAU,SAAUC,GAEfA,EAAKC,aAETD,EAAKC,YAAa,EAClBlwC,KAAKka,OAAOvP,KAAKslC,KAGlBE,WAAY,SAAUF,GAErB,GAAKA,EAAKC,WAAV,CAEAD,EAAKC,YAAa,EAElB,IAAIhwC,EAAIovC,GAAMp1B,OAAOrF,QAAQo7B,IACpB,GAAL/vC,GAEJovC,GAAMp1B,OAAOwS,OAAOxsB,EAAG,KAGxBkwC,WAAY,SAAUH,EAAMI,GAE3B,OAAQJ,EAAKK,IAAIluB,EAAE4pB,QAElB,KAAKsD,GAAMjD,gBACV,OAAOrsC,KAAKuwC,oBAAoBN,EAAMI,GAEvC,KAAKf,GAAMnD,mBACV,OAAOnsC,KAAKwwC,uBAAuBP,EAAMI,GAG3C,OAAOrwC,KAAKywC,iBAAiBR,EAAMI,IAIpCK,eAAgB,SAAUT,GAEzBA,EAAKU,SAAWvZ,aAAawZ,aAC7BX,EAAKU,SAASE,KAAKxxC,MAAQ,EAC3B4wC,EAAKU,SAASG,QAAQ1Z,aAAa2Z,aAEnCd,EAAKe,IAAM5Z,aAAa6Z,qBACxBhB,EAAKe,IAAIE,OAASjB,EAAKK,IAAIluB,EAAE1R,KAC7Bu/B,EAAKe,IAAIrJ,MAAO,EAChBsI,EAAKe,IAAIF,QAAQb,EAAKU,UACtBV,EAAKe,IAAIf,KAAOA,GAGjBkB,cAAe,SAAUlB,GAEnBA,EAAKe,MAEVf,EAAKU,SAASS,aAEdnB,EAAKe,IAAM,KACXf,EAAKU,SAAW,OAIjBU,kBAAmB,SAAUpB,GAE5BA,EAAKe,KAAM,GAGZM,iBAAkB,SAAUrB,GAE3BA,EAAKe,KAAM,GAIZO,YAAa,SAAUtB,GAQtB,OANKjwC,KAAK+vC,KAAK5vC,OAGd0H,KAAO7H,KAAK+vC,KAAKrkC,MAFjB7D,KAAOooC,EAAKuB,YAIb3pC,KAAK4pC,KAAOxB,EAAKryB,IACV/V,MAGR6pC,WAAY,SAAUzB,GAEjBjwC,KAAK+vC,KAAK5vC,QAAUH,KAAK8vC,eAM7B9vC,KAAK+vC,KAAKplC,KAAKslC,IAIhBM,oBAAqB,SAAUN,EAAMI,GAEpC,IAAKJ,EAAM,OAAO,KAElB,IAAIT,EAASF,GAAMI,OAAOF,OAASS,EAAKK,IAAIzE,MAAM2D,OAASS,EAAKT,OAEhE,OAAQa,GAGP,IAAK,OACJ,GAAIJ,EAAK0B,QAAS,MAEb1B,EAAKe,KACT1B,GAAMoB,eAAeT,GAEtBA,EAAK2B,SAAWxkC,QAChB6iC,EAAK0B,SAAU,EACf1B,EAAKpc,OAAQ,EAEboc,EAAKe,IAAIa,QAAUvC,GAAMwC,iBACzB7B,EAAKU,SAASE,KAAKxxC,MAAQmwC,EAE3B,IACCS,EAAKe,IAAIzjC,MAAM,EAAG0iC,EAAKtjC,UAAU,KAElC,MAAOgU,GAEN,OADA2uB,GAAM6B,cAAclB,GACb,KAGRX,GAAMU,SAASC,GACf,MAGD,IAAK,YACJ,IAAKA,EAAKe,IAAK,MAEff,EAAKU,SAASE,KAAKxxC,MAAQmwC,EAC3B,MAGD,IAAK,OACJ,IAAKS,EAAK0B,SAAW1B,EAAKja,OAC1B,CACCia,EAAKtjC,UAAY,EACjBsjC,EAAKja,QAAS,EAEdsZ,GAAM6B,cAAclB,GAEhBA,EAAKzjC,UAAUyjC,EAAKzjC,WACxB,MAGD,IAAKyjC,EAAKe,IAAK,MAEff,EAAKtjC,UAAY,EACjBsjC,EAAK0B,SAAU,EACf1B,EAAKpc,OAAQ,EACboc,EAAKe,IAAIa,QAAU,KAEnBvC,GAAMa,WAAWF,GACjBA,EAAKe,IAAIjjC,OAETuhC,GAAM6B,cAAclB,GAEhBA,EAAKzjC,UAAUyjC,EAAKzjC,WACxB,MAGD,IAAK,QACJ,IAAKyjC,EAAK0B,UAAY1B,EAAKe,IAC1B,MAEDf,EAAKtjC,WAAaS,QAAU6iC,EAAK2B,SACjC3B,EAAK0B,SAAU,EACf1B,EAAKpc,OAAQ,EACboc,EAAKe,IAAIa,QAAU,KAEnBvC,GAAMa,WAAWF,GACjBA,EAAKe,IAAIjjC,OAETuhC,GAAM6B,cAAclB,GACpB,MAGD,IAAK,WACJ,IAAKA,EAAK0B,SAAW1B,EAAKja,OAC1B,CACCia,EAAKtjC,UAAY,EACjBsjC,EAAKja,QAAS,EACd,MAGD,IAAKia,EAAK0B,UAAY1B,EAAKe,IAC1B,MAEDf,EAAKtjC,UAAY,EACjBsjC,EAAK0B,SAAU,EACf1B,EAAKpc,OAAQ,EAEboc,EAAKe,IAAIrJ,MAAO,EAIlB,OAAOsI,GAGR6B,iBAAkB,SAAUnxB,GAE3B,IAAIsvB,EAAOtvB,EAAEoxB,cAAc9B,KAE3B,GAAIA,EAAK0B,SAAwB,GAAb1B,EAAKtI,KAYxB,OAVA2H,GAAM6B,cAAclB,IAEH,GAAbA,EAAKtI,MACRsI,EAAKtI,OAENsI,EAAKtjC,UAAY,EACjBsjC,EAAK0B,SAAU,EACf1B,EAAKpc,OAAQ,OAEbyb,GAAMiB,oBAAqBN,EAAM,QAIlCA,EAAKe,IAAIa,QAAU,KACnB5B,EAAKe,IAAIxB,OAAS,EAElBF,GAAMiB,oBAAqBN,EAAM,SAIlCO,uBAAwB,SAAUP,EAAMI,GAEvC,IAAKJ,EAAM,OAAO,KAElB,OAAQI,GAGP,IAAK,OACJ,GAAIJ,EAAK0B,QAAS,MAEb1B,EAAKe,KACT1B,GAAM+B,kBAAkBpB,GAEzBA,EAAK0B,SAAU,EACf1B,EAAKpc,OAAQ,EAEb,IACC9tB,EAAO+lC,QAAQC,YAAY7D,KAAM+H,EAAKK,IAAIluB,EAAE1R,KAAM,KAAM,MAAM,WAAa4+B,GAAM0C,oBAAoB/B,MAEtG,MAAOtvB,GAEN,OADA2uB,GAAMgC,iBAAiBrB,GAChB,KAGRX,GAAMU,SAASC,GACf,MAGD,IAAK,YAoBL,IAAK,QAKL,IAAK,WAEJ,MAtBD,IAAK,OACJ,IAAKA,EAAKe,IAAK,MAEff,EAAK0B,SAAU,EACf1B,EAAKpc,OAAQ,EAEbyb,GAAMa,WAAWF,GACjBlqC,EAAO+lC,QAAQC,YAAYh+B,KAAMkiC,EAAKK,IAAIluB,EAAE1R,KAAM,MAElD4+B,GAAMgC,iBAAiBrB,GAEnBA,EAAKzjC,UAAUyjC,EAAKzjC,WAc1B,OAAOyjC,GAGR+B,oBAAqB,SAAU/B,GAE9BX,GAAMkB,uBAAwBP,EAAM,SAGrCQ,iBAAkB,SAAUR,EAAMI,GAEjC,IAAKJ,EAAM,OAAO,KAElB,IAAIT,EAASF,GAAMI,OAAOF,OAASS,EAAKK,IAAIzE,MAAM2D,OAASS,EAAKT,OAEhE,OAAQa,GAGP,IAAK,OACJ,GAAIJ,EAAK0B,QAAS,MAEb1B,EAAKe,MAETf,EAAKe,IAAM1B,GAAMiC,YAAatB,EAAKK,IAAIluB,EAAE1R,MACzCu/B,EAAKe,IAAIf,KAAOA,EAChBA,EAAKe,IAAIpzB,IAAMqyB,EAAKe,IAAIS,MAGzBxB,EAAK2B,SAAWxkC,QAChB6iC,EAAK0B,SAAU,EACf1B,EAAKpc,OAAQ,EAEboc,EAAKe,IAAIa,QAAUvC,GAAM2C,cACzBhC,EAAKe,IAAIkB,YAAcjC,EAAKtjC,UAAU,IACtCsjC,EAAKe,IAAIxB,OAASA,EAElB,IACCS,EAAKe,IAAI9I,OAEV,MAAOvnB,GAGN,OAFA2uB,GAAMoC,WAAYzB,EAAKe,KACvBf,EAAKe,IAAM,KACJ,KAGR1B,GAAMU,SAASC,GACf,MAGD,IAAK,YACJ,IAAKA,EAAKe,IAAK,MAEff,EAAKe,IAAIxB,OAASA,EAClB,MAGD,IAAK,OACJ,IAAKS,EAAK0B,SAAW1B,EAAKja,OAC1B,CACCia,EAAKtjC,UAAY,EACjBsjC,EAAKja,QAAS,EAEdsZ,GAAMoC,WAAYzB,EAAKe,KACvBf,EAAKe,IAAM,KAEPf,EAAKzjC,UAAUyjC,EAAKzjC,WACxB,MAGD,IAAKyjC,EAAKe,IAAK,MAEff,EAAKtjC,UAAY,EACjBsjC,EAAK0B,SAAU,EACf1B,EAAKpc,OAAQ,EAEbyb,GAAMa,WAAYF,GAClBA,EAAKe,IAAInd,QAETyb,GAAMoC,WAAYzB,EAAKe,KACvBf,EAAKe,IAAM,KAEPf,EAAKzjC,UAAUyjC,EAAKzjC,WACxB,MAGD,IAAK,QACJ,IAAKyjC,EAAK0B,UAAY1B,EAAKe,IAC1B,MAEDf,EAAKtjC,WAAaS,QAAU6iC,EAAK2B,SACjC3B,EAAK0B,SAAU,EACf1B,EAAKpc,OAAQ,EAEbyb,GAAMa,WAAYF,GAClBA,EAAKe,IAAInd,QACT,MAGD,IAAK,WACJ,IAAKoc,EAAK0B,SAAW1B,EAAKja,OAC1B,CACCia,EAAKtjC,UAAY,EACjBsjC,EAAKja,QAAS,EACd,MAGD,IAAKia,EAAK0B,UAAY1B,EAAKe,IAC1B,MAEDf,EAAKtjC,UAAY,EACjBsjC,EAAK0B,SAAU,EACf1B,EAAKpc,OAAQ,EAIf,OAAOoc,GAGRgC,cAAe,SAAUtxB,GAExB,IAAIsvB,EAAOtvB,EAAEoxB,cAAc9B,KAE3B,GAAIA,EAAK0B,SAAwB,GAAb1B,EAAKtI,KAUxB,OARiB,GAAbsI,EAAKtI,MACRsI,EAAKtI,OAENsI,EAAKtjC,UAAY,EACjBsjC,EAAK0B,SAAU,EACf1B,EAAKpc,OAAQ,OAEbyb,GAAMmB,iBAAkBR,EAAM,QAI/BA,EAAKe,IAAIa,QAAU,KACnB5B,EAAKe,IAAIxB,OAAS,EAElBF,GAAMmB,iBAAkBR,EAAM,SAM/BkC,YAAa,SAAUtG,GAEjBA,IAELA,EAAM9V,SAAU,IAGjBqc,aAAc,SAAUvG,GAElBA,IAELA,EAAM9V,SAAU,IAGjBsc,UAAW,SAAUxG,EAAOxsC,GAEtBwsC,IAELA,EAAM2D,OAASnwC,IAGhBizC,WAAY,SAAUhC,EAAKd,GAE1B,IAAIS,EAAO,GAcX,OAZAA,EAAKsC,YAAc/C,EACnBS,EAAKT,OAASA,EACdS,EAAKK,IAAMA,EACXL,EAAKtI,KAAO,EACZsI,EAAK0B,SAAU,EACf1B,EAAKja,QAAS,EACdia,EAAKtjC,UAAY,EACjBsjC,EAAK2B,SAAW,EAChB3B,EAAKzjC,SAAW,KAChByjC,EAAKuC,MAAQ,KACbvC,EAAKe,IAAM,KAEJf,GAGR/H,KAAM,SAAUoI,EAAK1F,EAAkB4E,GAEtC,IAAKxvC,KAAK0vC,OAAO3Z,UAAYua,IAAQA,EAAIzE,MAAM9V,QAC9C,OAAO,KAEJyZ,EAASA,QAA4CA,EAAS,EAAlE,IAEIS,EAAOjwC,KAAKsyC,WAAWhC,EAAKd,GAGhC,OAFAS,EAAKzjC,SAAWo+B,EAET5qC,KAAKowC,WAAWH,EAAM,SAG9BR,SAAU,SAAUa,EAAK1F,EAAkB4E,GAE1C,IAAKxvC,KAAK0vC,OAAO3Z,UAAYua,IAAQA,EAAIzE,MAAM9V,QAC9C,OAAO,KAERyZ,EAASA,QAA4CA,EAAS,EAE9D,IAAIS,EAAOjwC,KAAKsyC,WAAWhC,EAAKd,GAIhC,OAHAS,EAAKzjC,SAAWo+B,EAChBqF,EAAKtI,MAAO,EAEL3nC,KAAKowC,WAAWH,EAAM,SAG9BliC,KAAM,SAAUkiC,EAAMzjC,GAErB,OAAKyjC,GAEDzjC,IAAyB,IAAbA,IAAmByjC,EAAKzjC,SAAWA,GAC5CxM,KAAKowC,WAAWH,GAAmB,IAAbzjC,EAAoB,OAAS,aAHxC,MAMnBqnB,MAAO,SAAUoc,GAEhB,OAAKA,EAEEjwC,KAAKowC,WAAWH,EAAM,SAFX,MAKnBnc,OAAQ,SAAUmc,GAEjB,OAAKA,EAEEjwC,KAAKowC,WAAYH,EAAM,QAFZ,MAKnBwC,QAAS,SAAUxC,EAAMyC,EAAQlmC,GAEhC,GAAKyjC,EAEL,GAAKA,EAAK0B,UAAW1B,EAAKuC,MAA1B,CAMA,IAAI7lC,EAAYS,QAChB6iC,EAAKsC,YAActC,EAAKT,OAExBS,EAAKuC,MAAQG,aAAa,WAEzB,IAAI/c,GAAMxoB,QAAUT,GAAa+lC,EAC7B9c,EAAI,IAAGA,EAAI,GAEfqa,EAAKT,OAASS,EAAKsC,aAAa,EAAE3c,GAClC0Z,GAAMc,WAAWH,EAAM,aAEd,GAALra,IAEHgd,cAAe3C,EAAKuC,OACpBvC,EAAKuC,MAAQ,MAEI,IAAbhmC,EACH8iC,GAAMc,WAAWH,EAAM,QAEvBX,GAAMc,WAAWH,EAAM,SAEpBzjC,IAAyB,IAAbA,GACfA,OAGH,SA7BKA,GAAUA,KAgChBqmC,OAAQ,SAAU5C,EAAMyC,EAAQlmC,GAE/B,GAAKyjC,EAEL,GAAIA,EAAK0B,SAAW1B,EAAKuC,MAEpBhmC,GAAUA,QAFf,CAMA,IAAIG,EAAYS,QAEhB6iC,EAAKT,OAAS,EACdxvC,KAAKowC,WAAWH,EAAM,QAEtBA,EAAKuC,MAAQG,aAAa,WAEzB,IAAI/c,GAAMxoB,QAAUT,GAAa+lC,EAC7B9c,EAAI,IAAGA,EAAI,GAEfqa,EAAKT,OAASS,EAAKsC,YAAY3c,EAC/B0Z,GAAMc,WAAWH,EAAM,aAEd,GAALra,IAEHgd,cAAe3C,EAAKuC,OACpBvC,EAAKuC,MAAQ,KAEThmC,GAAUA,OAGhB,QAOF6iC,GAAU/C,MAAQ,SAAU1uB,EAAKM,EAAK,MAErC,MAAO,CAAEjJ,KAAM,QAASswB,QAAS,QAAS3nB,IAAKA,KAAQM,I,IAGxD40B,GAAexD;AC7oBfyD,GAAetzC,EAAMC,OACpB,CACA0iB,EAAG,KAEHriB,OAAQ,SAAUqiB,GAEjB,GAAc,UAAVA,EAAEnN,KACL,MAAM,IAAIzO,MAAO,2BAElBxG,KAAKoiB,EAAIA,EACTpiB,KAAKoiB,EAAEmjB,QAAUvlC,KAEZA,KAAKoiB,EAAEypB,QACX7rC,KAAKoiB,EAAEypB,MAAQ,OAEX7rC,KAAKoiB,EAAE4wB,OACXhzC,KAAKoiB,EAAE4wB,KAAO,UAEfhzC,KAAK6rC,MAAQiH,GAAM9yC,KAAKoiB,EAAEypB,MAAM0D,eAEhCvvC,KAAKizC,OAAS,GACdjzC,KAAKkzC,WAAY,EAEjB,IAAK,IAAIhzC,EAAI,EAAGA,EAAIF,KAAKoiB,EAAE1R,KAAKvQ,OAAQD,IAEvCF,KAAKizC,OAAOtoC,KAAK,IAAImoC,GAAOjlB,OAAOC,OAAQ9tB,KAAKoiB,EAAE1R,KAAKxQ,GAAI,CAAE2rC,MAAO7rC,KAAKoiB,EAAEypB,WAI7EsH,eAAgB,WAEf,MAAmB,UAAfnzC,KAAKoiB,EAAE4wB,KACHhzC,KAAKizC,OAAOzZ,MAAM,EAAGx5B,KAAKizC,OAAO9yC,OAAO,KAEhDH,KAAKkzC,YAAclzC,KAAKkzC,UAAYlzC,KAAKizC,OAAO9yC,OACzCH,KAAKizC,OAAOjzC,KAAKkzC,aAGzBhL,KAAM,SAAU17B,EAAUgjC,GAEzB,OAAOsD,GAAM5K,KAAMloC,KAAKmzC,iBAAkB3mC,EAAUgjC,IAGrDC,SAAU,SAAUjjC,EAAUgjC,GAE7B,OAAOsD,GAAMrD,SAAUzvC,KAAKmzC,iBAAkB3mC,EAAUgjC,IAGzD4D,OAAQ,SAAUxzC,EAAO4M,EAAUgjC,GAElC,OAAOsD,GAAM5K,KAAMloC,KAAKizC,OAAOrzC,EAAQI,KAAKizC,OAAO9yC,QAASqM,EAAUgjC,IAGvE6D,WAAY,SAAUzzC,EAAO4M,EAAUgjC,GAEtC,OAAOsD,GAAMrD,SAAUzvC,KAAKizC,OAAOrzC,EAAQI,KAAKizC,OAAO9yC,QAASqM,EAAUgjC,MChE9B,MAAM8D,GAAWhO,GAEfiO,GAAS/N,GAECgO,GAAc7N,GAEK8N,GAAuBlL,GAE5CmL,GAAazK,GAEvB0K,GAAQb,GAEGc,GAAab,G;ACTtEc,GAAep0C,EAAMC,OACpB,CACA6G,UAAW,gBAEXogC,MAAO,KACPmN,UAAW,KACXC,MAAO,KAMPh0C,OAAQ,WAEPC,KAAK2mC,MAAQ,GACb3mC,KAAK8zC,UAAY,IAOlBxkC,IAAK,SAAU0kC,GAEd,OAAc,MAAVA,EACI,MAEF,aAAcA,IACnBA,EAAOC,SAAW,IAEbD,EAAOC,YAAYj0C,KAAK2mC,QAE7B3mC,KAAK2mC,MAAMqN,EAAOC,UAAY,CAAEC,UAAU,EAAO/qC,KAAM,IACvDnJ,KAAK8zC,UAAUnpC,KAAKqpC,EAAOC,UAE3Bj0C,KAAK+zC,MAAQlmB,OAAOid,KAAK9qC,KAAK2mC,OAAOwN,MAAK,CAAC9zC,EAAEC,IAAMD,EAAEC,MAGG,IAArDN,KAAK2mC,MAAMqN,EAAOC,UAAU9qC,KAAK0L,QAAQm/B,IAC5Ch0C,KAAK2mC,MAAMqN,EAAOC,UAAU9qC,KAAKwB,KAAKqpC,GAEhCA,IAOR5oC,OAAQ,SAAU4oC,GAEjB,GAAc,MAAVA,EACH,OAAO,KAKR,GAHM,aAAcA,IACnBA,EAAOC,SAAW,MAEbD,EAAOC,YAAYj0C,KAAK2mC,OAC7B,OAAOqN,EAER,IAAI9zC,EAAIF,KAAK2mC,MAAMqN,EAAOC,UAAU9qC,KAAK0L,QAAQm/B,GACjD,OAAU,IAAN9zC,IAEJF,KAAK2mC,MAAMqN,EAAOC,UAAUC,UAAW,EACvCl0C,KAAK2mC,MAAMqN,EAAOC,UAAU9qC,KAAKjJ,GAAK,MAHjB8zC,GAYtBI,QAAS,WAER,IAAK,IAAIl0C,EAAI,EAAGA,EAAIF,KAAK8zC,UAAU3zC,OAAQD,IAC3C,CACC,IAAIm0C,EAAIr0C,KAAK2mC,MAAM3mC,KAAK8zC,UAAU5zC,IAClC,GAAKm0C,EAAEH,SAAP,CAEA,IAAK,IAAI1iC,EAAI,EAAGA,EAAI6iC,EAAElrC,KAAKhJ,OAAQqR,IAEjB,MAAb6iC,EAAElrC,KAAKqI,IAEV6iC,EAAElrC,KAAKujB,OAAOlb,IAAK,GAIrB6iC,EAAEH,UAAW,KASftoC,QAAS,SAAUY,GAElB,IAAI0nC,GAAW,EACXI,GAAc,EAElB,IAAK,IAAIp0C,EAAI,GAAIo0C,GAAep0C,EAAIF,KAAK+zC,MAAM5zC,OAAQD,IACvD,CACC,IAAIiJ,EAAOnJ,KAAK2mC,MAAM3mC,KAAK+zC,MAAM7zC,IAAIiJ,KAErC,IAAK,IAAIqI,EAAI,GAAI8iC,GAAe9iC,EAAIrI,EAAKhJ,OAAQqR,IAEjC,MAAXrI,EAAKqI,KAEkB,IAAtBhF,EAASrD,EAAKqI,MACjB8iC,GAAc,GAGD,MAAXnrC,EAAKqI,KACR0iC,GAAW,GAIVA,GAAUl0C,KAAKo0C,WAQpBroC,WAAY,SAAUS,GAErB,IAAI0nC,GAAW,EACXI,GAAc,EAElB,IAAK,IAAIp0C,EAAIF,KAAK+zC,MAAM5zC,OAAO,GAAIm0C,GAAep0C,GAAK,EAAGA,IAC1D,CACC,IAAIiJ,EAAOnJ,KAAK2mC,MAAM3mC,KAAK+zC,MAAM7zC,IAAIiJ,KAErC,IAAK,IAAIqI,EAAIrI,EAAKhJ,OAAO,GAAIm0C,GAAe9iC,GAAK,EAAGA,IAEpC,MAAXrI,EAAKqI,KAEkB,IAAtBhF,EAASrD,EAAKqI,MACjB8iC,GAAc,GAGD,MAAXnrC,EAAKqI,KACR0iC,GAAW,GAIVA,GAAUl0C,KAAKo0C,WASpBG,aAAc,SAAU/nC,EAAUu6B,EAAiB,MAElD,IAAI9b,EAAIjrB,KAEJk0C,GAAW,EACXI,GAAc,EAEdp0C,GAAI,EACJsR,GAAI,EAEJrI,EAAO,KAEPqrC,EAAS,WAEZhjC,KAEK8iC,GAAe9iC,EAAIrI,EAAKhJ,QAEb,MAAXgJ,EAAKqI,KAE0B,IAA9BhF,EAASrD,EAAKqI,GAAIgjC,KACrBF,GAAc,GAGD,MAAXnrC,EAAKqI,KACR0iC,GAAW,GAERI,GAAaE,KAGjBC,KAGEA,EAAS,WAEZv0C,KAEKo0C,GAAep0C,EAAI+qB,EAAE8oB,MAAM5zC,QAE/BgJ,EAAO8hB,EAAE0b,MAAM1b,EAAE8oB,MAAM7zC,IAAIiJ,KAC3BqI,GAAI,EACJgjC,MAIIN,GAAUjpB,EAAEmpB,UACZrN,GAAkBA,MAIxB0N,KASDC,gBAAiB,SAAUloC,GAE1BmoC,MAAM;;iBCnNR;MAAMC,GAAWn1C,EAAMC,OACtB,CACA6G,UAAW,WAKXiG,SAAU,KAKVqoC,KAAM,KACNC,KAAM,KACNC,KAAM,KACNC,KAAM,KACNC,KAAM,KACNC,KAAM,KAKNprC,KAAM,KACNC,KAAM,KAMNhK,OAAQ,SAAUyM,EAAUqoC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAEvFl1C,KAAKwM,SAAWA,EAEhBxM,KAAK60C,KAAOA,EACZ70C,KAAK80C,KAAOA,EACZ90C,KAAK+0C,KAAOA,EACZ/0C,KAAKg1C,KAAOA,EACZh1C,KAAKi1C,KAAOA,EACZj1C,KAAKk1C,KAAOA,EAEZl1C,KAAK8J,KAAO,KACZ9J,KAAK+J,KAAO,MAMblB,OAAQ,WAEP7I,KAAKwM,SAAW,KAEhBxM,KAAK60C,KAAO,KACZ70C,KAAK80C,KAAO,KACZ90C,KAAK+0C,KAAO,KACZ/0C,KAAKg1C,KAAO,KACZh1C,KAAKi1C,KAAO,KACZj1C,KAAKk1C,KAAO,KAEZl1C,KAAK8J,KAAO,KACZ9J,KAAK+J,KAAO,MAMborC,QAAS,SAAU3oC,EAAS,KAAMqoC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAE7F,OAAiB,OAAb1oC,GAAqBooC,GAASvpC,WAAWmB,GACrCA,IAAaxM,MAEJ,OAAbwM,GAAqBxM,KAAKwM,WAAaA,MAG9B,OAATqoC,GAAiB70C,KAAK60C,OAASA,MAGtB,OAATC,GAAiB90C,KAAK80C,OAASA,MAGtB,OAATC,GAAiB/0C,KAAK+0C,OAASA,MAGtB,OAATC,GAAiBh1C,KAAKg1C,OAASA,MAGtB,OAATC,GAAiBj1C,KAAKi1C,OAASA,KAGtB,OAATC,GAAiBl1C,KAAKk1C,OAASA,SAWpCE,KAAM,SAAUC,GAEf,OAAsB,OAAlBr1C,KAAKwM,UACDxM,KAAKwM,SAAU6oC,EAAMr1C,KAAK60C,KAAM70C,KAAK80C,KAAM90C,KAAK+0C,KAAM/0C,KAAKg1C,KAAMh1C,KAAKi1C,KAAMj1C,KAAKk1C;;;iBAgB3FjvC;EAASwD,WAAWmrC,GAAU,MAAO,M,IACrCU,GAAeV;;;gBCrHf;MAAMW,GAAU91C,EAAMC,OACrB,CACA6G,UAAW,UAMX8uC,KAAM,KAKN9qC,IAAK,KACLC,OAAQ,KAMRzK,OAAQ,SAAUs1C,EAAK,MAOtB,OALAr1C,KAAKq1C,KAAOA,EAEZr1C,KAAKuK,IAAM,KACXvK,KAAKwK,OAAS,KAEPxK,MAMR6I,OAAQ,WAEP7I,KAAKoL,UAONkE,IAAK,SAAU9C,EAAUqoC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAEpF,IAAIjF,EAAOqF,GAASjqC,WAAWmB,GAAYA,EAAW8oC,GAAS5rC,KAAK5B,MAAM0E,EAAUqoC,EAAMC,EAAMC,EAAMC,EAAMC,EAAMC,GAYlH,OAVAjF,EAAKnmC,KAAO9J,KAAKwK,OAEG,OAAhBxK,KAAKwK,SACRxK,KAAKwK,OAAOT,KAAOkmC,GAEpBjwC,KAAKwK,OAASylC,EAEG,OAAbjwC,KAAKuK,MACRvK,KAAKuK,IAAM0lC,GAELA,GAORhmC,OAAQ,SAAUgmC,GAejB,OAbIA,EAAKnmC,OAAMmmC,EAAKnmC,KAAKC,KAAOkmC,EAAKlmC,MACjCkmC,EAAKlmC,OAAMkmC,EAAKlmC,KAAKD,KAAOmmC,EAAKnmC,MAEjC9J,KAAKuK,MAAQ0lC,IAChBjwC,KAAKuK,IAAM0lC,EAAKlmC,MAEb/J,KAAKwK,SAAWylC,IACnBjwC,KAAKwK,OAASylC,EAAKnmC,MAEpBmmC,EAAKnmC,KAAO,KACZmmC,EAAKlmC,KAAO,KAEZe,QAAQmlC,GACDjwC,MAORoL,OAAQ,SAAUoB,EAAS,KAAMqoC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAE5F,GAAiB,OAAb1oC,GAAqB8oC,GAASjqC,WAAWmB,GAG5C,OADAxM,KAAKiK,OAAOuC,GACLxM,KAGR,IAAIiwC,EAAOjwC,KAAKuK,IAEhB,KAAgB,OAAT0lC,GACP,CACC,IAAIlmC,EAAOkmC,EAAKlmC,KAEZkmC,EAAKkF,QAAQ3oC,EAAUqoC,EAAMC,EAAMC,EAAMC,EAAMC,EAAMC,IACxDl1C,KAAKiK,OAAOgmC,GAEbA,EAAOlmC,EAGR,OAAO/J,MAORgM,KAAM,SAAUQ,EAAUqoC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAErF,IAAIjF,EAAOjwC,KAAKuK,IAEhB,KAAgB,OAAT0lC,GACP,CACC,GAAIA,EAAKkF,QAAQ3oC,EAAUqoC,EAAMC,EAAMC,EAAMC,EAAMC,EAAMC,GACxD,OAAOjF,EAERA,EAAOA,EAAKlmC,KAGb,OAAO,MAORqrC,KAAM,SAAUC,EAAK,MAEpB,IAAIpF,EAAOjwC,KAAKuK,IAIhB,IAFA8qC,EAAOA,GAAQr1C,KAAKq1C,KAEJ,OAATpF,GACP,CACC,IAAIlmC,EAAOkmC,EAAKlmC,KAEZ1K,EAAQ4wC,EAAKmF,KAAKC,GACtB,GAAc,OAAVh2C,EAAgB,OAEN,IAAVA,GACHW,KAAKiK,OAAOgmC,GAEbA,EAAOlmC,IAQTyrC,MAAO,SAAUhpC,EAAS,KAAMqoC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAE3F,IAAIjF,EAAOjwC,KAAKuK,IAEhB,KAAgB,OAAT0lC,GACP,CACC,IAAIlmC,EAAOkmC,EAAKlmC,KAEhB,GAAIkmC,EAAKkF,QAAQ3oC,EAAUqoC,EAAMC,EAAMC,EAAMC,EAAMC,EAAMC,GACzD,EAC8B,IAAzBjF,EAAKmF,KAAKp1C,KAAKq1C,OAClBr1C,KAAKiK,OAAOgmC,GAEb,MAGDA,EAAOlmC,IAQT0rC,MAAO,SAAUxF,EAAMoF,EAAK,OAEU,IAAjCpF,EAAKmF,KAAKC,GAAQr1C,KAAKq1C,OAC1Br1C,KAAKiK,OAAOgmC;;;iBAcfhqC;EAASwD,WAAW8rC,GAAS,MAAO,M,IACpCG,GAAeH;;;aCtMf;MAAMI,GAAOl2C,EAAMC,OAClB,CACA6G,UAAW,OAUX2I,GAAI,EAIJC,GAAI,EAIJsT,GAAI,EAIJC,GAAI,EAIJC,GAAI,EAIJC,GAAI,EAcJ7iB,OAAQ,SAAU0iB,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAE/C,OAAW,OAAPH,GAEHziB,KAAKyiB,GAAKziB,KAAK0iB,GAAK1iB,KAAK2iB,GAAK3iB,KAAK4iB,GAAK5iB,KAAKkP,GAAKlP,KAAKmP,GAAK,EACrDnP,MAGG,OAAP2iB,GAEH3iB,KAAKoO,IAAK,EAAG,EAAG,EAAG,GACnBpO,KAAKkgB,OAAQuC,EAAIC,GACV1iB,MAGDA,KAAKoO,IAAIqU,EAAIC,EAAIC,EAAIC,IAM7B/Z,OAAQ,aAQR6B,MAAO,WAEN,OAAOirC,GAAKC,KAAK9tC,MAAM9H,KAAKyiB,GAAIziB,KAAK0iB,GAAI1iB,KAAK2iB,GAAI3iB,KAAK4iB,KAOxDpU,KAAM,WAML,OAJAxO,KAAKkP,GAAK,EAAGlP,KAAKmP,GAAK,EACvBnP,KAAKyiB,GAAK,EAAGziB,KAAK0iB,GAAK,EACvB1iB,KAAK2iB,GAAK,EAAG3iB,KAAK4iB,GAAK,EAEhB5iB,MAORyK,MAAO,WAMN,OAJAzK,KAAKkP,GAAK,KAAMlP,KAAKmP,GAAK,KAC1BnP,KAAKyiB,GAAK,KAAMziB,KAAK0iB,GAAK,KAC1B1iB,KAAK2iB,GAAK,KAAM3iB,KAAK4iB,GAAK,KAEnB5iB,MAWR61C,gBAAiB,SAAUv2C,EAAG6O,EAAE,MAE/B,GAAU,OAANA,EACJ,CACC,MAAMiU,EAAI9iB,EACVA,EAAI8iB,EAAE9iB,EACN6O,EAAIiU,EAAEjU,EAWP,OARgB,OAAZnO,KAAKyiB,IAAenjB,EAAIU,KAAKyiB,MAAIziB,KAAKyiB,GAAKnjB,IAC/B,OAAZU,KAAK0iB,IAAevU,EAAInO,KAAK0iB,MAAI1iB,KAAK0iB,GAAKvU,IAC/B,OAAZnO,KAAK2iB,IAAerjB,EAAIU,KAAK2iB,MAAI3iB,KAAK2iB,GAAKrjB,IAC/B,OAAZU,KAAK4iB,IAAezU,EAAInO,KAAK4iB,MAAI5iB,KAAK4iB,GAAKzU,GAE/CnO,KAAKkP,IAAMlP,KAAKyiB,GAAKziB,KAAK2iB,IAAM,EAChC3iB,KAAKmP,IAAMnP,KAAK0iB,GAAK1iB,KAAK4iB,IAAM,EAEzB5iB,MAOR6O,UAAW,SAAUC,EAAIC,GAMxB,OAJA/O,KAAKyiB,IAAM3T,EAAI9O,KAAK0iB,IAAM3T,EAC1B/O,KAAK2iB,IAAM7T,EAAI9O,KAAK4iB,IAAM7T,EAC1B/O,KAAKkP,IAAMJ,EAAI9O,KAAKmP,IAAMJ,EAEnB/O,MAQR81C,SAAU,SAAUx2C,EAAG6O,EAAGs5B,GAAW,GAQpC,OANkB,GAAdA,IAEHnoC,EAAIU,KAAKyiB,GAAKnjB,GAAGU,KAAK2iB,GAAK3iB,KAAKyiB,IAChCtU,EAAInO,KAAK0iB,GAAKvU,GAAGnO,KAAK4iB,GAAK5iB,KAAK0iB,KAG1B1iB,KAAK6O,UAAWvP,EAAIU,KAAKkP,GAAIf,EAAInO,KAAKmP,KAW9Cf,IAAK,SAAUqU,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAEvC,GAAW,OAAPF,EACJ,CACC,MAAMN,EAAIK,EACVA,EAAKL,EAAEK,GAAIC,EAAKN,EAAEM,GAClBC,EAAKP,EAAEO,GAAIC,EAAKR,EAAEQ,GAWnB,OARA5iB,KAAKkP,IAAMuT,EAAKE,GAAM,EACtB3iB,KAAKmP,IAAMuT,EAAKE,GAAM,EAEtB5iB,KAAKyiB,GAAKA,EACVziB,KAAK0iB,GAAKA,EACV1iB,KAAK2iB,GAAKA,EACV3iB,KAAK4iB,GAAKA,EAEH5iB,MAWR0O,OAAQ,SAAU+T,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAE1C,GAAW,OAAPF,EACJ,CACC,MAAMN,EAAIK,EACVA,EAAKL,EAAEK,GAAIC,EAAKN,EAAEM,GAClBC,EAAKP,EAAEO,GAAIC,EAAKR,EAAEQ,GAGnB,OAAOH,GAAMziB,KAAKyiB,IAAME,GAAM3iB,KAAK2iB,IAAMD,GAAM1iB,KAAK0iB,IAAME,GAAM5iB,KAAK4iB,IAWtEmzB,SAAU,SAAUtzB,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAE5C,GAAW,OAAPF,EACJ,CACC,MAAMN,EAAIK,EACVA,EAAKL,EAAEK,GAAIC,EAAKN,EAAEM,GAClBC,EAAKP,EAAEO,GAAIC,EAAKR,EAAEQ,GAGnB,OAAOH,GAAO/a,KAAKwzB,IAAIl7B,KAAKyiB,GAAIA,IAASC,GAAMhb,KAAKwzB,IAAIl7B,KAAK0iB,GAAIA,IAASC,GAAMjb,KAAKC,IAAI3H,KAAK2iB,GAAIA,IAASC,GAAMlb,KAAKC,IAAI3H,KAAK4iB,GAAIA,IAWpIozB,WAAY,SAAUvzB,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAE9C,GAAW,OAAPF,EACJ,CACC,MAAMN,EAAIK,EACVA,EAAKL,EAAEK,GAAIC,EAAKN,EAAEM,GAClBC,EAAKP,EAAEO,GAAIC,EAAKR,EAAEQ,GAQnB,OALA5iB,KAAKyiB,GAAK/a,KAAKC,IAAI3H,KAAKyiB,GAAIA,GAC5BziB,KAAK0iB,GAAKhb,KAAKC,IAAI3H,KAAK0iB,GAAIA,GAC5B1iB,KAAK2iB,GAAKjb,KAAKwzB,IAAIl7B,KAAK2iB,GAAIA,GAC5B3iB,KAAK4iB,GAAKlb,KAAKwzB,IAAIl7B,KAAK4iB,GAAIA,GAErB5iB,MAWRi2C,WAAY,SAAUxzB,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAE9C,GAAW,OAAPF,EACJ,CACC,MAAMN,EAAIK,EACVA,EAAKL,EAAEK,GAAIC,EAAKN,EAAEM,GAClBC,EAAKP,EAAEO,GAAIC,EAAKR,EAAEQ,GAGnB,IAAIszB,EAAMxuC,KAAKwzB,IAAIl7B,KAAKyiB,GAAIA,GACxB0zB,EAAMzuC,KAAKwzB,IAAIl7B,KAAK0iB,GAAIA,GACxB0zB,EAAM1uC,KAAKC,IAAI3H,KAAK2iB,GAAIA,GACxB0zB,EAAM3uC,KAAKC,IAAI3H,KAAK4iB,GAAIA,GAE5B,OAAOlb,KAAKwzB,IAAI,EAAGmb,EAAIF,GAAOzuC,KAAKwzB,IAAI,EAAGkb,EAAIF,GAAO,GAatDI,kBAAmB,SAAU7zB,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAErD,GAAW,OAAPF,EACJ,CACC,MAAMN,EAAIK,EACVA,EAAKL,EAAEK,GAAIC,EAAKN,EAAEM,GAClBC,EAAKP,EAAEO,GAAIC,EAAKR,EAAEQ,GAQnB,OALA5iB,KAAKyiB,GAAK/a,KAAKwzB,IAAIl7B,KAAKyiB,GAAIA,GAC5BziB,KAAK0iB,GAAKhb,KAAKwzB,IAAIl7B,KAAK0iB,GAAIA,GAC5B1iB,KAAK2iB,GAAKjb,KAAKC,IAAI3H,KAAK2iB,GAAIA,GAC5B3iB,KAAK4iB,GAAKlb,KAAKC,IAAI3H,KAAK4iB,GAAIA,GAErBlb,KAAKwzB,IAAI,EAAGl7B,KAAK4iB,GAAG5iB,KAAK0iB,IAAMhb,KAAKwzB,IAAI,EAAGl7B,KAAK2iB,GAAG3iB,KAAKyiB,IAAM,GAStEvC,OAAQ,SAAUmB,EAAGC,EAAGi1B,GAAgB,EAAO9O,GAAW,GAqBzD,OAnBkB,GAAdA,IAEHpmB,GAAMrhB,KAAK2iB,GAAK3iB,KAAKyiB,GACrBnB,GAAMthB,KAAK4iB,GAAK5iB,KAAK0iB,IAGC,GAAnB6zB,GAEHv2C,KAAK2iB,GAAK3iB,KAAKyiB,GAAKpB,EACpBrhB,KAAK4iB,GAAK5iB,KAAK0iB,GAAKpB,IAIpBD,GAAK,EAAGC,GAAK,EAEbthB,KAAKyiB,GAAKziB,KAAKkP,GAAKmS,EAAGrhB,KAAK0iB,GAAK1iB,KAAKmP,GAAKmS,EAC3CthB,KAAK2iB,GAAK3iB,KAAKkP,GAAKmS,EAAGrhB,KAAK4iB,GAAK5iB,KAAKmP,GAAKmS,GAGrCthB,MAQRw2C,SAAU,SAAUhzB,EAAIC,EAAI8yB,GAAgB,GAe3C,OAbuB,GAAnBA,GAEHv2C,KAAK2iB,IAAMa,EACXxjB,KAAK4iB,IAAMa,IAIXD,GAAM,EAAGC,GAAM,EAEfzjB,KAAKyiB,IAAMe,EAAIxjB,KAAK0iB,IAAMe,EAC1BzjB,KAAK2iB,IAAMa,EAAIxjB,KAAK4iB,IAAMa,GAGpBzjB,MAORya,MAAO,WAEN,OAAOza,KAAK2iB,GAAK3iB,KAAKyiB,IAOvB/H,OAAQ,WAEP,OAAO1a,KAAK4iB,GAAK5iB,KAAK0iB,IAOvB+zB,IAAK,WAEJ,OAAQz2C,KAAKkP,GAAKlP,KAAKyiB,KAAOziB,KAAK2iB,GAAK3iB,KAAKyiB,KAO9Ci0B,IAAK,WAEJ,OAAQ12C,KAAKmP,GAAKnP,KAAK0iB,KAAO1iB,KAAK4iB,GAAK5iB,KAAK0iB,KAO9Ci0B,QAAS,WAER,OAAO32C,KAAKyiB,IAAMziB,KAAK2iB,IAAM3iB,KAAK0iB,IAAM1iB,KAAK4iB,IAQ9Cg0B,cAAe,SAAUt3C,EAAG6O,EAAG0oC,EAAI,GAElC,OAAO72C,KAAMyiB,GAAGo0B,GAAOv3C,GAAKA,GAAKU,KAAK2iB,GAAGk0B,GAAS72C,KAAK0iB,GAAGm0B,GAAO1oC,GAAKA,GAAKnO,KAAK4iB,GAAGi0B,GAQpFC,KAAM,SAAUC,GAEf,OAAOA,EAAU/2C,KAAK22C,WAAa32C,KAAK4iB,GAAG5iB,KAAK0iB,KAAK1iB,KAAK2iB,GAAG3iB,KAAKyiB,IAAM,GAAOziB,KAAK4iB,GAAG5iB,KAAK0iB,KAAK1iB,KAAK2iB,GAAG3iB,KAAKyiB,KAO/G/S,MAAO,WAQN,OANA1P,KAAKyiB,GAAK/a,KAAKgI,MAAM1P,KAAKyiB,IAC1BziB,KAAK0iB,GAAKhb,KAAKgI,MAAM1P,KAAK0iB,IAC1B1iB,KAAK2iB,GAAKjb,KAAKgI,MAAM1P,KAAK2iB,IAC1B3iB,KAAK4iB,GAAKlb,KAAKgI,MAAM1P,KAAK4iB,IAC1B5iB,KAAKkP,GAAKxH,KAAKgI,MAAM1P,KAAKkP,IAC1BlP,KAAKmP,GAAKzH,KAAKgI,MAAM1P,KAAKmP,IACnBnP,MAORqmC,KAAM,WAQL,OANArmC,KAAKyiB,GAAK/a,KAAK2+B,KAAKrmC,KAAKyiB,IACzBziB,KAAK0iB,GAAKhb,KAAK2+B,KAAKrmC,KAAK0iB,IACzB1iB,KAAK2iB,GAAKjb,KAAK2+B,KAAKrmC,KAAK2iB,IACzB3iB,KAAK4iB,GAAKlb,KAAK2+B,KAAKrmC,KAAK4iB,IACzB5iB,KAAKkP,GAAKxH,KAAK2+B,KAAKrmC,KAAKkP,IACzBlP,KAAKmP,GAAKzH,KAAK2+B,KAAKrmC,KAAKmP,IAClBnP,MAORoQ,SAAU,WAET,MAAO,IAAMpQ,KAAKyiB,GAAGnZ,QAAQ,GAAK,KAAOtJ,KAAK0iB,GAAGpZ,QAAQ,GAAK,KAAOtJ,KAAK2iB,GAAGrZ,QAAQ,GAAK,KAAOtJ,KAAK4iB,GAAGtZ,QAAQ,GAAK,KAOvH0tC,QAAS,WAER,MAAO,CAACh3C,KAAKyiB,GAAIziB,KAAK0iB,GAAI1iB,KAAK2iB,GAAI3iB,KAAK4iB,KAOzCq0B,UAAW,SAAU9lB,GAGpB,OADAnxB,KAAKoO,IAAK+iB,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,IACvBnxB;;;iBAsBTiG;EAASwD,WAAYksC,GAAM,KAAM,M,IACjCuB,GAAevB;kBC3ff;MAAMwB,GAAY13C,EAAMC,OACvB,CACA6G,UAAW,YAMXqvB,EAAG,KAMHznB,EAAG,KAMHyS,EAAG,KAOH7gB,OAAQ,SAAUV,EAAM,GAEvBW,KAAKyK,MAAMpL,IAQZoL,MAAO,SAAUpL,EAAM,GAMtB,OAJAW,KAAK41B,EAAI,CAAC,GACV51B,KAAKmO,EAAI,CAAC9O,GACVW,KAAK4gB,EAAI,CAAC,MAEH5gB,MAWRo3C,SAAU,SAAUx5B,EAAKy5B,EAAIC,GAM5B,GAJAt3C,KAAK41B,EAAI,GACT51B,KAAKmO,EAAI,GACTnO,KAAK4gB,EAAI,GAEC,MAANy2B,GAAoB,MAANC,EAClB,CACC,IAAK,IAAIp3C,EAAI,EAAGA,EAAI0d,EAAIgY,EAAEz1B,OAAQD,IAEjCF,KAAK41B,EAAEjrB,KAAKiT,EAAIgY,EAAE11B,IAClBF,KAAKmO,EAAExD,KAAKiT,EAAIzP,EAAEjO,IAClBF,KAAK4gB,EAAEjW,KAAKiT,EAAIgD,EAAE1gB,IAGnB,OAAOF,KAGE,MAANq3C,IAAYA,EAAKz5B,EAAIgY,EAAE,IACjB,MAAN0hB,IAAYA,EAAK15B,EAAIgY,EAAEhY,EAAIgY,EAAEz1B,OAAO,IAEpCk3C,EAAKz5B,EAAIgY,EAAE,KAAIyhB,EAAKz5B,EAAIgY,EAAE,IAE9B,IAAI2hB,EAAK35B,EAAI5R,KAAKqrC,GACdl9B,EAAKyD,EAAI5R,KAAKsrC,GAElB,GAAU,MAANC,EAAY,OAAO,KACvB,GAAU,MAANp9B,EAAY,OAAO,KAEnByD,EAAIgY,EAAE2hB,IAAOF,IAChBr3C,KAAKoO,IAAIipC,EAAIz5B,EAAI3S,MAAMosC,GAAKz5B,EAAIgD,EAAE22B,IAClCA,KAGD,IAAK,IAAIr3C,EAAIq3C,EAAIr3C,GAAKia,EAAIja,IACzBF,KAAKoO,IAAIwP,EAAIgY,EAAE11B,GAAI0d,EAAIzP,EAAEjO,GAAI0d,EAAIgD,EAAE1gB,IAEpC,GAAI0d,EAAIgY,EAAEzb,IAAOm9B,EACjB,CACC,IAAIhiB,GAAMgiB,EAAK15B,EAAIgY,EAAEzb,IAAOzS,KAAK2+B,KAAK3+B,KAAK0B,IAAIkuC,EAAK15B,EAAIgY,EAAEzb,KACtDyb,EAAI51B,KAAK41B,EAAE51B,KAAK41B,EAAEz1B,OAAO,GAI7B,IAFIm1B,GAAM,IAAGA,EAAK,GACrBA,EAAKgiB,EAAG1hB,EACEA,GAAK0hB,GAEP1hB,EAAEN,EAAKgiB,IACVhiB,EAAKgiB,EAAK1hB,GAEXA,GAAKN,EACLt1B,KAAKoO,IAAI4qB,OAAOpD,GAAIhY,EAAI3S,MAAM2qB,GAAIhY,EAAIgD,EAAEzG,IAI1C,OAAOna,MASR0K,MAAO,SAAU2sC,EAAIC,GAEpB,OAAO,IAAKH,IAAaC,SAASp3C,KAAMq3C,EAAIC,IAQ7CllB,QAAS,SAAUb,EAAM,GAExB,OAAOvxB,KAAK41B,EAAE51B,KAAK41B,EAAEz1B,OAAO,GAAKoxB,GAQlC5kB,UAAW,SAAU4kB,EAAM,GAE1B,OAAOvxB,KAAK41B,EAAE,GAAKrE,GASpBvlB,KAAM,SAAUka,GAEf,GAAIA,EAAOlmB,KAAK41B,EAAE,GACjB,OAAO,KAER,MAAMnuB,EAAIzH,KAAK41B,EAAEz1B,OAEjB,IAAK,IAAID,EAAI,EAAGA,EAAIuH,EAAGvH,IAEtB,GAAIgmB,EAAOlmB,KAAK41B,EAAE11B,GACjB,OAAOA,EAAE,EAGX,OAAOuH,EAAE,GAUV2G,IAAK,SAAUwnB,EAAGznB,EAAGyS,EAAE,MAEtB,IAAI1gB,EAAIF,KAAKgM,KAAK4pB,GAClB,OAAS,MAAL11B,IAEAF,KAAK41B,EAAE11B,IAAM01B,GAEhB51B,KAAKmO,EAAEjO,GAAKiO,EACH,MAALyS,IAAW5gB,KAAK4gB,EAAE1gB,GAAK0gB,KAI3B1gB,IACAF,KAAK41B,EAAElJ,OAAOxsB,EAAG,EAAG01B,GACpB51B,KAAKmO,EAAEue,OAAOxsB,EAAG,EAAGiO,GACpBnO,KAAK4gB,EAAE8L,OAAOxsB,EAAG,EAAG0gB,KAGd,IAOR3M,IAAK,WAEJ,OAAOjU,KAAKmO,EAAEnO,KAAKmO,EAAEhO,OAAO,IAQ7B8K,MAAO,SAAU2qB,GAEhB,IAAI2hB,EAAKv3C,KAAKgM,KAAK4pB,GACnB,GAAU,MAAN2hB,EAAY,OAAO,EAEvB,IAAIp9B,EAAKo9B,EAAK,EAEd,GAAIv3C,KAAK41B,EAAE2hB,IAAO3hB,GAAKzb,GAAMna,KAAK41B,EAAEz1B,QAAUH,KAAKmO,EAAEopC,IAAOv3C,KAAKmO,EAAEgM,IAAqB,MAAdna,KAAK4gB,EAAE22B,GAChF,OAAOv3C,KAAKmO,EAAEopC,GAEf,GAAkB,MAAdv3C,KAAK4gB,EAAE22B,GACV,OAAOv3C,KAAKmO,EAAEopC,GAEf,IAAIj4C,EAAIs2B,EACJkH,EAAK98B,KAAK41B,EAAE2hB,GACZ90B,EAAKziB,KAAK41B,EAAEzb,GACZq9B,EAAKx3C,KAAKmO,EAAEopC,GACZ70B,EAAK1iB,KAAKmO,EAAEgM,GAKhB,OAHAyb,GAAKt2B,EAAIw9B,IAAOra,EAAKqa,IACrBlH,EAAI51B,KAAK4gB,EAAE22B,GAAI3hB,IAENlT,GAAM,EAAEkT,GAAG4hB,GAWrBC,SAAU,SAAUJ,EAAG,KAAMC,EAAG,KAAMI,EAAG,GAE9B,MAANL,IAAYA,EAAKr3C,KAAK41B,EAAE,IAClB,MAAN0hB,IAAYA,EAAKt3C,KAAK41B,EAAE51B,KAAK41B,EAAEz1B,OAAO,IAEtCk3C,EAAKr3C,KAAK41B,EAAE,KAAIyhB,EAAKr3C,KAAK41B,EAAE,IAEhC,IAAIzlB,EAAO,EAEX,GAAIknC,EAAKC,EAAI,CACZ,IAAItjB,EAAKA,EAAMqjB,EAAIA,EAAKC,EAAIA,EAAKtjB,EACjC7jB,GAAO,EAGR,IAAIwnC,EAAQD,EAEZ,IAAK,IAAIxxB,EAAOmxB,EAAInxB,EAAOoxB,GAC3B,CACC,IAAIC,EAAKv3C,KAAKgM,KAAKka,GACnB,GAAU,MAANqxB,EAAY,OAAO,EAEvB,IAAIp9B,EAAKo9B,EAAK,EAEVza,EAAKp1B,KAAKwzB,IAAIl7B,KAAK41B,EAAE2hB,GAAKrxB,GAC1BzD,EAAK/a,KAAKC,IAAIwS,EAAKna,KAAK41B,EAAEz1B,OAASH,KAAK41B,EAAEzb,GAAMm9B,EAAIA,GAEpDE,EAAKx3C,KAAKiL,MAAM6xB,GAGhBhuB,EAAK2T,EAAKqa,EACV/tB,EAHK/O,KAAKiL,MAAMwX,GAGN+0B,EAEI,MAAdx3C,KAAK4gB,EAAE22B,GACVI,GAASH,EAAG1oC,EAEZ6oC,GAAS,GAAI5oC,GAAI0T,EAAGqa,GAAMA,EAAG/tB,EAAKyoC,EAAG1oC,EAEtCoX,GAAQpX,EAGT,OAAOqB,EAAKwnC,GAWbC,gBAAiB,SAAUP,EAAG,KAAMC,EAAG,KAAMI,EAAG,GAErC,MAANL,IAAYA,EAAKr3C,KAAK41B,EAAE,IAClB,MAAN0hB,IAAYA,EAAKt3C,KAAK41B,EAAE51B,KAAK41B,EAAEz1B,OAAO,IAE1C,IAAI4H,EAAKovC,GAAUU,MAAMT,SAASp3C,KAAMA,KAAK41B,EAAE,GAAIyhB,GAAIS,UAAUJ,GAAID,WAGrE,OAFSN,GAAUY,MAAMX,SAASp3C,KAAMA,KAAK41B,EAAE,GAAI0hB,GAAIQ,UAAUJ,GAAID,WAEzD1vC,GAUb+vC,UAAW,SAAUJ,EAAG,GAEvB,IAAIvpC,EAAI,GAERA,EAAExD,KAAK+sC,GAEP,IAAK,IAAIx3C,EAAI,EAAGA,EAAIF,KAAK41B,EAAEz1B,OAAQD,IAClCiO,EAAExD,KAAKwD,EAAEjO,EAAE,GAAKF,KAAKy3C,SAASz3C,KAAK41B,EAAE11B,EAAE,GAAIF,KAAK41B,EAAE11B,KAGnD,OADAF,KAAKmO,EAAIA,EACFnO,MAQRg4C,WAAY,SAAUN,EAAG,GAExB13C,KAAKmO,EAAE,IAAMupC,EAEb,IAAK,IAAIx3C,EAAI,EAAGA,EAAIF,KAAK41B,EAAEz1B,OAAQD,IAClCF,KAAKmO,EAAEjO,IAAMF,KAAKmO,EAAEjO,EAAE,GAEvB,OAAOF,MAORi4C,SAAU,SAAU/3C,GAMnB,OAJAF,KAAK41B,EAAElJ,OAAO,EAAGxsB,GACjBF,KAAK4gB,EAAE8L,OAAO,EAAGxsB,GACjBF,KAAKmO,EAAEue,OAAO,EAAGxsB,GAEVF,MAORk4C,UAAW,SAAUh4C,GAMpB,OAJAF,KAAK41B,EAAElJ,OAAOxsB,EAAE,EAAGF,KAAK41B,EAAEz1B,OAAOD,EAAE,GACnCF,KAAK4gB,EAAE8L,OAAOxsB,EAAE,EAAGF,KAAK4gB,EAAEzgB,OAAOD,EAAE,GACnCF,KAAKmO,EAAEue,OAAOxsB,EAAE,EAAGF,KAAKmO,EAAEhO,OAAOD,EAAE,GAE5BF,MAQRgW,IAAK,SAAUnK,GAEd,IAAK,IAAI3L,EAAI,EAAGA,EAAIF,KAAKmO,EAAEhO,OAAQD,IAClCF,KAAKmO,EAAEjO,GAAK2L,EAAI7L,KAAKmO,EAAEjO,GAAIF,KAAK41B,EAAE11B,GAAIA,GAEvC,OAAOF,MAORoQ,SAAU,SAASsnC,EAAG,GAErB,IAAIjhB,EAAI,GACJ0hB,EAAI,GAER,MAAMC,EAAM,SAAU/4C,EAAOoI,EAAG+0B,GAO/B,IALAn9B,EAAQA,EAAM+Q,WAEF,MAARosB,IAAcA,EAAO,KACzBA,EAAOA,EAAK,GAELn9B,EAAMc,OAASsH,GACrBpI,GAASm9B,EAEV,OAAOn9B,GAGRo3B,GAAK,KACLA,GAAK2hB,EAAI,QAASD,GAAK,IAAMC,EAAI,SAAUD,GAAK,IAAMC,EAAI,YAAaD,GAAK,KAC5E1hB,GAAK2hB,EAAI,GAAID,EAAG,KAAO,IAAMC,EAAI,GAAID,EAAG,KAAO,IAAMC,EAAI,GAAID,EAAG,KAAO,KAEvE,IAAK,IAAIj4C,EAAI,EAAGA,EAAIF,KAAK41B,EAAEz1B,OAAQD,IAElCu2B,GAAK2hB,EAAI,IAAIpf,OAAOh5B,KAAK41B,EAAE11B,IAAKi4C,GAAK,IAAMC,EAAI,IAAIpf,OAAOh5B,KAAKmO,EAAEjO,IAAKi4C,GAAK,IAAMC,EAAI,IAAIpf,OAAOh5B,KAAKy3C,SAASz3C,KAAK41B,EAAE,GAAI51B,KAAK41B,EAAE11B,GAAIw3C,IAAMS,GAAK,KAGhJ,OAAO1hB,KAIT0gB,GAAUU,MAAQ,IAAIV,GACtBA,GAAUY,MAAQ,IAAIZ,G,IAEtBkB,GAAelB;;;eCzZf;MAAMmB,GAAS74C,EAAMC,OACpB,CACA6G,UAAW,SAOXgyC,GAAI,EAAGC,GAAI,EAOXl5C,EAAG,EAAG6O,EAAG,EAcTpO,OAAQ,SAAUT,EAAE,KAAM6O,EAAE,MAE3B,OAAOnO,KAAKoO,IAAI9O,EAAG6O,IAMpB4tB,UAAW,WAIV,OAFA/7B,KAAKV,EAAIy8B,UAAU/7B,KAAKu4C,IACxBv4C,KAAKmO,EAAI4tB,UAAU/7B,KAAKw4C,IACjBx4C,MAOR0K,MAAO,WAEN,OAAO4tC,GAAO5uC,KAAK5B,MAAM9H,OAiB1BoO,IAAK,SAAU9O,EAAG6O,EAAE,KAAMsqC,GAAS,GA0BlC,OAxBU,OAANn5C,GACHA,EAAI,EACJ6O,EAAI,GAEU,OAANA,EAEJmqC,GAAOjtC,WAAW/L,IACrB6O,EAAI7O,EAAEk5C,GACNl5C,EAAIA,EAAEi5C,KAENpqC,EAAI2tB,QAAQx8B,EAAE6O,GACd7O,EAAIw8B,QAAQx8B,EAAEA,KAIE,IAAbm5C,IACHn5C,EAAIw8B,QAAQx8B,GACZ6O,EAAI2tB,QAAQ3tB,IAIdnO,KAAKu4C,GAAKj5C,EACVU,KAAKw4C,GAAKrqC,EAEHnO,KAAK+7B,UAAU/7B,OAOvBsO,KAAM,SAAUhP,GAGf,OADAU,KAAKu4C,GAAKzc,QAAQx8B,GACXU,KAAK+7B,UAAU/7B,OAOvBuO,KAAM,SAAUJ,GAGf,OADAnO,KAAKw4C,GAAK1c,QAAQ3tB,GACXnO,KAAK+7B,UAAU/7B,OAOvBwO,KAAM,WAEL,OAAOxO,KAAKoO,IAAI,EAAG,IAOpBK,OAAQ,WAEP,OAAiB,GAAVzO,KAAKV,GAAoB,GAAVU,KAAKmO,GAe5BO,OAAQ,SAAUpP,EAAG6O,EAAE,MAiBtB,OAfU,OAANA,EAECmqC,GAAOjtC,WAAW/L,IACrB6O,EAAI7O,EAAE6O,EACN7O,EAAIA,EAAEA,IAEN6O,EAAI1H,IAAInH,EAAE6O,GACV7O,EAAImH,IAAInH,EAAEA,KAIXA,EAAImH,IAAInH,GACR6O,EAAI1H,IAAI0H,IAGFnO,KAAKV,GAAKA,GAAKU,KAAKmO,GAAKA,GAgBjCmB,IAAK,SAAUR,EAAIC,EAAG,KAAM0pC,GAAS,GAoBpC,OAlBW,OAAP1pC,EAECupC,GAAOjtC,WAAWyD,IACrBC,EAAKD,EAAG0pC,GACR1pC,EAAKA,EAAGypC,KAERxpC,EAAK+sB,QAAQhtB,EAAGX,GAChBW,EAAKgtB,QAAQhtB,EAAGxP,KAIA,IAAbm5C,IACH3pC,EAAKgtB,QAAQhtB,GACbC,EAAK+sB,QAAQ/sB,IAIf/O,KAAKu4C,IAAMzpC,EAAI9O,KAAKw4C,IAAMzpC,EACnB/O,KAAK+7B,aAgBbxsB,IAAK,SAAUT,EAAIC,EAAI0pC,GAAS,GAoB/B,OAlBW,OAAP1pC,EAECupC,GAAOjtC,WAAWyD,IACrBC,EAAKD,EAAG0pC,GACR1pC,EAAKA,EAAGypC,KAERxpC,EAAK+sB,QAAQhtB,EAAGX,GAChBW,EAAKgtB,QAAQhtB,EAAGxP,KAIA,IAAbm5C,IACH3pC,EAAKgtB,QAAQhtB,GACbC,EAAK+sB,QAAQ/sB,IAIf/O,KAAKu4C,IAAMzpC,EAAI9O,KAAKw4C,IAAMzpC,EACnB/O,KAAK+7B,aAOb3rB,SAAU,WAET,MAAO,IAAIpQ,KAAKV,MAAMU,KAAKmO;;;iBAsB7BlI;EAASwD,WAAY6uC,GAAQ,KAAM,M,IACnCI,GAAeJ;;;;gBCzQf;MAAMK,GAAUl5C,EAAMC,OACrB,CACA6G,UAAW,UAUX2I,GAAI,EAIJC,GAAI,EAIJsT,GAAI,EAIJC,GAAI,EAIJC,GAAI,EAIJC,GAAI,EAKJg2B,IAAK,EAAGC,IAAK,EACbC,IAAK,EAAGC,IAAK,EACbC,IAAK,EAAGC,IAAK,EAiBbl5C,OAAQ,SAAU0iB,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAM61B,GAAS,GAE9D,OAAW,OAAPh2B,GAEHziB,KAAK84C,IAAM94C,KAAK+4C,IAAM/4C,KAAKg5C,IAAMh5C,KAAKi5C,IAAMj5C,KAAK44C,IAAM54C,KAAK64C,IAAM,EAC3D74C,KAAK+7B,aAGF,OAAPrZ,GAAsB,OAAPC,EACX3iB,KAAKoO,IAAI,EAAG,EAAG,EAAG,GAAG8R,OAAOuC,EAAIC,GAEjC1iB,KAAKoO,IAAIqU,EAAIC,EAAIC,EAAIC,EAAI61B,IAMjC1c,UAAW,WASV,OAPA/7B,KAAKyiB,GAAKsZ,UAAU/7B,KAAK84C,KACzB94C,KAAK0iB,GAAKqZ,UAAU/7B,KAAK+4C,KACzB/4C,KAAK2iB,GAAKoZ,UAAU/7B,KAAKg5C,KACzBh5C,KAAK4iB,GAAKmZ,UAAU/7B,KAAKi5C,KACzBj5C,KAAKkP,GAAK6sB,UAAU/7B,KAAK44C,KACzB54C,KAAKmP,GAAK4sB,UAAU/7B,KAAK64C,KAElB74C,MAORk5C,MAAO,WASN,OAPAl5C,KAAK84C,IAAMhd,QAAQ97B,KAAKyiB,IACxBziB,KAAK+4C,IAAMjd,QAAQ97B,KAAK0iB,IACxB1iB,KAAKg5C,IAAMld,QAAQ97B,KAAK2iB,IACxB3iB,KAAKi5C,IAAMnd,QAAQ97B,KAAK4iB,IACxB5iB,KAAK44C,IAAM9c,QAAQ97B,KAAKkP,IACxBlP,KAAK64C,IAAM/c,QAAQ97B,KAAKmP,IAEjBnP,MAOR0K,MAAO,WAEN,OAAOiuC,GAAQjvC,KAAK5B,MAAM9H,KAAK84C,IAAK94C,KAAK+4C,IAAK/4C,KAAKg5C,IAAKh5C,KAAKi5C,KAAK,IAOnEzqC,KAAM,WAML,OAJAxO,KAAK84C,IAAM,EAAG94C,KAAK+4C,IAAM,EACzB/4C,KAAKg5C,IAAM,EAAGh5C,KAAKi5C,IAAM,EACzBj5C,KAAK44C,IAAM,EAAG54C,KAAK64C,IAAM,EAElB74C,KAAK+7B,aAObtxB,MAAO,WAUN,OARAzK,KAAK84C,IAAM,KAAM94C,KAAK+4C,IAAM,KAC5B/4C,KAAKg5C,IAAM,KAAMh5C,KAAKi5C,IAAM,KAC5Bj5C,KAAK44C,IAAM,KAAM54C,KAAK64C,IAAM,KAE5B74C,KAAKyiB,GAAK,KAAMziB,KAAK0iB,GAAK,KAC1B1iB,KAAK2iB,GAAK,KAAM3iB,KAAK4iB,GAAK,KAC1B5iB,KAAKkP,GAAK,KAAMlP,KAAKmP,GAAK,KAEnBnP,MAeR6O,UAAW,SAAUC,EAAIC,EAAG,KAAM0pC,GAAS,GAuB1C,OArBW,OAAP1pC,EAEC2pC,GAAOrtC,WAAWyD,IACrBC,EAAKD,EAAG0pC,GACR1pC,EAAKA,EAAGypC,KAERxpC,EAAK+sB,QAAQhtB,EAAGX,GAChBW,EAAKgtB,QAAQhtB,EAAGxP,KAIA,IAAbm5C,IACH3pC,EAAKgtB,QAAQhtB,GACbC,EAAK+sB,QAAQ/sB,IAIf/O,KAAK84C,KAAOhqC,EAAI9O,KAAK+4C,KAAOhqC,EAC5B/O,KAAKg5C,KAAOlqC,EAAI9O,KAAKi5C,KAAOlqC,EAC5B/O,KAAK44C,KAAO9pC,EAAI9O,KAAK64C,KAAO9pC,EAErB/O,KAAK+7B,aAUb3tB,IAAK,SAAUqU,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAM61B,GAAS,GAkCtD,OAhCW,OAAP/1B,EAECi2B,GAAQttC,WAAWoX,IACtBG,EAAKH,EAAGw2B,IACRt2B,EAAKF,EAAGu2B,IACRt2B,EAAKD,EAAGs2B,IACRt2B,EAAKA,EAAGq2B,MAERl2B,EAAKkZ,QAAQrZ,EAAGG,IAChBD,EAAKmZ,QAAQrZ,EAAGE,IAChBD,EAAKoZ,QAAQrZ,EAAGC,IAChBD,EAAKqZ,QAAQrZ,EAAGA,MAKA,IAAbg2B,IACHh2B,EAAKqZ,QAAQrZ,GACbC,EAAKoZ,QAAQpZ,GACbC,EAAKmZ,QAAQnZ,GACbC,EAAKkZ,QAAQlZ,IAIf5iB,KAAK84C,IAAMr2B,EACXziB,KAAK+4C,IAAMr2B,EACX1iB,KAAKg5C,IAAMr2B,EACX3iB,KAAKi5C,IAAMr2B,EAEX5iB,KAAK44C,IAAMn2B,EAAME,GAAO,EACxB3iB,KAAK64C,IAAMn2B,EAAME,GAAO,EAEjB5iB,KAAK+7B,aAUbzsB,IAAK,SAAUmT,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAM61B,GAAS,GAkCtD,OAhCW,OAAP/1B,EAECi2B,GAAQttC,WAAWoX,IACtBG,EAAKH,EAAGw2B,IACRt2B,EAAKF,EAAGu2B,IACRt2B,EAAKD,EAAGs2B,IACRt2B,EAAKA,EAAGq2B,MAERl2B,EAAKkZ,QAAQrZ,EAAGG,IAChBD,EAAKmZ,QAAQrZ,EAAGE,IAChBD,EAAKoZ,QAAQrZ,EAAGC,IAChBD,EAAKqZ,QAAQrZ,EAAGA,MAKA,IAAbg2B,IACHh2B,EAAKqZ,QAAQrZ,GACbC,EAAKoZ,QAAQpZ,GACbC,EAAKmZ,QAAQnZ,GACbC,EAAKkZ,QAAQlZ,IAIf5iB,KAAK84C,KAAOr2B,EACZziB,KAAK+4C,KAAOr2B,EACZ1iB,KAAKg5C,KAAOr2B,EACZ3iB,KAAKi5C,KAAOr2B,EAEZ5iB,KAAK44C,KAAOn2B,EAAME,GAAO,EACzB3iB,KAAK64C,KAAOn2B,EAAME,GAAO,EAElB5iB,KAAK+7B,aAUbrtB,OAAQ,SAAU+T,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAwB1C,OAtBW,OAAPF,EAECi2B,GAAQttC,WAAWoX,IACtBG,EAAKH,EAAGG,GACRD,EAAKF,EAAGE,GACRD,EAAKD,EAAGC,GACRD,EAAKA,EAAGA,KAERG,EAAKnc,IAAIgc,EAAGG,IACZD,EAAKlc,IAAIgc,EAAGE,IACZD,EAAKjc,IAAIgc,EAAGC,IACZD,EAAKhc,IAAIgc,EAAGA,MAKbA,EAAKhc,IAAIgc,GACTC,EAAKjc,IAAIic,GACTC,EAAKlc,IAAIkc,GACTC,EAAKnc,IAAImc,IAGHH,GAAMziB,KAAKyiB,IAAME,GAAM3iB,KAAK2iB,IAAMD,GAAM1iB,KAAK0iB,IAAME,GAAM5iB,KAAK4iB,IAUtEmzB,SAAU,SAAUtzB,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAwB5C,OAtBW,OAAPF,EAECi2B,GAAQttC,WAAWoX,IACtBG,EAAKH,EAAGG,GACRD,EAAKF,EAAGE,GACRD,EAAKD,EAAGC,GACRD,EAAKA,EAAGA,KAERG,EAAKnc,IAAIgc,EAAGG,IACZD,EAAKlc,IAAIgc,EAAGE,IACZD,EAAKjc,IAAIgc,EAAGC,IACZD,EAAKhc,IAAIgc,EAAGA,MAKbA,EAAKhc,IAAIgc,GACTC,EAAKjc,IAAIic,GACTC,EAAKlc,IAAIkc,GACTC,EAAKnc,IAAImc,IAGHH,GAAO/a,KAAKwzB,IAAIl7B,KAAKyiB,GAAIA,IAASC,GAAMhb,KAAKwzB,IAAIl7B,KAAK0iB,GAAIA,IAASC,GAAMjb,KAAKC,IAAI3H,KAAK2iB,GAAIA,IAASC,GAAMlb,KAAKC,IAAI3H,KAAK4iB,GAAIA,IAapIozB,WAAY,SAAUvzB,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAE9C,GAAW,OAAPF,EACJ,CACC,GAAIi2B,GAAQttC,WAAWoX,GAItB,OAFAziB,KAAKg2C,WAAWvzB,EAAGq2B,IAAKr2B,EAAGs2B,KAAK,GAChC/4C,KAAKg2C,WAAWvzB,EAAGu2B,IAAKv2B,EAAGw2B,KAAK,GACzBj5C,KAEH,GAAIk3C,GAAK7rC,WAAWoX,GAIxB,OAFAziB,KAAKg2C,WAAWvzB,EAAGA,GAAIA,EAAGC,IAC1B1iB,KAAKg2C,WAAWvzB,EAAGE,GAAIF,EAAGG,IACnB5iB,KAEC04C,GAAOrtC,WAAWoX,IAE1BC,EAAKD,EAAG+1B,GACR/1B,EAAKA,EAAG81B,KAIR71B,EAAKoZ,QAAQrZ,EAAGtU,GAChBsU,EAAKqZ,QAAQrZ,EAAGnjB,QAIlB,CACC,GAAW,OAAPsjB,EAIH,OAFA5iB,KAAKg2C,WAAWvzB,EAAIC,GACpB1iB,KAAKg2C,WAAWrzB,EAAIC,GACb5iB,MAII,IAAP2iB,IAEHF,EAAKqZ,QAAQrZ,GACbC,EAAKoZ,QAAQpZ,IAahB,OARiB,OAAb1iB,KAAK84C,KAAgBr2B,EAAKziB,KAAK84C,OAAK94C,KAAK84C,IAAMr2B,IAClC,OAAbziB,KAAK+4C,KAAgBr2B,EAAK1iB,KAAK+4C,OAAK/4C,KAAK+4C,IAAMr2B,IAClC,OAAb1iB,KAAKg5C,KAAgBv2B,EAAKziB,KAAKg5C,OAAKh5C,KAAKg5C,IAAMv2B,IAClC,OAAbziB,KAAKi5C,KAAgBv2B,EAAK1iB,KAAKi5C,OAAKj5C,KAAKi5C,IAAMv2B,GAEnD1iB,KAAK44C,IAAM54C,KAAM84C,IAAM94C,KAAKg5C,KAAQ,EACpCh5C,KAAK64C,IAAM74C,KAAM+4C,IAAM/4C,KAAKi5C,KAAQ,EAE7Bj5C,KAAK+7B,aAUbka,WAAY,SAAUxzB,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAEnC,OAAPF,EAECi2B,GAAQttC,WAAWoX,IACtBG,EAAKH,EAAGG,GACRD,EAAKF,EAAGE,GACRD,EAAKD,EAAGC,GACRD,EAAKA,EAAGA,KAERG,EAAKnc,IAAIgc,EAAGG,IACZD,EAAKlc,IAAIgc,EAAGE,IACZD,EAAKjc,IAAIgc,EAAGC,IACZD,EAAKhc,IAAIgc,EAAGA,MAKbA,EAAKhc,IAAIgc,GACTC,EAAKjc,IAAIic,GACTC,EAAKlc,IAAIkc,GACTC,EAAKnc,IAAImc,IAGV,IAAIszB,EAAMxuC,KAAKwzB,IAAIl7B,KAAKyiB,GAAIA,GACxB0zB,EAAMzuC,KAAKwzB,IAAIl7B,KAAK0iB,GAAIA,GACxB0zB,EAAM1uC,KAAKC,IAAI3H,KAAK2iB,GAAIA,GACxB0zB,EAAM3uC,KAAKC,IAAI3H,KAAK4iB,GAAIA,GAE5B,OAAOlb,KAAKwzB,IAAI,EAAGmb,EAAIF,GAAOzuC,KAAKwzB,IAAI,EAAGkb,EAAIF,GAAO,GAUtDI,kBAAmB,SAAU7zB,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAkCrD,OAhCW,OAAPF,EAECi2B,GAAQttC,WAAWoX,IACtBG,EAAKH,EAAGG,GACRD,EAAKF,EAAGE,GACRD,EAAKD,EAAGC,GACRD,EAAKA,EAAGA,KAERG,EAAKnc,IAAIgc,EAAGG,IACZD,EAAKlc,IAAIgc,EAAGE,IACZD,EAAKjc,IAAIgc,EAAGC,IACZD,EAAKhc,IAAIgc,EAAGA,MAKbA,EAAKhc,IAAIgc,GACTC,EAAKjc,IAAIic,GACTC,EAAKlc,IAAIkc,GACTC,EAAKnc,IAAImc,IAGV5iB,KAAK84C,IAAMhd,QAAQp0B,KAAKwzB,IAAIl7B,KAAKyiB,GAAIA,IACrCziB,KAAK+4C,IAAMjd,QAAQp0B,KAAKwzB,IAAIl7B,KAAK0iB,GAAIA,IACrC1iB,KAAKg5C,IAAMld,QAAQp0B,KAAKC,IAAI3H,KAAK2iB,GAAIA,IACrC3iB,KAAKi5C,IAAMnd,QAAQp0B,KAAKC,IAAI3H,KAAK4iB,GAAIA,IAErC5iB,KAAK44C,IAAM54C,KAAM84C,IAAM94C,KAAKg5C,KAAQ,EACpCh5C,KAAK64C,IAAM74C,KAAM+4C,IAAM/4C,KAAKi5C,KAAQ,EAEpCj5C,KAAK+7B,YAEEr0B,KAAKwzB,IAAI,EAAGl7B,KAAKi5C,IAAIj5C,KAAK+4C,KAAOrxC,KAAKwzB,IAAI,EAAGl7B,KAAKg5C,IAAIh5C,KAAK84C,KAAO,GAU1E54B,OAAQ,SAAUzF,EAAOC,EAAQ67B,GAAgB,GA0BhD,OAxBA97B,EAAkB,OAAVA,GAA4B,IAAVA,GAAiBqhB,QAAQrhB,GAAiBza,KAAKg5C,IAAMh5C,KAAK84C,IACpFp+B,EAAoB,OAAXA,GAA8B,IAAXA,GAAkBohB,QAAQphB,GAAmB1a,KAAKi5C,IAAMj5C,KAAK+4C,KAE3E,IAAVt+B,EACHA,EAAQC,EAAO1a,KAAKqrC,SACD,IAAX3wB,IACRA,EAASD,EAAMza,KAAKqrC,UAEG,IAApBkL,GAEHv2C,KAAKg5C,IAAMh5C,KAAK84C,IAAMr+B,EACtBza,KAAKi5C,IAAMj5C,KAAK+4C,IAAMr+B,EAEtB1a,KAAK44C,IAAM54C,KAAM84C,IAAM94C,KAAKg5C,KAAQ,EACpCh5C,KAAK64C,IAAM74C,KAAM+4C,IAAM/4C,KAAKi5C,KAAQ,IAIpCx+B,IAAU,EAAGC,IAAW,EAExB1a,KAAK84C,IAAM94C,KAAK44C,IAAMn+B,EAAOza,KAAK+4C,IAAM/4C,KAAK64C,IAAMn+B,EACnD1a,KAAKg5C,IAAMh5C,KAAK44C,IAAMn+B,EAAOza,KAAKi5C,IAAMj5C,KAAK64C,IAAMn+B,GAG7C1a,KAAK+7B,aAObya,SAAU,SAAU2C,EAAQC,EAAS7C,GAAgB,GA0BpD,OAxBA4C,GAAoB,IAAXA,GAAkBrd,QAAQqd,GACnCC,GAAsB,IAAZA,GAAmBtd,QAAQsd,IAEtB,IAAXD,EACHA,EAASC,EAAQp5C,KAAKqrC,SACF,IAAZ+N,IACRA,EAAUD,EAAOn5C,KAAKqrC,UAEC,IAApBkL,GAEHv2C,KAAKg5C,KAAOG,EACZn5C,KAAKi5C,KAAOG,EAEZp5C,KAAK44C,IAAM54C,KAAM84C,IAAM94C,KAAKg5C,KAAQ,EACpCh5C,KAAK64C,IAAM74C,KAAM+4C,IAAM/4C,KAAKi5C,KAAQ,IAIpCE,IAAW,EAAGC,IAAY,EAE1Bp5C,KAAK84C,KAAOK,EAAQn5C,KAAK+4C,KAAOK,EAChCp5C,KAAKg5C,KAAOG,EAAQn5C,KAAKi5C,KAAOG,GAG1Bp5C,KAAK+7B,aAObthB,MAAO,WAEN,OAAOza,KAAK2iB,GAAK3iB,KAAKyiB,IAOvB/H,OAAQ,WAEP,OAAO1a,KAAK4iB,GAAK5iB,KAAK0iB,IAOvB2oB,MAAO,WAEN,OAAQrrC,KAAK2iB,GAAK3iB,KAAKyiB,KAAOziB,KAAK4iB,GAAK5iB,KAAK0iB,KAO9C22B,UAAW,WAEV,OAAOr5C,KAAK84C,KAAO94C,KAAKg5C,KAAOh5C,KAAK+4C,KAAO/4C,KAAKi5C,KAOjDrC,cAAe,SAAUt3C,EAAG6O,EAAG0oC,EAAI,GAMlC,OAJAv3C,EAAIw8B,QAAQx8B,GACZ6O,EAAI2tB,QAAQ3tB,GACZ0oC,EAAM/a,QAAQ+a,GAEP72C,KAAM84C,IAAIjC,GAAOv3C,GAAKA,GAAKU,KAAKg5C,IAAInC,GAAS72C,KAAK+4C,IAAIlC,GAAO1oC,GAAKA,GAAKnO,KAAKi5C,IAAIpC,GAOxFC,KAAM,SAAUC,GAAO,GAEtB,OAAOA,EAAU/2C,KAAKq5C,aAAer5C,KAAK4iB,GAAG5iB,KAAK0iB,KAAK1iB,KAAK2iB,GAAG3iB,KAAKyiB,IAAM,GAAOziB,KAAK4iB,GAAG5iB,KAAK0iB,KAAK1iB,KAAK2iB,GAAG3iB,KAAKyiB,KAOjHrS,SAAU,WAET,MAAO,IAAMpQ,KAAKyiB,GAAK,KAAOziB,KAAK0iB,GAAK,KAAO1iB,KAAK2iB,GAAK,KAAO3iB,KAAK4iB,GAAK,KAO3Eo0B,QAAS,WAER,MAAO,CAACh3C,KAAK84C,IAAK94C,KAAK+4C,IAAK/4C,KAAKg5C,IAAKh5C,KAAKi5C,MAO5ChC,UAAW,SAAU33C,GAUpB,OARAU,KAAK84C,IAAMx5C,EAAE,GACbU,KAAK+4C,IAAMz5C,EAAE,GACbU,KAAKg5C,IAAM15C,EAAE,GACbU,KAAKi5C,IAAM35C,EAAE,GAEbU,KAAK44C,IAAM54C,KAAM84C,IAAM94C,KAAKg5C,KAAQ,EACpCh5C,KAAK64C,IAAM74C,KAAM+4C,IAAM/4C,KAAKi5C,KAAQ,EAE7Bj5C,KAAK+7B;;;iBAcd91B;EAASwD,WAAYkvC,GAAS,KAAM,M,IACpCW,GAAeX;mBC3pBf;MAAMY,GACN;AAGCC,OACA,CAICC,GAAI,SAAU7jB,GAEb,OAAOA,GAMR8jB,IAAK,SAAU9jB,GAEd,OAAOA,GAMR+jB,OAAQ,SAAU/jB,GAEjB,OAAOA;;;AAOTgkB,KACA,CACC/f,EAAG,QAKH4f,GAAI,SAAU7jB,EAAGiE,EAAE,MAGlB,OADU,OAANA,IAAYA,EAAI0f,GAAOK,KAAK/f,GACzBjE,EAAEA,IAAIiE,EAAE,GAAGjE,EAAIiE,IAMvB6f,IAAK,SAAU9jB,EAAGiE,EAAE,MAEnB,OAAO,EAAI0f,GAAOK,KAAKH,GAAG,EAAI7jB,EAAGiE,IAMlC8f,OAAQ,SAAU/jB,EAAGiE,EAAE,MAEtB,OAAIjE,EAAI,GACA2jB,GAAOK,KAAKH,GAAK,EAAF7jB,EAAKiE,GAAG,EAEvB0f,GAAOK,KAAKF,IAAY,GAAP9jB,EAAE,IAAQiE,GAAG,EAAI;;;AAO5CggB,OACA,CACCC,SAAU,SAAUlkB,GAEnB,OAAIA,EAAI,EAAI,KACJ,OAASA,EAAIA,EACZA,EAAI,EAAI,KACT,QAAUA,GAAK,IAAI,MAAMA,EAAI,IAC5BA,EAAI,IAAI,KACT,QAAUA,GAAK,KAAM,MAAQA,EAAI,MAElC,QAAUA,GAAK,MAAM,MAAQA,EAAI,SAMzC6jB,GAAI,SAAU7jB,GAEb,OAAO,EAAI2jB,GAAOM,OAAOC,SAAS,EAAElkB,IAMrC8jB,IAAK,SAAU9jB,GAEd,OAAO2jB,GAAOM,OAAOC,SAASlkB,IAM/B+jB,OAAQ,SAAU/jB,GAEjB,OAAIA,EAAI,IACC,EAAI2jB,GAAOM,OAAOC,SAAS,EAAE,EAAElkB,IAAI,EAEpC2jB,GAAQM,OAAOC,SAAiB,GAAPlkB,EAAE,KAAQ,EAAG;;;AAOhDmkB,KACA,CAICN,GAAI,SAAU7jB,GAEb,OAAO,EAAIluB,KAAKqI,KAAK,EAAI6lB,EAAEA,IAM5B8jB,IAAK,SAAU9jB,GAEd,OAAO,EAAI2jB,GAAOQ,KAAKN,GAAG,EAAI7jB,IAM/B+jB,OAAQ,SAAU/jB,GAEjB,OAAIA,EAAI,GACC2jB,GAAOQ,KAAKN,GAAK,EAAF7jB,GAAK,EAEpB2jB,GAAOQ,KAAKL,IAAY,GAAP9jB,EAAE,KAAQ,EAAI;;;AAO1CokB,MACA,CAICP,GAAI,SAAU7jB,GAEb,OAAOA,EAAEA,EAAEA,GAMZ8jB,IAAK,SAAU9jB,GAEd,OAAO,EAAI2jB,GAAOS,MAAMP,GAAG,EAAI7jB,IAMhC+jB,OAAQ,SAAU/jB,GAEjB,OAAIA,EAAI,GACA2jB,GAAOS,MAAMP,GAAK,EAAF7jB,GAAK,EAErB2jB,GAAOS,MAAMN,IAAY,GAAP9jB,EAAE,KAAQ,EAAI;;;AAO1CqkB,KACA,CAICR,GAAI,SAAU7jB,GAEb,OAAOluB,KAAKq2B,IAAI,EAAG,IAAInI,EAAE,KAM1B8jB,IAAK,SAAU9jB,GAEd,OAA6B,EAArBluB,KAAKq2B,IAAI,GAAG,GAAInI,IAMzB+jB,OAAQ,SAAU/jB,GAEjB,OAAKA,GAAK,GAAK,EACPluB,KAAKq2B,IAAK,EAAG,IAAMnI,EAAI,IAAM,GAEG,EAA9BluB,KAAKq2B,IAAK,GAAG,IAAOnI,EAAI,KAAW;;;AAO/CskB,MACA,CAICT,GAAI,SAAU7jB,EAAG1C,EAAE,IAElB,OAAOxrB,KAAKq2B,IAAInI,EAAG1C,IAMpBwmB,IAAK,SAAU9jB,EAAG1C,EAAE,IAEnB,OAAO,EAAIqmB,GAAOW,MAAMT,GAAG,EAAI7jB,EAAG1C,IAMnCymB,OAAQ,SAAU/jB,EAAG1C,EAAE,IAEtB,OAAI0C,EAAI,GACA2jB,GAAOW,MAAMT,GAAK,EAAF7jB,EAAK1C,GAAG,EAExBqmB,GAAOW,MAAMR,IAAY,GAAP9jB,EAAE,IAAQ1C,GAAG,EAAI;;;AAO7CinB,KACA,CAICV,GAAI,SAAU7jB,GAEb,OAAOA,EAAEA,GAMV8jB,IAAK,SAAU9jB,GAEd,OAAO,EAAI2jB,GAAOY,KAAKV,GAAG,EAAI7jB,IAM/B+jB,OAAQ,SAAU/jB,GAEjB,OAAIA,EAAI,GACA2jB,GAAOY,KAAKV,GAAK,EAAF7jB,GAAK,EAEpB2jB,GAAOY,KAAKT,IAAY,GAAP9jB,EAAE,KAAQ,EAAI;;;AAOzCwkB,QACA,CAICX,GAAI,SAAU7jB,GAEb,OAAOA,EAAEA,EAAEA,EAAEA,GAMd8jB,IAAK,SAAU9jB,GAEd,OAAO,EAAI2jB,GAAOa,QAAQX,GAAG,EAAI7jB,IAMlC+jB,OAAQ,SAAU/jB,GAEjB,OAAIA,EAAI,GACA2jB,GAAOa,QAAQX,GAAK,EAAF7jB,GAAK,EAEvB2jB,GAAOa,QAAQV,IAAY,GAAP9jB,EAAE,KAAQ,EAAI;;;AAO5CykB,QACA,CAICZ,GAAI,SAAU7jB,GAEb,OAAOA,EAAEA,EAAEA,EAAEA,EAAEA,GAMhB8jB,IAAK,SAAU9jB,GAEd,OAAO,EAAI2jB,GAAOc,QAAQZ,GAAG,EAAI7jB,IAMlC+jB,OAAQ,SAAU/jB,GAEjB,OAAIA,EAAI,GACC2jB,GAAOc,QAAQZ,GAAK,EAAF7jB,GAAK,EAEvB2jB,GAAOc,QAAQX,IAAY,GAAP9jB,EAAE,KAAQ,EAAI;;;AAO7C0kB,KACA,CAICb,GAAI,SAAU7jB,GAEb,OAAO,EAAIluB,KAAK2H,IAAK,QAAU,EAAIumB,KAMpC8jB,IAAK,SAAU9jB,GAEd,OAAOluB,KAAK2H,IAAK,OAASumB,IAM3B+jB,OAAQ,SAAU/jB,GAEjB,OAAQluB,KAAK0H,IAAK,OAAOwmB,GAAK,IAAK;;;AAOrC2kB,KACA,CAICd,GAAI,SAAU7jB,GAEb,OAAY,GAALA,EAAW,EAAI,GAMvB8jB,IAAK,SAAU9jB,GAEd,OAAY,GAALA,EAAW,EAAI,GAMvB+jB,OAAQ,SAAU/jB,GAEjB,OAAY,GAALA,EAAW,EAAI,K,IAKzB4kB,GAAejB;;aCnZf;MAAMkB,GACN,CACCC,QAAS,IAAI7G,GAMb7D,SAAU,SAAU2K,GAEnB,OAAO36C,KAAK06C,QAAQprC,IAAIqrC,IAOzBxK,WAAY,SAAUwK,GAErB36C,KAAK06C,QAAQtvC,OAAOuvC,GACpB36C,KAAK06C,QAAQtG,WAOdwG,QAAS,SAAU7T,EAAiB,MAEnC/mC,KAAK06C,QAAQnG,cAAa,CAACza,EAAE1X,MAA+B,IAAnB0X,EAAE+gB,UAAUz4B,IAAcA,MAAQ2kB,IAO5E+T,SAAU,SAAU/T,EAAiB,MAEpC/mC,KAAK06C,QAAQK,iBAAiB,CAACjhB,EAAE1X,MAAgC,IAApB0X,EAAEkhB,WAAW54B,IAAcA,MAAQ2kB;;;mBASlF0T;GAAKQ,OAASx7C,EAAMC,OACnB,CACA6G,UAAW,SAMX0tC,SAAU,EAEVl0C,OAAQ,WAEP06C,GAAKzK,SAAShwC,OAGf6I,OAAQ,WAEP4xC,GAAKtK,WAAWnwC,OAOjB66C,UAAW,SAAU9wC,KAQrBixC,WAAY,SAAUjxC,O;;AAQvBmxC,GAAeT;YCvFf;MAAMU,GACN,CAICxS,aAAa,EAMbpa,YAAa,EAMbC,aAAc,EAMdxB,SAAU,KAMV9G,KAAM,EAMNoP,GAAI,EAKJ8lB,SAAU,KAKVC,UAAW,KAKXC,MAAO,KAMPpnB,OAAQ,KAMRtH,KAAM,KAMN2uB,SAAU,KAMVC,UAAW,KAKXr+B,QACA,CAIClL,IAAI,EAKJ7I,KAAK,EAKLkU,WAAW,EAKXc,WAAY,UAKZgQ,YAAa,YAKbG,YAAa,KAKbC,aAAc,KAKdH,IAAK,IAKLC,OAAQ,GAMR/mB,aAAa,GAWdkB,KAAM,SAAU0U,GAEf,OAAO,IAAIua,SAAS,CAACC,EAASC,KAE7B,GAAI53B,KAAK2oC,YACR,OAAOhR,IAER9J,OAAOC,OAAO9tB,KAAKmd,QAASA,GAE5BkyB,GAAUpJ,OAAQ,CAAEuE,WAAYxqC,KAAKmd,QAAQG,UAAWrR,OAAQjM,KAAKmd,QAAQG,UAAY,SAAW,YACpGwP,EAAOrkB,KAAMzI,KAAKmd,SAElB2P,EAAOiI,eACN,CACAb,OAAQ,SAASoB,GAEhB6lB,GAAOj1B,KAAO4G,EAAOqD,UACrBgrB,GAAO7lB,GAAKA,EAEZ6lB,GAAOC,SAAShG,KAAK9f,GACrB6lB,GAAOE,UAAUjG,KAAK9f,GACtB6lB,GAAOG,MAAMlG,KAAK9f,GAElB6lB,GAAOjnB,OAAOkhB,KAAK9f,MAIrBxI,EAAOoI,aACN,CACAtI,KAAM,SAASxF,GAEd+zB,GAAOvuB,KAAKwoB,KAAKhuB,MAInB8zB,GAAKN,SAAQ,WAEZ9tB,EAAOvf,QAEP4tC,GAAO5sB,YAAczB,EAAOyB,YAC5B4sB,GAAO3sB,aAAe1B,EAAO0B,aAC7B2sB,GAAOnuB,SAAWF,EAAOE,SAEzBmuB,GAAOC,SAAW1F,GAAQhsC,KAAK5B,QAC/BqzC,GAAOE,UAAY3F,GAAQhsC,KAAK5B,QAChCqzC,GAAOG,MAAQ5F,GAAQhsC,KAAK5B,QAE5BqzC,GAAOjnB,OAASwhB,GAAQhsC,KAAK5B,QAC7BqzC,GAAOvuB,KAAO8oB,GAAQhsC,KAAK5B,QAE3B2zC,OAAOC,OAAS,WACfP,GAAOtnB,OAAM,IAGd4nB,OAAOjN,QAAU,WAChB2M,GAAOrnB,QAAO,IAGfqnB,GAAOxS,aAAc,EAErBhR,WASH9D,MAAO,SAAU8nB,GAAkB,GAEV,OAApBR,GAAOI,UACVJ,GAAOI,SAASI,IAOlB7nB,OAAQ,SAAU6nB,GAAkB,GAEV,OAArBR,GAAOK,WACVL,GAAOK,UAAUG,IAOnBhuC,QAAS,SAAU8nB,EAAUjpB,EAAUqoC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAE5E,OAAOh1C,KAAKo7C,SAAS9rC,IAAItP,KAAK47C,eAAgBnmB,EAAUjpB,EAAUqoC,EAAMC,EAAMC,EAAMC,IAOrF6G,cAAe,SAAU5L,GAExBjwC,KAAKo7C,SAAShwC,OAAO6kC,IAGtB2L,eAAgB,SAAUtmB,EAAIrK,EAAGze,EAAUqoC,EAAMC,EAAMC,EAAMC,GAG5D,OADAh1C,KAAK60C,MAAQvf,EACTt1B,KAAK60C,KAAO,IAEhBroC,EAAUqoC,EAAMC,EAAMC,EAAMC,IACrB,IAORzoC,SAAU,SAAUuvC,EAAQtvC,EAAUqoC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAEhE,OAAO/0C,KAAKq7C,UAAU/rC,IAAItP,KAAK+7C,gBAAiB,EAAGD,EAAQtvC,EAAUqoC,EAAMC,EAAMC,IAOlFiH,eAAgB,SAAU/L,GAEzBjwC,KAAKq7C,UAAUjwC,OAAO6kC,IAGvB8L,gBAAiB,SAAUzmB,EAAI2mB,EAAIC,EAAI1vC,EAAUqoC,EAAMC,EAAMC,GAG5D,OADA/0C,KAAK60C,MAAQvf,EACTt1B,KAAK60C,KAAO70C,KAAK80C,OAErB90C,KAAK60C,MAAQ70C,KAAK80C,KACXtoC,EAAUqoC,EAAMC,EAAMC,KAO9BoH,KAAM,SAAU1mB,EAAUjpB,EAAUqoC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAE9D,OAAO/0C,KAAKs7C,MAAMhsC,IAAItP,KAAKo8C,YAAa,EAAG3mB,EAAUjpB,EAAUqoC,EAAMC,EAAMC,IAO5EsH,WAAY,SAAUpM,GAErBjwC,KAAKs7C,MAAMlwC,OAAO6kC,IAGnBmM,YAAa,SAAU9mB,EAAI2mB,EAAIC,EAAI1vC,EAAUqoC,EAAMC,EAAMC,GAQxD,OANA/0C,KAAK60C,MAAQvf,EACTt1B,KAAK60C,KAAO70C,KAAK80C,OACpBxf,GAAMt1B,KAAK60C,KAAO70C,KAAK80C,KACvB90C,KAAK60C,KAAO70C,KAAK80C,OAG2C,IAAzDtoC,EAAUxM,KAAK60C,KAAK70C,KAAK80C,KAAMxf,EAAIuf,EAAMC,EAAMC,IAG5C/0C,KAAK60C,OAAS70C,KAAK80C,O,IAI5BwH,GAAenB,GC5Tf,IAAIoB,GAAS,EACb,SAASC,KAGR,OADAD,GAASA,GAAU,EAAK,WACjBA;cAKR;MAAME,GAAQh9C,EAAMC,OACnB,CACA6G,UAAW,aAEXm2C,SAAU,KAEVC,SAAS,EACTC,SAAS,EACTC,MAAO,EACP32B,KAAM,EAMNzd,KAAM,WAIL,OAFAzI,KAAK08C,SAAWtwC,EAAK1C,KAAK5B,QAC1B9H,KAAKyK,MAAM,GACJzK,MAGR6I,OAAQ,WAEP7I,KAAKgK,QACLhK,KAAK08C,SAASh0C,QAOf5I,MAAO,WAEN,OAAOE,KAAK08C,SAASv8C,QAOtBmP,IAAK,SAAU+gC,GAUd,OARArwC,KAAK08C,SAAS/xC,KAAK0lC,IAEE,IAAjBrwC,KAAK28C,SAAsC,OAAjB38C,KAAK48C,UAElC58C,KAAK48C,QAAU58C,KAAK08C,SAASlyC,OAC7BxK,KAAK68C,MAAQL,MAGPnM,GAOR3lC,MAAO,WAEN,IAAIoyC,EAAQL,GAAM30C,QAElB,IAAK,IAAImoC,EAAOjwC,KAAK08C,SAASnyC,IAAc,OAAT0lC,EAAeA,EAAOA,EAAKlmC,KAC7D+yC,EAAMJ,SAAS/xC,KAAKslC,EAAK5wC,MAAMqL,SAEhC,OAAOoyC,GAOR9yC,MAAO,WAKN,OAHAhK,KAAK08C,SAAS1yC,QACdhK,KAAKyK,MAAM,GAEJzK,MAORyK,MAAO,SAAUyb,EAAK,GAOrB,OALAlmB,KAAK28C,SAAU,EACf38C,KAAK48C,QAAU,KACf58C,KAAKkmB,KAAOA,EACZlmB,KAAK68C,MAAQL,KAENx8C,MAOR+8C,QAAS,WAKR,OAHA/8C,KAAK28C,SAAU,EACf38C,KAAK68C,MAAQL,KAENx8C,MAORg9C,WAAY,WAQX,OANqB,IAAjBh9C,KAAK28C,UAER38C,KAAK48C,QAAU58C,KAAK08C,SAASnyC,IAC7BvK,KAAK28C,SAAU,GAGQ,OAAjB38C,KAAK48C,SAOb1oB,OAAQ,SAAUiT,GAEjB,MAAQnnC,KAAKg9C,cACb,CACC,IAAI56B,EAAIpiB,KAAK48C,QAAQv9C,MAAM60B,OAAOiT,EAAMnnC,MACxC,IAAU,IAANoiB,EAAY,OAAOA,EAEvBpiB,KAAK48C,QAAU58C,KAAK48C,QAAQ7yC,KAG7B,OAAO,KAcT9D,EAASC,SAASu2C,GAAO,M,IACzBQ,GAAeR;gBC7Jf;MAAMS,GAAUz9C,EAAMC,OACrB,CACA6G,UAAW,eAKX42C,GAAI,KAKJC,SAAS,EAKTl3B,KAAM,EAKNm3B,MAAO,KAKPh+C,MAAO,KAKPo2B,SAAU,EAAG6nB,UAAW,EAKxBx9C,MAAO,EAAGy9C,OAAQ,EAKlBC,WAAY,EAAGC,YAAa,EAK5BC,SAAU,EAAGC,UAAW,EAKxBjoB,OAAQ,KAERkoB,KAAM,KACNC,MAAO,KAKPf,MAAO,KAKPgB,OAAQ,KAKRlkB,MAAO,KAKP0W,IAAK,KAKLzkC,GAAI,KAMJpD,KAAM,SAAU00C,EAAIY,GAenB,OAbA/9C,KAAKm9C,GAAKA,EACVn9C,KAAKo9C,SAAU,EAEfp9C,KAAK88C,MAAQ,KACb98C,KAAK89C,OAAS,KAEd99C,KAAK45B,MAAQ,KACb55B,KAAKswC,IAAM,KACXtwC,KAAK6L,GAAK,MAEO,IAAbkyC,GACHZ,EAAG10C,KAAKzI,MAAM,GAERA,MAGR6I,OAAQ,WAEY,OAAf7I,KAAK88C,OAAgB98C,KAAK88C,MAAM9yC,QAAQtB,OACxB,OAAhB1I,KAAK89C,QAAiB99C,KAAK89C,OAAO9zC,QAAQtB,QAG/CgC,MAAO,WAEN,IAAI2lC,EAAM6M,GAAQp1C,MAAM9H,KAAKm9C,IAAI,GAgBjC,GAdC9M,EAAIgN,MAAQr9C,KAAKq9C,MACjBhN,EAAIhxC,MAAQW,KAAKX,MACjBgxC,EAAI5a,SAAWz1B,KAAKy1B,SACpB4a,EAAIvwC,MAAQE,KAAKF,MACjBuwC,EAAImN,WAAax9C,KAAKw9C,WACtBnN,EAAIqN,SAAW19C,KAAK09C,SACpBrN,EAAI3a,OAAS11B,KAAK01B,OACnB2a,EAAIzW,MAAQ55B,KAAK45B,MACjByW,EAAIC,IAAMtwC,KAAKswC,IACfD,EAAIxkC,GAAK7L,KAAK6L,GAEK,OAAf7L,KAAK88C,QACRzM,EAAIyM,MAAQ98C,KAAK88C,MAAMpyC,SAEJ,OAAhB1K,KAAK89C,OACT,CACCzN,EAAIyN,OAAS1xC,EAAK1C,KAAK5B,QAEvB,IAAK,IAAImoC,EAAOjwC,KAAK89C,OAAOvzC,IAAc,OAAT0lC,EAAeA,EAAOA,EAAKlmC,KAC3DsmC,EAAIyN,OAAOnzC,KAAKslC,EAAK5wC,MAAMqL,SAG7B,OAAO2lC,GAOR2N,MAAO,WAENh+C,KAAKm9C,GAAG10C,KAAKzI,MAAM,IAOpBk0B,OAAQ,SAASiT,EAAM2V,GAEtB,OAAO98C,KAAKm9C,GAAGjpB,OAAOiT,EAAM2V,EAAO98C,SAcrCiG,EAASC,SAASg3C,I,IAClBe,GAAef,GC5KfgB,GACA,CACCz1C,KAAM,SAAS4nC,EAAK8N,GAAS,GAE5B,IAAKA,EAIJ,OAFA9N,EAAIyM,MAAQG,GAAMn1C,aAClBuoC,EAAIyN,OAAS1xC,EAAK1C,KAAK5B,SAIxB,IAAI5H,EAEJ,KAA2C,OAAnCA,EAAImwC,EAAIyM,MAAMJ,SAASjxC,UAC/B,CACC,IAAIqxC,EAAQG,GAAMn1C,QAClBg1C,EAAMxtC,IAAIpP,GACVmwC,EAAIyN,OAAOnzC,KAAKmyC,GAGjBzM,EAAIyM,MAAMp0C,OACV2nC,EAAIyM,MAAQ,MAGb5oB,OAAQ,SAAUiT,EAAM2V,EAAOzM,GAE9B,IAAoB,IAAhBA,EAAI+M,QACR,CACC,IAAK,IAAIl9C,EAAImwC,EAAIyN,OAAOvzC,IAAW,OAANrK,EAAYA,EAAIA,EAAE6J,KAE9C7J,EAAEb,MAAMoL,MAAOqyC,EAAM52B,MAGtBmqB,EAAI+M,SAAU,EAGf,IAAIl3B,EAAO42B,EAAM52B,KACbze,EAAI,EAAGqyB,EAAI,EAEf,IAAK,IAAI55B,EAAImwC,EAAIyN,OAAOvzC,IAAW,OAANrK,EAAYA,EAAIA,EAAE6J,KAC/C,CACC,IAAIqY,EAAIliB,EAAEb,MAAM60B,OAAOiT,IACb,IAAN/kB,EAAY3a,IAAoB,OAAN2a,GAAY0X,IAEtC55B,EAAEb,MAAM6mB,KAAOA,IAClBA,EAAOhmB,EAAEb,MAAM6mB,MAGjB,OAAIze,EAAGqyB,GAAMuW,EAAIyN,OAAO39C,SAGxBkwC,EAAI+M,SAAU,EACdN,EAAM52B,KAAOA,GAEN,KCvDTk4B,GACA,CACC31C,KAAM,SAAS4nC,EAAK8N,GAAS,GAEvBA,IACJ9N,EAAIyM,MAAQG,GAAMn1C,UAGpBosB,OAAQ,SAASiT,EAAM2V,EAAOzM,IAET,IAAhBA,EAAI+M,UAEP/M,EAAIyM,MAAMryC,MAAOqyC,EAAM52B,MACvBmqB,EAAI+M,SAAU,GAGf,IAAIh7B,EAAIiuB,EAAIyM,MAAM5oB,OAAOiT,GACzB,OAAU,IAAN/kB,EAAmBA,GAEvBiuB,EAAI+M,SAAU,EACdN,EAAM52B,KAAOmqB,EAAIyM,MAAM52B,MAChB,KCrBTm4B,GACA,CACC51C,KAAM,SAAS4nC,EAAK8N,GAAS,GAEvBA,IACJ9N,EAAIyM,MAAQG,GAAMn1C,UAGpBosB,OAAQ,SAASiT,EAAM2V,EAAOzM,IAET,IAAhBA,EAAI+M,UAEP/M,EAAIyM,MAAMryC,MAAOqyC,EAAM52B,MACvBmqB,EAAIkN,OAASlN,EAAIvwC,MAEjBuwC,EAAI+M,SAAU,GAGf,IAAIh7B,EAAIiuB,EAAIyM,MAAM5oB,OAAOiT,GACzB,OAAU,IAAN/kB,EAAmBA,EAEnBiuB,EAAIkN,QAAU,GAEjBlN,EAAI+M,SAAU,EACdN,EAAM52B,KAAOmqB,EAAIyM,MAAM52B,MAChB,IAGRmqB,EAAIyM,MAAMC,UACV1M,EAAIkN,UACG,KChCTe,GACA,CACC71C,KAAM,SAAS4nC,EAAK8N,GAAS,KAI7BjqB,OAAQ,SAASiT,EAAM2V,EAAOzM,GAG7B,OADAlJ,EAAKoX,SAASlO,EAAIgN,MAAOlW,EAAKqX,SAASnO,EAAIgN,MAAOhN,EAAIhxC,SAC/C,ICTTo/C,GACA,CACCh2C,KAAM,SAAS4nC,EAAK8N,GAAS,KAI7BjqB,OAAQ,SAASiT,EAAM2V,EAAOzM,GAG7B,OADAyM,EAAMC,WACC,ICPT2B,GACA,CACCj2C,KAAM,SAAS4nC,EAAK8N,GAAS,KAI7BjqB,OAAQ,SAASiT,EAAM2V,EAAOzM,GAQ7B,OANoB,IAAhBA,EAAI+M,UAEP/M,EAAIiN,UAA0C,WAA9B1yC,EAAK+zC,OAAOtO,EAAI5a,UAAyB0R,EAAKqX,SAASnO,EAAI5a,UAAY4a,EAAI5a,SAC3F4a,EAAI+M,SAAU,KAGXjW,EAAKjhB,KAAO42B,EAAM52B,KAAOmqB,EAAIiN,aAGjCjN,EAAI+M,SAAU,EACdN,EAAM52B,MAAQmqB,EAAIiN,WACX,KCnBTsB,GACA,CACCn2C,KAAM,SAAS4nC,EAAK8N,GAAS,KAI7BjqB,OAAQ,SAASiT,EAAM2V,EAAOzM,IAET,IAAhBA,EAAI+M,UAEP/M,EAAIoN,YAActW,EAAKqX,SAASnO,EAAIgN,MAAOhN,EAAImN,YAC/CnN,EAAIiN,UAA0C,WAA9B1yC,EAAK+zC,OAAOtO,EAAI5a,UAAyB0R,EAAKqX,SAASnO,EAAI5a,UAAY4a,EAAI5a,SAE3F4a,EAAI+M,SAAU,GAGf/M,EAAIsN,UAAYxW,EAAKqX,SAASnO,EAAIgN,MAAOhN,EAAIqN,SAAUrN,EAAIoN,aAE3D,IAAI7nB,EAAI,EAUR,OARIuR,EAAKjhB,KAAO42B,EAAM52B,KAAOmqB,EAAIiN,YAChC1nB,GAAKuR,EAAKjhB,KAAO42B,EAAM52B,MAAQmqB,EAAIiN,WAEhCjN,EAAI3a,QAAe,GAALE,EACjBuR,EAAKoX,SAASlO,EAAIgN,MAAOhN,EAAI3a,OAAOE,IAAIya,EAAIsN,UAAYtN,EAAIoN,aAAepN,EAAIoN,aAE/EtW,EAAKoX,SAASlO,EAAIgN,MAAOznB,GAAGya,EAAIsN,UAAYtN,EAAIoN,aAAepN,EAAIoN,aAE3D,GAAL7nB,IAGJya,EAAI+M,SAAU,EACdN,EAAM52B,MAAQmqB,EAAIiN,WAEX,KClCTuB,GACA,CACCp2C,KAAM,SAAS4nC,EAAK8N,GAAS,KAI7BjqB,OAAQ,SAASiT,EAAM2V,EAAOzM,IAET,IAAhBA,EAAI+M,UAEP/M,EAAIiN,UAA0C,WAA9B1yC,EAAK+zC,OAAOtO,EAAI5a,UAAyB0R,EAAKqX,SAASnO,EAAI5a,UAAY4a,EAAI5a,SAC3F4a,EAAIwN,MAAQ,KAEZxN,EAAI+M,SAAU,GAGf,IAAIxnB,EAAI,EAUR,GARIuR,EAAKjhB,KAAO42B,EAAM52B,KAAOmqB,EAAIiN,YAChC1nB,GAAKuR,EAAKjhB,KAAO42B,EAAM52B,MAAQmqB,EAAIiN,WAEhCjN,EAAI3a,QAAe,GAALE,EACjBya,EAAIuN,KAAOn3C,IAAI4pC,EAAI3a,OAAOE,GAAGya,EAAIvwC,OAEjCuwC,EAAIuN,KAAOn3C,IAAImvB,EAAEya,EAAIvwC,OAElBuwC,EAAIuN,MAAQvN,EAAIwN,MACpB,CACC,IAAIthB,EAAM4K,EAAKqX,SAASnO,EAAIgN,OAE5B,OAAa,CAEZ,GADQ52C,IAAIiB,KAAK8kB,UAAU6jB,EAAIqN,SAAWrN,EAAImN,WAAa,IAAMnN,EAAImN,YAC5DjhB,EAAK,MAGf4K,EAAKoX,SAASlO,EAAIgN,MAAOn9C,GACzBmwC,EAAIwN,MAAQxN,EAAIuN,KAGjB,OAAS,GAALhoB,IAGJya,EAAI+M,SAAU,EACdN,EAAM52B,MAAQmqB,EAAIiN,WAEX,KC7CTwB,GACA,CACCr2C,KAAM,SAAS4nC,EAAK8N,GAAS,GAE5B,IAAKA,EAAU,OAEf,IAAIvkB,EAAQ,GAEZ,IAAK,IAAI15B,EAAI,EAAGA,EAAImwC,EAAIvwC,MAAOI,IAC9B05B,EAAMjvB,KAAMzK,GAAMmwC,EAAIqN,SAAWrN,EAAImN,WAAa,GAAMnN,EAAImN,YAE7D,IAAK,IAAIrjC,EAAIk2B,EAAIvwC,OAAS,EAAGqa,EAAI,EAAGA,IACpC,CACC,IAAI9Z,EAAIoG,IAAIiB,KAAK8kB,SAAW6jB,EAAIvwC,OAC5BQ,EAAImG,IAAIiB,KAAK8kB,SAAW6jB,EAAIvwC,OAE5BS,EAAIq5B,EAAMt5B,GACds5B,EAAMt5B,GAAKs5B,EAAMv5B,GACjBu5B,EAAMv5B,GAAKE,EAGZ8vC,EAAIzW,MAAQA,GAGb1F,OAAQ,SAASiT,EAAM2V,EAAOzM,IAET,IAAhBA,EAAI+M,UAEP/M,EAAIiN,UAA0C,WAA9B1yC,EAAK+zC,OAAOtO,EAAI5a,UAAyB0R,EAAKqX,SAASnO,EAAI5a,UAAY4a,EAAI5a,SAC3F4a,EAAI+M,SAAU,GAGf,IACIl9C,EADA01B,EAAI,EAaR,OAVIuR,EAAKjhB,KAAO42B,EAAM52B,KAAOmqB,EAAIiN,YAChC1nB,GAAKuR,EAAKjhB,KAAO42B,EAAM52B,MAAQmqB,EAAIiN,WAGnCp9C,EADGmwC,EAAI3a,QAAe,GAALE,EACbya,EAAI3a,OAAOE,IAAIya,EAAIvwC,MAAM,GAEzB81B,GAAGya,EAAIvwC,MAAM,GAElBqnC,EAAKoX,SAASlO,EAAIgN,MAAOhN,EAAIzW,MAAMnzB,KAAKvG,EAAImwC,EAAIvwC,OAASuwC,EAAIvwC,SAEpD,GAAL81B,IAGJya,EAAI+M,SAAU,EACdN,EAAM52B,MAAQmqB,EAAIiN,WAEX,KCrDTyB,GACA,CACCt2C,KAAM,SAAU4nC,EAAK8N,GAAS,KAI9BjqB,OAAQ,SAAUiT,EAAM2V,EAAOzM,IAEV,IAAhBA,EAAI+M,UAEP/M,EAAIwN,MAAQ1W,EAAKjhB,KACjBmqB,EAAI+M,SAAU,EACd/M,EAAInqB,KAAOihB,EAAKjhB,MAGjB,IAAIoP,EAAK6R,EAAKjhB,KAAOmqB,EAAIwN,MAKzB,OAJAxN,EAAIwN,MAAQ1W,EAAKjhB,KACjBmqB,EAAInqB,MAAQoP,GAGF,IADF+a,EAAIxkC,GAAGypB,EAAI6R,EAAKz2B,KAAM2/B,EAAKlJ,KAGnCkJ,EAAI+M,SAAU,GACP,KCvBT4B,GACA,CACCv2C,KAAM,SAAU4nC,EAAK8N,GAAS,KAI9BjqB,OAAQ,SAAUiT,EAAM2V,EAAOzM,GAG9B,OADAA,EAAIC,IAAIpI,QACD;;ACuBT,MAAM+W,GAAOx/C,EAAMC,OAClB,CACA6G,UAAW,OAEX24C,YAAa,KACbC,WAAY,KACZC,SAAU,KACVtC,MAAO,KAEP/V,iBAAkB,KAClBC,wBAAyB,KACzBC,wBAAyB,KAMzBv2B,KAAM,KAMNof,UAAW,EAMX5J,KAAM,EAMN8P,QAAQ,EAMR6Q,UAAU,EAMVwY,SAAS,EAMTC,aAAa,EAObv/C,OAAQ,WAiBP,OAdAC,KAAKk/C,YAAc,GACnBl/C,KAAK0Q,KAAO,GAEZ1Q,KAAK88C,MAAQG,GAAMn1C,QACnB9H,KAAKm/C,WAAa/yC,EAAK1C,KAAK5B,QAC5B9H,KAAKo/C,SAAWhzC,EAAK1C,KAAK5B,QAE1B9H,KAAKq/C,SAAU,EACfr/C,KAAKs/C,aAAc,EAEnBt/C,KAAK+mC,iBAAmB,KACxB/mC,KAAKgnC,wBAA0B,KAC/BhnC,KAAKinC,wBAA0B,KAExBjnC,KAAKyK,SAMb5B,OAAQ,WAEP7I,KAAK88C,MAAMp0C,OACX1I,KAAKm/C,WAAWn1C,QAAQtB,OACxB1I,KAAKo/C,SAASp1C,QAAQtB,OAEe,OAAjC1I,KAAKgnC,0BAERhnC,KAAKgnC,wBAAwBt+B,OAC7B1I,KAAKgnC,wBAA0B,MAGK,OAAjChnC,KAAKinC,0BAERjnC,KAAKinC,wBAAwBv+B,OAC7B1I,KAAKinC,wBAA0B,OAUjCsY,OAAQ,SAAU3uC,GAQjB,OANAA,EAAO5G,QAEPc,QAAQ8F,EAAOksC,OACflsC,EAAOksC,MAAQ98C,KAAK88C,MAAMpyC,QAE1BkG,EAAOsuC,YAAcl/C,KAAKk/C,YACnBtuC,EAAOnG,SASfC,MAAO,SAAU40C,GAAY,GAE5B,IAAInY,EAAO,IAAI8X,GAIf,OAHA9X,EAAKmY,YAAcA,EAEnBt/C,KAAKu/C,OAAOpY,GACLA,GASRG,WAAY,SAAU96B,GAGrB,OADAxM,KAAK+mC,iBAAmBv6B,EACjBxM,MAURq4B,KAAM,SAAU7rB,EAAUV,EAAQ,MAEjC,OAAKU,GAEDxM,KAAK+mC,mBAAqB/mC,KAAKunC,eAElCvnC,KAAK+mC,iBAAmB/mC,KAAKunC,aAEQ,OAAjCvnC,KAAKgnC,yBAERhnC,KAAKgnC,wBAA0B56B,EAAK1C,KAAK5B,QACzC9H,KAAKinC,wBAA0B76B,EAAK1C,KAAK5B,UAIzC9H,KAAKgnC,wBAAwBv8B,QAC7BzK,KAAKinC,wBAAwBx8B,UAI/BzK,KAAKgnC,wBAAwBr8B,KAAK6B,GAClCxM,KAAKinC,wBAAwBt8B,KAAKmB,GAC3B9L,MApBeA,MAuBvBunC,aAAc,SAAU72B,EAAMwgB,GAE7B,IAAKA,EAAK8V,wBAAwB7mC,OACjC,OAAO,EAER,IAAI2L,EAAUolB,EAAK+V,wBAAwBx7B,QAC3C,OAAOylB,EAAK8V,wBAAwBv7B,OAA7BylB,CAAqCA,EAAMplB,IAQnD9B,MAAO,WAwBN,OAtBAhK,KAAKm/C,WAAWn1C,QAChBhK,KAAKo/C,SAASp1C,QACdhK,KAAK88C,MAAM9yC,QAEXhK,KAAKg2B,QAAS,EACdh2B,KAAK6mC,UAAW,EAChB7mC,KAAKkmB,KAAO,EACZlmB,KAAK8vB,UAAY,EAEoB,OAAjC9vB,KAAKgnC,0BAERhnC,KAAKgnC,wBAAwBt+B,OAC7B1I,KAAKgnC,wBAA0B,MAGK,OAAjChnC,KAAKinC,0BAERjnC,KAAKinC,wBAAwBv+B,OAC7B1I,KAAKinC,wBAA0B,MAGhCjnC,KAAK+mC,iBAAmB,KACjB/mC,MAQRyK,MAAO,WAYN,OAVAzK,KAAKm/C,WAAWn1C,QAChBhK,KAAKo/C,SAASp1C,QACdhK,KAAK88C,MAAMryC,QAEXzK,KAAKg2B,QAAS,EACdh2B,KAAK6mC,UAAW,EAChB7mC,KAAKkmB,KAAO,EACZlmB,KAAK8vB,UAAY,EAEjBjC,OAAOC,OAAQ9tB,KAAK0Q,KAAM1Q,KAAKk/C,aACxBl/C,MAQRo0C,QAAS,WAWR,OATAp0C,KAAKm/C,WAAWn1C,QAChBhK,KAAKo/C,SAASp1C,QACdhK,KAAK88C,MAAM9yC,QAEXhK,KAAKg2B,QAAS,EACdh2B,KAAK6mC,UAAW,EAChB7mC,KAAKkmB,KAAO,EACZlmB,KAAK8vB,UAAY,EAEV9vB,MAcRw/C,QAAS,SAAU9uC,EAAK,MAMvB,OAJa,OAATA,IACH1Q,KAAKk/C,YAAcxuC,GAEpBmd,OAAOC,OAAQ9tB,KAAK0Q,KAAM1Q,KAAKk/C,aACxBl/C,MASRy/C,MAAO,SAAUpgD,GAGhB,OADAW,KAAK8vB,UAAYzwB,EAAQ,EAAMA,EAAQ,EAChCW,MASRmtC,OAAQ,SAAUz8B,GAGjB,OADA1Q,KAAK0Q,KAAOA,EACL1Q,MAQR6zB,MAAO,WAKN,OAHK7zB,KAAKg2B,SACTh2B,KAAKg2B,QAAS,GAERh2B,MAQR8zB,OAAQ,WAQP,OANA9zB,KAAK6mC,UAAW,EAChB7mC,KAAKg2B,QAAS,EAETh2B,KAAKq/C,SACTr/C,KAAK0/C,KAAI,GAEH1/C,MASR0/C,IAAK,SAAUj1C,GAAM,GAEpB,OAAIzK,KAAKq/C,UAGI,GAAT50C,GACHzK,KAAKyK,QAEN6xC,GAAIpoB,OAAO5kB,IAAItP,KAAKk0B,OAAQl0B,MAC5BA,KAAKq/C,SAAU,GANPr/C,MAgBTu+C,SAAU,SAAUoB,EAAWtgD,GAE9B,IAAIugD,EAAO5/C,KAAK0Q,KAEhB,GAA0B,iBAAfivC,EAEV,GAA0B,mBAAfA,EAEVA,EAAW3/C,KAAMX,OAGlB,CACC,IAAIa,EAAI,EAER,KAAgB,OAAT0/C,GAAiB1/C,EAAIy/C,EAAUx/C,OAAO,GAC5Cy/C,EAAOA,EAAKD,EAAUz/C,MAEvB0/C,EAAKD,EAAUz/C,IAAMb,OAItBugD,EAAKD,GAAatgD,GAUpBm/C,SAAU,SAAUmB,EAAWtgD,EAAM,KAAMwgD,EAAa,MAEvD,IAAID,EAAO5/C,KAAK0Q,KAEhB,GAA0B,iBAAfivC,EAEV,GAA0B,mBAAfA,EAEVC,EAAOD,EAAW3/C,KAAM,UAGzB,CACC,IAAIE,EAAI,EAER,KAAgB,OAAT0/C,GAAiB1/C,EAAIy/C,EAAUx/C,QACrCy/C,EAAOA,EAAKD,EAAUz/C,WAIxB0/C,EAAOA,EAAKD,GAQb,GANc,OAAVtgD,IACHA,EAAQugD,GAEY,OAAjBC,IACHA,EAAeD,GAEM,iBAAXvgD,EAEV,OAAOA,EAAM,IAEZ,IAAK,IACJA,EAAQwgD,EAAeC,OAAOzgD,EAAM8nB,OAAO,IAC3C,MAED,IAAK,IACJ9nB,EAAQwgD,EAAeC,OAAOzgD,EAAM8nB,OAAO,IAC3C,MAED,QACC9nB,EAAQygD,OAAOzgD,OAIS,mBAAXA,IACfA,EAAQA,EAAOugD,EAAMC,EAAc7/C,OAEpC,OAAOX,GAWR60B,OAAQ,SAAUoB,EAAIpE,EAAK,MAK1B,GAHa,OAATA,IACHA,EAAOlxB,MAEJkxB,EAAK8E,QAAU9E,EAAK4rB,MAAME,aAG7B,OADA9rB,EAAKmuB,SAAU,GACR,EAKR,GAFAnuB,EAAKhL,MAAQoP,EAAGpE,EAAKpB,UAAUmvB,GAAKnvB,WAEJ,IAA5BoB,EAAK4rB,MAAM5oB,OAAOhD,GACrB,OAAO,EAER,IAAI2V,EAAW3V,EAAK2V,SAChBgW,EAAQ3rB,EAAK4rB,MAAMD,MACnBC,EAAQ5rB,EAAK4rB,MAIjB,OAFA5rB,EAAK2V,UAAW,EAEXA,GAAsC,OAA1B3V,EAAK6V,oBAE0B,IAA3C7V,EAAK6V,iBAAiB7V,EAAKxgB,KAAMwgB,KACpCA,EAAK6V,iBAAmB,MAErB7V,EAAK4rB,QAAUA,GAAS5rB,EAAK4rB,MAAMD,OAASA,IAOjD3rB,EAAKmuB,SAAU,EAEXnuB,EAAKouB,aACRx0C,QAAQomB,IAEF,IAVLA,EAAK4C,UACE,IAiBVisB,iBAAkB,SAAU1gD,GAE3B,MAAsB,mBAAXA,EACHA,GAEqB,GAAtBA,EAAMwV,QAAQ,KAAaxV,EAAMiV,MAAM,KAAOjV,GAUtD2gD,SAAU,WAET,IAAI3P,EAAMrwC,KAAK88C,MAAMxtC,IAAI2uC,GAAQn2C,MAAMo2C,KAMvC,OAJAl+C,KAAKm/C,WAAWx0C,KAAM3K,KAAK88C,OAC3B98C,KAAKo/C,SAASz0C,KAAM0lC,GAEpBrwC,KAAK88C,MAAQzM,EAAIyM,MACV98C,MAQRigD,OAAQ,WAEP,IAAI5P,EAAMrwC,KAAK88C,MAAMxtC,IAAI2uC,GAAQn2C,MAAMs2C,KAMvC,OAJAp+C,KAAKm/C,WAAWx0C,KAAM3K,KAAK88C,OAC3B98C,KAAKo/C,SAASz0C,KAAM0lC,GAEpBrwC,KAAK88C,MAAQzM,EAAIyM,MACV98C,MASRo8B,OAAQ,SAAUt8B,GAEjB,IAAIuwC,EAAMrwC,KAAK88C,MAAMxtC,IAAI2uC,GAAQn2C,MAAMu2C,KAOvC,OANAhO,EAAIvwC,MAAQA,EAEZE,KAAKm/C,WAAWx0C,KAAM3K,KAAK88C,OAC3B98C,KAAKo/C,SAASz0C,KAAM0lC,GAEpBrwC,KAAK88C,MAAQzM,EAAIyM,MACV98C,MAQRgpB,IAAK,WAIJ,OAFAhpB,KAAKo/C,SAAS1zC,MAAMsyC,QACpBh+C,KAAK88C,MAAQ98C,KAAKm/C,WAAWzzC,MACtB1L,MAURoO,IAAK,SAAUivC,EAAOh+C,GAErB,IAAIgxC,EAAMrwC,KAAK88C,MAAMxtC,IAAI2uC,GAAQn2C,MAAMw2C,KAKvC,OAHAjO,EAAIgN,MAAQr9C,KAAK+/C,iBAAiB1C,GAClChN,EAAIhxC,MAAQA,EAELW,MAQR+8C,QAAS,WAGR,OADA/8C,KAAK88C,MAAMxtC,IAAI2uC,GAAQn2C,MAAM22C,KACtBz+C,MASRkgD,KAAM,SAAUzqB,GAMf,OAJUz1B,KAAK88C,MAAMxtC,IAAI2uC,GAAQn2C,MAAM42C,KAEnCjpB,SAAWA,EAERz1B,MAaRmgD,MAAO,SAAU9C,EAAO5nB,EAAU+nB,EAAYE,EAAUhoB,EAAO,MAE9D,IAAI2a,EAAMrwC,KAAK88C,MAAMxtC,IAAI2uC,GAAQn2C,MAAM82C,KAQvC,OANAvO,EAAIgN,MAAQr9C,KAAK+/C,iBAAiB1C,GAClChN,EAAI5a,SAAWA,EACf4a,EAAImN,WAAaA,EACjBnN,EAAIqN,SAAWA,EACfrN,EAAI3a,OAASA,EAEN11B,MAYRogD,QAAS,SAAU/C,EAAO5nB,EAAUioB,EAAUhoB,EAAO,MAEpD,IAAI2a,EAAMrwC,KAAK88C,MAAMxtC,IAAI2uC,GAAQn2C,MAAM82C,KAQvC,OANAvO,EAAIgN,MAAQr9C,KAAK+/C,iBAAiB1C,GAClChN,EAAI5a,SAAWA,EACf4a,EAAImN,WAAa,KACjBnN,EAAIqN,SAAWA,EACfrN,EAAI3a,OAASA,EAEN11B,MAcRq5B,KAAM,SAAUgkB,EAAO5nB,EAAU31B,EAAO09C,EAAYE,EAAUhoB,EAAO,MAEpE,IAAI2a,EAAMrwC,KAAK88C,MAAMxtC,IAAI2uC,GAAQn2C,MAAM+2C,KASvC,OAPAxO,EAAIgN,MAAQr9C,KAAK+/C,iBAAiB1C,GAClChN,EAAI5a,SAAWA,EACf4a,EAAIvwC,MAAQA,EACZuwC,EAAImN,WAAaA,EACjBnN,EAAIqN,SAAWA,EACfrN,EAAI3a,OAASA,EAEN11B,MAgBR05B,MAAO,SAAU2jB,EAAO5nB,EAAU31B,EAAO09C,EAAYE,EAAUhoB,GAE9D,IAAI2a,EAAMrwC,KAAK88C,MAAMxtC,IAAI2uC,GAAQn2C,MAAMg3C,KAWvC,OATAzO,EAAIgN,MAAQr9C,KAAK+/C,iBAAiB1C,GAClChN,EAAI5a,SAAWA,EACf4a,EAAIvwC,MAAQA,EACZuwC,EAAImN,WAAaA,EACjBnN,EAAIqN,SAAWA,EACfrN,EAAI3a,OAASA,EAEb2a,EAAI2N,QAEGh+C,MASRkoC,KAAM,SAAUoI,GAKf,OAHUtwC,KAAK88C,MAAMxtC,IAAI2uC,GAAQn2C,MAAMk3C,KACnC1O,IAAMA,EAEHtwC,MASRo1C,KAAM,SAAUvpC,GAKf,OAHU7L,KAAK88C,MAAMxtC,IAAI2uC,GAAQn2C,MAAMi3C,KACnClzC,GAAKA,EAEF7L,MAKRqgD,WAAY,SAAUlZ,EAAM9nC,GAE3B,GAAc,OAAVA,EACH,OAAO8nC,EAAKz2B,KAAK8yB,OAAO/gB,GAEzB0kB,EAAKz2B,KAAK7B,UAAUpI,IAAIpH,GAAS8nC,EAAKz2B,KAAK8yB,OAAO/gB,GAAI,IAGvD69B,WAAY,SAAUnZ,EAAM9nC,GAE3B,GAAc,OAAVA,EACH,OAAO8nC,EAAKz2B,KAAK8yB,OAAO9gB,GAEzBykB,EAAKz2B,KAAK7B,UAAU,EAAGpI,IAAIpH,GAAS8nC,EAAKz2B,KAAK8yB,OAAO9gB,KAStDpU,KAAM,SAAUjP,GAEf,OAAOW,KAAKoO,IAAIpO,KAAKqgD,WAAYhhD,IASlCkP,KAAM,SAAUlP,GAEf,OAAOW,KAAKoO,IAAIpO,KAAKsgD,WAAYjhD,IAUlCwf,SAAU,SAAUvf,EAAG6O,GAEtB,OAAOnO,KAAKoO,IAAIpO,KAAKqgD,WAAY/gD,GAAG8O,IAAIpO,KAAKsgD,WAAYnyC,IAW1DoyC,WAAY,SAAU9qB,EAAU+qB,EAAY9qB,GAE3C,OAAO11B,KAAKmgD,MAAMngD,KAAKqgD,WAAY5qB,EAAU,MAAO+qB,EAAa,EAAI,IAAM,KAAO94C,KAAKqB,IAAIy3C,GAAa9qB,IAWzG+qB,WAAY,SAAUhrB,EAAU+qB,EAAY9qB,GAE3C,OAAO11B,KAAKmgD,MAAMngD,KAAKsgD,WAAY7qB,EAAU,MAAO+qB,EAAa,EAAI,IAAM,KAAO94C,KAAKqB,IAAIy3C,GAAa9qB,IAazG7mB,UAAW,SAAU4mB,EAAUirB,EAAaC,EAAaC,EAASC,EAAQ,MAEzE,OAAO7gD,KAAKggD,WACRG,MAAMngD,KAAKqgD,WAAY5qB,EAAU,MAAOirB,EAAc,EAAI,IAAM,KAAOh5C,KAAKqB,IAAI23C,GAAcE,GAC9FT,MAAMngD,KAAKsgD,WAAY7qB,EAAU,MAAOkrB,EAAc,EAAI,IAAM,KAAOj5C,KAAKqB,IAAI43C,GAAcE,GAAoBD,GACnH53B,OAaJ/H,OAAQ,SAAUwU,EAAUqrB,EAAWC,EAAWH,EAAQ,KAAMC,EAAQ,MAEvE,OAAO7gD,KAAKggD,WACTG,MAAMngD,KAAKqgD,WAAY5qB,EAAU,KAAMqrB,EAAWF,GAClDT,MAAMngD,KAAKsgD,WAAY7qB,EAAU,KAAMsrB,EAAWF,GAAoBD,GACtE53B,OAUJg4B,MAAO,SAAUvrB,EAAUioB,EAAUhoB,EAAO,MAE3C,OAAO11B,KAAKmgD,MAAMngD,KAAKqgD,WAAY5qB,EAAU,KAAMioB,EAAUhoB,IAU9DurB,MAAO,SAAUxrB,EAAUioB,EAAUhoB,EAAO,MAE3C,OAAO11B,KAAKmgD,MAAMngD,KAAKsgD,WAAY7qB,EAAU,KAAMioB,EAAUhoB,IAU9DwrB,OAAQ,SAAUzrB,EAAUioB,EAAUhoB,GAErC,OAAO11B,KAAKmgD,MAAM,KAAM1qB,EAAU,KAAMioB,EAAUhoB,IAUnDyrB,OAAQ,SAAU1rB,EAAUioB,EAAUhoB,GAErC,OAAO11B,KAAKmgD,MAAM,KAAM1qB,EAAU,KAAMioB,EAAUhoB,IAanDjoB,MAAO,SAAUgoB,EAAUqrB,EAAWC,EAAWH,EAASC,EAAQ,MAEjE,OAAO7gD,KAAKggD,WACTG,MAAM,KAAM1qB,EAAU,KAAMqrB,EAAWF,GACvCT,MAAM,KAAM1qB,EAAU,KAAMsrB,EAAWF,GAAoBD,GAC3D53B,OAWJha,OAAQ,SAAUymB,EAAU+qB,EAAY9qB,GAEvC,OAAO11B,KAAKmgD,MAAM,QAAS1qB,EAAU,MAAO+qB,EAAa,EAAI,IAAM,KAAO94C,KAAKqB,IAAIy3C,GAAa9qB,MAQlGupB,GAAKnvB,UAAY,EAOjBmvB,GAAKQ,MAAQ,SAAUpgD,GAEtB4/C,GAAKnvB,UAAYzwB,EAAQ,EAAMA,EAAQ,GAGxC4G,EAASwD,WAAWw1C,GAAM,M,IAC1BmC,GAAenC;;;oBCp8Bf;MAAMoC,GAAc5hD,EAAMC,OACzB,CAIA6G,UAAW,cAMXyO,GAAI,KAMJwuB,OAAQ,KAMRzV,MAAO,EAMPrd,KAAM,KAMN4wC,IAAK,KAMLC,UAAW,KAKXC,kBAAmB,KAMnBC,QAAS,KAMT1hD,OAAQ,SAAUT,EAAG6O,EAAGsM,EAAOC,GAE9B1a,KAAKwjC,OAAS8V,GAAQ5vC,KAAK5B,QAE3B9H,KAAKwjC,OAAO30B,UAAWvP,EAAG6O,GAC1BnO,KAAKwjC,OAAOtjB,OAAQzF,EAAOC,GAAQ,GAEnC1a,KAAK+tB,MAAQszB,GAAYK,MAAQL,GAAYM,QAAUN,GAAYO,MAAQP,GAAYQ,WACvF7hD,KAAK0Q,KAAO,KACZ1Q,KAAKshD,IAAM,KAEXthD,KAAKyhD,QAAU/L,GAAQhsC,KAAK5B,MAAM9H,OAMnC6I,OAAQ,WAEP7I,KAAK8hD,OAAM,GAEO,OAAd9hD,KAAK0Q,OAER5F,QAAQ9K,KAAK0Q,MACb1Q,KAAK0Q,KAAO,MAGb1Q,KAAKyhD,QAAQrM,OACbp1C,KAAKyhD,QAAQ/4C,OAEb1I,KAAKwjC,OAAO96B,QAObq5C,MAAO,SAAU1iD,GAGhB,OADAW,KAAKgV,GAAK3V,EACHW,MAORgiD,SAAU,SAAU3iD,GAGnB,OADAW,KAAK+tB,OAAS1uB,EACPW,MAORiiD,WAAY,SAAU5iD,GAGrB,OADAW,KAAK+tB,QAAU1uB,EACRW,MAORkiD,SAAU,SAAUC,EAAS9iD,EAAM,MAElC,OAAc,OAAVA,GACKW,KAAK+tB,MAAQo0B,KAAaA,GAE3BniD,KAAK+tB,MAAQo0B,KAAa9iD,GAQnC+iD,QAAS,SAAU1xC,GAOlB,OALA1Q,KAAK0Q,KAAOA,EAEM,OAAd1Q,KAAK0Q,OACR1Q,KAAK0Q,KAAK2kC,KAAOr1C,MAEXA,MAORqiD,QAAS,WAER,OAAOriD,KAAK0Q,MAOb4xC,OAAQ,SAAUC,GAGjB,OADAviD,KAAKshD,IAAMiB,EACJviD,MAORwiD,OAAQ,WAEP,OAAOxiD,KAAKshD,KAQblM,KAAM,SAASlsC,EAAM2rC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMuN,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAE5H,OAAiB,OAAb5iD,KAAKshD,MAAkD,IAAlCthD,KAAKshD,IAAIptC,eAAehL,IAG1ClJ,KAAKshD,IAAIp4C,GAAOlJ,KAAM60C,EAAMC,EAAMC,EAAMC,EAAMC,EAAMC,EAAMuN,EAAMC,EAAMC,EAAMC,IAapFC,QAAS,SAAUxjD,EAAM,KAAM4oC,GAAO,GAErC,OAAc,OAAV5oC,KACOW,KAAK+tB,MAAQszB,GAAYM,WAErB,IAAX1Z,GAAgE,IAA3CjoC,KAAK+tB,MAAQszB,GAAYyB,gBAGlD9iD,KAAK+tB,QAAUszB,GAAYM,SACb,IAAVtiD,IAAgBW,KAAK+tB,OAASszB,GAAYM,UAHtC3hD,OAgBT+iD,YAAa,SAAU1jD,EAAM,MAE5B,OAAc,OAAVA,KACOW,KAAK+tB,MAAQszB,GAAYyB,eAEpC9iD,KAAK+tB,QAAUszB,GAAYyB,cACb,IAAVzjD,IAAgBW,KAAK+tB,OAASszB,GAAYyB,cAEvC9iD,OAWR8hD,MAAO,SAAUziD,EAAM,MAEtB,OAAc,OAAVA,KACOW,KAAK+tB,MAAQszB,GAAYK,QAEpC1hD,KAAK+tB,QAAUszB,GAAYK,OACb,IAAVriD,IAAgBW,KAAK+tB,OAASszB,GAAYK,OAEvC1hD,OAWRgjD,MAAO,SAAU3jD,EAAM,MAEtB,OAAc,OAAVA,KACOW,KAAK+tB,MAAQszB,GAAYO,QAEpC5hD,KAAK+tB,QAAUszB,GAAYO,OACb,IAAVviD,IAAgBW,KAAK+tB,OAASszB,GAAYO,OAEvC5hD,OAWRijD,iBAAkB,SAAU5jD,EAAM,MAEjC,OAAc,OAAVA,KACOW,KAAK+tB,MAAQszB,GAAY6B,qBAEpCljD,KAAK+tB,QAAUszB,GAAY6B,oBACb,IAAV7jD,IAAgBW,KAAK+tB,OAASszB,GAAY6B,oBAEvCljD,OAWRmjD,UAAW,SAAU9jD,EAAM,MAE1B,OAAc,OAAVA,KACOW,KAAK+tB,MAAQszB,GAAYQ,aAEpC7hD,KAAK+tB,QAAUszB,GAAYQ,YACb,IAAVxiD,IAAgBW,KAAK+tB,OAASszB,GAAYQ,YAEvC7hD,OAORoL,OAAQ,WAGP,OADApL,KAAKyhD,QAAQrM,OACNp1C,MAORojD,KAAM,WAEL,OAAuB,OAAnBpjD,KAAKuhD,YAA+E,IAAzDvhD,KAAKkiD,SAASb,GAAYK,MAAQL,GAAYO,QAG7E5hD,KAAKuhD,UAAU6B,KAAKpjD,MAFZA,MAUTkgB,OAAQ,SAAUzF,EAAOC,GAIxB,OAFA1a,KAAK+tB,OAASszB,GAAYO,MAC1B5hD,KAAKwjC,OAAOtjB,OAAQzF,EAAOC,GAAQ,GAC5B1a,MAORw2C,SAAU,SAAU2C,EAAQC,GAI3B,OAFAp5C,KAAK+tB,OAASszB,GAAYO,MAC1B5hD,KAAKwjC,OAAOgT,SAAU2C,EAAQC,GAAS,GAChCp5C,MAQR6O,UAAW,SAAUC,EAAIC,EAAI0pC,GAAS,GAIrC,OAFAz4C,KAAK+tB,OAASszB,GAAYO,MAC1B5hD,KAAKwjC,OAAO30B,UAAWC,EAAIC,EAAI0pC,GACxBz4C,MAWRqjD,YAAa,SAAU/jD,EAAG6O,GAAE,GAO3B,OALU,IAANA,IACHA,EAAI7O,EAAE6O,EACN7O,EAAIA,EAAEA,GAGAU,KAAK6O,UAAiB,OAANvP,EAAaw8B,QAAQx8B,GAAGU,KAAKwjC,OAAOsV,IAAM,EAAS,OAAN3qC,EAAa2tB,QAAQ3tB,GAAGnO,KAAKwjC,OAAOuV,IAAM,GAAG,MAOnHsI,GAAYK,MAAa,EACzBL,GAAYM,QAAc,EAC1BN,GAAYyB,aAAkB,EAC9BzB,GAAYO,MAAa,EACzBP,GAAY6B,mBAAsB,GAClC7B,GAAYQ,WAAgB,GAC5BR,GAAYiC,aAAgB,GAE5BjC,GAAYkC,QAAW,IACvBlC,GAAYmC,UAAY,IAMxBnC,GAAYoC,UAAY,WAEvB,IAAIC,EAAOrC,GAAYmC,UACvB,GAAa,aAATE,EAAsB,MAAM,IAAIl9C,MAAO,wDAK3C,OAHAk9C,IAAS,EACTrC,GAAYmC,UAAYE,EAEjBA,G,IAGRC,GAAetC;;;;ICwBfuC,GArbankD,EAAMC,OAClB,CAIA6G,UAAW,OAKXs9C,KAAM,KAMN/jD,MAAO,EAMPgkD,MAAO,EAAGC,MAAO,EAMjBC,GAAI,EAAGC,GAAI,EAKXC,OAAQ,EAMRC,oBAAoB,EAWpBpkD,OAAQ,SAAU0a,EAAOC,EAAQspC,EAAIC,EAAG,MAEvCxpC,EAAQ,GAAK/S,KAAK2+B,KAAK3+B,KAAK08C,KAAK3pC,IACjCC,EAAS,GAAKhT,KAAK2+B,KAAK3+B,KAAK08C,KAAK1pC,IAElC1a,KAAK8jD,MAAQrpC,GAAS,EACtBza,KAAK+jD,MAAQrpC,GAAU,EAEZ,OAAPupC,IACHA,EAAKD,GAENA,EAAKt8C,KAAKgI,MAAMhI,KAAK08C,KAAKJ,IAC1BC,EAAKv8C,KAAKgI,MAAMhI,KAAK08C,KAAKH,IAE1BjkD,KAAKgkD,GAAKA,EACVhkD,KAAKikD,GAAKA,EAEV,IAAI5iC,EAAI5G,GAASupC,EACb1iC,EAAI5G,GAAUupC,EAEb5iC,IACJ2iC,EAAKt8C,KAAK08C,KAAK3pC,GACf4G,EAAI,GAGAC,IACJ2iC,EAAKv8C,KAAK08C,KAAK1pC,GACf4G,EAAI,GAGLthB,KAAK6jD,KAAO,IAAIl9C,MAAM0a,EAAEC,GAAG1a,KAAK,MAChC5G,KAAKkkD,OAAS7iC,GAMfxY,OAAQ,WAEP7I,KAAKgK,QACLhK,KAAK6jD,KAAO,MAWb9M,OAAQ,SAAU13C,EAAM,MAEvB,OAAc,OAAVA,EACIW,KAAKmkD,oBAEbnkD,KAAKmkD,mBAAqB9kD,EACnBW,OAORgK,MAAO,WAEN,IAAK,IAAI9J,EAAI,EAAGA,EAAIF,KAAK6jD,KAAK1jD,OAAQD,IACtC,CACC,GAAqB,OAAjBF,KAAK6jD,KAAK3jD,GACb,SAED,IAAIsR,EAEJ,KAAsC,QAA9BA,EAAIxR,KAAK6jD,KAAK3jD,GAAGuL,UAExB+F,EAAEiwC,QAAQr2C,OAAOpL,KAAKqkD,QAASrkD,MAC/BwR,EAAE+vC,UAAY,KAEdz2C,QAAQ0G,GAGTxR,KAAK6jD,KAAK3jD,GAAGwI,OACb1I,KAAK6jD,KAAK3jD,GAAK,KAGhBF,KAAKF,MAAQ,GAOd2K,MAAO,WAEN,IAAK,IAAIvK,EAAI,EAAGA,EAAIF,KAAK6jD,KAAK1jD,OAAQD,IACtC,CACC,GAAqB,OAAjBF,KAAK6jD,KAAK3jD,GACb,SAED,IAAIsR,EAEJ,KAAsC,QAA9BA,EAAIxR,KAAK6jD,KAAK3jD,GAAGuL,UAExB+F,EAAEiwC,QAAQr2C,OAAOpL,KAAKqkD,QAASrkD,MAC/BwR,EAAE+vC,UAAY,KAGfvhD,KAAK6jD,KAAK3jD,GAAGwI,OACb1I,KAAK6jD,KAAK3jD,GAAK,KAGhBF,KAAKF,MAAQ,GAOdwP,IAAK,SAAU6O,GAEd,IAAqC,IAAjCwlC,GAAYt4C,WAAW8S,GAC1B,MAAM,IAAI3X,MAAO,kCAElB,IAAItG,EAAIuG,IAAI0X,EAAMqlB,OAAO9gB,GAAG1iB,KAAK+jD,OAAU/jD,KAAKikD,IAAMjkD,KAAKkkD,OAASz9C,IAAI0X,EAAMqlB,OAAO/gB,GAAGziB,KAAK8jD,OAAU9jD,KAAKgkD,IAC5G,QAAI9jD,EAAI,GAAKA,GAAKF,KAAK6jD,KAAK1jD,UAEP,OAAjBH,KAAK6jD,KAAK3jD,KACbF,KAAK6jD,KAAK3jD,GAAKkM,EAAK1C,KAAK5B,SAE1B9H,KAAK6jD,KAAK3jD,GAAGyK,KAAKwT,GAClBne,KAAKF,QAELqe,EAAKojC,UAAYvhD,KACjBme,EAAKqjC,kBAAoBrjC,EAAKsjC,QAAQnyC,IAAItP,KAAKqkD,QAASrkD,KAAME,EAAGF,KAAK6jD,KAAK3jD,GAAGsK,SAEvE,IAMR65C,QAAS,SAAUlmC,EAAM+S,EAAMtxB,EAAOqwC,GAMrC,OAJA/e,EAAK2yB,KAAKjkD,GAAOwL,OAAO6kC,GACxB/e,EAAKpxB,QAELqe,EAAKojC,UAAY,MACV,GAORn2C,OAAQ,SAAU+S,GAGjB,OADAA,EAAKsjC,QAAQhM,MAAMz1C,KAAKwhD,mBACjBrjC,GAQRilC,KAAM,SAAUjlC,GAEfA,EAAK8jC,WAAW0B,GAAY/B,OAE5B,IAAI3R,EAAO9xB,EAAKqjC,kBAEZthD,EAAIuG,IAAI0X,EAAMqlB,OAAO9gB,GAAG1iB,KAAK+jD,OAAU/jD,KAAKikD,IAAMjkD,KAAKkkD,OAASz9C,IAAI0X,EAAMqlB,OAAO/gB,GAAGziB,KAAK8jD,OAAU9jD,KAAKgkD,IAC5G,OAAI9jD,EAAI,GAAKA,GAAKF,KAAK6jD,KAAK1jD,QAE3Bge,EAAKsjC,QAAQhM,MAAMxF,IACZ,IAGJA,EAAK6E,OAAS50C,IAGlBF,KAAK6jD,KAAK5T,EAAK6E,MAAM1pC,OAAO6kC,EAAK8E,MAEZ,OAAjB/0C,KAAK6jD,KAAK3jD,KACbF,KAAK6jD,KAAK3jD,GAAKkM,EAAK1C,KAAK5B,SAE1B9H,KAAK6jD,KAAK3jD,GAAGyK,KAAKwT,GAElB8xB,EAAK6E,KAAO50C,EACZ+vC,EAAK8E,KAAO/0C,KAAK6jD,KAAK3jD,GAAGsK,SAVjB,IAoBT85C,gBAAiB,SAAU9gB,EAAQ+gB,EAAcC,EAAYh4C,EAAUV,GAEtE,IAAI24C,GAAMjhB,EAAQ9gB,GAAG1iB,KAAK+jD,OAAU,GAAG/jD,KAAKikD,GAAG,IAAMjkD,KAAKikD,IAAMjkD,KAAKkkD,OACjEQ,GAAMlhB,EAAQ5gB,GAAG5iB,KAAK+jD,OAAU,GAAG/jD,KAAKikD,GAAG,IAAMjkD,KAAKikD,IAAMjkD,KAAKkkD,OACjE3M,EAAM/T,EAAQ/gB,GAAGziB,KAAK8jD,OAAU,GAAG9jD,KAAKgkD,GAAG,IAAMhkD,KAAKgkD,GACtD7pC,EAAMqpB,EAAQ7gB,GAAG3iB,KAAK8jD,OAAU,GAAG9jD,KAAKgkD,GAAG,IAAMhkD,KAAKgkD,GAEtDv8C,EAAIzH,KAAK6jD,KAAK1jD,OAAO,EAErBskD,EAAK,IAAGA,EAAK,GAAOC,EAAK,IAAGA,EAAK,GACjCnN,EAAK,IAAGA,EAAK,GAAOp9B,EAAK,IAAGA,EAAK,GACjCsqC,EAAKh9C,IAAGg9C,EAAKh9C,GAAOi9C,EAAKj9C,IAAGi9C,EAAKj9C,GACjC8vC,EAAK9vC,IAAG8vC,EAAK9vC,GAAO0S,EAAK1S,IAAG0S,EAAK1S,GAErC,IAAK,IAAI+J,EAAIizC,EAAIjzC,GAAKkzC,EAAIlzC,GAAKxR,KAAKkkD,OAEnC,IAAK,IAAIhkD,EAAIq3C,EAAIr3C,GAAKia,EAAIja,IAC1B,CACC,IAAI25B,EAAIroB,EAAItR,EACZ,KAAI25B,EAAIpyB,GAAsB,OAAjBzH,KAAK6jD,KAAKhqB,IAEvB,IAAK,IAAIlZ,EAAI3gB,KAAK6jD,KAAKhqB,GAAGtvB,IAAKoW,EAAGA,EAAIA,EAAE5W,KACxC,CACC,MAAMsE,EAAIsS,EAAEthB,MAGZ,IAA6C,IAAzCgP,EAAE6zC,SAASqC,EAAcC,OAGG,IAA5BxkD,KAAKmkD,qBAAgC3yC,GAAKizC,EAAG,GAAKvkD,GAAKq3C,EAAG,GAAK/lC,GAAKkzC,EAAG,GAAKxkD,GAAKia,EAAG,KAEnF9L,EAAEm1B,OAAO7gB,GAAK6gB,EAAO/gB,IAAMpU,EAAEm1B,OAAO5gB,GAAK4gB,EAAO9gB,IAAMrU,EAAEm1B,OAAO/gB,GAAK+gB,EAAO7gB,IAAMtU,EAAEm1B,OAAO9gB,GAAK8gB,EAAO5gB,MAI9E,IAAzBpW,EAAS6B,EAAGvC,IACf,UAUL64C,eAAgB,SAAUnhB,EAAQ+gB,EAAcC,GAE/C,IAAIC,GAAMjhB,EAAQ9gB,GAAG1iB,KAAK+jD,OAAU,GAAG/jD,KAAKikD,GAAG,IAAMjkD,KAAKikD,IAAMjkD,KAAKkkD,OACjEQ,GAAMlhB,EAAQ5gB,GAAG5iB,KAAK+jD,OAAU,GAAG/jD,KAAKikD,GAAG,IAAMjkD,KAAKikD,IAAMjkD,KAAKkkD,OACjE3M,EAAM/T,EAAQ/gB,GAAGziB,KAAK8jD,OAAU,GAAG9jD,KAAKgkD,GAAG,IAAMhkD,KAAKgkD,GACtD7pC,EAAMqpB,EAAQ7gB,GAAG3iB,KAAK8jD,OAAU,GAAG9jD,KAAKgkD,GAAG,IAAMhkD,KAAKgkD,GAEtDv8C,EAAIzH,KAAK6jD,KAAK1jD,OAAO,EAErBskD,EAAK,IAAGA,EAAK,GAAOC,EAAK,IAAGA,EAAK,GACjCnN,EAAK,IAAGA,EAAK,GAAOp9B,EAAK,IAAGA,EAAK,GACjCsqC,EAAKh9C,IAAGg9C,EAAKh9C,GAAOi9C,EAAKj9C,IAAGi9C,EAAKj9C,GACjC8vC,EAAK9vC,IAAG8vC,EAAK9vC,GAAO0S,EAAK1S,IAAG0S,EAAK1S,GAErC,IAAI0B,EAAOiD,EAAK1C,KAAK5B,QAErB,IAAK,IAAI0J,EAAIizC,EAAIjzC,GAAKkzC,EAAIlzC,GAAKxR,KAAKkkD,OAEnC,IAAK,IAAIhkD,EAAIq3C,EAAIr3C,GAAKia,EAAIja,IAC1B,CACC,IAAI25B,EAAIroB,EAAItR,EACZ,KAAI25B,EAAIpyB,GAAsB,OAAjBzH,KAAK6jD,KAAKhqB,IAEvB,IAAK,IAAIlZ,EAAI3gB,KAAK6jD,KAAKhqB,GAAGtvB,IAAKoW,EAAGA,EAAIA,EAAE5W,KACxC,CACC,MAAMsE,EAAIsS,EAAEthB,OAGiC,IAAzCgP,EAAE6zC,SAASqC,EAAcC,MAGG,IAA5BxkD,KAAKmkD,qBAAgC3yC,GAAKizC,EAAG,GAAKvkD,GAAKq3C,EAAG,GAAK/lC,GAAKkzC,EAAG,GAAKxkD,GAAKia,EAAG,KAEnF9L,EAAEm1B,OAAO7gB,GAAK6gB,EAAO/gB,IAAMpU,EAAEm1B,OAAO5gB,GAAK4gB,EAAO9gB,IAAMrU,EAAEm1B,OAAO/gB,GAAK+gB,EAAO7gB,IAAMtU,EAAEm1B,OAAO9gB,GAAK8gB,EAAO5gB,KAI3GzZ,EAAKwB,KAAK0D,KAKb,OAAOlF,GAORy7C,cAAe,SAAUphB,EAAQ+gB,EAAcC,GAE9C,IAAIC,GAAMjhB,EAAQ9gB,GAAG1iB,KAAK+jD,OAAU,GAAG/jD,KAAKikD,GAAG,IAAMjkD,KAAKikD,IAAMjkD,KAAKkkD,OACjEQ,GAAMlhB,EAAQ5gB,GAAG5iB,KAAK+jD,OAAU,GAAG/jD,KAAKikD,GAAG,IAAMjkD,KAAKikD,IAAMjkD,KAAKkkD,OACjE3M,EAAM/T,EAAQ/gB,GAAGziB,KAAK8jD,OAAU,GAAG9jD,KAAKgkD,GAAG,IAAMhkD,KAAKgkD,GACtD7pC,EAAMqpB,EAAQ7gB,GAAG3iB,KAAK8jD,OAAU,GAAG9jD,KAAKgkD,GAAG,IAAMhkD,KAAKgkD,GAEtDv8C,EAAIzH,KAAK6jD,KAAK1jD,OAAO,EAErBskD,EAAK,IAAGA,EAAK,GAAOC,EAAK,IAAGA,EAAK,GACjCnN,EAAK,IAAGA,EAAK,GAAOp9B,EAAK,IAAGA,EAAK,GACjCsqC,EAAKh9C,IAAGg9C,EAAKh9C,GAAOi9C,EAAKj9C,IAAGi9C,EAAKj9C,GACjC8vC,EAAK9vC,IAAG8vC,EAAK9vC,GAAO0S,EAAK1S,IAAG0S,EAAK1S,GAErC,IAAIqyB,EAAI,EAER,IAAK,IAAItoB,EAAIizC,EAAIjzC,GAAKkzC,EAAIlzC,GAAKxR,KAAKkkD,OAEnC,IAAK,IAAIhkD,EAAIq3C,EAAIr3C,GAAKia,EAAIja,IAC1B,CACC,IAAI25B,EAAIroB,EAAItR,EACZ,KAAI25B,EAAIpyB,GAAsB,OAAjBzH,KAAK6jD,KAAKhqB,IAEvB,IAAK,IAAIlZ,EAAI3gB,KAAK6jD,KAAKhqB,GAAGtvB,IAAKoW,EAAGA,EAAIA,EAAE5W,KACxC,CACC,MAAMsE,EAAIsS,EAAEthB,OAGiC,IAAzCgP,EAAE6zC,SAASqC,EAAcC,MAGG,IAA5BxkD,KAAKmkD,qBAAgC3yC,GAAKizC,EAAG,GAAKvkD,GAAKq3C,EAAG,GAAK/lC,GAAKkzC,EAAG,GAAKxkD,GAAKia,EAAG,KAEnF9L,EAAEm1B,OAAO7gB,GAAK6gB,EAAO/gB,IAAMpU,EAAEm1B,OAAO5gB,GAAK4gB,EAAO9gB,IAAMrU,EAAEm1B,OAAO/gB,GAAK+gB,EAAO7gB,IAAMtU,EAAEm1B,OAAO9gB,GAAK8gB,EAAO5gB,KAI3GkX,MAKH,OAAOA,GAOR+qB,YAAa,SAAUrhB,EAAQ+gB,EAAcC,GAE5C,IAAIC,GAAMjhB,EAAQ9gB,GAAG1iB,KAAK+jD,OAAU,GAAG/jD,KAAKikD,GAAG,IAAMjkD,KAAKikD,IAAMjkD,KAAKkkD,OACjEQ,GAAMlhB,EAAQ5gB,GAAG5iB,KAAK+jD,OAAU,GAAG/jD,KAAKikD,GAAG,IAAMjkD,KAAKikD,IAAMjkD,KAAKkkD,OACjE3M,EAAM/T,EAAQ/gB,GAAGziB,KAAK8jD,OAAU,GAAG9jD,KAAKgkD,GAAG,IAAMhkD,KAAKgkD,GACtD7pC,EAAMqpB,EAAQ7gB,GAAG3iB,KAAK8jD,OAAU,GAAG9jD,KAAKgkD,GAAG,IAAMhkD,KAAKgkD,GAEtDv8C,EAAIzH,KAAK6jD,KAAK1jD,OAAO,EAErBskD,EAAK,IAAGA,EAAK,GAAOC,EAAK,IAAGA,EAAK,GACjCnN,EAAK,IAAGA,EAAK,GAAOp9B,EAAK,IAAGA,EAAK,GACjCsqC,EAAKh9C,IAAGg9C,EAAKh9C,GAAOi9C,EAAKj9C,IAAGi9C,EAAKj9C,GACjC8vC,EAAK9vC,IAAG8vC,EAAK9vC,GAAO0S,EAAK1S,IAAG0S,EAAK1S,GAErC,IAAK,IAAI+J,EAAIizC,EAAIjzC,GAAKkzC,EAAIlzC,GAAKxR,KAAKkkD,OAEnC,IAAK,IAAIhkD,EAAIq3C,EAAIr3C,GAAKia,EAAIja,IAC1B,CACC,IAAI25B,EAAIroB,EAAItR,EACZ,KAAI25B,EAAIpyB,GAAsB,OAAjBzH,KAAK6jD,KAAKhqB,IAEvB,IAAK,IAAIlZ,EAAI3gB,KAAK6jD,KAAKhqB,GAAGtvB,IAAKoW,EAAGA,EAAIA,EAAE5W,KACxC,CACC,MAAMsE,EAAIsS,EAAEthB,MAGZ,IAA6C,IAAzCgP,EAAE6zC,SAASqC,EAAcC,MAGG,IAA5BxkD,KAAKmkD,sBAAgC3yC,GAAKizC,EAAG,GAAKvkD,GAAKq3C,EAAG,GAAK/lC,GAAKkzC,EAAG,GAAKxkD,GAAKia,EAAG,MAEnF9L,EAAEm1B,OAAO7gB,GAAK6gB,EAAO/gB,IAAMpU,EAAEm1B,OAAO5gB,GAAK4gB,EAAO9gB,IAAMrU,EAAEm1B,OAAO/gB,GAAK+gB,EAAO7gB,IAAMtU,EAAEm1B,OAAO9gB,GAAK8gB,EAAO5gB,KAI3G,OAAOvU,GAKV,OAAO;kBCpbT;MAAMy2C,GAAYrlD,EAAMC,OACvB,CACA6G,UAAW,YAMXw+C,eAAgB,KAMhBtqC,MAAO,EAMPC,OAAQ,EAMRsL,OAAQ,EAMRg/B,MAAO,KAMPj3B,MAAO,EAMP3G,EAAG,KAMH69B,aAAc,EAMdC,UAAW,EAOXC,MAAO,KAUPplD,OAAQ,SAAU0a,EAAM,MAAOC,EAAO,OAErC1a,KAAKya,MAAQA,EACbza,KAAK0a,OAASA,EAEd1a,KAAK+tB,MAAQ+2B,GAAUnD,QAAUmD,GAAUjD,WAC3C7hD,KAAKmlD,MAAQzP,GAAQhsC,KAAK5B,MAAM9H,OAMjC6I,OAAQ,WAEP7I,KAAKmlD,MAAMz8C,QAWZm6C,QAAS,SAAUxjD,EAAM,MAExB,OAAc,OAAVA,KACOW,KAAK+tB,MAAQ+2B,GAAUnD,UAElC3hD,KAAK+tB,QAAU+2B,GAAUnD,SACX,IAAVtiD,IAAgBW,KAAK+tB,OAAS+2B,GAAUnD,SAErC3hD,OAWRmjD,UAAW,SAAU9jD,EAAM,MAE1B,OAAc,OAAVA,KACOW,KAAK+tB,MAAQ+2B,GAAUjD,aAElC7hD,KAAK+tB,QAAU+2B,GAAUjD,YACX,IAAVxiD,IAAgBW,KAAK+tB,OAAS+2B,GAAUjD,YAErC7hD,OAORolD,kBAAmB,SAAU5hB,GAG5B,OADAxjC,KAAK+kD,eAAiBvhB,EACfxjC,MAORqlD,YAAa,SAAUlnC,EAAM+S,GAG5B,OADAA,EAAKg0B,YACE/mC,EAAKyO,KAAKsE,EAAK9J,IAOvBk+B,MAAO,SAAUnnC,GAEhBA,EAAKonC,SAAWvlD,KAAKgmB,QAAU7H,EAAMqnC,QAAUrnC,EAAKqlB,OAAO5gB,GAAO,SAQnEwgC,KAAM,SAAUjlC,GAEf,MAAM,IAAI3X,MAAO,oCAOlBwD,MAAO,WAEN,MAAM,IAAIxD,MAAO,qCAOlBiE,MAAO,WAEN,MAAM,IAAIjE,MAAO,qCAOlB8I,IAAK,SAAU6O,GAEd,MAAM,IAAI3X,MAAO,mCAOlB4E,OAAQ,SAAU+S,GAEjB,MAAM,IAAI3X,MAAO,sCAOlBomB,KAAM,SAASxF,GAEd,IAAuB,IAAnBpnB,KAAK6iD,UAAqB,OAE9B,IAAI4C,EAAmBr+B,EAAEsC,cAAc1pB,KAAK+tB,MAAQ+2B,GAAUjD,YAE9Dz6B,EAAEpB,OAAShmB,KAAKgmB,OAEhBhmB,KAAKklD,UAAY,EACjBllD,KAAKonB,EAAIA,EAETpnB,KAAKge,SACLhe,KAAKmlD,MAAM/P,KAAKhuB,IAES,IAArBq+B,GAA2Br+B,EAAEuC,gBAOlC3L,OAAQ,WAEP,MAAM,IAAIxX,MAAO,wCAQnBs+C,GAAUnD,QAAU,EACpBmD,GAAUjD,WAAa,E,IAEvB6D,GAAeZ;;;;;iBC5Of;MAAMa,GAAWlmD,EAAMC,OACtB,CACA6G,UAAW,WAQXkU,MAAO,EAAGmrC,aAAc,EACxBlrC,OAAQ,EAAGmrC,cAAe,EAK1B30C,GAAI,EACJC,GAAI,EAKJ7R,EAAG,EACH6O,EAAG,EAKH23C,aAAc,EACdC,aAAc,EAKdzyC,OAAQ,KAORiuC,UAAW,KAMXyE,aAAc,EACdC,aAAc,EAKdC,UAAW,KACXC,WAAY,EACZC,WAAY,EAKZC,YAAY,EACZC,YAAY,EAKZv4B,MAAO,EAKPtgB,MAAO,EAKPia,YAAa,EAOb8b,OAAQ,KAKR+iB,QAAS,KAOTC,YAAa,KAObC,aAAc,KAKdC,SAAU,KAcV3mD,OAAQ,SAAUmR,EAAIC,EAAIsJ,EAAOC,EAAQisC,EAAgBC,GAExD5mD,KAAKgmD,aAAe,GACpBhmD,KAAKimD,aAAe,GACpBjmD,KAAKkmD,UAAY,KAEjBlmD,KAAKkR,GAAKA,EACVlR,KAAKmR,GAAKA,EACVnR,KAAKya,MAAQza,KAAK4lD,aAAenrC,EACjCza,KAAK0a,OAAS1a,KAAK6lD,cAAgBnrC,EAEnC1a,KAAKV,EAAI,EACTU,KAAKmO,EAAI,EAETnO,KAAKwjC,OAAS8V,GAAQ5vC,KAAK5B,QAC3B9H,KAAKumD,QAAU,KAEfvmD,KAAKwmD,YAAclN,GAAQ5vC,KAAK5B,QAChC9H,KAAKymD,aAAenN,GAAQ5vC,KAAK5B,QACjC9H,KAAKuhD,UAAYjI,GAAQ5vC,KAAK5B,QAC9B9H,KAAKsT,OAASolC,GAAOhvC,KAAK5B,QAE1B9H,KAAK+tB,MAAQ43B,GAASkB,QACtB7mD,KAAK0mD,SAAWhO,GAAOhvC,KAAK5B,QAE5B9H,KAAK8mD,oBAAoBH,GAAgB,GAAIC,GAAiB,EAAGD,GAAgB,EAAGC,GAAiB,GAErG5mD,KAAK+mD,qBACL/mD,KAAKgnD,gBAMNn+C,OAAQ,WAEP7I,KAAKwjC,OAAO96B,OACZ1I,KAAKwmD,YAAY99C,OACjB1I,KAAKymD,aAAa/9C,OAClB1I,KAAKuhD,UAAU74C,OACf1I,KAAK0mD,SAASh+C,OAEO,OAAjB1I,KAAKumD,SACRvmD,KAAKumD,QAAQ79C,QAafqtB,QAAS,SAAU12B,EAAM,MAExB,OAAc,OAAVA,KACOW,KAAK+tB,MAAQ43B,GAASkB,UAEjC7mD,KAAK+tB,QAAU43B,GAASkB,QACpBxnD,IAAOW,KAAK+tB,OAAS43B,GAASkB,SAE3B7mD,OAWRinD,QAAS,SAAU5nD,EAAM,MAExB,OAAc,OAAVA,KACOW,KAAK+tB,MAAQ43B,GAASuB,WAEjClnD,KAAK+tB,QAAU43B,GAASuB,SACpB7nD,IAAOW,KAAK+tB,OAAS43B,GAASuB,UAE3BlnD,OAaR8mD,mBAAoB,SAAUrkC,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAiBtD,OAfW,OAAPF,IAEHE,EAAKH,EAAGG,GACRD,EAAKF,EAAGE,GACRD,EAAKD,EAAGC,GACRD,EAAKA,EAAGA,IAGTziB,KAAKya,MAAQza,KAAK4lD,aAClB5lD,KAAK0a,OAAS1a,KAAK6lD,cAEf7lD,KAAKya,MAAQkI,EAAGF,IAAIziB,KAAKya,MAAQkI,EAAGF,GACpCziB,KAAK0a,OAASkI,EAAGF,IAAI1iB,KAAK0a,OAASkI,EAAGF,GAE1C1iB,KAAKuhD,UAAUnzC,IAAIqU,EAAIC,EAAIC,EAAIC,GACxB5iB,MAaRmnD,WAAY,SAAU1kC,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAY9C,OAVqB,OAAjB5iB,KAAKumD,UACRvmD,KAAKumD,QAAUjN,GAAQ5vC,KAAK5B,SAElB,OAAP4a,IAEHC,EAAKC,EAAKH,EACVA,EAAKC,GAAMD,GAGZziB,KAAKumD,QAAQn4C,IAAIqU,EAAIC,EAAIC,EAAIC,GACtB5iB,MAMRgnD,aAAc,SAAUI,GAAoB,GAE3C,IAAI/lC,EAAGC,EAAG+lC,EAAIC,EACV7kC,EAAIC,EAAIC,EAAIC,EAEhBvB,EAAIrhB,KAAKya,OAAS,EAClB6G,EAAIthB,KAAK0a,QAAU,EAEnB2sC,EAAMhmC,EAAErhB,KAAKyN,MACb65C,EAAMhmC,EAAEthB,KAAKyN,MAEbgV,EAAKziB,KAAKV,EAAE+nD,EAAGrnD,KAAKsT,OAAOhU,EAC3BojB,EAAK1iB,KAAKmO,EAAEm5C,EAAGtnD,KAAKsT,OAAOnF,EAC3BwU,EAAK3iB,KAAKV,EAAE+nD,EAAGrnD,KAAKsT,OAAOhU,EAC3BsjB,EAAK5iB,KAAKmO,EAAEm5C,EAAGtnD,KAAKsT,OAAOnF,EAEvBi5C,IAEC3kC,EAAKziB,KAAKuhD,UAAU9+B,GACvBziB,KAAKsT,OAAOhF,KAAKtO,KAAKuhD,UAAU9+B,GAAKziB,KAAKV,EAAI+nD,GACtC1kC,EAAK3iB,KAAKuhD,UAAU5+B,IAC5B3iB,KAAKsT,OAAOhF,KAAKtO,KAAKuhD,UAAU5+B,GAAK3iB,KAAKV,EAAI+nD,GAE3C3kC,EAAK1iB,KAAKuhD,UAAU7+B,GACvB1iB,KAAKsT,OAAO/E,KAAKvO,KAAKuhD,UAAU7+B,GAAK1iB,KAAKmO,EAAIm5C,GACtC1kC,EAAK5iB,KAAKuhD,UAAU3+B,IAC5B5iB,KAAKsT,OAAO/E,KAAKvO,KAAKuhD,UAAU3+B,GAAK5iB,KAAKmO,EAAIm5C,GAE/C7kC,EAAKziB,KAAKV,EAAE+nD,EAAGrnD,KAAKsT,OAAOhU,EAC3BojB,EAAK1iB,KAAKmO,EAAEm5C,EAAGtnD,KAAKsT,OAAOnF,EAC3BwU,EAAK3iB,KAAKV,EAAE+nD,EAAGrnD,KAAKsT,OAAOhU,EAC3BsjB,EAAK5iB,KAAKmO,EAAEm5C,EAAGtnD,KAAKsT,OAAOnF,GAG5BnO,KAAKwjC,OAAOp1B,IAAKqU,EAAIC,EAAIC,EAAIC,GAER,OAAjB5iB,KAAKumD,SACRvmD,KAAKwjC,OAAOl0B,IAAKtP,KAAKumD,SAEvBvmD,KAAKwmD,YAAYp4C,IAChBpO,KAAKV,GAAKU,KAAKgmD,aAAa3kC,EAAIrhB,KAAK8lD,aAAazkC,GAAGrhB,KAAKyN,MAAOzN,KAAKmO,GAAKnO,KAAKimD,aAAa3kC,EAAIthB,KAAK+lD,aAAazkC,GAAGthB,KAAKyN,MAC3HzN,KAAKV,GAAKU,KAAKgmD,aAAa3kC,EAAIrhB,KAAK8lD,aAAazkC,GAAGrhB,KAAKyN,MAAOzN,KAAKmO,GAAKnO,KAAKimD,aAAa3kC,EAAIthB,KAAK+lD,aAAazkC,GAAGthB,KAAKyN,QAO7Hs5C,mBAAoB,WAEnB/mD,KAAKymD,aAAar4C,IAAKpO,KAAKkR,GAAIlR,KAAKmR,GAAInR,KAAKkR,GAAKlR,KAAKya,MAAOza,KAAKmR,GAAKnR,KAAK0a,SAQ/EwF,OAAQ,SAAUzF,EAAOC,GAQxB,OANA1a,KAAKya,MAAQza,KAAK4lD,aAAenrC,GAASza,KAAKya,MAC/Cza,KAAK0a,OAAS1a,KAAK6lD,cAAgBnrC,GAAU1a,KAAK0a,OAElD1a,KAAK+mD,qBACL/mD,KAAKgnD,eAEEhnD,MAQRw2C,SAAU,SAAU2C,EAAQC,GAW3B,OATAp5C,KAAKya,OAAS0+B,EACdn5C,KAAK0a,QAAU0+B,EAEfp5C,KAAK4lD,aAAe5lD,KAAKya,MACzBza,KAAK6lD,cAAgB7lD,KAAK0a,OAE1B1a,KAAK+mD,qBACL/mD,KAAKgnD,eAEEhnD,MASRqjD,YAAa,SAAU/jD,EAAG6O,GAQzB,OANAnO,KAAKV,EAAIA,GAAKU,KAAKV,EACnBU,KAAKmO,EAAIA,GAAKnO,KAAKmO,EAEnBnO,KAAKsT,OAAOlF,IAAI,EAAG,GACnBpO,KAAKgnD,eAEEhnD,MAQRunD,WAAY,SAAUz4C,EAAIC,GAKzB,OAHA/O,KAAKsT,OAAOlF,IAAIU,EAAIC,GACpB/O,KAAKgnD,eAEEhnD,MAQRwnD,SAAU,SAAUnoD,GAInB,OAFAW,KAAKyN,MAAQpO,EACbW,KAAKgnD,eACEhnD,MAQRynD,SAAU,WAET,OAAOznD,KAAKyN,OAQbi6C,eAAgB,SAAUroD,GAGzB,OADAW,KAAK0nB,YAAcroB,EACZW,MAQR2nD,eAAgB,WAEf,OAAO3nD,KAAK0nB,aAQbkgC,UAAW,SAAUn8B,EAAIE,GAKxB,OAHA3rB,KAAK8lD,aAAer6B,EACpBzrB,KAAK+lD,aAAep6B,EAEb3rB,MASR6O,UAAW,SAAUC,EAAIC,EAAIq4C,GAAoB,GAKhD,OAHApnD,KAAKsT,OAAOhE,IAAIR,EAAIC,GAEpB/O,KAAKgnD,aAAaI,GACXpnD,MAQR6nD,kBAAmB,SAAU32C,EAAIC,GAMhC,OAJAnR,KAAKkR,GAAKA,EACVlR,KAAKmR,GAAKA,EAEVnR,KAAK+mD,qBACE/mD,MASR8nD,KAAM,SAAUzpC,GAAS,GAExB,OAAOre,KAAKV,GAAK+e,EAAW,EAAIre,KAAKsT,OAAOhU,IAS7CyoD,KAAM,SAAU1pC,GAAS,GAExB,OAAOre,KAAKmO,GAAKkQ,EAAW,EAAIre,KAAKsT,OAAOnF,IAQ7C65C,WAAY,WAEX,OAAOhoD,KAAKsT,OAAOhU,GAQpB2oD,WAAY,WAEX,OAAOjoD,KAAKsT,OAAOnF,GAQpB+5C,SAAU,WAET,OAAOloD,KAAKya,OAQb0tC,UAAW,WAEV,OAAOnoD,KAAK0a,QAQb0tC,OAAQ,SAAU7Q,EAAIp9B,EAAG,KAAM6pC,EAAG,MAEtB,OAAPA,IAAaA,EAAKhkD,KAAKgmD,cAChB,OAAP7rC,IAAaA,EAAKo9B,GAEtB,IAAIl2B,EAAIrhB,KAAKya,OAAS,EAElBgI,EAAKziB,KAAKV,EAAImH,KAAKu9C,EAAG3iC,EAAIrhB,KAAK8lD,aAAazkC,GAAGrhB,KAAKyN,OACpDkV,EAAK3iB,KAAKV,EAAImH,KAAKu9C,EAAG3iC,EAAIrhB,KAAK8lD,aAAazkC,GAAGrhB,KAAKyN,OAEpDgV,GAAME,IACT40B,EAAKp9B,EAAKo9B,EAAMp9B,GAAO,GAExB,IAAI9I,EAAKrR,KAAKV,EAYd,OAVIi4C,EAAK90B,EAAIpR,GAAOkmC,EAAK90B,EAChBtI,EAAKwI,IAAItR,GAAO8I,EAAKwI,GAE9BF,EAAKpR,EAAKgQ,EACVsB,EAAKtR,EAAKgQ,EAENoB,EAAKziB,KAAKuhD,UAAU9+B,KAAIpR,EAAKrR,KAAKuhD,UAAU9+B,GAAKpB,GACjDsB,EAAK3iB,KAAKuhD,UAAU5+B,KAAItR,EAAKrR,KAAKuhD,UAAU5+B,GAAKtB,GAErDrhB,KAAKV,EAAI+R,EACFrR,MAQRqoD,OAAQ,SAAU5D,EAAIC,EAAG,KAAMT,EAAG,MAEtB,OAAPA,IAAaA,EAAKjkD,KAAKimD,cAChB,OAAPvB,IAAaA,EAAKD,GAEtB,IAAInjC,EAAIthB,KAAK0a,QAAU,EAEnBgI,EAAK1iB,KAAKmO,EAAI1H,KAAKw9C,EAAG3iC,EAAIthB,KAAK+lD,aAAazkC,GAAGthB,KAAKyN,OACpDmV,EAAK5iB,KAAKmO,EAAI1H,KAAKw9C,EAAG3iC,EAAIthB,KAAK+lD,aAAazkC,GAAGthB,KAAKyN,OAEpDiV,GAAME,IACT6hC,EAAKC,EAAKD,EAAMC,GAAO,GAExB,IAAIpzC,EAAKtR,KAAKmO,EAYd,OAVIs2C,EAAK/hC,EAAIpR,GAAOmzC,EAAK/hC,EAChBgiC,EAAK9hC,IAAItR,GAAOozC,EAAK9hC,GAE9BF,EAAKpR,EAAKgQ,EACVsB,EAAKtR,EAAKgQ,EAENoB,EAAK1iB,KAAKuhD,UAAU7+B,KAAIpR,EAAKtR,KAAKuhD,UAAU7+B,GAAKpB,GACjDsB,EAAK5iB,KAAKuhD,UAAU3+B,KAAItR,EAAKtR,KAAKuhD,UAAU3+B,GAAKtB,GAErDthB,KAAKmO,EAAImD,EACFtR,MAQRk0B,OAAQ,SAAUoB,EAAG,GAEG,OAAnBt1B,KAAKkmD,YAGLlmD,KAAKqmD,YACRrmD,KAAKooD,OAAQpoD,KAAKkmD,UAAUzjC,GAAKziB,KAAKmmD,WAAYnmD,KAAKkmD,UAAUvjC,GAAK3iB,KAAKmmD,YAExEnmD,KAAKsmD,YACRtmD,KAAKqoD,OAAQroD,KAAKkmD,UAAUxjC,GAAK1iB,KAAKomD,WAAYpmD,KAAKkmD,UAAUtjC,GAAK5iB,KAAKomD,YAE5EpmD,KAAKgnD,iBAQNsB,aAAc,SAAUhzB,EAAG,GAEH,OAAnBt1B,KAAKkmD,YAGTlmD,KAAKooD,OAAQpoD,KAAKkmD,UAAUzjC,GAAKziB,KAAKmmD,WAAYnmD,KAAKkmD,UAAUvjC,GAAK3iB,KAAKmmD,YAC3EnmD,KAAKqoD,OAAQroD,KAAKkmD,UAAUxjC,GAAK1iB,KAAKomD,WAAYpmD,KAAKkmD,UAAUtjC,GAAK5iB,KAAKomD,YAE3EpmD,KAAKgnD,iBAQNuB,aAAc,SAAUnnC,EAAMwN,EAAM,EAAGC,EAAM,GAQ5C,OANA7uB,KAAKkmD,UAAY9kC,EAEjBphB,KAAKmmD,WAAav3B,EAClB5uB,KAAKomD,WAAav3B,EAElB7uB,KAAKk0B,OAAO,GACLl0B,MAQRwoD,gBAAiB,SAAU55B,EAAOC,GAKjC,OAHA7uB,KAAKmmD,WAAav3B,EAClB5uB,KAAKomD,WAAav3B,EAEX7uB,MAQRyoD,aAAc,SAAUC,EAAUC,GAKjC,OAHA3oD,KAAKqmD,WAAaqC,EAClB1oD,KAAKsmD,WAAaqC,EAEX3oD,MAQR4oD,eAAgB,SAAUC,EAAQC,GAKjC,OAHA9oD,KAAKgmD,aAAe6C,EACpB7oD,KAAKimD,kBAA0B3nB,IAAXwqB,EAAuBD,EAASC,EAE7C9oD,MAQR+oD,UAAW,SAAU3hC,GAEpBA,EAAE1F,KAAK1hB,KAAKymD,aAAahkC,GAAIziB,KAAKymD,aAAa/jC,GAAI1iB,KAAKymD,aAAahsC,QAASza,KAAKymD,aAAa/rC,WAQjGsuC,eAAgB,SAAU5hC,GAEnBpnB,KAAK+tB,MAAQ43B,GAASuB,SAG3B9/B,EAAEvY,UAAW7O,KAAKymD,aAAahkC,GAAIziB,KAAKymD,aAAa/jC,IAFrD0E,EAAEvY,UAAW7O,KAAKymD,aAAav3C,GAAIlP,KAAKymD,aAAat3C,IAIpC,GAAdnP,KAAKyN,OACR2Z,EAAE3Z,MAAOzN,KAAKyN,MAAOzN,KAAKyN,OAEH,GAApBzN,KAAK0nB,aACRN,EAAE3Z,MAAOzN,KAAK0nB,YAAa1nB,KAAK0nB,aAE3B1nB,KAAK+tB,MAAQ43B,GAASuB,SAG3B9/B,EAAEvY,WAAY7O,KAAKwjC,OAAO/gB,IAAKziB,KAAKwjC,OAAO9gB,IAF3C0E,EAAEvY,WAAY7O,KAAKwjC,OAAOt0B,IAAKlP,KAAKwjC,OAAOr0B,IAI5CiY,EAAErH,mBAeHkpC,aAAc,SAAU3pD,EAAG6O,EAAE,KAAMuB,GAAM,GASxC,IAAIw5C,EAAMC,EA+BV,OAtCU,OAANh7C,IAAoB,IAANA,IAEjBuB,GAAc,IAANvB,EACRA,EAAI7O,EAAE6O,EACN7O,EAAIA,EAAEA,GAKDU,KAAK+tB,MAAQ43B,GAASuB,UAgB3BgC,EAAOlpD,KAAKymD,aAAahkC,GACzB0mC,EAAOnpD,KAAKymD,aAAa/jC,GAErBhT,GACHpQ,GAAMA,EAAImH,IAAIyiD,IAASlpD,KAAKyN,MAAShH,IAAIzG,KAAKwjC,OAAO/gB,IACrDtU,GAAMA,EAAI1H,IAAI0iD,IAASnpD,KAAKyN,MAAShH,IAAIzG,KAAKwjC,OAAO9gB,MAGrDpjB,GAAMA,EAAI4pD,GAAQlpD,KAAKyN,MAASzN,KAAKwjC,OAAO/gB,GAC5CtU,GAAMA,EAAIg7C,GAAQnpD,KAAKyN,MAASzN,KAAKwjC,OAAO9gB,MAvB7CwmC,EAAOlpD,KAAKymD,aAAav3C,GACzBi6C,EAAOnpD,KAAKymD,aAAat3C,GAErBO,GACHpQ,GAAMA,EAAImH,IAAIyiD,IAASlpD,KAAKyN,MAAShH,IAAIzG,KAAKwjC,OAAOt0B,IACrDf,GAAMA,EAAI1H,IAAI0iD,IAASnpD,KAAKyN,MAAShH,IAAIzG,KAAKwjC,OAAOr0B,MAGrD7P,GAAMA,EAAI4pD,GAAQlpD,KAAKyN,MAASzN,KAAKwjC,OAAOt0B,GAC5Cf,GAAMA,EAAIg7C,GAAQnpD,KAAKyN,MAASzN,KAAKwjC,OAAOr0B,KAkBvCnP,KAAK0mD,SAASt4C,IAAI9O,EAAG6O,IAe7Bi7C,cAAe,SAAU9pD,EAAG6O,EAAE,KAAMuB,GAAM,GASzC,IAAIw5C,EAAMC,EA+BV,OAtCU,OAANh7C,IAAoB,IAANA,IAEjBuB,GAAc,IAANvB,EACRA,EAAI7O,EAAE6O,EACN7O,EAAIA,EAAEA,GAKDU,KAAK+tB,MAAQ43B,GAASuB,UAgB3BgC,EAAOlpD,KAAKymD,aAAahkC,GACzB0mC,EAAOnpD,KAAKymD,aAAa/jC,GAErBhT,GACHpQ,GAAKA,EAAImH,IAAIzG,KAAKwjC,OAAO/gB,KAAOziB,KAAKyN,MAAQhH,IAAIyiD,GACjD/6C,GAAKA,EAAI1H,IAAIzG,KAAKwjC,OAAO9gB,KAAO1iB,KAAKyN,MAAQhH,IAAI0iD,KAGjD7pD,GAAKA,EAAIU,KAAKwjC,OAAO/gB,IAAMziB,KAAKyN,MAAQy7C,EACxC/6C,GAAKA,EAAInO,KAAKwjC,OAAO9gB,IAAM1iB,KAAKyN,MAAQ07C,KAvBzCD,EAAOlpD,KAAKymD,aAAav3C,GACzBi6C,EAAOnpD,KAAKymD,aAAat3C,GAErBO,GACHpQ,GAAKA,EAAImH,IAAIzG,KAAKwjC,OAAOt0B,KAAOlP,KAAKyN,MAAQhH,IAAIyiD,GACjD/6C,GAAKA,EAAI1H,IAAIzG,KAAKwjC,OAAOr0B,KAAOnP,KAAKyN,MAAQhH,IAAI0iD,KAGjD7pD,GAAKA,EAAIU,KAAKwjC,OAAOt0B,IAAMlP,KAAKyN,MAAQy7C,EACxC/6C,GAAKA,EAAInO,KAAKwjC,OAAOr0B,IAAMnP,KAAKyN,MAAQ07C,IAkBnCnpD,KAAK0mD,SAASt4C,IAAI9O,EAAG6O,MAO9Bw3C,GAASkB,QAAU,EACnBlB,GAASuB,SAAW,E,IAEpBmC,GAAe1D;;;;;;;oCCj0Bf;MAAM2D,GAAU3F,GAAYjkD,OAC3B,CACA6G,UAAW,UAMXgD,MAAO,KAMPkU,IAAK,KAOLmZ,aAAa,EAKb4uB,QAAS,EAKTD,SAAU,EAKV1lC,OAAQ,EAKR0pC,eAAgB,KAKhB/yC,eAAgB,KAMhBwH,OAAQ,KAURje,OAAQ,SAAST,EAAG6O,EAAGsM,EAAM,KAAMC,EAAO,KAAM+C,EAAI,MAErC,OAAVhD,IACHA,EAAQC,EAAS,GAEH,OAAXA,IAGHD,GADAgD,EAAMhD,GACMA,MACZC,EAAS+C,EAAI/C,QAGd1a,KAAK2J,OAAO6/C,YAAYzpD,OAAOT,EAAG6O,EAAGsM,EAAOC,GAC5C1a,KAAKyd,IAAc,OAARA,EAAeA,EAAIslB,cAAgBtlB,EAE9Czd,KAAKuJ,MAAQ,KACbvJ,KAAK42B,aAAc,EAEnB52B,KAAKwlD,QAAU,EACfxlD,KAAKulD,SAAW,EAChBvlD,KAAK6f,OAAS,EAEd7f,KAAKupD,eAAiB,KACtBvpD,KAAKwW,eAAiB,KAEtBxW,KAAKge,OAAS,MAMfnV,OAAQ,WAEU,OAAb7I,KAAKyd,MAER3S,QAAQ9K,KAAKyd,KACbzd,KAAKyd,IAAM,MAGZzd,KAAK2J,OAAO6/C,YAAY3gD,UAOzB4gD,aAAc,YAEQ,IAAjBzpD,KAAK8hD,UAEc,OAAnB9hD,KAAKuhD,UACRvhD,KAAKuhD,UAAUyD,MAAM0E,aAAa1pD,MAElC8K,QAAQ9K,QAcVqJ,MAAO,SAAUhK,EAAM,MAEtB,OAAc,OAAVA,EACIW,KAAK42B,aAEb52B,KAAK42B,YAAwB,IAAVv3B,GAAqBA,EACjCW,OAOR2pD,KAAM,WAEL,IAAIA,EAAO3pD,KAEX,KAAsB,OAAf2pD,EAAKpgD,OACXogD,EAAOA,EAAKpgD,MAEb,OAAOogD,GAcRzqC,MAAO,SAAU7f,EAAM,MAEtB,OAAc,OAAVA,EACIW,KAAK6f,QAEb7f,KAAK6f,OAASxgB,EACPW,OAcRgmB,OAAQ,SAAU3mB,EAAM,MAEvB,OAAc,OAAVA,EACIW,KAAKwlD,SAEbxlD,KAAKwlD,QAAUnmD,EACRW,OAcRqa,cAAe,SAAUA,GAAc,GAEtC,OAAsB,IAAlBA,EACIra,KAAKupD,gBAEiB,iBAAnBlvC,IACVA,EAAgBC,EAAcrG,IAAIoG,IAEnCra,KAAKupD,eAAiBlvC,EACfra,OASR0W,cAAe,SAAUA,GAGxB,OADA1W,KAAKwW,eAAiBE,EACf1W,MAOR4sB,KAAM,SAASxF,GAEd,KAAIpnB,KAAK6f,QAAU,GAAnB,CAIA,GAAiB,OAAb7f,KAAKyd,KAAgC,OAAhBzd,KAAKge,OAC9B,CACqB,IAAhBhe,KAAK6f,SAERuH,EAAEkC,YACFlC,EAAElI,MAAMlf,KAAK6f,SAGd,IAAI+pC,EAAwC,OAAxB5pD,KAAKupD,gBAA0BniC,EAAEyC,kBAAkB7pB,KAAKupD,gBACxE9D,IAAmBzlD,KAAKijD,oBAAqB77B,EAAEsC,cAAc1pB,KAAKmjD,aAE1C,OAAxBnjD,KAAKupD,gBAAmD,OAAxBvpD,KAAKwW,gBAAoC,OAAT4Q,EAAEnV,IACrEjS,KAAKwW,eAAgB4Q,EAAEwC,mBAAoB5pB,KAAMonB,EAAEnV,IAEpDmV,EAAEpB,OAAShmB,KAAKulD,SAEI,OAAhBvlD,KAAKge,OACRhe,KAAKge,OAAOoJ,EAAGpnB,KAAMA,KAAKyd,KAE1Bzd,KAAKyd,IAAIO,OAAOoJ,EAAGpnB,OAEK,IAArBylD,GAA2Br+B,EAAEuC,gBACX,IAAlBigC,GAAwBxiC,EAAE0C,mBAEV,IAAhB9pB,KAAK6f,QACRuH,EAAEmC,WAKJ,IAAsB,IAAlBnK,EAAEwX,cAA8C,IAArB52B,KAAK42B,aAAwB52B,KAAK42B,YAAc,EAC/E,CACC,IAAIkD,EAAI1S,EAAE4C,aACV5C,EAAI0F,EAAOsC,gBAEThG,aACFhC,EAAE2C,WAAW+P,GACb1S,EAAEnH,UAAUqpC,GAAQO,cAAc7pD,KAAK42B,cACvCxP,EAAE5F,SAASxhB,KAAKwjC,OAAO/gB,GAAIziB,KAAKwjC,OAAO9gB,GAAI1iB,KAAKwjC,OAAO/oB,QAASza,KAAKwjC,OAAO9oB,UAC5E0M,EAAEiC,eASJygC,WAAY,SAAUC,GAGrB,OADA/pD,KAAKge,OAAS+rC,GAAkB,KACzB/pD,QAQTspD,GAAQU,YAAc,CACrB,uBACA,uBACA,uBACA,yBACA,qBACA,qBACA,qBACA,0BAODV,GAAQO,cAAgB,SAAUjzB,GAKjC,OAHoB,IAAhBA,IAAwC,IAAhBA,IAC3BA,EAAc,GAER0yB,GAAQU,YAA8B,IAAfpzB;;;;AAiB/B3wB,EAASwD,WAAW6/C,I,IACpBW,GAAeX;;;;+BCvVf;MAAMY,GAAYxR,GAAOhvC,KAAK5B,QAQxBqiD,GAAQF,GAAQvqD,OACrB,CACA6G,UAAW,QAMX6jD,SAAU,KAMVjgD,IAAK,KAMLpK,OAAQ,SAAUiV,EAAG,MAEpBhV,KAAK2J,OAAO0gD,QAAQtqD,OAAO,EAAG,EAAG,EAAG,GAEpCC,KAAKoqD,SAAWh+C,EAAK1C,KAAK5B,QAC1B9H,KAAKwjC,OAAO/4B,QAEZzK,KAAKmK,IAAMuuC,GAAOhvC,KAAK5B,QACvB9H,KAAK+hD,MAAM/sC,IAMZnM,OAAQ,WAEP7I,KAAKgK,QACLhK,KAAKoqD,SAAS1hD,OACd1I,KAAKmK,IAAIzB,OAET1I,KAAK2J,OAAO0gD,QAAQxhD,UAOrB4gD,aAAc,WAEb,IAAqB,IAAjBzpD,KAAK8hD,QAAmB,OAE5B,IAAI5hD,EAEJ,KAAsC,OAA9BA,EAAIF,KAAKoqD,SAAS3+C,UAEzBvL,EAAEuhD,QAAQr2C,OAAOpL,KAAKqkD,QAASrkD,MAC/BE,EAAEqJ,MAAQ,KACVrJ,EAAEupD,eAGHzpD,KAAK2J,OAAO0gD,QAAQZ,gBAOrBz/C,MAAO,WAEN,IAAI9J,EAEJ,KAAsC,OAA9BA,EAAIF,KAAKoqD,SAAS3+C,UAEzBvL,EAAEuhD,QAAQr2C,OAAOpL,KAAKqkD,QAASrkD,MAC/BE,EAAEqJ,MAAQ,KACVuB,QAAQ5K,GAGT,OAAOF,MAORyK,MAAO,WAEN,IAAIvK,EAEJ,KAAsC,OAA9BA,EAAIF,KAAKoqD,SAAS3+C,UAEzBvL,EAAEuhD,QAAQr2C,OAAOpL,KAAKqkD,QAASrkD,MAC/BE,EAAEqJ,MAAQ,KAGX,OAAOvJ,MAcRsqD,YAAa,SAAUjrD,EAAM,MAE5B,OAAc,OAAVA,KACOW,KAAK+tB,MAAQ41B,GAAYL,eAEpCtjD,KAAK+tB,QAAU41B,GAAYL,cACb,IAAVjkD,IAAgBW,KAAK+tB,OAAS41B,GAAYL,cAEvCtjD,OAQRuqD,SAAU,SAAUpsC,EAAMqsC,GAAS,GAElC,GAAa,OAATrsC,EAAe,OAAO,KAE1B,IAAIqhC,EAA6B,OAAnBx/C,KAAKwjC,OAAO/gB,GAqB1B,OAnBgB,IAAZ+8B,GAAgE,IAA3Cx/C,KAAK+tB,MAAQ41B,GAAYL,kBAEjC,IAAZ9D,GAAoBrhC,EAAKqlB,OAAO/gB,GAAKziB,KAAKwjC,OAAO/gB,KAAIziB,KAAKyqD,WAAWtsC,EAAKqlB,OAAO/gB,GAAKziB,KAAKwjC,OAAO/gB,GAAI,KAC1F,IAAZ+8B,GAAoBrhC,EAAKqlB,OAAO9gB,GAAK1iB,KAAKwjC,OAAO9gB,KAAI1iB,KAAKyqD,WAAW,EAAGtsC,EAAKqlB,OAAO9gB,GAAK1iB,KAAKwjC,OAAO9gB,MACzF,IAAZ88B,GAAoBrhC,EAAKqlB,OAAO7gB,GAAK3iB,KAAKwjC,OAAO7gB,KAAI3iB,KAAKw2C,SAASr4B,EAAKqlB,OAAO7gB,GAAK3iB,KAAKwjC,OAAO7gB,GAAI,KACxF,IAAZ68B,GAAoBrhC,EAAKqlB,OAAO5gB,GAAK5iB,KAAKwjC,OAAO5gB,KAAI5iB,KAAKw2C,SAAS,EAAGr4B,EAAKqlB,OAAO5gB,GAAK5iB,KAAKwjC,OAAO5gB,KAGxG5iB,KAAKoqD,SAASz/C,KAAKwT,GAEH,OAAZA,EAAKnJ,KACRhV,KAAKme,EAAKnJ,IAAMmJ,IAEA,IAAbqsC,GACHrsC,EAAKtP,UAAU7O,KAAKwjC,OAAO/gB,GAAIziB,KAAKwjC,OAAO9gB,IAE5CvE,EAAK5U,MAAQvJ,KACbme,EAAKsjC,QAAQnyC,IAAItP,KAAKqkD,QAASrkD,KAAMA,KAAKoqD,SAAS5/C,QAE5C2T,GAORusC,SAAU,SAAU11C,GAEnB,OAAOhV,KAAKgV,IAAO,MAMpBqvC,QAAS,SAAUlmC,EAAM+S,EAAM+e,GAQ9B,OANA/e,EAAKk5B,SAASh/C,OAAO6kC,GACrB9xB,EAAK5U,MAAQ,KAEG,OAAZ4U,EAAKnJ,KACRkc,EAAK/S,EAAKnJ,IAAM,OAEV,GAOR+R,YAAa,SAAU5I,GAEtB,OAAa,OAATA,GAAiBA,EAAK5U,QAAUvJ,MAGpCme,EAAKsjC,QAAQjM,MAAMx1C,KAAKqkD,QAASrkD,MAFzBme,GASTilC,KAAM,WAEL,IAAK,IAAIljD,EAAIF,KAAKoqD,SAAS7/C,IAAKrK,EAAGA,EAAIA,EAAE6J,KACxC7J,EAAEb,MAAM+jD,OAET,OAAOpjD,KAAK2J,OAAO0gD,QAAQjH,QAQ5BqH,WAAY,SAAU37C,EAAIC,EAAI0pC,GAAS,GAEtC,OAAOz4C,KAAK2J,OAAO0gD,QAAQx7C,UAAUC,EAAIC,EAAI0pC,IAQ9C5pC,UAAW,SAAUC,EAAIC,EAAI0pC,GAAS,GAErC,IAAIkS,EAAM3qD,KAAKwjC,OAAO/gB,GAClBmoC,EAAM5qD,KAAKwjC,OAAO9gB,GAEtB1iB,KAAK2J,OAAO0gD,QAAQx7C,UAAUC,EAAIC,EAAI0pC,GACtCz4C,KAAKmK,IAAImF,IAAIR,EAAIC,EAAI0pC,GAErBkS,EAAM3qD,KAAKwjC,OAAO/gB,GAAKkoC,EACvBC,EAAM5qD,KAAKwjC,OAAO9gB,GAAKkoC,EAEvB,IAAK,IAAI1qD,EAAIF,KAAKoqD,SAAS7/C,IAAKrK,EAAGA,EAAIA,EAAE6J,KACxC7J,EAAEb,MAAMwP,UAAU87C,EAAKC,GAExB,OAAO5qD,MAQR6qD,WAAY,SAAU/7C,EAAIC,EAAI0pC,GAAS,GAEtCyR,GAAU97C,IAAIpO,KAAKwjC,OAAOsV,IAAK94C,KAAKwjC,OAAOuV,KAAK,GAEhD,IAAI4R,EAAMT,GAAU5qD,EAChBsrD,EAAMV,GAAU/7C,EAYpB,OAVA+7C,GAAU56C,IAAIR,EAAIC,EAAI0pC,GAEtBkS,EAAMT,GAAU5qD,EAAIqrD,EACpBC,EAAMV,GAAU/7C,EAAIy8C,EAEpBV,GAAU97C,IAAIu8C,EAAKC,GAEnBV,GAAU5qD,GAAKwP,EACfo7C,GAAU/7C,GAAKY,EAERm7C,IAORlI,SAAU,SAAU3iD,GAEnB,IAAK,IAAIa,EAAIF,KAAKoqD,SAAS7/C,IAAKrK,EAAGA,EAAIA,EAAE6J,KACxC7J,EAAEb,MAAM2iD,SAAS3iD,GAElB,OAAOW,KAAK2J,OAAO0gD,QAAQrI,SAAS3iD,IAOrC4iD,WAAY,SAAU5iD,GAErB,IAAK,IAAIa,EAAIF,KAAKoqD,SAAS7/C,IAAKrK,EAAGA,EAAIA,EAAE6J,KACxC7J,EAAEb,MAAM4iD,WAAW5iD,GAEpB,OAAOW,KAAK2J,OAAO0gD,QAAQpI,WAAW5iD,IAavCwjD,QAAS,SAAUxjD,EAAM,KAAM4oC,GAAO,GAErC,GAAc,OAAV5oC,EACH,OAAOW,KAAK2J,OAAO0gD,QAAQxH,UAE5B,IAAK,IAAI3iD,EAAIF,KAAKoqD,SAAS7/C,IAAKrK,EAAGA,EAAIA,EAAE6J,KACxC7J,EAAEb,MAAMwjD,QAAQxjD,EAAO4oC,GAExB,OAAOjoC,KAAK2J,OAAO0gD,QAAQxH,QAAQxjD,EAAO4oC,IAc3C/oB,MAAO,SAAU7f,EAAM,MAEtB,GAAc,OAAVA,EACH,OAAOW,KAAK2J,OAAO0gD,QAAQnrC,QAE5B,IAAK,IAAIhf,EAAIF,KAAKoqD,SAAS7/C,IAAKrK,EAAGA,EAAIA,EAAE6J,KACxC7J,EAAEb,MAAM6f,MAAM7f,GAEf,OAAOW,KAAK2J,OAAO0gD,QAAQnrC,MAAM7f;;;;;AAcnC4G,EAASwD,WAAW0gD,I,IACpBW,GAAeX;;;;;;;;cC3Uf;MAAMY,GAAQtrD,EAAMC,OACnB,CACA6G,UAAW,QAOXykD,SAAU,KACVC,UAAW,KAOXloC,SAAU,KACVmoC,UAAW,KAKXC,WAAY,KAKZC,UAAW,KAMXrG,eAAgB,KAKhBsG,UAAW,KAKXC,OAAQ,KAKRC,cAAe,KAMfC,SAAU,KAMVC,QAAS,KAMTC,aAAc,KAMdC,SAAU,KAMVC,UAAW,KAMXt2B,GAAI,EAKJvH,MAAO,EAMPm3B,UAAW,EAKXF,MAAO,KAMPh/B,OAAQ,KAMR9c,KAAM,KAQNnJ,OAAQ,SAAUH,EAAOsJ,EAAK,MAE7BlJ,KAAKmrD,WAAa,GAQlBnrD,KAAKgmB,QAAkB,EAARpmB,IAAe,GAC9BI,KAAKkJ,KAAgB,OAATA,EAAgBA,EAAQ,SAAWtJ,EAE/CI,KAAKorD,UAAY,GACjBprD,KAAK+kD,eAAiBzL,GAAQ5vC,KAAK5B,QAEnC9H,KAAKqrD,UAAYj/C,EAAK1C,KAAK5B,QAC3B9H,KAAKsrD,OAAS,GAEdtrD,KAAKurD,cAAgBn/C,EAAK1C,KAAK5B,QAE/B9H,KAAKwrD,SAAW9V,GAAQhsC,KAAK5B,MAAM9H,MACnCA,KAAKyrD,QAAU/V,GAAQhsC,KAAK5B,MAAM9H,MAClCA,KAAK0rD,aAAehW,GAAQhsC,KAAK5B,MAAM9H,MACvCA,KAAK2rD,SAAWjW,GAAQhsC,KAAK5B,MAAM9H,MACnCA,KAAK4rD,UAAYlW,GAAQhsC,KAAK5B,MAAM9H,MAEpCA,KAAK+tB,MAAQg9B,GAAMpJ,QACnB3hD,KAAKglD,MAAQhlD,MAMd6I,OAAQ,WAaP,IAAI3I,EAEJ,IAbAF,KAAK6rD,gBACL7rD,KAAKurD,cAAc7iD,OAEnB1I,KAAK4rD,UAAUxW,OACfp1C,KAAK4rD,UAAUljD,OAEf1I,KAAKwrD,SAAS9iD,OACd1I,KAAKyrD,QAAQ/iD,OACb1I,KAAK0rD,aAAahjD,OAClB1I,KAAK2rD,SAASjjD,OAI0B,QAAhCxI,EAAIF,KAAKqrD,UAAU5/C,UAE1BvL,EAAEuhD,QAAQr2C,OAAOpL,KAAKqkD,QAASrkD,MAC/BE,EAAEqhD,UAAY,KACdz2C,QAAQ5K,GAGT,IAAKA,EAAI,EAAGA,EAAIF,KAAKmrD,WAAWhrD,OAAQD,IAElCF,KAAKmrD,WAAWjrD,KAErBF,KAAKmrD,WAAWjrD,GAAG8kD,MAAQ,KAC3Bl6C,QAAQ9K,KAAKmrD,WAAWjrD,IAExBF,KAAKmrD,WAAWjrD,GAAK,MAGtB,IAAKA,EAAI,EAAGA,EAAIF,KAAKorD,UAAUjrD,OAAQD,IAEjCF,KAAKorD,UAAUlrD,KAEpB4K,QAAQ9K,KAAKorD,UAAUlrD,IACvBF,KAAKorD,UAAUlrD,GAAK,MAGrBF,KAAK+kD,eAAer8C,OACpB1I,KAAKqrD,UAAU3iD,QAOhBsB,MAAO,WAIN,IAAI9J,EAEJ,IAJAF,KAAK6rD,gBAImC,QAAhC3rD,EAAIF,KAAKqrD,UAAU5/C,UAE1BvL,EAAEuhD,QAAQr2C,OAAOpL,KAAKqkD,QAASrkD,MAC/BE,EAAEqhD,UAAY,KACdz2C,QAAQ5K,GAGT,IAAKA,EAAI,EAAGA,EAAIF,KAAKmrD,WAAWhrD,OAAQD,IAEnCF,KAAKmrD,WAAWjrD,IACnBF,KAAKmrD,WAAWjrD,GAAG8J,SAYtB64C,QAAS,SAAUxjD,EAAM,MAExB,OAAc,OAAVA,KACOW,KAAK+tB,MAAQg9B,GAAMpJ,UAE9B3hD,KAAK+tB,QAAUg9B,GAAMpJ,QACjBtiD,IAAOW,KAAK+tB,OAASg9B,GAAMpJ,SAExB3hD,OAQR8rD,aAAc,SAAUlsD,EAAO2hD,GAE9B,GAAI3hD,EAAQ,EAAG,OAAOI,KAGtB,GAFAJ,GAAS,GAES,OAAd2hD,EAIH,OAFAvhD,KAAKmrD,WAAWvrD,GAAOolD,MAAQ,KAC/BhlD,KAAKmrD,WAAWvrD,GAAS,KAClBI,KAGR,IAAK0lD,GAAUr6C,WAAWk2C,GACzB,MAAM,IAAI/6C,MAAM,2CAA6C5G,EAAQ,iCAWtE,OATsB,OAAlBI,KAAKgrD,UAAqBzJ,EAAU9mC,MAAQza,KAAKgrD,YAAUhrD,KAAKgrD,SAAWzJ,EAAU9mC,QAClE,OAAnBza,KAAKirD,WAAsB1J,EAAU7mC,OAAS1a,KAAKirD,aAAWjrD,KAAKirD,UAAY1J,EAAU7mC,SACvE,OAAlB1a,KAAK+iB,UAAqBw+B,EAAU9mC,MAAQza,KAAK+iB,YAAU/iB,KAAK+iB,SAAWw+B,EAAU9mC,QAClE,OAAnBza,KAAKkrD,WAAsB3J,EAAU7mC,OAAS1a,KAAKkrD,aAAWlrD,KAAKkrD,UAAY3J,EAAU7mC,QAE7F6mC,EAAUyD,MAAQhlD,KAClBuhD,EAAUv7B,OAAShmB,KAAKgmB,QAAUpmB,GAAS,IAE3CI,KAAKmrD,WAAWvrD,GAAS2hD,EAClBvhD,MAOR+rD,aAAc,SAAUnsD,GAEvB,OAAOA,EAAQ,GAAKA,GAASI,KAAKmrD,WAAWhrD,OAAS,KAAOH,KAAKmrD,WAAWvrD,IAO9EosD,YAAa,SAAUpsD,EAAO6nB,GAE7B,GAAI7nB,EAAQ,EAAG,OAAOI,KAEtB,GAAiB,OAAbynB,IAAsB4hC,GAASh+C,WAAWoc,GAC7C,MAAM,IAAIjhB,MAAM,0CAA4C5G,EAAQ,iCAGrE,OADAI,KAAKorD,UAAUxrD,GAAS6nB,EACjBznB,MAORisD,YAAa,SAAUrsD,GAEtB,OAAOA,EAAQ,GAAKA,GAASI,KAAKorD,UAAUjrD,OAAS,KAAOH,KAAKorD,UAAUxrD,IAO5E8pD,aAAc,SAAUvrC,GAElBA,EAAK2jC,UAEV9hD,KAAKurD,cAAc5gD,KAAKwT,GACxBA,EAAK2jC,OAAM,KAOZ+J,cAAe,WAEd,IAAI1tC,EAEJ,KAA+C,QAAvCA,EAAOne,KAAKurD,cAAc9/C,UACjCX,QAAQqT,IAOV+tC,SAAU,SAAU3iD,GAEnB,IAAKuhD,GAAMz/C,WAAW9B,GACrB,MAAM,IAAI/C,MAAO,4BAUlB,OARAxG,KAAKqrD,UAAU1gD,KAAKpB,GAEH,OAAbA,EAAMyL,KACThV,KAAKsrD,OAAO/hD,EAAMyL,IAAMzL,GAEzBA,EAAMg4C,UAAYvhD,KAClBuJ,EAAMk4C,QAAQnyC,IAAItP,KAAKmsD,aAAcnsD,KAAMA,KAAKqrD,UAAU7gD,SAEnD,GAMR2hD,aAAc,SAAU5iD,EAAO2nB,EAAM+e,GAQpC,OANA1mC,EAAMg4C,UAAY,KAClBrwB,EAAKm6B,UAAUjgD,OAAO6kC,GAEL,OAAb1mC,EAAMyL,KACTkc,EAAKo6B,OAAO/hD,EAAMyL,IAAM,OAElB,GAORo3C,YAAa,SAAU7iD,GAGtB,OADAA,EAAMk4C,QAAQjM,MAAMx1C,KAAKqkD,QAASrkD,MAC3BuJ,GAOR65C,KAAM,SAAU75C,GAEf,OAAO,GAQRqjB,KAAM,SAAUxF,GAEf,GAAKpnB,KAAK6iD,UAAV,CAIA,GAFA7iD,KAAKklD,UAAY,EAEbllD,KAAKorD,UAAUjrD,OAElB,IAAK,IAAIksD,EAAgB,EAAGA,EAAgBrsD,KAAKorD,UAAUjrD,OAAQksD,IACnE,CACC,IAAI5kC,EAAWznB,KAAKorD,UAAUiB,GACzB5kC,GAAaA,EAASsO,YAE3B3W,EAAQqI,SAAWA,EAEnBL,EAAE5G,WACF4G,EAAEgC,aAEF3B,EAASshC,UAAU3hC,GACnBK,EAASuhC,eAAe5hC,GAExBpnB,KAAK+kD,eAAe32C,IAAIqZ,EAAS+b,QACjCxjC,KAAKssD,eAAellC,EAAGpnB,KAAK+kD,gBAE5B39B,EAAEiC,YACFjC,EAAE3G,gBAIHzgB,KAAKssD,eAAellC,EAAG,MAEpB/H,EAAI0W,UACP1W,EAAI8W,KAAKn2B,KAAKkJ,MAAQlJ,KAAKklD,aAO7BoH,eAAgB,SAAUllC,EAAG29B,GAE5B,IAAK,IAAI7kD,EAAI,EAAGA,EAAIF,KAAKmrD,WAAWhrD,OAAQD,IAEtCF,KAAKmrD,WAAWjrD,KAGrBF,KAAKmrD,WAAWjrD,GAAGklD,kBAAkBL,GACrC/kD,KAAKmrD,WAAWjrD,GAAG0sB,KAAKxF,GAExBpnB,KAAKklD,WAAallD,KAAKmrD,WAAWjrD,GAAGglD,YAOvCqH,gBAAiB,WAEhB,IAAK,IAAIrsD,EAAI,EAAGA,EAAIF,KAAKorD,UAAUjrD,OAAQD,IAErCF,KAAKorD,UAAUlrD,IAGpBF,KAAKorD,UAAUlrD,GAAGg0B,OAAOl0B,KAAKs1B,KAQhCpB,OAAQ,SAAUoB,GAEjBt1B,KAAKs1B,GAAKA,EACVt1B,KAAKwrD,SAASpW,OAEdp1C,KAAKyrD,QAAQrW,OACbp1C,KAAK6rD,gBACL7rD,KAAK0rD,aAAatW,OAClBp1C,KAAKusD,kBAELvsD,KAAK2rD,SAASvW,UAQhB2V,GAAMpJ,QAAU,E,IAEhB6K,GAAezB;;;;ICrSf0B,GAtMgBhtD,EAAMC,OACrB,CACA6G,UAAW,UAMXy+C,MAAO,KAKP77C,KAAM,KAKNujD,SAAU,KACVC,UAAW,KAKXC,YAAa,KACbC,aAAc,KAMd9sD,OAAQ,SAAUilD,EAAO9wB,EAAO,KAAMpoB,EAAQ,MAE7C9L,KAAKmJ,KAAOiD,EAAK1C,KAAK5B,QACtB9H,KAAKglD,MAAQA,EAEbhlD,KAAK0sD,SAAWx4B,EAChBl0B,KAAK2sD,UAAY7gD,EAEjB9L,KAAK4sD,YAAc,KACnB5sD,KAAK6sD,aAAe,KAEpB7sD,KAAKglD,MAAMyG,QAAQn8C,IAAItP,KAAK8sD,QAAS9sD,MACrCA,KAAKglD,MAAM0G,aAAap8C,IAAItP,KAAK+sD,MAAO/sD,MACxCA,KAAKglD,MAAM4G,UAAUt8C,IAAItP,KAAKgtD,SAAUhtD,OAMzC6I,OAAQ,WAEP,IAAI3I,EAMJ,IAJAF,KAAKglD,MAAMyG,QAAQrgD,OAAOpL,KAAK8sD,QAAS9sD,MACxCA,KAAKglD,MAAM0G,aAAatgD,OAAOpL,KAAK+sD,MAAO/sD,MAC3CA,KAAKglD,MAAM4G,UAAUxgD,OAAOpL,KAAKgtD,SAAUhtD,MAER,QAA3BE,EAAIF,KAAKmJ,KAAKsC,UACrBvL,EAAEuhD,QAAQr2C,OAAOpL,KAAKqkD,QAASrkD,MAGhCA,KAAKmJ,KAAKT,QAMXskD,SAAU,SAAUhI,EAAO9zB,GAE1BpmB,QAAQomB,IAQTzmB,MAAO,WAEN,KAAmC,QAA3BvK,EAAIF,KAAKmJ,KAAKsC,UACrBvL,EAAEuhD,QAAQr2C,OAAOpL,KAAKqkD,QAASrkD,MAGhC,OAAOA,MAORgK,MAAO,WAEN,KAAmC,QAA3B9J,EAAIF,KAAKmJ,KAAKsC,UACrBvL,EAAEuhD,QAAQr2C,OAAOpL,KAAKqkD,QAASrkD,MAC/B8K,QAAQ5K,GAGT,OAAOF,MAORitD,UAAW,SAAUzgD,GAGpB,OADAxM,KAAK4sD,YAAcpgD,EACZxM,MAORktD,WAAY,SAAU1gD,GAGrB,OADAxM,KAAK6sD,aAAergD,EACbxM,MAORsP,IAAK,SAAU6O,GAEd,IAAK8rC,GAAQ5+C,WAAW8S,GACvB,MAAM,IAAI3X,MAAO,qCAKlB,OAHAxG,KAAKmJ,KAAKwB,KAAKwT,GAEfA,EAAKsjC,QAAQnyC,IAAItP,KAAKqkD,QAASrkD,KAAMA,KAAKmJ,KAAKqB,QACxC2T,GAMRkmC,QAAS,SAAUlmC,EAAM+S,EAAM+e,GAG9B,OADA/e,EAAK/nB,KAAKiC,OAAO6kC,IACV,GAOR7kC,OAAQ,SAAU+S,GAGjB,OADAA,EAAKsjC,QAAQjM,MAAMx1C,KAAKqkD,QAASrkD,MAC1Bme,GAMR4uC,MAAO,SAAU/H,EAAO9zB,GAEvB,IAAK,IAAIhxB,EAAIgxB,EAAK/nB,KAAKoB,IAAKrK,EAAGA,EAAIA,EAAE6J,KACpC7J,EAAEb,MAAM+jD,QAMV0J,QAAS,SAAU9H,EAAO9zB,GAEzBA,EAAKgD,OAAO8wB,EAAM1vB,KAOnBpB,OAAQ,SAAUoB,GAKjB,GAHyB,OAArBt1B,KAAK4sD,aACR5sD,KAAK4sD,YAAa5sD,KAAKmJ,KAAMmsB,EAAIt1B,KAAK2sD,WAEjB,OAAlB3sD,KAAK0sD,SACT,CACC,IAAI3iD,EAAO,KACX,IAAK,IAAI7J,EAAIF,KAAKmJ,KAAKoB,IAAKrK,EAAGA,EAAI6J,EAElCA,EAAO7J,EAAE6J,MAE2C,IAAhD/J,KAAK0sD,SAAUxsD,EAAEb,MAAOi2B,EAAIt1B,KAAK2sD,YACpC3sD,KAAKoL,OAAOlL,EAAEb,OAIS,OAAtBW,KAAK6sD,cACR7sD,KAAK6sD,aAAc7sD,KAAKmJ,KAAMmsB,EAAIt1B,KAAK2sD;;;;;AC/L1CQ,GAAezH,GAAUhmD,OACxB,CACA6G,UAAW,kBAMX4C,KAAM,KAUNpJ,OAAQ,SAAU0a,EAAM,EAAGC,EAAO,GAEjC1a,KAAK2J,OAAOyjD,UAAUrtD,OAAQ0a,EAAOC,GACrC1a,KAAKmJ,KAAOiD,EAAK1C,KAAK5B,QAEtB9H,KAAKmjD,WAAU,IAMhBt6C,OAAQ,WAEP7I,KAAKgK,QACLhK,KAAKmJ,KAAKT,OAEV1I,KAAK2J,OAAOyjD,UAAUvkD,UAOvBu6C,KAAM,SAAUjlC,GAGf,OADAne,KAAKslD,MAAMnnC,IACJ,GAORnU,MAAO,WAEN,IAAI9J,EAEJ,KAAmC,QAA3BA,EAAIF,KAAKmJ,KAAKsC,UAErBvL,EAAEuhD,QAAQr2C,OAAOpL,KAAKqkD,QAASrkD,MAC/BE,EAAEqhD,UAAY,KACdz2C,QAAQ5K,GAGTF,KAAKilD,aAAe,GAOrBx6C,MAAO,WAEN,IAAIvK,EAEJ,KAAmC,QAA3BA,EAAIF,KAAKmJ,KAAKsC,UAErBvL,EAAEuhD,QAAQr2C,OAAOpL,KAAKqkD,QAASrkD,MAC/BE,EAAEqhD,UAAY,KAGfvhD,KAAKilD,aAAe,GAOrB31C,IAAK,SAAU6O,GAEd,IAAK8rC,GAAQ5+C,WAAW8S,GACvB,MAAM,IAAI3X,MAAO,+BASlB,OAPAxG,KAAKmJ,KAAKwB,KAAKwT,GACfne,KAAKilD,eAEL9mC,EAAKojC,UAAYvhD,KACjBme,EAAKsjC,QAAQnyC,IAAItP,KAAKqkD,QAASrkD,KAAMA,KAAKmJ,KAAKqB,QAE/CxK,KAAKslD,MAAMnnC,GACJA,GAMRkmC,QAAS,SAAUlmC,EAAM+S,EAAM+e,GAM9B,OAJA/e,EAAK/nB,KAAKiC,OAAO6kC,GACjB/e,EAAK+zB,eAEL9mC,EAAKojC,UAAY,MACV,GAORn2C,OAAQ,SAAU+S,GAGjB,OADAA,EAAKsjC,QAAQjM,MAAMx1C,KAAKqkD,QAASrkD,MAC1Bme,GAORH,OAAQ,WAEP,IAAI+P,EAAQ41B,GAAYjC,MAAQiC,GAAYhC,QAE5C,IAAK,IAAIzhD,EAAIF,KAAKmJ,KAAKoB,IAAKrK,KAEK,IAA5BA,EAAEb,MAAM6iD,SAASn0B,KAGmB,IAApC/tB,KAAKqlD,YAAYnlD,EAAEb,MAAOW,OALAE,EAAIA,EAAE6J;;;;;;;AC/HvCsjD,GAAe3H,GAAUhmD,OACxB,CACA6G,UAAW,gBAMXs9C,KAAM,KAMNjtB,aAAa,EAUb72B,OAAQ,SAAU0a,EAAM,MAAOC,EAAO,MAAO4yC,EAAS,GAAIC,EAAS,MAElEvtD,KAAK2J,OAAOyjD,UAAUrtD,OAAQ0a,EAAOC,GACrC1a,KAAK6jD,KAAO,IAAID,GAAMnpC,EAAOC,EAAQ4yC,EAAUC,IAMhD1kD,OAAQ,WAEP7I,KAAKgK,QACLhK,KAAK2J,OAAOyjD,UAAUvkD,UAOvBu6C,KAAM,SAAUjlC,GAGf,OADAne,KAAKslD,MAAMnnC,GACJne,KAAK6jD,KAAKT,KAAKjlC,IAOvBnU,MAAO,WAENhK,KAAK6jD,KAAK75C,SAOXS,MAAO,WAENzK,KAAK6jD,KAAKp5C,SAOX6E,IAAK,SAAU6O,GAEd,IAAK8rC,GAAQ5+C,WAAW8S,GACvB,MAAM,IAAI3X,MAAO,+BAElB,OAAKxG,KAAK6jD,KAAKv0C,IAAI6O,IAGnBA,EAAKojC,UAAYvhD,KACjBA,KAAKilD,aAAejlD,KAAK6jD,KAAK/jD,MAE9BE,KAAKslD,MAAMnnC,GACJA,GANC,MAaT/S,OAAQ,SAAU+S,GAIjB,OAFAne,KAAK6jD,KAAKz4C,OAAO+S,GACjBne,KAAKilD,aAAejlD,KAAK6jD,KAAK/jD,MACvBqe,GAORH,OAAQ,WAIP,GAFAhe,KAAK6jD,KAAKS,gBAAgBtkD,KAAK+kD,eAAgBpB,GAAYjC,MAAQiC,GAAYhC,QAASgC,GAAYjC,MAAQiC,GAAYhC,QAAS3hD,KAAKqlD,YAAarlD,OAE1H,IAArBA,KAAK42B,aAAiD,OAAxB52B,KAAK+kD,eACtC,OAED,IAAI39B,EAAI0F,EAAOsC,eAEfhI,EAAEgC,aACFhC,EAAE2C,WAAW/pB,KAAKonB,EAAE4C,aAEpB,IAAIwtB,GAAMx3C,KAAM+kD,eAAeriC,GAAG1iB,KAAK6jD,KAAKE,OAAS,GAAG/jD,KAAK6jD,KAAKI,GAAG,IAAOjkD,KAAK6jD,KAAKI,IAAMjkD,KAAK6jD,KAAKK,OAClGxhC,GAAM1iB,KAAM+kD,eAAeniC,GAAG5iB,KAAK6jD,KAAKE,OAAU,GAAG/jD,KAAK6jD,KAAKI,GAAG,IAAMjkD,KAAK6jD,KAAKI,IAAMjkD,KAAK6jD,KAAKK,OAClGpnB,EAAM98B,KAAM+kD,eAAetiC,GAAGziB,KAAK6jD,KAAKC,OAAS,GAAG9jD,KAAK6jD,KAAKG,GAAG,IAAOhkD,KAAK6jD,KAAKG,GAClFvhC,EAAMziB,KAAM+kD,eAAepiC,GAAG3iB,KAAK6jD,KAAKC,OAAU,GAAG9jD,KAAK6jD,KAAKG,GAAG,IAAMhkD,KAAK6jD,KAAKG,GAEtFxM,GAAM/wC,IAAI+wC,EAAKx3C,KAAK6jD,KAAKK,SAAWlkD,KAAK6jD,KAAKI,IAAMjkD,KAAK6jD,KAAKE,MAC9DrhC,GAAMjc,IAAIic,EAAK1iB,KAAK6jD,KAAKK,SAAWlkD,KAAK6jD,KAAKI,IAAMjkD,KAAK6jD,KAAKE,OAAS,GAAK/jD,KAAK6jD,KAAKI,IACtFnnB,GAAMA,GAAM98B,KAAK6jD,KAAKG,IAAMhkD,KAAK6jD,KAAKC,MACtCrhC,GAAMA,GAAMziB,KAAK6jD,KAAKG,IAAMhkD,KAAK6jD,KAAKC,OAAS,GAAK9jD,KAAK6jD,KAAKG,IAE9D58B,EAAEnH,UAAU,qBACZmH,EAAE5F,SAASsb,EAAI0a,EAAI/0B,EAAGqa,EAAG,EAAGpa,EAAG80B,EAAG,GAElCA,EAAKx3C,KAAK+kD,eAAeriC,GACzBA,EAAK1iB,KAAK+kD,eAAeniC,GACzBka,EAAK98B,KAAK+kD,eAAetiC,GACzBA,EAAKziB,KAAK+kD,eAAepiC,GAEzByE,EAAEa,UAAU,EAAE6E,EAAOmC,mBACrB7H,EAAEpH,YAAY,QACdoH,EAAE3F,WAAWqb,EAAI0a,EAAI/0B,EAAGqa,EAAG,EAAGpa,EAAG80B,EAAG,GAEpCpwB,EAAEa,UAAU,EAAE6E,EAAOmC,mBACrB7H,EAAEpH,YAAY,QACd,IAAK,IAAI7R,EAAIiR,EAAQqI,SAAS85B,UAAU7+B,GAAG1iB,KAAK6jD,KAAKE,MAAO51C,EAAIiR,EAAQqI,SAAS85B,UAAU3+B,GAAG5iB,KAAK6jD,KAAKE,MAAO51C,GAAM,GAAKnO,KAAK6jD,KAAKI,GACpI,IAAK,IAAI3kD,EAAI8f,EAAQqI,SAAS85B,UAAU9+B,GAAGziB,KAAK6jD,KAAKC,MAAOxkD,EAAI8f,EAAQqI,SAAS85B,UAAU5+B,GAAG3iB,KAAK6jD,KAAKC,MAAOxkD,GAAM,GAAKU,KAAK6jD,KAAKG,GAEnI58B,EAAE3F,WAAWniB,EAAEU,KAAK6jD,KAAKC,MAAO31C,EAAEnO,KAAK6jD,KAAKE,MAAQ,GAAK/jD,KAAK6jD,KAAKG,GAAM,GAAKhkD,KAAK6jD,KAAKI,IAGzF78B,EAAEiC,aAQHi7B,gBAAiB,SAAU9gB,EAAQ+gB,EAAcC,EAAYh4C,EAAUV,GAEtE9L,KAAK6jD,KAAKS,gBAAiB9gB,EAAQ+gB,EAAcC,EAAYh4C,EAAUV,IAOxE64C,eAAgB,SAAUnhB,EAAQ+gB,EAAcC,GAE/C,OAAOxkD,KAAK6jD,KAAKc,eAAgBnhB,EAAQ+gB,EAAcC,IAOxDI,cAAe,SAAUphB,EAAQ+gB,EAAcC,GAE9C,OAAOxkD,KAAK6jD,KAAKe,cAAephB,EAAQ+gB,EAAcC,IAOvDK,YAAa,SAAUrhB,EAAQ+gB,EAAcC,GAE5C,OAAOxkD,KAAK6jD,KAAKgB,YAAarhB,EAAQ+gB,EAAcC;;;;;ACzLtD,MAAMgJ,GAAOvD,GAAQvqD,OACpB,CACA6G,UAAW,OAMX0O,KAAM,EAMNlV,OAAQ,SAASkV,EAAM3V,EAAG6O,EAAGsM,EAAOC,GAEnC1a,KAAK2J,OAAO0gD,QAAQtqD,OAAOT,EAAG6O,EAAGsM,EAAOC,GAExC1a,KAAKiV,KAAOA,GAOb2X,KAAM,SAASxF,GAEd,IAA2B,IAAvBhI,EAAQyX,cAA8C,IAArB72B,KAAK42B,aAA8C,IAArB52B,KAAK42B,aACvE,OAED,IAAIkD,EAAI1S,EAAE4C,aACV5C,EAAI0F,EAAOsC,gBAEThG,aACFhC,EAAE2C,WAAW+P,GACb1S,EAAEnH,UAAUgqC,GAAQJ,cAAc7pD,KAAK42B,cACvCxP,EAAE5F,SAASxhB,KAAKwjC,OAAO/gB,GAAIziB,KAAKwjC,OAAO9gB,GAAI1iB,KAAKwjC,OAAO/oB,QAASza,KAAKwjC,OAAO9oB,UAC5E0M,EAAEiC;;;iBAcJpjB;EAASwD,WAAW+jD,I,IACpBC,GAAeD;;;8BCvDf;MAAME,GAAQzD,GAAQvqD,OACrB,CACA6G,UAAW,QAKX2K,GAAI,EAAGC,GAAI,EAMX2R,KAAM,KAQNyF,KAAM,KAKNolC,QAAQ,EAMRC,UAAW,KAMXC,WAAY,KAKZC,QAAQ,EACRC,SAAS,EAKTC,YAAa,KACbC,YAAa,KAMbluD,OAAQ,SAAST,EAAG6O,EAAGoa,EAAMzF,GAE5B9iB,KAAK2J,OAAO0gD,QAAQtqD,OAAOC,KAAKkR,GAAK5R,EAAGU,KAAKmR,GAAKhD,EAAG,EAAG,GAExDnO,KAAK8iB,KAAO,KACZ9iB,KAAKuoB,KAAOA,EAEZvoB,KAAK8tD,QAAS,EACd9tD,KAAK+tD,SAAU,EAEf/tD,KAAK8pD,WAAW9pD,KAAKkuD,YACrBluD,KAAKmuD,QAAQrrC,IAQdsrC,MAAO,SAAU/uD,GAEhB,OAAIW,KAAK8tD,SAAWzuD,EACZW,MAERA,KAAK8tD,OAASzuD,EACdW,KAAKguD,YAAc,KACZhuD,KAAKk0B,WAQbm6B,OAAQ,SAAShvD,GAEhB,OAAIW,KAAK+tD,UAAY1uD,EACbW,MAERA,KAAK+tD,QAAU1uD,EACfW,KAAKiuD,YAAc,KACZjuD,KAAKk0B,WAObi6B,QAAS,SAAU9uD,GAElB,OAAIW,KAAK8iB,OAASzjB,EACVW,MAERA,KAAK8iB,KAAOzjB,EACZW,KAAK2tD,QAAS,EACP3tD,KAAKk0B,WASbo6B,QAAS,SAAU/lC,GAElB,OAAIvoB,KAAKuoB,OAASA,EACVvoB,MAERA,KAAKuoB,KAAOA,EACZvoB,KAAK2tD,QAAS,EACP3tD,KAAKk0B,WAObA,OAAQ,WAiCP,OA/BoB,IAAhBl0B,KAAK2tD,SAER3tD,KAAKguD,YAAc,KACnBhuD,KAAKiuD,YAAc,KAEnBjuD,KAAK4tD,UAAY5tD,KAAKuoB,KAAK4hB,aAAanqC,KAAK8iB,MAC7C9iB,KAAK6tD,WAAa7tD,KAAKuoB,KAAK6hB,cAAcpqC,KAAK8iB,MAE/C9iB,KAAK2tD,QAAS,EAEd3tD,KAAKwjC,OAAOtjB,OAAOlgB,KAAK4tD,UAAW5tD,KAAK6tD,YAAY,IAG5B,OAArB7tD,KAAKguD,cAEJhuD,KAAK8tD,OAAS,EAAG9tD,KAAKguD,YAAc,EACf,IAAhBhuD,KAAK8tD,OAAc9tD,KAAKguD,aAAehuD,KAAK4tD,WAAa,EAC7D5tD,KAAKguD,aAAehuD,KAAK4tD,UAE9B5tD,KAAKwjC,OAAO30B,WAAW7O,KAAKwjC,OAAO/gB,GAAKziB,KAAKkR,GAAKlR,KAAKguD,YAAa,IAG5C,OAArBhuD,KAAKiuD,cAEJjuD,KAAK+tD,QAAU,EAAG/tD,KAAKiuD,YAAc,EACf,IAAjBjuD,KAAK+tD,QAAe/tD,KAAKiuD,aAAejuD,KAAK6tD,YAAc,EAC/D7tD,KAAKiuD,aAAejuD,KAAK6tD,WAE9B7tD,KAAKwjC,OAAO30B,UAAU,GAAI7O,KAAKwjC,OAAO9gB,GAAK1iB,KAAKmR,GAAKnR,KAAKiuD,cAGpDjuD,MAQR6O,UAAW,SAAUC,EAAIC,EAAI0pC,GAAS,GAUrC,OARAz4C,KAAK2J,OAAO0gD,QAAQx7C,UAAUC,EAAIC,EAAI0pC,GAEtCz4C,KAAKkR,GAAKlR,KAAKwjC,OAAO/gB,GACtBziB,KAAKmR,GAAKnR,KAAKwjC,OAAO9gB,GAEtB1iB,KAAKguD,YAAc,KACnBhuD,KAAKiuD,YAAc,KAEZjuD,KAAKk0B,UAMbg6B,WAAY,SAAS9mC,EAAGjJ,EAAMV,GAE7BU,EAAKoK,KAAK0hB,SAAU7iB,EAAGjJ,EAAKqlB,OAAO/gB,GAAItE,EAAKqlB,OAAO9gB,GAAIvE,EAAK2E;;;iBAe9D7c;EAASwD,WAAWikD,I,IACpBa,GAAeb;;;;;;;;AC7Lfc,GAAetT,GAAKD,OAAOthC,OAC1B,CACA80C,SAAU,KAEV1uD,OAAQ,WAEP,MAAMmxB,EAAOlxB,KAEbA,KAAK2J,OAAOsxC,OAAOl7C,SAEnBC,KAAKyuD,SAAW,IAAI5a,GAEpB7zC,KAAK0uD,qBAAuB,SAAU15B,GACrC,OAAO9D,EAAKy9B,oBAAoB35B,KAQlCgb,SAAU,SAAUhb,GAEnB,IACCh1B,KAAKyuD,SAASn/C,IAAI0lB,GAEd,SAAUA,GACbA,EAAQvsB,OAEV,MAAOkY,GACN,MAAM,IAAIna,MAAO,+BAAiCma,EAAEiuC,SAGrD,OAAO55B,GAORmb,WAAY,SAAUnb,GAErB,IACCh1B,KAAKyuD,SAASrjD,OAAO4pB,GACrBh1B,KAAKyuD,SAASra,UAEf,MAAOzzB,GACN,MAAM,IAAIna,MAAO,iCAAmCma,EAAEiuC,WAIxDD,oBAAqB,SAAU35B,GAE9B,OAAOA,EAAQ/C,gBAAgBjyB,KAAK6uD,QAAS7uD,KAAK8uD,SAAU9uD,KAAK+uD,YAMlElU,UAAW,WAEV/tB,EAAOmF,gBAAkB,CAAC9G,EAAQuE,EAASH,KAE1CvvB,KAAK6uD,QAAU1jC,EACfnrB,KAAK8uD,SAAWp/B,EAChB1vB,KAAK+uD,UAAYx/B,EAEjBvvB,KAAKyuD,SAAS7iD,QAAQ5L,KAAK0uD,wBAO7B1T,WAAY,WAEXluB,EAAOmF,gBAAkB;;;;;;;;AC5E3B+8B,GAAe9T,GAAKD,OAAOthC,OAC1B,CACA80C,SAAU,KAEV1uD,OAAQ,WAEP,MAAMmxB,EAAOlxB,KAEbA,KAAK2J,OAAOsxC,OAAOl7C,SAEnBC,KAAKyuD,SAAW,IAAI5a,GAEpB7zC,KAAKivD,oBAAsB,SAAUj6B,GACpC,OAAO9D,EAAKg+B,mBAAmBl6B,KAQjCgb,SAAU,SAAUhb,GAEnB,IACCh1B,KAAKyuD,SAASn/C,IAAI0lB,GAEd,SAAUA,GACbA,EAAQvsB,OAEV,MAAOkY,GACN,MAAM,IAAIna,MAAO,8BAAgCma,EAAEiuC,SAGpD,OAAO55B,GAORmb,WAAY,SAAUnb,GAErB,IACCh1B,KAAKyuD,SAASrjD,OAAO4pB,GACrBh1B,KAAKyuD,SAASra,UAEf,MAAOzzB,GACN,MAAM,IAAIna,MAAO,gCAAkCma,EAAEiuC,WAIvDM,mBAAoB,SAAUl6B,GAE7B,OAAOA,EAAQ7B,eAAenzB,KAAK6uD,QAAS7uD,KAAKmvD,GAAInvD,KAAKovD,YAM3DvU,UAAW,WAEV/tB,EAAOqG,eAAiB,CAAChI,EAAQ+H,EAAGvD,KAEnC3vB,KAAK6uD,QAAU1jC,EACfnrB,KAAKmvD,GAAKj8B,EACVlzB,KAAKovD,UAAYz/B,EAEjB3vB,KAAKyuD,SAAS7iD,QAAQ5L,KAAKivD,uBAO7BjU,WAAY,WAEXluB,EAAOqG,eAAiB;;;;;;;;;ACvC1B,MAAMk8B,GACL,CACApb,SAAU,EAKVqb,QAAS5Z,GAKTvsC,KAAM,GAKNomD,WAAW,EAKXC,YAAY,EAKZC,UAAW,EAMXngD,IAAK,SAAU0lB,IAEqB,IAA/Bh1B,KAAKmJ,KAAK0L,QAAQmgB,IACrBh1B,KAAKmJ,KAAKwB,KAAKqqB,IAOjB5pB,OAAQ,SAAU4pB,GAEjB,IAAI90B,EAAIF,KAAKmJ,KAAK0L,QAAQmgB,IAChB,IAAN90B,GAAUF,KAAKmJ,KAAKujB,OAAOxsB,EAAG,IAWnCwvD,MAAO,SAAUrwD,EAAM,MAEtB,GAAc,OAAVA,EACH,OAAOW,KAAKuvD,UAEbvvD,KAAKuvD,UAAYlwD,GAWlBswD,OAAQ,SAAUtwD,EAAM,MAEvB,GAAc,OAAVA,EACH,OAAOW,KAAKwvD,WAEbxvD,KAAKwvD,WAAanwD,GAGnBuwD,WAAY,SAAUtwD,EAAG6O,EAAGlC,EAAO,MAGlC,GAAIjM,KAAKwvD,YAAcxvD,KAAKyvD,WAAa3iC,EAAOsD,YAChD,CACC,IAAIu/B,EAAS3vD,KAAKmJ,KAAK,GAAGwmD,OAE1B,IAAK,IAAI9nD,KAAQ7H,KAAKmJ,KACtB,CACC,GAAItB,EAAK8nD,OAASA,EAClB,CACC3vD,KAAKmJ,KAAOnJ,KAAKmJ,KAAKgrC,MAAK,CAAC9zC,EAAEC,IAAMA,EAAEqvD,OAAStvD,EAAEsvD,SACjD,MAGDA,EAAS9nD,EAAK8nD,OAGf3vD,KAAKyvD,UAAY3iC,EAAOsD,YAGzB,IAAK,IAAIlwB,EAAI,EAAGA,EAAIF,KAAKmJ,KAAKhJ,OAAQD,IAErC,GAAKF,KAAKmJ,KAAKjJ,KAEA,OAAX+L,IAA4C,IAAzBA,EAAOjM,KAAKmJ,KAAKjJ,MAGpCF,KAAKmJ,KAAKjJ,GAAG02C,cAAct3C,EAAG6O,GACjC,OAAOnO,KAAKmJ,KAAKjJ,GAGnB,OAAO,MAQR2vD,YAAa,SAAU3vD,GAEtB,MAAO,UAAWA,GAUnBizB,eAAgB,SAAUhI,EAAQ+H,EAAGvD,GAEpC,IAAImgC,GAAY,EACZ97B,EAAM,KAEV,OAAQ7I,GAEP,KAAK2B,EAAOsG,iBAAiB9F,aAEd,MAAV4F,EAAE68B,OAEL/7B,EAAMd,EAAE68B,KAAM78B,EAAE68B,KAAO,KACvB/7B,EAAIg8B,kBAAkB98B,IAGvBc,EAAMh0B,KAAK4vD,WAAW18B,EAAE5zB,EAAG4zB,EAAE/kB,GAClB,MAAP6lB,KAEFd,EAAE68B,KAAO/7B,GAAKi8B,gBAAgB/8B,GAC/B48B,GAAY,GAGb,MAED,KAAKhjC,EAAOsG,iBAAiB3F,mBACd,MAAVyF,EAAE68B,OAAcD,GAAY,GAChC,MAED,KAAKhjC,EAAOsG,iBAAiB1F,kBACxB1tB,KAAKuvD,YAEO,MAAXr8B,EAAEg9B,MAEDh9B,EAAEg9B,MAAMtZ,cAAc1jB,EAAE5zB,EAAG4zB,EAAE/kB,KAKhC6lB,EAAMd,EAAEg9B,MAAOh9B,EAAEg9B,MAAQ,KACzBl8B,EAAI07B,OAAM,EAAOx8B,GAEjBc,EAAMh0B,KAAK4vD,WAAW18B,EAAE5zB,EAAG4zB,EAAE/kB,EAAGnO,KAAK6vD,aAC1B,MAAP77B,IACFd,EAAEg9B,MAAQl8B,GAAK07B,OAAM,EAAMx8B,KAK9Bc,EAAMh0B,KAAK4vD,WAAW18B,EAAE5zB,EAAG4zB,EAAE/kB,EAAGnO,KAAK6vD,aAC1B,MAAP77B,IACFd,EAAEg9B,MAAQl8B,GAAK07B,OAAM,EAAMx8B,KAIjB,MAAVA,EAAE68B,KAED78B,EAAE68B,KAAKnZ,cAAc1jB,EAAE5zB,EAAG4zB,EAAE/kB,IAA0B,GAApB+kB,EAAE68B,KAAKI,WAE5Cj9B,EAAE68B,KAAKK,cAAel9B,EAAE5zB,EAAG4zB,EAAE/kB,EAAG+kB,GAChC48B,GAAY,IAIZ97B,EAAMd,EAAE68B,KAAM78B,EAAE68B,KAAO,KACvB/7B,EAAIg8B,kBAAkB98B,GAEtBc,EAAMh0B,KAAK4vD,WAAW18B,EAAE5zB,EAAG4zB,EAAE/kB,GAClB,MAAP6lB,KAEFd,EAAE68B,KAAO/7B,GAAKi8B,gBAAgB/8B,GAC/B48B,GAAY,KAMd97B,EAAMh0B,KAAK4vD,WAAW18B,EAAE5zB,EAAG4zB,EAAE/kB,GAClB,MAAP6lB,KAEFd,EAAE68B,KAAO/7B,GAAKi8B,gBAAgB/8B,GAC/B48B,GAAY,IAId,MAED,KAAKhjC,EAAOsG,iBAAiB5F,aA0B5B,GAzBIxtB,KAAKuvD,YAEO,MAAXr8B,EAAEg9B,MAEDh9B,EAAEg9B,MAAMtZ,cAAc1jB,EAAE5zB,EAAG4zB,EAAE/kB,KAKhC6lB,EAAMd,EAAEg9B,MAAOh9B,EAAEg9B,MAAQ,KACzBl8B,EAAI07B,OAAM,EAAOx8B,GAEjBc,EAAMh0B,KAAK4vD,WAAW18B,EAAE5zB,EAAG4zB,EAAE/kB,EAAGnO,KAAK6vD,aAC1B,MAAP77B,IACFd,EAAEg9B,MAAQl8B,GAAK07B,OAAM,EAAMx8B,KAK9Bc,EAAMh0B,KAAK4vD,WAAW18B,EAAE5zB,EAAG4zB,EAAE/kB,EAAGnO,KAAK6vD,aAC1B,MAAP77B,IACFd,EAAEg9B,MAAQl8B,GAAK07B,OAAM,EAAMx8B,KAIjB,MAAVA,EAAE68B,KAAc,MAEhB78B,EAAE68B,KAAKnZ,cAAc1jB,EAAE5zB,EAAG4zB,EAAE/kB,IAA0B,GAApB+kB,EAAE68B,KAAKI,WAE5Cj9B,EAAE68B,KAAKK,cAAel9B,EAAE5zB,EAAG4zB,EAAE/kB,EAAG+kB,GAChC48B,GAAY,IAIZ97B,EAAMd,EAAE68B,KAAM78B,EAAE68B,KAAO,KACvB/7B,EAAIg8B,kBAAkB98B,IAGvB,MAED,KAAKpG,EAAOsG,iBAAiBzF,kBACd,MAAVuF,EAAE68B,OAAcD,GAAY,GAChC,MAED,KAAKhjC,EAAOsG,iBAAiB7F,WACd,MAAV2F,EAAE68B,OAEL/7B,EAAMd,EAAE68B,KAAM78B,EAAE68B,KAAO,KACvB/7B,EAAIg8B,kBAAkB98B,GAEtB48B,GAAY,GAMf,OAAOA,GAUR79B,gBAAiB,SAAU9G,EAAQuE,EAAS2gC,GAE3C,OAAQllC,GAEP,KAAK2B,EAAOoF,kBAAkB9E,SAE7B,IAAK,IAAIltB,EAAI,EAAGA,EAAIF,KAAKmJ,KAAKhJ,UAExBH,KAAKmJ,KAAKjJ,KAAOF,KAAKmJ,KAAKjJ,GAAGowD,iBAEY,IAA3CtwD,KAAKmJ,KAAKjJ,GAAGqwD,QAAQ7gC,EAAS2gC,IAJGnwD,KAQtC,MAED,KAAK4sB,EAAOoF,kBAAkB7E,OAE7B,IAAK,IAAIlT,EAAI,EAAGA,EAAIna,KAAKmJ,KAAKhJ,UAExBH,KAAKmJ,KAAKgR,KAAOna,KAAKmJ,KAAKgR,GAAGm2C,iBAEU,IAAzCtwD,KAAKmJ,KAAKgR,GAAGq2C,MAAM9gC,EAAS2gC,IAJKl2C,MAWxC,OAAO;SAMT60C;GAAehf,SAASqf,IACxBb,GAAgBxe,SAASqf,I,IAEzBoB,GAAepB;;;;AC3XfqB,GAAe5F,GAAMprD,OACpB,CAMAywD,WAAW,EAOXG,gBAAgB,EAMhBK,WAAW,EAMXC,YAAY,EAMZC,aAAc,KAMdC,WAAY,KAOZphC,QAAS,KAMTqhC,OAAQ,KAKRC,cAAe,KACfC,YAAa,KACbC,OAAQ,KACRC,UAAW,KAMXpxD,OAAQ,SAAUwhD,EAAWjiD,EAAG6O,EAAG0iD,EAAa,KAAMC,EAAW,MAEhE9wD,KAAK2J,OAAOynD,MAAMrxD,SAElBC,KAAK6wD,aAAeA,EACpB7wD,KAAK8wD,WAAaA,GAAcD,EAChC7wD,KAAK+wD,OAAS,KAEd,IAAIA,EAAStD,GAAK/jD,KAAK5B,MAAO,EAAGxI,EAAG6O,EAAGnO,KAAK6wD,aAAe7wD,KAAK6wD,aAAap2C,MAAQ,GAAIza,KAAK6wD,aAAe7wD,KAAK6wD,aAAan2C,OAAS,IAAImoC,SAAQ,GAAOE,aAAY,GAAM15C,MAAM,GACnLrJ,KAAKuqD,SAASwG,GAEdxP,EAAUjyC,IAAIyhD,GACdxP,EAAUjyC,IAAItP,MAEdA,KAAK+wD,OAASA,EAEd/wD,KAAKgxD,cAAgB,KACrBhxD,KAAKixD,YAAc,KACnBjxD,KAAKkxD,OAAS,KACdlxD,KAAKmxD,UAAYnxD,KAAKqxD,kBAEtBrxD,KAAKyK,QACLgmD,GAAenhD,IAAItP,OAMpB6I,OAAQ,WAEP7I,KAAK2J,OAAOynD,MAAMvoD,SAClB4nD,GAAerlD,OAAOpL,OAOvBkgB,OAAQ,SAAUzF,EAAOC,GAOxB,OALA1a,KAAK2J,OAAOynD,MAAMlxC,OAAOzF,EAAOC,GAEZ,OAAhB1a,KAAK+wD,QACR/wD,KAAK+wD,OAAO7wC,OAAOzF,EAAOC,GAEpB1a,MAORw2C,SAAU,SAAU2C,EAAQC,GAO3B,OALAp5C,KAAK2J,OAAOynD,MAAM5a,SAAS2C,EAAQC,GAEf,OAAhBp5C,KAAK+wD,QACR/wD,KAAK+wD,OAAOva,SAAS2C,EAAQC,GAEvBp5C,MAORsxD,SAAU,SAAUT,EAAcC,EAAW,MAM5C,OAJA9wD,KAAK6wD,aAAeA,EACpB7wD,KAAK8wD,WAAaA,GAAcD,EAEhC7wD,KAAKyK,QACEzK,MAORuxD,WAAY,SAAUlyD,GAGrB,OADAW,KAAK0vB,QAAUrwB,EACRW,MAORyK,MAAO,WAIN,OAFAzK,KAAKyd,IAAMzd,KAAK6wD,aAChB7wD,KAAKmxD,UAAWnxD,KAAK2wD,WAAY,EAAO3wD,KAAK4wD,YAAa,EAAO5wD,MAC1DA,MAORowD,cAAe,SAAUoB,EAAUC,EAAU57B,KAQ7C67B,UAAW,SAAUryD,GAEpB,OAAIW,KAAK2wD,YAActxD,IAGvBW,KAAK2xD,aAActyD,GAEnBW,KAAKyd,IAAMzd,KAAK2wD,UAAY3wD,KAAK8wD,WAAa9wD,KAAK6wD,aACnD7wD,KAAKmxD,UAAWnxD,KAAK2wD,UAAW3wD,KAAK4wD,WAAY5wD,OALzCA,MAcT2xD,aAAc,SAAUtyD,EAAM,MAI7B,OAFAW,KAAK4wD,WAAa5wD,KAAK2wD,UACvB3wD,KAAK2wD,UAAsB,OAAVtxD,EAAiBW,KAAK2wD,UAAYtxD,EAC5CW,MAORiwD,gBAAiB,SAAUp6B,GAE1B71B,KAAK0xD,WAAU,IAOhB1B,kBAAmB,SAAUn6B,GAE5B71B,KAAK0xD,WAAU,IAOhB9a,cAAe,SAASt3C,EAAG6O,GAE1B,SAAKnO,KAAK6iD,WAAa7iD,KAAKkf,SAAW,IAGhClf,KAAK+wD,OAAOvtB,OAAOoT,cAAct3C,EAAG6O,IAO5CkjD,kBAAmB,SAAUV,EAAWC,EAAY79B,GAE/C49B,IAAcC,IAEbD,GAAa3wD,KAAKgxD,cACrBhxD,KAAKgxD,iBACIL,GAAa3wD,KAAKixD,aAC3BjxD,KAAKixD,gBAGFN,GAAaC,GAAc5wD,KAAKkxD,QACpClxD,KAAKkxD,UAOPX,QAAS,SAAU7gC,EAAS2gC,GAE3B,GAAI3gC,IAAY1vB,KAAK0vB,QAGpB,OADA1vB,KAAKiwD,mBACE,GAQTO,MAAO,SAAU9gC,EAAS2gC,GAEzB,GAAI3gC,IAAY1vB,KAAK0vB,QAGpB,OADA1vB,KAAKgwD,qBACE,GAUT4B,SAAU,SAAUplD,GAGnB,OADAxM,KAAKmxD,UAAyB,OAAb3kD,EAAoBxM,KAAKqxD,kBAAoB7kD,EACvDxM,MAWR6xD,aAAc,SAAUrlD,GAAS,GAEhC,IAAiB,IAAbA,EAMJ,OADAxM,KAAKgxD,cAAgBxkD,EACdxM,KALFA,KAAKgxD,eAAehxD,KAAKgxD,iBAgB/Bc,WAAY,SAAUtlD,GAAS,GAE9B,IAAiB,IAAbA,EAMJ,OADAxM,KAAKixD,YAAczkD,EACZxM,KALFA,KAAKixD,aAAajxD,KAAKixD,eAgB7Bc,MAAO,SAAUvlD,GAAS,GAEzB,IAAiB,IAAbA,EAMJ,OADAxM,KAAKkxD,OAAS1kD,EACPxM,KALFA,KAAKkxD,QAAQlxD,KAAKkxD;;;;;AC1UzBc,GAAelH,GAAMprD,OACpB,CAMAywD,WAAW,EAKXG,gBAAgB,EAMhBK,WAAW,EAMXC,YAAY,EAMZC,aAAc,KAMdC,WAAY,KAMZmB,kBAAmB,KAMnBC,gBAAiB,KAMjBC,WAAY,EAMZC,YAAa,EAMbxjC,MAAO,EAMPC,MAAO,EAMPwjC,MAAO,EAMPC,MAAO,EAMPC,KAAM,EAMNC,KAAM,EAMN3iD,UAAW,EAMXZ,MAAO,EAKPwjD,OAAQ,EAAGC,OAAQ,EAAGC,MAAO,EAAGC,MAAO,EAAGC,WAAY,EAAGC,OAAQ,EAKjEC,MAAO,EAAGC,MAAO,EAKjBC,OAAQ,EAAGC,UAAW,EAKtBC,UAAW,EAAGC,UAAW,EAKzBrC,OAAQ,KAKRI,UAAW,KAKXxvD,GAAI,KACJE,KAAM,KACNH,KAAM,KACNE,MAAO,KAKPyxD,QAAS,KAAMC,QAAS,KACxBC,QAAS,KAAMC,QAAS,KAMxBzzD,OAAQ,SAAUwhD,EAAWjiD,EAAG6O,EAAG+kD,EAAWrC,EAAcoB,EAAmBnB,EAAW,KAAMoB,EAAgB,MAE/GlyD,KAAK2J,OAAOynD,MAAMrxD,SAElBC,KAAK6wD,aAAeA,EACpB7wD,KAAK8wD,WAAaA,GAAcD,EAEhC7wD,KAAKiyD,kBAAoBA,EACzBjyD,KAAKkyD,gBAAkBA,GAAmBD,EAE1CjyD,KAAKkzD,UAAYA,EAEjBlzD,KAAKmzD,UAAY,EACjBnzD,KAAKozD,UAAY,EAEjBpzD,KAAK4uB,MAAQ,EACb5uB,KAAK6uB,MAAQ,EAEb7uB,KAAKqzD,SAAU,EACfrzD,KAAKszD,SAAU,EACftzD,KAAKuzD,SAAU,EACfvzD,KAAKwzD,SAAU,EAEfxzD,KAAK+wD,OAAStD,GAAK/jD,KAAK5B,MAAO,EAAGxI,EAAG6O,GAAInO,KAAK6wD,cAAgB7wD,KAAKiyD,mBAAmBx3C,OAAQza,KAAK6wD,cAAgB7wD,KAAKiyD,mBAAmBv3C,QAAQmoC,SAAQ,GAAOE,aAAY,GAAM15C,MAAM,GAC1LrJ,KAAKuqD,SAASvqD,KAAK+wD,QAEnBxP,EAAUjyC,IAAItP,KAAK+wD,QACnBxP,EAAUjyC,IAAItP,MAEdA,KAAKmxD,UAAY,KAEjBnxD,KAAK8pD,WAAW9pD,KAAKyzD,aACrBhD,GAAenhD,IAAItP,OAMpB6I,OAAQ,WAEP7I,KAAK2J,OAAOynD,MAAMvoD,SAClB4nD,GAAerlD,OAAOpL,OAOvB0zD,SAAU,SAAUC,EAAG/yD,EAAQe,GAAIiyD,EAAKhzD,EAAQiB,KAAMid,EAAKle,EAAQc,KAAMmyD,EAAMjzD,EAAQgB,OAQtF,OANA5B,KAAK2B,GAAKgyD,EACV3zD,KAAK6B,KAAO+xD,EACZ5zD,KAAK0B,KAAOod,EACZ9e,KAAK4B,MAAQiyD,EAEb7zD,KAAKswD,gBAAiB,EACftwD,MAWR8zD,YAAa,SAAUz0D,EAAM,MAE5B,OAAc,OAAVA,EACIW,KAAKswD,gBAEbtwD,KAAKswD,eAAiBjxD,EACfW,OAOR+zD,UAAW,SAAUtxC,EAAIC,EAAIC,EAAIC,GAMhC,OAJA5iB,KAAKqzD,QAAU5wC,EACfziB,KAAKszD,QAAU5wC,EACf1iB,KAAKuzD,QAAU5wC,EACf3iB,KAAKwzD,QAAU5wC,EACR5iB,MAORsxD,SAAU,SAAUT,EAAcC,EAAW,MAI5C,OAFA9wD,KAAK6wD,aAAeA,EACpB7wD,KAAK8wD,WAAaA,GAAcD,EACzB7wD,MAORg0D,cAAe,SAAUnD,EAAcC,EAAW,MAIjD,OAFA9wD,KAAKiyD,kBAAoBpB,EACzB7wD,KAAKkyD,gBAAkBpB,GAAcD,EAC9B7wD,MAORi0D,cAAe,SAAUxsD,GAGxB,OADAzH,KAAKmyD,WAAa1qD,EACXzH,MAORk0D,eAAgB,SAAUzsD,GAGzB,OADAzH,KAAKoyD,YAAc3qD,EACZzH,MAWRm0D,YAAa,SAAUhB,EAAWC,EAAU,MAK3C,OAHApzD,KAAKmzD,UAAYA,EACjBnzD,KAAKozD,UAAYA,GAAaD,EAEvBnzD,MAORyK,MAAO,WAeN,OAbAzK,KAAK+yD,MAAQ,EACb/yD,KAAKgzD,MAAQ,EAEbhzD,KAAKqyD,MAAQ,EACbryD,KAAKsyD,MAAQ,EAEbtyD,KAAKuyD,KAAO,EACZvyD,KAAKwyD,KAAO,EACZxyD,KAAK6P,UAAY,EAEb7P,KAAKmxD,WACRnxD,KAAKmxD,UAAWnxD,KAAKuyD,KAAMvyD,KAAKwyD,KAAMxyD,KAAK6P,UAAW7P,KAAKiP,MAAOjP,MAE5DA,MAMRyzD,YAAa,SAAUrsC,EAAGjJ,EAAMV,GAE3BU,EAAKwyC,WAEJxyC,EAAK2yC,YACR3yC,EAAK2yC,WAAWlkC,KAAMxF,EAAGjJ,EAAKqlB,OAAO/gB,GAAKtE,EAAKyQ,MAAOzQ,EAAKqlB,OAAO9gB,GAAKvE,EAAK0Q,OAEzE1Q,EAAK+zC,iBACR/zC,EAAK+zC,gBAAgBtlC,KAAMxF,EAAGjJ,EAAKqlB,OAAO/gB,GAAKtE,EAAKyQ,MAAQzQ,EAAK40C,MAAO50C,EAAKqlB,OAAO9gB,GAAKvE,EAAK0Q,MAAQ1Q,EAAK60C,SAIxG70C,EAAK0yC,cACR1yC,EAAK0yC,aAAajkC,KAAMxF,EAAGjJ,EAAKqlB,OAAO/gB,GAAKtE,EAAKyQ,MAAOzQ,EAAKqlB,OAAO9gB,GAAKvE,EAAK0Q,OAE3E1Q,EAAK8zC,mBACR9zC,EAAK8zC,kBAAkBrlC,KAAMxF,EAAGjJ,EAAKqlB,OAAO/gB,GAAKtE,EAAKyQ,MAAOzQ,EAAKqlB,OAAO9gB,GAAKvE,EAAK0Q,SAOtFuhC,cAAe,SAAUoB,EAAUC,GAElC,IAAI3iD,EAAIC,EAyBR,GAvBAD,EAAK0iD,GAAYxxD,KAAKwjC,OAAOt0B,GAAKlP,KAAK4uB,OACvC7f,EAAK0iD,GAAYzxD,KAAKwjC,OAAOr0B,GAAKnP,KAAK6uB,OAEvC7uB,KAAKiP,MAAQvH,KAAK0sD,OAAOrlD,EAAID,GAC7B9O,KAAKizD,OAASvrD,KAAKqI,KAAKjB,EAAGA,EAAKC,EAAGA,GAE/B/O,KAAKizD,OAASjzD,KAAKkzD,aAED,IAAjBlzD,KAAKqzD,UACRrzD,KAAK4uB,OAASlnB,KAAK0H,IAAIpP,KAAKiP,QAAQjP,KAAKizD,OAASjzD,KAAKkzD,WAClC,OAAjBlzD,KAAKqzD,SAAoBrzD,KAAMwjC,OAAOt0B,GAAGlP,KAAK4uB,MAAS5uB,KAAKqzD,UAASrzD,KAAK4uB,MAAQ5uB,KAAKqzD,QAAUrzD,KAAKwjC,OAAOt0B,IAC5F,OAAjBlP,KAAKuzD,SAAoBvzD,KAAMwjC,OAAOt0B,GAAGlP,KAAK4uB,MAAS5uB,KAAKuzD,UAASvzD,KAAK4uB,MAAQ5uB,KAAKuzD,QAAUvzD,KAAKwjC,OAAOt0B,MAG7F,IAAjBlP,KAAKszD,UACRtzD,KAAK6uB,QAAUnnB,KAAK2H,IAAIrP,KAAKiP,QAAQjP,KAAKizD,OAASjzD,KAAKkzD,WACnC,OAAjBlzD,KAAKszD,SAAoBtzD,KAAMwjC,OAAOr0B,GAAGnP,KAAK6uB,MAAS7uB,KAAKszD,UAAStzD,KAAK6uB,MAAQ7uB,KAAKszD,QAAUtzD,KAAKwjC,OAAOr0B,IAC5F,OAAjBnP,KAAKwzD,SAAoBxzD,KAAMwjC,OAAOr0B,GAAGnP,KAAK6uB,MAAS7uB,KAAKwzD,UAASxzD,KAAK6uB,MAAQ7uB,KAAKwzD,QAAUxzD,KAAKwjC,OAAOr0B,KAGlHnP,KAAKizD,OAASjzD,KAAKkzD,WAGhBlzD,KAAKmyD,WACT,CACC,IAAIr4C,EAAM,EAAEpS,KAAKijB,GAAK3qB,KAAKmyD,WAC3BnyD,KAAKiP,MAAQxI,KAAKzG,KAAKiP,MAAQvH,KAAKijB,GAAK7Q,EAAG,GAAKA,GAAMA,EAAKpS,KAAKijB,GAGlE,GAAI3qB,KAAKoyD,YACT,CACC,IAAIt4C,EAAM9Z,KAAKkzD,UAAYlzD,KAAKoyD,YAChCpyD,KAAKizD,OAASxsD,KAAKzG,KAAKizD,OAASn5C,EAAG,GAAKA,GAAMA,EAGhD9Z,KAAKqyD,MAAQ3qD,KAAKC,IAAI,EAAGD,KAAKwzB,IAAIpsB,EAAK9O,KAAKkzD,WAAW,IACvDlzD,KAAKsyD,MAAQ5qD,KAAKC,IAAI,EAAGD,KAAKwzB,IAAInsB,EAAK/O,KAAKkzD,WAAW,IAEvDlzD,KAAK+yD,MAAQ/yD,KAAKizD,OAASvrD,KAAK0H,IAAIpP,KAAKiP,OACzCjP,KAAKgzD,MAAQhzD,KAAKizD,QAAUvrD,KAAK2H,IAAIrP,KAAKiP,OAEtCjP,KAAKizD,OAAS,GAEjBjzD,KAAKuyD,KAAOvyD,KAAK+yD,MAAQ/yD,KAAKizD,OAC9BjzD,KAAKwyD,KAAOxyD,KAAKgzD,MAAQhzD,KAAKizD,OAE9BjzD,KAAK6P,UAAY7P,KAAKizD,OAASjzD,KAAKkzD,YAIpClzD,KAAKuyD,KAAO,EACZvyD,KAAKwyD,KAAO,EAEZxyD,KAAK6P,UAAY,GAGdnI,KAAKqB,IAAI/I,KAAKqyD,OAASryD,KAAKmzD,YAC/BnzD,KAAKqyD,MAAQ,EACbryD,KAAKuyD,KAAO,GAGT7qD,KAAKqB,IAAI/I,KAAKsyD,OAAStyD,KAAKozD,YAC/BpzD,KAAKsyD,MAAQ,EACbtyD,KAAKwyD,KAAO,GAGTxyD,KAAKmxD,WACRnxD,KAAKmxD,UAAWnxD,KAAKuyD,KAAMvyD,KAAKwyD,KAAMxyD,KAAK6P,UAAW7P,KAAKiP,MAAOjP,OAMpEiwD,gBAAiB,SAAUp6B,GAE1B71B,KAAK4wD,WAAa5wD,KAAK2wD,UACvB3wD,KAAK2wD,UAAY,EAEjB3wD,KAAK4uB,MAAQ,EACb5uB,KAAK6uB,MAAQ,EAEb7uB,KAAKowD,cAAcv6B,EAAQv2B,EAAGu2B,EAAQ1nB,IAMvC6hD,kBAAmB,SAAUn6B,GAE5B71B,KAAK4wD,WAAa5wD,KAAK2wD,UACvB3wD,KAAK2wD,UAAY,EAEjB3wD,KAAK4uB,MAAQ,EACb5uB,KAAK6uB,MAAQ,EAEb7uB,KAAKyK,SAONmsC,cAAe,SAASt3C,EAAG6O,GAE1B,SAAKnO,KAAK6iD,WAAa7iD,KAAKkf,SAAW,IAGhClf,KAAK+wD,OAAOvtB,OAAOoT,cAAct3C,EAAG6O,IAO5CkmD,aAAc,SAAUvlD,EAAIC,EAAIokD,EAAU,GAAMC,EAAU,IASzD,OAPI1rD,KAAKqB,IAAI+F,GAAMqkD,IAAWrkD,EAAK,GAC/BpH,KAAKqB,IAAIgG,GAAMqkD,IAAWrkD,EAAK,GAEnC/O,KAAK4wD,WAAa5wD,KAAK2wD,UACvB3wD,KAAK2wD,UAAkB,GAAN7hD,GAAiB,GAANC,EAAU,EAAI,EAE1C/O,KAAKowD,cAAepwD,KAAKwjC,OAAOt0B,GAAKJ,EAAG9O,KAAKkzD,UAAWlzD,KAAKwjC,OAAOr0B,GAAKJ,EAAG/O,KAAKkzD,YAC1E,GASRoB,YAAa,SAAUC,GAAU,GAShC,OAPAv0D,KAAKyyD,OAAS8B,EAA2B,GAAdv0D,KAAKqyD,MAAaryD,KAAKqyD,MAAQryD,KAAKyyD,OAAUzyD,KAAKqyD,MAC9EryD,KAAK0yD,OAAS6B,EAA2B,GAAdv0D,KAAKsyD,MAAatyD,KAAKsyD,MAAQtyD,KAAK0yD,OAAU1yD,KAAKsyD,MAC9EtyD,KAAK2yD,MAAQ4B,EAA0B,GAAbv0D,KAAKuyD,KAAYvyD,KAAKuyD,KAAOvyD,KAAK2yD,MAAS3yD,KAAKuyD,KAC1EvyD,KAAK4yD,MAAQ2B,EAA0B,GAAbv0D,KAAKwyD,KAAYxyD,KAAKwyD,KAAOxyD,KAAK4yD,MAAS5yD,KAAKwyD,KAC1ExyD,KAAK6yD,WAAa0B,EAA+B,GAAlBv0D,KAAK6P,UAAiB7P,KAAK6P,UAAY7P,KAAK6yD,WAAc7yD,KAAK6P,UAC9F7P,KAAK8yD,OAASyB,EAA2B,GAAdv0D,KAAKiP,MAAajP,KAAKiP,MAAQjP,KAAK8yD,OAAU9yD,KAAKiP,MAEvEjP,MAMRuwD,QAAS,SAAU7gC,EAAS2gC,GAE3B,IAAIvhD,EAAK,EACLC,EAAK,EAUT,GARA/O,KAAK4uB,MAAQ,EACb5uB,KAAK6uB,MAAQ,GAEY,IAArBwhC,EAAQrwD,KAAK2B,MAAcoN,GAAM/O,KAAKkzD,YACf,IAAvB7C,EAAQrwD,KAAK0B,QAAgBoN,GAAM9O,KAAKkzD,YACjB,IAAvB7C,EAAQrwD,KAAK6B,QAAgBkN,EAAK/O,KAAKkzD,YACf,IAAxB7C,EAAQrwD,KAAK4B,SAAiBkN,EAAK9O,KAAKkzD,WAExCxjC,IAAY1vB,KAAK2B,IAAM+tB,IAAY1vB,KAAK0B,MAAQguB,IAAY1vB,KAAK6B,MAAQ6tB,IAAY1vB,KAAK4B,MAY7F,OAVA5B,KAAK4wD,WAAa5wD,KAAK2wD,UACvB3wD,KAAK2wD,UAAY,EAEP,GAAN7hD,GAAiB,GAANC,IAEdD,GAAM,MACNC,GAAM,OAGP/O,KAAKowD,cAAepwD,KAAKwjC,OAAOt0B,GAAKJ,EAAI9O,KAAKwjC,OAAOr0B,GAAKJ,IACnD,GAOTyhD,MAAO,SAAU9gC,EAAS2gC,GAEzB,IAAIvhD,EAAK,EACLC,EAAK,EAUT,GARA/O,KAAK4uB,MAAQ,EACb5uB,KAAK6uB,MAAQ,GAEY,IAArBwhC,EAAQrwD,KAAK2B,MAAcoN,GAAM/O,KAAKkzD,YACf,IAAvB7C,EAAQrwD,KAAK0B,QAAgBoN,GAAM9O,KAAKkzD,YACjB,IAAvB7C,EAAQrwD,KAAK6B,QAAgBkN,EAAK/O,KAAKkzD,YACf,IAAxB7C,EAAQrwD,KAAK4B,SAAiBkN,EAAK9O,KAAKkzD,WAExCxjC,IAAY1vB,KAAK2B,IAAM+tB,IAAY1vB,KAAK0B,MAAQguB,IAAY1vB,KAAK6B,MAAQ6tB,IAAY1vB,KAAK4B,MAgB7F,OAdU,GAANkN,GAAiB,GAANC,IAEdD,GAAM,MACNC,GAAM,OAGP/O,KAAKowD,cAAepwD,KAAKwjC,OAAOt0B,GAAKJ,EAAI9O,KAAKwjC,OAAOr0B,GAAKJ,GAE/C,IAAPD,GAAmB,IAAPC,IAEf/O,KAAK4wD,WAAa5wD,KAAK2wD,UACvB3wD,KAAK2wD,UAAY,IAGX,GAQTiB,SAAU,SAAUplD,GAGnB,OADAxM,KAAKmxD,UAAY3kD,EACVxM,Q;;;;;AC5jBT,MAAMw0D,GACN,CAOCC,WAAY,EACZC,UAAW,EAkBXC,UAAW,EACXC,UAAW,EACXC,UAAW,EACXC,UAAW,EACXC,UAAW,EACXC,WAAY,EACZC,UAAW,EACXC,UAAW,EACXC,UAAW,EACXC,UAAW,EACXC,UAAW,GACXC,WAAY,GAaXC,cAAe,EAChBC,cAAe,EACfC,cAAe,EACfC,eAAgB,EAChBC,cAAe,EACfC,cAAe,EACfC,cAAe,EAKfC,QAAS,GAMTC,YAAa,KAKbC,WAAY,GAMZC,eAAgB,KAMhBC,gBAAiB,KAMjBC,YAAa,KAMbC,UAAW,KAMXC,YAAa,KAMb7yB,OAAQ8V,GAAQ5vC,KAAK5B,QAMrBW,KAAM,SAAU6tD,EAAW,MAAOC,EAAY,MAAOjJ,EAAS,KAAMC,EAAS,MAEhD,IAAxBvtD,KAAK81D,QAAQ31D,SAGA,OAAbmtD,IACHA,EAAW5lD,KAAKwzB,IAAIo7B,EAAYC,GAAe,KAE5CjJ,EAAW,KACdA,EAAW,IAEK,OAAbC,GAAqBA,EAAW,KACnCA,EAAW,IAEZvtD,KAAKwjC,OAAOh1B,OAAO0R,OAAOo2C,EAAYC,GAEtCv2D,KAAKw2D,YAAYhC,GAAMC,WAAY,cACnCz0D,KAAK8rD,aAAa0I,GAAMG,UAAW,IAAItH,GAAeiJ,EAAYC,EAAajJ,EAAUC,IACzFvtD,KAAK8rD,aAAa0I,GAAMI,UAAW,IAAIvH,GAAeiJ,EAAYC,EAAajJ,EAAUC,IACzFvtD,KAAK8rD,aAAa0I,GAAMK,UAAW,IAAIxH,GAAeiJ,EAAYC,EAAajJ,EAAUC,IACzFvtD,KAAK8rD,aAAa0I,GAAMM,UAAW,IAAIzH,GAAeiJ,EAAYC,EAAajJ,EAAUC,IACzFvtD,KAAK8rD,aAAa0I,GAAMO,UAAW,IAAI1H,GAAeiJ,EAAYC,EAAajJ,EAAUC,IACzFvtD,KAAK8rD,aAAa0I,GAAMQ,WAAY,IAAI3H,GAAeiJ,EAAYC,EAAajJ,EAAUC,IAC1FvtD,KAAK8rD,aAAa0I,GAAMS,UAAW,IAAI5H,GAAeiJ,EAAYC,EAAajJ,EAAUC,IACzFvtD,KAAK8rD,aAAa0I,GAAMU,UAAW,IAAI7H,GAAeiJ,EAAYC,EAAajJ,EAAUC,IACzFvtD,KAAK8rD,aAAa0I,GAAMW,UAAW,IAAI9H,GAAeiJ,EAAYC,EAAajJ,EAAUC,IACzFvtD,KAAK8rD,aAAa0I,GAAMY,UAAW,IAAI/H,GAAeiJ,EAAYC,EAAajJ,EAAUC,IACzFvtD,KAAK8rD,aAAa0I,GAAMa,UAAW,IAAIhI,GAAeiJ,EAAYC,EAAajJ,EAAUC,IAEzFvtD,KAAK8rD,aAAa0I,GAAMc,WAAY,IAAIjI,GAAeiJ,EAAYC,EAAajJ,EAAUC,IAC1FvtD,KAAK+rD,aAAayI,GAAMc,YAAYzS,SAAQ,GAC5C7iD,KAAKy2D,eAAe,GAEpBz2D,KAAKw2D,YAAYhC,GAAME,UAAW,aAClC10D,KAAK8rD,aAAa0I,GAAMe,cAAe,IAAIpI,GAAiB7Q,GAAO/tB,YAAa+tB,GAAO9tB,eACvFxuB,KAAK8rD,aAAa0I,GAAMgB,cAAe,IAAIrI,GAAiB7Q,GAAO/tB,YAAa+tB,GAAO9tB,eACvFxuB,KAAK8rD,aAAa0I,GAAMiB,cAAe,IAAItI,GAAiB7Q,GAAO/tB,YAAa+tB,GAAO9tB,eACvFxuB,KAAK8rD,aAAa0I,GAAMkB,eAAgB,IAAIvI,GAAiB7Q,GAAO/tB,YAAa+tB,GAAO9tB,eACxFxuB,KAAK8rD,aAAa0I,GAAMmB,cAAe,IAAIxI,GAAiB7Q,GAAO/tB,YAAa+tB,GAAO9tB,eACvFxuB,KAAK8rD,aAAa0I,GAAMoB,cAAe,IAAIzI,GAAiB7Q,GAAO/tB,YAAa+tB,GAAO9tB,eACvFxuB,KAAK8rD,aAAa0I,GAAMqB,cAAe,IAAI1I,GAAiB7Q,GAAO/tB,YAAa+tB,GAAO9tB,iBAOxFgoC,YAAa,SAAU52D,EAAOsJ,EAAK,MAYlC,OAVIlJ,KAAK81D,QAAQl2D,KAEhBktB,EAAOuI,YAAYr1B,KAAK81D,QAAQl2D,IAChCmG,EAAO+E,QAAQ9K,KAAK81D,QAAQl2D,KAG7BI,KAAK81D,QAAQl2D,GAAS,IAAI4sD,GAAM5sD,EAAOsJ,GACvC4jB,EAAOsI,SAASp1B,KAAK81D,QAAQl2D,IAE7BI,KAAK02D,YAAY92D,GACVI,KAAK81D,QAAQl2D,IAOrB+2D,SAAU,SAAU/2D,EAAM,MAEzB,OAAc,OAAVA,EACII,KAAK+1D,YAETn2D,EAAQ,GAAKA,GAASI,KAAK81D,QAAQ31D,OAC/B,KAEDH,KAAK81D,QAAQl2D,IAOrB82D,YAAa,SAAU92D,GAEtB,QAAIA,EAAQ,GAAKA,GAASI,KAAK81D,QAAQ31D,SAAWH,KAAK81D,QAAQl2D,MAG/DI,KAAK+1D,YAAc/1D,KAAK81D,QAAQl2D,GAChCI,KAAKk2D,gBAAkB,MAEhB,IASRO,eAAgB,SAAU72D,GAEzB,GAAyB,OAArBI,KAAK+1D,YACR,MAAM,IAAIvvD,MAAO,uEAEdxG,KAAKg2D,WAAWp2D,KAEnBmG,EAAO+E,QAAQ9K,KAAKg2D,WAAWp2D,IAC/BI,KAAK+1D,YAAY/J,YAAYpsD,EAAO,OAGrCI,KAAKg2D,WAAWp2D,GAAS,IAAIypD,GAC5B,EAAG,EACH/M,GAAO/tB,YAAa+tB,GAAO9tB,aAC3BxuB,KAAK+1D,YAAYhzC,SAAU/iB,KAAK+1D,YAAY7K,WAG7ClrD,KAAK+1D,YAAY/J,YAAYpsD,EAAOI,KAAKg2D,WAAWp2D,IAEpDI,KAAK42D,eAAeh3D,IAOrBqsD,YAAa,SAAUrsD,EAAM,MAE5B,OAAc,OAAVA,EACII,KAAKi2D,eAETr2D,EAAQ,GAAKA,GAASI,KAAKg2D,WAAW71D,OAClC,KAEDH,KAAKg2D,WAAWp2D,IAOxBg3D,eAAgB,SAAUh3D,GAEzB,QAAIA,EAAQ,GAAKA,GAASI,KAAKg2D,WAAW71D,SAAWH,KAAKg2D,WAAWp2D,MAGrEI,KAAKi2D,eAAiBj2D,KAAKg2D,WAAWp2D,IAC/B,IAORksD,aAAc,SAAUlsD,EAAO2hD,GAE9B,GAAyB,OAArBvhD,KAAK+1D,YACR,MAAM,IAAIvvD,MAAO,qEAGlB,OADAxG,KAAK+1D,YAAYjK,aAAclsD,EAAO2hD,GAC/BA,GAORwK,aAAc,SAAUnsD,EAAM,KAAMi3D,GAAY,GAE/C,GAAc,OAAVj3D,EACJ,CACC,GAA6B,OAAzBI,KAAKk2D,iBAA4BW,EACpC,MAAM,IAAIrwD,MAAO,8EAElB,OAAOxG,KAAKk2D,gBAGb,GAAyB,OAArBl2D,KAAK+1D,YACR,MAAM,IAAIvvD,MAAO,qEAElB,IAAI+6C,EAAYvhD,KAAK+1D,YAAYhK,aAAansD,GAC9C,GAAkB,OAAd2hD,GAAsBsV,EACzB,MAAM,IAAIrwD,MAAO,gDAElB,OAAO+6C,GAORuV,gBAAiB,SAAUl3D,GAG1B,OADAI,KAAKk2D,gBAAkBl2D,KAAK+rD,aAAansD,GAAO,GAChB,OAAzBI,KAAKk2D,iBASba,UAAW,SAAU13D,EAAO23D,GAAS,GAEpCxC,GAAMmC,SAASnC,GAAMC,YAAY1I,aAAayI,GAAMc,YAAYzS,QAAQxjD,GACxE+f,EAAQyX,WAAamgC,GAOtBC,YAAa,SAASjiD,EAAG,MAExB,GAAyB,OAArBhV,KAAK+1D,YACR,MAAM,IAAIvvD,MAAO,kEAKlB,OAHAxG,KAAKm2D,YAAcrL,GAAMphD,KAAK5B,MAAMkN,GACpChV,KAAK+1D,YAAY7J,SAASlsD,KAAKm2D,aAExBn2D,KAAKm2D,aAObe,SAAU,SAAS53D,EAAE,KAAM6O,EAAE,MAQ5B,OANU,OAAN7O,GAAoB,OAAN6O,GACjBnO,KAAKm2D,YAAYtnD,UAAUvP,EAAG6O,GAE/BnO,KAAKo2D,UAAYp2D,KAAKm2D,YACtBn2D,KAAKm2D,YAAc,KAEZn2D,KAAKo2D,UAAUhT,QAevB3kC,cAAe,SAAUzJ,EAAI1V,EAAG6O,EAAGsP,EAAI,KAAM05C,EAAe,MAExC,iBAARniD,IAEVmiD,EAAiB15C,EACjBA,EAAMtP,EACNA,EAAI7O,EACJA,EAAI0V,EACJA,EAAK,MAGN,IAAIusC,EAAYvhD,KAAK+rD,aAAaoL,GAE9Bh5C,EAAO8rC,GAAQvgD,KAAK5B,MAAMxI,EAAG6O,EAAGsP,GAOpC,OANA8jC,EAAUjyC,IAAI6O,EAAK4jC,MAAM/sC,IAEA,OAArBhV,KAAKm2D,aACRn2D,KAAKm2D,YAAY5L,SAASpsC,GAE3Bne,KAAKq2D,YAAcl4C,EACZA,GASRi5C,WAAY,SAAUpiD,EAAIC,EAAM3V,EAAE,KAAM6O,EAAE,KAAMsM,EAAM,KAAMC,EAAO,KAAMy8C,EAAe,MAEvF,IAAI5V,EAAYvhD,KAAK+rD,aAAaoL,GAAkB3C,GAAMc,YAE1D,GAAU,OAANh2D,EACJ,CACC,GAAyB,OAArBU,KAAKm2D,YACR,MAAM,IAAI3vD,MAAO,0DAElBlH,EAAIU,KAAKm2D,YAAY3yB,OAAO/gB,GAC5BtU,EAAInO,KAAKm2D,YAAY3yB,OAAO9gB,GAC5BjI,EAAQza,KAAKm2D,YAAY3yB,OAAO/oB,QAChCC,EAAS1a,KAAKm2D,YAAY3yB,OAAO9oB,SAGlC,IAAI28C,EAAO5J,GAAK/jD,KAAK5B,MAAMmN,EAAM3V,EAAG6O,EAAGsM,EAAOC,GAM9C,OALA6mC,EAAUjyC,IAAI+nD,EAAKtV,MAAM/sC,IAEA,OAArBhV,KAAKm2D,aACRn2D,KAAKm2D,YAAY5L,SAAS8M,GAEpBA,GAeRC,YAAa,SAAUtiD,EAAI1V,EAAG6O,EAAGoa,EAAMzF,EAAMq0C,EAAe,MAExC,iBAARniD,IAEVmiD,EAAiBr0C,EACjBA,EAAOyF,EACPA,EAAOpa,EACPA,EAAI7O,EACJA,EAAI0V,EACJA,EAAK,MAGN,IAAIusC,EAAYvhD,KAAK+rD,aAAaoL,GAE9Bh5C,EAAOowC,GAAM7kD,KAAK5B,MAAMxI,EAAG6O,EAAGoa,EAAMzF,GAOxC,OANAy+B,EAAUjyC,IAAI6O,EAAK4jC,MAAM/sC,IAEA,OAArBhV,KAAKm2D,aACRn2D,KAAKm2D,YAAY5L,SAASpsC,GAE3Bne,KAAKq2D,YAAcl4C,EACZA,GAORo5C,cAAe,SAAUrjC,EAAO,KAAMpoB,EAAQ,MAE7C,GAAyB,OAArB9L,KAAK+1D,YACR,MAAM,IAAIvvD,MAAO,oEAElB,OAAO,IAAIimD,GAASzsD,KAAK+1D,YAAa7hC,EAAQpoB,K;AAMhD0rD,GAAehD;;;;IChefiD,GAHU;;;;;;;;IC2UVC,GA/RA,CAKCzxB,OAAQ,SAAU/nB,GAEjBmxB,GAAUpJ,OAAO/nB,IAOlBwsB,KAAM,SAAUC,EAAiB,MAEhC,OAAO,IAAIjT,SAAS,SAAUC,EAASC,GAEtCyX,GAAU3E,KAAM+sB,IACf,SAAU73D,EAAO+3D,EAAOt4D,EAAO6J,GAC1ByhC,GAAkBA,EAAiBtrC,EAAO6J,MAE/C,WACCyuB,WAUJ1jB,IAAK,SAAUe,GAEd,IAAKyiD,GAAEvjD,eAAec,GACrB,MAAM,IAAIxO,MAAM,uBAAyBwO,GAE1C,OAAOyiD,GAAEziD,IAMV4iD,oBAAqB,SAAU5iD,GAE9B,GAAIyiD,GAAEvjD,eAAec,GAAK,MAAM,IAAIxO,MAAO,wBAA0BwO,EAAK,wBAO3EgS,MAAO,SAAUhS,EAAIgS,EAAOvM,EAAOC,GAIlC,OAFA1a,KAAK43D,oBAAoB5iD,GAElByiD,GAAEziD,GAAM,CAAEC,KAAM,SAAUswB,QAAS,SAAUve,MAAOA,EAAOvM,MAAOA,EAAOC,OAAQA,IAOzFm9C,OAAQ,SAAU7iD,EAAIyF,EAAOC,EAAQo9C,EAAc55C,EAAK,MAIvD,OAFAle,KAAK43D,oBAAoB5iD,GAElByiD,GAAEziD,GAAM,CAAEC,KAAM,SAAUswB,QAAS,SAAU9qB,MAAOA,EAAOC,OAAQA,EAAQkS,KAAMkrC,KAAiB55C,IAO1GtB,MAAO,SAAU5H,EAAI+iD,EAAM75C,EAAK,MAI/B,OAFAle,KAAK43D,oBAAoB5iD,GAElByiD,GAAEziD,GAAM,CAAEC,KAAM,QAASswB,QAAS,WAAY3nB,IAAKm6C,KAAS75C,IAUpE85C,OAAQ,SAAUhjD,EAAI+iD,EAAMj4D,EAAO8jB,EAAW,KAAMC,EAAY,KAAMo0C,EAAc,KAAMC,EAAW,MAGpG,OADAl4D,KAAK43D,oBAAoB5iD,GAClByiD,GAAEziD,GAAM,CAAEC,KAAM,SAAUswB,QAAS,cAAe3nB,IAAKm6C,EAAMj4D,MAAOA,EAAO2a,MAAOmJ,EAAYlJ,OAAQmJ,EAC5GoiB,OAAQ,CACPriB,WAAYA,EAAYC,YAAaA,KAAgBo0C,MAEnDC,IAiBLt0B,YAAa,SAAU5uB,EAAI+iD,EAAMn0C,EAAYC,EAAa0M,EAAU,EAAG0nC,EAAc,KAAMC,EAAW,MAIrG,OAFAl4D,KAAK43D,oBAAoB5iD,GAElByiD,GAAEziD,GAAM,CAAEC,KAAM,QAASswB,QAAS,cAAe3nB,IAAKm6C,EAC5D9xB,OAAQ,CACPriB,WAAYA,EAAYC,YAAaA,EACrC0M,UAAiC,iBAAfA,EAA0BA,EAAY,EACxD4V,OAA8B,iBAAf5V,EAA0B,KAAOA,KAC7C0nC,MAEDC,EAEHrwB,MAAO,SAAUvoC,EAAG6O,EAAGkT,EAAGC,GAMzB,OAJKthB,KAAKimC,OAAOE,SAChBnmC,KAAKimC,OAAOE,OAAS,IAEtBnmC,KAAKimC,OAAOE,OAAOx7B,KAAK,CAACrL,EAAG6O,EAAGkT,EAAGC,IAC3BthB,QAWVm4D,UAAW,SAAUC,EAAIL,EAAMn0C,EAAYC,EAAa0M,EAAU,KAAM0nC,EAAc,KAAMC,EAAW,MAItG,OAFAl4D,KAAK43D,oBAAoBQ,GAElBX,GAAEW,GAAM,CAAEnjD,KAAM,QAASswB,QAAS,uBAAwB3nB,IAAKm6C,EACrE9xB,OAAQ,CACPriB,WAAYA,EAAYC,YAAaA,EAAa0M,UAAWA,KAAc0nC,GAG5E9wB,KAAM,CACLyB,IAAK,KAAMva,IAAK,GAAImY,IAAK,GAAK6xB,MAAO,OAGnCH,EAEH7pC,IAAK,SAAShvB,GAEb,OADAW,KAAKmnC,KAAK9Y,IAAMhvB,EACTW,MAGRwmC,IAAK,SAASxxB,EAAI2yB,EAAMp+B,EAAO8kB,EAAI,MAOlC,OALAruB,KAAKmnC,KAAKX,IAAIxxB,GAAM,CAAE2yB,KAAMA,EAAMp+B,MAAOA,GAE7B,OAAR8kB,IACHruB,KAAKmnC,KAAKX,IAAIxxB,GAAIqZ,IAAMA,GAElBruB,MAGRq4D,MAAO,SAASC,EAAQC,EAAQhvD,GAM/B,OAJM+uD,KAAUt4D,KAAKmnC,KAAKkxB,QACzBr4D,KAAKmnC,KAAKkxB,MAAMC,GAAU,IAE3Bt4D,KAAKmnC,KAAKkxB,MAAMC,GAAQC,GAAUhvD,EAC3BvJ,MAGR4oC,IAAK,SAASvpC,GAEb,OADAW,KAAKmnC,KAAKyB,IAAMvpC,EACTW,QAWVw4D,WAAY,SAAUxjD,EAAI+iD,EAAM5uB,EAAWE,EAAYO,EAAS6uB,EAAM,KAAMC,EAAM,MAIjF,OAFA14D,KAAK43D,oBAAoB5iD,GAElByiD,GAAEziD,GAAM,CAAEC,KAAM,QAASswB,QAAS,aAAc3nB,IAAKm6C,EAC3DxvC,KAAM,CACL4gB,UAAWA,EAAWE,WAAYA,EAAYO,QAASA,KAAY6uB,MAEjEC,IAULjsB,KAAM,SAAUz3B,EAAI+iD,EAAM75C,EAAK,MAI9B,OAFAle,KAAK43D,oBAAoB5iD,GAElByiD,GAAEziD,GAAM,CAAEC,KAAM,OAAQ2I,IAAKm6C,KAAS75C,IAS9CxN,KAAM,SAAUsE,EAAI+iD,EAAM75C,EAAK,MAI9B,OAFAle,KAAK43D,oBAAoB5iD,GAElByiD,GAAEziD,GAAM,CAAEC,KAAM,OAAQ2I,IAAKm6C,KAAS75C,IAS9C4E,KAAM,SAAU9N,EAAI+iD,EAAM75C,EAAK,MAI9B,OAFAle,KAAK43D,oBAAoB5iD,GAElByiD,GAAEziD,GAAM,CAAEC,KAAM,OAAQ2I,IAAKm6C,KAAS75C,IAS9Cy6C,IAAK,SAAU3jD,EAAI+iD,EAAM75C,EAAK,MAI7B,OAFAle,KAAK43D,oBAAoB5iD,GAElByiD,GAAEziD,GAAM,CAAEC,KAAM,QAASswB,QAAS,QAAS3nB,IAAKm6C,EAAMlsB,MAAO,SAAU3tB,IAW/E06C,KAAM,SAAU5jD,EAAI+iD,EAAMj4D,EAAOkzC,EAAK,cAGrC,OADAhzC,KAAK43D,oBAAoB5iD,GAClByiD,GAAEziD,GAAM,CAAEC,KAAM,SAAUswB,QAAS,aAAc3nB,IAAKm6C,EAAMj4D,MAAOA,EAAO+rC,MAAO,MAAOmH,KAAMA,IAStG6lB,MAAO,SAAU7jD,EAAI+iD,GAIpB,OAFA/3D,KAAK43D,oBAAoB5iD,GAElByiD,GAAEziD,GAAM,CAAEC,KAAM,QAASswB,QAAS,QAAS3nB,IAAKm6C,EAAMlsB,MAAO;;;;;ACjMtEitB,GA7HgBr5D,EAAMC,OACrB,CAKAq5D,OAAQ,KAMR3tC,QAAS,KAKT45B,MAAO,KAKPzD,UAAW,KAKXyX,UAAU,EAMVzvD,MAAO,KAMPxJ,OAAQ,SAASilD,EAAOmS,GAEvBn3D,KAAK+4D,OAAS,GACd/4D,KAAKorB,QAAU,GAEfprB,KAAKglD,MAAQA,EACbhlD,KAAKi5D,MAAQjU,EAAM+G,aAAaoL,GAEhCn3D,KAAKuJ,MAAQuhD,GAAMphD,KAAK5B,SAOzBoxD,SAAU,SAAUlkD,EAAI1V,EAAG6O,EAAGgrD,EAAeC,EAAelG,EAAU,GAEpD,GAAbA,IACHA,EAAYiG,EAAc1+C,MAAQ2+C,EAAc3+C,OAEjD,IAAI4+C,EAAQ,IAAIrH,GAAOhyD,KAAKi5D,MAAO35D,EAAG6O,EAAG+kD,EAAWiG,EAAeC,GAMnE,OAJAp5D,KAAK+4D,OAAO/jD,GAAMqkD,EAClBr5D,KAAKgV,GAAMqkD,EAEXr5D,KAAKuJ,MAAMghD,SAAS8O,GACbA,GAORC,UAAW,SAAUtkD,EAAI1V,EAAG6O,EAAGorD,EAAkB,KAAMC,EAAgB,MAEtE,IAAIzmC,EAAS,IAAI29B,GAAQ1wD,KAAKi5D,MAAO35D,EAAG6O,EAAGorD,EAAmBC,GAM9D,OAJAx5D,KAAKorB,QAAQpW,GAAM+d,EACnB/yB,KAAKgV,GAAM+d,EAEX/yB,KAAKuJ,MAAMghD,SAASx3B,GACbA,GAWR8vB,QAAS,SAAUxjD,EAAM,MAExB,GAAc,OAAVA,EACH,OAAOW,KAAKg5D,SAEbh5D,KAAKg5D,SAAW35D,EAEhB,IAAK,IAAIa,KAAKF,KAAK+4D,OAClB/4D,KAAK+4D,OAAO74D,GAAG2iD,QAAQxjD,GAExB,IAAK,IAAI8a,KAAKna,KAAKorB,QAClBprB,KAAKorB,QAAQjR,GAAG0oC,QAAQxjD,GAEzB,OAAOW,MAOR+2D,UAAW,SAAU13D,GAEpB,IAAK,IAAIa,KAAKF,KAAK+4D,OAClB/4D,KAAK+4D,OAAO74D,GAAG6wD,OAAOlO,QAAQxjD,GAAO,GAEtC,IAAK,IAAI06B,KAAK/5B,KAAKorB,QAClBprB,KAAKorB,QAAQ2O,GAAGg3B,OAAOlO,QAAQxjD,GAAO,GAEvC,OAAOW;;;cC7GT;MAAMy5D,GACN,CAICC,UAAW,GAMXC,cAAe,KAMfC,WAAY,KAMZC,UAAW,KAKXC,OACA,CAICC,SAAU,KAKVC,SAAU,KAKVC,SAAU,KAKVpkC,QAAS,KAKTqkC,QAAS,SAAU/7C,GAAK,GAEvB,OAAa,IAATA,EACIne,KAAKi6D,UAEbj6D,KAAKi6D,SAAW97C,EACTne,OAMRm6D,OAAQ,SAAU96D,GAEZA,GAA+C,SAAtCi9C,GAAOtvB,SAAS7O,KAAKS,MAAMk7C,OAEhCz6D,GAA+C,SAAtCi9C,GAAOtvB,SAAS7O,KAAKS,MAAMk7C,QAC5Cxd,GAAOtvB,SAAS7O,KAAKS,MAAMw7C,eAAe,UAF1C9d,GAAOtvB,SAAS7O,KAAKS,MAAMk7C,OAAS,QAQtC/jC,QAAS,SAAU12B,EAAM,MAExB,OAAc,OAAVA,EACIW,KAAK+5D,UAET/5D,KAAK+5D,WAAa16D,IAGtBW,KAAK+5D,SAAW16D,GAEF,IAAVA,GAEmB,OAAlBW,KAAKi6D,WACR3d,GAAOtvB,SAAS7O,KAAKS,MAAMk7C,OAAS,QAErC9K,GAAehf,SAAShwC,KAAK8qB,kBAI7BwxB,GAAOtvB,SAAS7O,KAAKS,MAAMw7C,eAAe,UAC1CpL,GAAe7e,WAAWnwC,KAAK8qB,kBAdxB9qB,OAwBTg1B,QAAS,SAAUxoB,GAGlB,OADAxM,KAAKg6D,SAAWxtD,EACTxM,MAMR8qB,eACA,CACCmpB,SAAU,GAEV9gB,eAAgB,SAAUhI,EAAQ0K,EAASlG,GAErC8pC,GAAMK,OAAOC,WAGlBN,GAAMK,OAAOjkC,QAAUA,EAEO,OAA1B4jC,GAAMK,OAAOG,UAChBR,GAAMK,OAAOG,SAAS5W,YAAYxtB,EAAQv2B,EAAGu2B,EAAQ1nB,GAExB,OAA1BsrD,GAAMK,OAAOE,UAChBP,GAAMK,OAAOE,SAAU7uC,EAAQ0K,OASnCA,QACA,CAICmkC,SAAU,KAKVluD,QAAS,KAKTrD,KAAM,WAEiB,OAAlBzI,KAAKg6D,WAGTh6D,KAAKg6D,SAAWtkB,GAAQhsC,KAAK5B,QAC7B9H,KAAK8L,QAAU,CAAEqf,OAAQ,KAAM0K,QAAS,KAAMlG,SAAU,MAExDq/B,GAAehf,SAAShwC,QAMzBmzB,eAAgB,SAAUhI,EAAQ0K,EAASlG,GAE1C3vB,KAAK8L,QAAQqf,OAASA,EACtBnrB,KAAK8L,QAAQ+pB,QAAUA,EACvB71B,KAAK8L,QAAQ6jB,SAAWA,EAExB3vB,KAAKg6D,SAAS5kB,KAAKp1C,KAAK8L,UAOzBwD,IAAK,SAAU9C,EAAUqoC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAKnD,OAHsB,OAAlB/0C,KAAKg6D,UACRh6D,KAAKyI,OAECzI,KAAKg6D,SAAS1qD,IAAKtP,KAAKq6D,kBAAmB7tD,EAAUqoC,EAAMC,EAAMC,IAQzE3pC,OAAQ,SAAUoB,GAEjB8tD,MAAMN,SAAS5uD,OAAQoB,IAGxB6tD,kBAAmB,SAAUvuD,EAASU,EAAUqoC,EAAMC,EAAMC,GAE3D,OAAOvoC,EAAUV,EAAQqf,OAAQrf,EAAQ+pB,QAASgf,EAAMC,EAAMC;;AAShEwlB,SACA,CAICP,SAAU,KAKVluD,QAAS,KAKTrD,KAAM,WAEiB,OAAlBzI,KAAKg6D,WAGTh6D,KAAKg6D,SAAWtkB,GAAQhsC,KAAK5B,QAC7B9H,KAAK8L,QAAU,CAAEqf,OAAQ,KAAMuE,QAAS,KAAM8qC,UAAW,MAEzDhM,GAAgBxe,SAAShwC,QAM1BiyB,gBAAiB,SAAU9G,EAAQuE,EAAS8qC,GAE3Cx6D,KAAK8L,QAAQqf,OAASA,EACtBnrB,KAAK8L,QAAQ4jB,QAAUA,EACvB1vB,KAAK8L,QAAQ0uD,UAAYA,EAEzBx6D,KAAKg6D,SAAS5kB,KAAKp1C,KAAK8L,UAOzBwD,IAAK,SAAU9C,EAAUqoC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAKnD,OAHsB,OAAlB/0C,KAAKg6D,UACRh6D,KAAKyI,OAECzI,KAAKg6D,SAAS1qD,IAAKtP,KAAKq6D,kBAAmB7tD,EAAUqoC,EAAMC,EAAMC,IAQzE3pC,OAAQ,SAAUoB,GAEjBxM,KAAKg6D,SAAS5uD,OAAQoB,IAGvB6tD,kBAAmB,SAAUvuD,EAASU,EAAUqoC,EAAMC,EAAMC,GAE3D,OAAOvoC,EAAUV,EAAQqf,OAAQrf,EAAQ4jB,QAAS5jB,EAAQ0uD,UAAW3lB,EAAMC,EAAMC;;AASnF0lB,cAAe,SAAU76D,EAAO86D,EAAW,MAU1C,OARAA,EAA4B,OAAfA,EAAsBA,EAAalD,GAAM9B,eAEtD8B,GAAMd,YAAYc,GAAM9C,WACxB8C,GAAMV,gBAAgB4D,GAEtB16D,KAAK05D,UAAU95D,GAAS,IAAIk5D,GAAStB,GAAMzB,YAAa2E,GACxD16D,KAAK26D,cAAc/6D,GAEZI,KAAK25D,eAObiB,WAAY,SAAUh7D,GAErB,OAAIA,EAAQ,GAAKA,GAASI,KAAK05D,UAAUv5D,OACjC,KAEDH,KAAK05D,UAAU95D,IAAU,MAOjC+6D,cAAe,SAAU/6D,GAGxB,OADAI,KAAK25D,cAAgB35D,KAAK46D,WAAWh7D,IAC9B,GAORi7D,aAAc,SAAUj7D,EAAOP,GAE9B,GAAc,OAAVO,EAaJI,KAAK05D,UAAU95D,GAAOyJ,MAAMhK,QAX3B,IAAK,IAAIa,EAAI,EAAGA,EAAIF,KAAK05D,UAAUv5D,OAAQD,IAErCF,KAAK05D,UAAUx5D,IAGpBF,KAAK66D,aAAa36D,EAAGb,IAaxBg6D,MAAO,SAAUrkD,EAAI1V,EAAG6O,EAAGgrD,EAAeC,EAAelG,EAAU,GAElE,GAA2B,OAAvBlzD,KAAK25D,cACR,MAAM,IAAInzD,MAAO,+EAElB,OAAOxG,KAAK65D,UAAY75D,KAAK25D,cAAcT,SAAUlkD,EAAI1V,EAAG6O,EAAGgrD,EAAeC,EAAelG,IAO9FngC,OAAQ,SAAU/d,EAAI1V,EAAG6O,EAAGorD,EAAkB,KAAMC,EAAgB,MAEnE,GAA2B,OAAvBx5D,KAAK25D,cACR,MAAM,IAAInzD,MAAO,gFAElB,OAAOxG,KAAK45D,WAAa55D,KAAK25D,cAAcL,UAAWtkD,EAAI1V,EAAG6O,EAAGorD,EAAmBC,K;AAMtFsB,GAAerB,GC5Xf,MAQMsB,GACN,CAKCC,aAAcrX,GAAYF,YAK1BwX,aAAc,GAKdC,gBAAiB,GAKjBlW,MAAO,KAKPmW,UAAW,KAMX3P,SAAU,KAMVG,SAAU,KAOVyP,SAAU,EACV5W,WAAY,EAMZ7kD,MACA,CAKC07D,QAAS/hB,GAAQ5vC,KAAK5B,QAMtBimB,MAAO,EAMPjf,GAAI,EAMJC,GAAI,EAEJy0B,OAAQ8V,GAAQ5vC,KAAK5B,QAErBxI,EAAG,IAAIqH,MAAM,IAAIC,KAAK,GACtBuH,EAAG,IAAIxH,MAAM,IAAIC,KAAK,GACtB00D,IAAK,IAAI30D,MAAM,IAAIC,KAAK,GACxB20D,IAAK,IAAI50D,MAAM,IAAIC,KAAK,GACxB40D,IAAK,IAAI70D,MAAM,IAAIC,KAAK,GACxB60D,IAAK,IAAI90D,MAAM,IAAIC,KAAK,GACxB80D,IAAK,IAAI/0D,MAAM,IAAIC,KAAK,GACxB+0D,IAAK,IAAIh1D,MAAM,IAAIC,KAAK,GAExB9G,MAAO,EACP8Q,OAAQ,EAER2H,GAAI,EAAGqjD,GAAI,EAAGC,OAAQ,EACtBjjD,GAAI,EAAGkjD,GAAI,EAAGC,OAAQ,EAEtBC,GAAI,EACJC,KAAM,EACNC,KAAM,GAUPp3C,OAAQ,SAAUq3C,EAAW,KAAMzB,EAAW,MAE7C16D,KAAKglD,MAAQwS,GAAMb,SAASwF,GAAc3E,GAAM/C,YAChDz0D,KAAKm7D,UAAYn7D,KAAKglD,MAAM+G,aAAa2O,GAAclD,GAAMlC,YAE7Dt1D,KAAKo7D,SAAWzX,GAAYjC,MAAQiC,GAAYhC,QAAUoZ,GAASC,aACnEh7D,KAAKwkD,WAAab,GAAYjC,MAAQiC,GAAYhC,QAElD3hD,KAAKglD,MAAMwG,SAASl8C,IAAItP,KAAKo8D,YAAap8D,MAC1CA,KAAKglD,MAAM2G,SAASr8C,IAAItP,KAAKs9B,WAAYt9B,MAEzCA,KAAKwrD,SAAW9V,GAAQhsC,KAAK5B,MAAM9H,MACnCA,KAAK2rD,SAAWjW,GAAQhsC,KAAK5B,MAAM9H,OAOpCmlB,QAAS,WAERnlB,KAAKglD,MAAMwG,SAASpgD,OAAOpL,KAAKk0B,OAAQl0B,MACxCA,KAAKm7D,UAAY,KAEjBn7D,KAAKwrD,SAAS9iD,OACd1I,KAAK2rD,SAASjjD,QAMf0zD,YAAa,SAASpX,EAAO9zB,GAE5BA,EAAKs6B,SAASpW,QAMf9X,WAAY,SAAS0nB,EAAO9zB,GAE3BA,EAAKy6B,SAASvW,QAOfinB,MACA,CAKC3c,IAAK,SAAUvhC,EAAM3R,EAAUsoC,EAAMC,EAAMC,GAE1C+lB,GAASvP,SAASl8C,IAAItP,KAAKs8D,KAAMn+C,EAAM3R,EAAUsoC,EAAMC,EAAMC,IAO9DunB,WAAY,SAAUp+C,EAAM9e,GAE3B07D,GAASvP,SAASl8C,IAAItP,KAAKw8D,YAAar+C,EAAM9e,IAO/Ck/C,SAAU,SAAUpnB,EAAKjuB,EAAM7J,GAE9B07D,GAASvP,SAASl8C,IAAItP,KAAKy8D,UAAWtlC,EAAKjuB,EAAM7J,IAOlD2iD,SAAU,SAAU7jC,EAAM9e,GAEzB07D,GAASvP,SAASl8C,IAAItP,KAAK08D,UAAWv+C,EAAM9e,IAO7C4iD,WAAY,SAAU9jC,EAAM9e,GAE3B07D,GAASvP,SAASl8C,IAAItP,KAAK28D,YAAax+C,EAAM9e,IAK/Ci9D,KAAM,SAAUjnB,EAAMl3B,EAAM3R,EAAUsoC,EAAMC,EAAMC,GAGjD,OADAxoC,EAAU6oC,EAAMl3B,EAAM22B,EAAMC,EAAMC,IAC3B,GAGRwnB,YAAa,SAAUnnB,EAAMl3B,EAAM9e,GAGlC,OADA8e,EAAK0kC,QAAQxjD,IACN,GAGRo9D,UAAW,SAAUpnB,EAAMle,EAAKjuB,EAAM7J,GAGrC,OADA83B,EAAIjuB,GAAQ7J,GACL,GAGRq9D,UAAW,SAAUrnB,EAAMl3B,EAAM9e,GAGhC,OADA8e,EAAK6jC,SAAS3iD,IACP,GAGRs9D,YAAa,SAAUtnB,EAAMl3B,EAAM9e,GAGlC,OADA8e,EAAK8jC,WAAW5iD,IACT;;AAaTg8D,QAAS,SAAUuB,EAAaC,EAAerwD,EAAUV,EAAQ,MAMhE,OAJM8wD,KAAe58D,KAAKi7D,eACzBj7D,KAAKi7D,aAAa2B,GAAe,IAElC58D,KAAKi7D,aAAa2B,GAAaC,GAAiB,CAAErwD,SAAUA,EAAUV,QAASA,GACxE9L,MAkBR88D,SAAU,SAAUF,EAAaC,EAAerwD,EAAS,KAAMV,EAAQ,MAMtE,OAJM8wD,KAAe58D,KAAKk7D,kBACzBl7D,KAAKk7D,gBAAgB0B,GAAe,IAErC58D,KAAKk7D,gBAAgB0B,GAAaC,GAAiB,CAAErwD,SAAUA,EAAUV,QAASA,GAC3E9L,MAOR+8D,gBAAiB,SAAUC,EAASC,GAEnCj9D,KAAKL,MAAM07D,QAAQjtD,IAAI4uD,GAAS1mB,kBAAkB2mB,GAClD,IAAI5B,EAAUr7D,KAAKL,MAAM07D,QA6BzB,OA3BAr7D,KAAKL,MAAMouB,MAAQ,EACnB/tB,KAAKL,MAAMu9D,SAAW,EAElB7B,EAAQ54C,IAAMw6C,EAAQx6C,KAEzBziB,KAAKL,MAAMouB,OAASgtC,GAASoC,QAAQz7D,KACrC1B,KAAKL,MAAMu9D,YAGR7B,EAAQ14C,IAAMs6C,EAAQt6C,KAEzB3iB,KAAKL,MAAMouB,OAASgtC,GAASoC,QAAQv7D,MACrC5B,KAAKL,MAAMu9D,YAGR7B,EAAQ34C,IAAMu6C,EAAQv6C,KAEzB1iB,KAAKL,MAAMouB,OAASgtC,GAASoC,QAAQC,IACrCp9D,KAAKL,MAAMu9D,YAGR7B,EAAQz4C,IAAMq6C,EAAQr6C,KAEzB5iB,KAAKL,MAAMouB,OAASgtC,GAASoC,QAAQE,OACrCr9D,KAAKL,MAAMu9D,YAGLl9D,KAAKL,MAAMouB,OAGnBuvC,KAAM,SAAUC,EAAQptD,EAAM9P,EAAGm9D,EAAKC,EAAKC,GAE1C,IAAIj2D,EAAIzH,KAAKL,MAAMG,MACfyxB,EAAQ,KACRljB,EAAI,EAER,GAAI8B,EAAO,EAEV,IAAK,IAAIjQ,EAAI,EAAGA,EAAIuH,EAAGvH,KAEjBs9D,EAAIt9D,KAAOu9D,EAAIv9D,IAAMG,EAAEH,GAAK,KAEnB,OAAVqxB,GAAkBlxB,EAAEH,GAAKqxB,KAC5BA,EAAQlxB,EAAEH,IAEXu9D,EAAIv9D,GAAKw9D,EAAIx9D,GAAK,EAClBmO,GAAKmvD,EAAIt9D,SAKV,IAAK,IAAIia,EAAI,EAAGA,EAAI1S,EAAG0S,KAEjBqjD,EAAIrjD,KAAOsjD,EAAItjD,IAAM9Z,EAAE8Z,GAAK,KAEnB,OAAVoX,GAAkBlxB,EAAE8Z,GAAKoX,KAC5BA,EAAQlxB,EAAE8Z,IAEXsjD,EAAItjD,GAAKujD,EAAIvjD,GAAK,EAClB9L,GAAKmvD,EAAIrjD,IAIG,OAAVoX,IACHA,EAAQ,GAELgsC,GACHv9D,KAAKL,MAAM4Y,GAAKlK,EAChBrO,KAAKL,MAAMi8D,GAAKl0D,KAAKqB,IAAIwoB,GACzBvxB,KAAKL,MAAMk8D,OAAStqC,IAEpBvxB,KAAKL,MAAMiZ,GAAKvK,EAChBrO,KAAKL,MAAMm8D,GAAKp0D,KAAKqB,IAAIwoB,GACzBvxB,KAAKL,MAAMo8D,OAASxqC,IAItBosC,cAAe,SAAUC,GAEpB59D,KAAKL,MAAMiZ,GAAK5Y,KAAKL,MAAM4Y,KAAOvY,KAAKL,MAAMiR,SAE1B,OAAlB5Q,KAAKL,MAAMq8D,IAAeh8D,KAAKL,MAAMm8D,GAAK97D,KAAKL,MAAMi8D,GAAK57D,KAAKL,MAAMq8D,MAExEh8D,KAAKL,MAAMq8D,GAAKh8D,KAAKL,MAAMm8D,GAAK97D,KAAKL,MAAMi8D,GAEtCgC,GAKJ59D,KAAKL,MAAMs8D,KAAOj8D,KAAKL,MAAMk8D,OAC7B77D,KAAKL,MAAMu8D,KAAOl8D,KAAKL,MAAMo8D,SAL7B/7D,KAAKL,MAAMs8D,KAAOj8D,KAAKL,MAAMo8D,OAC7B/7D,KAAKL,MAAMu8D,KAAOl8D,KAAKL,MAAMk8D,UAUjCgC,MAAO,WAEN,IAAIp2D,EAAIzH,KAAKL,MAAMG,MAEnB,IAAK,IAAII,EAAI,EAAGA,EAAIuH,EAAGvH,IAEtBF,KAAKL,MAAM67D,IAAIt7D,GAAKF,KAAKL,MAAM27D,IAAIp7D,GACnCF,KAAKL,MAAM87D,IAAIv7D,GAAKF,KAAKL,MAAM47D,IAAIr7D,IAIrC49D,MAAO,WAEN,IAAIr2D,EAAIzH,KAAKL,MAAMG,MAEnB,IAAK,IAAII,EAAI,EAAGA,EAAIuH,EAAGvH,IAEtBF,KAAKL,MAAM+7D,IAAIx7D,GAAKF,KAAKL,MAAM67D,IAAIt7D,GACnCF,KAAKL,MAAMg8D,IAAIz7D,GAAKF,KAAKL,MAAM87D,IAAIv7D,IAIrC69D,MAAO,WAEN,IAAIt2D,EAAIzH,KAAKL,MAAMG,MAEnB,IAAK,IAAII,EAAI,EAAGA,EAAIuH,EAAGvH,IAEtBF,KAAKL,MAAM67D,IAAIt7D,GAAKF,KAAKL,MAAM+7D,IAAIx7D,GACnCF,KAAKL,MAAM87D,IAAIv7D,GAAKF,KAAKL,MAAMg8D,IAAIz7D,IAIrC89D,YAAa,SAAUC,GAAO,GAG7B,GADAj+D,KAAKs9D,KAAMW,EAAQ,EAAGj+D,KAAKL,MAAML,EAAGU,KAAKL,MAAM27D,IAAKt7D,KAAKL,MAAM67D,IAAKx7D,KAAKL,MAAM87D,KAC3EwC,EAAQ,OAAO,EAEnBj+D,KAAK89D,QACD99D,KAAKk+D,aAAY,IAAOl+D,KAAK29D,eAAc,GAE/C39D,KAAK+9D,QACD/9D,KAAKm+D,aAAY,IAAOn+D,KAAK29D,eAAc,GAE/C39D,KAAK69D,SAGNO,YAAa,SAAUH,GAAO,GAG7B,GADAj+D,KAAKs9D,KAAMW,GAAQ,EAAIj+D,KAAKL,MAAML,EAAGU,KAAKL,MAAM27D,IAAKt7D,KAAKL,MAAM67D,IAAKx7D,KAAKL,MAAM87D,KAC5EwC,EAAQ,OAAO,EAEnBj+D,KAAK89D,QACD99D,KAAKk+D,aAAY,IAAOl+D,KAAK29D,eAAc,GAE/C39D,KAAK+9D,QACD/9D,KAAKm+D,aAAY,IAAOn+D,KAAK29D,eAAc,GAE/C39D,KAAK69D,SAGNK,YAAa,SAAUD,GAAO,GAG7B,GADAj+D,KAAKs9D,KAAMW,EAAQ,EAAGj+D,KAAKL,MAAMwO,EAAGnO,KAAKL,MAAM47D,IAAKv7D,KAAKL,MAAM87D,IAAKz7D,KAAKL,MAAM67D,KAC3EyC,EAAQ,OAAO,EAEnBj+D,KAAK89D,QACD99D,KAAKg+D,aAAY,IAAOh+D,KAAK29D,eAAc,GAE/C39D,KAAK+9D,QACD/9D,KAAKo+D,aAAY,IAAOp+D,KAAK29D,eAAc,GAE/C39D,KAAK69D,SAGNM,YAAa,SAAUF,GAAO,GAG7B,GADAj+D,KAAKs9D,KAAMW,GAAQ,EAAIj+D,KAAKL,MAAMwO,EAAGnO,KAAKL,MAAM47D,IAAKv7D,KAAKL,MAAM87D,IAAKz7D,KAAKL,MAAM67D,KAC5EyC,EAAQ,OAAO,EAEnBj+D,KAAK89D,QACD99D,KAAKg+D,aAAY,IAAOh+D,KAAK29D,eAAc,GAE/C39D,KAAK+9D,QACD/9D,KAAKo+D,aAAY,IAAOp+D,KAAK29D,eAAc,GAE/C39D,KAAK69D,SAMNQ,OAAQ,WAEFr+D,KAAKL,MAAM4J,MAAMu4C,UAGtB9hD,KAAKL,MAAM4J,MAAMsF,UAAW7O,KAAKL,MAAMmP,GAAI9O,KAAKL,MAAMoP,IACtD/O,KAAKL,MAAM4J,MAAM04C,WAAY8Y,GAASC,gBAkBvCnsD,UAAW,SAAUwoD,EAAM9tD,EAAM,KAAMuF,EAAG,EAAGC,EAAG,GAS/C,GAPsB,iBAAXxF,IAEVwF,EAAKD,EACLA,EAAKvF,EACLA,EAAQ,OAGJ8tD,EAAM,OAIX,GAFK9tD,IAAOA,EAAQ8tD,EAAK9tD,QAEpBA,EAAMu4C,UAAYuV,EAAKvV,QAC3B,OAQD,GANA9hD,KAAKL,MAAM03D,KAAOA,EAClBr3D,KAAKL,MAAM4J,MAAQA,EAEnBvJ,KAAKL,MAAMmP,GAAKktB,WAAWF,QAAQhtB,IACnC9O,KAAKL,MAAMoP,GAAKitB,WAAWF,QAAQ/sB,KAE9B/O,KAAKm7D,YAAc9D,EAAKxU,UAC5B,OAAO7iD,KAAKq+D,SAEb,IAAInD,EAAkBl7D,KAAKk7D,gBAAgB7D,EAAKpiD,MAChD,IAAKimD,IAEJA,EAAkBl7D,KAAKk7D,gBAvhBF,WAuhBkB7D,EAAKpiD,OACvCimD,GAGJ,OADAl7D,KAAKq+D,SACEr+D,KAAKs+D,KAAKjH,EAAM9tD,GAIzBvJ,KAAKL,MAAM4+D,KAAOh1D,EAAMshD,WAAW7qD,KAAKL,MAAMmP,GAAI9O,KAAKL,MAAMoP,IAC7D/O,KAAKL,MAAM6jC,OAAOp1B,IAAIipD,EAAK7zB,QAAQ30B,UAAU7O,KAAKL,MAAM4+D,KAAKj/D,EAAEU,KAAKL,MAAMmP,GAAI9O,KAAKL,MAAM4+D,KAAKpwD,EAAEnO,KAAKL,MAAMoP,IAE3GxF,EAAMy4C,SAAU+Y,GAASC,cAEzB,IAAIwD,EAAiBx+D,KAAKm7D,UAAUxW,eAAe3kD,KAAKL,MAAM6jC,OAAQxjC,KAAKo7D,SAAUp7D,KAAKwkD,YAC1F,GAA8B,IAA1Bga,EAAer+D,OAGlB,OADAq+D,EAAe91D,OACR1I,KAAKq+D,SAGb,IAAI52D,EAAI,EACJ4G,EAAI,EAER,OACA,CACC,IAAIxG,EAAO22D,EAAe/yD,QAC1B,GAAa,OAAT5D,EAAe,MAEnB,IAAI42D,EAAmBvD,EAAgBrzD,EAAKoN,MAC5C,IAAKwpD,IAEJA,EAAmBvD,EAtjBC,WAsjBerzD,EAAKoN,OACnCwpD,GAAkB,SAGxB,IAAkC,IAA9BA,EAAiBjyD,UAAqD,OAA9BiyD,EAAiBjyD,WAAmD,IAA9BiyD,EAAiBjyD,WAAsBiyD,EAAiBjyD,SAAS6qD,EAAMxvD,EAAM42D,EAAiB3yD,SAC/K,SAED,IAAI2O,EAAQ/S,KAAKC,IAAI3H,KAAKL,MAAM6jC,OAAO7gB,GAAI9a,EAAK27B,OAAO7gB,IAAMjb,KAAKwzB,IAAIl7B,KAAKL,MAAM6jC,OAAO/gB,GAAI5a,EAAK27B,OAAO/gB,IACpG/H,EAAShT,KAAKC,IAAI3H,KAAKL,MAAM6jC,OAAO5gB,GAAI/a,EAAK27B,OAAO5gB,IAAMlb,KAAKwzB,IAAIl7B,KAAKL,MAAM6jC,OAAO9gB,GAAI7a,EAAK27B,OAAO9gB,IAEzG1iB,KAAKL,MAAM27D,IAAI7zD,GAAK,EACpBzH,KAAKL,MAAM47D,IAAI9zD,GAAK,EAEhBC,KAAKC,IAAI3H,KAAKL,MAAM6jC,OAAO/oB,QAAS5S,EAAK27B,OAAO/oB,UAAYA,IAC/Dza,KAAKL,MAAML,EAAEmI,GAAKy0B,OAAOl8B,KAAKL,MAAM6jC,OAAO7gB,GAAK9a,EAAK27B,OAAO/gB,GAAIziB,KAAKL,MAAM6jC,OAAO/gB,GAAK5a,EAAK27B,OAAO7gB,IACnG3iB,KAAKL,MAAM27D,IAAI7zD,GAAK,GAGjBC,KAAKC,IAAI3H,KAAKL,MAAM6jC,OAAO9oB,SAAU7S,EAAK27B,OAAO9oB,WAAaA,IACjE1a,KAAKL,MAAMwO,EAAE1G,GAAKy0B,OAAOl8B,KAAKL,MAAM6jC,OAAO5gB,GAAK/a,EAAK27B,OAAO9gB,GAAI1iB,KAAKL,MAAM6jC,OAAO9gB,GAAK7a,EAAK27B,OAAO5gB,IACnG5iB,KAAKL,MAAM47D,IAAI9zD,GAAK,GAGrB,IAAIi3D,EAAK1+D,KAAKL,MAAM27D,IAAI7zD,GAAKzH,KAAKL,MAAM47D,IAAI9zD,GAC5C4G,GAAKqwD,EAEDA,EAAK,IACR1+D,KAAKL,MAAM27D,IAAI7zD,GAAKi3D,EACpB1+D,KAAKL,MAAM47D,IAAI9zD,GAAKi3D,GAGrB1+D,KAAKL,MAAM67D,IAAI/zD,GAAKzH,KAAKL,MAAM27D,IAAI7zD,GACnCzH,KAAKL,MAAM87D,IAAIh0D,GAAKzH,KAAKL,MAAM47D,IAAI9zD,GAEnCA,IAKD,GAFA+2D,EAAe91D,OAEN,GAAL2F,EAGH,OADArO,KAAKq+D,SACEr+D,KAAKs+D,KAAKjH,EAAM9tD,GAYxB,GATAvJ,KAAKL,MAAMiR,OAASvC,EACpBrO,KAAKL,MAAMG,MAAQ2H,EACnBzH,KAAKL,MAAMq8D,GAAK,KAEhBh8D,KAAKg+D,cACLh+D,KAAKo+D,cACLp+D,KAAKk+D,cACLl+D,KAAKm+D,cAEiB,OAAlBn+D,KAAKL,MAAMq8D,GACf,CACC,IAAIf,EAAej7D,KAAKi7D,aAAa5D,EAAKpiD,MAG1C,GAFKgmD,IAAcA,EAAej7D,KAAKi7D,aA/mBlB,WA+mB+B5D,EAAKpiD,OAErDgmD,EACJ,CAKC,IAJAj7D,KAAKL,MAAM6jC,OAAOp1B,IAAIipD,EAAK7zB,QAAQ30B,UAAU7O,KAAKL,MAAM4+D,KAAKj/D,EAAEU,KAAKL,MAAMmP,GAAmB,GAAhB9O,KAAKL,MAAMs8D,KAAUj8D,KAAKL,MAAM4+D,KAAKpwD,EAAEnO,KAAKL,MAAMoP,GAAmB,GAAhB/O,KAAKL,MAAMu8D,MAE7IsC,EAAiBx+D,KAAKm7D,UAAUxW,eAAe3kD,KAAKL,MAAM6jC,OAAQxjC,KAAKo7D,SAAUp7D,KAAKwkD,YAE/E6S,EAAKvV,SACZ,CACC,IAAIj6C,EAAO22D,EAAe/yD,QAC1B,GAAa,OAAT5D,EAAe,MAEnB,IAAKA,EAAKi6C,QACT,SAED,IAAIuZ,EAAUJ,EAAapzD,EAAKoN,OAC3BomD,IAEJA,EAAUJ,EAloBQ,WAkoBKpzD,EAAKoN,MACvBomD,KAGNA,EAAQ7uD,SAAU6qD,EAAMxvD,EAAMwzD,EAAQvvD,SAGvC0yD,EAAe91D,OAGhB1I,KAAKL,MAAMmP,IAAM9O,KAAKL,MAAMs8D,KAC5Bj8D,KAAKL,MAAMoP,IAAM/O,KAAKL,MAAMu8D,KAG7Bl8D,KAAKq+D,UAcNC,KAAM,SAAUjH,EAAM9tD,EAAM,MAI3B,GAFKA,IAAOA,EAAQ8tD,EAAK9tD,QAEpBA,IAAUA,EAAMu4C,UAAYuV,EAAKvV,QACrC,OAKD,GAHA9hD,KAAKL,MAAM03D,KAAOA,EAClBr3D,KAAKL,MAAM4J,MAAQA,GAEdvJ,KAAKm7D,YAAc9D,EAAKxU,UAC5B,OAED,IAAIoY,EAAej7D,KAAKi7D,aAAa5D,EAAKpiD,MAE1C,GADKgmD,IAAcA,EAAej7D,KAAKi7D,aA5qBjB,WA4qB8B5D,EAAKpiD,QACpDgmD,EAAc,OAEnB1xD,EAAMy4C,SAAU+Y,GAASC,cACzB,IAAIwD,EAAiBx+D,KAAKm7D,UAAUxW,eAAe0S,EAAK7zB,OAAQxjC,KAAKo7D,SAAUp7D,KAAKwkD,YAGpF,IAFAj7C,EAAM04C,WAAY8Y,GAASC,cAEpB3D,EAAKvV,SACZ,CACC,IAAIj6C,EAAO22D,EAAe/yD,QAC1B,GAAa,OAAT5D,EAAe,MAEnB,IAAKA,EAAKi6C,QACT,SAED,IAAIuZ,EAAUJ,EAAapzD,EAAKoN,OAC3BomD,IAEJA,EAAUJ,EA9rBU,WA8rBGpzD,EAAKoN,MACvBomD,KAGNA,EAAQ7uD,SAAU6qD,EAAMxvD,EAAMwzD,EAAQvvD,SAGvC0yD,EAAe91D;;;;AAajBqyD,QAAmB;;AAElBr5D,KAAM;;AAENE,MAAO;;AAEP+8D,WAAY;;AAEZvB,IAAK;;AAELC,OAAQ;;AAERuB,SAAU;iBCluBJ;MAAMC,GAAMviB,GAINwiB,GAAQtH,GAIRuH,GAAItH,GAIJuH,GAAMtH,GAINuH,GAAQnE,GAIRoE,GDotBEnE,GExuBFoE,GAAQ1/D,EACR2/D,GAASC,EACTC,GAAWC,EAMiCC,GAAUpgD,EAGlBqgD,GAAM5rD,EAGJ6rD,GAAO5qD,EAGH6qD,GAAS7yC,EAGX8yC,GAAQ3xD,EAGN4xD,GAASrgE,EAGPsgE,GAAUl/D,EAGZm/D,GAAS3iD,EAGb4iD,GAAOviC,EAGTwiC,GAAM5gD,EAGA6gD,GAAS9pD,EAGM+pD,GAAgB7lD,EAGrB8lD,GAAc59B,EAGtB69B,GAAU9lD,EAOA+lD,GAAWr0B,EAGds0B,GAAYlxB,GACpBmxB,GAAQ1tB,GAON2tB,GAAWx6D,EAGXy6D,GAAWr2D,EAGnBs2D,GAAOv0D,EAGYw0D,GAAgB/sB,GAG7BgtB,GAAUnrB,GAOborB,GAASjvD,EAGbkvD,GAAO7pB,GAGP8pB,GAAO3wD,EAGG4wD,GAAY5oB,GAGhB6oB,GAAU5nB,GAGZ6nB,GAASzoB,GAOT0oB,GAAS5mB,GAGb6mB,GAAOjgB,GAOPkgB,GAAOpmB,GAGQqmB,GAAc5d,GAG7B6d,GAAO5d,GAGL6d,GAAQjV,GAGFkV,GAAWrY,GAGbsY,GAAUlV,GAGNmV,GAAYlc,GAGCmc,GAAkB1U,GAGtB2U,GAAgBzU,GAGjC0U,GAAQjX,GAGFkX,GAAW38B,GAGb48B,GAAUhY,GAGhBiY,GAAOzU,GAGL0U,GAAQ5T,GAGa6T,GAAkB5T,GAGpB6T,GAAiBrT,GAGjBsT,GAAiB7R,GAGlC8R,GAAS7R,GAGX8R,GAAQxQ,G,IAQ3DyQ,GAAeC,U","sources":["src/system/random.js","src/system/keycode.js","src/utils/recycler.js","src/utils/linkable.js","src/utils/list.js","src/system/timer.js","src/math/vec2.js","src/math/matrix.js","src/system/glx.js","src/system/glsl.js","src/system/shader.js","src/system/shader-program.js","src/system/texture.js","src/system/canvas.js","src/system/system.js","src/system/log.js","src/system/globals.js","src/system/perf.js","src/system/framebuffer.js","src/flow/drawable.js","src/resources/drawable.js","src/resources/custom.js","src/resources/spritesheet.js","src/resources/spritesheet-animation.js","src/resources/spritefont.js","src/resources/resources.js","src/resources/sound.js","src/resources/sound-array.js","src/resources/wrappers.js","src/utils/priority-queue.js","src/utils/callback.js","src/utils/handler.js","src/math/rect.js","src/math/tfunction.js","src/math/point2.js","src/math/bounds2.js","src/anim/easing.js","src/flow/boot.js","src/fxl/system.js","src/anim/block.js","src/anim/command.js","src/anim/parallel.js","src/anim/serial.js","src/anim/repeat.js","src/anim/set.js","src/anim/restart.js","src/anim/wait.js","src/anim/range.js","src/anim/rand.js","src/anim/randt.js","src/anim/exec.js","src/anim/play.js","src/anim/anim.js","src/flow/grid-element.js","src/flow/grid.js","src/flow/container.js","src/flow/viewport.js","src/flow/element.js","src/flow/group.js","src/flow/scene.js","src/flow/updater.js","src/flow/simple-container.js","src/flow/grid-container.js","src/flow/mask.js","src/flow/label.js","src/flow/keyboard-handler.js","src/flow/pointer-handler.js","src/flow/screen-controls.js","src/flow/button.js","src/flow/stick.js","src/fxl/world.js","src/fxl/r.js","src/fxl/resources.js","src/fxl/gamepad.js","src/fxl/input.js","src/fxl/collider.js","src/fxl/fxl.js","src/main.js"],"sourcesContent":["\nimport { Class } from 'rinn';\n\nconst XOR = (value, x) => (value ^ x) & 0x7FFFFFFF;\nconst SHR = (value, x) => (value >>> x)  & 0x7FFFFFFF;\nconst SHL = (value, x) => (value << x) & 0x7FFFFFFF;\n\n/**\n * Random number generator based on the WELL algorithm family.\n */\n\n//!class Random\n\nconst Random = Class.extend\n({\n\t/**\n\t * State of the generator.\n\t */\n\tstate: null,\n\n\t/**\n\t * Index of the next state value.\n\t */\n\tindex: 0,\n\n\t/**\n\t * \tSeed value of the generator. Remains constant throughout the life of the generator.\n\t * \t!readonly seed: number;\n\t */\n\tseed: 0,\n\n\t/**\n\t * Number of times the generator has been called.\n\t */\n\tcount: 0,\n\n\t/**\n\t * \tInitializes the instance of the pseudo-random number generator.\n\t * \t@param seed - Value to seed the random number generator. If none provided, default one (0xDAE7A5D3) will be used.\n\t *\n\t *\t!constructor (seed?: number);\n\t */\n\t__ctor: function(seed=0xDAE7A5D3)\n\t{\n\t\tthis.setSeed(seed);\n\t},\n\n\t/**\n\t * \tSets the seed of the pseudo-random number generator.\n\t * \t@param value - Seed value to use (32-bit unsigned integer).\n\t *\n\t *\t!setSeed (value: number) : Random;\n\t */\n\tsetSeed: function(value)\n\t{\n\t\tthis.seed = value;\n\n\t\tthis.index = 0;\n\t\tthis.count = 0;\n\n\t\tthis.state = [\n\t\t\t0xA5F7310C, 0xEF731CF3, 0xFA784322, 0x7834FC31,\n\t\t\t0xD9AF7813, 0xDE78AD13, 0x783F3418, 0xAA123176,\n\t\t\t0x871CF4D1, 0x73412FAB, 0xBAE6C710, 0x06F73481,\n\t\t\t0x8910CF15, 0x927CF813, 0xBCF7834F, 0x73F61193\n\t\t];\n\n\t\tfor (let i = 0; i < this.state.length; i++)\n\t\t\tthis.state[i] = XOR(this.state[i], this.seed);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tGenerates a 32-bit unsigned integer.\n\t *\t!nextInt32 () : number;\n\t */\n\tnextInt32: function ()\n\t{\n\t\tlet a, b, c, d;\n\n\t\tthis.count = (this.count + 1) & 0x7FFFFFFF;\n\n\t\ta = this.state[this.index];\n\t\tc = this.state[(this.index + 13) & 15];\n\t\tb = XOR(XOR(XOR(a, c), SHL(a, 16)), SHL(c, 15));\n\t\tc = this.state[(this.index + 9) & 15];\n\t\tc = XOR(c, SHR(c, 11));\n\t\ta = this.state[this.index] = XOR(b, c);\n\t\td = XOR(a, SHL(a, 5) & 0xDA442D24);\n\n\t\tthis.index = (this.index + 15) & 15;\n\t\ta = this.state[this.index];\n\n\t\tthis.state[this.index] = XOR(XOR(XOR(XOR(XOR(a, b), d), SHL(a, 2)), SHL(b, 18)), SHL(c, 28));\n\t\treturn this.state[this.index] & 0x7FFFFFFF;\n\t},\n\n\t/**\n\t * \tGenerates a 16-bit unsigned integer.\n\t *\t!nextInt16 () : number;\n\t */\n\tnextInt16: function ()\n\t{\n\t\treturn this.nextInt32() & 0xFFFF;\n\t},\n\n\t/**\n\t * \tGenerates an 8-bit unsigned integer.\n\t * \t!nextInt8 () : number;\n\t */\n\tnextInt8: function ()\n\t{\n\t\treturn this.nextInt32() & 0xFF;\n\t},\n\n\t/**\n\t * \tGenerates a floating point number between 0 an 1 (inclusive).\n\t * \t!nextFloat () : number;\n\t */\n\tnextFloat: function ()\n\t{\n\t\treturn this.nextInt32() / 0x7FFFFFFF;\n\t}\n});\n\nexport default Random;\n","\n//:/**\n//: * \tEnumeration of key codes supported by the system.\n//: */\n\n//!enum KeyCode\n\nexport default\n{\n\tBACKSPACE: 8,\n\t//!BACKSPACE\n\tTAB: 9,\n\t//!TAB\n\tENTER: 13,\n\t//!ENTER\n\tSHIFT: 16,\n\t//!SHIFT\n\tCTRL: 17,\n\t//!CTRL\n\tESC: 27,\n\t//!ESC\n\tSPACE: 32,\n\t//!SPACE\n\n\tPGUP: 33,\n\t//!PGUP\n\tPGDN: 34,\n\t//!PGDN\n\n\tEND: 35,\n\t//!END\n\tHOME: 36,\n\t//!HOME\n\n\tINS: 45,\n\t//!INS\n\tDEL: 46,\n\t//!DEL\n\n\tLEFT: 37,\n\t//!LEFT\n\tUP: 38,\n\t//!UP\n\tRIGHT: 39,\n\t//!RIGHT\n\tDOWN: 40,\n\t//!DOWN\n\n\tNUM_PLUS: 107,\n\t//!NUM_PLUS\n\tNUM_MINUS: 109,\n\t//!NUM_MINUS\n\tNUM_ASTERISK: 106,\n\t//!NUM_ASTERISK\n\tNUM_SLASH: 111,\n\t//!NUM_SLASH\n\tNUM_DOT: 110,\n\t//!NUM_DOT\n\n\tNUM_0: 96,\n\t//!NUM_0\n\tNUM_1: 97,\n\t//!NUM_1\n\tNUM_2: 98,\n\t//!NUM_2\n\tNUM_3: 99,\n\t//!NUM_3\n\tNUM_4: 100,\n\t//!NUM_4\n\tNUM_5: 101,\n\t//!NUM_5\n\tNUM_6: 102,\n\t//!NUM_6\n\tNUM_7: 103,\n\t//!NUM_7\n\tNUM_8: 104,\n\t//!NUM_8\n\tNUM_9: 105,\n\t//!NUM_9\n\n\tD0: 48,\n\t//!D0\n\tD1: 49,\n\t//!D1\n\tD2: 50,\n\t//!D2\n\tD3: 51,\n\t//!D3\n\tD4: 52,\n\t//!D4\n\tD5: 53,\n\t//!D5\n\tD6: 54,\n\t//!D6\n\tD7: 55,\n\t//!D7\n\tD8: 56,\n\t//!D8\n\tD9: 57,\n\t//!D9\n\n\tA: 65,\n\t//!A\n\tB: 66,\n\t//!B\n\tC: 67,\n\t//!C\n\tD: 68,\n\t//!D\n\tE: 69,\n\t//!E\n\tF: 70,\n\t//!F\n\tG: 71,\n\t//!G\n\tH: 72,\n\t//!H\n\tI: 73,\n\t//!I\n\tJ: 74,\n\t//!J\n\tK: 75,\n\t//!K\n\tL: 76,\n\t//!L\n\tM: 77,\n\t//!M\n\tN: 78,\n\t//!N\n\tO: 79,\n\t//!O\n\tP: 80,\n\t//!P\n\tQ: 81,\n\t//!Q\n\tR: 82,\n\t//!R\n\tS: 83,\n\t//!S\n\tT: 84,\n\t//!T\n\tU: 85,\n\t//!U\n\tV: 86,\n\t//!V\n\tW: 87,\n\t//!W\n\tX: 88,\n\t//!X\n\tY: 89,\n\t//!Y\n\tZ: 90,\n\t//!Z\n\n\tBACKQUOTE: 192,\n\t//!BACKQUOTE\n\tMINUS: 173,\n\t//!MINUS\n\tEQUAL: 61,\n\t//!EQUAL\n\n\tLBRACKET: 219,\n\t//!LBRACKET\n\tRBRACKET: 221,\n\t//!RBRACKET\n\tBACKSLASH: 220,\n\t//!BACKSLASH\n\n\tSEMICOLON: 59,\n\t//!SEMICOLON\n\tQUOTE: 222,\n\t//!QUOTE\n\n\tCOMMA: 188,\n\t//!COMMA\n\tDOT: 190,\n\t//!DOT\n\tSLASH: 191,\n\t//!SLASH\n};\n","\nconst recyclingFacilities = { };\nlet totalPreallocated = 0;\n\nconst Recycler = { };\nglobal.Recycler = Recycler;\nexport default Recycler;\n\n//:/**\n//: * \tProvides functions to attach recycling functionality to any class for object pooling.\n//: */\n\n//!namespace Recycler\n\n/**\n * \tAttaches recycling methods (`allocate`, `alloc` and `free`) to the specified class. Class should implement method `init` to initialize the instance (and return itself)\n * \tand `__dtor` to destroy it.\n *\n * \t@param {*} maxPoolSize - Maximum number of instance to hold in the recycler.\n * \t@param {*} minPoolSize - Minimum number of instances to pre-allocate. Defaults to 0.375*`maxPoolSize` if not specified.\n * \n * \t!function attachTo (targetClass: any, maxPoolSize?: number, minPoolSize?: number) : any;\n */\n\nRecycler.attachTo = function (targetClass, maxPoolSize=8192, minPoolSize=null)\n{\n\tif (!targetClass.prototype.className)\n\t\tthrow new Error ('Unable to attach recycler methods to an unnamed class.');\n\n\tif (!('__dtor' in targetClass.prototype))\n\t\tthrow new Error ('Recycler: Class '+targetClass.prototype.className+' requires `__dtor` method.');\n\n\tif (!('init' in targetClass.prototype))\n\t\tthrow new Error ('Recycler: Class '+targetClass.prototype.className+' requires `init` method.');\n\n\tif (minPoolSize === null)\n\t\tminPoolSize = int(maxPoolSize * 0.375);\n\n\trecyclingFacilities[targetClass.prototype.className] = targetClass;\n\n\ttargetClass.recyclerPool = new Array(maxPoolSize).fill(null);\n\ttargetClass.recyclerPoolMax = maxPoolSize;\n\n\ttargetClass.prototype.objectId = 0;\n\ttargetClass.prototype.objectRefs = 0;\n\n\ttargetClass.recyclerNextObjectId = 0;\n\ttargetClass.recyclerCreated = 0;\n\ttargetClass.recyclerRecycled = 0;\n\ttargetClass.recyclerDropped = 0;\n\ttargetClass.recyclerLength = 0;\n\ttargetClass.recyclerActive = 0;\n\n\tlet preallocated = false;\n\n\t/**\n\t * \tPreallocates instances according the the minPoolSize value.\n\t */\n\ttargetClass.preallocate = function (maximum=null)\n\t{\n\t\tif (preallocated)\n\t\t\treturn;\n\n\t\tlet n = maximum === null ? minPoolSize : Math.min(maximum, minPoolSize);\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\ttargetClass.recyclerPool[targetClass.recyclerLength++] = new targetClass();\n\t\t\ttotalPreallocated++;\n\t\t}\n\n\t\tpreallocated = true;\n\t};\n\n\t/**\n\t * \tAllocates a new instance of the class. To ensure correct instance state a call to `init` must be made later.\n\t * \t@returns {object}\n\t */\n\ttargetClass.allocate = function()\n\t{\n\t\tlet item;\n\n\t\tif (this.recyclerLength === 0)\n\t\t{\n\t\t\titem = new targetClass();\n\t\t\ttargetClass.recyclerCreated++;\n\t\t}\n\t\telse\n\t\t{\n\t\t\titem = this.recyclerPool[--this.recyclerLength];\n\t\t\ttargetClass.recyclerRecycled++;\n\t\t}\n\n\t\ttargetClass.recyclerActive++;\n\n\t\titem.objectId = ++this.recyclerNextObjectId;\n\t\titem.objectRefs = 1;\n\n\t\tthis.recyclerNextObjectId &= 0x7FFFFFFF;\n\t\treturn item;\n\t};\n\n\t/**\n\t * \tAllocates an instance and initializes it. Internally runs `allocate` first and then `init` with up to 10 parameters.\n\t * \t@param {any} a0..a9 \n\t * \t@returns {object}\n\t */\n\ttargetClass.alloc = function(a0=null, a1=null, a2=null, a3=null, a4=null, a5=null, a6=null, a7=null, a8=null, a9=null)\n\t{\n\t\treturn targetClass.allocate().init(a0, a1, a2, a3, a4, a5, a6, a7, a8, a9);\n\t};\n\n\t/**\n\t * \tReleases the self object and adds it back to the pool. Duplicate call to this method will result in an error.\n\t * \t@returns {object}\n\t */\n\ttargetClass.prototype.free = function()\n\t{\n\t\tif (this.objectId < 0)\n\t\t\treturn this;\n\n\t\tif (this.objectId === 0)\n\t\t{\n\t\t\tconsole.error ('ERROR: Already released instance of ' + targetClass.prototype.className);\n\t\t\treturn this;\n\t\t}\n\n\t\tif (--this.objectRefs > 0)\n\t\t\treturn this;\n\n\t\tthis.__dtor();\n\t\tthis.objectId = 0;\n\n\t\tif (targetClass.recyclerLength >= maxPoolSize)\n\t\t\ttargetClass.recyclerDropped++;\n\t\telse\n\t\t\ttargetClass.recyclerPool[targetClass.recyclerLength++] = this;\n\n\t\ttargetClass.recyclerActive--;\n\t\treturn this;\n\t};\n\n\t/**\n\t * Sets a flag used to prevent the instance from being destroyed.\n\t * @param {boolean} value\n\t * @returns {object}\n\t */\n\ttargetClass.prototype.lockInstance = function (value)\n\t{\n\t\tthis.objectId = Math.abs(this.objectId);\n\t\tif (value) this.objectId = -this.objectId;\n\t\treturn this;\n\t};\n\n\t/**\n\t * Increases the internal reference counter by the specified value and returns the instance. If parameter is provided the default is 1.\n\t * @param {number} [count]\n\t * @returns {object}\n\t */\n\ttargetClass.prototype.instanceRef = function (count=1)\n\t{\n\t\tthis.objectRefs += count;\n\t\treturn this;\n\t};\n};\n\n/**\n * \tShows stats about all recycling facilities (or just the specified one) using `console.debug`.\n * \t@param name - Name of the class to show.\n * \t!function showStats (name?: string) : void;\n */\nRecycler.showStats = function (name=null)\n{\n\tlet list = recyclingFacilities;\n\n\tconsole.log('Total Preallocated: ' + totalPreallocated);\n\n\tif (name === true)\n\t{\n\t\tconsole.group('Recycling Facilities');\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tlet c = list[i];\n\t\t\tif (!c.recyclerCreated) continue;\n\n\t\t\tconsole.debug (i + ': '+(100*(c.recyclerCreated/c.recyclerPoolMax)).toFixed(1)+'%  =>  overhead=' + c.recyclerCreated + ', active='+c.recyclerActive+', array=' + c.recyclerPool.length + ', recycled=' + c.recyclerRecycled + ', in-recycler=' + c.recyclerLength + ', dropped=' + c.recyclerDropped + ', space=' + (c.recyclerPoolMax - c.recyclerLength));\n\t\t}\n\t\n\t\tconsole.groupEnd();\n\t\treturn;\n\t}\n\n\tif (name !== null)\n\t{\n\t\tif (typeof(name) === 'string')\n\t\t{\n\t\t\tlet c = recyclingFacilities[name];\n\t\t\tconsole.debug (name + ': '+(100*(c.recyclerCreated/c.recyclerPoolMax)).toFixed(1)+'%  =>  overhead=' + c.recyclerCreated + ', active='+c.recyclerActive+', array=' + c.recyclerPool.length + ', recycled=' + c.recyclerRecycled + ', in-recycler=' + c.recyclerLength + ', dropped=' + c.recyclerDropped + ', space=' + (c.recyclerPoolMax - c.recyclerLength));\n\t\t\treturn;\n\t\t}\n\n\t\tlist = name;\n\t}\n\n\tconsole.group('Recycling Facilities');\n\n\tfor (let i in list)\n\t{\n\t\tlet c = list[i];\n\t\tif (!c.recyclerCreated) continue;\n\n\t\tconsole.debug (i + ': '+(100*(c.recyclerCreated/c.recyclerPoolMax)).toFixed(1)+'%  =>  overhead=' + c.recyclerCreated + ', active='+c.recyclerActive+', array=' + c.recyclerPool.length + ', recycled=' + c.recyclerRecycled + ', in-recycler=' + c.recyclerLength + ', dropped=' + c.recyclerDropped + ', space=' + (c.recyclerPoolMax - c.recyclerLength));\n\t}\n\n\tconsole.groupEnd();\n};\n\n\n/**\n * \tCreate a new class extending the specified target class, this new class is a recycling facility and is placed under property `Pool` of the target class. This\n * \tmethod can be used instead of the usual `attachTo` when the target class construct/deconstruct methods need to remain untouched.\n *\n * \t@param {*} maxPoolSize - Maximum number of instance to hold in the recycler.\n * \t@param {*} minPoolSize - Minimum number of instances to pre-allocate. Defaults to 0.375*`maxPoolSize` if not specified.\n * \n *\t!function createPool (targetClass: any, maxPoolSize?: number, minPoolSize?: number) : any;\n */\nRecycler.createPool = function (targetClass, maxPoolSize=8192, minPoolSize=null)\n{\n\tconst name = targetClass.prototype.className;\n\tif (!name) throw new Error ('Unable to create pool sub-class on an unnamed class.');\n\n\tconst Pool = targetClass.extend\n\t({\n\t\tclassName: targetClass.prototype.className,\n\n\t\t__ctor: function () {\n\t\t},\n\n\t\tinit: function(a0=null, a1=null, a2=null, a3=null, a4=null, a5=null, a6=null, a7=null, a8=null, a9=null)\n\t\t{\n\t\t\tthis._super[name].__ctor(a0, a1, a2, a3, a4, a5, a6, a7, a8, a9);\n\t\t\treturn this;\n\t\t}\n\t});\n\n\tRecycler.attachTo(Pool, maxPoolSize, minPoolSize);\n\ttargetClass.Pool = Pool;\n\n\treturn targetClass;\n};\n\n\n/**\n * \tRuns the preallocation process of all registered pools. Returns the total number of instances preallocated.\n * \t@param {number|null} maxPreallocationsPerPool\n * \t!function preallocate (maxPreallocationsPerPool?: number) : number;\n */\nRecycler.preallocate = function (maxPreallocationsPerPool=null)\n{\n\ttotalPreallocated = 0;\n\n\tfor (let i in recyclingFacilities)\n\t\trecyclingFacilities[i].preallocate(maxPreallocationsPerPool);\n\n\treturn totalPreallocated;\n}\n","\nimport { Class } from 'rinn';\nimport Recycler from './recycler.js';\n\n//![import \"./recycler\"]\n\n//:/**\n//: * \tGeneric class for linkable items such as required by List. The responsibility of this class is to wrap a value into a linkable object.\n//: */\n\n//!class Linkable\n\nconst Linkable = Class.extend\n({\n\tclassName: \"Linkable\",\n\n\t/**\n\t * \tPointer to the previous item in the chain.\n\t * \t!readonly prev: Linkable;\n\t */\n\tprev: null, /* Linkable */\n\n\t/**\n\t * \tPointer to the next item in the chain.\n\t * \t!readonly next: Linkable;\n\t */\n\tnext: null, /* Linkable */\n\n\t/**\n\t * \tWrapped value.\n\t * \t!value: any;\n\t */\n\tvalue: null,\n\n\t/**\n\t * \tInitializes the linkable item and wraps the given value. Sets the `prev` and `next` pointers to null.\n\t * \t!constructor (value?: any);\n\t */\n\t__ctor: function (value)\n\t{\n\t\tthis.value = value;\n\t\tthis.clear();\n\t},\n\n\t/**\n\t * \tUnlinks the linkable item.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis.unlink();\n\t},\n\n\t/**\n\t * \tSets the previous/next connection pointers to null. Returns `this`.\n\t * \t!clear() : Linkable;\n\t */\n\tclear: function ()\n\t{\n\t\tthis.next = this.prev = null;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tLinks the item such that it will be located after the given reference.\n\t * \t!linkAfter (ref: Linkable) : Linkable;\n\t */\n\tlinkAfter: function (ref)\n\t{\n\t\tthis.prev = ref;\n\t\tthis.next = ref ? ref.next : null;\n\n\t\tif (ref)\n\t\t{\n\t\t\tif (ref.next) ref.next.prev = this;\n\t\t\tref.next = this;\n\t\t}\n\t},\n\n\t/**\n\t * \tLinks the item such that it will be located before the given reference.\n\t * \t!linkBefore (ref: Linkable) : Linkable;\n\t */\n\tlinkBefore: function (ref)\n\t{\n\t\tthis.prev = ref ? ref.prev : null;\n\t\tthis.next = ref;\n\n\t\tif (ref)\n\t\t{\n\t\t\tif (ref.prev) ref.prev.next = this;\n\t\t\tref.prev = this;\n\t\t}\n\t},\n\n\t/**\n\t * \tUnlinks the item by linking the `prev` and `next` together (when available) and returns `this`.\n\t * \t!unlink() : Linkable;\n\t */\n\tunlink: function () \n\t{\n\t\tif (this.prev) this.prev.next = this.next;\n\t\tif (this.next) this.next.prev = this.prev;\n\n\t\treturn this.clear();\n\t}\n});\n\n//!/class\n\n//!namespace Linkable\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a linkable item and wraps the given value. Sets the `prev` and `next` pointers to null.\n\t * \t!function alloc (value?: any) : Linkable;\n\t */\n\nRecycler.createPool (Linkable, 16384, 6144);\nexport default Linkable;\n","\nimport { Rinn, Class } from 'rinn';\nimport Linkable from './linkable.js';\nimport Recycler from './recycler.js';\n\n//![import \"./linkable\"]\n//![import \"./recycler\"]\n\n//:/**\n//: * \tImplementation of a generic linked list.\n//: */\n\n//!class List\n\nconst List = Class.extend\n({\n\t/**\n\t * \tName of the class (for inheritance purposes).\n\t */\n\tclassName: \"List\",\n\n\t/**\n\t * \tPointer to the first node in the list.\n\t * \t!top: Linkable;\n\t */\n\ttop: null,\n\n\t/**\n\t * \tPointer to the last node in the list.\n\t * \t!bottom: Linkable;\n\t */\n\tbottom: null,\n\n\t/**\n\t * \tNumber of values in the list.\n\t * \t!length: number;\n\t */\n\tlength: 0,\n\n\t/**\n\t * \tInitializes the instance to an empty list.\n\t * \t!constructor();\n\t */\n\t__ctor: function ()\n\t{\n\t\tthis.top = null;\n\t\tthis.bottom = null;\n\t\tthis.length = 0;\n\t},\n\n\t/**\n\t * \tTraverses the list and destroys all nodes. The actual values are maintained. To destroy the\n\t * \tlist contents call clear() instead.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis.reset();\n\t},\n\n\t/**\n\t * \tClones all contents and returns a new list.\n\t * \t!clone() : List;\n\t */\n\tclone: function()\n\t{\n\t\tlet list = List.Pool.alloc();\n\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tlist.push(Rinn.clone(i.value));\n\n\t\treturn list;\n\t},\n\n\t/**\n\t * \tTraverses the list and destroys all nodes and values.\n\t * \t!clear() : List;\n\t */\n\tclear: function ()\n\t{\n\t\tlet i, ni;\n\n\t\tfor (i = this.top; i; i = ni)\n\t\t{\n\t\t\tni = i.next;\n\t\t\tdispose(i.free().value);\n\t\t}\n\n\t\tthis.top = this.bottom = null;\n\t\tthis.length = 0;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tTraverses the list, destroys all nodes **but** values are preserved.\n\t * \t!reset() : List;\n\t */\n\treset: function ()\n\t{\n\t\tlet i, ni;\n\n\t\tfor (i = this.top; i != null; i = ni)\n\t\t{\n\t\t\tni = i.next;\n\t\t\ti.free();\n\t\t}\n\n\t\tthis.top = this.bottom = null;\n\t\tthis.length = 0;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the first value in the list.\n\t * \t!first() : any;\n\t */\n\tfirst: function ()\n\t{\n\t\treturn this.top !== null ? this.top.value : null;\n\n\t},\n\t/**\n\t * \tReturns the last value in the list.\n\t * \t!last() : any;\n\t */\n\tlast: function ()\n\t{\n\t\treturn this.bottom !== null ? this.bottom.value : null;\n\t},\n\n\t/**\n\t * \tReturns a value given its index.\n\t * \t!getAt (index: number) : any;\n\t */\n\tgetAt: function (index)\n\t{\n\t\tlet i = null;\n\t\tfor (i = this.top; i && index-- > 0; i = i.next);\n\t\treturn i != null ? i.value : null;\n\t},\n\n\t/**\n\t * \tReturns the node at the given index.\n\t * \t!getNodeAt (index: number) : Linkable;\n\t */\n\tgetNodeAt: function (index)\n\t{\n\t\tlet i = null;\n\t\tfor (i = this.top; i && index--; i = i.next);\n\t\treturn i;\n\t},\n\n\t/**\n\t * \tReturns the node of a value given another value to compare, uses identical comparison (===) to match the value.\n\t * \t!sgetNode (value: any) : Linkable;\n\t */\n\tsgetNode: function (value)\n\t{\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tif (i.value === value) return i;\n\n\t\treturn null;\n\t},\n\n\t/**\n\t * \tRemoves the given value from the list and returns it.\n\t * \t!remove<T> (value: T) : T;\n\t */\n\tremove: function (i)\n\t{\n\t\tif (i != null && !Linkable.isInstance(i))\n\t\t\ti = this.sgetNode(i);\n\n\t\tif (!i) return null;\n\n\t\tif (!i.prev) this.top = i.next;\n\t\tif (!i.next) this.bottom = i.prev;\n\n\t\tthis.length--;\n\t\treturn i.free().value;\n\t},\n\n\t/**\n\t * \tAdds a value before the given reference node.\n\t * \t!insertBefore<T> (ref: Linkable, value: T) : T;\n\t */\n\tinsertBefore: function (ref, value)\n\t{\n\t\tif (!ref) return this;\n\n\t\tlet i = Linkable.Pool.alloc(value);\n\t\ti.linkBefore (ref);\n\n\t\tif (ref == this.top) this.top = i;\n\t\tthis.length++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * \tAdds a value after the given reference node.\n\t * \t!insertAfter<T> (ref: Linkable, value: T) : T;\n\t */\n\tinsertAfter: function (ref, value)\n\t{\n\t\tif (!ref) return this;\n\n\t\tlet i = Linkable.Pool.alloc(value);\n\t\ti.linkAfter (ref);\n\n\t\tif (ref == this.bottom) this.bottom = i;\n\t\tthis.length++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * \tAdds a value to the top of the list.\n\t * \t!unshift<T> (value: T) : T;\n\t */\n\tunshift: function (value)\n\t{\n\t\tlet i = Linkable.Pool.alloc(value);\n\n\t\ti.linkBefore (this.top);\n\t\tif (!this.bottom) this.bottom = i;\n\n\t\tthis.top = i;\n\t\tthis.length++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * \tRemoves a value from the top of the list.\n\t * \t!shift() : any;\n\t */\n\tshift: function ()\n\t{\n\t\tlet i = this.top;\n\t\tif (!i) return null;\n\n\t\tif (!(this.top = i.next)) this.bottom = null;\n\t\tthis.length--;\n\n\t\treturn i.free().value;\n\t},\n\n\t/**\n\t * \tAdds a value to the bottom of the list.\n\t * \t!push<T> (value: T) : T;\n\t */\n\tpush: function (value)\n\t{\n\t\tlet i = Linkable.Pool.alloc(value);\n\n\t\ti.linkAfter (this.bottom);\n\t\tif (!this.top) this.top = i;\n\n\t\tthis.bottom = i;\n\t\tthis.length++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * \tRemoves a value from the bottom of the list.\n\t * \t!pop() : any;\n\t */\n\tpop: function ()\n\t{\n\t\tlet i = this.bottom;\n\t\tif (!i) return null;\n\n\t\tif (!(this.bottom = i.prev)) this.top = null;\n\t\tthis.length--;\n\n\t\treturn i.free().value;\n\t},\n\n\t/**\n\t * \tAppends all contents of the given list to the current one.\n\t * \t!append (list: List) : List;\n\t */\n\tappend: function (list)\n\t{\n\t\tfor (let i = list.top; i; i = i.next)\n\t\t\tthis.push(i.value);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tTraverses the list calling the specified function for each value.\n\t * \t@param fn - Callback to execute, return `false` to stop the loop immediately.\n\t * \t!forEach(fn: (value: any, node: Linkable, list: List, context: object) => boolean, context?: object) : boolean;\n\t */\n\tforEach: function (fn, context=null)\n\t{\n\t\tlet ni;\n\t\n\t\tfor (let i = this.top; i; i = ni)\n\t\t{\n\t\t\tni = i.next;\n\t\t\tif (fn (i.value, i, this, context) === false) return false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tTraverses the list in reverse order, calling the specified function for each value.\n\t * \t@param fn - Callback to execute, return `false` to stop the loop immediately.\n\t * \t!forEachRev(fn: (value: any, node: Linkable, list: List, context: object) => boolean, context?: object) : boolean;\n\t */\n\tforEachRev: function (fn, context=null)\n\t{\n\t\tlet ni;\n\t\n\t\tfor (let i = this.bottom; i; i = ni)\n\t\t{\n\t\t\tni = i.prev;\n\t\t\tif (fn (i.value, i, this, context) === false) return false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tReturns the first value where the specified function returns `true`.\n\t * \t!find (fn: (value: any, context: object) => boolean, context?: object) : any;\n\t */\n\tfind: function (fn, context=null)\n\t{\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tif (fn(i.value, context)) return i.value;\n\n\t\treturn null;\n\t},\n\n\t/**\n\t * \tReturns an array with all values where the specified function returns `true`.\n\t * \t!filter (fn: (value: any, context: object) => boolean, context?: object) : Array<any>;\n\t */\n\tfilter: function (fn, context=null)\n\t{\n\t\tlet list = List.Pool.alloc();\n\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tif (fn(i.value, context)) list.push(i.value);\n\n\t\treturn list;\n\t},\n\n\t/**\n\t * \tReturns an array with all the values in the list.\n\t * \t!toArray() : Array<any>;\n\t */\n\ttoArray: function()\n\t{\n\t\tlet array = [];\n\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tarray.push(i.value);\n\n\t\treturn array;\n\t}\n});\n\n//!/class\n\n//!namespace List\n//!namespace Pool\n\n\t/**\n\t * \tAllocates an empty list.\n\t * \t!function alloc() : List;\n\t */\n\nRecycler.createPool (List, 16384, 6144);\nexport default List;\n","\n//!class Timer\n\n/**\n * \t@param vsync - Indicates if requestAnimationFrame should be used instead of setTimeout.\n * \t@param interval - Amount of milliseconds between timer activations.\n * \t@param callback - Function to execute on each timer activation.\n *\n * \t!constructor (vsync: boolean, interval: number, callback: (dt: number, timer: Timer) => void );\n */\nconst Timer = function (vsync, interval, callback)\n{\n\tthis.callback = callback;\n\tthis.interval = interval;\n\tthis.vsync = vsync;\n\tthis.handle = null;\n\n\tthis.isRunning = false;\n\tthis.startTime = 0;\n\tthis.rTime = 0;\n\tthis.sTime = 0;\n\tthis.lTime = 0;\n\tthis.tDelta = 0;\n\n\tthis._onTimeout = () => {\n\t\tthis.onTimeout();\n\t};\n\n\tthis._onTimeout_b = () => {\n\t\tthis.runNow();\n\t};\n};\n\n/**\n * \tTimer onTimeout handler.\n */\nTimer.prototype.onTimeout = function ()\n{\n\tif (!this.isRunning) return;\n\n\tthis.rTime = hrnow() - this.startTime;\n\n\tlet tError = this.rTime - (this.sTime + this.interval);\n\tif (tError < 0)\n\t{\n\t\tthis.runAfter(-tError);\n\t\treturn;\n\t}\n\n\tthis.sTime += this.interval * (1 + int(tError / this.interval));\n\n\tthis.tDelta = tError < 0 ? this.interval : (this.rTime - this.lTime);\n\tthis.lTime = this.rTime;\n\n\tthis.runAfter((this.sTime + this.interval) - (hrnow() - this.startTime));\n\tthis.callback(this.tDelta, this);\n};\n\n/**\n * \tStarts the timer and triggers `onStarted`.\n *\n * \t@param immediate - When `true` the callback will be executed immediately.\n * \t@param scale - Used to control when to trigger the first timeout, delay is timeInterval*scale.\n *\n * \t!start (immediate?: boolean, scale?: number) : void;\n */\nTimer.prototype.start = function (immediate=false, scale=1.0)\n{\n\tif (this.isRunning) return;\n\n\tthis.startTime = hrnow();\n\tthis.isRunning = true;\n\n\tthis.sTime = 0;\n\tthis.lTime = 0;\n\n\tthis.onStarted();\n\n\tif (immediate)\n\t\tthis.callback (0, this);\n\n\tthis.runAfter(this.interval*scale);\n};\n\n/**\n * \tExecutes the timer activation after the specified amount of milliseconds.\n *\n * \t!runAfter (timeout: number) : void;\n */\nTimer.prototype.runAfter = function (timeout)\n{\n\tif (process.browser && this.vsync)\n\t{\n\t\trequestAnimationFrame(this._onTimeout_b);\n\t\treturn;\n\t}\n\n\tif (this.handle)\n\t\tclearTimeout(this.handle);\n\n\tthis.handle = setTimeout(this._onTimeout, timeout);\n};\n\n/**\n * \tExecutes the timer activaton as soon as possible.\n *\n * \t!runNow() : void;\n */\nTimer.prototype.runNow = function ()\n{\n\tif (this.handle)\n\t\tclearTimeout(this.handle);\n\n\tthis.handle = setTimeout(this._onTimeout, 0);\n};\n\n/**\n * \tStops the timer and triggers `onStopped`.\n *\n * \t!stop() : void;\n */\nTimer.prototype.stop = function ()\n{\n\tif (!this.isRunning) return;\n\n\tif (this.handle)\n\t{\n\t\tclearTimeout(this.handle);\n\t\tthis.handle = null;\n\t}\n\n\tthis.isRunning = false;\n\tthis.onStopped();\n};\n\n/**\n * \tTimer started event handler.\n *\n * \t!onStarted() : void;\n */\nTimer.prototype.onStarted = function ()\n{\n};\n\n/**\n * \tTimer stopped event handler.\n *\n * \t!onStopped() : void;\n */\nTimer.prototype.onStopped = function ()\n{\n};\n\nexport default Timer;\n","\nimport { Class } from 'rinn';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"../utils/recycler\"]\n\n//:/**\n//: * \tRepresentation of a vector in 2D space, that is, a float tuple with components x and y.\n//: */\n\n//!class Vec2\n\nconst Vec2 = Class.extend\n({\n\tclassName: 'Vec2',\n\n\t/**\n\t * \tCoordinates of the vector.\n\t * \t!x: number;\n\t * \t!y: number;\n\t */\n\tx: 0, y: 0,\n\n\t/**\n\t *\tConstructs the vector from another Vec2.\n\t * \t!constructor (value: Vec2);\n\t */\n\t/**\n\t *\tConstructs the vector with the specified coordinates.\n\t * \t!constructor (x?: number, y?: number);\n\t */\n\t__ctor: function (x=null, y=null)\n\t{\n\t\treturn this.set(x, y);\n\t},\n\n\t/**\n\t * \tClones the vector coordinates into a new Vec2 object.\n\t * \t!clone() : Vec2;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Vec2.Pool.alloc(this);\n\t},\n\n\t/**\n\t *\tSets the coordinates of the vector from a Vec2 object.\n\t *\t!set (value: Vec2) : Vec2;\n\t */\n\t/**\n\t *\tSets the coordinates of the vector.\n\t *\t!set (x: number, y: number) : Vec2;\n\t */\n\tset: function (x, y=null)\n\t{\n\t\tif (x === null) {\n\t\t\tx = 0;\n\t\t\ty = 0;\n\t\t}\n\t\telse if (y === null) {\n\t\t\tlet v = x;\n\t\t\tx = v.x;\n\t\t\ty = v.y;\n\t\t}\n\n\t\tthis.x = x;\n\t\tthis.y = y;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the X-coordinate of the vector.\n\t * \t!setX (x: number) : Vec2;\n\t */\n\tsetX: function (x)\n\t{\n\t\tthis.x = x;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the Y-coordinate of the vector.\n\t * \t!setY (y: number) : Vec2;\n\t */\n\tsetY: function (y)\n\t{\n\t\tthis.y = y;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the coordinates of the vector to zero.\n\t * \t!zero() : Vec2;\n\t */\n\tzero: function()\n\t{\n\t\treturn this.set(0, 0);\n\t},\n\n\t/**\n\t * \tReturns true if the vector coordinates are both zero.\n\t * \t!isZero() : boolean;\n\t */\n\tisZero: function()\n\t{\n\t\treturn this.x == 0 && this.y == 0;\n\t},\n\n\t/**\n\t *\tReturns true if the coordinates of the vector have the same values as the given Vec2.\n\t *\t!equals (value: Vec2) : boolean;\n\t */\n\t/**\n\t *\tReturns true if the coordinates of the vector have the same values as the given ones.\n\t *\t!equals (x: number, y: number) : boolean;\n\t */\n\tequals: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tlet v = x;\n\t\t\tx = v.x;\n\t\t\ty = v.y;\n\t\t}\n\n\t\treturn this.x == x && this.y == y;\n\t},\n\n\t/**\n\t * \tNegates the vector, that is changing the sign of each component in the vector.\n\t * \t!neg() : Vec2;\n\t */\n\tneg: function ()\n\t{\n\t\tthis.x = -this.x; this.y = -this.y;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tInverts the vector by changing each component to its reciprocal.\n\t * \t!inv() : Vec2;\n\t */\n\tinv: function ()\n\t{\n\t\tthis.x = 1 / this.x; this.y = 1 / this.y;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tChanges the components of the vector to their absolute value.\n\t * \t!abs() : Vec2;\n\t */\n\tabs: function ()\n\t{\n\t\tthis.x = this.x < 0 ? -this.x : this.x;\n\t\tthis.y = this.y < 0 ? -this.y : this.y;\n\t\treturn this;\n\t},\n\n\t/**\n\t *\tAdds the coordinates of the given Vec2 to the vector.\n\t *\t!translate (value: Vec2) : Vec2;\n\t */\n\t/**\n\t *\tAdds the given delta values to the vector.\n\t *\t!translate (dx: number, dy: number) : Vec2;\n\t */\n\ttranslate: function (dx, dy=null)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tlet v = dx;\n\t\t\tdx = v.x;\n\t\t\tdy = v.y;\n\t\t}\n\n\t\tthis.x += dx, this.y += dy;\n\t\treturn this;\n\t},\n\n\t/**\n\t *\tRotates the vector by the specified angle.\n\t *\t!rotate (angle: number) : Vec2;\n\t */\n\t/**\n\t *\tRotates the vector by the specified angle using the given origin point.\n\t *\t!rotate (angle: number, cx: number, cy: number) : Vec2;\n\t */\n\trotate: function (angle, cx=0, cy=0)\n\t{\n\t\tlet x = (this.x - cx)*Math.cos(angle) + (this.y - cy)*Math.sin(angle);\n\t\tlet y = (this.y - cy)*Math.cos(angle) - (this.x - cx)*Math.sin(angle);\n\n\t\tthis.x = x + cx;\n\t\tthis.y = y + cy;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t *\tAdds the coordinates of the given Vec2 to the vector.\n\t *\t!add (value: Vec2) : Vec2;\n\t */\n\t/**\n\t *\tAdds the given delta values to the vector.\n\t *\t!add (dx: number, dy: number) : Vec2;\n\t */\n\tadd: function (dx, dy=null)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tlet v = dx;\n\t\t\tdx = v.x;\n\t\t\tdy = v.y;\n\t\t}\n\n\t\tthis.x += dx, this.y += dy;\n\t\treturn this;\n\t},\n\n\t/**\n\t *\tSubtracts the coordinates of the given Vec2 from the vector.\n\t *\t!sub (value: Vec2) : Vec2;\n\t */\n\t/**\n\t *\tSubtracts the given delta values from the vector.\n\t *\t!sub (dx: number, dy: number) : Vec2;\n\t */\n\tsub: function (dx, dy=null)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tlet v = dx;\n\t\t\tdx = v.x;\n\t\t\tdy = v.y;\n\t\t}\n\n\t\tthis.x -= dx, this.y -= dy;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tScales each components of the vector by the respective component of the given one.\n\t * \t!scale (k: number) : Vec2;\n\t */\n\t/**\n\t * \tScales both components of the vector by the given factor.\n\t * \t!scale (k: number) : Vec2;\n\t */\n\t/**\n\t * \tScales each components of the vector by the given factors.\n\t * \t!scale (fx: number, fy: number) : Vec2;\n\t */\n\tscale: function (fx, fy=null)\n\t{\n\t\tif (fy === null)\n\t\t{\n\t\t\tif (Vec2.isInstance(fx)) {\n\t\t\t\tlet v = fx;\n\t\t\t\tfx = v.x;\n\t\t\t\tfy = v.y;\n\t\t\t} else {\n\t\t\t\tfy = fx;\n\t\t\t}\n\t\t}\n\n\t\tthis.x *= fx, this.y *= fy;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the components to their integer parts.\n\t * \t!floor() : Vec2;\n\t */\n\tfloor: function ()\n\t{\n\t\tthis.x = int(this.x);\n\t\tthis.y = int(this.y);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the components to their fractional parts.\n\t * \t!fract() : Vec2;\n\t */\n\tfract: function ()\n\t{\n\t\tthis.x = this.x - int(this.x);\n\t\tthis.y = this.y - int(this.y);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the dot product of the vectors.\n\t * \t!dot (value: Vec2) : number;\n\t */\n\t/**\n\t * \tReturns the dot product of the vector and the given values.\n\t * \t!dot (x: number, y: number) : number;\n\t */\n\tdot: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tlet v = x;\n\t\t\tx = v.x;\n\t\t\ty = v.y;\n\t\t}\n\n\t\treturn this.x*x + this.y*y;\n\t},\n\n\t/**\n\t * \tReturns the magnitude of the vector.\n\t * \t!magnitude(squared: boolean) : number;\n\t */\n\tmagnitude: function (squared=false)\n\t{\n\t\treturn squared ? (this.x*this.x + this.y*this.y) : Math.sqrt(this.x*this.x + this.y*this.y);\n\t},\n\n\t/**\n\t * \tNormalizes the vector by dividing each component by the vector magnitude to obtain a unit vector.\n\t * \t!normalize() : Vec2;\n\t */\n\tnormalize: function ()\n\t{\n\t\treturn this.isZero() ? this : this.scale (1 / this.magnitude());\n\t},\n\n\t/**\n\t * \tSets the vector to its major-axis, that is the component with the maximum absolute value.\n\t * \t!majorAxis() : Vec2;\n\t */\n\tmajorAxis: function ()\n\t{\n\t\tif (Math.abs(this.x) > Math.abs(this.y)) this.y = 0; else this.x = 0;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the vector to its minor-axis, that is the component with the minimum absolute value.\n\t * \t!minorAxis() : Vec2;\n\t */\n\tminorAxis: function ()\n\t{\n\t\tif (Math.abs(this.x) < Math.abs(this.y)) this.y = 0; else this.x = 0;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the vector to its sign-vector representation.\n\t * \t!sign() : Vec2;\n\t */\n\tsign: function ()\n\t{\n\t\tthis.x = !this.x ? 0 : (this.x < 0 ? -1 : 1);\n\t\tthis.y = !this.y ? 0 : (this.y < 0 ? -1 : 1);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the string representation of the coordinates of the vector.\n\t * \ttoString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn `(${this.x}, ${this.y})`;\n\t}\n});\n\n//!/class\n\n//!namespace Vec2\n//!namespace Pool\n\n/**\n *\tAllocates a vector from another Vec2.\n * \t!function alloc (value: Vec2) : Vec2;\n */\n/**\n *\tAllocates a vector with the specified coordinates.\n * \t!function alloc (x?: number, y?: number) : Vec2;\n */\n\nRecycler.createPool (Vec2, 4096, 2048);\nexport default Vec2;\n","\nimport { Class } from 'rinn';\nimport Recycler from '../utils/recycler.js';\nimport Vec2 from './vec2.js';\n\n//![import \"../utils/recycler\"]\n//![import \"./vec2\"]\n\nconst temp = new Float32Array(9).fill(0);\nconst temp2 = new Float32Array(9).fill(0);\n\n//:/**\n//: * \tRepresents a 3x3 matrix. Provides an interface to manipulate 3x3 matrices.\n//: */\n\n//!class Matrix\n\nconst Matrix = Class.extend\n({\n\tclassName: 'Matrix',\n\n\t/**\n\t * \tActual elements of the matrix.\n\t * \t!data: Float32Array\n\t */\n\tdata: null,\n\n\t/**\n\t * \tConstructs a new matrix copying the elements from the specified matrix.\n\t * \t!constructor(value: Matrix);\n\t */\n\t/**\n\t * \tConstructs a new matrix with the values from the specified array.\n\t * \t!constructor(value: Float32Array);\n\t */\n\t/**\n\t * \tConstructs a new matrix with the identity matrix values.\n\t * \t!constructor();\n\t */\n\t__ctor: function(value=null)\n\t{\n\t\tif (this.data === null)\n\t\t\tthis.data = new Float32Array(9);\n\n\t\tif (value !== null)\n\t\t\tthis.set(value);\n\t\telse\n\t\t\tthis.identity();\n\t},\n\n\t/**\n\t * \tFills the matrix with zeroes.\n\t * \t!zero() : Matrix;\n\t */\n\tzero: function()\n\t{\n\t\tthis.data.fill(0);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tFills the matrix with the specified value.\n\t * \t!fill (value: number) : Matrix;\n\t */\n\tfill: function (value)\n\t{\n\t\tthis.data.fill(value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCopies the specified matrix elements into the current one.\n\t * \t!set (value: Matrix) : Matrix;\n\t */\n\t/**\n\t * \tSets the matrix elements from the specified array.\n\t * \t!set (value: Float32Array) : Matrix;\n\t */\n\tset: function (value)\n\t{\n\t\tif (Matrix.isInstance(value))\n\t\t{\n\t\t\t//for (let i = 0; i < 9; i++) this.data[i] = value.data[i];\n\t\t\tthis.data.set(value.data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t//for (let i = 0; i < 9; i++) this.data[i] = value[i];\n\t\t\tthis.data.set(value);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the elements of the matrix to be the identity matrix.\n\t * \t!identity() : Matrix;\n\t */\n\tidentity: function (target=null)\n\t{\n\t\tif (target === null)\n\t\t\ttarget = this.data;\n\n\t\ttarget.fill(0);\n\t\ttarget[0] = target[4] = target[8] = 1;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMultiplies all elements in the matrix by a given scalar.\n\t * \t!scalef (scalar: number) : Matrix;\n\t */\n\tscalef: function (scalar)\n\t{\n\t\tfor (let i = 0; i < 9; i++) this.data[i] *= scalar;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns a clone of the matrix.\n\t * \t!clone() : Matrix;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Matrix.Pool.alloc(this);\n\t},\n\n\t/**\n\t * \tAppends the given matrix to the current one using matrix multiplication (self * matrix).\n\t * \t!append (matrix: Matrix) : Matrix;\n\t */\n\tappend: function (matr)\n\t{\n\t\tif (matr instanceof Matrix)\n\t\t\tmatr = matr.data;\n\n\t\t//for (let i = 0; i < 9; i++) temp[i] = this.data[i];\n\t\ttemp.set(this.data);\n\n\t\tthis.data[0] = matr[0]*temp[0] + matr[1]*temp[3] + matr[2]*temp[6];\n\t\tthis.data[1] = matr[0]*temp[1] + matr[1]*temp[4] + matr[2]*temp[7];\n\t\tthis.data[2] = matr[0]*temp[2] + matr[1]*temp[5] + matr[2]*temp[8];\n\t\tthis.data[3] = matr[3]*temp[0] + matr[4]*temp[3] + matr[5]*temp[6];\n\t\tthis.data[4] = matr[3]*temp[1] + matr[4]*temp[4] + matr[5]*temp[7];\n\t\tthis.data[5] = matr[3]*temp[2] + matr[4]*temp[5] + matr[5]*temp[8];\n\t\tthis.data[6] = matr[6]*temp[0] + matr[7]*temp[3] + matr[8]*temp[6];\n\t\tthis.data[7] = matr[6]*temp[1] + matr[7]*temp[4] + matr[8]*temp[7];\n\t\tthis.data[8] = matr[6]*temp[2] + matr[7]*temp[5] + matr[8]*temp[8];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCreates a translation matrix and appends it.\n\t * \t!translate (x: number, y: number) : Matrix;\n\t */\n\ttranslate: function (x, y)\n\t{\n\t\tif (x == 0 && y == 0)\n\t\t\treturn this;\n\n\t\t//for (let i = 0; i < 9; i++) temp[i] = this.data[i];\n\t\ttemp.set(this.data);\n\n\t\tthis.data[6] = x*temp[0] + y*temp[3] + temp[6];\n\t\tthis.data[7] = x*temp[1] + y*temp[4] + temp[7];\n\t\tthis.data[8] = x*temp[2] + y*temp[5] + temp[8];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCreates a rotation matrix for the given angle (in radians) and appends it.\n\t * \t!rotate (angle: number) : Matrix;\n\t */\n\trotate: function (angle)\n\t{\n\t\tif (angle == 0)\n\t\t\treturn this;\n\n\t\tthis.identity(temp2);\n\n\t\tlet cost = Math.cos(angle);\n\t\tlet sint = Math.sin(angle);\n\n\t\ttemp2[0] = cost;\n\t\ttemp2[1] = -sint;\n\t\ttemp2[3] = sint;\n\t\ttemp2[4] = cost;\n\n\t\treturn this.append(temp2);\n\t},\n\n\t/**\n\t * \tCreates a scaling matrix and appends it.\n\t * \t!scale (sx: number, sy: number) : Matrix;\n\t */\n\tscale: function (sx, sy)\n\t{\n\t\tif (sx == 1 && sy == 1)\n\t\t\treturn this;\n\n\t\tthis.identity(temp2);\n\n\t\ttemp2[0] = sx;\n\t\ttemp2[4] = sy;\n\n\t\treturn this.append(temp2);\n\t},\n\n\t/**\n\t * \tApplies the matrix to the specified vector (matrix-vector multiplication) and returns a new Vec2.\n\t * \t!applyTo (vect: Vec2) : Vec2;\n\t */\n\t/**\n\t * \tApplies the matrix to the specified coordinates (matrix-vector multiplication) and returns a new Vec2.\n\t * \t!applyTo (x: number, y: number) : Vec2;\n\t */\n\tapplyTo: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tconst v = x;\n\t\t\tx = v.x;\n\t\t\ty = v.y;\n\t\t}\n\n\t\tlet nx = this.data[0]*x + this.data[3]*y + this.data[6];\n\t\tlet ny = this.data[1]*x + this.data[4]*y + this.data[7];\n\n\t\treturn Vec2.Pool.alloc(nx, ny);\n\t},\n\n\t/**\n\t * \tTransposes the matrix.\n\t * \t!transpose() : Matrix;\n\t */\n\ttranspose: function ()\n\t{\n\t\ttemp.fill(0);\n\n\t\tfor (let j = 0; j < 3; j++)\n\t\tfor (let i = 0; i < 3; i++)\n\t\t\ttemp[j*3+i] = this.data[i*3+j];\n\n\t\t//for (let i = 0; i < 9; i++) this.data[i] = temp[i];\n\t\tthis.data.set(temp);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the determinant of the matrix.\n\t * \t!det() : number;\n\t */\n\tdet: function ()\n\t{\n\t\treturn\tthis.data[0] * (this.data[4]*this.data[8] - this.data[5]*this.data[7]) -\n\t\t\t\tthis.data[1] * (this.data[3]*this.data[8] - this.data[5]*this.data[6]) +\n\t\t\t\tthis.data[2] * (this.data[3]*this.data[7] - this.data[4]*this.data[6])\n\t\t\t\t;\n\t},\n\n\t/**\n\t * \tReturns a new matrix with the adjoint of the current matrix.\n\t * \t!adj() : Matrix;\n\t */\n\tadj: function () // violet:verify and fix\n\t{\n\t\t/*let t = this.transpose();\n\t\tlet d = Matrix.Pool.alloc();\n\n\t\td.data[0] = (t.data[4]*t.data[8] - t.data[5]*t.data[7]);\n\t\td.data[1] = -(t.data[3]*t.data[8] - t.data[5]*t.data[6]);\n\t\td.data[2] = (t.data[3]*t.data[7] - t.data[4]*t.data[6]);\n\n\t\td.data[3] = -(t.data[1]*t.data[8] - t.data[2]*t.data[7]);\n\t\td.data[4] = (t.data[0]*t.data[8] - t.data[2]*t.data[6]);\n\t\td.data[5] = -(t.data[0]*t.data[7] - t.data[1]*t.data[6]);\n\n\t\td.data[6] = (t.data[1]*t.data[5] - t.data[2]*t.data[4]);\n\t\td.data[7] = -(t.data[0]*t.data[5] - t.data[2]*t.data[3]);\n\t\td.data[8] = (t.data[0]*t.data[4] - t.data[1]*t.data[3]);\n\n\t\tt.data = d;\n\t\treturn t;*/\n\t\tthrow new Error('NOT IMPLEMENTED');\n\t},\n\n\t/**\n\t * \tReturns a new matrix with the inverse of the current matrix.\n\t * \t!inverse() : Matrix;\n\t */\n\tinverse: function ()\n\t{\n\t\tlet det = this.det();\n\t\tif (!det) return null;\n\n\t\treturn this.adj().scalef(1/det);\n\t},\n\n\t/**\n\t * \tReturns a string representation of the matrix.\n\t * \t!toString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn `[${this.data[0]}, ${this.data[3]}, ${this.data[6]}]\\n[${this.data[1]}, ${this.data[4]}, ${this.data[7]}]\\n[${this.data[2]}, ${this.data[5]}, ${this.data[8]}]\\n`;\n\t}\n});\n\n/**\n * \tSets the components of the specified array as the identity matrix.\n * \t!static loadIdentity (target: Float32Array) : void;\n */\nMatrix.loadIdentity = function (target)\n{\n\ttarget.fill(0);\n\ttarget[0] = target[4] = target[8] = 1;\n};\n\n//!/class\n\n//!namespace Matrix\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a new matrix copying the components from the specified matrix.\n\t * \t!function alloc (value: Matrix): Matrix;\n\t */\n\t/**\n\t * \tAllocates a new matrix with the values from the specified array.\n\t * \t!function alloc (value: Float32Array): Matrix;\n\t */\n\t/**\n\t * \tAllocates a new matrix with the identity matrix values.\n\t * \t!function alloc (): Matrix;\n\t */\n\nRecycler.createPool (Matrix, 4096, 1024);\nexport default Matrix;\n","//!namespace glx\n\n\t//!enum BufferTarget\n\t\t//:ARRAY_BUFFER\n\t\t//:ELEMENT_ARRAY_BUFFER\n\t\t//:COPY_READ_BUFFER\n\t\t//:COPY_WRITE_BUFFER\n\t\t//:TRANSFORM_FEEDBACK_BUFFER\n\t\t//:UNIFORM_BUFFER\n\t\t//:PIXEL_PACK_BUFFER\n\t\t//:PIXEL_UNPACK_BUFFER\n\t//!/enum\n\n\t//!enum BufferUsage\n\t\t//!STATIC_DRAW\n\t\t//!DYNAMIC_DRAW\n\t\t//!STREAM_DRAW\n\t\t//!STATIC_READ\n\t\t//!DYNAMIC_READ\n\t\t//!STREAM_READ\n\t\t//!STATIC_COPY\n\t\t//!DYNAMIC_COPY\n\t\t//!STREAM_COPY\n\t//!/enum\n\n//!/namespace\n\n//!class glx\n\nconst glx =\n{\n\tBufferTarget: { },\n\tBufferUsage: { },\n\n\t/**\n\t * WebGL rendering context.\n\t * !static readonly gl: WebGL2RenderingContext;\n\t */\n\tgl: null,\n\n\t/**\n\t * Sets the WebGL rendering context.\n\t * !static setContext (context: WebGL2RenderingContext) : glx;\n\t */\n\tsetContext: function (context)\n\t{\n\t\tthis.gl = context;\n\n\t\tthis.BufferTarget.ARRAY_BUFFER = this.gl.ARRAY_BUFFER;\n\t\tthis.BufferTarget.ELEMENT_ARRAY_BUFFER = this.gl.ELEMENT_ARRAY_BUFFER;\n\t\tthis.BufferTarget.COPY_READ_BUFFER = this.gl.COPY_READ_BUFFER;\n\t\tthis.BufferTarget.COPY_WRITE_BUFFER = this.gl.COPY_WRITE_BUFFER;\n\t\tthis.BufferTarget.TRANSFORM_FEEDBACK_BUFFER = this.gl.TRANSFORM_FEEDBACK_BUFFER;\n\t\tthis.BufferTarget.UNIFORM_BUFFER = this.gl.UNIFORM_BUFFER;\n\t\tthis.BufferTarget.PIXEL_PACK_BUFFER = this.gl.PIXEL_PACK_BUFFER;\n\t\tthis.BufferTarget.PIXEL_UNPACK_BUFFER = this.gl.PIXEL_UNPACK_BUFFER;\n\n\t\tthis.BufferUsage.STATIC_DRAW = this.gl.STATIC_DRAW;\n\t\tthis.BufferUsage.DYNAMIC_DRAW = this.gl.DYNAMIC_DRAW;\n\t\tthis.BufferUsage.STREAM_DRAW = this.gl.STREAM_DRAW;\n\t\tthis.BufferUsage.STATIC_READ = this.gl.STATIC_READ;\n\t\tthis.BufferUsage.DYNAMIC_READ = this.gl.DYNAMIC_READ;\n\t\tthis.BufferUsage.STREAM_READ = this.gl.STREAM_READ;\n\t\tthis.BufferUsage.STATIC_COPY = this.gl.STATIC_COPY;\n\t\tthis.BufferUsage.DYNAMIC_COPY = this.gl.DYNAMIC_COPY;\n\t\tthis.BufferUsage.STREAM_COPY = this.gl.STREAM_COPY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the value of a GL parameter.\n\t * !static getParameter (name: string) : any;\n\t */\n\tgetParameter: function (name)\n\t{\n\t\treturn this.gl.getParameter(this.gl[name]);\n\t},\n\n\t/**\n\t * Returns a slice of an array as a Float32Array.\n\t * !static getFloat32Array (data: any, offset: number, length: number) : Float32Array;\n\t */\n\tgetFloat32Array: function (data, offset, length)\n\t{\n\t\tif (offset === 0 && length === data.length)\n\t\t{\n\t\t\tif (data instanceof Float32Array)\n\t\t\t\treturn data;\n\t\t}\n\n\t\tlet buff = new Float32Array(length);\n\n\t\tfor (let i = 0; i < length; i++)\n\t\t\tbuff[i] = data[i+offset];\n\n\t\treturn buff;\n\t},\n\n\t/**\n\t * Creates a buffer from the specified array.\n\t * @param {BufferTarget} target Defaults to ARRAY_BUFFER.\n\t * @param {BufferUsage} usage Defaults to STATIC_DRAW.\n\t * !static createBufferFrom (data: any, target?: glx.BufferTarget, usage?: glx.BufferUsage, offset?: number, length?: number) : WebGLBuffer;\n\t */\n\tcreateBufferFrom: function (data, target=null, usage=null, offset=null, length=null)\n\t{\n\t\ttarget = target ?? glx.BufferTarget.ARRAY_BUFFER;\n\t\tusage = usage ?? glx.BufferUsage.STATIC_DRAW;\n\n\t\tlet buff = this.gl.createBuffer();\n\t\tthis.gl.bindBuffer (target, buff);\n\t\tthis.gl.bufferData (target, this.getFloat32Array(data, offset ?? 0, length ?? data.length), usage);\n\n\t\t//this.gl.bindBuffer (target, null);\n\t\treturn buff;\n\t}\n};\n\n//!/class\n\nexport default glx;\n","\n//:/**\n//: * Provides pre-processing to reuse GLSL code.\n//: */\n\n//!class glsl\n\nconst glsl =\n{\n\t/**\n\t * Library of GLSL code snippets.\n\t */\n\tsnippets: { },\n\n\t/**\n\t * Registers a snippet in the GLSL code library.\n\t * !static set (name: string, source: string) : void;\n\t */\n\tset: function (name, source)\n\t{\n\t\tthis.snippets[name] = source;\n\t},\n\n\t/**\n\t * Returns a snippet of code given its name.\n\t * !static get (name: string) : string;\n\t */\n\tget: function (name)\n\t{\n\t\treturn this.snippets.hasOwnProperty(name) ? this.snippets[name] : '';\n\t},\n\n\t/**\n\t * Replaces special marks in the code.\n\t */\n\treplace: function (code, alreadyImported)\n\t{\n\t\tcode = code.split('\\n');\n\n\t\tfor (let i = 0; i < code.length; i++)\n\t\t{\n\t\t\tlet value = code[i].trim();\n\n\t\t\tif (value.startsWith('//@use '))\n\t\t\t{\n\t\t\t\tlet str = '';\n\n\t\t\t\tfor (let name of value.substring(7).split(','))\n\t\t\t\t{\n\t\t\t\t\tname = name.trim();\n\n\t\t\t\t\tif (alreadyImported.hasOwnProperty(name))\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\talreadyImported[name] = true;\n\n\t\t\t\t\tstr += glsl.replace(glsl.get(name), alreadyImported) + '\\n';\n\t\t\t\t}\n\n\t\t\t\tcode[i] = str;\n\t\t\t}\n\t\t}\n\n\t\treturn code.join('\\n');\n\t},\n\n\t/**\n\t * Processes GLSL code, returns a string of GLSL code ready to be compiled.\n\t *\n\t * - If \"#version\" not specified \"#version 300 es\" will be added.\n\t * - If \"precision\" not specified \"precision highp float;\" will be added.\n\t * - Directive \"//@use\" will be replaced with the appropriate snippet(s).\n\t *\n\t * !static process (code: string) : string;\n\t */\n\tprocess: function (code)\n\t{\n\t\tcode = code.trim();\n\n\t\tif (code.indexOf('precision') === -1)\n\t\t\tcode = 'precision highp float;\\n' + code;\n\n\t\tif (code.indexOf('#version') === -1)\n\t\t\tcode = '#version 300 es\\n' + code;\n\n\t\treturn this.replace(code, { });\n\t}\n};\n\n//!/class\n\nexport default glsl;\n\n/**\n * Reusable GLSL snippets.\n */\n\nglsl.set('vert-defs', `\n\tuniform mat3 m_transform;\n\tuniform mat3 m_quad;\n\tuniform mat3 m_texture;\n\tuniform vec4 v_resolution;\n\tuniform vec4 v_frame_size;\n\tuniform float f_scale;\n\tuniform float f_time;\n\tuniform float f_depth;\n\n\tin vec3 location;\n\tout vec2 texcoords;\n`);\n\nglsl.set('frag-defs', `\n\tuniform vec4 v_resolution;\n\tuniform vec4 v_frame_size;\n\tuniform float f_scale;\n\tuniform float f_time;\n\tuniform float f_alpha;\n\tuniform sampler2D texture0;\n\n\tin vec2 texcoords;\n\tout vec4 color;\n`);\n\nglsl.set('invertX', `\n\tvec2 invertX (vec2 value) {\n\t\treturn value * vec2(-1.0, 1.0);\n\t}\n`);\n\nglsl.set('invertY', `\n\tvec2 invertY (vec2 value) {\n\t\treturn value * vec2(1.0, -1.0);\n\t}\n`);\n\n// Returns the normalized (0 to 1) value for the given signed-normalized (-1 to 1) value.\nglsl.set('norm', `\n\tfloat norm (float value) {\n\t\treturn (value + 1.0) * 0.5;\n\t}\n\n\tvec2 norm (vec2 value) {\n\t\treturn (value + 1.0) * 0.5;\n\t}\n\n\tvec3 norm (vec3 value) {\n\t\treturn (value + 1.0) * 0.5;\n\t}\n`);\n\n// Returns the signed-normalized (-1 to 1) value for the given normalized (0 to 1) value.\nglsl.set('snorm', `\n\tfloat snorm (float value) {\n\t\treturn value * 2.0 - 1.0;\n\t}\n\n\tvec2 snorm (vec2 value) {\n\t\treturn value * 2.0 - 1.0;\n\t}\n\n\tvec3 snorm (vec3 value) {\n\t\treturn value * 2.0 - 1.0;\n\t}\n`);\n\nglsl.set('location2d', `\n\t//@use invertY, snorm\n\n\tvec4 location2d (vec3 location, float depth)\n\t{\n\t\tvec2 loc = vec2(m_transform * m_quad * location) / v_resolution.xy;\n\t\treturn vec4(invertY(snorm(loc)), depth/16777216.0, 1.0);\n\t}\n`);\n\nglsl.set('frameTexCoords', `\n\tflat out vec2 v_frame_offset;\n\n\tvec2 frameTexCoords (vec3 location) {\n\t\tv_frame_offset = vec2(m_texture[2][0], m_texture[2][1]);\n\t\treturn mat2(m_texture * m_quad) * location.xy / (v_frame_size.xy * v_frame_size.zw);\n\t}\n`);\n\nglsl.set('frameTex', `\n\tflat in vec2 v_frame_offset;\n\n\tvec4 frameTex (vec2 texcoords) {\n\t\treturn texture(texture0, fract(texcoords)*v_frame_size.xy + v_frame_offset);\n\t}\n`);\n\nglsl.set('rand', `\n\tfloat rand (vec2 value) {\n\t\treturn fract(sin(dot(value, vec2(12.9898, 78.233))) * 43758.5453);\n\t}\n`);\n\nglsl.set('align', `\n\tfloat align (float value, float step) {\n\t\treturn floor(value/step)*step;\n\t}\n`);\n\nglsl.set('sqwave', `\n\tfloat sqwave (float time, float period, float dcycle) {\n\t\treturn step(mod(time, period) - dcycle*period, 0.0);\n\t}\n`);\n\nglsl.set('mask', `\n\tfloat mask (float alpha) {\n\t\treturn 1.0 - step(alpha, 0.0);\n\t}\n\n\tfloat mask (vec4 color) {\n\t\treturn 1.0 - step(color.a, 0.0);\n\t}\n`);\n\nglsl.set('luminance', `\n\tfloat luminance (vec3 color) {\n\t\treturn dot(color, vec3(0.2126, 0.7152, 0.0722));\n\t}\n\n\tfloat luminance (vec4 color) {\n\t\treturn dot(color.rgb, vec3(0.2126, 0.7152, 0.0722));\n\t}\n`);\n","\nimport { Class } from 'rinn';\nimport glx from './glx.js';\nimport glsl from './glsl.js';\n\n//![import \"./glx\"]\n//![import \"./glsl\"]\n\n//:/**\n//: * Describes a shader object. The actual shader type is specified at construction.\n//: */\n\n//!class Shader\n\nconst Shader = Class.extend\n({\n\t/**\n\t * Identifier of the shader.\n\t * !readonly id: string;\n\t */\n\tid: null,\n\n\t/**\n\t * Type of the shader.\n\t * !readonly type: Shader.Type;\n\t */\n\ttype: 0,\n\n\t/**\n\t * Shader GL identifier.\n\t * !readonly shaderId: number;\n\t */\n\tshaderId: null,\n\n\t/**\n\t * Constructs a shader and registers with the specified id. Compile its GLSL code using the `compile` method.\n\t * !constructor (id: string, type: Shader.Type);\n\t */\n\t/**\n\t * Constructs a shader, compile its GLSL code using the `compile` method.\n\t * !constructor (type: Shader.Type);\n\t */\n\t/**\n\t * Constructs a shader with the specified GLSL code and registers with the specified id.\n\t * !constructor (id: string, type: Shader.Type, source: string);\n\t */\n\t/**\n\t * Constructs a shader with the specified GLSL code.\n\t * !constructor (type: Shader.Type, source: string);\n\t */\n\t__ctor: function (id, type=null, source=null)\n\t{\n\t\tif (source === null && type !== null && typeof(type) === 'string')\n\t\t{\n\t\t\tsource = type;\n\t\t\ttype = null;\n\t\t}\n\n\t\tif (type === null)\n\t\t{\n\t\t\ttype = id;\n\t\t\tid = null;\n\t\t}\n\n\t\tShader.put(this.id = id, this);\n\t\tthis.type = type;\n\n\t\tthis.shaderId = null;\n\n\t\tif (source !== null)\n\t\t\tthis.compile(source);\n\t},\n\n\t/**\n\t * \tDestroys the shader.\n\t */\n\t__dtor: function ()\n\t{\n\t\tglx.gl.deleteShader(this.shaderId);\n\t\tShader.remove(this.id);\n\t},\n\n\t/**\n\t * Compiles the shader and throws an exception if any compilations error occur.\n\t * !compile (source: string) : Shader;\n\t */\n\tcompile: function (source)\n\t{\n\t\tlet gl = glx.gl;\n\t\tthis.shaderId = gl.createShader (this.type === Shader.Type.VERTEX ? gl.VERTEX_SHADER : (this.type === Shader.Type.FRAGMENT ? gl.FRAGMENT_SHADER : gl.GEOMETRY_SHADER));\n\n\t\tsource = glsl.process(source);\n\n\t\tgl.shaderSource(this.shaderId, source);\n\t\tgl.compileShader(this.shaderId);\n\n\t\tlet error = gl.getShaderInfoLog(this.shaderId);\n\t\tif (error) {\n\t\t\tconsole.error(source.split(\"\\n\").map((i,index) => (index) + \": \" + i).join(\"\\n\"));\n\t\t\tthrow new Error ((this.id ? '[' + this.id + '] ' : '') + error);\n\t\t}\n\n\t\treturn this;\n\t}\n});\n\n//!/class\n\n/**\n * \tGlobal shader list.\n */\nShader.shaders = { };\n\n/**\n * \tStores a shader with the specified identifier in the global shader list.\n * \t!static put (id: string, shader: Shader) : void;\n */\nShader.put = function (id, shader)\n{\n\tif (id) this.shaders[id] = shader;\n};\n\n/**\n * \tReturns a Shader from the global shader list given its identifier.\n * \t!static get (id: string) : Shader;\n */\nShader.get = function (id)\n{\n\treturn this.shaders[id];\n};\n\n/**\n * \tRemoves a shader from the global shader list.\n * \t!static remove (id: string) : void;\n */\nShader.remove = function (id)\n{\n\tdelete this.shaders[id];\n};\n\n//!namespace Shader\n\n//:/**\n//: * \tShader types.\n//: */\n\n//!enum Type\n\nShader.Type = {\n\tVERTEX: 0,\n\t//!VERTEX\n\tFRAGMENT: 1,\n\t//!FRAGMENT\n\tGEOMETRY: 2,\n\t//!GEOMETRY\n};\n\n//!/enum\n\nexport default Shader;\n","\nimport { Class } from 'rinn';\nimport Shader from './shader.js';\nimport glx from './glx.js';\n\n//![import \"./shader\"]\n//![import \"./globals\"]\n//![import \"./glx\"]\n\n//:/**\n//: * Describes a shader program.\n//: */\n\n//!class ShaderProgram\n\nconst ShaderProgram = Class.extend\n({\n\t/**\n\t * Cache of locations.\n\t */\n\tlocations: null,\n\n\t/**\n\t * Identifier of the program.\n\t * !readonly id: string;\n\t */\n\tid: null,\n\n\t/**\n\t * Shaders attached to the program.\n\t * !readonly shaders: Array<Shader>;\n\t */\n\tshaders: null,\n\n\t/**\n\t * Shader program GL identifier.\n\t * !readonly programId: number;\n\t */\n\tprogramId: null,\n\n\t/**\n\t * Constructs an empty shader program with the specified identifier. Attach shaders by using the `attach` method.\n\t * !constructor (id?: string);\n\t */\n\t__ctor: function (id=null)\n\t{\n\t\tthis.id = id;\n\n\t\tthis.shaders = [];\n\t\tthis.programId = null;\n\n\t\tthis.locations = { };\n\n\t\tthis._uniformSetter = null;\n\n\t\tShaderProgram.put(id, this);\n\t},\n\n\t/**\n\t * Destroys the shader program.\n\t */\n\t__dtor: function ()\n\t{\n\t\tlet gl = glx.gl;\n\t\tif (!gl) return this;\n\n\t\tgl.deleteProgram(this.programId);\n\t\tShaderProgram.remove(this.id);\n\t},\n\n\t/**\n\t * Sets the uniform setter function.\n\t * @param { (pgm:ShaderProgram) => void } uniformSetter\n\t * @returns {Element}\n\t * !uniformSetter (uniformSetter: (pgm:ShaderProgram) => void) : ShaderProgram;\n\t */\n\tuniformSetter: function (uniformSetter)\n\t{\n\t\tthis._uniformSetter = uniformSetter;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Attaches a shader to the shader program.\n\t * !attach (shader: Shader|string) : ShaderProgram;\n\t */\n\tattach: function (shader)\n\t{\n\t\tif (typeof(shader) === 'string')\n\t\t\tshader = Shader.get(shader);\n\n\t\tif (!shader)\n\t\t\tthrow new Error ('Unable to attach shader, argument is null.');\n\n\t\tthis.shaders.push(shader);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Binds the attribute locations to their predefined values.\n\t */\n\tbindLocations: function ()\n\t{\n\t\tglx.gl.bindAttribLocation (this.programId, 0, 'location');\n\t},\n\n\t/**\n\t * Returns the location of an attribute.\n\t * !getAttribLocation (name: string) : object;\n\t */\n\tgetAttribLocation: function (name)\n\t{\n\t\tif (!this.locations.hasOwnProperty(name))\n\t\t\tthis.locations[name] = glx.gl.getAttribLocation (this.programId, name);\n\n\t\treturn this.locations[name];\n\t},\n\n\t/**\n\t * Returns the location of a uniform variable.\n\t * !getUniformLocation (name: string) : object;\n\t */\n\tgetUniformLocation: function (name)\n\t{\n\t\tif (!this.locations.hasOwnProperty(name))\n\t\t\tthis.locations[name] = glx.gl.getUniformLocation (this.programId, name);\n\n\t\treturn this.locations[name];\n\t},\n\n\t/**\n\t * Returns the location of a uniform block.\n\t * !getUniformBlockLocation (name: string) : object;\n\t */\n\tgetUniformBlockLocation: function (name)\n\t{\n\t\tif (!this.locations.hasOwnProperty(name))\n\t\t\tthis.locations[name] = glx.gl.getUniformBlockIndex (this.programId, name);\n\n\t\treturn this.locations[name];\n\t},\n\n\t/**\n\t * Returns the size of a uniform block.\n\t * !getUniformBlockSize (uniformBlock: string|object) : number;\n\t */\n\tgetUniformBlockSize: function (uniformBlock)\n\t{\n\t\tif (typeof(uniformBlock) === 'string')\n\t\t\tuniformBlock = this.getUniformBlockLocation(uniformBlock);\n\n\t\treturn glx.gl.getActiveUniformBlockParameter(this.programId, uniformBlock, glx.gl.UNIFORM_BLOCK_DATA_SIZE);\n\t},\n\t\n\t/**\n\t * Creates a buffer for a uniform block.\n\t * !createUniformBlockBuffer (uniformBlock: string|object) : Float32Array;\n\t */\n\tcreateUniformBlockBuffer: function (uniformBlock)\n\t{\n\t\tif (typeof(uniformBlock) === 'string')\n\t\t\tuniformBlock = this.getUniformBlockLocation(uniformBlock);\n\n\t\tlet size = this.getUniformBlockSize(uniformBlock);\n\t\tlet buff = glx.createBufferFrom (new Float32Array(size).fill(0), glx.BufferTarget.UNIFORM_BUFFER, glx.BufferUsage.DYNAMIC_DRAW);\n\n\t\tglx.gl.bindBufferBase (glx.BufferTarget.UNIFORM_BUFFER, 0, buff);\n\t},\n\n\t/**\n\t * Loads the locations of the predefined uniforms and attributes.\n\t */\n\tpreloadLocations: function ()\n\t{\n\t\tthis.getUniformLocation('f_time');\n\t\tthis.getUniformLocation('f_scale');\n\n\t\tthis.getUniformLocation('m_transform');\n\t\tthis.getUniformLocation('m_texture');\n\t\tthis.getUniformLocation('m_quad');\n\n\t\tthis.getUniformLocation('v_resolution');\n\t\tthis.getUniformLocation('v_frame_size');\n\n\t\tthis.getUniformLocation('f_depth');\n\t\tthis.getUniformLocation('f_alpha');\n\t\tthis.getUniformLocation('v_base_color');\n\n\t\tthis.getUniformLocation('texture0');\n\n\t\tthis.getAttribLocation('location');\n\t},\n\n\t/**\n\t * Links the shaders into the shader program. Completion can be obtained by calling `getStatus`.\n\t * !link() : ShaderProgram;\n\t */\n\tlink: function ()\n\t{\n\t\tlet gl = glx.gl;\n\t\tif (!gl) return this;\n\n\t\tthis.programId = gl.createProgram();\n\n\t\tfor (let shader of this.shaders)\n\t\t\tgl.attachShader (this.programId, shader.shaderId);\n\n\t\tthis.bindLocations();\n\t\tgl.linkProgram (this.programId);\n\t\tthis.preloadLocations();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Activates the shader program to be used in the subsequent drawing operations.\n\t * !activate() : void;\n\t */\n\tactivate: function ()\n\t{\n\t\tlet gl = glx.gl;\n\t\tif (!gl) return;\n\n\t\tgl.useProgram (this.programId);\n\n\t\tif (this._uniformSetter !== null)\n\t\t\tthis._uniformSetter (this, gl);\n\t},\n\n\t/**\n\t * Returns the link status of the program.\n\t * !getStatus() : boolean;\n\t */\n\tgetStatus: function ()\n\t{\n\t\tlet gl = glx.gl;\n\t\tif (!gl) return true;\n\n\t\treturn gl.getProgramParameter(this.programId, gl.LINK_STATUS);\n\t},\n\n\t/**\n\t * Returns the error of the last link operation.\n\t * !getError() : string;\n\t */\n\tgetError: function ()\n\t{\n\t\tlet gl = glx.gl;\n\t\tif (!gl) return '';\n\n\t\tif (this.programId === null)\n\t\t\treturn 'Program has not been linked.';\n\n\t\treturn gl.getProgramInfoLog(this.programId);\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform1f (location: string|object, v0: number) : ShaderProgram;\n\t */\n\tuniform1f: function (location, v0)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform1f (location, v0);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform1fv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform1fv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform1fv (location, value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform1i (location: string|object, v0: number) : ShaderProgram;\n\t */\n\tuniform1i: function (location, v0)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform1i (location, v0);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform1iv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform1iv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform1iv (location, value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform2f (location: string|object, v0: number, v1: number) : ShaderProgram;\n\t */\n\tuniform2f: function (location, v0, v1)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform2f (location, v0, v1);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform2fv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform2fv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform2fv (location, value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform2i (location: string|object, v0: number, v1: number) : ShaderProgram;\n\t */\n\tuniform2i: function (location, v0, v1)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform2i (location, v0, v1);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform2iv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform2iv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform2iv (location, value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform3f (location: string|object, v0: number, v1: number, v2: number) : ShaderProgram;\n\t */\n\tuniform3f: function (location, v0, v1, v2)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform3f (location, v0, v1, v2);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform3fv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform3fv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform3fv (location, value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform3i (location: string|object, v0: number, v1: number, v2: number) : ShaderProgram;\n\t */\n\tuniform3i: function (location, v0, v1, v2)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform3i (location, v0, v1, v2);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform3iv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform3iv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform3iv (location, value);\n\t\treturn this;\n\t},\n\t\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform4f (location: string|object, v0: number, v1: number, v2: number, v3: number) : ShaderProgram;\n\t */\n\tuniform4f: function (location, v0, v1, v2, v3)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform4f (location, v0, v1, v2, v3);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform4fv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform4fv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform4fv (location, value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform4i (location: string|object, v0: number, v1: number, v2: number, v3: number) : ShaderProgram;\n\t */\n\tuniform4i: function (location, v0, v1, v2, v3)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform4i (location, v0, v1, v2, v3);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform4iv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform4iv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform4iv (location, value);\n\t\treturn this;\n\t},\n\n});\n\n/**\n * Global shader program list.\n */\nShaderProgram.programs = { };\n\n/**\n * Creates a new shader program. The specified source code allows the use of \"//@vert\", \"//@frag\" and \"//@geom\" directives to specify the code\n * blocks of the vertex, fragment and geometry shader respectively.\n * !static create (id: string, source: string) : ShaderProgram;\n */\nShaderProgram.create = function (id, source)\n{\n\tlet vs = null, vsName = null;\n\tlet fs = null, fsName = null;\n\tlet gs = null, gsName = null;\n\n\tlet active = null;\n\n\tfor (let i of source.split('\\n'))\n\t{\n\t\tlet v = i.trim();\n\n\t\tif (v.startsWith('//'))\n\t\t{\n\t\t\tv = v.split(' ').map(i => i.trim());\n\n\t\t\tif (v[0] === '//@vert') {\n\t\t\t\tif (v.length > 1) vsName = v[1];\n\t\t\t\tif (vs === null) vs = [];\n\t\t\t\tactive = vs;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (v[0] === '//@frag') {\n\t\t\t\tif (v.length > 1) fsName = v[1];\n\t\t\t\tif (fs === null) fs = [];\n\t\t\t\tactive = fs;\n\t\t\t\tcontinue;\n\n\t\t\t}\n\n\t\t\tif (v[0] === '//@geom') {\n\t\t\t\tif (v.length > 1) gsName = v[1];\n\t\t\t\tif (gs === null) gs = [];\n\t\t\t\tactive = gs;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\t\tif (active !== null)\n\t\t\tactive.push(i);\n\t}\n\n\tlet pgm = new ShaderProgram(id);\n\n\t// Convert to string.\n\tif (vs !== null) vs = vs.join('\\n').trim();\n\tif (fs !== null) fs = fs.join('\\n').trim();\n\tif (gs !== null) gs = gs.join('\\n').trim();\n\n\t// Load shaders from name if name specified without any source code.\n\tif (vs !== null && vs.length === 0)\n\t{\n\t\tvs = Shader.get(vsName);\n\t\tif (vs === null) throw new Error('Vertex shader not found: ' + vsName);\n\t}\n\telse if (vs === null || vs.length === 0)\n\t\tvs = null;\n\n\tif (fs !== null && fs.length === 0)\n\t{\n\t\tfs = Shader.get(fsName);\n\t\tif (fs === null) throw new Error('Fragment shader not found: ' + fsName);\n\t}\n\telse if (fs === null || fs.length === 0)\n\t\tfs = null;\n\n\tif (gs !== null && gs.length === 0)\n\t{\n\t\tgs = Shader.get(gsName);\n\t\tif (gs === null) throw new Error('Geometry shader not found: ' + gsName);\n\t}\n\telse if (gs === null || gs.length === 0)\n\t\tgs = null;\n\n\t// Load default if none specified.\n\tif (vs === null) vs = Shader.get('def-vert');\n\tif (fs === null) fs = Shader.get('def-frag');\n\n\t// Compile source if GLSL source specified.\n\tif (vs !== null && typeof(vs) === 'string')\n\t\tvs = new Shader (vsName, Shader.Type.VERTEX, vs);\n\n\tif (fs !== null && typeof(fs) === 'string')\n\t\tfs = new Shader (fsName, Shader.Type.FRAGMENT, fs);\n\n\tif (gs !== null && typeof(gs) === 'string')\n\t\tgs = new Shader (gsName, Shader.Type.GEOMETRY, gs);\n\n\t// Attach programs and link.\n\tif (vs !== null) pgm.attach(vs);\n\tif (fs !== null) pgm.attach(fs);\n\tif (gs !== null) pgm.attach(gs);\n\n\treturn pgm.link();\n};\n\n/**\n * Puts a shader program in the global program list under the specified identifier.\n * !static put (id: string, shaderProgram: ShaderProgram) : void;\n */\nShaderProgram.put = function (id, shaderProgram)\n{\n\tif (id) this.programs[id] = shaderProgram;\n};\n\n/**\n * Returns a shader program from the global program list given its identifier.\n * !static get (id: string) : ShaderProgram;\n */\nShaderProgram.get = function (id)\n{\n\treturn this.programs[id];\n};\n\n/**\n * Removes a shader program from the global program list.\n * !static remove (id: string) : void;\n */\nShaderProgram.remove = function (id)\n{\n\tdelete this.programs[id];\n};\n\nexport default ShaderProgram;\n","\nimport { Class } from 'rinn';\nimport Canvas from './canvas';\nimport glx from './glx';\n\n//!namespace Texture\n\n\t//:type FilterType = 'NEAREST' | 'LINEAR';\n\t//:type WrapMode = 'REPEAT' | 'CLAMP_TO_EDGE' | 'MIRRORED_REPEAT';\n\n//!/namespace\n\n//:/**\n//: * Definition of a texture.\n//: */\n\n//!class Texture\n\nexport default Class.extend\n({\n\tclassName: 'Texture',\n\n\t/**\n\t * WebGL ID of the texture.\n\t * !readonly textureId: number;\n\t */\n\ttextureId: null,\n\n\t/**\n\t * Texture width (physical width).\n\t * !readonly width: number;\n\t */\n\twidth: 0,\n\n\t/**\n\t * Texture height (physical height).\n\t * !readonly height: number;\n\t */\n\theight: 0,\n\n\t/**\n\t * Target width originally requested (logical width).\n\t * !readonly targetWidth: number;\n\t */\n\ttargetWidth: 0,\n\n\t/**\n\t * Target height originally requested (logical height).\n\t * !readonly targetHeight: number;\n\t */\n\ttargetHeight: 0,\n\n\t/**\n\t * Real scale of the texture (physical width / logical width).\n\t * !readonly rscale: number;\n\t */\n\trscale: 1.0,\n\n\t/**\n\t * Texture filter.\n\t * !readonly filter: Texture.FilterType;\n\t */\n\tfilter: 'LINEAR',\n\n\t/**\n\t * Texture wrap mode.\n\t * !readonly wrap: Texture.WrapMode;\n\t */\n\twrap: 'CLAMP_TO_EDGE',\n\n\t/**\n\t * Number of mipmap levels (use 0 to disable).\n\t * !readonly mipmap: number;\n\t */\n\tmipmap: 0,\n\n\t/**\n\t * Indicates if the texture storage has already been allocated.\n\t */\n\tallocated: false,\n\n\t/**\n\t * Canvas currently attached to the texture.\n\t */\n\tcanvas: null,\n\n\t/**\n\t * Creates an empty texture of the specified size.\n\t * !constructor (width: number, height: number, targetWidth?: number, targetHeight?: number);\n\t */\n\t__ctor: function (width, height, targetWidth=null, targetHeight=null)\n\t{\n\t\tthis.textureId = null;\n\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.targetWidth = targetWidth ?? width;\n\t\tthis.targetHeight = targetHeight ?? height;\n\n\t\tthis.rscale = this.width / this.targetWidth;\n\t\tthis.filter = 'LINEAR';\n\t\tthis.wrap = 'CLAMP_TO_EDGE';\n\t\tthis.mipmap = 0;\n\t},\n\n\t/**\n\t * Binds the texture to the TEXTURE_2D target.\n\t * !bind(): WebGL2RenderingContext;\n\t */\n\tbind: function ()\n\t{\n\t\tconst gl = glx.gl;\n\n\t\tif (this.textureId === null)\n\t\t\tthis.textureId = gl.createTexture();\n\n\t\tgl.bindTexture(gl.TEXTURE_2D, this.textureId);\n\n\t\tif (this.allocated === false)\n\t\t{\n\t\t\tthis.allocated = null;\n\t\t\tthis.allocate();\n\t\t}\n\n\t\treturn gl;\n\t},\n\n\t/**\n\t * Allocates the texture storage.\n\t * !allocate(): Texture;\n\t */\n\tallocate: function ()\n\t{\n\t\tif (this.allocated === true)\n\t\t\treturn this;\n\n\t\tthis.allocated = true;\n\n\t\tconst gl = this.bind();\n\n\t\tthis.applyFilter(gl);\n\t\tthis.applyWrap(gl);\n\n\t\tif (this.mipmap > 0)\n\t\t\tgl.texStorage2D(gl.TEXTURE_2D, this.mipmap, gl.RGBA8, this.width, this.height);\n\t\telse\n\t\t\tgl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA8, this.width, this.height);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Applies the texture filter.\n\t * !applyFilter() : Texture;\n\t */\n\tapplyFilter: function (_gl=null)\n\t{\n\t\tconst gl = _gl ?? this.bind();\n\n\t\tif (this.mipmap > 0)\n\t\t{\n\t\t\tif (this.filter === 'NEAREST')\n\t\t\t{\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST_MIPMAP_LINEAR);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.filter === 'NEAREST')\n\t\t\t{\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Applies the texture wrap mode.\n\t * !applyWrap() : Texture;\n\t */\n\tapplyWrap: function (_gl=null)\n\t{\n\t\tconst gl = _gl ?? this.bind();\n\n\t\tif (this.wrap === 'REPEAT')\n\t\t{\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n\t\t}\n\t\telse if (this.wrap === 'MIRRORED_REPEAT')\n\t\t{\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.MIRRORED_REPEAT);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.MIRRORED_REPEAT);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the texture filter.\n\t * !setFilter (filter: Texture.FilterType) : Texture;\n\t */\n\tsetFilter: function (filter)\n\t{\n\t\tthis.filter = filter;\n\t\tif (this.textureId !== null) this.applyFilter();\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the texture wrap mode.\n\t * !setWrap (wrap: Texture.WrapMode) : Texture;\n\t */\n\tsetWrap: function (wrap)\n\t{\n\t\tthis.wrap = wrap;\n\t\tif (this.textureId !== null) this.applyWrap();\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the number of mipmap levels.\n\t * !setMipmap (mipmap: number) : Texture;\n\t */\n\tsetMipmap: function (mipmap)\n\t{\n\t\tthis.mipmap = mipmap;\n\n\t\tif (this.textureId !== null && this.allocated === true && this.mipmap > 0)\n\t\t{\n\t\t\tconst gl = this.bind();\n\t\t\tgl.generateMipmap(gl.TEXTURE_2D);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Uploads data to the GPU from the specified image.\n\t * !upload (image: object, targetX?: number, targetY?: number) : Texture;\n\t */\n\tupload: function (image, targetX=0, targetY=0)\n\t{\n\t\tconst gl = this.bind();\n\n\t\tgl.texSubImage2D(gl.TEXTURE_2D, 0, targetX, targetY, Math.min(image.width, this.width), Math.min(image.height, this.height), gl.RGBA, gl.UNSIGNED_BYTE, image);\n\n\t\tif (this.mipmap > 0)\n\t\t\tgl.generateMipmap(gl.TEXTURE_2D);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Creates a canvas and attaches it to the texture. The contents of the attached canvas can be uploaded to the texture by calling the `uploadCanvas` method.\n\t * !getCanvas (options?: Canvas.Options) : Texture;\n\t */\n\tcreateCanvas: function (options=null)\n\t{\n\t\tif (this.canvas === null)\n\t\t\tthis.canvas = new Canvas ({ gl: false, hidden: true, width: this.width, height: this.height, antialias: this.filter === 'LINEAR', ...options });\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the canvas attached to the texture or `null` if no canvas has been created yet (use `createCanvas` first).\n\t * !getCanvas() : Canvas;\n\t */\n\tgetCanvas: function ()\n\t{\n\t\treturn this.canvas;\n\t},\n\n\t/**\n\t * Uploads the bitmap data from the attached canvas to the texture. The callback is called when the upload is completed.\n\t * @returns {Texture}\n\t * !uploadCanvas (callback?: () => void) : Texture;\n\t */\n\tuploadCanvas: function (callback=null)\n\t{\n\t\tif (this.canvas === null)\n\t\t{\n\t\t\tif (callback !== null) callback();\n\t\t\treturn this;\n\t\t}\n\n\t\tlet img = new Image();\n\t\timg.onload = () =>\n\t\t{\n\t\t\tthis.upload(img);\n\t\t\timg = null;\n\n\t\t\tif (callback !== null) callback();\n\t\t};\n\n\t\timg.src = this.canvas.toDataUrl();\n\t\treturn this;\n\t},\n\n\t/**\n\t * Disposes the attached canvas.\n\t * @returns {Texture}\n\t */\n\tdisposeCanvas: function ()\n\t{\n\t\tif (this.canvas !== null)\n\t\t{\n\t\t\tthis.canvas.dispose();\n\t\t\tthis.canvas = null;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Allocates a canvas, executes the given render function, uploads the result to the texture and disposes the canvas.\n\t * @param {Canvas.Options} options\n\t * @param {(g: Canvas) => void} render\n\t * !uploadRender (options: Canvas.Options, render: (g: Canvas) => void) : Texture;\n\t */\n\t/**\n\t * Allocates a canvas, executes the given render function, uploads the result to the texture and disposes the canvas.\n\t * @param {(g: Canvas) => void} render\n\t * !uploadRender (render: (g: Canvas) => void) : Texture;\n\t */\n\tuploadRender: function (options, render=null)\n\t{\n\t\tif (typeof(options) === 'function')\n\t\t{\n\t\t\trender = options;\n\t\t\toptions = null;\n\t\t}\n\n\t\trender(this.createCanvas(options));\n\n\t\tthis.uploadCanvas();\n\t\tthis.disposeCanvas();\n\t\treturn this;\n\t}\n});\n\n//!/class\n","\nimport { Class, Rinn } from 'rinn';\nimport Matrix from '../math/matrix.js';\nimport System from './system.js';\nimport List from '../utils/list.js';\nimport ShaderProgram from './shader-program.js';\nimport Shader from './shader.js';\nimport globals from './globals.js';\nimport Log from './log.js';\nimport glx from './glx.js';\nimport Texture from './texture.js';\n\n//![import \"../math/matrix\"]\n//![import \"./system\"]\n//![import \"../utils/list\"]\n//![import \"./shader-program\"]\n//![import \"./shader\"]\n//![import \"./globals\"]\n//![import \"./log\"]\n//![import \"./glx\"]\n//![import \"./texture\"]\n\n//!namespace Canvas\n\n\t//!type Options =\n\n\t\t/**\n\t\t * \tActual HTML5 Canvas element, if `null` a new one will be created.\n\t\t * \t!elem: HTMLCanvasElement;\n\t\t */\n\t\t\n\t\t/**\n\t\t * \tWebGL enable flag.\n\t\t * \t!gl: boolean;\n\t\t */\n\n\t\t/**\n\t\t * \tBackground of the canvas element.\n\t\t * \t!background: string;\n\t\t */\n\n\t\t/**\n\t\t * \tWidth of the canvas.\n\t\t * \t!width: number;\n\t\t */\n\n\t\t/**\n\t\t * \tHeight of the canvas.\n\t\t * \t!height: number;\n\t\t */\n\n\t\t/**\n\t\t * \tIndicates if the canvas element should be hidden from view (not attached to the document body).\n\t\t * \t!hidden: boolean;\n\t\t */\n\n\t\t/**\n\t\t * \tSet to `true` to ensure the canvas is positioned absolutly to (0, 0).\n\t\t * \t!absolute: boolean;\n\t\t */\n\n\t\t/**\n\t\t * \tUsed to control the antialias property of the canvas.\n\t\t * \t!antialias: boolean;\n\t\t */\n\n\t//!/type\n\n//!/namespace\n\n//!class Canvas\n\n/**\n * \tConstructs a canvas object. If the Canvas DOM element is not provided a new element will be created and attached to the page.\n * \t!constructor (options: Canvas.Options);\n */\n\nconst Canvas = function (options=null)\n{\n\tlet opts = {\n\t\telem: null,\n\t\tgl: false,\n\t\tbackground: '#000000',\n\t\twidth: 0,\n\t\theight: 0,\n\t\thidden: true,\n\t\tabsolute: false,\n\t\tantialias: false,\n\t\t...options\n\t};\n\n\tconst headless = global.document ? false : true;\n\n\t// Create canvas element if required.\n\tif (opts.elem == null)\n\t{\n\t\tthis.elem = !headless ? global.document.createElement('canvas') : Rinn.clone(Canvas.passThruCanvas);\n\n\t\tif (global.document && opts.hidden != true)\n\t\t{\n\t\t\tglobal.document.body.appendChild (this.elem);\n\n\t\t\tif (opts.absolute === true) {\n\t\t\t\tthis.elem.style.position = 'absolute';\n\t\t\t\tthis.elem.style.left = '0';\n\t\t\t\tthis.elem.style.top = '0';\n\t\t\t}\n\t\t}\n\t}\n\telse\n\t{\n\t\tthis.elem = opts.elem;\n\t}\n\n\tif (!this.elem.getContext) return;\n\n\tif (opts.gl === true && !headless)\n\t{\n\t\tthis.gl = this.elem.getContext('webgl2', { desynchronized: false, preserveDrawingBuffer: false, alpha: false, stencil: true });\n\n\t\tif (globals.gl === null)\n\t\t\tglx.setContext(globals.gl = this.gl);\n\n\t\tthis.shaderProgram = null;\n\t\tthis.context = null;\n\n\t\tLog.write(glx.getParameter('VERSION') + ', ' + glx.getParameter('SHADING_LANGUAGE_VERSION'));\n\t}\n\telse\n\t{\n\t\tthis.context = this.elem.getContext('2d', { desynchronized: false });\n\t\tthis.gl = null;\n\t}\n\n\t// State stack support.\n\tthis.matrixStack = List.Pool.alloc();\n\tthis.alphaStack = List.Pool.alloc();\n\tthis.depthFlagStack = List.Pool.alloc();\n\tthis.shaderProgramStack = List.Pool.alloc();\n\n\tthis.matr = Matrix.Pool.alloc();\n\tthis.transform = Matrix.Pool.alloc();\n\n\t// Default context values.\n\tthis._globalScale = 1.0;\n\tthis._alpha = 1.0;\n\tthis._depthFlag = true;\n\n\t// Set initial transformation matrix.\n\tthis.updateTransform();\n\tthis.strokeStyle(\"#fff\");\n\tthis.fillStyle(\"#fff\");\n\n\tif (opts.width && opts.height)\n\tthis.resize (opts.width, opts.height);\n\n\tif (this.gl !== null)\n\t\tthis.initGl();\n\n\tthis.antialias = opts.antialias;\n\tthis.setBackground (opts.background);\n};\n\nCanvas.passThruCanvas = \n{\n\tparentNode: null,\n\n\timageSmoothingEnabled: true,\n\n\tstyle: {\n\t},\n\n\twidth: 960,\n\theight: 540,\n\n\tgetContext: function (renderingContext) {\n\t\treturn this;\n\t},\n\n\tpushClip: function() {\n\t},\n\n\tpopClip: function() {\n\t},\n\n\tscale: function (sx, sy) {\n\t},\n\n\trotate: function (angle) {\n\t},\n\n\ttranslate: function (x, y) {\n\t},\n\n\tsetTransform: function (a, b, c, d, e, f) {\n\t},\n\n\tupdateTransform: function () {\n\t},\n\n\ttoDataURL: function (mime, params) {\n\t\treturn '';\n\t},\n\n\tbeginPath: function () {\n\t},\n\n\tmoveTo: function (x, y) {\n\t},\n\n\tclosePath: function() {\n\t},\n\n\tlineTo: function() {\n\t},\n\n\trect: function(x, y, w, h) {\n\t},\n\n\tfill: function() {\n\t},\n\n\tstroke: function() {\n\t},\n\n\tfillRect: function(x, y, w, h) {\n\t},\n\n\tstrokeRect: function(x, y, w, h) {\n\t},\n\n\tclip: function() {\n\t},\n\n\tquadraticCurveTo: function (cpx, cpy, x, y) {\n\t},\n\n\tbezierCurveTo: function (cx1, cy1, cx2, cy2, x, y) {\n\t},\n\n\tarc: function (x, y, r, sA, eA, cw) {\n\t},\n\n\tarcTo: function (x1, y1, x2, y2, r) {\n\t},\n\n\tfillText: function (text, x, y, maxWidth) {\n\t},\n\n\tstrokeText: function (text, x, y, maxWidth) {\n\t},\n\n\tmeasureText: function (text) {\n\t\treturn { width: 0 };\n\t},\n\n\tcreateImageData: function (w, h) {\n\t\treturn { width: w, height: h };\n\t},\n\n\tgetImageData: function (x, y, w, h) {\n\t\treturn { width: w, height: h, data: [] };\n\t},\n\n\tputImageData: function (data, x, y) {\n\t},\n\n\tdrawImage: function (img, sx=0, sy=0, sw=null, sh=null, dx=null, dy=null, dw=null, dh=null, textureWidth=null, textureHeight=null, frameWidth=null, frameHeight=null) {\n\t},\n\n\tgetBoundingClientRect: function () {\n\t\treturn { left: 0, top: 0 };\n\t}\n};\n\n/**\n * \tInitializes the OpenGL ES context.\n */\nCanvas.prototype.initGl = function ()\n{\n\tlet gl = this.gl;\n\n\t/**\n\t * \tCreate the frame-wrap shader program.\n\t */\n\tthis.glFWrapProgram = new ShaderProgram('fwrap');\n\n\tnew Shader ('fwrap-vert', Shader.Type.VERTEX,\n\t`\n\t\tuniform mat3 m_transform;\n\t\tuniform mat3 m_quad;\n\t\tuniform mat3 m_texture;\n\t\tuniform vec4 v_resolution;\n\t\tuniform vec4 v_frame_size;\n\t\tuniform float f_depth;\n\n\t\tin vec3 location;\n\t\tout vec2 texcoords;\n\n\t\t//@use location2d, frameTexCoords\n\n\t\tvoid main () {\n\t\t\tgl_Position = location2d (location, f_depth);\n\t\t\ttexcoords = frameTexCoords(location);\n\t\t}\n\t`);\n\n\tnew Shader ('fwrap-frag', Shader.Type.FRAGMENT,\n\t`\n\t\tuniform sampler2D texture0;\n\t\tuniform vec4 v_frame_size;\n\t\tuniform float f_alpha;\n\n\t\tin vec2 texcoords;\n\t\tout vec4 color;\n\n\t\t//@use frameTex\n\n\t\tvoid main () {\n\t\t\tcolor = frameTex(texcoords) * f_alpha;\n\t\t\tif (color.a == 0.0) discard;\n\t\t}\n\t`);\n\n\t/**\n\t * \tCreate the default shader program.\n\t */\n\tthis.glDefaultProgram = new ShaderProgram('def');\n\n\tnew Shader ('def-vert', Shader.Type.VERTEX,\n\t`\n\t\tuniform mat3 m_transform;\n\t\tuniform mat3 m_quad;\n\t\tuniform mat3 m_texture;\n\t\tuniform vec4 v_resolution;\n\t\tuniform float f_depth;\n\n\t\tin vec3 location;\n\t\tout vec2 texcoords;\n\n\t\t//@use location2d\n\n\t\tvoid main ()\n\t\t{\n\t\t\tgl_Position = location2d (location, f_depth);\n\t\t\ttexcoords = vec2(m_texture * location);\n\t\t}\n\t`);\n\n\tnew Shader ('def-frag', Shader.Type.FRAGMENT,\n\t`\n\t\tuniform sampler2D texture0;\n\t\tuniform float f_alpha;\n\n\t\tin vec2 texcoords;\n\t\tout vec4 color;\n\n\t\tvoid main() {\n\t\t\tcolor = texture(texture0, texcoords) * f_alpha;\n\t\t\tif (color.a == 0.0) discard;\n\t\t}\n\t`);\n\n\t/**\n\t * \tCreate the frame buffer blit shader program.\n\t */\n\tthis.glBlitProgram = new ShaderProgram('blit');\n\n\tnew Shader ('blit-vert', Shader.Type.VERTEX,\n\t`\n\t\tuniform vec4 v_resolution;\n\t\tuniform mat3 m_quad;\n\t\tuniform mat3 m_texture;\n\n\t\tin vec3 location;\n\t\tout vec2 texcoords;\n\n\t\t//@use snorm\n\n\t\tvoid main() {\n\t\t\tgl_Position = vec4(snorm(vec2(m_quad * location) / v_resolution.xy), 0.0, 1.0);\n\t\t\ttexcoords = vec2(m_texture * location);\n\t\t}\n\t`);\n\n\tnew Shader ('blit-frag', Shader.Type.FRAGMENT,\n\t`\n\t\tuniform sampler2D texture0;\n\t\tin vec2 texcoords;\n\t\tout vec4 color;\n\n\t\tvoid main() {\n\t\t\tcolor = texture(texture0, texcoords);\n\t\t}\n\t`);\n\n\t/* ****** */\n\tthis.glDefaultProgram.attach('def-vert');\n\tthis.glDefaultProgram.attach('def-frag');\n\n\tthis.glFWrapProgram.attach('fwrap-vert');\n\tthis.glFWrapProgram.attach('fwrap-frag');\n\n\tthis.glBlitProgram.attach('blit-vert');\n\tthis.glBlitProgram.attach('blit-frag');\n\n\tthis.glDefaultProgram.link();\n\tthis.glFWrapProgram.link();\n\tthis.glBlitProgram.link();\n\n\tif (!this.glDefaultProgram.getStatus())\n\t\tthrow new Error (this.glDefaultProgram.getAllErrors());\n\n\tif (!this.glFWrapProgram.getStatus())\n\t\tthrow new Error (this.glFWrapProgram.getAllErrors());\n\n\tif (!this.glBlitProgram.getStatus())\n\t\tthrow new Error (this.glBlitProgram.getAllErrors());\n\n\tthis.setShaderProgram(ShaderProgram.get('def'));\n\n\t/**\n\t * \tCreate the vertex buffer.\n\t */\n\tthis.vao0 = gl.createVertexArray();\n\tgl.bindVertexArray(this.vao0);\n\n\tglx.createBufferFrom([ 0.0, 0.0, 1.0,  0.0, 1.0, 1.0,  1.0, 0.0, 1.0,  1.0, 1.0, 1.0 ], glx.BufferTarget.ARRAY_BUFFER, glx.BufferUsage.STATIC_DRAW);\n\n\tgl.vertexAttribPointer(this.shaderProgram.getAttribLocation('location'), 3, gl.FLOAT, gl.FALSE, 3*Float32Array.BYTES_PER_ELEMENT, 0*Float32Array.BYTES_PER_ELEMENT);\n\tgl.enableVertexAttribArray(this.shaderProgram.getAttribLocation('location'));\n\n\t/**\n\t * \tSetup initial GL configuration.\n\t */\n\tgl.clearColor (0.0, 0.0, 0.0, 1.0);\n\n\tgl.enable (gl.DEPTH_TEST);\n\tgl.clearDepth (0.0);\n\tgl.depthFunc (gl.GEQUAL);\n\n\tgl.disable(gl.DITHER);\n\n\t// pre-multiplied blending\n\tgl.enable (gl.BLEND);\n\tgl.pixelStorei (gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\n\tgl.blendEquationSeparate (gl.FUNC_ADD, gl.FUNC_ADD);\n\tgl.blendFunc (gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n\n\t/**\n\t * \tSetup frame buffer.\n\t */\n\n\t/* *** */\n\tthis.m_quad = new Float32Array(9).fill(0);\n\tthis.m_texture = new Float32Array(9).fill(0);\n\tthis.v_resolution = new Float32Array(4).fill(0);\n\tthis.zvalue = 0;\n\n\tMatrix.loadIdentity(this.m_quad);\n\tMatrix.loadIdentity(this.m_texture);\n\n\t// drawImage (Image img, float sx, float sy, float sw, float sh, float dx, float dy, float dw, float dh, float textureWidth, float textureHeight, float frameWidth, float frameHeight);\n\tthis.drawImage = function (img, sx, sy, sw, sh, dx, dy, dw, dh, textureWidth=null, textureHeight=null, frameWidth=null, frameHeight=null)\n\t{\n\t\tif (!img.textureId)\n\t\t\treturn;\n\n\t\tlet gl = this.gl;\n\t\tlet program = this.shaderProgram;\n\n\t\tif (textureWidth === null)\n\t\t{\n\t\t\ttextureWidth = img.width;\n\t\t\ttextureHeight = img.height;\n\t\t}\n\n\t\tif (frameWidth === null)\n\t\t{\n\t\t\tframeWidth = img.targetWidth;\n\t\t\tframeHeight = img.targetHeight;\n\t\t}\n\n\t\tprogram.uniform4fv ('v_resolution', this.v_resolution);\n\t\tprogram.uniform1f ('f_time', globals.time);\n\t\tprogram.uniform1f ('f_scale', this._globalScale);\n\t\tprogram.uniform1f ('f_alpha', this._alpha);\n\t\tprogram.uniform1f ('f_depth', this.zvalue);\n\n\t\tif (this.activeTextureId !== img.textureId || this.activeShader !== program)\n\t\t{\n\t\t\tgl.activeTexture (gl.TEXTURE0);\n\t\t\tgl.bindTexture (gl.TEXTURE_2D, img.textureId);\n\n\t\t\tprogram.uniform1i ('texture0', 0);\n\t\t\tprogram.uniform4f ('v_frame_size', frameWidth*img.rscale/textureWidth, frameHeight*img.rscale/textureHeight, frameWidth, frameHeight);\n\n\t\t\tthis.activeTextureId = img.textureId;\n\t\t\tthis.activeShader = program;\n\t\t}\n\n\t\tthis.m_quad[0] = dw;\n\t\tthis.m_quad[4] = dh;\n\t\tthis.m_quad[6] = dx;\n\t\tthis.m_quad[7] = dy;\n\n\t\tthis.m_texture[0] = sw / textureWidth;\n\t\tthis.m_texture[4] = sh / textureHeight;\n\t\tthis.m_texture[6] = sx / textureWidth;\n\t\tthis.m_texture[7] = sy / textureHeight;\n\n\t\tgl.uniformMatrix3fv (program.getUniformLocation('m_transform'), false, this.transform.data);\n\t\tgl.uniformMatrix3fv (program.getUniformLocation('m_quad'), false, this.m_quad);\n\t\tgl.uniformMatrix3fv (program.getUniformLocation('m_texture'), false, this.m_texture);\n\n\t\tgl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\t};\n\n\t// TODO test if this still works\n\t// drawRect (float x, float y, float w, float h, Image img=null);\n\tthis.drawRect = function (x, y, w, h, img=null)\n\t{\n\t\tlet gl = this.gl;\n\t\tlet program = this.shaderProgram;\n\n\t\tprogram.uniform4fv ('v_resolution', this.v_resolution);\n\t\tprogram.uniform1f ('f_time', globals.time);\n\t\tprogram.uniform1f ('f_scale', this._globalScale);\n\t\tprogram.uniform1f ('f_alpha', this._alpha);\n\n\t\tthis.activeTextureId = null;\n\n\t\tthis.m_quad[0] = w;\n\t\tthis.m_quad[4] = h;\n\t\tthis.m_quad[6] = x;\n\t\tthis.m_quad[7] = y;\n\n\t\tthis.m_texture[0] = 1.0;\n\t\tthis.m_texture[4] = 1.0;\n\t\tthis.m_texture[6] = 0.0;\n\t\tthis.m_texture[7] = 0.0;\n\n\t\tgl.uniformMatrix3fv (program.getUniformLocation('m_transform'), false, this.transform.data);\n\t\tgl.uniformMatrix3fv (program.getUniformLocation('m_quad'), false, this.m_quad);\n\t\tgl.uniformMatrix3fv (program.getUniformLocation('m_texture'), false, this.m_texture);\n\t\tgl.uniform1f (program.getUniformLocation('f_depth'), this.zvalue);\n\t\tgl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\t};\n};\n\n/**\n * Prepares an image to use it on the canvas.\n * !prepareImage (image: HTMLImageElement) : void;\n */\nCanvas.prototype.prepareImage = function (image)\n{\n\t// REVIEW : ensure the properties from image aren't overwritten by `mutate`.\n\t// TODO : optimize this area or remove the method\n\tClass.mutate(Texture, image, { width: image.width, height: image.height }).upload(image);\n};\n\n/**\n * Creates a new texture of the specified size.\n * !createTexture (width: number, height: number, filter?: Texture.FilterType, mipmap?: number) : Texture;\n */\nCanvas.prototype.createTexture = function (width, height, filter='NEAREST', mipmap=0)\n{\n\treturn new Texture (width, height).setFilter(filter).setMipmap(mipmap).allocate();\n};\n\n/**\n * \tApplies the current config to the canvas (usually called after a reset on the canvas).\n */\nCanvas.prototype.applyConfig = function ()\n{\n\tif (this.antialias == false)\n\t{\n\t\tif (this.context != null)\n\t\t\tthis.context.imageSmoothingEnabled = false;\n\n\t\tthis.elem.style.imageRendering = 'crisp-edges';\n\t}\n\telse\n\t{\n\t\tif (this.context != null)\n\t\t\tthis.context.imageSmoothingEnabled = true;\n\n\t\tthis.elem.style.imageRendering = 'auto';\n\t}\n};\n\n/**\n * \tDisposes the resources used by the canvas. The HTMLCanvasElement will also be removed from the document.\n */\nCanvas.prototype.dispose = function ()\n{\n\tif (this.elem.parentNode)\n\t\tthis.elem.parentNode.removeChild (this.elem);\n\n\tthis.matrixStack.free();\n\tthis.alphaStack.free();\n\tthis.depthFlagStack.free();\n\tthis.shaderProgramStack.free();\n\n\tthis.matr = null;\n\tthis.context = null;\n\tthis.elem = null;\n};\n\n/**\n * \tSets the default background color of the canvas. Does not cause a canvas clear.\n * \t!setBackground (color: string) : void;\n */\nCanvas.prototype.setBackground = function (color)\n{\n\tthis.elem.style.background = color;\n\tthis.backgroundColor = color;\n\n\tif (this.gl !== null)\n\t{\n\t\tif (color.length != 7)\n\t\t\tthrow new Error ('Canvas.setBackground: color parameter should be CSS-style hex-rgb with 6 digits.');\n\n\t\tlet r = parseInt(color.substr(1,2), 16) / 255.0;\n\t\tlet g = parseInt(color.substr(3,2), 16) / 255.0;\n\t\tlet b = parseInt(color.substr(5,2), 16) / 255.0;\n\n\t\tthis.gl.clearColor (r, g, b, 1.0);\n\t}\n};\n\n/**\n * \tSets the canvas size.\n * \t!resize (width: number, height: number) : Canvas;\n */\nCanvas.prototype.resize = function (width, height)\n{\n\tlet rect = this.elem.getBoundingClientRect();\n\n\tif (!width) width = rect.width;\n\tif (!height) height = rect.height;\n\n\tthis.elem.width = width;\n\tthis.elem.height = height;\n\n\tthis.width = this.elem.width;\n\tthis.height = this.elem.height;\n\n\tthis._width = int(this.width / this._globalScale);\n\tthis._height = int(this.height / this._globalScale);\n\n\tlet gl = this.gl;\n\tif (gl != null)\n\t{\n\t\tgl.enable (gl.SCISSOR_TEST);\n\t\tgl.scissor (0, 0, this.width, this.height);\n\t\tgl.viewport (0, 0, this.width, this.height);\n\n\t\tif (this.v_resolution)\n\t\t{\n\t\t\t//violet:hardware scaling\n\t\t\t//this.v_resolution[0] = this._width;\n\t\t\t//this.v_resolution[1] = this._height;\n\n\t\t\tthis.v_resolution[0] = this.width;\n\t\t\tthis.v_resolution[1] = this.height;\n\n\t\t\tthis.v_resolution[2] = this.width;\n\t\t\tthis.v_resolution[3] = this.height;\n\t\t}\n\t}\n\n\tthis.applyConfig();\n\treturn this;\n};\n\n/**\n * \tSets the global canvas scale.\n * \t!globalScale (value: number) : Canvas;\n */\nCanvas.prototype.globalScale = function (value)\n{\n\tthis._globalScale = value;\n\n\tthis._width = int(this.width / this._globalScale);\n\tthis._height = int(this.height / this._globalScale);\n\n\tthis.loadIdentity();\n\n\t//violet:hardware scaling\n\t//if (this.gl === null)\n\t\tthis.scale(value, value);\n\n\treturn this;\n};\n\n/**\n * \tSets the flipped status of the canvas, that is, if the canvas coordinates are flipped (i.e. `xy` is now `yx`).\n * \t!flipped (value: boolean) : Canvas;\n */\nCanvas.prototype.flipped = function (value)\n{\n\tif (value)\n\t{\n\t\tthis._width = int(this.height / this._globalScale);\n\t\tthis._height = int(this.width / this._globalScale);\n\t}\n\telse\n\t{\n\t\tthis._width = int(this.width / this._globalScale);\n\t\tthis._height = int(this.height / this._globalScale);\n\t}\n\n\tif (this.gl != null && this.v_resolution)\n\t{\n\t\tthis.v_resolution[0] = this.width;\n\t\tthis.v_resolution[1] = this.height;\n\n\t\tthis.v_resolution[2] = value ? this.height : this.width;\n\t\tthis.v_resolution[3] = value ? this.width : this.height;\n\t}\n\n\tthis.isFlipped = value;\n\treturn this;\n};\n\n/**\n * \tSaves the clip state of the canvas. Works only in GL mode.\n * \t!pushClip() : Canvas;\n */\nCanvas.prototype.pushClip = function ()\n{\n\treturn this;\n};\n\n/**\n * \tRestores the clip state of the canvas. Works only in GL mode.\n * \t!popClip() : Canvas;\n */\nCanvas.prototype.popClip = function ()\n{\n\tif (this.gl != null)\n\t\tthis.gl.scissor(0, 0, this.width, this.height);\n\n\treturn this;\n};\n\n/**\n * \tReturns the image on the canvas as a string in DATA-URI format.\n * \t!toDataUrl (mime: string, params?: object) : string;\n */\nCanvas.prototype.toDataUrl = function (mime='image/png', params=null)\n{\n\treturn this.elem.toDataURL (mime, params);\n};\n\n/**\n * \tReturns the image as a Base-64 encoded PNG string.\n * \t!toPngBase64() : string;\n */\nCanvas.prototype.toPngBase64 = function ()\n{\n\treturn this.elem.toDataURL(\"image/png\").substr(22);\n};\n\n/**\n * \tSets or returns an attribute of the canvas context.\n */\nCanvas.prototype._contextAttribute = function (name, value=null)\n{\n\tif (!this.context) return;\n\n\tif (value !== null)\n\t{\n\t\tthis.context[name] = value;\n\t\treturn this;\n\t}\n\n\treturn this.context[name];\n};\n\n/**\n * \tSets the fill style.\n * \t!fillStyle (value: string) : Canvas;\n */\n/**\n * \tReturns the current fill style.\n * \t!fillStyle () : string;\n */\nCanvas.prototype.fillStyle = function (value)\n{\n\treturn this._contextAttribute (\"fillStyle\", value);\n};\n\n/**\n * \tSets the stroke style.\n * \t!strokeStyle (value: string) : Canvas;\n */\n/**\n * \tReturns the current strroke style.\n * \t!strokeStyle () : string;\n */\nCanvas.prototype.strokeStyle = function (value)\n{\n\treturn this._contextAttribute (\"strokeStyle\", value);\n};\n\n/**\n * \tSets the line cap style (Possible values are `butt`, `round`, or `square`. `butt` is default).\n * \t!lineCap (value: string) : Canvas;\n */\n/**\n * \tReturns the current line cap style.\n * \t!lineCap() : string;\n */\nCanvas.prototype.lineCap = function (value)\n{\n\treturn this._contextAttribute (\"lineCap\", value);\n};\n\n// violet\n\n/*\n**\tSets or returns the current line join style (bevel, round, miter. miter is default).\n**\n**\t>> Canvas lineJoin (string value);\n**\t>> string lineJoin ();\n*/\n\nCanvas.prototype.lineJoin = function (value)\n{\n\treturn this._contextAttribute (\"lineJoin\", value);\n};\n\n\n/*\n**\tSets or returns the current line width value (default 1).\n**\n**\t>> Canvas lineWidth (float value);\n**\t>> float lineWidth ();\n*/\n\nCanvas.prototype.lineWidth = function (value)\n{\n\treturn this._contextAttribute (\"lineWidth\", value);\n};\n\n\n/*\n**\tSets or returns the current miter limit value (default 10).\n**\n**\t>> Canvas miterLimit (float value);\n**\t>> float miterLimit ();\n*/\n\nCanvas.prototype.miterLimit = function (value)\n{\n\treturn this._contextAttribute (\"miterLimit\", value);\n};\n\n\n/*\n**\tSets or returns the current shadow color value (default black).\n**\n**\t>> Canvas shadowColor (string value);\n**\t>> string shadowColor ();\n*/\n\nCanvas.prototype.shadowColor = function (value)\n{\n\treturn this._contextAttribute (\"shadowColor\", value);\n};\n\n\n/*\n**\tSets or returns the current shadow X offset (default 0).\n**\n**\t>> Canvas shadowOffsetX (float value);\n**\t>> float shadowOffsetX ();\n*/\n\nCanvas.prototype.shadowOffsetX = function (value)\n{\n\treturn this._contextAttribute (\"shadowOffsetX\", value);\n};\n\n\n/*\n**\tSets or returns the current shadow Y offset (default 0).\n**\n**\t>> Canvas shadowOffsetY (float value);\n**\t>> float shadowOffsetY ();\n*/\n\nCanvas.prototype.shadowOffsetY = function (value)\n{\n\treturn this._contextAttribute (\"shadowOffsetY\", value);\n};\n\n\n/*\n**\tSets or returns the current shadow blue value (default 0).\n**\n**\t>> Canvas shadowBlur (string value);\n**\t>> string shadowBlur ();\n*/\n\nCanvas.prototype.shadowBlur = function (value)\n{\n\treturn this._contextAttribute (\"shadowBlur\", value);\n};\n\n\n/*\n**\tSets or returns the current font settings.\n**\n**\t>> Canvas font (string value);\n**\t>> string font ();\n*/\n\nCanvas.prototype.font = function (value)\n{\n\treturn this._contextAttribute (\"font\", value);\n};\n\n\n/*\n**\tSets or returns the current text align settings (start, end, left, right, center).\n**\n**\t>> Canvas textAlign (string value);\n**\t>> string textAlign ();\n*/\n\nCanvas.prototype.textAlign = function (value)\n{\n\treturn this._contextAttribute (\"textAlign\", value);\n};\n\n\n/*\n**\tSets or returns the current text base line settings (alphabetic, bottom, hanging, ideographic, middle, top. Alphabetic is default).\n**\n**\t>> Canvas textBaseline (string value);\n**\t>> string textBaseline ();\n*/\n\nCanvas.prototype.textBaseline = function (value)\n{\n\treturn this._contextAttribute (\"textBaseline\", value);\n};\n\n\n/*\n**\tSets or returns the current global alpha value.\n**\n**\t>> Canvas globalAlpha (float value);\n**\t>> float globalAlpha ();\n*/\n\nCanvas.prototype.globalAlpha = function (value=null)\n{\n\tif (value !== null)\n\t\tthis._alpha = value;\n\telse\n\t\treturn this._alpha;\n\n\treturn this.alpha(1.0);\n};\n\n\n/*\n**\tSets or returns the current global composite operation value (source-atop, source-in, source-out, source-over, destination-atop,\n**\tdestination-in, destination-out, destination-over, lighter, copy, xor).\n**\n**\t>> Canvas globalCompositeOperation (string value);\n**\t>> string globalCompositeOperation ();\n*/\nCanvas.prototype.globalCompositeOperation = function (value)\n{\n\treturn this._contextAttribute (\"globalCompositeOperation\", value);\n};\n\n/*\n**\tUpdates the underlying canvas or gl transformation matrix. \n**\n**\tCanvas updateTransform();\n*/\nCanvas.prototype.updateTransform = function()\n{\n\tthis.setTransform (this.matr.data[0], this.matr.data[1], this.matr.data[3], this.matr.data[4], this.matr.data[6], this.matr.data[7]);\n\treturn this;\n};\n\n/*\n**\tSets the canvas or gl transformation matrix to the given one.\n**\n**\tCanvas setTransform (float a, float b, float c, float d, float e, float f)\n*/\nCanvas.prototype.setTransform = function (a, b, c, d, e, f)\n{\n\tif (this.context === null)\n\t{\n\t\tthis.transform.data[0] = a;\n\t\tthis.transform.data[1] = b;\n\t\tthis.transform.data[2] = 0;\n\t\tthis.transform.data[3] = c;\n\t\tthis.transform.data[4] = d;\n\t\tthis.transform.data[5] = 0;\n\t\tthis.transform.data[6] = int(e);//Math.ceil(e);\n\t\tthis.transform.data[7] = int(f);//Math.ceil(f);\n\t\tthis.transform.data[8] = 1;\n\n\t\treturn this;\n\t}\n\n\t//this.context.setTransform (a, b, c, d, Math.ceil(e), Math.ceil(f));\n\tthis.context.setTransform (a, b, c, d, int(e), int(f));\n\treturn this;\n};\n\n/*\n**\tDraws a filled rectangle on the canvas.\n**\n**\tCanvas fillRect (float x, float y, float w, float h)\n*/\nCanvas.prototype.fillRect = function (x, y, w, h)\n{\n\tthis.context.fillRect (x, y, w, h);\n\treturn this;\n};\n\n/*\n**\tDraws an stroked rectangle on the canvas.\n**\n**\tCanvas strokeRect (float x, float y, float w, float h)\n*/\nCanvas.prototype.strokeRect = function (x, y, w, h)\n{\n\tthis.context.strokeRect (x, y, w, h);\n\treturn this;\n};\n\n/*\n**\tClears a rectangle on the canvas. All pixels will be erased.\n**\n**\tCanvas clearRect (float x, float y, float w, float h)\n*/\nCanvas.prototype.clearRect = function (x, y, w, h)\n{\n\tthis.context.clearRect (x, y, w, h);\n\treturn this;\n};\n\n/*\n**\tStarts a new path. Any previous path points will be cleared.\n**\n**\tCanvas beginPath()\n*/\nCanvas.prototype.beginPath = function ()\n{\n\tthis.context.beginPath ();\n\treturn this;\n};\n\n/*\n**\tCreates a new point in the current path.\n**\n**\tCanvas moveTo (float x, float y)\n*/\nCanvas.prototype.moveTo = function (x, y)\n{\n\tthis.context.moveTo (x, y);\n\treturn this;\n};\n\n/*\n**\tCreates a new point from the first path point to the last, and finishes the path.\n**\n**\tCanvas closePath()\n*/\nCanvas.prototype.closePath = function ()\n{\n\tthis.context.closePath ();\n\treturn this;\n};\n\n/*\n**\tDraws a line from the last point on the path to the given point.\n**\n**\tCanvas lineTo (float x, float y)\n*/\nCanvas.prototype.lineTo = function (x, y)\n{\n\tthis.context.lineTo (x, y);\n\treturn this;\n};\n\n/*\n**\tCreates a hollow rectangle path on the canvas for subsequent stroke or fill.\n**\n**\tCanvas rect (float x, float y, float w, float h)\n*/\nCanvas.prototype.rect = function (x, y, w, h)\n{\n\tthis.context.rect (x, y, w, h);\n\treturn this;\n};\n\n/*\n**\tFills the active path with the current fill style or with the one given in the value parameter.\n**\n**\tCanvas fill (string value=null)\n*/\nCanvas.prototype.fill = function (value=null)\n{\n\tif (value) this.fillStyle (value);\n\tthis.context.fill ();\n\treturn this;\n};\n\n/*\n**\tStrokes the active path with the current stroke style or with the one given in the value parameter.\n**\n**\tCanvas stroke (string value=null)\n*/\nCanvas.prototype.stroke = function (value=null)\n{\n\tif (value) this.strokeStyle (value);\n\tthis.context.stroke ();\n\treturn this;\n};\n\n/*\n**\tClips a region of the canvas so that only the region will be used for drawing. Coordinates must be in logical screen space.\n**\n**\tCanvas clip()\n*/\nCanvas.prototype.clip = function (x, y, width, height)\n{\n\tif (this.gl !== null)\n\t{\n\t\tx *= this._globalScale;\n\t\ty *= this._globalScale;\n\t\twidth *= this._globalScale;\n\t\theight *= this._globalScale;\n\n\t\tif (this.isFlipped)\n\t\t\tthis.gl.scissor(this.width-y-height-1, this.height-x-width-1, height, width);\n\t\telse\n\t\t\tthis.gl.scissor(x, this.height-y-height-1, width, height);\n\t}\n\n\treturn this;\n};\n\n/*\n**\tAdds points of a quadratic curve to the active path. A control points and one reference point must be provided.\n**\n**\tCanvas quadraticCurveTo (float cpx, float cpy, float x, float y)\n*/\nCanvas.prototype.quadraticCurveTo = function (cpx, cpy, x, y)\n{\n\tthis.context.quadraticCurveTo (cpx, cpy, x, y);\n\treturn this;\n};\n\n/*\n**\tAdds points of a bezier curve to the active path. Two control points and one reference point must be provided.\n**\n**\tCanvas bezierCurveTo (float cx1, float cy1, float cx2, float cy2, float x, float y)\n*/\nCanvas.prototype.bezierCurveTo = function (cx1, cy1, cx2, cy2, x, y)\n{\n\tthis.context.bezierCurveTo (cx1, cy1, cx2, cy2, x, y);\n\treturn this;\n};\n\n/*\n**\tAdds points of an arc the the active path. Used to draw a circle of part of it.\n**\n**\tCanvas arc (float x, float y, float r, float sA, float eA, float cw)\n*/\nCanvas.prototype.arc = function (x, y, r, sA, eA, cw)\n{\n\tthis.context.arc (x, y, r, sA, eA, cw);\n\treturn this;\n};\n\n/*\n**\tAdds points of an arc to the active path. Used to create an arc between two points.\n**\n**\tCanvas arcTo (float x1, float y1, float x2, float y2, float r)\n*/\nCanvas.prototype.arcTo = function (x1, y1, x2, y2, r)\n{\n\tthis.context.arcTo (x1, y1, x2, y2, r);\n\treturn this;\n};\n\n/*\n**\tDraws filled text on the canvas with the active font, and fillStyle properties.\n**\n**\tCanvas fillText (string text, float x, float y, float maxWidth=1000)\n*/\nCanvas.prototype.fillText = function (text, x, y, maxWidth=1000)\n{\n\tthis.context.fillText (text, x, y, maxWidth);\n\treturn this;\n};\n\n/*\n**\tDraws stroked text on the canvas with the active font, and fillStyle properties.\n**\n**\tCanvas strokeText (string text, float x, float y, float maxWidth=1000)\n*/\nCanvas.prototype.strokeText = function (text, x, y, maxWidth=1000)\n{\n\tthis.context.strokeText (text, x, y, maxWidth);\n\treturn this;\n};\n\n\n/*\n**\tMeasures the width of the given text using active font properties.\n**\n**\tfloat measureText (string text)\n*/\nCanvas.prototype.measureText = function (text)\n{\n\treturn this.context.measureText(text).width;\n};\n\n\n/*\n**\tReturns a new image data object with the specified size.\n**\n**\tImageData createImageData (float w, float h)\n*/\nCanvas.prototype.createImageData = function (w, h)\n{\n\treturn this.context.createImageData (w, h);\n};\n\n\n/*\n**\tReturns an image data object with the pixels of a rectangular area of the canvas.\n**\n**\tImageData getImageData (float x, float y, float w, float h)\n*/\nCanvas.prototype.getImageData = function (x, y, w, h)\n{\n\treturn this.context.getImageData (x, y, w, h);\n};\n\n\n/*\n**\tPuts image data on the canvas at the specified location.\n**\n**\tCanvas putImageData (ImageData data, float x, float y)\n*/\nCanvas.prototype.putImageData = function (data, x, y)\n{\n\tthis.context.putImageData (data, x, y);\n\treturn this;\n};\n\n\n/*\n**\tDraws an image on the canvas.\n**\n**\tCanvas drawImage (Image img, float x, float y)\n**\tCanvas drawImage (Image img, float x, float y, float w, float h)\n**\tCanvas drawImage (Image img, float sx, float sy, float sw, float sh, float dx, float dy, float dw, float dh)\n*/\nCanvas.prototype.drawImage = function (img, sx=0, sy=0, sw=null, sh=null, dx=null, dy=null, dw=null, dh=null)\n{\n\tif (sw === null)\n\t{\n\t\tthis.context.drawImage (img, int(sx), int(sy));\n\t}\n\telse if (dx === null)\n\t{\n\t\tthis.context.drawImage (img, int(sx), int(sy), int(sw), int(sh));\n\t}\n\telse\n\t{\n\t\tlet a3 = int(sw);\n\t\tlet a4 = int(sh);\n\t\tif (!a3 || !a4) return this;\n\n\t\tlet a7 = int(dw);\n\t\tlet a8 = int(dh);\n\t\tif (!a7 || !a8) return this;\n\n\t\tthis.context.drawImage (img, int(sx), int(sy), a3, a4, int(dx), int(dy), a7, a8);\n\t}\n\n\treturn this;\n};\n\n\n/*\n**\tClears the entire canvas. If the backgroundColor parameter is set the canvas will be cleared manually by using\n**\tthe fillRect method.\n**\n**\tCanvas clear (string backgroundColor)\n**\tCanvas clear ()\n*/\n\nCanvas.prototype.clear = function (backgroundColor=null)\n{\n\tif (this.gl != null)\n\t{\n\t\tthis.gl.clear(this.gl.STENCIL_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT | this.gl.COLOR_BUFFER_BIT);\n\t\tthis.activeTextureId = null;\n\t\treturn this;\n\t}\n\n\tif (backgroundColor)\n\t{\n\t\tthis.globalCompositeOperation(\"source-over\").globalAlpha(1.0).fillStyle(backgroundColor !== true ? backgroundColor : this.backgroundColor).fillRect(0, 0, this._width, this._height);\n\t}\n\telse\n\t{\n\t\tthis.elem.width = this.width;\n\t\tthis.applyConfig();\n\t}\n\n\tthis.updateTransform();\n\treturn this;\n};\n\n\n/*\n**\tIndicates that rendering is about to start. Used only in GL mode.\n*/\nCanvas.prototype.start = function ()\n{\n};\n\n/*\n**\tIndicates that rendering has ended. Used only in GL mode.\n*/\nCanvas.prototype.end = function ()\n{\n};\n\n/*\n**\tIndicates that rendering has been completed and any flush operation should be executed. Used only in GL mode.\n*/\nCanvas.prototype.flush = function ()\n{\n\t//let gl = this.gl;\n\t//if (gl === null) return;\n\n\t//gl.colorMask (false, false, false, true);\n\t//gl.clear (gl.COLOR_BUFFER_BIT);\n\t//gl.colorMask (true, true, true, true);\n\n\t// NOTE Add gl.flush() if not using RAF.\n};\n\n/**\n * Blits the specified texture to the active framebuffer.\n */\nCanvas.prototype.blit = function (textureId, width, height, shaderProgram=null)\n{\n\tlet gl = this.gl;\n\tif (gl === null) return;\n\n\tshaderProgram = shaderProgram || this.glBlitProgram;\n\n\tthis.setShaderProgram(shaderProgram);\n\tgl.disable (gl.DEPTH_TEST);\n\n\t\tgl.activeTexture (gl.TEXTURE0);\n\t\tgl.bindTexture (gl.TEXTURE_2D, textureId);\n\t\tshaderProgram.uniform1i ('texture0', 0);\n\n\t\tshaderProgram.uniform4fv ('v_resolution', this.v_resolution);\n\t\tshaderProgram.uniform1f ('f_time', globals.time);\n\t\tshaderProgram.uniform1f ('f_scale', this._globalScale);\n\t\tshaderProgram.uniform1f ('f_alpha', this._alpha);\n\n\t\tthis.m_quad[0] = this.width;\n\t\tthis.m_quad[4] = this.height;\n\t\tthis.m_quad[6] = 0;\n\t\tthis.m_quad[7] = 0;\n\n\t\tthis.m_texture[0] = this.width / width;\n\t\tthis.m_texture[4] = this.height / height;\n\t\tthis.m_texture[6] = 0.0;\n\t\tthis.m_texture[7] = 0.0;\n\n\t\tgl.uniformMatrix3fv (shaderProgram.getUniformLocation('m_quad'), false, this.m_quad);\n\t\tgl.uniformMatrix3fv (shaderProgram.getUniformLocation('m_texture'), false, this.m_texture);\n\t\tgl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\n\tthis.setShaderProgram(ShaderProgram.get('def'));\n\tgl.enable (gl.DEPTH_TEST);\n};\n\n/*\n**\tResets the context drawing properties to their initial values.\n**\n**\tCanvas reset (bool clearPath=false);\n*/\nCanvas.prototype.reset = function (clearPath=false)\n{\n\tthis.fillStyle(\"#000000\").strokeStyle(\"#000000\").lineCap(\"butt\").lineJoin(\"miter\")\n\t.lineWidth(\"1\").miterLimit(\"10\").shadowColor(\"#000000\").shadowOffsetX(\"0\")\n\t.shadowOffsetY(\"0\").shadowBlur(\"0\").globalAlpha(\"1.0\").globalCompositeOperation(\"source-over\");\n\n\tif (clearPath) this.beginPath().closePath();\n\n\treturn this;\n};\n\n/*\n**\tPushes the current transformation matrix into the matrix stack.\n*/\nCanvas.prototype.pushMatrix = function ()\n{\n\tthis.matrixStack.push(this.matr);\n\tthis.matr = this.matr.clone();\n\n\treturn this;\n};\n\n/*\n**\tPops a matrix from the matrix stack into the transformation matrix.\n*/\nCanvas.prototype.popMatrix = function ()\n{\n\tthis.matr.free();\n\tthis.matr = this.matrixStack.pop();\n\n\treturn this.updateTransform();\n};\n\n/*\n**\tSets or returns the relative alpha value for subsequent drawing operations.\n**\n**\t>> Canvas alpha (float value);\n**\t>> float alpha ();\n*/\n\nCanvas.prototype.alpha = function (value)\n{\n\tthis._alpha *= value;\n\n\tif (this.context && this.gl === null)\n\t\tthis.context.globalAlpha = this._alpha;\n\n\treturn this;\n};\n\n/*\n**\tPushes the current global alpha into the stack.\n*/\nCanvas.prototype.pushAlpha = function ()\n{\n\tthis.alphaStack.push (this.globalAlpha());\n\treturn this;\n};\n\n/*\n**\tPops an alpha from the stack into the global alpha.\n**\n**\t>> Canvas popAlpha();\n*/\nCanvas.prototype.popAlpha = function ()\n{\n\tthis.globalAlpha(this.alphaStack.pop());\n\treturn this;\n};\n\n/*\n**\tSets the depth-test flag.\n*/\nCanvas.prototype.setDepthFlag = function (value)\n{\n\tlet gl = this.gl;\n\tif (gl === null) return;\n\n\tif (value)\n\t{\n\t\tgl.enable (gl.DEPTH_TEST);\n\t\tthis._depthFlag = true;\n\t}\n\telse\n\t{\n\t\tgl.disable (gl.DEPTH_TEST);\n\t\tthis._depthFlag = false;\n\t}\n};\n\n/*\n**\tReturns the depth-test flag.\n*/\nCanvas.prototype.getDepthFlag = function ()\n{\n\treturn this._depthFlag;\n};\n\n/*\n**\tPushes the current depth-test flag into the depth flag stack. If a value is provided, the current flag will be pushed and set to the\n**\tgiven value only if they're different, when so, true will be returned.\n*/\nCanvas.prototype.pushDepthFlag = function (value=null)\n{\n\tif (value !== null)\n\t{\n\t\tvalue = !!value;\n\n\t\tif (value === this._depthFlag)\n\t\t\treturn false;\n\n\t\tthis.depthFlagStack.push(this._depthFlag);\n\t\tthis.setDepthFlag(value);\n\n\t\treturn true;\n\t}\n\n\tthis.depthFlagStack.push(this._depthFlag);\n};\n\n/*\n**\tPops the depth-test flag from the depth flag stack.\n*/\nCanvas.prototype.popDepthFlag = function ()\n{\n\tthis.setDepthFlag(this.depthFlagStack.pop());\n};\n\n/*\n**\tSets the active shader program.\n*/\nCanvas.prototype.setShaderProgram = function (program)\n{\n\tlet gl = this.gl;\n\tif (gl === null) return;\n\n\tthis.shaderProgram = program;\n\tthis.shaderProgram.activate();\n};\n\n/*\n**\tReturns the current shader program.\n*/\nCanvas.prototype.getShaderProgram = function ()\n{\n\treturn this.shaderProgram;\n};\n\n/*\n**\tPushes the current shader program into the stack. If a value is provided, the current shader program will be pushed and set to the\n**\tgiven one only if they're different, when so, true will be returned.\n*/\nCanvas.prototype.pushShaderProgram = function (program=null)\n{\n\tif (program !== null)\n\t{\n\t\tif (program === this.shaderProgram)\n\t\t\treturn false;\n\n\t\tthis.shaderProgramStack.push(this.shaderProgram);\n\t\tthis.setShaderProgram(program);\n\n\t\treturn true;\n\t}\n\n\tthis.shaderProgramStack.push(this.shaderProgram);\n};\n\n/*\n**\tPops the shader program from the stack.\n*/\nCanvas.prototype.popShaderProgram = function ()\n{\n\tthis.setShaderProgram(this.shaderProgramStack.pop());\n};\n\n\n/*\n**\tSets the transformation matrix to identity.\n**\n**\t>> Canvas loadIdentity();\n*/\n\nCanvas.prototype.loadIdentity = function ()\n{\n\tthis.matr.identity();\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tSets the transformation matrix to the specified one.\n**\n**\t>> Canvas loadMatrix (Matrix matr);\n*/\n\nCanvas.prototype.loadMatrix = function (matr)\n{\n\tthis.matr.set(matr);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tReturns the current transformation matrix, when `clone` is set to true, a cloned matrix will be returned.\n**\n**\t>> Matrix getMatrix(bool clone=false);\n*/\n\nCanvas.prototype.getMatrix = function (clone=false)\n{\n\treturn clone ? this.matr.clone() : this.matr;\n};\n\n\n/*\n**\tAppends a matrix to the current transformation matrix.\n**\n**\t>> Canvas appendMatrix (Matrix matr);\n*/\n\nCanvas.prototype.appendMatrix = function (matr)\n{\n\tthis.matr.append(matr);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tSets scaling factors for subsequent drawing operations. If the useNative is not set then scale with the current\n**\ttransformation matrix will be performed.\n**\n**\t>> Canvas scale (float sx, float sy, bool useNative=false);\n*/\n\nCanvas.prototype.scale = function (sx, sy, useNative=false)\n{\n\tif (useNative) {\n\t\tthis.context.scale (sx, sy);\n\t\treturn this;\n\t}\n\n\tthis.matr.scale (sx, sy);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tSets rotation factor for subsequent drawing operations. The angle is in radians. If useNative is not set\n**\tthen rotation with the transformation matrix will be used.\n**\n**\t>> Canvas rotate (float angle, bool useNative=false);\n*/\n\nCanvas.prototype.rotate = function (angle, useNative=false)\n{\n\tif (useNative) {\n\t\tthis.context.rotate (angle);\n\t\treturn this;\n\t}\n\n\tthis.matr.rotate(angle);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tMoves starting point to an specified location. If the useNative parameter is not set then translation with\n**\tthe transformation matrix will be done.\n**\n**\t>> Canvas translate (float x, float y, bool useNative=false);\n*/\n\nCanvas.prototype.translate = function (x, y, useNative=false)\n{\n\tif (useNative) {\n\t\tthis.context.translate(x, y);\n\t\treturn this;\n\t}\n\n\tthis.matr.translate(x, y);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tCreates a hollow ellipse path on the canvas for subsequent stroke or fill.\n**\n**\t>> Canvas ellipse (float x, float y, float w, float h);\n*/\n\nCanvas.prototype.ellipse = function (x, y, w, h)\n{\n\tvar ox = (w/2)*.5522848, oy = (h/2)*.5522848;\n\tvar xe = x+w-1, ye = y+h-1, xm = x+w/2, ym = y+h/2;\n\n\tthis.beginPath ().moveTo(x, ym);\n\tthis.bezierCurveTo (x, ym - oy, xm - ox, y, xm, y);\n\tthis.bezierCurveTo (xm + ox, y, xe, ym - oy, xe, ym);\n\tthis.bezierCurveTo (xe, ym + oy, xm + ox, ye, xm, ye);\n\tthis.bezierCurveTo (xm - ox, ye, x, ym + oy, x, ym);\n\tthis.closePath ();\n\n\treturn this;\n};\n\n\n/*\n**\tCreates a hollow circle path on the canvas for subsequent stroke or fill. If the stroke param is set the circle\n**\twill be drawn with the specified stroke color.\n**\n**\t>> Canvas circle (float x, float y, float r, string strokeColor);\n**\t>> Canvas circle (float x, float y, float r);\n*/\n\nCanvas.prototype.circle = function (x, y, r, stroke)\n{\n\tthis.beginPath();\n\tthis.arc(x, y, r, 0, 2*Math.PI);\n\tthis.closePath();\n\n\tif (stroke) this.stroke(stroke);\n\n\treturn this;\n};\n\n\n/*\n**\tDraws a line for subsequent stroke or fill. If the stroke param is set the line will be drawn with\n**\tthe specified stroke color.\n**\n**\t>> Canvas line (float x1, float y1, float x2, float y2, string strokeColor);\n**\t>> Canvas line (float x1, float y1, float x2, float y2);\n*/\n\nCanvas.prototype.line = function (x1, y1, x2, y2, stroke)\n{\n\tthis.beginPath();\n\tthis.moveTo(x1, y1);\n\tthis.lineTo(x2, y2);\n\tthis.closePath();\n\n\tif (stroke) this.stroke(stroke);\n\treturn this;\n};\n\n\n/*\n**\tAttaches internal listeners for mouse/pointer events on the canvas object, this is called automatically when\n**\tattaching handlers to the canvas. The actual handlers are added or removed using the addPointerHandler and\n**\tremovePointerHandler respectively.\n**\n**\t>> Canvas enablePointerEvents();\n*/\n\nCanvas.prototype.enablePointerEvents = function()\n{\n\tif (this.pointerHandler) return this;\n\n\tthis.pointerScale = { sx: 1, sy: 1 };\n\tthis.pointerOffset = { x: 0, y: 0 };\n\n\tvar _ = this;\n\n\tvar _evt =\n\t{\n\t\taction: '',\n\t\tbuttons: 0, lbuttons: 0,\n\t\tx: 0, y: 0,\n\n\t\tcontainedBy: function (x, y, w, h) {\n\t\t\treturn this.x >= x && this.x <= (x+w-1) && this.y >= y && this.y <= (y+h-1);\n\t\t}\n\t};\n\n\tthis.pointerHandlers = [];\n\n\tthis.pointerHandler = function (code, evt)\n\t{\n\t\tvar rect = this.elem.getBoundingClientRect();\n\n\t\t_evt.action = code;\n\t\t_evt.buttons = evt.buttons;\n\t\t_evt.x = _evt.rx = int(evt.clientX - rect.left);\n\t\t_evt.y = _evt.ry = int(evt.clientY - rect.top);\n\n\t\t_evt.x = ((_evt.x - _.pointerOffset.x) - 0.0*_.pointerScale.sx) / _.pointerScale.sx;\n\t\t_evt.y = ((_evt.y - _.pointerOffset.y) - 0.0*_.pointerScale.sy) / _.pointerScale.sy;\n\n\t\t_evt.dragging = false;\n\n\t\tif (_evt.buttons && !_evt.lbuttons)\n\t\t{\n\t\t\t_evt.sx = _evt.x;\n\t\t\t_evt.sy = _evt.y;\n\n\t\t\t_evt.ldx = _evt.ldy = 0;\n\t\t}\n\n\t\tif (_evt.buttons && _evt.lbuttons)\n\t\t{\n\t\t\t_evt.dragging = true;\n\n\t\t\t_evt.dx = _evt.x - _evt.sx;\n\t\t\t_evt.dy = _evt.y - _evt.sy;\n\t\t\t\n\t\t\t_evt.ddx = _evt.dx - _evt.ldx;\n\t\t\t_evt.ddy = _evt.dy - _evt.ldy;\n\n\t\t\t_evt.ldx = _evt.dx;\n\t\t\t_evt.ldy = _evt.dy;\n\t\t}\n\n\t\t_evt.lbuttons = _evt.buttons;\n\n\t\tfor (var i = 0; i < this.pointerHandlers.length; i++)\n\t\t{\n\t\t\tif (this.pointerHandlers[i][1] (_evt, this.pointerHandlers[i][2]) === false)\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tthis.elem.onmousedown = function(evt) {  _.pointerHandler('DOWN', evt); };\n\tthis.elem.onmouseup = function(evt) { _.pointerHandler('UP', evt); };\n\tthis.elem.onmousemove = function(evt) { _.pointerHandler('MOVE', evt); };\n\n\treturn this;\n};\n\n\n/*\n**\tSets the pointer scaling factors.\n**\n**\t>> Canvas setPointerScale (float sx, float sy);\n*/\n\nCanvas.prototype.setPointerScale = function (sx, sy)\n{\n\tthis.pointerScale = { sx: sx, sy: sy };\n\treturn this;\n};\n\n\n/*\n**\tSets the pointer offset that is applied after scaling.\n**\n**\t>> Canvas setPointerOffset (float x, float y);\n*/\n\nCanvas.prototype.setPointerOffset = function (x, y)\n{\n\tthis.pointerOffset = { x: x, y: y };\n\treturn this;\n};\n\n\n/*\n**\tAdds a pointer event handler, returns the handler reference id for later removal.\n**\n**\t>> string addPointerHandler (function callback, object context);\n**\t>> string addPointerHandler (function callback);\n*/\n\nCanvas.prototype.addPointerHandler = function (callback, context)\n{\n\tthis.enablePointerEvents();\n\n\tthis.pointerHandlers.push ([this.pointerHandlers.length+\"_\"+int(Math.random()*1e6), callback, context]);\n\n\treturn this.pointerHandlers[this.pointerHandlers.length-1][0];\n};\n\n\n/*\n**\tRemoves a previously attached pointer event handler.\n**\n**\t>> void removePointerHandler (string id);\n*/\n\nCanvas.prototype.removePointerHandler = function (id)\n{\n\tif (!this.pointerHandlers) return;\n\n\tfor (var i = 0; i < this.pointerHandlers.length; i++)\n\t{\n\t\tif (this.pointerHandlers[i][0] == id)\n\t\t{\n\t\t\tthis.pointerHandlers.splice(i, 1);\n\t\t\tbreak;\n\t\t}\n\t}\n};\n\n/**\n * \tExecutes the `draw` function on a new canvas of the specified width and height. Renders it into an image and runs the completed callback with the ready HTMLImageElement object.\n * \t!static renderImage (width: number, height: number, draw: (g: Canvas) => void, completed: (img: HTMLImageElement, url: string) => void) : void;\n */\nCanvas.renderImage = function (width, height, draw, completed)\n{\n\tlet g = new Canvas ({ hidden: true, width: width, height: height, antialias: System.options.antialias });\n\n\tdraw(g);\n\tlet url = g.toDataUrl();\n\n\tlet img = new Image();\n\timg.onload = () =>\n\t{\n\t\timg.filter = System.options.antialias ? 'LINEAR' : 'NEAREST';\n\t\timg.rscale = 1.0;\n\t\timg.targetWidth = width;\n\t\timg.targetHeight = height;\n\n\t\tSystem.renderer.prepareImage(img);\n\t\tcompleted(img, url);\n\t};\n\n\timg.src = url;\n\tg.dispose();\n};\n\n/**\n * Executes the `draw` function on a new canvas of the specified width and height. Renders it into an image and runs the completed callback with the ready HTMLImageElement object,\n * note that this function will generate mipmap images.\n * !static renderImageMipmap (levels: number, width: number, height: number, draw: (g: Canvas) => void, completed: (img: HTMLImageElement, url: string) => void) : void;\n */\nCanvas.renderImageMipmap = function (levels, width, height, draw, completed)\n{\n\tlet g = new Canvas ({ hidden: true, width: width, height: height, antialias: System.options.antialias });\n\n\tdraw(g);\n\tlet url = g.toDataUrl();\n\n\tlet img = new Image();\n\timg.onload = () =>\n\t{\n\t\timg.filter = System.options.antialias ? 'LINEAR' : 'NEAREST';\n\t\timg.rscale = 1.0;\n\t\timg.targetWidth = width;\n\t\timg.targetHeight = height;\n\t\timg.mipmap = levels;\n\n\t\tSystem.renderer.prepareImage(img);\n\t\tcompleted(img, url);\n\t};\n\n\timg.src = url;\n\tg.dispose();\n};\n\nexport default Canvas;\n","\nimport KeyCode from './keycode.js';\nimport List from '../utils/list.js';\nimport Linkable from '../utils/linkable.js';\nimport Timer from './timer.js';\nimport Canvas from './canvas.js';\nimport Log from './log.js';\nimport globals from './globals.js';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"./keycode\"]\n//![import \"../utils/list\"]\n//![import \"../utils/linkable\"]\n//![import \"./timer\"]\n//![import \"./canvas\"]\n//![import \"./globals\"]\n\nconst System = { };\n\n//!namespace System\n\n\t//:type DisplayOrientation = 'default'|'landscape'|'portrait'|'automatic'|'strict';\n\n\t//!enum KeyboardEventType\n\tSystem.KeyboardEventType = {\n\t\tKEY_DOWN: 0x001,\n\t\tKEY_UP: 0x002,\n\t\t//!KEY_DOWN\n\t\t//!KEY_UP\n\t};\n\t//!/enum\n\n\t//!enum PointerEventType\n\tSystem.PointerEventType = {\n\t\tPOINTER_DOWN: \t\t0x010,\n\t\tPOINTER_UP: \t\t0x011,\n\t\tPOINTER_MOVE: \t\t0x012,\n\t\tPOINTER_DRAG_START:\t0x013,\n\t\tPOINTER_DRAG_MOVE:\t0x014,\n\t\tPOINTER_DRAG_STOP:\t0x015,\n\t\tPOINTER_WHEEL:\t\t0x016,\n\t\t//!POINTER_DOWN\n\t\t//!POINTER_UP\n\t\t//!POINTER_MOVE\n\t\t//!POINTER_DRAG_START\n\t\t//!POINTER_DRAG_MOVE\n\t\t//!POINTER_DRAG_STOP\n\t\t//!POINTER_WHEEL\n\t};\n\t//!/enum\n\n\t//!type KeyboardState =\n\n\t\t/**\n\t\t * Time of last keyboard event.\n\t\t * !time: number;\n\t\t */\n\n\t\t/**\n\t\t * State of any of the SHIFT keys.\n\t\t * !shift: boolean;\n\t\t */\n\n\t\t/**\n\t\t * State of any of the CTRL keys.\n\t\t * !ctrl: boolean;\n\t\t */\n\n\t\t/**\n\t\t * State of the ALT key.\n\t\t * !alt: boolean;\n\t\t */\n\n\t\t/**\n\t\t * Key code of last keyboard event.\n\t\t * !keyCode: KeyCode;\n\t\t */\n\n\t//!/type\n\n\t//!type Pointer =\n\n\t\t/**\t\n\t\t * ID of the pointer.\n\t\t * !id: number;\n\t\t */\n\n\t\t/**\n\t\t * Indicates if the pointer is active (pressed).\n\t\t * !isActive: boolean;\n\t\t */\n\n\t\t/**\n\t\t * Indicates if the pointer is currently being dragged.\n\t\t * !isDragging: boolean;\n\t\t */\n\n\t\t/**\t\n\t\t * Source X-coordinate when the POINTER_DOWN event was fired.\n\t\t * !sx: number;\n\t\t */\n\n\t\t/**\n\t\t * Source Y-coordinate when the POINTER_DOWN event was fired.\n\t\t * !sy: number;\n\t\t */\n\n\t\t/**\n\t\t * Current X-coordinate of the pointer.\n\t\t * !x: number;\n\t\t */\n\n\t\t/**\t\n\t\t * Current Y-coordinate of the pointer.\n\t\t * !y: number;\n\t\t */\n\n\t\t/**\n\t\t * Delta in the X direction of the current drag event.\n\t\t * !dx: number;\n\t\t */\n\n\t\t/**\n\t\t * Delta in the Y direction of the current drag event.\n\t\t * !dy: number;\n\t\t */\n\n\t\t/**\n\t\t * Number of the button currently being pressed.\n\t\t * !button: number;\n\t\t */\n\n\t\t/**\n\t\t * Delta value of the mouse-wheel (valid only when the pointer is a mouse pointing-device).\n\t\t * !wheelDelta: number;\n\t\t */\n\n\t\t/**\n\t\t * Accumulated mouse-wheel delta. Should be set to zero (0) manually when needed.\n\t\t * !wheelAccum: number;\n\t\t */\n\n\t//!/type\n\n\t//!type Options =\n\n\t\t/**\n\t\t *\tBackground of the system canvas. Should be a full 7-digit HEX RGB color.\n\t\t *\t@default \"#000000\"\n\t\t *\t!background?: string;\n\t\t */\n\n\t\t/**\n\t\t * \tSet to `false` to disable WebGL mode.\n\t\t * \t@default true\n\t\t * \t!gl?: boolean;\n\t\t */\n\n\t\t/**\n\t\t *\tSet to `true` t o enable on-screen logging.\n\t\t *\t@default false\n\t\t *\t!log?: boolean,\n\t\t */\n\n\t\t/**\n\t\t *\tWhen `true` the renderer will not clear the buffer on each frame draw, thus allowing overdrawing on the previous frame.\n\t\t *\t@default false\n\t\t *\t!overdraw?: boolean,\n\t\t */\n\n\t\t/**\n\t\t *\tEnables or disables antialised canvas. Set to `false` when pixel-perfect is desired.\n\t\t *\t@default false\n\t\t *\t!antialias?: boolean;\n\t\t */\n\n\t\t/**\n\t\t *\tDesired orientaton of the display.\n\t\t *\t@default \"automatic\"\n\t\t *\t!orientation?: DisplayOrientation;\n\t\t */\n\n\t\t/**\n\t\t *\tDesired display width. When not specified (null) the maximum screen width to maintain the aspect ratio will be used.\n\t\t *\t@default null\n\t\t *\t!screenWidth?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tDesired display height. When not specified (null) the maximum screen height to maintain the aspect ratio will be used.\n\t\t *\t@default null\n\t\t *\t!screenHeight?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tTarget frames per second (FPS). Used to determine delay between frames.\n\t\t *\t@default 144\n\t\t *\t!fps?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tMinimum allowed frames per second (FPS). If system FPS drops below this value, the `frameDelta` property of System will be truncated to 1/minFps.\n\t\t *\t@default 10\n\t\t *\t!minFps?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tSelects which rendering mechanism to use either requestAnimationFrame when `true` or setTimeout when `false`.\n\t\t *\t@default true\n\t\t *\t!vsync?: boolean;\n\t\t */\n\n\t\t/**\n\t\t *\tExtra scale factor used to resize images. Use only when you want to render higher resolution images possibly for a very high DPI display.\n\t\t *\t@default 1\n\t\t *\t!extraScaleFactor?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tMaximum scale factor that should be used in the system. A value of `null` will cause no limit.\n\t\t *\t@default null\n\t\t *\t!maxScaleFactor?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tIndicates which method to use to find the target resolution, using `fullscreen` object when `true`, or the `window` object when `false`.\n\t\t *\t@default false\n\t\t *\t!fullscreen?: boolean;\n\t\t */\n\n\t\t/**\n\t\t * \tIndicates if recycler pool preallocation should be automatically executed. Additionally if this value is a number, it will be used as\n\t\t * \tmaximum preallocation parameter for the recycler.\n\t\t * \t@default false\n\t\t * \t!preallocate?: boolean|number;\n\t\t */\n\n\t//!/type\n\n\t//:type KeyboardEventHandler = (action: KeyboardEventType, keyCode: KeyCode, state: KeyboardState) => boolean;\n\t//:type PointerEventHandler = (action: PointerEventType, pointer: Pointer, pointers: { \\[pointerId: number\\]: Pointer }) => boolean;\n\n//!/namespace\n\n//!class System\n\nObject.assign(System,\n{\n\t/**\n\t * Renderer status flags.\n\t */\n\tflags:\n\t{\n\t\trenderingEnabled: false,\n\t\trenderingPaused: false\n\t},\n\n\t/**\n\t * Default options of the rendering system.\n\t */\n\tdefaultOptions:\n\t{\n\t\tbackground: \"#000000\",\n\t\tgl: true,\n\t\tlog: false,\n\n\t\toverdraw: false,\n\t\tantialias: true,\n\t\torientation: 0,\n\n\t\tfps: 144,\n\t\tminFps: 15,\n\t\tvsync: true,\n\n\t\tscreenWidth: null,\n\t\tscreenHeight: null,\n\n\t\textraScaleFactor: 1,\n\t\tmaxScaleFactor: null,\n\n\t\tfullscreen: false\n\t},\n\n\t/**\n\t * Screen width, available only after the system has been initialized.\n\t * !static readonly screenWidth: number;\n\t */\n\tscreenWidth: 0,\n\n\t/**\n\t * Screen height, available only after the system has been initialized.\n\t * !static readonly screenHeight: number;\n\t */\n\tscreenHeight: 0,\n\n\t/**\n\t * Current display orientation.\n\t * !static readonly orientation: System.DisplayOrientation;\n\t */\n\torientation: 0,\n\n\t/**\n\t * Coordinates of the screen's offset (for letter-box effect when the screen does not fit tightly).\n\t */\n\toffsX: 0, offsY: 0,\n\n\t/**\n\t * Device pixel ratio, canvas backing store ratio and resulting canvas ratio (devicePixelRatio / backingStoreRatio).\n\t */\n\tdevicePixelRatio: 1, backingStoreRatio: 1, canvasPixelRatio: 1, canvasScaleFactor: 1, scaleFactor: 1,\n\n\t/**\n\t * Initial transformation matrix. Should be used (if needed) instead of `loadIdentity` since the System does some transformations first.\n\t * !static readonly initialMatrix: Matrix;\n\t */\n\tinitialMatrix: null,\n\n\t/**\n\t * Primary renderer.\n\t * !static readonly renderer: Canvas;\n\t */\n\trenderer: null,\n\n\t/**\n\t * Secondary display buffer (always 2D). Has the same initial transformation matrix as the primary display buffer.\n\t * !static readonly displayBuffer2: Canvas;\n\t */\n\tdisplayBuffer2: null,\n\n\t/**\n\t * Terciary display buffer (always 2D). Is assured to have 1:1 with the screen size, initial transformation matrix not applied.\n\t * !static readonly displayBuffer3: Canvas;\n\t */\n\tdisplayBuffer3: null,\n\n\t/**\n\t * Temporal display buffer (640x480). Used to preload images.\n\t */\n\ttempDisplayBuffer: null,\n\n\t/**\n\t * Map with the status of all keys (along with other flags).\n\t * !static readonly keyState: System.KeyboardState;\n\t */\n\tkeyState: { time: 0, shift: false, ctrl: false, alt: false, keyCode: 0 },\n\n\t/**\n\t * Current status of all pointers.\n\t * !static readonly pointers: { \\[pointerId: number\\]: System.Pointer };\n\t */\n\tpointers: { },\n\n\t/**\n\t * \tThe update method of all objects will be executed when the system update() method is called.\n\t */\n\tupdateQueue: null,\n\n\t/**\n\t * The draw method of all objects will be executed when the system draw() method is called.\n\t */\n\tdrawQueue: null, /*List*/\n\n\t/**\n\t * The frame delta is multiplied by this value before each system cycle (defaults to 1).\n\t * !static timeScale: number;\n\t */\n\ttimeScale: 1,\n\n\t/**\n\t * Frame interval in milliseconds.\n\t * !static readonly frameInterval: number;\n\t */\n\tframeInterval: 0,\n\n\t/**\n\t * Fixed frame interval in milliseconds, when set to non-zero value the frame delta will always be set to this value.\n\t * !static fixedFrameInterval: number;\n\t */\n\tfixedFrameInterval: 0,\n\n\t/**\n\t * Maximum frame interval in milliseconds, if the `frameDelta` exceeds this, it will be truncated to this value. Controlled by the `minFps` value of the system initialization options.\n\t * !static readonly maxFrameInterval: number;\n\t */\n\tmaxFrameInterval: 0,\n\n\t/**\n\t * Last frame delta in seconds.\n\t * !static readonly frameDelta: number;\n\t */\n\tframeDelta: 0,\n\n\t/**\n\t * Logical system time in seconds. Updated on each cycle by the calculated `frameDelta`.\n\t * !static readonly frameTime: number;\n\t */\n\tframeTime: 0,\n\n\t/**\n\t * Current frame number.\n\t * !static readonly frameNumber: number;\n\t */\n\tframeNumber: 0,\n\n\t/**\n\t * Rendering performance data.\n\t */\n\tperf:\n\t{\n\t\t/**\n\t\t * Current time range.\n\t\t */\n\t\tstartTime: 0,\n\t\tlastTime: 0,\n\n\t\t/**\n\t\t * Number of frames drawn in the current time range.\n\t\t */\n\t\tnumFrames: 0,\n\n\t\t/**\n\t\t * Number of update and draw samples averaged in total.\n\t\t */\n\t\tnumSamples: 0,\n\n\t\t/**\n\t\t * Total time spent in update, draw and extra respectively in the current time range.\n\t\t */\n\t\tupdateTimeTotal: 0,\n\t\tdrawTimeTotal: 0,\n\t\textraTimeTotal: 0,\n\t\tframeTimeTotal: 0,\n\n\t\t/**\n\t\t * Calculated values for the last time range. The updateTime and drawTime are in microseconds.\n\t\t */\n\t\tfps: 0,\n\t\taverageFps: 0,\n\t\taverageUpdateTime: 0,\n\t\taverageDrawTime: 0,\n\t\taverageExtraTime: 0,\n\t\taverageFrameTime: 0,\n\t},\n\n\t/**\n\t * Initializes the system with the specified configuration options.\n\t * !static init (options: System.Options) : void;\n\t */\n\tinit: function (options=null)\n\t{\n\t\tlet self = this;\n\n\t\tlet o = { ...this.defaultOptions, ...options };\n\t\tthis.options = o;\n\n\t\t// Execute recycler pool data preallocation.\n\t\tif (this.options.preallocate !== false)\n\t\t{\n\t\t\tif (this.options.preallocate === true)\n\t\t\t\tRecycler.preallocate();\n\t\t\telse\n\t\t\t\tRecycler.preallocate(this.options.preallocate);\n\t\t}\n\n\t\t// Set default orientation if both target sizes were specified.\n\t\tif (o.screenWidth && o.screenHeight && o.orientation == 'default')\n\t\t\to.orientation = o.screenWidth > o.screenHeight ? 'landscape' : 'portrait';\n\n\t\tthis.orientation = o.orientation;\n\n\t\tthis.updateQueue = List.Pool.alloc();\n\t\tthis.drawQueue = List.Pool.alloc();\n\n\t\t// Attach frame event handlers.\n\t\tthis.frameInterval = 1000 / o.fps;\n\t\tthis.maxFrameInterval = 1000 / o.minFps;\n\n\t\tglobal.onresize = function() { self.onWindowResized(); };\n\n\t\tthis.frameTimer = new Timer (o.vsync, this.frameInterval, (delta) => this.onFrame(delta));\n\n\t\t// Setup canvas buffer.\n\t\tthis.renderer = new Canvas ({ gl: o.gl, elem: null, absolute: true, hidden: false, antialias: o.antialias, background: o.background });\n\n\t\tthis.displayBuffer2 = new Canvas ({ gl: false, elem: null, absolute: true, hidden: false, antialias: o.antialias, background: 'none' });\n\t\tthis.displayBuffer2.elem.style.pointerEvents = 'none';\n\n\t\tthis.displayBuffer3 = new Canvas ({ gl: false, elem: null, absolute: true, hidden: false, antialias: o.antialias, background: 'none' });\n\t\tthis.displayBuffer3.elem.style.pointerEvents = 'none';\n\n\t\tthis.tempDisplayBuffer = new Canvas ({ hidden: true, antialias: o.antialias }).resize(640, 480);\n\n\t\tlet display0 = this.renderer.elem;\n\n\t\t// Obtain device display ratios.\n\t\tthis.devicePixelRatio = global.devicePixelRatio || 1;\n\n\t\tthis.backingStoreRatio = o.gl === true ? 1 : (this.renderer.context.webkitBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.renderer.context.mozBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.renderer.context.msBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.renderer.context.oBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.renderer.context.backingStorePixelRatio || 1);\n\n\t\tthis.canvasPixelRatio = this.devicePixelRatio / this.backingStoreRatio;\n\n\t\tSystem.onWindowResized(true);\n\n\t\t// Attach keyboard event handlers.\n\t\tglobal.onkeydown = function (evt)\n\t\t{\n\t\t\tif (evt.target !== global.document.body)\n\t\t\t\treturn;\n\n\t\t\tif (self.keyState[evt.keyCode])\n\t\t\t\treturn false;\n\n\t\t\tself.keyState[evt.keyCode] = true;\n\n\t\t\tself.keyState.keyCode = evt.keyCode;\n\t\t\tself.keyState.startTime = hrnow();\n\n\t\t\tswitch (evt.keyCode)\n\t\t\t{\n\t\t\t\tcase 16: // SHIFT\n\t\t\t\t\tself.keyState.shift = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 17: // CTRL\n\t\t\t\t\tself.keyState.ctrl = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 18: // ALT\n\t\t\t\t\tself.keyState.alt = true;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// CTRL+TAB should always be handled by the browser.\n\t\t\tif (self.keyState.ctrl && evt.keyCode == KeyCode.TAB)\n\t\t\t{\n\t\t\t\tself.keyState[evt.keyCode] = false;\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (self.onKeyboardEvent (self.KeyboardEventType.KEY_DOWN, evt.keyCode, self.keyState) === false)\n\t\t\t\treturn false;\n\t\t};\n\n\t\tglobal.onkeyup = function (evt)\n\t\t{\n\t\t\tif (evt.target !== global.document.body)\n\t\t\t\treturn;\n\n\t\t\tif (!self.keyState[evt.keyCode])\n\t\t\t\treturn false;\n\n\t\t\tself.keyState[evt.keyCode] = false;\n\t\t\tself.keyState.endTime = hrnow();\n\t\t\tself.keyState.keyCode = evt.keyCode;\n\n\t\t\tswitch (evt.keyCode)\n\t\t\t{\n\t\t\t\tcase 16: // SHIFT\n\t\t\t\t\tself.keyState.shift = false;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 17: // CTRL\n\t\t\t\t\tself.keyState.ctrl = false;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 18: // ALT\n\t\t\t\t\tself.keyState.alt = false;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (self.onKeyboardEvent (self.KeyboardEventType.KEY_UP, evt.keyCode, self.keyState) === false)\n\t\t\t\treturn false;\n\t\t};\n\n\t\t// Converts pointer coordinates from physical space to screen space.\n\n\t\tconst pointerConvX = function (x, y)\n\t\t{\n\t\t\treturn System.reverseRender ? int(System.screenWidth-1 - (y-System.offsY)/System.canvasScaleFactor) : int((x-System.offsX)/System.canvasScaleFactor);\n\t\t};\n\n\t\tconst pointerConvY = function (x, y)\n\t\t{\n\t\t\treturn System.reverseRender ? int((x-System.offsX)/System.canvasScaleFactor) : int((y-System.offsY)/System.canvasScaleFactor);\n\t\t};\n\n\t\t// Attach pointer event handlers if pointer-events are available.\n\t\tif (\"ontouchstart\" in global)\n\t\t{\n\t\t\tdisplay0.ontouchstart = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tlet touches = evt.changedTouches;\n\n\t\t\t\tfor (let i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointers[touches[i].identifier])\n\t\t\t\t\t{\n\t\t\t\t\t\tSystem.pointers[touches[i].identifier] = {\n\t\t\t\t\t\t\t\tid: touches[i].identifier, isActive: false, isDragging: false,\n\t\t\t\t\t\t\t\tsx: 0, sy: 0, x: 0, y: 0, dx: 0, dy: 0, button: 0,\n\t\t\t\t\t\t\t\twheelDelta: 0, wheelAccum: 0\n\t\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tlet p = System.pointers[touches[i].identifier];\n\n\t\t\t\t\tp.isActive = true;\n\t\t\t\t\tp.isDragging = false;\n\t\t\t\t\tp.button = 1;\n\n\t\t\t\t\tp.startTime = hrnow();\n\n\t\t\t\t\tp.x = p.sx = pointerConvX(touches[i].clientX, touches[i].clientY);\n\t\t\t\t\tp.y = p.sy = pointerConvY(touches[i].clientX, touches[i].clientY);\n\n\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DOWN, p, System.pointers);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchend = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tlet touches = evt.changedTouches;\n\n\t\t\t\tfor (let i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointers[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tlet p = System.pointers[touches[i].identifier];\n\n\t\t\t\t\tp.endTime = hrnow();\n\t\t\t\t\tp.deltaTime = p.endTime - p.startTime;\n\n\t\t\t\t\tp.x = pointerConvX(touches[i].clientX, touches[i].clientY)\n\t\t\t\t\tp.y = pointerConvY(touches[i].clientX, touches[i].clientY)\n\n\t\t\t\t\tif (p.isDragging)\n\t\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DRAG_STOP, p, System.pointers);\n\n\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_UP, p, System.pointers);\n\n\t\t\t\t\tp.isActive = false;\n\t\t\t\t\tp.isDragging = false;\n\n\t\t\t\t\tp.button = 0;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchcancel = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tlet touches = evt.changedTouches;\n\n\t\t\t\tfor (let i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointers[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tlet p = System.pointers[touches[i].identifier];\n\n\t\t\t\t\tp.x = pointerConvX(touches[i].clientX, touches[i].clientY);\n\t\t\t\t\tp.y = pointerConvY(touches[i].clientX, touches[i].clientY);\n\n\t\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.PointerEventType.POINTER_DRAG_STOP : System.PointerEventType.POINTER_UP, p, System.pointers);\n\n\t\t\t\t\tp.isActive = false;\n\t\t\t\t\tp.isDragging = false;\n\n\t\t\t\t\tp.button = 0;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchmove = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tlet touches = evt.changedTouches;\n\n\t\t\t\tfor (let i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointers[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tlet p = System.pointers[touches[i].identifier];\n\n\t\t\t\t\tif (p.isActive && !p.isDragging)\n\t\t\t\t\t{\n\t\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DRAG_START, p, System.pointers);\n\t\t\t\t\t\tp.isDragging = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tp.x = pointerConvX(touches[i].clientX, touches[i].clientY);\n\t\t\t\t\tp.y = pointerConvY(touches[i].clientX, touches[i].clientY);\n\n\t\t\t\t\tp.dx = p.x - p.sx;\n\t\t\t\t\tp.dy = p.y - p.sy;\n\n\t\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.PointerEventType.POINTER_DRAG_MOVE : System.PointerEventType.POINTER_MOVE, p, System.pointers);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\t\t// Attach mouse event handlers when pointer-events are not available.\n\t\telse\n\t\t{\n\t\t\tdisplay0.oncontextmenu = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.onwheel = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointers[0])\n\t\t\t\t{\n\t\t\t\t\tSystem.pointers[0] = {\n\t\t\t\t\t\t\tid: 0, isActive: false, isDragging: false,\n\t\t\t\t\t\t\tsx: 0, sy: 0, x: 0, y: 0, dx: 0, dy: 0, button: 0,\n\t\t\t\t\t\t\twheelDelta: 0, wheelAccum: 0\n\t\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlet p = System.pointers[0];\n\n\t\t\t\tp.x = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = pointerConvY(evt.clientX, evt.clientY);\n\t\t\t\tp.wheelDelta = evt.deltaY;\n\t\t\t\tp.wheelAccum += evt.deltaY;\n\n\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_WHEEL, p, System.pointers);\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.onmousedown = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointers[0])\n\t\t\t\t{\n\t\t\t\t\tSystem.pointers[0] = {\n\t\t\t\t\t\t\tid: 0, isActive: false, isDragging: false,\n\t\t\t\t\t\t\tsx: 0, sy: 0, x: 0, y: 0, dx: 0, dy: 0, button: 0,\n\t\t\t\t\t\t\twheelDelta: 0, wheelAccum: 0\n\t\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlet p = System.pointers[0];\n\n\t\t\t\tp.isActive = true;\n\t\t\t\tp.isDragging = false;\n\t\t\t\tp.button = evt.which;\n\n\t\t\t\tp.x = p.sx = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = p.sy = pointerConvY(evt.clientX, evt.clientY);\n\n\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DOWN, p, System.pointers);\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.onmouseup = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointers[0])\n\t\t\t\t\treturn false;\n\n\t\t\t\tlet p = System.pointers[0];\n\n\t\t\t\tp.x = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = pointerConvY(evt.clientX, evt.clientY);\n\n\t\t\t\tif (p.isDragging)\n\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DRAG_STOP, p, System.pointers);\n\n\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_UP, p, System.pointers);\n\n\t\t\t\tp.isActive = false;\n\t\t\t\tp.isDragging = false;\n\n\t\t\t\tp.button = 0;\n\t\t\t};\n\n\t\t\tdisplay0.onmousemove = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointers[0])\n\t\t\t\t\treturn false;\n\n\t\t\t\tlet p = System.pointers[0];\n\n\t\t\t\tif (p.isActive && !p.isDragging)\n\t\t\t\t{\n\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DRAG_START, p, System.pointers);\n\t\t\t\t\tp.isDragging = true;\n\t\t\t\t}\n\n\t\t\t\tp.x = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = pointerConvY(evt.clientX, evt.clientY);\n\n\t\t\t\tp.dx = p.x - p.sx;\n\t\t\t\tp.dy = p.y - p.sy;\n\n\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.PointerEventType.POINTER_DRAG_MOVE : System.PointerEventType.POINTER_MOVE, p, System.pointers);\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\t// Enable log if flag is set.\n\t\tif (o.log === true) Log.enable();\n\t},\n\n\t/**\n\t * Returns the current logical time in seconds (same as reading `System.frameTime`).\n\t * !static time() : number;\n\t */\n\ttime: function()\n\t{\n\t\treturn this.frameTime;\n\t},\n\n\t/**\n\t * Starts the system and enables rendering and updates.\n\t * !static start() : void;\n\t */\n\tstart: function()\n\t{\n\t\tthis.onWindowResized();\n\n\t\tthis.flags.renderingPaused = false;\n\t\tthis.frameTimer.start();\n\t},\n\n\t/**\n\t * Stops the system by disabling both rendering and updates.\n\t * !static stop() : void;\n\t */\n\tstop: function()\n\t{\n\t\tthis.flags.renderingPaused = true;\n\t\tthis.frameTimer.stop();\n\t},\n\n\t/**\n\t * Pauses the system by disabling updates, but rendering will be continued.\n\t * !static pause() : void;\n\t */\n\tpause: function()\n\t{\n\t\tthis.flags.renderingPaused = true;\n\t},\n\n\t/**\n\t * Resumes the system after previously being paused with `pause` method.\n\t * !static resume() : void;\n\t */\n\tresume: function()\n\t{\n\t\tthis.flags.renderingPaused = false;\n\t\tthis.resetPerf();\n\t},\n\n\t/**\n\t * Executed when a frame needs to be rendered to the display buffer.\n\t * static onFrame (delta: number) : void;\n\t */\n\tonFrame: function (delta)\n\t{\n\t\tlet now = hrnow()\n\t\tlet tmp;\n\n\t\tif (delta > this.maxFrameInterval)\n\t\t\tdelta = this.maxFrameInterval;\n\n\t\tif (this.fixedFrameInterval !== 0)\n\t\t\tdelta = this.fixedFrameInterval;\n\n\t\tif (!this.flags.renderingEnabled || this.flags.renderingPaused)\n\t\t{\n\t\t\tthis.draw();\n\t\t\treturn;\n\t\t}\n\n\t\tdelta *= this.timeScale;\n\n\t\tthis.frameDelta = delta / 1000.0;\n\t\tthis.frameTime += this.frameDelta;\n\t\tglobals.time = this.frameTime;\n\n\t\tthis.frameNumber++;\n\n\t\t/* ~ */\n\t\ttmp = hrnow();\n\t\tthis.update (this.frameDelta);\n\t\tthis.perf.updateTimeTotal += hrnow() - tmp;\n\n\t\t/* ~ */\n\t\ttmp = hrnow();\n\t\tthis.draw();\n\t\tthis.perf.drawTimeTotal += hrnow() - tmp;\n\n\t\t/* ~ */\n\t\tthis.perf.lastTime = now;\n\t\tthis.perf.numFrames++;\n\n\t\tthis.perf.frameTimeTotal += hrnow() - now;\n\n\t\tdelta = this.perf.lastTime - this.perf.startTime;\n\t\tif (delta > 1000)\n\t\t{\n\t\t\tthis.perf.fps = int(this.perf.numFrames*1000 / delta);\n\n\t\t\t//this.perf.extraTimeTotal = delta - this.perf.updateTimeTotal - this.perf.drawTimeTotal;\n\n\t\t\tthis.perf.averageFps = int(((this.perf.averageFps*this.perf.numSamples) + this.perf.fps) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.averageUpdateTime = int(((this.perf.averageUpdateTime*this.perf.numSamples) + (this.perf.updateTimeTotal*1000 / this.perf.numFrames)) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.averageDrawTime = int(((this.perf.averageDrawTime*this.perf.numSamples) + (this.perf.drawTimeTotal*1000 / this.perf.numFrames)) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.averageExtraTime = int(((this.perf.averageExtraTime*this.perf.numSamples) + (this.perf.extraTimeTotal*1000 / this.perf.numFrames)) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.averageFrameTime = int(((this.perf.averageFrameTime*this.perf.numSamples) + (this.perf.frameTimeTotal*1000 / this.perf.numFrames)) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.numSamples++;\n\n\t\t\tthis.perf.startTime = now;\n\t\t\tthis.perf.lastTime = now;\n\t\t\tthis.perf.numFrames = 0;\n\t\t\tthis.perf.updateTimeTotal = 0;\n\t\t\tthis.perf.drawTimeTotal = 0;\n\t\t\tthis.perf.extraTimeTotal = 0;\n\t\t\tthis.perf.frameTimeTotal = 0;\n\t\t}\n\t},\n\n\t/**\n\t * Executed when the size of the window has changed.\n\t * static onWindowResized (notRendering?: boolean) : void;\n\t */\n\tonWindowResized: function (notRendering=false)\n\t{\n\t\t// Determine size of the screen.\n\t\tif ('document' in global)\n\t\t{\n\t\t\tif (this.options.fullscreen)\n\t\t\t{\n\t\t\t\tthis._screenWidth = int(global.screen.width);\n\t\t\t\tthis._screenHeight = int(global.screen.height);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._screenWidth = global.innerWidth;\n\t\t\t\tthis._screenHeight = global.innerHeight;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._screenWidth = this.options.screenWidth;\n\t\t\tthis._screenHeight = this.options.screenHeight;\n\n\t\t\tif (this.options.screenWidth == null && this.options.screenHeight == null)\n\t\t\t\tthrow new Error ('At least one screen dimension must be specified in headless mode.');\n\t\t}\n\n\t\t// Flip dimensions to ensure the desired orientation.\n\t\tif ((this._screenWidth < this._screenHeight && this.orientation == 'landscape') || (this._screenWidth > this._screenHeight && this.orientation == 'portrait'))\n\t\t{\n\t\t\tthis.screenWidth = this._screenHeight;\n\t\t\tthis.screenHeight = this._screenWidth;\n\n\t\t\tthis.reverseRender = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.screenWidth = this._screenWidth;\n\t\t\tthis.screenHeight = this._screenHeight;\n\n\t\t\tthis.reverseRender = false;\n\t\t}\n\n\t\t// Get target screen dimensions.\n\t\tlet targetScreenWidth = this.options.screenWidth;\n\t\tlet targetScreenHeight = this.options.screenHeight;\n\n\t\tif (targetScreenWidth === null || targetScreenHeight === null)\n\t\t{\n\t\t\tif (targetScreenWidth === null && targetScreenHeight === null)\n\t\t\t{\n\t\t\t\ttargetScreenWidth = this.screenWidth;\n\t\t\t\ttargetScreenHeight = this.screenHeight;\n\t\t\t}\n\t\t\telse if (targetScreenWidth === null)\n\t\t\t{\n\t\t\t\ttargetScreenWidth = int(0.5 + this.screenWidth * (this.options.screenHeight / this.screenHeight));\n\t\t\t}\n\t\t\telse if (targetScreenHeight === null)\n\t\t\t{\n\t\t\t\ttargetScreenHeight = int(0.5 + this.screenHeight * (this.options.screenWidth / this.screenWidth));\n\t\t\t}\n\t\t}\n\n\t\t// ***\n\t\tlet screenWidth = targetScreenWidth;\n\t\tlet screenHeight = targetScreenHeight;\n\n\t\tif (this.orientation === 'automatic' && screenWidth && screenHeight)\n\t\t{\n\t\t\tif ((screenWidth > screenHeight && this.screenWidth < this.screenHeight) || (screenWidth < screenHeight && this.screenWidth > this.screenHeight))\n\t\t\t{\n\t\t\t\tscreenWidth = screenHeight;\n\t\t\t\tscreenHeight = targetScreenWidth;\n\t\t\t}\n\t\t}\n\n\t\t// ***\n\t\tthis.canvasScaleFactor = 1;\n\n\t\tif (screenWidth && screenHeight)\n\t\t{\n\t\t\tthis.canvasScaleFactor = Math.min(this.screenWidth / screenWidth, this.screenHeight / screenHeight);\n\t\t}\n\t\telse if (screenWidth)\n\t\t{\n\t\t\tthis.canvasScaleFactor = this.screenWidth / screenWidth;\n\t\t}\n\t\telse if (screenHeight)\n\t\t{\n\t\t\tthis.canvasScaleFactor = this.screenHeight / screenHeight;\n\t\t}\n\n\t\t// ***\n\t\tlet _screenWidth = this.screenWidth;\n\t\tlet _screenHeight = this.screenHeight;\n\n\t\tif (screenWidth) this.screenWidth = screenWidth;\n\t\tif (screenHeight) this.screenHeight = screenHeight;\n\n\t\tthis.offsX = int((_screenWidth - this.screenWidth*this.canvasScaleFactor)*0.5);\n\t\tthis.offsY = int((_screenHeight - this.screenHeight*this.canvasScaleFactor)*0.5);\n\n\t\tif (this.reverseRender)\n\t\t{\n\t\t\tlet tmp = this.offsX;\n\t\t\tthis.offsX = this.offsY;\n\t\t\tthis.offsY = tmp;\n\t\t}\n\n\t\tthis.scaleFactor = this.canvasScaleFactor * this.canvasPixelRatio;\n\t\tthis.scaleFactor = int(0.7 + this.scaleFactor);\n\n\t\tif (this.options.maxScaleFactor > 0 && this.scaleFactor > this.options.maxScaleFactor)\n\t\t\tthis.scaleFactor = this.options.maxScaleFactor;\n\n\t\tthis.flags.renderingEnabled = false;\n\n\t\t/*\n\t\t**\tIf the scale is not exact, the final canvas size might not fit the entire screen perfectly (will always be a little smaller in\n\t\t**\tsuch a case), when that happens the body's background color will be quite noticeable, to mitigate that we set the body background\n\t\t**\tto the same color as the primary canvas.\n\t\t*/\n\t\tif ('document' in global)\n\t\t\tglobal.document.body.style.backgroundColor = this.renderer.backgroundColor;\n\n\t\t/*\n\t\t**\tResize all display buffers.\n\t\t*/\n\t\tif (!this.reverseRender)\n\t\t{\n\t\t\tthis.renderer.resize (this.screenWidth*this.scaleFactor, this.screenHeight*this.scaleFactor);\n\t\t\tthis.renderer.elem.style.width = int(this.screenWidth*this.canvasScaleFactor+0.5) + \"px\";\n\t\t\tthis.renderer.elem.style.height = int(this.screenHeight*this.canvasScaleFactor+0.5) + \"px\";\n\n\t\t\tthis.displayBuffer2.resize (this.screenWidth*this.scaleFactor, this.screenHeight*this.scaleFactor);\n\t\t\tthis.displayBuffer2.elem.style.width = int(this.screenWidth*this.canvasScaleFactor+0.5) + \"px\";\n\t\t\tthis.displayBuffer2.elem.style.height = int(this.screenHeight*this.canvasScaleFactor+0.5) + \"px\";\n\n\t\t\tthis.displayBuffer3.resize (_screenWidth, _screenHeight);\n\t\t\tthis.displayBuffer3.elem.style.width = _screenWidth + \"px\";\n\t\t\tthis.displayBuffer3.elem.style.height = _screenHeight + \"px\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.renderer.resize (this.screenHeight*this.scaleFactor, this.screenWidth*this.scaleFactor);\n\t\t\tthis.renderer.elem.style.width = int(this.screenHeight*this.canvasScaleFactor+0.5) + \"px\";\n\t\t\tthis.renderer.elem.style.height = int(this.screenWidth*this.canvasScaleFactor+0.5) + \"px\";\n\n\t\t\tthis.displayBuffer2.resize (this.screenHeight*this.scaleFactor, this.screenWidth*this.scaleFactor);\n\t\t\tthis.displayBuffer2.elem.style.width = int(this.screenHeight*this.canvasScaleFactor+0.5) + \"px\";\n\t\t\tthis.displayBuffer2.elem.style.height = int(this.screenWidth*this.canvasScaleFactor+0.5) + \"px\";\n\n\t\t\tthis.displayBuffer3.resize (_screenHeight, _screenWidth);\n\t\t\tthis.displayBuffer3.elem.style.width = _screenHeight + \"px\";\n\t\t\tthis.displayBuffer3.elem.style.height = _screenWidth + \"px\";\n\t\t}\n\n\t\tthis.renderer.elem.style.marginLeft = this.offsX + \"px\";\n\t\tthis.renderer.elem.style.marginTop = this.offsY + \"px\";\n\n\t\tthis.displayBuffer2.elem.style.marginLeft = this.offsX + \"px\";\n\t\tthis.displayBuffer2.elem.style.marginTop = this.offsY + \"px\";\n\n\t\tthis.renderer.loadIdentity();\n\t\tthis.displayBuffer2.loadIdentity();\n\t\tthis.displayBuffer3.loadIdentity();\n\n\t\tif (this.scaleFactor != 1)\n\t\t{\n\t\t\tthis.renderer.globalScale(this.scaleFactor);\n\t\t\tthis.displayBuffer2.globalScale(this.scaleFactor);\n\t\t}\n\n\t\tif (this.reverseRender)\n\t\t{\n\t\t\tthis.renderer.rotate(Math.PI/2);\n\t\t\tthis.renderer.translate(-this.screenWidth, 0);\n\t\t\tthis.renderer.flipped(true);\n\n\t\t\tthis.displayBuffer2.rotate(Math.PI/2);\n\t\t\tthis.displayBuffer2.translate(-this.screenWidth, 0);\n\t\t\tthis.displayBuffer2.flipped(true);\n\n\t\t\tthis.displayBuffer3.rotate(Math.PI/2);\n\t\t\tthis.displayBuffer3.translate(-_screenWidth, 0);\n\t\t\tthis.displayBuffer3.flipped(true);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.renderer.flipped(false);\n\t\t\tthis.displayBuffer2.flipped(false);\n\t\t\tthis.displayBuffer3.flipped(false);\n\t\t}\n\n\t\t/* *** */\n\t\tthis.scaleFactor *= this.options.extraScaleFactor;\n\n\t\tif (this.options.maxScaleFactor > 0 && this.scaleFactor > this.options.maxScaleFactor)\n\t\t\tthis.scaleFactor = this.options.maxScaleFactor;\n\n\t\tthis.integerScaleFactor = int(this.scaleFactor + 0.5); //0.9\n\t\tthis.resetPerf();\n\n\t\tif (this.initialMatrix)\n\t\t\tthis.initialMatrix.free();\n\n\t\tthis.initialMatrix = this.renderer.getMatrix(true);\n\n\t\tif (notRendering != true)\n\t\t{\n\t\t\tthis.flags.renderingEnabled = true;\n\t\t\tthis.onCanvasResized (this.screenWidth, this.screenHeight);\n\t\t}\n\t},\n\n\t/**\n\t * Event triggered when the canvas was resized by the system. Can be overriden.\n\t * !static onCanvasResized (screenWidth: number, screenHeight: number) : void;\n\t */\n\tonCanvasResized: function (screenWidth, screenHeight)\n\t{\n\t},\n\n\t/**\n\t * Resets the performance data.\n\t * !static resetPerf () : void;\n\t */\n\tresetPerf: function()\n\t{\n\t\tthis.perf.startTime = hrnow();\n\t\tthis.perf.lastTime = hrnow();\n\n\t\tthis.perf.numFrames = 0;\n\t\tthis.perf.updateTimeTotal = 0;\n\t\tthis.perf.drawTimeTotal = 0;\n\t\tthis.perf.extraTimeTotal = 0;\n\t\tthis.perf.frameTimeTotal = 0;\n\n\t\tthis.perf.numSamples = 0;\n\t\tthis.perf.fps = 0;\n\t\tthis.perf.averageFps = 0;\n\t\tthis.perf.averageUpdateTime = 0;\n\t\tthis.perf.averageDrawTime = 0;\n\t\tthis.perf.averageExtraTime = 0;\n\t\tthis.perf.averageFrameTime = 0;\n\t},\n\n\t/**\n\t * Adds the specified update handler to the system.\n\t * !static updateQueueAdd (handler: { update: (dt: number) => boolean }) : Linkable;\n\t * violet\n\t */\n\tupdateQueueAdd: function (handler)\n\t{\n\t\tthis.updateQueue.push (handler);\n\t\treturn this.updateQueue.bottom;\n\t},\n\n\t/**\n\t * Removes the specified update handler from the system.\n\t * !static updateQueueRemove (handler: { update: (dt: number) => boolean }) : void;\n\t * violet\n\t */\n\t/**\n\t * Removes the specified update handler node from the system.\n\t * !static updateQueueRemove (node: Linkable) : void;\n\t */\n\tupdateQueueRemove: function (handler)\n\t{\n\t\tthis.updateQueue.remove (Linkable.isInstance(handler) ? handler : this.updateQueue.sgetNode(handler));\n\t},\n\n\t/**\n\t * Adds the specified draw handler to the system.\n\t * !static drawQueueAdd (handler: { draw: (g: Canvas) => void }) : Linkable;\n\t * violet\n\t */\n\tdrawQueueAdd: function (handler)\n\t{\n\t\tthis.drawQueue.push (handler);\n\t\treturn this.drawQueue.bottom;\n\t},\n\n\t/**\n\t * Removes the specified draw handler from the system.\n\t * !static drawQueueRemove (handler: { draw: (g: Canvas) => void }) : void;\n\t * violet\n\t */\n\t/**\n\t * Removes the specified draw handler node from the system.\n\t * !static drawQueueRemove (node: Linkable) : void;\n\t */\n\tdrawQueueRemove: function (handler)\n\t{\n\t\tthis.drawQueue.remove (Linkable.isInstance(handler) ? handler : this.drawQueue.sgetNode(handler));\n\t},\n\n\t/**\n\t * Adds the specified handler to the update and draw queues.\n\t * !static queueAdd (handler: { update: (dt: number) => boolean, draw: (g: Canvas) => void }) : void;\n\t * violet\n\t */\n\tqueueAdd: function (handler)\n\t{\n\t\tthis.updateQueue.push (handler);\n\t\tthis.drawQueue.push (handler);\n\t},\n\n\t/**\n\t * Removes the specified handler from the update and draw queues.\n\t * !static queueRemove (handler: { update: (dt: number) => boolean, draw: (g: Canvas) => void }) : void;\n\t * violet\n\t */\n\tqueueRemove: function (handler)\n\t{\n\t\tthis.updateQueue.remove (this.updateQueue.sgetNode(handler));\n\t\tthis.drawQueue.remove (this.drawQueue.sgetNode(handler));\n\t},\n\n\t/**\n\t * Runs an update cycle. All objects in the `updateQueue` will have their `update method called.\n\t */\n\tupdate: function (dt)\n\t{\n\t\ttry\n\t\t{\n\t\t\tlet next;\n\n\t\t\tfor (let elem = this.updateQueue.top; elem; elem = next)\n\t\t\t{\n\t\t\t\tnext = elem.next;\n\n\t\t\t\tif (elem.value.update(dt) === false)\n\t\t\t\t\tthis.updateQueueRemove(elem);\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tSystem.stop();\n\t\t\tthrow e;\n\t\t}\t\n\t},\n\n\t/**\n\t * Runs a rendering cycle. All objects in the `drawQueue` will have their `draw` method called.\n\t */\n\tdraw: function ()\n\t{\n\t\tif (this.renderer.gl !== null)\n\t\t\tthis.renderer.start();\n\n\t\tif (!this.options.overdraw)\n\t\t{\n\t\t\tthis.renderer.clear();\n\t\t\tthis.displayBuffer2.clear();\n\t\t\tthis.displayBuffer3.clear();\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tlet next;\n\n\t\t\tfor (let elem = this.drawQueue.top; elem; elem = next)\n\t\t\t{\n\t\t\t\tnext = elem.next;\n\t\t\t\telem.value.draw(this.renderer);\n\t\t\t}\n\n\t\t\tif (this.renderer.gl !== null)\n\t\t\t{\n\t\t\t\tthis.renderer.flush();\n\t\t\t\tthis.renderer.end();\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tSystem.stop();\n\t\t\tthrow e;\n\t\t}\t\n\t},\n\n\t/**\n\t * Interpolates numeric values between two objects (`src` and `dst`) using the specified `duration` and `easing` function. Note that all four parameters `src`, `dst`,\n\t * `duration` and `easing` must be objects having the same number of values.\n\t * !static interpolate (src: object, dst: object, duration: object, easing: object, callback: (data: object, isFinished: boolean) => void) : void;\n\t */\n\t//VIOLET: Remove this from here.\n\tinterpolate: function (src, dst, duration, easing, callback)\n\t{\n\t\t//violet: not optimized\n\t\tlet time = { };\n\t\tlet data = { };\n\t\tlet count = 0;\n\n\t\tfor (let x in src)\n\t\t{\n\t\t\ttime[x] = 0.0;\n\t\t\tdata[x] = src[x]\n\t\t\tcount++;\n\t\t}\n\n\t\tlet interpolator =\n\t\t{\n\t\t\tupdate: function(dt)\n\t\t\t{\n\t\t\t\tfor (let x in time)\n\t\t\t\t{\n\t\t\t\t\tif (time[x] == duration[x])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\ttime[x] += dt;\n\t\t\t\t\tif (time[x] >= duration[x])\n\t\t\t\t\t{\n\t\t\t\t\t\ttime[x] = duration[x];\n\t\t\t\t\t\tcount--;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet t = easing[x] (time[x] / duration[x]);\n\t\t\t\t\tdata[x] = (1-t)*src[x] + t*dst[x];\n\t\t\t\t}\n\n\t\t\t\tcallback (data, count == 0);\n\n\t\t\t\tif (count == 0)\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t};\n\n\t\tSystem.updateQueueAdd(interpolator);\n\t\tinterpolator.update(0);\n\t},\n\n\t/**\n\t * Event triggered when a keyboard event is detected by the system.\n\t * !static onKeyboardEvent: System.KeyboardEventHandler;\n\t */\n\tonKeyboardEvent: function (action, keyCode, state)\n\t{\n\t\treturn true;\n\t},\n\n\t/**\n\t * Event triggered when a pointer event is detected by the system.\n\t * !static onPointerEvent: System.PointerEventHandler;\n\t */\n\tonPointerEvent: function (action, pointer, pointers)\n\t{\n\t\treturn true;\n\t}\n});\n\n//!/class\n\nexport default System;\n","\nimport System from './system.js';\nimport List from '../utils/list.js';\n\n//![import \"./system\"]\n//![import \"../utils/list\"]\n\n//:/**\n//: * \tLogging module to show logs on the system display buffer.\n//: */\n\n//!namespace Log\n\nconst Log =\n{\n\t/**\n\t * \tIndicates if the log module is enabled.\n\t *\t!let enabled: boolean;\n\t */\n\tenabled: false,\n\n\t/**\n\t * \tIndicates if the log module is paused.\n\t * \t!let paused: boolean;\n\t */\n\tpaused: false,\n\n\t/**\n\t * \tMaximum number of entries to show in the screen.\n\t * \t!let maxsize: number;\n\t */\n\tmaxsize: 30,\n\n\tdata: List.Pool.alloc(),\n\tcount: 0,\n\n\t/**\n\t * \tIndicates if output showuld also be passed to `console.debug` as secondary echo.\n\t * \t!let debugEcho: boolean;\n\t */\n\tdebugEcho: false,\n\n\t/**\n\t * \tForeground (text) color.\n\t * \t!let color: string;\n\t */\n\tcolor: '#fff',\n\n\t/**\n\t * \tBackground color.\n\t * \t!let background: string;\n\t */\n\tbackground: '#cf266a',\n\n\t/**\n\t * \tDebugging variables to show continuously at the top of the log output.\n\t * \t!let vars: object;\n\t */\n\tvars: { },\n\n\t/**\n\t * \tWrites a message to the log buffer, ensure logging has been enabled by calling `enable` first or any messages will be ignored.\n\t * \t!function write (msg: string) : void;\n\t */\n\twrite: function (msg)\n\t{\n\t\tthis.data.push(msg);\n\t\tthis.count++;\n\n\t\twhile (this.data.length > this.maxsize)\n\t\t\tthis.data.shift();\n\n\t\tif (this.debugEcho)\n\t\t\tconsole.debug(this.count + \": \" + msg);\n\t},\n\n\t/**\n\t * \tClears the current log buffer.\n\t * \t!function clear () : void;\n\t */\n\tclear: function ()\n\t{\n\t\tthis.data.reset();\n\t\tthis.count = 0;\n\t},\n\n\t/**\n\t * \tEnables on-screen logging for cool stuff.\n\t *\n\t * \t@param x - X-coordinate of the top-left corner.\n\t * \t@param y - Y-coordinate of the top-left corner.\n\t * \t@param fontSize - Desired font size in `pt` units.\n\t * \t@param showFps - Set to `true` to show FPS.\n\t * \t@param showIndex - Set to `true to show the message index.\n\t *\n\t * \t!function enable (x?: number, y?: number, fontSize?: number, showFps?: boolean, showIndex?: boolean) : void;\n\t */\n\tenable: function (x=0, y=0, fontSize=9.5, showFps=true, showIndex=true)\n\t{\n\t\tif (this.enabled) return;\n\t\tthis.enabled = true;\n\n\t\tif (!showFps) y -= 16;\n\t\tlet _y = y;\n\n\t\tSystem.drawQueueAdd ({ draw: function ()\n\t\t{\n\t\t\tif (Log.paused) return;\n\n\t\t\tlet tmp = hrnow();\n\n\t\t\tconst g = System.displayBuffer3;\n\n\t\t\tg.font('bold '+fontSize+'pt Monospace');\n\t\t\tg.textBaseline('top');\n\n\t\t\tlet s = '';\n\n\t\t\ty = _y;\n\n\t\t\tif (showFps !== false && System.perf.fps != 0)\n\t\t\t{\n\t\t\t\t//s = 'fps: ' + System.perf.fps + '/' + System.perf.averageFps + ', update: ' + System.perf.averageUpdateTime + ', draw: ' + System.perf.averageDrawTime /*+ ', extra: ' + System.perf.averageExtraTime*/ + ', frame: ' + System.perf.averageFrameTime;\n\t\t\t\ts = 'fps: ' + System.perf.fps + '/' + System.perf.averageFps + ', update:' + System.perf.averageUpdateTime + ', draw:' + System.perf.averageDrawTime + ', frame:' + System.perf.averageFrameTime;\n\n\t\t\t\tif (Log.background) {\n\t\t\t\t\tg.fillStyle(Log.background);\n\t\t\t\t\tg.fillRect (x-3, y-1, g.measureText(s)+6, fontSize+5);\n\t\t\t\t}\n\n\t\t\t\tg.fillStyle(Log.color);\n\t\t\t\tg.fillText(s, x, y);\n\t\t\t}\n\n\t\t\ts = '';\n\n\t\t\tfor (let i in Log.vars)\n\t\t\t\ts += i + ': ' + Log.vars[i] + '  ';\n\n\t\t\tif (s !== '')\n\t\t\t{\n\t\t\t\ty += 24;\n\n\t\t\t\tif (Log.background) {\n\t\t\t\t\tg.fillStyle(Log.background);\n\t\t\t\t\tg.fillRect (x-3, y-1, g.measureText(s)+6, fontSize+5);\n\t\t\t\t}\n\n\t\t\t\tg.fillStyle(Log.color);\n\t\t\t\tg.fillText(s, x, y);\n\t\t\t}\n\n\t\t\tlet i = 0;\n\t\t\tfor (let ii = Log.data.top; ii; ii = ii.next, i++)\n\t\t\t{\n\t\t\t\ts = (showIndex ? \"#\" + (Log.count-Log.data.length+i+1) + \": \" : \"> \") + ii.value;\n\n\t\t\t\tif (Log.background) {\n\t\t\t\t\tg.fillStyle(Log.background);\n\t\t\t\t\tg.fillRect (x-3, y-1+7 + (fontSize+5)*(i+1) - 1, g.measureText(s)+6, fontSize+5);\n\t\t\t\t}\n\n\t\t\t\tg.fillStyle(Log.color);\n\t\t\t\tg.fillText(s, x, y-1+7 + (fontSize+5)*(i+1));\n\t\t\t}\n\n\t\t\ttmp = (hrnow() - tmp);\n\t\t\tSystem.perf.drawTimeTotal -= tmp;\n\t\t\tSystem.perf.extraTimeTotal += tmp;\n\t\t}});\n\t},\n\n\t/**\n\t * \tPauses log rendering.\n\t * \t!function pause () : void;\n\t */\n\tpause: function ()\n\t{\n\t\tthis.paused = true;\n\t\treturn;\n\t},\n\n\t/**\n\t * \tResumes log rendering.\n\t * \t!function resume () : void;\n\t */\n\tresume: function ()\n\t{\n\t\tthis.paused = false;\n\t\treturn;\n\t}\n};\n\nexport default Log;\n","\nimport Random from './random.js';\nimport Log from './log.js';\n\n//![import \"./random\"]\n//![import \"./log\"]\n//![import \"../flow/viewport\"]\n\n//:/**\n//: * \tGlobal functions and definitions.\n//: */\n\n//!namespace globals\n\n/*\n**\tVariables and behavior flags, can be extended as needed from other modules.\n*/\nconst globals =\n{\n\t/**\n\t * Renderer's GL context.\n\t * !let gl: WebGL2RenderingContext;\n\t */\n\tgl: null,\n\n\t/**\n\t * Global system time, updated once per frame. Mirrors the `System.frameTime` property.\n\t * !let time: number;\n\t */\n\ttime: 0,\n\n\t/**\n\t * Active viewport (if any). Set by the `draw` method of the `Scene` class.\n\t * !let viewport: Viewport;\n\t */\n\tviewport: null,\n\n\t/**\n\t * Indicates if the element bounds should be drawn. Used by the `Element` class.\n\t * !let debugBounds: boolean;\n\t */\n\tdebugBounds: false,\n\n\t/**\n\t * Indicates if the mask bounds should be drawn. Used by the `Mask` class.\n\t * !let debugMasks: boolean;\n\t */\n\tdebugMasks: false,\n\n\t/**\n\t * Global random generators. Only `rand0` is used by the global random functions. The `rand1` and `rand2` can be used manually if desired.\n\t *\n\t * !const rand0: Random;\n\t * !const rand1: Random;\n\t * !const rand2: Random;\n\t */\n\trand0: new Random(),\n\trand1: new Random(),\n\trand2: new Random()\n}\n\nexport default globals;\n\n//!/namespace\n\n//!declare global\n\n/**\n * Converts the given pixel-value to actual screen pixels taking into account the current scale.\n * !function px (value: number) : number;\n */\nglobal.px = function(value)\n{\n\treturn value*C.SCALE;\n}\n\n/**\n * Disposes an object by running the first method that is found in the following order: `free`, `dispose` and finally `__dtor`.\n * !function dispose (obj: object) : void;\n */\nglobal.dispose = function (obj)\n{\n\tif (obj === null || typeof(obj) !== 'object')\n\t\treturn;\n\n\tif ('free' in obj)\n\t\treturn obj.free();\n\n\tif ('dispose' in obj)\n\t\treturn obj.dispose();\n\n\tif ('__dtor' in obj)\n\t\tobj.__dtor();\n}\n\n/**\n * Global audio context obtained when the system is initialized.\n * !let audioContext: AudioContext;\n */\nif ('AudioContext' in global)\n{\n\tglobal.audioContext = new AudioContext({ latencyHint: 'interactive', sampleRate: 44100 });\n\tLog.write('AudioContext: baseLatency=' + ~~(global.audioContext.baseLatency*1000) + ' ms' );\n}\nelse\n\tglobal.audioContext = null;\n\n/**\n * Similar to `fetch` but uses XMLHttpRequest because in some mobile browsers regular mode does not work well with ArrayBuffers.\n * !function fetchd (url: string, options?: object) : Promise<object>;\n */\nglobal.fetchd = function (url, options)\n{\n\treturn new Promise ((resolve, reject) =>\n\t{\n\t\tif (!options) options = { };\n\t\tif (!('responseType' in options)) options.responseType = 'arraybuffer';\n\n\t\tlet request = new XMLHttpRequest();\n\t\trequest.open('GET', url, true);\n\n\t\tfor (let i in options) request[i] = options[i];\n\n\t\trequest.onload = function() {\n\t\t\tresolve (request.response);\n\t\t};\n\n\t\trequest.onerror = function() {\n\t\t\treject ('Unable to fetch specified resource.');\n\t\t};\n\n\t\trequest.send();\n\t});\n}\n\n/**\n * Loads an arraybuffer from the specified URL and converts it to a AudioBuffer using the global audioContext.\n * !function fetchAudioBuffer (url: string) : Promise<AudioBuffer>;\n */\nglobal.fetchAudioBuffer = function (url)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tif (!global.audioContext)\n\t\t{\n\t\t\treject ('AudioContext is not available.');\n\t\t\treturn;\n\t\t}\n\n\t\tfetchd(url)\n\t\t.then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))\n\t\t.then(audioBuffer => resolve(audioBuffer))\n\t\t.catch(err => reject(err));\n\t});\n}\n\n/**\n * Returns the value as an integer.\n * !function int (value: number|string) : number;\n */\nglobal.int = function (value)\n{\n\treturn value >> 0;\n}\n\n/**\n * Returns the value as a boolean.\n * !function bool (value: number|string|boolean) : number;\n */\nglobal.bool = function (value)\n{\n\tif (value === true || value === false)\n\t\treturn value;\n\n\tif (value == 'true')\n\t\treturn true;\n\n\tif (value == 'false')\n\t\treturn false;\n\n\treturn !(!value);\n}\n\n/**\n * Returns the value as a floating point number.\n * !function float (value: number|string) : number;\n */\nglobal.float = function (value)\n{\n\treturn parseFloat(value);\n}\n\n/**\n * Returns the value truncated to 2 digits of precision.\n * !function float2 (value: number) : number;\n */\nglobal.float2 = function (value)\n{\n\treturn (int(value*100))/100;\n}\n\n/**\n * Returns the value truncated to 3 digits of precision.\n * !function float3 (value: number) : number;\n */\nglobal.float3 = function (value)\n{\n\treturn (int(value*1000))/1000;\n}\n\n/**\n * Returns the value truncated to 4 digits of precision.\n * !function float4 (value: number) : number;\n */\nglobal.float4 = function (value)\n{\n\treturn (int(value*10000))/10000;\n}\n\n/**\n * Converts the given value from degrees to radians.\n * !function rad (degrees: number) : number;\n */\nglobal.rad = function (degrees)\n{\n\treturn degrees*Math.PI/180.0;\n}\n\n/**\n * Converts the given value from radians to degrees.\n * !function deg (radians: number) : number;\n */\nglobal.deg = function (radians)\n{\n\treturn (radians/Math.PI)*180;\n}\n\n/**\n * Returns a random integer value from 0 to 0xFFFF (inclusive).\n * !function rand() : number;\n */\nglobal.rand = function ()\n{\n\treturn globals.rand0.nextInt16();\n}\n\n/**\n * Returns a random float from 0 to 1 (inclusive).\n * !function randf() : number;\n */\nglobal.randf = function ()\n{\n\treturn globals.rand0.nextFloat();\n}\n\n/**\n * Returns a random float within the given (inclusive) range.\n * !function randrf (startValue: number, endValue: number) : number;\n */\nglobal.randrf = function (a, b)\n{\n\tlet t = globals.rand0.nextFloat();\n\treturn t*b + (1-t)*a;\n}\n\n/**\n * Returns a random integer within the given range (inclusive).\n * !function randr (startValue: number, endValue: number) : number;\n */\nglobal.randr = function (a, b)\n{\n\tlet t = globals.rand0.nextFloat();\n\treturn Math.round(t*b + (1-t)*a);\n}\n\n/**\n * Returns a table (array) of N random integer numbers within the given range (inclusive). Ensures that the resulting\n * table has an even distribution.\n * !function randt (startValue: number, endValue: number, n: number, removeSubsequent?: boolean) : Array<number>;\n */\nglobal.randt = function (a, b, n, removeSubsequent=true)\n{\n\tlet table = [ ];\n\n\t// Generate numbers in order to even-out the probability of each.\n\tlet k = a;\n\tfor (let i = 0; i < n; i++, k++)\n\t{\n\t\ttable.push(k);\n\t\tif (k+1 > b) k = a-1;\n\t}\n\n\t// Shuffle the table.\n\tconst m = n >>> 1;\n\tfor (let i = 0; i < m; i++)\n\t{\n\t\ta = randr(i+1, n-1);\n\n\t\tlet tmp = table[i];\n\t\ttable[i] = table[a];\n\t\ttable[a] = tmp;\n\t}\n\n\t// Remove subsequent duplicates.\n\tif (!removeSubsequent) return table;\n\n\tlet j = n-1;\n\tfor (let i = 1; i < n; i++)\n\t{\n\t\tif (table[i] !== table[i-1])\n\t\t\tcontinue;\n\n\t\twhile(table[i] === table[j])\n\t\t{\n\t\t\tif (--j < 0) {\n\t\t\t\tj = n-1;\n\t\t\t\tconsole.log('!!');\n\t\t\t}\n\t\t}\n\n\t\tlet tmp = table[i];\n\t\ttable[i] = table[j];\n\t\ttable[j] = tmp;\n\t}\n\n\treturn table;\n}\n\n/**\n * Returns a table (array) of N random float numbers within the given range (inclusive).\n * !function randtf (startValue: number, endValue: number, n: number) : Array<number>;\n */\nglobal.randtf = function (a, b, n)\n{\n\tvar list = [ ];\n\n\tfor (var i = 0; i < n; i++)\n\t\tlist.push(randrf(a, b));\n\n\treturn list;\n}\n\n/**\n * Returns the high-resolution `now` counter in milliseconds (includes possibly microseconds in fractional part).\n * !function hrnow () : number;\n */\nglobal.hrnow = function ()\n{\n\treturn performance.now();\n}\n\n/**\n * Returns a function that when called produces a random integer value within the given (inclusive) range.\n * !function randvar (startValue: number, endValue: number) : () => number;\n */\nglobal.randvar = function (a, b)\n{\n\treturn function() { return randr(a, b); };\n}\n\n/**\n * Returns a function that when called returns an item from the specified array at some random index within the (inclusive) range.\n * !function randitem (arr: Array<any>, startValue?: number, endValue?: number) : () => any;\n */\nglobal.randitem = function (arr, a=null, b=null)\n{\n\tif (a === null) a = 0;\n\tif (b === null) b = arr.length - 1;\n\n\treturn function() { return arr[randr(a, b)]; };\n}\n\n/**\n * Returns the parameter 't' where two line segments intersect.\n * !function getLineSegmentIntersection (ls1_x1: number, ls1_y1: number, ls1_x2: number, ls1_y2: number, ls2_x1: number, ls2_y1: number, ls2_x2: number, ls2_y2: number) : number;\n */\nglobal.getLineSegmentIntersection = function (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2)\n{\n\t// Case #1: Identical segments.\n\tif (ls1_x1 == ls2_x1 && ls1_y1 == ls2_y1 && ls1_x2 == ls2_x2 && ls1_y2 == ls2_y2)\n\t\treturn 0;\n\n\tlet inf = 2.0;\n\n\tvar dyA = ls1_y2 - ls1_y1;\n\tvar dxA = ls1_x2 - ls1_x1;\n\tvar dyB = ls2_y2 - ls2_y1;\n\tvar dxB = ls2_x2 - ls2_x1;\n\n\t// Case #2: Horizontal vs. Horizontal\n\tif (dyA == 0 && dyB == 0)\n\t{\n\t\tif (ls1_y1 != ls2_y1) return inf;\n\n\t\tvar x1 = Math.max(ls1_x1, ls2_x1);\n\t\tvar x2 = Math.min(ls1_x2, ls2_x2);\n\n\t\tif (x1 > x2) return inf;\n\n\t\treturn (x1 - ls1_x1) / dxA;\n\t}\n\n\t// Case #3: Vertical vs. Vertical\n\tif (dxA == 0 && dxB == 0)\n\t{\n\t\tif (ls1_x1 != ls2_x1) return inf;\n\n\t\tvar y1 = Math.max(ls1_y1, ls2_y1);\n\t\tvar y2 = Math.min(ls1_y2, ls2_y2);\n\n\t\tif (y1 > y2) return inf;\n\n\t\treturn (y1 - ls1_y1) / dyA;\n\t}\n\n\t// Case #4: Vertical vs. Horizontal or Sloped\n\tif (dxA == 0)\n\t{\n\t\tvar tA = (dyB*(ls1_x1 - ls2_x1) + dxB*(ls2_y1 - ls1_y1)) / (dxB * dyA);\n\t\tif (0 > tA || tA > 1) return inf;\n\n\t\tvar tB = (ls1_x1 - ls2_x1) / dxB; \n\t\tif (0 > tB || tB > 1) return inf;\n\n\t\treturn tA;\n\t}\n\n\t// Case #5: Regular line segments.\n\tvar a = dyA*(ls2_x1 - ls1_x1) + dxA*(ls1_y1 - ls2_y1);\n\tvar b = dyB*dxA - dxB*dyA;\n\n\tif (b == 0) return inf;\n\n\tvar tB = a / b;\n\tif (0 > tB || tB > 1) return inf;\n\n\tvar tA = (dxB*tB + ls2_x1 - ls1_x1) / dxA;\n\tif (0 > tA || tA > 1) return inf;\n\n\treturn tA;\n}\n\n/**\n * Returns boolean indicating if the line segments intersect.\n * !function lineSegmentIntersects (ls1_x1: number, ls1_y1: number, ls1_x2: number, ls1_y2: number, ls2_x1: number, ls2_y1: number, ls2_x2: number, ls2_y2: number) : boolean;\n */\nglobal.lineSegmentIntersects = function (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2)\n{\n\tlet t = getLineSegmentIntersection (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2);\n\treturn t >= 0 && t <= 1.0;\n}\n\n/**\n * Rotates a point by the given angle.\n * !function rotatePoint (angle: number, x: number, y: number) : { x: number, y: number };\n */\n/**\n * Rotates a point by the given angle along the given center.\n * !function rotatePoint (angle: number, x: number, y: number, cx: number, cy: number) : { x: number, y: number };\n */\nglobal.rotatePoint = function (angle, x, y, cx=0, cy=0)\n{\n\treturn {\n\t\tx: cx + (x-cx)*Math.cos(angle) + (y-cy)*Math.sin(angle),\n\t\ty: cy + (y-cy)*Math.cos(angle) - (x-cx)*Math.sin(angle)\n\t};\n}\n\n/**\n * Returns a value snapped to a step within the given range.\n * !function stepValue (value: number, minValue: number, maxValue: number, numSteps: number) : number;\n */\nglobal.stepValue = function (value, minValue, maxValue, numSteps)\n{\n\treturn ((Math.round(numSteps * (value - minValue) / (maxValue - minValue))) / numSteps) * (maxValue - minValue) + minValue;\n}\n\n/**\n * Returns a value that is a factor of the specified step.\n * !function alignValue (value: number, step: number) : number;\n */\nglobal.alignValue = function (value, step)\n{\n\treturn Math.round(value/step)*step;\n}\n\n/**\n * Number of bits for fixed-point number (default is 8).\n * !let FIXED_POINT_BITS : number;\n*/\nglobal.FIXED_POINT_BITS = 8;\n\n/**\n * Returns a fixed-point upscaled value.\n * !function upscale (value: number) : number;\n */\nglobal.upscale = function (value)\n{\n\treturn (value * (1 << FIXED_POINT_BITS)) >> 0;\n}\n\n/**\n * Downscales a fixed-point value to its integer part.\n * !function downscale (value: number) : number;\n */\nglobal.downscale = function (value)\n{\n\treturn value >> FIXED_POINT_BITS;\n}\n\n/**\n * Downscales a fixed-point value to floating point.\n * !function downscalef (value: number) : number;\n */\nglobal.downscalef = function (value)\n{\n\treturn value / (1 << FIXED_POINT_BITS);\n}\n\n/**\n * Aligns a value to its fixed point floating point representation such that downscaling results in an integer.\n * !function falign (value: number) : number;\n */\nglobal.falign = function (value)\n{\n\treturn downscalef(upscale(value));\n}\n\n/**\n * Returns the fractional part of a value.\n * !function fract (value: number) : number;\n */\nglobal.fract = function(value)\n{\n\treturn value - (~~value);\n}\n\n/**\n * Returns the value having the minimum absolute value.\n * !function absmin (a: number, b: number) : number;\n */\nglobal.absmin = function(a, b)\n{\n\treturn Math.abs(a) < Math.abs(b) ? a : b;\n}\n\n/**\n * Returns the value having the maximum absolute value.\n * !function absmax (a: number, b: number) : number;\n */\nglobal.absmax = function(a, b)\n{\n\treturn Math.abs(a) > Math.abs(b) ? a : b;\n}\n\n/**\n * Repeats a string a number of times.\n * !function repeat (str: string, count: number) : string;\n */\nglobal.repeat = function (str, count)\n{\n\tlet out = '';\n\n\twhile (count-- > 0)\n\t\tout += str;\n\n\treturn out;\n}\n\n/**\n * Pads the given value with a character (added to the left) until the specified size is reached.\n * !function lpad (val: any, size: number, char?: string) : string;\n */\nglobal.lpad = function (val, size, char='0')\n{\n\tval = val.toString();\n\treturn repeat(char.charAt(0), size-val.length) + val;\n}\n\n/**\n * Pads the given value with a character (added to the right) until the specified size is reached.\n * !function rpad (val: any, size: number, char?: string) : string;\n */\nglobal.rpad = function (val, size, char='0')\n{\n\tval = val.toString();\n\treturn val + repeat(char.charAt(0), size-val.length);\n}\n\n/**\n * Returns the normalized (0 to 1) value for the given signed-normalized (-1 to 1) value.\n * !function norm (value: number) : number;\n */\nglobal.norm = function (value)\n{\n\treturn (value + 1.0) * 0.5;\n}\n\n/**\n * Returns the signed-normalized (-1 to 1) value for the given normalized (0 to 1) value.\n * !function snorm (value: number) : number;\n */\nglobal.snorm = function (value)\n{\n\treturn value * 2.0 - 1.0;\n}\n\n/**\n * Clamps the specified value to the [x0, x1] range.\n * !function clamp (value: number, x0?: number, x1?: number) : number;\n */\nglobal.clamp = function (value, x0=0.0, x1=1.0)\n{\n\treturn value < x0 ? x0 : (value > x1 ? x1 : value);\n}\n\n/**\n * Maps the given value from [a0, a1] to [b0, b1].\n * !function map (value: number, a0: number, a1: number, b0: number, b1: number) : number;\n */\nglobal.map = function (value, a0, a1, b0, b1)\n{\n\treturn ((value - a0)*(b1 - b0) / (a1 - a0)) + b0;\n}\n\n/**\n * Performs a linear interpolation between `x` and `y` using `a` to weight between them. The return value is computed as x*(1−a)+y*a.\n * !function mix (x: number, y: number, a: number) : number;\n */\nglobal.mix = function (x, y, a)\n{\n\treturn x*(1-a) + y*a;\n}\n","\n//!class Perf\n\n/**\n * \tInitializes the performance monitoring instance.\n *\n * \t@param accumSize - Maximum amount of samples to accumulate.\n * \t@param expectedValue - Expected value (average) of resulting samples.\n * \n * \t!constructor (accumSize: number, expectedValue?: number);\n */\nconst Perf = function (accumSize, expectedValue=null)\n{\n\tthis.data = [ ];\n\tthis.accumSize = accumSize;\n\n\tthis.expectedValue = expectedValue;\n\n\tthis.lastFeed = 0;\n\tthis.lastUpdate = 0;\n\n\tthis.stdSum = 0;\n\tthis.stdCount = 0;\n};\n\nexport default Perf;\n\n/**\n * \tMarks the start time of a performance test.\n * \t!begin() : void;\n */\nPerf.prototype.begin = function () {\n\tthis.startTime = performance.now();\n};\n\n/**\n * \tMarks the end time of the performance test, the elapsed time is fed into the monitor.\n * \t!end() : void;\n */\nPerf.prototype.end = function () {\n\tthis.feed (performance.now() - this.startTime);\n};\n\n/**\n * \tFeeds a value into the monitor, auto-generates a report using `console.log` when the number of samples reaches the `accumSize` specified in the constructor.\n * \t!feed (value: number) : void;\n */\nPerf.prototype.feed = function (value)\n{\n\tthis.data.push(value);\n\tthis.lastFeed++;\n\n\tif (this.data.length != this.accumSize)\n\t\treturn;\n\n\tthis.report();\n\tthis.data = [ ];\n};\n\n/**\n * \tUpdates the `min`, `max`, `avg` `std`, `stdSum` and `stdCount` fields of the object.\n * \t!update () : void;\n */\nPerf.prototype.update = function ()\n{\n\tlet min = null;\n\tlet max = null;\n\tlet avg = 0;\n\tlet std = 0;\n\n\tfor (let i = 0; i < this.data.length; i++)\n\t{\n\t\tmin = min === null ? this.data[i] : Math.min(min, this.data[i]);\n\t\tmax = max === null ? this.data[i] : Math.max(max, this.data[i]);\n\t\tavg += this.data[i];\n\t}\n\n\tavg /= this.data.length;\n\n\tlet e = this.expectedValue !== null ? this.expectedValue : avg;\n\n\tfor (let i = 0; i < this.data.length; i++) std += Math.pow(this.data[i] - e, 2);\n\n\tstd = Math.sqrt(std / this.data.length);\n\n\tthis.stdSum += std;\n\tthis.stdCount++;\n\n\tthis.min = min;\n\tthis.max = max;\n\tthis.avg = avg;\n\tthis.std = std;\n\n\tthis.lastUpdate = this.lastFeed;\n\treturn this;\n};\n\n/**\n * \tReturns a report string with the values selected by the specified flags.\n * \t!report (flags: Perf.Flags) : string;\n */\nPerf.prototype.report = function (flags=255)\n{\n\tlet out = '';\n\n\tif (this.lastUpdate != this.lastFeed)\n\t\tthis.update();\n\n\tif (flags & Perf.Flags.SAMPLES) out += 'n: ' + this.stdCount;\n\tif (flags & Perf.Flags.MIN) out += (out != '' ? ', ' : '') + 'min: ' + this.min;\n\tif (flags & Perf.Flags.MAX) out += (out != '' ? ', ' : '') + 'max: ' + this.max;\n\tif (flags & Perf.Flags.AVG) out += (out != '' ? ', ' : '') + 'avg: ' + this.avg.toFixed(2);\n\tif (flags & Perf.Flags.EXPECTED) out += (out != '' ? ', ' : '') + (this.expectedValue !== undefined ? 'e: ' + this.expectedValue : '');\n\tif (flags & Perf.Flags.STDDEV) out += (out != '' ? ', ' : '') + 'stddev: ' + this.std.toFixed(2);\n\tif (flags & Perf.Flags.AVG_STDDEV) out += (out != '' ? ', ' : '') + 'avg_stddev: ' + (this.stdSum / this.stdCount).toFixed(2)\n\n\treturn out;\n};\n\n//!/class\n\n//!namespace Perf\n//!enum Flags\n\nPerf.Flags = {\n\tSAMPLES: 1,\n\t//!SAMPLES\n\tMIN: 2,\n\t//!MIN\n\tMAX: 4,\n\t//!MAX\n\tAVG: 8,\n\t//!AVG\n\tEXPECTED: 16,\n\t//!EXPECTED\n\tSTDDEV: 32,\n\t//!STDDEV\n\tAVG_STDDEV: 64,\n\t//!AVG_STDDEV\n\tALL: 255,\n\t//!ALL\n};\n\n//!/enum\n","\nimport { Class } from 'rinn';\nimport globals from './globals.js';\nimport System from './system.js';\n\n//![import \"./globals\"]\n//![import \"./system\"]\n\n/*\n *\tDescribes a GL framebuffer.\n */\n\nconst Framebuffer = Class.extend\n({\n\t/**\n\t *\tShader GL identifier.\n\t */\n\tframebufferId: null,\n\n\t/**\n\t *\tAttachments of the framebuffer.\n\t */\n\tattachments: null,\n\n\t/**\n\t *\tType of each attachment.\n\t */\n\tattachmentTypes: null,\n\n\t/**\n\t *\tWidth of the framebuffer.\n\t */\n\twidth: 0,\n\n\t/**\n\t *\tHeight of the framebuffer.\n\t */\n\theight: 0,\n\n\t/**\n\t *\tEnabled draw buffers.\n\t */\n\tdrawBuffers: null,\n\tdrawBufferIds: null,\n\n\t/**\n\t *\tConstructs a GL framebuffer.\n\t *\n\t * \t@param {number} width\n\t * \t@param {number} height\n\t */\n\t__ctor: function (width=null, height=null)\n\t{\n\t\tif (globals.gl === null)\n\t\t\treturn;\n\n\t\tif (attachmentPointIds[0] === null)\n\t\t\tinitAttachmentPointIds(globals.gl);\n\n\t\tthis.framebufferId = globals.gl.createFramebuffer();\n\n\t\tthis.drawBuffers = [];\n\t\tthis.drawBufferIds = [];\n\n\t\t//violet:hardware scaling\n\t\t//this.width = width || System.screenWidth;\n\t\t//this.height = height || System.screenHeight;\n\n\t\tthis.width = width || System.renderer.width;\n\t\tthis.height = height || System.renderer.height;\n\n\t   \tthis.attachments = new Array(Framebuffer.MAX_ATTACHMENT_POINTS).fill(null);\n\t   \tthis.attachmentTypes = new Array(Framebuffer.MAX_ATTACHMENT_POINTS).fill(null);\n\t},\n\n\t/**\n\t * \tDestroys the framebuffer and all attached textures.\n\t */\n\t__dtor: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return;\n\n\t\tfor (let i = 0; i < this.attachments.length; i++)\n\t\t{\n\t\t\tif (this.attachments[i] !== null)\n\t\t\t{\n\t\t\t\tif (this.attachmentTypes[i] === Framebuffer.TEXTURE)\n\t\t\t\t\tgl.deleteTexture(this.attachments[i]);\n\t\t\t\telse\n\t\t\t\t\tgl.deleteRenderbuffer(this.attachments[i]);\n\t\t\t}\n\t\t}\n\n\t\tgl.deleteFramebuffer(this.frameBufferId);\n\t},\n\n\t/**\n\t * \tAttaches a texture to a framebuffer attachment point.\n\t *\n\t * \t@param {number} attachmentPoint\n\t * \t@param {any} texture\n\t * \t@param {number} type\n\t */\n\tattach: function (attachmentPoint, texture, type=null)\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return;\n\n\t\tif (type === null)\n\t\t\ttype = attachmentPoint < Framebuffer.DEPTH ? Framebuffer.TEXTURE : Framebuffer.RENDERBUFFER;\n\n\t\tthis.attachments[attachmentPoint] = texture;\n\t\tthis.attachmentTypes[attachmentPoint] = type;\n\n\t\tif (attachmentPoint < Framebuffer.DEPTH && this.drawBuffers.indexOf(attachmentPoint) === -1)\n\t\t{\n\t\t\tthis.drawBuffers.push(attachmentPoint);\n\t\t\tthis.drawBufferIds.push(attachmentPointIds[attachmentPoint]);\n\t\t}\n\n\t\tlet prev = gl.getParameter(gl.FRAMEBUFFER_BINDING);\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, this.framebufferId);\n\n\t\tswitch (type)\n\t\t{\n\t\t\tcase Framebuffer.TEXTURE:\n\t\t\t\tgl.framebufferTexture2D (gl.FRAMEBUFFER, attachmentPointIds[attachmentPoint], gl.TEXTURE_2D, texture, 0);\n\t\t\t\tbreak;\n\n\t\t\tcase Framebuffer.RENDERBUFFER:\n\t\t\t\tgl.framebufferRenderbuffer (gl.FRAMEBUFFER, attachmentPointIds[attachmentPoint], gl.RENDERBUFFER, texture);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, prev);\n\t},\n\n\t/**\n\t * \tCreates a new color buffer texture.\n\t *\n\t * \t@param {number} width\n\t * \t@param {number} height\n\t * \t@returns {GLTexture}\n\t */\n\tcreateColorBuffer: function (attachmentPoint, width=null, height=null)\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return null;\n\n\t\tif (width === null) width = this.width;\n\t\tif (height === null) height = this.height;\n\n\t\tlet tex = gl.createTexture();\n\t\tgl.bindTexture (gl.TEXTURE_2D, tex);\n\n\t\tgl.texStorage2D (gl.TEXTURE_2D, 1, gl.RGBA8, width, height);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n\t\tthis.attach(attachmentPoint, tex);\n\t\treturn tex;\n\t},\n\n\t/**\n\t * \tCreates a new depth buffer texture.\n\t *\n\t * \t@param {number} width\n\t * \t@param {number} height\n\t * \t@returns {GLTexture}\n\t */\n\tcreateDepthBuffer: function (width=null, height=null)\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return null;\n\n\t\tif (width === null) width = this.width;\n\t\tif (height === null) height = this.height;\n\n\t\tlet tex = gl.createRenderbuffer();\n\t\tgl.bindRenderbuffer (gl.RENDERBUFFER, tex);\n\t\tgl.renderbufferStorage (gl.RENDERBUFFER, gl.DEPTH_COMPONENT24, width, height);\n\n\t\tthis.attach(Framebuffer.DEPTH, tex);\n\t\treturn tex;\n\t},\n\n\t/**\n\t * \tCreates a new stencil buffer texture.\n\t *\n\t * \t@param {number} width\n\t * \t@param {number} height\n\t * \t@returns {GLTexture}\n\t */\n\tcreateStencilBuffer: function (width=null, height=null)\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return null;\n\n\t\tif (width === null) width = this.width;\n\t\tif (height === null) height = this.height;\n\n\t\tlet tex = gl.createTexture();\n\t\tgl.bindTexture (gl.TEXTURE_2D, tex);\n\n\t\tgl.texStorage2D (gl.TEXTURE_2D, 1, gl.DEPTH_STENCIL, width, height);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n\t\tthis.attach(Framebuffer.DEPTH_STENCIL, tex);\n\t\treturn tex;\n\t},\n\n\t/**\n\t * \tReturns a texture from the specified attachment point.\n\t * \t@param {number} attachmentPoint \n\t */\n\tgetTexture: function (attachmentPoint)\n\t{\n\t\tif (this.attachmentTypes[attachmentPoint] !== Framebuffer.TEXTURE)\n\t\t\treturn null;\n\n\t\treturn this.attachments[attachmentPoint];\n\t},\n\n\t/**\n\t * \tReturns a renderbuffer from the specified attachment point.\n\t * \t@param {number} attachmentPoint \n\t */\n\tgetRenderBuffer: function (attachmentPoint)\n\t{\n\t\tif (this.attachmentTypes[attachmentPoint] !== Framebuffer.RENDERBUFFER)\n\t\t\treturn null;\n\n\t\treturn this.attachments[attachmentPoint];\n\t},\n\n\t/**\n\t *\tBinds the framebuffer for further operations.\n\t */\n\tbind: function()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return;\n\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, this.framebufferId);\n\n\t\tgl.drawBuffers (this.drawBufferIds);\n\t\tgl.viewport (0, 0, this.width, this.height);\n\t},\n\n\t/**\n\t *\tBinds the default framebuffer.\n\t */\n\tunbind: function()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return;\n\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, null);\n\n\t\tgl.drawBuffers (defaultDrawBuffers);\n\t\tgl.viewport (0, 0, System.renderer.width, System.renderer.height);\n\t},\n\n\t/**\n\t *\tReturns the status of the framebuffer. Returns true if the framebuffer is complete.\n\t */\n\tisComplete: function()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return true;\n\n\t\tlet prev = gl.getParameter(gl.FRAMEBUFFER_BINDING);\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, this.framebufferId);\n\t\tlet result = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, prev);\n\n\t\treturn result === gl.FRAMEBUFFER_COMPLETE;\n\t}\n\n});\n\n/**\n *\tTypes of attachment objects.\n */\nFramebuffer.TEXTURE = 1;\nFramebuffer.RENDERBUFFER = 2;\n\n/**\n *\tAvailable attachment points.\n */\nFramebuffer.COLOR0\t\t\t= 0;\nFramebuffer.COLOR1\t\t\t= 1;\nFramebuffer.COLOR2\t\t\t= 2;\nFramebuffer.COLOR3\t\t\t= 3;\nFramebuffer.COLOR4\t\t\t= 4;\nFramebuffer.COLOR5\t\t\t= 5;\nFramebuffer.COLOR6\t\t\t= 6;\nFramebuffer.COLOR7\t\t\t= 7;\nFramebuffer.DEPTH \t\t\t= 8;\nFramebuffer.STENCIL \t\t= 9;\nFramebuffer.DEPTH_STENCIL\t= 10;\n\nFramebuffer.MAX_ATTACHMENT_POINTS = 11;\n\n/**\n *\tGL framebuffer attachment point IDs.\n */\nconst attachmentPointIds = new Array(Framebuffer.MAX_ATTACHMENT_POINTS).fill(null);\nconst defaultDrawBuffers = new Array(1).fill(null);\n\n/**\n * \tInitializes the attachment point IDs.\n */\nconst initAttachmentPointIds = function (gl)\n{\n\tdefaultDrawBuffers[0] = gl.BACK;\n\n\tattachmentPointIds[Framebuffer.COLOR0] = gl.COLOR_ATTACHMENT0;\n\tattachmentPointIds[Framebuffer.COLOR1] = gl.COLOR_ATTACHMENT1;\n\tattachmentPointIds[Framebuffer.COLOR2] = gl.COLOR_ATTACHMENT2;\n\tattachmentPointIds[Framebuffer.COLOR3] = gl.COLOR_ATTACHMENT3;\n\tattachmentPointIds[Framebuffer.COLOR4] = gl.COLOR_ATTACHMENT4;\n\tattachmentPointIds[Framebuffer.COLOR5] = gl.COLOR_ATTACHMENT5;\n\tattachmentPointIds[Framebuffer.COLOR6] = gl.COLOR_ATTACHMENT6;\n\tattachmentPointIds[Framebuffer.COLOR7] = gl.COLOR_ATTACHMENT7;\n\tattachmentPointIds[Framebuffer.DEPTH] = gl.DEPTH_ATTACHMENT;\n\tattachmentPointIds[Framebuffer.STENCIL] = gl.STENCIL_ATTACHMENT;\n\tattachmentPointIds[Framebuffer.DEPTH_STENCIL] = gl.DEPTH_STENCIL_ATTACHMENT;\n};\n\nexport default Framebuffer;\n","\nimport { Rinn, Class } from 'rinn';\n\n//:/**\n//: * \tDescribes an object that can be drawn to a Canvas.\n//: */\n\n//!class Drawable\n\nconst Drawable = Class.extend\n({\n\tclassName: 'Drawable',\n\n\t/**\n\t * Image resource.\n\t * @protected\n\t * !readonly resource: Texture;\n\t */\n\tresource: null,\n\n\t/**\n\t * Logical width of the drawable.\n\t * @protected\n\t * !readonly width: number;\n\t */\n\twidth: 0,\n\n\t/**\n\t * Logical height of the drawable.\n\t * @protected\n\t * !readonly height: number;\n\t */\n\theight: 0,\n\n\t/**\n\t * Frame source X-offset in physical units.\n\t * @protected\n\t * !readonly sx: number;\n\t */\n\tsx: 0,\n\n\t/**\n\t * Frame source Y-position in physical units.\n\t * @protected\n\t * !readonly sy: number;\n\t */\n\tsy: 0,\n\n\t/**\n\t * Frame source width in physical units.\n\t * @protected\n\t * !readonly swidth: number;\n\t */\n\tswidth: 0,\n\n\t/**\n\t * Frame source height in physical units.\n\t * @protected\n\t * !readonly sheight: number;\n\t */\n\tsheight: 0,\n\n\t//TODO rename `resources` to `texture`\n\n\t/**\n\t * Initializes the instance.\n\t * !constructor();\n\t */\n\t__ctor: function (resource=null, width=null, height=null)\n\t{\n\t\tif (Rinn.isInstanceOf(resource, Drawable))\n\t\t{\n\t\t\tlet drawable = resource;\n\n\t\t\tthis.resource = drawable.resource;\n\t\t\tthis.width = width ?? drawable.width;\n\t\t\tthis.height = height ?? drawable.height;\n\n\t\t\tthis.sx = drawable.sx;\n\t\t\tthis.sy = drawable.sy;\n\t\t\tthis.swidth = drawable.swidth;\n\t\t\tthis.sheight = drawable.sheight;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.resource = resource;\n\n\t\t\tthis.sx = 0;\n\t\t\tthis.sy = 0;\n\n\t\t\tif (this.resource)\n\t\t\t{\n\t\t\t\tthis.width = width ?? resource.targetWidth;\n\t\t\t\tthis.height = height ?? resource.targetHeight;\n\n\t\t\t\tthis.swidth = resource.width;\n\t\t\t\tthis.sheight = resource.height;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.width = width;\n\t\t\t\tthis.height = height;\n\n\t\t\t\tthis.swidth = width;\n\t\t\t\tthis.sheight = height;\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Returns the actual independent drawable object.\n\t * !getDrawable(): Drawable;\n\t */\n\tgetDrawable: function()\n\t{\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the underlying Image object, can be used directly with Canvas.drawImage.\n\t * @deprecated\n\t * !getImage(): Texture;\n\t * TODO remove in next major version\n\t */\n\tgetImage: function()\n\t{\n\t\treturn this.resource;\n\t},\n\n\t/**\n\t * Returns the underlying texture object.\n\t * !getTexture(): Texture;\n\t */\n\tgetTexture: function()\n\t{\n\t\treturn this.resource;\n\t},\n\n\t/**\n\t * Resizes the logical dimensions of the drawable.\n\t * !resize (width: number|boolean|null, height: number|boolean|null) : Drawable;\n\t */\n\tresize: function (width, height)\n\t{\n\t\twidth = width !== null ? (width !== true ? width : true) : this.width;\n\t\theight = height !== null ? (height !== true ? height : true)  : this.height;\n\n\t\tif (width === true)\n\t\t\twidth = height*(this.width/this.height);\n\t\telse if (height === true)\n\t\t\theight = width*(this.height/this.width);\n\n\t\tthis.width = width;\n\t\tthis.height = height;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Draws the drawable on the canvas.\n\t * !draw (g: Canvas, x: number, y: number, width?: number|null, height?: number|null) : void;\n\t */\n\tdraw: function (g, x, y, width=null, height=null)\n\t{\n\t\twidth = width ?? this.width;\n\t\theight = height ?? this.height;\n\n\t\tthis.drawf(g, this.sx, this.sy, this.swidth, this.sheight, x, y, width, height);\n\t},\n\n\t/**\n\t * Draws a section of the drawable on the canvas using full parameters.\n\t * !drawf (g: Canvas, sx:number, sy:number, swidth:number, sheight:number, tx:number, ty:number, twidth:number, theight:number, fwidth?:number|null, fheight?:number|null) : void;\n\t */\n\tdrawf: function (g, sx, sy, swidth, sheight, tx, ty, twidth, theight, fwidth=null, fheight=null)\n\t{\n\t\tg.drawImage (this.resource,\n\t\t\tsx, sy, swidth, sheight,\n\t\t\ttx, ty, twidth, theight,\n\t\t\tnull, null, fwidth ?? twidth, fheight ?? theight);\n\t},\n\n\t/**\n\t * Renders the drawable for the specified element.\n\t * !render (g: Canvas, elem: Element) : void;\n\t */\n\trender: function (g, elem)\n\t{\n\t\tthis.draw (g, elem.bounds.x1, elem.bounds.y1, elem.bounds.width(), elem.bounds.height());\n\t}\n});\n\n\n/**\n * Nine-Slice Drawable.\n */\nconst NineSlice = Drawable.extend\n({\n\tclassName: 'DrawableNineSlice',\n\n\tss: null,\n\tstartingIndex: 0,\n\n\t__ctor: function (spritesheet, startingIndex)\n\t{\n\t\tthis._super.Drawable.__ctor(spritesheet);\n\n\t\tif (spritesheet === null || !Class.instanceOf(spritesheet, 'Spritesheet'))\n\t\t\tthrow new Error('NineSlice: spritesheet required');\n\n\t\tthis.ss = spritesheet;\n\t\tthis.startingIndex = startingIndex;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.ss);\n\t},\n\n\tgetTexture: function()\n\t{\n\t\treturn this.ss.getTexture();\n\t},\n\n\tdraw: function (g, x, y, width, height)\n\t{\n\t\tconst k = this.startingIndex;\n\n\t\tlet leftWidth = this.ss.getFrame(k+0).width;\n\t\tlet rightWidth = this.ss.getFrame(k+2).width;\n\t\tlet midWidth = this.ss.getFrame(k+1).width;\n\n\t\tlet topHeight = this.ss.getFrame(k+0).height;\n\t\tlet bottomHeight = this.ss.getFrame(k+6).height;\n\t\tlet midHeight = this.ss.getFrame(k+3).height;\n\n\t\tlet n = int((width - leftWidth - rightWidth) / midWidth);\n\t\tlet m = int((height - topHeight - bottomHeight) / midHeight);\n\n\t\tlet x1 = x;\n\t\tlet y1 = y;\n\n\t\t// Corners\n\t\tthis.ss.getFrame(k+0).draw(g, x1, y1);\n\t\tthis.ss.getFrame(k+2).draw(g, x1 + leftWidth + n*midWidth, y1);\n\t\tthis.ss.getFrame(k+6).draw(g, x1, y1 + topHeight + m*midHeight);\n\t\tthis.ss.getFrame(k+8).draw(g, x1 + leftWidth + n*midWidth, y1 + topHeight + m*midHeight);\n\n\t\t// Top/Bottom\n\t\tfor (let i = 0; i < n; i++) {\n\t\t\tthis.ss.getFrame(k+1).draw(g, x1 + leftWidth + i*midWidth, y1);\n\t\t\tthis.ss.getFrame(k+7).draw(g, x1 + leftWidth + i*midWidth, y1 + topHeight + m*midHeight);\n\t\t}\n\n\t\t// Left/Right\n\t\tfor (let i = 0; i < m; i++) {\n\t\t\tthis.ss.getFrame(k+3).draw(g, x1, y1 + topHeight + i*midHeight);\n\t\t\tthis.ss.getFrame(k+5).draw(g, x1 + leftWidth + n*midWidth, y1 + topHeight + i*midHeight);\n\t\t}\n\n\t\t// Center\n\t\tfor (let j = 0; j < m; j++)\n\t\tfor (let i = 0; i < n; i++) {\n\t\t\tthis.ss.getFrame(k+4).draw(g, x1 + leftWidth + i*midWidth, y1 + topHeight + j*midHeight);\n\t\t}\n\t}\n});\n\nRecycler.createPool(NineSlice, 512);\n\n\n/**\n * Repeated drawable.\n */\nconst Repeated = Drawable.extend\n({\n\tclassName: 'DrawableRepeated',\n\n\tdrawable: null,\n\n\t__ctor: function (drawable)\n\t{\n\t\tthis._super.Drawable.__ctor(drawable);\n\t\tthis.drawable = drawable;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.drawable);\n\t},\n\n\tdrawf: function (g, sx, sy, swidth, sheight, tx, ty, twidth, theight, fwidth=null, fheight=null)\n\t{\n\t\tthis.drawable.drawf(g, sx, sy, swidth, sheight, tx, ty, twidth, theight, this.width, this.height);\n\t}\n});\n\nRecycler.createPool(Repeated, 512);\n\n\n/**\n * Clipped drawable.\n */\nconst Clipped = Drawable.extend\n({\n\tclassName: 'DrawableClipped',\n\n\tdrawable: null,\n\n\t__ctor: function (drawable)\n\t{\n\t\tthis._super.Drawable.__ctor(drawable);\n\t\tthis.drawable = drawable;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.drawable);\n\t},\n\n\tdraw: function (g, x, y, width=null, height=null)\n\t{\n\t\tlet img = this.getTexture();\n\t\n\t\twidth = width ?? this.width;\n\t\theight = height ?? this.height;\n\n\t\tthis.drawable.drawf (g,\n\t\t\tthis.drawable.sx, this.drawable.sy, width*img.rscale, height*img.rscale,\n\t\t\tx, y, width, height);\n\t}\n});\n\nRecycler.createPool(Clipped, 512);\n\n\n/**\n * Centered drawable.\n */\nconst Centered = Drawable.extend\n({\n\tclassName: 'DrawableCentered',\n\n\tdrawable: null,\n\toffsX: 0,\n\toffsY: 0,\n\n\t__ctor: function (drawable, offsX, offsY)\n\t{\n\t\tthis._super.Drawable.__ctor(drawable);\n\n\t\tthis.drawable = drawable;\n\t\tthis.offsX = offsX;\n\t\tthis.offsY = offsY;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.drawable);\n\t},\n\n\tdraw: function (g, x, y, width=null, height=null)\n\t{\n\t\twidth = width ?? this.width;\n\t\theight = height ?? this.height;\n\n\t\tthis.drawable.draw(g, x+this.offsX+(width-this.width)*0.5, y+this.offsY+(height-this.height)*0.5, this.width, this.height);\n\t}\n});\n\nRecycler.createPool(Centered, 512);\n\n\n/**\n * Static drawable.\n */\nconst Static = Drawable.extend\n({\n\tclassName: 'DrawableStatic',\n\n\tdrawable: null,\n\toffsX: 0,\n\toffsY: 0,\n\n\t__ctor: function (drawable, offsX, offsY)\n\t{\n\t\tthis._super.Drawable.__ctor(drawable);\n\n\t\tthis.drawable = drawable;\n\t\tthis.offsX = offsX;\n\t\tthis.offsY = offsY;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.drawable);\n\t},\n\n\tdraw: function (g, x, y, width=null, height=null)\n\t{\n\t\tthis.drawable.draw(g, x+this.offsX, y+this.offsY, width, height);\n\t}\n});\n\nRecycler.createPool(Static, 512);\n\n\n/**\n * Drawable group.\n */\nconst Group = Drawable.extend\n({\n\tclassName: 'DrawableGroup',\n\n\tlist: null,\n\n\t__ctor: function (list)\n\t{\n\t\tthis._super.Drawable.__ctor();\n\n\t\tthis.list = list;\n\n\t\tthis.width = 0;\n\t\tthis.height = 0;\n\n\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t{\n\t\t\tif (this.list[i].width > this.width) this.width = this.list[i].width;\n\t\t\tif (this.list[i].height > this.height) this.height = this.list[i].height;\n\t\t}\n\n\t\tthis.swidth = this.width;\n\t\tthis.sheight = this.height;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tif (this.list !== null)\n\t\t{\n\t\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\t\tdispose(this.list[i]);\n\n\t\t\tthis.list = null;\n\t\t}\n\t},\n\n\tdraw: function (g, x, y, width=null, height=null)\n\t{\n\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\tthis.list[i].draw(g, x, y, width, height);\n\t},\n\n\trender: function (g, elem)\n\t{\n\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\tthis.list[i].render(g, elem);\n\t}\n});\n\nRecycler.createPool(Group, 512);\n\n\n/**\n * Draws the given drawable mirrored horizontally.\n */\nconst MirrorX = Drawable.extend\n({\n\tclassName: 'DrawableMirrorX',\n\n\tdrawable: null,\n\n\t__ctor: function (drawable)\n\t{\n\t\tthis._super.Drawable.__ctor(drawable);\n\t\tthis.drawable = drawable;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.drawable);\n\t},\n\n\tdrawf: function (g, sx, sy, swidth, sheight, tx, ty, twidth, theight, fwidth=null, fheight=null)\n\t{\n\t\tg.pushMatrix();\n\t\tg.translate(tx+twidth, ty);\n\t\tg.scale(-1, 1);\n\t\tthis.drawable.drawf(g, sx, sy, swidth, sheight, 0, 0, twidth, theight, fwidth, fheight);\n\t\tg.popMatrix();\n\t}\n});\n\nRecycler.createPool(MirrorX, 512);\n\n\n/**\n * Draws the given drawable mirrored vertically.\n */\nconst MirrorY = Drawable.extend\n({\n\tclassName: 'DrawableMirrorY',\n\n\tdrawable: null,\n\n\t__ctor: function (drawable)\n\t{\n\t\tthis._super.Drawable.__ctor(drawable);\n\t\tthis.drawable = drawable;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.drawable);\n\t},\n\n\tdrawf: function (g, sx, sy, swidth, sheight, tx, ty, twidth, theight, fwidth=null, fheight=null)\n\t{\n\t\tg.pushMatrix();\n\t\tg.translate(tx, ty+theight);\n\t\tg.scale(1, -1);\n\t\tthis.drawable.drawf(g, sx, sy, swidth, sheight, 0, 0, twidth, theight, fwidth, fheight);\n\t\tg.popMatrix();\n\t}\n});\n\nRecycler.createPool(MirrorY, 512);\n\n\n/**\n * Drawable made with a composition of tiles from a nine-slice spritesheet to create a rectangle.\n * !static nineSlice (spritesheet: object, startingIndex?:number|0) : Drawable;\n */\n//violet: type fixup\n//static nineSlice (spritesheet: Spritesheet, startingIndex?:number|0) : Drawable;\nDrawable.nineSlice = function (spritesheet, startingIndex=0) { return NineSlice.Pool.alloc(spritesheet, startingIndex); }\n/**\n * Drawable made with a composition of tiles from a nine-slice spritesheet to create a rectangle.\n * !nineSlice (startingIndex?:number|0) : Drawable;\n */\nDrawable.prototype.nineSlice = function(startingIndex=0) { return NineSlice.Pool.alloc(this, startingIndex); }\n\n/**\n * Drawable tiles to the target size.\n * !static repeated (drawable: Drawable) : Drawable;\n */\nDrawable.repeated = function (drawable) { return Repeated.Pool.alloc(drawable); }\n/**\n * Drawable tiles to the target size.\n * !repeated () : Drawable;\n */\nDrawable.prototype.repeated = function () { return Repeated.Pool.alloc(this); }\n\n/**\n * Drawable clipped to the target size.\n * !static clipped (drawable: Drawable) : Drawable;\n */\nDrawable.clipped = function (drawable) { return Clipped.Pool.alloc(drawable); }\n/**\n * Drawable clipped to the target size.\n * !clipped () : Drawable;\n */\nDrawable.prototype.clipped = function () { return Clipped.Pool.alloc(this); }\n\n/**\n * Drawable centered to the target rectangle.\n * !static centered (drawable: Drawable, offsX?: number, offsY?: number) : Drawable;\n */\nDrawable.centered = function (drawable, offsX, offsY) { return Centered.Pool.alloc(drawable, offsX, offsY); }\n/**\n * Drawable centered to the target rectangle.\n * !centered (offsX?: number, offsY?: number) : Drawable;\n */\nDrawable.prototype.centered = function (offsX, offsY) { return Centered.Pool.alloc(this, offsX, offsY); }\n\n/**\n * Drawable as-is without stretching it.\n * !static static (drawable: Drawable, offsX?: number, offsY?: number) : Drawable;\n */\nDrawable.static = function (drawable, offsX, offsY) { return Static.Pool.alloc(drawable, offsX, offsY); }\n/**\n * Drawable as-is without stretching it.\n * !static (offsX?: number, offsY?: number) : Drawable;\n */\nDrawable.prototype.static = function (offsX, offsY) { return Static.Pool.alloc(this, offsX, offsY); }\n\n/**\n * Creates a drawable group.\n * !static group (...args: Array<Drawable>) : Drawable;\n */\nDrawable.group = function (...args) { return Group.Pool.alloc(args); }\n\n/**\n * Drawable mirrored horizontally.\n * !static mirrorX (drawable: Drawable) : Drawable;\n */\nDrawable.mirrorX = function (drawable) { return MirrorX.Pool.alloc(drawable); }\n/**\n * Drawable mirrored horizontally.\n * !mirrorX () : Drawable;\n */\nDrawable.prototype.mirrorX = function () { return MirrorX.Pool.alloc(this); }\n\n/**\n * Drawable mirrored vertically.\n * !static mirrorY (drawable: Drawable) : Drawable;\n */\nDrawable.mirrorY = function (drawable) { return MirrorY.Pool.alloc(drawable); }\n/**\n * Drawable mirrored vertically.\n * !mirrorY () : Drawable;\n */\nDrawable.prototype.mirrorY = function () { return MirrorY.Pool.alloc(this); }\n\n//!/class\n\n//!namespace Drawable\n//!namespace Pool\n\n\t/**\n\t * Allocates a drawable object.\n\t * !function alloc () : Drawable;\n\t */\n\nRecycler.createPool(Drawable, 512);\nexport default Drawable;\n","\nimport Drawable from '../flow/drawable.js';\n\nexport default Drawable.extend\n({\n\tclassName: 'DrawableResource',\n\n\tr: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type !== 'image')\n\t\t\tthrow new Error ('Resource is not an image.');\n\n\t\tthis._super.Drawable.__ctor(r.data, r.width, r.height);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\t}\n});\n","\nimport Canvas from '../system/canvas.js';\nimport Drawable from '../flow/drawable.js';\n\n//![import \"../system/canvas\"]\n\nexport default Drawable.extend\n({\n\tclassName: 'DrawableCustom',\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != 'object')\n\t\t\tthrow new Error ('Resource is not an object.');\n\n\t\tthis._super.Drawable.__ctor(null, r.width, r.height);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\t},\n\n\tinit: function (callback)\n\t{\n\t\tCanvas.renderImage(this.r.width, this.r.height,\n\t\t(g) => {\n\t\t\tif (this.r.draw !== null && typeof(this.r.draw) === 'function') {\n\t\t\t\tthis.r.draw(g, this.r);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tg.fillStyle(this.r.color);\n\t\t\t\tg.fillRect(0, 0, this.r.width, this.r.height);\n\t\t\t}\n\t\t},\n\t\t(img) => {\n\t\t\tthis.resource = img;\n\t\t\tthis.swidth = this.resource.width;\n\t\t\tthis.sheight = this.resource.height;\n\t\t\tcallback();\n\t\t});\n\t}\n});\n","\nimport Drawable from '../flow/drawable.js';\n\n/*\n\tIf source is \"image\":\n\t\tconfig: {\n\t\t\tsheetWidth: int, frameWidth: int, frameHeight: int?, numFrames: int?\n\t\t\t--OR--\n\t\t\tnumFrames: int, frameWidth: int, frameHeight: int?\n\t\t\t--OR--\n\t\t\tcoords: Array<[x,y,w,h]>\n\t\t}\n\n\tIf source is \"images\":\n\t\tconfig: {\n\t\t\tframeWidth: int, frameHeight: int\n\t\t}\n\t\t\n\tNOTE: The sheetWidth, frameWidth and frameHeight should reflect the real image size. The system will automatically scale it if the source image is smaller/bigger.\n*/\n\nconst FrameDrawable = Drawable.extend\n({\n\tspritesheet: null,\n\tframeIndex: 0,\n\n\t__ctor: function (spritesheet, frameIndex, texture, sx, sy, sw, sh, width=null, height=null)\n\t{\n\t\tthis._super.Drawable.__ctor(null, width ?? spritesheet.width, height ?? spritesheet.height);\n\n\t\tthis.spritesheet = spritesheet;\n\t\tthis.frameIndex = frameIndex;\n\n\t\tthis.sx = sx;\n\t\tthis.sy = sy;\n\t\tthis.swidth = sw;\n\t\tthis.sheight = sh;\n\n\t\tthis.resource = texture;\n\t}\n});\n\nexport default Drawable.extend\n({\n\tclassName: 'Spritesheet',\n\n\tframeCache: null,\n\tnumFrames: 0,\n\n\tframeWidth: 0,\n\tframeHeight: 0,\n\n\t__ctor: function (r)\n\t{\n\t\tthis._super.Drawable.__ctor();\n\n\t\tif ((r.type != 'image' && r.type != 'images'))\n\t\t\tthrow new Error ('Resource is not a sprite sheet.');\n\n\t\tlet r_scale, v_scale;\n\n\t\tif (r.type == 'image')\n\t\t{\n\t\t\tif (!r.config.sheetWidth && (!r.config.numFrames || !r.config.frameWidth) && !r.config.coords)\n\t\t\t\tthrow new Error (r.resName + ': required `sheetWidth` or `numFrames` with `frameWidth` or `coords` array.');\n\n\t\t\tif (!r.config.sheetWidth)\n\t\t\t\tr.config.sheetWidth = r.width;\n\n\t\t\tif (!r.config.frameHeight)\n\t\t\t\tr.config.frameHeight = r.data.height;\n\n\t\t\tr_scale = r.data.width / r.config.sheetWidth;\n\t\t\tv_scale = r.width / r.config.sheetWidth;\n\t\t}\n\t\telse // r.type == 'images'\n\t\t{\n\t\t\tif (!r.config) r.config = { };\n\n\t\t\tif (!r.config.frameWidth)\n\t\t\t\tr.config.frameWidth = r.data[0].width;\n\n\t\t\tif (!r.config.frameHeight)\n\t\t\t\tr.config.frameHeight = r.data[0].height;\n\n\t\t\tr_scale = r.data[0].data.width / r.config.frameWidth;\n\t\t\tv_scale = r.data[0].width / r.config.frameWidth;\n\t\t}\n\n\t\t// Physical frame dimensions.\n\t\tthis.frameWidth = (r.config.frameWidth * r_scale);\n\t\tthis.frameHeight = (r.config.frameHeight * r_scale);\n\n\t\t// Logical frame dimensions.\n\t\tthis.width = r.config.frameWidth * v_scale;\n\t\tthis.height = r.config.frameHeight * v_scale;\n\n\t\t// Load each frame into its own FrameDrawable.\n\t\tlet numCols, numRows;\n\n\t\tif (r.type == 'image')\n\t\t{\n\t\t\tnumCols = int(r.data.width / this.frameWidth);\n\t\t\tnumRows = Math.ceil(r.data.height / this.frameHeight);\n\n\t\t\tif (r.config.coords)\n\t\t\t\tthis.numFrames = r.config.coords.length;\n\t\t\telse\n\t\t\t\tthis.numFrames = r.config.numFrames || (numCols * numRows);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnumCols = numRows = 0;\n\t\t\tthis.numFrames = r.data.length;\n\t\t}\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\t// Prepare frameCache.\n\t\tthis.frameCache = { };\n\n\t\tfor (let i = 0; i < this.numFrames; i++)\n\t\t{\n\t\t\tlet frameObject;\n\n\t\t\tif (this.r.config.coords)\n\t\t\t{\n\t\t\t\tframeObject = new FrameDrawable (this, i, this.r.data, \n\t\t\t\t\tthis.r.config.coords[i][0]*r_scale, this.r.config.coords[i][1]*r_scale, this.r.config.coords[i][2]*r_scale, this.r.config.coords[i][3]*r_scale,\n\t\t\t\t\tthis.r.config.coords[i][2]*v_scale, this.r.config.coords[i][3]*v_scale);\n\t\t\t}\n\t\t\telse if (this.numCols != 0)\n\t\t\t{\n\t\t\t\tframeObject = new FrameDrawable (this, i, this.r.data, \n\t\t\t\t\t(i % numCols) * this.frameWidth, int(i / numCols) * this.frameHeight, this.frameWidth, this.frameHeight);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tframeObject = new FrameDrawable (this, i, this.r.data[i].data, \n\t\t\t\t\t0, 0, this.frameWidth, this.frameHeight);\n\t\t\t}\n\t\n\t\t\tthis.frameCache[i] = frameObject;\n\t\t}\n\t},\n\n\t/**\n\t * Returns a frame from the spritesheet.\n\t * @param frameIndex - The index of the frame to return.\n\t * !getFrame (frameIndex: number) : Drawable;\n\t */\n\tgetFrame: function (frameIndex)\n\t{\n\t\tif (frameIndex < 0 || frameIndex >= this.numFrames)\n\t\t\tthrow new Error ('frameIndex out of range');\n\n\t\treturn this.frameCache[frameIndex];\n\t},\n\n\t/**\n\t * Returns the texture related to the spritesheet.\n\t * !getTexture() : Texture;\n\t */\n\tgetTexture: function()\n\t{\n\t\treturn this.getFrame(0).getTexture();\n\t},\n\n\t/**\n\t * Returns the default drawable of the spritesheet (first frame).\n\t * !getDrawable() : Drawable;\n\t */\n\tgetDrawable: function()\n\t{\n\t\treturn this.getFrame(0);\n\t}\n});\n","\nimport { Class } from 'rinn';\nimport Spritesheet from './spritesheet.js';\nimport System from '../system/system.js';\nimport List from '../utils/list.js';\nimport Recycler from '../utils/recycler.js';\nimport Drawable from '../flow/drawable.js';\n\n//![import \"./spritesheet\"]\n//![import \"../system/system\"]\n//![import \"../utils/list\"]\n//![import \"../utils/recycler\"]\n\n/*\n\tanim: {\n\t\tdef: string, fps: int?,\n\n\t\tseq: {\n\t\t\tseq1: { loop: bool?, group: [ [int, int, ...], ... ] },\n\t\t\tseq2: { loop: bool?, group: [ [int, int, ...], ... ] },\n\t\t\tseq2: { loop: bool?, group: \"0-12\" },\n\t\t\tseq2: { loop: bool?, group: \"4 1 1 2 3\" },\n\t\t}\n\t}\n\n\tNOTE: When specifying a group such as \"0,12\" it means to draw tiles 0 and the 12 in that single frame.\n*/\n\nexport const Animation = Drawable.extend\n({\n\tclassName: 'Animation',\n\n\tseq: null, seq_i: 0, n_seq: null,\n\tqueue: null,\n\n\tfps: 0, frameDuration: 0, time: 0,\n\n\tframeNumber: -1,\n\n\tfinished: false,\n\t_paused: false,\n\n\tfinishedCallback: null,\n\tfinishedCallbackHandler: null,\n\tfinishedCallbackContext: null,\n\n\tframeCallback: null,\n\n\t__ctor: function (anim, seq, fps)\n\t{\n\t\tthis._super.Drawable.__ctor(anim.getTexture(), anim.width, anim.height);\n\n\t\tthis.anim = anim;\n\t\tthis.queue = List.Pool.alloc();\n\n\t\tthis.seq = seq;\n\t\tthis.seq_i = 0;\n\t\tthis.n_seq = null;\n\n\t\tthis.frameNumber = -1;\n\t\tthis.finished = false;\n\t\tthis._paused = false;\n\n\t\tthis.finishedCallback = null;\n\t\tthis.finishedCallbackHandler = null;\n\t\tthis.finishedCallbackContext = null;\n\t\tthis.frameCallback = null;\n\n\t\tthis.fps = fps;\n\t\tthis.setFps (this.seq.fps || this.fps);\n\t},\n\n\t__dtor: function ()\n\t{\n\t\tthis.queue.free();\n\n\t\tif (this.finishedCallbackHandler)\n\t\t\tthis.finishedCallbackHandler.free();\n\n\t\tif (this.finishedCallbackContext)\n\t\t\tthis.finishedCallbackContext.free();\n\t},\n\n\tsetFps: function (fps)\n\t{\n\t\tthis.frameDuration = 1.0 / fps;\n\t\tthis.time = 0;\n\n\t\treturn this;\n\t},\n\n\tpaused: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._paused;\n\n\t\tthis._paused = value;\n\t\treturn this;\n\t},\n\n\tinitialDelay: function (dt)\n\t{\n\t\tthis.time = -dt;\n\t\treturn this;\n\t},\n\n\tonFinished: function (callback)\n\t{\n\t\tthis.finishedCallback = callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Adds a callback to be called when the animation finishes. Use `false` to clear all callbacks.\n\t */\n\tthen: function (callback, context=null)\n\t{\n\t\tif (callback === false && this.finishedCallback === this.thenCallback)\n\t\t{\n\t\t\tthis.finishedCallbackHandler.clear();\n\t\t\tthis.finishedCallbackContext.clear();\n\t\t}\n\n\t\tif (!callback) return this;\n\n\t\tif (this.finishedCallback !== this.thenCallback)\n\t\t{\n\t\t\tthis.finishedCallback = this.thenCallback;\n\t\t\tthis.finishedCallbackHandler = List.Pool.alloc();\n\t\t\tthis.finishedCallbackContext = List.Pool.alloc();\n\t\t}\n\n\t\tthis.finishedCallbackHandler.push(callback);\n\t\tthis.finishedCallbackContext.push(context);\n\t\treturn this;\n\t},\n\n\tthenCallback: function ()\n\t{\n\t\tif (!this.finishedCallbackHandler.length)\n\t\t\treturn false;\n\n\t\tlet context = this.finishedCallbackContext.shift();\n\t\tthis.finishedCallbackHandler.shift()(this, context);\n\t},\n\n\tonFrame: function (fn)\n\t{\n\t\tthis.frameCallback = fn;\n\t\treturn this;\n\t},\n\n\tsetFrame: function (i)\n\t{\n\t\tthis.seq_i = int(i) % this.seq.group.length;\n\t\treturn this;\n\t},\n\n\tgetFrame: function (normalized)\n\t{\n\t\treturn normalized === true ? (this.seq_i / (this.seq.group.length-1)) : this.seq_i;\n\t},\n\n\tgetLength: function ()\n\t{\n\t\treturn this.seq.group.length;\n\t},\n\n\t/**\n\t * Draws a section of the drawable on the canvas using full parameters.\n\t * !drawf (g: Canvas, sx:number, sy:number, swidth:number, sheight:number, tx:number, ty:number, twidth:number, theight:number, fwidth?:number|null, fheight?:number|null) : void;\n\t */\n\tdrawf: function (g, sx, sy, swidth, sheight, tx, ty, twidth, theight, fwidth=null, fheight=null)\n\t{\n\t\t// Update animation time only if not paused and system frame number has changed.\n\t\tif (!this._paused)\n\t\t\tthis.time += this.frameNumber === System.frameNumber ? 0 : System.frameDelta;\n\n\t\t// Delay until `time` is non-negative. Negative time is used as initial animation delay.\n\t\tif (this.time < 0) {\n\t\t\tthis.frameNumber = System.frameNumber;\n\t\t\treturn;\n\t\t}\n\n\t\t// Load next sequence if specified.\n\t\tif (this.n_seq !== null && this.frameNumber !== System.frameNumber)\n\t\t{\n\t\t\tthis.seq = this.n_seq;\n\t\t\tthis.seq_i = 0;\n\t\t\tthis.n_seq = null;\n\n\t\t\tthis.time = 0;\n\t\t\tthis.finished = false;\n\n\t\t\tthis.setFps (this.seq.fps || this.fps);\n\t\t}\n\n\t\t// Update animation frame if frame time exceeds or equals frame duration.\n\t\tif (this.time >= this.frameDuration && this.frameNumber !== System.frameNumber && !this.finished)\n\t\t{\n\t\t\tconst frameIndex = this.seq_i;\n\n\t\t\tthis.time -= this.frameDuration;\n\t\t\tthis.seq_i++;\n\n\t\t\t// Reached end of sequence.\n\t\t\tif (this.seq_i === this.seq.group.length)\n\t\t\t{\n\t\t\t\t// If loop is not enabled, trigger `finished` callback.\n\t\t\t\tif (!this.seq.loop)\n\t\t\t\t{\n\t\t\t\t\tthis.finished = true;\n\n\t\t\t\t\tif (this.finishedCallback)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.finishedCallback(this) === false)\n\t\t\t\t\t\t\tthis.finishedCallback = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tthis.seq_i = 0;\n\n\t\t\t\t// Use next sequence in the queue.\n\t\t\t\tif (this.queue.length)\n\t\t\t\t\tthis.use(this.queue.shift(), true);\n\t\t\t}\n\n\t\t\t//  Execute frame callback if registered.\n\t\t\tif (this.frameCallback)\n\t\t\t{\n\t\t\t\tif (this.frameCallback(frameIndex, this.seq.group.length-1, this) === false)\n\t\t\t\t\tthis.frameCallback = null;\n\t\t\t}\n\t\t}\n\n\t\t// Draw the current frame.\n\t\tlet t = this.seq.group[ this.seq_i === this.seq.group.length ? this.seq_i-1 : this.seq_i ];\n\n\t\t// TODO optimize this to ensure t is always just a single image\n\t\tfor (let i = 0; i < t.length; i++)\n\t\t{\n\t\t\tlet frame = this.anim.getFrame(t[i]);\n\t\t\tframe.drawf(g, frame.sx, frame.sy, frame.swidth, frame.sheight, tx, ty, twidth, theight, fwidth, fheight);\n\t\t}\n\n\t\t// Record system frame number to prevent double frame updates.\n\t\tthis.frameNumber = System.frameNumber;\n\t},\n\n\tgetTexture: function()\n\t{\n\t\treturn this.anim.getTexture();\n\t},\n\n\tgetDrawable: function()\n\t{\n\t\treturn this;\n\t},\n\n\tadvance: function ()\n\t{\n\t\tthis.paused (false);\n\t\tthis.draw (null, 0, 0);\n\t},\n\n\tgetSequenceName: function ()\n\t{\n\t\treturn this.n_seq === null ? this.seq.name : this.n_seq.name;\n\t},\n\n\tuse: function (seqName, forced=false)\n\t{\n\t\tif (this.seq.name === seqName && !this.finished && forced !== true)\n\t\t\treturn false;\n\n\t\tthis.n_seq = this.anim.a.seq[seqName];\n\t\tthis.finished = false;\n\n\t\treturn true;\n\t},\n\n\tplay: function (name, forced=false)\n\t{\n\t\tthis.use(name, forced);\n\t\treturn this;\n\t},\n\n\tsetQueue: function (list)\n\t{\n\t\tif (!List.isInstance(list))\n\t\t\tthrow new Error('setQueue: Parameter must be an instance of List');\n\n\t\tif (this.queue != null)\n\t\t\tthis.queue.clear().free();\n\n\t\tthis.queue = list;\n\t\tthis.use(this.queue.shift(), true);\n\t},\n\n\tenqueue: function (seqName, force=false)\n\t{\n\t\tlet seq = this.seq;\n\n\t\tlet lastName = this.queue.length > 0 ? this.queue[this.queue.length-1] : seq.name;\n\n\t\tif (seq.name === seqName && seq.loop)\n\t\t\treturn this;\n\n\t\tif (lastName === seqName && !force)\n\t\t\treturn this;\n\n\t\tif (seq.loop || this.finished)\n\t\t{\n\t\t\tthis.use(seqName, true);\n\t\t\treturn this;\n\t\t}\n\n\t\tthis.queue.push(seqName);\n\t\treturn this;\n\t}\n});\n\nRecycler.createPool(Animation);\n\n/* ********************************************************** */\nexport default Spritesheet.extend\n({\n\tclassName: 'SpritesheetAnimation',\n\n\tdefaultDrawable: null,\n\tsharedAnim: null,\n\n\tr: null,\n\ta: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (!r.anim) throw new Error (\"Animation descriptors not found.\");\n\n\t\tthis._super.Spritesheet.__ctor (r);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tlet t = this.a = this.r.anim;\n\n\t\tif (t.initialized) return;\n\n\t\tif (!t.def) t.def = 'def';\n\t\tif (!t.seq) t.seq = { };\n\n\t\t// Create default sequence if it wasn't defined.\n\t\tif (!t.seq[t.def] && (t.def == 'def' || t.def == 'defloop'))\n\t\t{\n\t\t\tlet p = { loop: (t.def == 'def' ? false : true), group: [ ] };\n\n\t\t\tfor (let i = 0; i < this.numFrames; i++) {\n\t\t\t\tp.group.push([i]);\n\t\t\t}\n\n\t\t\tt.seq[t.def] = p;\n\t\t}\n\n\t\tif (!t.seq[t.def])\n\t\t\tthrow new Error ('Undefined default sequence: ' + t.def);\n\n\t\tif (!t.fps) t.fps = 25;\n\n\t\tt.def = t.seq[t.def];\n\n\t\tlet frameIndex = 0;\n\n\t\tfor (let i in t.seq)\n\t\t{\n\t\t\tt.seq[i].name = i;\n\n\t\t\tif (!t.seq[i].loop)\n\t\t\t\tt.seq[i].loop = false;\n\n\t\t\tif (typeof(t.seq[i].group) == 'string')\n\t\t\t{\n\t\t\t\tlet a, b, c;\n\n\t\t\t\tif (t.seq[i].group.indexOf(' ') != -1)\n\t\t\t\t{\n\t\t\t\t\ta = t.seq[i].group.split(' ');\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\tfor (let j in a)\n\t\t\t\t\t\tt.seq[i].group.push([int(a[j])]);\n\t\t\t\t}\n\t\t\t\telse if (t.seq[i].group.indexOf('-') != -1)\n\t\t\t\t{\n\t\t\t\t\tc = t.seq[i].group.split('-');\n\t\t\t\t\t\n\t\t\t\t\ta = int(c[0]);\n\t\t\t\t\tb = int(c[1]);\n\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\tif (a < b) {\n\t\t\t\t\t\tfor (c = a; c <= b; c++)\n\t\t\t\t\t\t\tt.seq[i].group.push([c]);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tfor (c = a; c >= b; c--)\n\t\t\t\t\t\t\tt.seq[i].group.push([c]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ta = int(t.seq[i].group);\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\twhile (a--) t.seq[i].group.push([frameIndex++]);\n\t\t\t\t}\n\n\t\t\t\tt.seq[i].count = t.seq[i].group.length;\n\t\t\t}\n\t\t}\n\n\t\tt.initialized = true;\n\t},\n\n\tgetSharedAnimation: function (initialseq=null)\n\t{\n\t\tif (this.sharedAnim === null)\n\t\t{\n\t\t\tthis.sharedAnim = Animation.Pool.alloc(this, initialseq ? this.a.seq[initialseq] : this.a.def, this.a.fps);\n\t\t\tthis.sharedAnim.lockInstance(true);\n\n\t\t\treturn this.sharedAnim;\n\t\t}\n\n\t\treturn this.sharedAnim.play(initialseq ? initialseq : this.a.def.name);\n\t},\n\n\tgetAnimation: function (initialseq=null, fps=null)\n\t{\n\t\treturn Animation.Pool.alloc(this, initialseq ? this.a.seq[initialseq] : this.a.def, fps || this.a.fps);\n\t},\n\n\tgetSequence: function (name)\n\t{\n\t\treturn this.a.seq[name];\n\t},\n\n\tgetDrawable: function()\n\t{\n\t\tif (this.defaultDrawable === null)\n\t\t\tthis.defaultDrawable = this.getAnimation();\n\n\t\treturn this.defaultDrawable;\n\t}\n});\n","\nimport { Class } from 'rinn';\nimport Canvas from '../system/canvas.js';\n\n//![import \"../system/canvas\"]\n\n/*\n\tfont: {\n\t\tsheetWidth: int?, charWidth: int, charHeight: int, charset: string, widths: [char, width, ...],\n\t\treverseDraw: bool?, paddingX: int?, paddingY: int?, spacingX: int?, spacingY: int?\n\t}\n*/\n\nexport default Class.extend\n({\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != 'image' || !r.font)\n\t\t\tthrow new Error ('Resource is not a sprite font.');\n\n\t\tif (!r.font.sheetWidth)\n\t\t\tr.font.sheetWidth = r.width;\n\n\t\tlet r_scale = r.data.width / r.font.sheetWidth;\n\t\tlet v_scale = r.width / r.font.sheetWidth;\n\n\t\tthis.r_charWidth = (r.font.charWidth * r_scale);\n\t\tthis.r_charHeight = (r.font.charHeight * r_scale);\n\n\t\tthis.charWidth = (r.font.charWidth * v_scale);\n\t\tthis.charHeight = (r.font.charHeight * v_scale);\n\n\t\tthis.paddingX = (r.font.paddingX || 0) * v_scale;\n\t\tthis.paddingY = (r.font.paddingY || 0) * v_scale;\n\n\t\tthis.spacingX = (r.font.spacingX || 0) * v_scale;\n\t\tthis.spacingY = (r.font.spacingY || 0) * v_scale;\n\n\t\tthis.reverseDraw = r.font.reverseDraw || false;\n\n\t\tlet cols = int(r.font.sheetWidth / r.font.charWidth);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tlet n = r.font.charset.length;\n\t\tlet k = 0;\n\t\tlet y = 0;\n\n\t\tthis.charTable = { };\n\n\t\twhile (k < n)\n\t\t{\n\t\t\tlet x = 0;\n\n\t\t\tfor (let i = 0; i < cols && k < n; i++)\n\t\t\t{\n\t\t\t\tlet c = r.font.charset[k++];\n\n\t\t\t\tthis.charTable[c] = { hidden: false, x: x, y: y, charWidth: this.charWidth, r_charWidth: this.r_charWidth, spacingX: 0 };\n\n\t\t\t\tx += this.r_charWidth;\n\t\t\t}\n\n\t\t\ty += this.r_charHeight;\n\t\t}\n\n\t\tif (!(' ' in this.charTable))\n\t\t\tthis.charTable[' '] = { hidden: true, charWidth: int((this.charWidth + this.paddingX)*2/3), r_charWidth: this.r_charWidth, spacingX: 0 };\n\n\t\tif (!r.font.widths) return;\n\n\t\tn = r.font.widths.length;\n\n\t\tfor (let i = 0; i < n; i += 2)\n\t\t{\n\t\t\tlet w = r.font.widths[i+1] * v_scale;\n\t\t\tlet s = r.font.widths[i];\n\n\t\t\tif (typeof(s) === 'number')\n\t\t\t\ts = String.fromCharCode(s);\n\n\t\t\tfor (let j = 0; j < s.length; j++)\n\t\t\t{\n\t\t\t\tif (s[j] in this.charTable)\n\t\t\t\t\tthis.charTable[s[j]].spacingX = w - this.charTable[s[j]].charWidth;\n\t\t\t}\n\t\t}\n\t},\n\n\tdrawText: function (g, x, y, text)\n\t{\n\t\tlet n = text.length;\n\n\t\tlet pX = -2*this.paddingX + this.spacingX;\n\n\t\tx -= this.paddingX;\n\t\ty -= this.paddingY;\n\n\t\tif (!this.reverseDraw)\n\t\t{\n\t\t\tfor (let i = 0; i < n; i++)\n\t\t\t{\n\t\t\t\tlet c = this.charTable[text[i]];\n\t\t\t\tif (!c) continue;\n\n\t\t\t\tif (!c.hidden)\n\t\t\t\t\tg.drawImage (this.r.data, c.x, c.y, c.r_charWidth, this.r_charHeight, x, y, c.charWidth, this.charHeight, null, null, c.charWidth, this.charHeight);\n\n\t\t\t\tx += c.charWidth + pX + c.spacingX;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let i = 0; i < n-1; i++)\n\t\t\t{\n\t\t\t\tlet c = this.charTable[text[i]];\n\t\t\t\tif (!c) continue;\n\n\t\t\t\tx += c.charWidth + pX;\n\t\t\t}\n\n\t\t\tfor (let i = n-1; i >= 0; i--)\n\t\t\t{\n\t\t\t\tlet c = this.charTable[text[i]];\n\t\t\t\tif (!c) continue;\n\n\t\t\t\tif (!c.hidden)\n\t\t\t\t\tg.drawImage (this.r.data, c.x, c.y, c.r_charWidth, this.r_charHeight, x, y, c.charWidth, this.charHeight, null, null, c.charWidth, this.charHeight);\n\n\t\t\t\tx -= c.charWidth + pX + c.spacingX;\n\t\t\t}\n\t\t}\n\t},\n\n\tmeasureWidth: function (text)\n\t{\n\t\tlet n = text.length;\n\t\tlet x = 0;\n\n\t\tlet pX = -2*this.paddingX + this.spacingX;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tlet c = this.charTable[text[i]];\n\t\t\tif (!c) continue;\n\n\t\t\tx += c.charWidth + pX + c.spacingX;\n\t\t}\n\n\t\treturn x;\n\t},\n\n\tmeasureHeight: function (text)\n\t{\n\t\treturn this.charHeight - 2*this.paddingY + this.spacingY;\n\t}\n});\n","\nimport { Rinn } from 'rinn';\nimport System from '../system/system.js';\nimport Canvas from '../system/canvas.js';\nimport Log from '../system/log.js';\n\n//[import '../system/system']\n//[import '../system/canvas']\n//[import '../system/log']\n\nconst Resources = { };\n\nimport * as Wrappers from './wrappers.js';\n\nlet reported = false;\n\n\n//!namespace Resources\n\n\t//!type ConfigOptions =\n\n\t\t/**\n\t\t * Enables integer scaling. When enabled, calling `resizeImage` with `pixelated` parameter set to `true` will cause images to be resized to integer\n\t\t * factors. When disabled, images will be resized using the half/double method to eventually end up reaching the exact target size.\n\t\t *\n\t\t * @default true\n\t\t * !integerScalingEnabled?: boolean;\n\t\t */\n\t\t/**\n\t\t * Default value for the `pixelated` parameter of image resources. Controls whether to use integer scaling when resizing images.\n\t\t * \n\t\t * @default false\n\t\t * !pixelated?: boolean;\n\t\t */\n\t\t/**\n\t\t * Default value for the `filter` parameter of image resources. When an image does not have the `pixelated` property nor `filter`, this value will be used.\n\t\t * \n\t\t * @default LINEAR\n\t\t * !filter?: 'LINEAR'|'NEAREST';\n\t\t */\n\t\t/**\n\t\t * Default value for the `original` parameter of image resources. When set to `true`, no resizing at all will take place on the image resources and the\n\t\t * original image will be used as-is.\n\t\t * \n\t\t * @default false\n\t\t * !original?: boolean;\n\t\t */\n\n\t//!/type\n\n//!/namespace\n\n//:/**\n//: * Provides functionality to load and manipulate resources (images, audio, etc).\n//: */\n\n//!class Resources\n\nObject.assign(Resources,\n{\n\t/**\n\t * Enables integer scaling. When enabled, calling `resizeImage` with `pixelated` parameter set to `true` will cause images to be resized to integer\n\t * factors. When disabled, images will be resized using the half/double method to eventually end up reaching the exact target size.\n\t *\n\t * @default true\n\t * !static integerScalingEnabled: boolean;\n\t */\n\tintegerScalingEnabled: true,\n\n\t/**\n\t * Default value for the `pixelated` parameter of image resources. Controls whether to use integer scaling when resizing images. Also controls the default\n\t * scaling filter (LINEAR/NEAREST) the image will use when converted to a WebGL2 texture.\n\t * \n\t * @default false\n\t * !static pixelated: boolean;\n\t */\n\tpixelated: false,\n\n\t/**\n\t * Default value for the `filter` parameter of image resources. When an image does not have the `pixelated` property nor `filter`, this value will be used.\n\t * \n\t * @default LINEAR\n\t * !static filter: 'LINEAR'|'NEAREST';\n\t */\n\tfilter: 'LINEAR',\n\n\t/**\n\t * Default value for the `original` parameter of image resources. When set to `true`, no resizing will take place on the image resource at all and the\n\t * original will be used as-is.\n\t * \n\t * @default false\n\t * !static original: boolean;\n\t */\n\toriginal: false,\n\n\t/**\n\t * Configures the resources object with the specified options.\n\t * !static config (options: Resources.ConfigOptions) : void;\n\t */\n\tconfig: function (opts)\n\t{\n\t\tif (opts !== null)\n\t\t\tObject.assign(this, opts);\n\t},\n\n\t/**\n\t * Loads a list of resources. The list parameter is actually a dictionary with objects as shown in the example below.\n\t *\n\t * { type: \"image\", wrapper: \"\", src: \"assets/ui/btn-left.png\", width: 64, \\[ height: 64 \\], scale: 1, pixelated: false, filter: null, original: false }\n\t * { type: \"images\", wrapper: \"\", src: \"assets/ui/##.png\", count: 16, width: 64, \\[ height: 64 \\], pixelated: false }\n\t * { type: \"audio\", wrapper: \"\", src: \"assets/ui/tap.wav\", track: \"sfx|music\" }\n\t * { type: \"audios\", wrapper: \"\", src: \"assets/ui/snd-##.wav\", count: 4 }\n\t * { type: \"json\", wrapper: \"\", src: \"assets/config.json\" }\n\t * { type: \"data\", wrapper: \"\", src: \"assets/config.dat\" }\n\t * { type: \"text\", wrapper: \"\", src: \"assets/config.frag\" }\n\t * { type: \"object\", wrapper: \"\" }\n\t *\n\t * @param list - Map of resources to load.\n\t * @param progressCallback - Executed once for every resource loaded.\n\t * @param completeCallback - Executed when all resources have been loaded.\n\t * !static load (list: { \\[id: string\\] : object }, progressCallback: (index: number, count: number, ratio: number, name: string) => void, completeCallback: (list: { \\[id: string\\] : object }) => void) : void;\n\t */\n\tload: function (list, progressCallback, completeCallback, keyList, index)\n\t{\n\t\tif (!keyList)\n\t\t{\n\t\t\tkeyList = Object.keys(list);\n\n\t\t\tfor (let i in keyList)\n\t\t\t{\n\t\t\t\tif (!('__loaded' in list[keyList[i]]))\n\t\t\t\t\tlist[keyList[i]].__clone = Rinn.clone(list[keyList[i]]);\n\t\t\t}\n\n\t\t\tindex = 0;\n\t\t}\n\n\t\twhile (index < keyList.length && ('__loaded' in list[keyList[index]]))\n\t\t\tindex++;\n\n\t\tif (progressCallback)\n\t\t\tprogressCallback (index, keyList.length, index / keyList.length, index < keyList.length ? keyList[index] : null);\n\n\t\tif (index == keyList.length)\n\t\t{\n\t\t\tif (completeCallback)\n\t\t\t\tcompleteCallback(list);\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet r = list[keyList[index]];\n\t\tr.resName = keyList[index];\n\n\t\tlet src, d0, d1, dN, cb;\n\n\t\tswitch (r.type)\n\t\t{\n\t\t\tcase \"image\":\n\t\t\t\tr.data = new Image ();\n\t\t\t\tr.data.onload = async function ()\n\t\t\t\t{\n\t\t\t\t\tconst ratio = r.data.width / r.data.height;\n\n\t\t\t\t\tif (r.scale) {\n\t\t\t\t\t\tr.width = int(r.data.width*r.scale);\n\t\t\t\t\t\tr.height = int(r.data.height*r.scale);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!r.hasOwnProperty('extraScale'))\n\t\t\t\t\t\tr.extraScale = 0.0;\n\n\t\t\t\t\tif (!r.width && !r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.width = r.data.width;\n\t\t\t\t\t\tr.height = r.data.height;\n\t\t\t\t\t}\n\t\t\t\t\telse if (r.width && !r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.height = int(r.width / ratio);\n\t\t\t\t\t}\n\t\t\t\t\telse if (!r.width && r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.width = int(ratio * r.height);\n\t\t\t\t\t}\n\n\t\t\t\t\t//TODO remove this comment if nothing explodes after removing owidth and oheight.\n\t\t\t\t\t//r.owidth = r.data.width;\n\t\t\t\t\t//r.oheight = r.data.height;\n\n\t\t\t\t\tif (!r.hasOwnProperty('filter'))\n\t\t\t\t\t\tr.filter = !r.hasOwnProperty('pixelated') ? Resources.filter : (r.pixelated === true ? 'NEAREST' : Resources.filter);\n\n\t\t\t\t\tif (!r.hasOwnProperty('pixelated'))\n\t\t\t\t\t\tr.pixelated = Resources.pixelated;\n\n\t\t\t\t\tif (!r.hasOwnProperty('original'))\n\t\t\t\t\t\tr.original = Resources.original;\n\n\t\t\t\t\tif ((r.data.width != r.width || r.data.height != r.height || r.extraScale != 0.0) && r.original !== true)\n\t\t\t\t\t{\n//let t = hrnow(); //violet\n\t\t\t\t\t\tr.data = await Resources.resizeImage (r, r.width * (r.extraScale + (r.pixelated ? System.integerScaleFactor : System.scaleFactor)), r.height * (r.extraScale + (r.pixelated ? System.integerScaleFactor : System.scaleFactor)), r.pixelated, true);\n//console.log((hrnow() - t) + ': resize to ' + (r.width * (r.pixelated ? System.integerScaleFactor : System.scaleFactor)) + 'x' + (r.height * (r.pixelated ? System.integerScaleFactor : System.scaleFactor)));\n\t\t\t\t\t}\n\n\t\t\t\t\tr.rscale = r.data.width / r.width;\n\n\t\t\t\t\tr.data.rscale = r.rscale;\n\t\t\t\t\tr.data.filter = r.filter;\n\t\t\t\t\tr.data.targetWidth = r.width;\n\t\t\t\t\tr.data.targetHeight = r.height;\n\n\t\t\t\t\tif (r.hasOwnProperty('mipmap') && r.mipmap > 0)\n\t\t\t\t\t\tr.data.mipmap = r.mipmap;\n\n\t\t\t\t\t// Pre-draw on an offscreen canvas, used to prevent a delay when rendering an image for the first time on some browsers.\n\t\t\t\t\tSystem.tempDisplayBuffer.drawImage(r.data, 0, 0);\n\t\t\t\t\tSystem.renderer.prepareImage(r.data);\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index], () => {\n\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index+1);\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\tr.data.onerror = function () {\n\t\t\t\t\tconsole.error (\"Error: Unable to load: \" + r.resName);\n\t\t\t\t};\n\n\t\t\t\tr.data.src = r.src + \"?r=\" + Math.random();\n\t\t\t\tbreak;\n\n\t\t\tcase \"images\":\n\t\t\t\tsrc = r.src;\n\t\t\t\td0 = src.indexOf(\"#\");\n\t\t\t\td1 = src.lastIndexOf(\"#\");\n\t\t\t\tdN = d1 - d0 + 1;\n\n\t\t\t\tif (d0 == -1)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'src' attribute requires one or more '#' marks.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!r.count)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'count' attribute was not found.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tr._i = 0;\n\t\t\t\tr.data = [ ];\n\n\t\t\t\tcb = function ()\n\t\t\t\t{\n\t\t\t\t\tif (r._i == r.count)\n\t\t\t\t\t{\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index], () => {\n\t\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// TODO add support for extraScale\n\t\t\t\t\tlet tmp = { type: \"image\", width: r.width, height: r.height, scale: r.scale };\n\n\t\t\t\t\ttmp.src = r.src.substr(0, d0) + ((r._i++) / Math.pow(10,dN)).toFixed(dN).substr(2) + r.src.substr(d1+1);\n\t\t\t\t\ttmp.data = new Image ();\n\t\t\t\t\ttmp.resName = r.resName + \"#\" + (r._i - 1);\n\n\t\t\t\t\tif (progressCallback)\n\t\t\t\t\t\tprogressCallback (index, keyList.length, (index / keyList.length) + ((r._i-1)/r.count)*(1 / keyList.length), r.resName + '/' + (r._i-1));\n\n\t\t\t\t\ttmp.data.onload = async function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tlet ratio = tmp.data.width / tmp.data.height;\n\n\t\t\t\t\t\tif (tmp.scale)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = int(tmp.data.width*tmp.scale);\n\t\t\t\t\t\t\ttmp.height = int(tmp.data.height*tmp.scale);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!tmp.width && !tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = tmp.data.width;\n\t\t\t\t\t\t\ttmp.height = tmp.data.height;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (tmp.width && !tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.height = int(tmp.width / ratio);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!tmp.width && tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = int(ratio * tmp.height);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (r._i == 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tr.owidth = tmp.data.width;\n\t\t\t\t\t\t\tr.oheight = tmp.data.height;\n\n\t\t\t\t\t\t\tif (!r.hasOwnProperty('filter'))\n\t\t\t\t\t\t\t\tr.filter = !r.hasOwnProperty('pixelated') ? Resources.filter : (r.pixelated === true ? 'NEAREST' : Resources.filter);\n\n\t\t\t\t\t\t\tif (!r.hasOwnProperty('pixelated'))\n\t\t\t\t\t\t\t\tr.pixelated = Resources.pixelated;\n\n\t\t\t\t\t\t\tif (!r.hasOwnProperty('original'))\n\t\t\t\t\t\t\t\tr.original = Resources.original;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttmp.pixelated = r.pixelated;\n\t\t\t\t\t\ttmp.filter = r.filter;\n\t\t\t\t\t\ttmp.original = r.original;\n\n\t\t\t\t\t\tif ((tmp.data.width != tmp.width || tmp.data.height != tmp.height) && tmp.original !== true)\n\t\t\t\t\t\t{\n//let t = hrnow();//violet\n\t\t\t\t\t\t\ttmp.data = await Resources.resizeImage (tmp, tmp.width * (r.pixelated ? System.integerScaleFactor : System.scaleFactor), tmp.height * (tmp.pixelated ? System.integerScaleFactor : System.scaleFactor), tmp.pixelated, true);\n//console.log((hrnow() - t) + ': resize to ' + (tmp.width * (r.pixelated ? System.integerScaleFactor : System.scaleFactor)) + 'x' + (tmp.height * (r.pixelated ? System.integerScaleFactor : System.scaleFactor)));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttmp.rscale = tmp.data.width / tmp.width;\n\n\t\t\t\t\t\ttmp.data.rscale = tmp.rscale;\n\t\t\t\t\t\ttmp.data.filter = tmp.filter;\n\t\t\t\t\t\ttmp.data.targetWidth = tmp.width;\n\t\t\t\t\t\ttmp.data.targetHeight = tmp.height;\n\n\t\t\t\t\t\tif (r.hasOwnProperty('mipmap') && r.mipmap > 0)\n\t\t\t\t\t\t\ttmp.data.mipmap = r.mipmap;\n\t\n\t\t\t\t\t\tif (r._i == 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tr.width = tmp.width;\n\t\t\t\t\t\t\tr.height = tmp.height;\n\t\t\t\t\t\t\tr.rscale = tmp.rscale;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tSystem.tempDisplayBuffer.drawImage(tmp.data, 0, 0);\n\t\t\t\t\t\tSystem.renderer.prepareImage(tmp.data);\n\n\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\tcb();\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.onerror = function () {\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName);\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.src = tmp.src + \"?r=\" + Math.random();\n\t\t\t\t};\n\n\t\t\t\tcb();\n\t\t\t\tbreak;\n\n\t\t\tcase \"audio\":\n\t\t\t\tif (!r.track) r.track = \"sfx\";\n\n\t\t\t\tif (global.plugins && global.plugins.NativeAudio && r.track == \"sfx\")\n\t\t\t\t{\n\t\t\t\t\tif (!reported) {\n\t\t\t\t\t\tLog.write('ENGINE_NATIVEAUDIO');\n\t\t\t\t\t\treported = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tr.engine = Wrappers.Sound.ENGINE_NATIVEAUDIO;\n\t\t\t\t\tr.data = \"snd_\" + index;\n\n\t\t\t\t\tglobal.plugins.NativeAudio.preloadSimple(r.data, r.src,\n\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\tResources.onLoaded (list, keyList[index], () => {\n\t\t\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\t\t\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction(e) {\n\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load (sfx): \" + r.resName + \"\\n\" + e);\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (global.audioContext)\n\t\t\t\t{\n\t\t\t\t\tif (!reported) {\n\t\t\t\t\t\tLog.write('ENGINE_WEBAUDIO');\n\t\t\t\t\t\treported = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tr.engine = Wrappers.Sound.ENGINE_WEBAUDIO;\n\n\t\t\t\t\tfetchAudioBuffer (r.src + \"?r=\" + Math.random())\n\t\t\t\t\t.then (audioBuffer => {\n\t\t\t\t\t\tr.data = audioBuffer;\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index], () => {\n\t\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.catch (err => {\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName + \"\\n\" + err);\n\t\t\t\t\t});\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!reported) {\n\t\t\t\t\tLog.write('ENGINE_HTML5');\n\t\t\t\t\treported = true;\n\t\t\t\t}\n\n\t\t\t\tr.data = new Audio ();\n\t\t\t\tr.engine = Wrappers.Sound.ENGINE_HTML5;\n\n\t\t\t\tr.data.oncanplaythrough = function ()\n\t\t\t\t{\n\t\t\t\t\tResources.onLoaded (list, keyList[index],  () => {\n\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\tr.data.onerror = function ()\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName);\n\t\t\t\t};\n\n\t\t\t\tr.data.src = r.src + \"?r=\" + Math.random();\n\t\t\t\tbreak;\n\n\t\t\tcase \"audios\":\n\t\t\t\tsrc = r.src;\n\t\t\t\td0 = src.indexOf(\"#\");\n\t\t\t\td1 = src.lastIndexOf(\"#\");\n\t\t\t\tdN = d1 - d0 + 1;\n\n\t\t\t\tif (d0 == -1)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'src' attribute requires one or more '#' marks.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!r.count)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'count' attribute was not found.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tr._i = 0;\n\t\t\t\tr.data = [ ];\n\n\t\t\t\tcb = function ()\n\t\t\t\t{\n\t\t\t\t\tif (r._i == r.count)\n\t\t\t\t\t{\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index], () => {\n\t\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet tmp = { type: \"audio\", track: r.track };\n\n\t\t\t\t\ttmp.src = r.src.substr(0, d0) + ((r._i++) / Math.pow(10,dN)).toFixed(dN).substr(2) + r.src.substr(d1+1);\n\t\t\t\t\ttmp.resName = r.resName + \"#\" + (r._i - 1);\n\n\t\t\t\t\tif (!tmp.track) tmp.track = \"sfx\";\n\n\t\t\t\t\tif (global.plugins && global.plugins.NativeAudio && tmp.track == \"sfx\")\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_NATIVEAUDIO;\n\t\t\t\t\t\ttmp.data = \"snd_\" + index + \"_\" + r._i;\n\t\n\t\t\t\t\t\tglobal.plugins.NativeAudio.preloadSimple(tmp.data, tmp.src,\n\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\t\t\tcb();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfunction(e) {\n\t\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load (sfx): \" + tmp.resName + \"\\n\" + e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (global.audioContext)\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_WEBAUDIO;\n\n\t\t\t\t\t\tfetchAudioBuffer (tmp.src + \"?r=\" + Math.random())\n\t\t\t\t\t\t.then (audioBuffer => {\n\t\t\t\t\t\t\ttmp.data = audioBuffer;\n\t\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\t\tcb();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch (err => {\n\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName + \"\\n\" + err);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\ttmp.data = new Audio ();\n\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_HTML5;\n\n\t\t\t\t\ttmp.data.oncanplaythrough = function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\tcb();\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.onerror = function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName);\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.src = tmp.src + \"?r=\" + Math.random();\n\t\t\t\t};\n\n\t\t\t\tcb();\n\t\t\t\tbreak;\n\n\t\t\tcase \"json\":\n\n\t\t\t\tfetchd (r.src + \"?r=\" + Math.random(), { responseType: 'json' }).then(function(json)\n\t\t\t\t{\n\t\t\t\t\tr.data = json;\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index], () => {\n\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch(function(err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName + \"\\n\" + err);\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"data\":\n\n\t\t\t\tfetchd (r.src + \"?r=\" + Math.random()).then(function(arraybuffer)\n\t\t\t\t{\n\t\t\t\t\tr.data = arraybuffer;\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index], () => {\n\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch(function(err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName + \"\\n\" + err);\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"text\":\n\n\t\t\t\tfetchd (r.src + \"?r=\" + Math.random()).then(function(arrayBuffer)\n\t\t\t\t{\n\t\t\t\t\tr.data = String.fromCharCode.apply(null, new Uint8Array(arrayBuffer));\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index], () => {\n\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch(function(err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName + \"\\n\" + err);\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"object\":\n\t\t\t\tr.data = { };\n\n\t\t\t\tResources.onLoaded (list, keyList[index], () => {\n\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t}\n\t},\n\n\t/**\n\t * Unloads the specified list of resources.\n\t * !static unload (list: { \\[id: string\\] : object }) : void;\n\t */\n\tunload: function (list)\n\t{\n\t\tthrow new Error('IMPLEMENTED UNLOAD!');\n\n\t\tlet __original;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tif (i == \"__original\")\n\t\t\t{\n\t\t\t\t__original = list[i];\n\t\t\t\tdelete list[i];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (list[i].r)\n\t\t\t{\n\t\t\t\tdispose(list[i]);\n\t\t\t\tlist[i] = list[i].r;\n\t\t\t}\n\n\t\t\tswitch (list[i].type)\n\t\t\t{\n\t\t\t\tcase \"audio\":\n\t\t\t\t\t// TODO unload audio if using NativeAudio\n\t\t\t\t\t// global.plugins.NativeAudio.unload\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"audios\":\n\t\t\t\t\t// TODO unload audio if using NativeAudio\n\t\t\t\t\t// global.plugins.NativeAudio.unload\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"images\":\n\t\t\t\t\tfor (let j = 0; j < list[i].data.length; j++)\n\t\t\t\t\t\tdispose (list[i].data[j]);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tdispose (list[i].data);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tlist[i].data = null;\n\t\t\tdelete list[i];\n\t\t}\n\n\t\tfor (let i in __original)\n\t\t\tlist[i] = __original[i];\n\t},\n\n\t/**\n\t * Executes post-load actions on a resource.\n\t */\n\tonLoaded: function (list, index, callback)\n\t{\n\t\tlet r = list[index];\n\t\tif (!r.wrapper || !(r.wrapper in Wrappers))\n\t\t{\n\t\t\tcallback();\n\t\t\treturn;\n\t\t}\n\n\t\tlist[index] = new Wrappers[r.wrapper] (r);\n\n\t\tif ('init' in list[index])\n\t\t{\n\t\t\tlist[index].init(() => {\n\t\t\t\tlist[index].__loaded = true;\n\t\t\t\tcallback();\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\tlist[index].__loaded = true;\n\t\t\tcallback();\n\t\t}\n\t},\n\n\t/**\n\t * Loads an image, returns a promise.\n\t * !static loadImage (src: string) : Promise<HTMLImageElement>;\n\t */\n\tloadImage: function (url)\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst image = new Image();\n\t\t\timage.onload = () => resolve(image);\n\t\t\timage.onerror = () => reject(new Error('Unable to load image'));\n\t\t\timage.src = url;\n\t\t});\n\t},\n\n\t/**\n\t * Resizes the given image to the specified size.\n\t * !static resizeImage (image: HTMLImageElement, targetWidth: number, targetHeight: number, pixelated?: boolean, discardOriginal?: boolean) : HTMLImageElement|HTMLCanvasElement;\n\t */\n\tresizeImage: async function (image, dw, dh, pixelated, discardOriginal)\n\t{\n\t\tlet sw = image.data.width;\n\t\tlet sh = image.data.height;\n\n\t\tdw = int(dw);\n\t\tdh = int(dh);\n\n\t\tif (sw == dw && sh == dh)\n\t\t\treturn image.data;\n\n\t\tif (!this.integerScalingEnabled && pixelated) pixelated = null;\n\n\t\tif (!pixelated)\n\t\t{\n\t\t\tpixelated = pixelated === null ? false : true;\n\n\t\t\tlet temp = new Canvas ({ hidden: true, antialias: pixelated }).resize (sw, sh);\n\t\t\ttemp.drawImage (image.data, 0, 0);\n\n\t\t\twhile (true)\n\t\t\t{\n\t\t\t\tlet tw = sw >> 1;\n\t\t\t\tlet th = sh >> 1;\n\n\t\t\t\tif (tw <= dw || th <= dh)\n\t\t\t\t\tbreak;\n\n\t\t\t\tlet output = new Canvas ({ hidden: true, antialias: pixelated }).resize (tw, th);\n\t\t\t\toutput.drawImage (temp.elem, 0, 0, tw, th);\n\t\t\t\ttemp.dispose ();\n\n\t\t\t\tsw = tw;\n\t\t\t\tsh = th;\n\n\t\t\t\ttemp = output;\n\t\t\t}\n\n\t\t\tlet output = new Canvas ({ hidden: true, antialias: pixelated }).resize (dw, dh);\n\t\t\toutput.drawImage (temp.elem, 0, 0, dw, dh);\n\t\t\ttemp.dispose ();\n\n\t\t\tif (discardOriginal)\n\t\t\t\tdispose (image.data);\n\n\t\t\treturn await this.loadImage(output.toDataUrl());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (int(dw / sw) > 0)\n\t\t\t{\n\t\t\t\tlet ratio = int((dw / sw) + 0.9);\n\n\t\t\t\tdw = ratio * sw;\n\t\t\t\tdh = ratio * sh;\n\n\t\t\t\tlet rep_x = dw / sw;\n\t\t\t\tlet rep_y = dh / sh;\n\n\t\t\t\tlet output = new Canvas ({ hidden: true, antialias: false }).resize (dw, dh);\n\n\t\t\t\tlet temp = new Canvas ({ hidden: true, antialias: false }).resize (sw, sh);\n\t\t\t\ttemp.drawImage (image.data, 0, 0);\n\n\t\t\t\tfor (let j = 0; j < sh; j++)\n\t\t\t\t{\n\t\t\t\t\tlet s = temp.getImageData(0, j, sw, 1).data;\n\t\t\t\t\tlet sp = 0;\n\n\t\t\t\t\tfor (let i = 0; i < sw && sp < s.length; i++, sp += 4)\n\t\t\t\t\t{\n\t\t\t\t\t\toutput.fillStyle(\"rgba(\"+s[sp]+\",\"+s[sp+1]+\",\"+s[sp+2]+\",\"+(s[sp+3] / 255)+\")\");\n\t\t\t\t\t\toutput.fillRect(i*rep_x, j*rep_y, rep_x, rep_y);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttemp.dispose();\n\n\t\t\t\treturn await this.loadImage(output.toDataUrl());\n\t\t\t}\n\n\t\t\treturn this.resizeImage (image, dw, dh, null, discardOriginal);\n\t\t}\n\t},\n\n\t/**\n\t * Flips an image horizontally.\n\t * !static flipImageHorz (image: HTMLImageElement) : HTMLImageElement;\n\t */\n\tflipImageHorz: function (image)\n\t{\n\t\tlet temp = new Canvas ({ hidden: true }).resize (image.data.width, image.data.height);\n\n\t\ttemp.translate(image.data.width, 0);\n\t\ttemp.scale(-1, 1);\n\n\t\ttemp.drawImage (image.data, 0, 0);\n\t\treturn temp.elem;\n\t},\n\n\t/**\n\t * Flips an image vertically.\n\t * !static flipImageVert (image: HTMLImageElement) : HTMLImageElement;\n\t */\n\tflipImageVert: function (image)\n\t{\n\t\tlet temp = new Canvas ({ hidden: true }).resize (image.data.width, image.data.height);\n\n\t\ttemp.translate(0, image.data.height);\n\t\ttemp.scale(1, -1);\n\n\t\ttemp.drawImage (image.data, 0, 0);\n\t\treturn temp.elem;\n\t},\n\n\t/**\n\t * Forces the browser to show a download dialog.\n\t * !static showDownload (filename: string, dataUrl: string) : void;\n\t */\n\tshowDownload: function (filename, dataUrl)\n\t{\n\t\tlet link = document.createElement(\"a\");\n\t\tlink.href = dataUrl;\n\n\t\tlink.style.display = 'none';\n\t\tlink.download = filename;\n\t\tlink.target = \"_blank\";\n\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t},\n\n\t/**\n\t * Forces the browser to show a file selection dialog.\n\t * !static showFilePicker (allowMultiple: boolean, accept: string, callback: (files: Array<File>) => void) : void;\n\t */\n\tshowFilePicker: function (allowMultiple, accept, callback)\n\t{\n\t\tlet input = document.createElement(\"input\");\n\n\t\tinput.type = \"file\";\n\t\tinput.accept = accept;\n\t\tinput.style.display = 'none';\n\t\tinput.multiple = allowMultiple;\n\n\t\tdocument.body.appendChild(input);\n\n\t\tinput.onchange = function ()\n\t\t{\n\t\t\tcallback(input.files);\n\t\t};\n\n\t\tdocument.body.onfocus = function ()\n\t\t{\n\t\t\tdocument.body.onfocus = null;\n\t\t\tdocument.body.removeChild(input);\n\t\t};\n\n\t\tinput.click();\n\t},\n\n\t/**\n\t * Loads a file using FileReader and returns the result as a dataURL.\n\t * !static loadAsDataURL (file: File, callback: (dataUrl: string) => void) : void;\n\t */\n\tloadAsDataURL: function (file, callback)\n\t{\n\t\tlet reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsDataURL(file);\n\t},\n\n\t/**\n\t * Loads a file using FileReader and returns the result as text.\n\t * !static loadAsText (file: File, callback: (text: string) => void) : void;\n\t */\n\tloadAsText: function (file, callback)\n\t{\n\t\tlet reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsText(file);\n\t},\n\n\t/**\n\t * Loads a file using FileReader and returns the result as an array buffer.\n\t * !static loadAsArrayBuffer (file: File, callback: (buff: ArrayBuffer) => void) : void;\n\t */\n\tloadAsArrayBuffer: function (file, callback)\n\t{\n\t\tlet reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsArrayBuffer(file);\n\t},\n\n\t/**\n\t * Loads an array of File objects using FileReader and returns them as data URLs.\n\t * !static loadAllAsDataURL (fileList: Array<File>, callback: (urlList: Array<{name:string, size:number, url:string}>) => void) : void;\n\t */\n\tloadAllAsDataURL: function (fileList, callback)\n\t{\n\t\tlet result = [];\n\n\t\tif (!fileList || !fileList.length)\n\t\t{\n\t\t\tcallback(result);\n\t\t\treturn;\n\t\t}\n\n\t\tlet loadNext = function (i)\n\t\t{\n\t\t\tif (i == fileList.length)\n\t\t\t{\n\t\t\t\tcallback(result);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tResources.loadAsDataURL (fileList[i], function(url) {\n\t\t\t\tresult.push({ name: fileList[i].name, size: fileList[i].size, url: url });\n\t\t\t\tloadNext(i+1);\n\t\t\t});\n\t\t};\n\n\t\tloadNext(0);\n\t}\n});\n\n//!/class\n\nexport default Resources;\n","\nimport { Class } from 'rinn';\nimport Resources from './resources.js';\n\n//![import \"./resources\"]\n\n/*\n\ttrack: string (music|sfx)\n*/\n\nconst Sound = Class.extend\n({\n\tr: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"audio\")\n\t\t\tthrow new Error (\"Resource is not audio.\");\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tthis.track = Sound[this.r.track.toUpperCase()];\n\t},\n\n\tplay: function (callback, volume)\n\t{\n\t\treturn Sound.play (this, callback, volume);\n\t},\n\n\tplayLoop: function (callback, volume)\n\t{\n\t\treturn Sound.playLoop (this, callback, volume);\n\t}\n});\n\nSound.ENGINE_HTML5 = 1;\nSound.ENGINE_WEBAUDIO = 2;\nSound.ENGINE_NATIVEAUDIO = 3;\n\nObject.assign(Sound,\n{\n\tMASTER: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tSFX: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tMUSIC: {\n\t\tenabled: true,\n\t\tvolume: 0.8\n\t},\n\n\tVOICE: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tMAX_POOL_SIZE: 100,\n\n\tpool: [ ],\n\tactive: [ ],\n\n\tregister: function (node)\n\t{\n\t\tif (node.registered) return;\n\n\t\tnode.registered = true;\n\t\tthis.active.push(node);\n\t},\n\n\tunregister: function (node)\n\t{\n\t\tif (!node.registered) return;\n\n\t\tnode.registered = false;\n\n\t\tvar i = Sound.active.indexOf(node);\n\t\tif (i == -1) return;\n\n\t\tSound.active.splice(i, 1);\n\t},\n\n\tupdateNode: function (node, cmd)\n\t{\n\t\tswitch (node.snd.r.engine)\n\t\t{\n\t\t\tcase Sound.ENGINE_WEBAUDIO:\n\t\t\t\treturn this.updateNode_webaudio(node, cmd);\n\n\t\t\tcase Sound.ENGINE_NATIVEAUDIO:\n\t\t\t\treturn this.updateNode_nativeaudio(node, cmd);\n\t\t}\n\n\t\treturn this.updateNode_audio(node, cmd);\n\t},\n\n\t// Web Audio.\n\talloc_webaudio: function (node)\n\t{\n\t\tnode.gainNode = audioContext.createGain();\n\t\tnode.gainNode.gain.value = 0;\n\t\tnode.gainNode.connect(audioContext.destination);\n\n\t\tnode.res = audioContext.createBufferSource();\n\t\tnode.res.buffer = node.snd.r.data;\n\t\tnode.res.loop = false;\n\t\tnode.res.connect(node.gainNode);\n\t\tnode.res.node = node;\n\t},\n\n\tfree_webaudio: function (node)\n\t{\n\t\tif (!node.res) return;\n\n\t\tnode.gainNode.disconnect();\n\n\t\tnode.res = null;\n\t\tnode.gainNode = null;\n\t},\n\n\t// Native Audio (Cordova plugin).\n\talloc_nativeaudio: function (node)\n\t{\n\t\tnode.res = true;\n\t},\n\n\tfree_nativeaudio: function (node)\n\t{\n\t\tnode.res = false;\n\t},\n\n\t// HTML5 Audio.\n\talloc_audio: function (node)\n\t{\n\t\tif (!this.pool.length)\n\t\t\titem = node.cloneNode();\n\t\telse\n\t\t\titem = this.pool.pop();\n\n\t\titem._src = node.src;\n\t\treturn item;\n\t},\n\n\tfree_audio: function (node)\n\t{\n\t\tif (this.pool.length == this.MAX_POOL_SIZE)\n\t\t\treturn;\n\n\t\t//BUG: This causes a GET request of \"/null\" on Chromium.\n\t\t//node.src = null;\n\n\t\tthis.pool.push(node);\n\t},\n\n\t/* *********************** */\n\tupdateNode_webaudio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tvar volume = Sound.MASTER.volume * node.snd.track.volume * node.volume;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t\tSound.alloc_webaudio(node);\n\n\t\t\t\tnode.playTime = hrnow();\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.onended = Sound.onended_webaudio;\n\t\t\t\tnode.gainNode.gain.value = volume;\n\n\t\t\t\ttry {\n\t\t\t\t\tnode.res.start(0, node.startTime/1000.0);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_webaudio(node);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.gainNode.gain.value = volume;\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\n\t\t\t\t\tSound.free_webaudio(node);\n\t\n\t\t\t\t\tif (node.callback) node.callback();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\t\t\t\tnode.res.onended = null;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tnode.res.stop();\n\n\t\t\t\tSound.free_webaudio(node);\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime += hrnow() - node.playTime;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = true;\n\t\t\t\tnode.res.onended = null;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tnode.res.stop();\n\n\t\t\t\tSound.free_webaudio(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.loop = false;\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_webaudio: function (e)\n\t{\n\t\tvar node = e.currentTarget.node;\n\n\t\tif (node.playing && node.loop != 0)\n\t\t{\n\t\t\tSound.free_webaudio(node);\n\n\t\t\tif (node.loop != -1)\n\t\t\t\tnode.loop--;\n\n\t\t\tnode.startTime = 0;\n\t\t\tnode.playing = false;\n\t\t\tnode.pause = false;\n\n\t\t\tSound.updateNode_webaudio (node, 'play');\n\t\t\treturn;\n\t\t}\n\n\t\tnode.res.onended = null;\n\t\tnode.res.volume = 0;\n\n\t\tSound.updateNode_webaudio (node, 'stop');\n\t},\n\n\t/* *********************** */\n\tupdateNode_nativeaudio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t\tSound.alloc_nativeaudio(node);\n\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\ttry {\n\t\t\t\t\tglobal.plugins.NativeAudio.play (node.snd.r.data, null, null, function() { Sound.onended_nativeaudio(node); } );\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_nativeaudio(node);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tglobal.plugins.NativeAudio.stop (node.snd.r.data, null);\n\n\t\t\t\tSound.free_nativeaudio(node);\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_nativeaudio: function (node)\n\t{\n\t\tSound.updateNode_nativeaudio (node, 'stop');\n\t},\n\n\tupdateNode_audio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tvar volume = Sound.MASTER.volume * node.snd.track.volume * node.volume;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t{\n\t\t\t\t\tnode.res = Sound.alloc_audio (node.snd.r.data);\n\t\t\t\t\tnode.res.node = node;\n\t\t\t\t\tnode.res.src = node.res._src;\n\t\t\t\t}\n\n\t\t\t\tnode.playTime = hrnow();\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.onended = Sound.onended_audio;\n\t\t\t\tnode.res.currentTime = node.startTime/1000.0;\n\t\t\t\tnode.res.volume = volume;\n\n\t\t\t\ttry {\n\t\t\t\t\tnode.res.play();\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_audio (node.res);\n\t\t\t\t\tnode.res = null;\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.res.volume = volume;\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\n\t\t\t\t\tSound.free_audio (node.res);\n\t\t\t\t\tnode.res = null;\n\t\n\t\t\t\t\tif (node.callback) node.callback();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tSound.unregister (node);\n\t\t\t\tnode.res.pause();\n\n\t\t\t\tSound.free_audio (node.res);\n\t\t\t\tnode.res = null;\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime += hrnow() - node.playTime;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = true;\n\n\t\t\t\tSound.unregister (node);\n\t\t\t\tnode.res.pause();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_audio: function (e)\n\t{\n\t\tvar node = e.currentTarget.node;\n\n\t\tif (node.playing && node.loop != 0)\n\t\t{\n\t\t\tif (node.loop != -1)\n\t\t\t\tnode.loop--;\n\n\t\t\tnode.startTime = 0;\n\t\t\tnode.playing = false;\n\t\t\tnode.pause = false;\n\n\t\t\tSound.updateNode_audio (node, 'play');\n\t\t\treturn;\n\t\t}\n\n\t\tnode.res.onended = null;\n\t\tnode.res.volume = 0;\n\n\t\tSound.updateNode_audio (node, 'stop');\n\t},\n\n\t/* *************************************** */\n\t/* PUBLIC */\n\n\tenableTrack: function (track)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.enabled = true;\n\t},\n\n\tdisableTrack: function (track)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.enabled = false;\n\t},\n\n\tsetVolume: function (track, value)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.volume = value;\n\t},\n\n\tcreateNode: function (snd, volume)\n\t{\n\t\tvar node = { };\n\n\t\tnode.startVolume = volume;\n\t\tnode.volume = volume;\n\t\tnode.snd = snd;\n\t\tnode.loop = 0;\n\t\tnode.playing = false;\n\t\tnode.paused = false;\n\t\tnode.startTime = 0;\n\t\tnode.playTime = 0;\n\t\tnode.callback = null;\n\t\tnode.timer = null;\n\t\tnode.res = null;\n\n\t\treturn node;\n\t},\n\n\tplay: function (snd, completeCallback, volume)\n\t{\n\t\tif (!this.MASTER.enabled || !snd || !snd.track.enabled)\n\t\t\treturn null;\n\n\t\tvar volume = (volume !== undefined && volume !== null) ? volume : 1.0;\n\n\t\tvar node = this.createNode(snd, volume);\n\t\tnode.callback = completeCallback;\n\n\t\treturn this.updateNode(node, 'play');\n\t},\n\n\tplayLoop: function (snd, completeCallback, volume)\n\t{\n\t\tif (!this.MASTER.enabled || !snd || !snd.track.enabled)\n\t\t\treturn null;\n\n\t\tvolume = (volume !== undefined && volume !== null) ? volume : 1.0;\n\t\n\t\tvar node = this.createNode(snd, volume);\n\t\tnode.callback = completeCallback;\n\t\tnode.loop = -1;\n\n\t\treturn this.updateNode(node, 'play');\n\t},\n\n\tstop: function (node, callback)\n\t{\n\t\tif (!node) return null;\n\n\t\tif (callback && callback !== true) node.callback = callback;\n\t\treturn this.updateNode(node, callback === true ? 'stop' : 'softstop');\n\t},\n\n\tpause: function (node)\n\t{\n\t\tif (!node) return null;\n\n\t\treturn this.updateNode(node, 'pause');\n\t},\n\n\tresume: function (node)\n\t{\n\t\tif (!node) return null;\n\n\t\treturn this.updateNode (node, 'play');\n\t},\n\n\tfadeOut: function (node, millis, callback)\n\t{\n\t\tif (!node) return;\n\n\t\tif (!node.playing || node.timer)\n\t\t{\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar startTime = hrnow();\n\t\tnode.startVolume = node.volume;\n\n\t\tnode.timer = setInterval (function()\n\t\t{\n\t\t\tvar t = ((hrnow() - startTime) / millis);\n\t\t\tif (t > 1) t = 1;\n\n\t\t\tnode.volume = node.startVolume*(1-t);\n\t\t\tSound.updateNode(node, 'setvolume');\n\n\t\t\tif (t == 1)\n\t\t\t{\n\t\t\t\tclearInterval (node.timer);\n\t\t\t\tnode.timer = null;\n\n\t\t\t\tif (callback === true)\n\t\t\t\t\tSound.updateNode(node, 'stop');\n\t\t\t\telse\n\t\t\t\t\tSound.updateNode(node, 'pause');\n\n\t\t\t\tif (callback && callback !== true)\n\t\t\t\t\tcallback();\n\t\t\t}\n\t\t},\n\t\t50);\n\t},\n\n\tfadeIn: function (node, millis, callback)\n\t{\n\t\tif (!node) return;\n\n\t\tif (node.playing || node.timer)\n\t\t{\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar startTime = hrnow();\n\n\t\tnode.volume = 0;\n\t\tthis.updateNode(node, 'play');\n\n\t\tnode.timer = setInterval (function()\n\t\t{\n\t\t\tvar t = ((hrnow() - startTime) / millis);\n\t\t\tif (t > 1) t = 1;\n\n\t\t\tnode.volume = node.startVolume*t;\n\t\t\tSound.updateNode(node, 'setvolume');\n\n\t\t\tif (t == 1)\n\t\t\t{\n\t\t\t\tclearInterval (node.timer);\n\t\t\t\tnode.timer = null;\n\n\t\t\t\tif (callback) callback();\n\t\t\t}\n\t\t},\n\t\t50);\n\t}\n});\n\n/**\n * \tCreates a descriptor for an audio resource.\n */\nResources.Audio = function (src, opts=null)\n{\n\treturn { type: \"audio\", wrapper: \"Sound\", src: src, ...opts };\n};\n\nexport default Sound;\n","\nimport { Class } from 'rinn';\nimport Sound from './sound.js';\n\n//![import \"./sound.js\"]\n\n/*\n\ttrack: string (music|sfx)\n\tmode: sequential|random\n*/\n\nexport default Class.extend\n({\n\tr: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"audios\")\n\t\t\tthrow new Error (\"Resource is not audios.\");\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tif (!this.r.track)\n\t\t\tthis.r.track = \"sfx\";\n\n\t\tif (!this.r.mode)\n\t\t\tthis.r.mode = \"random\";\n\n\t\tthis.track = Sound[this.r.track.toUpperCase()];\n\n\t\tthis.sounds = [];\n\t\tthis.lastIndex = -1;\n\n\t\tfor (var i = 0; i < this.r.data.length; i++)\n\t\t{\n\t\t\tthis.sounds.push(new Sound (Object.assign (this.r.data[i], { track: this.r.track })));\n\t\t}\n\t},\n\n\tgetRandomSound: function ()\n\t{\n\t\tif (this.r.mode == \"random\")\n\t\t\treturn this.sounds[randr(0, this.sounds.length-1)];\n\n\t\tthis.lastIndex = ++this.lastIndex % this.sounds.length;\n\t\treturn this.sounds[this.lastIndex];\n\t},\n\n\tplay: function (callback, volume)\n\t{\n\t\treturn Sound.play (this.getRandomSound(), callback, volume);\n\t},\n\n\tplayLoop: function (callback, volume)\n\t{\n\t\treturn Sound.playLoop (this.getRandomSound(), callback, volume);\n\t},\n\n\tplayAt: function (index, callback, volume)\n\t{\n\t\treturn Sound.play (this.sounds[index % this.sounds.length], callback, volume);\n\t},\n\n\tplayLoopAt: function (index, callback, volume)\n\t{\n\t\treturn Sound.playLoop (this.sounds[index % this.sounds.length], callback, volume);\n\t}\n});\n","\n//![import './drawable']\nimport _Drawable from './drawable.js'; export const Drawable = _Drawable;\n//![import './custom']\nimport _Custom from './custom.js'; export const Custom = _Custom;\n//![import './spritesheet']\nimport _Spritesheet from './spritesheet.js'; export const Spritesheet = _Spritesheet;\n//![import './spritesheet-animation']\nimport _SpritesheetAnimation from './spritesheet-animation.js'; export const SpritesheetAnimation = _SpritesheetAnimation;\n//![import './spritefont']\nimport _SpriteFont from './spritefont.js'; export const SpriteFont = _SpriteFont;\n//![import './sound']\nimport _Sound from './sound.js'; export const Sound = _Sound;\n//![import './sound-array']\nimport _SoundArray from './sound-array.js'; export const SoundArray = _SoundArray;\n","\nimport { Class } from 'rinn';\n\n//!class PriorityQueue\n\nexport default Class.extend\n({\n\tclassName: 'PriorityQueue',\n\n\tqueue: null,\n\tqueueKeys: null,\n\torder: null,\n\n\t/**\n\t * \tConstructs an priority queue.\n\t * \t!constructor();\n\t */\n\t__ctor: function()\n\t{\n\t\tthis.queue = { };\n\t\tthis.queueKeys = [];\n\t},\n\n\t/**\n\t * \tAdds an object to the priority queue.\n\t * \t!add (obj: object) : object;\n\t */\n\tadd: function (object)\n\t{\n\t\tif (object == null)\n\t\t\treturn null;\n\n\t\tif (!('priority' in object))\n\t\t\tobject.priority = 50;\n\n\t\tif (!(object.priority in this.queue))\n\t\t{\n\t\t\tthis.queue[object.priority] = { is_dirty: false, list: [ ] };\n\t\t\tthis.queueKeys.push(object.priority);\n\n\t\t\tthis.order = Object.keys(this.queue).sort((a,b) => a-b);\n\t\t}\n\n\t\tif (this.queue[object.priority].list.indexOf(object) === -1)\n\t\t\tthis.queue[object.priority].list.push(object);\n\n\t\treturn object;\n\t},\n\n\t/**\n\t * \tMarks an object to be removed from the priority queue. Use `cleanup` to actually remove them.\n\t * \t!remove (obj: object) : object;\n\t */\n\tremove: function (object)\n\t{\n\t\tif (object == null)\n\t\t\treturn null;\n\n\t\tif (!('priority' in object))\n\t\t\tobject.priority = 50;\n\n\t\tif (!(object.priority in this.queue))\n\t\t\treturn object;\n\n\t\tlet i = this.queue[object.priority].list.indexOf(object);\n\t\tif (i === -1) return object;\n\n\t\tthis.queue[object.priority].is_dirty = true;\n\t\tthis.queue[object.priority].list[i] = null;\n\n\t\treturn object;\n\t},\n\n\t/**\n\t * \tRuns a cleanup of the queue by removing any objects marked to be removed.\n\t * \t!cleanup() : void;\n\t */\n\tcleanup: function()\n\t{\n\t\tfor (let i = 0; i < this.queueKeys.length; i++)\n\t\t{\n\t\t\tlet q = this.queue[this.queueKeys[i]];\n\t\t\tif (!q.is_dirty) continue;\n\n\t\t\tfor (let j = 0; j < q.list.length; j++)\n\t\t\t{\n\t\t\t\tif (q.list[j] == null)\n\t\t\t\t{\n\t\t\t\t\tq.list.splice(j--, 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tq.is_dirty = false;\n\t\t}\n\t},\n\n\t/**\n\t * \tRuns the specified callback for each object in the queue. Executed in order of priority (from low number to high number).\n\t * \t@param callback - Return `false` to stop the forEach execution immediately.\n\t * \t!forEach (callback: (obj: object) => boolean) : void;\n\t */\n\tforEach: function (callback)\n\t{\n\t\tlet is_dirty = false;\n\t\tlet is_complete = false;\n\n\t\tfor (let i = 0; !is_complete && i < this.order.length; i++)\n\t\t{\n\t\t\tlet list = this.queue[this.order[i]].list;\n\n\t\t\tfor (let j = 0; !is_complete && j < list.length; j++)\n\t\t\t{\n\t\t\t\tif (list[j] != null)\n\t\t\t\t{\n\t\t\t\t\tif (callback(list[j]) === false)\n\t\t\t\t\t\tis_complete = true;\n\t\t\t\t}\n\n\t\t\t\tif (list[j] == null)\n\t\t\t\t\tis_dirty = true;\n\t\t\t}\n\t\t}\n\n\t\tif (is_dirty) this.cleanup();\n\t},\n\n\t/**\n\t * \tRuns the specified callback for each object in the queue. Executed in reverse order of priority (from high number to low number).\n\t * \t@param callback - Return `false` to stop the forEachRev execution immediately.\n\t * \t!forEachRev (callback: (obj: object) => boolean) : void;\n\t */\n\tforEachRev: function (callback)\n\t{\n\t\tlet is_dirty = false;\n\t\tlet is_complete = false;\n\n\t\tfor (let i = this.order.length-1; !is_complete && i >= 0; i--)\n\t\t{\n\t\t\tlet list = this.queue[this.order[i]].list;\n\n\t\t\tfor (let j = list.length-1; !is_complete && j >= 0; j--)\n\t\t\t{\n\t\t\t\tif (list[j] != null)\n\t\t\t\t{\n\t\t\t\t\tif (callback(list[j]) === false)\n\t\t\t\t\t\tis_complete = true;\n\t\t\t\t}\n\n\t\t\t\tif (list[j] == null)\n\t\t\t\t\tis_dirty = true;\n\t\t\t}\n\t\t}\n\n\t\tif (is_dirty) this.cleanup();\n\t},\n\n\t/**\n\t * \tRuns the specified callback for each object in the queue. Executed in order of priority (from low number to high number). When\n\t * \tthe cycle finishes the given `finishedCallback` will be executed.\n\t * \t@param callback - Return `false` to stop the forEachAsync execution immediately. Must manually execute `next` when finished.\n\t * \t!forEachAsync (callback: (obj: object, next: Function) => boolean) : void;\n\t */\n\tforEachAsync: function (callback, finishedCallback=null)\n\t{\n\t\tlet _ = this;\n\n\t\tlet is_dirty = false;\n\t\tlet is_complete = false;\n\n\t\tlet i = -1;\n\t\tlet j = -1;\n\n\t\tlet list = null;\n\n\t\tlet next_j = function()\n\t\t{\n\t\t\tj++;\n\n\t\t\tif (!is_complete && j < list.length)\n\t\t\t{\n\t\t\t\tif (list[j] != null)\n\t\t\t\t{\n\t\t\t\t\tif (callback(list[j], next_j) === false)\n\t\t\t\t\t\tis_complete = true;\n\t\t\t\t}\n\n\t\t\t\tif (list[j] == null)\n\t\t\t\t\tis_dirty = true;\n\n\t\t\t\tif (is_complete) next_j();\n\t\t\t}\n\t\t\telse\n\t\t\t\tnext_i();\n\t\t};\n\n\t\tlet next_i = function()\n\t\t{\n\t\t\ti++;\n\n\t\t\tif (!is_complete && i < _.order.length)\n\t\t\t{\n\t\t\t\tlist = _.queue[_.order[i]].list;\n\t\t\t\tj = -1;\n\t\t\t\tnext_j();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (is_dirty) _.cleanup();\n\t\t\t\tif (finishedCallback) finishedCallback();\n\t\t\t}\n\t\t};\n\n\t\tnext_i();\n\t},\n\n\t/**\n\t * \tRuns the specified callback for each object in the queue. Executed in reverse order of priority (from high number to low number). When\n\t * \tthe cycle finishes the given `finishedCallback` will be executed.\n\t * \t@param callback - Return `false` to stop the forEachRevAsync execution immediately. Must manually execute `next` when finished.\n\t * \t!forEachRevAsync (callback: (obj: object, next: Function) => boolean) : void;\n\t */\n\tforEachRevAsync: function (callback)\n\t{\n\t\talert('NOT IMPLEMENTED: forEachRevAsync');\n\t}\n});\n","\nimport { Class } from 'rinn';\nimport Recycler from './recycler.js';\n\n//![import \"./recycler\"]\n\n//:/**\n//: * Defines a callback node. Contains a callback function, and up to six arguments.\n//: */\n\n//!class Callback\n\nconst Callback = Class.extend\n({\n\tclassName: 'Callback',\n\n\t/**\n\t * Callback function.\n\t */\n\tcallback: null,\n\n\t/**\n\t * Optional arguments.\n\t */\n\targ0: null,\n\targ1: null,\n\targ2: null,\n\targ3: null,\n\targ4: null,\n\targ5: null,\n\n\t/**\n\t * Links to the previous and next callbacks.\n\t */\n\tprev: null,\n\tnext: null,\n\n\t/**\n\t * Initializes the callback with the specified arguments.\n\t * !constructor (callback: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any);\n\t */\n\t__ctor: function (callback, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tthis.callback = callback;\n\n\t\tthis.arg0 = arg0;\n\t\tthis.arg1 = arg1;\n\t\tthis.arg2 = arg2;\n\t\tthis.arg3 = arg3;\n\t\tthis.arg4 = arg4;\n\t\tthis.arg5 = arg5;\n\n\t\tthis.prev = null;\n\t\tthis.next = null;\n\t},\n\n\t/**\n\t * Destructs the instance.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.callback = null;\n\n\t\tthis.arg0 = null;\n\t\tthis.arg1 = null;\n\t\tthis.arg2 = null;\n\t\tthis.arg3 = null;\n\t\tthis.arg4 = null;\n\t\tthis.arg5 = null;\n\n\t\tthis.prev = null;\n\t\tthis.next = null;\n\t},\n\n\t/**\n\t * Returns true if the specified arguments are the same as the callback. Compares from left to right. All `null` values are ignored.\n\t */\n\tisEqual: function (callback=null, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tif (callback !== null && Callback.isInstance(callback))\n\t\t\treturn callback === this;\n\n\t\tif (callback !== null && this.callback !== callback)\n\t\t\treturn false;\n\n\t\tif (arg0 !== null && this.arg0 !== arg0)\n\t\t\treturn false;\n\n\t\tif (arg1 !== null && this.arg1 !== arg1)\n\t\t\treturn false;\n\n\t\tif (arg2 !== null && this.arg2 !== arg2)\n\t\t\treturn false;\n\n\t\tif (arg3 !== null && this.arg3 !== arg3)\n\t\t\treturn false;\n\n\t\tif (arg4 !== null && this.arg4 !== arg4)\n\t\t\treturn false;\n\n\t\tif (arg5 !== null && this.arg5 !== arg5)\n\t\t\treturn false;\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tExecutes the callback. Returns `false` if the callback has finished and should be removed.\n\t * \t@param host - Host object.\n\t * \t!exec (host: Object) : boolean;\n\t */\n\texec: function (host)\n\t{\n\t\tif (this.callback !== null)\n\t\t\treturn this.callback (host, this.arg0, this.arg1, this.arg2, this.arg3, this.arg4, this.arg5);\n\n\t\treturn true;\n\t}\n});\n\n//!/class\n\n//!namespace Callback\n//!namespace Pool\n\n/**\n * \tAllocates a callback with the specified arguments.\n * \t!function alloc (callback: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) : Callback;\n */\n\nRecycler.createPool(Callback, 16384, 6144);\nexport default Callback;\n","\nimport { Class } from 'rinn';\nimport Recycler from './recycler.js';\nimport Callback from './callback.js';\n\n//![import \"./recycler\"]\n//![import \"./callback\"]\n\n//:/**\n//: * The handler class allows zero or more callbacks to be attached, such that when the `exec` method is invoked, all attached callbacks will also be executed.\n//: */\n\n//!class Handler\n\nconst Handler = Class.extend\n({\n\tclassName: 'Handler',\n\n\t/**\n\t * Handler host element or value.\n\t * !host: any;\n\t */\n\thost: null,\n\n\t/**\n\t * Top and bottom of the linked list.\n\t */\n\ttop: null,\n\tbottom: null,\n\n\t/**\n\t * Initializes the Handler instance.\n\t * !constructor (host?: any);\n\t */\n\t__ctor: function (host=null)\n\t{\n\t\tthis.host = host;\n\n\t\tthis.top = null;\n\t\tthis.bottom = null;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Removes all callbacks from the handler.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.remove();\n\t},\n\n\t/**\n\t * Adds the specified callback to the handler.\n\t * !add (callback: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) : Callback;\n\t */\n\tadd: function (callback, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tlet node = Callback.isInstance(callback) ? callback : Callback.Pool.alloc(callback, arg0, arg1, arg2, arg3, arg4, arg5);\n\n\t\tnode.prev = this.bottom;\n\n\t\tif (this.bottom !== null)\n\t\t\tthis.bottom.next = node;\n\n\t\tthis.bottom = node;\n\n\t\tif (this.top === null)\n\t\t\tthis.top = node;\n\n\t\treturn node;\n\t},\n\n\t/**\n\t * Removes a callback from the handler.\n\t * !unlink (node: Callback) : Handler;\n\t */\n\tunlink: function (node)\n\t{\n\t\tif (node.prev) node.prev.next = node.next;\n\t\tif (node.next) node.next.prev = node.prev;\n\n\t\tif (this.top === node)\n\t\t\tthis.top = node.next;\n\n\t\tif (this.bottom === node)\n\t\t\tthis.bottom = node.prev;\n\n\t\tnode.prev = null;\n\t\tnode.next = null;\n\n\t\tdispose(node);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Removes all callbacks matching the specified arguments.\n\t * !remove (callback?: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) : Handler;\n\t */\n\tremove: function (callback=null, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tif (callback !== null && Callback.isInstance(callback))\n\t\t{\n\t\t\tthis.unlink(callback);\n\t\t\treturn this;\n\t\t}\n\n\t\tlet node = this.top;\n\n\t\twhile (node !== null)\n\t\t{\n\t\t\tlet next = node.next;\n\n\t\t\tif (node.isEqual(callback, arg0, arg1, arg2, arg3, arg4, arg5))\n\t\t\t\tthis.unlink(node);\n\n\t\t\tnode = next;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the first callback matching the specified arguments.\n\t * !find (callback: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) : Callback;\n\t */\n\tfind: function (callback, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tlet node = this.top;\n\n\t\twhile (node !== null)\n\t\t{\n\t\t\tif (node.isEqual(callback, arg0, arg1, arg2, arg3, arg4, arg5))\n\t\t\t\treturn node;\n\n\t\t\tnode = node.next;\n\t\t}\n\n\t\treturn null;\n\t},\n\n\t/**\n\t * Executes all callbacks in the handler.\n\t * !exec (host?: any) : void;\n\t */\n\texec: function (host=null)\n\t{\n\t\tlet node = this.top;\n\n\t\thost = host ?? this.host;\n\n\t\twhile (node !== null)\n\t\t{\n\t\t\tlet next = node.next;\n\n\t\t\tlet value = node.exec(host);\n\t\t\tif (value === null) break;\n\n\t\t\tif (value === false)\n\t\t\t\tthis.unlink(node);\n\n\t\t\tnode = next;\n\t\t}\n\t},\n\n\t/**\n\t * Executes the first callback matching the specified arguments.\n\t * !execf (callback?: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) : void;\n\t */\n\texecf: function (callback=null, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tlet node = this.top;\n\n\t\twhile (node !== null)\n\t\t{\n\t\t\tlet next = node.next;\n\n\t\t\tif (node.isEqual(callback, arg0, arg1, arg2, arg3, arg4, arg5))\n\t\t\t{\n\t\t\t\tif (node.exec(this.host) === false)\n\t\t\t\t\tthis.unlink(node);\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tnode = next;\n\t\t}\n\t},\n\n\t/**\n\t * Executes the specified callback.\n\t * !execc (node: Callback, host?: any) : void;\n\t */\n\texecc: function (node, host=null)\n\t{\n\t\tif (node.exec(host ?? this.host) === false)\n\t\t\tthis.unlink(node);\n\t}\n});\n\n//!/class\n\n//!namespace Handler\n//!namespace Pool\n\n/**\n * \tAllocates a new handler instance.\n * \t!function alloc (host?: Object) : Handler;\n */\n\nRecycler.createPool(Handler, 16384, 6144);\nexport default Handler;\n","\nimport { Class } from 'rinn';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"../utils/recycler\"]\n//![import \"./vec2\"]\n\n//:/**\n//: * \tRepresents a 2D rectangle.\n//: */\n\n//!class Rect\n\nconst Rect = Class.extend\n({\n\tclassName: 'Rect',\n\n\t/**\n\t * \tCoordinates of the rectangle (cx and cy are for the center). Note that this fields are readonly they should be\n\t * \tmodified through methods only.\n\t */\n\n\t/**\n\t * \t!readonly cx: number;\n\t */\n\tcx: 0,\n\t/**\n\t * \t!readonly cy: number;\n\t */\n\tcy: 0,\n\t/**\n\t * \t!readonly x1: number;\n\t */\n\tx1: 0,\n\t/**\n\t * \t!readonly y1: number;\n\t */\n\ty1: 0,\n\t/**\n\t * \t!readonly x2: number;\n\t */\n\tx2: 0,\n\t/**\n\t * \t!readonly y2: number;\n\t */\n\ty2: 0,\n\n\t/**\n\t * \tConstructs a rectangle of zero size, centered at (0, 0).\n\t * \t!constructor();\n\t */\n\t/**\n\t * \tConstructs a rectangle centered at (0, 0) with the specified size.\n\t * \t!constructor (width: number, height: number);\n\t */\n\t/**\n\t * \tConstructs a rectangle with the specified coordinates.\n\t * \t!constructor (x1: number, y1: number, x2: number, y2: number);\n\t */\n\t__ctor: function (x1=null, y1=null, x2=null, y2=null)\n\t{\n\t\tif (x1 === null)\n\t\t{\n\t\t\tthis.x1 = this.y1 = this.x2 = this.y2 = this.cx = this.cy = 0;\n\t\t\treturn this;\n\t\t}\n\n\t\tif (x2 === null)\n\t\t{\n\t\t\tthis.set (0, 0, 0, 0);\n\t\t\tthis.resize (x1, y1);\n\t\t\treturn this;\n\t\t}\n\n\t\treturn this.set(x1, y1, x2, y2);\n\t},\n\n\t/*\n\t**\tDestructor.\n\t*/\n\t__dtor: function ()\n\t{\n\t},\n\n\t/**\n\t * \tReturns a clone of the rectangle.\n\t * \t!clone() : Rect;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Rect.Rool.alloc(this.x1, this.y1, this.x2, this.y2);\n\t},\n\n\t/**\n\t * \tSets all coordinates of the rectangle to zero.\n\t * \t!zero() : Rect;\n\t */\n\tzero: function ()\n\t{\n\t\tthis.cx = 0; this.cy = 0;\n\t\tthis.x1 = 0; this.y1 = 0;\n\t\tthis.x2 = 0; this.y2 = 0;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets all coordinates of the rectangle to `null` for subsequent use with `extendWithPoint`.\n\t * \t!reset() : Rect;\n\t */\n\treset: function ()\n\t{\n\t\tthis.cx = null; this.cy = null;\n\t\tthis.x1 = null; this.y1 = null;\n\t\tthis.x2 = null; this.y2 = null;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tExtends the rectangle to contain the specified vector coordinates.\n\t * \t!extendWithPoint (v: Vec2) : Rect;\n\t */\n\t/**\n\t * \tExtends the rectangle to contain the specified point.\n\t * \t!extendWithPoint (x: number, y: number) : Rect;\n\t */\n\textendWithPoint: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tconst r = x;\n\t\t\tx = r.x;\n\t\t\ty = r.y;\n\t\t}\n\n\t\tif (this.x1 === null || x < this.x1) this.x1 = x;\n\t\tif (this.y1 === null || y < this.y1) this.y1 = y;\n\t\tif (this.x2 === null || x > this.x2) this.x2 = x;\n\t\tif (this.y2 === null || y > this.y2) this.y2 = y;\n\n\t\tthis.cx = (this.x1 + this.x2) / 2;\n\t\tthis.cy = (this.y1 + this.y2) / 2;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tTranslates the rectangle by the given deltas.\n\t * \t!translate (dx: number, dy: number) : Rect;\n\t */\n\ttranslate: function (dx, dy)\n\t{\n\t\tthis.x1 += dx; this.y1 += dy;\n\t\tthis.x2 += dx; this.y2 += dy;\n\t\tthis.cx += dx; this.cy += dy;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMoves the center of the rectangle to the specified position.\t \n\t * \t@param normalized - When `true` the arguments `x` and `y` are treated as normalized ranging from 0 to 1 (inclusive).\n\t * \t!centerAt (x: number, y: number, normalized?: false) : Rect;\n\t */\n\tcenterAt: function (x, y, normalized=false)\n\t{\n\t\tif (normalized == true)\n\t\t{\n\t\t\tx = this.x1 + x*(this.x2 - this.x1);\n\t\t\ty = this.y1 + y*(this.y2 - this.y1);\n\t\t}\n\n\t\treturn this.translate (x - this.cx, y - this.cy);\n\t},\n\n\t/**\n\t * \tCopies the coordinates of the specified rectangle.\n\t * \t!set (r: Rect) : Rect;\n\t */\n\t/**\n\t * \tSets the coordinates of the rectangle.\n\t * \t!set (x1: number, y1: number, x2: number, y2: number) : Rect;\n\t */\n\tset: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\tthis.cx = (x1 + x2) / 2;\n\t\tthis.cy = (y1 + y2) / 2;\n\n\t\tthis.x1 = x1;\n\t\tthis.y1 = y1;\n\t\tthis.x2 = x2;\n\t\tthis.y2 = y2;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns `true` if the given rectangle coordinates are equal.\n\t * \t!equals (r: Rect) : boolean;\n\t */\n\t/**\n\t * \tReturns `true` if the coordinates are equal.\n\t * \t!equals (x1: number, y1: number, x2: number, y2: number) : boolean;\n\t */\n\tequals: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\treturn x1 == this.x1 && x2 == this.x2 && y1 == this.y1 && y2 == this.y2;\n\t},\n\n\t/**\n\t * \tReturns `true` if the specified rectangle is contained in the current one.\n\t * \t!contains (r: Rect) : boolean;\n\t */\n\t/**\n\t * \tReturns `true` if the specified rectangle is contained in the current one.\n\t * \t!contains (x1: number, y1: number, x2: number, y2: number) : boolean;\n\t */\n\tcontains: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\treturn (x1 == Math.max(this.x1, x1)) && (y1 == Math.max(this.y1, y1)) && (x2 == Math.min(this.x2, x2)) && (y2 == Math.min(this.y2, y2));\n\t},\n\n\t/**\n\t * \tSets the coordinates of the rectangle to the union of it and the given one.\n\t * \t!setAsUnion (r: Rect) : Rect;\n\t */\n\t/**\n\t * \tSets the coordinates of the rectangle to the union of it and the given one.\n\t * \t!setAsUnion (x1: number, y1: number, x2: number, y2: number) : Rect;\n\t */\n\tsetAsUnion: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\tthis.x1 = Math.min(this.x1, x1);\n\t\tthis.y1 = Math.min(this.y1, y1);\n\t\tthis.x2 = Math.max(this.x2, x2);\n\t\tthis.y2 = Math.max(this.y2, y2);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns `true` if the rectangles intersect.\n\t * \t!intersects (r: Rect) : boolean;\n\t */\n\t/**\n\t * \tReturns `true` if the rectangles intersect.\n\t * \t!intersects (x1: number, y1: number, x2: number, y2: number) : boolean;\n\t */\n\tintersects: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\tlet _x1 = Math.max(this.x1, x1);\n\t\tlet _y1 = Math.max(this.y1, y1);\n\t\tlet _x2 = Math.min(this.x2, x2);\n\t\tlet _y2 = Math.min(this.y2, y2);\n\n\t\treturn Math.max(0, _y2-_y1) * Math.max(0, _x2-_x1) > 0;\n\t},\n\n\t/**\n\t * \tSets the coordinates of the rectangle to the intersection of it and the given one.\n\t * \t@returns Boolean indicating if the intersection is non-empty.\n\t * \t!setAsIntersection (r: Rect) : boolean;\n\t */\n\t/**\n\t * \tSets the coordinates of the rectangle to the intersection of it and the given one.\n\t * \t@returns Boolean indicating if the intersection is non-empty.\n\t * \t!setAsIntersection (x1: number, y1: number, x2: number, y2: number) : boolean;\n\t */\n\tsetAsIntersection: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\tthis.x1 = Math.max(this.x1, x1);\n\t\tthis.y1 = Math.max(this.y1, y1);\n\t\tthis.x2 = Math.min(this.x2, x2);\n\t\tthis.y2 = Math.min(this.y2, y2);\n\n\t\treturn Math.max(0, this.y2-this.y1) * Math.max(0, this.x2-this.x1) > 0;\n\t},\n\n\t/**\n\t * \tResizes the rectangle to the given size using its center or top-left corner as reference.\n\t * \t@param topLeftRelative - When `true` reference will be top-left corner, set to `false` to use the center.\n\t * \t@param normalized - When `true` the `w` and `h` will be treated as normalized ranging from 0 to 1 (inclusive).\n\t * \t!resize (w: number, h: number, normalized?: boolean, topLeftRelative?: boolean) : Rect;\n\t */\n\tresize: function (w, h, topLeftRelative=false, normalized=false)\n\t{\n\t\tif (normalized == true)\n\t\t{\n\t\t\tw *= (this.x2 - this.x1);\n\t\t\th *= (this.y2 - this.y1);\n\t\t}\n\n\t\tif (topLeftRelative == true)\n\t\t{\n\t\t\tthis.x2 = this.x1 + w;\n\t\t\tthis.y2 = this.y1 + h;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tw /= 2; h /= 2;\n\n\t\t\tthis.x1 = this.cx - w; this.y1 = this.cy - h;\n\t\t\tthis.x2 = this.cx + w; this.y2 = this.cy + h;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResizes the rectangle using the specified deltas, relative to its center or top-left corner.\n\t * \t@param topLeftRelative - When `true` reference will be top-left corner, set to `false` to use the center.\n\t * \t!resizeBy (dw: number, dh: number, topLeftRelative?: boolean) : Rect;\n\t */\n\tresizeBy: function (dw, dh, topLeftRelative=false)\n\t{\n\t\tif (topLeftRelative == true)\n\t\t{\n\t\t\tthis.x2 += dw;\n\t\t\tthis.y2 += dh;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdw /= 2; dh /= 2;\n\n\t\t\tthis.x1 -= dw; this.y1 -= dh;\n\t\t\tthis.x2 += dw; this.y2 += dh;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the width of the rectangle.\n\t * \t!width() : number;\n\t */\n\twidth: function ()\n\t{\n\t\treturn this.x2 - this.x1;\n\t},\n\n\t/**\n\t * \tReturns the height of the rectangle.\t \n\t * \t!height() : number;\n\t */\n\theight: function ()\n\t{\n\t\treturn this.y2 - this.y1;\n\t},\n\n\t/**\n\t * \tReturns the normalized center X-coordinate of the rectangle.\n\t * \t!ncx() : number;\n\t */\n\tncx: function ()\n\t{\n\t\treturn (this.cx - this.x1) / (this.x2 - this.x1);\n\t},\n\n\t/**\n\t * \tReturns the normalized center Y-coordinate of the rectangle.\n\t * \t!ncy() : number;\n\t */\n\tncy: function ()\n\t{\n\t\treturn (this.cy - this.y1) / (this.y2 - this.y1);\n\t},\n\n\t/**\n\t * \tReturns `true` if the rectangle is a right rectangle, that is: x1 < x2 and y1 < y2.\n\t * \t!isRight() : boolean;\n\t */\n\tisRight: function ()\n\t{\n\t\treturn this.x1 <= this.x2 && this.y1 <= this.y2;\n\t},\n\n\t/**\n\t * \tReturns `true` if the specified point is contained in the rectangle.\n\t * \t@param tol - Used to specify a tolerance value (default is zero).\n\t * \t!containsPoint (x: number, y: number, tol?: number) : boolean;\n\t */\n\tcontainsPoint: function (x, y, tol=0)\n\t{\n\t\treturn (this.x1-tol <= x && x <= this.x2+tol) && (this.y1-tol <= y && y <= this.y2+tol);\n\t},\n\n\t/**\n\t * \tReturns the area of the rectangle.\n\t * \t@param strict - Indicates if the area is returned only if the rectangle is a right rectangle. \t \n\t * \t!area (strict?: boolean) : number;\n\t */\n\tarea: function (strict)\n\t{\n\t\treturn strict ? (this.isRight() ? (this.y2-this.y1)*(this.x2-this.x1) : 0) : ((this.y2-this.y1)*(this.x2-this.x1));\n\t},\n\n\t/**\n\t * \tSets the components of the rectangle to their rounded-down integer parts.\n\t * \t!floor() : Rect;\n\t */\n\tfloor: function()\n\t{\n\t\tthis.x1 = Math.floor(this.x1);\n\t\tthis.y1 = Math.floor(this.y1);\n\t\tthis.x2 = Math.floor(this.x2);\n\t\tthis.y2 = Math.floor(this.y2);\n\t\tthis.cx = Math.floor(this.cx);\n\t\tthis.cy = Math.floor(this.cy);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the components of the rectangle to their rounded-up integer parts.\n\t * \t!ceil() : Rect;\n\t */\n\tceil: function()\n\t{\n\t\tthis.x1 = Math.ceil(this.x1);\n\t\tthis.y1 = Math.ceil(this.y1);\n\t\tthis.x2 = Math.ceil(this.x2);\n\t\tthis.y2 = Math.ceil(this.y2);\n\t\tthis.cx = Math.ceil(this.cx);\n\t\tthis.cy = Math.ceil(this.cy);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the string representation of the rectangle.\n\t * \t!toString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn \"(\" + this.x1.toFixed(2) + \", \" + this.y1.toFixed(2) + \", \" + this.x2.toFixed(2) + \", \" + this.y2.toFixed(2) + \")\";\n\t},\n\n\t/**\n\t * \tFlattens the rectangle.\n\t * \t!flatten() : Array<number>;\n\t */\n\tflatten: function ()\n\t{\n\t\treturn [this.x1, this.y1, this.x2, this.y2];\n\t},\n\n\t/**\n\t * \tUnflattens the rectangle.\n\t * \t!unflatten(input: Array<number>) : Rect;\n\t */\n\tunflatten: function (o)\n\t{\n\t\tthis.set (o[0], o[1], o[2], o[3]);\n\t\treturn this;\n\t}\n});\n\n//!/class\n\n//!namespace Rect\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a new rectangle of zero size.\n\t * \t!function alloc() : Rect;\n\t */\n\t/**\n\t * \tAllocates a new rectangle centered at (0, 0) with the specified size.\n\t * \t!function alloc (width: number, height: number) : Rect;\n\t */\n\t/**\n\t * \tAllocates a new rectangle with the specified coordinates.\n\t * \t!function alloc (x1: number, y1: number, x2: number, y2: number) : Rect;\n\t */\n\nRecycler.createPool (Rect, 4096, 2048);\nexport default Rect;\n","\nimport { Class } from 'rinn';\n\n//:/**\n//: * \tDescribes a function dependent of time (t-function), multiple sampling points (t,y) can be added, this class\n//: * \tprovides methods to access any value for a given time, or the integral of a time range.\n//: */\n\n//!class TFunction\n\nconst TFunction = Class.extend\n({\n\tclassName: 'TFunction',\n\n\t/**\n\t * \tContains the time values `t` in the t-function, for each time value there is a corresponding `y` and `f`.\n\t * \t!t: Array<number>;\n\t */\n\tt: null,\n\n\t/**\n\t * \tContains the values (y) for each of the time values (t) in the t-function.\n\t * \t!y: Array<number>;\n\t */\n\ty: null,\n\n\t/**\n\t * \tContains the easing function (f) for each of the time values (t).\n\t * \t!f: Array< (t:number) => number >;\n\t */\n\tf: null,\n\n\t/**\n\t * \tConstructs the time function.\n\t * \t@param value - Initial value of the t-function for t=0, defaults to 0.\n\t * \t!constructor (value?: number);\n\t */\n\t__ctor: function (value=0)\n\t{\n\t\tthis.reset(value);\n\t},\n\n\t/**\n\t * \tResets the t-function to its initial state.\n\t * \t@param value - Initial value of the t-function for t=0. Default is 0.\n\t * \t!reset (value?: number) : TFunction;\n\t */\n\treset: function (value=0)\n\t{\n\t\tthis.t = [0];\n\t\tthis.y = [value];\n\t\tthis.f = [null];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResets the t-function and copies data from the specified source.\n\t * \t@param src - Source TFunction.\n\t * \t@param t0 - Initial time, if none specified will be assumed to be the min time of the source.\n\t * \t@param t1 - Final time, if none specified will be assumed to the the max time of the source.\n\t * \t@returns A TFunction or `null` if the specified time range could not be resolved.\n\t * \t!copyFrom (src: TFunction, t0: number, t1: number) : TFunction;\n\t */\n\tcopyFrom: function (src, t0, t1)\n\t{\n\t\tthis.t = [];\n\t\tthis.y = [];\n\t\tthis.f = [];\n\n\t\tif (t0 == null && t1 == null)\n\t\t{\n\t\t\tfor (let i = 0; i < src.t.length; i++)\n\t\t\t{\n\t\t\t\tthis.t.push(src.t[i]);\n\t\t\t\tthis.y.push(src.y[i]);\n\t\t\t\tthis.f.push(src.f[i]);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\tif (t0 == null) t0 = src.t[0];\n\t\tif (t1 == null) t1 = src.t[src.t.length-1];\n\n\t\tif (t0 < src.t[0]) t0 = src.t[0];\n\n\t\tlet i0 = src.find(t0);\n\t\tlet i1 = src.find(t1);\n\n\t\tif (i0 == null) return null;\n\t\tif (i1 == null) return null;\n\n\t\tif (src.t[i0] != t0) {\n\t\t\tthis.set(t0, src.getAt(t0), src.f[i0]);\n\t\t\ti0++;\n\t\t}\n\n\t\tfor (let i = i0; i <= i1; i++)\n\t\t\tthis.set(src.t[i], src.y[i], src.f[i]);\n\n\t\tif (src.t[i1] != t1)\n\t\t{\n\t\t\tlet dt = (t1 - src.t[i1]) / Math.ceil(Math.log(t1 - src.t[i1]));\n\t\t\tlet t = this.t[this.t.length-1];\n\n\t\t\tif (dt <= 0) dt = 1;\ndt = t1-t; // Force just one step.\n\t\t\twhile (t != t1)\n\t\t\t{\n\t\t\t\tif (t+dt > t1)\n\t\t\t\t\tdt = t1 - t;\n\n\t\t\t\tt += dt;\n\t\t\t\tthis.set(float4(t), src.getAt(t), src.f[i1]);\n\t\t\t}\n\t\t}\n\t\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCreates a new t-function with the same values as the current one.\n\t * \t@param t0 - Initial time, if none specified will be assumed to be the min time of the source.\n\t * \t@param t1 - Final time, if none specified will be assumed to the the max time of the source.\n\t * \t!clone (t0: number, t1: number) : TFunction;\n\t */\n\tclone: function (t0, t1)\n\t{\n\t\treturn (new TFunction()).copyFrom(this, t0, t1);\n\t},\n\n\t/**\n\t * \tReturns the maximum time value in the t-function plus the given delta.\n\t * \t@param delta - Delta value to add to the result.\n\t * \t!endTime (delta?: number) : number;\n\t */\n\tendTime: function (delta=0)\n\t{\n\t\treturn this.t[this.t.length-1] + delta;\n\t},\n\n\t/**\n\t * \tReturns the start time of the t-function plus the given delta.\n\t * \t@param delta - Delta value to add to the result.\n\t * \t!startTime (delta?: number) : number;\n\t */\n\tstartTime: function (delta=0)\n\t{\n\t\treturn this.t[0] + delta;\n\t},\n\n\t/**\n\t * \tFinds the index of a sampling point whose sampling range contains the given time.\n\t * \t@param time - Time value to search.\n\t * \t@returns Index of the sampling point or `null` if not within range.\n\t * \t!find (time: number) : number|null;\n\t */\n\tfind: function (time)\n\t{\n\t\tif (time < this.t[0])\n\t\t\treturn null;\n\n\t\tconst n = this.t.length;\n\n\t\tfor (let i = 1; i < n; i++)\n\t\t{\n\t\t\tif (time < this.t[i])\n\t\t\t\treturn i-1;\n\t\t}\n\n\t\treturn n-1;\n\t},\n\n\t/**\n\t * \tSets a sampling point (t,y).\n\t * \t@param t - Time value of the sampling point.\n\t * \t@param y - Y-value for the given t.\n\t * \t@param f - Easing function.\n\t * \t!set (t: number, y: number, f?: (t: number) => number) : TFunction;\n\t */\n\tset: function (t, y, f=null)\n\t{\n\t\tlet i = this.find(t);\n\t\tif (i == null) return false;\n\n\t\tif (this.t[i] == t)\n\t\t{\n\t\t\tthis.y[i] = y;\n\t\t\tif (f != null) this.f[i] = f;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ti++;\n\t\t\tthis.t.splice(i, 0, t);\n\t\t\tthis.y.splice(i, 0, y);\n\t\t\tthis.f.splice(i, 0, f);\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tReturns the last Y-value in the t-function.\n\t *\t!get() : number;\n\t */\n\tget: function ()\n\t{\n\t\treturn this.y[this.y.length-1];\n\t},\n\n\t/**\n\t * \tReturns the Y-value in the t-function corresponding to some point in time (t).\n\t * \t@param t - Time (t) value.\n\t * \t!getAt (t: number) : number;\n\t */\n\tgetAt: function (t)\n\t{\n\t\tlet i0 = this.find(t);\n\t\tif (i0 == null) return 0;\n\n\t\tlet i1 = i0 + 1;\n\n\t\tif (this.t[i0] == t || i1 >= this.t.length || this.y[i0] == this.y[i1] || this.f[i0] == null)\n\t\t\treturn this.y[i0];\n\n\t\tif (this.f[i0] == null)\n\t\t\treturn this.y[i0];\n\n\t\tlet x = t;\n\t\tlet x0 = this.t[i0];\n\t\tlet x1 = this.t[i1];\n\t\tlet y0 = this.y[i0];\n\t\tlet y1 = this.y[i1];\n\n\t\tt = (x - x0) / (x1 - x0);\n\t\tt = this.f[i0](t);\n\n\t\treturn t*y1 + (1-t)*y0;\n\t},\n\n\t/**\n\t * \tReturns the approximate definite integral of the t-function for the given time range.\n\t * \t@param t0 - Initial time value, defaults to minimum time of the t-function.\n\t * \t@param t1 - Final time value, defaults to the maximum time of the t-function.\n\t * \t@param c0 - Constant of integration, defaults to 0.\n\t * \t@returns Definite integral of t-function from t0 to t1.\n\t * \t!integral (t0?: number, t1?: number, c0?: number) : number;\n\t */\n\tintegral: function (t0=null, t1=null, c0=0)\n\t{\n\t\tif (t0 == null) t0 = this.t[0];\n\t\tif (t1 == null) t1 = this.t[this.t.length-1];\n\n\t\tif (t0 < this.t[0]) t0 = this.t[0];\n\n\t\tlet sign = 1;\n\n\t\tif (t0 > t1) {\n\t\t\tlet tmp; tmp = t0; t0 = t1; t1 = tmp;\n\t\t\tsign = -1;\n\t\t}\n\n\t\tlet accum = c0;\n\n\t\tfor (let time = t0; time < t1; )\n\t\t{\n\t\t\tlet i0 = this.find(time);\n\t\t\tif (i0 == null) return 0;\n\n\t\t\tlet i1 = i0 + 1;\n\n\t\t\tlet x0 = Math.max(this.t[i0], time);\n\t\t\tlet x1 = Math.min(i1 < this.t.length ? this.t[i1] : t1, t1);\n\n\t\t\tlet y0 = this.getAt(x0);\n\t\t\tlet y1 = this.getAt(x1);\n\n\t\t\tlet dx = x1 - x0;\n\t\t\tlet dy = y1 - y0;\n\n\t\t\tif (this.f[i0] == null)\n\t\t\t\taccum += y0*dx;\n\t\t\telse\n\t\t\t\taccum += 0.5*dy*(x1+x0) - x0*dy + y0*dx;\n\n\t\t\ttime += dx;\n\t\t}\n\n\t\treturn sign*accum;\n\t},\n\n\t/**\n\t * \tReturns the approximate definite second integral of the t-function for the given time range.\n\t * \t@param t0 - Initial time value, defaults to minimum time of the t-function.\n\t * \t@param t1 - Final time value, defaults to the maximum time of the t-function.\n\t * \t@param c0 - Constant of integration, defaults to 0.\n\t * \t@returns Definite second integral of t-function from t0 to t1.\n\t * \t!integral (t0?: number, t1?: number, c0?: number) : number;\n\t */\n\tsecond_integral: function (t0=null, t1=null, c0=0)\n\t{\n\t\tif (t0 == null) t0 = this.t[0];\n\t\tif (t1 == null) t1 = this.t[this.t.length-1];\n\n\t\tlet a0 = TFunction.Temp1.copyFrom(this, this.t[0], t0).integrate(c0).integral();\n\t\tlet a1 = TFunction.Temp2.copyFrom(this, this.t[0], t1).integrate(c0).integral();\n\n\t\treturn a1 - a0;\n\t},\n\n\t/**\n\t * \tTransforms the t-function to its integral. For every sampling range in the t-function their Y-value will be set to the integral\n\t * \tof the sampling range plus any previous integrals.\n\t *\n\t * \t@param c0 - Constant of integration. Defaults to 0.\n\t * \t!integrate (c0?: number) : TFunction;\n\t */\n\tintegrate: function (c0=0)\n\t{\n\t\tlet y = [];\n\n\t\ty.push(c0);\n\n\t\tfor (let i = 1; i < this.t.length; i++)\n\t\t\ty.push(y[i-1] + this.integral(this.t[i-1], this.t[i]));\n\n\t\tthis.y = y;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tTransforms the t-function Y-values to the accumulated sum of each Y-value plus the given c0.\n\t * \t@param c0 - Initial value (defaults to 0).\n\t * \t!accumulate(c0?: number) : TFunction;\n\t */\n\taccumulate: function (c0=0)\n\t{\n\t\tthis.y[0] += c0;\n\n\t\tfor (let i = 1; i < this.t.length; i++)\n\t\t\tthis.y[i] += this.y[i-1];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tRemoves all sampling-points located before the given index.\n\t *\t!chopLeft (i: number) : TFunction;\n\t */\n\tchopLeft: function (i)\n\t{\n\t\tthis.t.splice(0, i);\n\t\tthis.f.splice(0, i);\n\t\tthis.y.splice(0, i);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tRemoves all sampling-points located after the given index.\n\t * \t!chopRight (i: number) : TFunction;\n\t */\n\tchopRight: function (i)\n\t{\n\t\tthis.t.splice(i+1, this.t.length-i-1);\n\t\tthis.f.splice(i+1, this.f.length-i-1);\n\t\tthis.y.splice(i+1, this.y.length-i-1);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMaps the Y-value to other Y-values using the specified mapping function.\n\t * \t@param fn - Receives parameters `y` (y-value), `t` (t-value), and `i` (index).\n\t * \t!map (fn: (y: number, t: number, i: number) => number) : TFunction;\n\t */\n\tmap: function (fn)\n\t{\n\t\tfor (let i = 0; i < this.y.length; i++)\n\t\t\tthis.y[i] = fn (this.y[i], this.t[i], i);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns a string representation of the variable state.\n\t * \t!toString (c0?: number) : string;\n\t */\n\ttoString: function(c0=0)\n\t{\n\t\tlet s = '';\n\t\tlet n = 10;\n\n\t\tconst pad = function (value, n, char)\n\t\t{\n\t\t\tvalue = value.toString();\n\n\t\t\tif (char == null) char = ' ';\n\t\t\tchar = char[0];\n\n\t\t\twhile (value.length < n)\n\t\t\t\tvalue += char;\n\n\t\t\treturn value;\n\t\t};\n\n\t\ts += '\\n';\n\t\ts += pad(' Time', n) + ' ' + pad(' Value', n) + ' ' + pad(' Integral', n) + '\\n';\n\t\ts += pad('', n, '-') + ' ' + pad('', n, '-') + ' ' + pad('', n, '-') + '\\n';\n\n\t\tfor (let i = 0; i < this.t.length; i++)\n\t\t{\n\t\t\ts += pad(' '+float4(this.t[i]), n) + ' ' + pad(' '+float4(this.y[i]), n) + ' ' + pad(' '+float4(this.integral(this.t[0], this.t[i], c0)), n) + '\\n';\n\t\t}\n\n\t\treturn s;\n\t}\n});\n\nTFunction.Temp1 = new TFunction();\nTFunction.Temp2 = new TFunction();\n\nexport default TFunction;\n","\nimport { Class } from 'rinn';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"../utils/recycler\"]\n//![import \"./vec2\"]\n\n//:/**\n//: * \tRepresentation of a point in 2D space. The coordinate values are upscaled by a fixed number of bits to allow\n//: * \tsub-pixel translations (internally), but the public values will always be integers.\n//: */\n\n//!class Point2\n\nconst Point2 = Class.extend\n({\n\tclassName: 'Point2',\n\n\t/**\n\t * \tUpscaled coordinates of the point.\n\t * \t!readonly ux: number;\n\t * \t!readonly uy: number;\n\t */\n\tux: 0, uy: 0,\n\n\t/**\n\t * \tCoordinates of the point.\n\t * \t!readonly x: number;\n\t * \t!readonly y: number;\n\t */\n\tx: 0, y: 0,\n\n\t/**\n\t *\tConstructs the Point2 instance from another Point2.\n\t * \t!constructor (value: Point2);\n\t */\n\t/**\n\t *\tConstructs the Point2 instance from a Vec2.\n\t * \t!constructor (value: Vec2);\n\t */\n\t/**\n\t *\tConstructs the Point2 instance with the specified coordinates.\n\t * \t!constructor (x?: number, y?: number);\n\t */\n\t__ctor: function (x=null, y=null)\n\t{\n\t\treturn this.set(x, y);\n\t},\n\n\t/**\n\t *\tPopulates the downscaled coordinates.\n\t */\n\tdownscale: function ()\n\t{\n\t\tthis.x = downscale(this.ux);\n\t\tthis.y = downscale(this.uy);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tClones the point coordinates into a new Point2 object.\n\t * \t!clone() : Point2;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Point2.Pool.alloc(this);\n\t},\n\n\t/**\n\t *\tSets the coordinates of the point from another Point2.\n\t *\t!set (value: Point2) : Point2;\n\t */\n\t/**\n\t *\tSets the coordinates of the point from a Vec2 object.\n\t *\t!set (value: Vec2) : Point2;\n\t */\n\t/**\n\t *\tSets the coordinates of the point.\n\t *\t@param upscaled - When `true` the specified values are assumed to have already been upscaled.\n\t *\n\t *\t!set (x: number, y: number, upscaled?: boolean) : Point2;\n\t */\n\tset: function (x, y=null, upscaled=false)\n\t{\n\t\tif (x === null) {\n\t\t\tx = 0;\n\t\t\ty = 0;\n\t\t}\n\t\telse if (y === null)\n\t\t{\n\t\t\tif (Point2.isInstance(x)) {\n\t\t\t\ty = x.uy;\n\t\t\t\tx = x.ux;\n\t\t\t} else { // Point2\n\t\t\t\ty = upscale(x.y);\n\t\t\t\tx = upscale(x.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (upscaled !== true) {\n\t\t\t\tx = upscale(x);\n\t\t\t\ty = upscale(y);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux = x;\n\t\tthis.uy = y;\n\n\t\treturn this.downscale(this);\n\t},\n\n\t/**\n\t * \tSets the X-coordinate of the point.\n\t * \t!setX (x: number) : Point2;\n\t */\n\tsetX: function (x)\n\t{\n\t\tthis.ux = upscale(x);\n\t\treturn this.downscale(this);\n\t},\n\n\t/**\n\t * \tSets the Y-coordinate of the point.\n\t * \t!setY (y: number) : Point2;\n\t */\n\tsetY: function (y)\n\t{\n\t\tthis.uy = upscale(y);\n\t\treturn this.downscale(this);\n\t},\n\n\t/**\n\t * \tSets the coordinates of the point to zero.\n\t * \t!zero() : Point2;\n\t */\n\tzero: function()\n\t{\n\t\treturn this.set(0, 0);\n\t},\n\n\t/**\n\t * \tReturns true if the point coordinates are both zero.\n\t * \t!isZero() : boolean;\n\t */\n\tisZero: function()\n\t{\n\t\treturn this.x == 0 && this.y == 0;\n\t},\n\n\t/**\n\t *\tReturns true if the coordinates of the point have the same values as the given Point2.\n\t *\t!equals (value: Point2) : boolean;\n\t */\n\t/**\n\t *\tReturns true if the coordinates of the point have the same values as the given Vec2.\n\t *\t!equals (value: Vec2) : boolean;\n\t */\n\t/**\n\t *\tReturns true if the coordinates of the point have the same values as the given ones.\n\t *\t!equals (x: number, y: number) : boolean;\n\t */\n\tequals: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tif (Point2.isInstance(x)) {\n\t\t\t\ty = x.y;\n\t\t\t\tx = x.x;\n\t\t\t} else { // Point2\n\t\t\t\ty = int(x.y);\n\t\t\t\tx = int(x.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tx = int(x);\n\t\t\ty = int(y);\n\t\t}\n\n\t\treturn this.x == x && this.y == y;\n\t},\n\n\t/**\n\t *\tAdds the coordinates of the given Point2 to the point.\n\t *\t!add (value: Point2) : Point2;\n\t */\n\t/**\n\t *\tAdds the coordinates of the given Vec2 to the point.\n\t *\t!add (value: Vec2) : Point2;\n\t */\n\t/**\n\t *\tAdds the given delta values to the point.\n\t *\t@param upscaled - When `true` the specified values are assumed to have already been upscaled.\n\t *\t!add (dx: number, dy: number, upscaled?: boolean) : Point2;\n\t */\n\tadd: function (dx, dy=null, upscaled=false)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tif (Point2.isInstance(dx)) {\n\t\t\t\tdy = dx.uy;\n\t\t\t\tdx = dx.ux;\n\t\t\t} else { // Point2\n\t\t\t\tdy = upscale(dx.y);\n\t\t\t\tdx = upscale(dx.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (upscaled !== true) {\n\t\t\t\tdx = upscale(dx);\n\t\t\t\tdy = upscale(dy);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux += dx, this.uy += dy;\n\t\treturn this.downscale();\n\t},\n\n\t/**\n\t *\tSubtracts the coordinates of the given Point2 from the point.\n\t *\t!sub (value: Point2) : Point2;\n\t */\n\t/**\n\t *\tSubtracts the coordinates of the given Vec2 from the point.\n\t *\t!sub (value: Vec2) : Point2;\n\t */\n\t/**\n\t *\tSubtracts the given delta values from the point.\n\t *\t@param upscaled - When `true` the specified values are assumed to have already been upscaled.\n\t *\t!sub (dx: number, dy: number, upscaled?: boolean) : Point2;\n\t */\n\tsub: function (dx, dy, upscaled=false)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tif (Point2.isInstance(dx)) {\n\t\t\t\tdy = dx.uy;\n\t\t\t\tdx = dx.ux;\n\t\t\t} else { // Point2\n\t\t\t\tdy = upscale(dx.y);\n\t\t\t\tdx = upscale(dx.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (upscaled !== true) {\n\t\t\t\tdx = upscale(dx);\n\t\t\t\tdy = upscale(dy);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux -= dx, this.uy -= dy;\n\t\treturn this.downscale();\n\t},\n\n\t/**\n\t * \tReturns the string representation of the coordinates of the point.\n\t * \ttoString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn `(${this.x}, ${this.y})`;\n\t}\n});\n\n//!/class\n\n//!namespace Point2\n//!namespace Pool\n\n/**\n *\tAllocates a Point2 instance from another Point2.\n * \t!function alloc (value: Point2) : Point2;\n */\n/**\n *\tAllocates a Point2 instance from a Vec2.\n * \t!function alloc (value: Vec2) : Point2;\n */\n/**\n *\tAllocates a Point2 instance with the specified coordinates.\n * \t!function alloc (x?: number, y?: number) : Point2;\n */\n\nRecycler.createPool (Point2, 2048, 1024);\nexport default Point2;\n","\nimport { Class } from 'rinn';\nimport Recycler from '../utils/recycler.js';\nimport Point2 from './point2.js';\nimport Rect from './rect.js';\n\n//![import \"../utils/recycler\"]\n//![import \"./point2\"]\n//![import \"./rect\"]\n\n//:/**\n//: * \tRepresentation of a bounding box in 2D space. The component values are upscaled by a fixed number of bits to allow sub-pixel\n//: * \ttranslations (internally), but the public values will always be integers.\n//: */\n\n//!class Bounds2\n\nconst Bounds2 = Class.extend\n({\n\tclassName: 'Bounds2',\n\n\t/**\n\t * \tCoordinates of the bounds (cx and cy are for the center). Note that this fields are read only and should be\n\t * \tmodified through methods only.\n\t */\n\n\t/**\n\t * \t!readonly cx: number;\n\t */\n\tcx: 0,\n\t/**\n\t * \t!readonly cy: number;\n\t */\n\tcy: 0,\n\t/**\n\t * \t!readonly x1: number;\n\t */\n\tx1: 0,\n\t/**\n\t * \t!readonly y1: number;\n\t */\n\ty1: 0,\n\t/**\n\t * \t!readonly x2: number;\n\t */\n\tx2: 0,\n\t/**\n\t * \t!readonly y2: number;\n\t */\n\ty2: 0,\n\n\t/**\n\t * \tUpscaled coordinates.\n\t */\n\tucx: 0, ucy: 0,\n\tux1: 0, uy1: 0,\n\tux2: 0, uy2: 0,\n\n\t/**\n\t * !constructor ();\n\t */\n\t/**\n\t * !constructor (bounds: Bounds2);\n\t */\n\t/**\n\t * !constructor (rect: Rect);\n\t */\n\t/**\n\t * !constructor (width: number, height: number);\n\t */\n\t/**\n\t * !constructor (x1: number, y1: number, x2: number, y2: number, upscaled?: boolean|false);\n\t */\n\t__ctor: function (x1=null, y1=null, x2=null, y2=null, upscaled=false)\n\t{\n\t\tif (x1 === null)\n\t\t{\n\t\t\tthis.ux1 = this.uy1 = this.ux2 = this.uy2 = this.ucx = this.ucy = 0;\n\t\t\treturn this.downscale();\n\t\t}\n\n\t\tif (y1 !== null && x2 === null)\n\t\t\treturn this.set(0, 0, 0, 0).resize(x1, y1);\n\n\t\treturn this.set(x1, y1, x2, y2, upscaled);\n\t},\n\n\t/**\n\t * Populates the downscaled components.\n\t */\n\tdownscale: function ()\n\t{\n\t\tthis.x1 = downscale(this.ux1);\n\t\tthis.y1 = downscale(this.uy1);\n\t\tthis.x2 = downscale(this.ux2);\n\t\tthis.y2 = downscale(this.uy2);\n\t\tthis.cx = downscale(this.ucx);\n\t\tthis.cy = downscale(this.ucy);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Truncates the components to remove fractional parts.\n\t * !trunc() : Bounds2;\n\t */\n\ttrunc: function ()\n\t{\n\t\tthis.ux1 = upscale(this.x1);\n\t\tthis.uy1 = upscale(this.y1);\n\t\tthis.ux2 = upscale(this.x2);\n\t\tthis.uy2 = upscale(this.y2);\n\t\tthis.ucx = upscale(this.cx);\n\t\tthis.ucy = upscale(this.cy);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Clones the bounds and returns a new object.\n\t * !clone() : Bounds2;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Bounds2.Pool.alloc(this.ux1, this.uy1, this.ux2, this.uy2, true);\n\t},\n\n\t/**\n\t * Sets the components to zero.\n\t * !zero() : Bounds2;\n\t */\n\tzero: function ()\n\t{\n\t\tthis.ux1 = 0; this.uy1 = 0;\n\t\tthis.ux2 = 0; this.uy2 = 0;\n\t\tthis.ucx = 0; this.ucy = 0;\n\n\t\treturn this.downscale();\n\t},\n\n\t/**\n\t * Resets the component values to `null` for subsequent use with `setAsUnion`.\n\t * !reset() : Bounds2;\n\t */\n\treset: function ()\n\t{\n\t\tthis.ux1 = null; this.uy1 = null;\n\t\tthis.ux2 = null; this.uy2 = null;\n\t\tthis.ucx = null; this.ucy = null;\n\n\t\tthis.x1 = null; this.y1 = null;\n\t\tthis.x2 = null; this.y2 = null;\n\t\tthis.cx = null; this.cy = null;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Translates the bounds by the given deltas.\n\t * !translate (point: Point2) : Bounds2;\n\t */\n\t/**\n\t * Translates the bounds by the given deltas.\n\t * !translate (vec: Vec2) : Bounds2;\n\t */\n\t/**\n\t * Translates the bounds by the given deltas.\n\t * !translate (dx: number, dy: number, upscaled?: boolean) : Bounds2;\n\t */\n\ttranslate: function (dx, dy=null, upscaled=false)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tif (Point2.isInstance(dx)) {\n\t\t\t\tdy = dx.uy;\n\t\t\t\tdx = dx.ux;\n\t\t\t} else { // Vec2\n\t\t\t\tdy = upscale(dx.y);\n\t\t\t\tdx = upscale(dx.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (upscaled !== true) {\n\t\t\t\tdx = upscale(dx);\n\t\t\t\tdy = upscale(dy);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux1 += dx; this.uy1 += dy;\n\t\tthis.ux2 += dx; this.uy2 += dy;\n\t\tthis.ucx += dx; this.ucy += dy;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tSets the coordinates of the bounds.\n\t**\n\t**\tBounds2 set (Bounds2 b)\n\t**\tBounds2 set (Rect r)\n\t**\tBounds2 set (float x1, float y1, float x2, float y2, bool upscaled=false)\n\t*/\n\tset: function (x1, y1=null, x2=null, y2=null, upscaled=false)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.uy2;\n\t\t\t\tx2 = x1.ux2;\n\t\t\t\ty1 = x1.uy1;\n\t\t\t\tx1 = x1.ux1;\n\t\t\t} else {\n\t\t\t\ty2 = upscale(x1.y2);\n\t\t\t\tx2 = upscale(x1.x2);\n\t\t\t\ty1 = upscale(x1.y1);\n\t\t\t\tx1 = upscale(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (upscaled !== true) {\n\t\t\t\tx1 = upscale(x1);\n\t\t\t\ty1 = upscale(y1);\n\t\t\t\tx2 = upscale(x2);\n\t\t\t\ty2 = upscale(y2);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux1 = x1;\n\t\tthis.uy1 = y1;\n\t\tthis.ux2 = x2;\n\t\tthis.uy2 = y2;\n\n\t\tthis.ucx = (x1 + x2) >> 1;\n\t\tthis.ucy = (y1 + y2) >> 1;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tAdds the specified coordinates to the current ones.\n\t**\n\t**\tBounds2 add (Bounds2 b)\n\t**\tBounds2 add (Rect r)\n\t**\tBounds2 add (float x1, float y1, float x2, float y2, bool upscaled=false)\n\t*/\n\tadd: function (x1, y1=null, x2=null, y2=null, upscaled=false)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.uy2;\n\t\t\t\tx2 = x1.ux2;\n\t\t\t\ty1 = x1.uy1;\n\t\t\t\tx1 = x1.ux1;\n\t\t\t} else {\n\t\t\t\ty2 = upscale(x1.y2);\n\t\t\t\tx2 = upscale(x1.x2);\n\t\t\t\ty1 = upscale(x1.y1);\n\t\t\t\tx1 = upscale(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (upscaled !== true) {\n\t\t\t\tx1 = upscale(x1);\n\t\t\t\ty1 = upscale(y1);\n\t\t\t\tx2 = upscale(x2);\n\t\t\t\ty2 = upscale(y2);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux1 += x1;\n\t\tthis.uy1 += y1;\n\t\tthis.ux2 += x2;\n\t\tthis.uy2 += y2;\n\n\t\tthis.ucx += (x1 + x2) >> 1;\n\t\tthis.ucy += (y1 + y2) >> 1;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tReturns true if the integer coordinates have the same values as the given argument.\n\t**\n\t**\tbool equals (Bounds2 b)\n\t**\tbool equals (Rect r)\n\t**\tbool equals (float x1, float y1, float x2, float y2)\n\t*/\n\tequals: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.y2;\n\t\t\t\tx2 = x1.x2;\n\t\t\t\ty1 = x1.y1;\n\t\t\t\tx1 = x1.x1;\n\t\t\t} else {\n\t\t\t\ty2 = int(x1.y2);\n\t\t\t\tx2 = int(x1.x2);\n\t\t\t\ty1 = int(x1.y1);\n\t\t\t\tx1 = int(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx1 = int(x1);\n\t\t\ty1 = int(y1);\n\t\t\tx2 = int(x2);\n\t\t\ty2 = int(y2);\n\t\t}\n\n\t\treturn x1 == this.x1 && x2 == this.x2 && y1 == this.y1 && y2 == this.y2;\n\t},\n\n\t/*\n\t**\tReturns a bool indicating if the specified bounds are contained by the current bounds.\n\t**\n\t**\tbool contains (Bounds2 b)\n\t**\tbool contains (Rect r)\n\t**\tbool contains (float x1, float y1, float x2, float y2)\n\t*/\n\tcontains: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.y2;\n\t\t\t\tx2 = x1.x2;\n\t\t\t\ty1 = x1.y1;\n\t\t\t\tx1 = x1.x1;\n\t\t\t} else {\n\t\t\t\ty2 = int(x1.y2);\n\t\t\t\tx2 = int(x1.x2);\n\t\t\t\ty1 = int(x1.y1);\n\t\t\t\tx1 = int(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx1 = int(x1);\n\t\t\ty1 = int(y1);\n\t\t\tx2 = int(x2);\n\t\t\ty2 = int(y2);\n\t\t}\n\n\t\treturn (x1 == Math.max(this.x1, x1)) && (y1 == Math.max(this.y1, y1)) && (x2 == Math.min(this.x2, x2)) && (y2 == Math.min(this.y2, y2));\n\t},\n\n\t/*\n\t**\tExtends the coordinates to ensure the specified argument is contained.\n\t**\n\t**\tBounds2 setAsUnion (Bounds2 b)\n\t**\tBounds2 setAsUnion (Rect r)\n\t**\tBounds2 setAsUnion (Point2 p)\n\t**\tBounds2 setAsUnion (Vec2 v)\n\t**\tBounds2 setAsUnion (float x, float y)\n\t**\tBounds2 setAsUnion (float x1, float y1, float x2, float y2)\n\t*/\n\tsetAsUnion: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1))\n\t\t\t{\n\t\t\t\tthis.setAsUnion(x1.ux1, x1.uy1, true);\n\t\t\t\tthis.setAsUnion(x1.ux2, x1.uy2, true);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t\telse if (Rect.isInstance(x1))\n\t\t\t{\n\t\t\t\tthis.setAsUnion(x1.x1, x1.y1);\n\t\t\t\tthis.setAsUnion(x1.x2, x1.y2);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t\telse if (Point2.isInstance(x1))\n\t\t\t{\n\t\t\t\ty1 = x1.uy;\n\t\t\t\tx1 = x1.ux;\n\t\t\t}\n\t\t\telse // Vec2\n\t\t\t{\n\t\t\t\ty1 = upscale(x1.y);\n\t\t\t\tx1 = upscale(x1.x);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (y2 !== null)\n\t\t\t{\n\t\t\t\tthis.setAsUnion(x1, y1);\n\t\t\t\tthis.setAsUnion(x2, y2);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (x2 !== true)\n\t\t\t\t{\n\t\t\t\t\tx1 = upscale(x1);\n\t\t\t\t\ty1 = upscale(y1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.ux1 === null || x1 < this.ux1) this.ux1 = x1;\n\t\tif (this.uy1 === null || y1 < this.uy1) this.uy1 = y1;\n\t\tif (this.ux2 === null || x1 > this.ux2) this.ux2 = x1;\n\t\tif (this.uy2 === null || y1 > this.uy2) this.uy2 = y1;\n\n\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tReturns a bool indicating if the integer components of the bounds intersect with the specified argument.\n\t**\n\t**\tbool intersects (Bounds2 b)\n\t**\tbool intersects (Rect r)\n\t**\tbool intersects (float x1, float y1, float x2, float y2)\n\t*/\n\tintersects: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.y2;\n\t\t\t\tx2 = x1.x2;\n\t\t\t\ty1 = x1.y1;\n\t\t\t\tx1 = x1.x1;\n\t\t\t} else {\n\t\t\t\ty2 = int(x1.y2);\n\t\t\t\tx2 = int(x1.x2);\n\t\t\t\ty1 = int(x1.y1);\n\t\t\t\tx1 = int(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx1 = int(x1);\n\t\t\ty1 = int(y1);\n\t\t\tx2 = int(x2);\n\t\t\ty2 = int(y2);\n\t\t}\n\n\t\tlet _x1 = Math.max(this.x1, x1);\n\t\tlet _y1 = Math.max(this.y1, y1);\n\t\tlet _x2 = Math.min(this.x2, x2);\n\t\tlet _y2 = Math.min(this.y2, y2);\n\n\t\treturn Math.max(0, _y2-_y1) * Math.max(0, _x2-_x1) > 0;\n\t},\n\n\t/*\n\t**\tSets the bounds to the intersection formed by the current bounds and the given argument.\n\t**\n\t**\tBounds2 setAsIntersection (Bounds2 b)\n\t**\tBounds2 setAsIntersection (Rect r)\n\t**\tBounds2 setAsIntersection (float x1, float y1, float x2, float y2)\n\t*/\n\tsetAsIntersection: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.y2;\n\t\t\t\tx2 = x1.x2;\n\t\t\t\ty1 = x1.y1;\n\t\t\t\tx1 = x1.x1;\n\t\t\t} else {\n\t\t\t\ty2 = int(x1.y2);\n\t\t\t\tx2 = int(x1.x2);\n\t\t\t\ty1 = int(x1.y1);\n\t\t\t\tx1 = int(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx1 = int(x1);\n\t\t\ty1 = int(y1);\n\t\t\tx2 = int(x2);\n\t\t\ty2 = int(y2);\n\t\t}\n\n\t\tthis.ux1 = upscale(Math.max(this.x1, x1));\n\t\tthis.uy1 = upscale(Math.max(this.y1, y1));\n\t\tthis.ux2 = upscale(Math.min(this.x2, x2));\n\t\tthis.uy2 = upscale(Math.min(this.y2, y2));\n\n\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\n\t\tthis.downscale();\n\n\t\treturn Math.max(0, this.uy2-this.uy1) * Math.max(0, this.ux2-this.ux1) > 0;\n\t},\n\n\t/**\n\t * Resizes the bounds to the given size using the center or top-left as reference.\n\t * @param {number} width Use a value, or `true` to preserve aspect ratio, or `null` to keep it unchanged.\n\t * @param {number} height Use a value, or `true` to preserve aspect ratio, or `null` to keep it unchanged.\n\t * @param {boolean} topLeftRelative (default `false`)\n\t * !resize (width: number|boolean|null, height: number|boolean|null, topLeftRelative?: boolean) : Bounds2;\n\t */\n\tresize: function (width, height, topLeftRelative=false)\n\t{\n\t\twidth = width !== null ? (width !== true ? upscale(width) : true) : this.ux2 - this.ux1;\n\t\theight = height !== null ? (height !== true ? upscale(height) : true)  : this.uy2 - this.uy1;\n\n\t\tif (width === true)\n\t\t\twidth = height*this.ratio();\n\t\telse if (height === true)\n\t\t\theight = width/this.ratio();\n\n\t\tif (topLeftRelative === true)\n\t\t{\n\t\t\tthis.ux2 = this.ux1 + width;\n\t\t\tthis.uy2 = this.uy1 + height;\n\n\t\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\t\t}\n\t\telse\n\t\t{\n\t\t\twidth >>= 1; height >>= 1;\n\n\t\t\tthis.ux1 = this.ucx - width; this.uy1 = this.ucy - height;\n\t\t\tthis.ux2 = this.ucx + width; this.uy2 = this.ucy + height;\n\t\t}\n\n\t\treturn this.downscale();\n\t},\n\n\t/**\n\t * Resizes the bounds using the specified deltas (using the center or top-left corner as reference).\n\t * !resizeBy (dWidth: number|boolean, dHeight: number|boolean, topLeftRelative?: boolean) : Bounds2;\n\t */\n\tresizeBy: function (dWidth, dHeight, topLeftRelative=false)\n\t{\n\t\tdWidth = dWidth !== true ? upscale(dWidth) : true;\n\t\tdHeight = dHeight !== true ? upscale(dHeight) : true;\n\n\t\tif (dWidth === true)\n\t\t\tdWidth = dHeight*this.ratio();\n\t\telse if (dHeight === true)\n\t\t\tdHeight = dWidth/this.ratio();\n\n\t\tif (topLeftRelative === true)\n\t\t{\n\t\t\tthis.ux2 += dWidth;\n\t\t\tthis.uy2 += dHeight;\n\n\t\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdWidth >>= 1; dHeight >>= 1;\n\n\t\t\tthis.ux1 -= dWidth; this.uy1 -= dHeight;\n\t\t\tthis.ux2 += dWidth; this.uy2 += dHeight;\n\t\t}\n\n\t\treturn this.downscale();\n\t},\n\n\t/**\n\t * Returns the width of the bounds.\n\t * !width(): number\n\t */\n\twidth: function ()\n\t{\n\t\treturn this.x2 - this.x1;\n\t},\n\n\t/**\n\t * Returns the height of the bounds.\n\t * !height(): number\n\t */\n\theight: function ()\n\t{\n\t\treturn this.y2 - this.y1;\n\t},\n\n\t/**\n\t * Returns the aspect ratio (width divided by height).\n\t * !ratio(): number\n\t */\n\tratio: function ()\n\t{\n\t\treturn (this.x2 - this.x1) / (this.y2 - this.y1);\n\t},\n\n\t/**\n\t * Returns true if the bounds are in forward position (x1 < x2 and y1 < y2).\n\t * !isForward() : boolean;\n\t */\n\tisForward: function ()\n\t{\n\t\treturn this.ux1 <= this.ux2 && this.uy1 <= this.uy2;\n\t},\n\n\t/**\n\t * Returns true if the specified point is within the bounds. The `tol` parameter is used to specify a tolerance value.\n\t * !containsPoint (x: number, y: number, tol?: number) : boolean;\n\t */\n\tcontainsPoint: function (x, y, tol=0)\n\t{\n\t\tx = upscale(x);\n\t\ty = upscale(y);\n\t\ttol = upscale(tol);\n\n\t\treturn (this.ux1-tol <= x && x <= this.ux2+tol) && (this.uy1-tol <= y && y <= this.uy2+tol);\n\t},\n\n\t/**\n\t * Returns the area of the bounds. When strict is true, the area will be returned only if the bounds are forward.\n\t * !area (strict?: boolean|false) : number;\n\t */\n\tarea: function (strict=false)\n\t{\n\t\treturn strict ? (this.isForward() ? (this.y2-this.y1)*(this.x2-this.x1) : 0) : ((this.y2-this.y1)*(this.x2-this.x1));\n\t},\n\n\t/**\n\t * Returns the string representation of the rect coordinates.\n\t * !toString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn '(' + this.x1 + ', ' + this.y1 + ', ' + this.x2 + ', ' + this.y2 + ')';\n\t},\n\n\t/**\n\t * Flattens the contents of the bounds.\n\t * !flatten() : \\[number,number,number,number\\];\n\t */\n\tflatten: function ()\n\t{\n\t\treturn [this.ux1, this.uy1, this.ux2, this.uy2];\n\t},\n\n\t/**\n\t * Unflattens the given array into the bounds object.\n\t * !unflatten (data: \\[number,number,number,number\\]) : Bounds2;\n\t */\n\tunflatten: function (x)\n\t{\n\t\tthis.ux1 = x[0];\n\t\tthis.uy1 = x[1];\n\t\tthis.ux2 = x[2];\n\t\tthis.uy2 = x[3];\n\n\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\n\t\treturn this.downscale();\n\t}\n});\n\n//!/class\n\n//!namespace Rect\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a new object of zero size.\n\t * \t!function alloc() : Bounds2;\n\t */\n\nRecycler.createPool (Bounds2, 8192, 3072);\nexport default Bounds2;\n","\n/**\n**\tCollection of useful easing functions.\n*/\n\n//!namespace Easing\n\nconst Easing =\n{\n\t/* ******************************************** */\n\t//!namespace Linear\n\tLinear:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Back\n\tBack:\n\t{\n\t\tk: 1.70158,\n\n\t\t/**\n\t\t * \t!function IN (t: number, k?: number) : number;\n\t\t */\n\t\tIN: function (t, k=null)\n\t\t{\n\t\t\tif (k === null) k = Easing.Back.k;\n\t\t\treturn t*t*((k+1)*t - k);\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number, k?: number) : number;\n\t\t */\n\t\tOUT: function (t, k=null)\n\t\t{\n\t\t\treturn 1 - Easing.Back.IN(1 - t, k);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number, k?: number) : number;\n\t\t */\n\t\tIN_OUT: function (t, k=null)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Back.IN(t*2, k)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Back.OUT((t-0.5)*2, k)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Bounce\n\tBounce:\n\t{\n\t\tgetConst: function (t)\n\t\t{\n\t\t\tif (t < 1.0/2.75)\n\t\t\t\treturn 7.5625 * t * t;\n\t\t\telse if (t < 2.0/2.75)\n\t\t\t\treturn 7.5625 * (t -= 1.5/2.75)*t + 0.75;\n\t\t\telse if (t < 2.5/2.75)\n\t\t\t\treturn 7.5625 * (t -= 2.250/2.75) * t + 0.9375;\n\n\t\t\treturn 7.5625 * (t -= 2.625/2.75) * t + 0.984375;\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Bounce.getConst(1-t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn Easing.Bounce.getConst(t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn (1 - Easing.Bounce.getConst(1-2*t))/2;\n\t\t\telse\n\t\t\t\treturn (Easing.Bounce.getConst((t-0.5)*2)/2)+0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Circ\n\tCirc:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Math.sqrt(1 - t*t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Circ.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\t\treturn Easing.Circ.IN(t*2)/2;\n\t\t\t\telse\n\t\t\t\t\treturn Easing.Circ.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Cubic\n\tCubic:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Cubic.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Cubic.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Cubic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Expo\n\tExpo:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn Math.pow(2, 12*(t-1));\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn -Math.pow(2, -12*t) + 1;\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif ((t *= 2) < 1)\n\t\t\t\treturn Math.pow (2, 12 * (t - 1)) / 2;\n\t\t\telse\n\t\t\t\treturn (-Math.pow (2, -12 * (t - 1)) + 2) / 2;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Power\n\tPower:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number, p?: number) : number;\n\t\t */\n\t\tIN: function (t, p=12)\n\t\t{\n\t\t\treturn Math.pow(t, p);\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number, p?: number) : number;\n\t\t */\n\t\tOUT: function (t, p=12)\n\t\t{\n\t\t\treturn 1 - Easing.Power.IN(1 - t, p);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number, p?: number) : number;\n\t\t */\n\t\tIN_OUT: function (t, p=12)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Power.IN(t*2, p)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Power.OUT((t-0.5)*2, p)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Quad\n\tQuad:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quad.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Quad.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Quad.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Quartic\n\tQuartic:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t*t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quartic.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Quartic.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Quartic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Quintic\n\tQuintic:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t*t*t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quintic.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\t\treturn Easing.Quintic.IN(t*2)/2;\n\t\t\t\telse\n\t\t\t\t\treturn Easing.Quintic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Sine\n\tSine:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Math.sin (1.5708 * (1 - t));\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn Math.sin (1.5708 * t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn (Math.cos (3.1416*t) - 1) / -2;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Step\n\tStep:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t}\n\t}\n};\n\nexport default Easing;\n","\nimport { Class } from 'rinn';\nimport PriorityQueue from '../utils/priority-queue.js';\n\n//![import \"../utils/priority-queue\"]\n\n//!class Boot\n\nconst Boot =\n{\n\tmodules: new PriorityQueue(),\n\n\t/**\n\t * \tRegisters a new boot module.\n\t * \t!static register (module: Boot.Module) : Boot.Module;\n\t */\n\tregister: function (module)\n\t{\n\t\treturn this.modules.add(module);\n\t},\n\n\t/**\n\t * \tRemoves a boot module.\n\t * \t!static unregister (module: Boot.Module) : void;\n\t */\n\tunregister: function (module)\n\t{\n\t\tthis.modules.remove(module);\n\t\tthis.modules.cleanup();\n\t},\n\n\t/**\n\t * \tExecutes the startup sequence.\n\t * \t!static startup (finishedCallback?: () => void) : void;\n\t */\n\tstartup: function (finishedCallback=null)\n\t{\n\t\tthis.modules.forEachAsync((m,r) => { if (m.onStartup(r) !== false) r(); }, finishedCallback);\n\t},\n\n\t/**\n\t * \tExecutes the shutdown sequence.\n\t * \t!static shutdown (finishedCallback?: () => void) : void;\n\t */\n\tshutdown: function (finishedCallback=null)\n\t{\n\t\tthis.modules.forEachAsyncRev( (m,r) => { if (m.onShutdown(r) !== false) r(); }, finishedCallback);\n\t}\n};\n\n//!/class\n\n//!namespace Boot\n//!interface Module\n\nBoot.Module = Class.extend\n({\n\tclassName: \"Module\",\n\n\t/**\n\t * \tPriority of the module (from 0 to 100), lower number means higher priority.\n\t * \t!priority: number;\n\t */\n\tpriority: 5,\n\n\t__ctor: function()\n\t{\n\t\tBoot.register(this);\n\t},\n\n\t__dtor: function()\n\t{\n\t\tBoot.unregister(this);\n\t},\n\n\t/**\n\t * \tShould return `false` if the method is async. When async ensure to call `next` once the operation is complete.\n\t * \t!onStartup (next: () => void) : boolean;\n\t */\n\tonStartup: function (next)\n\t{\n\t},\n\n\t/**\n\t * \tShould return `false` if the method is async. When async ensure to call `next` once the operation is complete.\n\t * \t!onShutdown (next: () => void) : boolean;\n\t */\n\tonShutdown: function (next)\n\t{\n\t}\n});\n\n//!/interface\n//!/namespace\n\nexport default Boot;\n","\nimport System from '../system/system.js';\nimport Resources from '../resources/resources.js';\nimport Boot from '../flow/boot.js';\nimport Handler from '../utils/handler.js';\n\n//!class sys\n\nconst system =\n{\n\t/**\n\t * Indicates if the system module has already been initialized.\n\t */\n\tinitialized: false,\n\n\t/**\n\t * Screen width (available after calling `init`).\n\t * !static readonly screenWidth: number;\n\t */\n\tscreenWidth: 0,\n\n\t/**\n\t * Screen height (available after calling `init`).\n\t * !static readonly screenHeight: number;\n\t */\n\tscreenHeight: 0,\n\n\t/**\n\t * Primary renderer (available after calling `init`).\n\t * !static readonly renderer: Canvas;\n\t */\n\trenderer: null,\n\n\t/**\n\t * Logical system time (mirrors the value of System.frameTime).\n\t * !static readonly time: number;\n\t */\n\ttime: 0,\n\n\t/**\n\t * Logical system delta time (mirrors the value of System.frameDelta).\n\t * !static readonly dt: number;\n\t */\n\tdt: 0,\n\n\t/**\n\t * Timeout update handler.\n\t */\n\t_timeout: null,\n\n\t/**\n\t * Interval update handler.\n\t */\n\t_interval: null,\n\n\t/**\n\t * Time span update handler.\n\t */\n\t_span: null,\n\n\t/**\n\t * Update handler executed on every frame start.\n\t * !static readonly update: Handler;\n\t */\n\tupdate: null,\n\n\t/**\n\t * Draw handler executed on every frame start.\n\t * !static readonly draw: Handler;\n\t */\n\tdraw: null,\n\n\t/**\n\t * Executed when the system is paused.\n\t * !static onPaused: (fromExternalEvent: boolean) => void;\n\t */\n\tonPaused: null,\n\n\t/**\n\t * Executed when the system is resumed.\n\t * !static onResumed: (fromExternalEvent: boolean) => void;\n\t */\n\tonResumed: null,\n\n\t/**\n\t * System initialization options.\n\t */\n\toptions:\n\t{\n\t\t/**\n\t\t * \tTells the system to enable WebGL support.\n\t\t */\n\t\tgl: true,\n\n\t\t/**\n\t\t * \tIndicates if on-screen logging should be enabled.\n\t\t */\n\t\tlog: false,\n\n\t\t/**\n\t\t * \tEnables or disables antialised canvas. Set to `false` when pixel-perfect is desired.\n\t\t */\n\t\tantialias: false,\n\n\t\t/**\n\t\t * \tBackground of the system canvas.\n\t\t */\n\t\tbackground: '#000000',\n\n\t\t/**\n\t\t * \tDesired orientaton of the display.\n\t\t */\n\t\torientation: 'automatic',\n\n\t\t/**\n\t\t * \tDesired display width. When not specified (null) the maximum screen width to maintain the aspect ratio will be used.\n\t\t */\n\t\tscreenWidth: null,\n\n\t\t/**\n\t\t * \tDesired display height. When not specified (null) the maximum screen height to maintain the aspect ratio will be used.\n\t\t */\n\t\tscreenHeight: null,\n\n\t\t/**\n\t\t * \tTarget frames per second (FPS). Used to determine delay between frames.\n\t\t */\n\t\tfps: 144,\n\n\t\t/**\n\t\t * \tMinimum allowed frames per second (FPS). If system FPS drops below this value, the `frameDelta` property of System will be truncated to 1/minFps.\n\t\t */\n\t\tminFps: 24,\n\n\t\t/**\n\t\t * \tIndicates if recycler pool preallocation should be automatically executed. Additionally if this value is a number, it will be used as\n\t\t * \tmaximum preallocation parameter for the recycler.\n\t\t */\n\t\tpreallocate: false\n\t},\n\n\t/**\n\t * Initializes the system with the specified options.\n\t * !static init (options: System.Options) : Promise<void>;\n\t */\n\t/**\n\t * Initializes the system using the default options.\n\t * !static init () : Promise<void>;\n\t */\n\tinit: function (options)\n\t{\n\t\treturn new Promise ((resolve, reject) =>\n\t\t{\n\t\t\tif (this.initialized)\n\t\t\t\treturn resolve();\n\n\t\t\tObject.assign(this.options, options);\n\n\t\t\tResources.config ({ pixelated: !this.options.antialias, filter: this.options.antialias ? 'LINEAR' : 'NEAREST' });\n\t\t\tSystem.init (this.options);\n\n\t\t\tSystem.updateQueueAdd\n\t\t\t({\n\t\t\t\tupdate: function(dt)\n\t\t\t\t{\n\t\t\t\t\tsystem.time = System.frameTime;\n\t\t\t\t\tsystem.dt = dt;\n\n\t\t\t\t\tsystem._timeout.exec(dt);\n\t\t\t\t\tsystem._interval.exec(dt);\n\t\t\t\t\tsystem._span.exec(dt);\n\n\t\t\t\t\tsystem.update.exec(dt);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tSystem.drawQueueAdd\n\t\t\t({\n\t\t\t\tdraw: function(g)\n\t\t\t\t{\n\t\t\t\t\tsystem.draw.exec(g);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tBoot.startup(function()\n\t\t\t{\n\t\t\t\tSystem.start();\n\n\t\t\t\tsystem.screenWidth = System.screenWidth;\n\t\t\t\tsystem.screenHeight = System.screenHeight;\n\t\t\t\tsystem.renderer = System.renderer;\n\n\t\t\t\tsystem._timeout = Handler.Pool.alloc();\n\t\t\t\tsystem._interval = Handler.Pool.alloc();\n\t\t\t\tsystem._span = Handler.Pool.alloc();\n\n\t\t\t\tsystem.update = Handler.Pool.alloc();\n\t\t\t\tsystem.draw = Handler.Pool.alloc();\n\n\t\t\t\twindow.onblur = function() {\n\t\t\t\t\tsystem.pause(true);\n\t\t\t\t};\n\n\t\t\t\twindow.onfocus = function() {\n\t\t\t\t\tsystem.resume(true);\n\t\t\t\t};\n\n\t\t\t\tsystem.initialized = true;\n\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Pauses the system.\n\t * !static pause (fromExternalEvent?: boolean|false) : void;\n\t */\n\tpause: function (fromExternalEvent=false)\n\t{\n\t\tif (system.onPaused !== null)\n\t\t\tsystem.onPaused(fromExternalEvent);\n\t},\n\n\t/**\n\t * Resumes the system.\n\t * !static resume (fromExternalEvent?: boolean|false) : void;\n\t */\n\tresume: function (fromExternalEvent=false)\n\t{\n\t\tif (system.onResumed !== null)\n\t\t\tsystem.onResumed(fromExternalEvent);\n\t},\n\n\t/**\n\t * Creates a timeout callback.\n\t * !static timeout (duration: number, callback: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any) : Callback;\n\t */\n\ttimeout: function (duration, callback, arg0=null, arg1=null, arg2=null, arg3=null)\n\t{\n\t\treturn this._timeout.add(this._updateTimeout, duration, callback, arg0, arg1, arg2, arg3);\n\t},\n\n\t/**\n\t * Cancels a timeout callback.\n\t * !static cancelTimeout (callback: Callback) : void;\n\t */\n\tcancelTimeout: function (node)\n\t{\n\t\tthis._timeout.remove(node);\n\t},\n\n\t_updateTimeout: function (dt, _, callback, arg0, arg1, arg2, arg3)\n\t{\n\t\tthis.arg0 -= dt;\n\t\tif (this.arg0 > 0) return true;\n\n\t\tcallback (arg0, arg1, arg2, arg3);\n\t\treturn false;\n\t},\n\n\t/**\n\t * Creates an interval callback.\n\t * !static interval (period: number, callback: Function, arg0?: any, arg1?: any, arg2?: any) : Callback;\n\t */\n\tinterval: function (period, callback, arg0=null, arg1=null, arg2=null)\n\t{\n\t\treturn this._interval.add(this._updateInterval, 0, period, callback, arg0, arg1, arg2);\n\t},\n\n\t/**\n\t * Cancels an interval callback.\n\t * !static cancelInterval (callback: Callback) : void;\n\t */\n\tcancelInterval: function (node)\n\t{\n\t\tthis._interval.remove(node);\n\t},\n\n\t_updateInterval: function (dt, _0, _1, callback, arg0, arg1, arg2)\n\t{\n\t\tthis.arg0 += dt;\n\t\tif (this.arg0 < this.arg1) return true;\n\n\t\tthis.arg0 -= this.arg1;\n\t\treturn callback (arg0, arg1, arg2);\n\t},\n\n\t/**\n\t * Creates a a time-span callback.\n\t * !static span (period: number, callback: (t:number, dt:number, ...args:any) => boolean, arg0?: any, arg1?: any, arg2?: any) : Callback;\n\t */\n\tspan: function (duration, callback, arg0=null, arg1=null, arg2=null)\n\t{\n\t\treturn this._span.add(this._updateSpan, 0, duration, callback, arg0, arg1, arg2);\n\t},\n\n\t/**\n\t * Cancels a time-span callback.\n\t * !static cancelSpan (callback: Callback) : void;\n\t */\n\tcancelSpan: function (node)\n\t{\n\t\tthis._span.remove(node);\n\t},\n\n\t_updateSpan: function (dt, _0, _1, callback, arg0, arg1, arg2)\n\t{\n\t\tthis.arg0 += dt;\n\t\tif (this.arg0 > this.arg1) {\n\t\t\tdt -= this.arg0 - this.arg1;\n\t\t\tthis.arg0 = this.arg1;\n\t\t}\n\n\t\tif (callback (this.arg0/this.arg1, dt, arg0, arg1, arg2) === false)\n\t\t\treturn false;\n\n\t\treturn this.arg0 !== this.arg1;\n\t}\n};\n\nexport default system;\n","\nimport { Class } from 'rinn';\nimport List from '../utils/list.js';\nimport Recycler from '../utils/recycler.js';\n\nlet _stamp = 0;\nfunction getStamp()\n{\n\t_stamp = (_stamp + 1) & 0x7FFFFFFF;\n\treturn _stamp;\n}\n\n//!class Block\n\nconst Block = Class.extend\n({\n\tclassName: 'Anim:Block',\n\n\tcommands: null,\n\n\tisFirst: true,\n\tcurrent: false,\n\tstamp: 0,\n\ttime: 0,\n\n\t/**\n\t * \tInitializes the block to its initial state.\n\t * \t!init() : Block;\n\t */\n\tinit: function()\n\t{\n\t\tthis.commands = List.Pool.alloc();\n\t\tthis.reset(0);\n\t\treturn this;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis.commands.free();\n\t},\n\n\t/**\n\t * Returns the number of commands in the block.\n\t * !count() : number;\n\t */\n\tcount: function()\n\t{\n\t\treturn this.commands.length;\n\t},\n\n\t/**\n\t * \tAdds a command to the block.\n\t * \t!add (cmd: Command) : Command;\n\t */\n\tadd: function (cmd)\n\t{\n\t\tthis.commands.push(cmd);\n\n\t\tif (this.isFirst === false && this.current === null)\n\t\t{\n\t\t\tthis.current = this.commands.bottom;\n\t\t\tthis.stamp = getStamp();\n\t\t}\n\n\t\treturn cmd;\n\t},\n\n\t/**\n\t * \tClones the block.\n\t * \t!clone() : Block;\n\t */\n\tclone: function()\n\t{\n\t\tlet block = Block.alloc();\n\n\t\tfor (let node = this.commands.top; node !== null; node = node.next)\n\t\t\tblock.commands.push(node.value.clone());\n\n\t\treturn block;\n\t},\n\n\t/**\n\t * \tClears the block by removing all commands and resetting it to initial state.\n\t * \t!clear() : Block;\n\t */\n\tclear: function()\n\t{\n\t\tthis.commands.clear();\n\t\tthis.reset(0);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResets the block to its initial state. Does not remove commands.\n\t * \t!reset (time: number) : Block;\n\t */\n\treset: function (time=0)\n\t{\n\t\tthis.isFirst = true;\n\t\tthis.current = null;\n\t\tthis.time = time;\n\t\tthis.stamp = getStamp();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the block to use the first command in the next call to `update`.\n\t * \t!restart() : Block;\n\t */\n\trestart: function()\n\t{\n\t\tthis.isFirst = true;\n\t\tthis.stamp = getStamp();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns `true` if all commands in the block have been executed to completion.\n\t * \t!isFinished() : boolean;\n\t */\n\tisFinished: function()\n\t{\n\t\tif (this.isFirst === true)\n\t\t{\n\t\t\tthis.current = this.commands.top;\n\t\t\tthis.isFirst = false;\n\t\t}\n\n\t\treturn this.current === null;\n\t},\n\n\t/**\n\t * \tExecutes the next command in the block. Returns `true` when block execution is complete.\n\t * \t!update (anim: Anim) : boolean;\n\t */\n\tupdate: function (anim)\n\t{\n\t\twhile (!this.isFinished())\n\t\t{\n\t\t\tlet r = this.current.value.update(anim, this);\n\t\t\tif (r !== true) return r;\n\n\t\t\tthis.current = this.current.next;\n\t\t}\n\n\t\treturn true;\n\t}\n});\n\n/**\n * \tAllocates a new block.\n * \t!static alloc () : Block;\n */\n\n/**\n * \tAllocates a new block and initializes it.\n * \t!static calloc () : Block;\n */\n\nRecycler.attachTo(Block, 2048);\nexport default Block;\n","\nimport { Class } from 'rinn';\nimport List from '../utils/list.js';\nimport Recycler from '../utils/recycler.js';\n\n//!class Command\n\nconst Command = Class.extend\n({\n\tclassName: 'Anim:Command',\n\n\t/**\n\t * Object having the code of the operation to execute.\n\t */\n\top: null,\n\n\t/**\n\t * Indicates if execution of the command has started.\n\t */\n\tstarted: false,\n\n\t/**\n\t * Time when the command started.\n\t */\n\ttime: 0,\n\n\t/**\n\t * Field related to the command.\n\t */\n\tfield: null,\n\n\t/**\n\t * Value related to the field of the command.\n\t */\n\tvalue: null,\n\n\t/**\n\t * Duration of the command.\n\t */\n\tduration: 0, _duration: 0,\n\n\t/**\n\t * Number of cicles of the command.\n\t */\n\tcount: 0, _count: 0,\n\n\t/**\n\t * Initial value for the command's field.\n\t */\n\tstartValue: 0, _startValue: 0,\n\n\t/**\n\t * Final value for the command's field.\n\t */\n\tendValue: 0, _endValue: 0,\n\n\t/**\n\t * Easing function to use to interpolate values of the command's field.\n\t */\n\teasing: null,\n\n\t_cur: null,\n\t_last: null,\n\n\t/**\n\t * Block where the command is stored.\n\t */\n\tblock: null, /* Block */\n\n\t/**\n\t * Blocks to execute (for commands having multiple blocks).\n\t */\n\tblocks: null, /* List<Block> */\n\n\t/**\n\t * Table with values.\n\t */\n\ttable: null,\n\n\t/**\n\t * Sound resource.\n\t */\n\tsnd: null,\n\n\t/**\n\t * Function to execute.\n\t */\n\tfn: null,\n\n\t/**\n\t * Initializes the command.\n\t * !init (op: object) : Command;\n\t */\n\tinit: function (op, autoInit)\n\t{\n\t\tthis.op = op;\n\t\tthis.started = false;\n\n\t\tthis.block = null;\n\t\tthis.blocks = null;\n\t\n\t\tthis.table = null;\n\t\tthis.snd = null;\n\t\tthis.fn = null;\n\n\t\tif (autoInit !== false)\n\t\t\top.init(this, false);\n\n\t\treturn this;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tif (this.block !== null) this.block.clear().free();\n\t\tif (this.blocks !== null) this.blocks.clear().free();\n\t},\n\n\tclone: function()\n\t{\n\t\tlet cmd = Command.alloc(this.op, false);\n\n\t \tcmd.field = this.field\n\t \tcmd.value = this.value\n\t \tcmd.duration = this.duration\n\t \tcmd.count = this.count\n\t \tcmd.startValue = this.startValue\n\t \tcmd.endValue = this.endValue\n\t \tcmd.easing = this.easing;\n\t\tcmd.table = this.table;\n\t\tcmd.snd = this.snd;\n\t\tcmd.fn = this.fn;\n\n\t\tif (this.block !== null)\n\t\t\tcmd.block = this.block.clone();\n\n\t\tif (this.blocks !== null)\n\t\t{\n\t\t\tcmd.blocks = List.Pool.alloc();\n\n\t\t\tfor (let node = this.blocks.top; node !== null; node = node.next)\n\t\t\t\tcmd.blocks.push(node.value.clone());\n\t\t}\n\n\t\treturn cmd;\n\t},\n\n\t/**\n\t * Executed when the command properties are ready, to initialize the operation code.\n\t * !ready() : void;\n\t */\n\tready: function()\n\t{\n\t\tthis.op.init(this, true);\n\t},\n\n\t/**\n\t * Updates the command execution.\n\t * !update (anim: Anim, block: Block) : boolean;\n\t */\n\tupdate: function(anim, block)\n\t{\n\t\treturn this.op.update(anim, block, this);\n\t}\n});\n\n/**\n * Allocates a new command.\n * !static alloc () : Command;\n */\n\n/**\n * Allocates a new command and initializes it.\n * !static calloc () : Command;\n */\n\nRecycler.attachTo(Command);\nexport default Command;\n","\nimport List from '../utils/list.js';\nimport Block from './block.js';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t\tif (!postinit)\n\t\t{\n\t\t\tcmd.block = Block.alloc();\n\t\t\tcmd.blocks = List.Pool.alloc();\n\t\t\treturn;\n\t\t}\n\n\t\tlet i;\n\n\t\twhile ((i = cmd.block.commands.shift()) != null)\n\t\t{\n\t\t\tlet block = Block.alloc();\n\t\t\tblock.add(i);\n\t\t\tcmd.blocks.push(block);\n\t\t}\n\n\t\tcmd.block.free();\n\t\tcmd.block = null;\n\t},\n\n\tupdate: function (anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tfor (let i = cmd.blocks.top; i !== null; i = i.next)\n\t\t\t{\n\t\t\t\ti.value.reset (block.time);\n\t\t\t}\n\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet time = block.time;\n\t\tlet n = 0, m = 0;\n\n\t\tfor (let i = cmd.blocks.top; i !== null; i = i.next)\n\t\t{\n\t\t\tlet r = i.value.update(anim);\n\t\t\tif (r === true) n++; else if (r === null) m++;\n\n\t\t\tif (i.value.time > time)\n\t\t\t\ttime = i.value.time;\n\t\t}\n\n\t\tif ((n+m) != cmd.blocks.length)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time = time;\n\n\t\treturn true;\n\t}\n};\n","\nimport Block from './block.js';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t\tif (!postinit)\n\t\t\tcmd.block = Block.alloc();\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd.block.reset (block.time);\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet r = cmd.block.update(anim);\n\t\tif (r !== true) return r;\n\n\t\tcmd.started = false;\n\t\tblock.time = cmd.block.time;\n\t\treturn true;\n\t}\n};\n","\nimport Block from './block.js';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t\tif (!postinit)\n\t\t\tcmd.block = Block.alloc();\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd.block.reset (block.time);\n\t\t\tcmd._count = cmd.count;\n\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet r = cmd.block.update(anim);\n\t\tif (r !== true) return r;\n\n\t\tif (cmd._count <= 1)\n\t\t{\n\t\t\tcmd.started = false;\n\t\t\tblock.time = cmd.block.time;\n\t\t\treturn true;\n\t\t}\n\n\t\tcmd.block.restart();\n\t\tcmd._count--;\n\t\treturn false;\n\t}\n};\n","\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tanim.setValue(cmd.field, anim.getValue(cmd.field, cmd.value));\n\t\treturn true;\n\t}\n};\n","\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tblock.restart();\n\t\treturn true;\n\t}\n};\n","\nimport { Rinn } from 'rinn';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._duration = Rinn.typeOf(cmd.duration) === 'string' ? anim.getValue(cmd.duration) : cmd.duration;\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tif (anim.time < block.time + cmd._duration)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time += cmd._duration;\n\t\treturn true;\n\t}\n};\n","\nimport { Rinn } from 'rinn';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._startValue = anim.getValue(cmd.field, cmd.startValue);\n\t\t\tcmd._duration = Rinn.typeOf(cmd.duration) === 'string' ? anim.getValue(cmd.duration) : cmd.duration;\n\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tcmd._endValue = anim.getValue(cmd.field, cmd.endValue, cmd._startValue);\n\n\t\tlet t = 1.0;\n\n\t\tif (anim.time < block.time + cmd._duration)\n\t\t\tt = (anim.time - block.time) / cmd._duration;\n\n\t\tif (cmd.easing && t != 1.0)\n\t\t\tanim.setValue(cmd.field, cmd.easing(t)*(cmd._endValue - cmd._startValue) + cmd._startValue);\n\t\telse\n\t\t\tanim.setValue(cmd.field, t*(cmd._endValue - cmd._startValue) + cmd._startValue);\n\n\t\tif (t != 1.0)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time += cmd._duration;\n\n\t\treturn true;\n\t}\n};\n","\nimport { Rinn } from 'rinn';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._duration = Rinn.typeOf(cmd.duration) === 'string' ? anim.getValue(cmd.duration) : cmd.duration;\n\t\t\tcmd._last = null;\n\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet t = 1.0;\n\n\t\tif (anim.time < block.time + cmd._duration)\n\t\t\tt = (anim.time - block.time) / cmd._duration;\n\n\t\tif (cmd.easing && t != 1.0)\n\t\t\tcmd._cur = int(cmd.easing(t)*cmd.count);\n\t\telse\n\t\t\tcmd._cur = int(t*cmd.count);\n\n\t\tif (cmd._cur != cmd._last)\n\t\t{\n\t\t\tlet val = anim.getValue(cmd.field);\n\n\t\t\twhile (true) {\n\t\t\t\tlet i = int(Math.random()*(cmd.endValue - cmd.startValue + 1)) + cmd.startValue;\n\t\t\t\tif (i != val) break;\n\t\t\t}\n\n\t\t\tanim.setValue(cmd.field, i);\n\t\t\tcmd._last = cmd._cur;\n\t\t}\n\n\t\tif (t != 1.0)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time += cmd._duration;\n\n\t\treturn true;\n\t}\n};\n","\nimport { Rinn } from 'rinn';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t\tif (!postinit) return;\n\n\t\tlet table = [ ];\n\n\t\tfor (let i = 0; i < cmd.count; i++)\n\t\t\ttable.push ((i % (cmd.endValue - cmd.startValue + 1)) + cmd.startValue);\n\n\t\tfor (let i = cmd.count >> 2; i > 0; i--)\n\t\t{\n\t\t\tlet a = int(Math.random() * cmd.count);\n\t\t\tlet b = int(Math.random() * cmd.count);\n\n\t\t\tlet c = table[b];\n\t\t\ttable[b] = table[a];\n\t\t\ttable[a] = c;\n\t\t}\n\n\t\tcmd.table = table;\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._duration = Rinn.typeOf(cmd.duration) === 'string' ? anim.getValue(cmd.duration) : cmd.duration;\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet t = 1.0;\n\t\tlet i;\n\n\t\tif (anim.time < block.time + cmd._duration)\n\t\t\tt = (anim.time - block.time) / cmd._duration;\n\n\t\tif (cmd.easing && t != 1.0)\n\t\t\ti = cmd.easing(t)*(cmd.count-1);\n\t\telse\n\t\t\ti = t*(cmd.count-1);\n\n\t\tanim.setValue(cmd.field, cmd.table[int((i + cmd.count) % cmd.count)]);\n\n\t\tif (t != 1.0)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time += cmd._duration;\n\n\t\treturn true;\n\t}\n};\n","\nexport default\n{\n\tinit: function (cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function (anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._last = anim.time;\n\t\t\tcmd.started = true;\n\t\t\tcmd.time = anim.time;\n\t\t}\n\n\t\tlet dt = anim.time - cmd._last;\n\t\tcmd._last = anim.time;\n\t\tcmd.time += dt;\n\n\t\tlet r = cmd.fn(dt, anim.data, cmd, anim);\n\t\tif (r === true) return false;\n\n\t\tcmd.started = false;\n\t\treturn true;\n\t}\n};\n","\nexport default\n{\n\tinit: function (cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function (anim, block, cmd)\n\t{\n\t\tcmd.snd.play();\n\t\treturn true;\n\t}\n};\n","\nimport { Class } from 'rinn';\nimport List from '../utils/list.js';\nimport Recycler from '../utils/recycler.js';\nimport sys from '../fxl/system.js';\n\n//![import \"../utils/list\"]\n//![import \"../utils/recycler\"]\n\nimport Block from './block.js';\nimport Command from './command.js';\n\n//![import \"./block\"]\n//![import \"./command\"]\n\nimport PARALLEL from './parallel.js';\nimport SERIAL from './serial.js';\nimport REPEAT from './repeat.js';\nimport SET from './set.js';\nimport RESTART from './restart.js';\nimport WAIT from './wait.js';\nimport RANGE from './range.js';\nimport RAND from './rand.js';\nimport RANDT from './randt.js';\nimport EXEC from './exec.js';\nimport PLAY from './play.js';\n\n//:/**\n//: * \tClass to animate properties using commands.\n//: */\n\n//!class Anim\n\nconst Anim = Class.extend\n({\n\tclassName: 'Anim',\n\n\tinitialData: null,\n\tblockStack: null,\n\tcmdStack: null,\n\tblock: null,\n\n\tfinishedCallback: null,\n\tfinishedCallbackHandler: null,\n\tfinishedCallbackContext: null,\n\n\t/**\n\t * Current output data object.\n\t * !data: object;\n\t */\n\tdata: null,\n\n\t/**\n\t * Current time scale (animation speed).\n\t * !readonly timeScale: number;\n\t */\n\ttimeScale: 1,\n\n\t/**\n\t * Current logical time.\n\t * !time: number;\n\t */\n\ttime: 0,\n\n\t/**\n\t * Indicates if the animation is paused.\n\t * !readonly paused: boolean;\n\t */\n\tpaused: false,\n\n\t/**\n\t * Indicates if the animation has finished.\n\t * !readonly finished: boolean;\n\t */\n\tfinished: false,\n\n\t/**\n\t * Indicates if the animation is running.\n\t * !readonly running: boolean;\n\t */\n\trunning: false,\n\n\t/**\n\t * Indicates if the anim should be automatically disposed when finished.\n\t * !autoDispose: boolean;\n\t */\n\tautoDispose: false,\n\n\t/**\n\t * Constructs a new empty Anim object.\n\t * @returns {Anim}\n\t * !constructor ();\n\t */\n\t__ctor: function ()\n\t{\n\t\t// VIOLET: Possibly optimize this { } objects.\n\t\tthis.initialData = { };\n\t\tthis.data = { };\n\n\t\tthis.block = Block.alloc();\n\t\tthis.blockStack = List.Pool.alloc();\n\t\tthis.cmdStack = List.Pool.alloc();\n\n\t\tthis.running = false;\n\t\tthis.autoDispose = false;\n\n\t\tthis.finishedCallback = null;\n\t\tthis.finishedCallbackHandler = null;\n\t\tthis.finishedCallbackContext = null;\n\n\t\treturn this.reset();\n\t},\n\n\t/**\n\t * Destructor.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis.block.free();\n\t\tthis.blockStack.clear().free();\n\t\tthis.cmdStack.clear().free();\n\n\t\tif (this.finishedCallbackHandler !== null)\n\t\t{\n\t\t\tthis.finishedCallbackHandler.free();\n\t\t\tthis.finishedCallbackHandler = null;\n\t\t}\n\n\t\tif (this.finishedCallbackContext !== null)\n\t\t{\n\t\t\tthis.finishedCallbackContext.free();\n\t\t\tthis.finishedCallbackContext = null;\n\t\t}\n\t},\n\n\t/**\n\t * Copies the anim to the specified target and returns it.\n\t * @param {Anim} target \n\t * @returns {Anim}\n\t * !copyTo (target: Anim) : Anim;\n\t */\n\tcopyTo: function (target)\n\t{\n\t\ttarget.clear();\n\n\t\tdispose(target.block);\n\t\ttarget.block = this.block.clone();\n\n\t\ttarget.initialData = this.initialData;\n\t\treturn target.reset();\n\t},\n\n\t/**\n\t * Returns a clone of the anim.\n\t * @param {boolean} autoDispose - If true, the new anim will be disposed when finished.\n\t * @returns {Anim}\n\t * !clone (autoDispose?: boolean) : Anim;\n\t */\n\tclone: function (autoDispose=false)\n\t{\n\t\tlet anim = new Anim();\n\t\tanim.autoDispose = autoDispose;\n\n\t\tthis.copyTo(anim);\n\t\treturn anim;\n\t},\n\n\t/**\n\t * Sets the callback to be called when the animation finishes.\n\t * @param {(anim: Anim, data: object) => boolean} callback\n\t * @returns {Anim}\n\t * !onFinished (callback: (anim: Anim, data: object) => boolean) : Anim;\n\t */\n\tonFinished: function (callback)\n\t{\n\t\tthis.finishedCallback = callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Adds the specified callback to be called when the animation finishes.\n\t * @param {(anim: Anim, context?: object) => boolean} callback\n\t * @param {object} context\n\t * @returns {Anim}\n\t * !then (callback: (anim: Anim, context?: object) => boolean, context?: object) : Anim;\n\t */\n\tthen: function (callback, context=null)\n\t{\n\t\tif (!callback) return this;\n\n\t\tif (this.finishedCallback !== this.thenCallback)\n\t\t{\n\t\t\tthis.finishedCallback = this.thenCallback;\n\n\t\t\tif (this.finishedCallbackHandler === null)\n\t\t\t{\n\t\t\t\tthis.finishedCallbackHandler = List.Pool.alloc();\n\t\t\t\tthis.finishedCallbackContext = List.Pool.alloc();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.finishedCallbackHandler.reset();\n\t\t\t\tthis.finishedCallbackContext.reset();\n\t\t\t}\n\t\t}\n\n\t\tthis.finishedCallbackHandler.push(callback);\n\t\tthis.finishedCallbackContext.push(context);\n\t\treturn this;\n\t},\n\n\tthenCallback: function (data, self)\n\t{\n\t\tif (!self.finishedCallbackHandler.length)\n\t\t\treturn false;\n\n\t\tlet context = self.finishedCallbackContext.shift();\n\t\treturn self.finishedCallbackHandler.shift()(self, context);\n\t},\n\n\t/**\n\t * Clears the object by removing all commands and callbacks. The `initialData` and `data` objects aren't changed.\n\t * @returns {Anim}\n\t * !clear() : Anim;\n\t */\n\tclear: function ()\n\t{\n\t\tthis.blockStack.clear();\n\t\tthis.cmdStack.clear();\n\t\tthis.block.clear();\n\n\t\tthis.paused = false;\n\t\tthis.finished = false;\n\t\tthis.time = 0;\n\t\tthis.timeScale = 1;\n\n\t\tif (this.finishedCallbackHandler !== null)\n\t\t{\n\t\t\tthis.finishedCallbackHandler.free();\n\t\t\tthis.finishedCallbackHandler = null;\n\t\t}\n\n\t\tif (this.finishedCallbackContext !== null)\n\t\t{\n\t\t\tthis.finishedCallbackContext.free();\n\t\t\tthis.finishedCallbackContext = null;\n\t\t}\n\n\t\tthis.finishedCallback = null;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Resets the animation to its initial state.\n\t * @returns {Anim}\n\t * !reset() : Anim;\n\t */\n\treset: function ()\n\t{\n\t\tthis.blockStack.clear();\n\t\tthis.cmdStack.clear();\n\t\tthis.block.reset();\n\n\t\tthis.paused = false;\n\t\tthis.finished = false;\n\t\tthis.time = 0;\n\t\tthis.timeScale = 1;\n\n\t\tObject.assign (this.data, this.initialData);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Cleans up the animation so new commands can be added. Callbacks are not removed.\n\t * @returns {Anim}\n\t * !cleanup() : Anim;\n\t */\n\tcleanup: function ()\n\t{\n\t\tthis.blockStack.clear();\n\t\tthis.cmdStack.clear();\n\t\tthis.block.clear();\n\n\t\tthis.paused = false;\n\t\tthis.finished = false;\n\t\tthis.time = 0;\n\t\tthis.timeScale = 1;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the initial data of the anim.\n\t * @param {object} data\n\t * @returns {Anim}\n\t * !initial (data: object) : Anim;\n\t */\n\t/**\n\t * Sets the anim's data to the initial values.\n\t * @returns {Anim}\n\t * !initial() : Anim;\n\t */\n\tinitial: function (data=null)\n\t{\n\t\tif (data !== null)\n\t\t\tthis.initialData = data;\n\n\t\tObject.assign (this.data, this.initialData);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the time scale (animation speed) to the specified value.\n\t * @param {number} value - The new time scale, should be greater than 0.\n\t * @returns {Anim}\n\t * !speed (value: number) : Anim;\n\t */\n\tspeed: function (value)\n\t{\n\t\tthis.timeScale = value > 0.0 ? value : 1.0;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the output data object.\n\t * @param {object} data \n\t * @returns {Anim}\n\t * !output (data: object) : Anim;\n\t */\n\toutput: function (data)\n\t{\n\t\tthis.data = data;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Pauses the animation.\n\t * @returns {Anim}\n\t * !pause() : Anim;\n\t */\n\tpause: function ()\n\t{\n\t\tif (!this.paused)\n\t\t\tthis.paused = true;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Resumes the animation.\n\t * @returns {Anim}\n\t * !resume() : Anim;\n\t */\n\tresume: function ()\n\t{\n\t\tthis.finished = false;\n\t\tthis.paused = false;\n\n\t\tif (!this.running)\n\t\t\tthis.run(false);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Starts the animation.\n\t * @param {boolean} reset - If true, the animation will be reset to its initial state.\n\t * @returns {Anim}\n\t * !run (reset?: boolean) : Anim;\n\t */\n\trun: function (reset=true)\n\t{\n\t\tif (this.running)\n\t\t\treturn this;\n\n\t\tif (reset == true)\n\t\t\tthis.reset();\n\n\t\tsys.update.add(this.update, this);\n\t\tthis.running = true;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a field.\n\t * @param {string|Function} fieldName \n\t * @param {*} value \n\t */\n\tsetValue: function (fieldName, value)\n\t{\n\t\tlet curr = this.data;\n\n\t\tif (typeof(fieldName) !== 'string')\n\t\t{\n\t\t\tif (typeof(fieldName) === 'function')\n\t\t\t{\n\t\t\t\tfieldName (this, value);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet i = 0;\n\n\t\t\t\twhile (curr !== null && i < fieldName.length-1)\n\t\t\t\t\tcurr = curr[fieldName[i++]];\n\n\t\t\t\tcurr[fieldName[i]] = value;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tcurr[fieldName] = value;\n\t},\n\n\t/**\n\t * Returns the value of a field. Performs special transforms to the value if certain prefix is found.\n\t * @param {string|Function} fieldName \n\t * @param {*} value \n\t * @param {*} initialValue \n\t * @returns {*}\n\t */\n\tgetValue: function (fieldName, value=null, initialValue=null)\n\t{\n\t\tlet curr = this.data;\n\t\t\n\t\tif (typeof(fieldName) !== 'string')\n\t\t{\n\t\t\tif (typeof(fieldName) === 'function')\n\t\t\t{\n\t\t\t\tcurr = fieldName (this, null);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet i = 0;\n\n\t\t\t\twhile (curr !== null && i < fieldName.length)\n\t\t\t\t\tcurr = curr[fieldName[i++]];\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tcurr = curr[fieldName];\n\n\t\tif (value === null)\n\t\t\tvalue = curr;\n\n\t\tif (initialValue === null)\n\t\t\tinitialValue = curr;\n\n\t\tif (typeof(value) === 'string')\n\t\t{\n\t\t\tswitch(value[0])\n\t\t\t{\n\t\t\t\tcase '+':\n\t\t\t\t\tvalue = initialValue + Number(value.substr(1));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase '-':\n\t\t\t\t\tvalue = initialValue - Number(value.substr(1));\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tvalue = Number(value);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\telse if (typeof(value) === 'function')\n\t\t\tvalue = value (curr, initialValue, this);\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * Updates the animation by the specified delta, which must be in the same unit as the duration of the commands.\n\t * Returns false when the animation has been completed.\n\t * @param {number} dt\n\t * @param {Anim} self\n\t * @returns {boolean}\n\t * !update (dt: number, self?: Anim) : boolean;\n\t */\n\tupdate: function (dt, self=null)\n\t{\n\t\tif (self === null)\n\t\t\tself = this;\n\n\t\tif (self.paused || self.block.isFinished())\n\t\t{\n\t\t\tself.running = false;\n\t\t\treturn false;\n\t\t}\n\n\t\tself.time += dt*self.timeScale*Anim.timeScale;\n\n\t\tif (self.block.update(self) !== true)\n\t\t\treturn true;\n\n\t\tlet finished = self.finished;\n\t\tlet stamp = self.block.stamp;\n\t\tlet block = self.block;\n\n\t\tself.finished = true;\n\n\t\tif (!finished && self.finishedCallback !== null)\n\t\t{\n\t\t\tif (self.finishedCallback(self.data, self) === false)\n\t\t\t\tself.finishedCallback = null;\n\n\t\t\tif (self.block !== block || self.block.stamp != stamp)\n\t\t\t{\n\t\t\t\tself.resume();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\tself.running = false;\n\n\t\tif (self.autoDispose)\n\t\t\tdispose(self);\n\n\t\treturn false;\n\t},\n\n\t/**\n\t * Ensures that the field name is correct for subsequent rules.\n\t * @param {string|Function} value \n\t * @returns {Array}\n\t */\n\tprepareFieldName: function (value)\n\t{\n\t\tif (typeof(value) === 'function')\n\t\t\treturn value;\n\n\t\treturn value.indexOf('.') != -1 ? value.split('.') : value;\n\t},\n\n\t/* ****************************************************************************************** */\n\n\t/**\n\t * Runs the subsequent commands in parallel. Should end the parallel block by calling `end`.\n\t * @returns {Anim}\n\t * !parallel() : Anim;\n\t */\n\tparallel: function ()\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(PARALLEL));\n\n\t\tthis.blockStack.push (this.block);\n\t\tthis.cmdStack.push (cmd);\n\n\t\tthis.block = cmd.block;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Runs the subsequent commands in series. Should end the serial block by calling `end`.\n\t * @returns {Anim}\n\t * !serial() : Anim;\n\t */\n\tserial: function ()\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(SERIAL));\n\n\t\tthis.blockStack.push (this.block);\n\t\tthis.cmdStack.push (cmd);\n\n\t\tthis.block = cmd.block;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Repeats a block the specified number of times.\n\t * @param {number} count \n\t * @returns {Anim}\n\t * !repeat (count: number) : Anim;\n\t */\n\trepeat: function (count)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(REPEAT));\n\t\tcmd.count = count;\n\n\t\tthis.blockStack.push (this.block);\n\t\tthis.cmdStack.push (cmd);\n\n\t\tthis.block = cmd.block;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Ends a `parallel`, `serial` or `repeat` block.\n\t * @returns {Anim}\n\t * !end() : Anim;\n\t */\n\tend: function ()\n\t{\n\t\tthis.cmdStack.pop().ready();\n\t\tthis.block = this.blockStack.pop();\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a variable.\n\t * @param {string|Function} field \n\t * @param {*} value \n\t * @returns {Anim}\n\t * !set (field: string|Function, value: any) : Anim;\n\t */\n\tset: function (field, value)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(SET));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.value = value;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Restarts the current block.\n\t * @returns {Anim}\n\t * !restart() : Anim;\n\t */\n\trestart: function ()\n\t{\n\t\tthis.block.add(Command.alloc(RESTART));\n\t\treturn this;\n\t},\n\n\t/**\n\t * Waits for the specified duration.\n\t * @param {number} duration \n\t * @returns {Anim}\n\t * !wait (duration: number) : Anim;\n\t */\n\twait: function (duration)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(WAIT));\n\n\t\tcmd.duration = duration;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Animates a variable from the startValue to the endValue over the specified duration.\n\t * @param {string|Function} field \n\t * @param {number} duration \n\t * @param {number} startValue \n\t * @param {number} endValue \n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t * !range (field: string|Function, duration: number, startValue: number, endValue: number, easing?: (t: number) => number) : Anim;\n\t */\n\trange: function (field, duration, startValue, endValue, easing=null)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(RANGE));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.duration = duration;\n\t\tcmd.startValue = startValue;\n\t\tcmd.endValue = endValue;\n\t\tcmd.easing = easing;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Animates a variable from the current value to the endValue over the specified duration.\n\t * @param {string|Function} field \n\t * @param {number} duration \n\t * @param {number} endValue \n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t * !rangeTo (field: string|Function, duration: number, endValue: number, easing?: (t: number) => number) : Anim;\n\t */\n\trangeTo: function (field, duration, endValue, easing=null)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(RANGE));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.duration = duration;\n\t\tcmd.startValue = null;\n\t\tcmd.endValue = endValue;\n\t\tcmd.easing = easing;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Changes the variable with a value that is a random number in the given range (inclusive) for the specified duration.\n\t * @param {string|Function} field \n\t * @param {number} duration \n\t * @param {number} count \n\t * @param {number} startValue \n\t * @param {number} endValue \n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t * !rand (field: string|Function, duration: number, count: number, startValue: number, endValue: number, easing?: (t: number) => number) : Anim;\n\t */\n\trand: function (field, duration, count, startValue, endValue, easing=null)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(RAND));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.duration = duration;\n\t\tcmd.count = count;\n\t\tcmd.startValue = startValue;\n\t\tcmd.endValue = endValue;\n\t\tcmd.easing = easing;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Changes the variable with a value that is a random number in the given range (inclusive) for the specified duration. The difference\n\t * between this and `rand` is that this function uses a static pre-generated table of random numbers between the specified range.\n\t *\n\t * @param {string|Function} field \n\t * @param {number} duration \n\t * @param {number} count \n\t * @param {number} startValue \n\t * @param {number} endValue \n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t * !randt (field: string|Function, duration: number, count: number, startValue: number, endValue: number, easing?: (t: number) => number) : Anim;\n\t */\n\trandt: function (field, duration, count, startValue, endValue, easing)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(RANDT));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.duration = duration;\n\t\tcmd.count = count;\n\t\tcmd.startValue = startValue;\n\t\tcmd.endValue = endValue;\n\t\tcmd.easing = easing;\n\n\t\tcmd.ready();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Plays a sound.\n\t * @param {object} snd \n\t * @returns {Anim}\n\t * !play (snd: object) : Anim;\n\t */\n\tplay: function (snd)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(PLAY));\n\t\tcmd.snd = snd;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Executes a function. If continuous execution is needed, simply return `true`.\n\t * @param {(dt: number, data: object, cmd: Command, anim: Anim) => boolean} fn \n\t * @returns {Anim}\n\t * !exec (fn: (dt: number, data: object, anim: Anim) => boolean) : Anim;\n\t */\n\texec: function (fn)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(EXEC));\n\t\tcmd.fn = fn;\n\n\t\treturn this;\n\t},\n\n\t/* ********************************************************** */\n\n\t_bounds_x1: function (anim, value)\n\t{\n\t\tif (value === null)\n\t\t\treturn anim.data.bounds.x1;\n\n\t\tanim.data.translate(int(value) - anim.data.bounds.x1, 0);\n\t},\n\n\t_bounds_y1: function (anim, value)\n\t{\n\t\tif (value === null)\n\t\t\treturn anim.data.bounds.y1;\n\n\t\tanim.data.translate(0, int(value) - anim.data.bounds.y1);\n\t},\n\n\t/**\n\t * Sets X coordinate.\n\t * @param {number} value \n\t * @returns {Anim}\n\t * !setX (value: number) : Anim;\n\t */\n\tsetX: function (value)\n\t{\n\t\treturn this.set(this._bounds_x1, value);\n\t},\n\n\t/**\n\t * Sets Y coordinate.\n\t * @param {number} value \n\t * @returns {Anim}\n\t * !setY (value: number) : Anim;\n\t */\n\tsetY: function (value)\n\t{\n\t\treturn this.set(this._bounds_y1, value);\n\t},\n\n\t/**\n\t * Sets both the X and Y coordinates.\n\t * @param {number} x \n\t * @param {number} y \n\t * @returns {Anim}\n\t * !position (x: number, y: number) : Anim;\n\t */\n\tposition: function (x, y)\n\t{\n\t\treturn this.set(this._bounds_x1, x).set(this._bounds_y1, y);\n\t},\n\n\t/**\n\t * Translates the X coordinate for the specified amount over the specified duration.\n\t * @param {number} duration \n\t * @param {number} deltaValue \n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t * !translateX (duration: number, deltaValue: number, easing?: (t: number) => number) : Anim;\n\t */\n\ttranslateX: function (duration, deltaValue, easing)\n\t{\n\t\treturn this.range(this._bounds_x1, duration, null, (deltaValue < 0 ? '-' : '+') + Math.abs(deltaValue), easing);\n\t},\n\n\t/**\n\t * Translates the Y coordinate for the specified amount over the specified duration.\n\t * @param {number} duration \n\t * @param {number} deltaValue \n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t * !translateY (duration: number, deltaValue: number, easing?: (t: number) => number) : Anim;\n\t */\n\ttranslateY: function (duration, deltaValue, easing)\n\t{\n\t\treturn this.range(this._bounds_y1, duration, null, (deltaValue < 0 ? '-' : '+') + Math.abs(deltaValue), easing);\n\t},\n\n\t/**\n\t * Translates the X and Y coordinates for the specified amount over the specified duration.\n\t * @param {number} duration \n\t * @param {number} deltaValueX \n\t * @param {number} deltaValueY \n\t * @param {(t: number) => number} easingX?\n\t * @param {(t: number) => number} easingY?\n\t * @returns {Anim}\n\t * !translate (duration: number, deltaValueX: number, deltaValueY: number, easingX?: (t: number) => number, easingY?: (t: number) => number) : Anim;\n\t */\n\ttranslate: function (duration, deltaValueX, deltaValueY, easingX, easingY=null)\n\t{\n\t\treturn this.parallel()\n\t\t\t\t\t.range(this._bounds_x1, duration, null, (deltaValueX < 0 ? '-' : '+') + Math.abs(deltaValueX), easingX)\n\t\t\t\t\t.range(this._bounds_y1, duration, null, (deltaValueY < 0 ? '-' : '+') + Math.abs(deltaValueY), easingY ? easingY : easingX)\n\t\t\t\t.end();\n\t},\n\n\t/**\n\t * Translates the X and Y coordinates to the specified end values over the specified duration.\n\t * @param {numbe} duration \n\t * @param {number} endValueX \n\t * @param {number} endValueY \n\t * @param {(t: number) => number} easingX?\n\t * @param {(t: number) => number} easingY?\n\t * @returns {Anim}\n\t * !moveTo (duration: number, endValueX: number, endValueY: number, easingX?: (t: number) => number, easingY?: (t: number) => number) : Anim;\n\t */\n\tmoveTo: function (duration, endValueX, endValueY, easingX=null, easingY=null)\n\t{\n\t\treturn this.parallel()\n\t\t\t\t.range(this._bounds_x1, duration, null, endValueX, easingX)\n\t\t\t\t.range(this._bounds_y1, duration, null, endValueY, easingY ? easingY : easingX)\n\t\t\t\t.end();\n\t},\n\n\t/**\n\t * Translates the X coordinate to the specified end value over the specified duration.\n\t * @param {number} duration \n\t * @param {number} endValue \n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t */\n\tmoveX: function (duration, endValue, easing=null)\n\t{\n\t\treturn this.range(this._bounds_x1, duration, null, endValue, easing);\n\t},\n\n\t/**\n\t * Translates the Y coordinate to the specified end value over the specified duration.\n\t * @param {number} duration \n\t * @param {number} endValue \n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t */\n\tmoveY: function (duration, endValue, easing=null)\n\t{\n\t\treturn this.range(this._bounds_y1, duration, null, endValue, easing);\n\t},\n\n\t/**\n\t * Changes the `sx` (scale X) property to the specified end value over the specified duration.\n\t * @param {numbe} duration \n\t * @param {numbber} endValue \n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t */\n\tscaleX: function (duration, endValue, easing)\n\t{\n\t\treturn this.range('sx', duration, null, endValue, easing);\n\t},\n\n\t/**\n\t * Changes the `sy` (scale Y) property to the specified end value over the specified duration.\n\t * @param {number} duration \n\t * @param {numbe} endValue \n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t */\n\tscaleY: function (duration, endValue, easing)\n\t{\n\t\treturn this.range('sy', duration, null, endValue, easing);\n\t},\n\n\t/**\n\t * Changes the `sx` and `sy` (scale X and scale Y) properties to the specified end values over the specified duration.\n\t * @param {number} duration\n\t * @param {number} endValueX\n\t * @param {number} endValueY\n\t * @param {(t: number) => number} easingX?\n\t * @param {(t: number) => number} easingY?\n\t * @returns {Anim}\n\t * !scale (duration: number, endValueX: number, endValueY: number, easingX?: (t: number) => number, easingY?: (t: number) => number) : Anim;\n\t */\n\tscale: function (duration, endValueX, endValueY, easingX, easingY=null)\n\t{\n\t\treturn this.parallel()\n\t\t\t\t.range('sx', duration, null, endValueX, easingX)\n\t\t\t\t.range('sy', duration, null, endValueY, easingY ? easingY : easingX)\n\t\t\t\t.end();\n\t},\n\n\t/**\n\t * Changes the `rotation` property by the specified delta value over the specified duration.\n\t * @param {number} duration\n\t * @param {number} deltaValue\n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t * !rotate (duration: number, deltaValue: number, easing?: (t: number) => number) : Anim;\n\t */\n\trotate: function (duration, deltaValue, easing)\n\t{\n\t\treturn this.range('angle', duration, null, (deltaValue < 0 ? '-' : '+') + Math.abs(deltaValue), easing);\n\t}\n});\n\n/**\n * Global animation time scale.\n * !static timeScale: number;\n */\nAnim.timeScale = 1.0;\n\n/**\n * Sets the global time scale (animation speed).\n * @param {number} value\n * !static speed (value: number) : void;\n */\nAnim.speed = function (value)\n{\n\tAnim.timeScale = value > 0.0 ? value : 1.0;\n};\n\nRecycler.createPool(Anim, 2048);\nexport default Anim;\n","\nimport { Class } from 'rinn';\nimport Bounds2 from '../math/bounds2.js';\nimport Handler from '../utils/handler.js';\n\n//![import \"../math/bounds2\"]\n//![import \"../utils/handler\"]\n\n//:/**\n//: * Describes an element that can be added to a grid.\n//: */\n\n//!class GridElement\n\nconst GridElement = Class.extend\n({\n\t/**\n\t * Name of the class (for inheritance purposes).\n\t */\n\tclassName: 'GridElement',\n\n\t/**\n\t * Identifier of the element (string).\n\t * !id: string;\n\t */\n\tid: null,\n\n\t/**\n\t * Bounds of the element.\n\t * !bounds: Bounds2;\n\t */\n\tbounds: null,\n\n\t/**\n\t * Flags of the element (see constants of this class).\n\t * !flags: number;\n\t */\n\tflags: 0,\n\n\t/**\n\t * Generic data of the element, used to store some value or object.\n\t * !data: object;\n\t */\n\tdata: null,\n\n\t/**\n\t * Extension object of the element, can be used to implement specific functionality.\n\t * !ext: object;\n\t */\n\text: null,\n\n\t/**\n\t * The container where the element is stored.\n\t * !readonly container: Container;\n\t */\n\tcontainer: null,\n\n\t/**\n\t * Removal callback node added by Grid.\n\t */\n\t_grid_remove_node: null,\n\n\t/**\n\t * Remover runs when the `remove` method of the element is called or when the element is destroyed.\n\t * !readonly remover: Handler;\n\t */\n\tremover: null,\n\n\t/**\n\t * Constructs the instance at the specified position and with the specified size.\n\t * !constructor (x: number, y: number, width: number, height: number);\n\t */\n\t__ctor: function (x, y, width, height)\n\t{\n\t\tthis.bounds = Bounds2.Pool.alloc();\n\n\t\tthis.bounds.translate (x, y);\n\t\tthis.bounds.resize (width, height, true);\n\n\t\tthis.flags = GridElement.ALIVE | GridElement.VISIBLE | GridElement.DIRTY | GridElement.DEPTH_FLAG;\n\t\tthis.data = null;\n\t\tthis.ext = null;\n\n\t\tthis.remover = Handler.Pool.alloc(this);\n\t},\n\n\t/**\n\t * Removes the element from its container and destroys it.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.alive(false);\n\n\t\tif (this.data !== null)\n\t\t{\n\t\t\tdispose(this.data);\n\t\t\tthis.data = null;\n\t\t}\n\n\t\tthis.remover.exec();\n\t\tthis.remover.free();\n\n\t\tthis.bounds.free();\n\t},\n\n\t/**\n\t * Sets the identifier of the element.\n\t * !setId (value: string) : GridElement;\n\t */\n\tsetId: function (value)\n\t{\n\t\tthis.id = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets bits of the element flags.\n\t * !setFlags (value: number) : GridElement;\n\t */\n\tsetFlags: function (value)\n\t{\n\t\tthis.flags |= value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Clears bits from the element flags.\n\t * !clearFlags (value: number) : GridElement;\n\t */\n\tclearFlags: function (value)\n\t{\n\t\tthis.flags &= ~value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns true if masking (bitwise AND) the flags by the specified flag bits results in the given value.\n\t * !getFlags (andMask: number, value?: number) : boolean;\n\t */\n\tgetFlags: function (andMask, value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn (this.flags & andMask) === andMask;\n\n\t\treturn (this.flags & andMask) === value;\n\t},\n\n\t/**\n\t * Sets the generic data of the element. Will be disposed when the element is destroyed. The property `host`\n\t * of the object will be set with the reference to the element.\n\t * !setData (data: object) : GridElement;\n\t */\n\tsetData: function (data)\n\t{\n\t\tthis.data = data;\n\n\t\tif (this.data !== null)\n\t\t\tthis.data.host = this;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the generic data of the element.\n\t * !getData() : object;\n\t */\n\tgetData: function()\n\t{\n\t\treturn this.data;\n\t},\n\n\t/**\n\t * Sets the extension object of the element. Calls to functions of this object should be done using the `exec` method.\n\t * !setExt (extensionObject: object) : GridElement;\n\t */\n\tsetExt: function (extensionObject)\n\t{\n\t\tthis.ext = extensionObject;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the extension object of the element.\n\t * !getExt() : object;\n\t */\n\tgetExt: function()\n\t{\n\t\treturn this.ext;\n\t},\n\n\t/**\n\t * Executes a function of the extension object.\n\t * @param {string} name\n\t * !exec (name: string, ...args: any) : any;\n\t */\n\texec: function(name, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null, arg6=null, arg7=null, arg8=null, arg9=null)\n\t{\n\t\tif (this.ext === null || this.ext.hasOwnProperty(name) === false)\n\t\t\treturn false;\n\n\t\treturn this.ext[name] (this, arg0, arg1, arg2, arg3, arg4, arg5, arg6, arg7, arg8, arg9);\n\t},\n\n\t/**\n\t * Sets the visible flag.\n\t * @param {boolean} value - New visibility value.\n\t * @param {boolean} forced - When `true` forces to ignore the VISIBLE_LOCK flag.\n\t * !visible (value: boolean, forced?: boolean|false) : GridElement;\n\t */\n\t/**\n\t * Returns the visible flag.\n\t * !visible() : boolean;\n\t */\n\tvisible: function (value=null, forced=false)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.VISIBLE);\n\n\t\tif (forced === false && (this.flags & GridElement.VISIBLE_LOCK) !== 0)\n\t\t\treturn this;\n\n\t\tthis.flags &= ~GridElement.VISIBLE;\n\t\tif (value === true) this.flags |= GridElement.VISIBLE;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the visible-lock flag.\n\t * !visibleLock (value: boolean) : GridElement;\n\t */\n\t/**\n\t * Returns the visible-lock flag.\n\t * !visibleLock() : boolean;\n\t */\n\tvisibleLock: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.VISIBLE_LOCK);\n\n\t\tthis.flags &= ~GridElement.VISIBLE_LOCK;\n\t\tif (value === true) this.flags |= GridElement.VISIBLE_LOCK;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the alive flag.\n\t * !alive (value: boolean) : GridElement;\n\t */\n\t/**\n\t * Returns the alive flag.\n\t * !alive() : boolean;\n\t */\n\talive: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.ALIVE);\n\n\t\tthis.flags &= ~GridElement.ALIVE;\n\t\tif (value === true) this.flags |= GridElement.ALIVE;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the dirty flag.\n\t * !alive (value: boolean) : GridElement;\n\t */\n\t/**\n\t * Returns the dirty flag.\n\t * !alive() : boolean;\n\t */\n\tdirty: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.DIRTY);\n\n\t\tthis.flags &= ~GridElement.DIRTY;\n\t\tif (value === true) this.flags |= GridElement.DIRTY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the depth-flag-enabled flag.\n\t * !depthFlagEnabled (value: boolean) : GridElement;\n\t */\n\t/**\n\t * Returns the depth-flag-enabled flag.\n\t * !depthFlagEnabled() : boolean;\n\t */\n\tdepthFlagEnabled: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.DEPTH_FLAG_ENABLED);\n\n\t\tthis.flags &= ~GridElement.DEPTH_FLAG_ENABLED;\n\t\tif (value === true) this.flags |= GridElement.DEPTH_FLAG_ENABLED;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the depth-flag flag. To actually use the depth-test, you have to enable the depth-flag using `depthFlagEnabled`.\n\t * !depthFlagEnabled (value: boolean) : GridElement;\n\t */\n\t/**\n\t * Returns the depth-flag flag.\n\t * !depthFlagEnabled() : boolean;\n\t */\n\tdepthFlag: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.DEPTH_FLAG);\n\n\t\tthis.flags &= ~GridElement.DEPTH_FLAG;\n\t\tif (value === true) this.flags |= GridElement.DEPTH_FLAG;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Removes the element from the container and returns itself.\n\t * !remove() : GridElement;\n\t */\n\tremove: function()\n\t{\n\t\tthis.remover.exec();\n\t\treturn this;\n\t},\n\n\t/**\n\t * Syncs the actual location of the specified element with its storage location (if alive and dirty).\n\t * !sync() : GridElement;\n\t */\n\tsync: function()\n\t{\n\t\tif (this.container === null || this.getFlags(GridElement.ALIVE | GridElement.DIRTY) === false)\n\t\t\treturn this;\n\n\t\tthis.container.sync(this);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the width and height of the element.\n\t * !resize (width: number|boolean|null, height: number|boolean|null) : GridElement;\n\t */\n\tresize: function (width, height)\n\t{\n\t\tthis.flags |= GridElement.DIRTY;\n\t\tthis.bounds.resize (width, height, true);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Resizes the element by the specified deltas.\n\t * !resizeBy (deltaWidth: number|boolean, deltaHeight: number|boolean) : GridElement;\n\t */\n\tresizeBy: function (dWidth, dHeight)\n\t{\n\t\tthis.flags |= GridElement.DIRTY;\n\t\tthis.bounds.resizeBy (dWidth, dHeight, true);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Moves the element by the specified deltas.\n\t * @param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * !translate (dx: number, dy: number, upscaled?: boolean) : GridElement;\n\t */\n\ttranslate: function (dx, dy, upscaled=false)\n\t{\n\t\tthis.flags |= GridElement.DIRTY;\n\t\tthis.bounds.translate (dx, dy, upscaled);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the position of the element. Any parameter set to `null` will cause it not to be changed.\n\t * !setPosition (x: number, y: number) : GridElement;\n\t */\n\t/**\n\t * Sets the position of the element. Any parameter set to `null` will cause it not to be changed.\n\t * !setPosition (pointer: {x:number, y:number}) : GridElement;\n\t */\n\tsetPosition: function (x, y=false)\n\t{\n\t\tif (y === false) {\n\t\t\ty = x.y;\n\t\t\tx = x.x;\n\t\t}\n\n\t\treturn this.translate (x !== null ? upscale(x)-this.bounds.ux1 : 0, y !== null ? upscale(y)-this.bounds.uy1 : 0, true);\n\t}\n});\n\n/*\n**\tGrid element flags.\n*/\nGridElement.ALIVE \t\t\t\t= \t0x0001;\nGridElement.VISIBLE \t\t\t= \t0x0002;\nGridElement.VISIBLE_LOCK \t\t= \t0x0004;\nGridElement.DIRTY \t\t\t\t= \t0x0008;\nGridElement.DEPTH_FLAG_ENABLED\t= \t0x0010;\nGridElement.DEPTH_FLAG\t\t\t= \t0x0020;\nGridElement.WRAP_EXTENTS\t\t=\t0x0040;\n\nGridElement.USERDEF\t\t=\t0x0100; /* Bits 8 to 30 : 23 flags  */\nGridElement.LAST_FLAG\t=\t0x0080;\n\n/**\n * Class-level function to allocate a new flag.\n * !static allocFlag() : number;\n */\nGridElement.allocFlag = function()\n{\n\tlet flag = GridElement.LAST_FLAG;\n\tif (flag === 0x4000_0000) throw new Error ('allocFlag: out of bit space to allocate another flag');\n\n\tflag <<= 1;\n\tGridElement.LAST_FLAG = flag;\n\n\treturn flag;\n};\n\nexport default GridElement;\n","\nimport { Class } from 'rinn';\nimport GridElement from './grid-element.js';\nimport List from '../utils/list.js';\n\n//![import \"./grid-element\"]\n//![import \"../utils/list\"]\n\n//:/**\n//: * \tDescribes an optimized data structure to store 2D spatially indexed elements.\n//: */\n\n//!class Grid\n\nconst Grid = Class.extend\n({\n\t/**\n\t * Name of the class (for inheritance purposes).\n\t */\n\tclassName: 'Grid',\n\n\t/**\n\t * Actual grid of data, stored linearly. Contains several entries each of which can be either null or a List containing grid elements.\n\t */\n\tgrid: null,\n\n\t/**\n\t * Number of elements active in the grid.\n\t * !readonly count: number;\n\t */\n\tcount: 0,\n\n\t/**\n\t * The X and Y offsets to be added to all input coordinates. Used to ensure that a negative coordinate always ends up positive, calculated\n\t * using the width and height of the grid.\n\t */\n\toffsx: 0, offsy: 0,\n\n\t/**\n\t * Divisors for the X and Y coordinates respectively. All input coordinates (after offseting) will be divided by these values to map them\n\t * to a grid entry (list) where the element can be added.\n\t */\n\tkx: 0, ky: 0,\n\n\t/**\n\t * Stride to calculate an index with a Y-coordinate.\n\t */\n\tstride: 0,\n\n\t/**\n\t * Indicates if the grid should match regions with exact precision by comparing region to element bounds intersection.\n\t * !verifyIntersection: boolean;\n\t */\n\tverifyIntersection: true,\n\n\t/**\n\t * Constructs a grid with the specified maximum width and height. The final effective coordinate range will be -(width/2) to (width/2)for X,\n\t * and -(height/2) to (height/2) for Y.\n\t * \n\t * Note that the width, height and divisors kx and ky will be converted to their closest base-2 value. This is done to ensure shifts can be used\n\t * to quickly divide the input coordinates.\n\t * \n\t * !constructor (width: number, height: number, kx: number, ky?: number);\n\t */\n\t__ctor: function (width, height, kx, ky=null)\n\t{\n\t\twidth = 1 << Math.ceil(Math.log2(width));\n\t\theight = 1 << Math.ceil(Math.log2(height));\n\n\t\tthis.offsx = width >> 1;\n\t\tthis.offsy = height >> 1;\n\n\t\tif (ky === null)\n\t\t\tky = kx;\n\n\t\tkx = Math.floor(Math.log2(kx));\n\t\tky = Math.floor(Math.log2(ky));\n\n\t\tthis.kx = kx;\n\t\tthis.ky = ky;\n\n\t\tlet w = width >> kx;\n\t\tlet h = height >> ky;\n\n\t\tif (!w) {\n\t\t\tkx = Math.log2(width);\n\t\t\tw = 1;\n\t\t}\n\n\t\tif (!h) {\n\t\t\tky = Math.log2(height);\n\t\t\th = 1;\n\t\t}\n\n\t\tthis.grid = new Array(w*h).fill(null);\n\t\tthis.stride = w;\n\t},\n\n\t/**\n\t * Destroys all lists and elements in the grid.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis.grid = null;\n\t},\n\n\t/**\n\t * Returns the value of the `strict` intersection flag.\n\t * !strict() : boolean;\n\t */\n\t/**\n\t * Sets the `strict` intersection flag, when set, only elements that intersect with the region when using forEachInRegion and similar methods will be used.\n\t * !strict (value: boolean) : Grid;\n\t */\n\tstrict: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this.verifyIntersection;\n\n\t\tthis.verifyIntersection = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tDestroys all lists and elements in the grid.\n\t * \t!clear() : void;\n\t */\n\tclear: function()\n\t{\n\t\tfor (let i = 0; i < this.grid.length; i++)\n\t\t{\n\t\t\tif (this.grid[i] === null)\n\t\t\t\tcontinue;\n\n\t\t\tlet j;\n\n\t\t\twhile ((j = this.grid[i].shift()) !== null)\n\t\t\t{\n\t\t\t\tj.remover.remove(this._remove, this);\n\t\t\t\tj.container = null;\n\n\t\t\t\tdispose(j);\n\t\t\t}\n\n\t\t\tthis.grid[i].free();\n\t\t\tthis.grid[i] = null;\n\t\t}\n\n\t\tthis.count = 0;\n\t},\n\n\t/**\n\t * \tDestroys all lists in the grid. Elements will not be destroyed.\n\t * \t!reset() : void;\n\t */\n\treset: function()\n\t{\n\t\tfor (let i = 0; i < this.grid.length; i++)\n\t\t{\n\t\t\tif (this.grid[i] === null)\n\t\t\t\tcontinue;\n\n\t\t\tlet j;\n\n\t\t\twhile ((j = this.grid[i].shift()) !== null)\n\t\t\t{\n\t\t\t\tj.remover.remove(this._remove, this);\n\t\t\t\tj.container = null;\n\t\t\t}\n\n\t\t\tthis.grid[i].free();\n\t\t\tthis.grid[i] = null;\n\t\t}\n\n\t\tthis.count = 0;\n\t},\n\n\t/**\n\t * \tAdds an element to the grid. Returns `true` if successful, or `false` if the element is outside of the grid bounds.\n\t * \t!add (elem: GridElement) : boolean;\n\t */\n\tadd: function (elem)\n\t{\n\t\tif (GridElement.isInstance(elem) === false)\n\t\t\tthrow new Error ('argument must be a GridElement');\n\n\t\tlet i = int((elem.bounds.y1+this.offsy) >> this.ky) * this.stride + int((elem.bounds.x1+this.offsx) >> this.kx);\n\t\tif (i < 0 || i >= this.grid.length) return false;\n\n\t\tif (this.grid[i] === null)\n\t\t\tthis.grid[i] = List.Pool.alloc();\n\n\t\tthis.grid[i].push(elem);\n\t\tthis.count++;\n\n\t\telem.container = this;\n\t\telem._grid_remove_node = elem.remover.add(this._remove, this, i, this.grid[i].bottom);\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tCallback to remove an element from the grid (called by Handler).\n\t */\n\t_remove: function (elem, self, index, node)\n\t{\n\t\tself.grid[index].remove(node);\n\t\tself.count--;\n\n\t\telem.container = null;\n\t\treturn false;\n\t},\n\n\t/**\n\t * \tRemoves the element from the grid and returns it.\n\t * \t!remove (elem: GridElement) : GridElement;\n\t */\n\tremove: function (elem)\n\t{\n\t\telem.remover.execc(this._grid_remove_node);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tUpdates the storage location of the specified element. Returns `true` if successful, or `false` if the element is outside of the grid bounds (in\n\t * \twhich case the element will be removed), or if the element does not belong to this grid.\n\t * \t!sync (elem: GridElement) : boolean;\n\t */\n\tsync: function (elem)\n\t{\n\t\telem.clearFlags(GridElement.DIRTY);\n\n\t\tlet node = elem._grid_remove_node;\n\n\t\tlet i = int((elem.bounds.y1+this.offsy) >> this.ky) * this.stride + int((elem.bounds.x1+this.offsx) >> this.kx);\n\t\tif (i < 0 || i >= this.grid.length)\n\t\t{\n\t\t\telem.remover.execc(node);\n\t\t\treturn false;\n\t\t}\n\n\t\tif (node.arg1 === i)\n\t\t\treturn true;\n\n\t\tthis.grid[node.arg1].remove(node.arg2);\n\n\t\tif (this.grid[i] === null)\n\t\t\tthis.grid[i] = List.Pool.alloc();\n\n\t\tthis.grid[i].push(elem);\n\n\t\tnode.arg1 = i;\n\t\tnode.arg2 = this.grid[i].bottom;\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tExecutes the specified callback function for each element that intersects the given bounds and has the specified flags set. The process is immediately\n\t * \tstopped if the callback returns `false`.\n\t * \t!forEachInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number, callback: (elem: GridElement, context?: object) => boolean, context?: object) : void;\n\t */\n\tforEachInRegion: function (bounds, flagsAndMask, flagsValue, callback, context)\n\t{\n\t\tlet j0 = ((bounds.y1+this.offsy) - (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet j1 = ((bounds.y2+this.offsy) + (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet i0 = ((bounds.x1+this.offsx) - (1<<this.kx-1) >> this.kx);\n\t\tlet i1 = ((bounds.x2+this.offsx) + (1<<this.kx-1) >> this.kx);\n\n\t\tlet n = this.grid.length-1;\n\n\t\tif (j0 < 0) j0 = 0; if (j1 < 0) j1 = 0;\n\t\tif (i0 < 0) i0 = 0; if (i1 < 0) i1 = 0;\n\t\tif (j0 > n) j0 = n; if (j1 > n) j1 = n;\n\t\tif (i0 > n) i0 = n; if (i1 > n) i1 = n;\n\n\t\tfor (let j = j0; j <= j1; j += this.stride)\n\t\t{\n\t\t\tfor (let i = i0; i <= i1; i++)\n\t\t\t{\n\t\t\t\tlet k = j + i;\n\t\t\t\tif (k > n || this.grid[k] === null) continue;\n\n\t\t\t\tfor (let e = this.grid[k].top; e; e = e.next)\n\t\t\t\t{\n\t\t\t\t\tconst v = e.value;\n\n\t\t\t\t\t// First check the element flags.\n\t\t\t\t\tif (v.getFlags(flagsAndMask, flagsValue) === false) continue;\n\n\t\t\t\t\t// Verify exact intersection only on elements located on the edges of the indexed-based approximated rectangle.\n\t\t\t\t\tif (this.verifyIntersection === true && (j <= j0+1 || i <= i0+1 || j >= j1-1 || i >= i1-1))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (v.bounds.x2 < bounds.x1 || v.bounds.y2 < bounds.y1 || v.bounds.x1 > bounds.x2 || v.bounds.y1 > bounds.y2)\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (callback(v, context) === false)\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * \tCollects all elements that intersect the given bounds and have the specified flags set. Returns a new List, remember to call `free` after using it.\n\t * \t!selectInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : List;\n\t */\n\tselectInRegion: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\tlet j0 = ((bounds.y1+this.offsy) - (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet j1 = ((bounds.y2+this.offsy) + (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet i0 = ((bounds.x1+this.offsx) - (1<<this.kx-1) >> this.kx);\n\t\tlet i1 = ((bounds.x2+this.offsx) + (1<<this.kx-1) >> this.kx);\n\n\t\tlet n = this.grid.length-1;\n\n\t\tif (j0 < 0) j0 = 0; if (j1 < 0) j1 = 0;\n\t\tif (i0 < 0) i0 = 0; if (i1 < 0) i1 = 0;\n\t\tif (j0 > n) j0 = n; if (j1 > n) j1 = n;\n\t\tif (i0 > n) i0 = n; if (i1 > n) i1 = n;\n\n\t\tlet list = List.Pool.alloc();\n\n\t\tfor (let j = j0; j <= j1; j += this.stride)\n\t\t{\n\t\t\tfor (let i = i0; i <= i1; i++)\n\t\t\t{\n\t\t\t\tlet k = j + i;\n\t\t\t\tif (k > n || this.grid[k] === null) continue;\n\n\t\t\t\tfor (let e = this.grid[k].top; e; e = e.next)\n\t\t\t\t{\n\t\t\t\t\tconst v = e.value;\n\n\t\t\t\t\t// First check the element flags.\n\t\t\t\t\tif (v.getFlags(flagsAndMask, flagsValue) === false) continue;\n\n\t\t\t\t\t// Verify exact intersection only on elements located on the edges of the indexed-based approximated rectangle.\n\t\t\t\t\tif (this.verifyIntersection === true && (j <= j0+1 || i <= i0+1 || j >= j1-1 || i >= i1-1))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (v.bounds.x2 < bounds.x1 || v.bounds.y2 < bounds.y1 || v.bounds.x1 > bounds.x2 || v.bounds.y1 > bounds.y2)\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tlist.push(v);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn list;\n\t},\n\n\t/**\n\t * \tCounts all elements that intersect the given bounds and have the specified flags set.\n\t * \t!countInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : number;\n\t */\n\tcountInRegion: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\tlet j0 = ((bounds.y1+this.offsy) - (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet j1 = ((bounds.y2+this.offsy) + (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet i0 = ((bounds.x1+this.offsx) - (1<<this.kx-1) >> this.kx);\n\t\tlet i1 = ((bounds.x2+this.offsx) + (1<<this.kx-1) >> this.kx);\n\n\t\tlet n = this.grid.length-1;\n\n\t\tif (j0 < 0) j0 = 0; if (j1 < 0) j1 = 0;\n\t\tif (i0 < 0) i0 = 0; if (i1 < 0) i1 = 0;\n\t\tif (j0 > n) j0 = n; if (j1 > n) j1 = n;\n\t\tif (i0 > n) i0 = n; if (i1 > n) i1 = n;\n\n\t\tlet m = 0;\n\n\t\tfor (let j = j0; j <= j1; j += this.stride)\n\t\t{\n\t\t\tfor (let i = i0; i <= i1; i++)\n\t\t\t{\n\t\t\t\tlet k = j + i;\n\t\t\t\tif (k > n || this.grid[k] === null) continue;\n\n\t\t\t\tfor (let e = this.grid[k].top; e; e = e.next)\n\t\t\t\t{\n\t\t\t\t\tconst v = e.value;\n\n\t\t\t\t\t// First check the element flags.\n\t\t\t\t\tif (v.getFlags(flagsAndMask, flagsValue) === false) continue;\n\n\t\t\t\t\t// Verify exact intersection only on elements located on the edges of the indexed-based approximated rectangle.\n\t\t\t\t\tif (this.verifyIntersection === true && (j <= j0+1 || i <= i0+1 || j >= j1-1 || i >= i1-1))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (v.bounds.x2 < bounds.x1 || v.bounds.y2 < bounds.y1 || v.bounds.x1 > bounds.x2 || v.bounds.y1 > bounds.y2)\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tm++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn m;\n\t},\n\n\t/**\n\t * \tReturns the first element that intersect the given bounds and have the specified flags set.\n\t * \t!selectFirst (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : GridElement;\n\t */\n\tselectFirst: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\tlet j0 = ((bounds.y1+this.offsy) - (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet j1 = ((bounds.y2+this.offsy) + (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet i0 = ((bounds.x1+this.offsx) - (1<<this.kx-1) >> this.kx);\n\t\tlet i1 = ((bounds.x2+this.offsx) + (1<<this.kx-1) >> this.kx);\n\n\t\tlet n = this.grid.length-1;\n\n\t\tif (j0 < 0) j0 = 0; if (j1 < 0) j1 = 0;\n\t\tif (i0 < 0) i0 = 0; if (i1 < 0) i1 = 0;\n\t\tif (j0 > n) j0 = n; if (j1 > n) j1 = n;\n\t\tif (i0 > n) i0 = n; if (i1 > n) i1 = n;\n\n\t\tfor (let j = j0; j <= j1; j += this.stride)\n\t\t{\n\t\t\tfor (let i = i0; i <= i1; i++)\n\t\t\t{\n\t\t\t\tlet k = j + i;\n\t\t\t\tif (k > n || this.grid[k] === null) continue;\n\n\t\t\t\tfor (let e = this.grid[k].top; e; e = e.next)\n\t\t\t\t{\n\t\t\t\t\tconst v = e.value;\n\n\t\t\t\t\t// First check the element flags.\n\t\t\t\t\tif (v.getFlags(flagsAndMask, flagsValue) === false) continue;\n\n\t\t\t\t\t// Verify exact intersection only on elements located on the edges of the indexed-based approximated rectangle.\n\t\t\t\t\tif (this.verifyIntersection === true && (j <= j0+1 || i <= i0+1 || j >= j1-1 || i >= i1-1))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (v.bounds.x2 < bounds.x1 || v.bounds.y2 < bounds.y1 || v.bounds.x1 > bounds.x2 || v.bounds.y1 > bounds.y2)\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n});\n\nexport default Grid;\n","\nimport { Class } from 'rinn';\nimport Handler from '../utils/handler';\n\n//:/**\n//: * \tA container is responsible to store elements for their subsequent rendering. The actual storage mechanism used can vary and must be implemented by derived\n//: * \tclasses (see `GridContainer` and `SimpleContainer`).\n//: */\n\n//!class Container\n\nconst Container = Class.extend\n({\n\tclassName: 'Container',\n\n\t/**\n\t * Viewport bounds currently active. Set by the Scene class before calling `draw`.\n\t * !viewportBounds: Bounds2;\n\t */\n\tviewportBounds: null,\n\n\t/**\n\t * Width of the container.\n\t * !width: number;\n\t */\n\twidth: 0,\n\n\t/**\n\t * Height of the container.\n\t * !height: number;\n\t */\n\theight: 0,\n\n\t/**\n\t * Depth (z-value) of the container, calculated by the scene.\n\t * !zvalue: number;\n\t */\n\tzvalue: 0,\n\n\t/**\n\t * Scene object to which this container belongs.\n\t * !scene: Scene;\n\t */\n\tscene: null,\n\n\t/**\n\t * Flags of the object (see constants at the bottom of this file).\n\t * !flags: number;\n\t */\n\tflags: 0,\n\n\t/**\n\t * Currently active display buffer for rendering operations (used by drawElement).\n\t * !g: Canvas;\n\t */\n\tg: null,\n\n\t/**\n\t * Total number of elements in the container.\n\t * !readonly elementCount: number;\n\t */\n\telementCount: 0,\n\n\t/**\n\t * Total number of elements drawn on the last draw operation.\n\t * !readonly drawCount: number;\n\t */\n\tdrawCount: 0,\n\n\t// TODO This might be useless when we move to variable container/scenes mode. So, ensure you destroy this ldraw crap.\n\t/**\n\t * Draw handler executed after the scene is drawn.\n\t * !readonly ldraw: Handler;\n\t */\n\tldraw: null,\n\n\t/**\n\t * Constructs the container with the default size (32768 x 32768).\n\t * !constructor ();\n\t */\n\t/**\n\t * Constructs the container with the specified size.\n\t * !constructor (width: number, height: number);\n\t */\n\t__ctor: function (width=32768, height=32768)\n\t{\n\t\tthis.width = width;\n\t\tthis.height = height;\n\n\t\tthis.flags = Container.VISIBLE | Container.DEPTH_FLAG;\n\t\tthis.ldraw = Handler.Pool.alloc(this);\n\t},\n\n\t/**\n\t * Destroys the container.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.ldraw.free();\n\t},\n\n\t/**\n\t * Returns the value of the `visible` flag.\n\t * !visible() : boolean;\n\t */\n\t/**\n\t * Sets the value of the `visible` flag.\n\t * !visible(value: boolean) : Container;\n\t */\n\tvisible: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Container.VISIBLE);\n\n\t\tthis.flags &= ~Container.VISIBLE;\n\t\tif (value === true) this.flags |= Container.VISIBLE;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the value of the `depthFlag` flag.\n\t * !depthFlag() : boolean;\n\t */\n\t/**\n\t * Sets the value of the `depthFlag` flag.\n\t * !depthFlag(value: boolean) : Container;\n\t */\n\tdepthFlag: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Container.DEPTH_FLAG);\n\n\t\tthis.flags &= ~Container.DEPTH_FLAG;\n\t\tif (value === true) this.flags |= Container.DEPTH_FLAG;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the active viewport bounds.\n\t * !setViewportBounds (bounds: Bounds2) : Container;\n\t */\n\tsetViewportBounds: function (bounds)\n\t{\n\t\tthis.viewportBounds = bounds;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Draws the specified element.\n\t * !drawElement (elem: Element, self: Container) : boolean;\n\t */\n\tdrawElement: function (elem, self)\n\t{\n\t\tself.drawCount++;\n\t\treturn elem.draw(self.g);\n\t},\n\n\t/**\n\t * Updates the Z-value of the specified element. Should be called after adding an element and after/before every sync.\n\t * !syncZ (elem: Element) : void;\n\t */\n\tsyncZ: function (elem)\n\t{\n\t\telem.__zvalue = this.zvalue + ((elem._zvalue + elem.bounds.y2) & ((1 << 18) - 1));\n\t\t//elem.__zvalue = this.zvalue + (1 << 18) - ((elem._zvalue + elem.bounds.y2 + (1 << 18)) & ((1 << 18) - 1));\n\t},\n\n\t/**\n\t * Syncs the actual location of the specified element with its storage location. Returns true if successful.\n\t * !sync (elem: Element) : boolean;\n\t */\n\tsync: function (elem)\n\t{\n\t\tthrow new Error ('Container::sync not implemented');\n\t},\n\n\t/**\n\t * Clears the container to empty. All contained elements will be destroyed.\n\t * !clear() : void;\n\t */\n\tclear: function() /* @override */\n\t{\n\t\tthrow new Error ('Container::clear not implemented');\n\t},\n\n\t/**\n\t * Resets the container to empty. Contained elements are not destroyed. Use `clear` if that is your intention.\n\t * !reset() : void;\n\t */\n\treset: function() /* @override */\n\t{\n\t\tthrow new Error ('Container::reset not implemented');\n\t},\n\n\t/**\n\t * Adds an element to the container. Returns boolean indicating if successful.\n\t * !add (elem: Element) : Element;\n\t */\n\tadd: function (elem) /* @override */\n\t{\n\t\tthrow new Error ('Container::add not implemented');\n\t},\n\n\t/**\n\t * Removes an element from the container and returns it.\n\t * !remove (elem: Element) : Element;\n\t */\n\tremove: function (elem) /* @override */\n\t{\n\t\tthrow new Error ('Container::remove not implemented');\n\t},\n\n\t/**\n\t * Prepares the canvas with depth flag configuration and Z-value to draw the contained elements.\n\t * !draw (g: Canvas) : void;\n\t */\n\tdraw: function(g)\n\t{\n\t\tif (this.visible() === false) return;\n\n\t\tlet depthFlagChanged = g.pushDepthFlag(this.flags & Container.DEPTH_FLAG);\n\n\t\tg.zvalue = this.zvalue;\n\n\t\tthis.drawCount = 0;\n\t\tthis.g = g;\n\n\t\tthis.render();\n\t\tthis.ldraw.exec(g);\n\n\t\tif (depthFlagChanged === true) g.popDepthFlag();\n\t},\n\n\t/**\n\t * Actually draws the contained elements.\n\t * !render() : void;\n\t */\n\trender: function()\n\t{\n\t\tthrow new Error ('Container::render not implemented');\n\t}\n});\n\n\n/*\n**\tConstants.\n*/\nContainer.VISIBLE = 0x001;\nContainer.DEPTH_FLAG = 0x002;\n\nexport default Container;\n","\nimport { Class } from 'rinn';\nimport Bounds2 from '../math/bounds2.js';\nimport Point2 from '../math/point2.js';\n\n//![import \"../math/point2\"]\n//![import \"../math/bounds2\"]\n//![import \"../math/rect\"]\n//![import \"../system/canvas\"]\n\n//:/**\n//: * \tViewport class controls the current visible rectangle of a container.\n//: */\n\n//!class Viewport\n\nconst Viewport = Class.extend\n({\n\tclassName: 'Viewport',\n\n\t/**\n\t * \tDimensions of the viewport.\n\t *\n\t * \t!readonly width: number;\n\t * \t!readonly height: number;\n\t */\n\twidth: 0, initialWidth: 0,\n\theight: 0, initialHeight: 0,\n\n\t/**\n\t * \tPosition of the top-left corner of the viewport in screen space.\n\t */\n\tsx: 0,\n\tsy: 0,\n\n\t/**\n\t * \tPosition of the center of the viewport in the container.\n\t */\n\tx: 0,\n\ty: 0,\n\n\t/**\n\t * \tRatio for the viewport's center (value from -1 to 1), used when focusing to use a different focus point instead of the exact center.\n\t */\n\tcenterRatioX: 0,\n\tcenterRatioY: 0,\n\n\t/**\n\t * \tPosition offset, used to move the viewport around without affecting the focus point.\n\t */\n\toffset: null,\n\n\t/**\n\t * \tBoundaries of the container, set by `setContainerBounds`.\n\t *\n\t * \t!readonly container: Bounds2;\n\t */\n\tcontainer: null,\n\n\t/**\n\t * \tThe focus factor determines the ratio of a smaller viewport on which the current focus point must  be contained. If the focus point is not inside the\n\t * \tsmaller viewport scrolling will be performed.\n\t */\n\tfocusFactorX: 0,\n\tfocusFactorY: 0,\n\n\t/**\n\t * \tFocus target rectangle and its offsets. When the viewport is updated it will automatically focus on this rect.\n\t */\n\tfocusRect: null,\n\tfocusOffsX: 0,\n\tfocusOffsY: 0,\n\n\t/**\n\t * \tEnabled focus axes. Used by the `update` method to figure which axis to update.\n\t */\n\tfocusAxisX: true,\n\tfocusAxisY: true,\n\n\t/**\n\t * \tFlags of the viewport.\n\t */\n\tflags: 0,\n\n\t/**\n\t * \tViewport scale.\n\t */\n\tscale: 1,\n\n\t/**\n\t * \tGlobal scale, used to scale the entire canvas including the viewport. Useful for debugging viewport bounds.\n\t */\n\tglobalScale: 1,\n\n\t/**\n\t * \tBounds of the viewport in world space. Used to determine which elements lie inside the viewport.\n\t *\n\t * \t!readonly bounds: Bounds2;\n\t */\n\tbounds: null,\n\n\t/**\n\t * \tExtra padding for the viewport bounds. Used to extend the viewport bounds without altering the original viewport size nor the world bounds.\n\t */\n\tpadding: null,\n\n\t/**\n\t * \tBounds of the focus area of the viewport in world space. When the `focusRect` moves outside this area the viewport will be panned to keep it inside these bounds.\n\t * \n\t * \t!readonly focusBounds: Bounds2;\n\t */\n\tfocusBounds: null,\n\n\t/**\n\t * \tBounds of the viewport in screen space, used as target rendering area.\n\t *\n\t *\t!readonly screenBounds: Bounds2;\n\t */\n\tscreenBounds: null,\n\n\t/**\n\t * \tTemporal Point2 object used as temporary result for `toWorldSpace` and `toScreenSpace`.\n\t */\n\ttmpPoint: null,\n\n\t/**\n\t * \tConstructs the viewport with the specified size and container dimensions.\n\t *\n\t * \t@param sx - Screen position X.\n\t * \t@param sy - Screen position Y.\n\t * \t@param width - Viewport width.\n\t * \t@param height - Viewport height.\n\t * \t@param containerWidth - Container width.\n\t * \t@param containerHeight - Container height.\n\t *\n\t * \t!constructor (sx: number, sy: number, width: number, height: number, containerWidth: number, containerHeight: number);\n\t */\n\t__ctor: function (sx, sy, width, height, containerWidth, containerHeight)\n\t{\n\t\tthis.focusFactorX = 0.4;\n\t\tthis.focusFactorY = 0.4;\n\t\tthis.focusRect = null;\n\n\t\tthis.sx = sx;\n\t\tthis.sy = sy;\n\t\tthis.width = this.initialWidth = width;\n\t\tthis.height = this.initialHeight = height;\n\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\n\t\tthis.bounds = Bounds2.Pool.alloc();\n\t\tthis.padding = null;\n\n\t\tthis.focusBounds = Bounds2.Pool.alloc();\n\t\tthis.screenBounds = Bounds2.Pool.alloc();\n\t\tthis.container = Bounds2.Pool.alloc();\n\t\tthis.offset = Point2.Pool.alloc();\n\n\t\tthis.flags = Viewport.ENABLED;\n\t\tthis.tmpPoint = Point2.Pool.alloc();\n\n\t\tthis.setContainerBounds(-containerWidth>>1, -containerHeight>>1, containerWidth>>1, containerHeight>>1);\n\n\t\tthis.updateScreenBounds();\n\t\tthis.updateBounds();\n\t},\n\n\t/**\n\t * \tDestructs the viewport.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis.bounds.free();\n\t\tthis.focusBounds.free();\n\t\tthis.screenBounds.free();\n\t\tthis.container.free();\n\t\tthis.tmpPoint.free();\n\n\t\tif (this.padding !== null)\n\t\t\tthis.padding.free();\n\t},\n\n\t/**\n\t * \tReturns the value of the `enabled` flag.\n\t *\n\t * \t!enabled() : boolean;\n\t */\n\t/**\n\t * \tSets the `enabled` flag.\n\t *\n\t * \t!enabled (value: boolean) : Viewport;\n\t */\n\tenabled: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Viewport.ENABLED);\n\n\t\tthis.flags &= ~Viewport.ENABLED;\n\t\tif (value) this.flags |= Viewport.ENABLED;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the value of the `topLeft` flag.\n\t * \t!topLeft() : boolean;\n\t */\n\t/**\n\t * \tSets the `topLeft` flag.\n\t * \t!topLeft (value: boolean) : Viewport;\n\t */\n\ttopLeft: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Viewport.TOP_LEFT);\n\n\t\tthis.flags &= ~Viewport.TOP_LEFT;\n\t\tif (value) this.flags |= Viewport.TOP_LEFT;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the container bounds. Used to ensure the viewport bounds are never outside these limits.\n\t *\n\t * \t!setContainerBounds (x1: number, y1: number, x2: number, y2: number) : Viewport;\n\t */\n\t/**\n\t * \tSets the container bounds. Used to ensure the viewport bounds are never outside these limits.\n\t *\n\t * \t!setContainerBounds (v: Bounds2|Rect) : Viewport;\n\t */\n\tsetContainerBounds: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\ty2 = x1.y2;\n\t\t\tx2 = x1.x2;\n\t\t\ty1 = x1.y1;\n\t\t\tx1 = x1.x1;\n\t\t}\n\n\t\tthis.width = this.initialWidth;\n\t\tthis.height = this.initialHeight;\n\n\t\tif (this.width > x2-x1) this.width = x2-x1;\n\t\tif (this.height > y2-y1) this.height = y2-y1;\n\n\t\tthis.container.set(x1, y1, x2, y2);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the viewport padding.\n\t *\n\t * \t!setPadding (value: number) : Viewport;\n\t */\n\t/**\n\t * \tSets the padding of each side of the viewport (left, top, right and bottom).\n\t *\n\t * \t!setPadding (x1: number, y1: number, x2: number, y2: number) : Viewport;\n\t */\n\tsetPadding: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (this.padding === null)\n\t\t\tthis.padding = Bounds2.Pool.alloc();\n\n\t\tif (y1 === null)\n\t\t{\n\t\t\tx2 = y2 = x1;\n\t\t\tx1 = y1 = -x1;\n\t\t}\n\n\t\tthis.padding.set(x1, y1, x2, y2);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tUpdates the bound rect of the viewport.\n\t */\n\tupdateBounds: function (truncateToContainer=false)\n\t{\n\t\tlet w, h, ws, hs;\n\t\tlet x1, y1, x2, y2;\n\n\t\tw = this.width >> 1;\n\t\th = this.height >> 1;\n\n\t\tws = (w/this.scale);\n\t\ths = (h/this.scale);\n\n\t\tx1 = this.x-ws+this.offset.x;\n\t\ty1 = this.y-hs+this.offset.y;\n\t\tx2 = this.x+ws+this.offset.x;\n\t\ty2 = this.y+hs+this.offset.y;\n\n\t\tif (truncateToContainer)\n\t\t{\n\t\t\tif (x1 < this.container.x1)\n\t\t\t\tthis.offset.setX(this.container.x1 - this.x + ws);\n\t\t\telse if (x2 > this.container.x2)\n\t\t\t\tthis.offset.setX(this.container.x2 - this.x - ws);\n\n\t\t\tif (y1 < this.container.y1)\n\t\t\t\tthis.offset.setY(this.container.y1 - this.y + hs);\n\t\t\telse if (y2 > this.container.y2)\n\t\t\t\tthis.offset.setY(this.container.y2 - this.y - hs);\n\n\t\t\tx1 = this.x-ws+this.offset.x;\n\t\t\ty1 = this.y-hs+this.offset.y;\n\t\t\tx2 = this.x+ws+this.offset.x;\n\t\t\ty2 = this.y+hs+this.offset.y;\n\t\t}\n\n\t\tthis.bounds.set (x1, y1, x2, y2);\n\n\t\tif (this.padding !== null)\n\t\t\tthis.bounds.add (this.padding);\n\n\t\tthis.focusBounds.set (\n\t\t\tthis.x - (this.focusFactorX*w + this.centerRatioX*w)/this.scale, this.y - (this.focusFactorY*h + this.centerRatioY*h)/this.scale,\n\t\t\tthis.x + (this.focusFactorX*w + this.centerRatioX*w)/this.scale, this.y + (this.focusFactorY*h + this.centerRatioY*h)/this.scale\n\t\t);\n\t},\n\n\t/**\n\t * \tUpdates the screen bound rect of the viewport.\n\t */\n\tupdateScreenBounds: function ()\n\t{\n\t\tthis.screenBounds.set (this.sx, this.sy, this.sx + this.width, this.sy + this.height);\n\t},\n\n\t/**\n\t * \tResizes the viewport to the specified size.\n\t *\n\t * \t!resize (width: number|null, height: number|null) : Viewport;\n\t */\n\tresize: function (width, height)\n\t{\n\t\tthis.width = this.initialWidth = width ?? this.width;\n\t\tthis.height = this.initialHeight = height ?? this.height;\n\n\t\tthis.updateScreenBounds();\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResizes the viewport by the specified deltas.\n\t *\n\t * \t!resizeBy (dWidth: number, dHeight: number) : Viewport;\n\t */\n\tresizeBy: function (dWidth, dHeight)\n\t{\n\t\tthis.width += dWidth;\n\t\tthis.height += dHeight;\n\n\t\tthis.initialWidth = this.width;\n\t\tthis.initialHeight = this.height;\n\n\t\tthis.updateScreenBounds();\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the position of the viewport's center within the world and resets the relative offset to zero.\n\t * Setting any parameter to `null` will cause it not to be changed.\n\t * \n\t * !setPosition (x: number|null, y: number|null) : Viewport;\n\t */\n\tsetPosition: function (x, y)\n\t{\n\t\tthis.x = x ?? this.x;\n\t\tthis.y = y ?? this.y;\n\n\t\tthis.offset.set(0, 0);\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the position of the viewport relative to the current focus point.\n\t * \n\t * \t!setOffsets (dx: number, dy: number) : Viewport;\n\t */\n\tsetOffsets: function (dx, dy)\n\t{\n\t\tthis.offset.set(dx, dy);\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the scale of the viewport.\n\t * \n\t * \t!setScale (value: number) : Viewport;\n\t */\n\tsetScale: function (value)\n\t{\n\t\tthis.scale = value;\n\t\tthis.updateBounds();\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the scale of the viewport.\n\t * \n\t * \t!getScale () : number;\n\t */\n\tgetScale: function ()\n\t{\n\t\treturn this.scale;\n\t},\n\n\t/**\n\t * \tSets the global scale of the viewport.\n\t * \n\t * \t!setGlobalScale (value: number) : Viewport;\n\t */\n\tsetGlobalScale: function (value)\n\t{\n\t\tthis.globalScale = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the global scale of the viewport.\n\t * \n\t * \t!getGlobalScale () : number;\n\t */\n\tgetGlobalScale: function ()\n\t{\n\t\treturn this.globalScale;\n\t},\n\n\t/**\n\t * \tSets the center ratio of the viewport (values from -1 to 1, default is 0). Used to focus on a different point instead of the exact center.\n\t * \n\t * \t!setCenter (rx: number, ry: number) : Viewport;\n\t */\n\tsetCenter: function (rx, ry)\n\t{\n\t\tthis.centerRatioX = rx;\n\t\tthis.centerRatioY = ry;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMoves the viewport within the world. Values are relative to the current focus point.\n\t *\t@param truncateToContainer - When `true` the final viewport bounds will be ensured to not lie outside the container bounds.\n\t *\n\t * \t!translate (dx: number, dy: number, truncateToContainer?: boolean) : Viewport;\n\t */\n\ttranslate: function (dx, dy, truncateToContainer=false)\n\t{\n\t\tthis.offset.add(dx, dy);\n\n\t\tthis.updateBounds(truncateToContainer);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the screen position of the viewport.\n\t * \n\t * \t!setScreenPosition (sx: number, sy: number) : number;\n\t */\n\tsetScreenPosition: function (sx, sy)\n\t{\n\t\tthis.sx = sx;\n\t\tthis.sy = sy;\n\n\t\tthis.updateScreenBounds();\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the X coordinate of the viewport's focus point inside the world.\n\t * \t@param absolute - When `true`, the focus point X (without offset) will be returned.\n\t * \t\n\t * \t!getX (absolute?: boolean) : number;\n\t */\n\tgetX: function (absolute=false)\n\t{\n\t\treturn this.x + (absolute ? 0 : this.offset.x);\n\t},\n\n\t/**\n\t * \tReturns the Y coordinate of the viewport's focus point inside the world.\n\t * \t@param absolute - When `true`, the focus point Y (without offset) will be returned.\n\t * \t\n\t * \t!getY (absolute?: boolean) : number;\n\t */\n\tgetY: function (absolute=false)\n\t{\n\t\treturn this.y + (absolute ? 0 : this.offset.y);\n\t},\n\n\t/**\n\t * \tReturns the X position of the viewport inside the world relative to the current focus point.\n\t * \n\t * \t!getOffsetX() : void;\n\t */\n\tgetOffsetX: function ()\n\t{\n\t\treturn this.offset.x;\n\t},\n\n\t/**\n\t * \tReturns the Y position of the viewport inside the world relative to the current focus point.\n\t * \n\t * \t!getOffsetY() : void;\n\t */\n\tgetOffsetY: function ()\n\t{\n\t\treturn this.offset.y;\n\t},\n\n\t/**\n\t * \tReturns the width of the viewport.\n\t * \n\t * \t!getWidth() : number;\n\t */\n\tgetWidth: function ()\n\t{\n\t\treturn this.width;\n\t},\n\n\t/**\n\t * \tReturns the height of the viewport.\n\t * \n\t * \t!getHeight() : number;\n\t */\n\tgetHeight: function ()\n\t{\n\t\treturn this.height;\n\t},\n\n\t/**\n\t * \tMoves the viewport X coordinate to focus on the specified line or coordinate. Method `updateBounds` should be called afterwards.\n\t * \n\t * \t!focusX (x0: number, x1?: number, factor?: number) : Viewport;\n\t */\n\tfocusX: function (i0, i1=null, kx=null)\n\t{\n\t\tif (kx === null) kx = this.focusFactorX;\n\t\tif (i1 === null) i1 = i0;\n\n\t\tlet w = this.width >> 1;\n\n\t\tlet x1 = this.x - int((kx*w + this.centerRatioX*w)/this.scale);\n\t\tlet x2 = this.x + int((kx*w + this.centerRatioX*w)/this.scale);\n\n\t\tif (x1 == x2)\n\t\t\ti0 = i1 = (i0 + i1) >> 1;\n\n\t\tlet nx = this.x;\n\n\t\tif (i0 < x1) nx += (i0 - x1);\n\t\telse if (i1 > x2) nx += (i1 - x2);\n\n\t\tx1 = nx - w;\n\t\tx2 = nx + w;\n\n\t\tif (x1 < this.container.x1) nx = this.container.x1 + w;\n\t\tif (x2 > this.container.x2) nx = this.container.x2 - w;\n\n\t\tthis.x = nx;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMoves the viewport Y coordinate to focus on the specified line or coordinate. Method `updateBounds` should be called afterwards.\n\t * \n\t * \t!focusY (y0: number, y1?: number, factor?: number) : Viewport;\n\t */\n\tfocusY: function (j0, j1=null, ky=null)\n\t{\n\t\tif (ky === null) ky = this.focusFactorY;\n\t\tif (j1 === null) j1 = j0;\n\n\t\tlet h = this.height >> 1;\n\n\t\tlet y1 = this.y - int((ky*h + this.centerRatioY*h)/this.scale);\n\t\tlet y2 = this.y + int((ky*h + this.centerRatioY*h)/this.scale);\n\n\t\tif (y1 == y2)\n\t\t\tj0 = j1 = (j0 + j1) >> 1;\n\n\t\tlet ny = this.y;\n\n\t\tif (j0 < y1) ny += (j0 - y1);\n\t\telse if (j1 > y2) ny += (j1 - y2);\n\n\t\ty1 = ny - h;\n\t\ty2 = ny + h;\n\n\t\tif (y1 < this.container.y1) ny = this.container.y1 + h;\n\t\tif (y2 > this.container.y2) ny = this.container.y2 - h;\n\n\t\tthis.y = ny;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tUpdates the viewport to focus on the focusRect. Takes into account enabled axes.\n\t *\n\t * \t!update (dt?: number) : void;\n\t */\n\tupdate: function (dt=0)\n\t{\n\t\tif (this.focusRect === null)\n\t\t\treturn;\n\n\t\tif (this.focusAxisX)\n\t\t\tthis.focusX (this.focusRect.x1 + this.focusOffsX, this.focusRect.x2 + this.focusOffsX);\n\n\t\tif (this.focusAxisY)\n\t\t\tthis.focusY (this.focusRect.y1 + this.focusOffsY, this.focusRect.y2 + this.focusOffsY);\n\n\t\tthis.updateBounds();\n\t},\n\n\t/**\n\t * \tUpdates the viewport to focus on the focusRect ignoring the enabled axes.\n\t *\n\t * \t!updateForced (dt?: number) : void;\n\t */\n\tupdateForced: function (dt=0)\n\t{\n\t\tif (this.focusRect === null)\n\t\t\treturn;\n\n\t\tthis.focusX (this.focusRect.x1 + this.focusOffsX, this.focusRect.x2 + this.focusOffsX);\n\t\tthis.focusY (this.focusRect.y1 + this.focusOffsY, this.focusRect.y2 + this.focusOffsY);\n\n\t\tthis.updateBounds();\n\t},\n\n\t/**\n\t * \tTracks a specified rectangle by maintaining focus on it (a call to `update` must be made on every frame update).\n\t * \n\t * \t!setFocusRect (rect: Rect|Bounds2, offsX?: number, offsY? :number) : Viewport;\n\t */\n\tsetFocusRect: function (rect, offsX=0, offsY=0)\n\t{\n\t\tthis.focusRect = rect;\n\n\t\tthis.focusOffsX = offsX;\n\t\tthis.focusOffsY = offsY;\n\n\t\tthis.update(0);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the focus offsets of the viewport. Used to translate the viewport without altering the focus point.\n\t *\n\t * \t!setFocusOffsets (offsX: number, offsY: number) : Viewport;\n\t */\n\tsetFocusOffsets: function (offsX, offsY)\n\t{\n\t\tthis.focusOffsX = offsX;\n\t\tthis.focusOffsY = offsY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the enabled flag of the focus axes. Only enabled axes will be updated when calling `update`.\n\t * \n\t * \t!setFocusAxes (enabledX: boolean, enabledY: boolean) : Viewport;\n\t */\n\tsetFocusAxes: function (enabledX, enabledY)\n\t{\n\t\tthis.focusAxisX = enabledX;\n\t\tthis.focusAxisY = enabledY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the focus factor of the viewport (value from 0 to 1), that is, the ratio of the smaller focus viewport.\n\t * \n\t * \t!setFocusFactor (valueX: number, valueY: number) : Viewport;\n\t */\n\tsetFocusFactor: function (valueX, valueY)\n\t{\n\t\tthis.focusFactorX = valueX;\n\t\tthis.focusFactorY = valueY === undefined ? valueX : valueY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tApplies the viewport clipping area to the specified canvas.\n\t * \n\t * \t!applyClip (g: Canvas) : void;\n\t */\n\tapplyClip: function (g)\n\t{\n\t\tg.clip(this.screenBounds.x1, this.screenBounds.y1, this.screenBounds.width(), this.screenBounds.height());\n\t},\n\n\t/**\n\t * \tApplies the viewport transform to the specified canvas.\n\t * \n\t * \t!applyTransform (g: Canvas) : void;\n\t */\n\tapplyTransform: function (g)\n\t{\n\t\tif (!(this.flags & Viewport.TOP_LEFT))\n\t\t\tg.translate (this.screenBounds.cx, this.screenBounds.cy);\n\t\telse\n\t\t\tg.translate (this.screenBounds.x1, this.screenBounds.y1);\n\n\t\tif (this.scale != 1.0)\n\t\t\tg.scale (this.scale, this.scale);\n\n\t\tif (this.globalScale != 1.0)\n\t\t\tg.scale (this.globalScale, this.globalScale);\n\n\t\tif (!(this.flags & Viewport.TOP_LEFT))\n\t\t\tg.translate (-this.bounds.cx, -this.bounds.cy);\n\t\telse\n\t\t\tg.translate (-this.bounds.x1, -this.bounds.y1);\n\n\t\tg.updateTransform();\n\t},\n\n\t/**\n\t * \tConverts a point from screen-space to world-space.\n\t * \t@returns Temporal Point2 object.\n\t *\n\t * \t!toWorldSpace (input: Point2|Vec2|{x:number,y:number}, floor?: boolean) : Point2;\n\t */\n\t/**\n\t * \tConverts a point from screen-space to world-space.\n\t * \t@returns Temporal Point2 object.\n\t *\n\t * \t!toWorldSpace (x: number, y: number, floor?: boolean) : Point2;\n\t */\n\ttoWorldSpace: function (x, y=null, floor=false)\n\t{\n\t\tif (y === null || y === true)\n\t\t{\n\t\t\tfloor = y === true;\n\t\t\ty = x.y;\n\t\t\tx = x.x;\n\t\t}\n\n\t\tlet refX, refY;\n\n\t\tif (!(this.flags & Viewport.TOP_LEFT))\n\t\t{\n\t\t\trefX = this.screenBounds.cx;\n\t\t\trefY = this.screenBounds.cy;\n\n\t\t\tif (floor) {\n\t\t\t\tx = ((x - int(refX)) / this.scale) + int(this.bounds.cx);\n\t\t\t\ty = ((y - int(refY)) / this.scale) + int(this.bounds.cy);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tx = ((x - refX) / this.scale) + this.bounds.cx;\n\t\t\t\ty = ((y - refY) / this.scale) + this.bounds.cy;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\trefX = this.screenBounds.x1;\n\t\t\trefY = this.screenBounds.y1;\n\n\t\t\tif (floor) {\n\t\t\t\tx = ((x - int(refX)) / this.scale) + int(this.bounds.x1);\n\t\t\t\ty = ((y - int(refY)) / this.scale) + int(this.bounds.y1);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tx = ((x - refX) / this.scale) + this.bounds.x1;\n\t\t\t\ty = ((y - refY) / this.scale) + this.bounds.y1;\n\t\t\t}\n\t\t}\n\n\t\treturn this.tmpPoint.set(x, y);\n\t},\n\n\t/**\n\t * \tConverts a point from world-space to screen-space.\n\t * \t@returns Temporal Point2 object.\n\t *\n\t * \t!toScreenSpace (input: Point2|Vec2|{x:number,y:number}, floor?: boolean) : Point2;\n\t */\n\t/**\n\t * \tConverts a point from world-space to screen-space.\n\t * \t@returns Temporal Point2 object.\n\t *\n\t * \t!toScreenSpace (x: number, y: number, floor?: boolean) : Point2;\n\t */\n\ttoScreenSpace: function (x, y=null, floor=false)\n\t{\n\t\tif (y === null || y === true)\n\t\t{\n\t\t\tfloor = y === true;\n\t\t\ty = x.y;\n\t\t\tx = x.x;\n\t\t}\n\n\t\tlet refX, refY;\n\n\t\tif (!(this.flags & Viewport.TOP_LEFT))\n\t\t{\n\t\t\trefX = this.screenBounds.cx;\n\t\t\trefY = this.screenBounds.cy;\n\n\t\t\tif (floor) {\n\t\t\t\tx = (x - int(this.bounds.cx)) * this.scale + int(refX);\n\t\t\t\ty = (y - int(this.bounds.cy)) * this.scale + int(refY);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tx = (x - this.bounds.cx) * this.scale + refX;\n\t\t\t\ty = (y - this.bounds.cy) * this.scale + refY;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\trefX = this.screenBounds.x1;\n\t\t\trefY = this.screenBounds.y1;\n\n\t\t\tif (floor) {\n\t\t\t\tx = (x - int(this.bounds.x1)) * this.scale + int(refX);\n\t\t\t\ty = (y - int(this.bounds.y1)) * this.scale + int(refY);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tx = (x - this.bounds.x1) * this.scale + refX;\n\t\t\t\ty = (y - this.bounds.y1) * this.scale + refY;\n\t\t\t}\n\t\t}\n\n\t\treturn this.tmpPoint.set(x, y);\n\t}\n});\n\n/*\n**\tConstants.\n*/\nViewport.ENABLED = 0x001;\nViewport.TOP_LEFT = 0x002;\n\nexport default Viewport;\n","\nimport GridElement from './grid-element.js';\nimport G from '../system/globals.js';\nimport Recycler from '../utils/recycler.js';\nimport System from '../system/system.js';\nimport Canvas from '../system/canvas.js';\nimport ShaderProgram from '../system/shader-program.js';\n\n//![import \"./grid-element\"]\n//![import \"../system/globals\"]\n//![import \"../utils/recycler\"]\n//![import \"../system/system\"]\n//![import \"../system/canvas\"]\n//![import \"../system/shader-program\"]\n\n//:/**\n//: * Describes an element that can be rendered to the screen.\n//: */\n\n//!class Element extends GridElement\n\nconst Element = GridElement.extend\n({\n\tclassName: 'Element',\n\n\t/**\n\t * Parent group to whom this element is related.\n\t * !group: Group;\n\t */\n\tgroup: null,\n\n\t/**\n\t * Drawable object to render to the display.\n\t * !img: Drawable;\n\t */\n\timg: null,\n\n\t/**\n\t * Indicates if the bounds of the element should be drawn (for debugging purposes). You can set it to a boolean or to a number from 1 to 7 to\n\t * draw the bounds with a different predefined color.\n\t * !debugBounds: boolean|number;\n\t */\n\tdebugBounds: false,\n\n\t/**\n\t * Basic depth (z-value) of the element (used for depth micro-adjustments).\n\t */\n\t_zvalue: 0,\n\n\t/**\n\t * Actual depth (z-value) of the element, calculated by the container.\n\t */\n\t__zvalue: 0,\n\n\t/**\n\t * Alpha value of the element.\n\t */\n\t_alpha: 1.0,\n\n\t/**\n\t * Element shader program.\n\t */\n\t_shaderProgram: null,\n\n\t/**\n\t * Function used to set the uniforms of the shader.\n\t */\n\t_uniformSetter: null,\n\n\t/**\n\t * Function used to render the element. Called by `draw` after rendering configuration has been set.\n\t * @type {(g:Canvas, elem:Element, img:Drawable) => void}\n\t */\n\trender: null,\n\n\t/**\n\t * Constructs a drawable element at the specified position with the given drawable.\n\t * !constructor (x: number, y: number, width: number, height: number, img?: Drawable);\n\t */\n\t/**\n\t * Constructs a drawable element at the specified position with the given drawable.\n\t * !constructor (x: number, y: number, img?: Drawable);\n\t */\n\t__ctor: function(x, y, width=null, height=null, img=null)\n\t{\n\t\tif (width === null)\n\t\t\twidth = height = 0;\n\n\t\tif (height === null)\n\t\t{\n\t\t\timg = width;\n\t\t\twidth = img.width;\n\t\t\theight = img.height;\n\t\t}\n\n\t\tthis._super.GridElement.__ctor(x, y, width, height);\n\t\tthis.img = img !== null ? img.getDrawable() : img;\n\n\t\tthis.group = null;\n\t\tthis.debugBounds = false;\n\n\t\tthis._zvalue = 0;\n\t\tthis.__zvalue = 0;\n\t\tthis._alpha = 1.0;\n\n\t\tthis._shaderProgram = null;\n\t\tthis._uniformSetter = null;\n\n\t\tthis.render = null;\n\t},\n\n\t/**\n\t * Destroys the element.\n\t */\n\t__dtor: function()\n\t{\n\t\tif (this.img !== null)\n\t\t{\n\t\t\tdispose(this.img);\n\t\t\tthis.img = null;\n\t\t}\n\n\t\tthis._super.GridElement.__dtor();\n\t},\n\n\t/**\n\t * Destroys the element later by adding it to the scene's destruction queue. If the element has no container, it will be destroyed immediately.\n\t * !destroyLater() : void;\n\t */\n\tdestroyLater: function()\n\t{\n\t\tif (this.alive() === false) return;\n\n\t\tif (this.container !== null)\n\t\t\tthis.container.scene.disposeLater(this);\n\t\telse\n\t\t\tdispose(this);\n\t},\n\n\t/**\n\t * Returns the `debugBounds` of the element.\n\t * @returns {number}\n\t * !debug () : number;\n\t */\n\t/**\n\t * Sets the `debugBounds` of the element.\n\t * @param {boolean|number} value\n\t * @returns {Element}\n\t * !debug (value: number) : Element;\n\t */\n\tdebug: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this.debugBounds;\n\n\t\tthis.debugBounds = value === 0 ? true : value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the `root` of the element, that is, the top-most element in the hierarchy.\n\t * !root () : Element;\n\t */\n\troot: function ()\n\t{\n\t\tlet root = this;\n\n\t\twhile (root.group !== null)\n\t\t\troot = root.group;\n\n\t\treturn root;\n\t},\n\n\t/**\n\t * Returns the alpha value of the element.\n\t * @returns {number}\n\t * !alpha () : number;\n\t */\n\t/**\n\t * Sets the alpha value of the element.\n\t * @param {number} value\n\t * @returns {Element}\n\t * !alpha (value: number) : Element;\n\t */\n\talpha: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._alpha;\n\n\t\tthis._alpha = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the zvalue of the element.\n\t * @returns {number}\n\t * !zvalue () : number;\n\t */\n\t/**\n\t * Sets the zvalue of the element.\n\t * @param {number} value\n\t * @returns {Element}\n\t * !zvalue (value: number) : Element;\n\t */\n\tzvalue: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._zvalue;\n\n\t\tthis._zvalue = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the shader program of the element.\n\t * @returns {ShaderProgram}\n\t * !shaderProgram () : ShaderProgram;\n\t */\n\t/**\n\t * Sets the shader program of the element.\n\t * @param {ShaderProgram} shaderProgram\n\t * @returns {Element}\n\t * !shaderProgram (shaderProgram: ShaderProgram|string) : Element;\n\t */\n\tshaderProgram: function (shaderProgram=false)\n\t{\n\t\tif (shaderProgram === false)\n\t\t\treturn this._shaderProgram;\n\n\t\tif (typeof(shaderProgram) === 'string')\n\t\t\tshaderProgram = ShaderProgram.get(shaderProgram);\n\n\t\tthis._shaderProgram = shaderProgram;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the uniform setter function.\n\t * @param { (pgm:ShaderProgram, elem:Element, gl:WebGLRenderingContext) => void } uniformSetter\n\t * @returns {Element}\n\t * !uniformSetter (uniformSetter: (pgm:ShaderProgram, elem:Element, gl:WebGLRenderingContext) => void) : Element;\n\t */\n\tuniformSetter: function (uniformSetter)\n\t{\n\t\tthis._uniformSetter = uniformSetter;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Draws the element on the specified canvas.\n\t * @param {Canvas} g\n\t */\n\tdraw: function(g)\n\t{\n\t\tif (this._alpha <= 0.0)\n\t\t\treturn;\n\n\t\t// TODO: Figure if there's a way to reduce the number of conditions here.\n\t\tif (this.img !== null || this.render !== null)\n\t\t{\n\t\t\tif (this._alpha !== 1.0)\n\t\t\t{\n\t\t\t\tg.pushAlpha();\n\t\t\t\tg.alpha(this._alpha);\n\t\t\t}\n\n\t\t\tlet shaderChanged = this._shaderProgram !== null ? g.pushShaderProgram(this._shaderProgram) : false;\n\t\t\tlet depthFlagChanged = this.depthFlagEnabled() ? g.pushDepthFlag(this.depthFlag()) : false;\n\n\t\t\tif (this._shaderProgram !== null && this._uniformSetter !== null && g.gl !== null)\n\t\t\t\tthis._uniformSetter (g.getShaderProgram(), this, g.gl);\n\n\t\t\tg.zvalue = this.__zvalue;\n\n\t\t\tif (this.render !== null)\n\t\t\t\tthis.render(g, this, this.img);\n\t\t\telse\n\t\t\t\tthis.img.render(g, this);\n\n\t\t\tif (depthFlagChanged === true) g.popDepthFlag();\n\t\t\tif (shaderChanged === true) g.popShaderProgram();\n\n\t\t\tif (this._alpha !== 1.0)\n\t\t\t\tg.popAlpha();\n\t\t}\n\n\t\t// TODO: See if this code can be removed or improved because it takes quite a bit to check the condition.\n\t\t/* *********** */\n\t\tif (G.debugBounds === true || (this.debugBounds === true || this.debugBounds > 0))\n\t\t{\n\t\t\tlet m = g.getMatrix();\n\t\t\tg = System.displayBuffer2;\n\t\n\t\t\tg.pushMatrix();\n\t\t\tg.loadMatrix(m);\n\t\t\tg.fillStyle(Element.getDebugColor(this.debugBounds));\n\t\t\tg.fillRect(this.bounds.x1, this.bounds.y1, this.bounds.width(), this.bounds.height());\n\t\t\tg.popMatrix();\n\t\t}\n\t},\n\n\t/**\n\t * Changes the function used to render the element.\n\t * @param { (g:Canvas, elem:Element, img:Drawable) => void } renderFunction\n\t * @returns {Element}\n\t */\n\trenderWith: function (renderFunction)\n\t{\n\t\tthis.render = renderFunction ?? null;\n\t\treturn this;\n\t}\n});\n\n/**\n * Colors for the bounds debugging.\n * !static debugColors : Array<string>;\n */\nElement.debugColors = [\n\t'rgba(0,255,255,0.35)', // Cyan\n\t'rgba(255,255,0,0.35)', // Yellow\n\t'rgba(255,0,255,0.35)', // Magenta\n\t'rgba(255,255,255,0.35)', // White\n\t'rgba(255,0,0,0.35)', // Red\n\t'rgba(0,255,0,0.35)', // Green\n\t'rgba(0,0,255,0.35)', // Blue\n\t'rgba(128,128,128,0.35)' // Gray\n];\n\n/**\n * Returns an RGBA color for the given `debugBounds` value.\n * !static getDebugColor (debugBounds: boolean|number) : string;\n */\nElement.getDebugColor = function (debugBounds)\n{\n\tif (debugBounds === true || debugBounds === false)\n\t\tdebugBounds = 0;\n\n\treturn Element.debugColors[(~~debugBounds) & 7];\n};\n\n//!/class\n\n//!namespace Element\n//!namespace Pool\n\n\t/**\n\t * Allocates a drawable element at the specified position with the given drawable.\n\t * !function alloc (x: number, y: number, width: number, height: number, img?: Drawable) : Element;\n\t */\n\t/**\n\t * Allocates a drawable element at the specified position with the given drawable.\n\t * !function alloc (x: number, y: number, img?: Drawable) : Element;\n\t */\n\nRecycler.createPool(Element);\nexport default Element;\n","\nimport Element from './element.js';\nimport List from '../utils/list.js';\nimport Point2 from '../math/point2.js';\nimport Recycler from '../utils/recycler.js';\nimport GridElement from './grid-element.js';\n\n//![import \"./element\"]\n//![import \"../utils/list\"]\n//![import \"../math/point2\"]\n//![import \"../utils/recycler\"]\n\nconst tempPoint = Point2.Pool.alloc();\n\n//:/**\n//: * Groups one or more elements into a single one.\n//: */\n\n//!class Group extends Element\n\nconst Group = Element.extend\n({\n\tclassName: 'Group',\n\n\t/**\n\t * List of elements in the group.\n\t * !readonly children: List;\n\t */\n\tchildren: null,\n\n\t/**\n\t * Virtual zero reference point.\n\t * !readonly ref: Point2;\n\t */\n\tref: null,\n\n\t/**\n\t * Constructs an empty Group element.\n\t * !constructor (id?: string);\n\t */\n\t__ctor: function (id=null)\n\t{\n\t\tthis._super.Element.__ctor(0, 0, 0, 0);\n\n\t\tthis.children = List.Pool.alloc();\n\t\tthis.bounds.reset();\n\n\t\tthis.ref = Point2.Pool.alloc();\n\t\tthis.setId(id);\n\t},\n\n\t/**\n\t * Destroys the group and all children.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis.children.free();\n\t\tthis.ref.free();\n\n\t\tthis._super.Element.__dtor();\n\t},\n\n\t/**\n\t * Adds the group itself and all children to the scene's destruction queue. If any element has no container, it will be destroyed immediately.\n\t * !destroyLater() : void;\n\t */\n\tdestroyLater: function()\n\t{\n\t\tif (this.alive() === false) return;\n\n\t\tlet i;\n\n\t\twhile ((i = this.children.shift()) != null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.group = null;\n\t\t\ti.destroyLater();\n\t\t}\n\n\t\tthis._super.Element.destroyLater();\n\t},\n\n\t/**\n\t * Removes and destroys all child elements.\n\t * !clear() : Group;\n\t */\n\tclear: function()\n\t{\n\t\tlet i;\n\n\t\twhile ((i = this.children.shift()) != null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.group = null;\n\t\t\tdispose(i);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Removes all child elements but does not destroy them.\n\t * !reset() : Group;\n\t */\n\treset: function()\n\t{\n\t\tlet i;\n\n\t\twhile ((i = this.children.shift()) != null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.group = null;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the wrapExtents flag of the group.\n\t * @returns {boolean}\n\t * !wrapExtents () : boolean;\n\t */\n\t/**\n\t * Sets the wrapExtents flag of the group.\n\t * @param {boolean} value\n\t * @returns {Group}\n\t * !wrapExtents (value: boolean) : Group;\n\t */\n\twrapExtents: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.WRAP_EXTENTS);\n\n\t\tthis.flags &= ~GridElement.WRAP_EXTENTS;\n\t\tif (value === true) this.flags |= GridElement.WRAP_EXTENTS;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Adds a child element to the group. If the element has its `id` property set, it will be added to the group as a\n\t * property, which can be accessed directly using the element identifier or using the `getChild` method.\n\t * !addChild (elem: Element) : Element;\n\t */\n\taddChild: function (elem, relative=false)\n\t{\n\t\tif (elem === null) return null;\n\n\t\tlet initial = this.bounds.x1 === null;\n\n\t\tif (initial === true || (this.flags & GridElement.WRAP_EXTENTS) !== 0)\n\t\t{\n\t\t\tif (initial === true || elem.bounds.x1 < this.bounds.x1) this.ltranslate(elem.bounds.x1 - this.bounds.x1, 0);\n\t\t\tif (initial === true || elem.bounds.y1 < this.bounds.y1) this.ltranslate(0, elem.bounds.y1 - this.bounds.y1);\n\t\t\tif (initial === true || elem.bounds.x2 > this.bounds.x2) this.resizeBy(elem.bounds.x2 - this.bounds.x2, 0);\n\t\t\tif (initial === true || elem.bounds.y2 > this.bounds.y2) this.resizeBy(0, elem.bounds.y2 - this.bounds.y2);\n\t\t}\n\n\t\tthis.children.push(elem);\n\n\t\tif (elem.id !== null)\n\t\t\tthis[elem.id] = elem;\n\n\t\tif (relative === true)\n\t\t\telem.translate(this.bounds.x1, this.bounds.y1);\n\n\t\telem.group = this;\n\t\telem.remover.add(this._remove, this, this.children.bottom);\n\n\t\treturn elem;\n\t},\n\n\t/**\n\t * Return the child element matching the specified identifier.\n\t * !child (id: string) : Element;\n\t */\n\tgetChild: function (id)\n\t{\n\t\treturn this[id] || null;\n\t},\n\n\t/**\n\t * Callback to remove an element from the container (called by Handler).\n\t */\n\t_remove: function (elem, self, node)\n\t{\n\t\tself.children.remove(node);\n\t\telem.group = null;\n\n\t\tif (elem.id !== null)\n\t\t\tself[elem.id] = null;\n\n\t\treturn false;\n\t},\n\n\t/**\n\t * Removes an element from the container and returns it.\n\t * !removeChild (elem: Element) : Element;\n\t */\n\tremoveChild: function (elem)\n\t{\n\t\tif (elem === null || elem.group !== this)\n\t\t\treturn elem;\n\n\t\telem.remover.execf(this._remove, this);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * Syncs the actual location of the specified element with its storage location. Returns `true` if successful.\n\t */\n\tsync: function()\n\t{\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.sync();\n\n\t\treturn this._super.Element.sync();\n\t},\n\n\t/**\n\t * Local group translation, moves only the group by the specified deltas. Child elements remain in position.\n\t * @param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * !ltranslate (dx: number, dy: number, upscaled?: boolean) : Group;\n\t */\n\tltranslate: function (dx, dy, upscaled=false)\n\t{\n\t\treturn this._super.Element.translate(dx, dy, upscaled);\n\t},\n\n\t/**\n\t * Moves the group and all children by the specified deltas.\n\t * @param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * !translate (dx: number, dy: number, upscaled?: boolean) : Group;\n\t */\n\ttranslate: function (dx, dy, upscaled=false)\n\t{\n\t\tlet _dx = this.bounds.x1;\n\t\tlet _dy = this.bounds.y1;\n\n\t\tthis._super.Element.translate(dx, dy, upscaled);\n\t\tthis.ref.add(dx, dy, upscaled);\n\n\t\t_dx = this.bounds.x1 - _dx;\n\t\t_dy = this.bounds.y1 - _dy;\n\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.translate(_dx, _dy);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns a temporal Point2, describing the extra offset introduced by the group when translating a child element by the specified deltas.\n\t * @param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * !getOffsets (dx: number, dy: number, upscaled?: boolean) : Point2;\n\t */\n\tgetOffsets: function (dx, dy, upscaled=false)\n\t{\n\t\ttempPoint.set(this.bounds.ux1, this.bounds.uy1, true);\n\n\t\tlet _dx = tempPoint.x;\n\t\tlet _dy = tempPoint.y;\n\n\t\ttempPoint.add(dx, dy, upscaled);\n\n\t\t_dx = tempPoint.x - _dx;\n\t\t_dy = tempPoint.y - _dy;\n\n\t\ttempPoint.set(_dx, _dy);\n\n\t\ttempPoint.x -= dx;\n\t\ttempPoint.y -= dy;\n\n\t\treturn tempPoint;\n\t},\n\n\t/**\n\t * Sets bits of the element flags in the group and all children.\n\t * !setFlags (value: number) : Group;\n\t */\n\tsetFlags: function (value)\n\t{\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.setFlags(value);\n\n\t\treturn this._super.Element.setFlags(value);\n\t},\n\n\t/**\n\t * Clears bits from the group and all children flags.\n\t * !clearFlags (value: number) : Group;\n\t */\n\tclearFlags: function (value)\n\t{\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.clearFlags(value);\n\n\t\treturn this._super.Element.clearFlags(value);\n\t},\n\n\t/**\n\t * Sets the visible flag of the group and all children.\n\t * @param {boolean} value - New visibility value.\n\t * @param {boolean} forced - When `true` forces to ignore the VISIBLE_LOCK flag.\n\t * !visible (value: boolean, forced?: boolean|false) : GridElement;\n\t */\n\t/**\n\t * Returns the visible flag.\n\t * !visible() : boolean;\n\t */\n\tvisible: function (value=null, forced=false)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._super.Element.visible();\n\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.visible(value, forced);\n\n\t\treturn this._super.Element.visible(value, forced);\n\t},\n\n\t/**\n\t * Returns the alpha value of the group.\n\t * @returns {number}\n\t * !alpha () : number;\n\t */\n\t/**\n\t * Sets the alpha value of the group and all children.\n\t * @param {number} value\n\t * @returns {Element}\n\t * !alpha (value: number) : Element;\n\t */\n\talpha: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._super.Element.alpha();\n\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.alpha(value);\n\n\t\treturn this._super.Element.alpha(value);\n\t}\n});\n\n//!/class\n\n//!namespace Group\n//!namespace Pool\n\n\t/**\n\t * Allocates an empty Group element.\n\t * !function alloc (id?: string) : Group;\n\t */\n\nRecycler.createPool(Group);\nexport default Group;\n","\nimport { Class } from 'rinn';\nimport Container from './container.js';\nimport Viewport from './viewport.js';\nimport Group from './group.js';\nimport Bounds2 from '../math/bounds2.js';\nimport List from '../utils/list.js';\nimport Handler from '../utils/handler.js';\nimport globals from '../system/globals.js';\nimport Log from '../system/log.js';\n\n//![import \"./container\"]\n//![import \"./viewport\"]\n//![import \"./group\"]\n//![import \"../math/bounds2\"]\n//![import \"../utils/list\"]\n//![import \"../utils/handler\"]\n//![import \"../system/globals\"]\n\n//:/**\n//: * \tA scene is a set of containers, viewports and groups. Rendering is done in their specific index-based order.\n//: */\n\n//!class Scene\n\nconst Scene = Class.extend\n({\n\tclassName: 'Scene',\n\n\t/**\n\t * Minimum dimensions of the scene (smallest container size).\n\t * !readonly minWidth: number;\n\t * !readonly minHeight: number;\n\t */\n\tminWidth: null,\n\tminHeight: null,\n\n\t/**\n\t * Maximum dimensions of the scene (largest container size).\n\t * !readonly maxWidth: number;\n\t * !readonly maxHeight: number;\n\t */\n\tmaxWidth: null,\n\tmaxHeight: null,\n\n\t/**\n\t * List of containers.\n\t */\n\tcontainers: null,\n\n\t/**\n\t * List of viewports.\n\t */\n\tviewports: null,\n\n\t/**\n\t * Active viewport bounds, used to select items in a visible region.\n\t * !readonly viewportBounds: Bounds2;\n\t */\n\tviewportBounds: null,\n\n\t/**\n\t * List of Group elements.\n\t */\n\tgroupList: null,\n\n\t/**\n\t * Named Group elements.\n\t */\n\tgroups: null,\n\n\t/**\n\t * Disposal queue.\n\t */\n\tdisposalQueue: null,\n\n\t/**\n\t * First updater. Runs before any other update calls.\n\t * !readonly fupdater: Handler;\n\t */\n\tfupdater: null,\n\n\t/**\n\t * General updater. Runs after the first updater and before synchronizer.\n\t * !readonly updater: Handler;\n\t */\n\tupdater: null,\n\n\t/**\n\t * Synchronizer. Run after general updater, and before viewport synchronization.\n\t * !readonly synchronizer: Handler;\n\t */\n\tsynchronizer: null,\n\n\t/**\n\t * Last updater. Runs after all other update calls.\n\t * !readonly lupdater: Handler;\n\t */\n\tlupdater: null,\n\n\t/**\n\t * Destroyer runs when the scene is destroyed.\n\t * !readonly destroyer: Handler;\n\t */\n\tdestroyer: null,\n\n\t/**\n\t * Current delta time. Set upon entering the `update` method. Reflects the same value as System.frameDelta.\n\t * !readonly dt: number;\n\t */\n\tdt: 0,\n\n\t/**\n\t * Flags of the object (see constants at the bottom of this file).\n\t */\n\tflags: 0,\n\n\t/**\n\t * Total number of elements drawn on the last draw operation.\n\t * !readonly drawCount: number;\n\t */\n\tdrawCount: 0,\n\n\t/**\n\t * Scene object pointing to itself.\n\t */\n\tscene: null,\n\n\t/**\n\t * Base depth (z-value) of the scene.\n\t * !readonly zvalue: number;\n\t */\n\tzvalue: null,\n\n\t/**\n\t * Name of the layer.\n\t * !readonly name: string;\n\t */\n\tname: null,\n\n\t/**\n\t * Constructs an empty scene with the specified index.\n\t * @param index - Index for the scene. Used to calculate the base z-value of the scene. Valid range is from 0 to 3.\n\t * @param name - Name of the scene, used for debugging purposes. If none provided SCENE_X will be used where X is the scene's index.\n\t * !constructor (index: number, name?: string);\n\t */\n\t__ctor: function (index, name=null)\n\t{\n\t\tthis.containers = [];\n\n\t\t/**\n\t\t * \tZ-value is a 24-bit value constructed as:\n\t\t *\t\t2-bits: Scene Index\n\t\t *\t\t4-bits: Container Index\n\t\t *\t\t18-bits: Element z-value\n\t\t */\n\t\tthis.zvalue = (index & 3) << (18+4);\n\t\tthis.name = name !== null ? name : (\"SCENE_\" + index);\n\n\t\tthis.viewports = [];\n\t\tthis.viewportBounds = Bounds2.Pool.alloc();\n\n\t\tthis.groupList = List.Pool.alloc();\n\t\tthis.groups = { };\n\n\t\tthis.disposalQueue = List.Pool.alloc();\n\n\t\tthis.fupdater = Handler.Pool.alloc(this);\n\t\tthis.updater = Handler.Pool.alloc(this);\n\t\tthis.synchronizer = Handler.Pool.alloc(this);\n\t\tthis.lupdater = Handler.Pool.alloc(this);\n\t\tthis.destroyer = Handler.Pool.alloc(this);\n\n\t\tthis.flags = Scene.VISIBLE;\n\t\tthis.scene = this;\n\t},\n\n\t/**\n\t * Destroys the instance along with all containers, viewports and groups.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.disposeQueued();\n\t\tthis.disposalQueue.free();\n\n\t\tthis.destroyer.exec();\n\t\tthis.destroyer.free();\n\n\t\tthis.fupdater.free();\n\t\tthis.updater.free();\n\t\tthis.synchronizer.free();\n\t\tthis.lupdater.free();\n\n\t\tlet i;\n\n\t\twhile ((i = this.groupList.shift()) !== null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.container = null;\n\t\t\tdispose(i);\n\t\t}\n\n\t\tfor (i = 0; i < this.containers.length; i++)\n\t\t{\n\t\t\tif (!this.containers[i]) continue;\n\n\t\t\tthis.containers[i].scene = null;\n\t\t\tdispose(this.containers[i]);\n\n\t\t\tthis.containers[i] = null;\n\t\t}\n\n\t\tfor (i = 0; i < this.viewports.length; i++)\n\t\t{\n\t\t\tif (!this.viewports[i]) continue;\n\n\t\t\tdispose(this.viewports[i]);\n\t\t\tthis.viewports[i] = null;\n\t\t}\n\n\t\tthis.viewportBounds.free();\n\t\tthis.groupList.free();\n\t},\n\n\t/**\n\t * Clears the scene by removing all groups and clearing the containers, leaving only viewports alive.\n\t * !clear() : void;\n\t */\n\tclear: function()\n\t{\n\t\tthis.disposeQueued();\n\n\t\tlet i;\n\n\t\twhile ((i = this.groupList.shift()) !== null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.container = null;\n\t\t\tdispose(i);\n\t\t}\n\n\t\tfor (i = 0; i < this.containers.length; i++)\n\t\t{\n\t\t\tif (this.containers[i])\n\t\t\t\tthis.containers[i].clear();\n\t\t}\n\t},\n\n\t/**\n\t * Returns the value of the `visible` flag.\n\t * !visible() : boolean;\n\t */\n\t/**\n\t * Sets the value of the `visible` flag.\n\t * !visible(value: boolean) : Container;\n\t */\n\tvisible: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Scene.VISIBLE);\n\n\t\tthis.flags &= ~Scene.VISIBLE;\n\t\tif (value) this.flags |= Scene.VISIBLE;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets a container at the specified index.\n\t * @param index - Index of the container, valid range is from 0 to 15.\n\t * !setContainer (index: number, container: Container) : Scene;\n\t */\n\tsetContainer: function (index, container)\n\t{\n\t\tif (index < 0) return this;\n\t\tindex &= 15;\n\n\t\tif (container === null)\n\t\t{\n\t\t\tthis.containers[index].scene = null;\n\t\t\tthis.containers[index] = null;\n\t\t\treturn this;\n\t\t}\n\n\t\tif (!Container.isInstance(container))\n\t\t\tthrow new Error('Scene: Unable to set container at index ' + index + ': argument is not a Container');\n\n\t\tif (this.minWidth === null || container.width < this.minWidth) this.minWidth = container.width;\n\t\tif (this.minHeight === null || container.height < this.minHeight) this.minHeight = container.height;\n\t\tif (this.maxWidth === null || container.width > this.maxWidth) this.maxWidth = container.width;\n\t\tif (this.maxHeight === null || container.height > this.maxHeight) this.maxHeight = container.height;\n\n\t\tcontainer.scene = this;\n\t\tcontainer.zvalue = this.zvalue + (index << 18);\n\n\t\tthis.containers[index] = container;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the container at the specified index.\n\t * !getContainer (index: number) : Container;\n\t */\n\tgetContainer: function (index)\n\t{\n\t\treturn index < 0 || index >= this.containers.length ? null : this.containers[index];\n\t},\n\n\t/**\n\t * Sets a viewport at the specified index.\n\t * !setViewport (index: number, viewport: Viewport) : Scene;\n\t */\n\tsetViewport: function (index, viewport)\n\t{\n\t\tif (index < 0) return this;\n\n\t\tif (viewport !== null && !Viewport.isInstance(viewport))\n\t\t\tthrow new Error('Scene: Unable to set viewport at index ' + index + ': argument is not a Viewport.');\n\n\t\tthis.viewports[index] = viewport;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the viewport at the specified index.\n\t * !getViewport (index: number) : Viewport;\n\t */\n\tgetViewport: function (index)\n\t{\n\t\treturn index < 0 || index >= this.viewports.length ? null : this.viewports[index];\n\t},\n\n\t/**\n\t * Adds the given element to the disposal queue. To be destroyed on the next call to `disposeQueued`.\n\t * !disposeLater (elem: Element) : void;\n\t */\n\tdisposeLater: function (elem)\n\t{\n\t\tif (!elem.alive()) return;\n\n\t\tthis.disposalQueue.push(elem);\n\t\telem.alive(false);\n\t},\n\n\t/**\n\t * Disposes all elements in the disposal queue.\n\t * !disposeQueued() : void;\n\t */\n\tdisposeQueued: function ()\n\t{\n\t\tlet elem;\n\n\t\twhile ((elem = this.disposalQueue.shift()) !== null)\n\t\t\tdispose(elem);\n\t},\n\n\t/**\n\t * Adds a group to the scene.\n\t * !addGroup (group: Group) : boolean;\n\t */\n\taddGroup: function (group)\n\t{\n\t\tif (!Group.isInstance(group))\n\t\t\tthrow new Error ('argument must be a Group');\n\n\t\tthis.groupList.push(group);\n\n\t\tif (group.id !== null)\n\t\t\tthis.groups[group.id] = group;\n\n\t\tgroup.container = this;\n\t\tgroup.remover.add(this._removeGroup, this, this.groupList.bottom);\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * Callback to remove a group from the scene (called by Handler).\n\t */\n\t_removeGroup: function (group, self, node)\n\t{\n\t\tgroup.container = null;\n\t\tself.groupList.remove(node);\n\n\t\tif (group.id !== null)\n\t\t\tself.groups[group.id] = null;\n\n\t\treturn false;\n\t},\n\n\t/**\n\t * Removes a group from the scene.\n\t * !removeGroup (group: Group) : Group;\n\t */\n\tremoveGroup: function (group)\n\t{\n\t\tgroup.remover.execf(this._remove, this);\n\t\treturn group;\n\t},\n\n\t/**\n\t * Syncs the actual location of the specified element with its storage location. Returns `true` if successful.\n\t * !sync (group: Group) : boolean;\n\t */\n\tsync: function (group)\n\t{\n\t\treturn true;\n\t},\n\n\t/**\n\t * Draws the scene, by executing the `draw` method on each container. The entire scene will be drawn once for each viewport, and\n\t * the visible region rules of each viewport will be applied.\n\t * !draw (g: Canvas) : void;\n\t */\n\tdraw: function (g)\n\t{\n\t\tif (!this.visible()) return;\n\n\t\tthis.drawCount = 0;\n\n\t\tif (this.viewports.length)\n\t\t{\n\t\t\tfor (let viewportIndex = 0; viewportIndex < this.viewports.length; viewportIndex++)\n\t\t\t{\n\t\t\t\tlet viewport = this.viewports[viewportIndex];\n\t\t\t\tif (!viewport || !viewport.enabled()) continue;\n\n\t\t\t\tglobals.viewport = viewport;\n\n\t\t\t\tg.pushClip();\n\t\t\t\tg.pushMatrix();\n\n\t\t\t\tviewport.applyClip(g);\n\t\t\t\tviewport.applyTransform(g);\n\n\t\t\t\tthis.viewportBounds.set(viewport.bounds);//.resizeBy(2, 2);\n\t\t\t\tthis.drawContainers(g, this.viewportBounds);\n\n\t\t\t\tg.popMatrix();\n\t\t\t\tg.popClip();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tthis.drawContainers(g, null);\n\n\t\tif (Log.enabled)\n\t\t\tLog.vars[this.name] = this.drawCount;\n\t},\n\n\t/**\n\t * Draws the scene containers and passes the specified viewport bounds to the container.\n\t * !drawContainers (g: Canvas, viewportBounds: Bounds2) : void;\n\t */\n\tdrawContainers: function (g, viewportBounds)\n\t{\n\t\tfor (let i = 0; i < this.containers.length; i++)\n\t\t{\n\t\t\tif (!this.containers[i])\n\t\t\t\tcontinue;\n\n\t\t\tthis.containers[i].setViewportBounds(viewportBounds);\n\t\t\tthis.containers[i].draw(g);\n\n\t\t\tthis.drawCount += this.containers[i].drawCount;\n\t\t}\n\t},\n\n\t/**\n\t * Updates the scene viewports.\n\t */\n\tupdateViewports: function ()\n\t{\n\t\tfor (let i = 0; i < this.viewports.length; i++)\n\t\t{\n\t\t\tif (!this.viewports[i])\n\t\t\t\tcontinue;\n\n\t\t\tthis.viewports[i].update(this.dt);\n\t\t}\n\t},\n\n\t/**\n\t * Runs a scene update cycle.\n\t * !update (dt: number) : void;\n\t */\n\tupdate: function (dt)\n\t{\n\t\tthis.dt = dt;\n\t\tthis.fupdater.exec();\n\n\t\tthis.updater.exec();\n\t\tthis.disposeQueued();\n\t\tthis.synchronizer.exec();\n\t\tthis.updateViewports();\n\n\t\tthis.lupdater.exec();\n\t}\n});\n\n\n/**\n * \tConstants.\n */\nScene.VISIBLE = 0x001;\n\nexport default Scene;\n","\nimport { Class } from 'rinn';\nimport List from '../utils/list.js';\nimport Element from './element.js';\n\n//![import \"../utils/list\"]\n//![import \"./element\"]\n\n//:/**\n//: * \tAn updater is used to update one or more elements and synchronize their position with their container.\n//: */\n\n//!class Updater\n\nconst Updater = Class.extend\n({\n\tclassName: 'Updater',\n\n\t/**\n\t * \tScene where the updater is attached.\n\t * \t!readonly scene: Scene;\n\t */\n\tscene: null,\n\n\t/**\n\t * \tList of elements.\n\t */\n\tlist: null,\n\n\t/**\n\t * \tCallback passed when constructing the updater.\n\t */\n\t__update: null,\n\t__context: null,\n\n\t/**\n\t * \tPre-update and post-update callbacks. Set using the `preupdate` and `postupdate` methods.\n\t */\n\t__preupdate: null,\n\t__postupdate: null,\n\n\t/**\n\t * \tConstructs the updater linked to the specified scene.\n\t * \t!constructor (scene: Scene, update: (elem: Element, dt: number, context: object) => boolean, context?: object);\n\t */\n\t__ctor: function (scene, update=null, context=null)\n\t{\n\t\tthis.list = List.Pool.alloc();\n\t\tthis.scene = scene;\n\n\t\tthis.__update = update;\n\t\tthis.__context = context;\n\n\t\tthis.__preupdate = null;\n\t\tthis.__postupdate = null;\n\n\t\tthis.scene.updater.add(this._update, this);\n\t\tthis.scene.synchronizer.add(this._sync, this);\n\t\tthis.scene.destroyer.add(this._destroy, this);\n\t},\n\n\t/**\n\t * \tDestroys the instance. All elements will just be removed.\n\t */\n\t__dtor: function()\n\t{\n\t\tlet i;\n\n\t\tthis.scene.updater.remove(this._update, this);\n\t\tthis.scene.synchronizer.remove(this._sync, this);\n\t\tthis.scene.destroyer.remove(this._destroy, this);\n\n\t\twhile ((i = this.list.shift()) !== null) {\n\t\t\ti.remover.remove(this._remove, this);\n\t\t}\n\n\t\tthis.list.free();\n\t},\n\n\t/**\n\t * \tDestroyer callback.\n\t */\n\t_destroy: function (scene, self)\n\t{\n\t\tdispose(self);\n\t},\n\n\n\t/**\n\t * \tResets the updater by removing all elements.\n\t * \t!reset () : Updater;\n\t */\n\treset: function ()\n\t{\n\t\twhile ((i = this.list.shift()) !== null) {\n\t\t\ti.remover.remove(this._remove, this);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tClears the updater by destroying all elements.\n\t * \t!clear () : Updater;\n\t */\n\tclear: function ()\n\t{\n\t\twhile ((i = this.list.shift()) !== null) {\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\tdispose(i);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the pre-update callback.\n\t * \t!preupdate (callback: (list: List, dt: number, updater: Updater) => Updater) : Updater;\n\t */\n\tpreUpdate: function (callback)\n\t{\n\t\tthis.__preupdate = callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the post-update callback.\n\t * \t!postupdate (callback: (list: List, dt: number, updater: Updater) => Updater) : Updater;\n\t */\n\tpostUpdate: function (callback)\n\t{\n\t\tthis.__postupdate = callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tAdds an element to the updater.\n\t * \t!add (elem: Element) : Element;\n\t */\n\tadd: function (elem)\n\t{\n\t\tif (!Element.isInstance(elem))\n\t\t\tthrow new Error ('argument must be of type: Element');\n\n\t\tthis.list.push(elem);\n\n\t\telem.remover.add(this._remove, this, this.list.bottom);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tCallback to remove an element from the updater (called by Handler).\n\t */\n\t_remove: function (elem, self, node)\n\t{\n\t\tself.list.remove(node);\n\t\treturn false;\n\t},\n\n\t/**\n\t * \tRemoves an element from the updater.\n\t * \t!remove (elem: Element) : Element;\n\t */\n\tremove: function (elem)\n\t{\n\t\telem.remover.execf(this._remove, this);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tCallback for the synchronizer.\n\t */\n\t_sync: function (scene, self)\n\t{\n\t\tfor (let i = self.list.top; i; i = i.next)\n\t\t\ti.value.sync();\n\t},\n\n\t/**\n\t * \tCallback for the updater.\n\t */\n\t_update: function (scene, self)\n\t{\n\t\tself.update(scene.dt);\n\t},\n\n\t/**\n\t * \tRuns an update cycle.\n\t * \t!update (dt: number) : void;\n\t */\n\tupdate: function (dt)\n\t{\n\t\tif (this.__preupdate !== null)\n\t\t\tthis.__preupdate (this.list, dt, this.__context);\n\n\t\tif (this.__update !== null)\n\t\t{\n\t\t\tlet next = null;\n\t\t\tfor (let i = this.list.top; i; i = next)\n\t\t\t{\n\t\t\t\tnext = i.next;\n\n\t\t\t\tif (this.__update (i.value, dt, this.__context) === false)\n\t\t\t\t\tthis.remove(i.value);\n\t\t\t}\n\t\t}\n\n\t\tif (this.__postupdate !== null)\n\t\t\tthis.__postupdate (this.list, dt, this.__context);\n\t}\n});\n\nexport default Updater;\n","\nimport Container from './container.js';\nimport GridElement from './grid-element.js';\nimport Element from './element.js';\nimport List from '../utils/list.js';\n\n//![import \"./container\"]\n//![import \"./grid-element\"]\n//![import \"./element\"]\n//![import \"../utils/list\"]\n\n//:/**\n//: * \tA simple container is a container that uses a linked-list to storage the elements.\n//: */\n\n//!class SimpleContainer extends Container\n\nexport default Container.extend\n({\n\tclassName: 'SimpleContainer',\n\n\t/**\n\t * List containing the elements.\n\t * !readonly list: List;\n\t */\n\tlist: null,\n\n\t/**\n\t * Constructs the simple container with the specified size.\n\t * !constructor (width: number, height: number);\n\t */\n\t/**\n\t * Constructs the simple container.\n\t * !constructor ();\n\t */\n\t__ctor: function (width=0, height=0)\n\t{\n\t\tthis._super.Container.__ctor (width, height);\n\t\tthis.list = List.Pool.alloc();\n\n\t\tthis.depthFlag(false);\n\t},\n\n\t/**\n\t * Destroys the container and all contained elements.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis.list.free();\n\n\t\tthis._super.Container.__dtor();\n\t},\n\n\t/**\n\t * Syncs the actual location of the specified element with its storage location. Returns true if successful.\n\t * !override sync (elem: Element) : boolean;\n\t */\n\tsync: function (elem)\n\t{\n\t\tthis.syncZ(elem);\n\t\treturn true;\n\t},\n\n\t/**\n\t * Clears the container to empty. All contained elements will be destroyed.\n\t * !override clear() : void;\n\t */\n\tclear: function()\n\t{\n\t\tlet i;\n\n\t\twhile ((i = this.list.shift()) !== null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.container = null;\n\t\t\tdispose(i);\n\t\t}\n\n\t\tthis.elementCount = 0;\n\t},\n\n\t/**\n\t * Resets the container to empty. Contained elements are not destroyed. Use `clear` if that is your intention.\n\t * !override reset() : void;\n\t */\n\treset: function()\n\t{\n\t\tlet i;\n\n\t\twhile ((i = this.list.shift()) !== null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.container = null;\n\t\t}\n\n\t\tthis.elementCount = 0;\n\t},\n\n\t/**\n\t * Adds an element to the container.\n\t * !override add (elem: Element) : Element;\n\t */\n\tadd: function (elem)\n\t{\n\t\tif (!Element.isInstance(elem))\n\t\t\tthrow new Error ('argument must be an Element');\n\n\t\tthis.list.push(elem);\n\t\tthis.elementCount++;\n\n\t\telem.container = this;\n\t\telem.remover.add(this._remove, this, this.list.bottom);\n\n\t\tthis.syncZ(elem);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * Callback to remove an element from the container (called by Handler).\n\t */\n\t_remove: function (elem, self, node)\n\t{\n\t\tself.list.remove(node);\n\t\tself.elementCount--;\n\n\t\telem.container = null;\n\t\treturn false;\n\t},\n\n\t/**\n\t * Removes an element from the container and returns it.\n\t * !override remove (elem: Element) : Element;\n\t */\n\tremove: function (elem)\n\t{\n\t\telem.remover.execf(this._remove, this);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * Actually draws the contained elements. Does not take the active viewport into account (hence simple container).\n\t * !override render() : void;\n\t */\n\trender: function()\n\t{\n\t\tlet flags = GridElement.ALIVE | GridElement.VISIBLE;\n\n\t\tfor (let i = this.list.top; i; i = i.next)\n\t\t{\n\t\t\tif (i.value.getFlags(flags) === false)\n\t\t\t\tcontinue;\n\n\t\t\tif (this.drawElement(i.value, this) === false)\n\t\t\t\tbreak;\n\t\t}\n\t}\n});\n","\nimport Container from './container.js';\nimport Grid from './grid.js';\nimport GridElement from './grid-element.js';\nimport Element from './element.js';\nimport globals from '../system/globals.js';\nimport System from '../system/system.js';\n\n//![import \"./container\"]\n//![import \"./grid\"]\n//![import \"./grid-element\"]\n//![import \"./element\"]\n//![import \"../system/globals\"]\n//![import \"../system/system\"]\n\n//:/**\n//: * \tA grid container is a container that uses an optimized spatial grid structure to store the elements.\n//: */\n\n//!class GridContainer extends Container\n\nexport default Container.extend\n({\n\tclassName: 'GridContainer',\n\n\t/**\n\t * \tGrid containing the elements.\n\t * \t!readonly grid: Grid;\n\t */\n\tgrid: null,\n\n\t/**\n\t * \tIndicates if the container bound should be drawn.\n\t * \t!debugBounds: boolean;\n\t */\n\tdebugBounds: false,\n\n\t/**\n\t * \tConstructs the grid container with the default size (32768x32768) and divisor (64).\n\t * \t!constructor ();\n\t */\n\t/**\n\t * \tConstructs the grid container with the specified size and divisor.\n\t * \t!constructor (width: number, height: number, divisorX: number, divisorY?: number);\n\t */\n\t__ctor: function (width=32768, height=32768, divisorX=64, divisorY=null)\n\t{\n\t\tthis._super.Container.__ctor (width, height);\n\t\tthis.grid = new Grid (width, height, divisorX, divisorY);\n\t},\n\n\t/**\n\t * \tDestroys the container and all contained elements.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis._super.Container.__dtor();\n\t},\n\n\t/**\n\t * \tSyncs the actual location of the specified element with its storage location. Returns true if successful.\n\t * \t!override sync (elem: Element) : boolean;\n\t */\n\tsync: function (elem)\n\t{\n\t\tthis.syncZ(elem);\n\t\treturn this.grid.sync(elem);\n\t},\n\n\t/**\n\t * \tClears the container to empty. All contained elements will be destroyed.\n\t * \t!override clear() : void;\n\t */\n\tclear: function()\n\t{\n\t\tthis.grid.clear();\n\t},\n\n\t/**\n\t * \tResets the container to empty. Contained elements are not destroyed. Use `clear` if that is your intention.\n\t * \t!override reset() : void;\n\t */\n\treset: function()\n\t{\n\t\tthis.grid.reset();\n\t},\n\n\t/**\n\t * \tAdds an element to the container. Returns boolean indicating if successful.\n\t * \t!override add (elem: Element) : Element;\n\t */\n\tadd: function (elem)\n\t{\n\t\tif (!Element.isInstance(elem))\n\t\t\tthrow new Error ('argument must be an Element');\n\n\t\tif (!this.grid.add(elem))\n\t\t\treturn null;\n\n\t\telem.container = this;\n\t\tthis.elementCount = this.grid.count;\n\n\t\tthis.syncZ(elem);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tRemoves an element from the container and returns it.\n\t * \t!override remove (elem: Element) : Element;\n\t */\n\tremove: function (elem)\n\t{\n\t\tthis.grid.remove(elem);\n\t\tthis.elementCount = this.grid.count;\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tActually draws the contained elements.\n\t * \t!override render() : void;\n\t */\n\trender: function()\n\t{\n\t\tthis.grid.forEachInRegion(this.viewportBounds, GridElement.ALIVE | GridElement.VISIBLE, GridElement.ALIVE | GridElement.VISIBLE, this.drawElement, this);\n\n\t\tif (this.debugBounds === false || this.viewportBounds === null)\n\t\t\treturn;\n\n\t\tlet g = System.displayBuffer2;\n\n\t\tg.pushMatrix();\n\t\tg.loadMatrix(this.g.getMatrix());\n\n\t\tlet y0 = ((this.viewportBounds.y1+this.grid.offsy - (1<<this.grid.ky-1)) >> this.grid.ky) * this.grid.stride;\n\t\tlet y1 = ((this.viewportBounds.y2+this.grid.offsy) + (1<<this.grid.ky-1) >> this.grid.ky) * this.grid.stride;\n\t\tlet x0 = ((this.viewportBounds.x1+this.grid.offsx - (1<<this.grid.kx-1)) >> this.grid.kx);\n\t\tlet x1 = ((this.viewportBounds.x2+this.grid.offsx) + (1<<this.grid.kx-1) >> this.grid.kx);\n\n\t\ty0 = (int(y0 / this.grid.stride) << this.grid.ky) - this.grid.offsy;\n\t\ty1 = (int(y1 / this.grid.stride) << this.grid.ky) - this.grid.offsy + (1 << this.grid.ky);\n\t\tx0 = (x0 << this.grid.kx) - this.grid.offsx;\n\t\tx1 = (x1 << this.grid.kx) - this.grid.offsx + (1 << this.grid.kx);\n\n\t\tg.fillStyle('rgba(255,0,0,0.2)');\n\t\tg.fillRect(x0, y0, x1-x0+1, y1-y0+1);\n\n\t\ty0 = this.viewportBounds.y1;\n\t\ty1 = this.viewportBounds.y2;\n\t\tx0 = this.viewportBounds.x1;\n\t\tx1 = this.viewportBounds.x2;\n\n\t\tg.lineWidth(1/System.canvasScaleFactor);\n\t\tg.strokeStyle('#fff');\n\t\tg.strokeRect(x0, y0, x1-x0+1, y1-y0+1);\n\n\t\tg.lineWidth(1/System.canvasScaleFactor);\n\t\tg.strokeStyle('#008');\n\t\tfor (let y = globals.viewport.container.y1+this.grid.offsy; y < globals.viewport.container.y2+this.grid.offsy; y += (1 << this.grid.ky))\n\t\tfor (let x = globals.viewport.container.x1+this.grid.offsx; x < globals.viewport.container.x2+this.grid.offsx; x += (1 << this.grid.kx))\n\t\t{\n\t\t\tg.strokeRect(x-this.grid.offsx, y-this.grid.offsy, (1 << this.grid.kx), (1 << this.grid.ky));\n\t\t}\n\n\t\tg.popMatrix();\n\t},\n\n\t/**\n\t * \tExecutes the specified callback for each element that intersects the given bounds and has the specified flags set. The process is\n\t * \timmediately stopped if the callback returns `false`.\n\t * \t!forEachInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number, callback: (elem: Element, context?: object) => boolean, context?: object) : void;\n\t */\n\tforEachInRegion: function (bounds, flagsAndMask, flagsValue, callback, context)\n\t{\n\t\tthis.grid.forEachInRegion (bounds, flagsAndMask, flagsValue, callback, context);\n\t},\n\n\t/**\n\t * \tCollects all elements that intersect the given bounds and have the specified flags set. Returns a new List, remember to call `free` after using it.\n\t * \t!selectInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : List;\n\t */\n\tselectInRegion: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\treturn this.grid.selectInRegion (bounds, flagsAndMask, flagsValue);\n\t},\n\n\t/**\n\t * \tCounts all elements that intersect the given bounds and have the specified flags set.\n\t * \t!countInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : number;\n\t */\n\tcountInRegion: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\treturn this.grid.countInRegion (bounds, flagsAndMask, flagsValue);\n\t},\n\n\t/**\n\t * \tReturns the first element that intersect the given bounds and have the specified flags set.\n\t * \t!selectFirst (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : Element;\n\t */\n\tselectFirst: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\treturn this.grid.selectFirst (bounds, flagsAndMask, flagsValue);\n\t}\n});\n","\nimport Element from './element.js';\nimport System from '../system/system.js';\nimport Recycler from '../utils/recycler.js';\nimport globals from '../system/globals.js';\n\n//![import \"./element\"]\n//![import \"../system/system\"]\n//![import \"../utils/recycler\"]\n\n//:/**\n//: * \tDescribes an element mask. Used for collision detection.\n//: */\n\n//!class Mask extends Element\n\nconst Mask = Element.extend\n({\n\tclassName: 'Mask',\n\n\t/**\n\t * \tType of the mask (user defined).\n\t * \t!type: number;\n\t */\n\ttype: 0,\n\n\t/**\n\t * \tConstructs the Mask element.\n\t * \t!constructor (type: number, x: number, y: number, width: number, height: number);\n\t */\n\t__ctor: function(type, x, y, width, height)\n\t{\n\t\tthis._super.Element.__ctor(x, y, width, height);\n\n\t\tthis.type = type;\n\t},\n\n\t/**\n\t * \tDraws the element on the specified canvas.\n\t * \t!draw (g: Canvas) : void;\n\t */\n\tdraw: function(g)\n\t{\n\t\tif (globals.debugMasks === false && (this.debugBounds === false || this.debugBounds === 0))\n\t\t\treturn;\n\n\t\tlet m = g.getMatrix();\n\t\tg = System.displayBuffer2;\n\n\t\tg.pushMatrix();\n\t\tg.loadMatrix(m);\n\t\tg.fillStyle(Element.getDebugColor(this.debugBounds));\n\t\tg.fillRect(this.bounds.x1, this.bounds.y1, this.bounds.width(), this.bounds.height());\n\t\tg.popMatrix();\n\t}\n});\n\n//!/class\n\n//!namespace Mask\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a new Mask element.\n\t * \t!function alloc (type: number, x: number, y: number, width: number, height: number) : Mask;\n\t */\n\nRecycler.createPool(Mask);\nexport default Mask;\n","\nimport Element from './element.js';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"./element\"]\n//![import \"../utils/recycler\"]\n\n//:/**\n//: * Describes an element that can be rendered to the screen.\n//: */\n\n//!class Label extends Element\n\nconst Label = Element.extend\n({\n\tclassName: 'Label',\n\n\t/**\n\t * Original label position.\n\t */\n\tsx: 0, sy: 0,\n\n\t/**\n\t * Text to render.\n\t * !readonly text: string;\n\t */\n\ttext: null,\n\n\t/**\n\t * Spritefont resource.\n\t * !readonly font: object;\n\t */\n\t//violet: type fixup\n\t//readonly font: Spritefont;\n\tfont: null,\n\n\t/**\n\t * Indicates if the `text` property changed.\n\t */\n\t_dirty: false,\n\n\t/**\n\t * Current text width.\n\t * !readonly textWidth: number;\n\t */\n\ttextWidth: null,\n\n\t/**\n\t * Current text height.\n\t * !readonly textHeight: number;\n\t */\n\ttextHeight: null,\n\n\t/**\n\t * Alignment properties of the label.\n\t */\n\t_align: -1, /* -1=LEFT, 0=CENTER, 1=RIGHT */\n\t_valign: -1, /* -1=TOP, 0=MIDDLE, 1=BOTTOM */\n\n\t/**\t\n\t * Position offset for the text. Calculated based on alignment properties.\n\t */\n\ttextOffsetX: null,\n\ttextOffsetY: null,\n\n\t/**\n\t * Constructs a label element at the specified position with the given text.\n\t * !constructor (x: number, y: number, font: object, text: string);\n\t */\n\t__ctor: function(x, y, font, text)\n\t{\n\t\tthis._super.Element.__ctor(this.sx = x, this.sy = y, 1, 1);\n\n\t\tthis.text = null;\n\t\tthis.font = font;\n\n\t\tthis._align = -1;\n\t\tthis._valign = -1;\n\n\t\tthis.renderWith(this.renderText);\n\t\tthis.setText(text);\n\t},\n\n\t/**\n\t * Sets the horizontal alignment value of the label.\n\t * @param value - Use -1 for LEFT, 0 for CENTER, and 1 for RIGHT.\n\t * !align (value: number) : Label;\n\t */\n\talign: function (value)\n\t{\n\t\tif (this._align === value)\n\t\t\treturn this;\n\n\t\tthis._align = value;\n\t\tthis.textOffsetX = null;\n\t\treturn this.update();\n\t},\n\n\t/**\n\t * Sets the vertical alignment value of the label.\n\t * @param value - Use -1 for TOP, 0 for MIDDLE, and 1 for BOTTOM.\n\t * !valign (value: number) : Label;\n\t */\n\tvalign: function(value)\n\t{\n\t\tif (this._valign === value)\n\t\t\treturn this;\n\n\t\tthis._valign = value;\n\t\tthis.textOffsetY = null;\n\t\treturn this.update();\n\t},\n\n\t/**\n\t * Sets the text value of the label.\n\t * !setText (value: string) : Label;\n\t */\n\tsetText: function (value)\n\t{\n\t\tif (this.text === value)\n\t\t\treturn this;\n\n\t\tthis.text = value;\n\t\tthis._dirty = true;\n\t\treturn this.update();\n\t},\n\n\t/**\n\t * Sets the font resource to use.\n\t * !setFont (font: object) : Label;\n\t */\n\t//violet: type fixup\n\t//setFont (font: Spritefont) : Label;\n\tsetFont: function (font)\n\t{\n\t\tif (this.font === font)\n\t\t\treturn this;\n\n\t\tthis.font = font;\n\t\tthis._dirty = true;\n\t\treturn this.update();\n\t},\n\n\t/**\n\t * Updates the text related properties (textWidth, textHeight, textOffsetX and textOffsetY). Automatically\n\t * called before the label is drawn. Recalculates offsets only if text changed since last call.\n\t */\n\tupdate: function()\n\t{\n\t\tif (this._dirty === true)\n\t\t{\n\t\t\tthis.textOffsetX = null;\n\t\t\tthis.textOffsetY = null;\n\n\t\t\tthis.textWidth = this.font.measureWidth(this.text);\n\t\t\tthis.textHeight = this.font.measureHeight(this.text);\n\n\t\t\tthis._dirty = false;\n\n\t\t\tthis.bounds.resize(this.textWidth, this.textHeight, true);\n\t\t}\n\n\t\tif (this.textOffsetX === null)\n\t\t{\n\t\t\tif (this._align < 0) this.textOffsetX = 0;\n\t\t\telse if (this._align === 0) this.textOffsetX = -this.textWidth >> 1;\n\t\t\telse this.textOffsetX = -this.textWidth;\n\n\t\t\tthis.bounds.translate(-this.bounds.x1 + this.sx + this.textOffsetX, 0);\n\t\t}\n\n\t\tif (this.textOffsetY === null)\n\t\t{\n\t\t\tif (this._valign < 0) this.textOffsetY = 0;\n\t\t\telse if (this._valign === 0) this.textOffsetY = -this.textHeight >> 1;\n\t\t\telse this.textOffsetY = -this.textHeight;\n\n\t\t\tthis.bounds.translate(0, -this.bounds.y1 + this.sy + this.textOffsetY);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Moves the label by the specified deltas.\n\t * @param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * !translate (dx: number, dy: number, upscaled?: boolean) : Group;\n\t */\n\ttranslate: function (dx, dy, upscaled=false)\n\t{\n\t\tthis._super.Element.translate(dx, dy, upscaled);\n\n\t\tthis.sx = this.bounds.x1;\n\t\tthis.sy = this.bounds.y1;\n\n\t\tthis.textOffsetX = null;\n\t\tthis.textOffsetY = null;\n\n\t\treturn this.update();\n\t},\n\n\t/**\n\t * Renders the element to the graphics surface.\n\t */\n\trenderText: function(g, elem, img)\n\t{\n\t\telem.font.drawText (g, elem.bounds.x1, elem.bounds.y1, elem.text);\n\t}\n});\n\n//!/class\n\n//!namespace Label\n//!namespace Pool\n\n\t/**\n\t * Allocates a label element at the specified position with the given text.\n\t * !function alloc (x: number, y: number, font: object, text: string) : Label;\n\t */\n\n\nRecycler.createPool(Label);\nexport default Label;\n","\nimport PriorityQueue from '../utils/priority-queue.js';\nimport Boot from './boot.js';\nimport System from '../system/system.js';\n\n//![import \"../utils/priority-queue\"]\n//![import \"./boot\"]\n//![import \"../system/system\"]\n\n//!namespace KeyboardHandler\n\n\t//!type Handler =\n\n\t\t/**\n\t\t * Executed when the handler is attached.\n\t\t * !init?: () => void;\n\t\t */\n\n\t\t/**\n\t\t * Keyboard event handler.\n\t\t * !onKeyboardEvent: System.KeyboardEventHandler;\n\t\t */\n\n\t//!/type\n\n//!/namespace\n\n//:/**\n//: * Used to attach keyboard event handlers to the system.\n//: */\n\n//!class KeyboardHandler\n\nexport default Boot.Module.create\n({\n\thandlers: null,\n\n\t__ctor: function ()\n\t{\n\t\tconst self = this;\n\n\t\tthis._super.Module.__ctor();\n\n\t\tthis.handlers = new PriorityQueue();\n\n\t\tthis._callOnKeyboardEvent = function (handler) {\n\t\t\treturn self.callOnKeyboardEvent(handler);\n\t\t};\n\t},\n\n\t/**\n\t * Registers a keyboard event handler.\n\t * !static register (handler: KeyboardHandler.Handler) : KeyboardHandler.Handler;\n\t */\n\tregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.add(handler);\n\n\t\t\tif ('init' in handler)\n\t\t\t\thandler.init();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"KeyboardHandler (register): \" + e.message);\n\t\t}\n\n\t\treturn handler;\n\t},\n\n\t/**\n\t * Removes a keyboard event handler.\n\t * !static unregister (handler: KeyboardHandler.Handler) : void;\n\t */\n\tunregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.remove(handler);\n\t\t\tthis.handlers.cleanup();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"KeyboardHandler (unregister): \" + e.message);\n\t\t}\n\t},\n\n\tcallOnKeyboardEvent: function (handler)\n\t{\n\t\treturn handler.onKeyboardEvent(this._action, this._keyCode, this._keyState);\n\t},\n\n\t/**\n\t * Overrides the default keyboard event handler.\n\t */\n\tonStartup: function()\n\t{\n\t\tSystem.onKeyboardEvent = (action, keyCode, keyState) =>\n\t\t{\n\t\t\tthis._action = action;\n\t\t\tthis._keyCode = keyCode;\n\t\t\tthis._keyState = keyState;\n\n\t\t\tthis.handlers.forEach(this._callOnKeyboardEvent);\n\t\t};\n\t},\n\n\t/**\n\t * Removes the default keyboard handler.\n\t */\n\tonShutdown: function()\n\t{\n\t\tSystem.onKeyboardEvent = null;\n\t}\n});\n","\nimport PriorityQueue from '../utils/priority-queue.js';\nimport Boot from './boot.js';\nimport System from '../system/system.js';\n\n//![import \"../utils/priority-queue\"]\n//![import \"./boot\"]\n//![import \"../system/system\"]\n\n//!namespace PointerHandler\n\n\t//!type Handler =\n\n\t\t/**\n\t\t * Executed when the handler is attached.\n\t\t * !init?: () => void;\n\t\t */\n\n\t\t/**\n\t\t * Pointer event handler.\n\t\t * !onPointerEvent: System.PointerEventHandler;\n\t\t */\n\n\t//!/type\n\n//!/namespace\n\n//:/**\n//: * Used to attach pointer event handlers to the system.\n//: */\n\n//!class PointerHandler\n\nexport default Boot.Module.create\n({\n\thandlers: null,\n\n\t__ctor: function ()\n\t{\n\t\tconst self = this;\n\n\t\tthis._super.Module.__ctor();\n\n\t\tthis.handlers = new PriorityQueue();\n\n\t\tthis._callOnPointerEvent = function (handler) {\n\t\t\treturn self.callOnPointerEvent(handler);\n\t\t};\n\t},\n\n\t/**\n\t * Registers a pointer event handler.\n\t * !static register (handler: PointerHandler.Handler) : PointerHandler.Handler;\n\t */\n\tregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.add(handler);\n\n\t\t\tif ('init' in handler)\n\t\t\t\thandler.init();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"PointerHandler (register): \" + e.message);\n\t\t}\n\n\t\treturn handler;\n\t},\n\n\t/**\n\t * Removes a pointer event handler.\n\t * !static unregister (handler: PointerHandler.Handler) : void;\n\t */\n\tunregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.remove(handler);\n\t\t\tthis.handlers.cleanup();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"PointerHandler (unregister): \" + e.message);\n\t\t}\n\t},\n\n\tcallOnPointerEvent: function (handler)\n\t{\n\t\treturn handler.onPointerEvent(this._action, this._p, this._pointers);\n\t},\n\n\t/**\n\t * Overrides the default pointer event handler.\n\t */\n\tonStartup: function()\n\t{\n\t\tSystem.onPointerEvent = (action, p, pointers) =>\n\t\t{\n\t\t\tthis._action = action;\n\t\t\tthis._p = p;\n\t\t\tthis._pointers = pointers;\n\n\t\t\tthis.handlers.forEach(this._callOnPointerEvent);\n\t\t};\n\t},\n\n\t/**\n\t * Removes the default pointer handler.\n\t */\n\tonShutdown: function()\n\t{\n\t\tSystem.onPointerEvent = null;\n\t}\n});\n","\nimport KeyboardHandler from './keyboard-handler.js';\nimport PointerHandler from './pointer-handler.js';\nimport System from '../system/system.js';\nimport Handler from '../utils/handler.js';\n\n//![import \"./keyboard-handler\"]\n//![import \"./pointer-handler\"]\n//![import \"../system/system\"]\n\n//!namespace ScreenControls\n\n\t//!type Handler =\n\n\t\t/**\n\t\t * Indicates if the pointer focus is locked once acquired, until the pointer is released.\n\t\t * !focusLock : boolean;\n\t\t */\n\n\t\t/**\n\t\t * Indicates if keyboard events are enabled for the object.\n\t\t * !keyboardEvents : boolean;\n\t\t */\n\n\t\t/**\n\t\t * Zindex of the object. Used only if ScreenControls has zindex-flag enabled.\n\t\t * !zindex : number;\n\t\t */\n\n\t\t/**\n\t\t * Returns `true` if the object contains the specified point (screen space).\n\t\t * !containsPoint (x: number, y: number) : boolean;\n\t\t */\n\n\t\t/**\n\t\t * Called when the PointerEventType.POINTER_DOWN event starts within the bounding box of the object.\n\t\t * !pointerActivate (pointer: System.Pointer) : void;\n\t\t */\n\n\t\t/**\n\t\t * Called when the PointerEventType.POINTER_UP event is fired when this object is already activated.\n\t\t * !pointerDeactivate (pointer: System.Pointer) : void;\n\t\t */\n\n\t\t/**\n\t\t * Executed when a pointer move/drag event happens while the object is activated.\n\t\t * !pointerUpdate (x: number, y: number, pointer: System.Pointer) : void;\n\t\t */\n\n\t\t/**\n\t\t * Executed when hover-flag is enabled and a pointer entered or left the host area.\n\t\t * !hover (status: boolean, pointer: System.Pointer) : void;\n\t\t */\n\n\t\t/**\n\t\t * Executed when `keyboardEvents` flag is enabled and a KeyboardEventType.KEY_DOWN event has happened.\n\t\t * !keyDown (keyCode: KeyCode, keyArgs: System.KeyboardState) : void;\n\t\t */\n\n\t\t/**\n\t\t * Executed when `keyboardEvents` flag is enabled and a KeyboardEventType.KEY_UP event has happened.\n\t\t * !keyUp (keyCode: KeyCode, keyArgs: System.KeyboardState) : void;\n\t\t */\n\n\t//!/type\n\n//!/namespace\n\n//!class ScreenControls\n\nconst ScreenControls =\n({\n\tpriority: 5,\n\n\t/**\n\t * Handler class.\n\t */\n\tHandler: Handler,\n\n\t/**\n\t * List of handlers.\n\t */\n\tlist: [ ],\n\n\t/**\n\t * Controls if `hover` support is enabled.\n\t */\n\thoverFlag: false,\n\n\t/**\n\t * Controls if `zindex` support is enabled.\n\t */\n\tzindexFlag: false,\n\n\t/**\n\t * Last frame number when the list was sorted (when zindex is enabled).\n\t */\n\tlastFrame: 0,\n\n\t/**\n\t * Adds the specified handler to the screen controls list.\n\t * !static add (handler: ScreenControls.Handler) : void;\n\t */\n\tadd: function (handler)\n\t{\n\t\tif (this.list.indexOf(handler) === -1)\n\t\t\tthis.list.push(handler);\n\t},\n\n\t/**\n\t * Removes the specified handler from the screen controls list.\n\t * !static remove (handler: ScreenControls.Handler) : void;\n\t */\n\tremove: function (handler)\n\t{\n\t\tlet i = this.list.indexOf(handler);\n\t\tif (i !== -1) this.list.splice(i, 1);\n\t},\n\n\t/**\n\t * Returns the hover-enable flag.\n\t * !static hover() : boolean;\n\t */\n\t/**\n\t * Sets the hover-enable flag.\n\t * !static hover (value: boolean) : void;\n\t */\n\thover: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this.hoverFlag;\n\n\t\tthis.hoverFlag = value;\n\t},\n\n\t/**\n\t * Returns the zindex-enable flag.\n\t * !static zindex() : boolean;\n\t */\n\t/**\n\t * Sets the zindex-enable flag.\n\t * !static zindex (value: boolean) : void;\n\t */\n\tzindex: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this.zindexFlag;\n\n\t\tthis.zindexFlag = value;\n\t},\n\n\tfindTarget: function (x, y, filter=null)\n\t{\n\t\t// Once per frame the list is re-sorted (if required) when the zindex flag is enabled.\n\t\tif (this.zindexFlag && this.lastFrame != System.frameNumber)\n\t\t{\n\t\t\tlet zindex = this.list[0].zindex;\n\n\t\t\tfor (let item of this.list)\n\t\t\t{\n\t\t\t\tif (item.zindex > zindex)\n\t\t\t\t{\n\t\t\t\t\tthis.list = this.list.sort((a,b) => b.zindex - a.zindex);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tzindex = item.zindex;\n\t\t\t}\n\n\t\t\tthis.lastFrame = System.frameNumber;\n\t\t}\n\n\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t{\n\t\t\tif (!this.list[i]) continue;\n\n\t\t\tif (filter !== null && filter(this.list[i]) === false)\n\t\t\t\tcontinue;\n\n\t\t\tif (this.list[i].containsPoint(x, y))\n\t\t\t\treturn this.list[i];\n\t\t}\n\n\t\treturn null;\n\t},\n\n\t/**\n\t * Returns `true` if the specified object has the `hover` method.\n\t * @param {object} i \n\t * @returns {boolean}\n\t */\n\tfilterHover: function (i)\n\t{\n\t\treturn 'hover' in i;\n\t},\n\n\t/**\n\t * Pointer event handler.\n\t * @param {System.PointerEventType} action \n\t * @param {object} p \n\t * @param {object} pointers \n\t * @returns {boolean}\n\t */\n\tonPointerEvent: function (action, p, pointers)\n\t{\n\t\tlet _continue = true;\n\t\tlet tmp = null;\n\n\t\tswitch (action)\n\t\t{\n\t\t\tcase System.PointerEventType.POINTER_DOWN:\n\n\t\t\t\tif (p._ref != null)\n\t\t\t\t{\n\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\ttmp.pointerDeactivate(p);\n\t\t\t\t}\n\n\t\t\t\ttmp = this.findTarget(p.x, p.y);\n\t\t\t\tif (tmp != null)\n\t\t\t\t{\n\t\t\t\t\t(p._ref = tmp).pointerActivate(p);\n\t\t\t\t\t_continue = false;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_DRAG_START:\n\t\t\t\tif (p._ref != null) _continue = false;\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_DRAG_MOVE:\n\t\t\t\tif (this.hoverFlag)\n\t\t\t\t{\n\t\t\t\t\tif (p._refh != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (p._refh.containsPoint(p.x, p.y))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp = p._refh; p._refh = null;\n\t\t\t\t\t\t\ttmp.hover(false, p);\n\n\t\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, this.filterHover);\n\t\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, this.filterHover);\n\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (p._ref != null)\n\t\t\t\t{\n\t\t\t\t\tif (p._ref.containsPoint(p.x, p.y) || p._ref.focusLock == true)\n\t\t\t\t\t{\n\t\t\t\t\t\tp._ref.pointerUpdate (p.x, p.y, p);\n\t\t\t\t\t\t_continue = false;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\t\ttmp.pointerDeactivate(p);\n\n\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y);\n\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t(p._ref = tmp).pointerActivate(p);\n\t\t\t\t\t\t\t_continue = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttmp = this.findTarget(p.x, p.y);\n\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t{\n\t\t\t\t\t\t(p._ref = tmp).pointerActivate(p);\n\t\t\t\t\t\t_continue = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_MOVE:\n\t\t\t\tif (this.hoverFlag)\n\t\t\t\t{\n\t\t\t\t\tif (p._refh != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (p._refh.containsPoint(p.x, p.y))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp = p._refh; p._refh = null;\n\t\t\t\t\t\t\ttmp.hover(false, p);\n\n\t\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, this.filterHover);\n\t\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, this.filterHover);\n\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (p._ref == null) break;\n\n\t\t\t\tif (p._ref.containsPoint(p.x, p.y) || p._ref.focusLock == true)\n\t\t\t\t{\n\t\t\t\t\tp._ref.pointerUpdate (p.x, p.y, p);\n\t\t\t\t\t_continue = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\ttmp.pointerDeactivate(p);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_DRAG_STOP:\n\t\t\t\tif (p._ref != null) _continue = false;\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_UP:\n\t\t\t\tif (p._ref != null)\n\t\t\t\t{\n\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\ttmp.pointerDeactivate(p);\n\n\t\t\t\t\t_continue = false;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn _continue;\n\t},\n\n\t/**\n\t * Keyboard event handler.\n\t * @param {System.KeyboardEventType} action \n\t * @param {int} keyCode \n\t * @param {object} keyArgs \n\t * @returns {boolean}\n\t */\n\tonKeyboardEvent: function (action, keyCode, keyArgs)\n\t{\n\t\tswitch (action)\n\t\t{\n\t\t\tcase System.KeyboardEventType.KEY_DOWN:\n\n\t\t\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!this.list[i] || !this.list[i].keyboardEvents) continue;\n\n\t\t\t\t\tif (this.list[i].keyDown(keyCode, keyArgs) === false)\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.KeyboardEventType.KEY_UP:\n\n\t\t\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!this.list[i] || !this.list[i].keyboardEvents) continue;\n\n\t\t\t\t\tif (this.list[i].keyUp(keyCode, keyArgs) === false)\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn true;\n\t}\n});\n\n//!/class\n\nPointerHandler.register(ScreenControls);\nKeyboardHandler.register(ScreenControls);\n\nexport default ScreenControls;\n","\nimport Group from './group.js';\nimport Mask from './mask.js';\nimport ScreenControls from './screen-controls.js';\n\n//![import \"./group.js\"]\n//![import \"./mask.js\"]\n//![import \"./screen-controls.js\"]\n\n/**\n * \tButton class provides an easy way to add push-button support to the world.\n */\n\n//!class Button extends Group\n\nexport default Group.extend\n({\n\t/**\n\t * \tIndicates if once focus is obtained it is locked until the user releases it.\n\t * \t@default false\n\t *\t!focusLock: boolean;\n\t */\n\tfocusLock: false,\n\n\t/**\n\t * \tIndicates if keyboard events are enabled on this object.\n\t * \t@default true\n\t *\t!keyboardEvents: boolean;\n\t */\n\tkeyboardEvents: true,\n\n\t/**\n\t * \tCurrent pressed status of the button.\n\t *\t!isPressed: boolean;\n\t */\n\tisPressed: false,\n\n\t/**\n\t * \tPrevious pressed status of the button.\n\t *\t!wasPressed: boolean;\n\t */\n\twasPressed: false,\n\n\t/**\n\t * \tImage to draw when the button is unpressed.\n\t *\t!unpressedImg: Drawable;\n\t */\n\tunpressedImg: null,\n\n\t/**\n\t * \tImage to draw when the button is pressed.\n\t *\t!pressedImg: Drawable;\n\t */\n\tpressedImg: null,\n\n\t/**\n\t * \tKey code related to the button. Used only if not `null`.\n\t * \t@default null\n\t *\t!keyCode: KeyCode;\n\t */\n\tkeyCode: null,\n\n\t/**\n\t * \tHitbox element.\n\t * \t!readonly hitbox: Mask;\n\t */\n\thitbox: null,\n\n\t/**\n\t * \tHandlers for the button events.\n\t */\n\t_onButtonDown: null,\n\t_onButtonUp: null,\n\t_onTap: null,\n\t_onChange: null,\n \n\t/**\n\t * \tCreates the button with the specified parameters. Automatically adds it to the screen controls.\n\t * \t!constructor (container: Container, x: number, y: number, unpressedImg?: Drawable, pressedImg?: Drawable);\n\t */\n\t__ctor: function (container, x, y, unpressedImg=null, pressedImg=null)\n\t{\n\t\tthis._super.Group.__ctor();\n\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg ?? unpressedImg;\n\t\tthis.hitbox = null;\n\n\t\tlet hitbox = Mask.Pool.alloc (0, x, y, this.unpressedImg ? this.unpressedImg.width : 16, this.unpressedImg ? this.unpressedImg.height : 16).visible(false).visibleLock(true).debug(2);\n\t\tthis.addChild(hitbox);\n\n\t\tcontainer.add(hitbox);\n\t\tcontainer.add(this);\n\n\t\tthis.hitbox = hitbox;\n\n\t\tthis._onButtonDown = null;\n\t\tthis._onButtonUp = null;\n\t\tthis._onTap = null;\n\t\tthis._onChange = this._default_onChange;\n\n\t\tthis.reset();\n\t\tScreenControls.add(this);\n\t},\n\n\t/**\n\t * \tRemoves the button from the screen controls and destroys it.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis._super.Group.__dtor();\n\t\tScreenControls.remove(this);\n\t},\n\n\t/**\n\t * \tSets the width and height of the button and the hitbox.\n\t * \t!resize (width: number, height: number) : GridElement;\n\t */\n\tresize: function (width, height)\n\t{\n\t\tthis._super.Group.resize(width, height);\n\n\t\tif (this.hitbox !== null)\n\t\t\tthis.hitbox.resize(width, height);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResizes the button and hitbox by the specified deltas.\n\t * \t!resizeBy (deltaWidth: number, deltaHeight: number) : GridElement;\n\t */\n\tresizeBy: function (dWidth, dHeight)\n\t{\n\t\tthis._super.Group.resizeBy(dWidth, dHeight);\n\n\t\tif (this.hitbox !== null)\n\t\t\tthis.hitbox.resizeBy(dWidth, dHeight);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tChanges the pressed/unpressed images of the button.\n\t * \t!setImage (unpressedImg: Drawable, pressedImg?: Drawable) : Button;\n\t */\n\tsetImage: function (unpressedImg, pressedImg=null)\n\t{\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg || unpressedImg;\n\n\t\tthis.reset();\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tChanges the key code of the button.\n\t * \t!setKeyCode (value: KeyCode) : Button;\n\t */\n\tsetKeyCode: function (value)\n\t{\n\t\tthis.keyCode = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResets the button to its initial state.\n\t * \t!reset() : Button;\n\t */\n\treset: function ()\n\t{\n\t\tthis.img = this.unpressedImg;\n\t\tthis._onChange (this.isPressed = false, this.wasPressed = false, this);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tButton pointer update event. Not required for the button control.\n\t * \t!pointerUpdate (pointerX: number, pointerY: number, pointer: object) : void;\n\t */\n\tpointerUpdate: function (pointerX, pointerY, pointer)\n\t{\n\t},\n\n\t/**\n\t * \tSets the pressed state of the button.\n\t * \t!setStatus (value: boolean) : Button;\n\t */\n\tsetStatus: function (value)\n\t{\n\t\tif (this.isPressed === value)\n\t\t\treturn this;\n\n\t\tthis.updateStatus (value);\n\n\t\tthis.img = this.isPressed ? this.pressedImg : this.unpressedImg;\n\t\tthis._onChange (this.isPressed, this.wasPressed, this);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMoves the `isPressed` value of the button to `wasPressed`, and updates `isPressed` with the given value. If none provided, `isPressed` is unchanged.\n\t *\t!updateStatus (value?: boolean) : Button;\n\t */\n\tupdateStatus: function (value=null)\n\t{\n\t\tthis.wasPressed = this.isPressed;\n\t\tthis.isPressed = value === null ? this.isPressed : value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCalled when the PointerEventType.POINTER_DOWN event starts within the bounding box of the button.\n\t * \t!pointerActivate (pointer: object) : void;\n\t */\n\tpointerActivate: function (pointer)\n\t{\n\t\tthis.setStatus(true);\n\t},\n\n\t/**\n\t * \tCalled when the PointerEventType.POINTER_UP event is fired with the \"_ref\" attribute pointing to this object.\n\t *\t!pointerDeactivate (pointer: object) : void;\n\t */\n\tpointerDeactivate: function (pointer)\n\t{\n\t\tthis.setStatus(false);\n\t},\n\n\t/**\n\t * \tReturns `true` if the button contains the specified point.\n\t * \t!containsPoint (x: number, y: number) : boolean;\n\t */\n\tcontainsPoint: function(x, y)\n\t{\n\t\tif (!this.visible() || this.alpha() <= 0)\n\t\t\treturn false;\n\n\t\treturn this.hitbox.bounds.containsPoint(x, y);\n\t},\n\n\t/**\n\t * \tExecuted after any change in the status of the button. Be careful when overriding this, because when so, the `onTap`, `onButtonDown` and `onButtonUp` methods will not work.\n\t * \t!onChange (isPressed: boolean, wasPressed: boolean, button: Button) : void;\n\t */\n\t_default_onChange: function (isPressed, wasPressed, button)\n\t{\n\t\tif (isPressed !== wasPressed)\n\t\t{\n\t\t\tif (isPressed && this._onButtonDown)\n\t\t\t\tthis._onButtonDown();\n\t\t\telse if (!isPressed && this._onButtonUp)\n\t\t\t\tthis._onButtonUp();\n\t\t}\n\n\t\tif (!isPressed && wasPressed && this._onTap)\n\t\t\tthis._onTap();\n\t},\n\n\t/**\n\t * \tKey down event, handles the keys that control the button.\n\t * \t!keyDown (keyCode: KeyCode, keyArgs: object) : boolean|null;\n\t */\n\tkeyDown: function (keyCode, keyArgs)\n\t{\n\t\tif (keyCode === this.keyCode)\n\t\t{\n\t\t\tthis.pointerActivate();\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * \tKey up event, handles the keys that control the button.\n\t * \t!keyUp (keyCode: KeyCode, keyArgs: object) : boolean|null;\n\t */\n\tkeyUp: function (keyCode, keyArgs)\n\t{\n\t\tif (keyCode === this.keyCode)\n\t\t{\n\t\t\tthis.pointerDeactivate();\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * \tSets the handler for the on-change event. Executed when the button state changes. Setting this callback will cause onButtonDown,\n\t * \tonButtonUp and onTap to no longer work. Set the callback to `null` to return it to the default state.\n\t * \n\t * \t!onChange (callback: (isPressed: boolean, wasPressed: boolean, buttons: Button) => void) : Button;\n\t */\n\tonChange: function (callback)\n\t{\n\t\tthis._onChange = callback === null ? this._default_onChange : callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the handler for the button-down event. Executed when the button is pressed. Fired only if the `onChange` method was not overriden.\n\t * !onButtonDown (callback: () => void) : Button;\n\t */\n\t/**\n\t * Executes the onButtonDown handler.\n\t * !onButtonDown() : void;\n\t */\n\tonButtonDown: function (callback=true)\n\t{\n\t\tif (callback === true) {\n\t\t\tif (this._onButtonDown) this._onButtonDown();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._onButtonDown = callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the handler for the button-up event. Executed when the button is released. Fired only if the `onChange` method was not overriden.\n\t * \t!onButtonUp (callback: () => void) : Button;\n\t */\n\t/**\n\t * Executes the onButtonUp handler.\n\t * !onButtonUp() : void;\n\t */\n\tonButtonUp: function (callback=true)\n\t{\n\t\tif (callback === true) {\n\t\t\tif (this._onButtonUp) this._onButtonUp();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._onButtonUp = callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the handler for the on-tap event. Executed when the button is tapped (pressed and then released). Fired only if the `onChange` method was not overriden.\n\t * \t!onTap (callback: () => void) : Button;\n\t */\n\t/**\n\t * Executes the onTap handler.\n\t * !onTap() : void;\n\t */\n\tonTap: function (callback=true)\n\t{\n\t\tif (callback === true) {\n\t\t\tif (this._onTap) this._onTap();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._onTap = callback;\n\t\treturn this;\n\t}\n});\n","\nimport Group from './group.js';\nimport Mask from './mask.js';\nimport ScreenControls from './screen-controls.js';\nimport KeyCode from '../system/keycode.js';\n\n//![import \"./group\"]\n//![import \"./mask\"]\n//![import \"./screen-controls\"]\n//![import \"../system/keycode\"]\n\n/**\n * Stick class provides an easy way to add directional control sticks to the world.\n */\n\n//!class Stick extends Group\n\nexport default Group.extend\n({\n\t/**\n\t * Indicates if once focus is obtained it is locked until the user releases it.\n\t * @default true\n\t * !focusLock: boolean;\n\t */\n\tfocusLock: true,\n\n\t/**\n\t * Indicates if keyboard events are enabled on this object. Use `bindKeys` to enable.\n\t */\n\tkeyboardEvents: false,\n\n\t/**\n\t * Current pressed status of the stick.\n\t * !readonly isPressed: boolean;\n\t */\n\tisPressed: false,\n\n\t/**\n\t * Previous pressed status of the stick.\n\t * !readonly wasPressed: boolean;\n\t */\n\twasPressed: false,\n\n\t/**\n\t * Image to draw when the stick is unpressed (outer circle).\n\t * !readonly unpressedImg: Drawable;\n\t */\n\tunpressedImg: null,\n\n\t/**\n\t * Image to draw when the stick is pressed (outer circle).\n\t * !readonly pressedImg: Drawable;\n\t */\n\tpressedImg: null,\n\n\t/**\n\t * Image to draw when the stick is unpressed (inner circle).\n\t * !readonly unpressedImgInner: Drawable;\n\t */\n\tunpressedImgInner: null,\n\n\t/**\n\t * Image to draw when the stick is pressed (inner circle).\n\t * !readonly pressedImgInner: Drawable;\n\t */\n\tpressedImgInner: null,\n\n\t/**\n\t * Number of steps for the angle. Used to snap the stick movement to discrete steps.\n\t * !readonly angleSteps: number;\n\t */\n\tangleSteps: 0,\n\n\t/**\n\t * Number of steps for the radius of the stick. Used to snap the stick movement to discrete steps.\n\t * !readonly radiusSteps: number;\n\t */\n\tradiusSteps: 0,\n\n\t/**\n\t * Current center offset X.\n\t * !readonly offsX: number;\n\t */\n\toffsX: 0,\n\n\t/**\n\t * Current center offset Y.\n\t * !readonly offsY: number;\n\t */\n\toffsY: 0,\n\n\t/**\n\t * Raw direction in the X-axis.\n\t * !readonly rdirx: number;\n\t */\n\trdirx: 0,\n\n\t/**\n\t * Raw direction in the Y-axis.\n\t * !readonly rdiry: number;\n\t */\n\trdiry: 0,\n\n\t/*\n\t * Normalized direction in the X-axis.\n\t * !readonly dirx: number;\n\t */\n\tdirx: 0,\n\n\t/**\n\t * Normalized direction in the Y-axis.\n\t * !readonly diry: number;\n\t */\n\tdiry: 0,\n\n\t/**\n\t * Magnitude of the direction vector.\n\t * !readonly magnitude: number;\n\t */\n\tmagnitude: 0,\n\n\t/**\n\t * Angle of the direction vector.\n\t * !readonly angle: number;\n\t */\n\tangle: 0,\n\n\t/*\n\t** Frozen stick state. Set by calling `freezeState`.\n\t*/\n\tfrdirx: 0, frdiry: 0, fdirx: 0, fdiry: 0, fmagnitude: 0, fangle: 0,\n\n\t/**\n\t * Displacement of the inner stick. Calculated when the `update` method is called.\n\t */\n\tdispx: 0, dispy: 0,\n\n\t/**\n\t * Current radius of the inner stick (how far it moved). And maximum radius that the inner stick can move.\n\t */\n\tradius: 0, maxRadius: 0,\n\n\t/**\n\t * Dead zone values for each axis. Set using `setDeadZone`.\n\t */\n\tdeadZoneX: 0, deadZoneY: 0,\n\n\t/**\n\t * Hitbox element.\n\t */\n\thitbox: null,\n\n\t/**\n\t * Handler for the stick change event. Set using the `onChange` method.\n\t */\n\t_onChange: null,\n\n\t/**\n\t * Key codes to control the stick direction with the keyboard. Set using the `bindKeys` method.\n\t */\n\tUP: null,\n\tDOWN: null,\n\tLEFT: null,\n\tRIGHT: null,\n \n\t/**\n\t * Maximum limits for the stick dragging.\n\t */\n\tlimitX1: null, limitY1: null,\n\tlimitX2: null, limitY2: null,\n\n\t/**\n\t * Creates the stick with the specified parameters. Automatically adds it to the screen controls.\n\t * !constructor (container: Container, x: number, y: number, maxRadius: number, unpressedImg: Drawable, unpressedImgInner: Drawable, pressedImg?: Drawable, pressedImgInner?: Drawable);\n\t */\n\t__ctor: function (container, x, y, maxRadius, unpressedImg, unpressedImgInner, pressedImg=null, pressedImgInner=null)\n\t{\n\t\tthis._super.Group.__ctor();\n\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg || unpressedImg;\n\n\t\tthis.unpressedImgInner = unpressedImgInner;\n\t\tthis.pressedImgInner = pressedImgInner || unpressedImgInner;\n\n\t\tthis.maxRadius = maxRadius;\n\n\t\tthis.deadZoneX = 0.0;\n\t\tthis.deadZoneY = 0.0;\n\n\t\tthis.offsX = 0;\n\t\tthis.offsY = 0;\n\n\t\tthis.limitX1 = false;\n\t\tthis.limitY1 = false;\n\t\tthis.limitX2 = false;\n\t\tthis.limitY2 = false;\n\n\t\tthis.hitbox = Mask.Pool.alloc (0, x, y, (this.unpressedImg ?? this.unpressedImgInner).width, (this.unpressedImg ?? this.unpressedImgInner).height).visible(false).visibleLock(true).debug(2);\n\t\tthis.addChild(this.hitbox);\n\n\t\tcontainer.add(this.hitbox);\n\t\tcontainer.add(this);\n\n\t\tthis._onChange = null;\n\n\t\tthis.renderWith(this.renderStick);\n\t\tScreenControls.add(this);\n\t},\n\n\t/**\n\t * Removes the button from the screen controls and destroys it.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis._super.Group.__dtor();\n\t\tScreenControls.remove(this);\n\t},\n\n\t/**\n\t * Binds the stick to the specified keycodes and enables keyboard events.\n\t * !bindKeys (up?: number, down?: number, left?: number, right?: number) : Stick;\n\t */\n\tbindKeys: function (up=KeyCode.UP, down=KeyCode.DOWN, left=KeyCode.LEFT, right=KeyCode.RIGHT)\n\t{\n\t\tthis.UP = up;\n\t\tthis.DOWN = down;\n\t\tthis.LEFT = left;\n\t\tthis.RIGHT = right;\n\n\t\tthis.keyboardEvents = true;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the state of the keyboard events enable flag.\n\t * !keysEnabled () : Stick;\n\t */\n\t/**\n\t * Enables or disables keyboard interaction with the stick.\n\t * !keysEnabled (value: boolean) : Stick;\n\t */\n\tkeysEnabled: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this.keyboardEvents;\n\n\t\tthis.keyboardEvents = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the maximum dragging limits for the stick. Values of `false` will disable dragging in the respective axis. And `null` will cause the axis to be unlimited.\n\t * !setLimits (x1: number|boolean|null, y1: number|boolean|null, x2: number|null, y2: number|null) : Stick;\n\t */\n\tsetLimits: function (x1, y1, x2, y2)\n\t{\n\t\tthis.limitX1 = x1;\n\t\tthis.limitY1 = y1;\n\t\tthis.limitX2 = x2;\n\t\tthis.limitY2 = y2;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Changes the pressed/unpressed images of the outer stick.\n\t * !setImage (unpressedImg: Drawable, pressedImg?: Drawable) : Stick;\n\t */\n\tsetImage: function (unpressedImg, pressedImg=null)\n\t{\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg || unpressedImg;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Changes the pressed/unpressed images of the inner stick.\n\t * !setImageInner (unpressedImg: Drawable, pressedImg?: Drawable) : Stick;\n\t */\n\tsetImageInner: function (unpressedImg, pressedImg=null)\n\t{\n\t\tthis.unpressedImgInner = unpressedImg;\n\t\tthis.pressedImgInner = pressedImg || unpressedImg;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the number of angle-steps for the stick.\n\t * !setAngleSteps (n: number) : Stick;\n\t */\n\tsetAngleSteps: function (n)\n\t{\n\t\tthis.angleSteps = n;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the number of radius-steps for the stick.\n\t * !setRadiusSteps (n: number) : Stick;\n\t */\n\tsetRadiusSteps: function (n)\n\t{\n\t\tthis.radiusSteps = n;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the dead zone values (normalized).\n\t * !setDeadZone (deadZoneX: number, deadZoneY: number) : Stick;\n\t */\n\t/**\n\t * Sets the dead zone values (normalized).\n\t * !setDeadZone (deadZone: number) : Stick;\n\t */\n\tsetDeadZone: function (deadZoneX, deadZoneY=null)\n\t{\n\t\tthis.deadZoneX = deadZoneX;\n\t\tthis.deadZoneY = deadZoneY ?? deadZoneX;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Resets the button to its initial state.\n\t * !reset() : Stick;\n\t */\n\treset: function ()\n\t{\n\t\tthis.dispx = 0;\n\t\tthis.dispy = 0;\n\n\t\tthis.rdirx = 0;\n\t\tthis.rdiry = 0;\n\n\t\tthis.dirx = 0;\n\t\tthis.diry = 0;\n\t\tthis.magnitude = 0;\n\n\t\tif (this._onChange)\n\t\t\tthis._onChange (this.dirx, this.diry, this.magnitude, this.angle, this);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Renders the stick in the canvas.\n\t */\n\trenderStick: function (g, elem, img)\n\t{\n\t\tif (elem.isPressed)\n\t\t{\n\t\t\tif (elem.pressedImg)\n\t\t\t\telem.pressedImg.draw (g, elem.bounds.x1 + elem.offsX, elem.bounds.y1 + elem.offsY);\n\n\t\t\tif (elem.pressedImgInner)\n\t\t\t\telem.pressedImgInner.draw (g, elem.bounds.x1 + elem.offsX + elem.dispx, elem.bounds.y1 + elem.offsY + elem.dispy);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (elem.unpressedImg)\n\t\t\t\telem.unpressedImg.draw (g, elem.bounds.x1 + elem.offsX, elem.bounds.y1 + elem.offsY);\n\n\t\t\tif (elem.unpressedImgInner)\n\t\t\t\telem.unpressedImgInner.draw (g, elem.bounds.x1 + elem.offsX, elem.bounds.y1 + elem.offsY);\n\t\t}\n\t},\n\n\t/**\n\t * Button pointer update event. Not required for the button control.\n\t */\n\tpointerUpdate: function (pointerX, pointerY)\n\t{\n\t\tlet dx, dy;\n\n\t\tdx = pointerX - (this.bounds.cx + this.offsX);\n\t\tdy = pointerY - (this.bounds.cy + this.offsY);\n\n\t\tthis.angle = Math.atan2(-dy, dx);\n\t\tthis.radius = Math.sqrt(dx*dx + dy*dy);\n\n\t\tif (this.radius > this.maxRadius)\n\t\t{\n\t\t\tif (this.limitX1 !== false) {\n\t\t\t\tthis.offsX += Math.cos(this.angle)*(this.radius - this.maxRadius);\n\t\t\t\tif (this.limitX1 !== null && (this.bounds.cx+this.offsX) < this.limitX1) this.offsX = this.limitX1 - this.bounds.cx;\n\t\t\t\tif (this.limitX2 !== null && (this.bounds.cx+this.offsX) > this.limitX2) this.offsX = this.limitX2 - this.bounds.cx;\n\t\t\t}\n\n\t\t\tif (this.limitY1 !== false) {\n\t\t\t\tthis.offsY += -Math.sin(this.angle)*(this.radius - this.maxRadius);\n\t\t\t\tif (this.limitY1 !== null && (this.bounds.cy+this.offsY) < this.limitY1) this.offsY = this.limitY1 - this.bounds.cy;\n\t\t\t\tif (this.limitY2 !== null && (this.bounds.cy+this.offsY) > this.limitY2) this.offsY = this.limitY2 - this.bounds.cy;\n\t\t\t}\n\n\t\t\tthis.radius = this.maxRadius;\n\t\t}\n\n\t\tif (this.angleSteps)\n\t\t{\n\t\t\tlet fs = (2*Math.PI / this.angleSteps);\n\t\t\tthis.angle = int((this.angle + Math.PI + fs/2) / fs) * fs - Math.PI;\n\t\t}\n\n\t\tif (this.radiusSteps)\n\t\t{\n\t\t\tlet fs = (this.maxRadius / this.radiusSteps);\n\t\t\tthis.radius = int((this.radius + fs/2) / fs) * fs;\n\t\t}\n\n\t\tthis.rdirx = Math.min(1, Math.max(dx / this.maxRadius, -1));\n\t\tthis.rdiry = Math.min(1, Math.max(dy / this.maxRadius, -1));\n\n\t\tthis.dispx = this.radius * Math.cos(this.angle);\n\t\tthis.dispy = this.radius * -Math.sin(this.angle);\n\n\t\tif (this.radius > 0)\n\t\t{\n\t\t\tthis.dirx = this.dispx / this.radius;\n\t\t\tthis.diry = this.dispy / this.radius;\n\n\t\t\tthis.magnitude = this.radius / this.maxRadius;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.dirx = 0;\n\t\t\tthis.diry = 0;\n\n\t\t\tthis.magnitude = 0;\n\t\t}\n\n\t\tif (Math.abs(this.rdirx) < this.deadZoneX) {\n\t\t\tthis.rdirx = 0;\n\t\t\tthis.dirx = 0;\n\t\t}\n\n\t\tif (Math.abs(this.rdiry) < this.deadZoneY) {\n\t\t\tthis.rdiry = 0;\n\t\t\tthis.diry = 0;\n\t\t}\n\n\t\tif (this._onChange)\n\t\t\tthis._onChange (this.dirx, this.diry, this.magnitude, this.angle, this);\n\t},\n\n\t/**\n\t * Called when the PointerEventType.POINTER_DOWN event starts within the bounding box of the stick.\n\t */\n\tpointerActivate: function (pointer)\n\t{\n\t\tthis.wasPressed = this.isPressed;\n\t\tthis.isPressed = 1;\n\n\t\tthis.offsX = 0;\n\t\tthis.offsY = 0;\n\n\t\tthis.pointerUpdate(pointer.x, pointer.y);\n\t},\n\n\t/**\n\t * Called when the PointerEventType.POINTER_UP event is fired with the \"_ref\" attribute pointing to this object.\n\t */\n\tpointerDeactivate: function (pointer)\n\t{\n\t\tthis.wasPressed = this.isPressed;\n\t\tthis.isPressed = 0;\n\n\t\tthis.offsX = 0;\n\t\tthis.offsY = 0;\n\n\t\tthis.reset();\n\t},\n\n\t/**\n\t * Returns `true` if the stick contains the specified point.\n\t * !containsPoint (x: number, y: number) : boolean;\n\t */\n\tcontainsPoint: function(x, y)\n\t{\n\t\tif (!this.visible() || this.alpha() <= 0)\n\t\t\treturn false;\n\n\t\treturn this.hitbox.bounds.containsPoint(x, y);\n\t},\n\n\t/**\n\t * Sets the direction of the stick, the provided deltas should be normalized in the \\[-1, 1\\] range.\n\t * !setDirection (dx: number, dy: number, deadZoneX?: number, deadZoneY?: number) : boolean;\n\t */\n\tsetDirection: function (dx, dy, deadZoneX=0.10, deadZoneY=0.10)\n\t{\n\t\tif (Math.abs(dx) < deadZoneX) dx = 0;\n\t\tif (Math.abs(dy) < deadZoneY) dy = 0;\n\n\t\tthis.wasPressed = this.isPressed;\n\t\tthis.isPressed = dx == 0 && dy == 0 ? 0 : 1;\n\n\t\tthis.pointerUpdate (this.bounds.cx + dx*this.maxRadius, this.bounds.cy + dy*this.maxRadius);\n\t\treturn false;\n\t},\n\n\t/**\n\t * Saves the current state of the stick in the froxen state variables (fdirx, fdiry, etc). When the `lastValid` parameter is `true`, the values\n\t * will be saved only if the current value of each field is not zero.\n\t *\n\t * !freezeState (lastValid?: boolean) : Stick;\n\t */\n\tfreezeState: function (lastValid=false)\n\t{\n\t\tthis.frdirx = lastValid ? (this.rdirx != 0 ? this.rdirx : this.frdirx) : this.rdirx;\n\t\tthis.frdiry = lastValid ? (this.rdiry != 0 ? this.rdiry : this.frdiry) : this.rdiry;\n\t\tthis.fdirx = lastValid ? (this.dirx != 0 ? this.dirx : this.fdirx) : this.dirx;\n\t\tthis.fdiry = lastValid ? (this.diry != 0 ? this.diry : this.fdiry) : this.diry;\n\t\tthis.fmagnitude = lastValid ? (this.magnitude != 0 ? this.magnitude : this.fmagnitude) : this.magnitude;\n\t\tthis.fangle = lastValid ? (this.angle != 0 ? this.angle : this.fangle) : this.angle;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Key down event, handles the keys that control the direction of the stick.\n\t */\n\tkeyDown: function (keyCode, keyArgs)\n\t{\n\t\tlet dx = 0;\n\t\tlet dy = 0;\n\n\t\tthis.offsX = 0;\n\t\tthis.offsY = 0;\n\n\t\tif (keyArgs[this.UP] === true) dy = -this.maxRadius;\n\t\tif (keyArgs[this.LEFT] === true) dx = -this.maxRadius;\n\t\tif (keyArgs[this.DOWN] === true) dy = this.maxRadius;\n\t\tif (keyArgs[this.RIGHT] === true) dx = this.maxRadius;\n\n\t\tif (keyCode === this.UP || keyCode === this.LEFT || keyCode === this.DOWN || keyCode === this.RIGHT)\n\t\t{\n\t\t\tthis.wasPressed = this.isPressed;\n\t\t\tthis.isPressed = 1;\n\n\t\t\tif (dx != 0 && dy != 0)\n\t\t\t{\n\t\t\t\tdx *= 0.7071;\n\t\t\t\tdy *= 0.7071;\n\t\t\t}\n\n\t\t\tthis.pointerUpdate (this.bounds.cx + dx, this.bounds.cy + dy);\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * Key up event, handles the keys that control the direction of the stick.\n\t */\n\tkeyUp: function (keyCode, keyArgs)\n\t{\n\t\tlet dx = 0;\n\t\tlet dy = 0;\n\n\t\tthis.offsX = 0;\n\t\tthis.offsY = 0;\n\n\t\tif (keyArgs[this.UP] === true) dy = -this.maxRadius;\n\t\tif (keyArgs[this.LEFT] === true) dx = -this.maxRadius;\n\t\tif (keyArgs[this.DOWN] === true) dy = this.maxRadius;\n\t\tif (keyArgs[this.RIGHT] === true) dx = this.maxRadius;\n\n\t\tif (keyCode === this.UP || keyCode === this.LEFT || keyCode === this.DOWN || keyCode === this.RIGHT)\n\t\t{\n\t\t\tif (dx != 0 && dy != 0)\n\t\t\t{\n\t\t\t\tdx *= 0.7071;\n\t\t\t\tdy *= 0.7071;\n\t\t\t}\n\n\t\t\tthis.pointerUpdate (this.bounds.cx + dx, this.bounds.cy + dy);\n\n\t\t\tif (dx === 0 && dy === 0)\n\t\t\t{\n\t\t\t\tthis.wasPressed = this.isPressed;\n\t\t\t\tthis.isPressed = 0;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * Sets the handler for the on-change event. Executed after any change in the direction of the stick.\n\t * !onChange (callback: (dirx: number, diry: number, magnitude: number, angle: number, stick: Stick) => void) : Stick;\n\t */\n\tonChange: function (callback)\n\t{\n\t\tthis._onChange = callback;\n\t\treturn this;\n\t}\n});\n","\nimport System from '../system/system.js';\nimport Scene from '../flow/scene.js';\nimport Viewport from '../flow/viewport.js';\nimport Bounds2 from '../math/bounds2.js';\nimport GridContainer from '../flow/grid-container.js';\nimport Element from '../flow/element.js';\nimport Label from '../flow/label.js';\nimport Group from '../flow/group.js';\nimport Updater from '../flow/updater.js';\nimport SimpleContainer from '../flow/simple-container.js';\nimport Mask from '../flow/mask.js';\nimport system from './system.js';\nimport globals from '../system/globals.js';\n\n//!/**\n//! * \tWorld system allows to manage scenes, containers, viewports and display elements.\n//! */\n\n//!class world\n\nconst world =\n{\n\t/**\n\t * World scene constants.\n\t *\n\t * !static readonly SCENE_MAIN: number;\n\t * !static readonly SCENE_HUD: number;\n\t */\n\tSCENE_MAIN: 0,\n\tSCENE_HUD: 1,\n\n\t/**\n\t * Default layers for the SCENE_MAIN scene.\n\t *\n\t * !static readonly LAYER_BG0: number;\n\t * !static readonly LAYER_BG1: number;\n\t * !static readonly LAYER_BG2: number;\n\t * !static readonly LAYER_BG3: number;\n\t * !static readonly LAYER_BG4: number;\n\t * !static readonly LAYER_MAIN: number;\n\t * !static readonly LAYER_FG0: number;\n\t * !static readonly LAYER_FG1: number;\n\t * !static readonly LAYER_FG2: number;\n\t * !static readonly LAYER_FG3: number;\n\t * !static readonly LAYER_FG4: number;\n\t * !static readonly LAYER_MASK: number;\n\t */\n\tLAYER_BG0: 0,\n\tLAYER_BG1: 1,\n\tLAYER_BG2: 2,\n\tLAYER_BG3: 3,\n\tLAYER_BG4: 4,\n\tLAYER_MAIN: 5,\n\tLAYER_FG0: 6,\n\tLAYER_FG1: 7,\n\tLAYER_FG2: 8,\n\tLAYER_FG3: 9,\n\tLAYER_FG4: 10,\n\tLAYER_MASK: 11,\n\n\t/**\n\t * Default layers for the SCENE_HUD scene.\n\t *\n\t * !static readonly LAYER_HUD_BG0: number;\n\t * !static readonly LAYER_HUD_BG1: number;\n\t * !static readonly LAYER_HUD_BG2: number;\n\t * !static readonly LAYER_HUD_MAIN: number;\n\t * !static readonly LAYER_HUD_FG0: number;\n\t * !static readonly LAYER_HUD_FG1: number;\n\t * !static readonly LAYER_HUD_FG2: number;\n\t */\n \tLAYER_HUD_BG0: 0,\n\tLAYER_HUD_BG1: 1,\n\tLAYER_HUD_BG2: 2,\n\tLAYER_HUD_MAIN: 3,\n\tLAYER_HUD_FG0: 4,\n\tLAYER_HUD_FG1: 5,\n\tLAYER_HUD_FG2: 6,\n\n\t/**\n\t *\tRegistered scenes.\n\t */\n\t_scenes: [],\n\n\t/**\n\t * Active scene set by `selectScene`.\n\t * !static activeScene: Scene;\n\t */\n\tactiveScene: null,\n\n\t/**\n\t *\tRegistered viewports.\n\t */\n\t_viewports: [],\n\n\t/**\n\t * Active viewport set by `selectViewport`.\n\t * !static activeViewport: Viewport;\n\t */\n\tactiveViewport: null,\n\n\t/**\n\t * Active container set by `selectContainer`.\n\t * !static activeContainer: Container;\n\t */\n\tactiveContainer: null,\n\n\t/**\n\t * Currently active group (set by `createGroup`).\n\t * !static activeGroup: Group;\n\t */\n\tactiveGroup: null,\n\n\t/**\n\t * Last used group (set by `endGroup`).\n\t * !static lastGroup: Group;\n\t */\n\tlastGroup: null,\n\n\t/**\n\t * Last element created by `createElement`, or `createLabel`.\n\t * !static lastElement: Element;\n\t */\n\tlastElement: null,\n\n\t/**\n\t * Dimensions of the world.\n\t * !static readonly bounds: Bounds2;\n\t */\n\tbounds: Bounds2.Pool.alloc(),\n\n\t/**\n\t * Initializes the world with the default scenes, viewports and layers.\n\t * !static init (worldWidth?: number, worldHeight?: number, divisorX?: number, divisorY?: number) : void;\n\t */\n\tinit: function (worldWidth=32768, worldHeight=32768, divisorX=null, divisorY=null)\n\t{\n\t\tif (this._scenes.length !== 0)\n\t\t\treturn;\n\n\t\tif (divisorX === null)\n\t\t\tdivisorX = Math.max(worldWidth, worldHeight) / 512;\n\n\t\tif (divisorX < 16)\n\t\t\tdivisorX = 16;\n\n\t\tif (divisorY !== null && divisorY < 16)\n\t\t\tdivisorY = 16;\n\n\t\tthis.bounds.zero().resize(worldWidth, worldHeight);\n\n\t\tthis.createScene(world.SCENE_MAIN, 'SCENE_MAIN');\n\t\tthis.setContainer(world.LAYER_BG0, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_BG1, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_BG2, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_BG3, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_BG4, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_MAIN, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_FG0, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_FG1, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_FG2, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_FG3, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_FG4, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\n\t\tthis.setContainer(world.LAYER_MASK, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.getContainer(world.LAYER_MASK).visible(false);\n\t\tthis.createViewport(0);\n\n\t\tthis.createScene(world.SCENE_HUD, 'SCENE_HUD');\n\t\tthis.setContainer(world.LAYER_HUD_BG0, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_BG1, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_BG2, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_MAIN, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_FG0, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_FG1, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_FG2, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t},\n\n\t/**\n\t * Creates a scene at the specified index and automatically selects it.\n\t * !static createScene (index: number, name?: string) : Scene;\n\t */\n\tcreateScene: function (index, name=null)\n\t{\n\t\tif (this._scenes[index])\n\t\t{\n\t\t\tSystem.queueRemove(this._scenes[index]);\n\t\t\tglobal.dispose(this._scenes[index]);\n\t\t}\n\n\t\tthis._scenes[index] = new Scene(index, name);\n\t\tSystem.queueAdd(this._scenes[index]);\n\n\t\tthis.selectScene(index);\n\t\treturn this._scenes[index];\n\t},\n\n\t/**\n\t * Returns the scene at the specified index (or the active scene if no index provided).\n\t * !static getScene (index?: number) : Scene;\n\t */\n\tgetScene: function (index=null)\n\t{\n\t\tif (index === null)\n\t\t\treturn this.activeScene;\n\n\t\tif (index < 0 || index >= this._scenes.length)\n\t\t\treturn null;\n\n\t\treturn this._scenes[index];\n\t},\n\n\t/**\n\t * Selects the active scene for subsequence scene-level operations.\n\t * !static selectScene (index: number) : boolean;\n\t */\n\tselectScene: function (index)\n\t{\n\t\tif (index < 0 || index >= this._scenes.length || !this._scenes[index])\n\t\t\treturn false;\n\n\t\tthis.activeScene = this._scenes[index];\n\t\tthis.activeContainer = null;\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * Creates a viewport at the specified index, attaches it to the active scene and selects it. Use this only after attaching all\n\t * containers to the scene or the `maxWidth` and `maxHeight` properties of the scene will not be properly set yet.\n\t *\n\t * !static createViewport (index: number) : void;\n\t */\n\tcreateViewport: function (index)\n\t{\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('createViewport: use `selectScene` first to select the active scene.');\n\n\t\tif (this._viewports[index])\n\t\t{\n\t\t\tglobal.dispose(this._viewports[index]);\n\t\t\tthis.activeScene.setViewport(index, null);\n\t\t}\n\n\t\tthis._viewports[index] = new Viewport(\n\t\t\t0, 0,\n\t\t\tsystem.screenWidth, system.screenHeight,\n\t\t\tthis.activeScene.maxWidth, this.activeScene.maxHeight\n\t\t);\n\n\t\tthis.activeScene.setViewport(index, this._viewports[index]);\n\n\t\tthis.selectViewport(index);\n\t},\n\n\t/**\n\t * Returns a viewport given its index (or the active viewport if no index provided).\n\t * !static getViewport (index?: number) : Viewport;\n\t */\n\tgetViewport: function (index=null)\n\t{\n\t\tif (index === null)\n\t\t\treturn this.activeViewport;\n\n\t\tif (index < 0 || index >= this._viewports.length)\n\t\t\treturn null;\n\n\t\treturn this._viewports[index];\n\t},\n\n\t/**\n\t * Selects the active viewport.\n\t * !static selectViewport (index: number) : boolean;\n\t */\n\tselectViewport: function (index)\n\t{\n\t\tif (index < 0 || index >= this._viewports.length || !this._viewports[index])\n\t\t\treturn false;\n\n\t\tthis.activeViewport = this._viewports[index];\n\t\treturn true;\n\t},\n\n\t/**\n\t * Sets a container in the active scene at the specified index and returns it.\n\t * !static setContainer (index: number, container: Container) : Container;\n\t */\n\tsetContainer: function (index, container)\n\t{\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('setContainer: use `selectScene` first to select the active scene.');\n\n\t\tthis.activeScene.setContainer (index, container);\n\t\treturn container;\n\t},\n\n\t/**\n\t * Returns the container at the specified index in the active scene (or the active container if no index provided).\n\t * !static getContainer (index?: number) : Container;\n\t */\n\tgetContainer: function (index=null, throwErrors=false)\n\t{\n\t\tif (index === null)\n\t\t{\n\t\t\tif (this.activeContainer === null && throwErrors)\n\t\t\t\tthrow new Error ('getContainer: container index not specified and default container not set.');\n\n\t\t\treturn this.activeContainer;\n\t\t}\n\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('getContainer: use `selectScene` first to select the active scene.');\n\n\t\tlet container = this.activeScene.getContainer(index);\n\t\tif (container === null && throwErrors)\n\t\t\tthrow new Error ('getContainer: container index out of bounds.');\n\n\t\treturn container;\n\t},\n\n\t/**\n\t * Selects the active container.\n\t * !static selectContainer (index: number) : boolean;\n\t */\n\tselectContainer: function (index)\n\t{\n\t\tthis.activeContainer = this.getContainer(index, true);\n\t\treturn this.activeContainer !== null;\n\t},\n\n\t/**\n\t * Changes the visibility of the LAYER_MASK to enable (or disable) mask bounds rendering.\n\t * @param {boolean} value\n\t * @param {boolean} allMasks If set to `false` only masks having `debugBounds` to non-false will be drawn.\n\t * !static showMasks (value: boolean, allMasks?: boolean) : void;\n\t */\n\tshowMasks: function (value, allMasks=true)\n\t{\n\t\tworld.getScene(world.SCENE_MAIN).getContainer(world.LAYER_MASK).visible(value);\n\t\tglobals.debugMasks = allMasks;\n\t},\n\n\t/**\n\t * Creates a group in the active scene and selects it as the active group.\n\t * !static createGroup (id?: string) : Group;\n\t */\n\tcreateGroup: function(id=null)\n\t{\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('createGroup: use selectScene first to select the active scene.');\n\n\t\tthis.activeGroup = Group.Pool.alloc(id);\n\t\tthis.activeScene.addGroup(this.activeGroup);\n\n\t\treturn this.activeGroup;\n\t},\n\n\t/**\n\t * If coordinates are provided the group will be translated to the specified position. It will then set `lastGroup`, and nullify `activeGroup`.\n\t * !static endGroup (x?: number, y?: number) : Group;\n\t */\n\tendGroup: function(x=null, y=null)\n\t{\n\t\tif (x !== null && y !== null)\n\t\t\tthis.activeGroup.translate(x, y);\n\n\t\tthis.lastGroup = this.activeGroup;\n\t\tthis.activeGroup = null;\n\n\t\treturn this.lastGroup.sync();\n\t},\n\n\t/**\n\t * Creates a named Element and adds it to the specified container (or the active one) in the active scene.\n\t * If a group is active, the element will be attached to the group.\n\t * \n\t * !static createElement (id: string, x: number, y: number, img?: Drawable, containerIndex?: number) : Element;\n\t */\n\t/**\n\t * Creates an Element and adds it to the specified container (or the active one) in the active scene.\n\t * If a group is active, the element will be attached to the group.\n\t * \n\t * !static createElement (x: number, y: number, img?: Drawable, containerIndex?: number) : Element;\n\t */\n\tcreateElement: function (id, x, y, img=null, containerIndex=null)\n\t{\n\t\tif (typeof(id) !== 'string')\n\t\t{\n\t\t\tcontainerIndex = img;\n\t\t\timg = y;\n\t\t\ty = x;\n\t\t\tx = id;\n\t\t\tid = null;\n\t\t}\n\n\t\tlet container = this.getContainer(containerIndex);\n\n\t\tlet elem = Element.Pool.alloc(x, y, img);\n\t\tcontainer.add(elem.setId(id));\n\n\t\tif (this.activeGroup !== null)\n\t\t\tthis.activeGroup.addChild(elem);\n\n\t\tthis.lastElement = elem;\n\t\treturn elem;\n\t},\n\n\t/**\n\t * Creates a named mask and adds it to the specified container or LAYER_MASK if none provided.\n\t * If a group is active, the mask will be attached to the group.\n\t * \n\t * !static createMask (id: string, type: number, x?: number, y?: number, width?: number, height?: number, containerIndex?: number) : Mask;\n\t */\n\tcreateMask: function (id, type, x=null, y=null, width=null, height=null, containerIndex=null)\n\t{\n\t\tlet container = this.getContainer(containerIndex || world.LAYER_MASK);\n\n\t\tif (x === null)\n\t\t{\n\t\t\tif (this.activeGroup === null)\n\t\t\t\tthrow new Error ('createMask: create a group first to use default masks.');\n\n\t\t\tx = this.activeGroup.bounds.x1;\n\t\t\ty = this.activeGroup.bounds.y1;\n\t\t\twidth = this.activeGroup.bounds.width();\n\t\t\theight = this.activeGroup.bounds.height();\n\t\t}\n\n\t\tlet mask = Mask.Pool.alloc(type, x, y, width, height);\n\t\tcontainer.add(mask.setId(id));\n\n\t\tif (this.activeGroup !== null)\n\t\t\tthis.activeGroup.addChild(mask);\n\n\t\treturn mask;\n\t},\n\n\t/**\n\t * Creates a named label element and adds it to the specified container (or the active one) in the active scene.\n\t * If a group is active, the label element will be attached to the group.\n\t * \n\t * !static createLabel (id: string, x: number, y: number, font: object, text: string, containerIndex?: number) : Label;\n\t */\n\t/**\n\t * Creates a label element and adds it to the specified container (or the active one) in the active scene.\n\t * If a group is active, the label element will be attached to the group.\n\t * \n\t * !static createLabel (x: number, y: number, font: object, text: string, containerIndex?: number) : Label;\n\t */\n\tcreateLabel: function (id, x, y, font, text, containerIndex=null)\n\t{\n\t\tif (typeof(id) !== 'string')\n\t\t{\n\t\t\tcontainerIndex = text;\n\t\t\ttext = font;\n\t\t\tfont = y;\n\t\t\ty = x;\n\t\t\tx = id;\n\t\t\tid = null;\n\t\t}\n\n\t\tlet container = this.getContainer(containerIndex);\n\n\t\tlet elem = Label.Pool.alloc(x, y, font, text);\n\t\tcontainer.add(elem.setId(id));\n\n\t\tif (this.activeGroup !== null)\n\t\t\tthis.activeGroup.addChild(elem);\n\n\t\tthis.lastElement = elem;\n\t\treturn elem;\n\t},\n\n\t/**\n\t * Creates a new updater, attaches it to the active scene and returns it.\n\t * !static createUpdater (update?: (elem: Element, dt: number, context: object) => boolean, context?: object) : Updater;\n\t */\n\tcreateUpdater: function (update=null, context=null)\n\t{\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('createUpdater: use selectScene first to select the active scene.');\n\n\t\treturn new Updater (this.activeScene, update, context);\n\t}\n};\n\n//!/class\n\nexport default world;\n","\n//!/**\n//! * Registered resources. Initially these are resource descriptors, but after a call to `res.load` these will be fully loaded resources.\n//! */\n//:const r : { \\[key: string\\]: any };\n\nconst r = {\n};\n\nexport default r;\n","\nimport Resources from '../resources/resources.js';\nimport r from './r.js';\n\n// TODO add an interface to change the parameter of image resources using methods instead of passing the properties.\n\n/**\n * Resource manager allows to specify resource descriptors to load them.\n */\n\n//!namespace res\n\n\t//!type AnimationResource =\n\n\t\t/**\n\t\t * Sets the default FPS value.\n\t\t * !fps (value: number) : AnimationResource;\n\t\t */\n\n\t\t/**\n\t\t * Defines an animation sequence.\n\t\t * !seq (sequenceName: string, isLoop: boolean, frameGroup: string, fps?: number) : AnimationResource;\n\t\t */\n\n\t\t/**\n\t\t * Defines a transition sequence.\n\t\t * !trans (sourceSequenceName: string, destinationSequenceName: string, frameGroup: string) : AnimationResource;\n\t\t */\n\n\t\t/**\n\t\t * Sets the default animation sequence.\n\t\t * !def (sequenceName: string) : AnimationResource;\n\t\t */\n\n\t//!/type\n\n\t//!type SpritesheetResource =\n\n\t\t/**\n\t\t * Adds a frame to the spritesheet given its coordinates.\n\t\t * !frame (x: number, y: number, width: number, height: number) : SpritesheetResource;\n\t\t */\n\n\t//!/type\n\n//!/namespace\n\n//!class res\n\nconst res =\n{\n\t/**\n\t * Configures the resources object with the specified options.\n\t * !static config (options: Resources.ConfigOptions) : void;\n\t */\n\tconfig: function (opts)\n\t{\n\t\tResources.config(opts);\n\t},\n\n\t/**\n\t * Loads all registered resources that have not been loaded yet.\n\t * !static load (progressCallback?: (t: number, name: string) => void) : Promise<void>;\n\t */\n\tload: function (progressCallback=null)\n\t{\n\t\treturn new Promise (function (resolve, reject)\n\t\t{\n\t\t\tResources.load (r,\n\t\t\t\tfunction (index, total, value, name) {\n\t\t\t\t\tif (progressCallback) progressCallback(value, name);\n\t\t\t\t},\n\t\t\t\tfunction () {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t},\n\n\t/**\n\t * Returns a resource given its identifier.\n\t * !static get (id: string) : object;\n\t */\n\tget: function (id)\n\t{\n\t\tif (!r.hasOwnProperty(id))\n\t\t\tthrow new Error('Resource not found: ' + id);\n\n\t\treturn r[id];\n\t},\n\n\t/**\n\t * Checks if the ID exists in the fxl `r` map, throws an error if it does.\n\t */\n\t__resIdMustNotExist: function (id)\n\t{\n\t\tif (r.hasOwnProperty(id)) throw new Error ('Resource identifier `' + id + '` is already in use');\n\t},\n\n\t/**\n\t * Registers a solid-color resource.\n\t * !static color (id: string, color: string, width: number, height: number) : Texture;\n\t */\n\tcolor: function (id, color, width, height)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'object', wrapper: 'Custom', color: color, width: width, height: height };\n\t},\n\n\t/**\n\t * Registers a custom drawable resource.\n\t * !static custom (id: string, width: number, height: number, drawFunction: (g: Canvas) => void) : Texture;\n\t */\n\tcustom: function (id, width, height, drawFunction, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'object', wrapper: 'Custom', width: width, height: height, draw: drawFunction, ...opts };\n\t},\n\n\t/**\n\t * Registers an image resource.\n\t * !static image (id: string, path: string, opts?: object) : Texture;\n\t */\n\timage: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'image', wrapper: 'Drawable', src: path, ...opts };\n\t},\n\n\t/**\n\t * Registers a multi image resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file. Ensure to add the \"#\" marks to replace the file index (i.e. \"image-##.png\").\n\t * @param count - Number of images to load (from 0 to count-1).\n\t * !static images (id: string, path: string, count: number, frameWidth?: number, frameHeight?: number, configOptions?: object, resOptions?: object) : object;\n\t */\n\timages: function (id, path, count, frameWidth=null, frameHeight=null, configOptions=null, resOptions=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\t\treturn r[id] = { type: 'images', wrapper: 'Spritesheet', src: path, count: count, width: frameWidth, height: frameHeight,\n\t\t\tconfig: {\n\t\t\t\tframeWidth: frameWidth, frameHeight: frameHeight, ...configOptions\n\t\t\t},\n\t\t\t...resOptions\n\t\t};\n\t},\n\n\t/**\n\t * Registers an spritesheet resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file.\n\t * !static spritesheet (id: string, path: string, frameWidth: number, frameHeight: number, numFrames?: number, configOptions?: object, resOptions?: object) : res.SpritesheetResource;\n\t */\n\t/**\n\t * Registers an spritesheet resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file.\n\t * @param coords - Array of coordinates of each frame.\n\t * !static spritesheet (id: string, path: string, frameWidth: number, frameHeight: number, coords: Array<[x,y,w,h]>, configOptions?: object, resOptions?: object) : res.SpritesheetResource;\n\t */\n\tspritesheet: function (id, path, frameWidth, frameHeight, numFrames=0, configOptions=null, resOptions=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'image', wrapper: 'Spritesheet', src: path,\n\t\t\tconfig: {\n\t\t\t\tframeWidth: frameWidth, frameHeight: frameHeight,\n\t\t\t\tnumFrames: typeof(numFrames) === 'number' ? numFrames : 0,\n\t\t\t\tcoords: typeof(numFrames) === 'number' ? null : numFrames,\n\t\t\t\t...configOptions\n\t\t\t},\n\t\t\t...resOptions,\n\n\t\t\tframe: function (x, y, w, h)\n\t\t\t{\n\t\t\t\tif (!this.config.coords)\n\t\t\t\t\tthis.config.coords = [];\n\n\t\t\t\tthis.config.coords.push([x, y, w, h]);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t};\n\t},\n\n\t/**\n\t * Registers a spritesheet animation resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file.\n\t * !static animation (id: string, path: string, frameWidth: number, frameHeight: number, numFrames?: number, configOptions?: object, resOptions?: object) : res.AnimationResource;\n\t */\n\tanimation: function (id, path, frameWidth, frameHeight, numFrames=null, configOptions=null, resOptions=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'image', wrapper: 'SpritesheetAnimation', src: path,\n\t\t\tconfig: {\n\t\t\t\tframeWidth: frameWidth, frameHeight: frameHeight, numFrames: numFrames, ...configOptions\n\t\t\t},\n\n\t\t\tanim: {\n\t\t\t\tdef: null, fps: 15, seq: { }, trans: { }\n\t\t\t},\n\n\t\t\t...resOptions,\n\n\t\t\tfps: function(value) {\n\t\t\t\tthis.anim.fps = value;\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\tseq: function(id, loop, group, fps=null)\n\t\t\t{\n\t\t\t\tthis.anim.seq[id] = { loop: loop, group: group };\n\n\t\t\t\tif (fps !== null)\n\t\t\t\t\tthis.anim.seq[id].fps = fps;\n\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\ttrans: function(srcSeq, dstSeq, group)\n\t\t\t{\n\t\t\t\tif (!(srcSeq in this.anim.trans))\n\t\t\t\t\tthis.anim.trans[srcSeq] = { };\n\n\t\t\t\tthis.anim.trans[srcSeq][dstSeq] = group;\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\tdef: function(value) {\n\t\t\t\tthis.anim.def = value;\n\t\t\t\treturn this;\n\t\t\t}\n\t\t};\n\t},\n\n\t/**\n\t * Registers a spritefont animation resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file.\n\t * !static spritefont (id: string, path: string, charWidth: number, charHeight: number, charset: string, optsA?: object, optsB?: object) : object;\n\t */\n\tspritefont: function (id, path, charWidth, charHeight, charset, optsA=null, optsB=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\t\t\n\t\treturn r[id] = { type: 'image', wrapper: 'SpriteFont', src: path,\n\t\t\tfont: {\n\t\t\t\tcharWidth: charWidth, charHeight: charHeight, charset: charset, ...optsA\n\t\t\t},\n\t\t\t...optsB\n\t\t};\n\t},\n\n\t/**\n\t * Registers a JSON data resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file.\n\t * !static json (id: string, path: string, opts?: object) : object;\n\t */\n\tjson: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'json', src: path, ...opts };\n\t},\n\n\t/**\n\t * Registers a binary data resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file.\n\t * !static data (id: string, path: string, opts?: object) : object;\n\t */\n\tdata: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'data', src: path, ...opts };\n\t},\n\n\t/**\n\t * Registers a text data resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file.\n\t * !static text (id: string, path: string, opts?: object) : object;\n\t */\n\ttext: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'text', src: path, ...opts };\n\t},\n\n\t/**\n\t * Registers a sound effect audio resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file.\n\t * !static sfx (id: string, path: string, opts?: object) : object;\n\t */\n\tsfx: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'audio', wrapper: 'Sound', src: path, track: 'sfx', ...opts };\n\t},\n\n\t/**\n\t * Registers a multi sound effect audio resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file. Ensure to add the \"#\" marks to replace the file index (i.e. \"sound-##.ogg\").\n\t * @param count - Number of sounds to load (from 0 to count-1).\n\t * @param mode - Playback mode, can be `sequential` (default) or `random`.\n\t * !static sfxm (id: string, path: string, count: number, mode?: string) : object;\n\t */\n\tsfxm: function (id, path, count, mode='sequential')\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\t\treturn r[id] = { type: 'audios', wrapper: 'SoundArray', src: path, count: count, track: 'sfx', mode: mode };\n\t},\n\n\t/**\n\t * Registers an music audio resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file.\n\t * !static music (id: string, path: string) : object;\n\t */\n\tmusic: function (id, path)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'audio', wrapper: 'Sound', src: path, track: 'music' };\n\t}\n};\n\nexport default res;\n","\nimport { Class } from 'rinn';\nimport Stick from '../flow/stick.js';\nimport Button from '../flow/button.js';\nimport Group from '../flow/group.js';\n\n//![import '../flow/stick.js']\n//![import '../flow/button.js']\n\n/**\n * Gamepads are input objects that allow sticks and buttons to be added to it.\n */\n\n//!class Gamepad\n\nconst Gamepad = Class.extend\n({\n\t/**\n\t * Contains the sticks of the gamepad.\n\t * !readonly sticks: { \\[key:string\\]: Stick };\n\t */\n\tsticks: null,\n\n\t/**\n\t * Contains the buttons of the gamepad.\n\t * !readonly buttons: { \\[key:string\\]: Button };\n\t */\n\tbuttons: null,\n\n\t/**\n\t * World scene where the container is defined.\n\t */\n\tscene: null,\n\n\t/**\n\t * Container where the gamepad controls will be created.\n\t */\n\tcontainer: null,\n\n\t/**\n\t * Indicates the visible state of the gamepad.\n\t */\n\t_visible: true,\n\n\t/**\n\t * Group containing all elements (buttons, sticks or user-added elements) that belong to the gamepad.\n\t * !readonly group: Group;\n\t */\n\tgroup: null,\n\n\t/**\n\t * Constructs a new gamepad object.\n\t * !constructor (scene: Scene, containerIndex: number);\n\t */\n\t__ctor: function(scene, containerIndex)\n\t{\n\t\tthis.sticks = { };\n\t\tthis.buttons = { };\n\n\t\tthis.scene = scene;\n\t\tthis.layer = scene.getContainer(containerIndex);\n\n\t\tthis.group = Group.Pool.alloc();\n\t},\n\n\t/**\n\t * Creates a new stick control and adds it to the gamepad.\n\t * !addStick (id: string, x: number, y: number, outerDrawable: Drawable, innerDrawable: Drawable, maxRadius?: number|0) : Stick;\n\t */\n\taddStick: function (id, x, y, outerDrawable, innerDrawable, maxRadius=0)\n\t{\n\t\tif (maxRadius == 0)\n\t\t\tmaxRadius = outerDrawable.width - innerDrawable.width;\n\n\t\tlet stick = new Stick (this.layer, x, y, maxRadius, outerDrawable, innerDrawable);\n\n\t\tthis.sticks[id] = stick;\n\t\tthis[id] = stick;\n\n\t\tthis.group.addChild(stick);\n\t\treturn stick;\n\t},\n\n\t/**\n\t * Creates a new button control and adds it to the gamepad.\n\t * !addButton (id: string, x: number, y: number, unpressedDrawable?: Drawable|null, pressedDrawable?: Drawable|null) : Button;\n\t */\n\taddButton: function (id, x, y, unpressedDrawable=null, pressedDrawable=null)\n\t{\n\t\tlet button = new Button (this.layer, x, y, unpressedDrawable, pressedDrawable);\n\n\t\tthis.buttons[id] = button;\n\t\tthis[id] = button;\n\n\t\tthis.group.addChild(button);\n\t\treturn button;\n\t},\n\n\t/**\n\t * Returns the `visible` property of the gamepad.\n\t * !visible() : boolean;\n\t */\n\t/**\n\t * Sets the `visible` property of the gamepad.\n\t * !visible (value: boolean) : Gamepad;\n\t */\n\tvisible: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._visible;\n\n\t\tthis._visible = value;\n\n\t\tfor (let i in this.sticks)\n\t\t\tthis.sticks[i].visible(value);\n\n\t\tfor (let i in this.buttons)\n\t\t\tthis.buttons[i].visible(value);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the `visible` property of all masks to the specified value.\n\t * !showMasks (value: boolean) : Gamepad;\n\t */\n\tshowMasks: function (value)\n\t{\n\t\tfor (let i in this.sticks)\n\t\t\tthis.sticks[i].hitbox.visible(value, true);\n\n\t\tfor (let i in this.buttons)\n\t\t\tthis.buttons[i].hitbox.visible(value, true);\n\n\t\treturn this;\n\t}\n});\n\n//!/class\n\nexport default Gamepad;\n","\nimport PointerHandler from '../flow/pointer-handler.js';\nimport KeyboardHandler from '../flow/keyboard-handler.js';\nimport Handler from '../utils/handler.js';\n\nimport world from './world.js';\nimport system from './system.js';\n\nimport Gamepad from './gamepad.js';\n\n//!namespace input\n\n//:[import './gamepad.js']\n\n\t//:type PointerCallback = (action: System.PointerEventType, pointer: System.Pointer, arg0?: any, arg1?: any, args2?: any) => void;\n\t//:type KeyboardCallback = (action: System.KeyboardEventType, keyCode: KeyCode, keyState: System.KeyboardState, arg0?: any, arg1?: any, args2?: any) => void;\n\n//!/namespace\n\n//!class input\n\n/**\n * Input system allows to interface with the pointer and keyboard devices. And to create on-screen gamepads.\n */\n\nconst input =\n{\n\t/**\n\t * Registered gamepads.\n\t */\n\t_gamepads: [],\n\n\t/**\n\t * Currently active gamepad.\n\t * !static activeGamepad: input.Gamepad;\n\t */\n\tactiveGamepad: null,\n\n\t/**\n\t * Last created button.\n\t * !static lastButton: Button;\n\t */\n\tlastButton: null,\n\n\t/**\n\t * Last created stick.\n\t * !static lastStick: Stick;\n\t */\n\tlastStick: null,\n\n\t/**\n\t * Cursor object, used to control the state of the single-cursor input.\n\t */\n\tcursor:\n\t{\n\t\t/**\n\t\t * Indicates if the single-cursor input has been enabled.\n\t\t */\n\t\t_enabled: null,\n\n\t\t/**\n\t\t * Handler callback for cursor events.\n\t\t */\n\t\t_handler: null,\n\n\t\t/**\n\t\t * Cursor element used when the single-cursor input is enabled.\n\t\t */\n\t\t_element: null,\n\n\t\t/**\n\t\t * Pointer state related to the cursor when single-cursor input is enabled.\n\t\t */\n\t\tpointer: null,\n\n\t\t/**\n\t\t * Returns the element used for single-cursor input.\n\t\t */\n\t\telement: function (elem=false)\n\t\t{\n\t\t\tif (elem === false)\n\t\t\t\treturn this._element;\n\n\t\t\tthis._element = elem;\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Hides or shows the native cursor.\n\t\t */\n\t\tnative: function (value)\n\t\t{\n\t\t\tif (!value && system.renderer.elem.style.cursor !== 'none')\n\t\t\t\tsystem.renderer.elem.style.cursor = 'none';\n\t\t\telse if (value && system.renderer.elem.style.cursor === 'none')\n\t\t\t\tsystem.renderer.elem.style.removeProperty('cursor');\n\t\t},\n\n\t\t/**\n\t\t * Enables or disables the single-cursor input.\n\t\t */\n\t\tenabled: function (value=null)\n\t\t{\n\t\t\tif (value === null)\n\t\t\t\treturn this._enabled;\n\n\t\t\tif (this._enabled === value)\n\t\t\t\treturn this;\n\n\t\t\tthis._enabled = value;\n\n\t\t\tif (value === true)\n\t\t\t{\n\t\t\t\tif (this._element !== null)\n\t\t\t\t\tsystem.renderer.elem.style.cursor = 'none';\n\n\t\t\t\tPointerHandler.register(this.pointerHandler);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsystem.renderer.elem.style.removeProperty('cursor');\n\t\t\t\tPointerHandler.unregister(this.pointerHandler);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Sets the callback to execute when a cursor event happens.\n\t\t * @param { (action:number, pointer:object) => void } callback\n\t\t */\n\t\thandler: function (callback)\n\t\t{\n\t\t\tthis._handler = callback;\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Pointer event handler for single-cursor input.\n\t\t */\n\t\tpointerHandler:\n\t\t{\n\t\t\tpriority: 50,\n\n\t\t\tonPointerEvent: function (action, pointer, pointers)\n\t\t\t{\n\t\t\t\tif (!input.cursor._enabled)\n\t\t\t\t\treturn;\n\n\t\t\t\tinput.cursor.pointer = pointer;\n\n\t\t\t\tif (input.cursor._element !== null)\n\t\t\t\t\tinput.cursor._element.setPosition(pointer.x, pointer.y);\n\n\t\t\t\tif (input.cursor._handler !== null)\n\t\t\t\t\tinput.cursor._handler (action, pointer);\n\t\t\t},\n\t\t},\n\t},\n\n\t/**\n\t * Pointer related functions.\n\t * !static pointer: {\n\t */\n\tpointer:\n\t{\n\t\t/**\n\t\t * Pointer handler.\n\t\t */\n\t\t_handler: null,\n\n\t\t/**\n\t\t * Context.\n\t\t */\n\t\tcontext: null,\n\n\t\t/**\n\t\t * Initializes the pointer input system.\n\t\t */\n\t\tinit: function ()\n\t\t{\n\t\t\tif (this._handler !== null)\n\t\t\t\treturn;\n\n\t\t\tthis._handler = Handler.Pool.alloc();\n\t\t\tthis.context = { action: null, pointer: null, pointers: null };\n\n\t\t\tPointerHandler.register(this);\n\t\t},\n\n\t\t/**\n\t\t * General pointer event handler.\n\t\t */\n\t\tonPointerEvent: function (action, pointer, pointers)\n\t\t{\n\t\t\tthis.context.action = action;\n\t\t\tthis.context.pointer = pointer;\n\t\t\tthis.context.pointers = pointers;\n\n\t\t\tthis._handler.exec(this.context);\n\t\t},\n\n\t\t/**\n\t\t * Adds a callback to the pointer event dispatcher.\n\t\t * !add: (callback: fxl.input.PointerCallback, arg0?: any, arg1?: any, arg2?: any) => Callback;\n\t\t */\n\t\tadd: function (callback, arg0=null, arg1=null, arg2=null)\n\t\t{\n\t\t\tif (this._handler === null)\n\t\t\t\tthis.init();\n\n\t\t\treturn this._handler.add (this._handler_callback, callback, arg0, arg1, arg2);\n\t\t},\n\n\t\t/**\n\t\t * Removes a callback from the pointer event dispatcher.\n\t\t * @param {Callback} callback - The node returned by the `add` method.\n\t\t * !remove: (callback: Callback) => void;\n\t\t */\n\t\tremove: function (callback)\n\t\t{\n\t\t\ththis._handler.remove (callback);\n\t\t},\n\n\t\t_handler_callback: function (context, callback, arg0, arg1, arg2)\n\t\t{\n\t\t\treturn callback (context.action, context.pointer, arg0, arg1, arg2);\n\t\t},\n\t},\n\t//!};\n\n\t/**\n\t * Keyboard related functions.\n\t * !keyboard: {\n\t */\n\tkeyboard:\n\t{\n\t\t/**\n\t\t * Keyboard handler.\n\t\t */\n\t\t_handler: null,\n\n\t\t/**\n\t\t * Context.\n\t\t */\n\t\tcontext: null,\n\n\t\t/**\n\t\t * Initializes the keyboard input system.\n\t\t */\n\t\tinit: function ()\n\t\t{\n\t\t\tif (this._handler !== null)\n\t\t\t\treturn;\n\n\t\t\tthis._handler = Handler.Pool.alloc();\n\t\t\tthis.context = { action: null, keyCode: null, keybState: null };\n\n\t\t\tKeyboardHandler.register(this);\n\t\t},\n\n\t\t/**\n\t\t * General keyboard event handler.\n\t\t */\n\t\tonKeyboardEvent: function (action, keyCode, keybState)\n\t\t{\n\t\t\tthis.context.action = action;\n\t\t\tthis.context.keyCode = keyCode;\n\t\t\tthis.context.keybState = keybState;\n\n\t\t\tthis._handler.exec(this.context);\n\t\t},\n\n\t\t/**\n\t\t * Adds a callback to the keyboard event dispatcher.\n\t\t * !add: (callback: fxl.input.KeyboardCallback, arg0?: any, arg1?: any, arg2?: any) => Callback;\n\t\t */\n\t\tadd: function (callback, arg0=null, arg1=null, arg2=null)\n\t\t{\n\t\t\tif (this._handler === null)\n\t\t\t\tthis.init();\n\n\t\t\treturn this._handler.add (this._handler_callback, callback, arg0, arg1, arg2);\n\t\t},\n\n\t\t/**\n\t\t * Removes a callback from the keyboard event dispatcher.\n\t\t * @param {Callback} callback - The node returned by the `add` method.\n\t\t * !remove: (callback: Callback) => void;\n\t\t */\n\t\tremove: function (callback)\n\t\t{\n\t\t\tthis._handler.remove (callback);\n\t\t},\n\n\t\t_handler_callback: function (context, callback, arg0, arg1, arg2)\n\t\t{\n\t\t\treturn callback (context.action, context.keyCode, context.keybState, arg0, arg1, arg2);\n\t\t},\n\t},\n\t//!};\n\n\t/**\n\t * Creates a gamepad object and attaches it to the SCENE_HUD in the specified layer (defaults to LAYER_HUD_MAIN).\n\t * !static createGamepad (index: number, layerIndex?: number) : input.Gamepad;\n\t */\n\tcreateGamepad: function (index, layerIndex=null)\n\t{\n\t\tlayerIndex = layerIndex !== null ? layerIndex : world.LAYER_HUD_MAIN;\n\n\t\tworld.selectScene(world.SCENE_HUD);\n\t\tworld.selectContainer(layerIndex);\n\n\t\tthis._gamepads[index] = new Gamepad (world.activeScene, layerIndex);\n\t\tthis.selectGamepad(index);\n\n\t\treturn this.activeGamepad;\n\t},\n\n\t/**\n\t * Returns a gamepad given its index.\n\t * !static getGamepad (index: number) : input.Gamepad;\n\t */\n\tgetGamepad: function (index)\n\t{\n\t\tif (index < 0 || index >= this._gamepads.length)\n\t\t\treturn null;\n\n\t\treturn this._gamepads[index] || null;\n\t},\n\n\t/**\n\t * Selects the active gamepad for subsequent gamepad-level operations.\n\t * !static selectGamepad (index: number) : boolean;\n\t */\n\tselectGamepad: function (index)\n\t{\n\t\tthis.activeGamepad = this.getGamepad(index);\n\t\treturn true;\n\t},\n\n\t/**\n\t * Sets the value of `debugBounds` on the specified gamepad. If index is `null`, all gamepads will be selected.\n\t * !static debugGamepad (index: number, value: boolean) : void;\n\t */\n\tdebugGamepad: function (index, value)\n\t{\n\t\tif (index === null)\n\t\t{\n\t\t\tfor (let i = 0; i < this._gamepads.length; i++)\n\t\t\t{\n\t\t\t\tif (!this._gamepads[i])\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis.debugGamepad(i, value);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis._gamepads[index].debug(value);\n\t},\n\n\t/**\n\t * Adds an stick control to the active gamepad.\n\t * !static stick (id: string, x: number, y: number, outerDrawable: Drawable, innerDrawable: Drawable, maxRadius?: number|0) : Stick;\n\t */\n\tstick: function (id, x, y, outerDrawable, innerDrawable, maxRadius=0)\n\t{\n\t\tif (this.activeGamepad === null)\n\t\t\tthrow new Error ('input.addStick: use input.selectGamepad first to select the active gamepad.');\n\n\t\treturn this.lastStick = this.activeGamepad.addStick (id, x, y, outerDrawable, innerDrawable, maxRadius);\n\t},\n\n\t/**\n\t * Adds a button control to the active gamepad.\n\t * !static button (id: string, x: number, y: number, unpressedDrawable?: Drawable|null, pressedDrawable?: Drawable|null) : Button;\n\t */\n\tbutton: function (id, x, y, unpressedDrawable=null, pressedDrawable=null)\n\t{\n\t\tif (this.activeGamepad === null)\n\t\t\tthrow new Error ('input.addButton: use input.selectGamepad first to select the active gamepad.');\n\n\t\treturn this.lastButton = this.activeGamepad.addButton (id, x, y, unpressedDrawable, pressedDrawable);\n\t}\n};\n\n//!/class\n\nexport default input;\n","\nimport Bounds2 from '../math/bounds2.js';\nimport GridElement from '../flow/grid-element.js';\nimport Handler from '../utils/handler.js';\n\nimport world from './world.js';\n\n/**\n * \tMask used to isolate the super-type of a type.\n */\nconst SUPER_TYPE_MASK = 0xFFFFF000;\n\n/**\n * \tThe collider system is responsible of detecting collisions and performing the respective actions.\n */\n\n//!class collider\n\nconst collider =\n{\n\t/**\n\t * \tFlag used to exclude from collision checks.\n\t *\t!static readonly FLAG_EXCLUDE: number;\n\t */\n\tFLAG_EXCLUDE: GridElement.allocFlag(),\n\n\t/**\n\t * \tContact rules, define what to do when certain types of elements are in contact.\n\t */\n\tcontactRules: { },\n\n\t/**\n\t * \tTruncation rules, indicate which type of elements are not allowed to penetrate each other.\n\t */\n\ttruncationRules: { },\n\n\t/**\n\t *\tScene where the mask layer is contained.\n\t */\n\tscene: null,\n\n\t/**\n\t *\tLayer containing the element masks.\n\t */\n\tmaskLayer: null,\n\n\t/**\n\t *\tFirst updater.\n\t *\t!static fupdater: Handler;\n\t */\n\tfupdater: null,\n\n\t/**\n\t *\tLast updater.\n\t *\t!static lupdater: Handler;\n\t */\n\tlupdater: null,\n\n\t/**\n\t *\tFlags used to filter elements.\n\t *\t!static flagsAnd: number;\n\t *\t!static flagsValue: number;\n\t */\n\tflagsAnd: 0,\n\tflagsValue: 0,\n\n\t/**\n\t *\tCurrent collider state fields.\n\t *\t!static state: {\n\t */\n\tstate:\n\t{\n\t\t/**\n\t\t * \tContact area.\n\t\t *\t!contact: Bounds2;\n\t\t */\n\t\tcontact: Bounds2.Pool.alloc(),\n\n\t\t/**\n\t\t * \tContact flags.\n\t\t * \t!flags: collider.Contact;\n\t\t */\n\t\tflags: 0,\n\n\t\t/**\n\t\t * \tFinal delta value for X-coordinate calculated by `translate`.\n\t\t *\t!dx: number;\n\t\t */\n\t\tdx: 0,\n\n\t\t/**\n\t\t * \tFinal delta value for Y-coordinate calculated by `translate`.\n\t\t *\t!dy: number;\n\t\t */\n\t\tdy: 0,\n\n\t\tbounds: Bounds2.Pool.alloc(),\n\n\t\tx: new Array(32).fill(0),\n\t\ty: new Array(32).fill(0),\n\t\tv0x: new Array(32).fill(0),\n\t\tv0y: new Array(32).fill(0),\n\t\tv1x: new Array(32).fill(0),\n\t\tv1y: new Array(32).fill(0),\n\t\tv2x: new Array(32).fill(0),\n\t\tv2y: new Array(32).fill(0),\n\n\t\tcount: 0,\n\t\ttarget: 0,\n\n\t\tv0: 0, w0: 0, delta0: 0,\n\t\tv1: 0, w1: 0, delta1: 0,\n\n\t\tw2: 0,\n\t\tt_dx: 0,\n\t\tt_dy: 0,\n\t},\n\t//:}\n\n\t/**\n\t *\tEnables the collider system on the specified scene and layer.\n\t * \t@param sceneIndex - Scene to attach the collider updater methods. Uses world.SCENE_MAIN if none specified.\n\t * \t@param layerIndex - Index within the scene of the layer where element masks are stored. Uses world.LAYER_MASK if none specified.\n\t * \t!static enable (sceneIndex?: number, layerIndex?: number) : void;\n\t */\n\tenable: function (sceneIndex=null, layerIndex=null)\n\t{\n\t\tthis.scene = world.getScene(sceneIndex || world.SCENE_MAIN);\n\t\tthis.maskLayer = this.scene.getContainer(layerIndex || world.LAYER_MASK);\n\n\t\tthis.flagsAnd = GridElement.ALIVE | GridElement.VISIBLE | collider.FLAG_EXCLUDE;\n\t\tthis.flagsValue = GridElement.ALIVE | GridElement.VISIBLE;\n\n\t\tthis.scene.fupdater.add(this.firstUpdate, this);\n\t\tthis.scene.lupdater.add(this.lastUpdate, this);\n\n\t\tthis.fupdater = Handler.Pool.alloc(this);\n\t\tthis.lupdater = Handler.Pool.alloc(this);\n\t},\n\n\t/**\n\t *\tDisables the collider system.\n\t *\t!static disable() : void;\n\t */\n\tdisable: function()\n\t{\n\t\tthis.scene.fupdater.remove(this.update, this);\n\t\tthis.maskLayer = null;\n\n\t\tthis.fupdater.free();\n\t\tthis.lupdater.free();\n\t},\n\n\t/**\n\t * \tRuns a first update cycle `fupdater` will be executed.\n\t */\n\tfirstUpdate: function(scene, self)\n\t{\n\t\tself.fupdater.exec();\n\t},\n\n\t/**\n\t * \tRuns a last update cycle `lupdater` will be executed.\n\t */\n\tlastUpdate: function(scene, self)\n\t{\n\t\tself.lupdater.exec();\n\t},\n\n\t/**\n\t * \tUtility object containing actions that are executed later on the next update cycle.\n\t * \t!static later: {\n\t */\n\tlater:\n\t{\n\t\t/**\n\t\t *\tRuns the specified callback.\n\t\t *\t!run (elem: Element, callback: Function, arg1?: any, arg2?: any, arg3?: any) : void;\n\t\t */\n\t\trun: function (elem, callback, arg1, arg2, arg3)\n\t\t{\n\t\t\tcollider.fupdater.add(this._run, elem, callback, arg1, arg2, arg3);\n\t\t},\n\n\t\t/**\n\t\t *\tSets the element's visibility flag.\n\t\t * \t!setVisible (elem: Element, value: boolean) : void;\n\t\t */\n\t\tsetVisible: function (elem, value)\n\t\t{\n\t\t\tcollider.fupdater.add(this._setVisible, elem, value);\n\t\t},\n\n\t\t/**\n\t\t *\tSets an attribute of an object to a given value.\n\t\t * \t!setValue (obj: Object, name: string, value: any) : void;\n\t\t */\n\t\tsetValue: function (obj, name, value)\n\t\t{\n\t\t\tcollider.fupdater.add(this._setValue, obj, name, value);\n\t\t},\n\n\t\t/**\n\t\t *\tSets the element's flags.\n\t\t *\t!setFlags (elem: Element, value: number) : void;\n\t\t */\n\t\tsetFlags: function (elem, value)\n\t\t{\n\t\t\tcollider.fupdater.add(this._setFlags, elem, value);\n\t\t},\n\n\t\t/**\n\t\t *\tClears the element's flags.\n\t\t * \t!clearFlags (elem: Element, value: number) : void;\n\t\t */\n\t\tclearFlags: function (elem, value)\n\t\t{\n\t\t\tcollider.fupdater.add(this._clearFlags, elem, value);\n\t\t},\n\n\t\t/* ******* */\n\n\t\t_run: function (host, elem, callback, arg1, arg2, arg3)\n\t\t{\n\t\t\tcallback (host, elem, arg1, arg2, arg3);\n\t\t\treturn false;\n\t\t},\n\n\t\t_setVisible: function (host, elem, value)\n\t\t{\n\t\t\telem.visible(value);\n\t\t\treturn false;\n\t\t},\n\n\t\t_setValue: function (host, obj, name, value)\n\t\t{\n\t\t\tobj[name] = value;\n\t\t\treturn false;\n\t\t},\n\n\t\t_setFlags: function (host, elem, value)\n\t\t{\n\t\t\telem.setFlags(value);\n\t\t\treturn false;\n\t\t},\n\n\t\t_clearFlags: function (host, elem, value)\n\t\t{\n\t\t\telem.clearFlags(value);\n\t\t\treturn false;\n\t\t}\n\t},\n\t//!}\n\n\t/**\n\t * \tAdds a contact rule.\n\t * \t@param primaryType - Type of the primary element.\n\t * \t@param secondaryType - Type of the secondary element.\n\t * \t@param callback - Callback to execute when contact is detected.\n\t * \t@param context - Optional value passed as last parameter to the callback.\n\t * \t!static contact (primaryType: number, secondaryType: number, callback: (primary: Mask, secondary: Mask, context?: any) => void, context?: any) : collider;\n\t */\n\tcontact: function (primaryType, secondaryType, callback, context=null)\n\t{\n\t\tif (!(primaryType in this.contactRules))\n\t\t\tthis.contactRules[primaryType] = { };\n\n\t\tthis.contactRules[primaryType][secondaryType] = { callback: callback, context: context };\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tAdds a truncation rule.\n\t * \t@param primaryType - Type or super-type of the primary element.\n\t * \t@param secondaryType - Type or super-type of the secondary element.\n\t * \t@param callback - Returns boolean indicating if the truncation rule should be applied.\n\t * \t@param context - Optional value passed as last parameter to the callback.\n\t * \t:static truncate (primaryType: number, secondaryType: number, callback?: (primary: Mask, secondary: Mask, context?: any) => void, context?: any) : collider;\n\t */\n\t/**\n\t * \tAdds a truncation rule.\n\t * \t@param primaryType - Type or super-type of the primary element.\n\t * \t@param secondaryType - Type or super-type of the secondary element.\n\t * \t@param value - Indicates the status of the truncation rule.\n\t * \t!static truncate (primaryType: number, secondaryType: number, value: boolean) : collider;\n\t */\n\ttruncate: function (primaryType, secondaryType, callback=null, context=null)\n\t{\n\t\tif (!(primaryType in this.truncationRules))\n\t\t\tthis.truncationRules[primaryType] = { };\n\n\t\tthis.truncationRules[primaryType][secondaryType] = { callback: callback, context: context };\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tLoads the contact flags in the collider state.\n\t *\t!static getContactFlags (boundsA: Bounds2, boundsB: Bounds2) : number;\n\t */\n\tgetContactFlags: function (boundsA, boundsB)\n\t{\n\t\tthis.state.contact.set(boundsA).setAsIntersection(boundsB);\n\t\tlet contact = this.state.contact;\n\n\t\tthis.state.flags = 0;\n\t\tthis.state.numFlags = 0;\n\n\t\tif (contact.x1 == boundsB.x1)\n\t\t{\n\t\t\tthis.state.flags |= collider.Contact.LEFT; // LEFT\n\t\t\tthis.state.numFlags++;\n\t\t}\n\n\t\tif (contact.x2 == boundsB.x2)\n\t\t{\n\t\t\tthis.state.flags |= collider.Contact.RIGHT; // RIGHT\n\t\t\tthis.state.numFlags++;\n\t\t}\n\n\t\tif (contact.y1 == boundsB.y1)\n\t\t{\n\t\t\tthis.state.flags |= collider.Contact.TOP; // TOP\n\t\t\tthis.state.numFlags++;\n\t\t}\n\n\t\tif (contact.y2 == boundsB.y2)\n\t\t{\n\t\t\tthis.state.flags |= collider.Contact.BOTTOM; // BOTTOM\n\t\t\tthis.state.numFlags++;\n\t\t}\n\n\t\treturn this.state.flags;\n\t},\n\n\tcalc: function (store0, sign, a, v0a, v1a, v1b)\n\t{\n\t\tlet n = this.state.count;\n\t\tlet delta = null;\n\t\tlet v = 0;\n\n\t\tif (sign > 0)\n\t\t{\n\t\t\tfor (let i = 0; i < n; i++)\n\t\t\t{\n\t\t\t\tif (!v0a[i] || !v1a[i] || a[i] < 0) continue;\n\n\t\t\t\tif (delta === null || a[i] > delta)\n\t\t\t\t\tdelta = a[i];\n\n\t\t\t\tv1a[i] = v1b[i] = 0;\n\t\t\t\tv += v0a[i];\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let i = 0; i < n; i++)\n\t\t\t{\n\t\t\t\tif (!v0a[i] || !v1a[i] || a[i] > 0) continue;\n\n\t\t\t\tif (delta === null || a[i] < delta)\n\t\t\t\t\tdelta = a[i];\n\n\t\t\t\tv1a[i] = v1b[i] = 0;\n\t\t\t\tv += v0a[i];\n\t\t\t}\n\t\t}\n\n\t\tif (delta === null)\n\t\t\tdelta = 0;\n\n\t\tif (store0) {\n\t\t\tthis.state.v0 = v;\n\t\t\tthis.state.w0 = Math.abs(delta);\n\t\t\tthis.state.delta0 = delta;\n\t\t} else {\n\t\t\tthis.state.v1 = v;\n\t\t\tthis.state.w1 = Math.abs(delta);\n\t\t\tthis.state.delta1 = delta;\n\t\t}\n\t},\n\n\tattemptSelect: function (swapped)\n\t{\n\t\tif (this.state.v1 + this.state.v0 === this.state.target)\n\t\t{\n\t\t\tif (this.state.w2 === null || this.state.w1 + this.state.w0 < this.state.w2)\n\t\t\t{\n\t\t\t\tthis.state.w2 = this.state.w1 + this.state.w0;\n\n\t\t\t\tif (!swapped) {\n\t\t\t\t\tthis.state.t_dx = this.state.delta1;\n\t\t\t\t\tthis.state.t_dy = this.state.delta0;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.state.t_dx = this.state.delta0;\n\t\t\t\t\tthis.state.t_dy = this.state.delta1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tload0: function()\n\t{\n\t\tlet n = this.state.count;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tthis.state.v1x[i] = this.state.v0x[i];\n\t\t\tthis.state.v1y[i] = this.state.v0y[i];\n\t\t}\n\t},\n\n\tsave1: function()\n\t{\n\t\tlet n = this.state.count;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tthis.state.v2x[i] = this.state.v1x[i];\n\t\t\tthis.state.v2y[i] = this.state.v1y[i];\n\t\t}\n\t},\n\n\tload1: function()\n\t{\n\t\tlet n = this.state.count;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tthis.state.v1x[i] = this.state.v2x[i];\n\t\t\tthis.state.v1y[i] = this.state.v2y[i];\n\t\t}\n\t},\n\n\tresolveXpos: function (single=false)\n\t{\n\t\tthis.calc (single, 1, this.state.x, this.state.v0x, this.state.v1x, this.state.v1y);\n\t\tif (single) return true;\n\n\t\tthis.save1();\n\t\tif (this.resolveYpos(true)) this.attemptSelect(false);\n\n\t\tthis.load1();\n\t\tif (this.resolveYneg(true)) this.attemptSelect(false);\n\n\t\tthis.load0();\n\t},\n\n\tresolveXneg: function (single=false)\n\t{\n\t\tthis.calc (single, -1, this.state.x, this.state.v0x, this.state.v1x, this.state.v1y);\n\t\tif (single) return true;\n\n\t\tthis.save1();\n\t\tif (this.resolveYpos(true)) this.attemptSelect(false);\n\n\t\tthis.load1();\n\t\tif (this.resolveYneg(true)) this.attemptSelect(false);\n\n\t\tthis.load0();\n\t},\n\n\tresolveYpos: function (single=false)\n\t{\n\t\tthis.calc (single, 1, this.state.y, this.state.v0y, this.state.v1y, this.state.v1x);\n\t\tif (single) return true;\n\n\t\tthis.save1();\n\t\tif (this.resolveXpos(true)) this.attemptSelect(true);\n\n\t\tthis.load1();\n\t\tif (this.resolveXneg(true)) this.attemptSelect(true);\n\n\t\tthis.load0();\n\t},\n\n\tresolveYneg: function (single=false)\n\t{\n\t\tthis.calc (single, -1, this.state.y, this.state.v0y, this.state.v1y, this.state.v1x);\n\t\tif (single) return true;\n\n\t\tthis.save1();\n\t\tif (this.resolveXpos(true)) this.attemptSelect(true);\n\n\t\tthis.load1();\n\t\tif (this.resolveXneg(true)) this.attemptSelect(true);\n\n\t\tthis.load0();\n\t},\n\n\t/**\n\t * \tCompletes the translation on the current group.\n\t */\n\tcommit: function ()\n\t{\n\t\tif (!this.state.group.alive())\n\t\t\treturn;\n\n\t\tthis.state.group.translate (this.state.dx, this.state.dy);\n\t\tthis.state.group.clearFlags (collider.FLAG_EXCLUDE);\n\t},\n\n\t/**\n\t * \tAttempts to move the specified group by the given deltas. Any collisions detected on the mask will trigger the respective actions.\n\t * \t@param mask - Mask element.\n\t * \t@param dx - X delta value.\n\t * \t@param dy - Y delta value.\n\t * \t!static translate (mask: Mask, dx: number, dy: number) : void;\n\t */\n\t/**\n\t * \tAttempts to move the specified group by the given deltas. Any collisions detected on the mask will trigger the respective actions.\n\t * \t@param mask - Mask element.\n\t * \t@param group - Group where the mask is stored.\n\t * \t@param dx - X delta value.\n\t * \t@param dy - Y delta value.\n\t * \t!static translate (mask: Mask, group: Group, dx: number, dy: number) : void;\n\t */\n\ttranslate: function (mask, group=null, dx=0, dy=0)\n\t{\n\t\tif (typeof(group) === 'number')\n\t\t{\n\t\t\tdy = dx;\n\t\t\tdx = group;\n\t\t\tgroup = null;\n\t\t}\n\n\t\tif (!mask) return;\n\n\t\tif (!group) group = mask.group;\n\n\t\tif (!group.alive() || !mask.alive())\n\t\t\treturn;\n\n\t\tthis.state.mask = mask;\n\t\tthis.state.group = group;\n\n\t\tthis.state.dx = downscalef(upscale(dx));\n\t\tthis.state.dy = downscalef(upscale(dy));\n\n\t\tif (!this.maskLayer || !mask.visible())\n\t\t\treturn this.commit();\n\n\t\tlet truncationRules = this.truncationRules[mask.type];\n\t\tif (!truncationRules)\n\t\t{\n\t\t\ttruncationRules = this.truncationRules[mask.type & SUPER_TYPE_MASK];\n\t\t\tif (!truncationRules)\n\t\t\t{\n\t\t\t\tthis.commit();\n\t\t\t\treturn this.scan(mask, group);\n\t\t\t}\n\t\t}\n\n\t\tthis.state.offs = group.getOffsets(this.state.dx, this.state.dy);\n\t\tthis.state.bounds.set(mask.bounds).translate(this.state.offs.x+this.state.dx, this.state.offs.y+this.state.dy);\n\n\t\tgroup.setFlags (collider.FLAG_EXCLUDE);\n\n\t\tlet collisionItems = this.maskLayer.selectInRegion(this.state.bounds, this.flagsAnd, this.flagsValue);\n\t\tif (collisionItems.length === 0)\n\t\t{\n\t\t\tcollisionItems.free();\n\t\t\treturn this.commit();\n\t\t}\n\n\t\tlet n = 0;\n\t\tlet v = 0;\n\n\t\twhile (true)\n\t\t{\n\t\t\tlet item = collisionItems.shift();\n\t\t\tif (item === null) break;\n\n\t\t\tlet allowsTruncation = truncationRules[item.type];\n\t\t\tif (!allowsTruncation)\n\t\t\t{\n\t\t\t\tallowsTruncation = truncationRules[item.type & SUPER_TYPE_MASK];\n\t\t\t\tif (!allowsTruncation) continue;\n\t\t\t}\n\n\t\t\tif (allowsTruncation.callback === false || (allowsTruncation.callback !== null && allowsTruncation.callback !== true && !allowsTruncation.callback(mask, item, allowsTruncation.context)))\n\t\t\t\tcontinue;\n\n\t\t\tlet width = Math.min(this.state.bounds.x2, item.bounds.x2) - Math.max(this.state.bounds.x1, item.bounds.x1);\n\t\t\tlet height = Math.min(this.state.bounds.y2, item.bounds.y2) - Math.max(this.state.bounds.y1, item.bounds.y1);\n\n\t\t\tthis.state.v0x[n] = 0;\n\t\t\tthis.state.v0y[n] = 0;\n\n\t\t\tif (Math.min(this.state.bounds.width(), item.bounds.width()) != width) {\n\t\t\t\tthis.state.x[n] = absmin(this.state.bounds.x2 - item.bounds.x1, this.state.bounds.x1 - item.bounds.x2);\n\t\t\t\tthis.state.v0x[n] = 1;\n\t\t\t}\n\n\t\t\tif (Math.min(this.state.bounds.height(), item.bounds.height()) != height) {\n\t\t\t\tthis.state.y[n] = absmin(this.state.bounds.y2 - item.bounds.y1, this.state.bounds.y1 - item.bounds.y2);\n\t\t\t\tthis.state.v0y[n] = 1;\n\t\t\t}\n\n\t\t\tlet sv = this.state.v0x[n] + this.state.v0y[n];\n\t\t\tv += sv;\n\n\t\t\tif (sv > 1) {\n\t\t\t\tthis.state.v0x[n] = sv;\n\t\t\t\tthis.state.v0y[n] = sv;\n\t\t\t}\n\n\t\t\tthis.state.v1x[n] = this.state.v0x[n];\n\t\t\tthis.state.v1y[n] = this.state.v0y[n];\n\n\t\t\tn++;\n\t\t}\n\n\t\tcollisionItems.free();\n\n\t\tif (v == 0)\n\t\t{\n\t\t\tthis.commit();\n\t\t\treturn this.scan(mask, group);\n\t\t}\n\n\t\tthis.state.target = v;\n\t\tthis.state.count = n;\n\t\tthis.state.w2 = null;\n\n\t\tthis.resolveXpos();\n\t\tthis.resolveXneg();\n\t\tthis.resolveYpos();\n\t\tthis.resolveYneg();\n\n\t\tif (this.state.w2 !== null)\n\t\t{\n\t\t\tlet contactRules = this.contactRules[mask.type];\n\t\t\tif (!contactRules) contactRules = this.contactRules[mask.type & SUPER_TYPE_MASK];\n\n\t\t\tif (contactRules)\n\t\t\t{\n\t\t\t\tthis.state.bounds.set(mask.bounds).translate(this.state.offs.x+this.state.dx-this.state.t_dx*0.5, this.state.offs.y+this.state.dy-this.state.t_dy*0.5);\n\n\t\t\t\tcollisionItems = this.maskLayer.selectInRegion(this.state.bounds, this.flagsAnd, this.flagsValue);\n\n\t\t\t\twhile (mask.alive())\n\t\t\t\t{\n\t\t\t\t\tlet item = collisionItems.shift();\n\t\t\t\t\tif (item === null) break;\n\n\t\t\t\t\tif (!item.alive())\n\t\t\t\t\t\tcontinue;\n\t\t\n\t\t\t\t\tlet contact = contactRules[item.type];\n\t\t\t\t\tif (!contact)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontact = contactRules[item.type & SUPER_TYPE_MASK];\n\t\t\t\t\t\tif (!contact) continue;\n\t\t\t\t\t}\n\n\t\t\t\t\tcontact.callback (mask, item, contact.context);\n\t\t\t\t}\n\n\t\t\t\tcollisionItems.free();\n\t\t\t}\n\n\t\t\tthis.state.dx -= this.state.t_dx;\n\t\t\tthis.state.dy -= this.state.t_dy;\n\t\t}\n\n\t\tthis.commit();\n\t},\n\n\t/**\n\t *\tScans for collisions against the specified mask.\n\t * \t@param mask - Mask element.\n\t * \t!static scan (mask: Mask) : void;\n\t */\n\t/**\n\t *\tScans for collisions against the specified mask.\n\t * \t@param mask - Mask element.\n\t * \t@param group - Group where the mask is stored.\n\t * \t!static scan (mask: Mask, group: Group) : void;\n\t */\n\tscan: function (mask, group=null)\n\t{\n\t\tif (!group) group = mask.group;\n\n\t\tif (!group || !group.alive() || !mask.alive())\n\t\t\treturn;\n\n\t\tthis.state.mask = mask;\n\t\tthis.state.group = group;\n\n\t\tif (!this.maskLayer || !mask.visible())\n\t\t\treturn;\n\n\t\tlet contactRules = this.contactRules[mask.type];\n\t\tif (!contactRules) contactRules = this.contactRules[mask.type & SUPER_TYPE_MASK];\n\t\tif (!contactRules) return;\n\t\n\t\tgroup.setFlags (collider.FLAG_EXCLUDE);\n\t\tlet collisionItems = this.maskLayer.selectInRegion(mask.bounds, this.flagsAnd, this.flagsValue);\n\t\tgroup.clearFlags (collider.FLAG_EXCLUDE);\n\n\t\twhile (mask.alive())\n\t\t{\n\t\t\tlet item = collisionItems.shift();\n\t\t\tif (item === null) break;\n\n\t\t\tif (!item.alive())\n\t\t\t\tcontinue;\n\n\t\t\tlet contact = contactRules[item.type];\n\t\t\tif (!contact)\n\t\t\t{\n\t\t\t\tcontact = contactRules[item.type & SUPER_TYPE_MASK];\n\t\t\t\tif (!contact) continue;\n\t\t\t}\n\n\t\t\tcontact.callback (mask, item, contact.context);\n\t\t}\n\n\t\tcollisionItems.free();\n\t}\n};\n\n/**\n * \tContact flag bits.\n */\n\n//!/class\n\n//!namespace collider\n//!enum Contact\n\ncollider.Contact = {\n\t//!LEFT\n\tLEFT: 1,\n\t//!RIGHT\n\tRIGHT: 2,\n\t//!HORIZONTAL\n\tHORIZONTAL: 1|2,\n\t//!TOP\n\tTOP: 4,\n\t//!BOTTOM\n\tBOTTOM: 8,\n\t//!VERTICAL\n\tVERTICAL: 4|8,\n};\n\n//!/enum\n//!/namespace\n\nexport default collider;\n","//@ts-check\n\n//!namespace fxl\n\n//![import \"./system\"]\nimport _sys from './system.js';\nexport const sys = _sys;\n\n//![import \"./world\"]\nimport _world from './world.js';\nexport const world = _world;\n\n//![import \"./r\"]\nimport _r from './r.js';\nexport const r = _r;\n\n//![import \"./resources\"]\nimport _res from './resources.js';\nexport const res = _res;\n\n//![import \"./input\"]\nimport _input from './input.js';\nexport const input = _input;\n\n//![import \"./collider\"]\nimport _collider from './collider.js';\nexport const collider = _collider;\n\n//!/namespace\n","//!//@ts-check\n\n// *********************************************\n// rinn\n\nimport * as rinn from 'rinn';\nexport const Class = rinn.Class;\nexport const Schema = rinn.Schema;\nexport const Template = rinn.Template;\n\n// *********************************************\n// system\n\n//![import \"system/globals\"]\nimport _globals from './system/globals.js'; export const globals = _globals;\n\n//![import \"system/glx\"]\nimport _glx from './system/glx.js'; export const glx = _glx;\n\n//![import \"system/glsl\"]\nimport _glsl from './system/glsl.js'; export const glsl = _glsl;\n\n//![import \"system/system\"]\nimport _System from './system/system.js'; export const System = _System;\n\n//![import \"system/timer\"]\nimport _Timer from './system/timer.js'; export const Timer = _Timer;\n\n//![import \"system/random\"]\nimport _Random from './system/random.js'; export const Random = _Random;\n\n//![import \"system/keycode\"]\nimport _KeyCode from './system/keycode.js'; export const KeyCode = _KeyCode;\n\n//![import \"system/canvas\"]\nimport _Canvas from './system/canvas.js'; export const Canvas = _Canvas;\n\n//![import \"system/perf\"]\nimport _Perf from './system/perf.js'; export const Perf = _Perf;\n\n//![import \"system/log\"]\nimport _Log from './system/log.js'; export const Log = _Log;\n\n//![import \"system/shader\"]\nimport _Shader from './system/shader.js'; export const Shader = _Shader;\n\n//![import \"system/shader-program\"]\nimport _ShaderProgram from './system/shader-program.js'; export const ShaderProgram = _ShaderProgram;\n\n//![import \"system/framebuffer\"]\nimport _Framebuffer from './system/framebuffer.js'; export const Framebuffer = _Framebuffer;\n\n//![import \"system/texture\"]\nimport _Texture from './system/texture.js'; export const Texture = _Texture;\n\n\n// *********************************************\n// resources\n\n//![import \"resources/wrappers\"]\nimport * as _Wrappers from './resources/wrappers.js'; export const Wrappers = _Wrappers;\n\n//![import \"resources/resources\"]\nimport _Resources from './resources/resources.js'; export const Resources = _Resources;\nimport _Sound from './resources/sound.js'; export const Sound = _Sound;\n\n\n// *********************************************\n// utils\n\n//![import \"utils/recycler\"]\nimport _Recycler from './utils/recycler.js'; export const Recycler = _Recycler;\n\n//![import \"utils/linkable\"]\nimport _Linkable from './utils/linkable.js'; export const Linkable = _Linkable;\n\n//![import \"utils/list\"]\nimport _List from './utils/list.js'; export const List = _List;\n\n//![import \"utils/priority-queue\"]\nimport _PriorityQueue from './utils/priority-queue.js'; export const PriorityQueue = _PriorityQueue;\n\n//![import \"utils/handler\"]\nimport _Handler from './utils/handler.js'; export const Handler = _Handler;\n\n\n// *********************************************\n// math\n\n//![import \"math/matrix\"]\nimport _Matrix from './math/matrix.js'; export const Matrix = _Matrix;\n\n//![import \"math/rect\"]\nimport _Rect from './math/rect.js'; export const Rect = _Rect;\n\n//![import \"math/vec2\"]\nimport _Vec2 from './math/vec2.js'; export const Vec2 = _Vec2;\n\n//![import \"math/tfunction\"]\nimport _TFunction from './math/tfunction.js'; export const TFunction = _TFunction;\n\n//![import \"math/bounds2\"]\nimport _Bounds2 from './math/bounds2.js'; export const Bounds2 = _Bounds2;\n\n//![import \"math/point2\"]\nimport _Point2 from './math/point2.js'; export const Point2 = _Point2;\n\n\n// *********************************************\n// anim\n\n//![import \"anim/easing\"]\nimport _Easing from './anim/easing.js'; export const Easing = _Easing;\n\n//![import \"anim/anim\"]\nimport _Anim from './anim/anim.js'; export const Anim = _Anim;\n\n\n// *********************************************\n// flow\n\n//![import \"flow/boot\"]\nimport _Boot from './flow/boot.js'; export const Boot = _Boot;\n\n//![import \"flow/grid-element\"]\nimport _GridElement from './flow/grid-element.js'; export const GridElement = _GridElement;\n\n//![import \"flow/grid\"]\nimport _Grid from './flow/grid.js'; export const Grid = _Grid;\n\n//![import \"flow/scene\"]\nimport _Scene from './flow/scene.js'; export const Scene = _Scene;\n\n//![import \"flow/viewport\"]\nimport _Viewport from './flow/viewport.js'; export const Viewport = _Viewport;\n\n//![import \"flow/updater\"]\nimport _Updater from './flow/updater.js'; export const Updater = _Updater;\n\n//![import \"flow/container\"]\nimport _Container from './flow/container.js'; export const Container = _Container;\n\n//![import \"flow/simple-container\"]\nimport _SimpleContainer from './flow/simple-container.js'; export const SimpleContainer = _SimpleContainer;\n\n//![import \"flow/grid-container\"]\nimport _GridContainer from './flow/grid-container.js'; export const GridContainer = _GridContainer;\n\n//![import \"flow/group\"]\nimport _Group from './flow/group.js'; export const Group = _Group;\n\n//![import \"flow/drawable\"]\nimport _Drawable from './flow/drawable.js'; export const Drawable = _Drawable;\n\n//![import \"flow/element\"]\nimport _Element from './flow/element.js'; export const Element = _Element;\n\n//![import \"flow/mask\"]\nimport _Mask from './flow/mask.js'; export const Mask = _Mask;\n\n//![import \"flow/label\"]\nimport _Label from './flow/label.js'; export const Label = _Label;\n\n//![import \"flow/keyboard-handler\"]\nimport _KeyboardHandler from './flow/keyboard-handler.js'; export const KeyboardHandler = _KeyboardHandler;\n\n//![import \"flow/pointer-handler\"]\nimport _PointerHandler from './flow/pointer-handler.js'; export const PointerHandler = _PointerHandler;\n\n//![import \"flow/screen-controls\"]\nimport _ScreenControls from './flow/screen-controls.js'; export const ScreenControls = _ScreenControls;\n\n//![import \"flow/button\"]\nimport _Button from './flow/button.js'; export const Button = _Button;\n\n//![import \"flow/stick\"]\nimport _Stick from './flow/stick.js'; export const Stick = _Stick;\n\n\n// *********************************************\n// fxl\n\n//![import \"fxl/fxl\"]\nimport * as fxl from './fxl/fxl.js';\nexport default fxl;\n\n//!export default fxl;\n"],"names":["$bd15d1e5a06a23c0$var$XOR","value","x","$bd15d1e5a06a23c0$var$SHL","$bd15d1e5a06a23c0$export$2e2bcd8739ae039","$k7heJ$Class","extend","state","index","seed","count","__ctor","this","setSeed","i","length","nextInt32","a","b","c","d","nextInt16","nextInt8","nextFloat","$5d435ccfe90db64e$export$2e2bcd8739ae039","BACKSPACE","TAB","ENTER","SHIFT","CTRL","ESC","SPACE","PGUP","PGDN","END","HOME","INS","DEL","LEFT","UP","RIGHT","DOWN","NUM_PLUS","NUM_MINUS","NUM_ASTERISK","NUM_SLASH","NUM_DOT","NUM_0","NUM_1","NUM_2","NUM_3","NUM_4","NUM_5","NUM_6","NUM_7","NUM_8","NUM_9","D0","D1","D2","D3","D4","D5","D6","D7","D8","D9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","BACKQUOTE","MINUS","EQUAL","LBRACKET","RBRACKET","BACKSLASH","SEMICOLON","QUOTE","COMMA","DOT","SLASH","$205c3d6510b11ca8$var$recyclingFacilities","$205c3d6510b11ca8$var$totalPreallocated","$205c3d6510b11ca8$var$Recycler","$parcel$global","Recycler","$205c3d6510b11ca8$export$2e2bcd8739ae039","attachTo","targetClass","maxPoolSize","minPoolSize","prototype","className","Error","int","recyclerPool","Array","fill","recyclerPoolMax","objectId","objectRefs","recyclerNextObjectId","recyclerCreated","recyclerRecycled","recyclerDropped","recyclerLength","recyclerActive","preallocated","preallocate","maximum","n","Math","min","allocate","item","alloc","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","init","free","console","error","__dtor","lockInstance","abs","instanceRef","showStats","name","list","log","debug","toFixed","group","groupEnd","createPool","Pool","_super","maxPreallocationsPerPool","$a727db7bde7d5f9c$var$Linkable","prev","next","clear","unlink","linkAfter","ref","linkBefore","$a727db7bde7d5f9c$export$2e2bcd8739ae039","$0d8718aa8db6f6f2$var$List","top","bottom","reset","clone","push","$k7heJ$Rinn","ni","dispose","first","last","getAt","getNodeAt","sgetNode","remove","isInstance","insertBefore","insertAfter","unshift","shift","pop","append","forEach","fn","context","forEachRev","find","filter","toArray","array","$0d8718aa8db6f6f2$export$2e2bcd8739ae039","$a63ee2aaa351be91$var$Timer","vsync","interval","callback","handle","isRunning","startTime","rTime","sTime","lTime","tDelta","_onTimeout","onTimeout","_onTimeout_b","runNow","hrnow","tError","runAfter","start","immediate","scale","onStarted","timeout","requestAnimationFrame","clearTimeout","setTimeout","stop","onStopped","$a63ee2aaa351be91$export$2e2bcd8739ae039","$cee83f83b8baf477$var$Vec2","y","set","v","setX","setY","zero","isZero","equals","neg","inv","translate","dx","dy","rotate","angle","cx","cy","cos","sin","add","sub","fx","fy","floor","fract","dot","magnitude","squared","sqrt","normalize","majorAxis","minorAxis","sign","toString","$cee83f83b8baf477$export$2e2bcd8739ae039","$770ae1a318be62f0$var$temp","Float32Array","$770ae1a318be62f0$var$temp2","$770ae1a318be62f0$var$Matrix","data","identity","target","scalef","scalar","matr","cost","sint","sx","sy","applyTo","nx","ny","transpose","j","det","adj","inverse","loadIdentity","$770ae1a318be62f0$export$2e2bcd8739ae039","$95d8a3c6c6bfc72e$var$glx","BufferTarget","BufferUsage","gl","setContext","ARRAY_BUFFER","ELEMENT_ARRAY_BUFFER","COPY_READ_BUFFER","COPY_WRITE_BUFFER","TRANSFORM_FEEDBACK_BUFFER","UNIFORM_BUFFER","PIXEL_PACK_BUFFER","PIXEL_UNPACK_BUFFER","STATIC_DRAW","DYNAMIC_DRAW","STREAM_DRAW","STATIC_READ","DYNAMIC_READ","STREAM_READ","STATIC_COPY","DYNAMIC_COPY","STREAM_COPY","getParameter","getFloat32Array","offset","buff","createBufferFrom","usage","createBuffer","bindBuffer","bufferData","$95d8a3c6c6bfc72e$export$2e2bcd8739ae039","$28762e7c8bebcaa1$var$glsl","snippets","source","get","hasOwnProperty","replace","code","alreadyImported","split","trim","startsWith","str","substring","join","process","indexOf","$28762e7c8bebcaa1$export$2e2bcd8739ae039","$82ad54537fbb73ee$var$Shader","id","type","shaderId","put","compile","deleteShader","createShader","Type","VERTEX","VERTEX_SHADER","FRAGMENT","FRAGMENT_SHADER","GEOMETRY_SHADER","shaderSource","compileShader","getShaderInfoLog","map","shaders","shader","GEOMETRY","$82ad54537fbb73ee$export$2e2bcd8739ae039","$c0feea377a42f554$var$ShaderProgram","locations","programId","_uniformSetter","deleteProgram","uniformSetter","attach","bindLocations","bindAttribLocation","getAttribLocation","getUniformLocation","getUniformBlockLocation","getUniformBlockIndex","getUniformBlockSize","uniformBlock","getActiveUniformBlockParameter","UNIFORM_BLOCK_DATA_SIZE","createUniformBlockBuffer","size","bindBufferBase","preloadLocations","link","createProgram","attachShader","linkProgram","activate","useProgram","getStatus","getProgramParameter","LINK_STATUS","getError","getProgramInfoLog","uniform1f","location","v0","uniform1fv","uniform1i","uniform1iv","uniform2f","v1","uniform2fv","uniform2i","uniform2iv","uniform3f","v2","uniform3fv","uniform3i","uniform3iv","uniform4f","v3","uniform4fv","uniform4i","uniform4iv","programs","create","vs","vsName","fs","fsName","gs","gsName","active","i1","pgm","shaderProgram","$c0feea377a42f554$export$2e2bcd8739ae039","$b821e5e4f94cc365$export$2e2bcd8739ae039","textureId","width","height","targetWidth","targetHeight","rscale","wrap","mipmap","allocated","canvas","bind","createTexture","bindTexture","TEXTURE_2D","applyFilter","applyWrap","texStorage2D","RGBA8","_gl","texParameteri","TEXTURE_MIN_FILTER","NEAREST_MIPMAP_LINEAR","TEXTURE_MAG_FILTER","NEAREST","LINEAR_MIPMAP_LINEAR","LINEAR","TEXTURE_WRAP_S","REPEAT","TEXTURE_WRAP_T","MIRRORED_REPEAT","CLAMP_TO_EDGE","setFilter","setWrap","setMipmap","generateMipmap","upload","image","targetX","targetY","texSubImage2D","RGBA","UNSIGNED_BYTE","createCanvas","options","$187169a8170c1c7d$export$2e2bcd8739ae039","hidden","antialias","getCanvas","uploadCanvas","img","Image","onload","src","toDataUrl","disposeCanvas","uploadRender","render","$187169a8170c1c7d$var$Canvas","opts","elem","background","absolute","headless","document","passThruCanvas","createElement","body","appendChild","style","position","left","getContext","desynchronized","preserveDrawingBuffer","alpha","stencil","$56198b4692f483f9$export$2e2bcd8739ae039","$7a6d1b208d296051$export$2e2bcd8739ae039","write","matrixStack","alphaStack","depthFlagStack","shaderProgramStack","transform","_globalScale","_alpha","_depthFlag","updateTransform","strokeStyle","fillStyle","resize","initGl","setBackground","parentNode","imageSmoothingEnabled","renderingContext","pushClip","popClip","setTransform","e","f","toDataURL","mime","params","beginPath","moveTo","closePath","lineTo","rect","w","h","stroke","fillRect","strokeRect","clip","quadraticCurveTo","cpx","cpy","bezierCurveTo","cx1","cy1","cx2","cy2","arc","r","sA","eA","cw","arcTo","x1","y1","x2","y2","fillText","text","maxWidth","strokeText","measureText","createImageData","getImageData","putImageData","drawImage","sw","sh","dw","dh","textureWidth","textureHeight","frameWidth","frameHeight","getBoundingClientRect","gl1","glFWrapProgram","glDefaultProgram","glBlitProgram","getAllErrors","setShaderProgram","vao0","createVertexArray","bindVertexArray","vertexAttribPointer","FLOAT","FALSE","BYTES_PER_ELEMENT","enableVertexAttribArray","clearColor","enable","DEPTH_TEST","clearDepth","depthFunc","GEQUAL","disable","DITHER","BLEND","pixelStorei","UNPACK_PREMULTIPLY_ALPHA_WEBGL","blendEquationSeparate","FUNC_ADD","blendFunc","ONE","ONE_MINUS_SRC_ALPHA","m_quad","m_texture","v_resolution","zvalue","program","time","activeTextureId","activeShader","activeTexture","TEXTURE0","uniformMatrix3fv","drawArrays","TRIANGLE_STRIP","drawRect","prepareImage","mutate","applyConfig","imageRendering","removeChild","color","backgroundColor","parseInt","substr","g","_width","_height","SCISSOR_TEST","scissor","viewport","globalScale","flipped","isFlipped","toPngBase64","_contextAttribute","lineCap","lineJoin","lineWidth","miterLimit","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","clearRect","STENCIL_BUFFER_BIT","DEPTH_BUFFER_BIT","COLOR_BUFFER_BIT","end","flush","blit","clearPath","pushMatrix","popMatrix","pushAlpha","popAlpha","setDepthFlag","getDepthFlag","pushDepthFlag","popDepthFlag","getShaderProgram","pushShaderProgram","popShaderProgram","loadMatrix","getMatrix","appendMatrix","useNative","ellipse","ox","oy","xe","ye","xm","ym","circle","PI","line","enablePointerEvents","pointerHandler","pointerScale","pointerOffset","_","_evt","action","buttons","lbuttons","containedBy","pointerHandlers","evt","rx","clientX","ry","clientY","dragging","ldx","ldy","ddx","ddy","onmousedown","onmouseup","onmousemove","setPointerScale","setPointerOffset","addPointerHandler","random","removePointerHandler","splice","renderImage","draw","completed","$1650d4f1f085a750$export$2e2bcd8739ae039","url","renderer","renderImageMipmap","levels","$1650d4f1f085a750$var$System","KEY_DOWN","KEY_UP","POINTER_DOWN","POINTER_UP","POINTER_MOVE","POINTER_DRAG_START","POINTER_DRAG_MOVE","POINTER_DRAG_STOP","POINTER_WHEEL","Object","assign","flags","renderingEnabled","renderingPaused","defaultOptions","overdraw","orientation","fps","minFps","screenWidth","screenHeight","extraScaleFactor","maxScaleFactor","fullscreen","offsX","offsY","devicePixelRatio","backingStoreRatio","canvasPixelRatio","canvasScaleFactor","scaleFactor","initialMatrix","displayBuffer2","displayBuffer3","tempDisplayBuffer","keyState","ctrl","alt","keyCode","pointers","updateQueue","drawQueue","timeScale","frameInterval","fixedFrameInterval","maxFrameInterval","frameDelta","frameTime","frameNumber","perf","lastTime","numFrames","numSamples","updateTimeTotal","drawTimeTotal","extraTimeTotal","frameTimeTotal","averageFps","averageUpdateTime","averageDrawTime","averageExtraTime","averageFrameTime","self","o","onresize","onWindowResized","frameTimer","delta","onFrame","pointerEvents","display0","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","onkeydown","onKeyboardEvent","KeyboardEventType","onkeyup","endTime","pointerConvX","reverseRender","pointerConvY","ontouchstart","preventDefault","touches","changedTouches","identifier","isActive","isDragging","button","wheelDelta","wheelAccum","p","onPointerEvent","PointerEventType","ontouchend","deltaTime","ontouchcancel","ontouchmove","oncontextmenu","onwheel","deltaY","which","pause","resume","resetPerf","tmp","now","update","notRendering","_screenWidth","screen","_screenHeight","innerWidth","innerHeight","targetScreenWidth","targetScreenHeight","marginLeft","marginTop","integerScaleFactor","onCanvasResized","updateQueueAdd","handler","updateQueueRemove","drawQueueAdd","drawQueueRemove","queueAdd","queueRemove","dt","interpolate","dst","duration","easing","interpolator","t","pointer","$7a6d1b208d296051$var$Log","enabled","paused","maxsize","debugEcho","vars","msg","fontSize","showFps","showIndex","_y","s","ii","$56198b4692f483f9$var$globals","debugBounds","debugMasks","rand0","rand1","rand2","px","SCALE","obj","audioContext","AudioContext","latencyHint","sampleRate","baseLatency","fetchd","Promise","resolve","reject","responseType","request","XMLHttpRequest","open","response","onerror","send","fetchAudioBuffer","then","arrayBuffer","decodeAudioData","audioBuffer","catch","err","bool","float","parseFloat","float2","float3","float4","rad","degrees","deg","radians","rand","randf","randrf","randr","round","randt","removeSubsequent","table","k","m","i2","randtf","performance","randvar","randitem","arr","getLineSegmentIntersection","ls1_x1","ls1_y1","ls1_x2","ls1_y2","ls2_x1","ls2_y1","ls2_x2","ls2_y2","dyA","dxA","dyB","dxB","max","tA","tB","lineSegmentIntersects","rotatePoint","stepValue","minValue","maxValue","numSteps","alignValue","step","FIXED_POINT_BITS","upscale","downscale","downscalef","falign","absmin","absmax","repeat","out","lpad","val","char","charAt","rpad","norm","snorm","clamp","x0","b0","b1","mix","$07bdad9ed75b86fd$var$Perf","accumSize","expectedValue","lastFeed","lastUpdate","stdSum","stdCount","$07bdad9ed75b86fd$export$2e2bcd8739ae039","begin","feed","report","avg","std","pow","Flags","SAMPLES","MIN","MAX","AVG","EXPECTED","undefined","STDDEV","AVG_STDDEV","ALL","$16169b52cc26c979$var$Framebuffer","framebufferId","attachments","attachmentTypes","drawBuffers","drawBufferIds","$16169b52cc26c979$var$attachmentPointIds","$16169b52cc26c979$var$initAttachmentPointIds","createFramebuffer","MAX_ATTACHMENT_POINTS","TEXTURE","deleteTexture","deleteRenderbuffer","deleteFramebuffer","frameBufferId","attachmentPoint","texture","DEPTH","RENDERBUFFER","FRAMEBUFFER_BINDING","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","framebufferRenderbuffer","createColorBuffer","tex","createDepthBuffer","createRenderbuffer","bindRenderbuffer","renderbufferStorage","DEPTH_COMPONENT24","createStencilBuffer","DEPTH_STENCIL","getTexture","getRenderBuffer","unbind","$16169b52cc26c979$var$defaultDrawBuffers","isComplete","result","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","COLOR0","COLOR1","COLOR2","COLOR3","COLOR4","COLOR5","COLOR6","COLOR7","STENCIL","BACK","COLOR_ATTACHMENT0","COLOR_ATTACHMENT1","COLOR_ATTACHMENT2","COLOR_ATTACHMENT3","COLOR_ATTACHMENT4","COLOR_ATTACHMENT5","COLOR_ATTACHMENT6","COLOR_ATTACHMENT7","DEPTH_ATTACHMENT","STENCIL_ATTACHMENT","DEPTH_STENCIL_ATTACHMENT","$16169b52cc26c979$export$2e2bcd8739ae039","$f24d03ef874fb100$var$Drawable","resource","swidth","sheight","isInstanceOf","drawable","getDrawable","getImage","drawf","tx","ty","twidth","theight","fwidth","fheight","bounds","$f24d03ef874fb100$var$NineSlice","ss","startingIndex","spritesheet","Drawable","instanceOf","leftWidth","getFrame","rightWidth","midWidth","topHeight","bottomHeight","midHeight","$f24d03ef874fb100$var$Repeated","$f24d03ef874fb100$var$Clipped","$f24d03ef874fb100$var$Centered","$f24d03ef874fb100$var$Static","$f24d03ef874fb100$var$Group","$f24d03ef874fb100$var$MirrorX","$f24d03ef874fb100$var$MirrorY","nineSlice","repeated","clipped","centered","static","args","mirrorX","mirrorY","$f24d03ef874fb100$export$2e2bcd8739ae039","$602324cdae94d715$export$2e2bcd8739ae039","wrapper","$838f4e0524a660e8$export$2e2bcd8739ae039","$4cecfbcae4e87661$var$FrameDrawable","frameIndex","$4cecfbcae4e87661$export$2e2bcd8739ae039","frameCache","r_scale","v_scale","numCols","numRows","config","sheetWidth","coords","resName","ceil","frameObject","$d523b03516be4d11$export$c35d437ae5945fcd","seq","seq_i","n_seq","queue","frameDuration","finished","_paused","finishedCallback","finishedCallbackHandler","finishedCallbackContext","frameCallback","anim","setFps","initialDelay","onFinished","thenCallback","setFrame","normalized","getLength","loop","use","frame","advance","getSequenceName","seqName","forced","play","setQueue","enqueue","force","lastName","$d523b03516be4d11$export$2e2bcd8739ae039","defaultDrawable","sharedAnim","Spritesheet","initialized","def","getSharedAnimation","initialseq","getAnimation","getSequence","$a1bcaa8b7c9cf5d6$export$2e2bcd8739ae039","r_charWidth","charWidth","r_charHeight","charHeight","paddingX","paddingY","spacingX","spacingY","reverseDraw","cols","charset","charTable","widths","String","fromCharCode","drawText","pX","measureWidth","measureHeight","$7a27af17efe2a19e$var$Resources","$7a27af17efe2a19e$var$reported","integerScalingEnabled","pixelated","original","load","progressCallback","completeCallback","keyList","keys","__clone","d0","d1","dN","cb","async","ratio","extraScale","resizeImage","onLoaded","lastIndexOf","_i","owidth","oheight","track","plugins","NativeAudio","engine","$7a4626eede78b6c8$exports","Sound","ENGINE_NATIVEAUDIO","preloadSimple","ENGINE_WEBAUDIO","Audio","ENGINE_HTML5","oncanplaythrough","json","arraybuffer","apply","Uint8Array","unload","__loaded","loadImage","discardOriginal","rep_x","rep_y","output","temp","sp","tw","th","flipImageHorz","flipImageVert","showDownload","filename","dataUrl","href","display","download","click","showFilePicker","allowMultiple","accept","input","multiple","onchange","files","onfocus","loadAsDataURL","file","reader","FileReader","readAsDataURL","loadAsText","readAsText","loadAsArrayBuffer","readAsArrayBuffer","loadAllAsDataURL","fileList","loadNext","$7a27af17efe2a19e$export$2e2bcd8739ae039","$b92898c3f9f0bd37$var$Sound","toUpperCase","volume","playLoop","MASTER","SFX","MUSIC","VOICE","MAX_POOL_SIZE","pool","register","node","registered","unregister","updateNode","cmd","snd","updateNode_webaudio","updateNode_nativeaudio","updateNode_audio","alloc_webaudio","gainNode","createGain","gain","connect","destination","res","createBufferSource","buffer","free_webaudio","disconnect","alloc_nativeaudio","free_nativeaudio","alloc_audio","cloneNode","_src","free_audio","playing","playTime","onended","onended_webaudio","currentTarget","onended_nativeaudio","onended_audio","currentTime","enableTrack","disableTrack","setVolume","createNode","startVolume","timer","fadeOut","millis","setInterval","clearInterval","fadeIn","$b92898c3f9f0bd37$export$2e2bcd8739ae039","$ceb50d2acce12264$export$2e2bcd8739ae039","mode","sounds","lastIndex","getRandomSound","playAt","playLoopAt","$7a4626eede78b6c8$export$f35845279390eafd","$7a4626eede78b6c8$export$922ad9063d3cdee8","$7a4626eede78b6c8$export$674d2eb4debbef0c","$7a4626eede78b6c8$export$7faa71ea66a694bb","$7a4626eede78b6c8$export$e1896ac0c4970221","$7a4626eede78b6c8$export$85990f0f98a390bb","$7a4626eede78b6c8$export$bc40a15752ef9732","$929bb1801a8ad1fc$export$2e2bcd8739ae039","queueKeys","order","object","priority","is_dirty","sort","cleanup","q","is_complete","forEachAsync","next_j","next_i","forEachRevAsync","alert","$848d2d71bed2ca20$var$Callback","arg0","arg1","arg2","arg3","arg4","arg5","isEqual","exec","host","$848d2d71bed2ca20$export$2e2bcd8739ae039","$cbfa9452e6775783$var$Handler","execf","execc","$cbfa9452e6775783$export$2e2bcd8739ae039","$6149ce635e08db36$var$Rect","Rool","extendWithPoint","centerAt","contains","setAsUnion","intersects","_x1","_y1","_x2","_y2","setAsIntersection","topLeftRelative","resizeBy","ncx","ncy","isRight","containsPoint","tol","area","strict","flatten","unflatten","$6149ce635e08db36$export$2e2bcd8739ae039","$798730a8c4bf8dde$var$TFunction","copyFrom","t0","t1","i0","y0","integral","c0","accum","second_integral","Temp1","integrate","Temp2","accumulate","chopLeft","chopRight","n1","pad","$798730a8c4bf8dde$export$2e2bcd8739ae039","$1eab71de54671471$var$Point2","ux","uy","upscaled","$1eab71de54671471$export$2e2bcd8739ae039","$eb2815224e368f78$var$Bounds2","ucx","ucy","ux1","uy1","ux2","uy2","trunc","dWidth","dHeight","isForward","$eb2815224e368f78$export$2e2bcd8739ae039","$e13bfacd4e6736f1$var$Easing","Linear","IN","OUT","IN_OUT","Back","Bounce","getConst","Circ","Cubic","Expo","Power","Quad","Quartic","Quintic","Sine","Step","$e13bfacd4e6736f1$export$2e2bcd8739ae039","$526684b4e15f7fa7$var$Boot","modules","module","startup","onStartup","shutdown","forEachAsyncRev","onShutdown","Module","$526684b4e15f7fa7$export$2e2bcd8739ae039","$c3cdc0ad45c34b34$var$system","_timeout","_interval","_span","onPaused","onResumed","window","onblur","fromExternalEvent","_updateTimeout","cancelTimeout","period","_updateInterval","cancelInterval","_0","_1","span","_updateSpan","cancelSpan","$c3cdc0ad45c34b34$export$2e2bcd8739ae039","$661cbdbf4dbaf875$var$_stamp","$661cbdbf4dbaf875$var$getStamp","$661cbdbf4dbaf875$var$Block","commands","isFirst","current","stamp","block","restart","isFinished","$661cbdbf4dbaf875$export$2e2bcd8739ae039","$dc1f34af83e398a9$var$Command","op","started","field","_duration","_count","startValue","_startValue","endValue","_endValue","_cur","_last","blocks","autoInit","ready","$dc1f34af83e398a9$export$2e2bcd8739ae039","$bcdc1a61a2a23409$export$2e2bcd8739ae039","postinit","$1048898898435e24$export$2e2bcd8739ae039","$4e781c0aa6ea91a0$export$2e2bcd8739ae039","$01e3298cb058aa0c$export$2e2bcd8739ae039","setValue","getValue","$44ecfd1d273f2cd8$export$2e2bcd8739ae039","$52387b85ffd24506$export$2e2bcd8739ae039","typeOf","$ca8b39682ea060a2$export$2e2bcd8739ae039","$7938af652ac7299e$export$2e2bcd8739ae039","$3797569fd74acc16$export$2e2bcd8739ae039","$5807724eb046f402$export$2e2bcd8739ae039","$0315b3415f5d67e9$export$2e2bcd8739ae039","$f0322bc0679ac4ce$var$Anim","initialData","blockStack","cmdStack","running","autoDispose","copyTo","initial","speed","run","fieldName","curr","initialValue","Number","prepareFieldName","parallel","serial","wait","range","rangeTo","_bounds_x1","_bounds_y1","translateX","deltaValue","translateY","deltaValueX","deltaValueY","easingX","easingY","endValueX","endValueY","moveX","moveY","scaleX","scaleY","$f0322bc0679ac4ce$export$2e2bcd8739ae039","$818bd2a0bfe38acb$var$GridElement","ext","container","_grid_remove_node","remover","ALIVE","VISIBLE","DIRTY","DEPTH_FLAG","alive","setId","setFlags","clearFlags","getFlags","andMask","setData","getData","setExt","extensionObject","getExt","arg6","arg7","arg8","arg9","visible","VISIBLE_LOCK","visibleLock","dirty","depthFlagEnabled","DEPTH_FLAG_ENABLED","depthFlag","sync","setPosition","WRAP_EXTENTS","USERDEF","LAST_FLAG","allocFlag","flag","$818bd2a0bfe38acb$export$2e2bcd8739ae039","$6740e7fb057c5687$export$2e2bcd8739ae039","grid","offsx","offsy","kx","ky","stride","verifyIntersection","log2","_remove","forEachInRegion","flagsAndMask","flagsValue","j0","j1","selectInRegion","countInRegion","selectFirst","$6aa0485f22448ccc$var$Container","viewportBounds","scene","elementCount","drawCount","ldraw","setViewportBounds","drawElement","syncZ","__zvalue","_zvalue","depthFlagChanged","$6aa0485f22448ccc$export$2e2bcd8739ae039","$5d206e1f4ebbfe47$var$Viewport","initialWidth","initialHeight","centerRatioX","centerRatioY","focusFactorX","focusFactorY","focusRect","focusOffsX","focusOffsY","focusAxisX","focusAxisY","padding","focusBounds","screenBounds","tmpPoint","containerWidth","containerHeight","ENABLED","setContainerBounds","updateScreenBounds","updateBounds","topLeft","TOP_LEFT","setPadding","truncateToContainer","ws","hs","setOffsets","setScale","getScale","setGlobalScale","getGlobalScale","setCenter","setScreenPosition","getX","getY","getOffsetX","getOffsetY","getWidth","getHeight","focusX","focusY","updateForced","setFocusRect","setFocusOffsets","setFocusAxes","enabledX","enabledY","setFocusFactor","valueX","valueY","applyClip","applyTransform","toWorldSpace","refX","refY","toScreenSpace","$5d206e1f4ebbfe47$export$2e2bcd8739ae039","$ffceaf2b8bc0d016$var$Element","_shaderProgram","GridElement","destroyLater","disposeLater","root","shaderChanged","getDebugColor","renderWith","renderFunction","debugColors","$ffceaf2b8bc0d016$export$2e2bcd8739ae039","$43bcddf2634acf45$var$tempPoint","$43bcddf2634acf45$var$Group","children","Element","wrapExtents","addChild","relative","ltranslate","getChild","_dx","_dy","getOffsets","$43bcddf2634acf45$export$2e2bcd8739ae039","$602d6bad2743754b$var$Scene","minWidth","minHeight","maxHeight","containers","viewports","groupList","groups","disposalQueue","fupdater","updater","synchronizer","lupdater","destroyer","disposeQueued","setContainer","getContainer","setViewport","getViewport","addGroup","_removeGroup","removeGroup","viewportIndex","drawContainers","updateViewports","$602d6bad2743754b$export$2e2bcd8739ae039","$c485cdaac549f3db$export$2e2bcd8739ae039","__update","__context","__preupdate","__postupdate","_update","_sync","_destroy","preUpdate","postUpdate","$bfab139f450d85e1$export$2e2bcd8739ae039","Container","$b80b64f624da3f7e$export$2e2bcd8739ae039","divisorX","divisorY","$986b75ca73a242a2$var$Mask","$986b75ca73a242a2$export$2e2bcd8739ae039","$a7c99fd917661692$var$Label","_dirty","textWidth","textHeight","_align","_valign","textOffsetX","textOffsetY","renderText","setText","align","valign","setFont","$a7c99fd917661692$export$2e2bcd8739ae039","$d871fc2aec8e0b0a$export$2e2bcd8739ae039","handlers","_callOnKeyboardEvent","callOnKeyboardEvent","message","_action","_keyCode","_keyState","$38f6644defdf8fb9$export$2e2bcd8739ae039","_callOnPointerEvent","callOnPointerEvent","_p","_pointers","$f92d8ca198771d19$var$ScreenControls","Handler","hoverFlag","zindexFlag","lastFrame","hover","zindex","findTarget","filterHover","_continue","_ref","pointerDeactivate","pointerActivate","_refh","focusLock","pointerUpdate","keyArgs","keyboardEvents","keyDown","keyUp","$f92d8ca198771d19$export$2e2bcd8739ae039","$15756a09bc7a89d5$export$2e2bcd8739ae039","isPressed","wasPressed","unpressedImg","pressedImg","hitbox","_onButtonDown","_onButtonUp","_onTap","_onChange","Group","_default_onChange","setImage","setKeyCode","pointerX","pointerY","setStatus","updateStatus","onChange","onButtonDown","onButtonUp","onTap","$02ed9b9c6577d425$export$2e2bcd8739ae039","unpressedImgInner","pressedImgInner","angleSteps","radiusSteps","rdirx","rdiry","dirx","diry","frdirx","frdiry","fdirx","fdiry","fmagnitude","fangle","dispx","dispy","radius","maxRadius","deadZoneX","deadZoneY","limitX1","limitY1","limitX2","limitY2","renderStick","bindKeys","up","down","right","keysEnabled","setLimits","setImageInner","setAngleSteps","setRadiusSteps","setDeadZone","atan2","setDirection","freezeState","lastValid","$6e2531d219e57927$var$world","SCENE_MAIN","SCENE_HUD","LAYER_BG0","LAYER_BG1","LAYER_BG2","LAYER_BG3","LAYER_BG4","LAYER_MAIN","LAYER_FG0","LAYER_FG1","LAYER_FG2","LAYER_FG3","LAYER_FG4","LAYER_MASK","LAYER_HUD_BG0","LAYER_HUD_BG1","LAYER_HUD_BG2","LAYER_HUD_MAIN","LAYER_HUD_FG0","LAYER_HUD_FG1","LAYER_HUD_FG2","_scenes","activeScene","_viewports","activeViewport","activeContainer","activeGroup","lastGroup","lastElement","worldWidth","worldHeight","createScene","createViewport","selectScene","getScene","selectViewport","throwErrors","selectContainer","showMasks","allMasks","createGroup","endGroup","containerIndex","createMask","mask","createLabel","createUpdater","$6e2531d219e57927$export$2e2bcd8739ae039","$7742454105ac7829$export$2e2bcd8739ae039","$50436562a0d7fa3e$export$2e2bcd8739ae039","total","__resIdMustNotExist","custom","drawFunction","path","images","configOptions","resOptions","animation","id1","trans","srcSeq","dstSeq","spritefont","optsA","optsB","sfx","sfxm","music","$ef0fbc081e04c66a$export$2e2bcd8739ae039","sticks","_visible","layer","addStick","outerDrawable","innerDrawable","stick","addButton","unpressedDrawable","pressedDrawable","$4c6520cb7e81a548$var$input","_gamepads","activeGamepad","lastButton","lastStick","cursor","_enabled","_handler","_element","element","native","removeProperty","_handler_callback","hthis","keyboard","keybState","createGamepad","layerIndex","selectGamepad","getGamepad","debugGamepad","$4c6520cb7e81a548$export$2e2bcd8739ae039","$e11c1b6e17253f5a$var$collider","FLAG_EXCLUDE","contactRules","truncationRules","maskLayer","flagsAnd","contact","v0x","v0y","v1x","v1y","v2x","v2y","w0","delta0","w1","delta1","w2","t_dx","t_dy","sceneIndex","firstUpdate","later","_run","setVisible","_setVisible","_setValue","_setFlags","_clearFlags","primaryType","secondaryType","truncate","getContactFlags","boundsA","boundsB","numFlags","Contact","TOP","BOTTOM","calc","store0","v0a","v1a","v1b","attemptSelect","swapped","load0","save1","load1","resolveXpos","single","resolveYpos","resolveYneg","resolveXneg","commit","scan","offs","collisionItems","allowsTruncation","sv","HORIZONTAL","VERTICAL","$0c6ff5b14d751d3a$export$773cc7fa6f8304c3","$0c6ff5b14d751d3a$export$f965ae91e38a1274","$0c6ff5b14d751d3a$export$43caf9889c228507","$0c6ff5b14d751d3a$export$a79e2b3ea5d10ee0","$0c6ff5b14d751d3a$export$b7e3ae3d7c15e42e","$0c6ff5b14d751d3a$export$5fa227701309b621","$9ffb7151b8b2d038$export$4c85e640eb41c31b","$9ffb7151b8b2d038$export$19342e026b58ebb7","$k7heJ$Schema","$9ffb7151b8b2d038$export$14416b8d99d47caa","$k7heJ$Template","$9ffb7151b8b2d038$export$816be348776d53c1","$9ffb7151b8b2d038$export$7c09191825db112d","$9ffb7151b8b2d038$export$c1b1a45ed915aad9","$9ffb7151b8b2d038$export$e1dae5660003ffa7","$9ffb7151b8b2d038$export$c57e9b2d8b9e4de","$9ffb7151b8b2d038$export$a92776769f460054","$9ffb7151b8b2d038$export$e9e0d96f49f57c33","$9ffb7151b8b2d038$export$8d01c972ee8b14a9","$9ffb7151b8b2d038$export$7c4f444dab5ed59","$9ffb7151b8b2d038$export$ce30dbb46644d06c","$9ffb7151b8b2d038$export$462bb059fed9d9e5","$9ffb7151b8b2d038$export$cb01d642ebc0a347","$9ffb7151b8b2d038$export$eff95f126aa67cfb","$9ffb7151b8b2d038$export$5431306cf43de24a","$9ffb7151b8b2d038$export$573ab5fe783d8aac","$9ffb7151b8b2d038$export$e9a269813a6315a4","$9ffb7151b8b2d038$export$85990f0f98a390bb","$9ffb7151b8b2d038$export$fe264c04f294fd15","$9ffb7151b8b2d038$export$1034c64782e66715","$9ffb7151b8b2d038$export$54c2e3dc7acea9f5","$9ffb7151b8b2d038$export$8fbd1ac8e83536df","$9ffb7151b8b2d038$export$a428cd33b25d5283","$9ffb7151b8b2d038$export$5b12bf1653c0dd85","$9ffb7151b8b2d038$export$c79fc6492f3af13d","$9ffb7151b8b2d038$export$ac4bca90992eed1","$9ffb7151b8b2d038$export$c9b44e90c5031de0","$9ffb7151b8b2d038$export$3dc3622b48e72adc","$9ffb7151b8b2d038$export$79f93ddd76e66d40","$9ffb7151b8b2d038$export$cea96571ebbff9dd","$9ffb7151b8b2d038$export$deefd61317ad2797","$9ffb7151b8b2d038$export$5a2130c936f86fb8","$9ffb7151b8b2d038$export$cfb3877ce19bb838","$9ffb7151b8b2d038$export$ef2184bd89960b14","$9ffb7151b8b2d038$export$38af1803e3442a7f","$9ffb7151b8b2d038$export$d5c6c08dc2d3ca7","$9ffb7151b8b2d038$export$3386beb5bc3bfa","$9ffb7151b8b2d038$export$42a852a2b6b56249","$9ffb7151b8b2d038$export$eeaa45a7d92663a6","$9ffb7151b8b2d038$export$cc55614734af2d87","$9ffb7151b8b2d038$export$eb2fcfdbd7ba97d4","$9ffb7151b8b2d038$export$f35845279390eafd","$9ffb7151b8b2d038$export$db77ccec0bb4ccac","$9ffb7151b8b2d038$export$991dcf7284de63d","$9ffb7151b8b2d038$export$b04be29aa201d4f5","$9ffb7151b8b2d038$export$474b8119f9aaf6a9","$9ffb7151b8b2d038$export$63d5558963a08ef6","$9ffb7151b8b2d038$export$f9b7ad1c9b000a93","$9ffb7151b8b2d038$export$353f5b6fc5456de1","$9ffb7151b8b2d038$export$85a6520672683043","$9ffb7151b8b2d038$export$2e2bcd8739ae039","$0c6ff5b14d751d3a$exports"],"version":3,"file":"froxel.m.js.map"}