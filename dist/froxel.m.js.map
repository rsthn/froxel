{"mappings":"iTAkBA,MAAMA,EAAM,CAACC,EAAOC,IAAoB,YAAbD,EAAQC,GAE7BC,EAAM,CAACF,EAAOC,IAAOD,GAASC,EAAK;;IAwHzCE,EAhHeC,EAAMC,OACpB,CAIAC,MAAO,KAKPC,MAAO,EAMPC,KAAM,EAQNC,OAAQ,SAASD,EAAK,YAErBE,KAAKJ,MAAQ,CACZ,WAAY,WAAY,WAAY,WACpC,WAAY,WAAY,WAAY,WACpC,WAAY,WAAY,WAAY,UACpC,WAAY,WAAY,WAAY,YAGrCI,KAAKH,MAAQ,EAEbG,KAAKC,QAAQH,IASdG,QAAS,SAASX,GAEjBU,KAAKF,KAAOR,EAEZU,KAAKJ,MAAQ,CACZ,WAAY,WAAY,WAAY,WACpC,WAAY,WAAY,WAAY,WACpC,WAAY,WAAY,WAAY,UACpC,WAAY,WAAY,WAAY,YAGrC,IAAK,IAAIM,EAAI,EAAGA,EAAIF,KAAKJ,MAAMO,OAAQD,IACtCF,KAAKJ,MAAMM,GAAKb,EAAIW,KAAKJ,MAAMM,GAAIF,KAAKF,MAEzC,OAAOE,MAORI,UAAW,WAEV,IAAIC,EAAGC,EAAGC,EAAGC,EAcb,OAZAH,EAAIL,KAAKJ,MAAMI,KAAKH,OACpBU,EAAIP,KAAKJ,MAAOI,KAAKH,MAAQ,GAAM,IACnCS,EAAIjB,EAAIA,EAAIA,EAAIgB,EAAGE,GAAIf,EAAIa,EAAG,KAAMb,EAAIe,EAAG,KAC3CA,EAAIP,KAAKJ,MAAOI,KAAKH,MAAQ,EAAK,IAClCU,EAAIlB,EAAIkB,EAAOA,IAAG,GAlFuB,YAmFzCF,EAAIL,KAAKJ,MAAMI,KAAKH,OAASR,EAAIiB,EAAGC,GACpCC,EAAInB,EAAIgB,EAAe,WAAZb,EAAIa,EAAG,IAElBL,KAAKH,MAASG,KAAKH,MAAQ,GAAM,GACjCQ,EAAIL,KAAKJ,MAAMI,KAAKH,OAEpBG,KAAKJ,MAAMI,KAAKH,OAASR,EAAIA,EAAIA,EAAIA,EAAIA,EAAIgB,EAAGC,GAAIE,GAAIhB,EAAIa,EAAG,IAAKb,EAAIc,EAAG,KAAMd,EAAIe,EAAG,KACxD,YAAzBP,KAAKJ,MAAMI,KAAKH,QAOxBY,UAAW,WAEV,OAA0B,MAAnBT,KAAKI,aAObM,SAAU,WAET,OAA0B,IAAnBV,KAAKI,aAObO,UAAW,WAEV,OAAOX,KAAKI,YAAc;;AClH5BQ,EACA,CACCC,UAAW;;AAEXC,IAAK;;AAELC,MAAO;;AAEPC,MAAO;;AAEPC,KAAM;;AAENC,IAAK;;AAELC,MAAO;;AAGPC,KAAM;;AAENC,KAAM;;AAGNC,IAAK;;AAELC,KAAM;;AAGNC,IAAK;;AAELC,IAAK;;AAGLC,KAAM;;AAENC,GAAI;;AAEJC,MAAO;;AAEPC,KAAM;;AAGNC,SAAU;;AAEVC,UAAW;;AAEXC,aAAc;;AAEdC,UAAW;;AAEXC,QAAS;;AAGTC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAGPC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAGJC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG,ICtJJ,MAAMC,EAAsB,GAC5B,IAAIC,EAAoB,EAExB,MAAMC,EAAW,GACjBC,EAAOC,SAAWF,MAClBG,EAAeH;qBAkBfA;EAASI,SAAW,SAAUC,EAAaC,EAAY,KAAMC,EAAY,MAExE,IAAKF,EAAYG,UAAUC,UAC1B,MAAM,IAAIC,MAAO,0DAElB,KAAM,WAAYL,EAAYG,WAC7B,MAAM,IAAIE,MAAO,mBAAmBL,EAAYG,UAAUC,UAAU,8BAErE,KAAM,SAAUJ,EAAYG,WAC3B,MAAM,IAAIE,MAAO,mBAAmBL,EAAYG,UAAUC,UAAU,4BAEjD,OAAhBF,IACHA,EAAcI,IAAkB,KAAdL,IAEnBR,EAAoBO,EAAYG,UAAUC,WAAaJ,EAEvDA,EAAYO,aAAe,GAC3BP,EAAYQ,gBAAkBP,EAE9BD,EAAYG,UAAUM,SAAW,EAEjCT,EAAYU,qBAAuB,EACnCV,EAAYW,gBAAkB,EAC9BX,EAAYY,iBAAmB,EAC/BZ,EAAYa,eAAiB,EAC7Bb,EAAYc,eAAiB,EAC7Bd,EAAYe,eAAiB,EAE7B,IAAIC,GAAe,EAKnBhB,EAAYiB,YAAc,SAAUC,EAAQ,MAE3C,GAAIF,EACH,OAED,IAAIG,EAAgB,OAAZD,EAAmBhB,EAAckB,KAAKC,IAAIH,EAAShB,GAE3D,IAAK,IAAIxF,EAAI,EAAGA,EAAIyG,EAAGzG,IAEtBsF,EAAYO,aAAae,KAAK,IAAItB,GAClCA,EAAYc,iBACZpB,IAGDsB,GAAe,GAOhBhB,EAAYuB,SAAW,WAEtB,IAAIC,EAkBJ,OAhBKhH,KAAKsG,gBAOTU,EAAOhH,KAAK+F,eAAe/F,KAAKsG,gBAChCd,EAAYY,qBANZY,EAAO,IAAIxB,EACXA,EAAYW,mBAQbX,EAAYe,iBAEZS,EAAKf,WAAajG,KAAKkG,qBACvBlG,KAAKkG,sBAAwB,WAEtBc,GAQRxB,EAAYyB,MAAQ,SAASC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAEhH,OAAOnC,EAAYuB,WAAWa,KAAKV,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,IAOxEnC,EAAYG,UAAUkC,KAAO,WAE5B,OAAI7H,KAAKiG,SAAW,EACZjG,KAEa,GAAjBA,KAAKiG,UAER6B,QAAQC,MAAO,uCAAyCvC,EAAYG,UAAUC,WACvE5F,OAGRA,KAAKgI,SAELhI,KAAKiG,SAAW,EAEZT,EAAYc,gBAAkBb,EACjCD,EAAYa,iBAEZb,EAAYO,aAAaP,EAAYc,kBAAoBtG,KAE1DwF,EAAYe,iBACLvG,OAORwF,EAAYG,UAAUsC,aAAe,SAAS3I,GAI7C,OAFAU,KAAKiG,SAAWW,KAAKsB,IAAIlI,KAAKiG,UAC1B3G,IAAOU,KAAKiG,UAAYjG,KAAKiG,UAC1BjG,OASTmF,EAASgD,UAAY,SAAUC,EAAK,MAEnC,IAAIC,EAAOpD,EAIX,GAFA6C,QAAQQ,IAAI,uBAAyBpD,IAExB,IAATkD,EAAJ,CAgBA,GAAa,OAATA,EACJ,CACC,GAAqB,iBAAVA,EACX,CACC,IAAI7H,EAAI0E,EAAoBmD,GAE5B,YADAN,QAAQS,MAAOH,EAAO,MAAW7H,EAAE4F,gBAAgB5F,EAAEyF,gBAAzB,KAA2CwC,QAAQ,GAAG,mBAAqBjI,EAAE4F,gBAAkB,YAAY5F,EAAEgG,eAAe,WAAahG,EAAEwF,aAAa5F,OAAS,cAAgBI,EAAE6F,iBAAmB,iBAAmB7F,EAAE+F,eAAiB,YAAc/F,EAAE8F,eAAiB,YAAc9F,EAAEyF,gBAAkBzF,EAAE+F,iBAI9U+B,EAAOD,EAGRN,QAAQW,MAAM,wBAEd,IAAK,IAAIvI,KAAKmI,EACd,CACC,IAAI9H,EAAI8H,EAAKnI,GACb4H,QAAQS,MAAOrI,EAAI,MAAWK,EAAE4F,gBAAgB5F,EAAEyF,gBAAzB,KAA2CwC,QAAQ,GAAG,mBAAqBjI,EAAE4F,gBAAkB,YAAY5F,EAAEgG,eAAe,WAAahG,EAAEwF,aAAa5F,OAAS,cAAgBI,EAAE6F,iBAAmB,iBAAmB7F,EAAE+F,eAAiB,YAAc/F,EAAE8F,eAAiB,YAAc9F,EAAEyF,gBAAkBzF,EAAE+F,iBAG3UwB,QAAQY,eApCR,CAECZ,QAAQW,MAAM,wBAEd,IAAK,IAAIvI,KAAKmI,EACd,CACC,IAAI9H,EAAI8H,EAAKnI,GACRK,EAAE4F,iBAEP2B,QAAQS,MAAOrI,EAAI,MAAWK,EAAE4F,gBAAgB5F,EAAEyF,gBAAzB,KAA2CwC,QAAQ,GAAG,mBAAqBjI,EAAE4F,gBAAkB,YAAY5F,EAAEgG,eAAe,WAAahG,EAAEwF,aAAa5F,OAAS,cAAgBI,EAAE6F,iBAAmB,iBAAmB7F,EAAE+F,eAAiB,YAAc/F,EAAE8F,eAAiB,YAAc9F,EAAEyF,gBAAkBzF,EAAE+F,iBAG3UwB,QAAQY,aAqCVvD,EAASwD,WAAa,SAAUnD,EAAaC,EAAY,KAAMC,EAAY,MAE1E,MAAM0C,EAAO5C,EAAYG,UAAUC,UACnC,IAAKwC,EAAM,MAAM,IAAIvC,MAAO,wDAE5B,MAAM+C,EAAOpD,EAAY7F,OACxB,CACAiG,UAAWJ,EAAYG,UAAUC,UAEjC7F,OAAQ,aAGR6H,KAAM,SAASV,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAGlG,OADA3H,KAAK6I,OAAOT,GAAMrI,OAAOmH,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,GACtD3H,QAOT,OAHAmF,EAASI,SAASqD,EAAMnD,EAAaC,GACrCF,EAAYoD,KAAOA,EAEZpD,GASRL,EAASsB,YAAc,SAAUqC,EAAyB,MAEzD5D,EAAoB,EAEpB,IAAK,IAAIhF,KAAK+E,EACbA,EAAoB/E,GAAGuG,YAAYqC,GAEpC,OAAO5D;;;AC7OR,MAAM6D,EAAWrJ,EAAMC,OACtB,CACAiG,UAAW,WAMXoD,KAAM,KAMNC,KAAM,KAMN3J,MAAO,KAMPS,OAAQ,SAAUT,GAEjBU,KAAKV,MAAQA,EACbU,KAAKkJ,SAMNlB,OAAQ,WAEPhI,KAAKmJ,UAOND,MAAO,WAGN,OADAlJ,KAAKiJ,KAAOjJ,KAAKgJ,KAAO,KACjBhJ,MAORoJ,UAAW,SAAUC,GAEpBrJ,KAAKgJ,KAAOK,EACZrJ,KAAKiJ,KAAOI,EAAMA,EAAIJ,KAAO,KAEzBI,IAECA,EAAIJ,OAAMI,EAAIJ,KAAKD,KAAOhJ,MAC9BqJ,EAAIJ,KAAOjJ,OAQbsJ,WAAY,SAAUD,GAErBrJ,KAAKgJ,KAAOK,EAAMA,EAAIL,KAAO,KAC7BhJ,KAAKiJ,KAAOI,EAERA,IAECA,EAAIL,OAAMK,EAAIL,KAAKC,KAAOjJ,MAC9BqJ,EAAIL,KAAOhJ,OAQbmJ,OAAQ,WAKP,OAHInJ,KAAKgJ,OAAMhJ,KAAKgJ,KAAKC,KAAOjJ,KAAKiJ,MACjCjJ,KAAKiJ,OAAMjJ,KAAKiJ,KAAKD,KAAOhJ,KAAKgJ,MAE9BhJ,KAAKkJ;;;iBAcd5D;EAASqD,WAAYI,EAAU,MAAO,UACtCQ,EAAeR;;;aCxGf;MAAMS,EAAO9J,EAAMC,OAClB,CAIAiG,UAAW,OAMX6D,IAAK,KAMLC,OAAQ,KAMRvJ,OAAQ,EAMRJ,OAAQ,WAEPC,KAAKyJ,IAAM,KACXzJ,KAAK0J,OAAS,KACd1J,KAAKG,OAAS,GAOf6H,OAAQ,WAEPhI,KAAK2J,SAONC,MAAO,WAEN,IAAIvB,EAAOmB,EAAKZ,KAAK3B,QAErB,IAAK,IAAI/G,EAAIF,KAAKyJ,IAAKvJ,EAAGA,EAAIA,EAAE+I,KAC/BZ,EAAKvB,KAAK+C,EAAKD,MAAM1J,EAAEZ,QAExB,OAAO+I,GAORa,MAAO,WAEN,IAAIhJ,EAAG4J,EAEP,IAAK5J,EAAIF,KAAKyJ,IAAKvJ,EAAGA,EAAI4J,EAEzBA,EAAK5J,EAAE+I,KACPc,QAAQ7J,EAAE2H,OAAOvI,OAMlB,OAHAU,KAAKyJ,IAAMzJ,KAAK0J,OAAS,KACzB1J,KAAKG,OAAS,EAEPH,MAOR2J,MAAO,WAEN,IAAIzJ,EAAG4J,EAEP,IAAK5J,EAAIF,KAAKyJ,IAAU,MAALvJ,EAAWA,EAAI4J,EAEjCA,EAAK5J,EAAE+I,KACP/I,EAAE2H,OAMH,OAHA7H,KAAKyJ,IAAMzJ,KAAK0J,OAAS,KACzB1J,KAAKG,OAAS,EAEPH,MAORgK,MAAO,WAEN,OAAoB,OAAbhK,KAAKyJ,IAAezJ,KAAKyJ,IAAInK,MAAQ,MAO7C2K,KAAM,WAEL,OAAuB,OAAhBjK,KAAK0J,OAAkB1J,KAAK0J,OAAOpK,MAAQ,MAOnD4K,MAAO,SAAUrK,GAEhB,IAAIK,EAAI,KACR,IAAKA,EAAIF,KAAKyJ,IAAKvJ,GAAKL,KAAU,EAAGK,EAAIA,EAAE+I,MAC3C,OAAY,MAAL/I,EAAYA,EAAEZ,MAAQ,MAO9B6K,UAAW,SAAUtK,GAEpB,IAAIK,EAAI,KACR,IAAKA,EAAIF,KAAKyJ,IAAKvJ,GAAKL,IAASK,EAAIA,EAAE+I,MACvC,OAAO/I,GAORkK,SAAU,SAAU9K,GAEnB,IAAK,IAAIY,EAAIF,KAAKyJ,IAAKvJ,EAAGA,EAAIA,EAAE+I,KAC/B,GAAI/I,EAAEZ,QAAUA,EAAO,OAAOY,EAE/B,OAAO,MAORmK,OAAQ,SAAUnK,GAKjB,OAHS,MAALA,GAAcqJ,EAASe,WAAWpK,KACrCA,EAAIF,KAAKoK,SAASlK,IAEdA,GAEAA,EAAE8I,OAAMhJ,KAAKyJ,IAAMvJ,EAAE+I,MACrB/I,EAAE+I,OAAMjJ,KAAK0J,OAASxJ,EAAE8I,MAE7BhJ,KAAKG,SACED,EAAE2H,OAAOvI,OAND,MAahBiL,aAAc,SAAUlB,EAAK/J,GAE5B,IAAK+J,EAAK,OAAOrJ,KAEjB,IAAIE,EAAIqJ,EAASX,KAAK3B,MAAM3H,GAM5B,OALAY,EAAEoJ,WAAYD,GAEVA,GAAOrJ,KAAKyJ,MAAKzJ,KAAKyJ,IAAMvJ,GAChCF,KAAKG,SAEEb,GAORkL,YAAa,SAAUnB,EAAK/J,GAE3B,IAAK+J,EAAK,OAAOrJ,KAEjB,IAAIE,EAAIqJ,EAASX,KAAK3B,MAAM3H,GAM5B,OALAY,EAAEkJ,UAAWC,GAETA,GAAOrJ,KAAK0J,SAAQ1J,KAAK0J,OAASxJ,GACtCF,KAAKG,SAEEb,GAORmL,QAAS,SAAUnL,GAElB,IAAIY,EAAIqJ,EAASX,KAAK3B,MAAM3H,GAQ5B,OANAY,EAAEoJ,WAAYtJ,KAAKyJ,KACdzJ,KAAK0J,SAAQ1J,KAAK0J,OAASxJ,GAEhCF,KAAKyJ,IAAMvJ,EACXF,KAAKG,SAEEb,GAORoL,MAAO,WAEN,IAAIxK,EAAIF,KAAKyJ,IACb,OAAKvJ,IAECF,KAAKyJ,IAAMvJ,EAAE+I,QAAOjJ,KAAK0J,OAAS,MACxC1J,KAAKG,SAEED,EAAE2H,OAAOvI,OALD,MAYhBwH,KAAM,SAAUxH,GAEf,IAAIY,EAAIqJ,EAASX,KAAK3B,MAAM3H,GAQ5B,OANAY,EAAEkJ,UAAWpJ,KAAK0J,QACb1J,KAAKyJ,MAAKzJ,KAAKyJ,IAAMvJ,GAE1BF,KAAK0J,OAASxJ,EACdF,KAAKG,SAEEb,GAORqL,IAAK,WAEJ,IAAIzK,EAAIF,KAAK0J,OACb,OAAKxJ,IAECF,KAAK0J,OAASxJ,EAAE8I,QAAOhJ,KAAKyJ,IAAM,MACxCzJ,KAAKG,SAEED,EAAE2H,OAAOvI,OALD,MAYhBsL,OAAQ,SAAUvC,GAEjB,IAAK,IAAInI,EAAImI,EAAKoB,IAAKvJ,EAAGA,EAAIA,EAAE+I,KAC/BjJ,KAAK8G,KAAK5G,EAAEZ,OAEb,OAAOU,MAQR6K,QAAS,SAAUC,EAAIC,EAAQ,MAE9B,IAAIjB,EAEJ,IAAK,IAAI5J,EAAIF,KAAKyJ,IAAKvJ,EAAGA,EAAI4J,EAG7B,GADAA,EAAK5J,EAAE+I,MACgC,IAAnC6B,EAAI5K,EAAEZ,MAAOY,EAAGF,KAAM+K,GAAoB,OAAO,EAGtD,OAAO,GAQRC,WAAY,SAAUF,EAAIC,EAAQ,MAEjC,IAAIjB,EAEJ,IAAK,IAAI5J,EAAIF,KAAK0J,OAAQxJ,EAAGA,EAAI4J,EAGhC,GADAA,EAAK5J,EAAE8I,MACgC,IAAnC8B,EAAI5K,EAAEZ,MAAOY,EAAGF,KAAM+K,GAAoB,OAAO,EAGtD,OAAO,GAORE,KAAM,SAAUH,EAAIC,EAAQ,MAE3B,IAAK,IAAI7K,EAAIF,KAAKyJ,IAAKvJ,EAAGA,EAAIA,EAAE+I,KAC/B,GAAI6B,EAAG5K,EAAEZ,MAAOyL,GAAU,OAAO7K,EAAEZ,MAEpC,OAAO,MAOR4L,OAAQ,SAAUJ,EAAIC,EAAQ,MAE7B,IAAI1C,EAAOmB,EAAKZ,KAAK3B,QAErB,IAAK,IAAI/G,EAAIF,KAAKyJ,IAAKvJ,EAAGA,EAAIA,EAAE+I,KAC3B6B,EAAG5K,EAAEZ,MAAOyL,IAAU1C,EAAKvB,KAAK5G,EAAEZ,OAEvC,OAAO+I,GAOR8C,QAAS,WAER,IAAIC,EAAQ,GAEZ,IAAK,IAAIlL,EAAIF,KAAKyJ,IAAKvJ,EAAGA,EAAIA,EAAE+I,KAC/BmC,EAAMtE,KAAK5G,EAAEZ,OAEd,OAAO8L;;;iBAcT9F;EAASqD,WAAYa,EAAM,MAAO,UAClC6B,EAAe7B;cCnXf;MAAM8B,EAAQ,SAAUC,EAAOC,EAAUC,GAExCzL,KAAKyL,SAAWA,EAChBzL,KAAKwL,SAAWA,EAChBxL,KAAKuL,MAAQA,EACbvL,KAAK0L,OAAS,KAEd1L,KAAK2L,WAAY,EACjB3L,KAAK4L,UAAY,EACjB5L,KAAK6L,MAAQ,EACb7L,KAAK8L,MAAQ,EACb9L,KAAK+L,MAAQ,EACb/L,KAAKgM,OAAS,EAEdhM,KAAKiM,WAAa,KACjBjM,KAAKkM,aAGNlM,KAAKmM,aAAe,KACnBnM,KAAKoM,WAOPd,EAAM3F,UAAUuG,UAAY,WAE3B,IAAKlM,KAAK2L,UAAW,OAErB3L,KAAK6L,MAAQQ,QAAUrM,KAAK4L,UAE5B,IAAIU,EAAStM,KAAK6L,OAAS7L,KAAK8L,MAAQ9L,KAAKwL,UACzCc,EAAS,EAEZtM,KAAKuM,UAAUD,IAIhBtM,KAAK8L,OAAS9L,KAAKwL,UAAY,EAAI1F,IAAIwG,EAAStM,KAAKwL,WAErDxL,KAAKgM,OAASM,EAAS,EAAItM,KAAKwL,SAAYxL,KAAK6L,MAAQ7L,KAAK+L,MAC9D/L,KAAK+L,MAAQ/L,KAAK6L,MAElB7L,KAAKuM,SAAUvM,KAAK8L,MAAQ9L,KAAKwL,UAAaa,QAAUrM,KAAK4L,YAC7D5L,KAAKyL,SAASzL,KAAKgM,OAAQhM,QAW5BsL,EAAM3F,UAAU6G,MAAQ,SAAUC,GAAU,EAAOC,EAAM,GAEpD1M,KAAK2L,YAET3L,KAAK4L,UAAYS,QACjBrM,KAAK2L,WAAY,EAEjB3L,KAAK8L,MAAQ,EACb9L,KAAK+L,MAAQ,EAEb/L,KAAK2M,YAEDF,GACHzM,KAAKyL,SAAU,EAAGzL,MAEnBA,KAAKuM,SAASvM,KAAKwL,SAASkB,KAQ7BpB,EAAM3F,UAAU4G,SAAW,SAAUK,GAEb5M,KAAKuL,MAE3BsB,sBAAsB7M,KAAKmM,eAIxBnM,KAAK0L,QACRoB,aAAa9M,KAAK0L,QAEnB1L,KAAK0L,OAASqB,WAAW/M,KAAKiM,WAAYW,KAQ3CtB,EAAM3F,UAAUyG,OAAS,WAEpBpM,KAAK0L,QACRoB,aAAa9M,KAAK0L,QAEnB1L,KAAK0L,OAASqB,WAAW/M,KAAKiM,WAAY,IAQ3CX,EAAM3F,UAAUqH,KAAO,WAEjBhN,KAAK2L,YAEN3L,KAAK0L,SAERoB,aAAa9M,KAAK0L,QAClB1L,KAAK0L,OAAS,MAGf1L,KAAK2L,WAAY,EACjB3L,KAAKiN,cAQN3B,EAAM3F,UAAUgH,UAAY,aAS5BrB,EAAM3F,UAAUsH,UAAY,iBAI5BC,EAAe5B;;aC7If;MAAM6B,EAAOzN,EAAMC,OAClB,CACAiG,UAAW,OAOXrG,EAAG,EAAG6N,EAAG,EAUTrN,OAAQ,SAAUR,EAAE,KAAM6N,EAAE,MAE3B,OAAOpN,KAAKqN,IAAI9N,EAAG6N,IAOpBxD,MAAO,WAEN,OAAOuD,EAAKvE,KAAK3B,MAAMjH,OAWxBqN,IAAK,SAAU9N,EAAG6N,EAAE,MAEnB,GAAU,OAAN7N,EACHA,EAAI,EACJ6N,EAAI,OAEA,GAAU,OAANA,EAAY,CACpB,IAAIE,EAAI/N,EACRA,EAAI+N,EAAE/N,EACN6N,EAAIE,EAAEF,EAMP,OAHApN,KAAKT,EAAIA,EACTS,KAAKoN,EAAIA,EAEFpN,MAORuN,KAAM,SAAUhO,GAGf,OADAS,KAAKT,EAAIA,EACFS,MAORwN,KAAM,SAAUJ,GAGf,OADApN,KAAKoN,EAAIA,EACFpN,MAORyN,KAAM,WAEL,OAAOzN,KAAKqN,IAAI,EAAG,IAOpBK,OAAQ,WAEP,OAAiB,GAAV1N,KAAKT,GAAoB,GAAVS,KAAKoN,GAW5BO,OAAQ,SAAUpO,EAAG6N,EAAE,MAEtB,GAAU,OAANA,EACJ,CACC,IAAIE,EAAI/N,EACRA,EAAI+N,EAAE/N,EACN6N,EAAIE,EAAEF,EAGP,OAAOpN,KAAKT,GAAKA,GAAKS,KAAKoN,GAAKA,GAOjCQ,IAAK,WAGJ,OADA5N,KAAKT,GAAKS,KAAKT,EAAGS,KAAKoN,GAAKpN,KAAKoN,EAC1BpN,MAOR6N,IAAK,WAGJ,OADA7N,KAAKT,EAAI,EAAIS,KAAKT,EAAGS,KAAKoN,EAAI,EAAIpN,KAAKoN,EAChCpN,MAORkI,IAAK,WAIJ,OAFAlI,KAAKT,EAAIS,KAAKT,EAAI,GAAKS,KAAKT,EAAIS,KAAKT,EACrCS,KAAKoN,EAAIpN,KAAKoN,EAAI,GAAKpN,KAAKoN,EAAIpN,KAAKoN,EAC9BpN,MAWR8N,UAAW,SAAUC,EAAIC,EAAG,MAE3B,GAAW,OAAPA,EACJ,CACC,IAAIV,EAAIS,EACRA,EAAKT,EAAE/N,EACPyO,EAAKV,EAAEF,EAIR,OADApN,KAAKT,GAAKwO,EAAI/N,KAAKoN,GAAKY,EACjBhO,MAORiO,OAAQ,SAAUC,GAEjB,IAAI3O,EAAIS,KAAKT,EAAEqH,KAAKuH,IAAID,GAASlO,KAAKoN,EAAExG,KAAKwH,IAAIF,GAC7Cd,EAAIpN,KAAKoN,EAAExG,KAAKuH,IAAID,GAASlO,KAAKT,EAAEqH,KAAKwH,IAAIF,GAKjD,OAHAlO,KAAKT,EAAIA,EACTS,KAAKoN,EAAIA,EAEFpN,MAWRqO,IAAK,SAAUN,EAAIC,EAAG,MAErB,GAAW,OAAPA,EACJ,CACC,IAAIV,EAAIS,EACRA,EAAKT,EAAE/N,EACPyO,EAAKV,EAAEF,EAIR,OADApN,KAAKT,GAAKwO,EAAI/N,KAAKoN,GAAKY,EACjBhO,MAWRsO,IAAK,SAAUP,EAAIC,EAAG,MAErB,GAAW,OAAPA,EACJ,CACC,IAAIV,EAAIS,EACRA,EAAKT,EAAE/N,EACPyO,EAAKV,EAAEF,EAIR,OADApN,KAAKT,GAAKwO,EAAI/N,KAAKoN,GAAKY,EACjBhO,MAeR0M,MAAO,SAAU6B,EAAIC,EAAG,MAEvB,GAAW,OAAPA,EAEH,GAAIrB,EAAK7C,WAAWiE,GAAK,CACxB,IAAIjB,EAAIiB,EACRA,EAAKjB,EAAE/N,EACPiP,EAAKlB,EAAEF,OAEPoB,EAAKD,EAKP,OADAvO,KAAKT,GAAKgP,EAAIvO,KAAKoN,GAAKoB,EACjBxO,MAORyO,MAAO,WAKN,OAHAzO,KAAKT,EAAIuG,IAAI9F,KAAKT,GAClBS,KAAKoN,EAAItH,IAAI9F,KAAKoN,GAEXpN,MAOR0O,MAAO,WAKN,OAHA1O,KAAKT,EAAIS,KAAKT,EAAIuG,IAAI9F,KAAKT,GAC3BS,KAAKoN,EAAIpN,KAAKoN,EAAItH,IAAI9F,KAAKoN,GAEpBpN,MAWR2O,IAAK,SAAUpP,EAAG6N,EAAE,MAEnB,GAAU,OAANA,EACJ,CACC,IAAIE,EAAI/N,EACRA,EAAI+N,EAAE/N,EACN6N,EAAIE,EAAEF,EAGP,OAAOpN,KAAKT,EAAEA,EAAIS,KAAKoN,EAAEA,GAO1BwB,UAAW,SAAUC,GAAQ,GAE5B,OAAOA,EAAW7O,KAAKT,EAAES,KAAKT,EAAIS,KAAKoN,EAAEpN,KAAKoN,EAAKxG,KAAKkI,KAAK9O,KAAKT,EAAES,KAAKT,EAAIS,KAAKoN,EAAEpN,KAAKoN,IAO1F2B,UAAW,WAEV,OAAO/O,KAAK0N,SAAW1N,KAAOA,KAAK0M,MAAO,EAAI1M,KAAK4O,cAOpDI,UAAW,WAGV,OADIpI,KAAKsB,IAAIlI,KAAKT,GAAKqH,KAAKsB,IAAIlI,KAAKoN,GAAIpN,KAAKoN,EAAI,EAAQpN,KAAKT,EAAI,EAC5DS,MAORiP,UAAW,WAGV,OADIrI,KAAKsB,IAAIlI,KAAKT,GAAKqH,KAAKsB,IAAIlI,KAAKoN,GAAIpN,KAAKoN,EAAI,EAAQpN,KAAKT,EAAI,EAC5DS,MAORkP,KAAM,WAIL,OAFAlP,KAAKT,EAAKS,KAAKT,EAASS,KAAKT,EAAI,GAAI,EAAK,EAAvB,EACnBS,KAAKoN,EAAKpN,KAAKoN,EAASpN,KAAKoN,EAAI,GAAI,EAAK,EAAvB,EACZpN,MAORmP,SAAU,WAET,MAAO,IAAInP,KAAKT,MAAMS,KAAKoN;;;iBAkB7B9H;EAASqD,WAAYwE,EAAM,KAAM,UACjCiC,EAAejC;;oBCzXf;MAAMkC,EAAO,IAAIC,aAAa,GAAGC,KAAK,GAChCC,EAAQ,IAAIF,aAAa,GAAGC,KAAK,GAQjCE,EAAS/P,EAAMC,OACpB,CACAiG,UAAW,SAMX8J,KAAM,KAcN3P,OAAQ,SAAST,EAAM,MAEJ,OAAdU,KAAK0P,OACR1P,KAAK0P,KAAO,IAAIJ,aAAa,IAEhB,OAAVhQ,EACHU,KAAKqN,IAAI/N,GAETU,KAAK2P,YAOPlC,KAAM,WAGL,OADAzN,KAAK0P,KAAKH,KAAK,GACRvP,MAORuP,KAAM,SAAUjQ,GAGf,OADAU,KAAK0P,KAAKH,KAAKjQ,GACRU,MAWRqN,IAAK,SAAU/N,GAEd,GAAImQ,EAAOnF,WAAWhL,GAErB,IAAK,IAAIY,EAAI,EAAGA,EAAI,EAAGA,IAAKF,KAAK0P,KAAKxP,GAAKZ,EAAMoQ,KAAKxP,QAItD,IAAK,IAAI0P,EAAI,EAAGA,EAAI,EAAGA,IAAK5P,KAAK0P,KAAKE,GAAKtQ,EAAMsQ,GAGlD,OAAO5P,MAOR2P,SAAU,SAAUE,EAAO,MAQ1B,OANe,OAAXA,IACHA,EAAS7P,KAAK0P,MAEfG,EAAON,KAAK,GACZM,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAAK,EAE7B7P,MAOR8P,OAAQ,SAAUC,GAEjB,IAAK,IAAI7P,EAAI,EAAGA,EAAI,EAAGA,IAAKF,KAAK0P,KAAKxP,IAAM6P,EAC5C,OAAO/P,MAOR4J,MAAO,WAEN,OAAO6F,EAAO7G,KAAK3B,MAAMjH,OAO1B4K,OAAQ,SAAUoF,GAEbA,aAAgBP,IACnBO,EAAOA,EAAKN,MAEb,IAAK,IAAIxP,EAAI,EAAGA,EAAI,EAAGA,IAAKmP,EAAKnP,GAAKF,KAAK0P,KAAKxP,GAYhD,OAVAF,KAAK0P,KAAK,GAAKM,EAAK,GAAGX,EAAK,GAAKW,EAAK,GAAGX,EAAK,GAAKW,EAAK,GAAGX,EAAK,GAChErP,KAAK0P,KAAK,GAAKM,EAAK,GAAGX,EAAK,GAAKW,EAAK,GAAGX,EAAK,GAAKW,EAAK,GAAGX,EAAK,GAChErP,KAAK0P,KAAK,GAAKM,EAAK,GAAGX,EAAK,GAAKW,EAAK,GAAGX,EAAK,GAAKW,EAAK,GAAGX,EAAK,GAChErP,KAAK0P,KAAK,GAAKM,EAAK,GAAGX,EAAK,GAAKW,EAAK,GAAGX,EAAK,GAAKW,EAAK,GAAGX,EAAK,GAChErP,KAAK0P,KAAK,GAAKM,EAAK,GAAGX,EAAK,GAAKW,EAAK,GAAGX,EAAK,GAAKW,EAAK,GAAGX,EAAK,GAChErP,KAAK0P,KAAK,GAAKM,EAAK,GAAGX,EAAK,GAAKW,EAAK,GAAGX,EAAK,GAAKW,EAAK,GAAGX,EAAK,GAChErP,KAAK0P,KAAK,GAAKM,EAAK,GAAGX,EAAK,GAAKW,EAAK,GAAGX,EAAK,GAAKW,EAAK,GAAGX,EAAK,GAChErP,KAAK0P,KAAK,GAAKM,EAAK,GAAGX,EAAK,GAAKW,EAAK,GAAGX,EAAK,GAAKW,EAAK,GAAGX,EAAK,GAChErP,KAAK0P,KAAK,GAAKM,EAAK,GAAGX,EAAK,GAAKW,EAAK,GAAGX,EAAK,GAAKW,EAAK,GAAGX,EAAK,GAEzDrP,MAOR8N,UAAW,SAAUvO,EAAG6N,GAEvB,GAAS,GAAL7N,GAAe,GAAL6N,EACb,OAAOpN,KAER,IAAK,IAAIE,EAAI,EAAGA,EAAI,EAAGA,IAAKmP,EAAKnP,GAAKF,KAAK0P,KAAKxP,GAMhD,OAJAF,KAAK0P,KAAK,GAAKnQ,EAAE8P,EAAK,GAAKjC,EAAEiC,EAAK,GAAKA,EAAK,GAC5CrP,KAAK0P,KAAK,GAAKnQ,EAAE8P,EAAK,GAAKjC,EAAEiC,EAAK,GAAKA,EAAK,GAC5CrP,KAAK0P,KAAK,GAAKnQ,EAAE8P,EAAK,GAAKjC,EAAEiC,EAAK,GAAKA,EAAK,GAErCrP,MAORiO,OAAQ,SAAUC,GAEjB,GAAa,GAATA,EACH,OAAOlO,KAERA,KAAK2P,SAASH,GAEd,IAAIS,EAAOrJ,KAAKuH,IAAID,GAChBgC,EAAOtJ,KAAKwH,IAAIF,GAOpB,OALAsB,EAAM,GAAKS,EACXT,EAAM,IAAMU,EACZV,EAAM,GAAKU,EACXV,EAAM,GAAKS,EAEJjQ,KAAK4K,OAAO4E,IAOpB9C,MAAO,SAAUyD,EAAIC,GAEpB,OAAU,GAAND,GAAiB,GAANC,EACPpQ,MAERA,KAAK2P,SAASH,GAEdA,EAAM,GAAKW,EACXX,EAAM,GAAKY,EAEJpQ,KAAK4K,OAAO4E,KAWpBa,QAAS,SAAU9Q,EAAG6N,EAAE,MAEvB,GAAU,OAANA,EACJ,CACC,MAAME,EAAI/N,EACVA,EAAI+N,EAAE/N,EACN6N,EAAIE,EAAEF,EAGP,IAAIkD,EAAKtQ,KAAK0P,KAAK,GAAGnQ,EAAIS,KAAK0P,KAAK,GAAGtC,EAAIpN,KAAK0P,KAAK,GACjDa,EAAKvQ,KAAK0P,KAAK,GAAGnQ,EAAIS,KAAK0P,KAAK,GAAGtC,EAAIpN,KAAK0P,KAAK,GAErD,OAAON,EAAKxG,KAAK3B,MAAMqJ,EAAIC,IAO5BC,UAAW,WAEVnB,EAAKE,KAAK,GAEV,IAAK,IAAIkB,EAAI,EAAGA,EAAI,EAAGA,IACvB,IAAK,IAAIvQ,EAAI,EAAGA,EAAI,EAAGA,IACtBmP,EAAO,EAAFoB,EAAIvQ,GAAKF,KAAK0P,KAAO,EAAFxP,EAAIuQ,GAE7B,IAAK,IAAIC,EAAI,EAAGA,EAAI,EAAGA,IAAK1Q,KAAK0P,KAAKgB,GAAKrB,EAAKqB,GAEhD,OAAO1Q,MAOR2Q,IAAK,WAEJ,OAAO3Q,KAAK0P,KAAK,IAAM1P,KAAK0P,KAAK,GAAG1P,KAAK0P,KAAK,GAAK1P,KAAK0P,KAAK,GAAG1P,KAAK0P,KAAK,IACxE1P,KAAK0P,KAAK,IAAM1P,KAAK0P,KAAK,GAAG1P,KAAK0P,KAAK,GAAK1P,KAAK0P,KAAK,GAAG1P,KAAK0P,KAAK,IACnE1P,KAAK0P,KAAK,IAAM1P,KAAK0P,KAAK,GAAG1P,KAAK0P,KAAK,GAAK1P,KAAK0P,KAAK,GAAG1P,KAAK0P,KAAK,KAQtEkB,IAAK,WAmBJ,MAAM,IAAI/K,MAAM,oBAOjBgL,QAAS,WAER,IAAIF,EAAM3Q,KAAK2Q,MACf,OAAKA,EAEE3Q,KAAK4Q,MAAMd,OAAO,EAAEa,GAFV,MASlBxB,SAAU,WAET,MAAO,IAAInP,KAAK0P,KAAK,OAAO1P,KAAK0P,KAAK,OAAO1P,KAAK0P,KAAK,SAAS1P,KAAK0P,KAAK,OAAO1P,KAAK0P,KAAK,OAAO1P,KAAK0P,KAAK,SAAS1P,KAAK0P,KAAK,OAAO1P,KAAK0P,KAAK,OAAO1P,KAAK0P,KAAK,WAQnKD,EAAOqB,aAAe,SAAUjB,GAE/BA,EAAON,KAAK,GACZM,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAAK;;;;AAqBrCvK,EAASqD,WAAY8G,EAAQ,KAAM,UACnCsB,EAAetB;;;;;;;;;;;;;;;;WClUf;MAAMuB,EACN,CACCC,aAAc,GACdC,YAAa,GAMbC,GAAI,KAMJC,WAAY,SAAUrG,GAuBrB,OArBA/K,KAAKmR,GAAKpG,EAEV/K,KAAKiR,aAAaI,aAAerR,KAAKmR,GAAGE,aACzCrR,KAAKiR,aAAaK,qBAAuBtR,KAAKmR,GAAGG,qBACjDtR,KAAKiR,aAAaM,iBAAmBvR,KAAKmR,GAAGI,iBAC7CvR,KAAKiR,aAAaO,kBAAoBxR,KAAKmR,GAAGK,kBAC9CxR,KAAKiR,aAAaQ,0BAA4BzR,KAAKmR,GAAGM,0BACtDzR,KAAKiR,aAAaS,eAAiB1R,KAAKmR,GAAGO,eAC3C1R,KAAKiR,aAAaU,kBAAoB3R,KAAKmR,GAAGQ,kBAC9C3R,KAAKiR,aAAaW,oBAAsB5R,KAAKmR,GAAGS,oBAEhD5R,KAAKkR,YAAYW,YAAc7R,KAAKmR,GAAGU,YACvC7R,KAAKkR,YAAYY,aAAe9R,KAAKmR,GAAGW,aACxC9R,KAAKkR,YAAYa,YAAc/R,KAAKmR,GAAGY,YACvC/R,KAAKkR,YAAYc,YAAchS,KAAKmR,GAAGa,YACvChS,KAAKkR,YAAYe,aAAejS,KAAKmR,GAAGc,aACxCjS,KAAKkR,YAAYgB,YAAclS,KAAKmR,GAAGe,YACvClS,KAAKkR,YAAYiB,YAAcnS,KAAKmR,GAAGgB,YACvCnS,KAAKkR,YAAYkB,aAAepS,KAAKmR,GAAGiB,aACxCpS,KAAKkR,YAAYmB,YAAcrS,KAAKmR,GAAGkB,YAEhCrS,MAORsS,aAAc,SAAUlK,GAEvB,OAAOpI,KAAKmR,GAAGmB,aAAatS,KAAKmR,GAAG/I,KAOrCmK,gBAAiB,SAAU7C,EAAM8C,EAAQrS,GAExC,GAAe,IAAXqS,GAAgBrS,IAAWuP,EAAKvP,QAE/BuP,aAAgBJ,aACnB,OAAOI,EAGT,IAAI+C,EAAO,IAAInD,aAAanP,GAE5B,IAAK,IAAID,EAAI,EAAGA,EAAIC,EAAQD,IAC3BuS,EAAKvS,GAAKwP,EAAKxP,EAAEsS,GAElB,OAAOC,GASRC,iBAAkB,SAAUhD,EAAMG,EAAO,KAAM8C,EAAM,KAAMH,EAAO,KAAMrS,EAAO,MAE9E0P,EAASA,MAAAA,EAAAA,EAAUmB,EAAGC,aAAaI,aACnCsB,EAAQA,MAAAA,EAAAA,EAAS3B,EAAGE,YAAYW,YAEhC,IAAIY,EAAOzS,KAAKmR,GAAGyB,eAKnB,OAJA5S,KAAKmR,GAAG0B,WAAYhD,EAAQ4C,GAC5BzS,KAAKmR,GAAG2B,WAAYjD,EAAQ7P,KAAKuS,gBAAgB7C,EAAM8C,MAAAA,EAAAA,EAAU,EAAGrS,MAAAA,EAAAA,EAAUuP,EAAKvP,QAASwS,GAGrFF;AAMTM,EAAe/B;aCnGf;MAAMgC,EACN,CAICC,SAAU,GAMV5F,IAAK,SAAUjF,EAAM8K,GAEpBlT,KAAKiT,SAAS7K,GAAQ8K,GAOvBC,IAAK,SAAU/K,GAEd,OAAOpI,KAAKiT,SAASG,eAAehL,GAAQpI,KAAKiT,SAAS7K,GAAQ,IAMnEiL,QAAS,SAAUC,EAAMC,GAExBD,EAAOA,EAAKE,MAAM,MAElB,IAAK,IAAItT,EAAI,EAAGA,EAAIoT,EAAKnT,OAAQD,IACjC,CACC,IAAIZ,EAAQgU,EAAKpT,GAAGuT,OAEpB,GAAInU,EAAMoU,WAAW,SACrB,CACC,IAAIC,EAAM,GAEV,IAAK,IAAIvL,KAAQ9I,EAAMsU,UAAU,GAAGJ,MAAM,KAEzCpL,EAAOA,EAAKqL,OAERF,EAAgBH,eAAehL,KAGnCmL,EAAgBnL,IAAQ,EAExBuL,GAAOX,EAAKK,QAAQL,EAAKG,IAAI/K,GAAOmL,GAAmB,MAGxDD,EAAKpT,GAAKyT,GAIZ,OAAOL,EAAKO,KAAK,OAYlBC,QAAS,SAAUR,GAUlB,OANkC,KAFlCA,EAAOA,EAAKG,QAEHM,QAAQ,eAChBT,EAAO,2BAA6BA,IAEJ,IAA7BA,EAAKS,QAAQ,cAChBT,EAAO,oBAAsBA,GAEvBtT,KAAKqT,QAAQC,EAAM;AAM5BU,EAAehB,EAMfA,EAAK3F,IAAI,UAAW,+EAMpB2F,EAAK3F,IAAI,UAAW,+EAMpB2F,EAAK3F,IAAI,QAAS,uEAMlB2F,EAAK3F,IAAI,aAAc,6NAUvB2F,EAAK3F,IAAI,iBAAkB,+OAS3B2F,EAAK3F,IAAI,WAAY,mKAQrB2F,EAAK3F,IAAI,OAAQ,gHAMjB2F,EAAK3F,IAAI,QAAS;;;;ACtIlB,MAAM4G,EAASvU,EAAMC,OACpB,CAKAuU,GAAI,KAMJC,KAAM,EAMNC,SAAU,KAkBVrU,OAAQ,SAAUmU,EAAIC,EAAK,KAAMjB,EAAO,MAExB,OAAXA,GAA4B,OAATiB,GAAkC,iBAAVA,IAE9CjB,EAASiB,EACTA,EAAO,MAGK,OAATA,IAEHA,EAAOD,EACPA,EAAK,MAGND,EAAOI,IAAIrU,KAAKkU,GAAKA,EAAIlU,MACzBA,KAAKmU,KAAOA,EAEZnU,KAAKoU,SAAW,KAEZlB,GACHlT,KAAKsU,QAAQpB,IAMflL,OAAQ,WAEP+K,EAAI5B,GAAGoD,aAAavU,KAAKoU,UACzBH,EAAO5J,OAAOrK,KAAKkU,KAOpBI,QAAS,SAAUpB,GAElB,IAAI/B,EAAK4B,EAAI5B,GACbnR,KAAKoU,SAAWjD,EAAGqD,aAAcxU,KAAKmU,OAASF,EAAOQ,KAAKC,OAASvD,EAAGwD,cAAiB3U,KAAKmU,OAASF,EAAOQ,KAAKG,SAAWzD,EAAG0D,gBAAkB1D,EAAG2D,iBAErJ5B,EAASc,EAAKF,QAAQZ,GAEtB/B,EAAG4D,aAAa/U,KAAKoU,SAAUlB,GAC/B/B,EAAG6D,cAAchV,KAAKoU,UAEtB,IAAIrM,EAAQoJ,EAAG8D,iBAAiBjV,KAAKoU,UACrC,GAAIrM,EAEH,MADAD,QAAQC,MAAMmL,EAAOM,MAAM,MAAM0B,KAAI,CAAChV,EAAEL,IAAWA,EAAS,KAAOK,IAAG2T,KAAK,OACrE,IAAIhO,OAAQ7F,KAAKkU,GAAK,IAAMlU,KAAKkU,GAAK,KAAO,IAAMnM,GAG1D,OAAO/H;SASTiU;EAAOkB,QAAU,GAMjBlB,EAAOI,IAAM,SAAUH,EAAIkB,GAEtBlB,IAAIlU,KAAKmV,QAAQjB,GAAMkB,IAO5BnB,EAAOd,IAAM,SAAUe,GAEtB,OAAOlU,KAAKmV,QAAQjB,IAOrBD,EAAO5J,OAAS,SAAU6J,UAElBlU,KAAKmV,QAAQjB;;;AAWrBD,EAAOQ,KAAO,CACbC,OAAQ;;AAERE,SAAU;;AAEVS,SAAU;AAMXC,EAAerB;;;;sBChJf;MAAMsB,EAAgB7V,EAAMC,OAC3B,CAIA6V,UAAW,KAMXtB,GAAI,KAMJiB,QAAS,KAMTM,UAAW,KAMX1V,OAAQ,SAAUmU,EAAG,MAEpBlU,KAAKkU,GAAKA,EAEVlU,KAAKmV,QAAU,GACfnV,KAAKyV,UAAY,KAEjBzV,KAAKwV,UAAY,GAEjBxV,KAAK0V,eAAiB,KAEtBH,EAAclB,IAAIH,EAAIlU,OAMvBgI,OAAQ,WAEP,IAAImJ,EAAK4B,EAAI5B,GACb,IAAKA,EAAI,OAAOnR,KAEhBmR,EAAGwE,cAAc3V,KAAKyV,WACtBF,EAAclL,OAAOrK,KAAKkU,KAS3B0B,cAAe,SAAUA,GAGxB,OADA5V,KAAK0V,eAAiBE,EACf5V,MAOR6V,OAAQ,SAAUT,GAKjB,GAHuB,iBAAZA,IACVA,EAASE,EAAOnC,IAAIiC,KAEhBA,EACJ,MAAM,IAAIvP,MAAO,8CAGlB,OADA7F,KAAKmV,QAAQrO,KAAKsO,GACXpV,MAMR8V,cAAe,WAEd/C,EAAI5B,GAAG4E,mBAAoB/V,KAAKyV,UAAW,EAAG,aAO/CO,kBAAmB,SAAU5N,GAK5B,OAHKpI,KAAKwV,UAAUpC,eAAehL,KAClCpI,KAAKwV,UAAUpN,GAAQ2K,EAAI5B,GAAG6E,kBAAmBhW,KAAKyV,UAAWrN,IAE3DpI,KAAKwV,UAAUpN,IAOvB6N,mBAAoB,SAAU7N,GAK7B,OAHKpI,KAAKwV,UAAUpC,eAAehL,KAClCpI,KAAKwV,UAAUpN,GAAQ2K,EAAI5B,GAAG8E,mBAAoBjW,KAAKyV,UAAWrN,IAE5DpI,KAAKwV,UAAUpN,IAOvB8N,wBAAyB,SAAU9N,GAKlC,OAHKpI,KAAKwV,UAAUpC,eAAehL,KAClCpI,KAAKwV,UAAUpN,GAAQ2K,EAAI5B,GAAGgF,qBAAsBnW,KAAKyV,UAAWrN,IAE9DpI,KAAKwV,UAAUpN,IAOvBgO,oBAAqB,SAAUC,GAK9B,MAH6B,iBAAlBA,IACVA,EAAerW,KAAKkW,wBAAwBG,IAEtCtD,EAAI5B,GAAGmF,+BAA+BtW,KAAKyV,UAAWY,EAActD,EAAI5B,GAAGoF,0BAOnFC,yBAA0B,SAAUH,GAEN,iBAAlBA,IACVA,EAAerW,KAAKkW,wBAAwBG,IAE7C,IAAII,EAAOzW,KAAKoW,oBAAoBC,GAChC5D,EAAOM,EAAIL,iBAAkB,IAAIpD,aAAamH,GAAMlH,KAAK,GAAIwD,EAAI9B,aAAaS,eAAgBqB,EAAI7B,YAAYY,cAElHiB,EAAI5B,GAAGuF,eAAgB3D,EAAI9B,aAAaS,eAAgB,EAAGe,IAM5DkE,iBAAkB,WAEjB3W,KAAKiW,mBAAmB,UACxBjW,KAAKiW,mBAAmB,WAExBjW,KAAKiW,mBAAmB,eACxBjW,KAAKiW,mBAAmB,aACxBjW,KAAKiW,mBAAmB,UAExBjW,KAAKiW,mBAAmB,gBACxBjW,KAAKiW,mBAAmB,gBAExBjW,KAAKiW,mBAAmB,WACxBjW,KAAKiW,mBAAmB,WACxBjW,KAAKiW,mBAAmB,gBAExBjW,KAAKiW,mBAAmB,YAExBjW,KAAKgW,kBAAkB,aAOxBY,KAAM,WAEL,IAAIzF,EAAK4B,EAAI5B,GACb,IAAKA,EAAI,OAAOnR,KAEhBA,KAAKyV,UAAYtE,EAAG0F,gBAEpB,IAAK,IAAIzB,KAAUpV,KAAKmV,QACvBhE,EAAG2F,aAAc9W,KAAKyV,UAAWL,EAAOhB,UAMzC,OAJApU,KAAK8V,gBACL3E,EAAG4F,YAAa/W,KAAKyV,WACrBzV,KAAK2W,mBAEE3W,MAORgX,SAAU,WAET,IAAI7F,EAAK4B,EAAI5B,GACRA,IAELA,EAAG8F,WAAYjX,KAAKyV,WAEQ,OAAxBzV,KAAK0V,gBACR1V,KAAK0V,eAAgB1V,KAAMmR,KAO7B+F,UAAW,WAEV,IAAI/F,EAAK4B,EAAI5B,GACb,OAAKA,GAEEA,EAAGgG,oBAAoBnX,KAAKyV,UAAWtE,EAAGiG,cAOlDC,SAAU,WAET,IAAIlG,EAAK4B,EAAI5B,GACb,OAAKA,EAEkB,OAAnBnR,KAAKyV,UACD,+BAEDtE,EAAGmG,kBAAkBtX,KAAKyV,WALjB,IAYjB8B,UAAW,SAAUC,EAAUC,GAM9B,MAJyB,iBAAdD,IACVA,EAAWxX,KAAKiW,mBAAmBuB,IAEpCzE,EAAI5B,GAAGoG,UAAWC,EAAUC,GACrBzX,MAOR0X,WAAY,SAAUF,EAAUlY,GAM/B,MAJyB,iBAAdkY,IACVA,EAAWxX,KAAKiW,mBAAmBuB,IAEpCzE,EAAI5B,GAAGuG,WAAYF,EAAUlY,GACtBU,MAOR2X,UAAW,SAAUH,EAAUC,GAM9B,MAJyB,iBAAdD,IACVA,EAAWxX,KAAKiW,mBAAmBuB,IAEpCzE,EAAI5B,GAAGwG,UAAWH,EAAUC,GACrBzX,MAOR4X,WAAY,SAAUJ,EAAUlY,GAM/B,MAJyB,iBAAdkY,IACVA,EAAWxX,KAAKiW,mBAAmBuB,IAEpCzE,EAAI5B,GAAGyG,WAAYJ,EAAUlY,GACtBU,MAOR6X,UAAW,SAAUL,EAAUC,EAAIK,GAMlC,MAJyB,iBAAdN,IACVA,EAAWxX,KAAKiW,mBAAmBuB,IAEpCzE,EAAI5B,GAAG0G,UAAWL,EAAUC,EAAIK,GACzB9X,MAOR+X,WAAY,SAAUP,EAAUlY,GAM/B,MAJyB,iBAAdkY,IACVA,EAAWxX,KAAKiW,mBAAmBuB,IAEpCzE,EAAI5B,GAAG4G,WAAYP,EAAUlY,GACtBU,MAORgY,UAAW,SAAUR,EAAUC,EAAIK,GAMlC,MAJyB,iBAAdN,IACVA,EAAWxX,KAAKiW,mBAAmBuB,IAEpCzE,EAAI5B,GAAG6G,UAAWR,EAAUC,EAAIK,GACzB9X,MAORiY,WAAY,SAAUT,EAAUlY,GAM/B,MAJyB,iBAAdkY,IACVA,EAAWxX,KAAKiW,mBAAmBuB,IAEpCzE,EAAI5B,GAAG8G,WAAYT,EAAUlY,GACtBU,MAORkY,UAAW,SAAUV,EAAUC,EAAIK,EAAIK,GAMtC,MAJyB,iBAAdX,IACVA,EAAWxX,KAAKiW,mBAAmBuB,IAEpCzE,EAAI5B,GAAG+G,UAAWV,EAAUC,EAAIK,EAAIK,GAC7BnY,MAORoY,WAAY,SAAUZ,EAAUlY,GAM/B,MAJyB,iBAAdkY,IACVA,EAAWxX,KAAKiW,mBAAmBuB,IAEpCzE,EAAI5B,GAAGiH,WAAYZ,EAAUlY,GACtBU,MAORqY,UAAW,SAAUb,EAAUC,EAAIK,EAAIK,GAMtC,MAJyB,iBAAdX,IACVA,EAAWxX,KAAKiW,mBAAmBuB,IAEpCzE,EAAI5B,GAAGkH,UAAWb,EAAUC,EAAIK,EAAIK,GAC7BnY,MAORsY,WAAY,SAAUd,EAAUlY,GAM/B,MAJyB,iBAAdkY,IACVA,EAAWxX,KAAKiW,mBAAmBuB,IAEpCzE,EAAI5B,GAAGmH,WAAYd,EAAUlY,GACtBU,MAORuY,UAAW,SAAUf,EAAUC,EAAIK,EAAIK,EAAIK,GAM1C,MAJyB,iBAAdhB,IACVA,EAAWxX,KAAKiW,mBAAmBuB,IAEpCzE,EAAI5B,GAAGoH,UAAWf,EAAUC,EAAIK,EAAIK,EAAIK,GACjCxY,MAORyY,WAAY,SAAUjB,EAAUlY,GAM/B,MAJyB,iBAAdkY,IACVA,EAAWxX,KAAKiW,mBAAmBuB,IAEpCzE,EAAI5B,GAAGsH,WAAYjB,EAAUlY,GACtBU,MAOR0Y,UAAW,SAAUlB,EAAUC,EAAIK,EAAIK,EAAIK,GAM1C,MAJyB,iBAAdhB,IACVA,EAAWxX,KAAKiW,mBAAmBuB,IAEpCzE,EAAI5B,GAAGuH,UAAWlB,EAAUC,EAAIK,EAAIK,EAAIK,GACjCxY,MAOR2Y,WAAY,SAAUnB,EAAUlY,GAM/B,MAJyB,iBAAdkY,IACVA,EAAWxX,KAAKiW,mBAAmBuB,IAEpCzE,EAAI5B,GAAGwH,WAAYnB,EAAUlY,GACtBU,QAQTuV,EAAcqD,SAAW,GAMzBrD,EAAclB,IAAM,SAAUH,EAAI2E,GAE7B3E,IAAIlU,KAAK4Y,SAAS1E,GAAM2E,IAO7BtD,EAAcpC,IAAM,SAAUe,GAE7B,OAAOlU,KAAK4Y,SAAS1E,IAOtBqB,EAAclL,OAAS,SAAU6J,UAEzBlU,KAAK4Y,SAAS1E,QAGtB4E,EAAevD;;;;;;;;;;;;;eCvaf;MAAMwD,EAAS,SAAUC,EAAQ,MAEhC,IAAIC,EAAO,CACVC,KAAM,KACN/H,IAAI,EACJgI,WAAY,UACZC,MAAO,EACPC,OAAQ,EACRC,QAAQ,EACRC,UAAU,EACVC,WAAW,KACRR,GAGJ,MAAMS,GAAWrU,EAAOsU,SAGP,MAAbT,EAAKC,MAERlZ,KAAKkZ,KAAQO,EAAqD5P,EAAKD,MAAMmP,EAAOY,gBAA5DvU,EAAOsU,SAASE,cAAc,UAElDxU,EAAOsU,UAA2B,GAAfT,EAAKK,SAE3BlU,EAAOsU,SAASG,KAAKC,YAAa9Z,KAAKkZ,OAEjB,IAAlBD,EAAKM,WACRvZ,KAAKkZ,KAAKa,MAAMC,SAAW,WAC3Bha,KAAKkZ,KAAKa,MAAME,KAAO,IACvBja,KAAKkZ,KAAKa,MAAMtQ,IAAM,OAMxBzJ,KAAKkZ,KAAOD,EAAKC,KAGblZ,KAAKkZ,KAAKgB,cAEC,IAAZjB,EAAK9H,IAAgBsI,GAexBzZ,KAAK+K,QAAU/K,KAAKkZ,KAAKgB,WAAW,KAAM,CAAEC,gBAAgB,IAC5Dna,KAAKmR,GAAK,OAdVnR,KAAKmR,GAAKnR,KAAKkZ,KAAKgB,WAAW,SAAU,CAAEC,gBAAgB,EAAOC,OAAO,EAAOC,SAAS,IAEzFC,EAAQnJ,GAAKnR,KAAKmR,GAClBmJ,EAAQzB,cAAgB,KAExB9F,EAAI3B,WAAWpR,KAAKmR,IAEpBnR,KAAK+K,QAAU,KAEfwP,EAAIC,MAAMzH,EAAIT,aAAa,WAAa,KAAOS,EAAIT,aAAa,8BASjEtS,KAAKya,YAAcpP,EAAKzC,KAAK3B,QAC7BjH,KAAK0a,WAAarP,EAAKzC,KAAK3B,QAC5BjH,KAAK2a,eAAiBtP,EAAKzC,KAAK3B,QAChCjH,KAAK4a,mBAAqBvP,EAAKzC,KAAK3B,QAEpCjH,KAAKgQ,KAAOe,EAAOnI,KAAK3B,QACxBjH,KAAK6a,UAAY9J,EAAOnI,KAAK3B,QAG7BjH,KAAK8a,aAAe,EACpB9a,KAAK+a,OAAS,EACd/a,KAAKgb,YAAa,EAGlBhb,KAAKib,kBACLjb,KAAKkb,YAAY,QACjBlb,KAAKmb,UAAU,QAEXlC,EAAKG,OAASH,EAAKI,QACvBrZ,KAAKob,OAAQnC,EAAKG,MAAOH,EAAKI,QAEd,OAAZrZ,KAAKmR,IACRnR,KAAKqb,SAENrb,KAAKwZ,UAAYP,EAAKO,UACtBxZ,KAAKsb,cAAerC,EAAKE,cAG1BJ,EAAOY,eACP,CACC4B,WAAY,KAEZC,uBAAuB,EAEvBzB,MAAO,GAGPX,MAAO,IACPC,OAAQ,IAERa,WAAY,SAAUuB,GACrB,OAAOzb,MAGR0b,SAAU,aAGVC,QAAS,aAGTjP,MAAO,SAAUyD,EAAIC,KAGrBnC,OAAQ,SAAUC,KAGlBJ,UAAW,SAAUvO,EAAG6N,KAGxBwO,aAAc,SAAUvb,EAAGC,EAAGC,EAAGC,EAAGqb,EAAGC,KAGvCb,gBAAiB,aAGjBc,UAAW,SAAUC,EAAMC,GAC1B,MAAO,IAGRC,UAAW,aAGXC,OAAQ,SAAU5c,EAAG6N,KAGrBgP,UAAW,aAGXC,OAAQ,aAGRC,KAAM,SAAS/c,EAAG6N,EAAGmP,EAAGC,KAGxBjN,KAAM,aAGNkN,OAAQ,aAGRC,SAAU,SAASnd,EAAG6N,EAAGmP,EAAGC,KAG5BG,WAAY,SAASpd,EAAG6N,EAAGmP,EAAGC,KAG9BI,KAAM,aAGNC,iBAAkB,SAAUC,EAAKC,EAAKxd,EAAG6N,KAGzC4P,cAAe,SAAUC,EAAKC,EAAKC,EAAKC,EAAK7d,EAAG6N,KAGhDiQ,IAAK,SAAU9d,EAAG6N,EAAGkQ,EAAGC,EAAIC,EAAIC,KAGhCC,MAAO,SAAUC,EAAIC,EAAIC,EAAIC,EAAIR,KAGjCS,SAAU,SAAUC,EAAMze,EAAG6N,EAAG6Q,KAGhCC,WAAY,SAAUF,EAAMze,EAAG6N,EAAG6Q,KAGlCE,YAAa,SAAUH,GACtB,MAAO,CAAE5E,MAAO,IAGjBgF,gBAAiB,SAAU7B,EAAGC,GAC7B,MAAO,CAAEpD,MAAOmD,EAAGlD,OAAQmD,IAG5B6B,aAAc,SAAU9e,EAAG6N,EAAGmP,EAAGC,GAChC,MAAO,CAAEpD,MAAOmD,EAAGlD,OAAQmD,EAAG9M,KAAM,KAGrC4O,aAAc,SAAU5O,EAAMnQ,EAAG6N,KAGjCmR,UAAW,SAAUC,EAAKrO,EAAG,EAAGC,EAAG,EAAGqO,EAAG,KAAMC,EAAG,KAAM3Q,EAAG,KAAMC,EAAG,KAAM2Q,EAAG,KAAMC,EAAG,KAAMC,EAAa,KAAMC,EAAc,KAAMC,EAAW,KAAMC,EAAY,QAGhKC,sBAAuB,WACtB,MAAO,CAAEhF,KAAM,EAAGxQ,IAAK,KAOzBsP,EAAOpT,UAAU0V,OAAS,WAEzB,IAAI6D,EAAKlf,KAAKmR,GA8Id,GAzIAnR,KAAKmf,iBAAmB,IAAIrG,EAAc,OAE1C,IAAIxD,EAAQ,WAAYA,EAAOb,KAAKC,OACpC,gcAqBA,IAAIY,EAAQ,WAAYA,EAAOb,KAAKG,SACpC,yVAuBA5U,KAAKof,eAAiB,IAAItG,EAAc,SAExC,IAAIxD,EAAQ,aAAcA,EAAOb,KAAKC,OACtC,kZAoBA,IAAIY,EAAQ,aAAcA,EAAOb,KAAKG,SACtC,4SAoBA5U,KAAKqf,cAAgB,IAAIvG,EAAc,QAEvC,IAAIxD,EAAQ,YAAaA,EAAOb,KAAKC,OACrC,kUAgBA,IAAIY,EAAQ,YAAaA,EAAOb,KAAKG,SACrC,iKAYA5U,KAAKmf,iBAAiBtJ,OAAO,YAC7B7V,KAAKmf,iBAAiBtJ,OAAO,YAE7B7V,KAAKof,eAAevJ,OAAO,cAC3B7V,KAAKof,eAAevJ,OAAO,cAE3B7V,KAAKqf,cAAcxJ,OAAO,aAC1B7V,KAAKqf,cAAcxJ,OAAO,aAE1B7V,KAAKmf,iBAAiBvI,OACtB5W,KAAKof,eAAexI,OACpB5W,KAAKqf,cAAczI,QAEd5W,KAAKmf,iBAAiBjI,YAC1B,MAAM,IAAIrR,MAAO7F,KAAKmf,iBAAiBG,gBAExC,IAAKtf,KAAKof,eAAelI,YACxB,MAAM,IAAIrR,MAAO7F,KAAKof,eAAeE,gBAEtC,IAAKtf,KAAKqf,cAAcnI,YACvB,MAAM,IAAIrR,MAAO7F,KAAKqf,cAAcC,gBAErCtf,KAAKuf,iBAAiBzG,EAAc3F,IAAI,QAKxCnT,KAAKwf,KAAON,EAAGO,oBACfP,EAAGQ,gBAAgB1f,KAAKwf,MAExBzM,EAAIL,iBAAiB,CAAE,EAAK,EAAK,EAAM,EAAK,EAAK,EAAM,EAAK,EAAK,EAAM,EAAK,EAAK,GAAOK,EAAI9B,aAAaI,aAAc0B,EAAI7B,YAAYW,aAEvIqN,EAAGS,oBAAoBrF,EAAQzB,cAAc7C,kBAAkB,YAAa,EAAGkJ,EAAGU,MAAOV,EAAGW,MAAO,EAAEvQ,aAAawQ,kBAAmB,EAAExQ,aAAawQ,mBACpJZ,EAAGa,wBAAwBzF,EAAQzB,cAAc7C,kBAAkB,aAKnEkJ,EAAGc,WAAY,EAAK,EAAK,EAAK,GAE9Bd,EAAGe,OAAQf,EAAGgB,YACdhB,EAAGiB,WAAY,GACfjB,EAAGkB,UAAWlB,EAAGmB,QAEjBnB,EAAGe,OAAQf,EAAGoB,OACdpB,EAAGqB,UAAWrB,EAAGsB,UAAWtB,EAAGuB,qBAO/BzgB,KAAK0gB,OAAS,IAAIpR,aAAa,GAAGC,KAAK,GACvCvP,KAAK2gB,UAAY,IAAIrR,aAAa,GAAGC,KAAK,GAC1CvP,KAAK4gB,aAAe,IAAItR,aAAa,GAAGC,KAAK,GAC7CvP,KAAK6gB,OAAS,EAEd9P,EAAOD,aAAa9Q,KAAK0gB,QACzB3P,EAAOD,aAAa9Q,KAAK2gB,WAGzB3gB,KAAKue,UAAY,SAAUC,EAAKrO,EAAIC,EAAIqO,EAAIC,EAAI3Q,EAAIC,EAAI2Q,EAAIC,EAAIC,EAAa,KAAMC,EAAc,KAAMC,EAAW,KAAMC,EAAY,MAEnI,IAAKR,EAAIsC,eACR,OAED,IAAI3P,EAAKnR,KAAKmR,GACV4P,EAAUzG,EAAQzB,cAED,OAAjBgG,IAEHA,EAAeL,EAAIpF,MACnB0F,EAAgBN,EAAInF,QAGF,OAAf0F,IAEHA,EAAaP,EAAIwC,YACjBhC,EAAcR,EAAIyC,cAGnBF,EAAQhJ,WAAY,eAAgB/X,KAAK4gB,cACzCG,EAAQxJ,UAAW,SAAU+C,EAAQ4G,MACrCH,EAAQxJ,UAAW,UAAWvX,KAAK8a,cACnCiG,EAAQxJ,UAAW,UAAWvX,KAAK+a,QAE/B/a,KAAKmhB,oBAAsB3C,EAAI4C,aAAephB,KAAKqhB,iBAAmBN,IAEzE5P,EAAGmQ,cAAenQ,EAAGoQ,UACrBpQ,EAAGqQ,YAAarQ,EAAGsQ,WAAYjD,EAAI4C,aAEnCL,EAAQpJ,UAAW,WAAY,GAC/BoJ,EAAQxI,UAAW,eAAgBwG,EAAWP,EAAIkD,OAAO7C,EAAcG,EAAYR,EAAIkD,OAAO5C,EAAeC,EAAYC,GAEzHhf,KAAKmhB,kBAAoB3C,EAAI4C,YAC7BphB,KAAKqhB,eAAiBN,GAGvB/gB,KAAK0gB,OAAO,GAAK/B,EACjB3e,KAAK0gB,OAAO,GAAK9B,EACjB5e,KAAK0gB,OAAO,GAAK3S,EACjB/N,KAAK0gB,OAAO,GAAK1S,EAEjBhO,KAAK2gB,UAAU,GAAKlC,EAAKI,EACzB7e,KAAK2gB,UAAU,GAAKjC,EAAKI,EACzB9e,KAAK2gB,UAAU,GAAKxQ,EAAK0O,EACzB7e,KAAK2gB,UAAU,GAAKvQ,EAAK0O,EAEzB3N,EAAGwQ,iBAAkBZ,EAAQ9K,mBAAmB,gBAAgB,EAAOjW,KAAK6a,UAAUnL,MACtFyB,EAAGwQ,iBAAkBZ,EAAQ9K,mBAAmB,WAAW,EAAOjW,KAAK0gB,QACvEvP,EAAGwQ,iBAAkBZ,EAAQ9K,mBAAmB,cAAc,EAAOjW,KAAK2gB,WAC1ExP,EAAGoG,UAAWwJ,EAAQ9K,mBAAmB,WAAYjW,KAAK6gB,QAC1D1P,EAAGyQ,WAAYzQ,EAAG0Q,eAAgB,EAAG,IAItC7hB,KAAK8hB,SAAW,SAAUviB,EAAG6N,EAAGmP,EAAGC,GAElC,IAAIrL,EAAKnR,KAAKmR,GACV4P,EAAUzG,EAAQzB,cAEtBkI,EAAQhJ,WAAY,eAAgB/X,KAAK4gB,cACzCG,EAAQxJ,UAAW,SAAU+C,EAAQ4G,MACrCH,EAAQxJ,UAAW,UAAWvX,KAAK8a,cACnCiG,EAAQxJ,UAAW,UAAWvX,KAAK+a,QAEnC/a,KAAKmhB,kBAAoB,KAEzBnhB,KAAK0gB,OAAO,GAAKnE,EACjBvc,KAAK0gB,OAAO,GAAKlE,EACjBxc,KAAK0gB,OAAO,GAAKnhB,EACjBS,KAAK0gB,OAAO,GAAKtT,EAEjBpN,KAAK2gB,UAAU,GAAK,EACpB3gB,KAAK2gB,UAAU,GAAK,EACpB3gB,KAAK2gB,UAAU,GAAK,EACpB3gB,KAAK2gB,UAAU,GAAK,EAEpBxP,EAAGwQ,iBAAkBZ,EAAQ9K,mBAAmB,gBAAgB,EAAOjW,KAAK6a,UAAUnL,MACtFyB,EAAGwQ,iBAAkBZ,EAAQ9K,mBAAmB,WAAW,EAAOjW,KAAK0gB,QACvEvP,EAAGwQ,iBAAkBZ,EAAQ9K,mBAAmB,cAAc,EAAOjW,KAAK2gB,WAC1ExP,EAAGoG,UAAW,UAAWvX,KAAK6gB,QAC9B1P,EAAGyQ,WAAYzQ,EAAG0Q,eAAgB,EAAG,KASvC9I,EAAOpT,UAAUoc,aAAe,SAAUC,GAEzC,IAAI7Q,EAAKnR,KAAKmR,GACd,GAAU,MAANA,EAAY,OAAO,EAEvB,IAAI8Q,EAAU9Q,EAAG+Q,gBA0BjB,OAzBA/Q,EAAGqQ,YAAYrQ,EAAGsQ,WAAYQ,GAE9B9Q,EAAGgR,aAAahR,EAAGsQ,WAAY,EAAGtQ,EAAGiR,MAAOJ,EAAM5I,MAAO4I,EAAM3I,QAC/DlI,EAAGkR,cAAclR,EAAGsQ,WAAY,EAAG,EAAG,EAAGO,EAAM5I,MAAO4I,EAAM3I,OAAQlI,EAAGmR,KAAMnR,EAAGoR,cAAeP,GAE1FA,EAAM9W,SACV8W,EAAM9W,OAAS,WAEK,YAAjB8W,EAAM9W,QAETiG,EAAGqR,cAAcrR,EAAGsQ,WAAYtQ,EAAGsR,mBAAoBtR,EAAGuR,SAC1DvR,EAAGqR,cAAcrR,EAAGsQ,WAAYtQ,EAAGwR,mBAAoBxR,EAAGuR,WAI1DvR,EAAGqR,cAAcrR,EAAGsQ,WAAYtQ,EAAGsR,mBAAoBtR,EAAGyR,QAC1DzR,EAAGqR,cAAcrR,EAAGsQ,WAAYtQ,EAAGwR,mBAAoBxR,EAAGyR,SAG3DzR,EAAGqR,cAAcrR,EAAGsQ,WAAYtQ,EAAG0R,eAAgB1R,EAAG2R,eACtD3R,EAAGqR,cAAcrR,EAAGsQ,WAAYtQ,EAAG4R,eAAgB5R,EAAG2R,eAEtDd,EAAMZ,YAAca,EACpBD,EAAMlB,gBAAiB,GAEhB,GAOR/H,EAAOpT,UAAUqd,cAAgB,SAAUhB,GAE1C,IAAI7Q,EAAKnR,KAAKmR,GACd,OAAU,MAANA,GAAe6Q,EAAMlB,gBAEzB3P,EAAGqQ,YAAYrQ,EAAGsQ,WAAYO,EAAMZ,aACpCjQ,EAAGqR,cAAcrR,EAAGsQ,WAAYtQ,EAAG0R,eAAgB1R,EAAG8R,QACtD9R,EAAGqR,cAAcrR,EAAGsQ,WAAYtQ,EAAG4R,eAAgB5R,EAAG8R,QAE/CjB,GANyCA,GAYjDjJ,EAAOpT,UAAUud,YAAc,WAER,GAAlBljB,KAAKwZ,WAEY,MAAhBxZ,KAAK+K,UACR/K,KAAK+K,QAAQyQ,uBAAwB,GAEtCxb,KAAKkZ,KAAKa,MAAMoJ,eAAiB,gBAIb,MAAhBnjB,KAAK+K,UACR/K,KAAK+K,QAAQyQ,uBAAwB,GAEtCxb,KAAKkZ,KAAKa,MAAMoJ,eAAiB,SAOnCpK,EAAOpT,UAAUoE,QAAU,WAEtB/J,KAAKkZ,KAAKqC,YACbvb,KAAKkZ,KAAKqC,WAAW6H,YAAapjB,KAAKkZ,MAExClZ,KAAKya,YAAY5S,OACjB7H,KAAK0a,WAAW7S,OAChB7H,KAAK2a,eAAe9S,OACpB7H,KAAK4a,mBAAmB/S,OAExB7H,KAAKgQ,KAAO,KACZhQ,KAAK+K,QAAU,KACf/K,KAAKkZ,KAAO,MAObH,EAAOpT,UAAU2V,cAAgB,SAAU+H,GAK1C,GAHArjB,KAAKkZ,KAAKa,MAAMZ,WAAakK,EAC7BrjB,KAAKsjB,gBAAkBD,EAEP,OAAZrjB,KAAKmR,GACT,CACC,GAAoB,GAAhBkS,EAAMljB,OACT,MAAM,IAAI0F,MAAO,oFAElB,IAAIyX,EAAIiG,SAASF,EAAMG,OAAO,EAAE,GAAI,IAAM,IACtCC,EAAIF,SAASF,EAAMG,OAAO,EAAE,GAAI,IAAM,IACtCljB,EAAIijB,SAASF,EAAMG,OAAO,EAAE,GAAI,IAAM,IAE1CxjB,KAAKmR,GAAG6O,WAAY1C,EAAGmG,EAAGnjB,EAAG,KAQ/ByY,EAAOpT,UAAUyV,OAAS,SAAUhC,EAAOC,GAE1C,IAAIiD,EAAOtc,KAAKkZ,KAAK+F,wBAEhB7F,IAAOA,EAAQkD,EAAKlD,OACpBC,IAAQA,EAASiD,EAAKjD,QAE3BrZ,KAAKkZ,KAAKE,MAAQA,EAClBpZ,KAAKkZ,KAAKG,OAASA,EAEnBrZ,KAAKoZ,MAAQpZ,KAAKkZ,KAAKE,MACvBpZ,KAAKqZ,OAASrZ,KAAKkZ,KAAKG,OAExBrZ,KAAK0jB,OAAS5d,IAAI9F,KAAKoZ,MAAQpZ,KAAK8a,cACpC9a,KAAK2jB,QAAU7d,IAAI9F,KAAKqZ,OAASrZ,KAAK8a,cAEtC,IAAI3J,EAAKnR,KAAKmR,GAmBd,OAlBU,MAANA,IAEHA,EAAG8O,OAAQ9O,EAAGyS,cACdzS,EAAG0S,QAAS,EAAG,EAAG7jB,KAAKoZ,MAAOpZ,KAAKqZ,QACnClI,EAAG2S,SAAU,EAAG,EAAG9jB,KAAKoZ,MAAOpZ,KAAKqZ,QAEhCrZ,KAAK4gB,eAMR5gB,KAAK4gB,aAAa,GAAK5gB,KAAKoZ,MAC5BpZ,KAAK4gB,aAAa,GAAK5gB,KAAKqZ,SAI9BrZ,KAAKkjB,cACEljB,MAOR+Y,EAAOpT,UAAUoe,YAAc,SAAUzkB,GAaxC,OAXAU,KAAK8a,aAAexb,EAEpBU,KAAK0jB,OAAS5d,IAAI9F,KAAKoZ,MAAQpZ,KAAK8a,cACpC9a,KAAK2jB,QAAU7d,IAAI9F,KAAKqZ,OAASrZ,KAAK8a,cAEtC9a,KAAK8Q,eAIJ9Q,KAAK0M,MAAMpN,EAAOA,GAEZU,MAOR+Y,EAAOpT,UAAUqe,QAAU,SAAU1kB,GAcpC,OAZIA,GAEHU,KAAK0jB,OAAS5d,IAAI9F,KAAKqZ,OAASrZ,KAAK8a,cACrC9a,KAAK2jB,QAAU7d,IAAI9F,KAAKoZ,MAAQpZ,KAAK8a,gBAIrC9a,KAAK0jB,OAAS5d,IAAI9F,KAAKoZ,MAAQpZ,KAAK8a,cACpC9a,KAAK2jB,QAAU7d,IAAI9F,KAAKqZ,OAASrZ,KAAK8a,eAGvC9a,KAAKikB,UAAY3kB,EACVU,MAOR+Y,EAAOpT,UAAU+V,SAAW,WAE3B,OAAO1b,MAOR+Y,EAAOpT,UAAUgW,QAAU,WAK1B,OAHe,MAAX3b,KAAKmR,IACRnR,KAAKmR,GAAG0S,QAAQ,EAAG,EAAG7jB,KAAKoZ,MAAOpZ,KAAKqZ,QAEjCrZ,MAOR+Y,EAAOpT,UAAUue,UAAY,SAAUlI,EAAK,YAAaC,EAAO,MAE/D,OAAOjc,KAAKkZ,KAAK6C,UAAWC,EAAMC,IAOnClD,EAAOpT,UAAUwe,YAAc,WAE9B,OAAOnkB,KAAKkZ,KAAK6C,UAAU,aAAayH,OAAO,KAMhDzK,EAAOpT,UAAUye,kBAAoB,SAAUhc,EAAM9I,EAAM,MAE1D,GAAKU,KAAK+K,QAEV,OAAc,OAAVzL,GAEHU,KAAK+K,QAAQ3C,GAAQ9I,EACdU,MAGDA,KAAK+K,QAAQ3C,IAWrB2Q,EAAOpT,UAAUwV,UAAY,SAAU7b,GAEtC,OAAOU,KAAKokB,kBAAmB,YAAa9kB,IAW7CyZ,EAAOpT,UAAUuV,YAAc,SAAU5b,GAExC,OAAOU,KAAKokB,kBAAmB,cAAe9kB,IAW/CyZ,EAAOpT,UAAU0e,QAAU,SAAU/kB,GAEpC,OAAOU,KAAKokB,kBAAmB,UAAW9kB,IAY3CyZ,EAAOpT,UAAU2e,SAAW,SAAUhlB,GAErC,OAAOU,KAAKokB,kBAAmB,WAAY9kB,IAW5CyZ,EAAOpT,UAAU4e,UAAY,SAAUjlB,GAEtC,OAAOU,KAAKokB,kBAAmB,YAAa9kB,IAW7CyZ,EAAOpT,UAAU6e,WAAa,SAAUllB,GAEvC,OAAOU,KAAKokB,kBAAmB,aAAc9kB,IAW9CyZ,EAAOpT,UAAU8e,YAAc,SAAUnlB,GAExC,OAAOU,KAAKokB,kBAAmB,cAAe9kB,IAW/CyZ,EAAOpT,UAAU+e,cAAgB,SAAUplB,GAE1C,OAAOU,KAAKokB,kBAAmB,gBAAiB9kB,IAWjDyZ,EAAOpT,UAAUgf,cAAgB,SAAUrlB,GAE1C,OAAOU,KAAKokB,kBAAmB,gBAAiB9kB,IAWjDyZ,EAAOpT,UAAUif,WAAa,SAAUtlB,GAEvC,OAAOU,KAAKokB,kBAAmB,aAAc9kB,IAW9CyZ,EAAOpT,UAAUkf,KAAO,SAAUvlB,GAEjC,OAAOU,KAAKokB,kBAAmB,OAAQ9kB,IAWxCyZ,EAAOpT,UAAUmf,UAAY,SAAUxlB,GAEtC,OAAOU,KAAKokB,kBAAmB,YAAa9kB,IAW7CyZ,EAAOpT,UAAUof,aAAe,SAAUzlB,GAEzC,OAAOU,KAAKokB,kBAAmB,eAAgB9kB,IAWhDyZ,EAAOpT,UAAUqf,YAAc,SAAU1lB,EAAM,MAE9C,OAAc,OAAVA,EAGIU,KAAK+a,QAFZ/a,KAAK+a,OAASzb,EAIRU,KAAKoa,MAAM,KAWnBrB,EAAOpT,UAAUsf,yBAA2B,SAAU3lB,GAErD,OAAOU,KAAKokB,kBAAmB,2BAA4B9kB,IAQ5DyZ,EAAOpT,UAAUsV,gBAAkB,WAGlC,OADAjb,KAAK4b,aAAc5b,KAAKgQ,KAAKN,KAAK,GAAI1P,KAAKgQ,KAAKN,KAAK,GAAI1P,KAAKgQ,KAAKN,KAAK,GAAI1P,KAAKgQ,KAAKN,KAAK,GAAI1P,KAAKgQ,KAAKN,KAAK,GAAI1P,KAAKgQ,KAAKN,KAAK,IAC1H1P,MAQR+Y,EAAOpT,UAAUiW,aAAe,SAAUvb,EAAGC,EAAGC,EAAGC,EAAGqb,EAAGC,GAExD,OAAqB,OAAjB9b,KAAK+K,SAER/K,KAAK6a,UAAUnL,KAAK,GAAKrP,EACzBL,KAAK6a,UAAUnL,KAAK,GAAKpP,EACzBN,KAAK6a,UAAUnL,KAAK,GAAK,EACzB1P,KAAK6a,UAAUnL,KAAK,GAAKnP,EACzBP,KAAK6a,UAAUnL,KAAK,GAAKlP,EACzBR,KAAK6a,UAAUnL,KAAK,GAAK,EACzB1P,KAAK6a,UAAUnL,KAAK,GAAK5J,IAAI+V,GAC7B7b,KAAK6a,UAAUnL,KAAK,GAAK5J,IAAIgW,GAC7B9b,KAAK6a,UAAUnL,KAAK,GAAK,EAElB1P,OAIRA,KAAK+K,QAAQ6Q,aAAcvb,EAAGC,EAAGC,EAAGC,EAAGsF,IAAI+V,GAAI/V,IAAIgW,IAC5C9b,OAQR+Y,EAAOpT,UAAU+W,SAAW,SAAUnd,EAAG6N,EAAGmP,EAAGC,GAG9C,OADAxc,KAAK+K,QAAQ2R,SAAUnd,EAAG6N,EAAGmP,EAAGC,GACzBxc,MAQR+Y,EAAOpT,UAAUgX,WAAa,SAAUpd,EAAG6N,EAAGmP,EAAGC,GAGhD,OADAxc,KAAK+K,QAAQ4R,WAAYpd,EAAG6N,EAAGmP,EAAGC,GAC3Bxc,MAQR+Y,EAAOpT,UAAUuf,UAAY,SAAU3lB,EAAG6N,EAAGmP,EAAGC,GAG/C,OADAxc,KAAK+K,QAAQma,UAAW3lB,EAAG6N,EAAGmP,EAAGC,GAC1Bxc,MAQR+Y,EAAOpT,UAAUuW,UAAY,WAG5B,OADAlc,KAAK+K,QAAQmR,YACNlc,MAQR+Y,EAAOpT,UAAUwW,OAAS,SAAU5c,EAAG6N,GAGtC,OADApN,KAAK+K,QAAQoR,OAAQ5c,EAAG6N,GACjBpN,MAQR+Y,EAAOpT,UAAUyW,UAAY,WAG5B,OADApc,KAAK+K,QAAQqR,YACNpc,MAQR+Y,EAAOpT,UAAU0W,OAAS,SAAU9c,EAAG6N,GAGtC,OADApN,KAAK+K,QAAQsR,OAAQ9c,EAAG6N,GACjBpN,MAQR+Y,EAAOpT,UAAU2W,KAAO,SAAU/c,EAAG6N,EAAGmP,EAAGC,GAG1C,OADAxc,KAAK+K,QAAQuR,KAAM/c,EAAG6N,EAAGmP,EAAGC,GACrBxc,MAQR+Y,EAAOpT,UAAU4J,KAAO,SAAUjQ,EAAM,MAIvC,OAFIA,GAAOU,KAAKmb,UAAW7b,GAC3BU,KAAK+K,QAAQwE,OACNvP,MAQR+Y,EAAOpT,UAAU8W,OAAS,SAAUnd,EAAM,MAIzC,OAFIA,GAAOU,KAAKkb,YAAa5b,GAC7BU,KAAK+K,QAAQ0R,SACNzc,MAQR+Y,EAAOpT,UAAUiX,KAAO,SAAUrd,EAAG6N,EAAGgM,EAAOC,GAe9C,OAbgB,OAAZrZ,KAAKmR,KAER5R,GAAKS,KAAK8a,aACV1N,GAAKpN,KAAK8a,aACV1B,GAASpZ,KAAK8a,aACdzB,GAAUrZ,KAAK8a,aAEX9a,KAAKikB,UACRjkB,KAAKmR,GAAG0S,QAAQ7jB,KAAKoZ,MAAMhM,EAAEiM,EAAO,EAAGrZ,KAAKqZ,OAAO9Z,EAAE6Z,EAAM,EAAGC,EAAQD,GAEtEpZ,KAAKmR,GAAG0S,QAAQtkB,EAAGS,KAAKqZ,OAAOjM,EAAEiM,EAAO,EAAGD,EAAOC,IAG7CrZ,MAQR+Y,EAAOpT,UAAUkX,iBAAmB,SAAUC,EAAKC,EAAKxd,EAAG6N,GAG1D,OADApN,KAAK+K,QAAQ8R,iBAAkBC,EAAKC,EAAKxd,EAAG6N,GACrCpN,MAQR+Y,EAAOpT,UAAUqX,cAAgB,SAAUC,EAAKC,EAAKC,EAAKC,EAAK7d,EAAG6N,GAGjE,OADApN,KAAK+K,QAAQiS,cAAeC,EAAKC,EAAKC,EAAKC,EAAK7d,EAAG6N,GAC5CpN,MAQR+Y,EAAOpT,UAAU0X,IAAM,SAAU9d,EAAG6N,EAAGkQ,EAAGC,EAAIC,EAAIC,GAGjD,OADAzd,KAAK+K,QAAQsS,IAAK9d,EAAG6N,EAAGkQ,EAAGC,EAAIC,EAAIC,GAC5Bzd,MAQR+Y,EAAOpT,UAAU+X,MAAQ,SAAUC,EAAIC,EAAIC,EAAIC,EAAIR,GAGlD,OADAtd,KAAK+K,QAAQ2S,MAAOC,EAAIC,EAAIC,EAAIC,EAAIR,GAC7Btd,MAQR+Y,EAAOpT,UAAUoY,SAAW,SAAUC,EAAMze,EAAG6N,EAAG6Q,EAAS,KAG1D,OADAje,KAAK+K,QAAQgT,SAAUC,EAAMze,EAAG6N,EAAG6Q,GAC5Bje,MAQR+Y,EAAOpT,UAAUuY,WAAa,SAAUF,EAAMze,EAAG6N,EAAG6Q,EAAS,KAG5D,OADAje,KAAK+K,QAAQmT,WAAYF,EAAMze,EAAG6N,EAAG6Q,GAC9Bje,MASR+Y,EAAOpT,UAAUwY,YAAc,SAAUH,GAExC,OAAOhe,KAAK+K,QAAQoT,YAAYH,GAAM5E,OASvCL,EAAOpT,UAAUyY,gBAAkB,SAAU7B,EAAGC,GAE/C,OAAOxc,KAAK+K,QAAQqT,gBAAiB7B,EAAGC,IASzCzD,EAAOpT,UAAU0Y,aAAe,SAAU9e,EAAG6N,EAAGmP,EAAGC,GAElD,OAAOxc,KAAK+K,QAAQsT,aAAc9e,EAAG6N,EAAGmP,EAAGC,IAS5CzD,EAAOpT,UAAU2Y,aAAe,SAAU5O,EAAMnQ,EAAG6N,GAGlD,OADApN,KAAK+K,QAAQuT,aAAc5O,EAAMnQ,EAAG6N,GAC7BpN,MAWR+Y,EAAOpT,UAAU4Y,UAAY,SAAUC,EAAKrO,EAAG,EAAGC,EAAG,EAAGqO,EAAG,KAAMC,EAAG,KAAM3Q,EAAG,KAAMC,EAAG,KAAM2Q,EAAG,KAAMC,EAAG,MAEvG,GAAW,OAAPH,EAEHze,KAAK+K,QAAQwT,UAAWC,EAAK1Y,IAAIqK,GAAKrK,IAAIsK,SAEtC,GAAW,OAAPrC,EAER/N,KAAK+K,QAAQwT,UAAWC,EAAK1Y,IAAIqK,GAAKrK,IAAIsK,GAAKtK,IAAI2Y,GAAK3Y,IAAI4Y,QAG7D,CACC,IAAIrX,EAAKvB,IAAI2Y,GACTnX,EAAKxB,IAAI4Y,GACb,IAAKrX,IAAOC,EAAI,OAAOtH,KAEvB,IAAIyH,EAAK3B,IAAI6Y,GACTjX,EAAK5B,IAAI8Y,GACb,IAAKnX,IAAOC,EAAI,OAAO1H,KAEvBA,KAAK+K,QAAQwT,UAAWC,EAAK1Y,IAAIqK,GAAKrK,IAAIsK,GAAK/I,EAAIC,EAAIxB,IAAIiI,GAAKjI,IAAIkI,GAAKvG,EAAIC,GAG9E,OAAO1H,MAYR+Y,EAAOpT,UAAUuD,MAAQ,SAAUoa,EAAgB,MAElD,OAAe,MAAXtjB,KAAKmR,IAERnR,KAAKmR,GAAGjI,MAAMlJ,KAAKmR,GAAGgU,mBAAqBnlB,KAAKmR,GAAGiU,iBAAmBplB,KAAKmR,GAAGkU,kBAC9ErlB,KAAKmhB,kBAAoB,KAElBnhB,OAGJsjB,EAEHtjB,KAAKilB,yBAAyB,eAAeD,YAAY,GAAK7J,WAA8B,IAApBmI,EAA2BA,EAAkBtjB,KAAKsjB,iBAAiB5G,SAAS,EAAG,EAAG1c,KAAK0jB,OAAQ1jB,KAAK2jB,UAI5K3jB,KAAKkZ,KAAKE,MAAQpZ,KAAKoZ,MACvBpZ,KAAKkjB,eAGNljB,KAAKib,kBACEjb,OAOR+Y,EAAOpT,UAAU6G,MAAQ,aAOzBuM,EAAOpT,UAAU2f,IAAM,aAOvBvM,EAAOpT,UAAU4f,MAAQ,WAExB,IAAIpU,EAAKnR,KAAKmR,GACH,OAAPA,IAEJA,EAAGqU,WAAW,GAAO,GAAO,GAAO,GACnCrU,EAAGjI,MAAOiI,EAAGkU,kBACblU,EAAGqU,WAAW,GAAM,GAAM,GAAM,KAQjCzM,EAAOpT,UAAU8f,KAAO,SAAUxD,EAAS7I,EAAOC,EAAQR,EAAc,MAEvE,IAAI1H,EAAKnR,KAAKmR,GACH,OAAPA,IAEJ0H,EAAgBA,GAAiB7Y,KAAKqf,cAEtCrf,KAAKuf,iBAAiB1G,GACtB1H,EAAGuU,QAASvU,EAAG+O,YAEd/O,EAAGmQ,cAAenQ,EAAGoQ,UACrBpQ,EAAGqQ,YAAarQ,EAAGsQ,WAAYQ,GAC/BpJ,EAAclB,UAAW,WAAY,GAErCkB,EAAcd,WAAY,eAAgB/X,KAAK4gB,cAC/C/H,EAActB,UAAW,SAAU+C,EAAQ4G,MAC3CrI,EAActB,UAAW,UAAWvX,KAAK8a,cACzCjC,EAActB,UAAW,UAAWvX,KAAK+a,QAEzC/a,KAAK0gB,OAAO,GAAK1gB,KAAKoZ,MACtBpZ,KAAK0gB,OAAO,GAAK1gB,KAAKqZ,OACtBrZ,KAAK0gB,OAAO,GAAK,EACjB1gB,KAAK0gB,OAAO,GAAK,EAEjB1gB,KAAK2gB,UAAU,GAAK3gB,KAAKoZ,MAAQA,EACjCpZ,KAAK2gB,UAAU,GAAK3gB,KAAKqZ,OAASA,EAClCrZ,KAAK2gB,UAAU,GAAK,EACpB3gB,KAAK2gB,UAAU,GAAK,EAEpBxP,EAAGwQ,iBAAkB9I,EAAc5C,mBAAmB,WAAW,EAAOjW,KAAK0gB,QAC7EvP,EAAGwQ,iBAAkB9I,EAAc5C,mBAAmB,cAAc,EAAOjW,KAAK2gB,WAChFxP,EAAGyQ,WAAYzQ,EAAG0Q,eAAgB,EAAG,GAEtC7hB,KAAKuf,iBAAiBzG,EAAc3F,IAAI,QACxChC,EAAG8O,OAAQ9O,EAAG+O,cAQfnH,EAAOpT,UAAUgE,MAAQ,SAAUgc,GAAU,GAQ5C,OANA3lB,KAAKmb,UAAU,WAAWD,YAAY,WAAWmJ,QAAQ,QAAQC,SAAS,SACzEC,UAAU,KAAKC,WAAW,MAAMC,YAAY,WAAWC,cAAc,KACrEC,cAAc,KAAKC,WAAW,KAAKI,YAAY,OAAOC,yBAAyB,eAE5EU,GAAW3lB,KAAKkc,YAAYE,YAEzBpc,MAMR+Y,EAAOpT,UAAUigB,WAAa,WAK7B,OAHA5lB,KAAKya,YAAY3T,KAAK9G,KAAKgQ,MAC3BhQ,KAAKgQ,KAAOhQ,KAAKgQ,KAAKpG,QAEf5J,MAMR+Y,EAAOpT,UAAUkgB,UAAY,WAK5B,OAHA7lB,KAAKgQ,KAAKnI,OACV7H,KAAKgQ,KAAOhQ,KAAKya,YAAY9P,MAEtB3K,KAAKib,mBAUblC,EAAOpT,UAAUyU,MAAQ,SAAU9a,GAOlC,OALAU,KAAK+a,QAAUzb,EAEXU,KAAK+K,SAAuB,OAAZ/K,KAAKmR,KACxBnR,KAAK+K,QAAQia,YAAchlB,KAAK+a,QAE1B/a,MAMR+Y,EAAOpT,UAAUmgB,UAAY,WAG5B,OADA9lB,KAAK0a,WAAW5T,KAAM9G,KAAKglB,eACpBhlB,MAQR+Y,EAAOpT,UAAUogB,SAAW,WAG3B,OADA/lB,KAAKglB,YAAYhlB,KAAK0a,WAAW/P,OAC1B3K,MAMR+Y,EAAOpT,UAAUqgB,aAAe,SAAU1mB,GAEzC,IAAI6R,EAAKnR,KAAKmR,GACH,OAAPA,IAEA7R,GAEH6R,EAAG8O,OAAQ9O,EAAG+O,YACdlgB,KAAKgb,YAAa,IAIlB7J,EAAGuU,QAASvU,EAAG+O,YACflgB,KAAKgb,YAAa,KAOpBjC,EAAOpT,UAAUsgB,aAAe,WAE/B,OAAOjmB,KAAKgb,YAObjC,EAAOpT,UAAUugB,cAAgB,SAAU5mB,EAAM,MAEhD,GAAc,OAAVA,EAIH,OAFAA,IAAUA,KAEIU,KAAKgb,aAGnBhb,KAAK2a,eAAe7T,KAAK9G,KAAKgb,YAC9Bhb,KAAKgmB,aAAa1mB,IAEX,GAGRU,KAAK2a,eAAe7T,KAAK9G,KAAKgb,aAM/BjC,EAAOpT,UAAUwgB,aAAe,WAE/BnmB,KAAKgmB,aAAahmB,KAAK2a,eAAehQ,QAMvCoO,EAAOpT,UAAU4Z,iBAAmB,SAAUwB,GAGlC,OADF/gB,KAAKmR,KAGdmJ,EAAQzB,cAAgBkI,EACxBzG,EAAQzB,cAAc7B,aAMvB+B,EAAOpT,UAAUygB,iBAAmB,WAEnC,OAAO9L,EAAQzB,eAOhBE,EAAOpT,UAAU0gB,kBAAoB,SAAUtF,EAAQ,MAEtD,GAAgB,OAAZA,EAEH,OAAIA,IAAYzG,EAAQzB,gBAGxB7Y,KAAK4a,mBAAmB9T,KAAKwT,EAAQzB,eACrC7Y,KAAKuf,iBAAiBwB,IAEf,GAGR/gB,KAAK4a,mBAAmB9T,KAAKwT,EAAQzB,gBAMtCE,EAAOpT,UAAU2gB,iBAAmB,WAEnCtmB,KAAKuf,iBAAiBvf,KAAK4a,mBAAmBjQ,QAU/CoO,EAAOpT,UAAUmL,aAAe,WAG/B,OADA9Q,KAAKgQ,KAAKL,WACH3P,KAAKib,mBAUblC,EAAOpT,UAAU4gB,WAAa,SAAUvW,GAGvC,OADAhQ,KAAKgQ,KAAK3C,IAAI2C,GACPhQ,KAAKib,mBAUblC,EAAOpT,UAAU6gB,UAAY,SAAU5c,GAAM,GAE5C,OAAOA,EAAQ5J,KAAKgQ,KAAKpG,QAAU5J,KAAKgQ,MAUzC+I,EAAOpT,UAAU8gB,aAAe,SAAUzW,GAGzC,OADAhQ,KAAKgQ,KAAKpF,OAAOoF,GACVhQ,KAAKib,mBAWblC,EAAOpT,UAAU+G,MAAQ,SAAUyD,EAAIC,EAAIsW,GAE1C,OAAIA,GACH1mB,KAAK+K,QAAQ2B,MAAOyD,EAAIC,GACjBpQ,OAGRA,KAAKgQ,KAAKtD,MAAOyD,EAAIC,GACdpQ,KAAKib,oBAWblC,EAAOpT,UAAUsI,OAAS,SAAUC,EAAOwY,GAE1C,OAAIA,GACH1mB,KAAK+K,QAAQkD,OAAQC,GACdlO,OAGRA,KAAKgQ,KAAK/B,OAAOC,GACVlO,KAAKib,oBAWblC,EAAOpT,UAAUmI,UAAY,SAAUvO,EAAG6N,EAAGsZ,GAE5C,OAAIA,GACH1mB,KAAK+K,QAAQ+C,UAAUvO,EAAG6N,GACnBpN,OAGRA,KAAKgQ,KAAKlC,UAAUvO,EAAG6N,GAChBpN,KAAKib,oBAUblC,EAAOpT,UAAUghB,QAAU,SAAUpnB,EAAG6N,EAAGmP,EAAGC,GAE7C,IAAIoK,EAAMrK,EAAE,EAAG,SAAUsK,EAAMrK,EAAE,EAAG,SAChCsK,EAAKvnB,EAAEgd,EAAE,EAAGwK,EAAK3Z,EAAEoP,EAAE,EAAGwK,EAAKznB,EAAEgd,EAAE,EAAG0K,EAAK7Z,EAAEoP,EAAE,EASjD,OAPAxc,KAAKkc,YAAaC,OAAO5c,EAAG0nB,GAC5BjnB,KAAKgd,cAAezd,EAAG0nB,EAAKJ,EAAIG,EAAKJ,EAAIxZ,EAAG4Z,EAAI5Z,GAChDpN,KAAKgd,cAAegK,EAAKJ,EAAIxZ,EAAG0Z,EAAIG,EAAKJ,EAAIC,EAAIG,GACjDjnB,KAAKgd,cAAe8J,EAAIG,EAAKJ,EAAIG,EAAKJ,EAAIG,EAAIC,EAAID,GAClD/mB,KAAKgd,cAAegK,EAAKJ,EAAIG,EAAIxnB,EAAG0nB,EAAKJ,EAAItnB,EAAG0nB,GAChDjnB,KAAKoc,YAEEpc,MAYR+Y,EAAOpT,UAAUuhB,OAAS,SAAU3nB,EAAG6N,EAAGkQ,EAAGb,GAQ5C,OANAzc,KAAKkc,YACLlc,KAAKqd,IAAI9d,EAAG6N,EAAGkQ,EAAG,EAAG,EAAE1W,KAAKugB,IAC5BnnB,KAAKoc,YAEDK,GAAQzc,KAAKyc,OAAOA,GAEjBzc,MAYR+Y,EAAOpT,UAAUyhB,KAAO,SAAUzJ,EAAIC,EAAIC,EAAIC,EAAIrB,GAQjD,OANAzc,KAAKkc,YACLlc,KAAKmc,OAAOwB,EAAIC,GAChB5d,KAAKqc,OAAOwB,EAAIC,GAChB9d,KAAKoc,YAEDK,GAAQzc,KAAKyc,OAAOA,GACjBzc,MAYR+Y,EAAOpT,UAAU0hB,oBAAsB,WAEtC,GAAIrnB,KAAKsnB,eAAgB,OAAOtnB,KAEhCA,KAAKunB,aAAe,CAAEpX,GAAI,EAAGC,GAAI,GACjCpQ,KAAKwnB,cAAgB,CAAEjoB,EAAG,EAAG6N,EAAG,GAEhC,IAAIqa,EAAIznB,KAEJ0nB,EACJ,CACCC,OAAQ,GACRC,QAAS,EAAGC,SAAU,EACtBtoB,EAAG,EAAG6N,EAAG,EAET0a,YAAa,SAAUvoB,EAAG6N,EAAGmP,EAAGC,GAC/B,OAAOxc,KAAKT,GAAKA,GAAKS,KAAKT,GAAMA,EAAEgd,EAAE,GAAMvc,KAAKoN,GAAKA,GAAKpN,KAAKoN,GAAMA,EAAEoP,EAAE,IAuD3E,OAnDAxc,KAAK+nB,gBAAkB,GAEvB/nB,KAAKsnB,eAAiB,SAAUhU,EAAM0U,GAErC,IAAI1L,EAAOtc,KAAKkZ,KAAK+F,wBAErByI,EAAKC,OAASrU,EACdoU,EAAKE,QAAUI,EAAIJ,QACnBF,EAAKnoB,EAAImoB,EAAKO,GAAKniB,IAAIkiB,EAAIE,QAAU5L,EAAKrC,MAC1CyN,EAAKta,EAAIsa,EAAKS,GAAKriB,IAAIkiB,EAAII,QAAU9L,EAAK7S,KAE1Cie,EAAKnoB,GAAMmoB,EAAKnoB,EAAIkoB,EAAED,cAAcjoB,EAAK,EAAIkoB,EAAEF,aAAapX,IAAMsX,EAAEF,aAAapX,GACjFuX,EAAKta,GAAMsa,EAAKta,EAAIqa,EAAED,cAAcpa,EAAK,EAAIqa,EAAEF,aAAanX,IAAMqX,EAAEF,aAAanX,GAEjFsX,EAAKW,UAAW,EAEZX,EAAKE,UAAYF,EAAKG,WAEzBH,EAAKvX,GAAKuX,EAAKnoB,EACfmoB,EAAKtX,GAAKsX,EAAKta,EAEfsa,EAAKY,IAAMZ,EAAKa,IAAM,GAGnBb,EAAKE,SAAWF,EAAKG,WAExBH,EAAKW,UAAW,EAEhBX,EAAK3Z,GAAK2Z,EAAKnoB,EAAImoB,EAAKvX,GACxBuX,EAAK1Z,GAAK0Z,EAAKta,EAAIsa,EAAKtX,GAExBsX,EAAKc,IAAMd,EAAK3Z,GAAK2Z,EAAKY,IAC1BZ,EAAKe,IAAMf,EAAK1Z,GAAK0Z,EAAKa,IAE1Bb,EAAKY,IAAMZ,EAAK3Z,GAChB2Z,EAAKa,IAAMb,EAAK1Z,IAGjB0Z,EAAKG,SAAWH,EAAKE,QAErB,IAAK,IAAI1nB,EAAI,EAAGA,EAAIF,KAAK+nB,gBAAgB5nB,SAE8B,IAAlEH,KAAK+nB,gBAAgB7nB,GAAG,GAAIwnB,EAAM1nB,KAAK+nB,gBAAgB7nB,GAAG,IAFdA,OAOlDF,KAAKkZ,KAAKwP,YAAc,SAASV,GAAQP,EAAEH,eAAe,OAAQU,IAClEhoB,KAAKkZ,KAAKyP,UAAY,SAASX,GAAOP,EAAEH,eAAe,KAAMU,IAC7DhoB,KAAKkZ,KAAK0P,YAAc,SAASZ,GAAOP,EAAEH,eAAe,OAAQU,IAE1DhoB,MAUR+Y,EAAOpT,UAAUkjB,gBAAkB,SAAU1Y,EAAIC,GAGhD,OADApQ,KAAKunB,aAAe,CAAEpX,GAAIA,EAAIC,GAAIA,GAC3BpQ,MAUR+Y,EAAOpT,UAAUmjB,iBAAmB,SAAUvpB,EAAG6N,GAGhD,OADApN,KAAKwnB,cAAgB,CAAEjoB,EAAGA,EAAG6N,EAAGA,GACzBpN,MAWR+Y,EAAOpT,UAAUojB,kBAAoB,SAAUtd,EAAUV,GAMxD,OAJA/K,KAAKqnB,sBAELrnB,KAAK+nB,gBAAgBjhB,KAAM,CAAC9G,KAAK+nB,gBAAgB5nB,OAAO,IAAI2F,IAAkB,IAAdc,KAAKoiB,UAAevd,EAAUV,IAEvF/K,KAAK+nB,gBAAgB/nB,KAAK+nB,gBAAgB5nB,OAAO,GAAG,IAU5D4Y,EAAOpT,UAAUsjB,qBAAuB,SAAU/U,GAEjD,GAAKlU,KAAK+nB,gBAEV,IAAK,IAAI7nB,EAAI,EAAGA,EAAIF,KAAK+nB,gBAAgB5nB,OAAQD,IAEhD,GAAIF,KAAK+nB,gBAAgB7nB,GAAG,IAAMgU,EAClC,CACClU,KAAK+nB,gBAAgBmB,OAAOhpB,EAAG,GAC/B,QASH6Y,EAAOoQ,YAAc,SAAU/P,EAAOC,EAAQ+P,EAAMC,GAEnD,IAAI5F,EAAI,IAAI1K,EAAO,CAAEK,MAAOA,EAAOC,OAAQA,IAE3C+P,EAAK3F,GAEL,IAAIjF,EAAM,IAAI8K,MACd9K,EAAI+K,OAAS,KAEZ/K,EAAItT,OAAS,UACbsT,EAAIkD,OAAS,EACb8H,EAAOC,SAAS1H,aAAavD,GAC7B6K,EAAU7K,IAGXA,EAAIkL,IAAMjG,EAAES,YACZT,EAAE1Z,eAGH4f,EAAe5Q;;;;;;;;;;;eCvyDf;MAAM6Q,EACN,CAICC,MACA,CACCC,kBAAkB,EAClBC,iBAAiB,GAMlBC,eACA,CACC7Q,WAAY,UACZhI,IAAI,EACJ7I,KAAK,EAEL2hB,UAAU,EACVzQ,WAAW,EACX0Q,YAAa,EAEbC,IAAK,IACLC,OAAQ,GACR7e,OAAO,EAEP8e,YAAa,KACbC,aAAc,KAEdC,iBAAkB,EAClBC,eAAgB,KAEhBC,YAAY,GAObJ,YAAa,EAMbC,aAAc,EAMdJ,YAAa,EAKbQ,MAAO,EAAGC,MAAO,EAKjBC,iBAAkB,EAAGC,kBAAmB,EAAGC,iBAAkB,EAAGC,kBAAmB,EAAGC,YAAa,EAMnGC,cAAe,KAMfxB,SAAU,KAMVyB,eAAgB,KAMhBC,eAAgB,KAKhBC,kBAAmB,KAKnBC,SAAU,CAAEnK,KAAM,EAAGxW,OAAO,EAAO4gB,MAAM,EAAOC,KAAK,EAAOC,QAAS,GAKrEC,aAAc,GAKdC,YAAa,KAKbC,UAAW,KAMXC,UAAW,EAMXC,cAAe,EAMfC,mBAAoB,EAOpBC,iBAAkB,EAMlBC,WAAY,EAMZC,UAAW,EAMXC,YAAa,EAKbC,KACA,CAICvgB,UAAW,EACXwgB,SAAU,EAKVC,UAAW,EAKXC,WAAY,EAKZC,gBAAiB,EACjBC,cAAe,EACfC,eAAgB,EAKhBtC,IAAK,EACLuC,WAAY,EACZC,kBAAmB,EACnBC,gBAAiB,EACjBC,iBAAkB,GAOnBjlB,KAAM,SAAUoR,EAAQ,MAEvB,IAAI8T,EAAO9sB,KAEP+sB,EAAI,IAAK/sB,KAAKgqB,kBAAmBhR,GACrChZ,KAAKgZ,QAAU+T,GAGkB,IAA7B/sB,KAAKgZ,QAAQvS,eAEiB,IAA7BzG,KAAKgZ,QAAQvS,YAChBnB,EAASmB,cAETnB,EAASmB,YAAYzG,KAAKgZ,QAAQvS,cAIhCsmB,EAAE1C,aAAe0C,EAAEzC,cAAiC,WAAjByC,EAAE7C,cACxC6C,EAAE7C,YAAc6C,EAAE1C,YAAc0C,EAAEzC,aAAe,YAAc,YAEhEtqB,KAAKkqB,YAAc6C,EAAE7C,YAErBlqB,KAAK0rB,YAAcrgB,EAAKzC,KAAK3B,QAC7BjH,KAAK2rB,UAAYtgB,EAAKzC,KAAK3B,QAG3BjH,KAAK6rB,cAAgB,IAAOkB,EAAE5C,IAC9BnqB,KAAK+rB,iBAAmB,IAAOgB,EAAE3C,OAEjChlB,EAAO4nB,SAAW,WAAaF,EAAKG,mBAEpCjtB,KAAKktB,WAAa,IAAIhgB,EAAO6f,EAAExhB,MAAOvL,KAAK6rB,eAAgBsB,GAAUntB,KAAKotB,QAAQD,KAGlFntB,KAAKypB,SAAW,IAAIE,EAAQ,CAAExY,GAAI4b,EAAE5b,GAAI+H,KAAM,KAAMK,UAAU,EAAMD,QAAQ,EAAOE,UAAWuT,EAAEvT,UAAWL,WAAY4T,EAAE5T,aAEzHnZ,KAAKkrB,eAAiB,IAAIvB,EAAQ,CAAExY,IAAI,EAAO+H,KAAM,KAAMK,UAAU,EAAMD,QAAQ,EAAOE,UAAWuT,EAAEvT,UAAWL,WAAY,SAC9HnZ,KAAKkrB,eAAehS,KAAKa,MAAMsT,cAAgB,OAE/CrtB,KAAKmrB,eAAiB,IAAIxB,EAAQ,CAAExY,IAAI,EAAO+H,KAAM,KAAMK,UAAU,EAAMD,QAAQ,EAAOE,UAAWuT,EAAEvT,UAAWL,WAAY,SAC9HnZ,KAAKmrB,eAAejS,KAAKa,MAAMsT,cAAgB,OAE/CrtB,KAAKorB,kBAAoB,IAAIzB,EAAQ,CAAErQ,QAAQ,EAAME,UAAWuT,EAAEvT,YAAa4B,OAAO,IAAK,KAE3F,IAAIkS,EAAWttB,KAAKypB,SAASvQ,KAG7BlZ,KAAK4qB,iBAAmBxlB,EAAOwlB,kBAAoB,EAEnD5qB,KAAK6qB,mBAA6B,IAATkC,EAAE5b,GAAc,EAAKnR,KAAKypB,SAAS1e,QAAQwiB,8BAC7DvtB,KAAKypB,SAAS1e,QAAQyiB,2BACtBxtB,KAAKypB,SAAS1e,QAAQ0iB,0BACtBztB,KAAKypB,SAAS1e,QAAQ2iB,yBACtB1tB,KAAKypB,SAAS1e,QAAQ4iB,wBAA0B,EAEvD3tB,KAAK8qB,iBAAmB9qB,KAAK4qB,iBAAmB5qB,KAAK6qB,kBAErDjB,EAAOqD,iBAAgB,GAGvB7nB,EAAOwoB,UAAY,SAAU5F,GAE5B,GAAIA,EAAInY,SAAWzK,EAAOsU,SAASG,KAAnC,CAGA,GAAIiT,EAAKzB,SAASrD,EAAIwD,SACrB,OAAO,EAOR,OALAsB,EAAKzB,SAASrD,EAAIwD,UAAW,EAE7BsB,EAAKzB,SAASG,QAAUxD,EAAIwD,QAC5BsB,EAAKzB,SAASzf,UAAYS,QAElB2b,EAAIwD,SAEX,KAAK,GACJsB,EAAKzB,SAAS3gB,OAAQ,EACtB,MAED,KAAK,GACJoiB,EAAKzB,SAASC,MAAO,EACrB,MAED,KAAK,GACJwB,EAAKzB,SAASE,KAAM,EAKtB,OAAIuB,EAAKzB,SAASC,MAAQtD,EAAIwD,SAAW5qB,EAAQE,KAEhDgsB,EAAKzB,SAASrD,EAAIwD,UAAW,GACtB,IAGmF,IAAvFsB,EAAKe,gBAAiBf,EAAKgB,kBAAkBC,SAAU/F,EAAIwD,QAASsB,EAAKzB,gBAA7E,IAIDjmB,EAAO4oB,QAAU,SAAUhG,GAE1B,GAAIA,EAAInY,SAAWzK,EAAOsU,SAASG,KAAnC,CAGA,IAAKiT,EAAKzB,SAASrD,EAAIwD,SACtB,OAAO,EAMR,OAJAsB,EAAKzB,SAASrD,EAAIwD,UAAW,EAC7BsB,EAAKzB,SAAS4C,QAAU5hB,QACxBygB,EAAKzB,SAASG,QAAUxD,EAAIwD,QAEpBxD,EAAIwD,SAEX,KAAK,GACJsB,EAAKzB,SAAS3gB,OAAQ,EACtB,MAED,KAAK,GACJoiB,EAAKzB,SAASC,MAAO,EACrB,MAED,KAAK,GACJwB,EAAKzB,SAASE,KAAM,EAItB,OAAyF,IAArFuB,EAAKe,gBAAiBf,EAAKgB,kBAAkBI,OAAQlG,EAAIwD,QAASsB,EAAKzB,gBAA3E,IAMD,MAAM8C,EAAe,SAAU5uB,EAAG6N,GAEjC,OAAOwc,EAAOwE,cAAgBtoB,IAAI8jB,EAAOS,YAAY,GAAKjd,EAAEwc,EAAOe,OAAOf,EAAOmB,mBAAqBjlB,KAAKvG,EAAEqqB,EAAOc,OAAOd,EAAOmB,oBAG7HsD,EAAe,SAAU9uB,EAAG6N,GAEjC,OAAOwc,EAAOwE,cAAgBtoB,KAAKvG,EAAEqqB,EAAOc,OAAOd,EAAOmB,mBAAqBjlB,KAAKsH,EAAEwc,EAAOe,OAAOf,EAAOmB,oBAIxG,iBAAkB3lB,GAErBkoB,EAASgB,aAAe,SAAUtG,GAEjCA,EAAIuG,iBAEJ,IAAIC,EAAUxG,EAAIyG,eAElB,IAAK,IAAIvuB,EAAI,EAAGA,EAAIsuB,EAAQruB,OAAQD,IACpC,CACM0pB,EAAO6B,aAAa+C,EAAQtuB,GAAGwuB,cAEnC9E,EAAO6B,aAAa+C,EAAQtuB,GAAGwuB,YAAc,CAC3Cxa,GAAIsa,EAAQtuB,GAAGwuB,WAAYC,UAAU,EAAOC,YAAY,EACxDze,GAAI,EAAGC,GAAI,EAAG7Q,EAAG,EAAG6N,EAAG,EAAGW,GAAI,EAAGC,GAAI,EAAG6gB,OAAQ,EAChDC,WAAY,EAAGC,WAAY,IAI9B,IAAIC,EAAIpF,EAAO6B,aAAa+C,EAAQtuB,GAAGwuB,YAEvCM,EAAEL,UAAW,EACbK,EAAEJ,YAAa,EACfI,EAAEH,OAAS,EAEXG,EAAEpjB,UAAYS,QAEd2iB,EAAEzvB,EAAIyvB,EAAE7e,GAAKge,EAAaK,EAAQtuB,GAAGgoB,QAASsG,EAAQtuB,GAAGkoB,SACzD4G,EAAE5hB,EAAI4hB,EAAE5e,GAAKie,EAAaG,EAAQtuB,GAAGgoB,QAASsG,EAAQtuB,GAAGkoB,SAEzDwB,EAAOqF,eAAgBrF,EAAOsF,iBAAiBC,aAAcH,EAAGpF,EAAO6B,cAGxE,OAAO,GAGR6B,EAAS8B,WAAa,SAAUpH,GAE/BA,EAAIuG,iBAEJ,IAAIC,EAAUxG,EAAIyG,eAElB,IAAK,IAAIvuB,EAAI,EAAGA,EAAIsuB,EAAQruB,OAAQD,IACpC,CACC,IAAK0pB,EAAO6B,aAAa+C,EAAQtuB,GAAGwuB,YACnC,SAED,IAAIM,EAAIpF,EAAO6B,aAAa+C,EAAQtuB,GAAGwuB,YAEvCM,EAAEf,QAAU5hB,QACZ2iB,EAAEK,UAAYL,EAAEf,QAAUe,EAAEpjB,UAE5BojB,EAAEzvB,EAAI4uB,EAAaK,EAAQtuB,GAAGgoB,QAASsG,EAAQtuB,GAAGkoB,SAClD4G,EAAE5hB,EAAIihB,EAAaG,EAAQtuB,GAAGgoB,QAASsG,EAAQtuB,GAAGkoB,SAE9C4G,EAAEJ,YACLhF,EAAOqF,eAAgBrF,EAAOsF,iBAAiBI,kBAAmBN,EAAGpF,EAAO6B,cAE7E7B,EAAOqF,eAAgBrF,EAAOsF,iBAAiBK,WAAYP,EAAGpF,EAAO6B,cAErEuD,EAAEL,UAAW,EACbK,EAAEJ,YAAa,EAEfI,EAAEH,OAAS,EAGZ,OAAO,GAGRvB,EAASkC,cAAgB,SAAUxH,GAElCA,EAAIuG,iBAEJ,IAAIC,EAAUxG,EAAIyG,eAElB,IAAK,IAAIvuB,EAAI,EAAGA,EAAIsuB,EAAQruB,OAAQD,IACpC,CACC,IAAK0pB,EAAO6B,aAAa+C,EAAQtuB,GAAGwuB,YACnC,SAED,IAAIM,EAAIpF,EAAO6B,aAAa+C,EAAQtuB,GAAGwuB,YAEvCM,EAAEzvB,EAAI4uB,EAAaK,EAAQtuB,GAAGgoB,QAASsG,EAAQtuB,GAAGkoB,SAClD4G,EAAE5hB,EAAIihB,EAAaG,EAAQtuB,GAAGgoB,QAASsG,EAAQtuB,GAAGkoB,SAElDwB,EAAOqF,eAAgBD,EAAEJ,WAAahF,EAAOsF,iBAAiBI,kBAAoB1F,EAAOsF,iBAAiBK,WAAYP,EAAGpF,EAAO6B,cAEhIuD,EAAEL,UAAW,EACbK,EAAEJ,YAAa,EAEfI,EAAEH,OAAS,EAGZ,OAAO,GAGRvB,EAASmC,YAAc,SAAUzH,GAEhCA,EAAIuG,iBAEJ,IAAIC,EAAUxG,EAAIyG,eAElB,IAAK,IAAIvuB,EAAI,EAAGA,EAAIsuB,EAAQruB,OAAQD,IACpC,CACC,IAAK0pB,EAAO6B,aAAa+C,EAAQtuB,GAAGwuB,YACnC,SAED,IAAIM,EAAIpF,EAAO6B,aAAa+C,EAAQtuB,GAAGwuB,YAEnCM,EAAEL,WAAaK,EAAEJ,aAEpBhF,EAAOqF,eAAgBrF,EAAOsF,iBAAiBQ,mBAAoBV,EAAGpF,EAAO6B,cAC7EuD,EAAEJ,YAAa,GAGhBI,EAAEzvB,EAAI4uB,EAAaK,EAAQtuB,GAAGgoB,QAASsG,EAAQtuB,GAAGkoB,SAClD4G,EAAE5hB,EAAIihB,EAAaG,EAAQtuB,GAAGgoB,QAASsG,EAAQtuB,GAAGkoB,SAElD4G,EAAEjhB,GAAKihB,EAAEzvB,EAAIyvB,EAAE7e,GACf6e,EAAEhhB,GAAKghB,EAAE5hB,EAAI4hB,EAAE5e,GAEfwZ,EAAOqF,eAAgBD,EAAEJ,WAAahF,EAAOsF,iBAAiBS,kBAAoB/F,EAAOsF,iBAAiBU,aAAcZ,EAAGpF,EAAO6B,cAGnI,OAAO,KAMR6B,EAASuC,cAAgB,SAAU7H,GAGlC,OADAA,EAAIuG,kBACG,GAGRjB,EAASwC,QAAU,SAAU9H,GAE5BA,EAAIuG,iBAEC3E,EAAO6B,aAAa,KAExB7B,EAAO6B,aAAa,GAAK,CACvBvX,GAAI,EAAGya,UAAU,EAAOC,YAAY,EACpCze,GAAI,EAAGC,GAAI,EAAG7Q,EAAG,EAAG6N,EAAG,EAAGW,GAAI,EAAGC,GAAI,EAAG6gB,OAAQ,EAChDC,WAAY,EAAGC,WAAY,IAI9B,IAAIC,EAAIpF,EAAO6B,aAAa,GAQ5B,OANAuD,EAAEzvB,EAAI4uB,EAAanG,EAAIE,QAASF,EAAII,SACpC4G,EAAE5hB,EAAIihB,EAAarG,EAAIE,QAASF,EAAII,SACpC4G,EAAEF,WAAa9G,EAAI+H,OACnBf,EAAED,YAAc/G,EAAI+H,OAEpBnG,EAAOqF,eAAgBrF,EAAOsF,iBAAiBc,cAAehB,EAAGpF,EAAO6B,eACjE,GAGR6B,EAAS5E,YAAc,SAAUV,GAEhCA,EAAIuG,iBAEC3E,EAAO6B,aAAa,KAExB7B,EAAO6B,aAAa,GAAK,CACvBvX,GAAI,EAAGya,UAAU,EAAOC,YAAY,EACpCze,GAAI,EAAGC,GAAI,EAAG7Q,EAAG,EAAG6N,EAAG,EAAGW,GAAI,EAAGC,GAAI,EAAG6gB,OAAQ,EAChDC,WAAY,EAAGC,WAAY,IAI9B,IAAIC,EAAIpF,EAAO6B,aAAa,GAU5B,OARAuD,EAAEL,UAAW,EACbK,EAAEJ,YAAa,EACfI,EAAEH,OAAS7G,EAAIiI,MAEfjB,EAAEzvB,EAAIyvB,EAAE7e,GAAKge,EAAanG,EAAIE,QAASF,EAAII,SAC3C4G,EAAE5hB,EAAI4hB,EAAE5e,GAAKie,EAAarG,EAAIE,QAASF,EAAII,SAE3CwB,EAAOqF,eAAgBrF,EAAOsF,iBAAiBC,aAAcH,EAAGpF,EAAO6B,eAChE,GAGR6B,EAAS3E,UAAY,SAAUX,GAI9B,GAFAA,EAAIuG,kBAEC3E,EAAO6B,aAAa,GACxB,OAAO,EAER,IAAIuD,EAAIpF,EAAO6B,aAAa,GAE5BuD,EAAEzvB,EAAI4uB,EAAanG,EAAIE,QAASF,EAAII,SACpC4G,EAAE5hB,EAAIihB,EAAarG,EAAIE,QAASF,EAAII,SAEhC4G,EAAEJ,YACLhF,EAAOqF,eAAgBrF,EAAOsF,iBAAiBI,kBAAmBN,EAAGpF,EAAO6B,cAE7E7B,EAAOqF,eAAgBrF,EAAOsF,iBAAiBK,WAAYP,EAAGpF,EAAO6B,cAErEuD,EAAEL,UAAW,EACbK,EAAEJ,YAAa,EAEfI,EAAEH,OAAS,GAGZvB,EAAS1E,YAAc,SAAUZ,GAIhC,GAFAA,EAAIuG,kBAEC3E,EAAO6B,aAAa,GACxB,OAAO,EAER,IAAIuD,EAAIpF,EAAO6B,aAAa,GAe5B,OAbIuD,EAAEL,WAAaK,EAAEJ,aAEpBhF,EAAOqF,eAAgBrF,EAAOsF,iBAAiBQ,mBAAoBV,EAAGpF,EAAO6B,cAC7EuD,EAAEJ,YAAa,GAGhBI,EAAEzvB,EAAI4uB,EAAanG,EAAIE,QAASF,EAAII,SACpC4G,EAAE5hB,EAAIihB,EAAarG,EAAIE,QAASF,EAAII,SAEpC4G,EAAEjhB,GAAKihB,EAAEzvB,EAAIyvB,EAAE7e,GACf6e,EAAEhhB,GAAKghB,EAAE5hB,EAAI4hB,EAAE5e,GAEfwZ,EAAOqF,eAAgBD,EAAEJ,WAAahF,EAAOsF,iBAAiBS,kBAAoB/F,EAAOsF,iBAAiBU,aAAcZ,EAAGpF,EAAO6B,eAC3H,KAKK,IAAVsB,EAAEzkB,KAAciS,EAAI0F,UAOzBiB,KAAM,WAEL,OAAOlhB,KAAKisB,WAObzf,MAAO,WAENxM,KAAKitB,kBAELjtB,KAAK6pB,MAAME,iBAAkB,EAC7B/pB,KAAKktB,WAAW1gB,SAOjBQ,KAAM,WAELhN,KAAK6pB,MAAME,iBAAkB,EAC7B/pB,KAAKktB,WAAWlgB,QAOjBkjB,MAAO,WAENlwB,KAAK6pB,MAAME,iBAAkB,GAO9BoG,OAAQ,WAEPnwB,KAAK6pB,MAAME,iBAAkB,EAC7B/pB,KAAKowB,aAONhD,QAAS,SAASD,GAEjB,IACIkD,EADAC,EAAMjkB,QAGN8gB,EAAQntB,KAAK+rB,mBAChBoB,EAAQntB,KAAK+rB,kBAEkB,IAA5B/rB,KAAK8rB,qBACRqB,EAAQntB,KAAK8rB,oBAET9rB,KAAK6pB,MAAMC,mBAAoB9pB,KAAK6pB,MAAME,iBAM/CoD,GAASntB,KAAK4rB,UAEd5rB,KAAKgsB,WAAamB,EAAQ,IAC1BntB,KAAKisB,WAAajsB,KAAKgsB,WACvB1R,EAAQ4G,KAAOlhB,KAAKisB,UAEpBjsB,KAAKksB,cAGLmE,EAAMhkB,QACNrM,KAAKuwB,OAAQvwB,KAAKgsB,YAClBhsB,KAAKmsB,KAAKI,iBAAmBlgB,QAAUgkB,EAGvCA,EAAMhkB,QACNrM,KAAKopB,OACLppB,KAAKmsB,KAAKK,eAAiBngB,QAAUgkB,EAGrCrwB,KAAKmsB,KAAKC,SAAWkE,EACrBtwB,KAAKmsB,KAAKE,aAEVc,EAAQntB,KAAKmsB,KAAKC,SAAWpsB,KAAKmsB,KAAKvgB,WAC3B,MAEX5L,KAAKmsB,KAAKhC,IAAMrkB,IAAwB,IAApB9F,KAAKmsB,KAAKE,UAAiBc,GAI/CntB,KAAKmsB,KAAKO,WAAa5mB,KAAM9F,KAAKmsB,KAAKO,WAAW1sB,KAAKmsB,KAAKG,WAActsB,KAAKmsB,KAAKhC,MAAQnqB,KAAKmsB,KAAKG,WAAa,IACnHtsB,KAAKmsB,KAAKQ,kBAAoB7mB,KAAM9F,KAAKmsB,KAAKQ,kBAAkB3sB,KAAKmsB,KAAKG,WAAyC,IAA1BtsB,KAAKmsB,KAAKI,gBAAuBvsB,KAAKmsB,KAAKE,YAAersB,KAAKmsB,KAAKG,WAAa,IAC1KtsB,KAAKmsB,KAAKS,gBAAkB9mB,KAAM9F,KAAKmsB,KAAKS,gBAAgB5sB,KAAKmsB,KAAKG,WAAuC,IAAxBtsB,KAAKmsB,KAAKK,cAAqBxsB,KAAKmsB,KAAKE,YAAersB,KAAKmsB,KAAKG,WAAa,IACpKtsB,KAAKmsB,KAAKU,iBAAmB/mB,KAAM9F,KAAKmsB,KAAKU,iBAAiB7sB,KAAKmsB,KAAKG,WAAwC,IAAzBtsB,KAAKmsB,KAAKM,eAAsBzsB,KAAKmsB,KAAKE,YAAersB,KAAKmsB,KAAKG,WAAa,IACvKtsB,KAAKmsB,KAAKG,aAEVtsB,KAAKmsB,KAAKvgB,UAAY0kB,EACtBtwB,KAAKmsB,KAAKC,SAAWkE,EACrBtwB,KAAKmsB,KAAKE,UAAY,EACtBrsB,KAAKmsB,KAAKI,gBAAkB,EAC5BvsB,KAAKmsB,KAAKK,cAAgB,EAC1BxsB,KAAKmsB,KAAKM,eAAiB,IA5C3BzsB,KAAKopB,QAoDP6D,gBAAiB,SAASuD,GAAa,GAGtC,GAAI,aAAcprB,EAEbpF,KAAKgZ,QAAQyR,YAEhBzqB,KAAKywB,aAAe3qB,IAAIV,EAAOsrB,OAAOtX,OACtCpZ,KAAK2wB,cAAgB7qB,IAAIV,EAAOsrB,OAAOrX,UAIvCrZ,KAAKywB,aAAerrB,EAAOwrB,WAC3B5wB,KAAK2wB,cAAgBvrB,EAAOyrB,kBAQ7B,GAHA7wB,KAAKywB,aAAezwB,KAAKgZ,QAAQqR,YACjCrqB,KAAK2wB,cAAgB3wB,KAAKgZ,QAAQsR,aAEF,MAA5BtqB,KAAKgZ,QAAQqR,aAAoD,MAA7BrqB,KAAKgZ,QAAQsR,aACpD,MAAM,IAAIzkB,MAAO,qEAId7F,KAAKywB,aAAezwB,KAAK2wB,eAAqC,aAApB3wB,KAAKkqB,aAAgClqB,KAAKywB,aAAezwB,KAAK2wB,eAAqC,YAApB3wB,KAAKkqB,aAElIlqB,KAAKqqB,YAAcrqB,KAAK2wB,cACxB3wB,KAAKsqB,aAAetqB,KAAKywB,aAEzBzwB,KAAKouB,eAAgB,IAIrBpuB,KAAKqqB,YAAcrqB,KAAKywB,aACxBzwB,KAAKsqB,aAAetqB,KAAK2wB,cAEzB3wB,KAAKouB,eAAgB,GAItB,IAAI0C,EAAoB9wB,KAAKgZ,QAAQqR,YACjC0G,EAAqB/wB,KAAKgZ,QAAQsR,aAEZ,OAAtBwG,GAAqD,OAAvBC,IAEP,OAAtBD,GAAqD,OAAvBC,GAEjCD,EAAoB9wB,KAAKqqB,YACzB0G,EAAqB/wB,KAAKsqB,cAEI,OAAtBwG,EAERA,EAAoBhrB,IAAI,GAAM9F,KAAKqqB,aAAerqB,KAAKgZ,QAAQsR,aAAetqB,KAAKsqB,eAEpD,OAAvByG,IAERA,EAAqBjrB,IAAI,GAAM9F,KAAKsqB,cAAgBtqB,KAAKgZ,QAAQqR,YAAcrqB,KAAKqqB,gBAKtF,IAAIA,EAAcyG,EACdxG,EAAeyG,EAEM,cAArB/wB,KAAKkqB,aAA+BG,GAAeC,IAEjDD,EAAcC,GAAgBtqB,KAAKqqB,YAAcrqB,KAAKsqB,cAAkBD,EAAcC,GAAgBtqB,KAAKqqB,YAAcrqB,KAAKsqB,gBAElID,EAAcC,EACdA,EAAewG,GAKjB9wB,KAAK+qB,kBAAoB,EAErBV,GAAeC,EAElBtqB,KAAK+qB,kBAAoBnkB,KAAKC,IAAI7G,KAAKqqB,YAAcA,EAAarqB,KAAKsqB,aAAeA,GAE9ED,EAERrqB,KAAK+qB,kBAAoB/qB,KAAKqqB,YAAcA,EAEpCC,IAERtqB,KAAK+qB,kBAAoB/qB,KAAKsqB,aAAeA,GAI9C,IAAImG,EAAezwB,KAAKqqB,YACpBsG,EAAgB3wB,KAAKsqB,aAQzB,GANID,IAAarqB,KAAKqqB,YAAcA,GAChCC,IAActqB,KAAKsqB,aAAeA,GAEtCtqB,KAAK0qB,MAAQ5kB,IAA6D,IAAxD2qB,EAAezwB,KAAKqqB,YAAYrqB,KAAK+qB,oBACvD/qB,KAAK2qB,MAAQ7kB,IAA+D,IAA1D6qB,EAAgB3wB,KAAKsqB,aAAatqB,KAAK+qB,oBAErD/qB,KAAKouB,cACT,CACC,IAAIiC,EAAMrwB,KAAK0qB,MACf1qB,KAAK0qB,MAAQ1qB,KAAK2qB,MAClB3qB,KAAK2qB,MAAQ0F,EAGdrwB,KAAKgrB,YAAchrB,KAAK+qB,kBAAoB/qB,KAAK8qB,iBACjD9qB,KAAKgrB,YAAcllB,IAAI,GAAM9F,KAAKgrB,aAE9BhrB,KAAKgZ,QAAQwR,eAAiB,GAAKxqB,KAAKgrB,YAAchrB,KAAKgZ,QAAQwR,iBACtExqB,KAAKgrB,YAAchrB,KAAKgZ,QAAQwR,gBAEjCxqB,KAAK6pB,MAAMC,kBAAmB,EAO1B,aAAc1kB,IACjBA,EAAOsU,SAASG,KAAKE,MAAMuJ,gBAAkBtjB,KAAKypB,SAASnG,iBAKvDtjB,KAAKouB,eAgBTpuB,KAAKypB,SAASrO,OAAQpb,KAAKsqB,aAAatqB,KAAKgrB,YAAahrB,KAAKqqB,YAAYrqB,KAAKgrB,aAChFhrB,KAAKypB,SAASvQ,KAAKa,MAAMX,MAAQtT,IAAI9F,KAAKsqB,aAAatqB,KAAK+qB,kBAAkB,IAAO,KACrF/qB,KAAKypB,SAASvQ,KAAKa,MAAMV,OAASvT,IAAI9F,KAAKqqB,YAAYrqB,KAAK+qB,kBAAkB,IAAO,KAErF/qB,KAAKkrB,eAAe9P,OAAQpb,KAAKsqB,aAAatqB,KAAKgrB,YAAahrB,KAAKqqB,YAAYrqB,KAAKgrB,aACtFhrB,KAAKkrB,eAAehS,KAAKa,MAAMX,MAAQtT,IAAI9F,KAAKsqB,aAAatqB,KAAK+qB,kBAAkB,IAAO,KAC3F/qB,KAAKkrB,eAAehS,KAAKa,MAAMV,OAASvT,IAAI9F,KAAKqqB,YAAYrqB,KAAK+qB,kBAAkB,IAAO,KAE3F/qB,KAAKmrB,eAAe/P,OAAQuV,EAAeF,GAC3CzwB,KAAKmrB,eAAejS,KAAKa,MAAMX,MAAQuX,EAAgB,KACvD3wB,KAAKmrB,eAAejS,KAAKa,MAAMV,OAASoX,EAAe,OAxBvDzwB,KAAKypB,SAASrO,OAAQpb,KAAKqqB,YAAYrqB,KAAKgrB,YAAahrB,KAAKsqB,aAAatqB,KAAKgrB,aAChFhrB,KAAKypB,SAASvQ,KAAKa,MAAMX,MAAQtT,IAAI9F,KAAKqqB,YAAYrqB,KAAK+qB,kBAAkB,IAAO,KACpF/qB,KAAKypB,SAASvQ,KAAKa,MAAMV,OAASvT,IAAI9F,KAAKsqB,aAAatqB,KAAK+qB,kBAAkB,IAAO,KAEtF/qB,KAAKkrB,eAAe9P,OAAQpb,KAAKqqB,YAAYrqB,KAAKgrB,YAAahrB,KAAKsqB,aAAatqB,KAAKgrB,aACtFhrB,KAAKkrB,eAAehS,KAAKa,MAAMX,MAAQtT,IAAI9F,KAAKqqB,YAAYrqB,KAAK+qB,kBAAkB,IAAO,KAC1F/qB,KAAKkrB,eAAehS,KAAKa,MAAMV,OAASvT,IAAI9F,KAAKsqB,aAAatqB,KAAK+qB,kBAAkB,IAAO,KAE5F/qB,KAAKmrB,eAAe/P,OAAQqV,EAAcE,GAC1C3wB,KAAKmrB,eAAejS,KAAKa,MAAMX,MAAQqX,EAAe,KACtDzwB,KAAKmrB,eAAejS,KAAKa,MAAMV,OAASsX,EAAgB,MAiBzD3wB,KAAKypB,SAASvQ,KAAKa,MAAMiX,WAAahxB,KAAK0qB,MAAQ,KACnD1qB,KAAKypB,SAASvQ,KAAKa,MAAMkX,UAAYjxB,KAAK2qB,MAAQ,KAElD3qB,KAAKkrB,eAAehS,KAAKa,MAAMiX,WAAahxB,KAAK0qB,MAAQ,KACzD1qB,KAAKkrB,eAAehS,KAAKa,MAAMkX,UAAYjxB,KAAK2qB,MAAQ,KAExD3qB,KAAKypB,SAAS3Y,eACd9Q,KAAKkrB,eAAepa,eACpB9Q,KAAKmrB,eAAera,eAEI,GAApB9Q,KAAKgrB,cAERhrB,KAAKypB,SAAS1F,YAAY/jB,KAAKgrB,aAC/BhrB,KAAKkrB,eAAenH,YAAY/jB,KAAKgrB,cAGlChrB,KAAKouB,eAERpuB,KAAKypB,SAASxb,OAAOrH,KAAKugB,GAAG,GAC7BnnB,KAAKypB,SAAS3b,WAAW9N,KAAKqqB,YAAa,GAC3CrqB,KAAKypB,SAASzF,SAAQ,GAEtBhkB,KAAKkrB,eAAejd,OAAOrH,KAAKugB,GAAG,GACnCnnB,KAAKkrB,eAAepd,WAAW9N,KAAKqqB,YAAa,GACjDrqB,KAAKkrB,eAAelH,SAAQ,GAE5BhkB,KAAKmrB,eAAeld,OAAOrH,KAAKugB,GAAG,GACnCnnB,KAAKmrB,eAAerd,WAAW2iB,EAAc,GAC7CzwB,KAAKmrB,eAAenH,SAAQ,KAI5BhkB,KAAKypB,SAASzF,SAAQ,GACtBhkB,KAAKkrB,eAAelH,SAAQ,GAC5BhkB,KAAKmrB,eAAenH,SAAQ,IAI7BhkB,KAAKgrB,aAAehrB,KAAKgZ,QAAQuR,iBAE7BvqB,KAAKgZ,QAAQwR,eAAiB,GAAKxqB,KAAKgrB,YAAchrB,KAAKgZ,QAAQwR,iBACtExqB,KAAKgrB,YAAchrB,KAAKgZ,QAAQwR,gBAEjCxqB,KAAKkxB,mBAAqBprB,IAAI9F,KAAKgrB,YAAc,IACjDhrB,KAAKowB,YAEDpwB,KAAKirB,eACRjrB,KAAKirB,cAAcpjB,OAEpB7H,KAAKirB,cAAgBjrB,KAAKypB,SAASjD,WAAU,GAEzB,GAAhBgK,IAEHxwB,KAAK6pB,MAAMC,kBAAmB,EAC9B9pB,KAAKmxB,gBAAiBnxB,KAAKqqB,YAAarqB,KAAKsqB,gBAQ/C6G,gBAAiB,SAAU9G,EAAaC,KAOxC8F,UAAW,WAEVpwB,KAAKmsB,KAAKvgB,UAAYS,QACtBrM,KAAKmsB,KAAKC,SAAW/f,QAErBrM,KAAKmsB,KAAKE,UAAY,EACtBrsB,KAAKmsB,KAAKI,gBAAkB,EAC5BvsB,KAAKmsB,KAAKK,cAAgB,EAC1BxsB,KAAKmsB,KAAKM,eAAiB,EAE3BzsB,KAAKmsB,KAAKG,WAAa,EACvBtsB,KAAKmsB,KAAKhC,IAAM,EAChBnqB,KAAKmsB,KAAKO,WAAa,EACvB1sB,KAAKmsB,KAAKQ,kBAAoB,EAC9B3sB,KAAKmsB,KAAKS,gBAAkB,EAC5B5sB,KAAKmsB,KAAKU,iBAAmB,GAO9BuE,eAAgB,SAAUC,GAGzB,OADArxB,KAAK0rB,YAAY5kB,KAAMuqB,GAChBrxB,KAAK0rB,YAAYhiB,QAWzB4nB,kBAAmB,SAAUD,GAE5BrxB,KAAK0rB,YAAYrhB,OAAQd,EAASe,WAAW+mB,GAAWA,EAAUrxB,KAAK0rB,YAAYthB,SAASinB,KAO7FE,aAAc,SAAUF,GAGvB,OADArxB,KAAK2rB,UAAU7kB,KAAMuqB,GACdrxB,KAAK2rB,UAAUjiB,QAWvB8nB,gBAAiB,SAAUH,GAE1BrxB,KAAK2rB,UAAUthB,OAAQd,EAASe,WAAW+mB,GAAWA,EAAUrxB,KAAK2rB,UAAUvhB,SAASinB,KAOzFI,SAAU,SAAUJ,GAEnBrxB,KAAK0rB,YAAY5kB,KAAMuqB,GACvBrxB,KAAK2rB,UAAU7kB,KAAMuqB,IAOtBK,YAAa,SAAUL,GAEtBrxB,KAAK0rB,YAAYrhB,OAAQrK,KAAK0rB,YAAYthB,SAASinB,IACnDrxB,KAAK2rB,UAAUthB,OAAQrK,KAAK2rB,UAAUvhB,SAASinB,KAMhDd,OAAQ,SAAUoB,GAEjB,IAEC,IAAI1oB,EAEJ,IAAK,IAAIiQ,EAAOlZ,KAAK0rB,YAAYjiB,IAAKyP,EAAMA,EAAOjQ,EAElDA,EAAOiQ,EAAKjQ,MAEkB,IAA1BiQ,EAAK5Z,MAAMixB,OAAOoB,IACrB3xB,KAAKsxB,kBAAkBpY,GAG1B,MAAO2C,GAGN,MADA+N,EAAO5c,OACD6O,IAORuN,KAAM,WAEoB,OAArBppB,KAAKypB,SAAStY,IACjBnR,KAAKypB,SAASjd,QAEVxM,KAAKgZ,QAAQiR,WAEjBjqB,KAAKypB,SAASvgB,QACdlJ,KAAKkrB,eAAehiB,QACpBlJ,KAAKmrB,eAAejiB,SAGrB,IAEC,IAAID,EAEJ,IAAK,IAAIiQ,EAAOlZ,KAAK2rB,UAAUliB,IAAKyP,EAAMA,EAAOjQ,EAEhDA,EAAOiQ,EAAKjQ,KACZiQ,EAAK5Z,MAAM8pB,KAAKppB,KAAKypB,UAGG,OAArBzpB,KAAKypB,SAAStY,KAEjBnR,KAAKypB,SAASlE,QACdvlB,KAAKypB,SAASnE,OAGhB,MAAOzJ,GAGN,MADA+N,EAAO5c,OACD6O,IASR+V,YAAa,SAAUlI,EAAKmI,EAAKC,EAAUC,EAAQtmB,GAGlD,IAAIyV,EAAO,GACPxR,EAAO,GACPsiB,EAAQ,EAEZ,IAAK,IAAIrU,KAAK+L,EAEbxI,EAAKvD,GAAK,EACVjO,EAAKiO,GAAK+L,EAAI/L,GACdqU,IAGD,IAAIC,EACJ,CACC1B,OAAQ,SAASoB,GAEhB,IAAK,IAAIpyB,KAAK2hB,EACd,CACC,GAAIA,EAAK3hB,IAAMuyB,EAASvyB,GACvB,SAED2hB,EAAK3hB,IAAMoyB,EACPzQ,EAAK3hB,IAAMuyB,EAASvyB,KAEvB2hB,EAAK3hB,GAAKuyB,EAASvyB,GACnByyB,KAGD,IAAIE,EAAIH,EAAOxyB,GAAI2hB,EAAK3hB,GAAKuyB,EAASvyB,IACtCmQ,EAAKnQ,IAAM,EAAE2yB,GAAGxI,EAAInqB,GAAK2yB,EAAEL,EAAItyB,GAKhC,GAFAkM,EAAUiE,EAAe,GAATsiB,GAEH,GAATA,EACH,OAAO,IAIVpI,EAAOwH,eAAea,GACtBA,EAAa1B,OAAO,IAOrB1C,gBAAiB,SAAUlG,EAAQ6D,EAASH,KAQ5C4D,eAAgB,SAAUtH,EAAQwK,EAASC;;;;AAU3CxI,kBAA2B,CAC1BmE,SAAU,EACVG,OAAQ;;;AAQTtE,iBAA0B,CACzBuF,aAAgB,GAChBI,WAAc,GACdK,aAAgB,GAChBF,mBAAoB,GACpBC,kBAAmB,GACnBL,kBAAmB,GACnBU,cAAgB;;AAclBxG,EAAeI;;;gBCjwCf;MAAMyI,EACN,CAKCC,WAAW,EAMXC,QAAQ,EAMRC,QAAS,GAET9iB,KAAMrE,EAAKzC,KAAK3B,QAChB+qB,MAAO,EAOPS,WAAW,EAMXpP,MAAO,OAMPlK,WAAY,UAMZuZ,KAAM,GAMNlY,MAAO,SAAUmY,GAKhB,IAHA3yB,KAAK0P,KAAK5I,KAAK6rB,GACf3yB,KAAKgyB,QAEEhyB,KAAK0P,KAAKvP,OAASH,KAAKwyB,SAC9BxyB,KAAK0P,KAAKhF,QAEP1K,KAAKyyB,WACR3qB,QAAQS,MAAMvI,KAAKgyB,MAAQ,KAAOW,IAOpCzpB,MAAO,WAENlJ,KAAK0P,KAAK/F,QACV3J,KAAKgyB,MAAQ,GAcd/R,OAAQ,SAAU1gB,EAAE,EAAG6N,EAAE,EAAGwlB,EAAS,IAAKC,GAAQ,EAAMC,GAAU,GAEjE,GAAI9yB,KAAKsyB,UAAW,OACpBtyB,KAAKsyB,WAAY,EAEZO,IAASzlB,GAAK,IACnB,IAAI2lB,EAAK3lB,EAEToc,EAAO+H,aAAc,CAAEnI,KAAM,WAE5B,GAAIiJ,EAAIE,OAAQ,OAEhB,IAAIlC,EAAMhkB,QAEV,MAAMoX,EAAI+F,EAAO2B,eAEjB1H,EAAEoB,KAAK,QAAQ+N,EAAS,gBACxBnP,EAAEsB,aAAa,OAEf,IAAIiO,EAAI,GAER5lB,EAAI2lB,GAEY,IAAZF,GAAwC,GAAnBrJ,EAAO2C,KAAKhC,MAEpC6I,EAAI,QAAUxJ,EAAO2C,KAAKhC,IAAM,IAAMX,EAAO2C,KAAKO,WAAa,aAAelD,EAAO2C,KAAKQ,kBAAoB,WAAanD,EAAO2C,KAAKS,gBAAkB,YAAcpD,EAAO2C,KAAKU,iBAE/KwF,EAAIlZ,aACPsK,EAAEtI,UAAUkX,EAAIlZ,YAChBsK,EAAE/G,SAAUnd,EAAE,EAAG6N,EAAE,EAAGqW,EAAEtF,YAAY6U,GAAG,EAAGJ,EAAS,IAGpDnP,EAAEtI,UAAUkX,EAAIhP,OAChBI,EAAE1F,SAASiV,EAAGzzB,EAAG6N,IAGlB4lB,EAAI,GAEJ,IAAK,IAAI9yB,KAAKmyB,EAAIK,KACjBM,GAAK9yB,EAAI,KAAOmyB,EAAIK,KAAKxyB,GAAK,KAErB,KAAN8yB,IAEH5lB,GAAK,GAEDilB,EAAIlZ,aACPsK,EAAEtI,UAAUkX,EAAIlZ,YAChBsK,EAAE/G,SAAUnd,EAAE,EAAG6N,EAAE,EAAGqW,EAAEtF,YAAY6U,GAAG,EAAGJ,EAAS,IAGpDnP,EAAEtI,UAAUkX,EAAIhP,OAChBI,EAAE1F,SAASiV,EAAGzzB,EAAG6N,IAGlB,IAAIwC,EAAI,EACR,IAAK,IAAIqjB,EAAKZ,EAAI3iB,KAAKjG,IAAKwpB,EAAIA,EAAKA,EAAGhqB,KAAM2G,IAE7CojB,GAAKF,EAAY,KAAOT,EAAIL,MAAMK,EAAI3iB,KAAKvP,OAAOyP,EAAE,GAAK,KAAO,MAAQqjB,EAAG3zB,MAEvE+yB,EAAIlZ,aACPsK,EAAEtI,UAAUkX,EAAIlZ,YAChBsK,EAAE/G,SAAUnd,EAAE,EAAG6N,EAAE,EAAE,GAAKwlB,EAAS,IAAIhjB,EAAE,GAAK,EAAG6T,EAAEtF,YAAY6U,GAAG,EAAGJ,EAAS,IAG/EnP,EAAEtI,UAAUkX,EAAIhP,OAChBI,EAAE1F,SAASiV,EAAGzzB,EAAG6N,EAAE,EAAE,GAAKwlB,EAAS,IAAIhjB,EAAE,IAG1CygB,EAAOhkB,QAAUgkB,EACjB7G,EAAO2C,KAAKK,eAAiB6D,EAC7B7G,EAAO2C,KAAKM,gBAAkB4D,MAQhCH,MAAO,WAENlwB,KAAKuyB,QAAS,GAQfpC,OAAQ,WAEPnwB,KAAKuyB,QAAS,QAKhBhY,EAAe8X;;;;oBChLf;MAAMa,EACN,CAKC/hB,GAAI,KAMJ0H,cAAe,KAMfqI,KAAM,EAMN4C,SAAU,KAMVqP,aAAa,EAMbC,YAAY,EASZC,MAAO,IAAI5zB,EACX6zB,MAAO,IAAI7zB,EACX8zB,MAAO,IAAI9zB,OAGZ6a,EAAe4Y;;iBAUf9tB;EAAOouB,GAAK,SAASl0B,GAEpB,OAAOA,EAAMmE,EAAEgwB,OAOhBruB,EAAO2E,QAAU,SAAU2pB,GAE1B,GAAY,OAARA,GAAgC,iBAATA,EAG3B,MAAI,SAAUA,EACNA,EAAI7rB,OAER,YAAa6rB,EACTA,EAAI3pB,eAER,WAAY2pB,GACfA,EAAI1rB,WAOF,iBAAkB5C,GAErBA,EAAOuuB,aAAe,IAAIC,aAAa,CAAEC,YAAa,cAAeC,WAAY,QACjFvZ,EAAIC,MAAM,gCAAkE,IAAhCpV,EAAOuuB,aAAaI,aAAoB,QAGpF3uB,EAAOuuB,aAAe,KAMvBvuB,EAAO4uB,OAAS,SAAUC,EAAKjb,GAE9B,OAAO,IAAIkb,SAAS,CAACC,EAASC,KAExBpb,IAASA,EAAU,IAClB,iBAAkBA,IAAUA,EAAQqb,aAAe,eAEzD,IAAIC,EAAU,IAAIC,eAClBD,EAAQE,KAAK,MAAOP,GAAK,GAEzB,IAAK,IAAI/zB,KAAK8Y,EAASsb,EAAQp0B,GAAK8Y,EAAQ9Y,GAE5Co0B,EAAQ/K,OAAS,WAChB4K,EAASG,EAAQG,WAGlBH,EAAQI,QAAU,WACjBN,EAAQ,wCAGTE,EAAQK,WAQVvvB,EAAOwvB,iBAAmB,SAAUX,GAEnC,OAAO,IAAIC,SAAQ,CAACC,EAASC,KAEvBhvB,EAAOuuB,aAMZK,OAAOC,GACNY,MAAKC,GAAenB,aAAaoB,gBAAgBD,KACjDD,MAAKG,GAAeb,EAAQa,KAC5BC,OAAMC,GAAOd,EAAOc,KAPpBd,EAAQ,sCAgBXhvB,EAAOU,IAAM,SAAUxG,GAEtB,OAAOA,GAAS,GAOjB8F,EAAO+vB,KAAO,SAAU71B,GAEvB,OAAc,IAAVA,IAA4B,IAAVA,EACdA,EAEK,QAATA,GAGS,SAATA,KAGMA,GAOX8F,EAAOgwB,MAAQ,SAAU91B,GAExB,OAAO+1B,WAAW/1B,IAOnB8F,EAAOkwB,OAAS,SAAUh2B,GAEzB,OAAQwG,IAAU,IAANxG,GAAY,KAOzB8F,EAAOmwB,OAAS,SAAUj2B,GAEzB,OAAQwG,IAAU,IAANxG,GAAa,KAO1B8F,EAAOowB,OAAS,SAAUl2B,GAEzB,OAAQwG,IAAU,IAANxG,GAAc,KAO3B8F,EAAOqwB,IAAM,SAAUn2B,GAEtB,OAAOA,EAAMsH,KAAKugB,GAAK,KAOxB/hB,EAAOswB,IAAM,SAAUp2B,GAEtB,OAAQA,EAAMsH,KAAKugB,GAAI,KAOxB/hB,EAAOuwB,KAAO,WAEb,OAAOzC,EAAQG,MAAM5yB,aAOtB2E,EAAOwwB,MAAQ,WAEd,OAAO1C,EAAQG,MAAM1yB,aAOtByE,EAAOywB,OAAS,SAAUx1B,EAAGC,GAE5B,IAAI4xB,EAAIgB,EAAQG,MAAM1yB,YACtB,OAAOuxB,EAAE5xB,GAAK,EAAE4xB,GAAG7xB,GAOpB+E,EAAO0wB,MAAQ,SAAUz1B,EAAGC,GAE3B,IAAI4xB,EAAIgB,EAAQG,MAAM1yB,YACtB,OAAOiG,KAAKmvB,MAAM7D,EAAE5xB,GAAK,EAAE4xB,GAAG7xB,IAO/B+E,EAAO4wB,OAAS,SAAU31B,EAAGC,EAAGqG,GAI/B,IAFA,IAAI0B,EAAO,GAEFnI,EAAI,EAAGA,EAAIyG,EAAGzG,IACtBmI,EAAKvB,KAAK+uB,OAAOx1B,EAAGC,IAErB,OAAO+H,GAORjD,EAAOiH,MAAQ,WAEd,OAAO4pB,YAAY3F,OAOpBlrB,EAAO8wB,QAAU,SAAU71B,EAAGC,GAE7B,OAAO,WAAa,OAAOw1B,MAAMz1B,EAAGC,KAOrC8E,EAAO+wB,SAAW,SAAUC,EAAK/1B,EAAE,KAAMC,EAAE,MAK1C,OAHU,OAAND,IAAYA,EAAI,GACV,OAANC,IAAYA,EAAI81B,EAAIj2B,OAAS,GAE1B,WAAa,OAAOi2B,EAAIN,MAAMz1B,EAAGC,MAOzC8E,EAAOixB,2BAA6B,SAAUC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,GAGrG,GAAIP,GAAUI,GAAUH,GAAUI,GAAUH,GAAUI,GAAUH,GAAUI,EACzE,OAAO,EAIR,IAAIC,EAAML,EAASF,EACfQ,EAAMP,EAASF,EACfU,EAAMH,EAASF,EACfM,EAAML,EAASF,EAGnB,GAAW,GAAPI,GAAmB,GAAPE,EAChB,CACC,GAAIT,GAAUI,EAAQ,OAVb,EAYT,IAAIhZ,EAAK/W,KAAKswB,IAAIZ,EAAQI,GAG1B,OAAI/Y,EAFK/W,KAAKC,IAAI2vB,EAAQI,GAbjB,GAiBDjZ,EAAK2Y,GAAUS,EAIxB,GAAW,GAAPA,GAAmB,GAAPE,EAChB,CACC,GAAIX,GAAUI,EAAQ,OAvBb,EAyBT,IAAI9Y,EAAKhX,KAAKswB,IAAIX,EAAQI,GAG1B,OAAI/Y,EAFKhX,KAAKC,IAAI4vB,EAAQI,GA1BjB,GA8BDjZ,EAAK2Y,GAAUO,EAIxB,GAAW,GAAPC,EAGH,OAAI,GADAI,GAAMH,GAAKV,EAASI,GAAUO,GAAKN,EAASJ,KAAYU,EAAMH,KACpDK,EAAK,GAGf,GADAC,GAAMd,EAASI,GAAUO,IACfG,EAAK,EAxCV,EA0CFD,EAIR,IAKIC,EAGAD,EAPA72B,EAAI02B,EAAID,EAAME,EAAIH,EAEtB,OAAS,GAALx2B,GAGA,GADA82B,GALIN,GAAKJ,EAASJ,GAAUS,GAAKR,EAASI,IAKjCr2B,IACC82B,EAAK,GAGf,GADAD,GAAMF,EAAIG,EAAKV,EAASJ,GAAUS,IACxBI,EAAK,EAvDT,EAyDHA,GAOR/xB,EAAOiyB,sBAAwB,SAAUf,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,GAEhG,IAAI3E,EAAImE,2BAA4BC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,GAC5F,OAAO3E,GAAK,GAAKA,GAAK,GAOvB9sB,EAAOkyB,YAAc,SAAUppB,EAAO3O,EAAG6N,GAExC,MAAO,CAAE7N,EAAGA,EAAEqH,KAAKuH,IAAID,GAASd,EAAExG,KAAKwH,IAAIF,GAAQd,EAAGA,EAAExG,KAAKuH,IAAID,GAAS3O,EAAEqH,KAAKwH,IAAIF,KAOtF9I,EAAOmyB,UAAY,SAAUj4B,EAAOk4B,EAAUC,EAAUC,GAEvD,OAAS9wB,KAAKmvB,MAAM2B,GAAYp4B,EAAQk4B,IAAaC,EAAWD,IAAcE,GAAaD,EAAWD,GAAYA,GAOnHpyB,EAAOuyB,WAAa,SAAUr4B,EAAOs4B,GAEpC,OAAOhxB,KAAKmvB,MAAMz2B,EAAMs4B,GAAMA,GAO/BxyB,EAAOyyB,iBAAmB,EAM1BzyB,EAAO0yB,QAAU,SAAUx4B,GAE1B,OAAQA,GAAS,GAAKu4B,mBAAsB,GAO7CzyB,EAAO2yB,UAAY,SAAUz4B,GAE5B,OAAOA,GAASu4B,kBAOjBzyB,EAAO4yB,WAAa,SAAU14B,GAE7B,OAAOA,GAAS,GAAKu4B,mBAOtBzyB,EAAO6yB,OAAS,SAAU34B,GAEzB,OAAO04B,WAAWF,QAAQx4B,KAO3B8F,EAAO8yB,OAAS,SAAS73B,EAAGC,GAE3B,OAAOsG,KAAKsB,IAAI7H,GAAKuG,KAAKsB,IAAI5H,GAAKD,EAAIC,GAOxC8E,EAAO+yB,OAAS,SAAS93B,EAAGC,GAE3B,OAAOsG,KAAKsB,IAAI7H,GAAKuG,KAAKsB,IAAI5H,GAAKD,EAAIC,GAOxC8E,EAAOgzB,OAAS,SAAUzkB,EAAKqe,GAE9B,IAAIqG,EAAM,GAEV,KAAOrG,KAAU,GAChBqG,GAAO1kB,EAER,OAAO0kB,GAORjzB,EAAOkzB,KAAO,SAAUC,EAAK9hB,EAAM+hB,EAAK,KAGvC,OADAD,EAAMA,EAAIppB,WACHipB,OAAOI,EAAKC,OAAO,GAAIhiB,EAAK8hB,EAAIp4B,QAAUo4B,GAOlDnzB,EAAOszB,KAAO,SAAUH,EAAK9hB,EAAM+hB,EAAK,KAGvC,OADAD,EAAMA,EAAIppB,YACGipB,OAAOI,EAAKC,OAAO,GAAIhiB,EAAK8hB,EAAIp4B;;ACjgB9C,MAAMw4B,EAAO,SAAUC,EAAWC,EAAc,MAE/C74B,KAAK0P,KAAO,GACZ1P,KAAK44B,UAAYA,EAEjB54B,KAAK64B,cAAgBA,EAErB74B,KAAK84B,SAAW,EAChB94B,KAAK+4B,WAAa,EAElB/4B,KAAKg5B,OAAS,EACdh5B,KAAKi5B,SAAW,OAGjBC,EAAeP,EAMfA,EAAKhzB,UAAUwzB,MAAQ,WACtBn5B,KAAK4L,UAAYqqB,YAAY3F,OAO9BqI,EAAKhzB,UAAU2f,IAAM,WACpBtlB,KAAKo5B,KAAMnD,YAAY3F,MAAQtwB,KAAK4L,YAOrC+sB,EAAKhzB,UAAUyzB,KAAO,SAAU95B,GAE/BU,KAAK0P,KAAK5I,KAAKxH,GACfU,KAAK84B,WAED94B,KAAK0P,KAAKvP,QAAUH,KAAK44B,YAG7B54B,KAAKq5B,SACLr5B,KAAK0P,KAAO,KAObipB,EAAKhzB,UAAU4qB,OAAS,WAEvB,IAAI1pB,EAAM,KACNqwB,EAAM,KACNoC,EAAM,EACNC,EAAM,EAEV,IAAK,IAAIr5B,EAAI,EAAGA,EAAIF,KAAK0P,KAAKvP,OAAQD,IAErC2G,EAAc,OAARA,EAAe7G,KAAK0P,KAAKxP,GAAK0G,KAAKC,IAAIA,EAAK7G,KAAK0P,KAAKxP,IAC5Dg3B,EAAc,OAARA,EAAel3B,KAAK0P,KAAKxP,GAAK0G,KAAKswB,IAAIA,EAAKl3B,KAAK0P,KAAKxP,IAC5Do5B,GAAOt5B,KAAK0P,KAAKxP,GAGlBo5B,GAAOt5B,KAAK0P,KAAKvP,OAEjB,IAAI0b,EAA2B,OAAvB7b,KAAK64B,cAAyB74B,KAAK64B,cAAgBS,EAE3D,IAAK,IAAI1pB,EAAI,EAAGA,EAAI5P,KAAK0P,KAAKvP,OAAQyP,IAAK2pB,GAAO3yB,KAAK4yB,IAAIx5B,KAAK0P,KAAKE,GAAKiM,EAAG,GAa7E,OAXA0d,EAAM3yB,KAAKkI,KAAKyqB,EAAMv5B,KAAK0P,KAAKvP,QAEhCH,KAAKg5B,QAAUO,EACfv5B,KAAKi5B,WAELj5B,KAAK6G,IAAMA,EACX7G,KAAKk3B,IAAMA,EACXl3B,KAAKs5B,IAAMA,EACXt5B,KAAKu5B,IAAMA,EAEXv5B,KAAK+4B,WAAa/4B,KAAK84B,SAChB94B,MAOR24B,EAAKhzB,UAAU0zB,OAAS,SAAUxP,EAAM,KAEvC,IAAIwO,EAAM,GAaV,OAXIr4B,KAAK+4B,YAAc/4B,KAAK84B,UAC3B94B,KAAKuwB,SAEF1G,EAAQ8O,EAAKc,MAAMC,UAASrB,GAAO,MAAQr4B,KAAKi5B,UAChDpP,EAAQ8O,EAAKc,MAAME,MAAKtB,IAAe,IAAPA,EAAY,KAAO,IAAM,QAAUr4B,KAAK6G,KACxEgjB,EAAQ8O,EAAKc,MAAMG,MAAKvB,IAAe,IAAPA,EAAY,KAAO,IAAM,QAAUr4B,KAAKk3B,KACxErN,EAAQ8O,EAAKc,MAAMI,MAAKxB,IAAe,IAAPA,EAAY,KAAO,IAAM,QAAUr4B,KAAKs5B,IAAI9wB,QAAQ,IACpFqhB,EAAQ8O,EAAKc,MAAMK,WAAUzB,IAAe,IAAPA,EAAY,KAAO,UAA8B0B,IAAvB/5B,KAAK64B,cAA8B,MAAQ74B,KAAK64B,cAAgB,KAC/HhP,EAAQ8O,EAAKc,MAAMO,SAAQ3B,IAAe,IAAPA,EAAY,KAAO,IAAM,WAAar4B,KAAKu5B,IAAI/wB,QAAQ,IAC1FqhB,EAAQ8O,EAAKc,MAAMQ,aAAY5B,IAAe,IAAPA,EAAY,KAAO,IAAM,gBAAkBr4B,KAAKg5B,OAASh5B,KAAKi5B,UAAUzwB,QAAQ,IAEpH6vB;;;;AAQRM,EAAKc,MAAQ,CACZC,QAAS;;AAETC,IAAK;;AAELC,IAAK;;AAELC,IAAK;;AAELC,SAAU;;AAEVE,OAAQ;;AAERC,WAAY;;AAEZC,IAAK;;;AC/HN,MAAMC,EAAcz6B,EAAMC,OACzB,CAIAy6B,cAAe,KAKfC,YAAa,KAKbC,gBAAiB,KAKjBlhB,MAAO,EAKPC,OAAQ,EAKRkhB,YAAa,KACbC,cAAe,KAQfz6B,OAAQ,SAAUqZ,EAAM,KAAMC,EAAO,MAEjB,OAAfiB,EAAQnJ,KAGkB,OAA1BspB,EAAmB,IACtBC,EAAuBpgB,EAAQnJ,IAEhCnR,KAAKo6B,cAAgB9f,EAAQnJ,GAAGwpB,oBAEhC36B,KAAKu6B,YAAc,GACnBv6B,KAAKw6B,cAAgB,GAMrBx6B,KAAKoZ,MAAQA,GAASoQ,EAAOC,SAASrQ,MACtCpZ,KAAKqZ,OAASA,GAAUmQ,EAAOC,SAASpQ,OAErCrZ,KAAKq6B,YAAc,IAAIO,MAAMT,EAAYU,uBAAuBtrB,KAAK,MACrEvP,KAAKs6B,gBAAkB,IAAIM,MAAMT,EAAYU,uBAAuBtrB,KAAK,QAM7EvH,OAAQ,WAEP,IAAImJ,EAAKmJ,EAAQnJ,GACjB,GAAW,OAAPA,EAAJ,CAEA,IAAK,IAAIjR,EAAI,EAAGA,EAAIF,KAAKq6B,YAAYl6B,OAAQD,IAEhB,OAAxBF,KAAKq6B,YAAYn6B,KAEhBF,KAAKs6B,gBAAgBp6B,KAAOi6B,EAAYW,QAC3C3pB,EAAG4pB,cAAc/6B,KAAKq6B,YAAYn6B,IAElCiR,EAAG6pB,mBAAmBh7B,KAAKq6B,YAAYn6B,KAI1CiR,EAAG8pB,kBAAkBj7B,KAAKk7B,iBAU3BrlB,OAAQ,SAAUslB,EAAiBlZ,EAAS9N,EAAK,MAEhD,IAAIhD,EAAKmJ,EAAQnJ,GACjB,GAAW,OAAPA,EAAa,OAEJ,OAATgD,IACHA,EAAOgnB,EAAkBhB,EAAYiB,MAAQjB,EAAYW,QAAUX,EAAYkB,cAEhFr7B,KAAKq6B,YAAYc,GAAmBlZ,EACpCjiB,KAAKs6B,gBAAgBa,GAAmBhnB,EAEpCgnB,EAAkBhB,EAAYiB,QAAuD,IAA9Cp7B,KAAKu6B,YAAYxmB,QAAQonB,KAEnEn7B,KAAKu6B,YAAYzzB,KAAKq0B,GACtBn7B,KAAKw6B,cAAc1zB,KAAK2zB,EAAmBU,KAG5C,IAAInyB,EAAOmI,EAAGmB,aAAanB,EAAGmqB,qBAG9B,OAFAnqB,EAAGoqB,gBAAiBpqB,EAAGqqB,YAAax7B,KAAKo6B,eAEjCjmB,GAEP,KAAKgmB,EAAYW,QAChB3pB,EAAGsqB,qBAAsBtqB,EAAGqqB,YAAaf,EAAmBU,GAAkBhqB,EAAGsQ,WAAYQ,EAAS,GACtG,MAED,KAAKkY,EAAYkB,aAChBlqB,EAAGuqB,wBAAyBvqB,EAAGqqB,YAAaf,EAAmBU,GAAkBhqB,EAAGkqB,aAAcpZ,GAIpG9Q,EAAGoqB,gBAAiBpqB,EAAGqqB,YAAaxyB,IAUrC2yB,kBAAmB,SAAUR,EAAiB/hB,EAAM,KAAMC,EAAO,MAEhE,IAAIlI,EAAKmJ,EAAQnJ,GACjB,GAAW,OAAPA,EAAa,OAAO,KAEV,OAAViI,IAAgBA,EAAQpZ,KAAKoZ,OAClB,OAAXC,IAAiBA,EAASrZ,KAAKqZ,QAEnC,IAAIuiB,EAAMzqB,EAAG+Q,gBAUb,OATA/Q,EAAGqQ,YAAarQ,EAAGsQ,WAAYma,GAE/BzqB,EAAGgR,aAAchR,EAAGsQ,WAAY,EAAGtQ,EAAGiR,MAAOhJ,EAAOC,GACpDlI,EAAGqR,cAAerR,EAAGsQ,WAAYtQ,EAAGsR,mBAAoBtR,EAAGuR,SAC3DvR,EAAGqR,cAAerR,EAAGsQ,WAAYtQ,EAAGwR,mBAAoBxR,EAAGuR,SAC3DvR,EAAGqR,cAAerR,EAAGsQ,WAAYtQ,EAAG0R,eAAgB1R,EAAG2R,eACvD3R,EAAGqR,cAAerR,EAAGsQ,WAAYtQ,EAAG4R,eAAgB5R,EAAG2R,eAEvD9iB,KAAK6V,OAAOslB,EAAiBS,GACtBA,GAURC,kBAAmB,SAAUziB,EAAM,KAAMC,EAAO,MAE/C,IAAIlI,EAAKmJ,EAAQnJ,GACjB,GAAW,OAAPA,EAAa,OAAO,KAEV,OAAViI,IAAgBA,EAAQpZ,KAAKoZ,OAClB,OAAXC,IAAiBA,EAASrZ,KAAKqZ,QAEnC,IAAIuiB,EAAMzqB,EAAG2qB,qBAKb,OAJA3qB,EAAG4qB,iBAAkB5qB,EAAGkqB,aAAcO,GACtCzqB,EAAG6qB,oBAAqB7qB,EAAGkqB,aAAclqB,EAAG8qB,kBAAmB7iB,EAAOC,GAEtErZ,KAAK6V,OAAOskB,EAAYiB,MAAOQ,GACxBA,GAURM,oBAAqB,SAAU9iB,EAAM,KAAMC,EAAO,MAEjD,IAAIlI,EAAKmJ,EAAQnJ,GACjB,GAAW,OAAPA,EAAa,OAAO,KAEV,OAAViI,IAAgBA,EAAQpZ,KAAKoZ,OAClB,OAAXC,IAAiBA,EAASrZ,KAAKqZ,QAEnC,IAAIuiB,EAAMzqB,EAAG+Q,gBAUb,OATA/Q,EAAGqQ,YAAarQ,EAAGsQ,WAAYma,GAE/BzqB,EAAGgR,aAAchR,EAAGsQ,WAAY,EAAGtQ,EAAGgrB,cAAe/iB,EAAOC,GAC5DlI,EAAGqR,cAAerR,EAAGsQ,WAAYtQ,EAAGsR,mBAAoBtR,EAAGuR,SAC3DvR,EAAGqR,cAAerR,EAAGsQ,WAAYtQ,EAAGwR,mBAAoBxR,EAAGuR,SAC3DvR,EAAGqR,cAAerR,EAAGsQ,WAAYtQ,EAAG0R,eAAgB1R,EAAG2R,eACvD3R,EAAGqR,cAAerR,EAAGsQ,WAAYtQ,EAAG4R,eAAgB5R,EAAG2R,eAEvD9iB,KAAK6V,OAAOskB,EAAYgC,cAAeP,GAChCA,GAORQ,WAAY,SAAUjB,GAErB,OAAIn7B,KAAKs6B,gBAAgBa,KAAqBhB,EAAYW,QAClD,KAED96B,KAAKq6B,YAAYc,IAOzBkB,gBAAiB,SAAUlB,GAE1B,OAAIn7B,KAAKs6B,gBAAgBa,KAAqBhB,EAAYkB,aAClD,KAEDr7B,KAAKq6B,YAAYc,IAMzBmB,KAAM,WAEL,IAAInrB,EAAKmJ,EAAQnJ,GACN,OAAPA,IAEJA,EAAGoqB,gBAAiBpqB,EAAGqqB,YAAax7B,KAAKo6B,eAEzCjpB,EAAGopB,YAAav6B,KAAKw6B,eACrBrpB,EAAG2S,SAAU,EAAG,EAAG9jB,KAAKoZ,MAAOpZ,KAAKqZ,UAMrCkjB,OAAQ,WAEP,IAAIprB,EAAKmJ,EAAQnJ,GACN,OAAPA,IAEJA,EAAGoqB,gBAAiBpqB,EAAGqqB,YAAa,MAEpCrqB,EAAGopB,YAAaiC,GAChBrrB,EAAG2S,SAAU,EAAG,EAAG0F,EAAOC,SAASrQ,MAAOoQ,EAAOC,SAASpQ,UAM3DojB,WAAY,WAEX,IAAItrB,EAAKmJ,EAAQnJ,GACjB,GAAW,OAAPA,EAAa,OAAO,EAExB,IAAInI,EAAOmI,EAAGmB,aAAanB,EAAGmqB,qBAC9BnqB,EAAGoqB,gBAAiBpqB,EAAGqqB,YAAax7B,KAAKo6B,eACzC,IAAIsC,EAASvrB,EAAGwrB,uBAAuBxrB,EAAGqqB,aAG1C,OAFArqB,EAAGoqB,gBAAiBpqB,EAAGqqB,YAAaxyB,GAE7B0zB,IAAWvrB,EAAGyrB,wBAQvBzC,EAAYW,QAAU,EACtBX,EAAYkB,aAAe,EAK3BlB,EAAY0C,OAAW,EACvB1C,EAAY2C,OAAW,EACvB3C,EAAY4C,OAAW,EACvB5C,EAAY6C,OAAW,EACvB7C,EAAY8C,OAAW,EACvB9C,EAAY+C,OAAW,EACvB/C,EAAYgD,OAAW,EACvBhD,EAAYiD,OAAW,EACvBjD,EAAYiB,MAAW,EACvBjB,EAAYkD,QAAY,EACxBlD,EAAYgC,cAAgB,GAE5BhC,EAAYU,sBAAwB,GAKpC,MAAMJ,EAAqB,IAAIG,MAAMT,EAAYU,uBAAuBtrB,KAAK,MACvEitB,EAAqB,IAAI5B,MAAM,GAAGrrB,KAAK,MAKvCmrB,EAAyB,SAAUvpB,GAExCqrB,EAAmB,GAAKrrB,EAAGmsB,KAE3B7C,EAAmBN,EAAY0C,QAAU1rB,EAAGosB,kBAC5C9C,EAAmBN,EAAY2C,QAAU3rB,EAAGqsB,kBAC5C/C,EAAmBN,EAAY4C,QAAU5rB,EAAGssB,kBAC5ChD,EAAmBN,EAAY6C,QAAU7rB,EAAGusB,kBAC5CjD,EAAmBN,EAAY8C,QAAU9rB,EAAGwsB,kBAC5ClD,EAAmBN,EAAY+C,QAAU/rB,EAAGysB,kBAC5CnD,EAAmBN,EAAYgD,QAAUhsB,EAAG0sB,kBAC5CpD,EAAmBN,EAAYiD,QAAUjsB,EAAG2sB,kBAC5CrD,EAAmBN,EAAYiB,OAASjqB,EAAG4sB,iBAC3CtD,EAAmBN,EAAYkD,SAAWlsB,EAAG6sB,mBAC7CvD,EAAmBN,EAAYgC,eAAiBhrB,EAAG8sB,8BAGpDC,EAAe/D;;ACvUf,MAAMgE,EAAWz+B,EAAMC,OACtB,CACAiG,UAAW,WAOXw4B,SAAU,KAOVhlB,MAAO,EAOPC,OAAQ,EAORlJ,GAAI,EAOJC,GAAI,EAOJiuB,OAAQ,EAORC,QAAS,EAMTv+B,OAAQ,SAAUq+B,EAAS,KAAMhlB,EAAM,KAAMC,EAAO,MAEnD,GAAIxP,EAAK00B,aAAaH,EAAUD,GAChC,CACC,IAAIK,EAAWJ,EAEfp+B,KAAKo+B,SAAWI,EAASJ,SACzBp+B,KAAKoZ,MAAQA,MAAAA,EAAAA,EAASolB,EAASplB,MAC/BpZ,KAAKqZ,OAASA,MAAAA,EAAAA,EAAUmlB,EAASnlB,OAEjCrZ,KAAKmQ,GAAKquB,EAASruB,GACnBnQ,KAAKoQ,GAAKouB,EAASpuB,GACnBpQ,KAAKq+B,OAASG,EAASH,OACvBr+B,KAAKs+B,QAAUE,EAASF,aAIxBt+B,KAAKo+B,SAAWA,EAEhBp+B,KAAKmQ,GAAK,EACVnQ,KAAKoQ,GAAK,EAENpQ,KAAKo+B,UAERp+B,KAAKoZ,MAAQA,MAAAA,EAAAA,EAASglB,EAASpd,YAC/BhhB,KAAKqZ,OAASA,MAAAA,EAAAA,EAAU+kB,EAASnd,aAEjCjhB,KAAKq+B,OAASD,EAAShlB,MACvBpZ,KAAKs+B,QAAUF,EAAS/kB,SAIxBrZ,KAAKoZ,MAAQA,EACbpZ,KAAKqZ,OAASA,EAEdrZ,KAAKq+B,OAASjlB,EACdpZ,KAAKs+B,QAAUjlB,IASlBolB,YAAa,WAEZ,OAAOz+B,MAOR0+B,SAAU,WAET,OAAO1+B,KAAKo+B,UAObhV,KAAM,SAAU3F,EAAGlkB,EAAG6N,EAAGgM,EAAM,KAAMC,EAAO,MAE3CD,EAAQA,MAAAA,EAAAA,EAASpZ,KAAKoZ,MACtBC,EAASA,MAAAA,EAAAA,EAAUrZ,KAAKqZ,OAExBrZ,KAAK2+B,MAAMlb,EAAGzjB,KAAKmQ,GAAInQ,KAAKoQ,GAAIpQ,KAAKq+B,OAAQr+B,KAAKs+B,QAAS/+B,EAAG6N,EAAGgM,EAAOC,IAOzEslB,MAAO,SAAUlb,EAAGtT,EAAIC,EAAIiuB,EAAQC,EAASM,EAAIC,EAAIC,EAAQC,EAASC,EAAO,KAAMC,EAAQ,MAE1Fxb,EAAElF,UAAWve,KAAKo+B,SACjBjuB,EAAIC,EAAIiuB,EAAQC,EAChBM,EAAIC,EAAIC,EAAQC,EAChB,KAAM,KAAMC,MAAAA,EAAAA,EAAUF,EAAQG,MAAAA,EAAAA,EAAWF,IAO3CG,OAAQ,SAAUzb,EAAGvK,GAEpBlZ,KAAKopB,KAAM3F,EAAGvK,EAAKimB,OAAOxhB,GAAIzE,EAAKimB,OAAOvhB,GAAI1E,EAAKimB,OAAO/lB,QAASF,EAAKimB,OAAO9lB,aAQ3E+lB,EAAYjB,EAASx+B,OAC1B,CACAiG,UAAW,oBAEXy5B,GAAI,KACJC,cAAe,EAEfv/B,OAAQ,SAAUw/B,EAAaD,GAI9B,GAFAt/B,KAAK6I,OAAO22B,SAASz/B,OAAOw/B,GAER,OAAhBA,IAAyB7/B,EAAM+/B,WAAWF,EAAa,eAC1D,MAAM,IAAI15B,MAAM,mCAEjB7F,KAAKq/B,GAAKE,EACVv/B,KAAKs/B,cAAgBA,GAGtBt3B,OAAQ,WAEP+B,QAAQ/J,KAAKq/B,KAGdX,SAAU,WAET,OAAO1+B,KAAKq/B,GAAGX,YAGhBtV,KAAM,SAAU3F,EAAGlkB,EAAG6N,EAAGgM,EAAOC,GAE/B,MAAMqmB,EAAI1/B,KAAKs/B,cAEf,IAAIK,EAAY3/B,KAAKq/B,GAAGO,SAASF,EAAE,GAAGtmB,MAClCymB,EAAa7/B,KAAKq/B,GAAGO,SAASF,EAAE,GAAGtmB,MACnC0mB,EAAW9/B,KAAKq/B,GAAGO,SAASF,EAAE,GAAGtmB,MAEjC2mB,EAAY//B,KAAKq/B,GAAGO,SAASF,EAAE,GAAGrmB,OAClC2mB,EAAehgC,KAAKq/B,GAAGO,SAASF,EAAE,GAAGrmB,OACrC4mB,EAAYjgC,KAAKq/B,GAAGO,SAASF,EAAE,GAAGrmB,OAElC1S,EAAIb,KAAKsT,EAAQumB,EAAYE,GAAcC,GAC3CI,EAAIp6B,KAAKuT,EAAS0mB,EAAYC,GAAgBC,GAE9CtiB,EAAKpe,EACLqe,EAAKxQ,EAGTpN,KAAKq/B,GAAGO,SAASF,EAAE,GAAGtW,KAAK3F,EAAG9F,EAAIC,GAClC5d,KAAKq/B,GAAGO,SAASF,EAAE,GAAGtW,KAAK3F,EAAG9F,EAAKgiB,EAAYh5B,EAAEm5B,EAAUliB,GAC3D5d,KAAKq/B,GAAGO,SAASF,EAAE,GAAGtW,KAAK3F,EAAG9F,EAAIC,EAAKmiB,EAAYG,EAAED,GACrDjgC,KAAKq/B,GAAGO,SAASF,EAAE,GAAGtW,KAAK3F,EAAG9F,EAAKgiB,EAAYh5B,EAAEm5B,EAAUliB,EAAKmiB,EAAYG,EAAED,GAG9E,IAAK,IAAI//B,EAAI,EAAGA,EAAIyG,EAAGzG,IACtBF,KAAKq/B,GAAGO,SAASF,EAAE,GAAGtW,KAAK3F,EAAG9F,EAAKgiB,EAAYz/B,EAAE4/B,EAAUliB,GAC3D5d,KAAKq/B,GAAGO,SAASF,EAAE,GAAGtW,KAAK3F,EAAG9F,EAAKgiB,EAAYz/B,EAAE4/B,EAAUliB,EAAKmiB,EAAYG,EAAED,GAI/E,IAAK,IAAIrwB,EAAI,EAAGA,EAAIswB,EAAGtwB,IACtB5P,KAAKq/B,GAAGO,SAASF,EAAE,GAAGtW,KAAK3F,EAAG9F,EAAIC,EAAKmiB,EAAYnwB,EAAEqwB,GACrDjgC,KAAKq/B,GAAGO,SAASF,EAAE,GAAGtW,KAAK3F,EAAG9F,EAAKgiB,EAAYh5B,EAAEm5B,EAAUliB,EAAKmiB,EAAYnwB,EAAEqwB,GAI/E,IAAK,IAAIxvB,EAAI,EAAGA,EAAIyvB,EAAGzvB,IACvB,IAAK,IAAIC,EAAI,EAAGA,EAAI/J,EAAG+J,IACtB1Q,KAAKq/B,GAAGO,SAASF,EAAE,GAAGtW,KAAK3F,EAAG9F,EAAKgiB,EAAYjvB,EAAEovB,EAAUliB,EAAKmiB,EAAYtvB,EAAEwvB,MAKjF56B,SAASsD,WAAWy2B,EAAW,KAM/B,MAAMe,GAAWhC,EAASx+B,OACzB,CACAiG,UAAW,mBAEX44B,SAAU,KAEVz+B,OAAQ,SAAUy+B,GAEjBx+B,KAAK6I,OAAO22B,SAASz/B,OAAOy+B,GAC5Bx+B,KAAKw+B,SAAWA,GAGjBx2B,OAAQ,WAEP+B,QAAQ/J,KAAKw+B,WAGdG,MAAO,SAAUlb,EAAGtT,EAAIC,EAAIiuB,EAAQC,EAASM,EAAIC,EAAIC,EAAQC,EAASC,EAAO,KAAMC,EAAQ,MAE1Fj/B,KAAKw+B,SAASG,MAAMlb,EAAGtT,EAAIC,EAAIiuB,EAAQC,EAASM,EAAIC,EAAIC,EAAQC,EAAS/+B,KAAKoZ,MAAOpZ,KAAKqZ,WAI5FhU,SAASsD,WAAWw3B,GAAU,KAM9B,MAAMC,GAAUjC,EAASx+B,OACxB,CACAiG,UAAW,kBAEX44B,SAAU,KAEVz+B,OAAQ,SAAUy+B,GAEjBx+B,KAAK6I,OAAO22B,SAASz/B,OAAOy+B,GAC5Bx+B,KAAKw+B,SAAWA,GAGjBx2B,OAAQ,WAEP+B,QAAQ/J,KAAKw+B,WAGdpV,KAAM,SAAU3F,EAAGlkB,EAAG6N,EAAGgM,EAAM,KAAMC,EAAO,MAE3C,IAAImF,EAAMxe,KAAK0+B,WAEftlB,EAAQA,MAAAA,EAAAA,EAASpZ,KAAKoZ,MACtBC,EAASA,MAAAA,EAAAA,EAAUrZ,KAAKqZ,OAExBrZ,KAAKw+B,SAASG,MAAOlb,EACpBzjB,KAAKw+B,SAASruB,GAAInQ,KAAKw+B,SAASpuB,GAAIgJ,EAAMoF,EAAIkD,OAAQrI,EAAOmF,EAAIkD,OACjEniB,EAAG6N,EAAGgM,EAAOC,MAIhBhU,SAASsD,WAAWy3B,GAAS,KAM7B,MAAMC,GAAWlC,EAASx+B,OACzB,CACAiG,UAAW,mBAEX44B,SAAU,KACV9T,MAAO,EACPC,MAAO,EAEP5qB,OAAQ,SAAUy+B,EAAU9T,EAAOC,GAElC3qB,KAAK6I,OAAO22B,SAASz/B,OAAOy+B,GAE5Bx+B,KAAKw+B,SAAWA,EAChBx+B,KAAK0qB,MAAQA,EACb1qB,KAAK2qB,MAAQA,GAGd3iB,OAAQ,WAEP+B,QAAQ/J,KAAKw+B,WAGdpV,KAAM,SAAU3F,EAAGlkB,EAAG6N,EAAGgM,EAAM,KAAMC,EAAO,MAE3CD,EAAQA,MAAAA,EAAAA,EAASpZ,KAAKoZ,MACtBC,EAASA,MAAAA,EAAAA,EAAUrZ,KAAKqZ,OAExBrZ,KAAKw+B,SAASpV,KAAK3F,EAAGlkB,EAAES,KAAK0qB,MAAyB,IAAlBtR,EAAMpZ,KAAKoZ,OAAYhM,EAAEpN,KAAK2qB,MAA2B,IAApBtR,EAAOrZ,KAAKqZ,QAAarZ,KAAKoZ,MAAOpZ,KAAKqZ,WAIrHhU,SAASsD,WAAW03B,GAAU,KAM9B,MAAMC,GAASnC,EAASx+B,OACvB,CACAiG,UAAW,iBAEX44B,SAAU,KACV9T,MAAO,EACPC,MAAO,EAEP5qB,OAAQ,SAAUy+B,EAAU9T,EAAOC,GAElC3qB,KAAK6I,OAAO22B,SAASz/B,OAAOy+B,GAE5Bx+B,KAAKw+B,SAAWA,EAChBx+B,KAAK0qB,MAAQA,EACb1qB,KAAK2qB,MAAQA,GAGd3iB,OAAQ,WAEP+B,QAAQ/J,KAAKw+B,WAGdpV,KAAM,SAAU3F,EAAGlkB,EAAG6N,EAAGgM,EAAM,KAAMC,EAAO,MAE3CrZ,KAAKw+B,SAASpV,KAAK3F,EAAGlkB,EAAES,KAAK0qB,MAAOtd,EAAEpN,KAAK2qB,MAAOvR,EAAOC,MAI3DhU,SAASsD,WAAW23B,GAAQ,KAM5B,MAAMC,GAAQpC,EAASx+B,OACtB,CACAiG,UAAW,gBAEXyC,KAAM,KAENtI,OAAQ,SAAUsI,GAEjBrI,KAAK6I,OAAO22B,SAASz/B,SAErBC,KAAKqI,KAAOA,EAEZrI,KAAKoZ,MAAQ,EACbpZ,KAAKqZ,OAAS,EAEd,IAAK,IAAInZ,EAAI,EAAGA,EAAIF,KAAKqI,KAAKlI,OAAQD,IAEjCF,KAAKqI,KAAKnI,GAAGkZ,MAAQpZ,KAAKoZ,QAAOpZ,KAAKoZ,MAAQpZ,KAAKqI,KAAKnI,GAAGkZ,OAC3DpZ,KAAKqI,KAAKnI,GAAGmZ,OAASrZ,KAAKqZ,SAAQrZ,KAAKqZ,OAASrZ,KAAKqI,KAAKnI,GAAGmZ,QAGnErZ,KAAKq+B,OAASr+B,KAAKoZ,MACnBpZ,KAAKs+B,QAAUt+B,KAAKqZ,QAGrBrR,OAAQ,WAEP,GAAkB,OAAdhI,KAAKqI,KACT,CACC,IAAK,IAAInI,EAAI,EAAGA,EAAIF,KAAKqI,KAAKlI,OAAQD,IACrC6J,QAAQ/J,KAAKqI,KAAKnI,IAEnBF,KAAKqI,KAAO,OAId+gB,KAAM,SAAU3F,EAAGlkB,EAAG6N,EAAGgM,EAAM,KAAMC,EAAO,MAE3C,IAAK,IAAInZ,EAAI,EAAGA,EAAIF,KAAKqI,KAAKlI,OAAQD,IACrCF,KAAKqI,KAAKnI,GAAGkpB,KAAK3F,EAAGlkB,EAAG6N,EAAGgM,EAAOC,IAGpC6lB,OAAQ,SAAUzb,EAAGvK,GAEpB,IAAK,IAAIhZ,EAAI,EAAGA,EAAIF,KAAKqI,KAAKlI,OAAQD,IACrCF,KAAKqI,KAAKnI,GAAGg/B,OAAOzb,EAAGvK,MAI1B7T,SAASsD,WAAW43B,GAAO,KAO3BpC,EAASqC,UAAY,SAAUjB,EAAaD,EAAc,GAAK,OAAOF,EAAUx2B,KAAK3B,MAAMs4B,EAAaD,IAKxGnB,EAASx4B,UAAU66B,UAAY,SAASlB,EAAc,GAAK,OAAOF,EAAUx2B,KAAK3B,MAAMjH,KAAMs/B,IAM7FnB,EAASsC,SAAW,SAAUjC,GAAY,OAAO2B,GAASv3B,KAAK3B,MAAMu3B,IAKrEL,EAASx4B,UAAU86B,SAAW,WAAc,OAAON,GAASv3B,KAAK3B,MAAMjH,OAMvEm+B,EAASuC,QAAU,SAAUlC,GAAY,OAAO4B,GAAQx3B,KAAK3B,MAAMu3B,IAKnEL,EAASx4B,UAAU+6B,QAAU,WAAc,OAAON,GAAQx3B,KAAK3B,MAAMjH,OAMrEm+B,EAASwC,SAAW,SAAUnC,EAAU9T,EAAOC,GAAS,OAAO0V,GAASz3B,KAAK3B,MAAMu3B,EAAU9T,EAAOC,IAKpGwT,EAASx4B,UAAUg7B,SAAW,SAAUjW,EAAOC,GAAS,OAAO0V,GAASz3B,KAAK3B,MAAMjH,KAAM0qB,EAAOC,IAMhGwT,EAASyC,OAAS,SAAUpC,EAAU9T,EAAOC,GAAS,OAAO2V,GAAO13B,KAAK3B,MAAMu3B,EAAU9T,EAAOC,IAKhGwT,EAASx4B,UAAUi7B,OAAS,SAAUlW,EAAOC,GAAS,OAAO2V,GAAO13B,KAAK3B,MAAMjH,KAAM0qB,EAAOC,IAM5FwT,EAAS11B,MAAQ,YAAao4B,GAAQ,OAAON,GAAM33B,KAAK3B,MAAM45B;;;;AAa9Dx7B,SAASsD,WAAWw1B,EAAU,SAC9B2C,GAAe3C,ECnff4C,GAAeD,GAASnhC,OACvB,CACAiG,UAAW,mBAEX0X,EAAG,KAEHvd,OAAQ,SAAUud,GAEjB,GAAe,UAAXA,EAAEnJ,KACL,MAAM,IAAItO,MAAO,6BAElB7F,KAAK6I,OAAO22B,SAASz/B,OAAOud,EAAE5N,KAAM4N,EAAElE,MAAOkE,EAAEjE,QAE/CrZ,KAAKsd,EAAIA,EACTtd,KAAKsd,EAAE0jB,QAAUhhC;ACXnBihC,GAAeH,GAASnhC,OACvB,CACAiG,UAAW,iBAEX7F,OAAQ,SAAUud,GAEjB,GAAc,UAAVA,EAAEnJ,KACL,MAAM,IAAItO,MAAO,8BAElB7F,KAAK6I,OAAO22B,SAASz/B,OAAO,KAAMud,EAAElE,MAAOkE,EAAEjE,QAE7CrZ,KAAKsd,EAAIA,EACTtd,KAAKsd,EAAE0jB,QAAUhhC,KAEjB2pB,EAAOR,YAAY7L,EAAElE,MAAOkE,EAAEjE,QAC7BoK,IACoB,OAAhBzjB,KAAKsd,EAAE8L,MAAyC,mBAAjBppB,KAAKsd,EAAE8L,KACzCppB,KAAKsd,EAAE8L,KAAK3F,EAAGzjB,KAAKsd,IAGpBmG,EAAEtI,UAAUnb,KAAKsd,EAAE+F,OACnBI,EAAE/G,SAAS,EAAG,EAAG1c,KAAKsd,EAAElE,MAAOpZ,KAAKsd,EAAEjE,YAGvCmF,IACAxe,KAAKo+B,SAAW5f,EAChBxe,KAAKq+B,OAASr+B,KAAKo+B,SAAShlB,MAC5BpZ,KAAKs+B,QAAUt+B,KAAKo+B,SAAS/kB,aCdhC,MAAM6nB,GAAgBJ,GAASnhC,OAC9B,CACA4/B,YAAa,KACb4B,WAAY,EAEZphC,OAAQ,SAAUw/B,EAAa4B,GAE9BnhC,KAAK6I,OAAO22B,SAASz/B,OAAO,KAAMw/B,EAAYnmB,MAAOmmB,EAAYlmB,QAEjErZ,KAAKu/B,YAAcA,EACnBv/B,KAAKmhC,WAAaA,EAElBnhC,KAAKoZ,MAAQmmB,EAAYnmB,MACzBpZ,KAAKqZ,OAASkmB,EAAYlmB,OAE1BrZ,KAAKq+B,OAASkB,EAAYxgB,WAC1B/e,KAAKs+B,QAAUiB,EAAYvgB,mBAI7BoiB,GAAeN,GAASnhC,OACvB,CACAiG,UAAW,cAEXy7B,QAAS,EACThV,UAAW,EAEXiV,WAAY,KAEZvhC,OAAQ,SAAUud,GAIjB,GAFAtd,KAAK6I,OAAO22B,SAASz/B,SAEN,SAAVud,EAAEnJ,MAA6B,UAAVmJ,EAAEnJ,KAC3B,MAAM,IAAItO,MAAO,mCAElB,IAAI07B,EAASC,EAEb,GAAc,SAAVlkB,EAAEnJ,KACN,CACC,KAAKmJ,EAAEmkB,OAAOC,YAAgBpkB,EAAEmkB,OAAOpV,WAAc/O,EAAEmkB,OAAO1iB,YAC7D,MAAM,IAAIlZ,MAAOyX,EAAEqkB,QAAU,iDAEzBrkB,EAAEmkB,OAAOC,aACbpkB,EAAEmkB,OAAOC,WAAapkB,EAAElE,OAEpBkE,EAAEmkB,OAAOziB,cACb1B,EAAEmkB,OAAOziB,YAAc1B,EAAE5N,KAAK2J,QAE/BkoB,EAAUjkB,EAAE5N,KAAK0J,MAAQkE,EAAEmkB,OAAOC,WAClCF,EAAUlkB,EAAElE,MAAQkE,EAAEmkB,OAAOC,gBAIxBpkB,EAAEmkB,SAAQnkB,EAAEmkB,OAAS,IAErBnkB,EAAEmkB,OAAO1iB,aACbzB,EAAEmkB,OAAO1iB,WAAazB,EAAE5N,KAAK,GAAG0J,OAE5BkE,EAAEmkB,OAAOziB,cACb1B,EAAEmkB,OAAOziB,YAAc1B,EAAE5N,KAAK,GAAG2J,QAElCkoB,EAAUjkB,EAAE5N,KAAK,GAAGA,KAAK0J,MAAQkE,EAAEmkB,OAAO1iB,WAC1CyiB,EAAUlkB,EAAE5N,KAAK,GAAG0J,MAAQkE,EAAEmkB,OAAO1iB,WAItC/e,KAAK+e,WAAczB,EAAEmkB,OAAO1iB,WAAawiB,EACzCvhC,KAAKgf,YAAe1B,EAAEmkB,OAAOziB,YAAcuiB,EAG3CvhC,KAAKoZ,MAAQkE,EAAEmkB,OAAO1iB,WAAayiB,EACnCxhC,KAAKqZ,OAASiE,EAAEmkB,OAAOziB,YAAcwiB,EAEvB,SAAVlkB,EAAEnJ,MAELnU,KAAKqhC,QAAUv7B,IAAIwX,EAAE5N,KAAK0J,MAAQpZ,KAAK+e,YACvC/e,KAAK4hC,QAAUh7B,KAAKi7B,KAAKvkB,EAAE5N,KAAK2J,OAASrZ,KAAKgf,aAE9Chf,KAAKqsB,UAAY/O,EAAEmkB,OAAOpV,WAAcrsB,KAAKqhC,QAAUrhC,KAAK4hC,UAI5D5hC,KAAKqhC,QAAUrhC,KAAK4hC,QAAU,EAC9B5hC,KAAKqsB,UAAY/O,EAAE5N,KAAKvP,QAGzBH,KAAKshC,WAAa,GAElBthC,KAAKsd,EAAIA,EACTtd,KAAKsd,EAAE0jB,QAAUhhC,KAGjB,IAAK,IAAIE,EAAI,EAAGA,EAAIF,KAAKqsB,UAAWnsB,IACnCF,KAAK4/B,SAAS1/B,IAGhB0/B,SAAU,SAAUrgC,EAAG6N,EAAE,MAExB,IAAI+zB,EAAmB,OAAN/zB,EAAaA,EAAEpN,KAAKqhC,QAAQ9hC,EAAIA,EACjD,GAAI4hC,EAAa,GAAKA,GAAcnhC,KAAKqsB,UACxC,MAAM,IAAIxmB,MAAO,2BAElB,GAAI7F,KAAKshC,WAAWH,GACnB,OAAOnhC,KAAKshC,WAAWH,GAExB,IAAIW,EAAc,IAAIZ,GAAelhC,KAAMmhC,GAa3C,OAXoB,GAAhBnhC,KAAKqhC,SAERS,EAAY1xB,GAAKtK,IAAIq7B,EAAanhC,KAAKqhC,SAAWrhC,KAAKgf,YACvD8iB,EAAY3xB,GAAMgxB,EAAanhC,KAAKqhC,QAAWrhC,KAAK+e,WACpD+iB,EAAY1D,SAAWp+B,KAAKsd,EAAE5N,MAI9BoyB,EAAY1D,SAAWp+B,KAAKsd,EAAE5N,KAAKyxB,GAAYzxB,KAGzC1P,KAAKshC,WAAWH,GAAcW,GAGtCpD,SAAU,WAET,OAAO1+B,KAAK4/B,SAAS,GAAGlB,YAGzBD,YAAa,WAEZ,OAAOz+B,KAAK4/B,SAAS,MClHhB,MAAMmC,GAAYjB,GAASnhC,OACjC,CACAiG,UAAW,YAEXo8B,IAAK,KAAMC,MAAO,EAClBC,MAAO,KAAMC,QAAS,EAAGC,QAAS,KAElCC,MAAO,KAEPlY,IAAK,EAAGmY,aAAc,EAAGphB,KAAM,EAE/BgL,aAAa,EAEbqW,UAAU,EACVC,SAAS,EAETC,iBAAkB,KAClBC,wBAAyB,KACzBC,wBAAyB,KAEzBC,cAAe,KAEf7iC,OAAQ,SAAU8iC,EAAMb,EAAK7X,GAE5BnqB,KAAK6I,OAAO22B,SAASz/B,OAAO8iC,EAAKnE,WAAYmE,EAAKzpB,MAAOypB,EAAKxpB,QAE9DrZ,KAAK6iC,KAAOA,EACZ7iC,KAAKqiC,MAAQh3B,EAAKzC,KAAK3B,QAEvBjH,KAAKgiC,IAAMA,EACXhiC,KAAKiiC,MAAQ,EAEbjiC,KAAKkiC,MAAQ,KACbliC,KAAKmiC,QAAU,EACfniC,KAAKoiC,QAAU,KAEfpiC,KAAKksB,aAAc,EACnBlsB,KAAKuiC,UAAW,EAChBviC,KAAKwiC,SAAU,EAEfxiC,KAAKyiC,iBAAmB,KACxBziC,KAAK0iC,wBAA0B,KAC/B1iC,KAAK2iC,wBAA0B,KAC/B3iC,KAAK4iC,cAAgB,KAErB5iC,KAAKmqB,IAAMA,EACXnqB,KAAK8iC,OAAQ9iC,KAAKgiC,IAAI7X,KAAOnqB,KAAKmqB,MAGnCniB,OAAQ,WAEPhI,KAAKqiC,MAAMx6B,OAEP7H,KAAK0iC,yBACR1iC,KAAK0iC,wBAAwB76B,OAE1B7H,KAAK2iC,yBACR3iC,KAAK2iC,wBAAwB96B,QAG/Bi7B,OAAQ,SAAU3Y,GAKjB,OAHAnqB,KAAKsiC,aAAe,EAAMnY,EAC1BnqB,KAAKkhB,KAAO,EAELlhB,MAGRuyB,OAAQ,SAAUjzB,EAAM,MAEvB,OAAc,OAAVA,EACIU,KAAKwiC,SAEbxiC,KAAKwiC,QAAUljC,EACRU,OAGR+iC,aAAc,SAAUpR,GAGvB,OADA3xB,KAAKkhB,MAAQyQ,EACN3xB,MAGRgjC,WAAY,SAAUv3B,GAGrB,OADAzL,KAAKyiC,iBAAmBh3B,EACjBzL,MAGR60B,KAAM,SAAUppB,EAAUV,EAAQ,MAQjC,OANiB,IAAbU,GAAsBzL,KAAKyiC,mBAAqBziC,KAAKijC,eAExDjjC,KAAK0iC,wBAAwBx5B,QAC7BlJ,KAAK2iC,wBAAwBz5B,SAGzBuC,GAEDzL,KAAKyiC,mBAAqBziC,KAAKijC,eAElCjjC,KAAKyiC,iBAAmBziC,KAAKijC,aAC7BjjC,KAAK0iC,wBAA0Br3B,EAAKzC,KAAK3B,QACzCjH,KAAK2iC,wBAA0Bt3B,EAAKzC,KAAK3B,SAG1CjH,KAAK0iC,wBAAwB57B,KAAK2E,GAClCzL,KAAK2iC,wBAAwB77B,KAAKiE,GAC3B/K,MAXeA,MAcvBijC,aAAc,WAEb,IAAKjjC,KAAK0iC,wBAAwBviC,OACjC,OAAO,EAER,IAAI4K,EAAU/K,KAAK2iC,wBAAwBj4B,QAC3C1K,KAAK0iC,wBAAwBh4B,OAA7B1K,CAAqCA,KAAM+K,IAG5CqiB,QAAS,SAAUtiB,GAGlB,OADA9K,KAAK4iC,cAAgB93B,EACd9K,MAGRkjC,SAAU,SAAUhjC,GAGnB,OADAF,KAAKiiC,MAAQn8B,IAAI5F,GAAKF,KAAKgiC,IAAIv5B,MAAMtI,OAC9BH,MAGR4/B,SAAU,SAAUuD,GAEnB,OAAsB,IAAfA,EAAuBnjC,KAAKiiC,OAASjiC,KAAKgiC,IAAIv5B,MAAMtI,OAAO,GAAMH,KAAKiiC,OAG9EmB,UAAW,WAEV,OAAOpjC,KAAKgiC,IAAIv5B,MAAMtI,QAGvBipB,KAAM,SAAU3F,EAAGlkB,EAAE,EAAG6N,EAAE,EAAGgM,EAAM,KAAMC,EAAO,MAE/C,GAAIrZ,KAAKkhB,KAAO,EASf,OAPKlhB,KAAKwiC,UAETxiC,KAAKkhB,MAAQlhB,KAAKksB,cAAgB1C,EAAO0C,YAAc,EAAI1C,EAAOwC,WAClEhsB,KAAKksB,YAAc1C,EAAO0C,kBAGvBlsB,KAAKkhB,KAAO,IAAGlhB,KAAKkhB,KAAO,IAIhC,GAAIlhB,KAAKiiC,QAAUjiC,KAAKgiC,IAAIv5B,MAAMtI,OAClC,CACC,IAAI+xB,EAAIlyB,KAAKgiC,IAAIv5B,MAAMzI,KAAKiiC,MAAM,GAElC,GAAU,OAANxe,EAEH,IAAK,IAAIvjB,EAAI,EAAGA,EAAIgyB,EAAE/xB,OAAQD,IAC7BF,KAAK6iC,KAAKjD,SAAS1N,EAAEhyB,IAAIkpB,KAAK3F,EAAGlkB,EAAG6N,EAAGgM,EAAOC,GAGhD,OAGD,IAAI6Y,EAAIlyB,KAAKgiC,IAAIv5B,MAAMzI,KAAKiiC,OAE5B,GAAU,OAANxe,EAEH,IAAK,IAAIvjB,EAAI,EAAGA,EAAIgyB,EAAE/xB,OAAQD,IAC7BF,KAAK6iC,KAAKjD,SAAS1N,EAAEhyB,IAAIkpB,KAAK3F,EAAGlkB,EAAG6N,EAAGgM,EAAOC,GAShD,GANKrZ,KAAKwiC,UAETxiC,KAAKkhB,MAAQlhB,KAAKksB,cAAgB1C,EAAO0C,YAAc,EAAI1C,EAAOwC,WAClEhsB,KAAKksB,YAAc1C,EAAO0C,aAGvBlsB,KAAKkhB,MAAQlhB,KAAKsiC,aACtB,CACC,MAAMnB,EAAanhC,KAAKiiC,MAExBjiC,KAAKkhB,MAAQlhB,KAAKsiC,aAClBtiC,KAAKiiC,QAEDjiC,KAAKiiC,QAAUjiC,KAAKgiC,IAAIv5B,MAAMtI,SAEf,MAAdH,KAAKkiC,SAEFliC,KAAKmiC,UAAYniC,KAAKkiC,MAAM/hC,QAEjCH,KAAKkiC,MAAQ,KACbliC,KAAKgiC,IAAMhiC,KAAKoiC,SAGhBpiC,KAAKgiC,IAAMhiC,KAAKkiC,MAAMliC,KAAKmiC,SAE5BniC,KAAK8iC,OAAQ9iC,KAAKgiC,IAAI7X,KAAOnqB,KAAKmqB,KAElCnqB,KAAKiiC,MAAQ,EACbjiC,KAAKkhB,KAAO,EAEZlhB,KAAKuiC,UAAW,IAIZviC,KAAKgiC,IAAIqB,KACZrjC,KAAKiiC,MAAQ,GAGbjiC,KAAKuiC,UAAW,EAEZviC,KAAKyiC,mBAE4B,IAAhCziC,KAAKyiC,iBAAiBziC,QACzBA,KAAKyiC,iBAAmB,OAIvBziC,KAAKqiC,MAAMliC,QACdH,KAAKsjC,IAAItjC,KAAKqiC,MAAM33B,SAAS,KAI5B1K,KAAK4iC,gBAE8D,IAAlE5iC,KAAK4iC,cAAczB,EAAYnhC,KAAKgiC,IAAIv5B,MAAMtI,OAAO,EAAGH,QAC3DA,KAAK4iC,cAAgB,QAKzBlE,SAAU,WAET,OAAO1+B,KAAK6iC,KAAKnE,YAGlBD,YAAa,WAEZ,OAAOz+B,MAGRujC,QAAS,WAERvjC,KAAKuyB,QAAQ,GACbvyB,KAAKopB,KAAM,KAAM,EAAG,IAGrBoa,gBAAiB,WAEhB,OAAuB,OAAfxjC,KAAKkiC,MAAiBliC,KAAKgiC,IAAMhiC,KAAKoiC,SAASh6B,MAGxDk7B,IAAK,SAAUG,EAASC,GAAM,GAE7B,IAAI1B,EAAqB,OAAfhiC,KAAKkiC,MAAiBliC,KAAKgiC,IAAMhiC,KAAKoiC,QAEhD,QAAIJ,EAAI55B,OAASq7B,IAAYzjC,KAAKuiC,WAAsB,IAAVmB,KAG1C1B,EAAIE,OAASF,EAAIE,MAAMuB,IAE1BzjC,KAAKoiC,QAAUpiC,KAAK6iC,KAAKxiC,EAAE2hC,IAAIyB,GAE/BzjC,KAAKkiC,MAAQF,EAAIE,MAAMuB,GACvBzjC,KAAKmiC,QAAU,EAEfniC,KAAKgiC,IAAMhiC,KAAKkiC,MAAMliC,KAAKmiC,YAIb,IAAVuB,IACH1jC,KAAKkiC,MAAQ,MAEdliC,KAAKgiC,IAAMhiC,KAAK6iC,KAAKxiC,EAAE2hC,IAAIyB,IAG5BzjC,KAAK8iC,OAAQ9iC,KAAKgiC,IAAI7X,KAAOnqB,KAAKmqB,KAElCnqB,KAAKiiC,MAAQ,EACbjiC,KAAKkhB,KAAO,EAEZlhB,KAAKuiC,UAAW,GACT,IAGRoB,KAAM,SAAUv7B,GAGf,OADApI,KAAKsjC,IAAIl7B,GACFpI,MAGR4jC,SAAU,SAAUv7B,GAEnB,IAAKgD,EAAKf,WAAWjC,GACpB,MAAM,IAAIxC,MAAM,mDAEC,MAAd7F,KAAKqiC,OACRriC,KAAKqiC,MAAMn5B,QAAQrB,OAEpB7H,KAAKqiC,MAAQh6B,EACbrI,KAAKsjC,IAAItjC,KAAKqiC,MAAM33B,SAAS,IAG9Bm5B,QAAS,SAAUJ,EAASC,GAAM,GAEjC,IAAI1B,EAAqB,OAAfhiC,KAAKkiC,MAAiBliC,KAAKgiC,IAAMhiC,KAAKoiC,QAE5C0B,EAAW9jC,KAAKqiC,MAAMliC,OAAS,EAAIH,KAAKqiC,MAAMriC,KAAKqiC,MAAMliC,OAAO,GAAK6hC,EAAI55B,KAE7E,OAAI45B,EAAI55B,OAASq7B,GAAWzB,EAAIqB,KACxBrjC,KAEJ8jC,IAAaL,GAAYC,EAGzB1B,EAAIqB,MAAQrjC,KAAKuiC,UAEpBviC,KAAKsjC,IAAIG,GAAS,GACXzjC,OAGRA,KAAKqiC,MAAMv7B,KAAK28B,GACTzjC,MATCA,QAaVsF,EAASqD,WAAWo5B,QAGpBgC,GAAe3C,GAAYzhC,OAC1B,CACAiG,UAAW,uBAEXo+B,gBAAiB,KACjBC,WAAY,KAEZ3mB,EAAG,KACHjd,EAAG,KAEHN,OAAQ,SAAUud,GAEjB,IAAKA,EAAEulB,KAAM,MAAM,IAAIh9B,MAAO,oCAE9B7F,KAAK6I,OAAOq7B,YAAYnkC,OAAQud,GAEhCtd,KAAKsd,EAAIA,EACTtd,KAAKsd,EAAE0jB,QAAUhhC,KAEjB,IAAIkyB,EAAIlyB,KAAKK,EAAIL,KAAKsd,EAAEulB,KAExB,GAAI3Q,EAAEiS,YAAa,OAMnB,GAJKjS,EAAEkS,MAAKlS,EAAEkS,IAAM,OACflS,EAAE8P,MAAK9P,EAAE8P,IAAM,KAGf9P,EAAE8P,IAAI9P,EAAEkS,OAAkB,OAATlS,EAAEkS,KAAyB,WAATlS,EAAEkS,KAC1C,CACC,IAAIpV,EAAI,CAAEqU,KAAgB,OAATnR,EAAEkS,IAA8B37B,MAAO,IAExD,IAAK,IAAIvI,EAAI,EAAGA,EAAIF,KAAKqsB,UAAWnsB,IACnC8uB,EAAEvmB,MAAM3B,KAAK,CAAC5G,IAGfgyB,EAAE8P,IAAI9P,EAAEkS,KAAOpV,EAGhB,IAAKkD,EAAE8P,IAAI9P,EAAEkS,KACZ,MAAM,IAAIv+B,MAAO,+BAAiCqsB,EAAEkS,KAEhDlS,EAAE/H,MAAK+H,EAAE/H,IAAM,IAEpB+H,EAAEkS,IAAMlS,EAAE8P,IAAI9P,EAAEkS,KAEhB,IAAIjD,EAAa,EAEjB,IAAK,IAAIjhC,KAAKgyB,EAAE8P,IAOf,GALA9P,EAAE8P,IAAI9hC,GAAGkI,KAAOlI,EAEXgyB,EAAE8P,IAAI9hC,GAAGmjC,OACbnR,EAAE8P,IAAI9hC,GAAGmjC,MAAO,GAEa,iBAAnBnR,EAAE8P,IAAI9hC,GAAGuI,MACpB,CACC,IAAIpI,EAAGC,EAAGC,EAEV,IAAmC,GAA/B2xB,EAAE8P,IAAI9hC,GAAGuI,MAAMsL,QAAQ,KAC3B,CACC1T,EAAI6xB,EAAE8P,IAAI9hC,GAAGuI,MAAM+K,MAAM,KACzB0e,EAAE8P,IAAI9hC,GAAGuI,MAAQ,GAEjB,IAAK,IAAIgI,KAAKpQ,EACb6xB,EAAE8P,IAAI9hC,GAAGuI,MAAM3B,KAAK,CAAChB,IAAIzF,EAAEoQ,WAExB,IAAmC,GAA/ByhB,EAAE8P,IAAI9hC,GAAGuI,MAAMsL,QAAQ,KAS/B,GAPAxT,EAAI2xB,EAAE8P,IAAI9hC,GAAGuI,MAAM+K,MAAM,KAEzBnT,EAAIyF,IAAIvF,EAAE,IACVD,EAAIwF,IAAIvF,EAAE,IAEV2xB,EAAE8P,IAAI9hC,GAAGuI,MAAQ,GAEbpI,EAAIC,EACP,IAAKC,EAAIF,EAAGE,GAAKD,EAAGC,IACnB2xB,EAAE8P,IAAI9hC,GAAGuI,MAAM3B,KAAK,CAACvG,SAGtB,IAAKA,EAAIF,EAAGE,GAAKD,EAAGC,IACnB2xB,EAAE8P,IAAI9hC,GAAGuI,MAAM3B,KAAK,CAACvG,SAQvB,IAHAF,EAAIyF,IAAIosB,EAAE8P,IAAI9hC,GAAGuI,OACjBypB,EAAE8P,IAAI9hC,GAAGuI,MAAQ,GAEVpI,KAAK6xB,EAAE8P,IAAI9hC,GAAGuI,MAAM3B,KAAK,CAACq6B,MAGlCjP,EAAE8P,IAAI9hC,GAAG8xB,MAAQE,EAAE8P,IAAI9hC,GAAGuI,MAAMtI,OAIlC,GAAI+xB,EAAEgQ,MAEL,IAAK,IAAItyB,KAAKsiB,EAAEgQ,MAChB,CACChQ,EAAE8P,IAAIpyB,GAAGsyB,MAAQhQ,EAAEgQ,MAAMtyB,GAEzB,IAAK,IAAIa,KAAKyhB,EAAEgQ,MAAMtyB,GAErB,IAAK,IAAI8vB,EAAI,EAAGA,EAAIxN,EAAEgQ,MAAMtyB,GAAGa,GAAGtQ,OAAQu/B,IAC1C,CACC,IAAI/4B,EAAIurB,EAAEgQ,MAAMtyB,GAAGa,GAAGivB,GAEtB,IAAKxN,EAAE8P,IAAIr7B,GAAI,MAAM,IAAId,MAAO,uBAAyBc,GACzDurB,EAAEgQ,MAAMtyB,GAAGa,GAAGivB,GAAKxN,EAAE8P,IAAIr7B,IAM7BurB,EAAEiS,aAAc,GAGjBE,mBAAoB,SAAUC,EAAW,MAExC,OAAwB,OAApBtkC,KAAKikC,YAERjkC,KAAKikC,WAAalC,GAAUn5B,KAAK3B,MAAMjH,KAAMskC,EAAatkC,KAAKK,EAAE2hC,IAAIsC,GAActkC,KAAKK,EAAE+jC,IAAKpkC,KAAKK,EAAE8pB,KACtGnqB,KAAKikC,WAAWh8B,cAAa,GAEtBjI,KAAKikC,YAGNjkC,KAAKikC,WAAWN,KAAKW,GAA0BtkC,KAAKK,EAAE+jC,IAAIh8B,OAGlEm8B,aAAc,SAAUD,EAAW,KAAMna,EAAI,MAE5C,OAAO4X,GAAUn5B,KAAK3B,MAAMjH,KAAMskC,EAAatkC,KAAKK,EAAE2hC,IAAIsC,GAActkC,KAAKK,EAAE+jC,IAAKja,GAAOnqB,KAAKK,EAAE8pB,MAGnGqa,YAAa,SAAUp8B,GAEtB,OAAOpI,KAAKK,EAAE2hC,IAAI55B,IAGnBq2B,YAAa,WAKZ,OAH6B,OAAzBz+B,KAAKgkC,kBACRhkC,KAAKgkC,gBAAkBhkC,KAAKukC,gBAEtBvkC,KAAKgkC;ACtfdS,GAAe/kC,EAAMC,OACpB,CACAI,OAAQ,SAAUud,GAEjB,GAAc,SAAVA,EAAEnJ,OAAoBmJ,EAAEuH,KAC3B,MAAM,IAAIhf,MAAO,kCAEbyX,EAAEuH,KAAK6c,aACXpkB,EAAEuH,KAAK6c,WAAapkB,EAAElE,OAEvB,IAAImoB,EAAUjkB,EAAE5N,KAAK0J,MAAQkE,EAAEuH,KAAK6c,WAChCF,EAAUlkB,EAAElE,MAAQkE,EAAEuH,KAAK6c,WAE/B1hC,KAAK0kC,YAAepnB,EAAEuH,KAAK8f,UAAYpD,EACvCvhC,KAAK4kC,aAAgBtnB,EAAEuH,KAAKggB,WAAatD,EAEzCvhC,KAAK2kC,UAAarnB,EAAEuH,KAAK8f,UAAYnD,EACrCxhC,KAAK6kC,WAAcvnB,EAAEuH,KAAKggB,WAAarD,EAEvCxhC,KAAK8kC,UAAYxnB,EAAEuH,KAAKigB,UAAY,GAAKtD,EACzCxhC,KAAK+kC,UAAYznB,EAAEuH,KAAKkgB,UAAY,GAAKvD,EAEzCxhC,KAAKglC,UAAY1nB,EAAEuH,KAAKmgB,UAAY,GAAKxD,EACzCxhC,KAAKilC,UAAY3nB,EAAEuH,KAAKogB,UAAY,GAAKzD,EAEzCxhC,KAAKklC,YAAc5nB,EAAEuH,KAAKqgB,cAAe,EAEzC,IAAIC,EAAOr/B,IAAIwX,EAAEuH,KAAK6c,WAAapkB,EAAEuH,KAAK8f,WAE1C3kC,KAAKsd,EAAIA,EACTtd,KAAKsd,EAAE0jB,QAAUhhC,KAEjB,IAAI2G,EAAI2W,EAAEuH,KAAKugB,QAAQjlC,OACnBu/B,EAAI,EACJtyB,EAAI,EAIR,IAFApN,KAAKqlC,UAAY,GAEV3F,EAAI/4B,GACX,CACC,IAAIpH,EAAI,EAER,IAAK,IAAIW,EAAI,EAAGA,EAAIilC,GAAQzF,EAAI/4B,EAAGzG,IACnC,CACC,IAAIK,EAAI+c,EAAEuH,KAAKugB,QAAQ1F,KAEvB1/B,KAAKqlC,UAAU9kC,GAAK,CAAE+Y,QAAQ,EAAO/Z,EAAGA,EAAG6N,EAAGA,EAAGu3B,UAAW3kC,KAAK2kC,UAAWD,YAAa1kC,KAAK0kC,YAAaM,SAAU,GAErHzlC,GAAKS,KAAK0kC,YAGXt3B,GAAKpN,KAAK4kC,aAMX,GAHM,MAAO5kC,KAAKqlC,YACjBrlC,KAAKqlC,UAAU,KAAO,CAAE/rB,QAAQ,EAAMqrB,UAAW7+B,IAAqC,GAAhC9F,KAAK2kC,UAAY3kC,KAAK8kC,UAAY,GAAIJ,YAAa1kC,KAAK0kC,YAAaM,SAAU,IAEjI1nB,EAAEuH,KAAKygB,OAAZ,CAEA3+B,EAAI2W,EAAEuH,KAAKygB,OAAOnlC,OAElB,IAAK,IAAID,EAAI,EAAGA,EAAIyG,EAAGzG,GAAK,EAC5B,CACC,IAAIqc,EAAIe,EAAEuH,KAAKygB,OAAOplC,EAAE,GAAKshC,EACzBxO,EAAI1V,EAAEuH,KAAKygB,OAAOplC,GAEJ,iBAAP8yB,IACVA,EAAIuS,OAAOC,aAAaxS,IAEzB,IAAK,IAAIviB,EAAI,EAAGA,EAAIuiB,EAAE7yB,OAAQsQ,IAEzBuiB,EAAEviB,KAAMzQ,KAAKqlC,YAChBrlC,KAAKqlC,UAAUrS,EAAEviB,IAAIu0B,SAAWzoB,EAAIvc,KAAKqlC,UAAUrS,EAAEviB,IAAIk0B,cAK7Dc,SAAU,SAAUhiB,EAAGlkB,EAAG6N,EAAG4Q,GAE5B,IAAIrX,EAAIqX,EAAK7d,OAETulC,GAAK,EAAG1lC,KAAK8kC,SAAW9kC,KAAKglC,SAKjC,GAHAzlC,GAAKS,KAAK8kC,SACV13B,GAAKpN,KAAK+kC,SAEL/kC,KAAKklC,YAcV,CACC,IAAK,IAAIhlC,EAAI,EAAGA,EAAIyG,EAAE,EAAGzG,IACzB,CACC,IAAIK,EAAIP,KAAKqlC,UAAUrnB,EAAK9d,IACvBK,IAELhB,GAAKgB,EAAEokC,UAAYe,GAGpB,IAAK,IAAI91B,EAAIjJ,EAAE,EAAGiJ,GAAK,EAAGA,IAC1B,CACC,IAAIrP,EAAIP,KAAKqlC,UAAUrnB,EAAKpO,IACvBrP,IAEAA,EAAE+Y,QACNmK,EAAElF,UAAWve,KAAKsd,EAAE5N,KAAMnP,EAAEhB,EAAGgB,EAAE6M,EAAG7M,EAAEmkC,YAAa1kC,KAAK4kC,aAAcrlC,EAAG6N,EAAG7M,EAAEokC,UAAW3kC,KAAK6kC,WAAY,KAAM,KAAMtkC,EAAEokC,UAAW3kC,KAAK6kC,YAEzItlC,GAAKgB,EAAEokC,UAAYe,EAAKnlC,EAAEykC,gBA7B3B,IAAK,IAAI9kC,EAAI,EAAGA,EAAIyG,EAAGzG,IACvB,CACC,IAAIK,EAAIP,KAAKqlC,UAAUrnB,EAAK9d,IACvBK,IAEAA,EAAE+Y,QACNmK,EAAElF,UAAWve,KAAKsd,EAAE5N,KAAMnP,EAAEhB,EAAGgB,EAAE6M,EAAG7M,EAAEmkC,YAAa1kC,KAAK4kC,aAAcrlC,EAAG6N,EAAG7M,EAAEokC,UAAW3kC,KAAK6kC,WAAY,KAAM,KAAMtkC,EAAEokC,UAAW3kC,KAAK6kC,YAEzItlC,GAAKgB,EAAEokC,UAAYe,EAAKnlC,EAAEykC,YA0B7BW,aAAc,SAAU3nB,GAEvB,IAAIrX,EAAIqX,EAAK7d,OACTZ,EAAI,EAEJmmC,GAAK,EAAG1lC,KAAK8kC,SAAW9kC,KAAKglC,SAEjC,IAAK,IAAI9kC,EAAI,EAAGA,EAAIyG,EAAGzG,IACvB,CACC,IAAIK,EAAIP,KAAKqlC,UAAUrnB,EAAK9d,IACvBK,IAELhB,GAAKgB,EAAEokC,UAAYe,EAAKnlC,EAAEykC,UAG3B,OAAOzlC,GAGRqmC,cAAe,SAAU5nB,GAExB,OAAOhe,KAAK6kC,WAAa,EAAE7kC,KAAK+kC,SAAW/kC,KAAKilC,YAKlDtb,EAAOhkB,UAAU8/B,SAAW,SAAUnoB,EAAG/d,EAAG6N,EAAG4Q,GAE9CV,EAAEmoB,SAAUzlC,KAAMT,EAAG6N,EAAG4Q,IAGzB2L,EAAOhkB,UAAUkgC,gBAAkB,SAAUvoB,EAAG/d,EAAG6N,EAAGmP,EAAGC,EAAGspB,EAAIC,EAAI/nB,GAEzD,GAAN8nB,EACHvmC,GAAUgd,EAAIe,EAAEqoB,aAAa3nB,IAAU,EAC/B8nB,EAAK,EACbvmC,EAAIA,EAAIumC,EAAK,EACLA,EAAK,IACbvmC,EAAIA,EAAIgd,EAAIupB,EAAK,EAAIxoB,EAAEqoB,aAAa3nB,IAE3B,GAAN+nB,EACH34B,GAAUoP,EAAIc,EAAEsoB,cAAc5nB,IAAU,EAChC+nB,EAAK,EACb34B,EAAIA,EAAI24B,EAAK,EACLA,EAAK,IACb34B,EAAIA,EAAIoP,EAAIupB,EAAK,EAAIzoB,EAAEsoB,cAAc5nB,IAEtCV,EAAEmoB,SAAUzlC,KAAMT,EAAG6N,EAAG4Q,IAGzB2L,EAAOhkB,UAAUqgC,iBAAmB,SAAU1oB,EAAG6hB,EAAQ2G,EAAIC,EAAI/nB,GAEhEhe,KAAK6lC,gBAAiBvoB,EAAG6hB,EAAOxhB,GAAIwhB,EAAOvhB,GAAIuhB,EAAO/lB,QAAS+lB,EAAO9lB,SAAUysB,EAAIC,EAAI/nB,IChLzF,MAAMioB,GAAY,GAIlB,IAAIC,IAAW;;;;;kBA6CfC;OAAOC,OAAOH,GACd,CAQCI,uBAAuB,EASvBC,WAAW,EAQXp7B,OAAQ,SASRq7B,UAAU,EAMV9E,OAAQ,SAAUxoB,GAEJ,OAATA,GACHktB,OAAOC,OAAOpmC,KAAMiZ,IAoBtButB,KAAM,SAAUn+B,EAAMo+B,EAAkBC,EAAkBC,EAAS9mC,GAElE,IAAK8mC,EACL,CACCA,EAAUR,OAAOS,KAAKv+B,GAEtB,IAAK,IAAInI,KAAKymC,EAEP,aAAct+B,EAAKs+B,EAAQzmC,MAChCmI,EAAKs+B,EAAQzmC,IAAI2mC,QAAUh9B,EAAKD,MAAMvB,EAAKs+B,EAAQzmC,MAGrDL,EAAQ,EAGT,KAAOA,EAAQ8mC,EAAQxmC,QAAW,aAAckI,EAAKs+B,EAAQ9mC,KAC5DA,IAKD,GAHI4mC,GACHA,EAAkB5mC,EAAO8mC,EAAQxmC,OAAQN,EAAQ8mC,EAAQxmC,OAAQwmC,EAAQ9mC,IAEtEA,GAAS8mC,EAAQxmC,OAKpB,YAHIumC,GACHA,EAAiBr+B,IAKnB,IAAIiV,EAAIjV,EAAKs+B,EAAQ9mC,IAIrB,OAFAyd,EAAEqkB,QAAUgF,EAAQ9mC,GAEZyd,EAAEnJ,MAET,IAAK,QACJmJ,EAAE5N,KAAO,IAAI4Z,MAEbhM,EAAE5N,KAAK6Z,OAAS,WAEf,IAAIud,EAAQxpB,EAAE5N,KAAK0J,MAAQkE,EAAE5N,KAAK2J,OAE9BiE,EAAE5Q,QAEL4Q,EAAElE,MAAQtT,IAAIwX,EAAE5N,KAAK0J,MAAMkE,EAAE5Q,OAC7B4Q,EAAEjE,OAASvT,IAAIwX,EAAE5N,KAAK2J,OAAOiE,EAAE5Q,QAG3B4Q,EAAElK,eAAe,gBACrBkK,EAAEypB,WAAa,GAEXzpB,EAAElE,OAAUkE,EAAEjE,OAKViE,EAAElE,QAAUkE,EAAEjE,OAEtBiE,EAAEjE,OAASvT,IAAIwX,EAAElE,MAAQ0tB,IAEhBxpB,EAAElE,OAASkE,EAAEjE,SAEtBiE,EAAElE,MAAQtT,IAAIghC,EAAQxpB,EAAEjE,UATxBiE,EAAElE,MAAQkE,EAAE5N,KAAK0J,MACjBkE,EAAEjE,OAASiE,EAAE5N,KAAK2J,QAWnBiE,EAAE0pB,OAAS1pB,EAAE5N,KAAK0J,MAClBkE,EAAE2pB,QAAU3pB,EAAE5N,KAAK2J,OAEdiE,EAAElK,eAAe,YACrBkK,EAAEpS,OAAUoS,EAAElK,eAAe,eAAmD,IAAhBkK,EAAEgpB,UAAqB,UAA3CL,GAAU/6B,QAElDoS,EAAElK,eAAe,eACrBkK,EAAEgpB,UAAYL,GAAUK,WAEpBhpB,EAAElK,eAAe,cACrBkK,EAAEipB,SAAWN,GAAUM,UAEnBjpB,EAAE5N,KAAK0J,OAASkE,EAAElE,OAASkE,EAAE5N,KAAK2J,QAAUiE,EAAEjE,QAA0B,GAAhBiE,EAAEypB,aAAqC,IAAfzpB,EAAEipB,WAGtFjpB,EAAE5N,KAAOu2B,GAAUiB,YAAa5pB,EAAGA,EAAElE,OAASkE,EAAEypB,YAAczpB,EAAEgpB,UAAY9c,EAAO0H,mBAAqB1H,EAAOwB,cAAe1N,EAAEjE,QAAUiE,EAAEypB,YAAczpB,EAAEgpB,UAAY9c,EAAO0H,mBAAqB1H,EAAOwB,cAAe1N,EAAEgpB,WAAW,IAIxOhpB,EAAEoE,OAASpE,EAAE5N,KAAK0J,MAAQkE,EAAElE,MAE5BkE,EAAE5N,KAAKgS,OAASpE,EAAEoE,OAClBpE,EAAE5N,KAAKxE,OAASoS,EAAEpS,OAClBoS,EAAE5N,KAAKsR,YAAc1D,EAAElE,MACvBkE,EAAE5N,KAAKuR,aAAe3D,EAAEjE,OAGxBmQ,EAAO4B,kBAAkB7M,UAAUjB,EAAE5N,KAAM,EAAG,GAC9C8Z,EAAOC,SAAS1H,aAAazE,EAAE5N,MAE/Bu2B,GAAUkB,SAAU9+B,EAAMs+B,EAAQ9mC,IAClComC,GAAUO,KAAMn+B,EAAMo+B,EAAkBC,EAAkBC,EAAS9mC,EAAM,IAG1Eyd,EAAE5N,KAAKglB,QAAU,WAChB5sB,QAAQC,MAAO,0BAA4BuV,EAAEqkB,UAG9CrkB,EAAE5N,KAAKga,IAAMpM,EAAEoM,IAAM,MAAQ9iB,KAAKoiB,SAClC,MAED,IAAK,SAEJ,IAEIoe,GAFA1d,EAAMpM,EAAEoM,KAEC3V,QAAQ,KAEjBszB,GADAC,EAAK5d,EAAI6d,YAAY,MACXH,EAAK,EAEnB,IAAU,GAANA,EAGH,YADAt/B,QAAQC,MAAO,mBAAqBuV,EAAEqkB,QAAU,gEAIjD,IAAKrkB,EAAE0U,MAGN,YADAlqB,QAAQC,MAAO,mBAAqBuV,EAAEqkB,QAAU,iDAIjDrkB,EAAEkqB,GAAK,EACPlqB,EAAE5N,KAAO,IAEL+3B,EAAK,WAER,GAAInqB,EAAEkqB,IAAMlqB,EAAE0U,MAIb,OAFAiU,GAAUkB,SAAU9+B,EAAMs+B,EAAQ9mC,SAClComC,GAAUO,KAAMn+B,EAAMo+B,EAAkBC,EAAkBC,EAAS9mC,EAAQ,GAK5E,IAAIwwB,EAAM,CAAElc,KAAM,QAASiF,MAAOkE,EAAElE,MAAOC,OAAQiE,EAAEjE,OAAQ3M,MAAO4Q,EAAE5Q,OAEtE2jB,EAAI3G,IAAMpM,EAAEoM,IAAIlG,OAAO,EAAG4jB,IAAQ9pB,EAAEkqB,KAAQ5gC,KAAK4yB,IAAI,GAAG6N,IAAK7+B,QAAQ6+B,GAAI7jB,OAAO,GAAKlG,EAAEoM,IAAIlG,OAAO8jB,EAAG,GACrGjX,EAAI3gB,KAAO,IAAI4Z,MACf+G,EAAIsR,QAAUrkB,EAAEqkB,QAAU,KAAOrkB,EAAEkqB,GAAK,GAExCnX,EAAI3gB,KAAK6Z,OAAS,WAEjB,IAAIud,EAAQzW,EAAI3gB,KAAK0J,MAAQiX,EAAI3gB,KAAK2J,OAElCgX,EAAI3jB,QAEP2jB,EAAIjX,MAAQtT,IAAIuqB,EAAI3gB,KAAK0J,MAAMiX,EAAI3jB,OACnC2jB,EAAIhX,OAASvT,IAAIuqB,EAAI3gB,KAAK2J,OAAOgX,EAAI3jB,QAGjC2jB,EAAIjX,OAAUiX,EAAIhX,OAKdgX,EAAIjX,QAAUiX,EAAIhX,OAE1BgX,EAAIhX,OAASvT,IAAIuqB,EAAIjX,MAAQ0tB,IAEpBzW,EAAIjX,OAASiX,EAAIhX,SAE1BgX,EAAIjX,MAAQtT,IAAIghC,EAAQzW,EAAIhX,UAT5BgX,EAAIjX,MAAQiX,EAAI3gB,KAAK0J,MACrBiX,EAAIhX,OAASgX,EAAI3gB,KAAK2J,QAWX,GAARiE,EAAEkqB,KAELlqB,EAAE0pB,OAAS3W,EAAI3gB,KAAK0J,MACpBkE,EAAE2pB,QAAU5W,EAAI3gB,KAAK2J,OAEhBiE,EAAElK,eAAe,YACrBkK,EAAEpS,OAAUoS,EAAElK,eAAe,eAAmD,IAAhBkK,EAAEgpB,UAAqB,UAA3CL,GAAU/6B,QAElDoS,EAAElK,eAAe,eACrBkK,EAAEgpB,UAAYL,GAAUK,WAEpBhpB,EAAElK,eAAe,cACrBkK,EAAEipB,SAAWN,GAAUM,WAGzBlW,EAAIiW,UAAYhpB,EAAEgpB,UAClBjW,EAAInlB,OAASoS,EAAEpS,OACfmlB,EAAIkW,SAAWjpB,EAAEipB,SAEZlW,EAAI3gB,KAAK0J,OAASiX,EAAIjX,OAASiX,EAAI3gB,KAAK2J,QAAUgX,EAAIhX,SAA4B,IAAjBgX,EAAIkW,WAGzElW,EAAI3gB,KAAOu2B,GAAUiB,YAAa7W,EAAKA,EAAIjX,OAASkE,EAAEgpB,UAAY9c,EAAO0H,mBAAqB1H,EAAOwB,aAAcqF,EAAIhX,QAAUgX,EAAIiW,UAAY9c,EAAO0H,mBAAqB1H,EAAOwB,aAAcqF,EAAIiW,WAAW,IAIlNjW,EAAI3O,OAAS2O,EAAI3gB,KAAK0J,MAAQiX,EAAIjX,MAElCiX,EAAI3gB,KAAKgS,OAAS2O,EAAI3O,OACtB2O,EAAI3gB,KAAKxE,OAASmlB,EAAInlB,OACtBmlB,EAAI3gB,KAAKsR,YAAcqP,EAAIjX,MAC3BiX,EAAI3gB,KAAKuR,aAAeoP,EAAIhX,OAEhB,GAARiE,EAAEkqB,KAELlqB,EAAElE,MAAQiX,EAAIjX,MACdkE,EAAEjE,OAASgX,EAAIhX,OACfiE,EAAEoE,OAAS2O,EAAI3O,QAGhB8H,EAAO4B,kBAAkB7M,UAAU8R,EAAI3gB,KAAM,EAAG,GAChD8Z,EAAOC,SAAS1H,aAAasO,EAAI3gB,MAEjC4N,EAAE5N,KAAK5I,KAAKupB,GACZoX,KAGDpX,EAAI3gB,KAAKglB,QAAU,WAClB5sB,QAAQC,MAAM,0BAA4BsoB,EAAIsR,UAG/CtR,EAAI3gB,KAAKga,IAAM2G,EAAI3G,IAAM,MAAQ9iB,KAAKoiB,aAIvC,MAED,IAAK,QAIJ,GAFK1L,EAAEoqB,QAAOpqB,EAAEoqB,MAAQ,OAEpBtiC,EAAOuiC,SAAWviC,EAAOuiC,QAAQC,aAA0B,OAAXtqB,EAAEoqB,MACtD,CACMxB,KACJ3rB,EAAIC,MAAM,sBACV0rB,IAAW,GAGZ5oB,EAAEuqB,OAASC,EAASC,MAAMC,mBAC1B1qB,EAAE5N,KAAO,OAAS7P,EAElBuF,EAAOuiC,QAAQC,YAAYK,cAAc3qB,EAAE5N,KAAM4N,EAAEoM,KAClD,WACCuc,GAAUkB,SAAU9+B,EAAMs+B,EAAQ9mC,IAClComC,GAAUO,KAAMn+B,EAAMo+B,EAAkBC,EAAkBC,EAAS9mC,EAAQ,MAE5E,SAASgc,GACR/T,QAAQC,MAAM,gCAAkCuV,EAAEqkB,QAAU,KAAO9lB,MAIrE,MAGD,GAAIzW,EAAOuuB,aACX,CACMuS,KACJ3rB,EAAIC,MAAM,mBACV0rB,IAAW,GAGZ5oB,EAAEuqB,OAASC,EAASC,MAAMG,gBAE1BtT,iBAAkBtX,EAAEoM,IAAM,MAAQ9iB,KAAKoiB,UACtC6L,MAAMG,IACN1X,EAAE5N,KAAOslB,EACTiR,GAAUkB,SAAU9+B,EAAMs+B,EAAQ9mC,IAClComC,GAAUO,KAAMn+B,EAAMo+B,EAAkBC,EAAkBC,EAAS9mC,EAAQ,MAE3Eo1B,OAAOC,IACPptB,QAAQC,MAAM,0BAA4BuV,EAAEqkB,YAG7C,MAGIuE,KACJ3rB,EAAIC,MAAM,gBACV0rB,IAAW,GAGZ5oB,EAAE5N,KAAO,IAAIy4B,MACb7qB,EAAEuqB,OAASC,EAASC,MAAMK,aAE1B9qB,EAAE5N,KAAK24B,iBAAmB,WAEzBpC,GAAUkB,SAAU9+B,EAAMs+B,EAAQ9mC,IAClComC,GAAUO,KAAMn+B,EAAMo+B,EAAkBC,EAAkBC,EAAS9mC,EAAQ,IAG5Eyd,EAAE5N,KAAKglB,QAAU,WAEhB5sB,QAAQC,MAAM,0BAA4BuV,EAAEqkB,UAG7CrkB,EAAE5N,KAAKga,IAAMpM,EAAEoM,IAAM,MAAQ9iB,KAAKoiB,SAClC,MAED,IAAK,SAEJ,IAAIU,EAGA4d,EAkBAG,EAnBAL,GAFA1d,EAAMpM,EAAEoM,KAEC3V,QAAQ,KAEjBszB,GADAC,EAAK5d,EAAI6d,YAAY,MACXH,EAAK,EAEnB,IAAU,GAANA,EAGH,YADAt/B,QAAQC,MAAO,mBAAqBuV,EAAEqkB,QAAU,gEAIjD,IAAKrkB,EAAE0U,MAGN,YADAlqB,QAAQC,MAAO,mBAAqBuV,EAAEqkB,QAAU,iDAIjDrkB,EAAEkqB,GAAK,EACPlqB,EAAE5N,KAAO,IAEL+3B,EAAK,WAER,GAAInqB,EAAEkqB,IAAMlqB,EAAE0U,MAIb,OAFAiU,GAAUkB,SAAU9+B,EAAMs+B,EAAQ9mC,SAClComC,GAAUO,KAAMn+B,EAAMo+B,EAAkBC,EAAkBC,EAAS9mC,EAAQ,GAI5E,IAAIwwB,EAAM,CAAElc,KAAM,QAASuzB,MAAOpqB,EAAEoqB,OAOpC,OALArX,EAAI3G,IAAMpM,EAAEoM,IAAIlG,OAAO,EAAG4jB,IAAQ9pB,EAAEkqB,KAAQ5gC,KAAK4yB,IAAI,GAAG6N,IAAK7+B,QAAQ6+B,GAAI7jB,OAAO,GAAKlG,EAAEoM,IAAIlG,OAAO8jB,EAAG,GACrGjX,EAAIsR,QAAUrkB,EAAEqkB,QAAU,KAAOrkB,EAAEkqB,GAAK,GAEnCnX,EAAIqX,QAAOrX,EAAIqX,MAAQ,OAExBtiC,EAAOuiC,SAAWviC,EAAOuiC,QAAQC,aAA4B,OAAbvX,EAAIqX,OAEvDrX,EAAIwX,OAASC,EAASC,MAAMC,mBAC5B3X,EAAI3gB,KAAO,OAAS7P,EAAQ,IAAMyd,EAAEkqB,QAEpCpiC,EAAOuiC,QAAQC,YAAYK,cAAc5X,EAAI3gB,KAAM2gB,EAAI3G,KACtD,WACCpM,EAAE5N,KAAK5I,KAAKupB,GACZoX,OAED,SAAS5rB,GACR/T,QAAQC,MAAM,gCAAkCsoB,EAAIsR,QAAU,KAAO9lB,OAOpEzW,EAAOuuB,cAEVtD,EAAIwX,OAASC,EAASC,MAAMG,qBAE5BtT,iBAAkBvE,EAAI3G,IAAM,MAAQ9iB,KAAKoiB,UACxC6L,MAAMG,IACN3E,EAAI3gB,KAAOslB,EACX1X,EAAE5N,KAAK5I,KAAKupB,GACZoX,OAEAxS,OAAOC,IACPptB,QAAQC,MAAM,0BAA4BsoB,EAAIsR,cAMhDtR,EAAI3gB,KAAO,IAAIy4B,MACf9X,EAAIwX,OAASC,EAASC,MAAMK,aAE5B/X,EAAI3gB,KAAK24B,iBAAmB,WAE3B/qB,EAAE5N,KAAK5I,KAAKupB,GACZoX,KAGDpX,EAAI3gB,KAAKglB,QAAU,WAElB5sB,QAAQC,MAAM,0BAA4BsoB,EAAIsR,eAG/CtR,EAAI3gB,KAAKga,IAAM2G,EAAI3G,IAAM,MAAQ9iB,KAAKoiB,eAKvC,MAED,IAAK,OAEJgL,OAAQ1W,EAAEoM,IAAM,MAAQ9iB,KAAKoiB,SAAU,CAAEqL,aAAc,SAAUQ,MAAK,SAASyT,GAE9EhrB,EAAE5N,KAAO44B,EAETrC,GAAUkB,SAAU9+B,EAAMs+B,EAAQ9mC,IAClComC,GAAUO,KAAMn+B,EAAMo+B,EAAkBC,EAAkBC,EAAS9mC,EAAQ,MAE3Eo1B,OAAM,SAASC,GAEfptB,QAAQC,MAAM,0BAA4BuV,EAAEqkB,QAAU,YAAczM,MAGrE,MAED,IAAK,OAEJlB,OAAQ1W,EAAEoM,IAAM,MAAQ9iB,KAAKoiB,UAAU6L,MAAK,SAAS0T,GAEpDjrB,EAAE5N,KAAO64B,EAETtC,GAAUkB,SAAU9+B,EAAMs+B,EAAQ9mC,IAClComC,GAAUO,KAAMn+B,EAAMo+B,EAAkBC,EAAkBC,EAAS9mC,EAAQ,MAE3Eo1B,OAAM,SAASC,GAEfptB,QAAQC,MAAM,0BAA4BuV,EAAEqkB,QAAU,YAAczM,MAGrE,MAED,IAAK,OAEJlB,OAAQ1W,EAAEoM,IAAM,MAAQ9iB,KAAKoiB,UAAU6L,MAAK,SAASC,GAEpDxX,EAAE5N,KAAO61B,OAAOC,aAAagD,MAAM,KAAM,IAAIC,WAAW3T,IAExDmR,GAAUkB,SAAU9+B,EAAMs+B,EAAQ9mC,IAClComC,GAAUO,KAAMn+B,EAAMo+B,EAAkBC,EAAkBC,EAAS9mC,EAAQ,MAE3Eo1B,OAAM,SAASC,GAEfptB,QAAQC,MAAM,0BAA4BuV,EAAEqkB,QAAU,YAAczM,MAGrE,MAED,IAAK,SACJ5X,EAAE5N,KAAO,GAETu2B,GAAUkB,SAAU9+B,EAAMs+B,EAAQ9mC,IAClComC,GAAUO,KAAMn+B,EAAMo+B,EAAkBC,EAAkBC,EAAS9mC,EAAQ,KAS9E6oC,OAAQ,SAAUrgC,GAEjB,MAAM,IAAIxC,MAAM,wBAoDjBshC,SAAU,SAAU9+B,EAAMxI,GAEzB,IAAIyd,EAAIjV,EAAKxI,GACRyd,EAAE0jB,SAAa1jB,EAAE0jB,WAAW8G,IAEjCz/B,EAAKxI,GAAS,IAAIioC,EAASxqB,EAAE0jB,SAAU1jB,GACvCjV,EAAKxI,GAAO8oC,UAAW,IAOxBzB,YAAa,SAAUllB,EAAOrD,EAAIC,EAAI0nB,EAAWsC,GAEhD,IAAInqB,EAAKuD,EAAMtS,KAAK0J,MAChBsF,EAAKsD,EAAMtS,KAAK2J,OAKpB,GAHAsF,EAAK7Y,IAAI6Y,GACTC,EAAK9Y,IAAI8Y,GAELH,GAAME,GAAMD,GAAME,EACrB,OAAOoD,EAAMtS,KAId,IAFK1P,KAAKqmC,uBAAyBC,IAAWA,EAAY,MAErDA,EAmCL,CACC,GAAIxgC,IAAI6Y,EAAKF,GAAM,EACnB,CACC,IAUIoqB,EAVA/B,EAAQhhC,IAAK6Y,EAAKF,EAAM,IAKxBqqB,GAHJnqB,EAAKmoB,EAAQroB,GAGIA,EACbsqB,GAHJnqB,EAAKkoB,EAAQpoB,GAGIA,EAEbsqB,EAAS,IAAIrf,EAAQ,CAAErQ,QAAQ,EAAME,WAAW,IAAS4B,OAAQuD,EAAIC,IAErEiqB,EAAO,IAAIlf,EAAQ,CAAErQ,QAAQ,EAAME,WAAW,IAAS4B,OAAQqD,EAAIC,IAClEH,UAAWyD,EAAMtS,KAAM,EAAG,GAE/B,IAAK,IAAIe,EAAI,EAAGA,EAAIiO,EAAIjO,IAKvB,IAHA,IAAIuiB,EAAI6V,EAAKxqB,aAAa,EAAG5N,EAAGgO,EAAI,GAAG/O,KACnCu5B,EAAK,EAEA/oC,EAAI,EAAGA,EAAIue,GAAMwqB,EAAKjW,EAAE7yB,OAAQD,IAAK+oC,GAAM,EAEnDD,EAAO7tB,UAAU,QAAQ6X,EAAEiW,GAAI,IAAIjW,EAAEiW,EAAG,GAAG,IAAIjW,EAAEiW,EAAG,GAAG,IAAKjW,EAAEiW,EAAG,GAAK,IAAK,KAC3ED,EAAOtsB,SAASxc,EAAE4oC,EAAOr4B,EAAEs4B,EAAOD,EAAOC,GAM3C,OAFAF,EAAK9+B,UAEEi/B,EAAO9vB,KAGf,OAAOlZ,KAAKknC,YAAallB,EAAOrD,EAAIC,EAAI,KAAMgqB,GA7D9C,KAHIC,EAAO,IAAIlf,EAAQ,CAAErQ,QAAQ,EAAME,UAFvC8sB,EAA0B,OAAdA,IAEmDlrB,OAAQqD,EAAIC,IACtEH,UAAWyD,EAAMtS,KAAM,EAAG,KAG/B,CACC,IAMIs5B,EANAE,EAAKzqB,GAAM,EACX0qB,EAAKzqB,GAAM,EAEf,GAAIwqB,GAAMvqB,GAAMwqB,GAAMvqB,EACrB,OAEGoqB,EAAS,IAAIrf,EAAQ,CAAErQ,QAAQ,EAAME,UAAW8sB,IAAalrB,OAAQ8tB,EAAIC,IACtE5qB,UAAWsqB,EAAK3vB,KAAM,EAAG,EAAGgwB,EAAIC,GACvCN,EAAK9+B,UAEL0U,EAAKyqB,EACLxqB,EAAKyqB,EAELN,EAAOG,EAUR,OAPIA,EAAS,IAAIrf,EAAQ,CAAErQ,QAAQ,EAAME,UAAW8sB,IAAalrB,OAAQuD,EAAIC,IACtEL,UAAWsqB,EAAK3vB,KAAM,EAAG,EAAGyF,EAAIC,GACvCiqB,EAAK9+B,UAED6+B,GACH7+B,QAASiY,EAAMtS,MAETs5B,EAAO9vB,MA4ChBkwB,cAAe,SAAUpnB,GAExB,IAAI6mB,EAAO,IAAIlf,EAAQ,CAAErQ,QAAQ,IAAQ8B,OAAQ4G,EAAMtS,KAAK0J,MAAO4I,EAAMtS,KAAK2J,QAM9E,OAJAwvB,EAAK/6B,UAAUkU,EAAMtS,KAAK0J,MAAO,GACjCyvB,EAAKn8B,OAAM,EAAI,GAEfm8B,EAAKtqB,UAAWyD,EAAMtS,KAAM,EAAG,GACxBm5B,EAAK3vB,MAObmwB,cAAe,SAAUrnB,GAExB,IAAI6mB,EAAO,IAAIlf,EAAQ,CAAErQ,QAAQ,IAAQ8B,OAAQ4G,EAAMtS,KAAK0J,MAAO4I,EAAMtS,KAAK2J,QAM9E,OAJAwvB,EAAK/6B,UAAU,EAAGkU,EAAMtS,KAAK2J,QAC7BwvB,EAAKn8B,MAAM,GAAG,GAEdm8B,EAAKtqB,UAAWyD,EAAMtS,KAAM,EAAG,GACxBm5B,EAAK3vB,MAObowB,aAAc,SAAUC,EAAUC,GAEjC,IAAI5yB,EAAO8C,SAASE,cAAc,KAClChD,EAAK6yB,KAAOD,EAEZ5yB,EAAKmD,MAAM2vB,QAAU,OACrB9yB,EAAK+yB,SAAWJ,EAChB3yB,EAAK/G,OAAS,SAEd6J,SAASG,KAAKC,YAAYlD,GAC1BA,EAAKgzB,QACLlwB,SAASG,KAAKuJ,YAAYxM,IAO3BizB,eAAgB,SAAUC,EAAeC,EAAQt+B,GAEhD,IAAIu+B,EAAQtwB,SAASE,cAAc,SAEnCowB,EAAM71B,KAAO,OACb61B,EAAMD,OAASA,EACfC,EAAMjwB,MAAM2vB,QAAU,OACtBM,EAAMC,SAAWH,EAEjBpwB,SAASG,KAAKC,YAAYkwB,GAE1BA,EAAME,SAAW,WAEhBz+B,EAASu+B,EAAMG,QAGhBzwB,SAASG,KAAKuwB,QAAU,WAEvB1wB,SAASG,KAAKuwB,QAAU,KACxB1wB,SAASG,KAAKuJ,YAAY4mB,IAG3BA,EAAMJ,SAOPS,cAAe,SAAUC,EAAM7+B,GAE9B,IAAI8+B,EAAS,IAAIC,WAEjBD,EAAOhhB,OAAS,SAAS1N,GACxBpQ,EAAUoQ,EAAEhM,OAAO6sB,SAGpB6N,EAAOE,cAAcH,IAOtBI,WAAY,SAAUJ,EAAM7+B,GAE3B,IAAI8+B,EAAS,IAAIC,WAEjBD,EAAOhhB,OAAS,SAAS1N,GACxBpQ,EAAUoQ,EAAEhM,OAAO6sB,SAGpB6N,EAAOI,WAAWL,IAOnBM,kBAAmB,SAAUN,EAAM7+B,GAElC,IAAI8+B,EAAS,IAAIC,WAEjBD,EAAOhhB,OAAS,SAAS1N,GACxBpQ,EAAUoQ,EAAEhM,OAAO6sB,SAGpB6N,EAAOM,kBAAkBP,IAO1BQ,iBAAkB,SAAUC,EAAUt/B,GAErC,IAAIixB,EAAS,GAEb,GAAKqO,GAAaA,EAAS5qC,OAA3B,CAMA,IAAI6qC,EAAW,SAAU9qC,GAEpBA,GAAK6qC,EAAS5qC,OAMlB8lC,GAAUoE,cAAeU,EAAS7qC,IAAI,SAAS+zB,GAC9CyI,EAAO51B,KAAK,CAAEsB,KAAM2iC,EAAS7qC,GAAGkI,KAAMqO,KAAMs0B,EAAS7qC,GAAGuW,KAAMwd,IAAKA,IACnE+W,EAAS9qC,EAAE,MANXuL,EAASixB,IAUXsO,EAAS,QAlBRv/B,EAASixB;AAwBZuO,GAAehF;yBC12Bf;MAAMiF,GAAQxrC,EAAMC,OACnB,CACA2d,EAAG,KAEHvd,OAAQ,SAAUud,GAEjB,GAAc,SAAVA,EAAEnJ,KACL,MAAM,IAAItO,MAAO,0BAElB7F,KAAKsd,EAAIA,EACTtd,KAAKsd,EAAE0jB,QAAUhhC,KAEjBA,KAAK0nC,MAAQwD,GAAMlrC,KAAKsd,EAAEoqB,MAAMyD,gBAGjCxH,KAAM,SAAUl4B,EAAU2/B,GAEzB,OAAOF,GAAMvH,KAAM3jC,KAAMyL,EAAU2/B,IAGpCC,SAAU,SAAU5/B,EAAU2/B,GAE7B,OAAOF,GAAMG,SAAUrrC,KAAMyL,EAAU2/B,MAIzCF,GAAM9C,aAAe,EACrB8C,GAAMhD,gBAAkB,EACxBgD,GAAMlD,mBAAqB,EAE3B7B,OAAOC,OAAO8E,GACd,CACCI,OAAQ,CACPC,SAAS,EACTH,OAAQ,GAGTI,IAAK,CACJD,SAAS,EACTH,OAAQ,GAGTK,MAAO,CACNF,SAAS,EACTH,OAAQ,IAGTM,MAAO,CACNH,SAAS,EACTH,OAAQ,GAGTO,cAAe,IAEfC,KAAM,GACNC,OAAQ,GAERC,SAAU,SAAUC,GAEfA,EAAKC,aAETD,EAAKC,YAAa,EAClBhsC,KAAK6rC,OAAO/kC,KAAKilC,KAGlBE,WAAY,SAAUF,GAErB,GAAKA,EAAKC,WAAV,CAEAD,EAAKC,YAAa,EAElB,IAAI9rC,EAAIgrC,GAAMW,OAAO93B,QAAQg4B,IACpB,GAAL7rC,GAEJgrC,GAAMW,OAAO3iB,OAAOhpB,EAAG,KAGxBgsC,WAAY,SAAUH,EAAMI,GAE3B,OAAQJ,EAAKK,IAAI9uB,EAAEuqB,QAElB,KAAKqD,GAAMhD,gBACV,OAAOloC,KAAKqsC,oBAAoBN,EAAMI,GAEvC,KAAKjB,GAAMlD,mBACV,OAAOhoC,KAAKssC,uBAAuBP,EAAMI,GAG3C,OAAOnsC,KAAKusC,iBAAiBR,EAAMI,IAIpCK,eAAgB,SAAUT,GAEzBA,EAAKU,SAAW9Y,aAAa+Y,aAC7BX,EAAKU,SAASE,KAAKrtC,MAAQ,EAC3BysC,EAAKU,SAASG,QAAQjZ,aAAakZ,aAEnCd,EAAKe,IAAMnZ,aAAaoZ,qBACxBhB,EAAKe,IAAIE,OAASjB,EAAKK,IAAI9uB,EAAE5N,KAC7Bq8B,EAAKe,IAAIzJ,MAAO,EAChB0I,EAAKe,IAAIF,QAAQb,EAAKU,UACtBV,EAAKe,IAAIf,KAAOA,GAGjBkB,cAAe,SAAUlB,GAEnBA,EAAKe,MAEVf,EAAKU,SAASS,aAEdnB,EAAKe,IAAM,KACXf,EAAKU,SAAW,OAIjBU,kBAAmB,SAAUpB,GAE5BA,EAAKe,KAAM,GAGZM,iBAAkB,SAAUrB,GAE3BA,EAAKe,KAAM,GAIZO,YAAa,SAAUtB,GAQtB,OANK/rC,KAAK4rC,KAAKzrC,OAGd6G,KAAOhH,KAAK4rC,KAAKjhC,MAFjB3D,KAAO+kC,EAAKuB,YAIbtmC,KAAKumC,KAAOxB,EAAKriB,IACV1iB,MAGRwmC,WAAY,SAAUzB,GAEjB/rC,KAAK4rC,KAAKzrC,QAAUH,KAAK2rC,eAM7B3rC,KAAK4rC,KAAK9kC,KAAKilC,IAIhBM,oBAAqB,SAAUN,EAAMI,GAEpC,IAAKJ,EAAM,OAAO,KAElB,IAAIX,EAASF,GAAMI,OAAOF,OAASW,EAAKK,IAAI1E,MAAM0D,OAASW,EAAKX,OAEhE,OAAQe,GAGP,IAAK,OACJ,GAAIJ,EAAK0B,QAAS,MAEb1B,EAAKe,KACT5B,GAAMsB,eAAeT,GAEtBA,EAAK2B,SAAWrhC,QAChB0/B,EAAK0B,SAAU,EACf1B,EAAK7b,OAAQ,EAEb6b,EAAKe,IAAIa,QAAUzC,GAAM0C,iBACzB7B,EAAKU,SAASE,KAAKrtC,MAAQ8rC,EAE3B,IACCW,EAAKe,IAAItgC,MAAM,EAAGu/B,EAAKngC,UAAU,KAElC,MAAOiQ,GAEN,OADAqvB,GAAM+B,cAAclB,GACb,KAGRb,GAAMY,SAASC,GACf,MAGD,IAAK,YACJ,IAAKA,EAAKe,IAAK,MAEff,EAAKU,SAASE,KAAKrtC,MAAQ8rC,EAC3B,MAGD,IAAK,OACJ,IAAKW,EAAK0B,SAAW1B,EAAKxZ,OAC1B,CACCwZ,EAAKngC,UAAY,EACjBmgC,EAAKxZ,QAAS,EAEd2Y,GAAM+B,cAAclB,GAEhBA,EAAKtgC,UAAUsgC,EAAKtgC,WACxB,MAGD,IAAKsgC,EAAKe,IAAK,MAEff,EAAKngC,UAAY,EACjBmgC,EAAK0B,SAAU,EACf1B,EAAK7b,OAAQ,EACb6b,EAAKe,IAAIa,QAAU,KAEnBzC,GAAMe,WAAWF,GACjBA,EAAKe,IAAI9/B,OAETk+B,GAAM+B,cAAclB,GAEhBA,EAAKtgC,UAAUsgC,EAAKtgC,WACxB,MAGD,IAAK,QACJ,IAAKsgC,EAAK0B,UAAY1B,EAAKe,IAC1B,MAEDf,EAAKngC,WAAaS,QAAU0/B,EAAK2B,SACjC3B,EAAK0B,SAAU,EACf1B,EAAK7b,OAAQ,EACb6b,EAAKe,IAAIa,QAAU,KAEnBzC,GAAMe,WAAWF,GACjBA,EAAKe,IAAI9/B,OAETk+B,GAAM+B,cAAclB,GACpB,MAGD,IAAK,WACJ,IAAKA,EAAK0B,SAAW1B,EAAKxZ,OAC1B,CACCwZ,EAAKngC,UAAY,EACjBmgC,EAAKxZ,QAAS,EACd,MAGD,IAAKwZ,EAAK0B,UAAY1B,EAAKe,IAC1B,MAEDf,EAAKngC,UAAY,EACjBmgC,EAAK0B,SAAU,EACf1B,EAAK7b,OAAQ,EAEb6b,EAAKe,IAAIzJ,MAAO,EAIlB,OAAO0I,GAGR6B,iBAAkB,SAAU/xB,GAE3B,IAAIkwB,EAAOlwB,EAAEgyB,cAAc9B,KAE3B,GAAIA,EAAK0B,SAAwB,GAAb1B,EAAK1I,KAYxB,OAVA6H,GAAM+B,cAAclB,IAEH,GAAbA,EAAK1I,MACR0I,EAAK1I,OAEN0I,EAAKngC,UAAY,EACjBmgC,EAAK0B,SAAU,EACf1B,EAAK7b,OAAQ,OAEbgb,GAAMmB,oBAAqBN,EAAM,QAIlCA,EAAKe,IAAIa,QAAU,KACnB5B,EAAKe,IAAI1B,OAAS,EAElBF,GAAMmB,oBAAqBN,EAAM,SAIlCO,uBAAwB,SAAUP,EAAMI,GAEvC,IAAKJ,EAAM,OAAO,KAElB,OAAQI,GAGP,IAAK,OACJ,GAAIJ,EAAK0B,QAAS,MAEb1B,EAAKe,KACT5B,GAAMiC,kBAAkBpB,GAEzBA,EAAK0B,SAAU,EACf1B,EAAK7b,OAAQ,EAEb,IACC9qB,EAAOuiC,QAAQC,YAAYjE,KAAMoI,EAAKK,IAAI9uB,EAAE5N,KAAM,KAAM,MAAM,WAAaw7B,GAAM4C,oBAAoB/B,MAEtG,MAAOlwB,GAEN,OADAqvB,GAAMkC,iBAAiBrB,GAChB,KAGRb,GAAMY,SAASC,GACf,MAGD,IAAK,YAoBL,IAAK,QAKL,IAAK,WAEJ,MAtBD,IAAK,OACJ,IAAKA,EAAKe,IAAK,MAEff,EAAK0B,SAAU,EACf1B,EAAK7b,OAAQ,EAEbgb,GAAMe,WAAWF,GACjB3mC,EAAOuiC,QAAQC,YAAY56B,KAAM++B,EAAKK,IAAI9uB,EAAE5N,KAAM,MAElDw7B,GAAMkC,iBAAiBrB,GAEnBA,EAAKtgC,UAAUsgC,EAAKtgC,WAc1B,OAAOsgC,GAGR+B,oBAAqB,SAAU/B,GAE9Bb,GAAMoB,uBAAwBP,EAAM,SAGrCQ,iBAAkB,SAAUR,EAAMI,GAEjC,IAAKJ,EAAM,OAAO,KAElB,IAAIX,EAASF,GAAMI,OAAOF,OAASW,EAAKK,IAAI1E,MAAM0D,OAASW,EAAKX,OAEhE,OAAQe,GAGP,IAAK,OACJ,GAAIJ,EAAK0B,QAAS,MAEb1B,EAAKe,MAETf,EAAKe,IAAM5B,GAAMmC,YAAatB,EAAKK,IAAI9uB,EAAE5N,MACzCq8B,EAAKe,IAAIf,KAAOA,EAChBA,EAAKe,IAAIpjB,IAAMqiB,EAAKe,IAAIS,MAGzBxB,EAAK2B,SAAWrhC,QAChB0/B,EAAK0B,SAAU,EACf1B,EAAK7b,OAAQ,EAEb6b,EAAKe,IAAIa,QAAUzC,GAAM6C,cACzBhC,EAAKe,IAAIkB,YAAcjC,EAAKngC,UAAU,IACtCmgC,EAAKe,IAAI1B,OAASA,EAElB,IACCW,EAAKe,IAAInJ,OAEV,MAAO9nB,GAGN,OAFAqvB,GAAMsC,WAAYzB,EAAKe,KACvBf,EAAKe,IAAM,KACJ,KAGR5B,GAAMY,SAASC,GACf,MAGD,IAAK,YACJ,IAAKA,EAAKe,IAAK,MAEff,EAAKe,IAAI1B,OAASA,EAClB,MAGD,IAAK,OACJ,IAAKW,EAAK0B,SAAW1B,EAAKxZ,OAC1B,CACCwZ,EAAKngC,UAAY,EACjBmgC,EAAKxZ,QAAS,EAEd2Y,GAAMsC,WAAYzB,EAAKe,KACvBf,EAAKe,IAAM,KAEPf,EAAKtgC,UAAUsgC,EAAKtgC,WACxB,MAGD,IAAKsgC,EAAKe,IAAK,MAEff,EAAKngC,UAAY,EACjBmgC,EAAK0B,SAAU,EACf1B,EAAK7b,OAAQ,EAEbgb,GAAMe,WAAYF,GAClBA,EAAKe,IAAI5c,QAETgb,GAAMsC,WAAYzB,EAAKe,KACvBf,EAAKe,IAAM,KAEPf,EAAKtgC,UAAUsgC,EAAKtgC,WACxB,MAGD,IAAK,QACJ,IAAKsgC,EAAK0B,UAAY1B,EAAKe,IAC1B,MAEDf,EAAKngC,WAAaS,QAAU0/B,EAAK2B,SACjC3B,EAAK0B,SAAU,EACf1B,EAAK7b,OAAQ,EAEbgb,GAAMe,WAAYF,GAClBA,EAAKe,IAAI5c,QACT,MAGD,IAAK,WACJ,IAAK6b,EAAK0B,SAAW1B,EAAKxZ,OAC1B,CACCwZ,EAAKngC,UAAY,EACjBmgC,EAAKxZ,QAAS,EACd,MAGD,IAAKwZ,EAAK0B,UAAY1B,EAAKe,IAC1B,MAEDf,EAAKngC,UAAY,EACjBmgC,EAAK0B,SAAU,EACf1B,EAAK7b,OAAQ,EAIf,OAAO6b,GAGRgC,cAAe,SAAUlyB,GAExB,IAAIkwB,EAAOlwB,EAAEgyB,cAAc9B,KAE3B,GAAIA,EAAK0B,SAAwB,GAAb1B,EAAK1I,KAUxB,OARiB,GAAb0I,EAAK1I,MACR0I,EAAK1I,OAEN0I,EAAKngC,UAAY,EACjBmgC,EAAK0B,SAAU,EACf1B,EAAK7b,OAAQ,OAEbgb,GAAMqB,iBAAkBR,EAAM,QAI/BA,EAAKe,IAAIa,QAAU,KACnB5B,EAAKe,IAAI1B,OAAS,EAElBF,GAAMqB,iBAAkBR,EAAM,SAM/BkC,YAAa,SAAUvG,GAEjBA,IAELA,EAAM6D,SAAU,IAGjB2C,aAAc,SAAUxG,GAElBA,IAELA,EAAM6D,SAAU,IAGjB4C,UAAW,SAAUzG,EAAOpoC,GAEtBooC,IAELA,EAAM0D,OAAS9rC,IAGhB8uC,WAAY,SAAUhC,EAAKhB,GAE1B,IAAIW,EAAO,GAcX,OAZAA,EAAKsC,YAAcjD,EACnBW,EAAKX,OAASA,EACdW,EAAKK,IAAMA,EACXL,EAAK1I,KAAO,EACZ0I,EAAK0B,SAAU,EACf1B,EAAKxZ,QAAS,EACdwZ,EAAKngC,UAAY,EACjBmgC,EAAK2B,SAAW,EAChB3B,EAAKtgC,SAAW,KAChBsgC,EAAKuC,MAAQ,KACbvC,EAAKe,IAAM,KAEJf,GAGRpI,KAAM,SAAUyI,EAAK1F,EAAkB0E,GAEtC,IAAKprC,KAAKsrC,OAAOC,UAAYa,IAAQA,EAAI1E,MAAM6D,QAC9C,OAAO,KAEJH,EAAUA,MAAAA,EAA2CA,EAAS,EAAlE,IAEIW,EAAO/rC,KAAKouC,WAAWhC,EAAKhB,GAGhC,OAFAW,EAAKtgC,SAAWi7B,EAET1mC,KAAKksC,WAAWH,EAAM,SAG9BV,SAAU,SAAUe,EAAK1F,EAAkB0E,GAE1C,IAAKprC,KAAKsrC,OAAOC,UAAYa,IAAQA,EAAI1E,MAAM6D,QAC9C,OAAO,KAERH,EAAUA,MAAAA,EAA2CA,EAAS,EAE9D,IAAIW,EAAO/rC,KAAKouC,WAAWhC,EAAKhB,GAIhC,OAHAW,EAAKtgC,SAAWi7B,EAChBqF,EAAK1I,MAAO,EAELrjC,KAAKksC,WAAWH,EAAM,SAG9B/+B,KAAM,SAAU++B,EAAMtgC,GAErB,OAAKsgC,GAEDtgC,IAAyB,IAAbA,IAAmBsgC,EAAKtgC,SAAWA,GAC5CzL,KAAKksC,WAAWH,GAAmB,IAAbtgC,EAAoB,OAAS,aAHxC,MAMnBykB,MAAO,SAAU6b,GAEhB,OAAKA,EAEE/rC,KAAKksC,WAAWH,EAAM,SAFX,MAKnB5b,OAAQ,SAAU4b,GAEjB,OAAKA,EAEE/rC,KAAKksC,WAAYH,EAAM,QAFZ,MAKnBwC,QAAS,SAAUxC,EAAMyC,EAAQ/iC,GAEhC,GAAKsgC,EAEL,GAAKA,EAAK0B,UAAW1B,EAAKuC,MAA1B,CAMA,IAAI1iC,EAAYS,QAChB0/B,EAAKsC,YAActC,EAAKX,OAExBW,EAAKuC,MAAQG,aAAa,WAEzB,IAAIvc,GAAM7lB,QAAUT,GAAa4iC,EAC7Btc,EAAI,IAAGA,EAAI,GAEf6Z,EAAKX,OAASW,EAAKsC,aAAa,EAAEnc,GAClCgZ,GAAMgB,WAAWH,EAAM,aAEd,GAAL7Z,IAEHwc,cAAe3C,EAAKuC,OACpBvC,EAAKuC,MAAQ,MAEI,IAAb7iC,EACHy/B,GAAMgB,WAAWH,EAAM,QAEvBb,GAAMgB,WAAWH,EAAM,SAEpBtgC,IAAyB,IAAbA,GACfA,OAGH,SA7BKA,GAAUA,KAgChBkjC,OAAQ,SAAU5C,EAAMyC,EAAQ/iC,GAE/B,GAAKsgC,EAEL,GAAIA,EAAK0B,SAAW1B,EAAKuC,MAEpB7iC,GAAUA,QAFf,CAMA,IAAIG,EAAYS,QAEhB0/B,EAAKX,OAAS,EACdprC,KAAKksC,WAAWH,EAAM,QAEtBA,EAAKuC,MAAQG,aAAa,WAEzB,IAAIvc,GAAM7lB,QAAUT,GAAa4iC,EAC7Btc,EAAI,IAAGA,EAAI,GAEf6Z,EAAKX,OAASW,EAAKsC,YAAYnc,EAC/BgZ,GAAMgB,WAAWH,EAAM,aAEd,GAAL7Z,IAEHwc,cAAe3C,EAAKuC,OACpBvC,EAAKuC,MAAQ,KAET7iC,GAAUA,OAGhB,QAOFw/B,GAAU9C,MAAQ,SAAUze,EAAKzQ,EAAK,MAErC,MAAO,CAAE9E,KAAM,QAAS6sB,QAAS,QAAStX,IAAKA,KAAQzQ,QAGxD21B,GAAe1D;AC7oBf2D,GAAenvC,EAAMC,OACpB,CACA2d,EAAG,KAEHvd,OAAQ,SAAUud,GAEjB,GAAc,UAAVA,EAAEnJ,KACL,MAAM,IAAItO,MAAO,2BAElB7F,KAAKsd,EAAIA,EACTtd,KAAKsd,EAAE0jB,QAAUhhC,KAEZA,KAAKsd,EAAEoqB,QACX1nC,KAAKsd,EAAEoqB,MAAQ,OAEX1nC,KAAKsd,EAAEwxB,OACX9uC,KAAKsd,EAAEwxB,KAAO,UAEf9uC,KAAK0nC,MAAQkH,GAAM5uC,KAAKsd,EAAEoqB,MAAMyD,eAEhCnrC,KAAK+uC,OAAS,GACd/uC,KAAKgvC,WAAY,EAEjB,IAAK,IAAI9uC,EAAI,EAAGA,EAAIF,KAAKsd,EAAE5N,KAAKvP,OAAQD,IAEvCF,KAAK+uC,OAAOjoC,KAAK,IAAI8nC,GAAOzI,OAAOC,OAAQpmC,KAAKsd,EAAE5N,KAAKxP,GAAI,CAAEwnC,MAAO1nC,KAAKsd,EAAEoqB,WAI7EuH,eAAgB,WAEf,MAAmB,UAAfjvC,KAAKsd,EAAEwxB,KACH9uC,KAAK+uC,OAAOjZ,MAAM,EAAG91B,KAAK+uC,OAAO5uC,OAAO,KAEhDH,KAAKgvC,YAAchvC,KAAKgvC,UAAYhvC,KAAK+uC,OAAO5uC,OACzCH,KAAK+uC,OAAO/uC,KAAKgvC,aAGzBrL,KAAM,SAAUl4B,EAAU2/B,GAEzB,OAAOwD,GAAMjL,KAAM3jC,KAAKivC,iBAAkBxjC,EAAU2/B,IAGrDC,SAAU,SAAU5/B,EAAU2/B,GAE7B,OAAOwD,GAAMvD,SAAUrrC,KAAKivC,iBAAkBxjC,EAAU2/B,IAGzD8D,OAAQ,SAAUrvC,EAAO4L,EAAU2/B,GAElC,OAAOwD,GAAMjL,KAAM3jC,KAAK+uC,OAAOlvC,EAAQG,KAAK+uC,OAAO5uC,QAASsL,EAAU2/B,IAGvE+D,WAAY,SAAUtvC,EAAO4L,EAAU2/B,GAEtC,OAAOwD,GAAMvD,SAAUrrC,KAAK+uC,OAAOlvC,EAAQG,KAAK+uC,OAAO5uC,QAASsL,EAAU2/B,MChE9B,MAAMgE,GAAWrO,GAEfsO,GAASpO,GAECqO,GAAclO,GAEKmO,GAAuBxL,GAE5CyL,GAAa/K,GAEvBgL,GAAQb,GAEGc,GAAab;ACTtEc,GAAejwC,EAAMC,OACpB,CACAiG,UAAW,gBAEXy8B,MAAO,KACPuN,UAAW,KACXC,MAAO,KAMP9vC,OAAQ,WAEPC,KAAKqiC,MAAQ,GACbriC,KAAK4vC,UAAY,IAOlBvhC,IAAK,SAAUyhC,GAEd,OAAc,MAAVA,EACI,MAEF,aAAcA,IACnBA,EAAOC,SAAW,IAEbD,EAAOC,YAAY/vC,KAAKqiC,QAE7BriC,KAAKqiC,MAAMyN,EAAOC,UAAY,CAAEC,UAAU,EAAO3nC,KAAM,IACvDrI,KAAK4vC,UAAU9oC,KAAKgpC,EAAOC,UAE3B/vC,KAAK6vC,MAAQ1J,OAAOS,KAAK5mC,KAAKqiC,OAAO4N,MAAK,CAAC5vC,EAAEC,IAAMD,EAAEC,MAGG,IAArDN,KAAKqiC,MAAMyN,EAAOC,UAAU1nC,KAAK0L,QAAQ+7B,IAC5C9vC,KAAKqiC,MAAMyN,EAAOC,UAAU1nC,KAAKvB,KAAKgpC,GAEhCA,IAORzlC,OAAQ,SAAUylC,GAEjB,GAAc,MAAVA,EACH,OAAO,KAKR,GAHM,aAAcA,IACnBA,EAAOC,SAAW,MAEbD,EAAOC,YAAY/vC,KAAKqiC,OAC7B,OAAOyN,EAER,IAAI5vC,EAAIF,KAAKqiC,MAAMyN,EAAOC,UAAU1nC,KAAK0L,QAAQ+7B,GACjD,OAAU,IAAN5vC,IAEJF,KAAKqiC,MAAMyN,EAAOC,UAAUC,UAAW,EACvChwC,KAAKqiC,MAAMyN,EAAOC,UAAU1nC,KAAKnI,GAAK,MAHjB4vC,GAYtBI,QAAS,WAER,IAAK,IAAIhwC,EAAI,EAAGA,EAAIF,KAAK4vC,UAAUzvC,OAAQD,IAC3C,CACC,IAAIiwC,EAAInwC,KAAKqiC,MAAMriC,KAAK4vC,UAAU1vC,IAClC,GAAKiwC,EAAEH,SAAP,CAEA,IAAK,IAAIv/B,EAAI,EAAGA,EAAI0/B,EAAE9nC,KAAKlI,OAAQsQ,IAEjB,MAAb0/B,EAAE9nC,KAAKoI,IAEV0/B,EAAE9nC,KAAK6gB,OAAOzY,IAAK,GAIrB0/B,EAAEH,UAAW,KASfnlC,QAAS,SAAUY,GAElB,IAAIukC,GAAW,EACXI,GAAc,EAElB,IAAK,IAAIlwC,EAAI,GAAIkwC,GAAelwC,EAAIF,KAAK6vC,MAAM1vC,OAAQD,IACvD,CACC,IAAImI,EAAOrI,KAAKqiC,MAAMriC,KAAK6vC,MAAM3vC,IAAImI,KAErC,IAAK,IAAIoI,EAAI,GAAI2/B,GAAe3/B,EAAIpI,EAAKlI,OAAQsQ,IAEjC,MAAXpI,EAAKoI,KAEkB,IAAtBhF,EAASpD,EAAKoI,MACjB2/B,GAAc,GAGD,MAAX/nC,EAAKoI,KACRu/B,GAAW,GAIVA,GAAUhwC,KAAKkwC,WAQpBllC,WAAY,SAAUS,GAErB,IAAIukC,GAAW,EACXI,GAAc,EAElB,IAAK,IAAIlwC,EAAIF,KAAK6vC,MAAM1vC,OAAO,GAAIiwC,GAAelwC,GAAK,EAAGA,IAC1D,CACC,IAAImI,EAAOrI,KAAKqiC,MAAMriC,KAAK6vC,MAAM3vC,IAAImI,KAErC,IAAK,IAAIoI,EAAIpI,EAAKlI,OAAO,GAAIiwC,GAAe3/B,GAAK,EAAGA,IAEpC,MAAXpI,EAAKoI,KAEkB,IAAtBhF,EAASpD,EAAKoI,MACjB2/B,GAAc,GAGD,MAAX/nC,EAAKoI,KACRu/B,GAAW,GAIVA,GAAUhwC,KAAKkwC,WASpBG,aAAc,SAAU5kC,EAAUg3B,EAAiB,MAElD,IAAIhb,EAAIznB,KAEJgwC,GAAW,EACXI,GAAc,EAEdlwC,GAAI,EACJuQ,GAAI,EAEJpI,EAAO,KAEPioC,EAAS,WAEZ7/B,KAEK2/B,GAAe3/B,EAAIpI,EAAKlI,QAEb,MAAXkI,EAAKoI,KAE0B,IAA9BhF,EAASpD,EAAKoI,GAAI6/B,KACrBF,GAAc,GAGD,MAAX/nC,EAAKoI,KACRu/B,GAAW,GAERI,GAAaE,KAGjBC,KAGEA,EAAS,WAEZrwC,KAEKkwC,GAAelwC,EAAIunB,EAAEooB,MAAM1vC,QAE/BkI,EAAOof,EAAE4a,MAAM5a,EAAEooB,MAAM3vC,IAAImI,KAC3BoI,GAAI,EACJ6/B,MAIIN,GAAUvoB,EAAEyoB,UACZzN,GAAkBA,MAIxB8N,KASDC,gBAAiB,SAAU/kC,GAE1BglC,MAAM;;iBCnNR;MAAMC,GAAWhxC,EAAMC,OACtB,CACAiG,UAAW,WAKX6F,SAAU,KAKVklC,KAAM,KACNC,KAAM,KACNC,KAAM,KACNC,KAAM,KACNC,KAAM,KACNC,KAAM,KAKNhoC,KAAM,KACNC,KAAM,KAMNlJ,OAAQ,SAAU0L,EAAUklC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAEvFhxC,KAAKyL,SAAWA,EAEhBzL,KAAK2wC,KAAOA,EACZ3wC,KAAK4wC,KAAOA,EACZ5wC,KAAK6wC,KAAOA,EACZ7wC,KAAK8wC,KAAOA,EACZ9wC,KAAK+wC,KAAOA,EACZ/wC,KAAKgxC,KAAOA,EAEZhxC,KAAKgJ,KAAO,KACZhJ,KAAKiJ,KAAO,MAMbjB,OAAQ,WAEPhI,KAAKyL,SAAW,KAEhBzL,KAAK2wC,KAAO,KACZ3wC,KAAK4wC,KAAO,KACZ5wC,KAAK6wC,KAAO,KACZ7wC,KAAK8wC,KAAO,KACZ9wC,KAAK+wC,KAAO,KACZ/wC,KAAKgxC,KAAO,KAEZhxC,KAAKgJ,KAAO,KACZhJ,KAAKiJ,KAAO,MAMbgoC,QAAS,SAAUxlC,EAAS,KAAMklC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAE7F,OAAiB,OAAbvlC,GAAqBilC,GAASpmC,WAAWmB,GACrCA,IAAazL,MAEJ,OAAbyL,GAAqBzL,KAAKyL,WAAaA,MAG9B,OAATklC,GAAiB3wC,KAAK2wC,OAASA,MAGtB,OAATC,GAAiB5wC,KAAK4wC,OAASA,MAGtB,OAATC,GAAiB7wC,KAAK6wC,OAASA,MAGtB,OAATC,GAAiB9wC,KAAK8wC,OAASA,MAGtB,OAATC,GAAiB/wC,KAAK+wC,OAASA,KAGtB,OAATC,GAAiBhxC,KAAKgxC,OAASA,SAWpCE,KAAM,SAAUC,GAEf,OAAsB,OAAlBnxC,KAAKyL,UACDzL,KAAKyL,SAAU0lC,EAAMnxC,KAAK2wC,KAAM3wC,KAAK4wC,KAAM5wC,KAAK6wC,KAAM7wC,KAAK8wC,KAAM9wC,KAAK+wC,KAAM/wC,KAAKgxC;;;iBAgB3F1rC;EAASqD,WAAW+nC,GAAU,MAAO,UACrCU,GAAeV;;;gBCrHf;MAAMW,GAAU3xC,EAAMC,OACrB,CACAiG,UAAW,UAMXurC,KAAM,KAKN1nC,IAAK,KACLC,OAAQ,KAMR3J,OAAQ,SAAUoxC,EAAK,MAOtB,OALAnxC,KAAKmxC,KAAOA,EAEZnxC,KAAKyJ,IAAM,KACXzJ,KAAK0J,OAAS,KAEP1J,MAMRgI,OAAQ,WAEPhI,KAAKqK,UAONgE,IAAK,SAAU5C,EAAUklC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAEpF,IAAIjF,EAAOqF,GAAS9mC,WAAWmB,GAAYA,EAAW2lC,GAASxoC,KAAK3B,MAAMwE,EAAUklC,EAAMC,EAAMC,EAAMC,EAAMC,EAAMC,GAYlH,OAVAjF,EAAK/iC,KAAOhJ,KAAK0J,OAEG,OAAhB1J,KAAK0J,SACR1J,KAAK0J,OAAOT,KAAO8iC,GAEpB/rC,KAAK0J,OAASqiC,EAEG,OAAb/rC,KAAKyJ,MACRzJ,KAAKyJ,IAAMsiC,GAELA,GAOR5iC,OAAQ,SAAU4iC,GAEbA,EAAK/iC,OAAM+iC,EAAK/iC,KAAKC,KAAO8iC,EAAK9iC,MACjC8iC,EAAK9iC,OAAM8iC,EAAK9iC,KAAKD,KAAO+iC,EAAK/iC,MAEjChJ,KAAKyJ,MAAQsiC,IAChB/rC,KAAKyJ,IAAMsiC,EAAK9iC,MAEbjJ,KAAK0J,SAAWqiC,IACnB/rC,KAAK0J,OAASqiC,EAAK/iC,MAEpB+iC,EAAK/iC,KAAO,KACZ+iC,EAAK9iC,KAAO,KAEZc,QAAQgiC,IAOT1hC,OAAQ,SAAUoB,EAAS,KAAMklC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAE5F,GAAiB,OAAbvlC,GAAqB2lC,GAAS9mC,WAAWmB,GAG5C,OADAzL,KAAKmJ,OAAOsC,GACLzL,KAGR,IAAI+rC,EAAO/rC,KAAKyJ,IAEhB,KAAgB,OAATsiC,GACP,CACC,IAAI9iC,EAAO8iC,EAAK9iC,KAEZ8iC,EAAKkF,QAAQxlC,EAAUklC,EAAMC,EAAMC,EAAMC,EAAMC,EAAMC,IACxDhxC,KAAKmJ,OAAO4iC,GAEbA,EAAO9iC,EAGR,OAAOjJ,MAORiL,KAAM,SAAUQ,EAAUklC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAErF,IAAIjF,EAAO/rC,KAAKyJ,IAEhB,KAAgB,OAATsiC,GACP,CACC,GAAIA,EAAKkF,QAAQxlC,EAAUklC,EAAMC,EAAMC,EAAMC,EAAMC,EAAMC,GACxD,OAAOjF,EAERA,EAAOA,EAAK9iC,KAGb,OAAO,MAORioC,KAAM,SAAUC,EAAK,MAEpB,IAAIpF,EAAO/rC,KAAKyJ,IAIhB,IAFA0nC,EAAOA,MAAAA,EAAAA,EAAQnxC,KAAKmxC,KAEJ,OAATpF,GACP,CACC,IAAI9iC,EAAO8iC,EAAK9iC,MAEQ,IAApB8iC,EAAKmF,KAAKC,IACbnxC,KAAKmJ,OAAO4iC,GAEbA,EAAO9iC,IAQTqoC,MAAO,SAAU7lC,EAAS,KAAMklC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAE3F,IAAIjF,EAAO/rC,KAAKyJ,IAEhB,KAAgB,OAATsiC,GACP,CACC,IAAI9iC,EAAO8iC,EAAK9iC,KAEhB,GAAI8iC,EAAKkF,QAAQxlC,EAAUklC,EAAMC,EAAMC,EAAMC,EAAMC,EAAMC,GACzD,EAC8B,IAAzBjF,EAAKmF,KAAKlxC,KAAKmxC,OAClBnxC,KAAKmJ,OAAO4iC,GAEb,MAGDA,EAAO9iC,IAQTsoC,MAAO,SAAUxF,EAAMoF,EAAK,OAEU,IAAjCpF,EAAKmF,KAAKC,MAAAA,EAAAA,EAAQnxC,KAAKmxC,OAC1BnxC,KAAKmJ,OAAO4iC;;;iBAcfzmC;EAASqD,WAAW0oC,GAAS,MAAO,UACpCG,GAAeH;;;aClMf;MAAMI,GAAO/xC,EAAMC,OAClB,CACAiG,UAAW,OAUX8rC,GAAI,EAIJC,GAAI,EAIJh0B,GAAI,EAIJC,GAAI,EAIJC,GAAI,EAIJC,GAAI,EAcJ/d,OAAQ,SAAU4d,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAE/C,OAAW,OAAPH,GAEH3d,KAAK2d,GAAK3d,KAAK4d,GAAK5d,KAAK6d,GAAK7d,KAAK8d,GAAK9d,KAAK0xC,GAAK1xC,KAAK2xC,GAAK,EACrD3xC,MAGG,OAAP6d,GAEH7d,KAAKqN,IAAK,EAAG,EAAG,EAAG,GACnBrN,KAAKob,OAAQuC,EAAIC,GACV5d,MAGDA,KAAKqN,IAAIsQ,EAAIC,EAAIC,EAAIC,IAM7B9V,OAAQ,aAQR4B,MAAO,WAEN,OAAO6nC,GAAKG,KAAK3qC,MAAMjH,KAAK2d,GAAI3d,KAAK4d,GAAI5d,KAAK6d,GAAI7d,KAAK8d,KAOxDrQ,KAAM,WAML,OAJAzN,KAAK0xC,GAAK,EAAG1xC,KAAK2xC,GAAK,EACvB3xC,KAAK2d,GAAK,EAAG3d,KAAK4d,GAAK,EACvB5d,KAAK6d,GAAK,EAAG7d,KAAK8d,GAAK,EAEhB9d,MAOR2J,MAAO,WAMN,OAJA3J,KAAK0xC,GAAK,KAAM1xC,KAAK2xC,GAAK,KAC1B3xC,KAAK2d,GAAK,KAAM3d,KAAK4d,GAAK,KAC1B5d,KAAK6d,GAAK,KAAM7d,KAAK8d,GAAK,KAEnB9d,MAWR6xC,gBAAiB,SAAUtyC,EAAG6N,EAAE,MAE/B,GAAU,OAANA,EACJ,CACC,MAAMkQ,EAAI/d,EACVA,EAAI+d,EAAE/d,EACN6N,EAAIkQ,EAAElQ,EAWP,OARgB,OAAZpN,KAAK2d,IAAepe,EAAIS,KAAK2d,MAAI3d,KAAK2d,GAAKpe,IAC/B,OAAZS,KAAK4d,IAAexQ,EAAIpN,KAAK4d,MAAI5d,KAAK4d,GAAKxQ,IAC/B,OAAZpN,KAAK6d,IAAete,EAAIS,KAAK6d,MAAI7d,KAAK6d,GAAKte,IAC/B,OAAZS,KAAK8d,IAAe1Q,EAAIpN,KAAK8d,MAAI9d,KAAK8d,GAAK1Q,GAE/CpN,KAAK0xC,IAAM1xC,KAAK2d,GAAK3d,KAAK6d,IAAM,EAChC7d,KAAK2xC,IAAM3xC,KAAK4d,GAAK5d,KAAK8d,IAAM,EAEzB9d,MAOR8N,UAAW,SAAUC,EAAIC,GAMxB,OAJAhO,KAAK2d,IAAM5P,EAAI/N,KAAK4d,IAAM5P,EAC1BhO,KAAK6d,IAAM9P,EAAI/N,KAAK8d,IAAM9P,EAC1BhO,KAAK0xC,IAAM3jC,EAAI/N,KAAK2xC,IAAM3jC,EAEnBhO,MAQR8xC,SAAU,SAAUvyC,EAAG6N,EAAG+1B,GAAW,GAQpC,OANkB,GAAdA,IAEH5jC,EAAIS,KAAK2d,GAAKpe,GAAGS,KAAK6d,GAAK7d,KAAK2d,IAChCvQ,EAAIpN,KAAK4d,GAAKxQ,GAAGpN,KAAK8d,GAAK9d,KAAK4d,KAG1B5d,KAAK8N,UAAWvO,EAAIS,KAAK0xC,GAAItkC,EAAIpN,KAAK2xC,KAW9CtkC,IAAK,SAAUsQ,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAEvC,GAAW,OAAPF,EACJ,CACC,MAAMN,EAAIK,EACVA,EAAKL,EAAEK,GAAIC,EAAKN,EAAEM,GAClBC,EAAKP,EAAEO,GAAIC,EAAKR,EAAEQ,GAWnB,OARA9d,KAAK0xC,IAAM/zB,EAAKE,GAAM,EACtB7d,KAAK2xC,IAAM/zB,EAAKE,GAAM,EAEtB9d,KAAK2d,GAAKA,EACV3d,KAAK4d,GAAKA,EACV5d,KAAK6d,GAAKA,EACV7d,KAAK8d,GAAKA,EAEH9d,MAWR2N,OAAQ,SAAUgQ,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAE1C,GAAW,OAAPF,EACJ,CACC,MAAMN,EAAIK,EACVA,EAAKL,EAAEK,GAAIC,EAAKN,EAAEM,GAClBC,EAAKP,EAAEO,GAAIC,EAAKR,EAAEQ,GAGnB,OAAOH,GAAM3d,KAAK2d,IAAME,GAAM7d,KAAK6d,IAAMD,GAAM5d,KAAK4d,IAAME,GAAM9d,KAAK8d,IAWtEi0B,SAAU,SAAUp0B,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAE5C,GAAW,OAAPF,EACJ,CACC,MAAMN,EAAIK,EACVA,EAAKL,EAAEK,GAAIC,EAAKN,EAAEM,GAClBC,EAAKP,EAAEO,GAAIC,EAAKR,EAAEQ,GAGnB,OAAQH,GAAM/W,KAAKswB,IAAIl3B,KAAK2d,GAAIA,IAASC,GAAMhX,KAAKswB,IAAIl3B,KAAK4d,GAAIA,IAASC,GAAMjX,KAAKC,IAAI7G,KAAK6d,GAAIA,IAASC,GAAMlX,KAAKC,IAAI7G,KAAK8d,GAAIA,IAWpIk0B,WAAY,SAAUr0B,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAE9C,GAAW,OAAPF,EACJ,CACC,MAAMN,EAAIK,EACVA,EAAKL,EAAEK,GAAIC,EAAKN,EAAEM,GAClBC,EAAKP,EAAEO,GAAIC,EAAKR,EAAEQ,GAQnB,OALA9d,KAAK2d,GAAK/W,KAAKC,IAAI7G,KAAK2d,GAAIA,GAC5B3d,KAAK4d,GAAKhX,KAAKC,IAAI7G,KAAK4d,GAAIA,GAC5B5d,KAAK6d,GAAKjX,KAAKswB,IAAIl3B,KAAK6d,GAAIA,GAC5B7d,KAAK8d,GAAKlX,KAAKswB,IAAIl3B,KAAK8d,GAAIA,GAErB9d,MAWRiyC,WAAY,SAAUt0B,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAE9C,GAAW,OAAPF,EACJ,CACC,MAAMN,EAAIK,EACVA,EAAKL,EAAEK,GAAIC,EAAKN,EAAEM,GAClBC,EAAKP,EAAEO,GAAIC,EAAKR,EAAEQ,GAGnB,IAAIo0B,EAAMtrC,KAAKswB,IAAIl3B,KAAK2d,GAAIA,GACxBw0B,EAAMvrC,KAAKswB,IAAIl3B,KAAK4d,GAAIA,GACxBw0B,EAAMxrC,KAAKC,IAAI7G,KAAK6d,GAAIA,GACxBw0B,EAAMzrC,KAAKC,IAAI7G,KAAK8d,GAAIA,GAE5B,OAAOlX,KAAKswB,IAAI,EAAGmb,EAAIF,GAAOvrC,KAAKswB,IAAI,EAAGkb,EAAIF,GAAO,GAatDI,kBAAmB,SAAU30B,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAErD,GAAW,OAAPF,EACJ,CACC,MAAMN,EAAIK,EACVA,EAAKL,EAAEK,GAAIC,EAAKN,EAAEM,GAClBC,EAAKP,EAAEO,GAAIC,EAAKR,EAAEQ,GAQnB,OALA9d,KAAK2d,GAAK/W,KAAKswB,IAAIl3B,KAAK2d,GAAIA,GAC5B3d,KAAK4d,GAAKhX,KAAKswB,IAAIl3B,KAAK4d,GAAIA,GAC5B5d,KAAK6d,GAAKjX,KAAKC,IAAI7G,KAAK6d,GAAIA,GAC5B7d,KAAK8d,GAAKlX,KAAKC,IAAI7G,KAAK8d,GAAIA,GAErBlX,KAAKswB,IAAI,EAAGl3B,KAAK8d,GAAG9d,KAAK4d,IAAMhX,KAAKswB,IAAI,EAAGl3B,KAAK6d,GAAG7d,KAAK2d,IAAM,GAStEvC,OAAQ,SAAUmB,EAAGC,EAAG+1B,GAAgB,EAAOpP,GAAW,GAqBzD,OAnBkB,GAAdA,IAEH5mB,GAAMvc,KAAK6d,GAAK7d,KAAK2d,GACrBnB,GAAMxc,KAAK8d,GAAK9d,KAAK4d,IAGC,GAAnB20B,GAEHvyC,KAAK6d,GAAK7d,KAAK2d,GAAKpB,EACpBvc,KAAK8d,GAAK9d,KAAK4d,GAAKpB,IAIpBD,GAAK,EAAGC,GAAK,EAEbxc,KAAK2d,GAAK3d,KAAK0xC,GAAKn1B,EAAGvc,KAAK4d,GAAK5d,KAAK2xC,GAAKn1B,EAC3Cxc,KAAK6d,GAAK7d,KAAK0xC,GAAKn1B,EAAGvc,KAAK8d,GAAK9d,KAAK2xC,GAAKn1B,GAGrCxc,MAQRwyC,SAAU,SAAU7zB,EAAIC,EAAI2zB,GAAgB,GAe3C,OAbuB,GAAnBA,GAEHvyC,KAAK6d,IAAMc,EACX3e,KAAK8d,IAAMc,IAIXD,GAAM,EAAGC,GAAM,EAEf5e,KAAK2d,IAAMgB,EAAI3e,KAAK4d,IAAMgB,EAC1B5e,KAAK6d,IAAMc,EAAI3e,KAAK8d,IAAMc,GAGpB5e,MAORoZ,MAAO,WAEN,OAAOpZ,KAAK6d,GAAK7d,KAAK2d,IAOvBtE,OAAQ,WAEP,OAAOrZ,KAAK8d,GAAK9d,KAAK4d,IAOvB60B,IAAK,WAEJ,OAAQzyC,KAAK0xC,GAAK1xC,KAAK2d,KAAO3d,KAAK6d,GAAK7d,KAAK2d,KAO9C+0B,IAAK,WAEJ,OAAQ1yC,KAAK2xC,GAAK3xC,KAAK4d,KAAO5d,KAAK8d,GAAK9d,KAAK4d,KAO9C+0B,QAAS,WAER,OAAO3yC,KAAK2d,IAAM3d,KAAK6d,IAAM7d,KAAK4d,IAAM5d,KAAK8d,IAQ9C80B,cAAe,SAAUrzC,EAAG6N,EAAGylC,EAAI,GAElC,OAAQ7yC,KAAK2d,GAAGk1B,GAAOtzC,GAAKA,GAAKS,KAAK6d,GAAGg1B,GAAS7yC,KAAK4d,GAAGi1B,GAAOzlC,GAAKA,GAAKpN,KAAK8d,GAAG+0B,GAQpFC,KAAM,SAAUC,GAEf,OAAOA,EAAU/yC,KAAK2yC,WAAa3yC,KAAK8d,GAAG9d,KAAK4d,KAAK5d,KAAK6d,GAAG7d,KAAK2d,IAAM,GAAO3d,KAAK8d,GAAG9d,KAAK4d,KAAK5d,KAAK6d,GAAG7d,KAAK2d,KAO/GlP,MAAO,WAQN,OANAzO,KAAK2d,GAAK/W,KAAK6H,MAAMzO,KAAK2d,IAC1B3d,KAAK4d,GAAKhX,KAAK6H,MAAMzO,KAAK4d,IAC1B5d,KAAK6d,GAAKjX,KAAK6H,MAAMzO,KAAK6d,IAC1B7d,KAAK8d,GAAKlX,KAAK6H,MAAMzO,KAAK8d,IAC1B9d,KAAK0xC,GAAK9qC,KAAK6H,MAAMzO,KAAK0xC,IAC1B1xC,KAAK2xC,GAAK/qC,KAAK6H,MAAMzO,KAAK2xC,IACnB3xC,MAOR6hC,KAAM,WAQL,OANA7hC,KAAK2d,GAAK/W,KAAKi7B,KAAK7hC,KAAK2d,IACzB3d,KAAK4d,GAAKhX,KAAKi7B,KAAK7hC,KAAK4d,IACzB5d,KAAK6d,GAAKjX,KAAKi7B,KAAK7hC,KAAK6d,IACzB7d,KAAK8d,GAAKlX,KAAKi7B,KAAK7hC,KAAK8d,IACzB9d,KAAK0xC,GAAK9qC,KAAKi7B,KAAK7hC,KAAK0xC,IACzB1xC,KAAK2xC,GAAK/qC,KAAKi7B,KAAK7hC,KAAK2xC,IAClB3xC,MAORmP,SAAU,WAET,MAAO,IAAMnP,KAAK2d,GAAGnV,QAAQ,GAAK,KAAOxI,KAAK4d,GAAGpV,QAAQ,GAAK,KAAOxI,KAAK6d,GAAGrV,QAAQ,GAAK,KAAOxI,KAAK8d,GAAGtV,QAAQ,GAAK,KAOvHwqC,QAAS,WAER,MAAO,CAAChzC,KAAK2d,GAAI3d,KAAK4d,GAAI5d,KAAK6d,GAAI7d,KAAK8d,KAOzCm1B,UAAW,SAAUlmB,GAGpB,OADA/sB,KAAKqN,IAAK0f,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,IACvB/sB;;;iBAsBTsF;EAASqD,WAAY8oC,GAAM,KAAM,UACjCyB,GAAezB;kBC3ff;MAAM0B,GAAYzzC,EAAMC,OACvB,CACAiG,UAAW,YAMXssB,EAAG,KAMH9kB,EAAG,KAMH0O,EAAG,KAOH/b,OAAQ,SAAUT,EAAM,GAEvBU,KAAK2J,MAAMrK,IAQZqK,MAAO,SAAUrK,EAAM,GAMtB,OAJAU,KAAKkyB,EAAI,CAAC,GACVlyB,KAAKoN,EAAI,CAAC9N,GACVU,KAAK8b,EAAI,CAAC,MAEH9b,MAWRozC,SAAU,SAAU1pB,EAAK2pB,EAAIC,GAM5B,GAJAtzC,KAAKkyB,EAAI,GACTlyB,KAAKoN,EAAI,GACTpN,KAAK8b,EAAI,GAEC,MAANu3B,GAAoB,MAANC,EAClB,CACC,IAAK,IAAIpzC,EAAI,EAAGA,EAAIwpB,EAAIwI,EAAE/xB,OAAQD,IAEjCF,KAAKkyB,EAAEprB,KAAK4iB,EAAIwI,EAAEhyB,IAClBF,KAAKoN,EAAEtG,KAAK4iB,EAAItc,EAAElN,IAClBF,KAAK8b,EAAEhV,KAAK4iB,EAAI5N,EAAE5b,IAGnB,OAAOF,KAGE,MAANqzC,IAAYA,EAAK3pB,EAAIwI,EAAE,IACjB,MAANohB,IAAYA,EAAK5pB,EAAIwI,EAAExI,EAAIwI,EAAE/xB,OAAO,IAEpCkzC,EAAK3pB,EAAIwI,EAAE,KAAImhB,EAAK3pB,EAAIwI,EAAE,IAE9B,IAAIqhB,EAAK7pB,EAAIze,KAAKooC,GACdzjC,EAAK8Z,EAAIze,KAAKqoC,GAElB,GAAU,MAANC,EAAY,OAAO,KACvB,GAAU,MAAN3jC,EAAY,OAAO,KAEnB8Z,EAAIwI,EAAEqhB,IAAOF,IAChBrzC,KAAKqN,IAAIgmC,EAAI3pB,EAAIxf,MAAMmpC,GAAK3pB,EAAI5N,EAAEy3B,IAClCA,KAGD,IAAK,IAAIrzC,EAAIqzC,EAAIrzC,GAAK0P,EAAI1P,IACzBF,KAAKqN,IAAIqc,EAAIwI,EAAEhyB,GAAIwpB,EAAItc,EAAElN,GAAIwpB,EAAI5N,EAAE5b,IAEpC,GAAIwpB,EAAIwI,EAAEtiB,IAAO0jC,EACjB,CACC,IAAI3hB,GAAM2hB,EAAK5pB,EAAIwI,EAAEtiB,IAAOhJ,KAAKi7B,KAAKj7B,KAAK0B,IAAIgrC,EAAK5pB,EAAIwI,EAAEtiB,KACtDsiB,EAAIlyB,KAAKkyB,EAAElyB,KAAKkyB,EAAE/xB,OAAO,GAI7B,IAFIwxB,GAAM,IAAGA,EAAK,GACrBA,EAAK2hB,EAAGphB,EACEA,GAAKohB,GAEPphB,EAAEP,EAAK2hB,IACV3hB,EAAK2hB,EAAKphB,GAEXA,GAAKP,EACL3xB,KAAKqN,IAAImoB,OAAOtD,GAAIxI,EAAIxf,MAAMgoB,GAAIxI,EAAI5N,EAAElM,IAI1C,OAAO5P,MASR4J,MAAO,SAAUypC,EAAIC,GAEpB,OAAQ,IAAIH,IAAaC,SAASpzC,KAAMqzC,EAAIC,IAQ7CrlB,QAAS,SAAUd,EAAM,GAExB,OAAOntB,KAAKkyB,EAAElyB,KAAKkyB,EAAE/xB,OAAO,GAAKgtB,GAQlCvhB,UAAW,SAAUuhB,EAAM,GAE1B,OAAOntB,KAAKkyB,EAAE,GAAK/E,GASpBliB,KAAM,SAAUiW,GAEf,GAAIA,EAAOlhB,KAAKkyB,EAAE,GACjB,OAAO,KAER,MAAMvrB,EAAI3G,KAAKkyB,EAAE/xB,OAEjB,IAAK,IAAID,EAAI,EAAGA,EAAIyG,EAAGzG,IAEtB,GAAIghB,EAAOlhB,KAAKkyB,EAAEhyB,GACjB,OAAOA,EAAE,EAGX,OAAOyG,EAAE,GAUV0G,IAAK,SAAU6kB,EAAG9kB,EAAG0O,EAAE,MAEtB,IAAI5b,EAAIF,KAAKiL,KAAKinB,GAClB,OAAS,MAALhyB,IAEAF,KAAKkyB,EAAEhyB,IAAMgyB,GAEhBlyB,KAAKoN,EAAElN,GAAKkN,EACH,MAAL0O,IAAW9b,KAAK8b,EAAE5b,GAAK4b,KAI3B5b,IACAF,KAAKkyB,EAAEhJ,OAAOhpB,EAAG,EAAGgyB,GACpBlyB,KAAKoN,EAAE8b,OAAOhpB,EAAG,EAAGkN,GACpBpN,KAAK8b,EAAEoN,OAAOhpB,EAAG,EAAG4b,KAGd,IAOR3I,IAAK,WAEJ,OAAOnT,KAAKoN,EAAEpN,KAAKoN,EAAEjN,OAAO,IAQ7B+J,MAAO,SAAUgoB,GAEhB,IAAIqhB,EAAKvzC,KAAKiL,KAAKinB,GACnB,GAAU,MAANqhB,EAAY,OAAO,EAEvB,IAAI3jC,EAAK2jC,EAAK,EAEd,GAAIvzC,KAAKkyB,EAAEqhB,IAAOrhB,GAAKtiB,GAAM5P,KAAKkyB,EAAE/xB,QAAUH,KAAKoN,EAAEmmC,IAAOvzC,KAAKoN,EAAEwC,IAAqB,MAAd5P,KAAK8b,EAAEy3B,GAChF,OAAOvzC,KAAKoN,EAAEmmC,GAEf,GAAkB,MAAdvzC,KAAK8b,EAAEy3B,GACV,OAAOvzC,KAAKoN,EAAEmmC,GAEf,IAAIh0C,EAAI2yB,EACJshB,EAAKxzC,KAAKkyB,EAAEqhB,GACZ51B,EAAK3d,KAAKkyB,EAAEtiB,GACZ6jC,EAAKzzC,KAAKoN,EAAEmmC,GACZ31B,EAAK5d,KAAKoN,EAAEwC,GAKhB,OAHAsiB,GAAK3yB,EAAIi0C,IAAO71B,EAAK61B,IACrBthB,EAAIlyB,KAAK8b,EAAEy3B,GAAIrhB,IAENtU,GAAM,EAAEsU,GAAGuhB,GAWrBC,SAAU,SAAUL,EAAG,KAAMC,EAAG,KAAMK,EAAG,GAE9B,MAANN,IAAYA,EAAKrzC,KAAKkyB,EAAE,IAClB,MAANohB,IAAYA,EAAKtzC,KAAKkyB,EAAElyB,KAAKkyB,EAAE/xB,OAAO,IAEtCkzC,EAAKrzC,KAAKkyB,EAAE,KAAImhB,EAAKrzC,KAAKkyB,EAAE,IAEhC,IAAIhjB,EAAO,EAEX,GAAImkC,EAAKC,EAAI,CACZ,IAAIjjB,EAAKA,EAAMgjB,EAAIA,EAAKC,EAAIA,EAAKjjB,EACjCnhB,GAAO,EAGR,IAAI0kC,EAAQD,EAEZ,IAAK,IAAIzyB,EAAOmyB,EAAInyB,EAAOoyB,GAC3B,CACC,IAAIC,EAAKvzC,KAAKiL,KAAKiW,GACnB,GAAU,MAANqyB,EAAY,OAAO,EAEvB,IAAI3jC,EAAK2jC,EAAK,EAEVC,EAAK5sC,KAAKswB,IAAIl3B,KAAKkyB,EAAEqhB,GAAKryB,GAC1BvD,EAAK/W,KAAKC,IAAI+I,EAAK5P,KAAKkyB,EAAE/xB,OAASH,KAAKkyB,EAAEtiB,GAAM0jC,EAAIA,GAEpDG,EAAKzzC,KAAKkK,MAAMspC,GAGhBzlC,EAAK4P,EAAK61B,EACVxlC,EAHKhO,KAAKkK,MAAMyT,GAGN81B,EAEI,MAAdzzC,KAAK8b,EAAEy3B,GACVK,GAASH,EAAG1lC,EAEZ6lC,GAAS,GAAI5lC,GAAI2P,EAAG61B,GAAMA,EAAGxlC,EAAKylC,EAAG1lC,EAEtCmT,GAAQnT,EAGT,OAAOmB,EAAK0kC,GAWbC,gBAAiB,SAAUR,EAAG,KAAMC,EAAG,KAAMK,EAAG,GAErC,MAANN,IAAYA,EAAKrzC,KAAKkyB,EAAE,IAClB,MAANohB,IAAYA,EAAKtzC,KAAKkyB,EAAElyB,KAAKkyB,EAAE/xB,OAAO,IAE1C,IAAI+G,EAAKisC,GAAUW,MAAMV,SAASpzC,KAAMA,KAAKkyB,EAAE,GAAImhB,GAAIU,UAAUJ,GAAID,WAGrE,OAFSP,GAAUa,MAAMZ,SAASpzC,KAAMA,KAAKkyB,EAAE,GAAIohB,GAAIS,UAAUJ,GAAID,WAEzDxsC,GAUb6sC,UAAW,SAAUJ,EAAG,GAEvB,IAAIvmC,EAAI,GAERA,EAAEtG,KAAK6sC,GAEP,IAAK,IAAIzzC,EAAI,EAAGA,EAAIF,KAAKkyB,EAAE/xB,OAAQD,IAClCkN,EAAEtG,KAAKsG,EAAElN,EAAE,GAAKF,KAAK0zC,SAAS1zC,KAAKkyB,EAAEhyB,EAAE,GAAIF,KAAKkyB,EAAEhyB,KAGnD,OADAF,KAAKoN,EAAIA,EACFpN,MAQRi0C,WAAY,SAAUN,EAAG,GAExB3zC,KAAKoN,EAAE,IAAMumC,EAEb,IAAK,IAAIzzC,EAAI,EAAGA,EAAIF,KAAKkyB,EAAE/xB,OAAQD,IAClCF,KAAKoN,EAAElN,IAAMF,KAAKoN,EAAElN,EAAE,GAEvB,OAAOF,MAORk0C,SAAU,SAAUh0C,GAMnB,OAJAF,KAAKkyB,EAAEhJ,OAAO,EAAGhpB,GACjBF,KAAK8b,EAAEoN,OAAO,EAAGhpB,GACjBF,KAAKoN,EAAE8b,OAAO,EAAGhpB,GAEVF,MAORm0C,UAAW,SAAUj0C,GAMpB,OAJAF,KAAKkyB,EAAEhJ,OAAOhpB,EAAE,EAAGF,KAAKkyB,EAAE/xB,OAAOD,EAAE,GACnCF,KAAK8b,EAAEoN,OAAOhpB,EAAE,EAAGF,KAAK8b,EAAE3b,OAAOD,EAAE,GACnCF,KAAKoN,EAAE8b,OAAOhpB,EAAE,EAAGF,KAAKoN,EAAEjN,OAAOD,EAAE,GAE5BF,MAQRkV,IAAK,SAAUpK,GAEd,IAAK,IAAI5K,EAAI,EAAGA,EAAIF,KAAKoN,EAAEjN,OAAQD,IAClCF,KAAKoN,EAAElN,GAAK4K,EAAI9K,KAAKoN,EAAElN,GAAIF,KAAKkyB,EAAEhyB,GAAIA,GAEvC,OAAOF,MAORmP,SAAU,SAASwkC,EAAG,GAErB,IAAI3gB,EAAI,GACJohB,EAAI,GAER,MAAMC,EAAM,SAAU/0C,EAAOqH,EAAG6xB,GAO/B,IALAl5B,EAAQA,EAAM6P,WAEF,MAARqpB,IAAcA,EAAO,KACzBA,EAAOA,EAAK,GAELl5B,EAAMa,OAASwG,GACrBrH,GAASk5B,EAEV,OAAOl5B,GAGR0zB,GAAK,KACLA,GAAKqhB,EAAI,QAASD,GAAK,IAAMC,EAAI,SAAUD,GAAK,IAAMC,EAAI,YAAaD,GAAK,KAC5EphB,GAAKqhB,EAAI,GAAID,EAAG,KAAO,IAAMC,EAAI,GAAID,EAAG,KAAO,IAAMC,EAAI,GAAID,EAAG,KAAO,KAEvE,IAAK,IAAIl0C,EAAI,EAAGA,EAAIF,KAAKkyB,EAAE/xB,OAAQD,IAElC8yB,GAAKqhB,EAAI,IAAI7e,OAAOx1B,KAAKkyB,EAAEhyB,IAAKk0C,GAAK,IAAMC,EAAI,IAAI7e,OAAOx1B,KAAKoN,EAAElN,IAAKk0C,GAAK,IAAMC,EAAI,IAAI7e,OAAOx1B,KAAK0zC,SAAS1zC,KAAKkyB,EAAE,GAAIlyB,KAAKkyB,EAAEhyB,GAAIyzC,IAAMS,GAAK,KAGhJ,OAAOphB,KAITmgB,GAAUW,MAAQ,IAAIX,GACtBA,GAAUa,MAAQ,IAAIb,OAEtBmB,GAAenB;;;eCzZf;MAAMoB,GAAS70C,EAAMC,OACpB,CACAiG,UAAW,SAOX4uC,GAAI,EAAGC,GAAI,EAOXl1C,EAAG,EAAG6N,EAAG,EAcTrN,OAAQ,SAAUR,EAAE,KAAM6N,EAAE,MAE3B,OAAOpN,KAAKqN,IAAI9N,EAAG6N,IAMpB2qB,UAAW,WAIV,OAFA/3B,KAAKT,EAAIw4B,UAAU/3B,KAAKw0C,IACxBx0C,KAAKoN,EAAI2qB,UAAU/3B,KAAKy0C,IACjBz0C,MAOR4J,MAAO,WAEN,OAAO2qC,GAAO3rC,KAAK3B,MAAMjH,OAiB1BqN,IAAK,SAAU9N,EAAG6N,EAAE,KAAMsnC,GAAS,GA0BlC,OAxBU,OAANn1C,GACHA,EAAI,EACJ6N,EAAI,GAEU,OAANA,EAEJmnC,GAAOjqC,WAAW/K,IACrB6N,EAAI7N,EAAEk1C,GACNl1C,EAAIA,EAAEi1C,KAENpnC,EAAI0qB,QAAQv4B,EAAE6N,GACd7N,EAAIu4B,QAAQv4B,EAAEA,IAIVm1C,IACJn1C,EAAIu4B,QAAQv4B,GACZ6N,EAAI0qB,QAAQ1qB,IAIdpN,KAAKw0C,GAAKj1C,EACVS,KAAKy0C,GAAKrnC,EAEHpN,KAAK+3B,UAAU/3B,OAOvBuN,KAAM,SAAUhO,GAGf,OADAS,KAAKw0C,GAAK1c,QAAQv4B,GACXS,KAAK+3B,UAAU/3B,OAOvBwN,KAAM,SAAUJ,GAGf,OADApN,KAAKy0C,GAAK3c,QAAQ1qB,GACXpN,KAAK+3B,UAAU/3B,OAOvByN,KAAM,WAEL,OAAOzN,KAAKqN,IAAI,EAAG,IAOpBK,OAAQ,WAEP,OAAiB,GAAV1N,KAAKT,GAAoB,GAAVS,KAAKoN,GAe5BO,OAAQ,SAAUpO,EAAG6N,EAAE,MAiBtB,OAfU,OAANA,EAECmnC,GAAOjqC,WAAW/K,IACrB6N,EAAI7N,EAAE6N,EACN7N,EAAIA,EAAEA,IAEN6N,EAAItH,IAAIvG,EAAE6N,GACV7N,EAAIuG,IAAIvG,EAAEA,KAIXA,EAAIuG,IAAIvG,GACR6N,EAAItH,IAAIsH,IAGFpN,KAAKT,GAAKA,GAAKS,KAAKoN,GAAKA,GAgBjCiB,IAAK,SAAUN,EAAIC,EAAG,KAAM0mC,GAAS,GAoBpC,OAlBW,OAAP1mC,EAECumC,GAAOjqC,WAAWyD,IACrBC,EAAKD,EAAG0mC,GACR1mC,EAAKA,EAAGymC,KAERxmC,EAAK8pB,QAAQ/pB,EAAGX,GAChBW,EAAK+pB,QAAQ/pB,EAAGxO,IAIZm1C,IACJ3mC,EAAK+pB,QAAQ/pB,GACbC,EAAK8pB,QAAQ9pB,IAIfhO,KAAKw0C,IAAMzmC,EAAI/N,KAAKy0C,IAAMzmC,EACnBhO,KAAK+3B,aAgBbzpB,IAAK,SAAUP,EAAIC,EAAI0mC,GAAS,GAoB/B,OAlBW,OAAP1mC,EAECumC,GAAOjqC,WAAWyD,IACrBC,EAAKD,EAAG0mC,GACR1mC,EAAKA,EAAGymC,KAERxmC,EAAK8pB,QAAQ/pB,EAAGX,GAChBW,EAAK+pB,QAAQ/pB,EAAGxO,IAIZm1C,IACJ3mC,EAAK+pB,QAAQ/pB,GACbC,EAAK8pB,QAAQ9pB,IAIfhO,KAAKw0C,IAAMzmC,EAAI/N,KAAKy0C,IAAMzmC,EACnBhO,KAAK+3B,aAOb5oB,SAAU,WAET,MAAO,IAAInP,KAAKT,MAAMS,KAAKoN;;;iBAsB7B9H;EAASqD,WAAY4rC,GAAQ,KAAM,UACnCI,GAAeJ;;;;gBCzQf;MAAMK,GAAUl1C,EAAMC,OACrB,CACAiG,UAAW,UAUX8rC,GAAI,EAIJC,GAAI,EAIJh0B,GAAI,EAIJC,GAAI,EAIJC,GAAI,EAIJC,GAAI,EAKJ+2B,IAAK,EAAGC,IAAK,EACbC,IAAK,EAAGC,IAAK,EACbC,IAAK,EAAGC,IAAK,EAiBbn1C,OAAQ,SAAU4d,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAM42B,GAAS,GAE9D,OAAW,OAAP/2B,GAEH3d,KAAK+0C,IAAM/0C,KAAKg1C,IAAMh1C,KAAKi1C,IAAMj1C,KAAKk1C,IAAMl1C,KAAK60C,IAAM70C,KAAK80C,IAAM,EAC3D90C,KAAK+3B,aAGF,OAAPna,GAAsB,OAAPC,EACX7d,KAAKqN,IAAI,EAAG,EAAG,EAAG,GAAG+N,OAAOuC,EAAIC,GAEjC5d,KAAKqN,IAAIsQ,EAAIC,EAAIC,EAAIC,EAAI42B,IAMjC3c,UAAW,WASV,OAPA/3B,KAAK2d,GAAKoa,UAAU/3B,KAAK+0C,KACzB/0C,KAAK4d,GAAKma,UAAU/3B,KAAKg1C,KACzBh1C,KAAK6d,GAAKka,UAAU/3B,KAAKi1C,KACzBj1C,KAAK8d,GAAKia,UAAU/3B,KAAKk1C,KACzBl1C,KAAK0xC,GAAK3Z,UAAU/3B,KAAK60C,KACzB70C,KAAK2xC,GAAK5Z,UAAU/3B,KAAK80C,KAElB90C,MAORm1C,MAAO,WASN,OAPAn1C,KAAK+0C,IAAMjd,QAAQ93B,KAAK2d,IACxB3d,KAAKg1C,IAAMld,QAAQ93B,KAAK4d,IACxB5d,KAAKi1C,IAAMnd,QAAQ93B,KAAK6d,IACxB7d,KAAKk1C,IAAMpd,QAAQ93B,KAAK8d,IACxB9d,KAAK60C,IAAM/c,QAAQ93B,KAAK0xC,IACxB1xC,KAAK80C,IAAMhd,QAAQ93B,KAAK2xC,IAEjB3xC,MAOR4J,MAAO,WAEN,OAAOgrC,GAAQhsC,KAAK3B,MAAMjH,KAAK+0C,IAAK/0C,KAAKg1C,IAAKh1C,KAAKi1C,IAAKj1C,KAAKk1C,KAAK,IAOnEznC,KAAM,WAML,OAJAzN,KAAK+0C,IAAM,EAAG/0C,KAAKg1C,IAAM,EACzBh1C,KAAKi1C,IAAM,EAAGj1C,KAAKk1C,IAAM,EACzBl1C,KAAK60C,IAAM,EAAG70C,KAAK80C,IAAM,EAElB90C,KAAK+3B,aAObpuB,MAAO,WAUN,OARA3J,KAAK+0C,IAAM,KAAM/0C,KAAKg1C,IAAM,KAC5Bh1C,KAAKi1C,IAAM,KAAMj1C,KAAKk1C,IAAM,KAC5Bl1C,KAAK60C,IAAM,KAAM70C,KAAK80C,IAAM,KAE5B90C,KAAK2d,GAAK,KAAM3d,KAAK4d,GAAK,KAC1B5d,KAAK6d,GAAK,KAAM7d,KAAK8d,GAAK,KAC1B9d,KAAK0xC,GAAK,KAAM1xC,KAAK2xC,GAAK,KAEnB3xC,MAeR8N,UAAW,SAAUC,EAAIC,EAAG,KAAM0mC,GAAS,GAuB1C,OArBW,OAAP1mC,EAEC2mC,GAAOrqC,WAAWyD,IACrBC,EAAKD,EAAG0mC,GACR1mC,EAAKA,EAAGymC,KAERxmC,EAAK8pB,QAAQ/pB,EAAGX,GAChBW,EAAK+pB,QAAQ/pB,EAAGxO,IAIZm1C,IACJ3mC,EAAK+pB,QAAQ/pB,GACbC,EAAK8pB,QAAQ9pB,IAIfhO,KAAK+0C,KAAOhnC,EAAI/N,KAAKg1C,KAAOhnC,EAC5BhO,KAAKi1C,KAAOlnC,EAAI/N,KAAKk1C,KAAOlnC,EAC5BhO,KAAK60C,KAAO9mC,EAAI/N,KAAK80C,KAAO9mC,EAErBhO,KAAK+3B,aAUb1qB,IAAK,SAAUsQ,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAM42B,GAAS,GAkCtD,OAhCW,OAAP92B,EAECg3B,GAAQtqC,WAAWqT,IACtBG,EAAKH,EAAGu3B,IACRr3B,EAAKF,EAAGs3B,IACRr3B,EAAKD,EAAGq3B,IACRr3B,EAAKA,EAAGo3B,MAERj3B,EAAKga,QAAQna,EAAGG,IAChBD,EAAKia,QAAQna,EAAGE,IAChBD,EAAKka,QAAQna,EAAGC,IAChBD,EAAKma,QAAQna,EAAGA,KAKZ+2B,IACJ/2B,EAAKma,QAAQna,GACbC,EAAKka,QAAQla,GACbC,EAAKia,QAAQja,GACbC,EAAKga,QAAQha,IAIf9d,KAAK+0C,IAAMp3B,EACX3d,KAAKg1C,IAAMp3B,EACX5d,KAAKi1C,IAAMp3B,EACX7d,KAAKk1C,IAAMp3B,EAEX9d,KAAK60C,IAAOl3B,EAAKE,GAAO,EACxB7d,KAAK80C,IAAOl3B,EAAKE,GAAO,EAEjB9d,KAAK+3B,aAUb1pB,IAAK,SAAUsP,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAM42B,GAAS,GAkCtD,OAhCW,OAAP92B,EAECg3B,GAAQtqC,WAAWqT,IACtBG,EAAKH,EAAGu3B,IACRr3B,EAAKF,EAAGs3B,IACRr3B,EAAKD,EAAGq3B,IACRr3B,EAAKA,EAAGo3B,MAERj3B,EAAKga,QAAQna,EAAGG,IAChBD,EAAKia,QAAQna,EAAGE,IAChBD,EAAKka,QAAQna,EAAGC,IAChBD,EAAKma,QAAQna,EAAGA,KAKZ+2B,IACJ/2B,EAAKma,QAAQna,GACbC,EAAKka,QAAQla,GACbC,EAAKia,QAAQja,GACbC,EAAKga,QAAQha,IAIf9d,KAAK+0C,KAAOp3B,EACZ3d,KAAKg1C,KAAOp3B,EACZ5d,KAAKi1C,KAAOp3B,EACZ7d,KAAKk1C,KAAOp3B,EAEZ9d,KAAK60C,KAAQl3B,EAAKE,GAAO,EACzB7d,KAAK80C,KAAQl3B,EAAKE,GAAO,EAElB9d,KAAK+3B,aAUbpqB,OAAQ,SAAUgQ,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAwB1C,OAtBW,OAAPF,EAECg3B,GAAQtqC,WAAWqT,IACtBG,EAAKH,EAAGG,GACRD,EAAKF,EAAGE,GACRD,EAAKD,EAAGC,GACRD,EAAKA,EAAGA,KAERG,EAAKhY,IAAI6X,EAAGG,IACZD,EAAK/X,IAAI6X,EAAGE,IACZD,EAAK9X,IAAI6X,EAAGC,IACZD,EAAK7X,IAAI6X,EAAGA,MAKbA,EAAK7X,IAAI6X,GACTC,EAAK9X,IAAI8X,GACTC,EAAK/X,IAAI+X,GACTC,EAAKhY,IAAIgY,IAGHH,GAAM3d,KAAK2d,IAAME,GAAM7d,KAAK6d,IAAMD,GAAM5d,KAAK4d,IAAME,GAAM9d,KAAK8d,IAUtEi0B,SAAU,SAAUp0B,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAwB5C,OAtBW,OAAPF,EAECg3B,GAAQtqC,WAAWqT,IACtBG,EAAKH,EAAGG,GACRD,EAAKF,EAAGE,GACRD,EAAKD,EAAGC,GACRD,EAAKA,EAAGA,KAERG,EAAKhY,IAAI6X,EAAGG,IACZD,EAAK/X,IAAI6X,EAAGE,IACZD,EAAK9X,IAAI6X,EAAGC,IACZD,EAAK7X,IAAI6X,EAAGA,MAKbA,EAAK7X,IAAI6X,GACTC,EAAK9X,IAAI8X,GACTC,EAAK/X,IAAI+X,GACTC,EAAKhY,IAAIgY,IAGFH,GAAM/W,KAAKswB,IAAIl3B,KAAK2d,GAAIA,IAASC,GAAMhX,KAAKswB,IAAIl3B,KAAK4d,GAAIA,IAASC,GAAMjX,KAAKC,IAAI7G,KAAK6d,GAAIA,IAASC,GAAMlX,KAAKC,IAAI7G,KAAK8d,GAAIA,IAapIk0B,WAAY,SAAUr0B,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAE9C,GAAW,OAAPF,EACJ,CACC,GAAIg3B,GAAQtqC,WAAWqT,GAItB,OAFA3d,KAAKgyC,WAAWr0B,EAAGo3B,IAAKp3B,EAAGq3B,KAAK,GAChCh1C,KAAKgyC,WAAWr0B,EAAGs3B,IAAKt3B,EAAGu3B,KAAK,GACzBl1C,KAEH,GAAIkzC,GAAK5oC,WAAWqT,GAIxB,OAFA3d,KAAKgyC,WAAWr0B,EAAGA,GAAIA,EAAGC,IAC1B5d,KAAKgyC,WAAWr0B,EAAGE,GAAIF,EAAGG,IACnB9d,KAEC20C,GAAOrqC,WAAWqT,IAE1BC,EAAKD,EAAG82B,GACR92B,EAAKA,EAAG62B,KAIR52B,EAAKka,QAAQna,EAAGvQ,GAChBuQ,EAAKma,QAAQna,EAAGpe,QAIlB,CACC,GAAW,OAAPue,EAIH,OAFA9d,KAAKgyC,WAAWr0B,EAAIC,GACpB5d,KAAKgyC,WAAWn0B,EAAIC,GACb9d,MAII,IAAP6d,IAEHF,EAAKma,QAAQna,GACbC,EAAKka,QAAQla,IAahB,OARiB,OAAb5d,KAAK+0C,KAAgBp3B,EAAK3d,KAAK+0C,OAAK/0C,KAAK+0C,IAAMp3B,IAClC,OAAb3d,KAAKg1C,KAAgBp3B,EAAK5d,KAAKg1C,OAAKh1C,KAAKg1C,IAAMp3B,IAClC,OAAb5d,KAAKi1C,KAAgBt3B,EAAK3d,KAAKi1C,OAAKj1C,KAAKi1C,IAAMt3B,IAClC,OAAb3d,KAAKk1C,KAAgBt3B,EAAK5d,KAAKk1C,OAAKl1C,KAAKk1C,IAAMt3B,GAEnD5d,KAAK60C,IAAO70C,KAAK+0C,IAAM/0C,KAAKi1C,KAAQ,EACpCj1C,KAAK80C,IAAO90C,KAAKg1C,IAAMh1C,KAAKk1C,KAAQ,EAE7Bl1C,KAAK+3B,aAUbka,WAAY,SAAUt0B,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAEnC,OAAPF,EAECg3B,GAAQtqC,WAAWqT,IACtBG,EAAKH,EAAGG,GACRD,EAAKF,EAAGE,GACRD,EAAKD,EAAGC,GACRD,EAAKA,EAAGA,KAERG,EAAKhY,IAAI6X,EAAGG,IACZD,EAAK/X,IAAI6X,EAAGE,IACZD,EAAK9X,IAAI6X,EAAGC,IACZD,EAAK7X,IAAI6X,EAAGA,MAKbA,EAAK7X,IAAI6X,GACTC,EAAK9X,IAAI8X,GACTC,EAAK/X,IAAI+X,GACTC,EAAKhY,IAAIgY,IAGV,IAAIo0B,EAAMtrC,KAAKswB,IAAIl3B,KAAK2d,GAAIA,GACxBw0B,EAAMvrC,KAAKswB,IAAIl3B,KAAK4d,GAAIA,GACxBw0B,EAAMxrC,KAAKC,IAAI7G,KAAK6d,GAAIA,GACxBw0B,EAAMzrC,KAAKC,IAAI7G,KAAK8d,GAAIA,GAE5B,OAAOlX,KAAKswB,IAAI,EAAGmb,EAAIF,GAAOvrC,KAAKswB,IAAI,EAAGkb,EAAIF,GAAO,GAUtDI,kBAAmB,SAAU30B,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAkCrD,OAhCW,OAAPF,EAECg3B,GAAQtqC,WAAWqT,IACtBG,EAAKH,EAAGG,GACRD,EAAKF,EAAGE,GACRD,EAAKD,EAAGC,GACRD,EAAKA,EAAGA,KAERG,EAAKhY,IAAI6X,EAAGG,IACZD,EAAK/X,IAAI6X,EAAGE,IACZD,EAAK9X,IAAI6X,EAAGC,IACZD,EAAK7X,IAAI6X,EAAGA,MAKbA,EAAK7X,IAAI6X,GACTC,EAAK9X,IAAI8X,GACTC,EAAK/X,IAAI+X,GACTC,EAAKhY,IAAIgY,IAGV9d,KAAK+0C,IAAMjd,QAAQlxB,KAAKswB,IAAIl3B,KAAK2d,GAAIA,IACrC3d,KAAKg1C,IAAMld,QAAQlxB,KAAKswB,IAAIl3B,KAAK4d,GAAIA,IACrC5d,KAAKi1C,IAAMnd,QAAQlxB,KAAKC,IAAI7G,KAAK6d,GAAIA,IACrC7d,KAAKk1C,IAAMpd,QAAQlxB,KAAKC,IAAI7G,KAAK8d,GAAIA,IAErC9d,KAAK60C,IAAO70C,KAAK+0C,IAAM/0C,KAAKi1C,KAAQ,EACpCj1C,KAAK80C,IAAO90C,KAAKg1C,IAAMh1C,KAAKk1C,KAAQ,EAEpCl1C,KAAK+3B,YAEEnxB,KAAKswB,IAAI,EAAGl3B,KAAKk1C,IAAIl1C,KAAKg1C,KAAOpuC,KAAKswB,IAAI,EAAGl3B,KAAKi1C,IAAIj1C,KAAK+0C,KAAO,GAQ1E35B,OAAQ,SAAUhC,EAAOC,EAAQk5B,GAAgB,GAqBhD,OAnBAn5B,EAAkB,OAAVA,EAAiB0e,QAAQ1e,GAAUpZ,KAAKi1C,IAAMj1C,KAAK+0C,IAC3D17B,EAAoB,OAAXA,EAAkBye,QAAQze,GAAWrZ,KAAKk1C,IAAMl1C,KAAKg1C,KAEtC,IAApBzC,GAEHvyC,KAAKi1C,IAAMj1C,KAAK+0C,IAAM37B,EACtBpZ,KAAKk1C,IAAMl1C,KAAKg1C,IAAM37B,EAEtBrZ,KAAK60C,IAAO70C,KAAK+0C,IAAM/0C,KAAKi1C,KAAQ,EACpCj1C,KAAK80C,IAAO90C,KAAKg1C,IAAMh1C,KAAKk1C,KAAQ,IAIpC97B,IAAU,EAAGC,IAAW,EAExBrZ,KAAK+0C,IAAM/0C,KAAK60C,IAAMz7B,EAAOpZ,KAAKg1C,IAAMh1C,KAAK80C,IAAMz7B,EACnDrZ,KAAKi1C,IAAMj1C,KAAK60C,IAAMz7B,EAAOpZ,KAAKk1C,IAAMl1C,KAAK80C,IAAMz7B,GAG7CrZ,KAAK+3B,aAQbya,SAAU,SAAU4C,EAAQC,EAAS9C,GAAgB,GAqBpD,OAnBA6C,EAAStd,QAAQsd,GACjBC,EAAUvd,QAAQud,IAEM,IAApB9C,GAEHvyC,KAAKi1C,KAAOG,EACZp1C,KAAKk1C,KAAOG,EAEZr1C,KAAK60C,IAAO70C,KAAK+0C,IAAM/0C,KAAKi1C,KAAQ,EACpCj1C,KAAK80C,IAAO90C,KAAKg1C,IAAMh1C,KAAKk1C,KAAQ,IAIpCE,IAAW,EAAGC,IAAY,EAE1Br1C,KAAK+0C,KAAOK,EAAQp1C,KAAKg1C,KAAOK,EAChCr1C,KAAKi1C,KAAOG,EAAQp1C,KAAKk1C,KAAOG,GAG1Br1C,KAAK+3B,aAOb3e,MAAO,WAEN,OAAOpZ,KAAK6d,GAAK7d,KAAK2d,IAOvBtE,OAAQ,WAEP,OAAOrZ,KAAK8d,GAAK9d,KAAK4d,IAOvB03B,UAAW,WAEV,OAAOt1C,KAAK+0C,KAAO/0C,KAAKi1C,KAAOj1C,KAAKg1C,KAAOh1C,KAAKk1C,KAOjDtC,cAAe,SAAUrzC,EAAG6N,EAAGylC,EAAI,GAMlC,OAJAtzC,EAAIu4B,QAAQv4B,GACZ6N,EAAI0qB,QAAQ1qB,GACZylC,EAAM/a,QAAQ+a,GAEN7yC,KAAK+0C,IAAIlC,GAAOtzC,GAAKA,GAAKS,KAAKi1C,IAAIpC,GAAS7yC,KAAKg1C,IAAInC,GAAOzlC,GAAKA,GAAKpN,KAAKk1C,IAAIrC,GAOxFC,KAAM,SAAUC,GAAO,GAEtB,OAAOA,EAAU/yC,KAAKs1C,aAAet1C,KAAK8d,GAAG9d,KAAK4d,KAAK5d,KAAK6d,GAAG7d,KAAK2d,IAAM,GAAO3d,KAAK8d,GAAG9d,KAAK4d,KAAK5d,KAAK6d,GAAG7d,KAAK2d,KAOjHxO,SAAU,WAET,MAAO,IAAMnP,KAAK2d,GAAK,KAAO3d,KAAK4d,GAAK,KAAO5d,KAAK6d,GAAK,KAAO7d,KAAK8d,GAAK,KAO3Ek1B,QAAS,WAER,MAAO,CAAChzC,KAAK+0C,IAAK/0C,KAAKg1C,IAAKh1C,KAAKi1C,IAAKj1C,KAAKk1C,MAO5CjC,UAAW,SAAU1zC,GAUpB,OARAS,KAAK+0C,IAAMx1C,EAAE,GACbS,KAAKg1C,IAAMz1C,EAAE,GACbS,KAAKi1C,IAAM11C,EAAE,GACbS,KAAKk1C,IAAM31C,EAAE,GAEbS,KAAK60C,IAAO70C,KAAK+0C,IAAM/0C,KAAKi1C,KAAQ,EACpCj1C,KAAK80C,IAAO90C,KAAKg1C,IAAMh1C,KAAKk1C,KAAQ,EAE7Bl1C,KAAK+3B;;;iBAcdzyB;EAASqD,WAAYisC,GAAS,KAAM,UACpCW,GAAeX;mBCvoBf;MAAMY,GACN;AAGCC,OACA,CAICC,GAAI,SAAUxjB,GAEb,OAAOA,GAMRyjB,IAAK,SAAUzjB,GAEd,OAAOA,GAMR0jB,OAAQ,SAAU1jB,GAEjB,OAAOA;;;AAOT2jB,KACA,CACCnW,EAAG,QAKHgW,GAAI,SAAUxjB,EAAGwN,EAAE,MAGlB,OADU,OAANA,IAAYA,EAAI8V,GAAOK,KAAKnW,GACzBxN,EAAEA,IAAIwN,EAAE,GAAGxN,EAAIwN,IAMvBiW,IAAK,SAAUzjB,EAAGwN,EAAE,MAEnB,OAAO,EAAI8V,GAAOK,KAAKH,GAAG,EAAIxjB,EAAGwN,IAMlCkW,OAAQ,SAAU1jB,EAAGwN,EAAE,MAEtB,OAAIxN,EAAI,GACAsjB,GAAOK,KAAKH,GAAK,EAAFxjB,EAAKwN,GAAG,EAEvB8V,GAAOK,KAAKF,IAAY,GAAPzjB,EAAE,IAAQwN,GAAG,EAAI;;;AAO5CoW,OACA,CACCC,SAAU,SAAU7jB,GAEnB,OAAIA,EAAI,EAAI,KACJ,OAASA,EAAIA,EACZA,EAAI,EAAI,KACT,QAAUA,GAAK,IAAI,MAAMA,EAAI,IAC5BA,EAAI,IAAI,KACT,QAAUA,GAAK,KAAM,MAAQA,EAAI,MAElC,QAAUA,GAAK,MAAM,MAAQA,EAAI,SAMzCwjB,GAAI,SAAUxjB,GAEb,OAAO,EAAIsjB,GAAOM,OAAOC,SAAS,EAAE7jB,IAMrCyjB,IAAK,SAAUzjB,GAEd,OAAOsjB,GAAOM,OAAOC,SAAS7jB,IAM/B0jB,OAAQ,SAAU1jB,GAEjB,OAAIA,EAAI,IACC,EAAIsjB,GAAOM,OAAOC,SAAS,EAAE,EAAE7jB,IAAI,EAEnCsjB,GAAOM,OAAOC,SAAiB,GAAP7jB,EAAE,KAAQ,EAAG;;;AAOhD8jB,KACA,CAICN,GAAI,SAAUxjB,GAEb,OAAO,EAAItrB,KAAKkI,KAAK,EAAIojB,EAAEA,IAM5ByjB,IAAK,SAAUzjB,GAEd,OAAO,EAAIsjB,GAAOQ,KAAKN,GAAG,EAAIxjB,IAM/B0jB,OAAQ,SAAU1jB,GAEjB,OAAIA,EAAI,GACCsjB,GAAOQ,KAAKN,GAAK,EAAFxjB,GAAK,EAEpBsjB,GAAOQ,KAAKL,IAAY,GAAPzjB,EAAE,KAAQ,EAAI;;;AAO1C+jB,MACA,CAICP,GAAI,SAAUxjB,GAEb,OAAOA,EAAEA,EAAEA,GAMZyjB,IAAK,SAAUzjB,GAEd,OAAO,EAAIsjB,GAAOS,MAAMP,GAAG,EAAIxjB,IAMhC0jB,OAAQ,SAAU1jB,GAEjB,OAAIA,EAAI,GACAsjB,GAAOS,MAAMP,GAAK,EAAFxjB,GAAK,EAErBsjB,GAAOS,MAAMN,IAAY,GAAPzjB,EAAE,KAAQ,EAAI;;;AAO1CgkB,KACA,CAICR,GAAI,SAAUxjB,GAEb,OAAOtrB,KAAK4yB,IAAI,EAAG,IAAItH,EAAE,KAM1ByjB,IAAK,SAAUzjB,GAEd,OAA6B,EAArBtrB,KAAK4yB,IAAI,GAAG,GAAItH,IAMzB0jB,OAAQ,SAAU1jB,GAEjB,OAAKA,GAAK,GAAK,EACPtrB,KAAK4yB,IAAK,EAAG,IAAMtH,EAAI,IAAM,GAEG,EAA9BtrB,KAAK4yB,IAAK,GAAG,IAAOtH,EAAI,KAAW;;;AAO/CikB,MACA,CAICT,GAAI,SAAUxjB,EAAGlD,EAAE,IAElB,OAAOpoB,KAAK4yB,IAAItH,EAAGlD,IAMpB2mB,IAAK,SAAUzjB,EAAGlD,EAAE,IAEnB,OAAO,EAAIwmB,GAAOW,MAAMT,GAAG,EAAIxjB,EAAGlD,IAMnC4mB,OAAQ,SAAU1jB,EAAGlD,EAAE,IAEtB,OAAIkD,EAAI,GACAsjB,GAAOW,MAAMT,GAAK,EAAFxjB,EAAKlD,GAAG,EAExBwmB,GAAOW,MAAMR,IAAY,GAAPzjB,EAAE,IAAQlD,GAAG,EAAI;;;AAO7ConB,KACA,CAICV,GAAI,SAAUxjB,GAEb,OAAOA,EAAEA,GAMVyjB,IAAK,SAAUzjB,GAEd,OAAO,EAAIsjB,GAAOY,KAAKV,GAAG,EAAIxjB,IAM/B0jB,OAAQ,SAAU1jB,GAEjB,OAAIA,EAAI,GACAsjB,GAAOY,KAAKV,GAAK,EAAFxjB,GAAK,EAEpBsjB,GAAOY,KAAKT,IAAY,GAAPzjB,EAAE,KAAQ,EAAI;;;AAOzCmkB,QACA,CAICX,GAAI,SAAUxjB,GAEb,OAAOA,EAAEA,EAAEA,EAAEA,GAMdyjB,IAAK,SAAUzjB,GAEd,OAAO,EAAIsjB,GAAOa,QAAQX,GAAG,EAAIxjB,IAMlC0jB,OAAQ,SAAU1jB,GAEjB,OAAIA,EAAI,GACAsjB,GAAOa,QAAQX,GAAK,EAAFxjB,GAAK,EAEvBsjB,GAAOa,QAAQV,IAAY,GAAPzjB,EAAE,KAAQ,EAAI;;;AAO5CokB,QACA,CAICZ,GAAI,SAAUxjB,GAEb,OAAOA,EAAEA,EAAEA,EAAEA,EAAEA,GAMhByjB,IAAK,SAAUzjB,GAEd,OAAO,EAAIsjB,GAAOc,QAAQZ,GAAG,EAAIxjB,IAMlC0jB,OAAQ,SAAU1jB,GAEjB,OAAIA,EAAI,GACCsjB,GAAOc,QAAQZ,GAAK,EAAFxjB,GAAK,EAEvBsjB,GAAOc,QAAQX,IAAY,GAAPzjB,EAAE,KAAQ,EAAI;;;AAO7CqkB,KACA,CAICb,GAAI,SAAUxjB,GAEb,OAAO,EAAItrB,KAAKwH,IAAK,QAAU,EAAI8jB,KAMpCyjB,IAAK,SAAUzjB,GAEd,OAAOtrB,KAAKwH,IAAK,OAAS8jB,IAM3B0jB,OAAQ,SAAU1jB,GAEjB,OAAQtrB,KAAKuH,IAAK,OAAO+jB,GAAK,IAAK;;;AAOrCskB,KACA,CAICd,GAAI,SAAUxjB,GAEb,OAAY,GAALA,EAAW,EAAI,GAMvByjB,IAAK,SAAUzjB,GAEd,OAAY,GAALA,EAAW,EAAI,GAMvB0jB,OAAQ,SAAU1jB,GAEjB,OAAY,GAALA,EAAW,EAAI,SAKzBukB,GAAejB;;aCnZf;MAAMkB,GACN,CACCC,QAAS,IAAIhH,GAMb7D,SAAU,SAAU8K,GAEnB,OAAO52C,KAAK22C,QAAQtoC,IAAIuoC,IAOzB3K,WAAY,SAAU2K,GAErB52C,KAAK22C,QAAQtsC,OAAOusC,GACpB52C,KAAK22C,QAAQzG,WAOd2G,QAAS,SAAUpU,EAAiB,MAEnCziC,KAAK22C,QAAQtG,cAAa,CAACnQ,EAAE5iB,MAA+B,IAAnB4iB,EAAE4W,UAAUx5B,IAAcA,MAAQmlB,IAO5EsU,SAAU,SAAUtU,EAAiB,MAEpCziC,KAAK22C,QAAQK,iBAAiB,CAAC9W,EAAE5iB,MAAgC,IAApB4iB,EAAE+W,WAAW35B,IAAcA,MAAQmlB;;;mBASlFiU;GAAKQ,OAASx3C,EAAMC,OACnB,CACAiG,UAAW,SAMXmqC,SAAU,EAEVhwC,OAAQ,WAEP22C,GAAK5K,SAAS9rC,OAGfgI,OAAQ,WAEP0uC,GAAKzK,WAAWjsC,OAOjB82C,UAAW,SAAU7tC,KAQrBguC,WAAY,SAAUhuC;;AAQvBkuC,GAAeT;YCvFf;MAAMU,GACN,CAICjT,aAAa,EAMb9Z,YAAa,EAMbC,aAAc,EAMdb,SAAU,KAMVvI,KAAM,EAMNyQ,GAAI,EAKJ0lB,SAAU,KAKVC,UAAW,KAKXC,MAAO,KAMPhnB,OAAQ,KAMRnH,KAAM,KAMNouB,SAAU,KAMVC,UAAW,KAKXz+B,QACA,CAIC7H,IAAI,EAKJ7I,KAAK,EAKLkR,WAAW,EAKXL,WAAY,UAKZ+Q,YAAa,YAKbG,YAAa,KAKbC,aAAc,KAKdH,IAAK,IAKLC,OAAQ,GAMR3jB,aAAa,GAWdmB,KAAM,SAAUoR,GAEf,OAAO,IAAIkb,SAAS,CAACC,EAASC,KAE7B,GAAIp0B,KAAKmkC,YACR,OAAOhQ,IAERgS,OAAOC,OAAOpmC,KAAKgZ,QAASA,GAE5BiyB,GAAUxJ,OAAQ,CAAE6E,WAAYtmC,KAAKgZ,QAAQQ,UAAWtO,OAAQlL,KAAKgZ,QAAQQ,UAAY,SAAW,YACpGgQ,EAAO5hB,KAAM5H,KAAKgZ,SAElBwQ,EAAO4H,eACN,CACAb,OAAQ,SAASoB,GAEhBylB,GAAOl2B,KAAOsI,EAAOyC,UACrBmrB,GAAOzlB,GAAKA,EAEZylB,GAAOC,SAASnG,KAAKvf,GACrBylB,GAAOE,UAAUpG,KAAKvf,GACtBylB,GAAOG,MAAMrG,KAAKvf,GAElBylB,GAAO7mB,OAAO2gB,KAAKvf,MAIrBnI,EAAO+H,aACN,CACAnI,KAAM,SAAS3F,GAEd2zB,GAAOhuB,KAAK8nB,KAAKztB,MAInB0zB,GAAKN,SAAQ,WAEZrtB,EAAOhd,QAEP4qC,GAAO/sB,YAAcb,EAAOa,YAC5B+sB,GAAO9sB,aAAed,EAAOc,aAC7B8sB,GAAO3tB,SAAWD,EAAOC,SAEzB2tB,GAAOC,SAAW7F,GAAQ5oC,KAAK3B,QAC/BmwC,GAAOE,UAAY9F,GAAQ5oC,KAAK3B,QAChCmwC,GAAOG,MAAQ/F,GAAQ5oC,KAAK3B,QAE5BmwC,GAAO7mB,OAASihB,GAAQ5oC,KAAK3B,QAC7BmwC,GAAOhuB,KAAOooB,GAAQ5oC,KAAK3B,QAE3BywC,OAAOC,OAAS,WACfP,GAAOlnB,OAAM,IAGdwnB,OAAOtN,QAAU,WAChBgN,GAAOjnB,QAAO,IAGfinB,GAAOjT,aAAc,EAErBhQ,WASHjE,MAAO,SAAU0nB,GAAkB,GAEV,OAApBR,GAAOI,UACVJ,GAAOI,SAASI,IAOlBznB,OAAQ,SAAUynB,GAAkB,GAEV,OAArBR,GAAOK,WACVL,GAAOK,UAAUG,IAOnBhrC,QAAS,SAAUklB,EAAUrmB,EAAUklC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAE5E9wC,KAAKq3C,SAAShpC,IAAIrO,KAAK63C,eAAgB/lB,EAAUrmB,EAAUklC,EAAMC,EAAMC,EAAMC,IAG9E+G,eAAgB,SAAUlmB,EAAIlK,EAAGhc,EAAUklC,EAAMC,EAAMC,EAAMC,GAG5D,OADA9wC,KAAK2wC,MAAQhf,EACT3xB,KAAK2wC,KAAO,IAEhBllC,EAAUklC,EAAMC,EAAMC,EAAMC,IACrB,IAORtlC,SAAU,SAAUssC,EAAQrsC,EAAUklC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAEhE7wC,KAAKs3C,UAAUjpC,IAAIrO,KAAK+3C,gBAAiB,EAAGD,EAAQrsC,EAAUklC,EAAMC,EAAMC,IAG3EkH,gBAAiB,SAAUpmB,EAAIqmB,EAAIC,EAAIxsC,EAAUklC,EAAMC,EAAMC,GAG5D,OADA7wC,KAAK2wC,MAAQhf,EACT3xB,KAAK2wC,KAAO3wC,KAAK4wC,OAErB5wC,KAAK2wC,MAAQ3wC,KAAK4wC,KACXnlC,EAAUklC,EAAMC,EAAMC,KAO9BqH,KAAM,SAAUpmB,EAAUrmB,EAAUklC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAE9D7wC,KAAKu3C,MAAMlpC,IAAIrO,KAAKm4C,YAAa,EAAGrmB,EAAUrmB,EAAUklC,EAAMC,EAAMC,IAGrEsH,YAAa,SAAUxmB,EAAIqmB,EAAIC,EAAIxsC,EAAUklC,EAAMC,EAAMC,GAKxD,OAHA7wC,KAAK2wC,MAAQhf,EACT3xB,KAAK2wC,KAAO3wC,KAAK4wC,OAAM5wC,KAAK2wC,KAAO3wC,KAAK4wC,OAEa,IAArDnlC,EAAUzL,KAAK2wC,KAAK3wC,KAAK4wC,KAAMD,EAAMC,EAAMC,IAGxC7wC,KAAK2wC,OAAS3wC,KAAK4wC,WAI5BwH,GAAehB;cC5Rf;MAAMiB,GAAQ34C,EAAMC,OACnB,CACAiG,UAAW,aAEX0yC,SAAU,KAEVtuC,OAAO,EACPuuC,SAAS,EACTr3B,KAAM,EAMNtZ,KAAM,WAIL,OAFA5H,KAAKs4C,SAAWjtC,EAAKzC,KAAK3B,QAC1BjH,KAAK2J,MAAM,GACJ3J,MAGRgI,OAAQ,WAEPhI,KAAKkJ,QACLlJ,KAAKs4C,SAASzwC,QAOfwG,IAAK,SAAS89B,GAGb,OADAnsC,KAAKs4C,SAASxxC,KAAKqlC,GACZA,GAORviC,MAAO,WAEN,IAAI4uC,EAAQH,GAAMpxC,QAElB,IAAK,IAAI8kC,EAAO/rC,KAAKs4C,SAAS7uC,IAAc,OAATsiC,EAAeA,EAAOA,EAAK9iC,KAC7DuvC,EAAMF,SAASxxC,KAAKilC,EAAKzsC,MAAMsK,SAEhC,OAAO4uC,GAORtvC,MAAO,WAKN,OAHAlJ,KAAKs4C,SAASpvC,QACdlJ,KAAK2J,MAAM,GAEJ3J,MAOR2J,MAAO,SAAUuX,EAAK,GAMrB,OAJAlhB,KAAKgK,OAAQ,EACbhK,KAAKu4C,QAAU,KACfv4C,KAAKkhB,KAAOA,EAELlhB,MAORy4C,QAAS,WAGR,OADAz4C,KAAKgK,OAAQ,EACNhK,MAOR04C,WAAY,WAQX,OANmB,IAAf14C,KAAKgK,QAERhK,KAAKu4C,QAAUv4C,KAAKs4C,SAAS7uC,IAC7BzJ,KAAKgK,OAAQ,GAGU,OAAjBhK,KAAKu4C,SAObhoB,OAAQ,SAAUsS,GAEjB,MAAQ7iC,KAAK04C,cACb,CACC,IAAIp7B,EAAItd,KAAKu4C,QAAQj5C,MAAMixB,OAAOsS,EAAM7iC,MACxC,IAAU,IAANsd,EAAY,OAAOA,EAEvBtd,KAAKu4C,QAAUv4C,KAAKu4C,QAAQtvC,KAG7B,OAAO,KAcT3D,EAASC,SAAS8yC,GAAO,UACzBM,GAAeN;gBClIf;MAAMO,GAAUl5C,EAAMC,OACrB,CACAiG,UAAW,eAKXizC,GAAI,KAKJC,SAAS,EAKTC,MAAO,KAKPz5C,MAAO,KAKPwyB,SAAU,EAAGknB,UAAW,EAKxBhnB,MAAO,EAAGinB,OAAQ,EAKlBC,WAAY,EAAGC,YAAa,EAK5BC,SAAU,EAAGC,UAAW,EAKxBtnB,OAAQ,KAERunB,KAAM,KACNC,MAAO,KAKPf,MAAO,KAKPgB,OAAQ,KAKRC,MAAO,KAKPrN,IAAK,KAKLthC,GAAI,KAMJlD,KAAM,SAAUixC,EAAIa,GAenB,OAbA15C,KAAK64C,GAAKA,EACV74C,KAAK84C,SAAU,EAEf94C,KAAKw4C,MAAQ,KACbx4C,KAAKw5C,OAAS,KAEdx5C,KAAKy5C,MAAQ,KACbz5C,KAAKosC,IAAM,KACXpsC,KAAK8K,GAAK,MAEO,IAAb4uC,GACHb,EAAGjxC,KAAK5H,MAAM,GAERA,MAGRgI,OAAQ,WAEY,OAAfhI,KAAKw4C,OAAgBx4C,KAAKw4C,MAAMtvC,QAAQrB,OACxB,OAAhB7H,KAAKw5C,QAAiBx5C,KAAKw5C,OAAOtwC,QAAQrB,QAG/C+B,MAAO,WAEN,IAAIuiC,EAAMyM,GAAQ3xC,MAAMjH,KAAK64C,IAAI,GAgBjC,GAdC1M,EAAI4M,MAAQ/4C,KAAK+4C,MACjB5M,EAAI7sC,MAAQU,KAAKV,MACjB6sC,EAAIra,SAAW9xB,KAAK8xB,SACpBqa,EAAIna,MAAQhyB,KAAKgyB,MACjBma,EAAI+M,WAAal5C,KAAKk5C,WACtB/M,EAAIiN,SAAWp5C,KAAKo5C,SACpBjN,EAAIpa,OAAS/xB,KAAK+xB,OACnBoa,EAAIsN,MAAQz5C,KAAKy5C,MACjBtN,EAAIC,IAAMpsC,KAAKosC,IACfD,EAAIrhC,GAAK9K,KAAK8K,GAEK,OAAf9K,KAAKw4C,QACRrM,EAAIqM,MAAQx4C,KAAKw4C,MAAM5uC,SAEJ,OAAhB5J,KAAKw5C,OACT,CACCrN,EAAIqN,OAASnuC,EAAKzC,KAAK3B,QAEvB,IAAK,IAAI8kC,EAAO/rC,KAAKw5C,OAAO/vC,IAAc,OAATsiC,EAAeA,EAAOA,EAAK9iC,KAC3DkjC,EAAIqN,OAAO1yC,KAAKilC,EAAKzsC,MAAMsK,SAG7B,OAAOuiC,GAORwN,MAAO,WAEN35C,KAAK64C,GAAGjxC,KAAK5H,MAAM,IAOpBuwB,OAAQ,SAASsS,EAAM2V,GAEtB,OAAOx4C,KAAK64C,GAAGtoB,OAAOsS,EAAM2V,EAAOx4C,SAcrCsF,EAASC,SAASqzC,QAClBgB,GAAehB,GCvKfiB,GACA,CACCjyC,KAAM,SAASukC,EAAK2N,GAAS,GAE5B,IAAKA,EAIJ,OAFA3N,EAAIqM,MAAQG,GAAM1xC,aAClBklC,EAAIqN,OAASnuC,EAAKzC,KAAK3B,SAIxB,IAAI/G,EAEJ,KAA2C,OAAnCA,EAAIisC,EAAIqM,MAAMF,SAAS5tC,UAC/B,CACC,IAAI8tC,EAAQG,GAAM1xC,QAClBuxC,EAAMnqC,IAAInO,GACVisC,EAAIqN,OAAO1yC,KAAK0xC,GAGjBrM,EAAIqM,MAAM3wC,OACVskC,EAAIqM,MAAQ,MAGbjoB,OAAQ,SAAUsS,EAAM2V,EAAOrM,GAE9B,IAAoB,IAAhBA,EAAI2M,QACR,CACC,IAAK,IAAI54C,EAAIisC,EAAIqN,OAAO/vC,IAAW,OAANvJ,EAAYA,EAAIA,EAAE+I,KAE9C/I,EAAEZ,MAAMqK,MAAO6uC,EAAMt3B,MAGtBirB,EAAI2M,SAAU,EAGf,IAAI53B,EAAOs3B,EAAMt3B,KACbva,EAAI,EAAGu5B,EAAI,EAEf,IAAK,IAAIhgC,EAAIisC,EAAIqN,OAAO/vC,IAAW,OAANvJ,EAAYA,EAAIA,EAAE+I,KAC/C,CACC,IAAIqU,EAAIpd,EAAEZ,MAAMixB,OAAOsS,IACb,IAANvlB,EAAY3W,IAAoB,OAAN2W,GAAY4iB,IAEtChgC,EAAEZ,MAAM4hB,KAAOA,IAClBA,EAAOhhB,EAAEZ,MAAM4hB,MAGjB,OAAKva,EAAEu5B,GAAMiM,EAAIqN,OAAOr5C,SAGxBgsC,EAAI2M,SAAU,EACdN,EAAMt3B,KAAOA,GAEN,KCvDT64B,GACA,CACCnyC,KAAM,SAASukC,EAAK2N,GAAS,GAEvBA,IACJ3N,EAAIqM,MAAQG,GAAM1xC,UAGpBspB,OAAQ,SAASsS,EAAM2V,EAAOrM,IAET,IAAhBA,EAAI2M,UAEP3M,EAAIqM,MAAM7uC,MAAO6uC,EAAMt3B,MACvBirB,EAAI2M,SAAU,GAGf,IAAIx7B,EAAI6uB,EAAIqM,MAAMjoB,OAAOsS,GACzB,OAAU,IAANvlB,EAAmBA,GAEvB6uB,EAAI2M,SAAU,EACdN,EAAMt3B,KAAOirB,EAAIqM,MAAMt3B,MAChB,KCrBT84B,GACA,CACCpyC,KAAM,SAASukC,EAAK2N,GAAS,GAEvBA,IACJ3N,EAAIqM,MAAQG,GAAM1xC,UAGpBspB,OAAQ,SAASsS,EAAM2V,EAAOrM,IAET,IAAhBA,EAAI2M,UAEP3M,EAAIqM,MAAM7uC,MAAO6uC,EAAMt3B,MACvBirB,EAAI8M,OAAS9M,EAAIna,MAEjBma,EAAI2M,SAAU,GAGf,IAAIx7B,EAAI6uB,EAAIqM,MAAMjoB,OAAOsS,GACzB,OAAU,IAANvlB,EAAmBA,EAEnB6uB,EAAI8M,QAAU,GAEjB9M,EAAI2M,SAAU,EACdN,EAAMt3B,KAAOirB,EAAIqM,MAAMt3B,MAChB,IAGRirB,EAAIqM,MAAMC,UACVtM,EAAI8M,UACG,KChCTgB,GACA,CACCryC,KAAM,SAASukC,EAAK2N,GAAS,KAI7BvpB,OAAQ,SAASsS,EAAM2V,EAAOrM,GAG7B,OADAtJ,EAAKqX,SAAS/N,EAAI4M,MAAOlW,EAAKsX,SAAShO,EAAI4M,MAAO5M,EAAI7sC,SAC/C,ICTT86C,GACA,CACCxyC,KAAM,SAASukC,EAAK2N,GAAS,KAI7BvpB,OAAQ,SAASsS,EAAM2V,EAAOrM,GAG7B,OADAqM,EAAMC,WACC,ICPT4B,GACA,CACCzyC,KAAM,SAASukC,EAAK2N,GAAS,KAI7BvpB,OAAQ,SAASsS,EAAM2V,EAAOrM,GAQ7B,OANoB,IAAhBA,EAAI2M,UAEP3M,EAAI6M,UAA0C,WAA9BnvC,EAAKywC,OAAOnO,EAAIra,UAAyB+Q,EAAKsX,SAAShO,EAAIra,UAAYqa,EAAIra,SAC3Fqa,EAAI2M,SAAU,KAGXjW,EAAK3hB,KAAOs3B,EAAMt3B,KAAOirB,EAAI6M,aAGjC7M,EAAI2M,SAAU,EACdN,EAAMt3B,MAAQirB,EAAI6M,WACX,KCnBTuB,GACA,CACC3yC,KAAM,SAASukC,EAAK2N,GAAS,KAI7BvpB,OAAQ,SAASsS,EAAM2V,EAAOrM,IAET,IAAhBA,EAAI2M,UAEP3M,EAAIgN,YAActW,EAAKsX,SAAShO,EAAI4M,MAAO5M,EAAI+M,YAC/C/M,EAAI6M,UAA0C,WAA9BnvC,EAAKywC,OAAOnO,EAAIra,UAAyB+Q,EAAKsX,SAAShO,EAAIra,UAAYqa,EAAIra,SAE3Fqa,EAAI2M,SAAU,GAGf3M,EAAIkN,UAAYxW,EAAKsX,SAAShO,EAAI4M,MAAO5M,EAAIiN,SAAUjN,EAAIgN,aAE3D,IAAIjnB,EAAI,EAUR,OARI2Q,EAAK3hB,KAAOs3B,EAAMt3B,KAAOirB,EAAI6M,YAChC9mB,GAAK2Q,EAAK3hB,KAAOs3B,EAAMt3B,MAAQirB,EAAI6M,WAEhC7M,EAAIpa,QAAe,GAALG,EACjB2Q,EAAKqX,SAAS/N,EAAI4M,MAAO5M,EAAIpa,OAAOG,IAAIia,EAAIkN,UAAYlN,EAAIgN,aAAehN,EAAIgN,aAE/EtW,EAAKqX,SAAS/N,EAAI4M,MAAO7mB,GAAGia,EAAIkN,UAAYlN,EAAIgN,aAAehN,EAAIgN,aAE3D,GAALjnB,IAGJia,EAAI2M,SAAU,EACdN,EAAMt3B,MAAQirB,EAAI6M,WAEX,KClCTwB,GACA,CACC5yC,KAAM,SAASukC,EAAK2N,GAAS,KAI7BvpB,OAAQ,SAASsS,EAAM2V,EAAOrM,IAET,IAAhBA,EAAI2M,UAEP3M,EAAI6M,UAA0C,WAA9BnvC,EAAKywC,OAAOnO,EAAIra,UAAyB+Q,EAAKsX,SAAShO,EAAIra,UAAYqa,EAAIra,SAC3Fqa,EAAIoN,MAAQ,KAEZpN,EAAI2M,SAAU,GAGf,IAAI5mB,EAAI,EAUR,GARI2Q,EAAK3hB,KAAOs3B,EAAMt3B,KAAOirB,EAAI6M,YAChC9mB,GAAK2Q,EAAK3hB,KAAOs3B,EAAMt3B,MAAQirB,EAAI6M,WAEhC7M,EAAIpa,QAAe,GAALG,EACjBia,EAAImN,KAAOxzC,IAAIqmC,EAAIpa,OAAOG,GAAGia,EAAIna,OAEjCma,EAAImN,KAAOxzC,IAAIosB,EAAEia,EAAIna,OAElBma,EAAImN,MAAQnN,EAAIoN,MACpB,CACC,IAAIhhB,EAAMsK,EAAKsX,SAAShO,EAAI4M,OAE5B,OAAa,CAEZ,GADQjzC,IAAIc,KAAKoiB,UAAUmjB,EAAIiN,SAAWjN,EAAI+M,WAAa,IAAM/M,EAAI+M,YAC5D3gB,EAAK,MAGfsK,EAAKqX,SAAS/N,EAAI4M,MAAO74C,GACzBisC,EAAIoN,MAAQpN,EAAImN,KAGjB,OAAS,GAALpnB,IAGJia,EAAI2M,SAAU,EACdN,EAAMt3B,MAAQirB,EAAI6M,WAEX,KC7CTyB,GACA,CACC7yC,KAAM,SAASukC,EAAK2N,GAAS,GAE5B,IAAKA,EAAU,OAEf,IAAIL,EAAQ,GAEZ,IAAK,IAAIv5C,EAAI,EAAGA,EAAIisC,EAAIna,MAAO9xB,IAC9Bu5C,EAAM3yC,KAAO5G,GAAKisC,EAAIiN,SAAWjN,EAAI+M,WAAa,GAAM/M,EAAI+M,YAE7D,IAAK,IAAItpC,EAAIu8B,EAAIna,OAAS,EAAGpiB,EAAI,EAAGA,IACpC,CACC,IAAIvP,EAAIyF,IAAIc,KAAKoiB,SAAWmjB,EAAIna,OAC5B1xB,EAAIwF,IAAIc,KAAKoiB,SAAWmjB,EAAIna,OAE5BzxB,EAAIk5C,EAAMn5C,GACdm5C,EAAMn5C,GAAKm5C,EAAMp5C,GACjBo5C,EAAMp5C,GAAKE,EAGZ4rC,EAAIsN,MAAQA,GAGblpB,OAAQ,SAASsS,EAAM2V,EAAOrM,IAET,IAAhBA,EAAI2M,UAEP3M,EAAI6M,UAA0C,WAA9BnvC,EAAKywC,OAAOnO,EAAIra,UAAyB+Q,EAAKsX,SAAShO,EAAIra,UAAYqa,EAAIra,SAC3Fqa,EAAI2M,SAAU,GAGf,IACI54C,EADAgyB,EAAI,EAaR,OAVI2Q,EAAK3hB,KAAOs3B,EAAMt3B,KAAOirB,EAAI6M,YAChC9mB,GAAK2Q,EAAK3hB,KAAOs3B,EAAMt3B,MAAQirB,EAAI6M,WAGnC94C,EADGisC,EAAIpa,QAAe,GAALG,EACbia,EAAIpa,OAAOG,IAAIia,EAAIna,MAAM,GAEzBE,GAAGia,EAAIna,MAAM,GAElB6Q,EAAKqX,SAAS/N,EAAI4M,MAAO5M,EAAIsN,MAAM3zC,KAAK5F,EAAIisC,EAAIna,OAASma,EAAIna,SAEpD,GAALE,IAGJia,EAAI2M,SAAU,EACdN,EAAMt3B,MAAQirB,EAAI6M,WAEX;;ACvBT,MAAM0B,GAAOh7C,EAAMC,OAClB,CACAiG,UAAW,OAEX+0C,YAAa,KACbjrC,KAAM,KAENkrC,WAAY,KACZC,SAAU,KAEVjvB,UAAW,EACX4sB,MAAO,KACPt3B,KAAM,EAENqR,QAAQ,EACRgQ,UAAU,EACVuY,SAAS,EAETrY,iBAAkB,KAClBC,wBAAyB,KACzBC,wBAAyB,KAEzBoY,aAAa,EAEbh7C,OAAQ,WAiBP,OAdAC,KAAK26C,YAAc,GACnB36C,KAAK0P,KAAO,GAEZ1P,KAAKw4C,MAAQG,GAAM1xC,QACnBjH,KAAK46C,WAAavvC,EAAKzC,KAAK3B,QAC5BjH,KAAK66C,SAAWxvC,EAAKzC,KAAK3B,QAE1BjH,KAAK86C,SAAU,EACf96C,KAAK+6C,aAAc,EAEnB/6C,KAAKyiC,iBAAmB,KACxBziC,KAAK0iC,wBAA0B,KAC/B1iC,KAAK2iC,wBAA0B,KAExB3iC,KAAK2J,SAGb3B,OAAQ,WAEPhI,KAAKw4C,MAAM3wC,OACX7H,KAAK46C,WAAW1xC,QAAQrB,OACxB7H,KAAK66C,SAAS3xC,QAAQrB,OAEe,OAAjC7H,KAAK0iC,0BAER1iC,KAAK0iC,wBAAwB76B,OAC7B7H,KAAK0iC,wBAA0B,MAGK,OAAjC1iC,KAAK2iC,0BAER3iC,KAAK2iC,wBAAwB96B,OAC7B7H,KAAK2iC,wBAA0B,OAIjCqY,OAAQ,SAAUnrC,GAQjB,OANAA,EAAO3G,QAEPa,QAAQ8F,EAAO2oC,OACf3oC,EAAO2oC,MAAQx4C,KAAKw4C,MAAM5uC,QAE1BiG,EAAO8qC,YAAc36C,KAAK26C,YACnB9qC,EAAOlG,SAGfC,MAAO,SAAUmxC,GAAY,GAE5B,IAAIlY,EAAO,IAAI6X,GAIf,OAHA7X,EAAKkY,YAAcA,EAEnB/6C,KAAKg7C,OAAOnY,GACLA,GAGRG,WAAY,SAAUv3B,GAGrB,OADAzL,KAAKyiC,iBAAmBh3B,EACjBzL,MAGR60B,KAAM,SAAUppB,EAAUV,EAAQ,MAEjC,OAAKU,GAEDzL,KAAKyiC,mBAAqBziC,KAAKijC,eAElCjjC,KAAKyiC,iBAAmBziC,KAAKijC,aAEQ,OAAjCjjC,KAAK0iC,yBAER1iC,KAAK0iC,wBAA0Br3B,EAAKzC,KAAK3B,QACzCjH,KAAK2iC,wBAA0Bt3B,EAAKzC,KAAK3B,UAIzCjH,KAAK0iC,wBAAwB/4B,QAC7B3J,KAAK2iC,wBAAwBh5B,UAI/B3J,KAAK0iC,wBAAwB57B,KAAK2E,GAClCzL,KAAK2iC,wBAAwB77B,KAAKiE,GAC3B/K,MApBeA,MAuBvBijC,aAAc,WAEb,IAAKjjC,KAAK0iC,wBAAwBviC,OACjC,OAAO,EAER,IAAI4K,EAAU/K,KAAK2iC,wBAAwBj4B,QAC3C1K,KAAK0iC,wBAAwBh4B,OAA7B1K,CAAqCA,KAAM+K,IAM5C7B,MAAO,WAwBN,OAtBAlJ,KAAK46C,WAAW1xC,QAChBlJ,KAAK66C,SAAS3xC,QACdlJ,KAAKw4C,MAAMtvC,QAEXlJ,KAAKuyB,QAAS,EACdvyB,KAAKuiC,UAAW,EAChBviC,KAAKkhB,KAAO,EACZlhB,KAAK4rB,UAAY,EAEoB,OAAjC5rB,KAAK0iC,0BAER1iC,KAAK0iC,wBAAwB76B,OAC7B7H,KAAK0iC,wBAA0B,MAGK,OAAjC1iC,KAAK2iC,0BAER3iC,KAAK2iC,wBAAwB96B,OAC7B7H,KAAK2iC,wBAA0B,MAGhC3iC,KAAKyiC,iBAAmB,KACjBziC,MAMR2J,MAAO,WAYN,OAVA3J,KAAK46C,WAAW1xC,QAChBlJ,KAAK66C,SAAS3xC,QACdlJ,KAAKw4C,MAAM7uC,QAEX3J,KAAKuyB,QAAS,EACdvyB,KAAKuiC,UAAW,EAChBviC,KAAKkhB,KAAO,EACZlhB,KAAK4rB,UAAY,EAEjBua,OAAOC,OAAQpmC,KAAK0P,KAAM1P,KAAK26C,aACxB36C,MAMRi7C,QAAS,SAAUvrC,EAAK,MAMvB,OAJa,OAATA,IACH1P,KAAK26C,YAAcjrC,GAEpBy2B,OAAOC,OAAQpmC,KAAK0P,KAAM1P,KAAK26C,aACxB36C,MAMRk7C,MAAO,SAAU57C,GAGhB,OADAU,KAAK4rB,UAAYtsB,EAAQ,EAAMA,EAAQ,EAChCU,MAMRgpC,OAAQ,SAAUt5B,GAGjB,OADA1P,KAAK0P,KAAOA,EACL1P,MAMRkwB,MAAO,WAKN,OAHKlwB,KAAKuyB,SACTvyB,KAAKuyB,QAAS,GAERvyB,MAMRmwB,OAAQ,WAQP,OANAnwB,KAAKuiC,UAAW,EAChBviC,KAAKuyB,QAAS,EAETvyB,KAAK86C,SACT96C,KAAKm7C,KAAI,GAEHn7C,MAMRm7C,IAAK,SAAUxxC,GAAM,GAEpB,OAAI3J,KAAK86C,UAGI,GAATnxC,GACH3J,KAAK2J,QAENyuC,GAAI7nB,OAAOliB,IAAIrO,KAAKuwB,OAAQvwB,MAC5BA,KAAK86C,SAAU,GANP96C,MAcTk6C,SAAU,SAAUkB,EAAW97C,GAE9B,IAAI+7C,EAAOr7C,KAAK0P,KAEhB,GAA0B,iBAAf0rC,EAEV,GAA0B,mBAAfA,EAEVA,EAAWp7C,KAAMV,OAGlB,CACC,IAAIY,EAAI,EAER,KAAgB,OAATm7C,GAAiBn7C,EAAIk7C,EAAUj7C,OAAO,GAC5Ck7C,EAAOA,EAAKD,EAAUl7C,MAEvBm7C,EAAKD,EAAUl7C,IAAMZ,OAItB+7C,EAAKD,GAAa97C,GAMpB66C,SAAU,SAAUiB,EAAW97C,EAAM,KAAMg8C,EAAa,MAEvD,IAAID,EAAOr7C,KAAK0P,KAEhB,GAA0B,iBAAf0rC,EAEV,GAA0B,mBAAfA,EAEVC,EAAOD,EAAWp7C,KAAM,UAGzB,CACC,IAAIE,EAAI,EAER,KAAgB,OAATm7C,GAAiBn7C,EAAIk7C,EAAUj7C,QACrCk7C,EAAOA,EAAKD,EAAUl7C,WAIxBm7C,EAAOA,EAAKD,GAQb,GANc,OAAV97C,IACHA,EAAQ+7C,GAEY,OAAjBC,IACHA,EAAeD,GAEM,iBAAX/7C,EAEV,OAAOA,EAAM,IAEZ,IAAK,IACJA,EAAQg8C,EAAeC,OAAOj8C,EAAMkkB,OAAO,IAC3C,MAED,IAAK,IACJlkB,EAAQg8C,EAAeC,OAAOj8C,EAAMkkB,OAAO,IAC3C,MAED,QACClkB,EAAQi8C,OAAOj8C,OAIS,mBAAXA,IACfA,EAAQA,EAAO+7C,EAAMC,EAAct7C,OAEpC,OAAOV,GAURixB,OAAQ,SAAUoB,EAAI7E,EAAK,MAK1B,GAHa,OAATA,IACHA,EAAO9sB,MAEJ8sB,EAAKyF,QAAUzF,EAAK0rB,MAAME,aAG7B,OADA5rB,EAAKguB,SAAU,GACR,EAKR,GAFAhuB,EAAK5L,MAAQyQ,EAAG7E,EAAKlB,UAAU8uB,GAAK9uB,WAEJ,IAA5BkB,EAAK0rB,MAAMjoB,OAAOzD,GACrB,OAAO,EAER,IAAIyV,EAAWzV,EAAKyV,SAChBvQ,EAAQlF,EAAK0rB,MAAMr4C,OACnBq4C,EAAQ1rB,EAAK0rB,MAIjB,OAFA1rB,EAAKyV,UAAW,EAEXA,GAAsC,OAA1BzV,EAAK2V,oBAE0B,IAA3C3V,EAAK2V,iBAAiB3V,EAAKpd,KAAMod,KACpCA,EAAK2V,iBAAmB,MAErB3V,EAAK0rB,QAAUA,GAAS1rB,EAAK0rB,MAAMr4C,QAAU6xB,IAOlDlF,EAAKguB,SAAU,EAEXhuB,EAAKiuB,aACRhxC,QAAQ+iB,IAEF,IAVLA,EAAKqD,UACE,IAeVqrB,iBAAkB,SAAUl8C,GAE3B,MAAsB,mBAAXA,EACHA,GAEqB,GAAtBA,EAAMyU,QAAQ,KAAazU,EAAMkU,MAAM,KAAOlU,GAQtDm8C,SAAU,WAET,IAAItP,EAAMnsC,KAAKw4C,MAAMnqC,IAAIurC,GAAQ3yC,MAAM4yC,KAMvC,OAJA75C,KAAK46C,WAAW9zC,KAAM9G,KAAKw4C,OAC3Bx4C,KAAK66C,SAAS/zC,KAAMqlC,GAEpBnsC,KAAKw4C,MAAQrM,EAAIqM,MACVx4C,MAMR07C,OAAQ,WAEP,IAAIvP,EAAMnsC,KAAKw4C,MAAMnqC,IAAIurC,GAAQ3yC,MAAM8yC,KAMvC,OAJA/5C,KAAK46C,WAAW9zC,KAAM9G,KAAKw4C,OAC3Bx4C,KAAK66C,SAAS/zC,KAAMqlC,GAEpBnsC,KAAKw4C,MAAQrM,EAAIqM,MACVx4C,MAMRo4B,OAAQ,SAAUpG,GAEjB,IAAIma,EAAMnsC,KAAKw4C,MAAMnqC,IAAIurC,GAAQ3yC,MAAM+yC,KAOvC,OANA7N,EAAIna,MAAQA,EAEZhyB,KAAK46C,WAAW9zC,KAAM9G,KAAKw4C,OAC3Bx4C,KAAK66C,SAAS/zC,KAAMqlC,GAEpBnsC,KAAKw4C,MAAQrM,EAAIqM,MACVx4C,MAMRslB,IAAK,WAIJ,OAFAtlB,KAAK66C,SAASlwC,MAAMgvC,QACpB35C,KAAKw4C,MAAQx4C,KAAK46C,WAAWjwC,MACtB3K,MAMRqN,IAAK,SAAU0rC,EAAOz5C,GAErB,IAAI6sC,EAAMnsC,KAAKw4C,MAAMnqC,IAAIurC,GAAQ3yC,MAAMgzC,KAKvC,OAHA9N,EAAI4M,MAAQ/4C,KAAKw7C,iBAAiBzC,GAClC5M,EAAI7sC,MAAQA,EAELU,MAMRy4C,QAAS,WAGR,OADAz4C,KAAKw4C,MAAMnqC,IAAIurC,GAAQ3yC,MAAMmzC,KACtBp6C,MAMR27C,KAAM,SAAU7pB,GAMf,OAJU9xB,KAAKw4C,MAAMnqC,IAAIurC,GAAQ3yC,MAAMozC,KAEnCvoB,SAAWA,EAER9xB,MAMR47C,MAAO,SAAU7C,EAAOjnB,EAAUonB,EAAYE,EAAUrnB,EAAO,MAE9D,IAAIoa,EAAMnsC,KAAKw4C,MAAMnqC,IAAIurC,GAAQ3yC,MAAMszC,KAQvC,OANApO,EAAI4M,MAAQ/4C,KAAKw7C,iBAAiBzC,GAClC5M,EAAIra,SAAWA,EACfqa,EAAI+M,WAAaA,EACjB/M,EAAIiN,SAAWA,EACfjN,EAAIpa,OAASA,EAEN/xB,MAMR67C,QAAS,SAAU9C,EAAOjnB,EAAUsnB,EAAUrnB,EAAO,MAEpD,IAAIoa,EAAMnsC,KAAKw4C,MAAMnqC,IAAIurC,GAAQ3yC,MAAMszC,KAQvC,OANApO,EAAI4M,MAAQ/4C,KAAKw7C,iBAAiBzC,GAClC5M,EAAIra,SAAWA,EACfqa,EAAI+M,WAAa,KACjB/M,EAAIiN,SAAWA,EACfjN,EAAIpa,OAASA,EAEN/xB,MAMR21B,KAAM,SAAUojB,EAAOjnB,EAAUE,EAAOknB,EAAYE,EAAUrnB,EAAO,MAEpE,IAAIoa,EAAMnsC,KAAKw4C,MAAMnqC,IAAIurC,GAAQ3yC,MAAMuzC,KASvC,OAPArO,EAAI4M,MAAQ/4C,KAAKw7C,iBAAiBzC,GAClC5M,EAAIra,SAAWA,EACfqa,EAAIna,MAAQA,EACZma,EAAI+M,WAAaA,EACjB/M,EAAIiN,SAAWA,EACfjN,EAAIpa,OAASA,EAEN/xB,MAMR87C,MAAO,SAAU/C,EAAOjnB,EAAUE,EAAOknB,EAAYE,EAAUrnB,GAE9D,IAAIoa,EAAMnsC,KAAKw4C,MAAMnqC,IAAIurC,GAAQ3yC,MAAMwzC,KAWvC,OATAtO,EAAI4M,MAAQ/4C,KAAKw7C,iBAAiBzC,GAClC5M,EAAIra,SAAWA,EACfqa,EAAIna,MAAQA,EACZma,EAAI+M,WAAaA,EACjB/M,EAAIiN,SAAWA,EACfjN,EAAIpa,OAASA,EAEboa,EAAIwN,QAEG35C,MAMR2jC,KAAM,SAAUyI,GAKf,OAHUpsC,KAAKw4C,MAAMnqC,IAAIurC,GAAQ3yC,MAAM80C,OACnC3P,IAAMA,EAEHpsC,MAMRkxC,KAAM,SAAUpmC,GAKf,OAHU9K,KAAKw4C,MAAMnqC,IAAIurC,GAAQ3yC,MAAM+0C,OACnClxC,GAAKA,EAEF9K,MAKRi8C,WAAY,SAAUpZ,EAAMvjC,GAE3B,GAAc,OAAVA,EACH,OAAOujC,EAAKnzB,KAAKyvB,OAAOxhB,GAEzBklB,EAAKnzB,KAAK5B,UAAUhI,IAAIxG,GAASujC,EAAKnzB,KAAKyvB,OAAOxhB,GAAI,IAGvDu+B,WAAY,SAAUrZ,EAAMvjC,GAE3B,GAAc,OAAVA,EACH,OAAOujC,EAAKnzB,KAAKyvB,OAAOvhB,GAEzBilB,EAAKnzB,KAAK5B,UAAU,EAAGhI,IAAIxG,GAASujC,EAAKnzB,KAAKyvB,OAAOvhB,KAMtDrQ,KAAM,SAAUjO,GAEf,OAAOU,KAAKqN,IAAIrN,KAAKi8C,WAAY38C,IAMlCkO,KAAM,SAAUlO,GAEf,OAAOU,KAAKqN,IAAIrN,KAAKk8C,WAAY58C,IAMlC0a,SAAU,SAAUza,EAAG6N,GAEtB,OAAOpN,KAAKqN,IAAIrN,KAAKi8C,WAAY18C,GAAG8N,IAAIrN,KAAKk8C,WAAY9uC,IAM1D+uC,WAAY,SAAUrqB,EAAUsqB,EAAYrqB,GAE3C,OAAO/xB,KAAK47C,MAAM57C,KAAKi8C,WAAYnqB,EAAU,MAAOsqB,EAAa,EAAI,IAAM,KAAOx1C,KAAKsB,IAAIk0C,GAAarqB,IAMzGsqB,WAAY,SAAUvqB,EAAUsqB,EAAYrqB,GAE3C,OAAO/xB,KAAK47C,MAAM57C,KAAKk8C,WAAYpqB,EAAU,MAAOsqB,EAAa,EAAI,IAAM,KAAOx1C,KAAKsB,IAAIk0C,GAAarqB,IAMzGjkB,UAAW,SAAUgkB,EAAUwqB,EAAaC,EAAaC,EAASC,EAAQ,MAEzE,OAAOz8C,KAAKy7C,WACRG,MAAM57C,KAAKi8C,WAAYnqB,EAAU,MAAOwqB,EAAc,EAAI,IAAM,KAAO11C,KAAKsB,IAAIo0C,GAAcE,GAC9FZ,MAAM57C,KAAKk8C,WAAYpqB,EAAU,MAAOyqB,EAAc,EAAI,IAAM,KAAO31C,KAAKsB,IAAIq0C,GAAcE,GAAoBD,GACnHl3B,OAMJnJ,OAAQ,SAAU2V,EAAU4qB,EAAWC,EAAWH,EAASC,EAAQ,MAElE,OAAOz8C,KAAKy7C,WACTG,MAAM57C,KAAKi8C,WAAYnqB,EAAU,KAAM4qB,EAAWF,GAClDZ,MAAM57C,KAAKk8C,WAAYpqB,EAAU,KAAM6qB,EAAWF,GAAoBD,GACtEl3B,OAMJs3B,MAAO,SAAU9qB,EAAUsnB,EAAUrnB,EAAO,MAE3C,OAAO/xB,KAAK47C,MAAM57C,KAAKi8C,WAAYnqB,EAAU,KAAMsnB,EAAUrnB,IAM9D8qB,MAAO,SAAU/qB,EAAUsnB,EAAUrnB,EAAO,MAE3C,OAAO/xB,KAAK47C,MAAM57C,KAAKk8C,WAAYpqB,EAAU,KAAMsnB,EAAUrnB,IAM9D+qB,OAAQ,SAAUhrB,EAAUsnB,EAAUrnB,GAErC,OAAO/xB,KAAK47C,MAAM,KAAM9pB,EAAU,KAAMsnB,EAAUrnB,IAMnDgrB,OAAQ,SAAUjrB,EAAUsnB,EAAUrnB,GAErC,OAAO/xB,KAAK47C,MAAM,KAAM9pB,EAAU,KAAMsnB,EAAUrnB,IAMnDrlB,MAAO,SAAUolB,EAAU4qB,EAAWC,EAAWH,EAASC,EAAQ,MAEjE,OAAOz8C,KAAKy7C,WACTG,MAAM,KAAM9pB,EAAU,KAAM4qB,EAAWF,GACvCZ,MAAM,KAAM9pB,EAAU,KAAM6qB,EAAWF,GAAoBD,GAC3Dl3B,OAMJrX,OAAQ,SAAU6jB,EAAUsqB,EAAYrqB,GAEvC,OAAO/xB,KAAK47C,MAAM,QAAS9pB,EAAU,MAAOsqB,EAAa,EAAI,IAAM,KAAOx1C,KAAKsB,IAAIk0C,GAAarqB,MAOlG2oB,GAAK9uB,UAAY,EAKjB8uB,GAAKQ,MAAQ,SAAU57C,GAEtBo7C,GAAK9uB,UAAYtsB,EAAQ,EAAMA,EAAQ,GAGxCgG,EAASqD,WAAW+xC,GAAM,UAC1BsC,GAAetC;;;oBCrtBf;MAAMuC,GAAcv9C,EAAMC,OACzB,CAIAiG,UAAW,cAMXsO,GAAI,KAMJirB,OAAQ,KAMRtV,MAAO,EAMPna,KAAM,KAMNwtC,IAAK,KAKLC,UAAW,KAKXC,kBAAmB,KAKnBC,QAAS,KAMTt9C,OAAQ,SAAUR,EAAG6N,EAAGgM,EAAOC,GAE9BrZ,KAAKm/B,OAASoW,GAAQ3sC,KAAK3B,QAE3BjH,KAAKm/B,OAAOrxB,UAAWvO,EAAG6N,GAC1BpN,KAAKm/B,OAAO/jB,OAAQhC,EAAOC,GAAQ,GAEnCrZ,KAAK6pB,MAAQozB,GAAYK,MAAQL,GAAYM,QAAUN,GAAYO,MAAQP,GAAYQ,WACvFz9C,KAAK0P,KAAO,KACZ1P,KAAKk9C,IAAM,KAEXl9C,KAAKq9C,QAAU7L,GAAQ5oC,KAAK3B,MAAMjH,OAMnCgI,OAAQ,WAEPhI,KAAK09C,OAAM,GAEO,OAAd19C,KAAK0P,OAER3F,QAAQ/J,KAAK0P,MACb1P,KAAK0P,KAAO,MAGb1P,KAAKq9C,QAAQnM,OACblxC,KAAKq9C,QAAQx1C,OAEb7H,KAAKm/B,OAAOt3B,QAOb81C,MAAO,SAAUr+C,GAGhB,OADAU,KAAKkU,GAAK5U,EACHU,MAOR49C,SAAU,SAAUt+C,GAGnB,OADAU,KAAK6pB,OAASvqB,EACPU,MAOR69C,WAAY,SAAUv+C,GAGrB,OADAU,KAAK6pB,QAAUvqB,EACRU,MAOR89C,SAAU,SAAUC,EAASz+C,EAAM,MAElC,OAAc,OAAVA,GACKU,KAAK6pB,MAAQk0B,KAAaA,GAE3B/9C,KAAK6pB,MAAQk0B,KAAaz+C,GAOnC0+C,QAAS,SAAUtuC,GAGlB,OADA1P,KAAK0P,KAAOA,EACL1P,MAORi+C,QAAS,WAER,OAAOj+C,KAAK0P,MAObwuC,OAAQ,SAAUC,GAGjB,OADAn+C,KAAKk9C,IAAMiB,EACJn+C,MAORo+C,OAAQ,WAEP,OAAOp+C,KAAKk9C,KAQbhM,KAAM,SAAS9oC,EAAMuoC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMqN,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAE5H,QAAiB,OAAbx+C,KAAKk9C,MAAiBl9C,KAAKk9C,IAAI9pC,eAAehL,KAG3CpI,KAAKk9C,IAAI90C,GAAOpI,KAAM2wC,EAAMC,EAAMC,EAAMC,EAAMC,EAAMC,EAAMqN,EAAMC,EAAMC,EAAMC,IAapFC,QAAS,SAAUn/C,EAAM,KAAMo/C,GAAO,GAErC,OAAc,OAAVp/C,KACOU,KAAK6pB,MAAQozB,GAAYM,WAE/BmB,GAAU1+C,KAAK6pB,MAAQozB,GAAY0B,eAGxC3+C,KAAK6pB,QAAUozB,GAAYM,QACvBj+C,IAAOU,KAAK6pB,OAASozB,GAAYM,UAH7Bv9C,OAgBT4+C,YAAa,SAAUt/C,EAAM,MAE5B,OAAc,OAAVA,KACOU,KAAK6pB,MAAQozB,GAAY0B,eAEpC3+C,KAAK6pB,QAAUozB,GAAY0B,aACvBr/C,IAAOU,KAAK6pB,OAASozB,GAAY0B,cAE9B3+C,OAWR09C,MAAO,SAAUp+C,EAAM,MAEtB,OAAc,OAAVA,KACOU,KAAK6pB,MAAQozB,GAAYK,QAEpCt9C,KAAK6pB,QAAUozB,GAAYK,MACvBh+C,IAAOU,KAAK6pB,OAASozB,GAAYK,OAE9Bt9C,OAWR6+C,MAAO,SAAUv/C,EAAM,MAEtB,OAAc,OAAVA,KACOU,KAAK6pB,MAAQozB,GAAYO,QAEpCx9C,KAAK6pB,QAAUozB,GAAYO,MACvBl+C,IAAOU,KAAK6pB,OAASozB,GAAYO,OAE9Bx9C,OAWR8+C,iBAAkB,SAAUx/C,EAAM,MAEjC,OAAc,OAAVA,KACOU,KAAK6pB,MAAQozB,GAAY8B,qBAEpC/+C,KAAK6pB,QAAUozB,GAAY8B,mBACvBz/C,IAAOU,KAAK6pB,OAASozB,GAAY8B,oBAE9B/+C,OAWRg/C,UAAW,SAAU1/C,EAAM,MAE1B,OAAc,OAAVA,KACOU,KAAK6pB,MAAQozB,GAAYQ,aAEpCz9C,KAAK6pB,QAAUozB,GAAYQ,WACvBn+C,IAAOU,KAAK6pB,OAASozB,GAAYQ,YAE9Bz9C,OAORqK,OAAQ,WAGP,OADArK,KAAKq9C,QAAQnM,OACNlxC,MAORi/C,KAAM,WAEL,OAAuB,OAAnBj/C,KAAKm9C,WAAuBn9C,KAAK89C,SAASb,GAAYK,MAAQL,GAAYO,QAG9Ex9C,KAAKm9C,UAAU8B,KAAKj/C,MACbA,MAHCA,MAUTob,OAAQ,SAAUhC,EAAOC,GAIxB,OAFArZ,KAAK6pB,OAASozB,GAAYO,MAC1Bx9C,KAAKm/B,OAAO/jB,OAAQhC,MAAAA,EAAAA,EAASpZ,KAAKm/B,OAAO/lB,QAASC,MAAAA,EAAAA,EAAUrZ,KAAKm/B,OAAO9lB,UAAU,GAC3ErZ,MAORwyC,SAAU,SAAU0M,EAAQC,GAE3B,OAAOn/C,KAAKob,OAAOpb,KAAKm/B,OAAO/lB,QAAU8lC,EAAQl/C,KAAKm/B,OAAO9lB,SAAW8lC,IAQzErxC,UAAW,SAAUC,EAAIC,EAAI0mC,GAAS,GAIrC,OAFA10C,KAAK6pB,OAASozB,GAAYO,MAC1Bx9C,KAAKm/B,OAAOrxB,UAAWC,EAAIC,EAAI0mC,GACxB10C,MAWRo/C,YAAa,SAAU7/C,EAAG6N,GAAE,GAO3B,OALU,IAANA,IACHA,EAAI7N,EAAE6N,EACN7N,EAAIA,EAAEA,GAGAS,KAAK8N,UAAiB,OAANvO,EAAau4B,QAAQv4B,GAAGS,KAAKm/B,OAAO4V,IAAM,EAAS,OAAN3nC,EAAa0qB,QAAQ1qB,GAAGpN,KAAKm/B,OAAO6V,IAAM,GAAG,MAOnHiI,GAAYK,MAAa,EACzBL,GAAYM,QAAc,EAC1BN,GAAY0B,aAAkB,EAC9B1B,GAAYO,MAAa,EACzBP,GAAY8B,mBAAsB,GAClC9B,GAAYQ,WAAgB,GAC5BR,GAAYoC,aAAgB,GAE5BpC,GAAYqC,QAAW,IACvBrC,GAAYsC,UAAY,IAMxBtC,GAAYuC,UAAY,WAEvB,IAAIC,EAAOxC,GAAYsC,UACvB,GAAa,aAATE,EAAsB,MAAM,IAAI55C,MAAO,wDAK3C,OAHA45C,IAAS,EACTxC,GAAYsC,UAAYE,EAEjBA,OAGRC,GAAezC;;;;ICJf0C,GAhZajgD,EAAMC,OAClB,CAIAiG,UAAW,OAKXg6C,KAAM,KAMN5tB,MAAO,EAMP6tB,MAAO,EAAGC,MAAO,EAMjBC,GAAI,EAAGC,GAAI,EAKXC,OAAQ,EAMRC,oBAAoB,EAWpBngD,OAAQ,SAAUqZ,EAAOC,EAAQ0mC,EAAIC,EAAG,MAEvC5mC,EAAQ,GAAKxS,KAAKi7B,KAAKj7B,KAAKu5C,KAAK/mC,IACjCC,EAAS,GAAKzS,KAAKi7B,KAAKj7B,KAAKu5C,KAAK9mC,IAElCrZ,KAAK6/C,MAAQzmC,GAAS,EACtBpZ,KAAK8/C,MAAQzmC,GAAU,EAEZ,OAAP2mC,IACHA,EAAKD,GAENA,EAAKn5C,KAAK6H,MAAM7H,KAAKu5C,KAAKJ,IAC1BC,EAAKp5C,KAAK6H,MAAM7H,KAAKu5C,KAAKH,IAE1BhgD,KAAK+/C,GAAKA,EACV//C,KAAKggD,GAAKA,EAEV,IAAIzjC,EAAInD,GAAS2mC,EACbvjC,EAAInD,GAAU2mC,EAEbzjC,IACJwjC,EAAKn5C,KAAKu5C,KAAK/mC,GACfmD,EAAI,GAGAC,IACJwjC,EAAKp5C,KAAKu5C,KAAK9mC,GACfmD,EAAI,GAGLxc,KAAK4/C,KAAO,IAAIhlB,MAAMre,EAAEC,GAAGjN,KAAK,MAChCvP,KAAKigD,OAAS1jC,GAMfvU,OAAQ,WAEPhI,KAAKkJ,QACLlJ,KAAK4/C,KAAO,MAOb12C,MAAO,WAEN,IAAK,IAAIhJ,EAAI,EAAGA,EAAIF,KAAK4/C,KAAKz/C,OAAQD,IACtC,CACC,GAAqB,OAAjBF,KAAK4/C,KAAK1/C,GACb,SAED,IAAIuQ,EAEJ,KAAsC,QAA9BA,EAAIzQ,KAAK4/C,KAAK1/C,GAAGwK,UAExB+F,EAAE4sC,QAAQhzC,OAAOrK,KAAKogD,QAASpgD,MAC/ByQ,EAAE0sC,UAAY,KAEdpzC,QAAQ0G,GAGTzQ,KAAK4/C,KAAK1/C,GAAG2H,OACb7H,KAAK4/C,KAAK1/C,GAAK,KAGhBF,KAAKgyB,MAAQ,GAOdroB,MAAO,WAEN,IAAK,IAAIzJ,EAAI,EAAGA,EAAIF,KAAK4/C,KAAKz/C,OAAQD,IACtC,CACC,GAAqB,OAAjBF,KAAK4/C,KAAK1/C,GACb,SAED,IAAIuQ,EAEJ,KAAsC,QAA9BA,EAAIzQ,KAAK4/C,KAAK1/C,GAAGwK,UAExB+F,EAAE4sC,QAAQhzC,OAAOrK,KAAKogD,QAASpgD,MAC/ByQ,EAAE0sC,UAAY,KAGfn9C,KAAK4/C,KAAK1/C,GAAG2H,OACb7H,KAAK4/C,KAAK1/C,GAAK,KAGhBF,KAAKgyB,MAAQ,GAOd3jB,IAAK,SAAU6K,GAEd,IAAKwmC,GAAYp1C,WAAW4O,GAC3B,MAAM,IAAIrT,MAAO,kCAElB,IAAI3F,EAAI4F,IAAKoT,EAAKimB,OAAOvhB,GAAG5d,KAAK8/C,OAAU9/C,KAAKggD,IAAMhgD,KAAKigD,OAASn6C,IAAKoT,EAAKimB,OAAOxhB,GAAG3d,KAAK6/C,OAAU7/C,KAAK+/C,IAC5G,QAAI7/C,EAAI,GAAKA,GAAKF,KAAK4/C,KAAKz/C,UAEP,OAAjBH,KAAK4/C,KAAK1/C,KACbF,KAAK4/C,KAAK1/C,GAAKmL,EAAKzC,KAAK3B,SAE1BjH,KAAK4/C,KAAK1/C,GAAG4G,KAAKoS,GAClBlZ,KAAKgyB,QAEL9Y,EAAKikC,UAAYn9C,KACjBkZ,EAAKkkC,kBAAoBlkC,EAAKmkC,QAAQhvC,IAAIrO,KAAKogD,QAASpgD,KAAME,EAAGF,KAAK4/C,KAAK1/C,GAAGwJ,SAEvE,IAMR02C,QAAS,SAAUlnC,EAAM4T,EAAMjtB,EAAOksC,GAMrC,OAJAjf,EAAK8yB,KAAK//C,GAAOwK,OAAO0hC,GACxBjf,EAAKkF,QAEL9Y,EAAKikC,UAAY,MACV,GAOR9yC,OAAQ,SAAU6O,GAGjB,OADAA,EAAKmkC,QAAQ9L,MAAMvxC,KAAKo9C,mBACjBlkC,GAQR+lC,KAAM,SAAU/lC,GAEfA,EAAK2kC,WAAW6B,GAAYlC,OAE5B,IAAIzR,EAAO7yB,EAAKkkC,kBAEZl9C,EAAI4F,IAAKoT,EAAKimB,OAAOvhB,GAAG5d,KAAK8/C,OAAU9/C,KAAKggD,IAAMhgD,KAAKigD,OAASn6C,IAAKoT,EAAKimB,OAAOxhB,GAAG3d,KAAK6/C,OAAU7/C,KAAK+/C,IAC5G,OAAI7/C,EAAI,GAAKA,GAAKF,KAAK4/C,KAAKz/C,QAE3B+Y,EAAKmkC,QAAQ9L,MAAMxF,IACZ,IAGJA,EAAK6E,OAAS1wC,IAGlBF,KAAK4/C,KAAK7T,EAAK6E,MAAMvmC,OAAO0hC,EAAK8E,MAEZ,OAAjB7wC,KAAK4/C,KAAK1/C,KACbF,KAAK4/C,KAAK1/C,GAAKmL,EAAKzC,KAAK3B,SAE1BjH,KAAK4/C,KAAK1/C,GAAG4G,KAAKoS,GAElB6yB,EAAK6E,KAAO1wC,EACZ6rC,EAAK8E,KAAO7wC,KAAK4/C,KAAK1/C,GAAGwJ,SAVjB,IAoBT22C,gBAAiB,SAAUlhB,EAAQmhB,EAAcC,EAAY90C,EAAUV,GAEtE,IAAIy1C,GAAOrhB,EAAOvhB,GAAG5d,KAAK8/C,OAAU,GAAG9/C,KAAKggD,GAAG,IAAMhgD,KAAKggD,IAAMhgD,KAAKigD,OACjEQ,GAAOthB,EAAOrhB,GAAG9d,KAAK8/C,OAAU,GAAG9/C,KAAKggD,GAAG,IAAMhgD,KAAKggD,IAAMhgD,KAAKigD,OACjE1M,EAAOpU,EAAOxhB,GAAG3d,KAAK6/C,OAAU,GAAG7/C,KAAK+/C,GAAG,IAAM//C,KAAK+/C,GACtDnwC,EAAOuvB,EAAOthB,GAAG7d,KAAK6/C,OAAU,GAAG7/C,KAAK+/C,GAAG,IAAM//C,KAAK+/C,GAEtDp5C,EAAI3G,KAAK4/C,KAAKz/C,OAAO,EAErBqgD,EAAK,IAAGA,EAAK,GAAOC,EAAK,IAAGA,EAAK,GACjClN,EAAK,IAAGA,EAAK,GAAO3jC,EAAK,IAAGA,EAAK,GACjC4wC,EAAK75C,IAAG65C,EAAK75C,GAAO85C,EAAK95C,IAAG85C,EAAK95C,GACjC4sC,EAAK5sC,IAAG4sC,EAAK5sC,GAAOiJ,EAAKjJ,IAAGiJ,EAAKjJ,GAErC,IAAK,IAAI8J,EAAI+vC,EAAI/vC,GAAKgwC,EAAIhwC,GAAKzQ,KAAKigD,OAEnC,IAAK,IAAI//C,EAAIqzC,EAAIrzC,GAAK0P,EAAI1P,IAC1B,CACC,IAAIw/B,EAAIjvB,EAAIvQ,EACZ,KAAIw/B,EAAI/4B,GAAsB,OAAjB3G,KAAK4/C,KAAKlgB,IAEvB,IAAK,IAAI7jB,EAAI7b,KAAK4/C,KAAKlgB,GAAGj2B,IAAKoS,EAAGA,EAAIA,EAAE5S,KAGvC,GAAK4S,EAAEvc,MAAMw+C,SAASwC,EAAcC,MAGhCvgD,KAAKkgD,sBAAuBzvC,GAAK+vC,EAAG,GAAKtgD,GAAKqzC,EAAG,GAAK9iC,GAAKgwC,EAAG,GAAKvgD,GAAK0P,EAAG,IAAOiM,EAAEvc,MAAM6/B,OAAO8S,WAAW9S,MAG7E,IAA/B1zB,EAASoQ,EAAEvc,MAAOyL,GACrB,SAUL21C,eAAgB,SAAUvhB,EAAQmhB,EAAcC,GAE/C,IAAIC,GAAOrhB,EAAOvhB,GAAG5d,KAAK8/C,OAAU,GAAG9/C,KAAKggD,GAAG,IAAMhgD,KAAKggD,IAAMhgD,KAAKigD,OACjEQ,GAAOthB,EAAOrhB,GAAG9d,KAAK8/C,OAAU,GAAG9/C,KAAKggD,GAAG,IAAMhgD,KAAKggD,IAAMhgD,KAAKigD,OACjE1M,EAAOpU,EAAOxhB,GAAG3d,KAAK6/C,OAAU,GAAG7/C,KAAK+/C,GAAG,IAAM//C,KAAK+/C,GACtDnwC,EAAOuvB,EAAOthB,GAAG7d,KAAK6/C,OAAU,GAAG7/C,KAAK+/C,GAAG,IAAM//C,KAAK+/C,GAEtDp5C,EAAI3G,KAAK4/C,KAAKz/C,OAAO,EAErBqgD,EAAK,IAAGA,EAAK,GAAOC,EAAK,IAAGA,EAAK,GACjClN,EAAK,IAAGA,EAAK,GAAO3jC,EAAK,IAAGA,EAAK,GACjC4wC,EAAK75C,IAAG65C,EAAK75C,GAAO85C,EAAK95C,IAAG85C,EAAK95C,GACjC4sC,EAAK5sC,IAAG4sC,EAAK5sC,GAAOiJ,EAAKjJ,IAAGiJ,EAAKjJ,GAErC,IAAI0B,EAAOgD,EAAKzC,KAAK3B,QAErB,IAAK,IAAIwJ,EAAI+vC,EAAI/vC,GAAKgwC,EAAIhwC,GAAKzQ,KAAKigD,OAEnC,IAAK,IAAI//C,EAAIqzC,EAAIrzC,GAAK0P,EAAI1P,IAC1B,CACC,IAAIw/B,EAAIjvB,EAAIvQ,EACZ,KAAIw/B,EAAI/4B,GAAsB,OAAjB3G,KAAK4/C,KAAKlgB,IAEvB,IAAK,IAAI7jB,EAAI7b,KAAK4/C,KAAKlgB,GAAGj2B,IAAKoS,EAAGA,EAAIA,EAAE5S,KAGlC4S,EAAEvc,MAAMw+C,SAASwC,EAAcC,KAGhCvgD,KAAKkgD,qBAAuBzvC,GAAK+vC,EAAG,GAAKtgD,GAAKqzC,EAAG,GAAK9iC,GAAKgwC,EAAG,GAAKvgD,GAAK0P,EAAG,KAAOiM,EAAEvc,MAAM6/B,OAAO8S,WAAW9S,IAGhH92B,EAAKvB,KAAK+U,EAAEvc,QAKf,OAAO+I,GAORs4C,cAAe,SAAUxhB,EAAQmhB,EAAcC,GAE9C,IAAIC,GAAOrhB,EAAOvhB,GAAG5d,KAAK8/C,OAAU,GAAG9/C,KAAKggD,GAAG,IAAMhgD,KAAKggD,IAAMhgD,KAAKigD,OACjEQ,GAAOthB,EAAOrhB,GAAG9d,KAAK8/C,OAAU,GAAG9/C,KAAKggD,GAAG,IAAMhgD,KAAKggD,IAAMhgD,KAAKigD,OACjE1M,EAAOpU,EAAOxhB,GAAG3d,KAAK6/C,OAAU,GAAG7/C,KAAK+/C,GAAG,IAAM//C,KAAK+/C,GACtDnwC,EAAOuvB,EAAOthB,GAAG7d,KAAK6/C,OAAU,GAAG7/C,KAAK+/C,GAAG,IAAM//C,KAAK+/C,GAEtDp5C,EAAI3G,KAAK4/C,KAAKz/C,OAAO,EAErBqgD,EAAK,IAAGA,EAAK,GAAOC,EAAK,IAAGA,EAAK,GACjClN,EAAK,IAAGA,EAAK,GAAO3jC,EAAK,IAAGA,EAAK,GACjC4wC,EAAK75C,IAAG65C,EAAK75C,GAAO85C,EAAK95C,IAAG85C,EAAK95C,GACjC4sC,EAAK5sC,IAAG4sC,EAAK5sC,GAAOiJ,EAAKjJ,IAAGiJ,EAAKjJ,GAErC,IAAIu5B,EAAI,EAER,IAAK,IAAIzvB,EAAI+vC,EAAI/vC,GAAKgwC,EAAIhwC,GAAKzQ,KAAKigD,OAEnC,IAAK,IAAI//C,EAAIqzC,EAAIrzC,GAAK0P,EAAI1P,IAC1B,CACC,IAAIw/B,EAAIjvB,EAAIvQ,EACZ,KAAIw/B,EAAI/4B,GAAsB,OAAjB3G,KAAK4/C,KAAKlgB,IAEvB,IAAK,IAAI7jB,EAAI7b,KAAK4/C,KAAKlgB,GAAGj2B,IAAKoS,EAAGA,EAAIA,EAAE5S,KAGlC4S,EAAEvc,MAAMw+C,SAASwC,EAAcC,KAGhCvgD,KAAKkgD,qBAAuBzvC,GAAK+vC,EAAG,GAAKtgD,GAAKqzC,EAAG,GAAK9iC,GAAKgwC,EAAG,GAAKvgD,GAAK0P,EAAG,KAAOiM,EAAEvc,MAAM6/B,OAAO8S,WAAW9S,IAGhHe,KAKH,OAAOA,GAOR0gB,YAAa,SAAUzhB,EAAQmhB,EAAcC,GAE5C,IAAIC,GAAOrhB,EAAOvhB,GAAG5d,KAAK8/C,OAAU,GAAG9/C,KAAKggD,GAAG,IAAMhgD,KAAKggD,IAAMhgD,KAAKigD,OACjEQ,GAAOthB,EAAOrhB,GAAG9d,KAAK8/C,OAAU,GAAG9/C,KAAKggD,GAAG,IAAMhgD,KAAKggD,IAAMhgD,KAAKigD,OACjE1M,EAAOpU,EAAOxhB,GAAG3d,KAAK6/C,OAAU,GAAG7/C,KAAK+/C,GAAG,IAAM//C,KAAK+/C,GACtDnwC,EAAOuvB,EAAOthB,GAAG7d,KAAK6/C,OAAU,GAAG7/C,KAAK+/C,GAAG,IAAM//C,KAAK+/C,GAEtDp5C,EAAI3G,KAAK4/C,KAAKz/C,OAAO,EAErBqgD,EAAK,IAAGA,EAAK,GAAOC,EAAK,IAAGA,EAAK,GACjClN,EAAK,IAAGA,EAAK,GAAO3jC,EAAK,IAAGA,EAAK,GACjC4wC,EAAK75C,IAAG65C,EAAK75C,GAAO85C,EAAK95C,IAAG85C,EAAK95C,GACjC4sC,EAAK5sC,IAAG4sC,EAAK5sC,GAAOiJ,EAAKjJ,IAAGiJ,EAAKjJ,GAErC,IAAK,IAAI8J,EAAI+vC,EAAI/vC,GAAKgwC,EAAIhwC,GAAKzQ,KAAKigD,OAEnC,IAAK,IAAI//C,EAAIqzC,EAAIrzC,GAAK0P,EAAI1P,IAC1B,CACC,IAAIw/B,EAAIjvB,EAAIvQ,EACZ,KAAIw/B,EAAI/4B,GAAsB,OAAjB3G,KAAK4/C,KAAKlgB,IAEvB,IAAK,IAAI7jB,EAAI7b,KAAK4/C,KAAKlgB,GAAGj2B,IAAKoS,EAAGA,EAAIA,EAAE5S,KAGvC,GAAK4S,EAAEvc,MAAMw+C,SAASwC,EAAcC,MAGhCvgD,KAAKkgD,sBAAuBzvC,GAAK+vC,EAAG,GAAKtgD,GAAKqzC,EAAG,GAAK9iC,GAAKgwC,EAAG,GAAKvgD,GAAK0P,EAAG,IAAOiM,EAAEvc,MAAM6/B,OAAO8S,WAAW9S,IAGhH,OAAOtjB,EAAEvc,MAKZ,OAAO;kBChZT;MAAMuhD,GAAYnhD,EAAMC,OACvB,CACAiG,UAAW,YAMXk7C,eAAgB,KAMhB1nC,MAAO,EAMPC,OAAQ,EAMRwH,OAAQ,EAMRkgC,MAAO,KAMPl3B,MAAO,EAMPpG,EAAG,KAMHu9B,aAAc,EAMdC,UAAW,EAUXlhD,OAAQ,SAAUqZ,EAAM,MAAOC,EAAO,OAErCrZ,KAAKoZ,MAAQA,EACbpZ,KAAKqZ,OAASA,EAEdrZ,KAAK6pB,MAAQg3B,GAAUtD,QAAUsD,GAAUpD,YAM5Cz1C,OAAQ,aAYRy2C,QAAS,SAAUn/C,EAAM,MAExB,OAAc,OAAVA,KACOU,KAAK6pB,MAAQg3B,GAAUtD,UAElCv9C,KAAK6pB,QAAUg3B,GAAUtD,QACrBj+C,IAAOU,KAAK6pB,OAASg3B,GAAUtD,SAE5Bv9C,OAWRg/C,UAAW,SAAU1/C,EAAM,MAE1B,OAAc,OAAVA,KACOU,KAAK6pB,MAAQg3B,GAAUpD,aAElCz9C,KAAK6pB,QAAUg3B,GAAUpD,WACrBn+C,IAAOU,KAAK6pB,OAASg3B,GAAUpD,YAE5Bz9C,OAORkhD,kBAAmB,SAAU/hB,GAG5B,OADAn/B,KAAK8gD,eAAiB3hB,EACfn/B,MAORmhD,YAAa,SAAUjoC,EAAM4T,GAG5B,OADAA,EAAKm0B,YACE/nC,EAAKkQ,KAAK0D,EAAKrJ,IAOvB29B,MAAO,SAAUloC,GAEhBA,EAAKmoC,SAAWrhD,KAAK6gB,QAAW3H,EAAKooC,QAAUpoC,EAAKimB,OAAOrhB,GAAO,SAQnEmhC,KAAM,SAAU/lC,GAEf,MAAM,IAAIrT,MAAO,oCAOlBqD,MAAO,WAEN,MAAM,IAAIrD,MAAO,qCAOlB8D,MAAO,WAEN,MAAM,IAAI9D,MAAO,qCAOlBwI,IAAK,SAAU6K,GAEd,MAAM,IAAIrT,MAAO,mCAOlBwE,OAAQ,SAAU6O,GAEjB,MAAM,IAAIrT,MAAO,sCAOlBujB,KAAM,SAAS3F,GAEd,IAAKzjB,KAAKy+C,UAAW,OAErB,IAAI8C,EAAmB99B,EAAEyC,cAAclmB,KAAK6pB,MAAQg3B,GAAUpD,YAE9Dh6B,EAAE5C,OAAS7gB,KAAK6gB,OAEhB7gB,KAAKihD,WAAY,EACjBjhD,KAAKyjB,EAAIA,EAETzjB,KAAKk/B,SAEDqiB,GAAkB99B,EAAE0C,gBAOzB+Y,OAAQ,WAEP,MAAM,IAAIr5B,MAAO,wCAQnBg7C,GAAUtD,QAAU,EACpBsD,GAAUpD,WAAa,MAEvB+D,GAAeX;;;;;iBCjOf;MAAMY,GAAW/hD,EAAMC,OACtB,CACAiG,UAAW,WAQXwT,MAAO,EAAGsoC,aAAc,EACxBroC,OAAQ,EAAGsoC,cAAe,EAK1BxxC,GAAI,EACJC,GAAI,EAKJ7Q,EAAG,EACH6N,EAAG,EAKHw0C,aAAc,EACdC,aAAc,EAKdrvC,OAAQ,KAOR2qC,UAAW,KAMX2E,aAAc,EACdC,aAAc,EAKdC,UAAW,KACXC,WAAY,EACZC,WAAY,EAKZC,YAAY,EACZC,YAAY,EAKZv4B,MAAO,EAKPnd,MAAO,EAKPqX,YAAa,EAObob,OAAQ,KAKRkjB,QAAS,KAOTC,YAAa,KAObC,aAAc,KAKdC,SAAU,KAcVziD,OAAQ,SAAUoQ,EAAIC,EAAIgJ,EAAOC,EAAQopC,EAAgBC,GAExD1iD,KAAK8hD,aAAe,GACpB9hD,KAAK+hD,aAAe,GACpB/hD,KAAKgiD,UAAY,KAEjBhiD,KAAKmQ,GAAKA,EACVnQ,KAAKoQ,GAAKA,EACVpQ,KAAKoZ,MAAQpZ,KAAK0hD,aAAetoC,EACjCpZ,KAAKqZ,OAASrZ,KAAK2hD,cAAgBtoC,EAEnCrZ,KAAKT,EAAI,EACTS,KAAKoN,EAAI,EAETpN,KAAKm/B,OAASoW,GAAQ3sC,KAAK3B,QAC3BjH,KAAKqiD,QAAU,KAEfriD,KAAKsiD,YAAc/M,GAAQ3sC,KAAK3B,QAChCjH,KAAKuiD,aAAehN,GAAQ3sC,KAAK3B,QACjCjH,KAAKm9C,UAAY5H,GAAQ3sC,KAAK3B,QAC9BjH,KAAKwS,OAASmiC,GAAO/rC,KAAK3B,QAE1BjH,KAAK6pB,MAAQ43B,GAASkB,QACtB3iD,KAAKwiD,SAAW7N,GAAO/rC,KAAK3B,QAE5BjH,KAAK4iD,oBAAoBH,GAAgB,GAAIC,GAAiB,EAAGD,GAAgB,EAAGC,GAAiB,GAErG1iD,KAAK6iD,qBACL7iD,KAAK8iD,gBAMN96C,OAAQ,WAEPhI,KAAKm/B,OAAOt3B,OACZ7H,KAAKsiD,YAAYz6C,OACjB7H,KAAKuiD,aAAa16C,OAClB7H,KAAKm9C,UAAUt1C,OACf7H,KAAKwiD,SAAS36C,OAEO,OAAjB7H,KAAKqiD,SACRriD,KAAKqiD,QAAQx6C,QAaf0jC,QAAS,SAAUjsC,EAAM,MAExB,OAAc,OAAVA,KACOU,KAAK6pB,MAAQ43B,GAASkB,UAEjC3iD,KAAK6pB,QAAU43B,GAASkB,QACpBrjD,IAAOU,KAAK6pB,OAAS43B,GAASkB,SAE3B3iD,OAWR+iD,QAAS,SAAUzjD,EAAM,MAExB,OAAc,OAAVA,KACOU,KAAK6pB,MAAQ43B,GAASuB,WAEjChjD,KAAK6pB,QAAU43B,GAASuB,SACpB1jD,IAAOU,KAAK6pB,OAAS43B,GAASuB,UAE3BhjD,OAaR4iD,mBAAoB,SAAUjlC,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAiBtD,OAfW,OAAPF,IAEHE,EAAKH,EAAGG,GACRD,EAAKF,EAAGE,GACRD,EAAKD,EAAGC,GACRD,EAAKA,EAAGA,IAGT3d,KAAKoZ,MAAQpZ,KAAK0hD,aAClB1hD,KAAKqZ,OAASrZ,KAAK2hD,cAEf3hD,KAAKoZ,MAAQyE,EAAGF,IAAI3d,KAAKoZ,MAAQyE,EAAGF,GACpC3d,KAAKqZ,OAASyE,EAAGF,IAAI5d,KAAKqZ,OAASyE,EAAGF,GAE1C5d,KAAKm9C,UAAU9vC,IAAIsQ,EAAIC,EAAIC,EAAIC,GACxB9d,MAaRijD,WAAY,SAAUtlC,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAY9C,OAVqB,OAAjB9d,KAAKqiD,UACRriD,KAAKqiD,QAAU9M,GAAQ3sC,KAAK3B,SAElB,OAAP2W,IAEHC,EAAKC,EAAKH,EACVA,EAAKC,GAAMD,GAGZ3d,KAAKqiD,QAAQh1C,IAAIsQ,EAAIC,EAAIC,EAAIC,GACtB9d,MAMR8iD,aAAc,SAAUI,GAAoB,GAE3C,IAAI3mC,EAAGC,EAAG2mC,EAAIC,EACVzlC,EAAIC,EAAIC,EAAIC,EAEhBvB,EAAIvc,KAAKoZ,OAAS,EAClBoD,EAAIxc,KAAKqZ,QAAU,EAEnB8pC,EAAM5mC,EAAEvc,KAAK0M,MACb02C,EAAM5mC,EAAExc,KAAK0M,MAEbiR,EAAK3d,KAAKT,EAAE4jD,EAAGnjD,KAAKwS,OAAOjT,EAC3Bqe,EAAK5d,KAAKoN,EAAEg2C,EAAGpjD,KAAKwS,OAAOpF,EAC3ByQ,EAAK7d,KAAKT,EAAE4jD,EAAGnjD,KAAKwS,OAAOjT,EAC3Bue,EAAK9d,KAAKoN,EAAEg2C,EAAGpjD,KAAKwS,OAAOpF,EAEvB81C,IAECvlC,EAAK3d,KAAKm9C,UAAUx/B,GACvB3d,KAAKwS,OAAOjF,KAAKvN,KAAKm9C,UAAUx/B,GAAK3d,KAAKT,EAAI4jD,GACtCtlC,EAAK7d,KAAKm9C,UAAUt/B,IAC5B7d,KAAKwS,OAAOjF,KAAKvN,KAAKm9C,UAAUt/B,GAAK7d,KAAKT,EAAI4jD,GAE3CvlC,EAAK5d,KAAKm9C,UAAUv/B,GACvB5d,KAAKwS,OAAOhF,KAAKxN,KAAKm9C,UAAUv/B,GAAK5d,KAAKoN,EAAIg2C,GACtCtlC,EAAK9d,KAAKm9C,UAAUr/B,IAC5B9d,KAAKwS,OAAOhF,KAAKxN,KAAKm9C,UAAUr/B,GAAK9d,KAAKoN,EAAIg2C,GAE/CzlC,EAAK3d,KAAKT,EAAE4jD,EAAGnjD,KAAKwS,OAAOjT,EAC3Bqe,EAAK5d,KAAKoN,EAAEg2C,EAAGpjD,KAAKwS,OAAOpF,EAC3ByQ,EAAK7d,KAAKT,EAAE4jD,EAAGnjD,KAAKwS,OAAOjT,EAC3Bue,EAAK9d,KAAKoN,EAAEg2C,EAAGpjD,KAAKwS,OAAOpF,GAG5BpN,KAAKm/B,OAAO9xB,IAAKsQ,EAAIC,EAAIC,EAAIC,GAER,OAAjB9d,KAAKqiD,SACRriD,KAAKm/B,OAAO9wB,IAAKrO,KAAKqiD,SAEvBriD,KAAKsiD,YAAYj1C,IAChBrN,KAAKT,GAAKS,KAAK8hD,aAAavlC,EAAIvc,KAAK4hD,aAAarlC,GAAGvc,KAAK0M,MAAO1M,KAAKoN,GAAKpN,KAAK+hD,aAAavlC,EAAIxc,KAAK6hD,aAAarlC,GAAGxc,KAAK0M,MAC3H1M,KAAKT,GAAKS,KAAK8hD,aAAavlC,EAAIvc,KAAK4hD,aAAarlC,GAAGvc,KAAK0M,MAAO1M,KAAKoN,GAAKpN,KAAK+hD,aAAavlC,EAAIxc,KAAK6hD,aAAarlC,GAAGxc,KAAK0M,QAO7Hm2C,mBAAoB,WAEnB7iD,KAAKuiD,aAAal1C,IAAKrN,KAAKmQ,GAAInQ,KAAKoQ,GAAIpQ,KAAKmQ,GAAKnQ,KAAKoZ,MAAOpZ,KAAKoQ,GAAKpQ,KAAKqZ,SAQ/E+B,OAAQ,SAAUhC,EAAOC,GAQxB,OANArZ,KAAKoZ,MAAQpZ,KAAK0hD,aAAetoC,MAAAA,EAAAA,EAASpZ,KAAKoZ,MAC/CpZ,KAAKqZ,OAASrZ,KAAK2hD,cAAgBtoC,MAAAA,EAAAA,EAAUrZ,KAAKqZ,OAElDrZ,KAAK6iD,qBACL7iD,KAAK8iD,eAEE9iD,MAQRwyC,SAAU,SAAU0M,EAAQC,GAW3B,OATAn/C,KAAKoZ,OAAS8lC,EACdl/C,KAAKqZ,QAAU8lC,EAEfn/C,KAAK0hD,aAAe1hD,KAAKoZ,MACzBpZ,KAAK2hD,cAAgB3hD,KAAKqZ,OAE1BrZ,KAAK6iD,qBACL7iD,KAAK8iD,eAEE9iD,MASRo/C,YAAa,SAAU7/C,EAAG6N,GAQzB,OANApN,KAAKT,EAAIA,MAAAA,EAAAA,EAAKS,KAAKT,EACnBS,KAAKoN,EAAIA,MAAAA,EAAAA,EAAKpN,KAAKoN,EAEnBpN,KAAKwS,OAAOnF,IAAI,EAAG,GACnBrN,KAAK8iD,eAEE9iD,MAQRqjD,WAAY,SAAUt1C,EAAIC,GAKzB,OAHAhO,KAAKwS,OAAOnF,IAAIU,EAAIC,GACpBhO,KAAK8iD,eAEE9iD,MAQRsjD,SAAU,SAAUhkD,GAInB,OAFAU,KAAK0M,MAAQpN,EACbU,KAAK8iD,eACE9iD,MAQRujD,SAAU,WAET,OAAOvjD,KAAK0M,OAQb82C,eAAgB,SAAUlkD,GAGzB,OADAU,KAAK+jB,YAAczkB,EACZU,MAQRyjD,eAAgB,WAEf,OAAOzjD,KAAK+jB,aAQb2/B,UAAW,SAAUz7B,EAAIE,GAKxB,OAHAnoB,KAAK4hD,aAAe35B,EACpBjoB,KAAK6hD,aAAe15B,EAEbnoB,MASR8N,UAAW,SAAUC,EAAIC,EAAIk1C,GAAoB,GAKhD,OAHAljD,KAAKwS,OAAOnE,IAAIN,EAAIC,GAEpBhO,KAAK8iD,aAAaI,GACXljD,MAQR2jD,kBAAmB,SAAUxzC,EAAIC,GAMhC,OAJApQ,KAAKmQ,GAAKA,EACVnQ,KAAKoQ,GAAKA,EAEVpQ,KAAK6iD,qBACE7iD,MASR4jD,KAAM,SAAUrqC,GAAS,GAExB,OAAOvZ,KAAKT,GAAKga,EAAW,EAAIvZ,KAAKwS,OAAOjT,IAS7CskD,KAAM,SAAUtqC,GAAS,GAExB,OAAOvZ,KAAKoN,GAAKmM,EAAW,EAAIvZ,KAAKwS,OAAOpF,IAQ7C02C,WAAY,WAEX,OAAO9jD,KAAKwS,OAAOjT,GAQpBwkD,WAAY,WAEX,OAAO/jD,KAAKwS,OAAOpF,GAQpB42C,SAAU,WAET,OAAOhkD,KAAKoZ,OAQb6qC,UAAW,WAEV,OAAOjkD,KAAKqZ,QAQb6qC,OAAQ,SAAU3Q,EAAI3jC,EAAG,KAAMmwC,EAAG,MAEtB,OAAPA,IAAaA,EAAK//C,KAAK8hD,cAChB,OAAPlyC,IAAaA,EAAK2jC,GAEtB,IAAIh3B,EAAIvc,KAAKoZ,OAAS,EAElBuE,EAAK3d,KAAKT,EAAIuG,KAAKi6C,EAAGxjC,EAAIvc,KAAK4hD,aAAarlC,GAAGvc,KAAK0M,OACpDmR,EAAK7d,KAAKT,EAAIuG,KAAKi6C,EAAGxjC,EAAIvc,KAAK4hD,aAAarlC,GAAGvc,KAAK0M,OAEpDiR,GAAME,IACT01B,EAAK3jC,EAAM2jC,EAAK3jC,GAAO,GAExB,IAAIU,EAAKtQ,KAAKT,EAYd,OAVIg0C,EAAK51B,EAAIrN,GAAOijC,EAAK51B,EAChB/N,EAAKiO,IAAIvN,GAAOV,EAAKiO,GAE9BF,EAAKrN,EAAKiM,EACVsB,EAAKvN,EAAKiM,EAENoB,EAAK3d,KAAKm9C,UAAUx/B,KAAIrN,EAAKtQ,KAAKm9C,UAAUx/B,GAAKpB,GACjDsB,EAAK7d,KAAKm9C,UAAUt/B,KAAIvN,EAAKtQ,KAAKm9C,UAAUt/B,GAAKtB,GAErDvc,KAAKT,EAAI+Q,EACFtQ,MAQRmkD,OAAQ,SAAU3D,EAAIC,EAAG,KAAMT,EAAG,MAEtB,OAAPA,IAAaA,EAAKhgD,KAAK+hD,cAChB,OAAPtB,IAAaA,EAAKD,GAEtB,IAAIhkC,EAAIxc,KAAKqZ,QAAU,EAEnBuE,EAAK5d,KAAKoN,EAAItH,KAAKk6C,EAAGxjC,EAAIxc,KAAK6hD,aAAarlC,GAAGxc,KAAK0M,OACpDoR,EAAK9d,KAAKoN,EAAItH,KAAKk6C,EAAGxjC,EAAIxc,KAAK6hD,aAAarlC,GAAGxc,KAAK0M,OAEpDkR,GAAME,IACT0iC,EAAKC,EAAMD,EAAKC,GAAO,GAExB,IAAIlwC,EAAKvQ,KAAKoN,EAYd,OAVIozC,EAAK5iC,EAAIrN,GAAOiwC,EAAK5iC,EAChB6iC,EAAK3iC,IAAIvN,GAAOkwC,EAAK3iC,GAE9BF,EAAKrN,EAAKiM,EACVsB,EAAKvN,EAAKiM,EAENoB,EAAK5d,KAAKm9C,UAAUv/B,KAAIrN,EAAKvQ,KAAKm9C,UAAUv/B,GAAKpB,GACjDsB,EAAK9d,KAAKm9C,UAAUr/B,KAAIvN,EAAKvQ,KAAKm9C,UAAUr/B,GAAKtB,GAErDxc,KAAKoN,EAAImD,EACFvQ,MAQRuwB,OAAQ,SAAUoB,EAAG,GAEG,OAAnB3xB,KAAKgiD,YAGLhiD,KAAKmiD,YACRniD,KAAKkkD,OAAQlkD,KAAKgiD,UAAUrkC,GAAK3d,KAAKiiD,WAAYjiD,KAAKgiD,UAAUnkC,GAAK7d,KAAKiiD,YAExEjiD,KAAKoiD,YACRpiD,KAAKmkD,OAAQnkD,KAAKgiD,UAAUpkC,GAAK5d,KAAKkiD,WAAYliD,KAAKgiD,UAAUlkC,GAAK9d,KAAKkiD,YAE5EliD,KAAK8iD,iBAQNsB,aAAc,SAAUzyB,EAAG,GAEH,OAAnB3xB,KAAKgiD,YAGThiD,KAAKkkD,OAAQlkD,KAAKgiD,UAAUrkC,GAAK3d,KAAKiiD,WAAYjiD,KAAKgiD,UAAUnkC,GAAK7d,KAAKiiD,YAC3EjiD,KAAKmkD,OAAQnkD,KAAKgiD,UAAUpkC,GAAK5d,KAAKkiD,WAAYliD,KAAKgiD,UAAUlkC,GAAK9d,KAAKkiD,YAE3EliD,KAAK8iD,iBAQNuB,aAAc,SAAU/nC,EAAMoO,EAAM,EAAGC,EAAM,GAQ5C,OANA3qB,KAAKgiD,UAAY1lC,EAEjBtc,KAAKiiD,WAAav3B,EAClB1qB,KAAKkiD,WAAav3B,EAElB3qB,KAAKuwB,OAAO,GACLvwB,MAQRskD,gBAAiB,SAAU55B,EAAOC,GAKjC,OAHA3qB,KAAKiiD,WAAav3B,EAClB1qB,KAAKkiD,WAAav3B,EAEX3qB,MAQRukD,aAAc,SAAUC,EAAUC,GAKjC,OAHAzkD,KAAKmiD,WAAaqC,EAClBxkD,KAAKoiD,WAAaqC,EAEXzkD,MAQR0kD,eAAgB,SAAUC,EAAQC,GAKjC,OAHA5kD,KAAK8hD,aAAe6C,EACpB3kD,KAAK+hD,kBAA0BhoB,IAAX6qB,EAAuBD,EAASC,EAE7C5kD,MAQR6kD,UAAW,SAAUphC,GAEpBA,EAAE7G,KAAK5c,KAAKuiD,aAAa5kC,GAAI3d,KAAKuiD,aAAa3kC,GAAI5d,KAAKuiD,aAAanpC,QAASpZ,KAAKuiD,aAAalpC,WAQjGyrC,eAAgB,SAAUrhC,GAEnBzjB,KAAK6pB,MAAQ43B,GAASuB,SAG3Bv/B,EAAE3V,UAAW9N,KAAKuiD,aAAa5kC,GAAI3d,KAAKuiD,aAAa3kC,IAFrD6F,EAAE3V,UAAW9N,KAAKuiD,aAAa7Q,GAAI1xC,KAAKuiD,aAAa5Q,IAIpC,GAAd3xC,KAAK0M,OACR+W,EAAE/W,MAAO1M,KAAK0M,MAAO1M,KAAK0M,OAEH,GAApB1M,KAAK+jB,aACRN,EAAE/W,MAAO1M,KAAK+jB,YAAa/jB,KAAK+jB,aAE3B/jB,KAAK6pB,MAAQ43B,GAASuB,SAG3Bv/B,EAAE3V,WAAY9N,KAAKm/B,OAAOxhB,IAAK3d,KAAKm/B,OAAOvhB,IAF3C6F,EAAE3V,WAAY9N,KAAKm/B,OAAOuS,IAAK1xC,KAAKm/B,OAAOwS,IAI5CluB,EAAExI,mBAeH8pC,aAAc,SAAUxlD,EAAG6N,EAAE,KAAMqB,GAAM,GASxC,IAAIu2C,EAAMC,EA+BV,OAtCU,OAAN73C,IAAoB,IAANA,IAEjBqB,GAAc,IAANrB,EACRA,EAAI7N,EAAE6N,EACN7N,EAAIA,EAAEA,GAKDS,KAAK6pB,MAAQ43B,GAASuB,UAgB3BgC,EAAOhlD,KAAKuiD,aAAa5kC,GACzBsnC,EAAOjlD,KAAKuiD,aAAa3kC,GAErBnP,GACHlP,GAAMA,EAAIuG,IAAIk/C,IAAShlD,KAAK0M,MAAS5G,IAAI9F,KAAKm/B,OAAOxhB,IACrDvQ,GAAMA,EAAItH,IAAIm/C,IAASjlD,KAAK0M,MAAS5G,IAAI9F,KAAKm/B,OAAOvhB,MAGrDre,GAAMA,EAAIylD,GAAQhlD,KAAK0M,MAAS1M,KAAKm/B,OAAOxhB,GAC5CvQ,GAAMA,EAAI63C,GAAQjlD,KAAK0M,MAAS1M,KAAKm/B,OAAOvhB,MAvB7ConC,EAAOhlD,KAAKuiD,aAAa7Q,GACzBuT,EAAOjlD,KAAKuiD,aAAa5Q,GAErBljC,GACHlP,GAAMA,EAAIuG,IAAIk/C,IAAShlD,KAAK0M,MAAS5G,IAAI9F,KAAKm/B,OAAOuS,IACrDtkC,GAAMA,EAAItH,IAAIm/C,IAASjlD,KAAK0M,MAAS5G,IAAI9F,KAAKm/B,OAAOwS,MAGrDpyC,GAAMA,EAAIylD,GAAQhlD,KAAK0M,MAAS1M,KAAKm/B,OAAOuS,GAC5CtkC,GAAMA,EAAI63C,GAAQjlD,KAAK0M,MAAS1M,KAAKm/B,OAAOwS,KAkBvC3xC,KAAKwiD,SAASn1C,IAAI9N,EAAG6N,IAe7B83C,cAAe,SAAU3lD,EAAG6N,EAAE,KAAMqB,GAAM,GASzC,IAAIu2C,EAAMC,EA+BV,OAtCU,OAAN73C,IAAoB,IAANA,IAEjBqB,GAAc,IAANrB,EACRA,EAAI7N,EAAE6N,EACN7N,EAAIA,EAAEA,GAKDS,KAAK6pB,MAAQ43B,GAASuB,UAgB3BgC,EAAOhlD,KAAKuiD,aAAa5kC,GACzBsnC,EAAOjlD,KAAKuiD,aAAa3kC,GAErBnP,GACHlP,GAAKA,EAAIuG,IAAI9F,KAAKm/B,OAAOxhB,KAAO3d,KAAK0M,MAAQ5G,IAAIk/C,GACjD53C,GAAKA,EAAItH,IAAI9F,KAAKm/B,OAAOvhB,KAAO5d,KAAK0M,MAAQ5G,IAAIm/C,KAGjD1lD,GAAKA,EAAIS,KAAKm/B,OAAOxhB,IAAM3d,KAAK0M,MAAQs4C,EACxC53C,GAAKA,EAAIpN,KAAKm/B,OAAOvhB,IAAM5d,KAAK0M,MAAQu4C,KAvBzCD,EAAOhlD,KAAKuiD,aAAa7Q,GACzBuT,EAAOjlD,KAAKuiD,aAAa5Q,GAErBljC,GACHlP,GAAKA,EAAIuG,IAAI9F,KAAKm/B,OAAOuS,KAAO1xC,KAAK0M,MAAQ5G,IAAIk/C,GACjD53C,GAAKA,EAAItH,IAAI9F,KAAKm/B,OAAOwS,KAAO3xC,KAAK0M,MAAQ5G,IAAIm/C,KAGjD1lD,GAAKA,EAAIS,KAAKm/B,OAAOuS,IAAM1xC,KAAK0M,MAAQs4C,EACxC53C,GAAKA,EAAIpN,KAAKm/B,OAAOwS,IAAM3xC,KAAK0M,MAAQu4C,IAkBnCjlD,KAAKwiD,SAASn1C,IAAI9N,EAAG6N,MAO9Bq0C,GAASkB,QAAU,EACnBlB,GAASuB,SAAW,MAEpBmC,GAAe1D;;;;;;;oCCj0Bf;MAAM2D,GAAU1F,GAAY//C,OAC3B,CACAiG,UAAW,UAMX6C,MAAO,KAMP+V,IAAK,KAOL2U,aAAa,EAKbmuB,QAAS,EAKTD,SAAU,EAKVtmC,OAAQ,EAKRsqC,eAAgB,KAKhB3vC,eAAgB,KAMhBwpB,OAAQ,KAURn/B,OAAQ,SAASR,EAAG6N,EAAGgM,EAAM,KAAMC,EAAO,KAAMmF,EAAI,MAErC,OAAVpF,IACHA,EAAQC,EAAS,GAEH,OAAXA,IAGHD,GADAoF,EAAMpF,GACMA,MACZC,EAASmF,EAAInF,QAGdrZ,KAAK6I,OAAOy8C,YAAYvlD,OAAOR,EAAG6N,EAAGgM,EAAOC,GAC5CrZ,KAAKwe,IAAc,OAARA,EAAeA,EAAIigB,cAAgBjgB,EAE9Cxe,KAAKyI,MAAQ,KACbzI,KAAKmzB,aAAc,EAEnBnzB,KAAKshD,QAAU,EACfthD,KAAKqhD,SAAW,EAChBrhD,KAAK+a,OAAS,EAEd/a,KAAKqlD,eAAiB,KACtBrlD,KAAK0V,eAAiB,KAEtB1V,KAAKk/B,OAAS,MAMfl3B,OAAQ,WAEU,OAAbhI,KAAKwe,MAERzU,QAAQ/J,KAAKwe,KACbxe,KAAKwe,IAAM,MAGZxe,KAAK6I,OAAOy8C,YAAYt9C,UAOzBu9C,aAAc,WAERvlD,KAAK09C,UAEa,OAAnB19C,KAAKm9C,UACRn9C,KAAKm9C,UAAU4D,MAAMyE,aAAaxlD,MAElC+J,QAAQ/J,QAcVuI,MAAO,SAAUjJ,EAAM,MAEtB,OAAc,OAAVA,EACIU,KAAKmzB,aAEbnzB,KAAKmzB,YAAwB,IAAV7zB,GAAqBA,EACjCU,OAcRoa,MAAO,SAAU9a,EAAM,MAEtB,OAAc,OAAVA,EACIU,KAAK+a,QAEb/a,KAAK+a,OAASzb,EACPU,OAcR6gB,OAAQ,SAAUvhB,EAAM,MAEvB,OAAc,OAAVA,EACIU,KAAKshD,SAEbthD,KAAKshD,QAAUhiD,EACRU,OAcR6Y,cAAe,SAAUA,GAAc,GAEtC,OAAsB,IAAlBA,EACI7Y,KAAKqlD,gBAEiB,iBAAnBxsC,IACVA,EAAgBC,EAAc3F,IAAI0F,IAEnC7Y,KAAKqlD,eAAiBxsC,EACf7Y,OASR4V,cAAe,SAAUA,GAGxB,OADA5V,KAAK0V,eAAiBE,EACf5V,MAORopB,KAAM,SAAS3F,GAEd,GAAiB,OAAbzjB,KAAKwe,KAAgC,OAAhBxe,KAAKk/B,OAC9B,CACC,IAAIumB,EAAwC,OAAxBzlD,KAAKqlD,gBAA0B5hC,EAAE4C,kBAAkBrmB,KAAKqlD,gBACxE9D,IAAmBvhD,KAAK8+C,oBAAqBr7B,EAAEyC,cAAclmB,KAAKg/C,aAE1C,OAAxBh/C,KAAKqlD,gBAAmD,OAAxBrlD,KAAK0V,gBAAoC,OAAT+N,EAAEtS,IACrEnR,KAAK0V,eAAgB+N,EAAE2C,mBAAoBpmB,KAAMyjB,EAAEtS,IAEpDsS,EAAE5C,OAAS7gB,KAAKqhD,SAEG,GAAfrhD,KAAK+a,SAER0I,EAAEqC,YACFrC,EAAErJ,MAAMpa,KAAK+a,SAGM,OAAhB/a,KAAKk/B,OACRl/B,KAAKk/B,OAAOzb,EAAGzjB,KAAMA,KAAKwe,KAE1Bxe,KAAKwe,IAAI0gB,OAAOzb,EAAGzjB,MAEhBuhD,GAAkB99B,EAAE0C,eACpBs/B,GAAehiC,EAAE6C,mBAEF,GAAftmB,KAAK+a,QACR0I,EAAEsC,WAIJ,GAAIzL,EAAE6Y,aAAenzB,KAAKmzB,YAC1B,CACC,IAAI+M,EAAIzc,EAAE+C,aACV/C,EAAI+F,EAAO0B,gBAETtF,aACFnC,EAAE8C,WAAW2Z,GACbzc,EAAEtI,UAAUiqC,GAAQM,cAAc1lD,KAAKmzB,cACvC1P,EAAE/G,SAAS1c,KAAKm/B,OAAOxhB,GAAI3d,KAAKm/B,OAAOvhB,GAAI5d,KAAKm/B,OAAO/lB,QAASpZ,KAAKm/B,OAAO9lB,UAC5EoK,EAAEoC,cASJ8/B,WAAY,SAAUC,GAGrB,OADA5lD,KAAKk/B,OAAS0mB,MAAAA,EAAAA,EAAkB,KACzB5lD,QAQTolD,GAAQS,YAAc,CACrB,uBACA,uBACA,uBACA,yBACA,qBACA,qBACA,qBACA,0BAODT,GAAQM,cAAgB,SAAUvyB,GAKjC,OAHoB,IAAhBA,IAAwC,IAAhBA,IAC3BA,EAAc,GAERiyB,GAAQS,YAA8B,IAAf1yB;;;;AAiB/B7tB,EAASqD,WAAWy8C,QACpBU,GAAeV;;;;+BCpUf;MAAMW,GAAYpR,GAAO/rC,KAAK3B,QAQxB++C,GAAQF,GAAQnmD,OACrB,CACAiG,UAAW,QAMXqgD,SAAU,KAMV58C,IAAK,KAMLtJ,OAAQ,SAAUmU,EAAG,MAEpBlU,KAAK6I,OAAOq9C,QAAQnmD,OAAO,EAAG,EAAG,EAAG,GAEpCC,KAAKimD,SAAW56C,EAAKzC,KAAK3B,QAC1BjH,KAAKm/B,OAAOx1B,QAEZ3J,KAAKqJ,IAAMsrC,GAAO/rC,KAAK3B,QACvBjH,KAAK29C,MAAMzpC,IAMZlM,OAAQ,WAEPhI,KAAKkJ,QACLlJ,KAAKimD,SAASp+C,OACd7H,KAAKqJ,IAAIxB,OAET7H,KAAK6I,OAAOq9C,QAAQl+C,UAOrBu9C,aAAc,WAEb,IAAKvlD,KAAK09C,QAAS,OAEnB,IAAIx9C,EAEJ,KAAsC,OAA9BA,EAAIF,KAAKimD,SAASv7C,UAEzBxK,EAAEm9C,QAAQhzC,OAAOrK,KAAKogD,QAASpgD,MAC/BE,EAAEuI,MAAQ,KACVvI,EAAEqlD,eAGHvlD,KAAK6I,OAAOq9C,QAAQX,gBAOrBr8C,MAAO,WAEN,IAAIhJ,EAEJ,KAAsC,OAA9BA,EAAIF,KAAKimD,SAASv7C,UAEzBxK,EAAEm9C,QAAQhzC,OAAOrK,KAAKogD,QAASpgD,MAC/BE,EAAEuI,MAAQ,KACVsB,QAAQ7J,GAGT,OAAOF,MAOR2J,MAAO,WAEN,IAAIzJ,EAEJ,KAAsC,OAA9BA,EAAIF,KAAKimD,SAASv7C,UAEzBxK,EAAEm9C,QAAQhzC,OAAOrK,KAAKogD,QAASpgD,MAC/BE,EAAEuI,MAAQ,KAGX,OAAOzI,MAcRmmD,YAAa,SAAU7mD,EAAM,MAE5B,OAAc,OAAVA,KACOU,KAAK6pB,MAAQ61B,GAAYL,eAEpCr/C,KAAK6pB,QAAU61B,GAAYL,aACvB//C,IAAOU,KAAK6pB,OAAS61B,GAAYL,cAE9Br/C,OAQRomD,SAAU,SAAUltC,EAAMmtC,GAAS,GAElC,IAAKntC,EAAM,OAAOA,EAElB,IAAI+hC,EAA6B,OAAnBj7C,KAAKm/B,OAAOxhB,GAqB1B,OAnBIs9B,GAAYj7C,KAAK6pB,MAAQ61B,GAAYL,iBAEpCpE,GAAW/hC,EAAKimB,OAAOxhB,GAAK3d,KAAKm/B,OAAOxhB,KAAI3d,KAAKsmD,WAAWptC,EAAKimB,OAAOxhB,GAAK3d,KAAKm/B,OAAOxhB,GAAI,IAC7Fs9B,GAAW/hC,EAAKimB,OAAOvhB,GAAK5d,KAAKm/B,OAAOvhB,KAAI5d,KAAKsmD,WAAW,EAAGptC,EAAKimB,OAAOvhB,GAAK5d,KAAKm/B,OAAOvhB,KAC5Fq9B,GAAW/hC,EAAKimB,OAAOthB,GAAK7d,KAAKm/B,OAAOthB,KAAI7d,KAAKwyC,SAASt5B,EAAKimB,OAAOthB,GAAK7d,KAAKm/B,OAAOthB,GAAI,IAC3Fo9B,GAAW/hC,EAAKimB,OAAOrhB,GAAK9d,KAAKm/B,OAAOrhB,KAAI9d,KAAKwyC,SAAS,EAAGt5B,EAAKimB,OAAOrhB,GAAK9d,KAAKm/B,OAAOrhB,KAG/F9d,KAAKimD,SAASn/C,KAAKoS,GAEH,OAAZA,EAAKhF,KACRlU,KAAKkZ,EAAKhF,IAAMgF,IAEA,IAAbmtC,GACHntC,EAAKpL,UAAU9N,KAAKm/B,OAAOxhB,GAAI3d,KAAKm/B,OAAOvhB,IAE5C1E,EAAKzQ,MAAQzI,KACbkZ,EAAKmkC,QAAQhvC,IAAIrO,KAAKogD,QAASpgD,KAAMA,KAAKimD,SAASv8C,QAE5CwP,GAORqtC,SAAU,SAAUryC,GAEnB,OAAOlU,KAAKkU,IAAO,MAMpBksC,QAAS,SAAUlnC,EAAM4T,EAAMif,GAQ9B,OANAjf,EAAKm5B,SAAS57C,OAAO0hC,GACrB7yB,EAAKzQ,MAAQ,KAEG,OAAZyQ,EAAKhF,KACR4Y,EAAK5T,EAAKhF,IAAM,OAEV,GAORkP,YAAa,SAAUlK,GAEtB,OAAKA,GAAQA,EAAKzQ,QAAUzI,MAG5BkZ,EAAKmkC,QAAQ/L,MAAMtxC,KAAKogD,QAASpgD,MAC1BkZ,GAHCA,GAST+lC,KAAM,WAEL,IAAK,IAAI/+C,EAAIF,KAAKimD,SAASx8C,IAAKvJ,EAAGA,EAAIA,EAAE+I,KACxC/I,EAAEZ,MAAM2/C,OAET,OAAOj/C,KAAK6I,OAAOq9C,QAAQjH,QAQ5BqH,WAAY,SAAUv4C,EAAIC,EAAI0mC,GAAS,GAEtC,OAAO10C,KAAK6I,OAAOq9C,QAAQp4C,UAAUC,EAAIC,EAAI0mC,IAQ9C5mC,UAAW,SAAUC,EAAIC,EAAI0mC,GAAS,GAErC,IAAI8R,EAAMxmD,KAAKm/B,OAAOxhB,GAClB8oC,EAAMzmD,KAAKm/B,OAAOvhB,GAEtB5d,KAAK6I,OAAOq9C,QAAQp4C,UAAUC,EAAIC,EAAI0mC,GACtC10C,KAAKqJ,IAAIgF,IAAIN,EAAIC,EAAI0mC,GAErB8R,EAAMxmD,KAAKm/B,OAAOxhB,GAAK6oC,EACvBC,EAAMzmD,KAAKm/B,OAAOvhB,GAAK6oC,EAEvB,IAAK,IAAIvmD,EAAIF,KAAKimD,SAASx8C,IAAKvJ,EAAGA,EAAIA,EAAE+I,KACxC/I,EAAEZ,MAAMwO,UAAU04C,EAAKC,GAExB,OAAOzmD,MAQR0mD,WAAY,SAAU34C,EAAIC,EAAI0mC,GAAS,GAEtCqR,GAAU14C,IAAIrN,KAAKm/B,OAAO4V,IAAK/0C,KAAKm/B,OAAO6V,KAAK,GAEhD,IAAIwR,EAAMT,GAAUxmD,EAChBknD,EAAMV,GAAU34C,EAYpB,OAVA24C,GAAU13C,IAAIN,EAAIC,EAAI0mC,GAEtB8R,EAAMT,GAAUxmD,EAAIinD,EACpBC,EAAMV,GAAU34C,EAAIq5C,EAEpBV,GAAU14C,IAAIm5C,EAAKC,GAEnBV,GAAUxmD,GAAKwO,EACfg4C,GAAU34C,GAAKY,EAER+3C,IAORnI,SAAU,SAAUt+C,GAEnB,IAAK,IAAIY,EAAIF,KAAKimD,SAASx8C,IAAKvJ,EAAGA,EAAIA,EAAE+I,KACxC/I,EAAEZ,MAAMs+C,SAASt+C,GAElB,OAAOU,KAAK6I,OAAOq9C,QAAQtI,SAASt+C,IAOrCu+C,WAAY,SAAUv+C,GAErB,IAAK,IAAIY,EAAIF,KAAKimD,SAASx8C,IAAKvJ,EAAGA,EAAIA,EAAE+I,KACxC/I,EAAEZ,MAAMu+C,WAAWv+C,GAEpB,OAAOU,KAAK6I,OAAOq9C,QAAQrI,WAAWv+C,IAavCm/C,QAAS,SAAUn/C,EAAM,KAAMo/C,GAAO,GAErC,GAAc,OAAVp/C,EACH,OAAOU,KAAK6I,OAAOq9C,QAAQzH,UAE5B,IAAK,IAAIv+C,EAAIF,KAAKimD,SAASx8C,IAAKvJ,EAAGA,EAAIA,EAAE+I,KACxC/I,EAAEZ,MAAMm/C,QAAQn/C,EAAOo/C,GAExB,OAAO1+C,KAAK6I,OAAOq9C,QAAQzH,QAAQn/C,EAAOo/C,IAc3CtkC,MAAO,SAAU9a,EAAM,MAEtB,GAAc,OAAVA,EACH,OAAOU,KAAK6I,OAAOq9C,QAAQ9rC,QAE5B,IAAK,IAAIla,EAAIF,KAAKimD,SAASx8C,IAAKvJ,EAAGA,EAAIA,EAAE+I,KACxC/I,EAAEZ,MAAM8a,MAAM9a,GAEf,OAAOU,KAAK6I,OAAOq9C,QAAQ9rC,MAAM9a;;;;;AAcnCgG,EAASqD,WAAWq9C,QACpBW,GAAeX;;;;;;;;cC5Uf;MAAMY,GAAQlnD,EAAMC,OACnB,CACAiG,UAAW,QAOXihD,SAAU,KACVC,UAAW,KAOX7oC,SAAU,KACV8oC,UAAW,KAKXC,WAAY,KAKZC,UAAW,KAMXnG,eAAgB,KAKhBoG,UAAW,KAKXC,OAAQ,KAKRC,cAAe,KAMfC,SAAU,KAMVC,QAAS,KAMTC,aAAc,KAMdC,SAAU,KAMVC,UAAW,KAMX91B,GAAI,EAKJ9H,MAAO,EAMPo3B,UAAW,EAKXF,MAAO,KAMPlgC,OAAQ,KAOR9gB,OAAQ,SAASF,GAEhBG,KAAKgnD,WAAa,GAQlBhnD,KAAK6gB,QAAkB,EAARhhB,IAAe,GAE9BG,KAAKinD,UAAY,GACjBjnD,KAAK8gD,eAAiBvL,GAAQ3sC,KAAK3B,QAEnCjH,KAAKknD,UAAY77C,EAAKzC,KAAK3B,QAC3BjH,KAAKmnD,OAAS,GAEdnnD,KAAKonD,cAAgB/7C,EAAKzC,KAAK3B,QAE/BjH,KAAKqnD,SAAW7V,GAAQ5oC,KAAK3B,MAAMjH,MACnCA,KAAKsnD,QAAU9V,GAAQ5oC,KAAK3B,MAAMjH,MAClCA,KAAKunD,aAAe/V,GAAQ5oC,KAAK3B,MAAMjH,MACvCA,KAAKwnD,SAAWhW,GAAQ5oC,KAAK3B,MAAMjH,MACnCA,KAAKynD,UAAYjW,GAAQ5oC,KAAK3B,MAAMjH,MAEpCA,KAAK6pB,MAAQ+8B,GAAMrJ,QACnBv9C,KAAK+gD,MAAQ/gD,MAMdgI,OAAQ,WAaP,IAAI9H,EAEJ,IAbAF,KAAK0nD,gBACL1nD,KAAKonD,cAAcv/C,OAEnB7H,KAAKynD,UAAUvW,OACflxC,KAAKynD,UAAU5/C,OAEf7H,KAAKqnD,SAASx/C,OACd7H,KAAKsnD,QAAQz/C,OACb7H,KAAKunD,aAAa1/C,OAClB7H,KAAKwnD,SAAS3/C,OAI0B,QAAhC3H,EAAIF,KAAKknD,UAAUx8C,UAE1BxK,EAAEm9C,QAAQhzC,OAAOrK,KAAKogD,QAASpgD,MAC/BE,EAAEi9C,UAAY,KACdpzC,QAAQ7J,GAGT,IAAKA,EAAI,EAAGA,EAAIF,KAAKgnD,WAAW7mD,OAAQD,IAElCF,KAAKgnD,WAAW9mD,KAErBF,KAAKgnD,WAAW9mD,GAAG6gD,MAAQ,KAC3Bh3C,QAAQ/J,KAAKgnD,WAAW9mD,IAExBF,KAAKgnD,WAAW9mD,GAAK,MAGtB,IAAKA,EAAI,EAAGA,EAAIF,KAAKinD,UAAU9mD,OAAQD,IAEjCF,KAAKinD,UAAU/mD,KAEpB6J,QAAQ/J,KAAKinD,UAAU/mD,IACvBF,KAAKinD,UAAU/mD,GAAK,MAGrBF,KAAK8gD,eAAej5C,OACpB7H,KAAKknD,UAAUr/C,QAOhBqB,MAAO,WAIN,IAAIhJ,EAEJ,IAJAF,KAAK0nD,gBAImC,QAAhCxnD,EAAIF,KAAKknD,UAAUx8C,UAE1BxK,EAAEm9C,QAAQhzC,OAAOrK,KAAKogD,QAASpgD,MAC/BE,EAAEi9C,UAAY,KACdpzC,QAAQ7J,GAGT,IAAKA,EAAI,EAAGA,EAAIF,KAAKgnD,WAAW7mD,OAAQD,IAEnCF,KAAKgnD,WAAW9mD,IACnBF,KAAKgnD,WAAW9mD,GAAGgJ,SAYtBu1C,QAAS,SAAUn/C,EAAM,MAExB,OAAc,OAAVA,KACOU,KAAK6pB,MAAQ+8B,GAAMrJ,UAE9Bv9C,KAAK6pB,QAAU+8B,GAAMrJ,QACjBj+C,IAAOU,KAAK6pB,OAAS+8B,GAAMrJ,SAExBv9C,OAQR2nD,aAAc,SAAU9nD,EAAOs9C,GAE9B,GAAIt9C,EAAQ,EAAG,OAAOG,KAGtB,GAFAH,GAAS,GAES,OAAds9C,EAIH,OAFAn9C,KAAKgnD,WAAWnnD,GAAOkhD,MAAQ,KAC/B/gD,KAAKgnD,WAAWnnD,GAAS,KAClBG,KAGR,IAAKwhD,GAAUl3C,WAAW6yC,GACzB,MAAM,IAAIt3C,MAAM,2CAA6ChG,EAAQ,iCAWtE,OATsB,OAAlBG,KAAK6mD,UAAqB1J,EAAU/jC,MAAQpZ,KAAK6mD,YAAU7mD,KAAK6mD,SAAW1J,EAAU/jC,QAClE,OAAnBpZ,KAAK8mD,WAAsB3J,EAAU9jC,OAASrZ,KAAK8mD,aAAW9mD,KAAK8mD,UAAY3J,EAAU9jC,SACvE,OAAlBrZ,KAAKie,UAAqBk/B,EAAU/jC,MAAQpZ,KAAKie,YAAUje,KAAKie,SAAWk/B,EAAU/jC,QAClE,OAAnBpZ,KAAK+mD,WAAsB5J,EAAU9jC,OAASrZ,KAAK+mD,aAAW/mD,KAAK+mD,UAAY5J,EAAU9jC,QAE7F8jC,EAAU4D,MAAQ/gD,KAClBm9C,EAAUt8B,OAAS7gB,KAAK6gB,QAAUhhB,GAAS,IAE3CG,KAAKgnD,WAAWnnD,GAASs9C,EAClBn9C,MAOR4nD,aAAc,SAAU/nD,GAEvB,OAAOA,EAAQ,GAAKA,GAASG,KAAKgnD,WAAW7mD,OAAS,KAAOH,KAAKgnD,WAAWnnD,IAO9EgoD,YAAa,SAAUhoD,EAAOikB,GAE7B,GAAIjkB,EAAQ,EAAG,OAAOG,KAEtB,GAAiB,OAAb8jB,IAAsBqhC,GAAS76C,WAAWwZ,GAC7C,MAAM,IAAIje,MAAM,0CAA4ChG,EAAQ,iCAGrE,OADAG,KAAKinD,UAAUpnD,GAASikB,EACjB9jB,MAOR8nD,YAAa,SAAUjoD,GAEtB,OAAOA,EAAQ,GAAKA,GAASG,KAAKinD,UAAU9mD,OAAS,KAAOH,KAAKinD,UAAUpnD,IAO5E2lD,aAAc,SAAUtsC,GAElBA,EAAKwkC,UAEV19C,KAAKonD,cAActgD,KAAKoS,GACxBA,EAAKwkC,OAAM,KAOZgK,cAAe,WAEd,IAAIxuC,EAEJ,KAA+C,QAAvCA,EAAOlZ,KAAKonD,cAAc18C,UACjCX,QAAQmP,IAOV6uC,SAAU,SAAUt/C,GAEnB,IAAKk+C,GAAMr8C,WAAW7B,GACrB,MAAM,IAAI5C,MAAO,4BAUlB,OARA7F,KAAKknD,UAAUpgD,KAAK2B,GAEH,OAAbA,EAAMyL,KACTlU,KAAKmnD,OAAO1+C,EAAMyL,IAAMzL,GAEzBA,EAAM00C,UAAYn9C,KAClByI,EAAM40C,QAAQhvC,IAAIrO,KAAKgoD,aAAchoD,KAAMA,KAAKknD,UAAUx9C,SAEnD,GAMRs+C,aAAc,SAAUv/C,EAAOqkB,EAAMif,GAQpC,OANAtjC,EAAM00C,UAAY,KAClBrwB,EAAKo6B,UAAU78C,OAAO0hC,GAEL,OAAbtjC,EAAMyL,KACT4Y,EAAKq6B,OAAO1+C,EAAMyL,IAAM,OAElB,GAOR+zC,YAAa,SAAUx/C,GAGtB,OADAA,EAAM40C,QAAQ/L,MAAMtxC,KAAKogD,QAASpgD,MAC3ByI,GAORw2C,KAAM,SAAUx2C,GAEf,OAAO,GAQR2gB,KAAM,SAAU3F,GAEf,GAAKzjB,KAAKy+C,UAIV,GAFAz+C,KAAKihD,UAAY,EAEZjhD,KAAKinD,UAAU9mD,OAMpB,IAAK,IAAI+nD,EAAgB,EAAGA,EAAgBloD,KAAKinD,UAAU9mD,OAAQ+nD,IACnE,CACC,IAAIpkC,EAAW9jB,KAAKinD,UAAUiB,GACzBpkC,GAAaA,EAASynB,YAE3BjxB,EAAQwJ,SAAWA,EAEnBL,EAAE/H,WACF+H,EAAEmC,aAEF9B,EAAS+gC,UAAUphC,GACnBK,EAASghC,eAAerhC,GAExBzjB,KAAK8gD,eAAezzC,IAAIyW,EAASqb,QACjCn/B,KAAKmoD,eAAe1kC,EAAGzjB,KAAK8gD,gBAE5Br9B,EAAEoC,YACFpC,EAAE9H,gBArBF3b,KAAKmoD,eAAe1kC,EAAG,OA6BzB0kC,eAAgB,SAAU1kC,EAAGq9B,GAE5B,IAEC,IAAK,IAAI5gD,EAAI,EAAGA,EAAIF,KAAKgnD,WAAW7mD,OAAQD,IAEtCF,KAAKgnD,WAAW9mD,KAGrBF,KAAKgnD,WAAW9mD,GAAGghD,kBAAkBJ,GACrC9gD,KAAKgnD,WAAW9mD,GAAGkpB,KAAK3F,GAExBzjB,KAAKihD,WAAajhD,KAAKgnD,WAAW9mD,GAAG+gD,WAGvC,MAAOplC,GAEN,GAAkB,cAAdA,EAAEusC,QACL,MAAMvsC,IAQTwsC,gBAAiB,WAEhB,IAAK,IAAInoD,EAAI,EAAGA,EAAIF,KAAKinD,UAAU9mD,OAAQD,IAErCF,KAAKinD,UAAU/mD,IAGpBF,KAAKinD,UAAU/mD,GAAGqwB,OAAOvwB,KAAK2xB,KAQhCpB,OAAQ,SAAUoB,GAEjB3xB,KAAK2xB,GAAKA,EACV3xB,KAAKqnD,SAASnW,OAEdlxC,KAAKsnD,QAAQpW,OACblxC,KAAK0nD,gBACL1nD,KAAKunD,aAAarW,OAClBlxC,KAAKqoD,kBAELroD,KAAKwnD,SAAStW,UAQhB0V,GAAMrJ,QAAU,MAEhB+K,GAAe1B;;;;ICnSf2B,GAtMgB7oD,EAAMC,OACrB,CACAiG,UAAW,UAMXm7C,MAAO,KAKP14C,KAAM,KAKNmgD,SAAU,KACVC,UAAW,KAKXC,YAAa,KACbC,aAAc,KAMd5oD,OAAQ,SAAUghD,EAAOxwB,EAAO,KAAMxlB,EAAQ,MAE7C/K,KAAKqI,KAAOgD,EAAKzC,KAAK3B,QACtBjH,KAAK+gD,MAAQA,EAEb/gD,KAAKwoD,SAAWj4B,EAChBvwB,KAAKyoD,UAAY19C,EAEjB/K,KAAK0oD,YAAc,KACnB1oD,KAAK2oD,aAAe,KAEpB3oD,KAAK+gD,MAAMuG,QAAQj5C,IAAIrO,KAAK4oD,QAAS5oD,MACrCA,KAAK+gD,MAAMwG,aAAal5C,IAAIrO,KAAK6oD,MAAO7oD,MACxCA,KAAK+gD,MAAM0G,UAAUp5C,IAAIrO,KAAK8oD,SAAU9oD,OAMzCgI,OAAQ,WAEP,IAAI9H,EAMJ,IAJAF,KAAK+gD,MAAMuG,QAAQj9C,OAAOrK,KAAK4oD,QAAS5oD,MACxCA,KAAK+gD,MAAMwG,aAAal9C,OAAOrK,KAAK6oD,MAAO7oD,MAC3CA,KAAK+gD,MAAM0G,UAAUp9C,OAAOrK,KAAK8oD,SAAU9oD,MAER,QAA3BE,EAAIF,KAAKqI,KAAKqC,UACrBxK,EAAEm9C,QAAQhzC,OAAOrK,KAAKogD,QAASpgD,MAGhCA,KAAKqI,KAAKR,QAMXihD,SAAU,SAAU/H,EAAOj0B,GAE1B/iB,QAAQ+iB,IAQTnjB,MAAO,WAEN,KAAmC,QAA3BzJ,EAAIF,KAAKqI,KAAKqC,UACrBxK,EAAEm9C,QAAQhzC,OAAOrK,KAAKogD,QAASpgD,MAGhC,OAAOA,MAORkJ,MAAO,WAEN,KAAmC,QAA3BhJ,EAAIF,KAAKqI,KAAKqC,UACrBxK,EAAEm9C,QAAQhzC,OAAOrK,KAAKogD,QAASpgD,MAC/B+J,QAAQ7J,GAGT,OAAOF,MAOR+oD,UAAW,SAAUt9C,GAGpB,OADAzL,KAAK0oD,YAAcj9C,EACZzL,MAORgpD,WAAY,SAAUv9C,GAGrB,OADAzL,KAAK2oD,aAAel9C,EACbzL,MAORqO,IAAK,SAAU6K,GAEd,IAAK4sC,GAAQx7C,WAAW4O,GACvB,MAAM,IAAIrT,MAAO,+BAKlB,OAHA7F,KAAKqI,KAAKvB,KAAKoS,GAEfA,EAAKmkC,QAAQhvC,IAAIrO,KAAKogD,QAASpgD,KAAMA,KAAKqI,KAAKqB,SACxC,GAMR02C,QAAS,SAAUlnC,EAAM4T,EAAMif,GAG9B,OADAjf,EAAKzkB,KAAKgC,OAAO0hC,IACV,GAOR1hC,OAAQ,SAAU6O,GAGjB,OADAA,EAAKmkC,QAAQ/L,MAAMtxC,KAAKogD,QAASpgD,MAC1BkZ,GAMR2vC,MAAO,SAAU9H,EAAOj0B,GAEvB,IAAK,IAAI5sB,EAAI4sB,EAAKzkB,KAAKoB,IAAKvJ,EAAGA,EAAIA,EAAE+I,KACpC/I,EAAEZ,MAAM2/C,QAMV2J,QAAS,SAAU7H,EAAOj0B,GAEzBA,EAAKyD,OAAOwwB,EAAMpvB,KAOnBpB,OAAQ,SAAUoB,GAKjB,GAHyB,OAArB3xB,KAAK0oD,aACR1oD,KAAK0oD,YAAa1oD,KAAKqI,KAAMspB,EAAI3xB,KAAKyoD,WAEjB,OAAlBzoD,KAAKwoD,SACT,CACC,IAAIv/C,EAAO,KACX,IAAK,IAAI/I,EAAIF,KAAKqI,KAAKoB,IAAKvJ,EAAGA,EAAI+I,EAElCA,EAAO/I,EAAE+I,MAE2C,IAAhDjJ,KAAKwoD,SAAUtoD,EAAEZ,MAAOqyB,EAAI3xB,KAAKyoD,YACpCzoD,KAAKqK,OAAOnK,EAAEZ,OAIS,OAAtBU,KAAK2oD,cACR3oD,KAAK2oD,aAAc3oD,KAAKqI,KAAMspB,EAAI3xB,KAAKyoD;;;;;AC/L1CQ,GAAezH,GAAU7hD,OACxB,CACAiG,UAAW,kBAMXyC,KAAM,KAMNtI,OAAQ,SAAUqZ,EAAOC,GAExBrZ,KAAK6I,OAAOqgD,UAAUnpD,OAAQqZ,EAAOC,GACrCrZ,KAAKqI,KAAOgD,EAAKzC,KAAK3B,QAEtBjH,KAAKg/C,WAAU,IAMhBh3C,OAAQ,WAEPhI,KAAKkJ,QACLlJ,KAAKqI,KAAKR,OAEV7H,KAAK6I,OAAOqgD,UAAUlhD,UAOvBi3C,KAAM,SAAU/lC,GAGf,OADAlZ,KAAKohD,MAAMloC,IACJ,GAORhQ,MAAO,WAEN,IAAIhJ,EAEJ,KAAmC,QAA3BA,EAAIF,KAAKqI,KAAKqC,UAErBxK,EAAEm9C,QAAQhzC,OAAOrK,KAAKogD,QAASpgD,MAC/BE,EAAEi9C,UAAY,KACdpzC,QAAQ7J,GAGTF,KAAKghD,aAAe,GAOrBr3C,MAAO,WAEN,IAAIzJ,EAEJ,KAAmC,QAA3BA,EAAIF,KAAKqI,KAAKqC,UAErBxK,EAAEm9C,QAAQhzC,OAAOrK,KAAKogD,QAASpgD,MAC/BE,EAAEi9C,UAAY,KAGfn9C,KAAKghD,aAAe,GAOrB3yC,IAAK,SAAU6K,GAEd,IAAK4sC,GAAQx7C,WAAW4O,GACvB,MAAM,IAAIrT,MAAO,+BASlB,OAPA7F,KAAKqI,KAAKvB,KAAKoS,GACflZ,KAAKghD,eAEL9nC,EAAKikC,UAAYn9C,KACjBkZ,EAAKmkC,QAAQhvC,IAAIrO,KAAKogD,QAASpgD,KAAMA,KAAKqI,KAAKqB,QAE/C1J,KAAKohD,MAAMloC,IACJ,GAMRknC,QAAS,SAAUlnC,EAAM4T,EAAMif,GAM9B,OAJAjf,EAAKzkB,KAAKgC,OAAO0hC,GACjBjf,EAAKk0B,eAEL9nC,EAAKikC,UAAY,MACV,GAOR9yC,OAAQ,SAAU6O,GAGjB,OADAA,EAAKmkC,QAAQ/L,MAAMtxC,KAAKogD,QAASpgD,MAC1BkZ,GAORgmB,OAAQ,WAEP,IAAIrV,EAAQ61B,GAAYpC,MAAQoC,GAAYnC,QAE5C,IAAK,IAAIr9C,EAAIF,KAAKqI,KAAKoB,IAAKvJ,KAEtBA,EAAEZ,MAAMw+C,SAASj0B,KAGkB,IAApC7pB,KAAKmhD,YAAYjhD,EAAEZ,MAAOU,OALAE,EAAIA,EAAE+I;;;;;;;AC3HvCkgD,GAAe3H,GAAU7hD,OACxB,CACAiG,UAAW,gBAMXg6C,KAAM,KAMNzsB,aAAa,EAUbpzB,OAAQ,SAAUqZ,EAAM,MAAOC,EAAO,MAAO+vC,EAAS,GAAIC,EAAS,MAElErpD,KAAK6I,OAAOqgD,UAAUnpD,OAAQqZ,EAAOC,GACrCrZ,KAAK4/C,KAAO,IAAID,GAAMvmC,EAAOC,EAAQ+vC,EAAUC,IAMhDrhD,OAAQ,WAEPhI,KAAKkJ,QACLlJ,KAAK6I,OAAOqgD,UAAUlhD,UAOvBi3C,KAAM,SAAU/lC,GAGf,OADAlZ,KAAKohD,MAAMloC,GACJlZ,KAAK4/C,KAAKX,KAAK/lC,IAOvBhQ,MAAO,WAENlJ,KAAK4/C,KAAK12C,SAOXS,MAAO,WAEN3J,KAAK4/C,KAAKj2C,SAOX0E,IAAK,SAAU6K,GAEd,IAAK4sC,GAAQx7C,WAAW4O,GACvB,MAAM,IAAIrT,MAAO,+BAElB,QAAK7F,KAAK4/C,KAAKvxC,IAAI6K,KAGnBA,EAAKikC,UAAYn9C,KACjBA,KAAKghD,aAAehhD,KAAK4/C,KAAK5tB,MAE9BhyB,KAAKohD,MAAMloC,IACJ,IAOR7O,OAAQ,SAAU6O,GAIjB,OAFAlZ,KAAK4/C,KAAKv1C,OAAO6O,GACjBlZ,KAAKghD,aAAehhD,KAAK4/C,KAAK5tB,MACvB9Y,GAORgmB,OAAQ,WAIP,GAFAl/B,KAAK4/C,KAAKS,gBAAgBrgD,KAAK8gD,eAAgBpB,GAAYpC,MAAQoC,GAAYnC,QAASmC,GAAYpC,MAAQoC,GAAYnC,QAASv9C,KAAKmhD,YAAanhD,OAE9IA,KAAKmzB,aAAuC,OAAxBnzB,KAAK8gD,eAC7B,OAED,IAAIr9B,EAAI+F,EAAO0B,eAEfzH,EAAEmC,aACFnC,EAAE8C,WAAWvmB,KAAKyjB,EAAE+C,aAEpB,IAAIitB,GAAOzzC,KAAK8gD,eAAeljC,GAAG5d,KAAK4/C,KAAKE,OAAS,GAAG9/C,KAAK4/C,KAAKI,GAAG,IAAOhgD,KAAK4/C,KAAKI,IAAMhgD,KAAK4/C,KAAKK,OAClGriC,GAAO5d,KAAK8gD,eAAehjC,GAAG9d,KAAK4/C,KAAKE,OAAU,GAAG9/C,KAAK4/C,KAAKI,GAAG,IAAMhgD,KAAK4/C,KAAKI,IAAMhgD,KAAK4/C,KAAKK,OAClGzM,EAAOxzC,KAAK8gD,eAAenjC,GAAG3d,KAAK4/C,KAAKC,OAAS,GAAG7/C,KAAK4/C,KAAKG,GAAG,IAAO//C,KAAK4/C,KAAKG,GAClFpiC,EAAO3d,KAAK8gD,eAAejjC,GAAG7d,KAAK4/C,KAAKC,OAAU,GAAG7/C,KAAK4/C,KAAKG,GAAG,IAAM//C,KAAK4/C,KAAKG,GAEtFtM,GAAM3tC,IAAI2tC,EAAKzzC,KAAK4/C,KAAKK,SAAWjgD,KAAK4/C,KAAKI,IAAMhgD,KAAK4/C,KAAKE,MAC9DliC,GAAM9X,IAAI8X,EAAK5d,KAAK4/C,KAAKK,SAAWjgD,KAAK4/C,KAAKI,IAAMhgD,KAAK4/C,KAAKE,OAAS,GAAK9/C,KAAK4/C,KAAKI,IACtFxM,GAAMA,GAAMxzC,KAAK4/C,KAAKG,IAAM//C,KAAK4/C,KAAKC,MACtCliC,GAAMA,GAAM3d,KAAK4/C,KAAKG,IAAM//C,KAAK4/C,KAAKC,OAAS,GAAK7/C,KAAK4/C,KAAKG,IAE9Dt8B,EAAEtI,UAAU,qBACZsI,EAAE/G,SAAS82B,EAAIC,EAAI91B,EAAG61B,EAAG,EAAG51B,EAAG61B,EAAG,GAElCA,EAAKzzC,KAAK8gD,eAAeljC,GACzBA,EAAK5d,KAAK8gD,eAAehjC,GACzB01B,EAAKxzC,KAAK8gD,eAAenjC,GACzBA,EAAK3d,KAAK8gD,eAAejjC,GAEzB4F,EAAEc,UAAU,EAAEiF,EAAOuB,mBACrBtH,EAAEvI,YAAY,QACduI,EAAE9G,WAAW62B,EAAIC,EAAI91B,EAAG61B,EAAG,EAAG51B,EAAG61B,EAAG,GAEpChwB,EAAEc,UAAU,EAAEiF,EAAOuB,mBACrBtH,EAAEvI,YAAY,QACd,IAAK,IAAI9N,EAAIkN,EAAQwJ,SAASq5B,UAAUv/B,GAAG5d,KAAK4/C,KAAKE,MAAO1yC,EAAIkN,EAAQwJ,SAASq5B,UAAUr/B,GAAG9d,KAAK4/C,KAAKE,MAAO1yC,GAAM,GAAKpN,KAAK4/C,KAAKI,GACpI,IAAK,IAAIzgD,EAAI+a,EAAQwJ,SAASq5B,UAAUx/B,GAAG3d,KAAK4/C,KAAKC,MAAOtgD,EAAI+a,EAAQwJ,SAASq5B,UAAUt/B,GAAG7d,KAAK4/C,KAAKC,MAAOtgD,GAAM,GAAKS,KAAK4/C,KAAKG,GAEnIt8B,EAAE9G,WAAWpd,EAAES,KAAK4/C,KAAKC,MAAOzyC,EAAEpN,KAAK4/C,KAAKE,MAAQ,GAAK9/C,KAAK4/C,KAAKG,GAAM,GAAK//C,KAAK4/C,KAAKI,IAGzFv8B,EAAEoC,aAQHw6B,gBAAiB,SAAUlhB,EAAQmhB,EAAcC,EAAY90C,EAAUV,GAEtE/K,KAAK4/C,KAAKS,gBAAiBlhB,EAAQmhB,EAAcC,EAAY90C,EAAUV,IAOxE21C,eAAgB,SAAUvhB,EAAQmhB,EAAcC,GAE/C,OAAOvgD,KAAK4/C,KAAKc,eAAgBvhB,EAAQmhB,EAAcC,IAOxDI,cAAe,SAAUxhB,EAAQmhB,EAAcC,GAE9C,OAAOvgD,KAAK4/C,KAAKe,cAAexhB,EAAQmhB,EAAcC,IAOvDK,YAAa,SAAUzhB,EAAQmhB,EAAcC,GAE5C,OAAOvgD,KAAK4/C,KAAKgB,YAAazhB,EAAQmhB,EAAcC;;;;;ACzLtD,MAAM+I,GAAOxD,GAAQnmD,OACpB,CACAiG,UAAW,OAMXuO,KAAM,EAMNpU,OAAQ,SAASoU,EAAM5U,EAAG6N,EAAGgM,EAAOC,GAEnCrZ,KAAK6I,OAAOq9C,QAAQnmD,OAAOR,EAAG6N,EAAGgM,EAAOC,GAExCrZ,KAAKmU,KAAOA,GAObiV,KAAM,SAAS3F,GAEd,IAAKnJ,EAAQ8Y,aAAepzB,KAAKmzB,YAChC,OAED,IAAI+M,EAAIzc,EAAE+C,aACV/C,EAAI+F,EAAO0B,gBAETtF,aACFnC,EAAE8C,WAAW2Z,GACbzc,EAAEtI,UAAU2qC,GAAQJ,cAAc1lD,KAAKmzB,cACvC1P,EAAE/G,SAAS1c,KAAKm/B,OAAOxhB,GAAI3d,KAAKm/B,OAAOvhB,GAAI5d,KAAKm/B,OAAO/lB,QAASpZ,KAAKm/B,OAAO9lB,UAC5EoK,EAAEoC;;;iBAcJvgB;EAASqD,WAAW2gD,QACpBC,GAAeD;;;8BCvDf;MAAME,GAAQ1D,GAAQnmD,OACrB,CACAiG,UAAW,QAMXoY,KAAM,KAMN6G,KAAM,KAKN4kC,QAAQ,EAMRC,UAAW,KAMXC,WAAY,KAKZC,QAAQ,EACRC,SAAS,EAKTC,YAAa,KACbC,YAAa,KAMbhqD,OAAQ,SAASR,EAAG6N,EAAGyX,EAAM7G,GAE5Bhe,KAAK6I,OAAOq9C,QAAQnmD,OAAOR,EAAG6N,EAAG,EAAG,GAEpCpN,KAAKge,KAAOA,EACZhe,KAAK6kB,KAAOA,EAEZ7kB,KAAK4pD,QAAS,EACd5pD,KAAK6pD,SAAU,EAEf7pD,KAAK2lD,WAAW3lD,KAAKgqD,YACrBhqD,KAAKypD,QAAS,GAQfQ,MAAO,SAAU3qD,GAEhB,OAAIU,KAAK4pD,SAAWtqD,IAGpBU,KAAK4pD,OAAStqD,EACdU,KAAK8pD,YAAc,MAHX9pD,MAYTkqD,OAAQ,SAAS5qD,GAEhB,OAAIU,KAAK6pD,UAAYvqD,IAGrBU,KAAK6pD,QAAUvqD,EACfU,KAAK+pD,YAAc,MAHX/pD,MAWTmqD,QAAS,SAAU7qD,GAElB,OAAIU,KAAKge,OAAS1e,IAGlBU,KAAKge,KAAO1e,EACZU,KAAKypD,QAAS,GAHNzpD,MAWToqD,QAAS,SAAUvlC,GAElB,OAAI7kB,KAAK6kB,OAASA,IAGlB7kB,KAAK6kB,KAAOA,EACZ7kB,KAAKypD,QAAS,GAHNzpD,MAWTuwB,OAAQ,WAEHvwB,KAAKypD,SAERzpD,KAAK0pD,UAAY1pD,KAAK6kB,KAAK8gB,aAAa3lC,KAAKge,MAC7Che,KAAK2pD,WAAa3pD,KAAK6kB,KAAK+gB,cAAc5lC,KAAKge,MAE/Che,KAAK8pD,YAAc,KACnB9pD,KAAK+pD,YAAc,KAEnB/pD,KAAKypD,QAAS,GAGU,OAArBzpD,KAAK8pD,cACJ9pD,KAAK4pD,OAAS,EAAG5pD,KAAK8pD,YAAc,EACf,IAAhB9pD,KAAK4pD,OAAc5pD,KAAK8pD,aAAe9pD,KAAK0pD,WAAa,EAC7D1pD,KAAK8pD,aAAe9pD,KAAK0pD,WAGN,OAArB1pD,KAAK+pD,cACJ/pD,KAAK6pD,QAAU,EAAG7pD,KAAK+pD,YAAc,EACf,IAAjB/pD,KAAK6pD,QAAe7pD,KAAK+pD,aAAe/pD,KAAK2pD,YAAc,EAC/D3pD,KAAK+pD,aAAe/pD,KAAK2pD,aAOhCK,WAAY,SAASvmC,EAAGvK,EAAMsF,GAE7BtF,EAAKqX,SACLrX,EAAK2L,KAAK4gB,SAAUhiB,EAAGvK,EAAKimB,OAAOxhB,GAAKzE,EAAK4wC,YAAa5wC,EAAKimB,OAAOvhB,GAAK1E,EAAK6wC,YAAa7wC,EAAK8E;;;iBAepG1Y;EAASqD,WAAW6gD,QACpBa,GAAeb;;;;;;;;AC9Jfc,GAAenT,GAAKD,OAAOqT,OAC1B,CACAC,SAAU,KAEVzqD,OAAQ,WAEP,MAAM+sB,EAAO9sB,KAEbA,KAAK6I,OAAOquC,OAAOn3C,SAEnBC,KAAKwqD,SAAW,IAAI7a,GAEpB3vC,KAAKyqD,qBAAuB,SAAUp5B,GACrC,OAAOvE,EAAK49B,oBAAoBr5B,KAQlCya,SAAU,SAAUza,GAEnB,IACCrxB,KAAKwqD,SAASn8C,IAAIgjB,GAEd,SAAUA,GACbA,EAAQzpB,OAEV,MAAOiU,GACN,MAAM,IAAIhW,MAAO,+BAAiCgW,EAAEusC,SAGrD,OAAO/2B,GAOR4a,WAAY,SAAU5a,GAErB,IACCrxB,KAAKwqD,SAASngD,OAAOgnB,GACrBrxB,KAAKwqD,SAASta,UAEf,MAAOr0B,GACN,MAAM,IAAIhW,MAAO,iCAAmCgW,EAAEusC,WAIxDsC,oBAAqB,SAAUr5B,GAE9B,OAAOA,EAAQxD,gBAAgB7tB,KAAK2qD,QAAS3qD,KAAK4qD,SAAU5qD,KAAK6qD,YAGlE/T,UAAW,WAEVttB,EAAOqE,gBAAkB,CAAClG,EAAQ6D,EAASH,KAE1CrrB,KAAK2qD,QAAUhjC,EACf3nB,KAAK4qD,SAAWp/B,EAChBxrB,KAAK6qD,UAAYx/B,EAEjBrrB,KAAKwqD,SAAS3/C,QAAQ7K,KAAKyqD,wBAI7BxT,WAAY,WAEXztB,EAAOqE,gBAAkB;;;;;;;;ACtE3Bi9B,GAAe3T,GAAKD,OAAOqT,OAC1B,CACAC,SAAU,KAEVzqD,OAAQ,WAEP,MAAM+sB,EAAO9sB,KAEbA,KAAK6I,OAAOquC,OAAOn3C,SAEnBC,KAAKwqD,SAAW,IAAI7a,GAEpB3vC,KAAK+qD,oBAAsB,SAAU15B,GACpC,OAAOvE,EAAKk+B,mBAAmB35B,KAQjCya,SAAU,SAAUza,GAEnB,IACCrxB,KAAKwqD,SAASn8C,IAAIgjB,GAEd,SAAUA,GACbA,EAAQzpB,OAEV,MAAOiU,GACN,MAAM,IAAIhW,MAAO,8BAAgCgW,EAAEusC,SAGpD,OAAO/2B,GAOR4a,WAAY,SAAU5a,GAErB,IACCrxB,KAAKwqD,SAASngD,OAAOgnB,GACrBrxB,KAAKwqD,SAASta,UAEf,MAAOr0B,GACN,MAAM,IAAIhW,MAAO,gCAAkCgW,EAAEusC,WAIvD4C,mBAAoB,SAAU35B,GAE7B,OAAOA,EAAQpC,eAAejvB,KAAK2qD,QAAS3qD,KAAKirD,GAAIjrD,KAAKkrD,YAG3DpU,UAAW,WAEVttB,EAAOyF,eAAiB,CAACtH,EAAQqH,EAAGoD,KAEnCpyB,KAAK2qD,QAAUhjC,EACf3nB,KAAKirD,GAAKj8B,EACVhvB,KAAKkrD,UAAY94B,EAEjBpyB,KAAKwqD,SAAS3/C,QAAQ7K,KAAK+qD,uBAI7B9T,WAAY,WAEXztB,EAAOyF,eAAiB;;;;ACrF1B,MAAMk8B,GACL,CACApb,SAAU,EAEV1nC,KAAM,GACN+iD,MAAO,GAEPC,cAAc,EACdC,eAAe,EACfC,UAAW,EAgBXl9C,IAAK,SAAU9N,GAEVP,KAAKsrD,iBAAmB,WAAY/qD,KACvCA,EAAEirD,OAAS,IAEiB,IAAzBxrD,KAAKqI,KAAK0L,QAAQxT,IACrBP,KAAKqI,KAAKvB,KAAKvG,IAGjB8J,OAAQ,SAAU9J,GAEjB,IAAIL,EAAIF,KAAKqI,KAAK0L,QAAQxT,IAChB,IAANL,GAAUF,KAAKqI,KAAK6gB,OAAOhpB,EAAG,IAGnCurD,gBAAiB,SAAUnsD,GAE1BU,KAAKqrD,aAAe/rD,GAGrBosD,iBAAkB,SAAUpsD,GAE3BU,KAAKsrD,cAAgBhsD,GAGtBqsD,WAAY,SAAUpsD,EAAG6N,EAAGlC,GAE3B,GAAIlL,KAAKsrD,eAAiBtrD,KAAKurD,WAAa/hC,EAAO0C,YACnD,CACC,IAAIs/B,EAASxrD,KAAKqI,KAAK,GAAGmjD,OAE1B,IAAK,IAAIxkD,KAAQhH,KAAKqI,KACtB,CACC,GAAIrB,EAAKwkD,OAASA,EAClB,CACCxrD,KAAKqI,KAAOrI,KAAKqI,KAAK4nC,MAAK,CAAC5vC,EAAEC,IAAMA,EAAEkrD,OAASnrD,EAAEmrD,SACjD,MAGDA,EAASxkD,EAAKwkD,OAGfxrD,KAAKurD,UAAY/hC,EAAO0C,YAGzB,IAAK,IAAIhsB,EAAI,EAAGA,EAAIF,KAAKqI,KAAKlI,OAAQD,IAErC,GAAKF,KAAKqI,KAAKnI,KAED,MAAVgL,IAA2C,IAAzBA,EAAOlL,KAAKqI,KAAKnI,MAGnCF,KAAKqI,KAAKnI,GAAG0yC,cAAcrzC,EAAG6N,GACjC,OAAOpN,KAAKqI,KAAKnI,GAGnB,OAAO,MAGR0rD,YAAa,SAAU1rD,GAEtB,MAAO,UAAWA,GAGnB+uB,eAAgB,SAAUtH,EAAQqH,EAAGoD,GAEpC,IAAIy5B,GAAY,EACZx7B,EAAM,KAEV,OAAQ1I,GAEP,KAAK6B,EAAO0F,iBAAiBC,aAEd,MAAVH,EAAE88B,OAELz7B,EAAMrB,EAAE88B,KAAM98B,EAAE88B,KAAO,KACvBz7B,EAAI07B,kBAAkB/8B,IAGvBqB,EAAMrwB,KAAK2rD,WAAW38B,EAAEzvB,EAAGyvB,EAAE5hB,GAClB,MAAPijB,KAEFrB,EAAE88B,KAAOz7B,GAAK27B,gBAAgBh9B,GAC/B68B,GAAY,GAGb,MAED,KAAKriC,EAAO0F,iBAAiBQ,mBACd,MAAVV,EAAE88B,OAAcD,GAAY,GAChC,MAED,KAAKriC,EAAO0F,iBAAiBS,kBACxB3vB,KAAKqrD,eAEO,MAAXr8B,EAAEi9B,MAEDj9B,EAAEi9B,MAAMrZ,cAAc5jB,EAAEzvB,EAAGyvB,EAAE5hB,KAKhCijB,EAAMrB,EAAEi9B,MAAOj9B,EAAEi9B,MAAQ,KACzB57B,EAAI67B,OAAM,EAAOl9B,GAEjBqB,EAAMrwB,KAAK2rD,WAAW38B,EAAEzvB,EAAGyvB,EAAE5hB,EAAGpN,KAAK4rD,aAC1B,MAAPv7B,IACFrB,EAAEi9B,MAAQ57B,GAAK67B,OAAM,EAAMl9B,KAK9BqB,EAAMrwB,KAAK2rD,WAAW38B,EAAEzvB,EAAGyvB,EAAE5hB,EAAGpN,KAAK4rD,aAC1B,MAAPv7B,IACFrB,EAAEi9B,MAAQ57B,GAAK67B,OAAM,EAAMl9B,KAIjB,MAAVA,EAAE88B,KAED98B,EAAE88B,KAAKlZ,cAAc5jB,EAAEzvB,EAAGyvB,EAAE5hB,IAA0B,GAApB4hB,EAAE88B,KAAKK,WAE5Cn9B,EAAE88B,KAAKM,cAAep9B,EAAEzvB,EAAGyvB,EAAE5hB,EAAG4hB,GAChC68B,GAAY,IAIZx7B,EAAMrB,EAAE88B,KAAM98B,EAAE88B,KAAO,KACvBz7B,EAAI07B,kBAAkB/8B,GAEtBqB,EAAMrwB,KAAK2rD,WAAW38B,EAAEzvB,EAAGyvB,EAAE5hB,GAClB,MAAPijB,KAEFrB,EAAE88B,KAAOz7B,GAAK27B,gBAAgBh9B,GAC/B68B,GAAY,KAMdx7B,EAAMrwB,KAAK2rD,WAAW38B,EAAEzvB,EAAGyvB,EAAE5hB,GAClB,MAAPijB,KAEFrB,EAAE88B,KAAOz7B,GAAK27B,gBAAgBh9B,GAC/B68B,GAAY,IAId,MAED,KAAKriC,EAAO0F,iBAAiBU,aA0B5B,GAzBI5vB,KAAKqrD,eAEO,MAAXr8B,EAAEi9B,MAEDj9B,EAAEi9B,MAAMrZ,cAAc5jB,EAAEzvB,EAAGyvB,EAAE5hB,KAKhCijB,EAAMrB,EAAEi9B,MAAOj9B,EAAEi9B,MAAQ,KACzB57B,EAAI67B,OAAM,EAAOl9B,GAEjBqB,EAAMrwB,KAAK2rD,WAAW38B,EAAEzvB,EAAGyvB,EAAE5hB,EAAGpN,KAAK4rD,aAC1B,MAAPv7B,IACFrB,EAAEi9B,MAAQ57B,GAAK67B,OAAM,EAAMl9B,KAK9BqB,EAAMrwB,KAAK2rD,WAAW38B,EAAEzvB,EAAGyvB,EAAE5hB,EAAGpN,KAAK4rD,aAC1B,MAAPv7B,IACFrB,EAAEi9B,MAAQ57B,GAAK67B,OAAM,EAAMl9B,KAIjB,MAAVA,EAAE88B,KAAc,MAEhB98B,EAAE88B,KAAKlZ,cAAc5jB,EAAEzvB,EAAGyvB,EAAE5hB,IAA0B,GAApB4hB,EAAE88B,KAAKK,WAE5Cn9B,EAAE88B,KAAKM,cAAep9B,EAAEzvB,EAAGyvB,EAAE5hB,EAAG4hB,GAChC68B,GAAY,IAIZx7B,EAAMrB,EAAE88B,KAAM98B,EAAE88B,KAAO,KACvBz7B,EAAI07B,kBAAkB/8B,IAGvB,MAED,KAAKxF,EAAO0F,iBAAiBI,kBACd,MAAVN,EAAE88B,OAAcD,GAAY,GAChC,MAED,KAAKriC,EAAO0F,iBAAiBK,WACd,MAAVP,EAAE88B,OAELz7B,EAAMrB,EAAE88B,KAAM98B,EAAE88B,KAAO,KACvBz7B,EAAI07B,kBAAkB/8B,GAEtB68B,GAAY,GAMf,OAAOA,GAGRh+B,gBAAiB,SAAUlG,EAAQ6D,EAAS6gC,GAE3C,OAAQ1kC,GAEP,KAAK6B,EAAOsE,kBAAkBC,SAE7B,IAAK,IAAI7tB,EAAI,EAAGA,EAAIF,KAAKqI,KAAKlI,UAExBH,KAAKqI,KAAKnI,KAAOF,KAAKqI,KAAKnI,GAAGosD,iBAEY,IAA3CtsD,KAAKqI,KAAKnI,GAAGqsD,QAAQ/gC,EAAS6gC,IAJGnsD,KAQtC,MAED,KAAKspB,EAAOsE,kBAAkBI,OAE7B,IAAK,IAAIte,EAAI,EAAGA,EAAI5P,KAAKqI,KAAKlI,UAExBH,KAAKqI,KAAKuH,KAAO5P,KAAKqI,KAAKuH,GAAG08C,iBAEU,IAAzCtsD,KAAKqI,KAAKuH,GAAG48C,MAAMhhC,EAAS6gC,IAJKz8C,SAa1Ck7C,GAAehf,SAASqf,IACxBb,GAAgBxe,SAASqf,QAEzBsB,GAAetB;;;;AC3QfuB,GAAe/F,GAAMhnD,OACpB,CAMAwsD,WAAW,EAOXG,gBAAgB,EAMhBK,WAAW,EAMXC,YAAY,EAMZC,aAAc,KAMdC,WAAY,KAOZthC,QAAS,KAMTuhC,OAAQ,KAKRC,cAAe,KACfC,YAAa,KACbC,OAAQ,KACRC,UAAW,KAMXptD,OAAQ,SAAUo9C,EAAW59C,EAAG6N,EAAGy/C,EAAa,KAAMC,EAAW,MAEhE9sD,KAAK6I,OAAOukD,MAAMrtD,SAElBC,KAAK6sD,aAAeA,EACpB7sD,KAAK8sD,WAAaA,MAAAA,EAAAA,EAAcD,EAChC7sD,KAAK+sD,OAAS,KAEd,IAAIA,EAASxD,GAAK3gD,KAAK3B,MAAO,EAAG1H,EAAG6N,EAAGpN,KAAK6sD,aAAe7sD,KAAK6sD,aAAazzC,MAAQ,GAAIpZ,KAAK6sD,aAAe7sD,KAAK6sD,aAAaxzC,OAAS,IAAIolC,SAAQ,GAAOG,aAAY,GAAMr2C,MAAM,GACnLvI,KAAKomD,SAAS2G,GAEd5P,EAAU9uC,IAAI0+C,GACd5P,EAAU9uC,IAAIrO,MAEdA,KAAK+sD,OAASA,EAEd/sD,KAAKgtD,cAAgB,KACrBhtD,KAAKitD,YAAc,KACnBjtD,KAAKktD,OAAS,KACdltD,KAAKmtD,UAAYntD,KAAKqtD,kBAEtBrtD,KAAK2J,QACL8iD,GAAep+C,IAAIrO,OAMpBgI,OAAQ,WAEPhI,KAAK6I,OAAOukD,MAAMplD,SAClBykD,GAAepiD,OAAOrK,OAOvBob,OAAQ,SAAUhC,EAAOC,GAOxB,OALArZ,KAAK6I,OAAOukD,MAAMhyC,OAAOhC,EAAOC,GAEZ,OAAhBrZ,KAAK+sD,QACR/sD,KAAK+sD,OAAO3xC,OAAOhC,EAAOC,GAEpBrZ,MAORwyC,SAAU,SAAU0M,EAAQC,GAO3B,OALAn/C,KAAK6I,OAAOukD,MAAM5a,SAAS0M,EAAQC,GAEf,OAAhBn/C,KAAK+sD,QACR/sD,KAAK+sD,OAAOva,SAAS0M,EAAQC,GAEvBn/C,MAORstD,SAAU,SAAUT,EAAcC,EAAW,MAM5C,OAJA9sD,KAAK6sD,aAAeA,EACpB7sD,KAAK8sD,WAAaA,GAAcD,EAEhC7sD,KAAK2J,QACE3J,MAORutD,WAAY,SAAUjuD,GAGrB,OADAU,KAAKwrB,QAAUlsB,EACRU,MAOR2J,MAAO,WAEN3J,KAAKwe,IAAMxe,KAAK6sD,aAChB7sD,KAAKmtD,UAAWntD,KAAK2sD,WAAY,EAAO3sD,KAAK4sD,YAAa,EAAO5sD,OAOlEosD,cAAe,SAAUoB,EAAUC,EAAUt7B,KAQ7Cu7B,UAAW,SAAUpuD,GAEpB,OAAKU,KAAK2sD,WAAartD,IAAYU,KAAK2sD,YAAcrtD,IAGtDU,KAAK2tD,aAAcruD,GAEnBU,KAAKwe,IAAMxe,KAAK2sD,UAAY3sD,KAAK8sD,WAAa9sD,KAAK6sD,aACnD7sD,KAAKmtD,UAAWntD,KAAK2sD,UAAW3sD,KAAK4sD,WAAY5sD,OALzCA,MAcT2tD,aAAc,SAAUruD,EAAM,MAI7B,OAFAU,KAAK4sD,WAAa5sD,KAAK2sD,UACvB3sD,KAAK2sD,UAAsB,OAAVrtD,EAAiBU,KAAK2sD,UAAYrtD,EAC5CU,MAORgsD,gBAAiB,SAAU75B,GAE1BnyB,KAAK0tD,WAAU,IAOhB3B,kBAAmB,SAAU55B,GAE5BnyB,KAAK0tD,WAAU,IAOhB9a,cAAe,SAASrzC,EAAG6N,GAE1B,QAAKpN,KAAKy+C,WAGHz+C,KAAK+sD,OAAO5tB,OAAOyT,cAAcrzC,EAAG6N,IAO5CigD,kBAAmB,SAAUV,EAAWC,EAAY/9B,GAE/C89B,GAAaC,IAEZD,GAAa3sD,KAAKgtD,cACrBhtD,KAAKgtD,iBACIL,GAAa3sD,KAAKitD,aAC3BjtD,KAAKitD,gBAGFN,GAAaC,GAAc5sD,KAAKktD,QACpCltD,KAAKktD,UAOPX,QAAS,SAAU/gC,EAAS6gC,GAE3B,GAAI7gC,IAAYxrB,KAAKwrB,QAGpB,OADAxrB,KAAKgsD,mBACE,GAQTQ,MAAO,SAAUhhC,EAAS6gC,GAEzB,GAAI7gC,IAAYxrB,KAAKwrB,QAGpB,OADAxrB,KAAK+rD,qBACE,GAUT6B,SAAU,SAAUniD,GAGnB,OADAzL,KAAKmtD,UAAyB,OAAb1hD,EAAoBzL,KAAKqtD,kBAAoB5hD,EACvDzL,MAWR6tD,aAAc,SAAUpiD,GAAS,GAEhC,IAAiB,IAAbA,EAMJ,OADAzL,KAAKgtD,cAAgBvhD,EACdzL,KALFA,KAAKgtD,eAAehtD,KAAKgtD,iBAgB/Bc,WAAY,SAAUriD,GAAS,GAE9B,IAAiB,IAAbA,EAMJ,OADAzL,KAAKitD,YAAcxhD,EACZzL,KALFA,KAAKitD,aAAajtD,KAAKitD,eAgB7Bc,MAAO,SAAUtiD,GAAS,GAEzB,IAAiB,IAAbA,EAMJ,OADAzL,KAAKktD,OAASzhD,EACPzL,KALFA,KAAKktD,QAAQltD,KAAKktD;;;;;ACzUzBc,GAAerH,GAAMhnD,OACpB,CAMAwsD,WAAW,EAOXG,gBAAgB,EAMhBK,WAAW,EAMXC,YAAY,EAMXC,aAAc,KAMdC,WAAY,KAMbmB,kBAAmB,KAMnBC,gBAAiB,KAMhBC,WAAY,EAMZC,YAAa,EAKdpJ,KAAM,KACNC,KAAM,KAKNoJ,MAAO,EACPC,MAAO,EAEPC,KAAM,EACNC,KAAM,EAEN5/C,UAAW,EACXV,MAAO,EAKPugD,OAAQ,EAAGC,OAAQ,EAAGC,MAAO,EAAGC,MAAO,EAAGC,WAAY,EAAGC,OAAQ,EAKjEC,MAAO,EAAGC,MAAO,EAKjBC,OAAQ,EAAGC,UAAW,EAKtBC,UAAW,EAAGC,UAAW,EAKzBrC,OAAQ,EAKRI,UAAW,KAMXptD,OAAQ,SAAUo9C,EAAW59C,EAAG6N,EAAG8hD,EAAWrC,EAAcoB,EAAmBnB,EAAW,KAAMoB,EAAgB,UAetEmB,EAAqDC,EAb9FtvD,KAAK6I,OAAOukD,MAAMrtD,SAElBC,KAAK6sD,aAAeA,EACpB7sD,KAAK8sD,WAAaA,GAAcD,EAEhC7sD,KAAKiuD,kBAAoBA,EACzBjuD,KAAKkuD,gBAAkBA,GAAmBD,EAE1CjuD,KAAKkvD,UAAYA,EAEjBlvD,KAAKmvD,UAAY,EACjBnvD,KAAKovD,UAAY,EAEjBpvD,KAAK+sD,OAASxD,GAAK3gD,KAAK3B,MAAO,EAAG1H,EAAG6N,GAAqB,QAAjBiiD,EAAArvD,KAAK6sD,oBAAY,IAAjBwC,EAAAA,EAAqBrvD,KAAKiuD,mBAAmB70C,OAAyB,QAAjBk2C,EAAAtvD,KAAK6sD,oBAAY,IAAjByC,EAAAA,EAAqBtvD,KAAKiuD,mBAAmB50C,QAAQolC,SAAQ,GAAOG,aAAY,GAAMr2C,MAAM,GAC1LvI,KAAKomD,SAASpmD,KAAK+sD,QAEnB5P,EAAU9uC,IAAIrO,KAAK+sD,QACnB5P,EAAU9uC,IAAIrO,MAEdA,KAAKmtD,UAAY,KAEjBntD,KAAK2lD,WAAW3lD,KAAKuvD,aACrB9C,GAAep+C,IAAIrO,OAMpBgI,OAAQ,WAEPhI,KAAK6I,OAAOukD,MAAMplD,SAClBykD,GAAepiD,OAAOrK,OAOvBstD,SAAU,SAAUT,EAAcC,EAAW,MAI5C,OAFA9sD,KAAK6sD,aAAeA,EACpB7sD,KAAK8sD,WAAaA,GAAcD,EACzB7sD,MAORwvD,cAAe,SAAU3C,EAAcC,EAAW,MAIjD,OAFA9sD,KAAKiuD,kBAAoBpB,EACzB7sD,KAAKkuD,gBAAkBpB,GAAcD,EAC9B7sD,MAORyvD,cAAe,SAAU9oD,GAGxB,OADA3G,KAAKmuD,WAAaxnD,EACX3G,MAOR0vD,eAAgB,SAAU/oD,GAGzB,OADA3G,KAAKouD,YAAcznD,EACZ3G,MAOR2vD,YAAa,SAAUR,EAAWC,GAKjC,OAHApvD,KAAKmvD,UAAYA,EACjBnvD,KAAKovD,UAAYA,EAEVpvD,MAOR2J,MAAO,WAEN3J,KAAK+uD,MAAQ,EACb/uD,KAAKgvD,MAAQ,EAEbhvD,KAAKquD,MAAQ,EACbruD,KAAKsuD,MAAQ,EAEbtuD,KAAKuuD,KAAO,EACZvuD,KAAKwuD,KAAO,EACZxuD,KAAK4O,UAAY,EAEb5O,KAAKmtD,WACRntD,KAAKmtD,UAAWntD,KAAKuuD,KAAMvuD,KAAKwuD,KAAMxuD,KAAK4O,UAAW5O,KAAKkO,MAAOlO,OAOpEuvD,YAAa,SAAU9rC,EAAGvK,EAAMsF,GAE3BtF,EAAKyzC,WAEJzzC,EAAK4zC,YACR5zC,EAAK4zC,WAAW1jC,KAAM3F,EAAGvK,EAAKimB,OAAOxhB,GAAIzE,EAAKimB,OAAOvhB,IAElD1E,EAAKg1C,iBACRh1C,EAAKg1C,gBAAgB9kC,KAAM3F,EAAGvK,EAAKimB,OAAOxhB,GAAKzE,EAAK61C,MAAO71C,EAAKimB,OAAOvhB,GAAK1E,EAAK81C,SAI9E91C,EAAK2zC,cACR3zC,EAAK2zC,aAAazjC,KAAM3F,EAAGvK,EAAKimB,OAAOxhB,GAAIzE,EAAKimB,OAAOvhB,IAEpD1E,EAAK+0C,mBACR/0C,EAAK+0C,kBAAkB7kC,KAAM3F,EAAGvK,EAAKimB,OAAOxhB,GAAIzE,EAAKimB,OAAOvhB,MAQ/DwuC,cAAe,SAAUoB,EAAUC,GAElC,IAAI1/C,EAAIC,EAWR,GATAD,EAAKy/C,EAAWxtD,KAAKglD,KACrBh3C,EAAKy/C,EAAWztD,KAAKilD,KAErBjlD,KAAKkO,MAAQtH,KAAKgpD,OAAO5hD,EAAID,GAC7B/N,KAAKivD,OAASroD,KAAKkI,KAAKf,EAAGA,EAAKC,EAAGA,GAE/BhO,KAAKivD,OAASjvD,KAAKkvD,YACtBlvD,KAAKivD,OAASjvD,KAAKkvD,WAEhBlvD,KAAKmuD,WACT,CACC,IAAI0B,EAAM,EAAEjpD,KAAKugB,GAAKnnB,KAAKmuD,WAC3BnuD,KAAKkO,MAAQpI,KAAK9F,KAAKkO,MAAQtH,KAAKugB,GAAK0oC,EAAG,GAAKA,GAAMA,EAAKjpD,KAAKugB,GAGlE,GAAInnB,KAAKouD,YACT,CACC,IAAIyB,EAAM7vD,KAAKkvD,UAAYlvD,KAAKouD,YAChCpuD,KAAKivD,OAASnpD,KAAK9F,KAAKivD,OAASY,EAAG,GAAKA,GAAMA,EAGhD7vD,KAAKquD,MAAQznD,KAAKC,IAAI,EAAGD,KAAKswB,IAAInpB,EAAK/N,KAAKkvD,WAAW,IACvDlvD,KAAKsuD,MAAQ1nD,KAAKC,IAAI,EAAGD,KAAKswB,IAAIlpB,EAAKhO,KAAKkvD,WAAW,IAEvDlvD,KAAK+uD,MAAQ/uD,KAAKivD,OAASroD,KAAKuH,IAAInO,KAAKkO,OACzClO,KAAKgvD,MAAQhvD,KAAKivD,QAAUroD,KAAKwH,IAAIpO,KAAKkO,OAEtClO,KAAKivD,OAAS,GAEjBjvD,KAAKuuD,KAAOvuD,KAAK+uD,MAAQ/uD,KAAKivD,OAC9BjvD,KAAKwuD,KAAOxuD,KAAKgvD,MAAQhvD,KAAKivD,OAE9BjvD,KAAK4O,UAAY5O,KAAKivD,OAASjvD,KAAKkvD,YAIpClvD,KAAKuuD,KAAO,EACZvuD,KAAKwuD,KAAO,EAEZxuD,KAAK4O,UAAY,GAGdhI,KAAKsB,IAAIlI,KAAKquD,OAASruD,KAAKmvD,YAC/BnvD,KAAKquD,MAAQ,EACbruD,KAAKuuD,KAAO,GAGT3nD,KAAKsB,IAAIlI,KAAKsuD,OAAStuD,KAAKovD,YAC/BpvD,KAAKsuD,MAAQ,EACbtuD,KAAKwuD,KAAO,GAGTxuD,KAAKmtD,WACRntD,KAAKmtD,UAAWntD,KAAKuuD,KAAMvuD,KAAKwuD,KAAMxuD,KAAK4O,UAAW5O,KAAKkO,MAAOlO,OAOpEgsD,gBAAiB,SAAU75B,GAE1BnyB,KAAK4sD,WAAa5sD,KAAK2sD,UACvB3sD,KAAK2sD,UAAY,EAEjB3sD,KAAKglD,KAAO7yB,EAAQ5yB,EACpBS,KAAKilD,KAAO9yB,EAAQ/kB,EAEpBpN,KAAKosD,cAAcj6B,EAAQ5yB,EAAG4yB,EAAQ/kB,IAOvC2+C,kBAAmB,SAAU55B,GAE5BnyB,KAAK4sD,WAAa5sD,KAAK2sD,UACvB3sD,KAAK2sD,UAAY,EAEjB3sD,KAAK2J,SAONipC,cAAe,SAASrzC,EAAG6N,GAE1B,QAAKpN,KAAKy+C,WAGHz+C,KAAK+sD,OAAO5tB,OAAOyT,cAAcrzC,EAAG6N,IAO5C0iD,aAAc,SAAU/hD,EAAIC,EAAImhD,EAAU,GAAMC,EAAU,IASzD,OAPIxoD,KAAKsB,IAAI6F,GAAMohD,IAAWphD,EAAK,GAC/BnH,KAAKsB,IAAI8F,GAAMohD,IAAWphD,EAAK,GAEnChO,KAAK4sD,WAAa5sD,KAAK2sD,UACvB3sD,KAAK2sD,UAAkB,GAAN5+C,GAAiB,GAANC,EAAU,EAAI,EAE1ChO,KAAKosD,cAAepsD,KAAKm/B,OAAOuS,GAAK3jC,EAAG/N,KAAKkvD,UAAWlvD,KAAKm/B,OAAOwS,GAAK3jC,EAAGhO,KAAKkvD,YAC1E,GAQRa,YAAa,SAAUC,GAAU,GAShC,OAPAhwD,KAAKyuD,OAASuB,EAA2B,GAAdhwD,KAAKquD,MAAaruD,KAAKquD,MAAQruD,KAAKyuD,OAAUzuD,KAAKquD,MAC9EruD,KAAK0uD,OAASsB,EAA2B,GAAdhwD,KAAKsuD,MAAatuD,KAAKsuD,MAAQtuD,KAAK0uD,OAAU1uD,KAAKsuD,MAC9EtuD,KAAK2uD,MAAQqB,EAA0B,GAAbhwD,KAAKuuD,KAAYvuD,KAAKuuD,KAAOvuD,KAAK2uD,MAAS3uD,KAAKuuD,KAC1EvuD,KAAK4uD,MAAQoB,EAA0B,GAAbhwD,KAAKwuD,KAAYxuD,KAAKwuD,KAAOxuD,KAAK4uD,MAAS5uD,KAAKwuD,KAC1ExuD,KAAK6uD,WAAamB,EAA+B,GAAlBhwD,KAAK4O,UAAiB5O,KAAK4O,UAAY5O,KAAK6uD,WAAc7uD,KAAK4O,UAC9F5O,KAAK8uD,OAASkB,EAA2B,GAAdhwD,KAAKkO,MAAalO,KAAKkO,MAAQlO,KAAK8uD,OAAU9uD,KAAKkO,MAEvElO,MAORusD,QAAS,SAAU/gC,EAAS6gC,GAE3B,IAAIt+C,EAAK,EACLC,EAAK,EAOT,IAL4B,IAAxBq+C,EAAQzrD,EAAQe,MAAcqM,GAAMhO,KAAKkvD,YACf,IAA1B7C,EAAQzrD,EAAQc,QAAgBqM,GAAM/N,KAAKkvD,YACjB,IAA1B7C,EAAQzrD,EAAQiB,QAAgBmM,EAAKhO,KAAKkvD,YACf,IAA3B7C,EAAQzrD,EAAQgB,SAAiBmM,EAAK/N,KAAKkvD,WAE3C1jC,IAAY5qB,EAAQe,IAAM6pB,IAAY5qB,EAAQc,MAAQ8pB,IAAY5qB,EAAQiB,MAAQ2pB,IAAY5qB,EAAQgB,MASzG,OAPAmM,EAAK/N,KAAKm/B,OAAOuS,GAAK3jC,EACtBC,EAAKhO,KAAKm/B,OAAOwS,GAAK3jC,EAEtBhO,KAAK4sD,WAAa5sD,KAAK2sD,UACvB3sD,KAAK2sD,UAAY,EAEjB3sD,KAAKosD,cAAer+C,EAAIC,IACjB,GAQTw+C,MAAO,SAAUhhC,EAAS6gC,GAEzB,IAAIt+C,EAAK,EACLC,EAAK,EAOT,IAL4B,IAAxBq+C,EAAQzrD,EAAQe,MAAcqM,GAAMhO,KAAKkvD,YACf,IAA1B7C,EAAQzrD,EAAQc,QAAgBqM,GAAM/N,KAAKkvD,YACjB,IAA1B7C,EAAQzrD,EAAQiB,QAAgBmM,EAAKhO,KAAKkvD,YACf,IAA3B7C,EAAQzrD,EAAQgB,SAAiBmM,EAAK/N,KAAKkvD,WAE3C1jC,IAAY5qB,EAAQe,IAAM6pB,IAAY5qB,EAAQc,MAAQ8pB,IAAY5qB,EAAQiB,MAAQ2pB,IAAY5qB,EAAQgB,MAUzG,OARA5B,KAAKosD,cAAepsD,KAAKm/B,OAAOuS,GAAK3jC,EAAI/N,KAAKm/B,OAAOwS,GAAK3jC,GAE/C,IAAPD,GAAmB,IAAPC,IAEfhO,KAAK4sD,WAAa5sD,KAAK2sD,UACvB3sD,KAAK2sD,UAAY,IAGX,GAQTiB,SAAU,SAAUniD,GAGnB,OADAzL,KAAKmtD,UAAY1hD,EACVzL;;;;;AC5bT,MAAMiwD,GACN,CAOCC,WAAY,EACZC,UAAW,EAkBXC,UAAW,EACXC,UAAW,EACXC,UAAW,EACXC,UAAW,EACXC,UAAW,EACXC,WAAY,EACZC,UAAW,EACXC,UAAW,EACXC,UAAW,EACXC,UAAW,EACXC,UAAW,GACXC,WAAY,GAaXC,cAAe,EAChBC,cAAe,EACfC,cAAe,EACfC,eAAgB,EAChBC,cAAe,EACfC,cAAe,EACfC,cAAe,EAKfC,QAAS,GAMTC,YAAa,KAKbC,WAAY,GAMZC,eAAgB,KAMhBC,gBAAiB,KAMjBC,YAAa,KAMbC,UAAW,KAMXC,YAAa,KAMb3yB,OAAQoW,GAAQ3sC,KAAK3B,QAMrBW,KAAM,SAAUmqD,EAAW,MAAOC,EAAY,MAAO5I,EAAS,KAAMC,EAAS,MAE3D,OAAbD,IACHA,EAAWxiD,KAAKswB,IAAI66B,EAAYC,GAAe,KAE5C5I,EAAW,KACdA,EAAW,IAEK,OAAbC,GAAqBA,EAAW,KACnCA,EAAW,IAEZrpD,KAAKm/B,OAAO1xB,OAAO2N,OAAO22C,EAAYC,GAEtChyD,KAAKiyD,YAAYhC,GAAMC,YACvBlwD,KAAK2nD,aAAasI,GAAMG,UAAW,IAAIjH,GAAe4I,EAAYC,EAAa5I,EAAUC,IACzFrpD,KAAK2nD,aAAasI,GAAMI,UAAW,IAAIlH,GAAe4I,EAAYC,EAAa5I,EAAUC,IACzFrpD,KAAK2nD,aAAasI,GAAMK,UAAW,IAAInH,GAAe4I,EAAYC,EAAa5I,EAAUC,IACzFrpD,KAAK2nD,aAAasI,GAAMM,UAAW,IAAIpH,GAAe4I,EAAYC,EAAa5I,EAAUC,IACzFrpD,KAAK2nD,aAAasI,GAAMO,UAAW,IAAIrH,GAAe4I,EAAYC,EAAa5I,EAAUC,IACzFrpD,KAAK2nD,aAAasI,GAAMQ,WAAY,IAAItH,GAAe4I,EAAYC,EAAa5I,EAAUC,IAC1FrpD,KAAK2nD,aAAasI,GAAMS,UAAW,IAAIvH,GAAe4I,EAAYC,EAAa5I,EAAUC,IACzFrpD,KAAK2nD,aAAasI,GAAMU,UAAW,IAAIxH,GAAe4I,EAAYC,EAAa5I,EAAUC,IACzFrpD,KAAK2nD,aAAasI,GAAMW,UAAW,IAAIzH,GAAe4I,EAAYC,EAAa5I,EAAUC,IACzFrpD,KAAK2nD,aAAasI,GAAMY,UAAW,IAAI1H,GAAe4I,EAAYC,EAAa5I,EAAUC,IACzFrpD,KAAK2nD,aAAasI,GAAMa,UAAW,IAAI3H,GAAe4I,EAAYC,EAAa5I,EAAUC,IAEzFrpD,KAAK2nD,aAAasI,GAAMc,WAAY,IAAI5H,GAAe4I,EAAYC,EAAa5I,EAAUC,IAC1FrpD,KAAK4nD,aAAaqI,GAAMc,YAAYtS,SAAQ,GAC5Cz+C,KAAKkyD,eAAe,GAEpBlyD,KAAKiyD,YAAYhC,GAAME,WACvBnwD,KAAK2nD,aAAasI,GAAMe,cAAe,IAAI/H,GAAiB7Q,GAAO/tB,YAAa+tB,GAAO9tB,eACvFtqB,KAAK2nD,aAAasI,GAAMgB,cAAe,IAAIhI,GAAiB7Q,GAAO/tB,YAAa+tB,GAAO9tB,eACvFtqB,KAAK2nD,aAAasI,GAAMiB,cAAe,IAAIjI,GAAiB7Q,GAAO/tB,YAAa+tB,GAAO9tB,eACvFtqB,KAAK2nD,aAAasI,GAAMkB,eAAgB,IAAIlI,GAAiB7Q,GAAO/tB,YAAa+tB,GAAO9tB,eACxFtqB,KAAK2nD,aAAasI,GAAMmB,cAAe,IAAInI,GAAiB7Q,GAAO/tB,YAAa+tB,GAAO9tB,eACvFtqB,KAAK2nD,aAAasI,GAAMoB,cAAe,IAAIpI,GAAiB7Q,GAAO/tB,YAAa+tB,GAAO9tB,eACvFtqB,KAAK2nD,aAAasI,GAAMqB,cAAe,IAAIrI,GAAiB7Q,GAAO/tB,YAAa+tB,GAAO9tB,gBAOxF2nC,YAAa,SAAUpyD,GAElBG,KAAKuxD,QAAQ1xD,KAEhB2pB,EAAOkI,YAAY1xB,KAAKuxD,QAAQ1xD,IAChCuF,EAAO2E,QAAQ/J,KAAKuxD,QAAQ1xD,KAG7BG,KAAKuxD,QAAQ1xD,GAAS,IAAIyoD,GAAMzoD,GAChC2pB,EAAOiI,SAASzxB,KAAKuxD,QAAQ1xD,IAE7BG,KAAKmyD,YAAYtyD,IAOlBuyD,SAAU,SAAUvyD,EAAM,MAEzB,OAAc,OAAVA,EACIG,KAAKwxD,YAET3xD,EAAQ,GAAKA,GAASG,KAAKuxD,QAAQpxD,OAC/B,KAEDH,KAAKuxD,QAAQ1xD,IAOrBsyD,YAAa,SAAUtyD,GAEtB,QAAIA,EAAQ,GAAKA,GAASG,KAAKuxD,QAAQpxD,SAAWH,KAAKuxD,QAAQ1xD,MAG/DG,KAAKwxD,YAAcxxD,KAAKuxD,QAAQ1xD,GAChCG,KAAK2xD,gBAAkB,MAEhB,IASRO,eAAgB,SAAUryD,GAEzB,GAAyB,OAArBG,KAAKwxD,YACR,MAAM,IAAI3rD,MAAO,uEAEd7F,KAAKyxD,WAAW5xD,KAEnBuF,EAAO2E,QAAQ/J,KAAKyxD,WAAW5xD,IAC/BG,KAAKwxD,YAAY3J,YAAYhoD,EAAO,OAGrCG,KAAKyxD,WAAW5xD,GAAS,IAAIslD,GAC5B,EAAG,EACH/M,GAAO/tB,YAAa+tB,GAAO9tB,aAC3BtqB,KAAKwxD,YAAYvzC,SAAUje,KAAKwxD,YAAYzK,WAG7C/mD,KAAKwxD,YAAY3J,YAAYhoD,EAAOG,KAAKyxD,WAAW5xD,IAEpDG,KAAKqyD,eAAexyD,IAOrBioD,YAAa,SAAUjoD,EAAM,MAE5B,OAAc,OAAVA,EACIG,KAAK0xD,eAET7xD,EAAQ,GAAKA,GAASG,KAAKyxD,WAAWtxD,OAClC,KAEDH,KAAKyxD,WAAW5xD,IAOxBwyD,eAAgB,SAAUxyD,GAEzB,QAAIA,EAAQ,GAAKA,GAASG,KAAKyxD,WAAWtxD,SAAWH,KAAKyxD,WAAW5xD,MAGrEG,KAAK0xD,eAAiB1xD,KAAKyxD,WAAW5xD,IAC/B,IAOR8nD,aAAc,SAAU9nD,EAAOs9C,GAE9B,GAAyB,OAArBn9C,KAAKwxD,YACR,MAAM,IAAI3rD,MAAO,qEAGlB,OADA7F,KAAKwxD,YAAY7J,aAAc9nD,EAAOs9C,GAC/BA,GAORyK,aAAc,SAAU/nD,EAAM,KAAMyyD,GAAY,GAE/C,GAAc,OAAVzyD,EACJ,CACC,GAA6B,OAAzBG,KAAK2xD,iBAA4BW,EACpC,MAAM,IAAIzsD,MAAO,8EAElB,OAAO7F,KAAK2xD,gBAGb,GAAyB,OAArB3xD,KAAKwxD,YACR,MAAM,IAAI3rD,MAAO,qEAElB,IAAIs3C,EAAYn9C,KAAKwxD,YAAY5J,aAAa/nD,GAC9C,GAAkB,OAAds9C,GAAsBmV,EACzB,MAAM,IAAIzsD,MAAO,gDAElB,OAAOs3C,GAORoV,gBAAiB,SAAU1yD,GAG1B,OADAG,KAAK2xD,gBAAkB3xD,KAAK4nD,aAAa/nD,GAAO,GAChB,OAAzBG,KAAK2xD,iBASba,UAAW,SAAUlzD,EAAOmzD,GAAS,GAEpCxC,GAAMmC,SAASnC,GAAMC,YAAYtI,aAAaqI,GAAMc,YAAYtS,QAAQn/C,GACxEgb,EAAQ8Y,WAAaq/B,GAOtBC,YAAa,SAASx+C,EAAG,MAExB,GAAyB,OAArBlU,KAAKwxD,YACR,MAAM,IAAI3rD,MAAO,kEAKlB,OAHA7F,KAAK4xD,YAAcjL,GAAM/9C,KAAK3B,MAAMiN,GACpClU,KAAKwxD,YAAYzJ,SAAS/nD,KAAK4xD,aAExB5xD,KAAK4xD,aAObe,SAAU,SAASpzD,EAAE,KAAM6N,EAAE,MAQ5B,OANU,OAAN7N,GAAoB,OAAN6N,GACjBpN,KAAK4xD,YAAY9jD,UAAUvO,EAAG6N,GAE/BpN,KAAK6xD,UAAY7xD,KAAK4xD,YACtB5xD,KAAK4xD,YAAc,KAEZ5xD,KAAK6xD,UAAU5S,QAevBrlC,cAAe,SAAU1F,EAAI3U,EAAG6N,EAAGoR,EAAI,KAAMo0C,EAAe,MAExC,iBAAR1+C,IAEV0+C,EAAiBp0C,EACjBA,EAAMpR,EACNA,EAAI7N,EACJA,EAAI2U,EACJA,EAAK,MAGN,IAAIipC,EAAYn9C,KAAK4nD,aAAagL,GAE9B15C,EAAO4sC,GAAQl9C,KAAK3B,MAAM1H,EAAG6N,EAAGoR,GAOpC,OANA2+B,EAAU9uC,IAAI6K,EAAKykC,MAAMzpC,IAEA,OAArBlU,KAAK4xD,aACR5xD,KAAK4xD,YAAYxL,SAASltC,GAE3BlZ,KAAK8xD,YAAc54C,EACZA,GASR25C,WAAY,SAAU3+C,EAAIC,EAAM5U,EAAE,KAAM6N,EAAE,KAAMgM,EAAM,KAAMC,EAAO,KAAMu5C,EAAe,MAEvF,IAAIzV,EAAYn9C,KAAK4nD,aAAagL,GAAkB3C,GAAMc,YAE1D,GAAU,OAANxxD,EACJ,CACC,GAAyB,OAArBS,KAAK4xD,YACR,MAAM,IAAI/rD,MAAO,0DAElBtG,EAAIS,KAAK4xD,YAAYzyB,OAAOxhB,GAC5BvQ,EAAIpN,KAAK4xD,YAAYzyB,OAAOvhB,GAC5BxE,EAAQpZ,KAAK4xD,YAAYzyB,OAAO/lB,QAChCC,EAASrZ,KAAK4xD,YAAYzyB,OAAO9lB,SAGlC,IAAIy5C,EAAOvJ,GAAK3gD,KAAK3B,MAAMkN,EAAM5U,EAAG6N,EAAGgM,EAAOC,GAM9C,OALA8jC,EAAU9uC,IAAIykD,EAAKnV,MAAMzpC,IAEA,OAArBlU,KAAK4xD,aACR5xD,KAAK4xD,YAAYxL,SAAS0M,GAEpBA,GAeRC,YAAa,SAAU7+C,EAAI3U,EAAG6N,EAAGyX,EAAM7G,EAAM40C,EAAe,MAExC,iBAAR1+C,IAEV0+C,EAAiB50C,EACjBA,EAAO6G,EACPA,EAAOzX,EACPA,EAAI7N,EACJA,EAAI2U,EACJA,EAAK,MAGN,IAAIipC,EAAYn9C,KAAK4nD,aAAagL,GAE9B15C,EAAOmxC,GAAMzhD,KAAK3B,MAAM1H,EAAG6N,EAAGyX,EAAM7G,GAOxC,OANAm/B,EAAU9uC,IAAI6K,EAAKykC,MAAMzpC,IAEA,OAArBlU,KAAK4xD,aACR5xD,KAAK4xD,YAAYxL,SAASltC,GAE3BlZ,KAAK8xD,YAAc54C,EACZA,GAOR85C,cAAe,SAAUziC,EAAO,KAAMxlB,EAAQ,MAE7C,GAAyB,OAArB/K,KAAKwxD,YACR,MAAM,IAAI3rD,MAAO,oEAElB,OAAO,IAAI0iD,GAASvoD,KAAKwxD,YAAajhC,EAAQxlB;AAMhDkoD,GAAehD;;;;IC3efiD,GAHU;;ICgSVC,GA1RA,CAKC1xB,OAAQ,SAAUxoB,GAEjBgyB,GAAUxJ,OAAOxoB,IAOlButB,KAAM,SAASC,EAAiB,MAE/B,OAAO,IAAIvS,SAAS,SAAUC,EAASC,GAEtC6W,GAAUzE,KAAM0sB,IACf,SAAUrzD,EAAOuzD,EAAO9zD,EAAO8I,GAC1Bq+B,GAAkBA,EAAiBnnC,EAAO8I,MAE/C,WACC+rB,WAWJhhB,IAAK,SAAUe,GAEd,OAAOg/C,GAAEh/C,IAMVm/C,oBAAqB,SAAUn/C,GAE9B,GAAIA,KAAMg/C,GAAG,MAAM,IAAIrtD,MAAO,wBAA0BqO,EAAK,wBAS9DmP,MAAO,SAAUnP,EAAImP,EAAOjK,EAAOC,GAIlC,OAFArZ,KAAKqzD,oBAAoBn/C,GAElBg/C,GAAEh/C,GAAM,CAAEC,KAAM,SAAU6sB,QAAS,SAAU3d,MAAOA,EAAOjK,MAAOA,EAAOC,OAAQA,IASzFi6C,OAAQ,SAAUp/C,EAAIkF,EAAOC,EAAQk6C,EAAct6C,EAAK,MAIvD,OAFAjZ,KAAKqzD,oBAAoBn/C,GAElBg/C,GAAEh/C,GAAM,CAAEC,KAAM,SAAU6sB,QAAS,SAAU5nB,MAAOA,EAAOC,OAAQA,EAAQ+P,KAAMmqC,KAAiBt6C,IAS1G+I,MAAO,SAAU9N,EAAIs/C,EAAMv6C,EAAK,MAI/B,OAFAjZ,KAAKqzD,oBAAoBn/C,GAElBg/C,GAAEh/C,GAAM,CAAEC,KAAM,QAAS6sB,QAAS,WAAYtX,IAAK8pC,KAASv6C,IAWpEw6C,OAAQ,SAAUv/C,EAAIs/C,EAAMxhC,EAAOjT,EAAW,KAAMC,EAAY,KAAM00C,EAAM,KAAMC,EAAM,MAGvF,OADA3zD,KAAKqzD,oBAAoBn/C,GAClBg/C,GAAEh/C,GAAM,CAAEC,KAAM,SAAU6sB,QAAS,cAAetX,IAAK8pC,EAAMxhC,MAAOA,EAAO5Y,MAAO2F,EAAY1F,OAAQ2F,EAC5GyiB,OAAQ,CACP1iB,WAAYA,EAAYC,YAAaA,KAAgB00C,MAEnDC,IAWLp0B,YAAa,SAAUrrB,EAAIs/C,EAAMz0C,EAAYC,EAAaqN,EAAU,EAAGqnC,EAAM,KAAMC,EAAM,MAIxF,OAFA3zD,KAAKqzD,oBAAoBn/C,GAElBg/C,GAAEh/C,GAAM,CAAEC,KAAM,QAAS6sB,QAAS,cAAetX,IAAK8pC,EAC5D/xB,OAAQ,CACP1iB,WAAYA,EAAYC,YAAaA,EAAaqN,UAAWA,KAAcqnC,MAEzEC,IAWLC,UAAW,SAAUC,EAAIL,EAAMz0C,EAAYC,EAAaqN,EAAU,KAAMynC,EAAc,KAAMC,EAAW,MAItG,OAFA/zD,KAAKqzD,oBAAoBQ,GAElBX,GAAEW,GAAM,CAAE1/C,KAAM,QAAS6sB,QAAS,uBAAwBtX,IAAK8pC,EACrE/xB,OAAQ,CACP1iB,WAAYA,EAAYC,YAAaA,EAAaqN,UAAWA,KAAcynC,GAG5EjxB,KAAM,CACLuB,IAAK,KAAMja,IAAK,GAAI6X,IAAK,GAAKE,MAAO,OAGnC6xB,EAEH5pC,IAAK,SAAS7qB,GAEb,OADAU,KAAK6iC,KAAK1Y,IAAM7qB,EACTU,MAGRgiC,IAAK,SAAS9tB,EAAImvB,EAAM56B,EAAO0hB,EAAI,MAOlC,OALAnqB,KAAK6iC,KAAKb,IAAI9tB,GAAM,CAAEmvB,KAAMA,EAAM56B,MAAOA,GAE7B,OAAR0hB,IACHnqB,KAAK6iC,KAAKb,IAAI9tB,GAAIiW,IAAMA,GAElBnqB,MAGRkiC,MAAO,SAAS8xB,EAAQC,EAAQxrD,GAM/B,OAJMurD,KAAUh0D,KAAK6iC,KAAKX,QACzBliC,KAAK6iC,KAAKX,MAAM8xB,GAAU,IAE3Bh0D,KAAK6iC,KAAKX,MAAM8xB,GAAQC,GAAUxrD,EAC3BzI,MAGRokC,IAAK,SAAS9kC,GAEb,OADAU,KAAK6iC,KAAKuB,IAAM9kC,EACTU,QAYVk0D,WAAY,SAAUhgD,EAAIs/C,EAAM7uB,EAAWE,EAAYO,EAASsuB,EAAM,KAAMC,EAAM,MAIjF,OAFA3zD,KAAKqzD,oBAAoBn/C,GAElBg/C,GAAEh/C,GAAM,CAAEC,KAAM,QAAS6sB,QAAS,aAActX,IAAK8pC,EAC3D3uC,KAAM,CACL8f,UAAWA,EAAWE,WAAYA,EAAYO,QAASA,KAAYsuB,MAEjEC,IAWLrrB,KAAM,SAAUp0B,EAAIs/C,EAAMv6C,EAAK,MAI9B,OAFAjZ,KAAKqzD,oBAAoBn/C,GAElBg/C,GAAEh/C,GAAM,CAAEC,KAAM,OAAQuV,IAAK8pC,KAASv6C,IAU9CvJ,KAAM,SAAUwE,EAAIs/C,EAAMv6C,EAAK,MAI9B,OAFAjZ,KAAKqzD,oBAAoBn/C,GAElBg/C,GAAEh/C,GAAM,CAAEC,KAAM,OAAQuV,IAAK8pC,KAASv6C,IAU9C+E,KAAM,SAAU9J,EAAIs/C,EAAMv6C,EAAK,MAI9B,OAFAjZ,KAAKqzD,oBAAoBn/C,GAElBg/C,GAAEh/C,GAAM,CAAEC,KAAM,OAAQuV,IAAK8pC,KAASv6C,IAU9Ck7C,IAAK,SAAUjgD,EAAIs/C,EAAMv6C,EAAK,MAI7B,OAFAjZ,KAAKqzD,oBAAoBn/C,GAElBg/C,GAAEh/C,GAAM,CAAEC,KAAM,QAAS6sB,QAAS,QAAStX,IAAK8pC,EAAM9rB,MAAO,SAAUzuB,IAY/Em7C,KAAM,SAAUlgD,EAAIs/C,EAAMxhC,EAAO8c,EAAK,cAGrC,OADA9uC,KAAKqzD,oBAAoBn/C,GAClBg/C,GAAEh/C,GAAM,CAAEC,KAAM,SAAU6sB,QAAS,aAActX,IAAK8pC,EAAMxhC,MAAOA,EAAO0V,MAAO,MAAOoH,KAAMA,IAUtGulB,MAAO,SAAUngD,EAAIs/C,GAIpB,OAFAxzD,KAAKqzD,oBAAoBn/C,GAElBg/C,GAAEh/C,GAAM,CAAEC,KAAM,QAAS6sB,QAAS,QAAStX,IAAK8pC,EAAM9rB,MAAO;;;;;AClJtE4sB,GAnHgB50D,EAAMC,OACrB,CAKA40D,OAAQ,KAMR3sC,QAAS,KAKTm5B,MAAO,KAKP5D,UAAW,KAKXqX,UAAU,EAMVz0D,OAAQ,SAASghD,EAAO6R,GAEvB5yD,KAAKu0D,OAAS,GACdv0D,KAAK4nB,QAAU,GAEf5nB,KAAK+gD,MAAQA,EACb/gD,KAAKy0D,MAAQ1T,EAAM6G,aAAagL,IAOjC8B,SAAU,SAAUxgD,EAAI3U,EAAG6N,EAAGunD,EAAeC,EAAe1F,EAAU,GAEpD,GAAbA,IACHA,EAAYyF,EAAcv7C,MAAQw7C,EAAcx7C,OAEjD,IAAIy7C,EAAQ,IAAI7G,GAAOhuD,KAAKy0D,MAAOl1D,EAAG6N,EAAG8hD,EAAWyF,EAAeC,GAKnE,OAHA50D,KAAKu0D,OAAOrgD,GAAM2gD,EAClB70D,KAAKkU,GAAM2gD,EAEJA,GAORC,UAAW,SAAU5gD,EAAI3U,EAAG6N,EAAG2nD,EAAkB,KAAMC,EAAgB,MAEtE,IAAInmC,EAAS,IAAI69B,GAAQ1sD,KAAKy0D,MAAOl1D,EAAG6N,EAAG2nD,EAAmBC,GAK9D,OAHAh1D,KAAK4nB,QAAQ1T,GAAM2a,EACnB7uB,KAAKkU,GAAM2a,EAEJA,GAWR4vB,QAAS,SAAUn/C,EAAM,MAExB,GAAc,OAAVA,EACH,OAAOU,KAAKw0D,SAEbx0D,KAAKw0D,SAAWl1D,EAEhB,IAAK,IAAIY,KAAKF,KAAKu0D,OAClBv0D,KAAKu0D,OAAOr0D,GAAGu+C,QAAQn/C,GAExB,IAAK,IAAIsQ,KAAK5P,KAAK4nB,QAClB5nB,KAAK4nB,QAAQhY,GAAG6uC,QAAQn/C,GAEzB,OAAOU,MAORwyD,UAAW,SAAUlzD,GAEpB,IAAK,IAAIY,KAAKF,KAAKu0D,OAClBv0D,KAAKu0D,OAAOr0D,GAAG6sD,OAAOtO,QAAQn/C,GAAO,GAEtC,IAAK,IAAIoR,KAAK1Q,KAAK4nB,QAClB5nB,KAAK4nB,QAAQlX,GAAGq8C,OAAOtO,QAAQn/C,GAAO,GAEvC,OAAOU;;;cC3GT;MAAMi1D,GACN,CAICC,UAAW,GAMXC,cAAe,KAMfC,WAAY,KAMZC,UAAW,KAKXC,OACA,CAICC,SAAU,KAKVC,SAAU,KAKVC,SAAU,KAKVtjC,QAAS,KAKTujC,QAAS,SAAUx8C,GAAK,GAEvB,OAAa,IAATA,EACIlZ,KAAKy1D,UAEbz1D,KAAKy1D,SAAWv8C,EACTlZ,OAMR21D,OAAQ,SAAUr2D,GAEZA,GAA+C,SAAtC84C,GAAO3uB,SAASvQ,KAAKa,MAAMu7C,OAEhCh2D,GAA+C,SAAtC84C,GAAO3uB,SAASvQ,KAAKa,MAAMu7C,QAC5Cld,GAAO3uB,SAASvQ,KAAKa,MAAM67C,eAAe,UAF1Cxd,GAAO3uB,SAASvQ,KAAKa,MAAMu7C,OAAS,QAQtC/pB,QAAS,SAAUjsC,EAAM,MAExB,OAAc,OAAVA,EACIU,KAAKu1D,UAETv1D,KAAKu1D,WAAaj2D,IAGtBU,KAAKu1D,SAAWj2D,GAEF,IAAVA,GAEmB,OAAlBU,KAAKy1D,WACRrd,GAAO3uB,SAASvQ,KAAKa,MAAMu7C,OAAS,QAErCxK,GAAehf,SAAS9rC,KAAKsnB,kBAI7B8wB,GAAO3uB,SAASvQ,KAAKa,MAAM67C,eAAe,UAC1C9K,GAAe7e,WAAWjsC,KAAKsnB,kBAdxBtnB,OAwBTqxB,QAAS,SAAU5lB,GAGlB,OADAzL,KAAKw1D,SAAW/pD,EACTzL,MAMRsnB,eACA,CACCyoB,SAAU,GAEV9gB,eAAgB,SAAUtH,EAAQwK,EAASC,GAErC6iC,GAAMK,OAAOC,WAGlBN,GAAMK,OAAOnjC,QAAUA,EAEO,OAA1B8iC,GAAMK,OAAOG,UAChBR,GAAMK,OAAOG,SAASrW,YAAYjtB,EAAQ5yB,EAAG4yB,EAAQ/kB,GAExB,OAA1B6nD,GAAMK,OAAOE,UAChBP,GAAMK,OAAOE,SAAU7tC,EAAQwK,OASnC0jC,cAAe,SAAUh2D,EAAOi2D,EAAW,MAU1C,OARAA,EAA4B,OAAfA,EAAsBA,EAAa7C,GAAM9B,eAEtD8B,GAAMd,YAAYc,GAAM9C,WACxB8C,GAAMV,gBAAgBuD,GAEtB91D,KAAKk1D,UAAUr1D,GAAS,IAAIy0D,GAASrB,GAAMzB,YAAasE,GACxD91D,KAAK+1D,cAAcl2D,GAEZG,KAAKm1D,eAOba,WAAY,SAAUn2D,GAErB,OAAIA,EAAQ,GAAKA,GAASG,KAAKk1D,UAAU/0D,OACjC,KAEDH,KAAKk1D,UAAUr1D,IAAU,MAOjCk2D,cAAe,SAAUl2D,GAGxB,OADAG,KAAKm1D,cAAgBn1D,KAAKg2D,WAAWn2D,IAC9B,GAORo2D,aAAc,SAAUp2D,EAAOP,GAE9B,GAAc,OAAVO,EAaJG,KAAKk1D,UAAUr1D,GAAO0I,MAAMjJ,QAX3B,IAAK,IAAIY,EAAI,EAAGA,EAAIF,KAAKk1D,UAAU/0D,OAAQD,IAErCF,KAAKk1D,UAAUh1D,IAGpBF,KAAKi2D,aAAa/1D,EAAGZ,IAaxBu1D,MAAO,SAAU3gD,EAAI3U,EAAG6N,EAAGunD,EAAeC,EAAe1F,EAAU,GAElE,GAA2B,OAAvBlvD,KAAKm1D,cACR,MAAM,IAAItvD,MAAO,+EAElB,OAAO7F,KAAKq1D,UAAYr1D,KAAKm1D,cAAcT,SAAUxgD,EAAI3U,EAAG6N,EAAGunD,EAAeC,EAAe1F,IAO9FrgC,OAAQ,SAAU3a,EAAI3U,EAAG6N,EAAG2nD,EAAkB,KAAMC,EAAgB,MAEnE,GAA2B,OAAvBh1D,KAAKm1D,cACR,MAAM,IAAItvD,MAAO,gFAElB,OAAO7F,KAAKo1D,WAAap1D,KAAKm1D,cAAcL,UAAW5gD,EAAI3U,EAAG6N,EAAG2nD,EAAmBC;AAMtFkB,GAAejB,GCpPf,MAQMkB,GACN,CAKCC,aAAc1W,GAAYF,YAK1B6W,aAAc,GAKdC,gBAAiB,GAKjBvV,MAAO,KAKPwV,UAAW,KAMXlP,SAAU,KAMVG,SAAU,KAOVgP,SAAU,EACVjW,WAAY,EAMZ3gD,MACA,CAKC62D,QAASlhB,GAAQ3sC,KAAK3B,QAMtB4iB,MAAO,EAMP9b,GAAI,EAMJC,GAAI,EAEJmxB,OAAQoW,GAAQ3sC,KAAK3B,QAErB1H,EAAG,IAAIq7B,MAAM,IAAIrrB,KAAK,GACtBnC,EAAG,IAAIwtB,MAAM,IAAIrrB,KAAK,GACtBmnD,IAAK,IAAI97B,MAAM,IAAIrrB,KAAK,GACxBonD,IAAK,IAAI/7B,MAAM,IAAIrrB,KAAK,GACxBqnD,IAAK,IAAIh8B,MAAM,IAAIrrB,KAAK,GACxBsnD,IAAK,IAAIj8B,MAAM,IAAIrrB,KAAK,GACxBunD,IAAK,IAAIl8B,MAAM,IAAIrrB,KAAK,GACxBwnD,IAAK,IAAIn8B,MAAM,IAAIrrB,KAAK,GAExByiB,MAAO,EACPniB,OAAQ,EAER4H,GAAI,EAAGu/C,GAAI,EAAGC,OAAQ,EACtBn/C,GAAI,EAAGo/C,GAAI,EAAGC,OAAQ,EAEtBC,GAAI,EACJC,KAAM,EACNC,KAAM,GAUPr3C,OAAQ,SAASs3C,EAAW,KAAMzB,EAAW,MAE5C91D,KAAK+gD,MAAQkS,GAAMb,SAASmF,GAActE,GAAM/C,YAChDlwD,KAAKu2D,UAAYv2D,KAAK+gD,MAAM6G,aAAakO,GAAc7C,GAAMlC,YAE7D/wD,KAAKw2D,SAAW9W,GAAYpC,MAAQoC,GAAYnC,QAAU4Y,GAASC,aACnEp2D,KAAKugD,WAAab,GAAYpC,MAAQoC,GAAYnC,QAElDv9C,KAAK+gD,MAAMsG,SAASh5C,IAAIrO,KAAKw3D,YAAax3D,MAC1CA,KAAK+gD,MAAMyG,SAASn5C,IAAIrO,KAAK+4B,WAAY/4B,MAEzCA,KAAKqnD,SAAW7V,GAAQ5oC,KAAK3B,MAAMjH,MACnCA,KAAKwnD,SAAWhW,GAAQ5oC,KAAK3B,MAAMjH,OAOpC0lB,QAAS,WAER1lB,KAAK+gD,MAAMsG,SAASh9C,OAAOrK,KAAKuwB,OAAQvwB,MACxCA,KAAKu2D,UAAY,KAEjBv2D,KAAKqnD,SAASx/C,OACd7H,KAAKwnD,SAAS3/C,QAMf2vD,YAAa,SAASzW,EAAOj0B,GAE5BA,EAAKu6B,SAASnW,QAMfnY,WAAY,SAASgoB,EAAOj0B,GAE3BA,EAAK06B,SAAStW,QAOfumB,MACA,CAKCtc,IAAK,SAAUjiC,EAAMzN,EAAUmlC,EAAMC,EAAMC,GAE1CqlB,GAAS9O,SAASh5C,IAAIrO,KAAK03D,KAAMx+C,EAAMzN,EAAUmlC,EAAMC,EAAMC,IAO9D6mB,WAAY,SAAUz+C,EAAM5Z,GAE3B62D,GAAS9O,SAASh5C,IAAIrO,KAAK43D,YAAa1+C,EAAM5Z,IAO/C46C,SAAU,SAAUxmB,EAAKtrB,EAAM9I,GAE9B62D,GAAS9O,SAASh5C,IAAIrO,KAAK63D,UAAWnkC,EAAKtrB,EAAM9I,IAOlDs+C,SAAU,SAAU1kC,EAAM5Z,GAEzB62D,GAAS9O,SAASh5C,IAAIrO,KAAK83D,UAAW5+C,EAAM5Z,IAO7Cu+C,WAAY,SAAU3kC,EAAM5Z,GAE3B62D,GAAS9O,SAASh5C,IAAIrO,KAAK+3D,YAAa7+C,EAAM5Z,IAK/Co4D,KAAM,SAAUvmB,EAAMj4B,EAAMzN,EAAUmlC,EAAMC,EAAMC,GAGjD,OADArlC,EAAU0lC,EAAMj4B,EAAM03B,EAAMC,EAAMC,IAC3B,GAGR8mB,YAAa,SAAUzmB,EAAMj4B,EAAM5Z,GAGlC,OADA4Z,EAAKulC,QAAQn/C,IACN,GAGRu4D,UAAW,SAAU1mB,EAAMzd,EAAKtrB,EAAM9I,GAGrC,OADAo0B,EAAItrB,GAAQ9I,GACL,GAGRw4D,UAAW,SAAU3mB,EAAMj4B,EAAM5Z,GAGhC,OADA4Z,EAAK0kC,SAASt+C,IACP,GAGRy4D,YAAa,SAAU5mB,EAAMj4B,EAAM5Z,GAGlC,OADA4Z,EAAK2kC,WAAWv+C,IACT;;AAaTm3D,QAAS,SAAUuB,EAAaC,EAAexsD,EAAUV,EAAQ,MAMhE,OAJMitD,KAAeh4D,KAAKq2D,eACzBr2D,KAAKq2D,aAAa2B,GAAe,IAElCh4D,KAAKq2D,aAAa2B,GAAaC,GAAiB,CAAExsD,SAAUA,EAAUV,QAASA,GACxE/K,MAkBRk4D,SAAU,SAAUF,EAAaC,EAAexsD,EAAS,KAAMV,EAAQ,MAMtE,OAJMitD,KAAeh4D,KAAKs2D,kBACzBt2D,KAAKs2D,gBAAgB0B,GAAe,IAErCh4D,KAAKs2D,gBAAgB0B,GAAaC,GAAiB,CAAExsD,SAAUA,EAAUV,QAASA,GAC3E/K,MAORm4D,gBAAiB,SAAUC,EAASC,GAEnCr4D,KAAKJ,MAAM62D,QAAQppD,IAAI+qD,GAAS9lB,kBAAkB+lB,GAClD,IAAI5B,EAAUz2D,KAAKJ,MAAM62D,QA6BzB,OA3BAz2D,KAAKJ,MAAMiqB,MAAQ,EACnB7pB,KAAKJ,MAAM04D,SAAW,EAElB7B,EAAQ94C,IAAM06C,EAAQ16C,KAEzB3d,KAAKJ,MAAMiqB,OAASssC,GAASoC,QAAQ72D,KACrC1B,KAAKJ,MAAM04D,YAGR7B,EAAQ54C,IAAMw6C,EAAQx6C,KAEzB7d,KAAKJ,MAAMiqB,OAASssC,GAASoC,QAAQ32D,MACrC5B,KAAKJ,MAAM04D,YAGR7B,EAAQ74C,IAAMy6C,EAAQz6C,KAEzB5d,KAAKJ,MAAMiqB,OAASssC,GAASoC,QAAQC,IACrCx4D,KAAKJ,MAAM04D,YAGR7B,EAAQ34C,IAAMu6C,EAAQv6C,KAEzB9d,KAAKJ,MAAMiqB,OAASssC,GAASoC,QAAQE,OACrCz4D,KAAKJ,MAAM04D,YAGLt4D,KAAKJ,MAAMiqB,OAGnB6uC,KAAM,SAAUC,EAAQzpD,EAAM7O,EAAGu4D,EAAKC,EAAKC,GAE1C,IAAInyD,EAAI3G,KAAKJ,MAAMoyB,MACf7E,EAAQ,KACR7f,EAAI,EAER,GAAI4B,EAAO,EAEV,IAAK,IAAIhP,EAAI,EAAGA,EAAIyG,EAAGzG,KAEjB04D,EAAI14D,KAAO24D,EAAI34D,IAAMG,EAAEH,GAAK,KAEnB,OAAVitB,GAAkB9sB,EAAEH,GAAKitB,KAC5BA,EAAQ9sB,EAAEH,IAEX24D,EAAI34D,GAAK44D,EAAI54D,GAAK,EAClBoN,GAAKsrD,EAAI14D,SAKV,IAAK,IAAI0P,EAAI,EAAGA,EAAIjJ,EAAGiJ,KAEjBgpD,EAAIhpD,KAAOipD,EAAIjpD,IAAMvP,EAAEuP,GAAK,KAEnB,OAAVud,GAAkB9sB,EAAEuP,GAAKud,KAC5BA,EAAQ9sB,EAAEuP,IAEXipD,EAAIjpD,GAAKkpD,EAAIlpD,GAAK,EAClBtC,GAAKsrD,EAAIhpD,IAIG,OAAVud,IACHA,EAAQ,GAELwrC,GACH34D,KAAKJ,MAAM6X,GAAKnK,EAChBtN,KAAKJ,MAAMo3D,GAAKpwD,KAAKsB,IAAIilB,GACzBntB,KAAKJ,MAAMq3D,OAAS9pC,IAEpBntB,KAAKJ,MAAMkY,GAAKxK,EAChBtN,KAAKJ,MAAMs3D,GAAKtwD,KAAKsB,IAAIilB,GACzBntB,KAAKJ,MAAMu3D,OAAShqC,IAItB4rC,cAAe,SAAUC,GAEpBh5D,KAAKJ,MAAMkY,GAAK9X,KAAKJ,MAAM6X,KAAOzX,KAAKJ,MAAMiQ,SAE1B,OAAlB7P,KAAKJ,MAAMw3D,IAAep3D,KAAKJ,MAAMs3D,GAAKl3D,KAAKJ,MAAMo3D,GAAKh3D,KAAKJ,MAAMw3D,MAExEp3D,KAAKJ,MAAMw3D,GAAKp3D,KAAKJ,MAAMs3D,GAAKl3D,KAAKJ,MAAMo3D,GAEtCgC,GAKJh5D,KAAKJ,MAAMy3D,KAAOr3D,KAAKJ,MAAMq3D,OAC7Bj3D,KAAKJ,MAAM03D,KAAOt3D,KAAKJ,MAAMu3D,SAL7Bn3D,KAAKJ,MAAMy3D,KAAOr3D,KAAKJ,MAAMu3D,OAC7Bn3D,KAAKJ,MAAM03D,KAAOt3D,KAAKJ,MAAMq3D,UAUjCgC,MAAO,WAEN,IAAItyD,EAAI3G,KAAKJ,MAAMoyB,MAEnB,IAAK,IAAI9xB,EAAI,EAAGA,EAAIyG,EAAGzG,IAEtBF,KAAKJ,MAAMg3D,IAAI12D,GAAKF,KAAKJ,MAAM82D,IAAIx2D,GACnCF,KAAKJ,MAAMi3D,IAAI32D,GAAKF,KAAKJ,MAAM+2D,IAAIz2D,IAIrCg5D,MAAO,WAEN,IAAIvyD,EAAI3G,KAAKJ,MAAMoyB,MAEnB,IAAK,IAAI9xB,EAAI,EAAGA,EAAIyG,EAAGzG,IAEtBF,KAAKJ,MAAMk3D,IAAI52D,GAAKF,KAAKJ,MAAMg3D,IAAI12D,GACnCF,KAAKJ,MAAMm3D,IAAI72D,GAAKF,KAAKJ,MAAMi3D,IAAI32D,IAIrCi5D,MAAO,WAEN,IAAIxyD,EAAI3G,KAAKJ,MAAMoyB,MAEnB,IAAK,IAAI9xB,EAAI,EAAGA,EAAIyG,EAAGzG,IAEtBF,KAAKJ,MAAMg3D,IAAI12D,GAAKF,KAAKJ,MAAMk3D,IAAI52D,GACnCF,KAAKJ,MAAMi3D,IAAI32D,GAAKF,KAAKJ,MAAMm3D,IAAI72D,IAIrCk5D,YAAa,SAAUC,GAAO,GAG7B,GADAr5D,KAAK04D,KAAMW,EAAQ,EAAGr5D,KAAKJ,MAAML,EAAGS,KAAKJ,MAAM82D,IAAK12D,KAAKJ,MAAMg3D,IAAK52D,KAAKJ,MAAMi3D,KAC3EwC,EAAQ,OAAO,EAEnBr5D,KAAKk5D,QACDl5D,KAAKs5D,aAAY,IAAOt5D,KAAK+4D,eAAc,GAE/C/4D,KAAKm5D,QACDn5D,KAAKu5D,aAAY,IAAOv5D,KAAK+4D,eAAc,GAE/C/4D,KAAKi5D,SAGNO,YAAa,SAAUH,GAAO,GAG7B,GADAr5D,KAAK04D,KAAMW,GAAQ,EAAIr5D,KAAKJ,MAAML,EAAGS,KAAKJ,MAAM82D,IAAK12D,KAAKJ,MAAMg3D,IAAK52D,KAAKJ,MAAMi3D,KAC5EwC,EAAQ,OAAO,EAEnBr5D,KAAKk5D,QACDl5D,KAAKs5D,aAAY,IAAOt5D,KAAK+4D,eAAc,GAE/C/4D,KAAKm5D,QACDn5D,KAAKu5D,aAAY,IAAOv5D,KAAK+4D,eAAc,GAE/C/4D,KAAKi5D,SAGNK,YAAa,SAAUD,GAAO,GAG7B,GADAr5D,KAAK04D,KAAMW,EAAQ,EAAGr5D,KAAKJ,MAAMwN,EAAGpN,KAAKJ,MAAM+2D,IAAK32D,KAAKJ,MAAMi3D,IAAK72D,KAAKJ,MAAMg3D,KAC3EyC,EAAQ,OAAO,EAEnBr5D,KAAKk5D,QACDl5D,KAAKo5D,aAAY,IAAOp5D,KAAK+4D,eAAc,GAE/C/4D,KAAKm5D,QACDn5D,KAAKw5D,aAAY,IAAOx5D,KAAK+4D,eAAc,GAE/C/4D,KAAKi5D,SAGNM,YAAa,SAAUF,GAAO,GAG7B,GADAr5D,KAAK04D,KAAMW,GAAQ,EAAIr5D,KAAKJ,MAAMwN,EAAGpN,KAAKJ,MAAM+2D,IAAK32D,KAAKJ,MAAMi3D,IAAK72D,KAAKJ,MAAMg3D,KAC5EyC,EAAQ,OAAO,EAEnBr5D,KAAKk5D,QACDl5D,KAAKo5D,aAAY,IAAOp5D,KAAK+4D,eAAc,GAE/C/4D,KAAKm5D,QACDn5D,KAAKw5D,aAAY,IAAOx5D,KAAK+4D,eAAc,GAE/C/4D,KAAKi5D,SAMNQ,OAAQ,WAEFz5D,KAAKJ,MAAM6I,MAAMi1C,UAGtB19C,KAAKJ,MAAM6I,MAAMqF,UAAW9N,KAAKJ,MAAMmO,GAAI/N,KAAKJ,MAAMoO,IACtDhO,KAAKJ,MAAM6I,MAAMo1C,WAAYsY,GAASC,gBAkBvCtoD,UAAW,SAAUglD,EAAMrqD,EAAM,KAAMsF,EAAG,EAAGC,EAAG,GAS/C,GAPsB,iBAAXvF,IAEVuF,EAAKD,EACLA,EAAKtF,EACLA,EAAQ,OAGJqqD,EAAM,OAIX,GAFKrqD,IAAOA,EAAQqqD,EAAKrqD,QAEpBA,EAAMi1C,UAAYoV,EAAKpV,QAC3B,OAQD,GANA19C,KAAKJ,MAAMkzD,KAAOA,EAClB9yD,KAAKJ,MAAM6I,MAAQA,EAEnBzI,KAAKJ,MAAMmO,GAAKiqB,WAAWF,QAAQ/pB,IACnC/N,KAAKJ,MAAMoO,GAAKgqB,WAAWF,QAAQ9pB,KAE9BhO,KAAKu2D,YAAczD,EAAKrU,UAC5B,OAAOz+C,KAAKy5D,SAEb,IAAInD,EAAkBt2D,KAAKs2D,gBAAgBxD,EAAK3+C,MAChD,IAAKmiD,IAEJA,EAAkBt2D,KAAKs2D,gBAvhBF,WAuhBkBxD,EAAK3+C,OACvCmiD,GAGJ,OADAt2D,KAAKy5D,SACEz5D,KAAK05D,KAAK5G,EAAMrqD,GAIzBzI,KAAKJ,MAAM+5D,KAAOlxD,EAAMi+C,WAAW1mD,KAAKJ,MAAMmO,GAAI/N,KAAKJ,MAAMoO,IAC7DhO,KAAKJ,MAAMu/B,OAAO9xB,IAAIylD,EAAK3zB,QAAQrxB,UAAU9N,KAAKJ,MAAM+5D,KAAKp6D,EAAES,KAAKJ,MAAMmO,GAAI/N,KAAKJ,MAAM+5D,KAAKvsD,EAAEpN,KAAKJ,MAAMoO,IAE3GvF,EAAMm1C,SAAUuY,GAASC,cAEzB,IAAIwD,EAAiB55D,KAAKu2D,UAAU7V,eAAe1gD,KAAKJ,MAAMu/B,OAAQn/B,KAAKw2D,SAAUx2D,KAAKugD,YAC1F,GAA8B,IAA1BqZ,EAAez5D,OAGlB,OADAy5D,EAAe/xD,OACR7H,KAAKy5D,SAGb,IAAI9yD,EAAI,EACJ2G,EAAI,EAER,OACA,CACC,IAAItG,EAAO4yD,EAAelvD,QAC1B,GAAa,OAAT1D,EAAe,MAEnB,IAAI6yD,EAAmBvD,EAAgBtvD,EAAKmN,MAC5C,IAAK0lD,IAEJA,EAAmBvD,EAtjBC,WAsjBetvD,EAAKmN,OACnC0lD,GAAkB,SAGxB,IAAkC,IAA9BA,EAAiBpuD,UAAqD,OAA9BouD,EAAiBpuD,WAAmD,IAA9BouD,EAAiBpuD,WAAsBouD,EAAiBpuD,SAASqnD,EAAM9rD,EAAM6yD,EAAiB9uD,SAC/K,SAED,IAAIqO,EAAQxS,KAAKC,IAAI7G,KAAKJ,MAAMu/B,OAAOthB,GAAI7W,EAAKm4B,OAAOthB,IAAMjX,KAAKswB,IAAIl3B,KAAKJ,MAAMu/B,OAAOxhB,GAAI3W,EAAKm4B,OAAOxhB,IACpGtE,EAASzS,KAAKC,IAAI7G,KAAKJ,MAAMu/B,OAAOrhB,GAAI9W,EAAKm4B,OAAOrhB,IAAMlX,KAAKswB,IAAIl3B,KAAKJ,MAAMu/B,OAAOvhB,GAAI5W,EAAKm4B,OAAOvhB,IAEzG5d,KAAKJ,MAAM82D,IAAI/vD,GAAK,EACpB3G,KAAKJ,MAAM+2D,IAAIhwD,GAAK,EAEhBC,KAAKC,IAAI7G,KAAKJ,MAAMu/B,OAAO/lB,QAASpS,EAAKm4B,OAAO/lB,UAAYA,IAC/DpZ,KAAKJ,MAAML,EAAEoH,GAAKuxB,OAAOl4B,KAAKJ,MAAMu/B,OAAOthB,GAAK7W,EAAKm4B,OAAOxhB,GAAI3d,KAAKJ,MAAMu/B,OAAOxhB,GAAK3W,EAAKm4B,OAAOthB,IACnG7d,KAAKJ,MAAM82D,IAAI/vD,GAAK,GAGjBC,KAAKC,IAAI7G,KAAKJ,MAAMu/B,OAAO9lB,SAAUrS,EAAKm4B,OAAO9lB,WAAaA,IACjErZ,KAAKJ,MAAMwN,EAAEzG,GAAKuxB,OAAOl4B,KAAKJ,MAAMu/B,OAAOrhB,GAAK9W,EAAKm4B,OAAOvhB,GAAI5d,KAAKJ,MAAMu/B,OAAOvhB,GAAK5W,EAAKm4B,OAAOrhB,IACnG9d,KAAKJ,MAAM+2D,IAAIhwD,GAAK,GAGrB,IAAImzD,EAAK95D,KAAKJ,MAAM82D,IAAI/vD,GAAK3G,KAAKJ,MAAM+2D,IAAIhwD,GAC5C2G,GAAKwsD,EAEDA,EAAK,IACR95D,KAAKJ,MAAM82D,IAAI/vD,GAAKmzD,EACpB95D,KAAKJ,MAAM+2D,IAAIhwD,GAAKmzD,GAGrB95D,KAAKJ,MAAMg3D,IAAIjwD,GAAK3G,KAAKJ,MAAM82D,IAAI/vD,GACnC3G,KAAKJ,MAAMi3D,IAAIlwD,GAAK3G,KAAKJ,MAAM+2D,IAAIhwD,GAEnCA,IAKD,GAFAizD,EAAe/xD,OAEN,GAALyF,EAGH,OADAtN,KAAKy5D,SACEz5D,KAAK05D,KAAK5G,EAAMrqD,GAYxB,GATAzI,KAAKJ,MAAMiQ,OAASvC,EACpBtN,KAAKJ,MAAMoyB,MAAQrrB,EACnB3G,KAAKJ,MAAMw3D,GAAK,KAEhBp3D,KAAKo5D,cACLp5D,KAAKw5D,cACLx5D,KAAKs5D,cACLt5D,KAAKu5D,cAEiB,OAAlBv5D,KAAKJ,MAAMw3D,GACf,CACC,IAAIf,EAAer2D,KAAKq2D,aAAavD,EAAK3+C,MAG1C,GAFKkiD,IAAcA,EAAer2D,KAAKq2D,aA/mBlB,WA+mB+BvD,EAAK3+C,OAErDkiD,EACJ,CAKC,IAJAr2D,KAAKJ,MAAMu/B,OAAO9xB,IAAIylD,EAAK3zB,QAAQrxB,UAAU9N,KAAKJ,MAAM+5D,KAAKp6D,EAAES,KAAKJ,MAAMmO,GAAmB,GAAhB/N,KAAKJ,MAAMy3D,KAAUr3D,KAAKJ,MAAM+5D,KAAKvsD,EAAEpN,KAAKJ,MAAMoO,GAAmB,GAAhBhO,KAAKJ,MAAM03D,MAE7IsC,EAAiB55D,KAAKu2D,UAAU7V,eAAe1gD,KAAKJ,MAAMu/B,OAAQn/B,KAAKw2D,SAAUx2D,KAAKugD,YAE/EuS,EAAKpV,SACZ,CACC,IAAI12C,EAAO4yD,EAAelvD,QAC1B,GAAa,OAAT1D,EAAe,MAEnB,IAAKA,EAAK02C,QACT,SAED,IAAI+Y,EAAUJ,EAAarvD,EAAKmN,OAC3BsiD,IAEJA,EAAUJ,EAloBQ,WAkoBKrvD,EAAKmN,MACvBsiD,KAGNA,EAAQhrD,SAAUqnD,EAAM9rD,EAAMyvD,EAAQ1rD,SAGvC6uD,EAAe/xD,OAGhB7H,KAAKJ,MAAMmO,IAAM/N,KAAKJ,MAAMy3D,KAC5Br3D,KAAKJ,MAAMoO,IAAMhO,KAAKJ,MAAM03D,KAG7Bt3D,KAAKy5D,UAcNC,KAAM,SAAU5G,EAAMrqD,EAAM,MAI3B,GAFKA,IAAOA,EAAQqqD,EAAKrqD,QAEpBA,IAAUA,EAAMi1C,UAAYoV,EAAKpV,QACrC,OAKD,GAHA19C,KAAKJ,MAAMkzD,KAAOA,EAClB9yD,KAAKJ,MAAM6I,MAAQA,GAEdzI,KAAKu2D,YAAczD,EAAKrU,UAC5B,OAED,IAAI4X,EAAer2D,KAAKq2D,aAAavD,EAAK3+C,MAE1C,GADKkiD,IAAcA,EAAer2D,KAAKq2D,aA5qBjB,WA4qB8BvD,EAAK3+C,QACpDkiD,EAAc,OAEnB5tD,EAAMm1C,SAAUuY,GAASC,cACzB,IAAIwD,EAAiB55D,KAAKu2D,UAAU7V,eAAeoS,EAAK3zB,OAAQn/B,KAAKw2D,SAAUx2D,KAAKugD,YAGpF,IAFA93C,EAAMo1C,WAAYsY,GAASC,cAEpBtD,EAAKpV,SACZ,CACC,IAAI12C,EAAO4yD,EAAelvD,QAC1B,GAAa,OAAT1D,EAAe,MAEnB,IAAKA,EAAK02C,QACT,SAED,IAAI+Y,EAAUJ,EAAarvD,EAAKmN,OAC3BsiD,IAEJA,EAAUJ,EA9rBU,WA8rBGrvD,EAAKmN,MACvBsiD,KAGNA,EAAQhrD,SAAUqnD,EAAM9rD,EAAMyvD,EAAQ1rD,SAGvC6uD,EAAe/xD;;;;AAajBsuD,QAAmB;;AAElBz0D,KAAM;;AAENE,MAAO;;AAEPm4D,WAAY;;AAEZvB,IAAK;;AAELC,OAAQ;;AAERuB,SAAU;iBCluBJ;MAAMC,GAAM7hB,GAIN8hB,GAAQjH,GAIRkH,GAAIjH,GAIJkH,GAAMjH,GAINkH,GAAQnE,GAIRoE,GDotBEnE,GEztBFoE,GAAQ76D,EACR86D,GAASC,EACTC,GAAWC,EAMiCC,GAAUtgD,EAGlBugD,GAAM9nD,EAGJ+nD,GAAO9mD,EAGH+mD,GAASvxC,EAGXwxC,GAAQ9tD,EAGN+tD,GAASx7D,EAGPy7D,GAAUt6D,EAGZu6D,GAASxxC,EAGbyxC,GAAOliC,EAGTmiC,GAAM9gD,EAGA+gD,GAAShmD,EAGMimD,GAAgBziD,EAGrB0iD,GAAct9B,EAOZu9B,GAAW3zB,EAGd4zB,GAAYzwB,GACpB0wB,GAAQ/sB,GAONgtB,GAAWt2D,EAGXu2D,GAAWtyD,EAGnBuyD,GAAOzwD,EAGY0wD,GAAgBpsB,GAG7BqsB,GAAUxqB,GAObyqB,GAASlrD,EAGbmrD,GAAOhpB,GAGPipB,GAAO/sD,EAGGgtD,GAAY9nB,GAGhB+nB,GAAU9mB,GAGZ+mB,GAAS3nB,GAOT4nB,GAAS9lB,GAGb+lB,GAAOxf,GAOPyf,GAAOtlB,GAGQulB,GAAchd,GAG7Bid,GAAOhd,GAGLid,GAAQtU,GAGFuU,GAAW1X,GAGb2X,GAAUvU,GAGNwU,GAAYvb,GAGCwb,GAAkB/T,GAGtBgU,GAAgB9T,GAGjC+T,GAAQvW,GAGFwW,GAAWr8B,GAGbs8B,GAAUtX,GAGhBuX,GAAO9T,GAGL+T,GAAQjT,GAGakT,GAAkBjT,GAGpBkT,GAAiB1S,GAGjB2S,GAAiBhR,GAGlCiR,GAAShR,GAGXiR,GAAQ3P,OAQ3D4P,GAAeC","sources":["src/system/random.js","src/system/keycode.js","src/utils/recycler.js","src/utils/linkable.js","src/utils/list.js","src/system/timer.js","src/math/vec2.js","src/math/matrix.js","src/system/glx.js","src/system/glsl.js","src/system/shader.js","src/system/shader-program.js","src/system/canvas.js","src/system/system.js","src/system/log.js","src/system/globals.js","src/system/perf.js","src/system/framebuffer.js","src/flow/drawable.js","src/resources/drawable.js","src/resources/custom.js","src/resources/spritesheet.js","src/resources/spritesheet-animation.js","src/resources/spritefont.js","src/resources/resources.js","src/resources/sound.js","src/resources/sound-array.js","src/resources/wrappers.js","src/utils/priority-queue.js","src/utils/callback.js","src/utils/handler.js","src/math/rect.js","src/math/tfunction.js","src/math/point2.js","src/math/bounds2.js","src/anim/easing.js","src/flow/boot.js","src/fxl/system.js","src/anim/block.js","src/anim/command.js","src/anim/parallel.js","src/anim/serial.js","src/anim/repeat.js","src/anim/set.js","src/anim/restart.js","src/anim/wait.js","src/anim/range.js","src/anim/rand.js","src/anim/randt.js","src/anim/anim.js","src/flow/grid-element.js","src/flow/grid.js","src/flow/container.js","src/flow/viewport.js","src/flow/element.js","src/flow/group.js","src/flow/scene.js","src/flow/updater.js","src/flow/simple-container.js","src/flow/grid-container.js","src/flow/mask.js","src/flow/label.js","src/flow/keyboard-handler.js","src/flow/pointer-handler.js","src/flow/screen-controls.js","src/flow/button.js","src/flow/stick.js","src/fxl/world.js","src/fxl/r.js","src/fxl/resources.js","src/fxl/gamepad.js","src/fxl/input.js","src/fxl/collider.js","src/fxl/fxl.js","src/main.js"],"sourcesContent":["/*\n**\tsystem/random.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\n\nconst XOR = (value, x) => (value ^ x) & 0x7FFFFFFF;\nconst SHR = (value, x) => (value >>> x)  & 0x7FFFFFFF;\nconst SHL = (value, x) => (value << x) & 0x7FFFFFFF;\n\n/**\n * Random number generator based on the WELL algorithm family.\n */\n\n//!class Random\n\nconst Random = Class.extend\n({\n\t/**\n\t * State of the generator.\n\t */\n\tstate: null,\n\n\t/**\n\t * Index of the next state value.\n\t */\n\tindex: 0,\n\n\t/**\n\t * \tSeed value of the generator. Remains constant throughout the life of the generator.\n\t * \t!readonly seed: number;\n\t */\n\tseed: 0,\n\n\t/**\n\t * \tInitializes the instance of the pseudo-random number generator.\n\t * \t@param seed - Value to seed the random number generator. If none provided, default one (0xDAE7A5D3) will be used.\n\t *\n\t *\t!constructor (seed?: number);\n\t */\n\t__ctor: function(seed=0xDAE7A5D3)\n\t{\n\t\tthis.state = [\n\t\t\t0xA5F7310C, 0xEF731CF3, 0xFA784322, 0x7834FC31,\n\t\t\t0xD9AF7813, 0xDE78AD13, 0x783F3418, 0xAA123176,\n\t\t\t0x871CF4D1, 0x73412FAB, 0xBAE6C710, 0x06F73481,\n\t\t\t0x8910CF15, 0x927CF813, 0xBCF7834F, 0x73F61193\n\t\t];\n\n\t\tthis.index = 0;\n\n\t\tthis.setSeed(seed);\n\t},\n\n\t/**\n\t * \tSets the seed of the pseudo-random number generator.\n\t * \t@param value - Seed value to use (32-bit unsigned integer).\n\t *\n\t *\t!setSeed (value: number) : Random;\n\t */\n\tsetSeed: function(value)\n\t{\n\t\tthis.seed = value;\n\n\t\tthis.state = [\n\t\t\t0xA5F7310C, 0xEF731CF3, 0xFA784322, 0x7834FC31,\n\t\t\t0xD9AF7813, 0xDE78AD13, 0x783F3418, 0xAA123176,\n\t\t\t0x871CF4D1, 0x73412FAB, 0xBAE6C710, 0x06F73481,\n\t\t\t0x8910CF15, 0x927CF813, 0xBCF7834F, 0x73F61193\n\t\t];\n\n\t\tfor (let i = 0; i < this.state.length; i++)\n\t\t\tthis.state[i] = XOR(this.state[i], this.seed);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tGenerates a 32-bit unsigned integer.\n\t *\t!nextInt32 () : number;\n\t */\n\tnextInt32: function ()\n\t{\n\t\tlet a, b, c, d;\n\n\t\ta = this.state[this.index];\n\t\tc = this.state[(this.index + 13) & 15];\n\t\tb = XOR(XOR(XOR(a, c), SHL(a, 16)), SHL(c, 15));\n\t\tc = this.state[(this.index + 9) & 15];\n\t\tc = XOR(c, SHR(c, 11));\n\t\ta = this.state[this.index] = XOR(b, c);\n\t\td = XOR(a, SHL(a, 5) & 0xDA442D24);\n\n\t\tthis.index = (this.index + 15) & 15;\n\t\ta = this.state[this.index];\n\n\t\tthis.state[this.index] = XOR(XOR(XOR(XOR(XOR(a, b), d), SHL(a, 2)), SHL(b, 18)), SHL(c, 28));\n\t\treturn this.state[this.index] & 0x7FFFFFFFF;\n\t},\n\n\t/**\n\t * \tGenerates a 16-bit unsigned integer.\n\t *\t!nextInt16 () : number;\n\t */\n\tnextInt16: function ()\n\t{\n\t\treturn this.nextInt32() & 0xFFFF;\n\t},\n\n\t/**\n\t * \tGenerates an 8-bit unsigned integer.\n\t * \t!nextInt8 () : number;\n\t */\n\tnextInt8: function ()\n\t{\n\t\treturn this.nextInt32() & 0xFF;\n\t},\n\n\t/**\n\t * \tGenerates a floating point number between 0 an 1 (inclusive).\n\t * \t!nextFloat () : number;\n\t */\n\tnextFloat: function ()\n\t{\n\t\treturn this.nextInt32() / 0x7FFFFFFF;\n\t}\n});\n\nexport default Random;\n","/*\n**\tsystem/keycode.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n//:/**\n//: * \tEnumeration of key codes supported by the system.\n//: */\n\n//!enum KeyCode\n\nexport default\n{\n\tBACKSPACE: 8,\n\t//!BACKSPACE\n\tTAB: 9,\n\t//!TAB\n\tENTER: 13,\n\t//!ENTER\n\tSHIFT: 16,\n\t//!SHIFT\n\tCTRL: 17,\n\t//!CTRL\n\tESC: 27,\n\t//!ESC\n\tSPACE: 32,\n\t//!SPACE\n\n\tPGUP: 33,\n\t//!PGUP\n\tPGDN: 34,\n\t//!PGDN\n\n\tEND: 35,\n\t//!END\n\tHOME: 36,\n\t//!HOME\n\n\tINS: 45,\n\t//!INS\n\tDEL: 46,\n\t//!DEL\n\n\tLEFT: 37,\n\t//!LEFT\n\tUP: 38,\n\t//!UP\n\tRIGHT: 39,\n\t//!RIGHT\n\tDOWN: 40,\n\t//!DOWN\n\n\tNUM_PLUS: 107,\n\t//!NUM_PLUS\n\tNUM_MINUS: 109,\n\t//!NUM_MINUS\n\tNUM_ASTERISK: 106,\n\t//!NUM_ASTERISK\n\tNUM_SLASH: 111,\n\t//!NUM_SLASH\n\tNUM_DOT: 110,\n\t//!NUM_DOT\n\n\tNUM_0: 96,\n\t//!NUM_0\n\tNUM_1: 97,\n\t//!NUM_1\n\tNUM_2: 98,\n\t//!NUM_2\n\tNUM_3: 99,\n\t//!NUM_3\n\tNUM_4: 100,\n\t//!NUM_4\n\tNUM_5: 101,\n\t//!NUM_5\n\tNUM_6: 102,\n\t//!NUM_6\n\tNUM_7: 103,\n\t//!NUM_7\n\tNUM_8: 104,\n\t//!NUM_8\n\tNUM_9: 105,\n\t//!NUM_9\n\n\tD0: 48,\n\t//!D0\n\tD1: 49,\n\t//!D1\n\tD2: 50,\n\t//!D2\n\tD3: 51,\n\t//!D3\n\tD4: 52,\n\t//!D4\n\tD5: 53,\n\t//!D5\n\tD6: 54,\n\t//!D6\n\tD7: 55,\n\t//!D7\n\tD8: 56,\n\t//!D8\n\tD9: 57,\n\t//!D9\n\n\tA: 65,\n\t//!A\n\tB: 66,\n\t//!B\n\tC: 67,\n\t//!C\n\tD: 68,\n\t//!D\n\tE: 69,\n\t//!E\n\tF: 70,\n\t//!F\n\tG: 71,\n\t//!G\n\tH: 72,\n\t//!H\n\tI: 73,\n\t//!I\n\tJ: 74,\n\t//!J\n\tK: 75,\n\t//!K\n\tL: 76,\n\t//!L\n\tM: 77,\n\t//!M\n\tN: 78,\n\t//!N\n\tO: 79,\n\t//!O\n\tP: 80,\n\t//!P\n\tQ: 81,\n\t//!Q\n\tR: 82,\n\t//!R\n\tS: 83,\n\t//!S\n\tT: 84,\n\t//!T\n\tU: 85,\n\t//!U\n\tV: 86,\n\t//!V\n\tW: 87,\n\t//!W\n\tX: 88,\n\t//!X\n\tY: 89,\n\t//!Y\n\tZ: 90,\n\t//!Z\n};\n","/*\n**\tutils/recycler.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst recyclingFacilities = { };\nlet totalPreallocated = 0;\n\nconst Recycler = { };\nglobal.Recycler = Recycler;\nexport default Recycler;\n\n//:/**\n//: * \tProvides functions to attach recycling functionality to any class for object pooling.\n//: */\n\n//!namespace Recycler\n\n/**\n * \tAttaches recycling methods (`allocate`, `alloc` and `free`) to the specified class. Class should implement method `init` to initialize the instance (and return itself)\n * \tand `__dtor` to destroy it.\n *\n * \t@param {*} maxPoolSize - Maximum number of instance to hold in the recycler.\n * \t@param {*} minPoolSize - Minimum number of instances to pre-allocate. Defaults to 0.375*`maxPoolSize` if not specified.\n * \n * \t!function attachTo (targetClass: any, maxPoolSize?: number, minPoolSize?: number) : any;\n */\n\nRecycler.attachTo = function (targetClass, maxPoolSize=8192, minPoolSize=null)\n{\n\tif (!targetClass.prototype.className)\n\t\tthrow new Error ('Unable to attach recycler methods to an unnamed class.');\n\n\tif (!('__dtor' in targetClass.prototype))\n\t\tthrow new Error ('Recycler: Class '+targetClass.prototype.className+' requires `__dtor` method.');\n\n\tif (!('init' in targetClass.prototype))\n\t\tthrow new Error ('Recycler: Class '+targetClass.prototype.className+' requires `init` method.');\n\n\tif (minPoolSize === null)\n\t\tminPoolSize = int(maxPoolSize * 0.375);\n\n\trecyclingFacilities[targetClass.prototype.className] = targetClass;\n\n\ttargetClass.recyclerPool = [ ];\n\ttargetClass.recyclerPoolMax = maxPoolSize;\n\n\ttargetClass.prototype.objectId = 0;\n\n\ttargetClass.recyclerNextObjectId = 0;\n\ttargetClass.recyclerCreated = 0;\n\ttargetClass.recyclerRecycled = 0;\n\ttargetClass.recyclerMissed = 0;\n\ttargetClass.recyclerLength = 0;\n\ttargetClass.recyclerActive = 0;\n\n\tlet preallocated = false;\n\n\t/**\n\t * \tPreallocates instances according the the minPoolSize value.\n\t */\n\ttargetClass.preallocate = function (maximum=null)\n\t{\n\t\tif (preallocated)\n\t\t\treturn;\n\n\t\tlet n = maximum === null ? minPoolSize : Math.min(maximum, minPoolSize);\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\ttargetClass.recyclerPool.push(new targetClass ());\n\t\t\ttargetClass.recyclerLength++;\n\t\t\ttotalPreallocated++;\n\t\t}\n\n\t\tpreallocated = true;\n\t};\n\n\t/**\n\t * \tAllocates a new instance of the class. To ensure correct instance state a call to `init` must be made later.\n\t * \t@returns {object}\n\t */\n\ttargetClass.allocate = function()\n\t{\n\t\tlet item;\n\n\t\tif (!this.recyclerLength)\n\t\t{\n\t\t\titem = new targetClass ();\n\t\t\ttargetClass.recyclerCreated++;\n\t\t}\n\t\telse\n\t\t{\n\t\t\titem = this.recyclerPool[--this.recyclerLength];\n\t\t\ttargetClass.recyclerRecycled++;\n\t\t}\n\n\t\ttargetClass.recyclerActive++;\n\n\t\titem.objectId = ++this.recyclerNextObjectId;\n\t\tthis.recyclerNextObjectId &= 0x7FFFFFFF;\n\n\t\treturn item;\n\t};\n\n\t/**\n\t * \tAllocates an instance and initializes it. Internally runs `allocate` first and then `init` with up to 10 parameters.\n\t * \t@param {any} a0..a9 \n\t * \t@returns {object}\n\t */\n\ttargetClass.alloc = function(a0=null, a1=null, a2=null, a3=null, a4=null, a5=null, a6=null, a7=null, a8=null, a9=null)\n\t{\n\t\treturn targetClass.allocate().init(a0, a1, a2, a3, a4, a5, a6, a7, a8, a9);\n\t};\n\n\t/**\n\t * \tReleases the self object and adds it back to the pool. Duplicate call to this method will result in an error.\n\t * \t@returns {object}\n\t */\n\ttargetClass.prototype.free = function()\n\t{\n\t\tif (this.objectId < 0)\n\t\t\treturn this;\n\n\t\tif (this.objectId == 0)\n\t\t{\n\t\t\tconsole.error ('ERROR: Already released instance of ' + targetClass.prototype.className);\n\t\t\treturn this;\n\t\t}\n\n\t\tthis.__dtor();\n\n\t\tthis.objectId = 0;\n\n\t\tif (targetClass.recyclerLength >= maxPoolSize)\n\t\t\ttargetClass.recyclerMissed++;\n\t\telse\n\t\t\ttargetClass.recyclerPool[targetClass.recyclerLength++] = this;\n\n\t\ttargetClass.recyclerActive--;\n\t\treturn this;\n\t};\n\n\t/**\n\t * \tSets a flag used to prevent the instance from being destroyed.\n\t * \t@returns {object}\n\t */\n\ttargetClass.prototype.lockInstance = function(value)\n\t{\n\t\tthis.objectId = Math.abs(this.objectId);\n\t\tif (value) this.objectId = -this.objectId;\n\t\treturn this;\n\t};\n};\n\n/**\n * \tShows stats about all recycling facilities (or just the specified one) using `console.debug`.\n * \t@param name - Name of the class to show.\n * \t!function showStats (name?: string) : void;\n */\nRecycler.showStats = function (name=null)\n{\n\tlet list = recyclingFacilities;\n\n\tconsole.log('Total Preallocated: ' + totalPreallocated);\n\n\tif (name === true)\n\t{\n\t\tconsole.group('Recycling Facilities');\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tlet c = list[i];\n\t\t\tif (!c.recyclerCreated) continue;\n\n\t\t\tconsole.debug (i + ': '+(100*(c.recyclerCreated/c.recyclerPoolMax)).toFixed(1)+'%  =>  overhead=' + c.recyclerCreated + ', active='+c.recyclerActive+', array=' + c.recyclerPool.length + ', recycled=' + c.recyclerRecycled + ', in-recycler=' + c.recyclerLength + ', missed=' + c.recyclerMissed + ', space=' + (c.recyclerPoolMax - c.recyclerLength));\n\t\t}\n\t\n\t\tconsole.groupEnd();\n\t\treturn;\n\t}\n\n\tif (name !== null)\n\t{\n\t\tif (typeof(name) === 'string')\n\t\t{\n\t\t\tlet c = recyclingFacilities[name];\n\t\t\tconsole.debug (name + ': '+(100*(c.recyclerCreated/c.recyclerPoolMax)).toFixed(1)+'%  =>  overhead=' + c.recyclerCreated + ', active='+c.recyclerActive+', array=' + c.recyclerPool.length + ', recycled=' + c.recyclerRecycled + ', in-recycler=' + c.recyclerLength + ', missed=' + c.recyclerMissed + ', space=' + (c.recyclerPoolMax - c.recyclerLength));\n\t\t\treturn;\n\t\t}\n\n\t\tlist = name;\n\t}\n\n\tconsole.group('Recycling Facilities');\n\n\tfor (let i in list)\n\t{\n\t\tlet c = list[i];\n\t\tconsole.debug (i + ': '+(100*(c.recyclerCreated/c.recyclerPoolMax)).toFixed(1)+'%  =>  overhead=' + c.recyclerCreated + ', active='+c.recyclerActive+', array=' + c.recyclerPool.length + ', recycled=' + c.recyclerRecycled + ', in-recycler=' + c.recyclerLength + ', missed=' + c.recyclerMissed + ', space=' + (c.recyclerPoolMax - c.recyclerLength));\n\t}\n\n\tconsole.groupEnd();\n};\n\n\n/**\n * \tCreate a new class extending the specified target class, this new class is a recycling facility and is placed under property `Pool` of the target class. This\n * \tmethod can be used instead of the usual `attachTo` when the target class construct/deconstruct methods need to remain untouched.\n *\n * \t@param {*} maxPoolSize - Maximum number of instance to hold in the recycler.\n * \t@param {*} minPoolSize - Minimum number of instances to pre-allocate. Defaults to 0.375*`maxPoolSize` if not specified.\n * \n *\t!function createPool (targetClass: any, maxPoolSize?: number, minPoolSize?: number) : any;\n */\nRecycler.createPool = function (targetClass, maxPoolSize=8192, minPoolSize=null)\n{\n\tconst name = targetClass.prototype.className;\n\tif (!name) throw new Error ('Unable to create pool sub-class on an unnamed class.');\n\n\tconst Pool = targetClass.extend\n\t({\n\t\tclassName: targetClass.prototype.className,\n\n\t\t__ctor: function () {\n\t\t},\n\n\t\tinit: function(a0=null, a1=null, a2=null, a3=null, a4=null, a5=null, a6=null, a7=null, a8=null, a9=null)\n\t\t{\n\t\t\tthis._super[name].__ctor(a0, a1, a2, a3, a4, a5, a6, a7, a8, a9);\n\t\t\treturn this;\n\t\t}\n\t});\n\n\tRecycler.attachTo(Pool, maxPoolSize, minPoolSize);\n\ttargetClass.Pool = Pool;\n\n\treturn targetClass;\n};\n\n\n/**\n * \tRuns the preallocation process of all registered pools. Returns the total number of instances preallocated.\n * \t@param {number|null} maxPreallocationsPerPool\n * \t!function preallocate (maxPreallocationsPerPool?: number) : number;\n */\nRecycler.preallocate = function (maxPreallocationsPerPool=null)\n{\n\ttotalPreallocated = 0;\n\n\tfor (let i in recyclingFacilities)\n\t\trecyclingFacilities[i].preallocate(maxPreallocationsPerPool);\n\n\treturn totalPreallocated;\n}\n","/*\n**\tutils/linkable.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Recycler from './recycler.js';\n\n//![import \"./recycler\"]\n\n//:/**\n//: * \tGeneric class for linkable items such as required by List. The responsibility of this class is to wrap a value into a linkable object.\n//: */\n\n//!class Linkable\n\nconst Linkable = Class.extend\n({\n\tclassName: \"Linkable\",\n\n\t/**\n\t * \tPointer to the previous item in the chain.\n\t * \t!readonly prev: Linkable;\n\t */\n\tprev: null, /* Linkable */\n\n\t/**\n\t * \tPointer to the next item in the chain.\n\t * \t!readonly next: Linkable;\n\t */\n\tnext: null, /* Linkable */\n\n\t/**\n\t * \tWrapped value.\n\t * \t!value: any;\n\t */\n\tvalue: null,\n\n\t/**\n\t * \tInitializes the linkable item and wraps the given value. Sets the `prev` and `next` pointers to null.\n\t * \t!constructor (value?: any);\n\t */\n\t__ctor: function (value)\n\t{\n\t\tthis.value = value;\n\t\tthis.clear();\n\t},\n\n\t/**\n\t * \tUnlinks the linkable item.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis.unlink();\n\t},\n\n\t/**\n\t * \tSets the previous/next connection pointers to null. Returns `this`.\n\t * \t!clear() : Linkable;\n\t */\n\tclear: function ()\n\t{\n\t\tthis.next = this.prev = null;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tLinks the item such that it will be located after the given reference.\n\t * \t!linkAfter (ref: Linkable) : Linkable;\n\t */\n\tlinkAfter: function (ref)\n\t{\n\t\tthis.prev = ref;\n\t\tthis.next = ref ? ref.next : null;\n\n\t\tif (ref)\n\t\t{\n\t\t\tif (ref.next) ref.next.prev = this;\n\t\t\tref.next = this;\n\t\t}\n\t},\n\n\t/**\n\t * \tLinks the item such that it will be located before the given reference.\n\t * \t!linkBefore (ref: Linkable) : Linkable;\n\t */\n\tlinkBefore: function (ref)\n\t{\n\t\tthis.prev = ref ? ref.prev : null;\n\t\tthis.next = ref;\n\n\t\tif (ref)\n\t\t{\n\t\t\tif (ref.prev) ref.prev.next = this;\n\t\t\tref.prev = this;\n\t\t}\n\t},\n\n\t/**\n\t * \tUnlinks the item by linking the `prev` and `next` together (when available) and returns `this`.\n\t * \t!unlink() : Linkable;\n\t */\n\tunlink: function () \n\t{\n\t\tif (this.prev) this.prev.next = this.next;\n\t\tif (this.next) this.next.prev = this.prev;\n\n\t\treturn this.clear();\n\t}\n});\n\n//!/class\n\n//!namespace Linkable\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a linkable item and wraps the given value. Sets the `prev` and `next` pointers to null.\n\t * \t!function alloc (value?: any) : Linkable;\n\t */\n\nRecycler.createPool (Linkable, 16384, 6144);\nexport default Linkable;\n","/*\n**\tutils/list.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rinn, Class } from 'rinn';\nimport Linkable from './linkable.js';\nimport Recycler from './recycler.js';\n\n//![import \"./linkable\"]\n//![import \"./recycler\"]\n\n//:/**\n//: * \tImplementation of a generic linked list.\n//: */\n\n//!class List\n\nconst List = Class.extend\n({\n\t/**\n\t * \tName of the class (for inheritance purposes).\n\t */\n\tclassName: \"List\",\n\n\t/**\n\t * \tPointer to the first node in the list.\n\t * \t!top: Linkable;\n\t */\n\ttop: null,\n\n\t/**\n\t * \tPointer to the last node in the list.\n\t * \t!bottom: Linkable;\n\t */\n\tbottom: null,\n\n\t/**\n\t * \tNumber of values in the list.\n\t * \t!length: number;\n\t */\n\tlength: 0,\n\n\t/**\n\t * \tInitializes the instance to an empty list.\n\t * \t!constructor();\n\t */\n\t__ctor: function ()\n\t{\n\t\tthis.top = null;\n\t\tthis.bottom = null;\n\t\tthis.length = 0;\n\t},\n\n\t/**\n\t * \tTraverses the list and destroys all nodes. The actual values are maintained. To destroy the\n\t * \tlist contents call clear() instead.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis.reset();\n\t},\n\n\t/**\n\t * \tClones all contents and returns a new list.\n\t * \t!clone() : List;\n\t */\n\tclone: function()\n\t{\n\t\tlet list = List.Pool.alloc();\n\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tlist.push(Rinn.clone(i.value));\n\n\t\treturn list;\n\t},\n\n\t/**\n\t * \tTraverses the list and destroys all nodes and values.\n\t * \t!clear() : List;\n\t */\n\tclear: function ()\n\t{\n\t\tlet i, ni;\n\n\t\tfor (i = this.top; i; i = ni)\n\t\t{\n\t\t\tni = i.next;\n\t\t\tdispose(i.free().value);\n\t\t}\n\n\t\tthis.top = this.bottom = null;\n\t\tthis.length = 0;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tTraverses the list, destroys all nodes **but** values are preserved.\n\t * \t!reset() : List;\n\t */\n\treset: function ()\n\t{\n\t\tlet i, ni;\n\n\t\tfor (i = this.top; i != null; i = ni)\n\t\t{\n\t\t\tni = i.next;\n\t\t\ti.free();\n\t\t}\n\n\t\tthis.top = this.bottom = null;\n\t\tthis.length = 0;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the first value in the list.\n\t * \t!first() : any;\n\t */\n\tfirst: function ()\n\t{\n\t\treturn this.top !== null ? this.top.value : null;\n\n\t},\n\t/**\n\t * \tReturns the last value in the list.\n\t * \t!last() : any;\n\t */\n\tlast: function ()\n\t{\n\t\treturn this.bottom !== null ? this.bottom.value : null;\n\t},\n\n\t/**\n\t * \tReturns a value given its index.\n\t * \t!getAt (index: number) : any;\n\t */\n\tgetAt: function (index)\n\t{\n\t\tlet i = null;\n\t\tfor (i = this.top; i && index-- > 0; i = i.next);\n\t\treturn i != null ? i.value : null;\n\t},\n\n\t/**\n\t * \tReturns the node at the given index.\n\t * \t!getNodeAt (index: number) : Linkable;\n\t */\n\tgetNodeAt: function (index)\n\t{\n\t\tlet i = null;\n\t\tfor (i = this.top; i && index--; i = i.next);\n\t\treturn i;\n\t},\n\n\t/**\n\t * \tReturns the node of a value given another value to compare, uses identical comparison (===) to match the value.\n\t * \t!sgetNode (value: any) : Linkable;\n\t */\n\tsgetNode: function (value)\n\t{\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tif (i.value === value) return i;\n\n\t\treturn null;\n\t},\n\n\t/**\n\t * \tRemoves the given value from the list and returns it.\n\t * \t!remove<T> (value: T) : T;\n\t */\n\tremove: function (i)\n\t{\n\t\tif (i != null && !Linkable.isInstance(i))\n\t\t\ti = this.sgetNode(i);\n\n\t\tif (!i) return null;\n\n\t\tif (!i.prev) this.top = i.next;\n\t\tif (!i.next) this.bottom = i.prev;\n\n\t\tthis.length--;\n\t\treturn i.free().value;\n\t},\n\n\t/**\n\t * \tAdds a value before the given reference node.\n\t * \t!insertBefore<T> (ref: Linkable, value: T) : T;\n\t */\n\tinsertBefore: function (ref, value)\n\t{\n\t\tif (!ref) return this;\n\n\t\tlet i = Linkable.Pool.alloc(value);\n\t\ti.linkBefore (ref);\n\n\t\tif (ref == this.top) this.top = i;\n\t\tthis.length++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * \tAdds a value after the given reference node.\n\t * \t!insertAfter<T> (ref: Linkable, value: T) : T;\n\t */\n\tinsertAfter: function (ref, value)\n\t{\n\t\tif (!ref) return this;\n\n\t\tlet i = Linkable.Pool.alloc(value);\n\t\ti.linkAfter (ref);\n\n\t\tif (ref == this.bottom) this.bottom = i;\n\t\tthis.length++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * \tAdds a value to the top of the list.\n\t * \t!unshift<T> (value: T) : T;\n\t */\n\tunshift: function (value)\n\t{\n\t\tlet i = Linkable.Pool.alloc(value);\n\n\t\ti.linkBefore (this.top);\n\t\tif (!this.bottom) this.bottom = i;\n\n\t\tthis.top = i;\n\t\tthis.length++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * \tRemoves a value from the top of the list.\n\t * \t!shift() : any;\n\t */\n\tshift: function ()\n\t{\n\t\tlet i = this.top;\n\t\tif (!i) return null;\n\n\t\tif (!(this.top = i.next)) this.bottom = null;\n\t\tthis.length--;\n\n\t\treturn i.free().value;\n\t},\n\n\t/**\n\t * \tAdds a value to the bottom of the list.\n\t * \t!push<T> (value: T) : T;\n\t */\n\tpush: function (value)\n\t{\n\t\tlet i = Linkable.Pool.alloc(value);\n\n\t\ti.linkAfter (this.bottom);\n\t\tif (!this.top) this.top = i;\n\n\t\tthis.bottom = i;\n\t\tthis.length++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * \tRemoves a value from the bottom of the list.\n\t * \t!pop() : any;\n\t */\n\tpop: function ()\n\t{\n\t\tlet i = this.bottom;\n\t\tif (!i) return null;\n\n\t\tif (!(this.bottom = i.prev)) this.top = null;\n\t\tthis.length--;\n\n\t\treturn i.free().value;\n\t},\n\n\t/**\n\t * \tAppends all contents of the given list to the current one.\n\t * \t!append (list: List) : List;\n\t */\n\tappend: function (list)\n\t{\n\t\tfor (let i = list.top; i; i = i.next)\n\t\t\tthis.push(i.value);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tTraverses the list calling the specified function for each value.\n\t * \t@param fn - Callback to execute, return `false` to stop the loop immediately.\n\t * \t!forEach(fn: (value: any, node: Linkable, list: List, context: object) => boolean, context?: object) : boolean;\n\t */\n\tforEach: function (fn, context=null)\n\t{\n\t\tlet ni;\n\t\n\t\tfor (let i = this.top; i; i = ni)\n\t\t{\n\t\t\tni = i.next;\n\t\t\tif (fn (i.value, i, this, context) === false) return false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tTraverses the list in reverse order, calling the specified function for each value.\n\t * \t@param fn - Callback to execute, return `false` to stop the loop immediately.\n\t * \t!forEachRev(fn: (value: any, node: Linkable, list: List, context: object) => boolean, context?: object) : boolean;\n\t */\n\tforEachRev: function (fn, context=null)\n\t{\n\t\tlet ni;\n\t\n\t\tfor (let i = this.bottom; i; i = ni)\n\t\t{\n\t\t\tni = i.prev;\n\t\t\tif (fn (i.value, i, this, context) === false) return false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tReturns the first value where the specified function returns `true`.\n\t * \t!find (fn: (value: any, context: object) => boolean, context?: object) : any;\n\t */\n\tfind: function (fn, context=null)\n\t{\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tif (fn(i.value, context)) return i.value;\n\n\t\treturn null;\n\t},\n\n\t/**\n\t * \tReturns an array with all values where the specified function returns `true`.\n\t * \t!filter (fn: (value: any, context: object) => boolean, context?: object) : Array<any>;\n\t */\n\tfilter: function (fn, context=null)\n\t{\n\t\tlet list = List.Pool.alloc();\n\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tif (fn(i.value, context)) list.push(i.value);\n\n\t\treturn list;\n\t},\n\n\t/**\n\t * \tReturns an array with all the values in the list.\n\t * \t!toArray() : Array<any>;\n\t */\n\ttoArray: function()\n\t{\n\t\tlet array = [];\n\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tarray.push(i.value);\n\n\t\treturn array;\n\t}\n});\n\n//!/class\n\n//!namespace List\n//!namespace Pool\n\n\t/**\n\t * \tAllocates an empty list.\n\t * \t!function alloc() : List;\n\t */\n\nRecycler.createPool (List, 16384, 6144);\nexport default List;\n","/*\n**\tsystem/timer.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n//!class Timer\n\n/**\n * \t@param vsync - Indicates if requestAnimationFrame should be used instead of setTimeout.\n * \t@param interval - Amount of milliseconds between timer activations.\n * \t@param callback - Function to execute on each timer activation.\n *\n * \t!constructor (vsync: boolean, interval: number, callback: (dt: number, timer: Timer) => void );\n */\nconst Timer = function (vsync, interval, callback)\n{\n\tthis.callback = callback;\n\tthis.interval = interval;\n\tthis.vsync = vsync;\n\tthis.handle = null;\n\n\tthis.isRunning = false;\n\tthis.startTime = 0;\n\tthis.rTime = 0;\n\tthis.sTime = 0;\n\tthis.lTime = 0;\n\tthis.tDelta = 0;\n\n\tthis._onTimeout = () => {\n\t\tthis.onTimeout();\n\t};\n\n\tthis._onTimeout_b = () => {\n\t\tthis.runNow();\n\t};\n};\n\n/**\n * \tTimer onTimeout handler.\n */\nTimer.prototype.onTimeout = function ()\n{\n\tif (!this.isRunning) return;\n\n\tthis.rTime = hrnow() - this.startTime;\n\n\tlet tError = this.rTime - (this.sTime + this.interval);\n\tif (tError < 0)\n\t{\n\t\tthis.runAfter(-tError);\n\t\treturn;\n\t}\n\n\tthis.sTime += this.interval * (1 + int(tError / this.interval));\n\n\tthis.tDelta = tError < 0 ? this.interval : (this.rTime - this.lTime);\n\tthis.lTime = this.rTime;\n\n\tthis.runAfter((this.sTime + this.interval) - (hrnow() - this.startTime));\n\tthis.callback(this.tDelta, this);\n};\n\n/**\n * \tStarts the timer and triggers `onStarted`.\n *\n * \t@param immediate - When `true` the callback will be executed immediately.\n * \t@param scale - Used to control when to trigger the first timeout, delay is timeInterval*scale.\n *\n * \t!start (immediate?: boolean, scale?: number) : void;\n */\nTimer.prototype.start = function (immediate=false, scale=1.0)\n{\n\tif (this.isRunning) return;\n\n\tthis.startTime = hrnow();\n\tthis.isRunning = true;\n\n\tthis.sTime = 0;\n\tthis.lTime = 0;\n\n\tthis.onStarted();\n\n\tif (immediate)\n\t\tthis.callback (0, this);\n\n\tthis.runAfter(this.interval*scale);\n};\n\n/**\n * \tExecutes the timer activation after the specified amount of milliseconds.\n *\n * \t!runAfter (timeout: number) : void;\n */\nTimer.prototype.runAfter = function (timeout)\n{\n\tif (process.browser && this.vsync)\n\t{\n\t\trequestAnimationFrame(this._onTimeout_b);\n\t\treturn;\n\t}\n\n\tif (this.handle)\n\t\tclearTimeout(this.handle);\n\n\tthis.handle = setTimeout(this._onTimeout, timeout);\n};\n\n/**\n * \tExecutes the timer activaton as soon as possible.\n *\n * \t!runNow() : void;\n */\nTimer.prototype.runNow = function ()\n{\n\tif (this.handle)\n\t\tclearTimeout(this.handle);\n\n\tthis.handle = setTimeout(this._onTimeout, 0);\n};\n\n/**\n * \tStops the timer and triggers `onStopped`.\n *\n * \t!stop() : void;\n */\nTimer.prototype.stop = function ()\n{\n\tif (!this.isRunning) return;\n\n\tif (this.handle)\n\t{\n\t\tclearTimeout(this.handle);\n\t\tthis.handle = null;\n\t}\n\n\tthis.isRunning = false;\n\tthis.onStopped();\n};\n\n/**\n * \tTimer started event handler.\n *\n * \t!onStarted() : void;\n */\nTimer.prototype.onStarted = function ()\n{\n};\n\n/**\n * \tTimer stopped event handler.\n *\n * \t!onStopped() : void;\n */\nTimer.prototype.onStopped = function ()\n{\n};\n\nexport default Timer;\n","/*\n**\tmath/vec2.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"../utils/recycler\"]\n\n//:/**\n//: * \tRepresentation of a vector in 2D space, that is, a float tuple with components x and y.\n//: */\n\n//!class Vec2\n\nconst Vec2 = Class.extend\n({\n\tclassName: 'Vec2',\n\n\t/**\n\t * \tCoordinates of the vector.\n\t * \t!x: number;\n\t * \t!y: number;\n\t */\n\tx: 0, y: 0,\n\n\t/**\n\t *\tConstructs the vector from another Vec2.\n\t * \t!constructor (value: Vec2);\n\t */\n\t/**\n\t *\tConstructs the vector with the specified coordinates.\n\t * \t!constructor (x?: number, y?: number);\n\t */\n\t__ctor: function (x=null, y=null)\n\t{\n\t\treturn this.set(x, y);\n\t},\n\n\t/**\n\t * \tClones the vector coordinates into a new Vec2 object.\n\t * \t!clone() : Vec2;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Vec2.Pool.alloc(this);\n\t},\n\n\t/**\n\t *\tSets the coordinates of the vector from a Vec2 object.\n\t *\t!set (value: Vec2) : Vec2;\n\t */\n\t/**\n\t *\tSets the coordinates of the vector.\n\t *\t!set (x: number, y: number) : Vec2;\n\t */\n\tset: function (x, y=null)\n\t{\n\t\tif (x === null) {\n\t\t\tx = 0;\n\t\t\ty = 0;\n\t\t}\n\t\telse if (y === null) {\n\t\t\tlet v = x;\n\t\t\tx = v.x;\n\t\t\ty = v.y;\n\t\t}\n\n\t\tthis.x = x;\n\t\tthis.y = y;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the X-coordinate of the vector.\n\t * \t!setX (x: number) : Vec2;\n\t */\n\tsetX: function (x)\n\t{\n\t\tthis.x = x;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the Y-coordinate of the vector.\n\t * \t!setY (y: number) : Vec2;\n\t */\n\tsetY: function (y)\n\t{\n\t\tthis.y = y;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the coordinates of the vector to zero.\n\t * \t!zero() : Vec2;\n\t */\n\tzero: function()\n\t{\n\t\treturn this.set(0, 0);\n\t},\n\n\t/**\n\t * \tReturns true if the vector coordinates are both zero.\n\t * \t!isZero() : boolean;\n\t */\n\tisZero: function()\n\t{\n\t\treturn this.x == 0 && this.y == 0;\n\t},\n\n\t/**\n\t *\tReturns true if the coordinates of the vector have the same values as the given Vec2.\n\t *\t!equals (value: Vec2) : boolean;\n\t */\n\t/**\n\t *\tReturns true if the coordinates of the vector have the same values as the given ones.\n\t *\t!equals (x: number, y: number) : boolean;\n\t */\n\tequals: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tlet v = x;\n\t\t\tx = v.x;\n\t\t\ty = v.y;\n\t\t}\n\n\t\treturn this.x == x && this.y == y;\n\t},\n\n\t/**\n\t * \tNegates the vector, that is changing the sign of each component in the vector.\n\t * \t!neg() : Vec2;\n\t */\n\tneg: function ()\n\t{\n\t\tthis.x = -this.x; this.y = -this.y;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tInverts the vector by changing each component to its reciprocal.\n\t * \t!inv() : Vec2;\n\t */\n\tinv: function ()\n\t{\n\t\tthis.x = 1 / this.x; this.y = 1 / this.y;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tChanges the components of the vector to their absolute value.\n\t * \t!abs() : Vec2;\n\t */\n\tabs: function ()\n\t{\n\t\tthis.x = this.x < 0 ? -this.x : this.x;\n\t\tthis.y = this.y < 0 ? -this.y : this.y;\n\t\treturn this;\n\t},\n\n\t/**\n\t *\tAdds the coordinates of the given Vec2 to the vector.\n\t *\t!translate (value: Vec2) : Vec2;\n\t */\n\t/**\n\t *\tAdds the given delta values to the vector.\n\t *\t!translate (dx: number, dy: number) : Vec2;\n\t */\n\ttranslate: function (dx, dy=null)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tlet v = dx;\n\t\t\tdx = v.x;\n\t\t\tdy = v.y;\n\t\t}\n\n\t\tthis.x += dx, this.y += dy;\n\t\treturn this;\n\t},\n\n\t/**\n\t *\tRotates the vector by the specified angle.\n\t *\t!rotate (angle: number) : Vec2;\n\t */\n\trotate: function (angle)\n\t{\n\t\tlet x = this.x*Math.cos(angle) + this.y*Math.sin(angle);\n\t\tlet y = this.y*Math.cos(angle) - this.x*Math.sin(angle);\n\n\t\tthis.x = x;\n\t\tthis.y = y;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t *\tAdds the coordinates of the given Vec2 to the vector.\n\t *\t!add (value: Vec2) : Vec2;\n\t */\n\t/**\n\t *\tAdds the given delta values to the vector.\n\t *\t!add (dx: number, dy: number) : Vec2;\n\t */\n\tadd: function (dx, dy=null)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tlet v = dx;\n\t\t\tdx = v.x;\n\t\t\tdy = v.y;\n\t\t}\n\n\t\tthis.x += dx, this.y += dy;\n\t\treturn this;\n\t},\n\n\t/**\n\t *\tSubtracts the coordinates of the given Vec2 from the vector.\n\t *\t!sub (value: Vec2) : Vec2;\n\t */\n\t/**\n\t *\tSubtracts the given delta values from the vector.\n\t *\t!sub (dx: number, dy: number) : Vec2;\n\t */\n\tsub: function (dx, dy=null)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tlet v = dx;\n\t\t\tdx = v.x;\n\t\t\tdy = v.y;\n\t\t}\n\n\t\tthis.x -= dx, this.y -= dy;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tScales each components of the vector by the respective component of the given one.\n\t * \t!scale (k: number) : Vec2;\n\t */\n\t/**\n\t * \tScales both components of the vector by the given factor.\n\t * \t!scale (k: number) : Vec2;\n\t */\n\t/**\n\t * \tScales each components of the vector by the given factors.\n\t * \t!scale (fx: number, fy: number) : Vec2;\n\t */\n\tscale: function (fx, fy=null)\n\t{\n\t\tif (fy === null)\n\t\t{\n\t\t\tif (Vec2.isInstance(fx)) {\n\t\t\t\tlet v = fx;\n\t\t\t\tfx = v.x;\n\t\t\t\tfy = v.y;\n\t\t\t} else {\n\t\t\t\tfy = fx;\n\t\t\t}\n\t\t}\n\n\t\tthis.x *= fx, this.y *= fy;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the components to their integer parts.\n\t * \t!floor() : Vec2;\n\t */\n\tfloor: function ()\n\t{\n\t\tthis.x = int(this.x);\n\t\tthis.y = int(this.y);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the components to their fractional parts.\n\t * \t!fract() : Vec2;\n\t */\n\tfract: function ()\n\t{\n\t\tthis.x = this.x - int(this.x);\n\t\tthis.y = this.y - int(this.y);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the dot product of the vectors.\n\t * \t!dot (value: Vec2) : number;\n\t */\n\t/**\n\t * \tReturns the dot product of the vector and the given values.\n\t * \t!dot (x: number, y: number) : number;\n\t */\n\tdot: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tlet v = x;\n\t\t\tx = v.x;\n\t\t\ty = v.y;\n\t\t}\n\n\t\treturn this.x*x + this.y*y;\n\t},\n\n\t/**\n\t * \tReturns the magnitude of the vector.\n\t * \t!magnitude(squared: boolean) : number;\n\t */\n\tmagnitude: function (squared=false)\n\t{\n\t\treturn squared ? (this.x*this.x + this.y*this.y) : Math.sqrt(this.x*this.x + this.y*this.y);\n\t},\n\n\t/**\n\t * \tNormalizes the vector by dividing each component by the vector magnitude to obtain a unit vector.\n\t * \t!normalize() : Vec2;\n\t */\n\tnormalize: function ()\n\t{\n\t\treturn this.isZero() ? this : this.scale (1 / this.magnitude());\n\t},\n\n\t/**\n\t * \tSets the vector to its major-axis, that is the component with the maximum absolute value.\n\t * \t!majorAxis() : Vec2;\n\t */\n\tmajorAxis: function ()\n\t{\n\t\tif (Math.abs(this.x) > Math.abs(this.y)) this.y = 0; else this.x = 0;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the vector to its minor-axis, that is the component with the minimum absolute value.\n\t * \t!minorAxis() : Vec2;\n\t */\n\tminorAxis: function ()\n\t{\n\t\tif (Math.abs(this.x) < Math.abs(this.y)) this.y = 0; else this.x = 0;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the vector to its sign-vector representation.\n\t * \t!sign() : Vec2;\n\t */\n\tsign: function ()\n\t{\n\t\tthis.x = !this.x ? 0 : (this.x < 0 ? -1 : 1);\n\t\tthis.y = !this.y ? 0 : (this.y < 0 ? -1 : 1);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the string representation of the coordinates of the vector.\n\t * \ttoString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn `(${this.x}, ${this.y})`;\n\t}\n});\n\n//!/class\n\n//!namespace Vec2\n//!namespace Pool\n\n/**\n *\tAllocates a vector from another Vec2.\n * \t!function alloc (value: Vec2) : Vec2;\n */\n/**\n *\tAllocates a vector with the specified coordinates.\n * \t!function alloc (x?: number, y?: number) : Vec2;\n */\n\nRecycler.createPool (Vec2, 4096, 2048);\nexport default Vec2;\n","/*\n**\tmath/matrix.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Recycler from '../utils/recycler.js';\nimport Vec2 from './vec2.js';\n\n//![import \"../utils/recycler\"]\n//![import \"./vec2\"]\n\nconst temp = new Float32Array(9).fill(0);\nconst temp2 = new Float32Array(9).fill(0);\n\n//:/**\n//: * \tRepresents a 3x3 matrix. Provides an interface to manipulate 3x3 matrices.\n//: */\n\n//!class Matrix\n\nconst Matrix = Class.extend\n({\n\tclassName: 'Matrix',\n\n\t/**\n\t * \tActual elements of the matrix.\n\t * \t!data: Float32Array\n\t */\n\tdata: null,\n\n\t/**\n\t * \tConstructs a new matrix copying the elements from the specified matrix.\n\t * \t!constructor(value: Matrix);\n\t */\n\t/**\n\t * \tConstructs a new matrix with the values from the specified array.\n\t * \t!constructor(value: Float32Array);\n\t */\n\t/**\n\t * \tConstructs a new matrix with the identity matrix values.\n\t * \t!constructor();\n\t */\n\t__ctor: function(value=null)\n\t{\n\t\tif (this.data === null)\n\t\t\tthis.data = new Float32Array(9);\n\n\t\tif (value !== null)\n\t\t\tthis.set(value);\n\t\telse\n\t\t\tthis.identity();\n\t},\n\n\t/**\n\t * \tFills the matrix with zeroes.\n\t * \t!zero() : Matrix;\n\t */\n\tzero: function()\n\t{\n\t\tthis.data.fill(0);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tFills the matrix with the specified value.\n\t * \t!fill (value: number) : Matrix;\n\t */\n\tfill: function (value)\n\t{\n\t\tthis.data.fill(value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCopies the specified matrix elements into the current one.\n\t * \t!set (value: Matrix) : Matrix;\n\t */\n\t/**\n\t * \tSets the matrix elements from the specified array.\n\t * \t!set (value: Float32Array) : Matrix;\n\t */\n\tset: function (value)\n\t{\n\t\tif (Matrix.isInstance(value))\n\t\t{\n\t\t\tfor (let i = 0; i < 9; i++) this.data[i] = value.data[i];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let i = 0; i < 9; i++) this.data[i] = value[i];\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the elements of the matrix to be the identity matrix.\n\t * \t!identity() : Matrix;\n\t */\n\tidentity: function (target=null)\n\t{\n\t\tif (target === null)\n\t\t\ttarget = this.data;\n\n\t\ttarget.fill(0);\n\t\ttarget[0] = target[4] = target[8] = 1;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMultiplies all elements in the matrix by a given scalar.\n\t * \t!scalef (scalar: number) : Matrix;\n\t */\n\tscalef: function (scalar)\n\t{\n\t\tfor (let i = 0; i < 9; i++) this.data[i] *= scalar;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns a clone of the matrix.\n\t * \t!clone() : Matrix;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Matrix.Pool.alloc(this);\n\t},\n\n\t/**\n\t * \tAppends the given matrix to the current one using matrix multiplication (self * matrix).\n\t * \t!append (matrix: Matrix) : Matrix;\n\t */\n\tappend: function (matr)\n\t{\n\t\tif (matr instanceof Matrix)\n\t\t\tmatr = matr.data;\n\n\t\tfor (let i = 0; i < 9; i++) temp[i] = this.data[i];\n\n\t\tthis.data[0] = matr[0]*temp[0] + matr[1]*temp[3] + matr[2]*temp[6];\n\t\tthis.data[1] = matr[0]*temp[1] + matr[1]*temp[4] + matr[2]*temp[7];\n\t\tthis.data[2] = matr[0]*temp[2] + matr[1]*temp[5] + matr[2]*temp[8];\n\t\tthis.data[3] = matr[3]*temp[0] + matr[4]*temp[3] + matr[5]*temp[6];\n\t\tthis.data[4] = matr[3]*temp[1] + matr[4]*temp[4] + matr[5]*temp[7];\n\t\tthis.data[5] = matr[3]*temp[2] + matr[4]*temp[5] + matr[5]*temp[8];\n\t\tthis.data[6] = matr[6]*temp[0] + matr[7]*temp[3] + matr[8]*temp[6];\n\t\tthis.data[7] = matr[6]*temp[1] + matr[7]*temp[4] + matr[8]*temp[7];\n\t\tthis.data[8] = matr[6]*temp[2] + matr[7]*temp[5] + matr[8]*temp[8];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCreates a translation matrix and appends it.\n\t * \t!translate (x: number, y: number) : Matrix;\n\t */\n\ttranslate: function (x, y)\n\t{\n\t\tif (x == 0 && y == 0)\n\t\t\treturn this;\n\n\t\tfor (let i = 0; i < 9; i++) temp[i] = this.data[i];\n\n\t\tthis.data[6] = x*temp[0] + y*temp[3] + temp[6];\n\t\tthis.data[7] = x*temp[1] + y*temp[4] + temp[7];\n\t\tthis.data[8] = x*temp[2] + y*temp[5] + temp[8];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCreates a rotation matrix for the given angle (in radians) and appends it.\n\t * \t!rotate (angle: number) : Matrix;\n\t */\n\trotate: function (angle)\n\t{\n\t\tif (angle == 0)\n\t\t\treturn this;\n\n\t\tthis.identity(temp2);\n\n\t\tlet cost = Math.cos(angle);\n\t\tlet sint = Math.sin(angle);\n\n\t\ttemp2[0] = cost;\n\t\ttemp2[1] = -sint;\n\t\ttemp2[3] = sint;\n\t\ttemp2[4] = cost;\n\n\t\treturn this.append(temp2);\n\t},\n\n\t/**\n\t * \tCreates a scaling matrix and appends it.\n\t * \t!scale (sx: number, sy: number) : Matrix;\n\t */\n\tscale: function (sx, sy)\n\t{\n\t\tif (sx == 1 && sy == 1)\n\t\t\treturn this;\n\n\t\tthis.identity(temp2);\n\n\t\ttemp2[0] = sx;\n\t\ttemp2[4] = sy;\n\n\t\treturn this.append(temp2);\n\t},\n\n\t/**\n\t * \tApplies the matrix to the specified vector (matrix-vector multiplication) and returns a new Vec2.\n\t * \t!applyTo (vect: Vec2) : Vec2;\n\t */\n\t/**\n\t * \tApplies the matrix to the specified coordinates (matrix-vector multiplication) and returns a new Vec2.\n\t * \t!applyTo (x: number, y: number) : Vec2;\n\t */\n\tapplyTo: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tconst v = x;\n\t\t\tx = v.x;\n\t\t\ty = v.y;\n\t\t}\n\n\t\tlet nx = this.data[0]*x + this.data[3]*y + this.data[6];\n\t\tlet ny = this.data[1]*x + this.data[4]*y + this.data[7];\n\n\t\treturn Vec2.Pool.alloc(nx, ny);\n\t},\n\n\t/**\n\t * \tTransposes the matrix.\n\t * \t!transpose() : Matrix;\n\t */\n\ttranspose: function ()\n\t{\n\t\ttemp.fill(0);\n\n\t\tfor (let j = 0; j < 3; j++)\n\t\tfor (let i = 0; i < 3; i++)\n\t\t\ttemp[j*3+i] = this.data[i*3+j];\n\n\t\tfor (let i = 0; i < 9; i++) this.data[i] = temp[i];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the determinant of the matrix.\n\t * \t!det() : number;\n\t */\n\tdet: function ()\n\t{\n\t\treturn\tthis.data[0] * (this.data[4]*this.data[8] - this.data[5]*this.data[7]) -\n\t\t\t\tthis.data[1] * (this.data[3]*this.data[8] - this.data[5]*this.data[6]) +\n\t\t\t\tthis.data[2] * (this.data[3]*this.data[7] - this.data[4]*this.data[6])\n\t\t\t\t;\n\t},\n\n\t/**\n\t * \tReturns a new matrix with the adjoint of the current matrix.\n\t * \t!adj() : Matrix;\n\t */\n\tadj: function () // violet:verify and fix\n\t{\n\t\t/*let t = this.transpose();\n\t\tlet d = Matrix.Pool.alloc();\n\n\t\td.data[0] = (t.data[4]*t.data[8] - t.data[5]*t.data[7]);\n\t\td.data[1] = -(t.data[3]*t.data[8] - t.data[5]*t.data[6]);\n\t\td.data[2] = (t.data[3]*t.data[7] - t.data[4]*t.data[6]);\n\n\t\td.data[3] = -(t.data[1]*t.data[8] - t.data[2]*t.data[7]);\n\t\td.data[4] = (t.data[0]*t.data[8] - t.data[2]*t.data[6]);\n\t\td.data[5] = -(t.data[0]*t.data[7] - t.data[1]*t.data[6]);\n\n\t\td.data[6] = (t.data[1]*t.data[5] - t.data[2]*t.data[4]);\n\t\td.data[7] = -(t.data[0]*t.data[5] - t.data[2]*t.data[3]);\n\t\td.data[8] = (t.data[0]*t.data[4] - t.data[1]*t.data[3]);\n\n\t\tt.data = d;\n\t\treturn t;*/\n\t\tthrow new Error('NOT IMPLEMENTED');\n\t},\n\n\t/**\n\t * \tReturns a new matrix with the inverse of the current matrix.\n\t * \t!inverse() : Matrix;\n\t */\n\tinverse: function ()\n\t{\n\t\tlet det = this.det();\n\t\tif (!det) return null;\n\n\t\treturn this.adj().scalef(1/det);\n\t},\n\n\t/**\n\t * \tReturns a string representation of the matrix.\n\t * \t!toString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn `[${this.data[0]}, ${this.data[3]}, ${this.data[6]}]\\n[${this.data[1]}, ${this.data[4]}, ${this.data[7]}]\\n[${this.data[2]}, ${this.data[5]}, ${this.data[8]}]\\n`;\n\t}\n});\n\n/**\n * \tSets the components of the specified array as the identity matrix.\n * \t!static loadIdentity (target: Float32Array) : void;\n */\nMatrix.loadIdentity = function (target)\n{\n\ttarget.fill(0);\n\ttarget[0] = target[4] = target[8] = 1;\n};\n\n//!/class\n\n//!namespace Matrix\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a new matrix copying the components from the specified matrix.\n\t * \t!function alloc (value: Matrix): Matrix;\n\t */\n\t/**\n\t * \tAllocates a new matrix with the values from the specified array.\n\t * \t!function alloc (value: Float32Array): Matrix;\n\t */\n\t/**\n\t * \tAllocates a new matrix with the identity matrix values.\n\t * \t!function alloc (): Matrix;\n\t */\n\nRecycler.createPool (Matrix, 4096, 1024);\nexport default Matrix;\n","//!namespace gl\n\n\t//!enum BufferTarget\n\t\t//:ARRAY_BUFFER\n\t\t//:ELEMENT_ARRAY_BUFFER\n\t\t//:COPY_READ_BUFFER\n\t\t//:COPY_WRITE_BUFFER\n\t\t//:TRANSFORM_FEEDBACK_BUFFER\n\t\t//:UNIFORM_BUFFER\n\t\t//:PIXEL_PACK_BUFFER\n\t\t//:PIXEL_UNPACK_BUFFER\n\t//!/enum\n\n\t//!enum BufferUsage\n\t\t//!STATIC_DRAW\n\t\t//!DYNAMIC_DRAW\n\t\t//!STREAM_DRAW\n\t\t//!STATIC_READ\n\t\t//!DYNAMIC_READ\n\t\t//!STREAM_READ\n\t\t//!STATIC_COPY\n\t\t//!DYNAMIC_COPY\n\t\t//!STREAM_COPY\n\t//!/enum\n\n//!/namespace\n\n//!class gl\n\nconst gl =\n{\n\tBufferTarget: { },\n\tBufferUsage: { },\n\n\t/**\n\t * WebGL rendering context.\n\t * !static readonly gl: WebGL2RenderingContext;\n\t */\n\tgl: null,\n\n\t/**\n\t * Sets the WebGL rendering context.\n\t * !static setContext (context: WebGL2RenderingContext) : gl;\n\t */\n\tsetContext: function (context)\n\t{\n\t\tthis.gl = context;\n\n\t\tthis.BufferTarget.ARRAY_BUFFER = this.gl.ARRAY_BUFFER;\n\t\tthis.BufferTarget.ELEMENT_ARRAY_BUFFER = this.gl.ELEMENT_ARRAY_BUFFER;\n\t\tthis.BufferTarget.COPY_READ_BUFFER = this.gl.COPY_READ_BUFFER;\n\t\tthis.BufferTarget.COPY_WRITE_BUFFER = this.gl.COPY_WRITE_BUFFER;\n\t\tthis.BufferTarget.TRANSFORM_FEEDBACK_BUFFER = this.gl.TRANSFORM_FEEDBACK_BUFFER;\n\t\tthis.BufferTarget.UNIFORM_BUFFER = this.gl.UNIFORM_BUFFER;\n\t\tthis.BufferTarget.PIXEL_PACK_BUFFER = this.gl.PIXEL_PACK_BUFFER;\n\t\tthis.BufferTarget.PIXEL_UNPACK_BUFFER = this.gl.PIXEL_UNPACK_BUFFER;\n\n\t\tthis.BufferUsage.STATIC_DRAW = this.gl.STATIC_DRAW;\n\t\tthis.BufferUsage.DYNAMIC_DRAW = this.gl.DYNAMIC_DRAW;\n\t\tthis.BufferUsage.STREAM_DRAW = this.gl.STREAM_DRAW;\n\t\tthis.BufferUsage.STATIC_READ = this.gl.STATIC_READ;\n\t\tthis.BufferUsage.DYNAMIC_READ = this.gl.DYNAMIC_READ;\n\t\tthis.BufferUsage.STREAM_READ = this.gl.STREAM_READ;\n\t\tthis.BufferUsage.STATIC_COPY = this.gl.STATIC_COPY;\n\t\tthis.BufferUsage.DYNAMIC_COPY = this.gl.DYNAMIC_COPY;\n\t\tthis.BufferUsage.STREAM_COPY = this.gl.STREAM_COPY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the value of a GL parameter.\n\t * !static getParameter (name: string) : any;\n\t */\n\tgetParameter: function (name)\n\t{\n\t\treturn this.gl.getParameter(this.gl[name]);\n\t},\n\n\t/**\n\t * Returns a slice of an array as a Float32Array.\n\t * !static getFloat32Array (data: any, offset: number, length: number) : Float32Array;\n\t */\n\tgetFloat32Array: function (data, offset, length)\n\t{\n\t\tif (offset === 0 && length === data.length)\n\t\t{\n\t\t\tif (data instanceof Float32Array)\n\t\t\t\treturn data;\n\t\t}\n\n\t\tlet buff = new Float32Array(length);\n\n\t\tfor (let i = 0; i < length; i++)\n\t\t\tbuff[i] = data[i+offset];\n\n\t\treturn buff;\n\t},\n\n\t/**\n\t * Creates a buffer from the specified array.\n\t * @param {BufferTarget} target Defaults to ARRAY_BUFFER.\n\t * @param {BufferUsage} usage Defaults to STATIC_DRAW.\n\t * !static createBufferFrom (data: any, target?: gl.BufferTarget, usage?: gl.BufferUsage, offset?: number, length?: number) : WebGLBuffer;\n\t */\n\tcreateBufferFrom: function (data, target=null, usage=null, offset=null, length=null)\n\t{\n\t\ttarget = target ?? gl.BufferTarget.ARRAY_BUFFER;\n\t\tusage = usage ?? gl.BufferUsage.STATIC_DRAW;\n\n\t\tlet buff = this.gl.createBuffer();\n\t\tthis.gl.bindBuffer (target, buff);\n\t\tthis.gl.bufferData (target, this.getFloat32Array(data, offset ?? 0, length ?? data.length), usage);\n\n\t\t//this.gl.bindBuffer (target, null);\n\t\treturn buff;\n\t}\n};\n\n//!/class\n\nexport default gl;\n","/*\n**\tsystem/shader.js\n**\n**\tCopyright (c) 2021-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n//:/**\n//: * Provides pre-processing to reuse GLSL code.\n//: */\n\n//!class glsl\n\nconst glsl =\n{\n\t/**\n\t * Library of GLSL code snippets.\n\t */\n\tsnippets: { },\n\n\t/**\n\t * Registers a snippet in the GLSL code library.\n\t * !static set (name: string, source: string) : void;\n\t */\n\tset: function (name, source)\n\t{\n\t\tthis.snippets[name] = source;\n\t},\n\n\t/**\n\t * Returns a snippet of code given its name.\n\t * !static get (name: string) : string;\n\t */\n\tget: function (name)\n\t{\n\t\treturn this.snippets.hasOwnProperty(name) ? this.snippets[name] : '';\n\t},\n\n\t/**\n\t * Replaces special marks in the code.\n\t */\n\treplace: function (code, alreadyImported)\n\t{\n\t\tcode = code.split('\\n');\n\n\t\tfor (let i = 0; i < code.length; i++)\n\t\t{\n\t\t\tlet value = code[i].trim();\n\n\t\t\tif (value.startsWith('#use '))\n\t\t\t{\n\t\t\t\tlet str = '';\n\n\t\t\t\tfor (let name of value.substring(5).split(','))\n\t\t\t\t{\n\t\t\t\t\tname = name.trim();\n\n\t\t\t\t\tif (alreadyImported.hasOwnProperty(name))\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\talreadyImported[name] = true;\n\n\t\t\t\t\tstr += glsl.replace(glsl.get(name), alreadyImported) + '\\n';\n\t\t\t\t}\n\n\t\t\t\tcode[i] = str;\n\t\t\t}\n\t\t}\n\n\t\treturn code.join('\\n');\n\t},\n\n\t/**\n\t * Processes GLSL code, returns a string of GLSL code ready to be compiled.\n\t *\n\t * - If \"#version\" not specified \"#version 300 es\" will be added.\n\t * - If \"precision\" not specified \"precision highp float;\" will be added.\n\t * - xasd\n\t *\n\t * !static process (code: string) : string;\n\t */\n\tprocess: function (code)\n\t{\n\t\tcode = code.trim();\n\n\t\tif (code.indexOf('precision') === -1)\n\t\t\tcode = 'precision highp float;\\n' + code;\n\n\t\tif (code.indexOf('#version') === -1)\n\t\t\tcode = '#version 300 es\\n' + code;\n\n\t\treturn this.replace(code, { });\n\t}\n};\n\n//!/class\n\nexport default glsl;\n\n/**\n * Reusable GLSL snippets.\n */\n\nglsl.set('invertX', `\n\tvec2 invertX (vec2 value) {\n\t\treturn value * vec2(-1.0, 1.0);\n\t}\n`);\n\nglsl.set('invertY', `\n\tvec2 invertY (vec2 value) {\n\t\treturn value * vec2(1.0, -1.0);\n\t}\n`);\n\nglsl.set('snorm', `\n\tvec2 snorm (vec2 value) {\n\t\treturn value * 2.0 - 1.0;\n\t}\n`);\n\nglsl.set('location2d', `\n\t#use invertY, snorm\n\n\tvec4 location2d (vec3 location, float depth)\n\t{\n\t\tvec2 loc = vec2(m_transform * m_quad * location) / v_resolution;\n\t\treturn vec4(invertY(snorm(loc)), depth/16777216.0, 1.0);\n\t}\n`);\n\nglsl.set('frameTexCoords', `\n\tflat out vec2 v_frame_offset;\n\n\tvec2 frameTexCoords (vec3 location) {\n\t\tv_frame_offset = vec2(m_texture[2][0], m_texture[2][1]);\n\t\treturn mat2(m_texture * m_quad) * location.xy / (v_frame_size.xy * v_frame_size.zw);\n\t}\n`);\n\nglsl.set('frameTex', `\n\tflat in vec2 v_frame_offset;\n\n\tvec4 frameTex (vec2 texcoords) {\n\t\treturn texture(texture0, fract(texcoords)*v_frame_size.xy + v_frame_offset);\n\t}\n`);\n\nglsl.set('rand', `\n\tfloat rand (vec2 value) {\n\t\treturn fract(sin(dot(value, vec2(12.9898, 78.233))) * 43758.5453);\n\t}\n`);\n\nglsl.set('align', `\n\tfloat align (float value, float step) {\n\t\treturn floor(value/step)*step;\n\t}\n`);\n","/*\n**\tsystem/shader.js\n**\n**\tCopyright (c) 2021-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport glx from './glx.js';\nimport glsl from './glsl.js';\n\n//![import \"./glx\"]\n//![import \"./glsl\"]\n\n//:/**\n//: * Describes a shader object. The actual shader type is specified at construction.\n//: */\n\n//!class Shader\n\nconst Shader = Class.extend\n({\n\t/**\n\t * Identifier of the shader.\n\t * !readonly id: string;\n\t */\n\tid: null,\n\n\t/**\n\t * Type of the shader.\n\t * !readonly type: Shader.Type;\n\t */\n\ttype: 0,\n\n\t/**\n\t * Shader GL identifier.\n\t * !readonly shaderId: number;\n\t */\n\tshaderId: null,\n\n\t/**\n\t * Constructs a shader and registers with the specified id. Compile its GLSL code using the `compile` method.\n\t * !constructor (id: string, type: Shader.Type);\n\t */\n\t/**\n\t * Constructs a shader, compile its GLSL code using the `compile` method.\n\t * !constructor (type: Shader.Type);\n\t */\n\t/**\n\t * Constructs a shader with the specified GLSL code and registers with the specified id.\n\t * !constructor (id: string, type: Shader.Type, source: string);\n\t */\n\t/**\n\t * Constructs a shader with the specified GLSL code.\n\t * !constructor (type: Shader.Type, source: string);\n\t */\n\t__ctor: function (id, type=null, source=null)\n\t{\n\t\tif (source === null && type !== null && typeof(type) === 'string')\n\t\t{\n\t\t\tsource = type;\n\t\t\ttype = null;\n\t\t}\n\n\t\tif (type === null)\n\t\t{\n\t\t\ttype = id;\n\t\t\tid = null;\n\t\t}\n\n\t\tShader.put(this.id = id, this);\n\t\tthis.type = type;\n\n\t\tthis.shaderId = null;\n\n\t\tif (source)\n\t\t\tthis.compile(source);\n\t},\n\n\t/**\n\t * \tDestroys the shader.\n\t */\n\t__dtor: function ()\n\t{\n\t\tglx.gl.deleteShader(this.shaderId);\n\t\tShader.remove(this.id);\n\t},\n\n\t/**\n\t * Compiles the shader and throws an exception if any compilations error occur.\n\t * !compile (source: string) : Shader;\n\t */\n\tcompile: function (source)\n\t{\n\t\tlet gl = glx.gl;\n\t\tthis.shaderId = gl.createShader (this.type === Shader.Type.VERTEX ? gl.VERTEX_SHADER : (this.type === Shader.Type.FRAGMENT ? gl.FRAGMENT_SHADER : gl.GEOMETRY_SHADER));\n\n\t\tsource = glsl.process(source);\n\n\t\tgl.shaderSource(this.shaderId, source);\n\t\tgl.compileShader(this.shaderId);\n\n\t\tlet error = gl.getShaderInfoLog(this.shaderId);\n\t\tif (error) {\n\t\t\tconsole.error(source.split(\"\\n\").map((i,index) => (index) + \": \" + i).join(\"\\n\"));\n\t\t\tthrow new Error ((this.id ? '[' + this.id + '] ' : '') + error);\n\t\t}\n\n\t\treturn this;\n\t}\n});\n\n//!/class\n\n/**\n * \tGlobal shader list.\n */\nShader.shaders = { };\n\n/**\n * \tStores a shader with the specified identifier in the global shader list.\n * \t!static put (id: string, shader: Shader) : void;\n */\nShader.put = function (id, shader)\n{\n\tif (id) this.shaders[id] = shader;\n};\n\n/**\n * \tReturns a Shader from the global shader list given its identifier.\n * \t!static get (id: string) : Shader;\n */\nShader.get = function (id)\n{\n\treturn this.shaders[id];\n};\n\n/**\n * \tRemoves a shader from the global shader list.\n * \t!static remove (id: string) : void;\n */\nShader.remove = function (id)\n{\n\tdelete this.shaders[id];\n};\n\n//!namespace Shader\n\n//:/**\n//: * \tShader types.\n//: */\n\n//!enum Type\n\nShader.Type = {\n\tVERTEX: 0,\n\t//!VERTEX\n\tFRAGMENT: 1,\n\t//!FRAGMENT\n\tGEOMETRY: 2,\n\t//!GEOMETRY\n};\n\n//!/enum\n\nexport default Shader;\n","/*\n**\tsystem/shader-program.js\n**\n**\tCopyright (c) 2021-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Shader from './shader.js';\nimport glx from './glx.js';\n\n//![import \"./shader\"]\n//![import \"./globals\"]\n//![import \"./glx\"]\n\n//:/**\n//: * Describes a shader program.\n//: */\n\n//!class ShaderProgram\n\nconst ShaderProgram = Class.extend\n({\n\t/**\n\t * Cache of locations.\n\t */\n\tlocations: null,\n\n\t/**\n\t * Identifier of the program.\n\t * !readonly id: string;\n\t */\n\tid: null,\n\n\t/**\n\t * Shaders attached to the program.\n\t * !readonly shaders: Array<Shader>;\n\t */\n\tshaders: null,\n\n\t/**\n\t * Shader program GL identifier.\n\t * !readonly programId: number;\n\t */\n\tprogramId: null,\n\n\t/**\n\t * Constructs an empty shader program with the specified identifier. Attach shaders by using the `attach` method.\n\t * !constructor (id?: string);\n\t */\n\t__ctor: function (id=null)\n\t{\n\t\tthis.id = id;\n\n\t\tthis.shaders = [];\n\t\tthis.programId = null;\n\n\t\tthis.locations = { };\n\n\t\tthis._uniformSetter = null;\n\n\t\tShaderProgram.put(id, this);\n\t},\n\n\t/**\n\t * Destroys the shader program.\n\t */\n\t__dtor: function ()\n\t{\n\t\tlet gl = glx.gl;\n\t\tif (!gl) return this;\n\n\t\tgl.deleteProgram(this.programId);\n\t\tShaderProgram.remove(this.id);\n\t},\n\n\t/**\n\t * Sets the uniform setter function.\n\t * @param { (pgm:ShaderProgram) => void } uniformSetter\n\t * @returns {Element}\n\t * !uniformSetter (uniformSetter: (pgm:ShaderProgram) => void) : ShaderProgram;\n\t */\n\tuniformSetter: function (uniformSetter)\n\t{\n\t\tthis._uniformSetter = uniformSetter;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Attaches a shader to the shader program.\n\t * !attach (shader: Shader|string) : ShaderProgram;\n\t */\n\tattach: function (shader)\n\t{\n\t\tif (typeof(shader) === 'string')\n\t\t\tshader = Shader.get(shader);\n\n\t\tif (!shader)\n\t\t\tthrow new Error ('Unable to attach shader, invalid argument.');\n\n\t\tthis.shaders.push(shader);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Binds the attribute locations to their predefined values.\n\t */\n\tbindLocations: function ()\n\t{\n\t\tglx.gl.bindAttribLocation (this.programId, 0, 'location');\n\t},\n\n\t/**\n\t * Returns the location of an attribute.\n\t * !getAttribLocation (name: string) : object;\n\t */\n\tgetAttribLocation: function (name)\n\t{\n\t\tif (!this.locations.hasOwnProperty(name))\n\t\t\tthis.locations[name] = glx.gl.getAttribLocation (this.programId, name);\n\n\t\treturn this.locations[name];\n\t},\n\n\t/**\n\t * Returns the location of a uniform variable.\n\t * !getUniformLocation (name: string) : object;\n\t */\n\tgetUniformLocation: function (name)\n\t{\n\t\tif (!this.locations.hasOwnProperty(name))\n\t\t\tthis.locations[name] = glx.gl.getUniformLocation (this.programId, name);\n\n\t\treturn this.locations[name];\n\t},\n\n\t/**\n\t * Returns the location of a uniform block.\n\t * !getUniformBlockLocation (name: string) : object;\n\t */\n\tgetUniformBlockLocation: function (name)\n\t{\n\t\tif (!this.locations.hasOwnProperty(name))\n\t\t\tthis.locations[name] = glx.gl.getUniformBlockIndex (this.programId, name);\n\n\t\treturn this.locations[name];\n\t},\n\n\t/**\n\t * Returns the size of a uniform block.\n\t * !getUniformBlockSize (uniformBlock: string|object) : number;\n\t */\n\tgetUniformBlockSize: function (uniformBlock)\n\t{\n\t\tif (typeof(uniformBlock) === 'string')\n\t\t\tuniformBlock = this.getUniformBlockLocation(uniformBlock);\n\n\t\treturn glx.gl.getActiveUniformBlockParameter(this.programId, uniformBlock, glx.gl.UNIFORM_BLOCK_DATA_SIZE);\n\t},\n\t\n\t/**\n\t * Creates a buffer for a uniform block.\n\t * !createUniformBlockBuffer (uniformBlock: string|object) : Float32Array;\n\t */\n\tcreateUniformBlockBuffer: function (uniformBlock)\n\t{\n\t\tif (typeof(uniformBlock) === 'string')\n\t\t\tuniformBlock = this.getUniformBlockLocation(uniformBlock);\n\n\t\tlet size = this.getUniformBlockSize(uniformBlock);\n\t\tlet buff = glx.createBufferFrom (new Float32Array(size).fill(0), glx.BufferTarget.UNIFORM_BUFFER, glx.BufferUsage.DYNAMIC_DRAW);\n\n\t\tglx.gl.bindBufferBase (glx.BufferTarget.UNIFORM_BUFFER, 0, buff);\n\t},\n\n\t/**\n\t * Loads the locations of the predefined uniforms and attributes.\n\t */\n\tpreloadLocations: function ()\n\t{\n\t\tthis.getUniformLocation('f_time');\n\t\tthis.getUniformLocation('f_scale');\n\n\t\tthis.getUniformLocation('m_transform');\n\t\tthis.getUniformLocation('m_texture');\n\t\tthis.getUniformLocation('m_quad');\n\n\t\tthis.getUniformLocation('v_resolution');\n\t\tthis.getUniformLocation('v_frame_size');\n\n\t\tthis.getUniformLocation('f_depth');\n\t\tthis.getUniformLocation('f_alpha');\n\t\tthis.getUniformLocation('v_base_color');\n\n\t\tthis.getUniformLocation('texture0');\n\n\t\tthis.getAttribLocation('location');\n\t},\n\n\t/**\n\t * Links the shaders into the shader program. Completion can be obtained by calling `getStatus`.\n\t * !link() : ShaderProgram;\n\t */\n\tlink: function ()\n\t{\n\t\tlet gl = glx.gl;\n\t\tif (!gl) return this;\n\n\t\tthis.programId = gl.createProgram();\n\n\t\tfor (let shader of this.shaders)\n\t\t\tgl.attachShader (this.programId, shader.shaderId);\n\n\t\tthis.bindLocations();\n\t\tgl.linkProgram (this.programId);\n\t\tthis.preloadLocations();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Activates the shader program to be used in the subsequent drawing operations.\n\t * !activate() : void;\n\t */\n\tactivate: function ()\n\t{\n\t\tlet gl = glx.gl;\n\t\tif (!gl) return;\n\n\t\tgl.useProgram (this.programId);\n\n\t\tif (this._uniformSetter !== null)\n\t\t\tthis._uniformSetter (this, gl);\n\t},\n\n\t/**\n\t * Returns the link status of the program.\n\t * !getStatus() : boolean;\n\t */\n\tgetStatus: function ()\n\t{\n\t\tlet gl = glx.gl;\n\t\tif (!gl) return true;\n\n\t\treturn gl.getProgramParameter(this.programId, gl.LINK_STATUS);\n\t},\n\n\t/**\n\t * Returns the error of the last link operation.\n\t * !getError() : string;\n\t */\n\tgetError: function ()\n\t{\n\t\tlet gl = glx.gl;\n\t\tif (!gl) return '';\n\n\t\tif (this.programId === null)\n\t\t\treturn 'Program has not been linked.';\n\n\t\treturn gl.getProgramInfoLog(this.programId);\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform1f (location: string|object, v0: number) : ShaderProgram;\n\t */\n\tuniform1f: function (location, v0)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform1f (location, v0);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform1fv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform1fv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform1fv (location, value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform1i (location: string|object, v0: number) : ShaderProgram;\n\t */\n\tuniform1i: function (location, v0)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform1i (location, v0);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform1iv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform1iv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform1iv (location, value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform2f (location: string|object, v0: number, v1: number) : ShaderProgram;\n\t */\n\tuniform2f: function (location, v0, v1)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform2f (location, v0, v1);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform2fv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform2fv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform2fv (location, value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform2i (location: string|object, v0: number, v1: number) : ShaderProgram;\n\t */\n\tuniform2i: function (location, v0, v1)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform2i (location, v0, v1);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform2iv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform2iv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform2iv (location, value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform3f (location: string|object, v0: number, v1: number, v2: number) : ShaderProgram;\n\t */\n\tuniform3f: function (location, v0, v1, v2)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform3f (location, v0, v1, v2);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform3fv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform3fv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform3fv (location, value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform3i (location: string|object, v0: number, v1: number, v2: number) : ShaderProgram;\n\t */\n\tuniform3i: function (location, v0, v1, v2)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform3i (location, v0, v1, v2);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform3iv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform3iv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform3iv (location, value);\n\t\treturn this;\n\t},\n\t\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform4f (location: string|object, v0: number, v1: number, v2: number, v3: number) : ShaderProgram;\n\t */\n\tuniform4f: function (location, v0, v1, v2, v3)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform4f (location, v0, v1, v2, v3);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform4fv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform4fv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform4fv (location, value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform4i (location: string|object, v0: number, v1: number, v2: number, v3: number) : ShaderProgram;\n\t */\n\tuniform4i: function (location, v0, v1, v2, v3)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform4i (location, v0, v1, v2, v3);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform4iv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform4iv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform4iv (location, value);\n\t\treturn this;\n\t},\n\n});\n\n/**\n * Global shader program list.\n */\nShaderProgram.programs = { };\n\n/**\n * Puts a shader program in the global program list under the specified identifier.\n * !static put (id: string, shaderProgram: ShaderProgram) : void;\n */\nShaderProgram.put = function (id, shaderProgram)\n{\n\tif (id) this.programs[id] = shaderProgram;\n};\n\n/**\n * Returns a shader program from the global program list given its identifier.\n * !static get (id: string) : ShaderProgram;\n */\nShaderProgram.get = function (id)\n{\n\treturn this.programs[id];\n};\n\n/**\n * Removes a shader program from the global program list.\n * !static remove (id: string) : void;\n */\nShaderProgram.remove = function (id)\n{\n\tdelete this.programs[id];\n};\n\nexport default ShaderProgram;\n","/*\n**\tsystem/canvas.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rinn } from 'rinn';\nimport Matrix from '../math/matrix.js';\nimport System from './system.js';\nimport List from '../utils/list.js';\nimport ShaderProgram from './shader-program.js';\nimport Shader from './shader.js';\nimport globals from './globals.js';\nimport Log from './log.js';\nimport glx from './glx.js';\n\n//![import \"../math/matrix\"]\n//![import \"./system\"]\n//![import \"../utils/list\"]\n//![import \"./shader-program\"]\n//![import \"./shader\"]\n//![import \"./globals\"]\n//![import \"./log\"]\n//![import \"./glx\"]\n\n//!namespace Canvas\n\n\t//!type Options =\n\n\t\t/**\n\t\t * \tActual HTML5 Canvas element, if `null` a new one will be created.\n\t\t * \t!elem: HTMLCanvasElement;\n\t\t */\n\t\t\n\t\t/**\n\t\t * \tWebGL enable flag.\n\t\t * \t!gl: boolean;\n\t\t */\n\n\t\t/**\n\t\t * \tBackground of the canvas element.\n\t\t * \t!background: string;\n\t\t */\n\n\t\t/**\n\t\t * \tWidth of the canvas.\n\t\t * \t!width: number;\n\t\t */\n\n\t\t/**\n\t\t * \tHeight of the canvas.\n\t\t * \t!height: number;\n\t\t */\n\n\t\t/**\n\t\t * \tIndicates if the canvas element should be hidden from view (not attached to the document body).\n\t\t * \t!hidden: boolean;\n\t\t */\n\n\t\t/**\n\t\t * \tSet to `true` to ensure the canvas is positioned absolutly to (0, 0).\n\t\t * \t!absolute: boolean;\n\t\t */\n\n\t\t/**\n\t\t * \tUsed to control the antialias property of the canvas.\n\t\t * \t!antialias: boolean;\n\t\t */\n\n\t//!/type\n\n//!/namespace\n\n//!class Canvas\n\n/**\n * \tConstructs a canvas object. If the Canvas DOM element is not provided a new element will be created and attached to the page.\n * \t!constructor (options: Canvas.Options);\n */\n\nconst Canvas = function (options=null)\n{\n\tlet opts = {\n\t\telem: null,\n\t\tgl: false,\n\t\tbackground: '#000000',\n\t\twidth: 0,\n\t\theight: 0,\n\t\thidden: true,\n\t\tabsolute: false,\n\t\tantialias: false,\n\t\t...options\n\t};\n\n\tconst headless = global.document ? false : true;\n\n\t// Create canvas element if required.\n\tif (opts.elem == null)\n\t{\n\t\tthis.elem = !headless ? global.document.createElement('canvas') : Rinn.clone(Canvas.passThruCanvas);\n\n\t\tif (global.document && opts.hidden != true)\n\t\t{\n\t\t\tglobal.document.body.appendChild (this.elem);\n\n\t\t\tif (opts.absolute === true) {\n\t\t\t\tthis.elem.style.position = 'absolute';\n\t\t\t\tthis.elem.style.left = '0';\n\t\t\t\tthis.elem.style.top = '0';\n\t\t\t}\n\t\t}\n\t}\n\telse\n\t{\n\t\tthis.elem = opts.elem;\n\t}\n\n\tif (!this.elem.getContext) return;\n\n\tif (opts.gl === true && !headless)\n\t{\n\t\tthis.gl = this.elem.getContext('webgl2', { desynchronized: false, alpha: false, stencil: true });\n\n\t\tglobals.gl = this.gl\n\t\tglobals.shaderProgram = null;\n\n\t\tglx.setContext(this.gl);\n\n\t\tthis.context = null;\n\n\t\tLog.write(glx.getParameter('VERSION') + ', ' + glx.getParameter('SHADING_LANGUAGE_VERSION'));\n\t}\n\telse\n\t{\n\t\tthis.context = this.elem.getContext('2d', { desynchronized: false });\n\t\tthis.gl = null;\n\t}\n\n\t// State stack support.\n\tthis.matrixStack = List.Pool.alloc();\n\tthis.alphaStack = List.Pool.alloc();\n\tthis.depthFlagStack = List.Pool.alloc();\n\tthis.shaderProgramStack = List.Pool.alloc();\n\n\tthis.matr = Matrix.Pool.alloc();\n\tthis.transform = Matrix.Pool.alloc();\n\n\t// Default context values.\n\tthis._globalScale = 1.0;\n\tthis._alpha = 1.0;\n\tthis._depthFlag = true;\n\n\t// Set initial transformation matrix.\n\tthis.updateTransform();\n\tthis.strokeStyle(\"#fff\");\n\tthis.fillStyle(\"#fff\");\n\n\tif (opts.width && opts.height)\n\tthis.resize (opts.width, opts.height);\n\n\tif (this.gl !== null)\n\t\tthis.initGl();\n\n\tthis.antialias = opts.antialias;\n\tthis.setBackground (opts.background);\n};\n\nCanvas.passThruCanvas = \n{\n\tparentNode: null,\n\n\timageSmoothingEnabled: true,\n\n\tstyle: {\n\t},\n\n\twidth: 960,\n\theight: 540,\n\n\tgetContext: function (renderingContext) {\n\t\treturn this;\n\t},\n\n\tpushClip: function() {\n\t},\n\n\tpopClip: function() {\n\t},\n\n\tscale: function (sx, sy) {\n\t},\n\n\trotate: function (angle) {\n\t},\n\n\ttranslate: function (x, y) {\n\t},\n\n\tsetTransform: function (a, b, c, d, e, f) {\n\t},\n\n\tupdateTransform: function () {\n\t},\n\n\ttoDataURL: function (mime, params) {\n\t\treturn '';\n\t},\n\n\tbeginPath: function () {\n\t},\n\n\tmoveTo: function (x, y) {\n\t},\n\n\tclosePath: function() {\n\t},\n\n\tlineTo: function() {\n\t},\n\n\trect: function(x, y, w, h) {\n\t},\n\n\tfill: function() {\n\t},\n\n\tstroke: function() {\n\t},\n\n\tfillRect: function(x, y, w, h) {\n\t},\n\n\tstrokeRect: function(x, y, w, h) {\n\t},\n\n\tclip: function() {\n\t},\n\n\tquadraticCurveTo: function (cpx, cpy, x, y) {\n\t},\n\n\tbezierCurveTo: function (cx1, cy1, cx2, cy2, x, y) {\n\t},\n\n\tarc: function (x, y, r, sA, eA, cw) {\n\t},\n\n\tarcTo: function (x1, y1, x2, y2, r) {\n\t},\n\n\tfillText: function (text, x, y, maxWidth) {\n\t},\n\n\tstrokeText: function (text, x, y, maxWidth) {\n\t},\n\n\tmeasureText: function (text) {\n\t\treturn { width: 0 };\n\t},\n\n\tcreateImageData: function (w, h) {\n\t\treturn { width: w, height: h };\n\t},\n\n\tgetImageData: function (x, y, w, h) {\n\t\treturn { width: w, height: h, data: [] };\n\t},\n\n\tputImageData: function (data, x, y) {\n\t},\n\n\tdrawImage: function (img, sx=0, sy=0, sw=null, sh=null, dx=null, dy=null, dw=null, dh=null, textureWidth=null, textureHeight=null, frameWidth=null, frameHeight=null) {\n\t},\n\n\tgetBoundingClientRect: function () {\n\t\treturn { left: 0, top: 0 };\n\t}\n};\n\n/**\n * \tInitializes the OpenGL ES context.\n */\nCanvas.prototype.initGl = function ()\n{\n\tlet gl = this.gl;\n\n\t/**\n\t * \tCreate the default shader program.\n\t */\n\tthis.glDefaultProgram = new ShaderProgram('def');\n\n\tnew Shader ('def-vert', Shader.Type.VERTEX,\n\t`\n\t\tuniform mat3 m_transform;\n\t\tuniform mat3 m_quad;\n\t\tuniform mat3 m_texture;\n\t\tuniform vec2 v_resolution;\n\t\tuniform vec4 v_frame_size;\n\t\tuniform float f_depth;\n\n\t\tin vec3 location;\n\t\tout vec2 texcoords;\n\n\t\t// --------------------------------\n\t\t#use location2d, frameTexCoords\n\n\t\tvoid main ()\n\t\t{\n\t\t\tgl_Position = location2d (location, f_depth);\n\t\t\ttexcoords = frameTexCoords(location);\n\t\t}\n\t`);\n\n\tnew Shader ('def-frag', Shader.Type.FRAGMENT,\n\t`\n\t\tuniform sampler2D texture0;\n\t\tuniform vec4 v_frame_size;\n\t\tuniform float f_alpha;\n\n\t\tin vec2 texcoords;\n\t\tout vec4 color;\n\n\t\t// --------------------------------\n\t\t#use frameTex\n\n\t\tvoid main ()\n\t\t{\n\t\t\tcolor = frameTex(texcoords);\n\n\t\t\tcolor.a *= f_alpha;\n\t\t\tif (color.a <= 0.0) discard;\n\t\t}\n\t`);\n\n\t/**\n\t * \tCreate the quick shader program.\n\t */\n\tthis.glQuickProgram = new ShaderProgram('quick');\n\n\tnew Shader ('quick-vert', Shader.Type.VERTEX,\n\t`\n\t\tuniform mat3 m_transform;\n\t\tuniform mat3 m_quad;\n\t\tuniform mat3 m_texture;\n\t\tuniform vec2 v_resolution;\n\t\tuniform float f_depth;\n\n\t\tin vec3 location;\n\t\tout vec2 texcoords;\n\n\t\t// --------------------------------\n\t\t#use location2d\n\n\t\tvoid main ()\n\t\t{\n\t\t\tgl_Position = location2d (location, f_depth);\n\t\t\ttexcoords = vec2(m_texture * location);\n\t\t}\n\t`);\n\n\tnew Shader ('quick-frag', Shader.Type.FRAGMENT,\n\t`\n\t\tuniform sampler2D texture0;\n\t\tuniform float f_alpha;\n\n\t\tin vec2 texcoords;\n\t\tout vec4 color;\n\n\t\t// --------------------------------\n\t\tvoid main()\n\t\t{\n\t\t\tcolor = texture(texture0, texcoords);\n\n\t\t\tcolor.a *= f_alpha;\n\t\t\tif (color.a <= 0.0) discard;\n\t\t}\n\t`);\n\n\t/**\n\t * \tCreate the frame buffer blit shader program.\n\t */\n\tthis.glBlitProgram = new ShaderProgram('blit');\n\n\tnew Shader ('blit-vert', Shader.Type.VERTEX,\n\t`\n\t\tuniform vec2 v_resolution;\n\t\tuniform mat3 m_quad;\n\t\tuniform mat3 m_texture;\n\n\t\tin vec3 location;\n\t\tout vec2 texcoords;\n\n\t\t#use snorm\n\n\t\tvoid main() {\n\t\t\tgl_Position = vec4(snorm(vec2(m_quad * location) / v_resolution), 0.0, 1.0);\n\t\t\ttexcoords = vec2(m_texture * location);\n\t\t}\n\t`);\n\n\tnew Shader ('blit-frag', Shader.Type.FRAGMENT,\n\t`\n\t\tuniform sampler2D texture0;\n\t\tin vec2 texcoords;\n\n\t\tout vec4 color;\n\n\t\tvoid main() {\n\t\t\tcolor = texture(texture0, texcoords);\n\t\t}\n\t`);\n\n\t/* ****** */\n\tthis.glDefaultProgram.attach('def-vert');\n\tthis.glDefaultProgram.attach('def-frag');\n\n\tthis.glQuickProgram.attach('quick-vert');\n\tthis.glQuickProgram.attach('quick-frag');\n\n\tthis.glBlitProgram.attach('blit-vert');\n\tthis.glBlitProgram.attach('blit-frag');\n\n\tthis.glDefaultProgram.link();\n\tthis.glQuickProgram.link();\n\tthis.glBlitProgram.link();\n\n\tif (!this.glDefaultProgram.getStatus())\n\t\tthrow new Error (this.glDefaultProgram.getAllErrors());\n\n\tif (!this.glQuickProgram.getStatus())\n\t\tthrow new Error (this.glQuickProgram.getAllErrors());\n\n\tif (!this.glBlitProgram.getStatus())\n\t\tthrow new Error (this.glBlitProgram.getAllErrors());\n\n\tthis.setShaderProgram(ShaderProgram.get('def'));\n\n\t/**\n\t * \tCreate the vertex buffer.\n\t */\n\tthis.vao0 = gl.createVertexArray();\n\tgl.bindVertexArray(this.vao0);\n\n\tglx.createBufferFrom([ 0.0, 0.0, 1.0,  0.0, 1.0, 1.0,  1.0, 0.0, 1.0,  1.0, 1.0, 1.0 ], glx.BufferTarget.ARRAY_BUFFER, glx.BufferUsage.STATIC_DRAW);\n\n\tgl.vertexAttribPointer(globals.shaderProgram.getAttribLocation('location'), 3, gl.FLOAT, gl.FALSE, 3*Float32Array.BYTES_PER_ELEMENT, 0*Float32Array.BYTES_PER_ELEMENT);\n\tgl.enableVertexAttribArray(globals.shaderProgram.getAttribLocation('location'));\n\n\t/**\n\t * \tSetup initial GL configuration.\n\t */\n\tgl.clearColor (0.0, 0.0, 0.0, 1.0);\n\n\tgl.enable (gl.DEPTH_TEST);\n\tgl.clearDepth (0.0);\n\tgl.depthFunc (gl.GEQUAL);\n\n\tgl.enable (gl.BLEND);\n\tgl.blendFunc (gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\n\t/**\n\t * \tSetup frame buffer.\n\t */\n\n\t/* *** */\n\tthis.m_quad = new Float32Array(9).fill(0);\n\tthis.m_texture = new Float32Array(9).fill(0);\n\tthis.v_resolution = new Float32Array(2).fill(0);\n\tthis.zvalue = 0;\n\n\tMatrix.loadIdentity(this.m_quad);\n\tMatrix.loadIdentity(this.m_texture);\n\n\t// drawImage (Image img, float sx, float sy, float sw, float sh, float dx, float dy, float dw, float dh, float textureWidth, float textureHeight, float frameWidth, float frameHeight);\n\tthis.drawImage = function (img, sx, sy, sw, sh, dx, dy, dw, dh, textureWidth=null, textureHeight=null, frameWidth=null, frameHeight=null)\n\t{\n\t\tif (!img.glTextureReady)\n\t\t\treturn;\n\n\t\tlet gl = this.gl;\n\t\tlet program = globals.shaderProgram;\n\n\t\tif (textureWidth === null)\n\t\t{\n\t\t\ttextureWidth = img.width;\n\t\t\ttextureHeight = img.height;\n\t\t}\n\n\t\tif (frameWidth === null)\n\t\t{\n\t\t\tframeWidth = img.targetWidth;\n\t\t\tframeHeight = img.targetHeight;\n\t\t}\n\n\t\tprogram.uniform2fv ('v_resolution', this.v_resolution);\n\t\tprogram.uniform1f ('f_time', globals.time);\n\t\tprogram.uniform1f ('f_scale', this._globalScale);\n\t\tprogram.uniform1f ('f_alpha', this._alpha);\n\n\t\tif (this.glActiveTextureId !== img.glTextureId || this.glActiveShader !== program)\n\t\t{\n\t\t\tgl.activeTexture (gl.TEXTURE0);\n\t\t\tgl.bindTexture (gl.TEXTURE_2D, img.glTextureId);\n\n\t\t\tprogram.uniform1i ('texture0', 0);\n\t\t\tprogram.uniform4f ('v_frame_size', frameWidth*img.rscale/textureWidth, frameHeight*img.rscale/textureHeight, frameWidth, frameHeight);\n\n\t\t\tthis.glActiveTextureId = img.glTextureId;\n\t\t\tthis.glActiveShader = program;\n\t\t}\n\n\t\tthis.m_quad[0] = dw;\n\t\tthis.m_quad[4] = dh;\n\t\tthis.m_quad[6] = dx;\n\t\tthis.m_quad[7] = dy;\n\n\t\tthis.m_texture[0] = sw / textureWidth;\n\t\tthis.m_texture[4] = sh / textureHeight;\n\t\tthis.m_texture[6] = sx / textureWidth;\n\t\tthis.m_texture[7] = sy / textureHeight;\n\n\t\tgl.uniformMatrix3fv (program.getUniformLocation('m_transform'), false, this.transform.data);\n\t\tgl.uniformMatrix3fv (program.getUniformLocation('m_quad'), false, this.m_quad);\n\t\tgl.uniformMatrix3fv (program.getUniformLocation('m_texture'), false, this.m_texture);\n\t\tgl.uniform1f (program.getUniformLocation('f_depth'), this.zvalue);\n\t\tgl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\t};\n\n\t// drawRect (float x, float y, float w, float h);\n\tthis.drawRect = function (x, y, w, h)\n\t{\n\t\tlet gl = this.gl;\n\t\tlet program = globals.shaderProgram;\n\n\t\tprogram.uniform2fv ('v_resolution', this.v_resolution);\n\t\tprogram.uniform1f ('f_time', globals.time);\n\t\tprogram.uniform1f ('f_scale', this._globalScale);\n\t\tprogram.uniform1f ('f_alpha', this._alpha);\n\n\t\tthis.glActiveTextureId = null;\n\n\t\tthis.m_quad[0] = w;\n\t\tthis.m_quad[4] = h;\n\t\tthis.m_quad[6] = x;\n\t\tthis.m_quad[7] = y;\n\n\t\tthis.m_texture[0] = 1.0;\n\t\tthis.m_texture[4] = 1.0;\n\t\tthis.m_texture[6] = 0.0;\n\t\tthis.m_texture[7] = 0.0;\n\n\t\tgl.uniformMatrix3fv (program.getUniformLocation('m_transform'), false, this.transform.data);\n\t\tgl.uniformMatrix3fv (program.getUniformLocation('m_quad'), false, this.m_quad);\n\t\tgl.uniformMatrix3fv (program.getUniformLocation('m_texture'), false, this.m_texture);\n\t\tgl.uniform1f ('f_depth', this.zvalue);\n\t\tgl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\t};\n};\n\n\n/**\n * \tPrepares an image to use it on the canvas. Used only when GL mode is active.\n * \t!prepareImage (image: HTMLImageElement) : boolean;\n */\nCanvas.prototype.prepareImage = function (image)\n{\n\tlet gl = this.gl;\n\tif (gl == null) return false;\n\n\tlet texture = gl.createTexture();\n\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\n\tgl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA8, image.width, image.height);\n\tgl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, image.width, image.height, gl.RGBA, gl.UNSIGNED_BYTE, image);\n\n\tif (!image.filter)\n\t\timage.filter = 'NEAREST';\n\n\tif (image.filter === 'NEAREST')\n\t{\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t}\n\telse\n\t{\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\t}\n\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n\timage.glTextureId = texture;\n\timage.glTextureReady = true;\n\n\treturn true;\n};\n\n/**\n * \tConfigures the texture related to specified image to gl.REPEAT.\n * \t!setWrapRepeat (image: HTMLImageElement) : HTMLImageElement;\n */\nCanvas.prototype.setWrapRepeat = function (image)\n{\n\tlet gl = this.gl;\n\tif (gl == null || !image.glTextureReady) return image;\n\n\tgl.bindTexture(gl.TEXTURE_2D, image.glTextureId);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n\n\treturn image;\n};\n\n/**\n * \tApplies the current config to the canvas (usually called after a reset on the canvas).\n */\nCanvas.prototype.applyConfig = function ()\n{\n\tif (this.antialias == false)\n\t{\n\t\tif (this.context != null)\n\t\t\tthis.context.imageSmoothingEnabled = false;\n\n\t\tthis.elem.style.imageRendering = 'crisp-edges';\n\t}\n\telse\n\t{\n\t\tif (this.context != null)\n\t\t\tthis.context.imageSmoothingEnabled = true;\n\n\t\tthis.elem.style.imageRendering = 'auto';\n\t}\n};\n\n/**\n * \tDisposes the resources used by the canvas. The HTMLCanvasElement will also be removed from the document.\n */\nCanvas.prototype.dispose = function ()\n{\n\tif (this.elem.parentNode)\n\t\tthis.elem.parentNode.removeChild (this.elem);\n\n\tthis.matrixStack.free();\n\tthis.alphaStack.free();\n\tthis.depthFlagStack.free();\n\tthis.shaderProgramStack.free();\n\n\tthis.matr = null;\n\tthis.context = null;\n\tthis.elem = null;\n};\n\n/**\n * \tSets the default background color of the canvas. Does not cause a canvas clear.\n * \t!setBackground (color: string) : void;\n */\nCanvas.prototype.setBackground = function (color)\n{\n\tthis.elem.style.background = color;\n\tthis.backgroundColor = color;\n\n\tif (this.gl !== null)\n\t{\n\t\tif (color.length != 7)\n\t\t\tthrow new Error ('Canvas.setBackground: color parameter should be CSS-style hex-rgb with 6 digits.');\n\n\t\tlet r = parseInt(color.substr(1,2), 16) / 255.0;\n\t\tlet g = parseInt(color.substr(3,2), 16) / 255.0;\n\t\tlet b = parseInt(color.substr(5,2), 16) / 255.0;\n\n\t\tthis.gl.clearColor (r, g, b, 1.0);\n\t}\n};\n\n/**\n * \tSets the canvas size.\n * \t!resize (width: number, height: number) : Canvas;\n */\nCanvas.prototype.resize = function (width, height)\n{\n\tlet rect = this.elem.getBoundingClientRect();\n\n\tif (!width) width = rect.width;\n\tif (!height) height = rect.height;\n\n\tthis.elem.width = width;\n\tthis.elem.height = height;\n\n\tthis.width = this.elem.width;\n\tthis.height = this.elem.height;\n\n\tthis._width = int(this.width / this._globalScale);\n\tthis._height = int(this.height / this._globalScale);\n\n\tlet gl = this.gl;\n\tif (gl != null)\n\t{\n\t\tgl.enable (gl.SCISSOR_TEST);\n\t\tgl.scissor (0, 0, this.width, this.height);\n\t\tgl.viewport (0, 0, this.width, this.height);\n\n\t\tif (this.v_resolution)\n\t\t{\n\t\t\t//violet:hardware scaling\n\t\t\t//this.v_resolution[0] = this._width;\n\t\t\t//this.v_resolution[1] = this._height;\n\n\t\t\tthis.v_resolution[0] = this.width;\n\t\t\tthis.v_resolution[1] = this.height;\n\t\t}\n\t}\n\n\tthis.applyConfig();\n\treturn this;\n};\n\n/**\n * \tSets the global canvas scale.\n * \t!globalScale (value: number) : Canvas;\n */\nCanvas.prototype.globalScale = function (value)\n{\n\tthis._globalScale = value;\n\n\tthis._width = int(this.width / this._globalScale);\n\tthis._height = int(this.height / this._globalScale);\n\n\tthis.loadIdentity();\n\n\t//violet:hardware scaling\n\t//if (this.gl === null)\n\t\tthis.scale(value, value);\n\n\treturn this;\n};\n\n/**\n * \tSets the flipped status of the canvas, that is, if the canvas coordinates are flipped (i.e. `xy` is now `yx`).\n * \t!flipped (value: boolean) : Canvas;\n */\nCanvas.prototype.flipped = function (value)\n{\n\tif (value)\n\t{\n\t\tthis._width = int(this.height / this._globalScale);\n\t\tthis._height = int(this.width / this._globalScale);\n\t}\n\telse\n\t{\n\t\tthis._width = int(this.width / this._globalScale);\n\t\tthis._height = int(this.height / this._globalScale);\n\t}\n\n\tthis.isFlipped = value;\n\treturn this;\n};\n\n/**\n * \tSaves the clip state of the canvas. Works only in GL mode.\n * \t!pushClip() : Canvas;\n */\nCanvas.prototype.pushClip = function ()\n{\n\treturn this;\n};\n\n/**\n * \tRestores the clip state of the canvas. Works only in GL mode.\n * \t!popClip() : Canvas;\n */\nCanvas.prototype.popClip = function ()\n{\n\tif (this.gl != null)\n\t\tthis.gl.scissor(0, 0, this.width, this.height);\n\n\treturn this;\n};\n\n/**\n * \tReturns the image on the canvas as a string in DATA-URI format.\n * \t!toDataUrl (mime: string, params?: object) : string;\n */\nCanvas.prototype.toDataUrl = function (mime='image/png', params=null)\n{\n\treturn this.elem.toDataURL (mime, params);\n};\n\n/**\n * \tReturns the image as a Base-64 encoded PNG string.\n * \t!toPngBase64() : string;\n */\nCanvas.prototype.toPngBase64 = function ()\n{\n\treturn this.elem.toDataURL(\"image/png\").substr(22);\n};\n\n/**\n * \tSets or returns an attribute of the canvas context.\n */\nCanvas.prototype._contextAttribute = function (name, value=null)\n{\n\tif (!this.context) return;\n\n\tif (value !== null)\n\t{\n\t\tthis.context[name] = value;\n\t\treturn this;\n\t}\n\n\treturn this.context[name];\n};\n\n/**\n * \tSets the fill style.\n * \t!fillStyle (value: string) : Canvas;\n */\n/**\n * \tReturns the current fill style.\n * \t!fillStyle () : string;\n */\nCanvas.prototype.fillStyle = function (value)\n{\n\treturn this._contextAttribute (\"fillStyle\", value);\n};\n\n/**\n * \tSets the stroke style.\n * \t!strokeStyle (value: string) : Canvas;\n */\n/**\n * \tReturns the current strroke style.\n * \t!strokeStyle () : string;\n */\nCanvas.prototype.strokeStyle = function (value)\n{\n\treturn this._contextAttribute (\"strokeStyle\", value);\n};\n\n/**\n * \tSets the line cap style (Possible values are `butt`, `round`, or `square`. `butt` is default).\n * \t!lineCap (value: string) : Canvas;\n */\n/**\n * \tReturns the current line cap style.\n * \t!lineCap() : string;\n */\nCanvas.prototype.lineCap = function (value)\n{\n\treturn this._contextAttribute (\"lineCap\", value);\n};\n\n// violet\n\n/*\n**\tSets or returns the current line join style (bevel, round, miter. miter is default).\n**\n**\t>> Canvas lineJoin (string value);\n**\t>> string lineJoin ();\n*/\n\nCanvas.prototype.lineJoin = function (value)\n{\n\treturn this._contextAttribute (\"lineJoin\", value);\n};\n\n\n/*\n**\tSets or returns the current line width value (default 1).\n**\n**\t>> Canvas lineWidth (float value);\n**\t>> float lineWidth ();\n*/\n\nCanvas.prototype.lineWidth = function (value)\n{\n\treturn this._contextAttribute (\"lineWidth\", value);\n};\n\n\n/*\n**\tSets or returns the current miter limit value (default 10).\n**\n**\t>> Canvas miterLimit (float value);\n**\t>> float miterLimit ();\n*/\n\nCanvas.prototype.miterLimit = function (value)\n{\n\treturn this._contextAttribute (\"miterLimit\", value);\n};\n\n\n/*\n**\tSets or returns the current shadow color value (default black).\n**\n**\t>> Canvas shadowColor (string value);\n**\t>> string shadowColor ();\n*/\n\nCanvas.prototype.shadowColor = function (value)\n{\n\treturn this._contextAttribute (\"shadowColor\", value);\n};\n\n\n/*\n**\tSets or returns the current shadow X offset (default 0).\n**\n**\t>> Canvas shadowOffsetX (float value);\n**\t>> float shadowOffsetX ();\n*/\n\nCanvas.prototype.shadowOffsetX = function (value)\n{\n\treturn this._contextAttribute (\"shadowOffsetX\", value);\n};\n\n\n/*\n**\tSets or returns the current shadow Y offset (default 0).\n**\n**\t>> Canvas shadowOffsetY (float value);\n**\t>> float shadowOffsetY ();\n*/\n\nCanvas.prototype.shadowOffsetY = function (value)\n{\n\treturn this._contextAttribute (\"shadowOffsetY\", value);\n};\n\n\n/*\n**\tSets or returns the current shadow blue value (default 0).\n**\n**\t>> Canvas shadowBlur (string value);\n**\t>> string shadowBlur ();\n*/\n\nCanvas.prototype.shadowBlur = function (value)\n{\n\treturn this._contextAttribute (\"shadowBlur\", value);\n};\n\n\n/*\n**\tSets or returns the current font settings.\n**\n**\t>> Canvas font (string value);\n**\t>> string font ();\n*/\n\nCanvas.prototype.font = function (value)\n{\n\treturn this._contextAttribute (\"font\", value);\n};\n\n\n/*\n**\tSets or returns the current text align settings (start, end, left, right, center).\n**\n**\t>> Canvas textAlign (string value);\n**\t>> string textAlign ();\n*/\n\nCanvas.prototype.textAlign = function (value)\n{\n\treturn this._contextAttribute (\"textAlign\", value);\n};\n\n\n/*\n**\tSets or returns the current text base line settings (alphabetic, bottom, hanging, ideographic, middle, top. Alphabetic is default).\n**\n**\t>> Canvas textBaseline (string value);\n**\t>> string textBaseline ();\n*/\n\nCanvas.prototype.textBaseline = function (value)\n{\n\treturn this._contextAttribute (\"textBaseline\", value);\n};\n\n\n/*\n**\tSets or returns the current global alpha value.\n**\n**\t>> Canvas globalAlpha (float value);\n**\t>> float globalAlpha ();\n*/\n\nCanvas.prototype.globalAlpha = function (value=null)\n{\n\tif (value !== null)\n\t\tthis._alpha = value;\n\telse\n\t\treturn this._alpha;\n\n\treturn this.alpha(1.0);\n};\n\n\n/*\n**\tSets or returns the current global composite operation value (source-atop, source-in, source-out, source-over, destination-atop,\n**\tdestination-in, destination-out, destination-over, lighter, copy, xor).\n**\n**\t>> Canvas globalCompositeOperation (string value);\n**\t>> string globalCompositeOperation ();\n*/\nCanvas.prototype.globalCompositeOperation = function (value)\n{\n\treturn this._contextAttribute (\"globalCompositeOperation\", value);\n};\n\n/*\n**\tUpdates the underlying canvas or gl transformation matrix. \n**\n**\tCanvas updateTransform();\n*/\nCanvas.prototype.updateTransform = function()\n{\n\tthis.setTransform (this.matr.data[0], this.matr.data[1], this.matr.data[3], this.matr.data[4], this.matr.data[6], this.matr.data[7]);\n\treturn this;\n};\n\n/*\n**\tSets the canvas or gl transformation matrix to the given one.\n**\n**\tCanvas setTransform (float a, float b, float c, float d, float e, float f)\n*/\nCanvas.prototype.setTransform = function (a, b, c, d, e, f)\n{\n\tif (this.context === null)\n\t{\n\t\tthis.transform.data[0] = a;\n\t\tthis.transform.data[1] = b;\n\t\tthis.transform.data[2] = 0;\n\t\tthis.transform.data[3] = c;\n\t\tthis.transform.data[4] = d;\n\t\tthis.transform.data[5] = 0;\n\t\tthis.transform.data[6] = int(e);//Math.ceil(e);\n\t\tthis.transform.data[7] = int(f);//Math.ceil(f);\n\t\tthis.transform.data[8] = 1;\n\n\t\treturn this;\n\t}\n\n\t//this.context.setTransform (a, b, c, d, Math.ceil(e), Math.ceil(f));\n\tthis.context.setTransform (a, b, c, d, int(e), int(f));\n\treturn this;\n};\n\n/*\n**\tDraws a filled rectangle on the canvas.\n**\n**\tCanvas fillRect (float x, float y, float w, float h)\n*/\nCanvas.prototype.fillRect = function (x, y, w, h)\n{\n\tthis.context.fillRect (x, y, w, h);\n\treturn this;\n};\n\n/*\n**\tDraws an stroked rectangle on the canvas.\n**\n**\tCanvas strokeRect (float x, float y, float w, float h)\n*/\nCanvas.prototype.strokeRect = function (x, y, w, h)\n{\n\tthis.context.strokeRect (x, y, w, h);\n\treturn this;\n};\n\n/*\n**\tClears a rectangle on the canvas. All pixels will be erased.\n**\n**\tCanvas clearRect (float x, float y, float w, float h)\n*/\nCanvas.prototype.clearRect = function (x, y, w, h)\n{\n\tthis.context.clearRect (x, y, w, h);\n\treturn this;\n};\n\n/*\n**\tStarts a new path. Any previous path points will be cleared.\n**\n**\tCanvas beginPath()\n*/\nCanvas.prototype.beginPath = function ()\n{\n\tthis.context.beginPath ();\n\treturn this;\n};\n\n/*\n**\tCreates a new point in the current path.\n**\n**\tCanvas moveTo (float x, float y)\n*/\nCanvas.prototype.moveTo = function (x, y)\n{\n\tthis.context.moveTo (x, y);\n\treturn this;\n};\n\n/*\n**\tCreates a new point from the first path point to the last, and finishes the path.\n**\n**\tCanvas closePath()\n*/\nCanvas.prototype.closePath = function ()\n{\n\tthis.context.closePath ();\n\treturn this;\n};\n\n/*\n**\tDraws a line from the last point on the path to the given point.\n**\n**\tCanvas lineTo (float x, float y)\n*/\nCanvas.prototype.lineTo = function (x, y)\n{\n\tthis.context.lineTo (x, y);\n\treturn this;\n};\n\n/*\n**\tCreates a hollow rectangle path on the canvas for subsequent stroke or fill.\n**\n**\tCanvas rect (float x, float y, float w, float h)\n*/\nCanvas.prototype.rect = function (x, y, w, h)\n{\n\tthis.context.rect (x, y, w, h);\n\treturn this;\n};\n\n/*\n**\tFills the active path with the current fill style or with the one given in the value parameter.\n**\n**\tCanvas fill (string value=null)\n*/\nCanvas.prototype.fill = function (value=null)\n{\n\tif (value) this.fillStyle (value);\n\tthis.context.fill ();\n\treturn this;\n};\n\n/*\n**\tStrokes the active path with the current stroke style or with the one given in the value parameter.\n**\n**\tCanvas stroke (string value=null)\n*/\nCanvas.prototype.stroke = function (value=null)\n{\n\tif (value) this.strokeStyle (value);\n\tthis.context.stroke ();\n\treturn this;\n};\n\n/*\n**\tClips a region of the canvas so that only the region will be used for drawing. Coordinates must be in logical screen space.\n**\n**\tCanvas clip()\n*/\nCanvas.prototype.clip = function (x, y, width, height)\n{\n\tif (this.gl !== null)\n\t{\n\t\tx *= this._globalScale;\n\t\ty *= this._globalScale;\n\t\twidth *= this._globalScale;\n\t\theight *= this._globalScale;\n\n\t\tif (this.isFlipped)\n\t\t\tthis.gl.scissor(this.width-y-height-1, this.height-x-width-1, height, width);\n\t\telse\n\t\t\tthis.gl.scissor(x, this.height-y-height-1, width, height);\n\t}\n\n\treturn this;\n};\n\n/*\n**\tAdds points of a quadratic curve to the active path. A control points and one reference point must be provided.\n**\n**\tCanvas quadraticCurveTo (float cpx, float cpy, float x, float y)\n*/\nCanvas.prototype.quadraticCurveTo = function (cpx, cpy, x, y)\n{\n\tthis.context.quadraticCurveTo (cpx, cpy, x, y);\n\treturn this;\n};\n\n/*\n**\tAdds points of a bezier curve to the active path. Two control points and one reference point must be provided.\n**\n**\tCanvas bezierCurveTo (float cx1, float cy1, float cx2, float cy2, float x, float y)\n*/\nCanvas.prototype.bezierCurveTo = function (cx1, cy1, cx2, cy2, x, y)\n{\n\tthis.context.bezierCurveTo (cx1, cy1, cx2, cy2, x, y);\n\treturn this;\n};\n\n/*\n**\tAdds points of an arc the the active path. Used to draw a circle of part of it.\n**\n**\tCanvas arc (float x, float y, float r, float sA, float eA, float cw)\n*/\nCanvas.prototype.arc = function (x, y, r, sA, eA, cw)\n{\n\tthis.context.arc (x, y, r, sA, eA, cw);\n\treturn this;\n};\n\n/*\n**\tAdds points of an arc to the active path. Used to create an arc between two points.\n**\n**\tCanvas arcTo (float x1, float y1, float x2, float y2, float r)\n*/\nCanvas.prototype.arcTo = function (x1, y1, x2, y2, r)\n{\n\tthis.context.arcTo (x1, y1, x2, y2, r);\n\treturn this;\n};\n\n/*\n**\tDraws filled text on the canvas with the active font, and fillStyle properties.\n**\n**\tCanvas fillText (string text, float x, float y, float maxWidth=1000)\n*/\nCanvas.prototype.fillText = function (text, x, y, maxWidth=1000)\n{\n\tthis.context.fillText (text, x, y, maxWidth);\n\treturn this;\n};\n\n/*\n**\tDraws stroked text on the canvas with the active font, and fillStyle properties.\n**\n**\tCanvas strokeText (string text, float x, float y, float maxWidth=1000)\n*/\nCanvas.prototype.strokeText = function (text, x, y, maxWidth=1000)\n{\n\tthis.context.strokeText (text, x, y, maxWidth);\n\treturn this;\n};\n\n\n/*\n**\tMeasures the width of the given text using active font properties.\n**\n**\tfloat measureText (string text)\n*/\nCanvas.prototype.measureText = function (text)\n{\n\treturn this.context.measureText(text).width;\n};\n\n\n/*\n**\tReturns a new image data object with the specified size.\n**\n**\tImageData createImageData (float w, float h)\n*/\nCanvas.prototype.createImageData = function (w, h)\n{\n\treturn this.context.createImageData (w, h);\n};\n\n\n/*\n**\tReturns an image data object with the pixels of a rectangular area of the canvas.\n**\n**\tImageData getImageData (float x, float y, float w, float h)\n*/\nCanvas.prototype.getImageData = function (x, y, w, h)\n{\n\treturn this.context.getImageData (x, y, w, h);\n};\n\n\n/*\n**\tPuts image data on the canvas at the specified location.\n**\n**\tCanvas putImageData (ImageData data, float x, float y)\n*/\nCanvas.prototype.putImageData = function (data, x, y)\n{\n\tthis.context.putImageData (data, x, y);\n\treturn this;\n};\n\n\n/*\n**\tDraws an image on the canvas.\n**\n**\tCanvas drawImage (Image img, float x, float y)\n**\tCanvas drawImage (Image img, float x, float y, float w, float h)\n**\tCanvas drawImage (Image img, float sx, float sy, float sw, float sh, float dx, float dy, float dw, float dh)\n*/\nCanvas.prototype.drawImage = function (img, sx=0, sy=0, sw=null, sh=null, dx=null, dy=null, dw=null, dh=null)\n{\n\tif (sw === null)\n\t{\n\t\tthis.context.drawImage (img, int(sx), int(sy));\n\t}\n\telse if (dx === null)\n\t{\n\t\tthis.context.drawImage (img, int(sx), int(sy), int(sw), int(sh));\n\t}\n\telse\n\t{\n\t\tlet a3 = int(sw);\n\t\tlet a4 = int(sh);\n\t\tif (!a3 || !a4) return this;\n\n\t\tlet a7 = int(dw);\n\t\tlet a8 = int(dh);\n\t\tif (!a7 || !a8) return this;\n\n\t\tthis.context.drawImage (img, int(sx), int(sy), a3, a4, int(dx), int(dy), a7, a8);\n\t}\n\n\treturn this;\n};\n\n\n/*\n**\tClears the entire canvas. If the backgroundColor parameter is set the canvas will be cleared manually by using\n**\tthe fillRect method.\n**\n**\tCanvas clear (string backgroundColor)\n**\tCanvas clear ()\n*/\n\nCanvas.prototype.clear = function (backgroundColor=null)\n{\n\tif (this.gl != null)\n\t{\n\t\tthis.gl.clear(this.gl.STENCIL_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT | this.gl.COLOR_BUFFER_BIT);\n\t\tthis.glActiveTextureId = null;\n\n\t\treturn this;\n\t}\n\n\tif (backgroundColor)\n\t{\n\t\tthis.globalCompositeOperation(\"source-over\").globalAlpha(1.0).fillStyle(backgroundColor !== true ? backgroundColor : this.backgroundColor).fillRect(0, 0, this._width, this._height);\n\t}\n\telse\n\t{\n\t\tthis.elem.width = this.width;\n\t\tthis.applyConfig();\n\t}\n\n\tthis.updateTransform();\n\treturn this;\n};\n\n\n/*\n**\tIndicates that rendering is about to start. Used only in GL mode.\n*/\nCanvas.prototype.start = function ()\n{\n};\n\n/*\n**\tIndicates that rendering has ended. Used only in GL mode.\n*/\nCanvas.prototype.end = function ()\n{\n};\n\n/*\n**\tIndicates that rendering has been completed and any flush operation should be executed. Used only in GL mode.\n*/\nCanvas.prototype.flush = function ()\n{\n\tlet gl = this.gl;\n\tif (gl === null) return;\n\n\tgl.colorMask (false, false, false, true);\n\tgl.clear (gl.COLOR_BUFFER_BIT);\n\tgl.colorMask (true, true, true, true);\n\n\t// VIOLET: Add gl.flush() if not using RAF.\n};\n\n/**\n *\tBlits the specified texture to the active framebuffer.\n */\nCanvas.prototype.blit = function (texture, width, height, shaderProgram=null)\n{\n\tlet gl = this.gl;\n\tif (gl === null) return;\n\n\tshaderProgram = shaderProgram || this.glBlitProgram;\n\n\tthis.setShaderProgram(shaderProgram);\n\tgl.disable (gl.DEPTH_TEST);\n\n\t\tgl.activeTexture (gl.TEXTURE0);\n\t\tgl.bindTexture (gl.TEXTURE_2D, texture);\n\t\tshaderProgram.uniform1i ('texture0', 0);\n\n\t\tshaderProgram.uniform2fv ('v_resolution', this.v_resolution);\n\t\tshaderProgram.uniform1f ('f_time', globals.time);\n\t\tshaderProgram.uniform1f ('f_scale', this._globalScale);\n\t\tshaderProgram.uniform1f ('f_alpha', this._alpha);\n\n\t\tthis.m_quad[0] = this.width;\n\t\tthis.m_quad[4] = this.height;\n\t\tthis.m_quad[6] = 0;\n\t\tthis.m_quad[7] = 0;\n\n\t\tthis.m_texture[0] = this.width / width;\n\t\tthis.m_texture[4] = this.height / height;\n\t\tthis.m_texture[6] = 0.0;\n\t\tthis.m_texture[7] = 0.0;\n\n\t\tgl.uniformMatrix3fv (shaderProgram.getUniformLocation('m_quad'), false, this.m_quad);\n\t\tgl.uniformMatrix3fv (shaderProgram.getUniformLocation('m_texture'), false, this.m_texture);\n\t\tgl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\n\tthis.setShaderProgram(ShaderProgram.get('def'));\n\tgl.enable (gl.DEPTH_TEST);\n};\n\n/*\n**\tResets the context drawing properties to their initial values.\n**\n**\tCanvas reset (bool clearPath=false);\n*/\nCanvas.prototype.reset = function (clearPath=false)\n{\n\tthis.fillStyle(\"#000000\").strokeStyle(\"#000000\").lineCap(\"butt\").lineJoin(\"miter\")\n\t.lineWidth(\"1\").miterLimit(\"10\").shadowColor(\"#000000\").shadowOffsetX(\"0\")\n\t.shadowOffsetY(\"0\").shadowBlur(\"0\").globalAlpha(\"1.0\").globalCompositeOperation(\"source-over\");\n\n\tif (clearPath) this.beginPath().closePath();\n\n\treturn this;\n};\n\n/*\n**\tPushes the current transformation matrix into the matrix stack.\n*/\nCanvas.prototype.pushMatrix = function ()\n{\n\tthis.matrixStack.push(this.matr);\n\tthis.matr = this.matr.clone();\n\n\treturn this;\n};\n\n/*\n**\tPops a matrix from the matrix stack into the transformation matrix.\n*/\nCanvas.prototype.popMatrix = function ()\n{\n\tthis.matr.free();\n\tthis.matr = this.matrixStack.pop();\n\n\treturn this.updateTransform();\n};\n\n/*\n**\tSets or returns the relative alpha value for subsequent drawing operations.\n**\n**\t>> Canvas alpha (float value);\n**\t>> float alpha ();\n*/\n\nCanvas.prototype.alpha = function (value)\n{\n\tthis._alpha *= value;\n\n\tif (this.context && this.gl === null)\n\t\tthis.context.globalAlpha = this._alpha;\n\n\treturn this;\n};\n\n/*\n**\tPushes the current global alpha into the stack.\n*/\nCanvas.prototype.pushAlpha = function ()\n{\n\tthis.alphaStack.push (this.globalAlpha());\n\treturn this;\n};\n\n/*\n**\tPops an alpha from the stack into the global alpha.\n**\n**\t>> Canvas popAlpha();\n*/\nCanvas.prototype.popAlpha = function ()\n{\n\tthis.globalAlpha(this.alphaStack.pop());\n\treturn this;\n};\n\n/*\n**\tSets the depth-test flag.\n*/\nCanvas.prototype.setDepthFlag = function (value)\n{\n\tlet gl = this.gl;\n\tif (gl === null) return;\n\n\tif (value)\n\t{\n\t\tgl.enable (gl.DEPTH_TEST);\n\t\tthis._depthFlag = true;\n\t}\n\telse\n\t{\n\t\tgl.disable (gl.DEPTH_TEST);\n\t\tthis._depthFlag = false;\n\t}\n};\n\n/*\n**\tReturns the depth-test flag.\n*/\nCanvas.prototype.getDepthFlag = function ()\n{\n\treturn this._depthFlag;\n};\n\n/*\n**\tPushes the current depth-test flag into the depth flag stack. If a value is provided, the current flag will be pushed and set to the\n**\tgiven value only if they're different, when so, true will be returned.\n*/\nCanvas.prototype.pushDepthFlag = function (value=null)\n{\n\tif (value !== null)\n\t{\n\t\tvalue = !!value;\n\n\t\tif (value === this._depthFlag)\n\t\t\treturn false;\n\n\t\tthis.depthFlagStack.push(this._depthFlag);\n\t\tthis.setDepthFlag(value);\n\n\t\treturn true;\n\t}\n\n\tthis.depthFlagStack.push(this._depthFlag);\n};\n\n/*\n**\tPops the depth-test flag from the depth flag stack.\n*/\nCanvas.prototype.popDepthFlag = function ()\n{\n\tthis.setDepthFlag(this.depthFlagStack.pop());\n};\n\n/*\n**\tSets the active shader program.\n*/\nCanvas.prototype.setShaderProgram = function (program)\n{\n\tlet gl = this.gl;\n\tif (gl === null) return;\n\n\tglobals.shaderProgram = program;\n\tglobals.shaderProgram.activate();\n};\n\n/*\n**\tReturns the current shader program.\n*/\nCanvas.prototype.getShaderProgram = function ()\n{\n\treturn globals.shaderProgram;\n};\n\n/*\n**\tPushes the current shader program into the stack. If a value is provided, the current shader program will be pushed and set to the\n**\tgiven one only if they're different, when so, true will be returned.\n*/\nCanvas.prototype.pushShaderProgram = function (program=null)\n{\n\tif (program !== null)\n\t{\n\t\tif (program === globals.shaderProgram)\n\t\t\treturn false;\n\n\t\tthis.shaderProgramStack.push(globals.shaderProgram);\n\t\tthis.setShaderProgram(program);\n\n\t\treturn true;\n\t}\n\n\tthis.shaderProgramStack.push(globals.shaderProgram);\n};\n\n/*\n**\tPops the shader program from the stack.\n*/\nCanvas.prototype.popShaderProgram = function ()\n{\n\tthis.setShaderProgram(this.shaderProgramStack.pop());\n};\n\n\n/*\n**\tSets the transformation matrix to identity.\n**\n**\t>> Canvas loadIdentity();\n*/\n\nCanvas.prototype.loadIdentity = function ()\n{\n\tthis.matr.identity();\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tSets the transformation matrix to the specified one.\n**\n**\t>> Canvas loadMatrix (Matrix matr);\n*/\n\nCanvas.prototype.loadMatrix = function (matr)\n{\n\tthis.matr.set(matr);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tReturns the current transformation matrix, when `clone` is set to true, a cloned matrix will be returned.\n**\n**\t>> Matrix getMatrix(bool clone=false);\n*/\n\nCanvas.prototype.getMatrix = function (clone=false)\n{\n\treturn clone ? this.matr.clone() : this.matr;\n};\n\n\n/*\n**\tAppends a matrix to the current transformation matrix.\n**\n**\t>> Canvas appendMatrix (Matrix matr);\n*/\n\nCanvas.prototype.appendMatrix = function (matr)\n{\n\tthis.matr.append(matr);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tSets scaling factors for subsequent drawing operations. If the useNative is not set then scale with the current\n**\ttransformation matrix will be performed.\n**\n**\t>> Canvas scale (float sx, float sy, bool useNative=false);\n*/\n\nCanvas.prototype.scale = function (sx, sy, useNative)\n{\n\tif (useNative) {\n\t\tthis.context.scale (sx, sy);\n\t\treturn this;\n\t}\n\n\tthis.matr.scale (sx, sy);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tSets rotation factor for subsequent drawing operations. The angle is in radians. If useNative is not set\n**\tthen rotation with the transformation matrix will be used.\n**\n**\t>> Canvas rotate (float angle, bool useNative=false);\n*/\n\nCanvas.prototype.rotate = function (angle, useNative)\n{\n\tif (useNative) {\n\t\tthis.context.rotate (angle);\n\t\treturn this;\n\t}\n\n\tthis.matr.rotate(angle);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tMoves starting point to an specified location. If the useNative parameter is not set then translation with\n**\tthe transformation matrix will be done.\n**\n**\t>> Canvas translate (float x, float y, bool useNative=false);\n*/\n\nCanvas.prototype.translate = function (x, y, useNative)\n{\n\tif (useNative) {\n\t\tthis.context.translate(x, y);\n\t\treturn this;\n\t}\n\n\tthis.matr.translate(x, y);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tCreates a hollow ellipse path on the canvas for subsequent stroke or fill.\n**\n**\t>> Canvas ellipse (float x, float y, float w, float h);\n*/\n\nCanvas.prototype.ellipse = function (x, y, w, h)\n{\n\tvar ox = (w/2)*.5522848, oy = (h/2)*.5522848;\n\tvar xe = x+w-1, ye = y+h-1, xm = x+w/2, ym = y+h/2;\n\n\tthis.beginPath ().moveTo(x, ym);\n\tthis.bezierCurveTo (x, ym - oy, xm - ox, y, xm, y);\n\tthis.bezierCurveTo (xm + ox, y, xe, ym - oy, xe, ym);\n\tthis.bezierCurveTo (xe, ym + oy, xm + ox, ye, xm, ye);\n\tthis.bezierCurveTo (xm - ox, ye, x, ym + oy, x, ym);\n\tthis.closePath ();\n\n\treturn this;\n};\n\n\n/*\n**\tCreates a hollow circle path on the canvas for subsequent stroke or fill. If the stroke param is set the circle\n**\twill be drawn with the specified stroke color.\n**\n**\t>> Canvas circle (float x, float y, float r, string strokeColor);\n**\t>> Canvas circle (float x, float y, float r);\n*/\n\nCanvas.prototype.circle = function (x, y, r, stroke)\n{\n\tthis.beginPath();\n\tthis.arc(x, y, r, 0, 2*Math.PI);\n\tthis.closePath();\n\n\tif (stroke) this.stroke(stroke);\n\n\treturn this;\n};\n\n\n/*\n**\tDraws a line for subsequent stroke or fill. If the stroke param is set the line will be drawn with\n**\tthe specified stroke color.\n**\n**\t>> Canvas line (float x1, float y1, float x2, float y2, string strokeColor);\n**\t>> Canvas line (float x1, float y1, float x2, float y2);\n*/\n\nCanvas.prototype.line = function (x1, y1, x2, y2, stroke)\n{\n\tthis.beginPath();\n\tthis.moveTo(x1, y1);\n\tthis.lineTo(x2, y2);\n\tthis.closePath();\n\n\tif (stroke) this.stroke(stroke);\n\treturn this;\n};\n\n\n/*\n**\tAttaches internal listeners for mouse/pointer events on the canvas object, this is called automatically when\n**\tattaching handlers to the canvas. The actual handlers are added or removed using the addPointerHandler and\n**\tremovePointerHandler respectively.\n**\n**\t>> Canvas enablePointerEvents();\n*/\n\nCanvas.prototype.enablePointerEvents = function()\n{\n\tif (this.pointerHandler) return this;\n\n\tthis.pointerScale = { sx: 1, sy: 1 };\n\tthis.pointerOffset = { x: 0, y: 0 };\n\n\tvar _ = this;\n\n\tvar _evt =\n\t{\n\t\taction: '',\n\t\tbuttons: 0, lbuttons: 0,\n\t\tx: 0, y: 0,\n\n\t\tcontainedBy: function (x, y, w, h) {\n\t\t\treturn this.x >= x && this.x <= (x+w-1) && this.y >= y && this.y <= (y+h-1);\n\t\t}\n\t};\n\n\tthis.pointerHandlers = [];\n\n\tthis.pointerHandler = function (code, evt)\n\t{\n\t\tvar rect = this.elem.getBoundingClientRect();\n\n\t\t_evt.action = code;\n\t\t_evt.buttons = evt.buttons;\n\t\t_evt.x = _evt.rx = int(evt.clientX - rect.left);\n\t\t_evt.y = _evt.ry = int(evt.clientY - rect.top);\n\n\t\t_evt.x = ((_evt.x - _.pointerOffset.x) - 0.0*_.pointerScale.sx) / _.pointerScale.sx;\n\t\t_evt.y = ((_evt.y - _.pointerOffset.y) - 0.0*_.pointerScale.sy) / _.pointerScale.sy;\n\n\t\t_evt.dragging = false;\n\n\t\tif (_evt.buttons && !_evt.lbuttons)\n\t\t{\n\t\t\t_evt.sx = _evt.x;\n\t\t\t_evt.sy = _evt.y;\n\n\t\t\t_evt.ldx = _evt.ldy = 0;\n\t\t}\n\n\t\tif (_evt.buttons && _evt.lbuttons)\n\t\t{\n\t\t\t_evt.dragging = true;\n\n\t\t\t_evt.dx = _evt.x - _evt.sx;\n\t\t\t_evt.dy = _evt.y - _evt.sy;\n\t\t\t\n\t\t\t_evt.ddx = _evt.dx - _evt.ldx;\n\t\t\t_evt.ddy = _evt.dy - _evt.ldy;\n\n\t\t\t_evt.ldx = _evt.dx;\n\t\t\t_evt.ldy = _evt.dy;\n\t\t}\n\n\t\t_evt.lbuttons = _evt.buttons;\n\n\t\tfor (var i = 0; i < this.pointerHandlers.length; i++)\n\t\t{\n\t\t\tif (this.pointerHandlers[i][1] (_evt, this.pointerHandlers[i][2]) === false)\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tthis.elem.onmousedown = function(evt) {  _.pointerHandler('DOWN', evt); };\n\tthis.elem.onmouseup = function(evt) { _.pointerHandler('UP', evt); };\n\tthis.elem.onmousemove = function(evt) { _.pointerHandler('MOVE', evt); };\n\n\treturn this;\n};\n\n\n/*\n**\tSets the pointer scaling factors.\n**\n**\t>> Canvas setPointerScale (float sx, float sy);\n*/\n\nCanvas.prototype.setPointerScale = function (sx, sy)\n{\n\tthis.pointerScale = { sx: sx, sy: sy };\n\treturn this;\n};\n\n\n/*\n**\tSets the pointer offset that is applied after scaling.\n**\n**\t>> Canvas setPointerOffset (float x, float y);\n*/\n\nCanvas.prototype.setPointerOffset = function (x, y)\n{\n\tthis.pointerOffset = { x: x, y: y };\n\treturn this;\n};\n\n\n/*\n**\tAdds a pointer event handler, returns the handler reference id for later removal.\n**\n**\t>> string addPointerHandler (function callback, object context);\n**\t>> string addPointerHandler (function callback);\n*/\n\nCanvas.prototype.addPointerHandler = function (callback, context)\n{\n\tthis.enablePointerEvents();\n\n\tthis.pointerHandlers.push ([this.pointerHandlers.length+\"_\"+int(Math.random()*1e6), callback, context]);\n\n\treturn this.pointerHandlers[this.pointerHandlers.length-1][0];\n};\n\n\n/*\n**\tRemoves a previously attached pointer event handler.\n**\n**\t>> void removePointerHandler (string id);\n*/\n\nCanvas.prototype.removePointerHandler = function (id)\n{\n\tif (!this.pointerHandlers) return;\n\n\tfor (var i = 0; i < this.pointerHandlers.length; i++)\n\t{\n\t\tif (this.pointerHandlers[i][0] == id)\n\t\t{\n\t\t\tthis.pointerHandlers.splice(i, 1);\n\t\t\tbreak;\n\t\t}\n\t}\n};\n\n/**\n * \tExecutes the `draw` function on a new canvas of the specified width and height. Renders it into an image and runs the completed callback with the ready HTMLImageElement object.\n * \t!static renderImage (width: number, height: number, filter: 'NEAREST'|'LINEAR', draw: (g: Canvas) => void, completed: (img: HTMLImageElement) => void) : void;\n */\nCanvas.renderImage = function (width, height, draw, completed)\n{\n\tlet g = new Canvas({ width: width, height: height });\n\n\tdraw(g);\n\n\tlet img = new Image();\n\timg.onload = () => {\n\t\t//Violet: set other image properties.\n\t\timg.filter = 'NEAREST';\n\t\timg.rscale = 1.0;\n\t\tSystem.renderer.prepareImage(img);\n\t\tcompleted(img);\n\t};\n\n\timg.src = g.toDataUrl();\n\tg.dispose();\n};\n\nexport default Canvas;\n","/*\n**\tsystem/system.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport KeyCode from './keycode.js';\nimport List from '../utils/list.js';\nimport Linkable from '../utils/linkable.js';\nimport Timer from './timer.js';\nimport Canvas from './canvas.js';\nimport Log from './log.js';\nimport globals from './globals.js';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"./keycode\"]\n//![import \"../utils/list\"]\n//![import \"../utils/linkable\"]\n//![import \"./timer\"]\n//![import \"./canvas\"]\n//![import \"./globals\"]\n\n//!namespace System\n\n\t//:type DisplayOrientation = 'default'|'landscape'|'portrait'|'automatic';\n\n\t//!type Options =\n\n\t\t/**\n\t\t *\tBackground of the system canvas. Should be a full 7-digit HEX RGB color.\n\t\t *\t@default \"#000000\"\n\t\t *\t!background?: string;\n\t\t */\n\n\t\t/**\n\t\t * \tSet to `false` to disable WebGL mode.\n\t\t * \t@default true\n\t\t * \t!gl?: boolean;\n\t\t */\n\n\t\t/**\n\t\t *\tSet to `true` t o enable on-screen logging.\n\t\t *\t@default false\n\t\t *\t!log?: boolean,\n\t\t */\n\n\t\t/**\n\t\t *\tWhen `true` the renderer will not clear the buffer on each frame draw, thus allowing overdrawing on the previous frame.\n\t\t *\t@default false\n\t\t *\t!overdraw?: boolean,\n\t\t */\n\n\t\t/**\n\t\t *\tEnables or disables antialised canvas. Set to `false` when pixel-perfect is desired.\n\t\t *\t@default false\n\t\t *\t!antialias?: boolean;\n\t\t */\n\n\t\t/**\n\t\t *\tDesired orientaton of the display.\n\t\t *\t@default \"automatic\"\n\t\t *\t!orientation?: System.DisplayOrientation;\n\t\t */\n\n\t\t/**\n\t\t *\tDesired display width. When not specified (null) the maximum screen width to maintain the aspect ratio will be used.\n\t\t *\t@default null\n\t\t *\t!screenWidth?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tDesired display height. When not specified (null) the maximum screen height to maintain the aspect ratio will be used.\n\t\t *\t@default null\n\t\t *\t!screenHeight?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tTarget frames per second (FPS). Used to determine delay between frames.\n\t\t *\t@default 144\n\t\t *\t!fps?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tMinimum allowed frames per second (FPS). If system FPS drops below this value, the `frameDelta` property of System will be truncated to 1/minFps.\n\t\t *\t@default 10\n\t\t *\t!minFps?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tSelects which rendering mechanism to use either requestAnimationFrame when `true` or setTimeout when `false`.\n\t\t *\t@default true\n\t\t *\t!vsync?: boolean;\n\t\t */\n\n\t\t/**\n\t\t *\tExtra scale factor used to resize images. Use only when you want to render higher resolution images possibly for a very high DPI display.\n\t\t *\t@default 1\n\t\t *\t!extraScaleFactor?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tMaximum scale factor that should be used in the system. A value of `null` will cause no limit.\n\t\t *\t@default null\n\t\t *\t!maxScaleFactor?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tIndicates which method to use to find the target resolution, using `fullscreen` object when `true`, or the `window` object when `false`.\n\t\t *\t@default false\n\t\t *\t!fullscreen?: boolean;\n\t\t */\n\n\t\t/**\n\t\t * \tIndicates if recycler pool preallocation should be automatically executed. Additionally if this value is a number, it will be used as\n\t\t * \tmaximum preallocation parameter for the recycler.\n\t\t * \t@default true\n\t\t * \t!preallocate?: boolean|number;\n\t\t */\n\n\t//!/type\n\n//!/namespace\n\n//!class System\n\nconst System =\n{\n\t/**\n\t * \tRenderer status flags.\n\t */\n\tflags:\n\t{\n\t\trenderingEnabled: false,\n\t\trenderingPaused: false\n\t},\n\n\t/**\n\t * \tDefault options of the rendering system.\n\t */\n\tdefaultOptions:\n\t{\n\t\tbackground: \"#000000\",\n\t\tgl: true,\n\t\tlog: false,\n\n\t\toverdraw: false,\n\t\tantialias: true,\n\t\torientation: 0,\n\n\t\tfps: 144,\n\t\tminFps: 15,\n\t\tvsync: true,\n\n\t\tscreenWidth: null,\n\t\tscreenHeight: null,\n\n\t\textraScaleFactor: 1,\n\t\tmaxScaleFactor: null,\n\n\t\tfullscreen: false\n\t},\n\n\t/**\n\t * \tScreen width, available only after the system has been initialized.\n\t * \t!static readonly screenWidth: number;\n\t */\n\tscreenWidth: 0,\n\n\t/**\n\t * \tScreen height, available only after the system has been initialized.\n\t * \t!static readonly screenHeight: number;\n\t */\n\tscreenHeight: 0,\n\n\t/**\n\t * \tCurrent display orientation.\n\t * \t!static readonly orientation: System.DisplayOrientation;\n\t */\n\torientation: 0,\n\n\t/**\n\t * \tCoordinates of the screen's offset (for letter-box effect when the screen does not fit tightly).\n\t */\n\toffsX: 0, offsY: 0,\n\n\t/**\n\t * \tDevice pixel ratio, canvas backing store ratio and resulting canvas ratio (devicePixelRatio / backingStoreRatio).\n\t */\n\tdevicePixelRatio: 1, backingStoreRatio: 1, canvasPixelRatio: 1, canvasScaleFactor: 1, scaleFactor: 1,\n\n\t/**\n\t * \tInitial transformation matrix. Should be used (if needed) instead of `loadIdentity` since the System does some transformations first.\n\t * \t!static readonly initialMatrix: Matrix;\n\t */\n\tinitialMatrix: null,\n\n\t/**\n\t * \tPrimary renderer.\n\t * \t!static readonly renderer: Canvas;\n\t */\n\trenderer: null,\n\n\t/**\n\t * \tSecondary display buffer (always 2D). Has the same initial transformation matrix as the primary display buffer.\n\t * \t!static readonly displayBuffer2: Canvas;\n\t */\n\tdisplayBuffer2: null,\n\n\t/**\n\t * \tTerciary display buffer (always 2D). Is assured to have 1:1 with the screen size, initial transformation matrix not applied.\n\t * \t!static readonly displayBuffer3: Canvas;\n\t */\n\tdisplayBuffer3: null,\n\n\t/**\n\t * \tSmall (320x240) temporal display buffer. Used to preload images.\n\t */\n\ttempDisplayBuffer: null,\n\n\t/**\n\t * \tMap with the status of all keys (along with other flags).\n\t */\n\tkeyState: { time: 0, shift: false, ctrl: false, alt: false, keyCode: 0 },\n\n\t/**\n\t * \tCurrent status of all pointers. The related object is known as the Pointer State, and has the following fields: id, isActive, isDragging, sx, sy, x, y, dx, dy, button, wheelDelta and wheelAccum.\n\t */\n\tpointerState: { },\n\n\t/**\n\t * \tThe update method of all objects will be executed when the system update() method is called.\n\t */\n\tupdateQueue: null,\n\n\t/**\n\t * \tThe draw method of all objects will be executed when the system draw() method is called.\n\t */\n\tdrawQueue: null, /*List*/\n\n\t/**\n\t * \tThe frame delta is multiplied by this value before each system cycle (defaults to 1).\n\t * \t!static timeScale: number;\n\t */\n\ttimeScale: 1,\n\n\t/**\n\t * \tFrame interval in milliseconds.\n\t * \t!static readonly frameInterval: number;\n\t */\n\tframeInterval: 0,\n\n\t/**\n\t * \tFixed frame interval in milliseconds, when set to non-zero value the frame delta will always be set to this value.\n\t * \t!static fixedFrameInterval: number;\n\t */\n\tfixedFrameInterval: 0,\n\n\t/**\n\t * \tMaximum frame interval in milliseconds, if the `frameDelta` exceeds this, it will be truncated to this value. Controlled by the `minFps` value\n\t * \tof the system initialization options.\n\t * \t!static readonly maxFrameInterval: number;\n\t */\n\tmaxFrameInterval: 0,\n\n\t/**\n\t * \tLast frame delta in seconds.\n\t * \t!static readonly frameDelta: number;\n\t */\n\tframeDelta: 0,\n\n\t/**\n\t * \tLogical system time in seconds. Updated on each cycle by the calculated `frameDelta`.\n\t * \t!static readonly frameTime: number;\n\t */\n\tframeTime: 0,\n\n\t/**\n\t * \tCurrent frame number.\n\t * \t!static readonly frameNumber: number;\n\t */\n\tframeNumber: 0,\n\n\t/**\n\t * \tRendering performance data.\n\t */\n\tperf:\n\t{\n\t\t/**\n\t\t * \tCurrent time range.\n\t\t */\n\t\tstartTime: 0,\n\t\tlastTime: 0,\n\n\t\t/**\n\t\t * \tNumber of frames drawn in the current time range.\n\t\t */\n\t\tnumFrames: 0,\n\n\t\t/**\n\t\t * \tNumber of update and draw samples averaged in total.\n\t\t */\n\t\tnumSamples: 0,\n\n\t\t/**\n\t\t * \tTotal time spent in update, draw and extra respectively in the current time range.\n\t\t */\n\t\tupdateTimeTotal: 0,\n\t\tdrawTimeTotal: 0,\n\t\textraTimeTotal: 0,\n\n\t\t/**\n\t\t * \tCalculated values for the last time range. The updateTime and drawTime are in microseconds.\n\t\t */\n\t\tfps: 0,\n\t\taverageFps: 0,\n\t\taverageUpdateTime: 0,\n\t\taverageDrawTime: 0,\n\t\taverageExtraTime: 0\n\t},\n\n\t/**\n\t * \tInitializes the system with the specified configuration options.\n\t * \t!static init (options: System.Options) : void;\n\t */\n\tinit: function (options=null)\n\t{\n\t\tlet self = this;\n\n\t\tlet o = { ...this.defaultOptions, ...options };\n\t\tthis.options = o;\n\n\t\t// Execute recycler pool data preallocation.\n\t\tif (this.options.preallocate !== false)\n\t\t{\n\t\t\tif (this.options.preallocate === true)\n\t\t\t\tRecycler.preallocate();\n\t\t\telse\n\t\t\t\tRecycler.preallocate(this.options.preallocate);\n\t\t}\n\n\t\t// Set default orientation if both target sizes were specified.\n\t\tif (o.screenWidth && o.screenHeight && o.orientation == 'default')\n\t\t\to.orientation = o.screenWidth > o.screenHeight ? 'landscape' : 'portrait';\n\n\t\tthis.orientation = o.orientation;\n\n\t\tthis.updateQueue = List.Pool.alloc();\n\t\tthis.drawQueue = List.Pool.alloc();\n\n\t\t// Attach frame event handlers.\n\t\tthis.frameInterval = 1000 / o.fps;\n\t\tthis.maxFrameInterval = 1000 / o.minFps;\n\n\t\tglobal.onresize = function() { self.onWindowResized(); };\n\n\t\tthis.frameTimer = new Timer (o.vsync, this.frameInterval, (delta) => this.onFrame(delta));\n\n\t\t// Setup canvas buffer.\n\t\tthis.renderer = new Canvas ({ gl: o.gl, elem: null, absolute: true, hidden: false, antialias: o.antialias, background: o.background });\n\n\t\tthis.displayBuffer2 = new Canvas ({ gl: false, elem: null, absolute: true, hidden: false, antialias: o.antialias, background: 'none' });\n\t\tthis.displayBuffer2.elem.style.pointerEvents = 'none';\n\n\t\tthis.displayBuffer3 = new Canvas ({ gl: false, elem: null, absolute: true, hidden: false, antialias: o.antialias, background: 'none' });\n\t\tthis.displayBuffer3.elem.style.pointerEvents = 'none';\n\n\t\tthis.tempDisplayBuffer = new Canvas ({ hidden: true, antialias: o.antialias }).resize(320, 240);\n\n\t\tlet display0 = this.renderer.elem;\n\n\t\t// Obtain device display ratios.\n\t\tthis.devicePixelRatio = global.devicePixelRatio || 1;\n\n\t\tthis.backingStoreRatio = o.gl === true ? 1 : (this.renderer.context.webkitBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.renderer.context.mozBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.renderer.context.msBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.renderer.context.oBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.renderer.context.backingStorePixelRatio || 1);\n\n\t\tthis.canvasPixelRatio = this.devicePixelRatio / this.backingStoreRatio;\n\n\t\tSystem.onWindowResized(true);\n\n\t\t// Attach keyboard event handlers.\n\t\tglobal.onkeydown = function (evt)\n\t\t{\n\t\t\tif (evt.target !== global.document.body)\n\t\t\t\treturn;\n\n\t\t\tif (self.keyState[evt.keyCode])\n\t\t\t\treturn false;\n\n\t\t\tself.keyState[evt.keyCode] = true;\n\n\t\t\tself.keyState.keyCode = evt.keyCode;\n\t\t\tself.keyState.startTime = hrnow();\n\n\t\t\tswitch (evt.keyCode)\n\t\t\t{\n\t\t\t\tcase 16: // SHIFT\n\t\t\t\t\tself.keyState.shift = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 17: // CTRL\n\t\t\t\t\tself.keyState.ctrl = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 18: // ALT\n\t\t\t\t\tself.keyState.alt = true;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// CTRL+TAB should always be handled by the browser.\n\t\t\tif (self.keyState.ctrl && evt.keyCode == KeyCode.TAB)\n\t\t\t{\n\t\t\t\tself.keyState[evt.keyCode] = false;\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (self.onKeyboardEvent (self.KeyboardEventType.KEY_DOWN, evt.keyCode, self.keyState) === false)\n\t\t\t\treturn false;\n\t\t};\n\n\t\tglobal.onkeyup = function (evt)\n\t\t{\n\t\t\tif (evt.target !== global.document.body)\n\t\t\t\treturn;\n\n\t\t\tif (!self.keyState[evt.keyCode])\n\t\t\t\treturn false;\n\n\t\t\tself.keyState[evt.keyCode] = false;\n\t\t\tself.keyState.endTime = hrnow();\n\t\t\tself.keyState.keyCode = evt.keyCode;\n\n\t\t\tswitch (evt.keyCode)\n\t\t\t{\n\t\t\t\tcase 16: // SHIFT\n\t\t\t\t\tself.keyState.shift = false;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 17: // CTRL\n\t\t\t\t\tself.keyState.ctrl = false;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 18: // ALT\n\t\t\t\t\tself.keyState.alt = false;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (self.onKeyboardEvent (self.KeyboardEventType.KEY_UP, evt.keyCode, self.keyState) === false)\n\t\t\t\treturn false;\n\t\t};\n\n\t\t// Converts pointer coordinates from physical space to screen space.\n\n\t\tconst pointerConvX = function (x, y)\n\t\t{\n\t\t\treturn System.reverseRender ? int(System.screenWidth-1 - (y-System.offsY)/System.canvasScaleFactor) : int((x-System.offsX)/System.canvasScaleFactor);\n\t\t};\n\n\t\tconst pointerConvY = function (x, y)\n\t\t{\n\t\t\treturn System.reverseRender ? int((x-System.offsX)/System.canvasScaleFactor) : int((y-System.offsY)/System.canvasScaleFactor);\n\t\t};\n\n\t\t// Attach pointer event handlers if pointer-events are available.\n\t\tif (\"ontouchstart\" in global)\n\t\t{\n\t\t\tdisplay0.ontouchstart = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tlet touches = evt.changedTouches;\n\n\t\t\t\tfor (let i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointerState[touches[i].identifier])\n\t\t\t\t\t{\n\t\t\t\t\t\tSystem.pointerState[touches[i].identifier] = {\n\t\t\t\t\t\t\t\tid: touches[i].identifier, isActive: false, isDragging: false,\n\t\t\t\t\t\t\t\tsx: 0, sy: 0, x: 0, y: 0, dx: 0, dy: 0, button: 0,\n\t\t\t\t\t\t\t\twheelDelta: 0, wheelAccum: 0\n\t\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tlet p = System.pointerState[touches[i].identifier];\n\n\t\t\t\t\tp.isActive = true;\n\t\t\t\t\tp.isDragging = false;\n\t\t\t\t\tp.button = 1;\n\n\t\t\t\t\tp.startTime = hrnow();\n\n\t\t\t\t\tp.x = p.sx = pointerConvX(touches[i].clientX, touches[i].clientY);\n\t\t\t\t\tp.y = p.sy = pointerConvY(touches[i].clientX, touches[i].clientY);\n\n\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DOWN, p, System.pointerState);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchend = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tlet touches = evt.changedTouches;\n\n\t\t\t\tfor (let i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointerState[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tlet p = System.pointerState[touches[i].identifier];\n\n\t\t\t\t\tp.endTime = hrnow();\n\t\t\t\t\tp.deltaTime = p.endTime - p.startTime;\n\n\t\t\t\t\tp.x = pointerConvX(touches[i].clientX, touches[i].clientY)\n\t\t\t\t\tp.y = pointerConvY(touches[i].clientX, touches[i].clientY)\n\n\t\t\t\t\tif (p.isDragging)\n\t\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DRAG_STOP, p, System.pointerState);\n\n\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_UP, p, System.pointerState);\n\n\t\t\t\t\tp.isActive = false;\n\t\t\t\t\tp.isDragging = false;\n\n\t\t\t\t\tp.button = 0;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchcancel = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tlet touches = evt.changedTouches;\n\n\t\t\t\tfor (let i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointerState[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tlet p = System.pointerState[touches[i].identifier];\n\n\t\t\t\t\tp.x = pointerConvX(touches[i].clientX, touches[i].clientY);\n\t\t\t\t\tp.y = pointerConvY(touches[i].clientX, touches[i].clientY);\n\n\t\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.PointerEventType.POINTER_DRAG_STOP : System.PointerEventType.POINTER_UP, p, System.pointerState);\n\n\t\t\t\t\tp.isActive = false;\n\t\t\t\t\tp.isDragging = false;\n\n\t\t\t\t\tp.button = 0;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchmove = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tlet touches = evt.changedTouches;\n\n\t\t\t\tfor (let i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointerState[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tlet p = System.pointerState[touches[i].identifier];\n\n\t\t\t\t\tif (p.isActive && !p.isDragging)\n\t\t\t\t\t{\n\t\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DRAG_START, p, System.pointerState);\n\t\t\t\t\t\tp.isDragging = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tp.x = pointerConvX(touches[i].clientX, touches[i].clientY);\n\t\t\t\t\tp.y = pointerConvY(touches[i].clientX, touches[i].clientY);\n\n\t\t\t\t\tp.dx = p.x - p.sx;\n\t\t\t\t\tp.dy = p.y - p.sy;\n\n\t\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.PointerEventType.POINTER_DRAG_MOVE : System.PointerEventType.POINTER_MOVE, p, System.pointerState);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\t\t// Attach mouse event handlers when pointer-events are not available.\n\t\telse\n\t\t{\n\t\t\tdisplay0.oncontextmenu = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.onwheel = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointerState[0])\n\t\t\t\t{\n\t\t\t\t\tSystem.pointerState[0] = {\n\t\t\t\t\t\t\tid: 0, isActive: false, isDragging: false,\n\t\t\t\t\t\t\tsx: 0, sy: 0, x: 0, y: 0, dx: 0, dy: 0, button: 0,\n\t\t\t\t\t\t\twheelDelta: 0, wheelAccum: 0\n\t\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlet p = System.pointerState[0];\n\n\t\t\t\tp.x = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = pointerConvY(evt.clientX, evt.clientY);\n\t\t\t\tp.wheelDelta = evt.deltaY;\n\t\t\t\tp.wheelAccum += evt.deltaY;\n\n\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_WHEEL, p, System.pointerState);\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.onmousedown = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointerState[0])\n\t\t\t\t{\n\t\t\t\t\tSystem.pointerState[0] = {\n\t\t\t\t\t\t\tid: 0, isActive: false, isDragging: false,\n\t\t\t\t\t\t\tsx: 0, sy: 0, x: 0, y: 0, dx: 0, dy: 0, button: 0,\n\t\t\t\t\t\t\twheelDelta: 0, wheelAccum: 0\n\t\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlet p = System.pointerState[0];\n\n\t\t\t\tp.isActive = true;\n\t\t\t\tp.isDragging = false;\n\t\t\t\tp.button = evt.which;\n\n\t\t\t\tp.x = p.sx = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = p.sy = pointerConvY(evt.clientX, evt.clientY);\n\n\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DOWN, p, System.pointerState);\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.onmouseup = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointerState[0])\n\t\t\t\t\treturn false;\n\n\t\t\t\tlet p = System.pointerState[0];\n\n\t\t\t\tp.x = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = pointerConvY(evt.clientX, evt.clientY);\n\n\t\t\t\tif (p.isDragging)\n\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DRAG_STOP, p, System.pointerState);\n\n\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_UP, p, System.pointerState);\n\n\t\t\t\tp.isActive = false;\n\t\t\t\tp.isDragging = false;\n\n\t\t\t\tp.button = 0;\n\t\t\t};\n\n\t\t\tdisplay0.onmousemove = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointerState[0])\n\t\t\t\t\treturn false;\n\n\t\t\t\tlet p = System.pointerState[0];\n\n\t\t\t\tif (p.isActive && !p.isDragging)\n\t\t\t\t{\n\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DRAG_START, p, System.pointerState);\n\t\t\t\t\tp.isDragging = true;\n\t\t\t\t}\n\n\t\t\t\tp.x = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = pointerConvY(evt.clientX, evt.clientY);\n\n\t\t\t\tp.dx = p.x - p.sx;\n\t\t\t\tp.dy = p.y - p.sy;\n\n\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.PointerEventType.POINTER_DRAG_MOVE : System.PointerEventType.POINTER_MOVE, p, System.pointerState);\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\t// Enable log if flag is set.\n\t\tif (o.log === true) Log.enable();\n\t},\n\n\t/**\n\t * \tReturns the current logical time in seconds (same as reading `System.frameTime`).\n\t * \t!static time() : number;\n\t */\n\ttime: function()\n\t{\n\t\treturn this.frameTime;\n\t},\n\n\t/**\n\t * \tStarts the system and enables rendering and updates.\n\t * \t!static start() : void;\n\t */\n\tstart: function()\n\t{\n\t\tthis.onWindowResized();\n\n\t\tthis.flags.renderingPaused = false;\n\t\tthis.frameTimer.start();\n\t},\n\n\t/**\n\t * \tStops the system by disabling both rendering and updates.\n\t * \t!static stop() : void;\n\t */\n\tstop: function()\n\t{\n\t\tthis.flags.renderingPaused = true;\n\t\tthis.frameTimer.stop();\n\t},\n\n\t/**\n\t * \tPauses the system by disabling updates, but rendering will be continued.\n\t * \t!static pause() : void;\n\t */\n\tpause: function()\n\t{\n\t\tthis.flags.renderingPaused = true;\n\t},\n\n\t/**\n\t * \tResumes the system after previously being paused with `pause` method.\n\t * \t!static resume() : void;\n\t */\n\tresume: function()\n\t{\n\t\tthis.flags.renderingPaused = false;\n\t\tthis.resetPerf();\n\t},\n\n\t/**\n\t * \tExecuted when a frame needs to be rendered to the display buffer.\n\t * \tstatic onFrame (delta: number) : void;\n\t */\n\tonFrame: function(delta)\n\t{\n\t\tlet now = hrnow()\n\t\tlet tmp;\n\n\t\tif (delta > this.maxFrameInterval)\n\t\t\tdelta = this.maxFrameInterval;\n\n\t\tif (this.fixedFrameInterval !== 0)\n\t\t\tdelta = this.fixedFrameInterval;\n\n\t\tif (!this.flags.renderingEnabled || this.flags.renderingPaused)\n\t\t{\n\t\t\tthis.draw();\n\t\t\treturn;\n\t\t}\n\n\t\tdelta *= this.timeScale;\n\n\t\tthis.frameDelta = delta / 1000.0;\n\t\tthis.frameTime += this.frameDelta;\n\t\tglobals.time = this.frameTime;\n\n\t\tthis.frameNumber++;\n\n\t\t/* ~ */\n\t\ttmp = hrnow();\n\t\tthis.update (this.frameDelta);\n\t\tthis.perf.updateTimeTotal += hrnow() - tmp;\n\n\t\t/* ~ */\n\t\ttmp = hrnow();\n\t\tthis.draw();\n\t\tthis.perf.drawTimeTotal += hrnow() - tmp;\n\n\t\t/* ~ */\n\t\tthis.perf.lastTime = now;\n\t\tthis.perf.numFrames++;\n\n\t\tdelta = this.perf.lastTime - this.perf.startTime;\n\t\tif (delta > 1000)\n\t\t{\n\t\t\tthis.perf.fps = int(this.perf.numFrames*1000 / delta);\n\n\t\t\t//this.perf.extraTimeTotal = delta - this.perf.updateTimeTotal - this.perf.drawTimeTotal;\n\n\t\t\tthis.perf.averageFps = int(((this.perf.averageFps*this.perf.numSamples) + this.perf.fps) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.averageUpdateTime = int(((this.perf.averageUpdateTime*this.perf.numSamples) + (this.perf.updateTimeTotal*1000 / this.perf.numFrames)) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.averageDrawTime = int(((this.perf.averageDrawTime*this.perf.numSamples) + (this.perf.drawTimeTotal*1000 / this.perf.numFrames)) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.averageExtraTime = int(((this.perf.averageExtraTime*this.perf.numSamples) + (this.perf.extraTimeTotal*1000 / this.perf.numFrames)) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.numSamples++;\n\n\t\t\tthis.perf.startTime = now;\n\t\t\tthis.perf.lastTime = now;\n\t\t\tthis.perf.numFrames = 0;\n\t\t\tthis.perf.updateTimeTotal = 0;\n\t\t\tthis.perf.drawTimeTotal = 0;\n\t\t\tthis.perf.extraTimeTotal = 0;\n\t\t}\n\t},\n\n\t/**\n\t * \tExecuted when the size of the window has changed.\n\t * \tstatic onWindowResized (notRendering: boolean = false) : void;\n\t */\n\tonWindowResized: function(notRendering=false)\n\t{\n\t\t// Determine size of the screen.\n\t\tif ('document' in global)\n\t\t{\n\t\t\tif (this.options.fullscreen)\n\t\t\t{\n\t\t\t\tthis._screenWidth = int(global.screen.width);\n\t\t\t\tthis._screenHeight = int(global.screen.height);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._screenWidth = global.innerWidth;\n\t\t\t\tthis._screenHeight = global.innerHeight;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._screenWidth = this.options.screenWidth;\n\t\t\tthis._screenHeight = this.options.screenHeight;\n\n\t\t\tif (this.options.screenWidth == null && this.options.screenHeight == null)\n\t\t\t\tthrow new Error ('At least one screen dimension must be specified in headless mode.');\n\t\t}\n\n\t\t// Flip dimensions to ensure the desired orientation.\n\t\tif ((this._screenWidth < this._screenHeight && this.orientation == 'landscape') || (this._screenWidth > this._screenHeight && this.orientation == 'portrait'))\n\t\t{\n\t\t\tthis.screenWidth = this._screenHeight;\n\t\t\tthis.screenHeight = this._screenWidth;\n\n\t\t\tthis.reverseRender = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.screenWidth = this._screenWidth;\n\t\t\tthis.screenHeight = this._screenHeight;\n\n\t\t\tthis.reverseRender = false;\n\t\t}\n\n\t\t// Get target screen dimensions.\n\t\tlet targetScreenWidth = this.options.screenWidth;\n\t\tlet targetScreenHeight = this.options.screenHeight;\n\n\t\tif (targetScreenWidth === null || targetScreenHeight === null)\n\t\t{\n\t\t\tif (targetScreenWidth === null && targetScreenHeight === null)\n\t\t\t{\n\t\t\t\ttargetScreenWidth = this.screenWidth;\n\t\t\t\ttargetScreenHeight = this.screenHeight;\n\t\t\t}\n\t\t\telse if (targetScreenWidth === null)\n\t\t\t{\n\t\t\t\ttargetScreenWidth = int(0.5 + this.screenWidth * (this.options.screenHeight / this.screenHeight));\n\t\t\t}\n\t\t\telse if (targetScreenHeight === null)\n\t\t\t{\n\t\t\t\ttargetScreenHeight = int(0.5 + this.screenHeight * (this.options.screenWidth / this.screenWidth));\n\t\t\t}\n\t\t}\n\n\t\t// ***\n\t\tlet screenWidth = targetScreenWidth;\n\t\tlet screenHeight = targetScreenHeight;\n\n\t\tif (this.orientation === 'automatic' && screenWidth && screenHeight)\n\t\t{\n\t\t\tif ((screenWidth > screenHeight && this.screenWidth < this.screenHeight) || (screenWidth < screenHeight && this.screenWidth > this.screenHeight))\n\t\t\t{\n\t\t\t\tscreenWidth = screenHeight;\n\t\t\t\tscreenHeight = targetScreenWidth;\n\t\t\t}\n\t\t}\n\n\t\t// ***\n\t\tthis.canvasScaleFactor = 1;\n\n\t\tif (screenWidth && screenHeight)\n\t\t{\n\t\t\tthis.canvasScaleFactor = Math.min(this.screenWidth / screenWidth, this.screenHeight / screenHeight);\n\t\t}\n\t\telse if (screenWidth)\n\t\t{\n\t\t\tthis.canvasScaleFactor = this.screenWidth / screenWidth;\n\t\t}\n\t\telse if (screenHeight)\n\t\t{\n\t\t\tthis.canvasScaleFactor = this.screenHeight / screenHeight;\n\t\t}\n\n\t\t// ***\n\t\tlet _screenWidth = this.screenWidth;\n\t\tlet _screenHeight = this.screenHeight;\n\n\t\tif (screenWidth) this.screenWidth = screenWidth;\n\t\tif (screenHeight) this.screenHeight = screenHeight;\n\n\t\tthis.offsX = int((_screenWidth - this.screenWidth*this.canvasScaleFactor)*0.5);\n\t\tthis.offsY = int((_screenHeight - this.screenHeight*this.canvasScaleFactor)*0.5);\n\n\t\tif (this.reverseRender)\n\t\t{\n\t\t\tlet tmp = this.offsX;\n\t\t\tthis.offsX = this.offsY;\n\t\t\tthis.offsY = tmp;\n\t\t}\n\n\t\tthis.scaleFactor = this.canvasScaleFactor * this.canvasPixelRatio;\n\t\tthis.scaleFactor = int(0.7 + this.scaleFactor);\n\n\t\tif (this.options.maxScaleFactor > 0 && this.scaleFactor > this.options.maxScaleFactor)\n\t\t\tthis.scaleFactor = this.options.maxScaleFactor;\n\n\t\tthis.flags.renderingEnabled = false;\n\n\t\t/*\n\t\t**\tIf the scale is not exact, the final canvas size might not fit the entire screen perfectly (will always be a little smaller in\n\t\t**\tsuch a case), when that happens the body's background color will be quite noticeable, to mitigate that we set the body background\n\t\t**\tto the same color as the primary canvas.\n\t\t*/\n\t\tif ('document' in global)\n\t\t\tglobal.document.body.style.backgroundColor = this.renderer.backgroundColor;\n\n\t\t/*\n\t\t**\tResize all display buffers.\n\t\t*/\n\t\tif (!this.reverseRender)\n\t\t{\n\t\t\tthis.renderer.resize (this.screenWidth*this.scaleFactor, this.screenHeight*this.scaleFactor);\n\t\t\tthis.renderer.elem.style.width = int(this.screenWidth*this.canvasScaleFactor+0.5) + \"px\";\n\t\t\tthis.renderer.elem.style.height = int(this.screenHeight*this.canvasScaleFactor+0.5) + \"px\";\n\n\t\t\tthis.displayBuffer2.resize (this.screenWidth*this.scaleFactor, this.screenHeight*this.scaleFactor);\n\t\t\tthis.displayBuffer2.elem.style.width = int(this.screenWidth*this.canvasScaleFactor+0.5) + \"px\";\n\t\t\tthis.displayBuffer2.elem.style.height = int(this.screenHeight*this.canvasScaleFactor+0.5) + \"px\";\n\n\t\t\tthis.displayBuffer3.resize (_screenWidth, _screenHeight);\n\t\t\tthis.displayBuffer3.elem.style.width = _screenWidth + \"px\";\n\t\t\tthis.displayBuffer3.elem.style.height = _screenHeight + \"px\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.renderer.resize (this.screenHeight*this.scaleFactor, this.screenWidth*this.scaleFactor);\n\t\t\tthis.renderer.elem.style.width = int(this.screenHeight*this.canvasScaleFactor+0.5) + \"px\";\n\t\t\tthis.renderer.elem.style.height = int(this.screenWidth*this.canvasScaleFactor+0.5) + \"px\";\n\n\t\t\tthis.displayBuffer2.resize (this.screenHeight*this.scaleFactor, this.screenWidth*this.scaleFactor);\n\t\t\tthis.displayBuffer2.elem.style.width = int(this.screenHeight*this.canvasScaleFactor+0.5) + \"px\";\n\t\t\tthis.displayBuffer2.elem.style.height = int(this.screenWidth*this.canvasScaleFactor+0.5) + \"px\";\n\n\t\t\tthis.displayBuffer3.resize (_screenHeight, _screenWidth);\n\t\t\tthis.displayBuffer3.elem.style.width = _screenHeight + \"px\";\n\t\t\tthis.displayBuffer3.elem.style.height = _screenWidth + \"px\";\n\t\t}\n\n\t\tthis.renderer.elem.style.marginLeft = this.offsX + \"px\";\n\t\tthis.renderer.elem.style.marginTop = this.offsY + \"px\";\n\n\t\tthis.displayBuffer2.elem.style.marginLeft = this.offsX + \"px\";\n\t\tthis.displayBuffer2.elem.style.marginTop = this.offsY + \"px\";\n\n\t\tthis.renderer.loadIdentity();\n\t\tthis.displayBuffer2.loadIdentity();\n\t\tthis.displayBuffer3.loadIdentity();\n\n\t\tif (this.scaleFactor != 1)\n\t\t{\n\t\t\tthis.renderer.globalScale(this.scaleFactor);\n\t\t\tthis.displayBuffer2.globalScale(this.scaleFactor);\n\t\t}\n\n\t\tif (this.reverseRender)\n\t\t{\n\t\t\tthis.renderer.rotate(Math.PI/2);\n\t\t\tthis.renderer.translate(-this.screenWidth, 0);\n\t\t\tthis.renderer.flipped(true);\n\n\t\t\tthis.displayBuffer2.rotate(Math.PI/2);\n\t\t\tthis.displayBuffer2.translate(-this.screenWidth, 0);\n\t\t\tthis.displayBuffer2.flipped(true);\n\n\t\t\tthis.displayBuffer3.rotate(Math.PI/2);\n\t\t\tthis.displayBuffer3.translate(-_screenWidth, 0);\n\t\t\tthis.displayBuffer3.flipped(true);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.renderer.flipped(false);\n\t\t\tthis.displayBuffer2.flipped(false);\n\t\t\tthis.displayBuffer3.flipped(false);\n\t\t}\n\n\t\t/* *** */\n\t\tthis.scaleFactor *= this.options.extraScaleFactor;\n\n\t\tif (this.options.maxScaleFactor > 0 && this.scaleFactor > this.options.maxScaleFactor)\n\t\t\tthis.scaleFactor = this.options.maxScaleFactor;\n\n\t\tthis.integerScaleFactor = int(this.scaleFactor + 0.5); //0.9\n\t\tthis.resetPerf();\n\n\t\tif (this.initialMatrix)\n\t\t\tthis.initialMatrix.free();\n\n\t\tthis.initialMatrix = this.renderer.getMatrix(true);\n\n\t\tif (notRendering != true)\n\t\t{\n\t\t\tthis.flags.renderingEnabled = true;\n\t\t\tthis.onCanvasResized (this.screenWidth, this.screenHeight);\n\t\t}\n\t},\n\n\t/**\n\t * \tEvent triggered when the canvas was resized by the system. Can be overriden.\n\t * \t!static onCanvasResized (screenWidth: number, screenHeight: number) : void;\n\t */\n\tonCanvasResized: function (screenWidth, screenHeight)\n\t{\n\t},\n\n\t/**\n\t * \tResets the performance data.\n\t */\n\tresetPerf: function()\n\t{\n\t\tthis.perf.startTime = hrnow();\n\t\tthis.perf.lastTime = hrnow();\n\n\t\tthis.perf.numFrames = 0;\n\t\tthis.perf.updateTimeTotal = 0;\n\t\tthis.perf.drawTimeTotal = 0;\n\t\tthis.perf.extraTimeTotal = 0;\n\n\t\tthis.perf.numSamples = 0;\n\t\tthis.perf.fps = 0;\n\t\tthis.perf.averageFps = 0;\n\t\tthis.perf.averageUpdateTime = 0;\n\t\tthis.perf.averageDrawTime = 0;\n\t\tthis.perf.averageExtraTime = 0;\n\t},\n\n\t/**\n\t * \tAdds the specified update handler to the system.\n\t * \t!updateQueueAdd (handler: { update: (dt: number) => void }) : Linkable;\n\t */\n\tupdateQueueAdd: function (handler)\n\t{\n\t\tthis.updateQueue.push (handler);\n\t\treturn this.updateQueue.bottom;\n\t},\n\n\t/**\n\t * \tRemoves the specified update handler from the system.\n\t * \t!updateQueueRemove (handler: { update: (dt: number) => void }) : void;\n\t */\n\t/**\n\t * \tRemoves the specified update handler node from the system.\n\t * \t!updateQueueRemove (node: Linkable) : void;\n\t */\n\tupdateQueueRemove: function (handler)\n\t{\n\t\tthis.updateQueue.remove (Linkable.isInstance(handler) ? handler : this.updateQueue.sgetNode(handler));\n\t},\n\n\t/**\n\t * \tAdds the specified draw handler to the system.\n\t * \t!drawQueueAdd (handler: { draw: (g: Canvas) => void }) : Linkable;\n\t */\n\tdrawQueueAdd: function (handler)\n\t{\n\t\tthis.drawQueue.push (handler);\n\t\treturn this.drawQueue.bottom;\n\t},\n\n\t/**\n\t * \tRemoves the specified draw handler from the system.\n\t * \t!drawQueueRemove (handler: { draw: (g: Canvas) => void }) : void;\n\t */\n\t/**\n\t * \tRemoves the specified draw handler node from the system.\n\t * \t!drawQueueRemove (node: Linkable) : void;\n\t */\n\tdrawQueueRemove: function (handler)\n\t{\n\t\tthis.drawQueue.remove (Linkable.isInstance(handler) ? handler : this.drawQueue.sgetNode(handler));\n\t},\n\n\t/**\n\t * \tAdds the specified handler to the update and draw queues.\n\t * \t!queueAdd (handler: { update: (dt: number) => void, draw: (g: Canvas) => void }) : void;\n\t */\n\tqueueAdd: function (handler)\n\t{\n\t\tthis.updateQueue.push (handler);\n\t\tthis.drawQueue.push (handler);\n\t},\n\n\t/**\n\t *\tRemoves the specified handler from the update and draw queues.\n\t * \t!queueRemove (handler: { update: (dt: number) => void, draw: (g: Canvas) => void }) : void;\n\t */\n\tqueueRemove: function (handler)\n\t{\n\t\tthis.updateQueue.remove (this.updateQueue.sgetNode(handler));\n\t\tthis.drawQueue.remove (this.drawQueue.sgetNode(handler));\n\t},\n\n\t/**\n\t * \tRuns an update cycle. All objects in the `updateQueue` will have their `update method called.\n\t */\n\tupdate: function (dt)\n\t{\n\t\ttry\n\t\t{\n\t\t\tlet next;\n\n\t\t\tfor (let elem = this.updateQueue.top; elem; elem = next)\n\t\t\t{\n\t\t\t\tnext = elem.next;\n\n\t\t\t\tif (elem.value.update(dt) === false)\n\t\t\t\t\tthis.updateQueueRemove(elem);\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tSystem.stop();\n\t\t\tthrow e;\n\t\t}\t\n\t},\n\n\t/**\n\t * \tRuns a rendering cycle. All objects in the `drawQueue` will have their `draw` method called.\n\t */\n\tdraw: function ()\n\t{\n\t\tif (this.renderer.gl !== null)\n\t\t\tthis.renderer.start();\n\n\t\tif (!this.options.overdraw)\n\t\t{\n\t\t\tthis.renderer.clear();\n\t\t\tthis.displayBuffer2.clear();\n\t\t\tthis.displayBuffer3.clear();\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tlet next;\n\n\t\t\tfor (let elem = this.drawQueue.top; elem; elem = next)\n\t\t\t{\n\t\t\t\tnext = elem.next;\n\t\t\t\telem.value.draw(this.renderer);\n\t\t\t}\n\n\t\t\tif (this.renderer.gl !== null)\n\t\t\t{\n\t\t\t\tthis.renderer.flush();\n\t\t\t\tthis.renderer.end();\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tSystem.stop();\n\t\t\tthrow e;\n\t\t}\t\n\t},\n\n\t/**\n\t * \tInterpolates numeric values between two objects (`src` and `dst`) using the specified `duration` and `easing` function. Note that all four parameters `src`, `dst`,\n\t * \t`duration` and `easing` must be objects having the same number of values.\n\t * \t!interpolate (src: object, dst: object, duration: object, easing: object, callback: (data: object, isFinished: boolean) => void) : void;\n\t */\n\tinterpolate: function (src, dst, duration, easing, callback)\n\t{\n\t\t//violet: not optimized\n\t\tlet time = { };\n\t\tlet data = { };\n\t\tlet count = 0;\n\n\t\tfor (let x in src)\n\t\t{\n\t\t\ttime[x] = 0.0;\n\t\t\tdata[x] = src[x]\n\t\t\tcount++;\n\t\t}\n\n\t\tlet interpolator =\n\t\t{\n\t\t\tupdate: function(dt)\n\t\t\t{\n\t\t\t\tfor (let x in time)\n\t\t\t\t{\n\t\t\t\t\tif (time[x] == duration[x])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\ttime[x] += dt;\n\t\t\t\t\tif (time[x] >= duration[x])\n\t\t\t\t\t{\n\t\t\t\t\t\ttime[x] = duration[x];\n\t\t\t\t\t\tcount--;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet t = easing[x] (time[x] / duration[x]);\n\t\t\t\t\tdata[x] = (1-t)*src[x] + t*dst[x];\n\t\t\t\t}\n\n\t\t\t\tcallback (data, count == 0);\n\n\t\t\t\tif (count == 0)\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t};\n\n\t\tSystem.updateQueueAdd(interpolator);\n\t\tinterpolator.update(0);\n\t},\n\n\t/**\n\t * \tEvent triggered when a keyboard event is detected by the system.\n\t * \tonKeyboardEvent (action: KeyboardEventType, keyCode: number, keyState: object) : void;\n\t */\n\tonKeyboardEvent: function (action, keyCode, keyState)\n\t{\n\t},\n\n\t/**\n\t * \tEvent triggered when a pointer event is detected by the system.\n\t * \tonPointerEvent (action: PointerEventType, pointer: object, pointers: object) : void;\n\t */\n\tonPointerEvent: function (action, pointer, pointers)\n\t{\n\t}\n};\n\n//!/class\n\n//!namespace System\n\n\t//!enum KeyboardEventType\n\tSystem.KeyboardEventType = {\n\t\tKEY_DOWN: 0x001,\n\t\tKEY_UP: 0x002,\n\n\t\t//!KEY_DOWN\n\t\t//!KEY_UP\n\t};\n\t//!/enum\n\n\t//!enum PointerEventType\n\tSystem.PointerEventType = {\n\t\tPOINTER_DOWN: \t\t0x010,\n\t\tPOINTER_UP: \t\t0x011,\n\t\tPOINTER_MOVE: \t\t0x012,\n\t\tPOINTER_DRAG_START:\t0x013,\n\t\tPOINTER_DRAG_MOVE:\t0x014,\n\t\tPOINTER_DRAG_STOP:\t0x015,\n\t\tPOINTER_WHEEL:\t\t0x016,\n\n\t\t//!POINTER_DOWN\n\t\t//!POINTER_UP\n\t\t//!POINTER_MOVE\n\t\t//!POINTER_DRAG_START\n\t\t//!POINTER_DRAG_MOVE\n\t\t//!POINTER_DRAG_STOP\n\t\t//!POINTER_WHEEL\n\t};\n\t//!/enum\n\n//!/namespace\n\nexport default System;\n","/*\n**\tsystem/log.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport System from './system.js';\nimport List from '../utils/list.js';\n\n//![import \"./system\"]\n//![import \"../utils/list\"]\n\n//:/**\n//: * \tLogging module to show logs on the system display buffer.\n//: */\n\n//!namespace Log\n\nconst Log =\n{\n\t/**\n\t * \tIndicates if the log module is enabled.\n\t *\t!let activated: boolean;\n\t */\n\tactivated: false,\n\n\t/**\n\t * \tIndicates if the log module is paused.\n\t * \t!let paused: boolean;\n\t */\n\tpaused: false,\n\n\t/**\n\t * \tMaximum number of entries to show in the screen.\n\t * \t!let maxsize: number;\n\t */\n\tmaxsize: 30,\n\n\tdata: List.Pool.alloc(),\n\tcount: 0,\n\n\n\t/**\n\t * \tIndicates if output showuld also be passed to `console.debug` as secondary echo.\n\t * \t!let debugEcho: boolean;\n\t */\n\tdebugEcho: false,\n\n\t/**\n\t * \tForeground (text) color.\n\t * \t!let color: string;\n\t */\n\tcolor: '#fff',\n\n\t/**\n\t * \tBackground color.\n\t * \t!let background: string;\n\t */\n\tbackground: '#cf266a',\n\n\t/**\n\t * \tDebugging variables to show continuously at the top of the log output.\n\t * \t!let vars: object;\n\t */\n\tvars: { },\n\n\t/**\n\t * \tWrites a message to the log buffer, ensure logging has been enabled by calling `enable` first or any messages will be ignored.\n\t * \t!function write (msg: string) : void;\n\t */\n\twrite: function (msg)\n\t{\n\t\tthis.data.push(msg);\n\t\tthis.count++;\n\n\t\twhile (this.data.length > this.maxsize)\n\t\t\tthis.data.shift();\n\n\t\tif (this.debugEcho)\n\t\t\tconsole.debug(this.count + \": \" + msg);\n\t},\n\n\t/**\n\t * \tClears the current log buffer.\n\t * \t!function clear () : void;\n\t */\n\tclear: function ()\n\t{\n\t\tthis.data.reset();\n\t\tthis.count = 0;\n\t},\n\n\t/**\n\t * \tEnables on-screen logging for cool stuff.\n\t *\n\t * \t@param x - X-coordinate of the top-left corner.\n\t * \t@param y - Y-coordinate of the top-left corner.\n\t * \t@param fontSize - Desired font size in `pt` units.\n\t * \t@param showFps - Set to `true` to show FPS.\n\t * \t@param showIndex - Set to `true to show the message index.\n\t *\n\t * \t!function enable (x?: number, y?: number, fontSize?: number, showFps?: boolean, showIndex?: boolean) : void;\n\t */\n\tenable: function (x=0, y=0, fontSize=9.5, showFps=true, showIndex=true)\n\t{\n\t\tif (this.activated) return;\n\t\tthis.activated = true;\n\n\t\tif (!showFps) y -= 16;\n\t\tlet _y = y;\n\n\t\tSystem.drawQueueAdd ({ draw: function ()\n\t\t{\n\t\t\tif (Log.paused) return;\n\n\t\t\tlet tmp = hrnow();\n\n\t\t\tconst g = System.displayBuffer3;\n\n\t\t\tg.font('bold '+fontSize+'pt Monospace');\n\t\t\tg.textBaseline('top');\n\n\t\t\tlet s = '';\n\n\t\t\ty = _y;\n\n\t\t\tif (showFps !== false && System.perf.fps != 0)\n\t\t\t{\n\t\t\t\ts = 'fps: ' + System.perf.fps + '/' + System.perf.averageFps + ', update: ' + System.perf.averageUpdateTime + ', draw: ' + System.perf.averageDrawTime + ', extra: ' + System.perf.averageExtraTime;\n\n\t\t\t\tif (Log.background) {\n\t\t\t\t\tg.fillStyle(Log.background);\n\t\t\t\t\tg.fillRect (x-3, y-1, g.measureText(s)+6, fontSize+5);\n\t\t\t\t}\n\n\t\t\t\tg.fillStyle(Log.color);\n\t\t\t\tg.fillText(s, x, y);\n\t\t\t}\n\n\t\t\ts = '';\n\n\t\t\tfor (let i in Log.vars)\n\t\t\t\ts += i + ': ' + Log.vars[i] + '  ';\n\n\t\t\tif (s !== '')\n\t\t\t{\n\t\t\t\ty += 24;\n\n\t\t\t\tif (Log.background) {\n\t\t\t\t\tg.fillStyle(Log.background);\n\t\t\t\t\tg.fillRect (x-3, y-1, g.measureText(s)+6, fontSize+5);\n\t\t\t\t}\n\n\t\t\t\tg.fillStyle(Log.color);\n\t\t\t\tg.fillText(s, x, y);\n\t\t\t}\n\n\t\t\tlet i = 0;\n\t\t\tfor (let ii = Log.data.top; ii; ii = ii.next, i++)\n\t\t\t{\n\t\t\t\ts = (showIndex ? \"#\" + (Log.count-Log.data.length+i+1) + \": \" : \"> \") + ii.value;\n\n\t\t\t\tif (Log.background) {\n\t\t\t\t\tg.fillStyle(Log.background);\n\t\t\t\t\tg.fillRect (x-3, y-1+7 + (fontSize+5)*(i+1) - 1, g.measureText(s)+6, fontSize+5);\n\t\t\t\t}\n\n\t\t\t\tg.fillStyle(Log.color);\n\t\t\t\tg.fillText(s, x, y-1+7 + (fontSize+5)*(i+1));\n\t\t\t}\n\n\t\t\ttmp = (hrnow() - tmp);\n\t\t\tSystem.perf.drawTimeTotal -= tmp;\n\t\t\tSystem.perf.extraTimeTotal += tmp;\n\t\t}});\n\t},\n\n\t/**\n\t * \tPauses log rendering.\n\t * \t!function pause () : void;\n\t */\n\tpause: function ()\n\t{\n\t\tthis.paused = true;\n\t\treturn;\n\t},\n\n\t/**\n\t * \tResumes log rendering.\n\t * \t!function resume () : void;\n\t */\n\tresume: function ()\n\t{\n\t\tthis.paused = false;\n\t\treturn;\n\t}\n};\n\nexport default Log;\n","/*\n**\tsystem/globals.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Random from './random.js';\nimport Log from './log.js';\n\n//![import \"./random\"]\n//![import \"./log\"]\n//![import \"../flow/viewport\"]\n\n//:/**\n//: * \tGlobal functions and definitions.\n//: */\n\n//!namespace globals\n\n/*\n**\tVariables and behavior flags, can be extended as needed from other modules.\n*/\nconst globals =\n{\n\t/**\n\t * Renderer's GL context.\n\t * !let gl: WebGL2RenderingContext;\n\t */\n\tgl: null,\n\n\t/**\n\t * Currently active shader program.\n\t * !let shaderProgram: ShaderProgram;\n\t */\n\tshaderProgram: null,\n\n\t/**\n\t * Global system time, updated once per frame. Mirrors the `System.frameTime` property.\n\t * !let time: number;\n\t */\n\ttime: 0,\n\n\t/**\n\t * Active viewport (if any). Set by the `draw` method of the `Scene` class.\n\t * !let viewport: Viewport;\n\t */\n\tviewport: null,\n\n\t/**\n\t * Indicates if the element bounds should be drawn. Used by the `Element` class.\n\t * !let debugBounds: boolean;\n\t */\n\tdebugBounds: false,\n\n\t/**\n\t * Indicates if the mask bounds should be drawn. Used by the `Mask` class.\n\t * !let debugMasks: boolean;\n\t */\n\tdebugMasks: false,\n\n\t/**\n\t * Global random generators. Only `rand0` is used by the global random functions. The `rand1` and `rand2` can be used manually if desired.\n\t *\n\t * !const rand0: Random;\n\t * !const rand1: Random;\n\t * !const rand2: Random;\n\t */\n\trand0: new Random(),\n\trand1: new Random(),\n\trand2: new Random()\n};\n\nexport default globals;\n\n//!/namespace\n\n//!declare global\n\n/**\n * Converts the given pixel-value to actual screen pixels taking into account the current scale.\n * !function px (value: number) : number;\n */\nglobal.px = function(value)\n{\n\treturn value*C.SCALE;\n};\n\n/**\n * Disposes an object by running the first method that is found in the following order: `free`, `dispose` and finally `__dtor`.\n * !function dispose (obj: object) : void;\n */\nglobal.dispose = function (obj)\n{\n\tif (obj === null || typeof(obj) !== 'object')\n\t\treturn;\n\n\tif ('free' in obj)\n\t\treturn obj.free();\n\n\tif ('dispose' in obj)\n\t\treturn obj.dispose();\n\n\tif ('__dtor' in obj)\n\t\tobj.__dtor();\n};\n\n/**\n * Global audio context obtained when the system is initialized.\n * !let audioContext: AudioContext;\n */\nif ('AudioContext' in global)\n{\n\tglobal.audioContext = new AudioContext({ latencyHint: 'interactive', sampleRate: 44100 });\n\tLog.write('AudioContext: baseLatency=' + ~~(global.audioContext.baseLatency*1000) + ' ms' );\n}\nelse\n\tglobal.audioContext = null;\n\n/**\n * Similar to `fetch` but uses XMLHttpRequest because in some mobile browsers regular mode does not work well with ArrayBuffers.\n * !function fetchd (url: string, options?: object) : Promise<object>;\n */\nglobal.fetchd = function (url, options)\n{\n\treturn new Promise ((resolve, reject) =>\n\t{\n\t\tif (!options) options = { };\n\t\tif (!('responseType' in options)) options.responseType = 'arraybuffer';\n\n\t\tvar request = new XMLHttpRequest();\n\t\trequest.open('GET', url, true);\n\n\t\tfor (let i in options) request[i] = options[i];\n\n\t\trequest.onload = function() {\n\t\t\tresolve (request.response);\n\t\t};\n\n\t\trequest.onerror = function() {\n\t\t\treject ('Unable to fetch specified resource.');\n\t\t};\n\n\t\trequest.send();\n\t});\n};\n\n/**\n * Loads an arraybuffer from the specified URL and converts it to a AudioBuffer using the global audioContext.\n * !function fetchAudioBuffer (url: string) : Promise<AudioBuffer>;\n */\nglobal.fetchAudioBuffer = function (url)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tif (!global.audioContext)\n\t\t{\n\t\t\treject ('AudioContext is not available.');\n\t\t\treturn;\n\t\t}\n\n\t\tfetchd(url)\n\t\t.then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))\n\t\t.then(audioBuffer => resolve(audioBuffer))\n\t\t.catch(err => reject(err));\n\t});\n};\n\n\n/**\n * Returns the value as an integer.\n * !function int (value: number|string) : number;\n */\nglobal.int = function (value)\n{\n\treturn value >> 0;\n};\n\n/**\n * Returns the value as a boolean.\n * !function bool (value: number|string|boolean) : number;\n */\nglobal.bool = function (value)\n{\n\tif (value === true || value === false)\n\t\treturn value;\n\n\tif (value == 'true')\n\t\treturn true;\n\n\tif (value == 'false')\n\t\treturn false;\n\n\treturn !(!value);\n};\n\n/**\n * Returns the value as a floating point number.\n * !function float (value: number|string) : number;\n */\nglobal.float = function (value)\n{\n\treturn parseFloat(value);\n};\n\n/**\n * Returns the value truncated to 2 digits of precision.\n * !function float2 (value: number) : number;\n */\nglobal.float2 = function (value)\n{\n\treturn (int(value*100))/100;\n};\n\n/**\n * Returns the value truncated to 3 digits of precision.\n * !function float3 (value: number) : number;\n */\nglobal.float3 = function (value)\n{\n\treturn (int(value*1000))/1000;\n};\n\n/**\n * Returns the value truncated to 4 digits of precision.\n * !function float4 (value: number) : number;\n */\nglobal.float4 = function (value)\n{\n\treturn (int(value*10000))/10000;\n};\n\n/**\n * Converts the given value to radians.\n * !function rad (value: number) : number;\n */\nglobal.rad = function (value)\n{\n\treturn value*Math.PI / 180;\n};\n\n/**\n * Converts the given value to degrees.\n * !function deg (value: number) : number;\n */\nglobal.deg = function (value)\n{\n\treturn (value/Math.PI)*180;\n};\n\n/**\n * Returns a random integer value from 0 to 0xFFFF (inclusive).\n * !function rand() : number;\n */\nglobal.rand = function ()\n{\n\treturn globals.rand0.nextInt16();\n};\n\n/**\n * Returns a random float from 0 to 1 (inclusive).\n * !function randf() : number;\n */\nglobal.randf = function ()\n{\n\treturn globals.rand0.nextFloat();\n};\n\n/**\n * Returns a random float within the given (inclusive) range.\n * !function randrf (startValue: number, endValue: number) : number;\n */\nglobal.randrf = function (a, b)\n{\n\tlet t = globals.rand0.nextFloat();\n\treturn t*b + (1-t)*a;\n};\n\n/**\n * Returns a random integer within the given range (inclusive).\n * !function randr (startValue: number, endValue: number) : number;\n */\nglobal.randr = function (a, b)\n{\n\tlet t = globals.rand0.nextFloat();\n\treturn Math.round(t*b + (1-t)*a);\n};\n\n/**\n * Returns a table (array) of N random float numbers within the given range (inclusive).\n * !function randtf (startValue: number, endValue: number, n: number) : Array<number>;\n */\nglobal.randtf = function (a, b, n)\n{\n\tvar list = [ ];\n\n\tfor (var i = 0; i < n; i++)\n\t\tlist.push(randrf(a, b));\n\n\treturn list;\n};\n\n/**\n * Returns the high-resolution `now` counter in milliseconds (includes possibly microseconds in fractional part).\n * !function hrnow () : number;\n */\nglobal.hrnow = function ()\n{\n\treturn performance.now();\n};\n\n/**\n * Returns a function that when called produces a random integer value within the given (inclusive) range.\n * !function randvar (startValue: number, endValue: number) : () => number;\n */\nglobal.randvar = function (a, b)\n{\n\treturn function() { return randr(a, b); };\n};\n\n/**\n * Returns a function that when called returns an item from the specified array at some random index within the (inclusive) range.\n * !function randitem (arr: Array<any>, startValue?: number, endValue?: number) : () => any;\n */\nglobal.randitem = function (arr, a=null, b=null)\n{\n\tif (a === null) a = 0;\n\tif (b === null) b = arr.length - 1;\n\n\treturn function() { return arr[randr(a, b)]; };\n};\n\n/**\n * Returns the parameter 't' where two line segments intersect.\n * !function getLineSegmentIntersection (ls1_x1: number, ls1_y1: number, ls1_x2: number, ls1_y2: number, ls2_x1: number, ls2_y1: number, ls2_x2: number, ls2_y2: number) : number;\n */\nglobal.getLineSegmentIntersection = function (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2)\n{\n\t// Case #1: Identical segments.\n\tif (ls1_x1 == ls2_x1 && ls1_y1 == ls2_y1 && ls1_x2 == ls2_x2 && ls1_y2 == ls2_y2)\n\t\treturn 0;\n\n\tlet inf = 2.0;\n\n\tvar dyA = ls1_y2 - ls1_y1;\n\tvar dxA = ls1_x2 - ls1_x1;\n\tvar dyB = ls2_y2 - ls2_y1;\n\tvar dxB = ls2_x2 - ls2_x1;\n\n\t// Case #2: Horizontal vs. Horizontal\n\tif (dyA == 0 && dyB == 0)\n\t{\n\t\tif (ls1_y1 != ls2_y1) return inf;\n\n\t\tvar x1 = Math.max(ls1_x1, ls2_x1);\n\t\tvar x2 = Math.min(ls1_x2, ls2_x2);\n\n\t\tif (x1 > x2) return inf;\n\n\t\treturn (x1 - ls1_x1) / dxA;\n\t}\n\n\t// Case #3: Vertical vs. Vertical\n\tif (dxA == 0 && dxB == 0)\n\t{\n\t\tif (ls1_x1 != ls2_x1) return inf;\n\n\t\tvar y1 = Math.max(ls1_y1, ls2_y1);\n\t\tvar y2 = Math.min(ls1_y2, ls2_y2);\n\n\t\tif (y1 > y2) return inf;\n\n\t\treturn (y1 - ls1_y1) / dyA;\n\t}\n\n\t// Case #4: Vertical vs. Horizontal or Sloped\n\tif (dxA == 0)\n\t{\n\t\tvar tA = (dyB*(ls1_x1 - ls2_x1) + dxB*(ls2_y1 - ls1_y1)) / (dxB * dyA);\n\t\tif (0 > tA || tA > 1) return inf;\n\n\t\tvar tB = (ls1_x1 - ls2_x1) / dxB; \n\t\tif (0 > tB || tB > 1) return inf;\n\n\t\treturn tA;\n\t}\n\n\t// Case #5: Regular line segments.\n\tvar a = dyA*(ls2_x1 - ls1_x1) + dxA*(ls1_y1 - ls2_y1);\n\tvar b = dyB*dxA - dxB*dyA;\n\n\tif (b == 0) return inf;\n\n\tvar tB = a / b;\n\tif (0 > tB || tB > 1) return inf;\n\n\tvar tA = (dxB*tB + ls2_x1 - ls1_x1) / dxA;\n\tif (0 > tA || tA > 1) return inf;\n\n\treturn tA;\n};\n\n/**\n * Returns boolean indicating if the line segments intersect.\n * !function lineSegmentIntersects (ls1_x1: number, ls1_y1: number, ls1_x2: number, ls1_y2: number, ls2_x1: number, ls2_y1: number, ls2_x2: number, ls2_y2: number) : boolean;\n */\nglobal.lineSegmentIntersects = function (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2)\n{\n\tlet t = getLineSegmentIntersection (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2);\n\treturn t >= 0 && t <= 1.0;\n};\n\n/**\n * Rotates a point (2d) by the given angle and returns an object having x and y properties.\n * !function rotatePoint (angle: number, x: number, y: number) : { x: number, y: number };\n */\nglobal.rotatePoint = function (angle, x, y)\n{\n\treturn { x: x*Math.cos(angle) + y*Math.sin(angle), y: y*Math.cos(angle) - x*Math.sin(angle) };\n};\n\n/**\n * Returns a value snapped to a step within the given range.\n * !function stepValue (value: number, minValue: number, maxValue: number, numSteps: number) : number;\n */\nglobal.stepValue = function (value, minValue, maxValue, numSteps)\n{\n\treturn ((Math.round(numSteps * (value - minValue) / (maxValue - minValue))) / numSteps) * (maxValue - minValue) + minValue;\n};\n\n/**\n * Returns a value that is a factor of the specified step.\n * !function alignValue (value: number, step: number) : number;\n */\nglobal.alignValue = function (value, step)\n{\n\treturn Math.round(value/step)*step;\n};\n\n/**\n * Number of bits for fixed-point number (default is 8).\n * !let FIXED_POINT_BITS : number;\n*/\nglobal.FIXED_POINT_BITS = 8;\n\n/**\n * Returns a fixed-point upscaled value.\n * !function upscale (value: number) : number;\n */\nglobal.upscale = function (value)\n{\n\treturn (value * (1 << FIXED_POINT_BITS)) >> 0;\n};\n\n/**\n * Downscales a fixed-point value to its integer part.\n * !function downscale (value: number) : number;\n */\nglobal.downscale = function (value)\n{\n\treturn value >> FIXED_POINT_BITS;\n};\n\n/**\n * Downscales a fixed-point value to floating point.\n * !function downscalef (value: number) : number;\n */\nglobal.downscalef = function (value)\n{\n\treturn value / (1 << FIXED_POINT_BITS);\n};\n\n/**\n * Aligns a value to its fixed point floating point representation such that downscaling results in an integer.\n * !function falign (value: number) : number;\n */\nglobal.falign = function (value)\n{\n\treturn downscalef(upscale(value));\n};\n\n/**\n * Returns the value having the minimum absolute value.\n * !function absmin (a: number, b: number) : number;\n */\nglobal.absmin = function(a, b)\n{\n\treturn Math.abs(a) < Math.abs(b) ? a : b;\n};\n\n/**\n * Returns the value having the maximum absolute value.\n * !function absmax (a: number, b: number) : number;\n */\nglobal.absmax = function(a, b)\n{\n\treturn Math.abs(a) > Math.abs(b) ? a : b;\n};\n\n/**\n * Repeats a string a number of times.\n * !function repeat (str: string, count: number) : string;\n */\nglobal.repeat = function (str, count)\n{\n\tlet out = '';\n\n\twhile (count-- > 0)\n\t\tout += str;\n\n\treturn out;\n};\n\n/**\n * Pads the given value with a character (added to the left) until the specified size is reached.\n * !function lpad (val: any, size: number, char?: string) : string;\n */\nglobal.lpad = function (val, size, char='0')\n{\n\tval = val.toString();\n\treturn repeat(char.charAt(0), size-val.length) + val;\n};\n\n/**\n * Pads the given value with a character (added to the right) until the specified size is reached.\n * !function rpad (val: any, size: number, char?: string) : string;\n */\nglobal.rpad = function (val, size, char='0')\n{\n\tval = val.toString();\n\treturn val + repeat(char.charAt(0), size-val.length);\n};\n","/*\n**\tsystem/perf.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n//!class Perf\n\n/**\n * \tInitializes the performance monitoring instance.\n *\n * \t@param accumSize - Maximum amount of samples to accumulate.\n * \t@param expectedValue - Expected value (average) of resulting samples.\n * \n * \t!constructor (accumSize: number, expectedValue?: number);\n */\nconst Perf = function (accumSize, expectedValue=null)\n{\n\tthis.data = [ ];\n\tthis.accumSize = accumSize;\n\n\tthis.expectedValue = expectedValue;\n\n\tthis.lastFeed = 0;\n\tthis.lastUpdate = 0;\n\n\tthis.stdSum = 0;\n\tthis.stdCount = 0;\n};\n\nexport default Perf;\n\n/**\n * \tMarks the start time of a performance test.\n * \t!begin() : void;\n */\nPerf.prototype.begin = function () {\n\tthis.startTime = performance.now();\n};\n\n/**\n * \tMarks the end time of the performance test, the elapsed time is fed into the monitor.\n * \t!end() : void;\n */\nPerf.prototype.end = function () {\n\tthis.feed (performance.now() - this.startTime);\n};\n\n/**\n * \tFeeds a value into the monitor, auto-generates a report using `console.log` when the number of samples reaches the `accumSize` specified in the constructor.\n * \t!feed (value: number) : void;\n */\nPerf.prototype.feed = function (value)\n{\n\tthis.data.push(value);\n\tthis.lastFeed++;\n\n\tif (this.data.length != this.accumSize)\n\t\treturn;\n\n\tthis.report();\n\tthis.data = [ ];\n};\n\n/**\n * \tUpdates the `min`, `max`, `avg` `std`, `stdSum` and `stdCount` fields of the object.\n * \t!update () : void;\n */\nPerf.prototype.update = function ()\n{\n\tlet min = null;\n\tlet max = null;\n\tlet avg = 0;\n\tlet std = 0;\n\n\tfor (let i = 0; i < this.data.length; i++)\n\t{\n\t\tmin = min === null ? this.data[i] : Math.min(min, this.data[i]);\n\t\tmax = max === null ? this.data[i] : Math.max(max, this.data[i]);\n\t\tavg += this.data[i];\n\t}\n\n\tavg /= this.data.length;\n\n\tlet e = this.expectedValue !== null ? this.expectedValue : avg;\n\n\tfor (let i = 0; i < this.data.length; i++) std += Math.pow(this.data[i] - e, 2);\n\n\tstd = Math.sqrt(std / this.data.length);\n\n\tthis.stdSum += std;\n\tthis.stdCount++;\n\n\tthis.min = min;\n\tthis.max = max;\n\tthis.avg = avg;\n\tthis.std = std;\n\n\tthis.lastUpdate = this.lastFeed;\n\treturn this;\n};\n\n/**\n * \tReturns a report string with the values selected by the specified flags.\n * \t!report (flags: Perf.Flags) : string;\n */\nPerf.prototype.report = function (flags=255)\n{\n\tlet out = '';\n\n\tif (this.lastUpdate != this.lastFeed)\n\t\tthis.update();\n\n\tif (flags & Perf.Flags.SAMPLES) out += 'n: ' + this.stdCount;\n\tif (flags & Perf.Flags.MIN) out += (out != '' ? ', ' : '') + 'min: ' + this.min;\n\tif (flags & Perf.Flags.MAX) out += (out != '' ? ', ' : '') + 'max: ' + this.max;\n\tif (flags & Perf.Flags.AVG) out += (out != '' ? ', ' : '') + 'avg: ' + this.avg.toFixed(2);\n\tif (flags & Perf.Flags.EXPECTED) out += (out != '' ? ', ' : '') + (this.expectedValue !== undefined ? 'e: ' + this.expectedValue : '');\n\tif (flags & Perf.Flags.STDDEV) out += (out != '' ? ', ' : '') + 'stddev: ' + this.std.toFixed(2);\n\tif (flags & Perf.Flags.AVG_STDDEV) out += (out != '' ? ', ' : '') + 'avg_stddev: ' + (this.stdSum / this.stdCount).toFixed(2)\n\n\treturn out;\n};\n\n//!/class\n\n//!namespace Perf\n//!enum Flags\n\nPerf.Flags = {\n\tSAMPLES: 1,\n\t//!SAMPLES\n\tMIN: 2,\n\t//!MIN\n\tMAX: 4,\n\t//!MAX\n\tAVG: 8,\n\t//!AVG\n\tEXPECTED: 16,\n\t//!EXPECTED\n\tSTDDEV: 32,\n\t//!STDDEV\n\tAVG_STDDEV: 64,\n\t//!AVG_STDDEV\n\tALL: 255,\n\t//!ALL\n};\n\n//!/enum\n","/*\n**\tsystem/framebuffer.js\n**\n**\tCopyright (c) 2021-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport globals from './globals.js';\nimport System from './system.js';\n\n//![import \"./globals\"]\n//![import \"./system\"]\n\n/*\n *\tDescribes a GL framebuffer.\n */\n\nconst Framebuffer = Class.extend\n({\n\t/**\n\t *\tShader GL identifier.\n\t */\n\tframebufferId: null,\n\n\t/**\n\t *\tAttachments of the framebuffer.\n\t */\n\tattachments: null,\n\n\t/**\n\t *\tType of each attachment.\n\t */\n\tattachmentTypes: null,\n\n\t/**\n\t *\tWidth of the framebuffer.\n\t */\n\twidth: 0,\n\n\t/**\n\t *\tHeight of the framebuffer.\n\t */\n\theight: 0,\n\n\t/**\n\t *\tEnabled draw buffers.\n\t */\n\tdrawBuffers: null,\n\tdrawBufferIds: null,\n\n\t/**\n\t *\tConstructs a GL framebuffer.\n\t *\n\t * \t@param {number} width\n\t * \t@param {number} height\n\t */\n\t__ctor: function (width=null, height=null)\n\t{\n\t\tif (globals.gl === null)\n\t\t\treturn;\n\n\t\tif (attachmentPointIds[0] === null)\n\t\t\tinitAttachmentPointIds(globals.gl);\n\n\t\tthis.framebufferId = globals.gl.createFramebuffer();\n\n\t\tthis.drawBuffers = [];\n\t\tthis.drawBufferIds = [];\n\n\t\t//violet:hardware scaling\n\t\t//this.width = width || System.screenWidth;\n\t\t//this.height = height || System.screenHeight;\n\n\t\tthis.width = width || System.renderer.width;\n\t\tthis.height = height || System.renderer.height;\n\n\t   \tthis.attachments = new Array(Framebuffer.MAX_ATTACHMENT_POINTS).fill(null);\n\t   \tthis.attachmentTypes = new Array(Framebuffer.MAX_ATTACHMENT_POINTS).fill(null);\n\t},\n\n\t/**\n\t * \tDestroys the framebuffer and all attached textures.\n\t */\n\t__dtor: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return;\n\n\t\tfor (let i = 0; i < this.attachments.length; i++)\n\t\t{\n\t\t\tif (this.attachments[i] !== null)\n\t\t\t{\n\t\t\t\tif (this.attachmentTypes[i] === Framebuffer.TEXTURE)\n\t\t\t\t\tgl.deleteTexture(this.attachments[i]);\n\t\t\t\telse\n\t\t\t\t\tgl.deleteRenderbuffer(this.attachments[i]);\n\t\t\t}\n\t\t}\n\n\t\tgl.deleteFramebuffer(this.frameBufferId);\n\t},\n\n\t/**\n\t * \tAttaches a texture to a framebuffer attachment point.\n\t *\n\t * \t@param {number} attachmentPoint\n\t * \t@param {any} texture\n\t * \t@param {number} type\n\t */\n\tattach: function (attachmentPoint, texture, type=null)\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return;\n\n\t\tif (type === null)\n\t\t\ttype = attachmentPoint < Framebuffer.DEPTH ? Framebuffer.TEXTURE : Framebuffer.RENDERBUFFER;\n\n\t\tthis.attachments[attachmentPoint] = texture;\n\t\tthis.attachmentTypes[attachmentPoint] = type;\n\n\t\tif (attachmentPoint < Framebuffer.DEPTH && this.drawBuffers.indexOf(attachmentPoint) === -1)\n\t\t{\n\t\t\tthis.drawBuffers.push(attachmentPoint);\n\t\t\tthis.drawBufferIds.push(attachmentPointIds[attachmentPoint]);\n\t\t}\n\n\t\tlet prev = gl.getParameter(gl.FRAMEBUFFER_BINDING);\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, this.framebufferId);\n\n\t\tswitch (type)\n\t\t{\n\t\t\tcase Framebuffer.TEXTURE:\n\t\t\t\tgl.framebufferTexture2D (gl.FRAMEBUFFER, attachmentPointIds[attachmentPoint], gl.TEXTURE_2D, texture, 0);\n\t\t\t\tbreak;\n\n\t\t\tcase Framebuffer.RENDERBUFFER:\n\t\t\t\tgl.framebufferRenderbuffer (gl.FRAMEBUFFER, attachmentPointIds[attachmentPoint], gl.RENDERBUFFER, texture);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, prev);\n\t},\n\n\t/**\n\t * \tCreates a new color buffer texture.\n\t *\n\t * \t@param {number} width\n\t * \t@param {number} height\n\t * \t@returns {GLTexture}\n\t */\n\tcreateColorBuffer: function (attachmentPoint, width=null, height=null)\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return null;\n\n\t\tif (width === null) width = this.width;\n\t\tif (height === null) height = this.height;\n\n\t\tlet tex = gl.createTexture();\n\t\tgl.bindTexture (gl.TEXTURE_2D, tex);\n\n\t\tgl.texStorage2D (gl.TEXTURE_2D, 1, gl.RGBA8, width, height);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n\t\tthis.attach(attachmentPoint, tex);\n\t\treturn tex;\n\t},\n\n\t/**\n\t * \tCreates a new depth buffer texture.\n\t *\n\t * \t@param {number} width\n\t * \t@param {number} height\n\t * \t@returns {GLTexture}\n\t */\n\tcreateDepthBuffer: function (width=null, height=null)\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return null;\n\n\t\tif (width === null) width = this.width;\n\t\tif (height === null) height = this.height;\n\n\t\tlet tex = gl.createRenderbuffer();\n\t\tgl.bindRenderbuffer (gl.RENDERBUFFER, tex);\n\t\tgl.renderbufferStorage (gl.RENDERBUFFER, gl.DEPTH_COMPONENT24, width, height);\n\n\t\tthis.attach(Framebuffer.DEPTH, tex);\n\t\treturn tex;\n\t},\n\n\t/**\n\t * \tCreates a new stencil buffer texture.\n\t *\n\t * \t@param {number} width\n\t * \t@param {number} height\n\t * \t@returns {GLTexture}\n\t */\n\tcreateStencilBuffer: function (width=null, height=null)\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return null;\n\n\t\tif (width === null) width = this.width;\n\t\tif (height === null) height = this.height;\n\n\t\tlet tex = gl.createTexture();\n\t\tgl.bindTexture (gl.TEXTURE_2D, tex);\n\n\t\tgl.texStorage2D (gl.TEXTURE_2D, 1, gl.DEPTH_STENCIL, width, height);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n\t\tthis.attach(Framebuffer.DEPTH_STENCIL, tex);\n\t\treturn tex;\n\t},\n\n\t/**\n\t * \tReturns a texture from the specified attachment point.\n\t * \t@param {number} attachmentPoint \n\t */\n\tgetTexture: function (attachmentPoint)\n\t{\n\t\tif (this.attachmentTypes[attachmentPoint] !== Framebuffer.TEXTURE)\n\t\t\treturn null;\n\n\t\treturn this.attachments[attachmentPoint];\n\t},\n\n\t/**\n\t * \tReturns a renderbuffer from the specified attachment point.\n\t * \t@param {number} attachmentPoint \n\t */\n\tgetRenderBuffer: function (attachmentPoint)\n\t{\n\t\tif (this.attachmentTypes[attachmentPoint] !== Framebuffer.RENDERBUFFER)\n\t\t\treturn null;\n\n\t\treturn this.attachments[attachmentPoint];\n\t},\n\n\t/**\n\t *\tBinds the framebuffer for further operations.\n\t */\n\tbind: function()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return;\n\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, this.framebufferId);\n\n\t\tgl.drawBuffers (this.drawBufferIds);\n\t\tgl.viewport (0, 0, this.width, this.height);\n\t},\n\n\t/**\n\t *\tBinds the default framebuffer.\n\t */\n\tunbind: function()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return;\n\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, null);\n\n\t\tgl.drawBuffers (defaultDrawBuffers);\n\t\tgl.viewport (0, 0, System.renderer.width, System.renderer.height);\n\t},\n\n\t/**\n\t *\tReturns the status of the framebuffer. Returns true if the framebuffer is complete.\n\t */\n\tisComplete: function()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return true;\n\n\t\tlet prev = gl.getParameter(gl.FRAMEBUFFER_BINDING);\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, this.framebufferId);\n\t\tlet result = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, prev);\n\n\t\treturn result === gl.FRAMEBUFFER_COMPLETE;\n\t}\n\n});\n\n/**\n *\tTypes of attachment objects.\n */\nFramebuffer.TEXTURE = 1;\nFramebuffer.RENDERBUFFER = 2;\n\n/**\n *\tAvailable attachment points.\n */\nFramebuffer.COLOR0\t\t\t= 0;\nFramebuffer.COLOR1\t\t\t= 1;\nFramebuffer.COLOR2\t\t\t= 2;\nFramebuffer.COLOR3\t\t\t= 3;\nFramebuffer.COLOR4\t\t\t= 4;\nFramebuffer.COLOR5\t\t\t= 5;\nFramebuffer.COLOR6\t\t\t= 6;\nFramebuffer.COLOR7\t\t\t= 7;\nFramebuffer.DEPTH \t\t\t= 8;\nFramebuffer.STENCIL \t\t= 9;\nFramebuffer.DEPTH_STENCIL\t= 10;\n\nFramebuffer.MAX_ATTACHMENT_POINTS = 11;\n\n/**\n *\tGL framebuffer attachment point IDs.\n */\nconst attachmentPointIds = new Array(Framebuffer.MAX_ATTACHMENT_POINTS).fill(null);\nconst defaultDrawBuffers = new Array(1).fill(null);\n\n/**\n * \tInitializes the attachment point IDs.\n */\nconst initAttachmentPointIds = function (gl)\n{\n\tdefaultDrawBuffers[0] = gl.BACK;\n\n\tattachmentPointIds[Framebuffer.COLOR0] = gl.COLOR_ATTACHMENT0;\n\tattachmentPointIds[Framebuffer.COLOR1] = gl.COLOR_ATTACHMENT1;\n\tattachmentPointIds[Framebuffer.COLOR2] = gl.COLOR_ATTACHMENT2;\n\tattachmentPointIds[Framebuffer.COLOR3] = gl.COLOR_ATTACHMENT3;\n\tattachmentPointIds[Framebuffer.COLOR4] = gl.COLOR_ATTACHMENT4;\n\tattachmentPointIds[Framebuffer.COLOR5] = gl.COLOR_ATTACHMENT5;\n\tattachmentPointIds[Framebuffer.COLOR6] = gl.COLOR_ATTACHMENT6;\n\tattachmentPointIds[Framebuffer.COLOR7] = gl.COLOR_ATTACHMENT7;\n\tattachmentPointIds[Framebuffer.DEPTH] = gl.DEPTH_ATTACHMENT;\n\tattachmentPointIds[Framebuffer.STENCIL] = gl.STENCIL_ATTACHMENT;\n\tattachmentPointIds[Framebuffer.DEPTH_STENCIL] = gl.DEPTH_STENCIL_ATTACHMENT;\n};\n\nexport default Framebuffer;\n","/*\n**\tflow/drawable.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rinn, Class } from 'rinn';\n\n//:/**\n//: * \tDescribes an object that can be drawn to a Canvas.\n//: */\n\n//!class Drawable\n\nconst Drawable = Class.extend\n({\n\tclassName: 'Drawable',\n\n\t/**\n\t * Image resource.\n\t * @protected\n\t * !readonly resource: HTMLImageElement|Canvas;\n\t */\n\tresource: null,\n\n\t/**\n\t * Logical width of the drawable.\n\t * @protected\n\t * !readonly width: number;\n\t */\n\twidth: 0,\n\n\t/**\n\t * Logical height of the drawable.\n\t * @protected\n\t * !readonly height: number;\n\t */\n\theight: 0,\n\n\t/**\n\t * Frame source X-offset in physical units.\n\t * @protected\n\t * !readonly sx: number;\n\t */\n\tsx: 0,\n\n\t/**\n\t * Frame source Y-position in physical units.\n\t * @protected\n\t * !readonly sy: number;\n\t */\n\tsy: 0,\n\n\t/**\n\t * Frame source width in physical units.\n\t * @protected\n\t * !readonly swidth: number;\n\t */\n\tswidth: 0,\n\n\t/**\n\t * Frame source height in physical units.\n\t * @protected\n\t * !readonly sheight: number;\n\t */\n\tsheight: 0,\n\n\t/**\n\t * Initializes the instance.\n\t * !constructor();\n\t */\n\t__ctor: function (resource=null, width=null, height=null)\n\t{\n\t\tif (Rinn.isInstanceOf(resource, Drawable))\n\t\t{\n\t\t\tlet drawable = resource;\n\n\t\t\tthis.resource = drawable.resource;\n\t\t\tthis.width = width ?? drawable.width;\n\t\t\tthis.height = height ?? drawable.height;\n\n\t\t\tthis.sx = drawable.sx;\n\t\t\tthis.sy = drawable.sy;\n\t\t\tthis.swidth = drawable.swidth;\n\t\t\tthis.sheight = drawable.sheight;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.resource = resource;\n\n\t\t\tthis.sx = 0;\n\t\t\tthis.sy = 0;\n\n\t\t\tif (this.resource)\n\t\t\t{\n\t\t\t\tthis.width = width ?? resource.targetWidth;\n\t\t\t\tthis.height = height ?? resource.targetHeight;\n\n\t\t\t\tthis.swidth = resource.width;\n\t\t\t\tthis.sheight = resource.height;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.width = width;\n\t\t\t\tthis.height = height;\n\n\t\t\t\tthis.swidth = width;\n\t\t\t\tthis.sheight = height;\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Returns the actual independent drawable object.\n\t * !getDrawable(): Drawable;\n\t */\n\tgetDrawable: function()\n\t{\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the underlying Image object, can be used directly with Canvas.drawImage.\n\t * !getImage(): HTMLImageElement|Canvas;\n\t */\n\tgetImage: function()\n\t{\n\t\treturn this.resource;\n\t},\n\n\t/**\n\t * Draws the drawable on the canvas.\n\t * !draw (g: Canvas, x: number, y: number, width?: number|null, height?: number|null) : void;\n\t */\n\tdraw: function (g, x, y, width=null, height=null)\n\t{\n\t\twidth = width ?? this.width;\n\t\theight = height ?? this.height;\n\n\t\tthis.drawf(g, this.sx, this.sy, this.swidth, this.sheight, x, y, width, height);\n\t},\n\n\t/**\n\t * Draws a section of the drawable on the canvas using full parameters.\n\t * !drawf (g: Canvas, sx:number, sy:number, swidth:number, sheight:number, tx:number, ty:number, twidth:number, theight:number, fwidth?:number|null, fheight?:number|null) : void;\n\t */\n\tdrawf: function (g, sx, sy, swidth, sheight, tx, ty, twidth, theight, fwidth=null, fheight=null)\n\t{\n\t\tg.drawImage (this.resource,\n\t\t\tsx, sy, swidth, sheight,\n\t\t\ttx, ty, twidth, theight,\n\t\t\tnull, null, fwidth ?? twidth, fheight ?? theight);\n\t},\n\n\t/**\n\t * Renders the drawable for the specified element.\n\t * !render (g: Canvas, elem: Element) : void;\n\t */\n\trender: function (g, elem)\n\t{\n\t\tthis.draw (g, elem.bounds.x1, elem.bounds.y1, elem.bounds.width(), elem.bounds.height());\n\t}\n});\n\n\n/**\n * Nine-Slice Drawable.\n */\nconst NineSlice = Drawable.extend\n({\n\tclassName: 'DrawableNineSlice',\n\n\tss: null,\n\tstartingIndex: 0,\n\n\t__ctor: function (spritesheet, startingIndex)\n\t{\n\t\tthis._super.Drawable.__ctor(spritesheet);\n\n\t\tif (spritesheet === null || !Class.instanceOf(spritesheet, 'Spritesheet'))\n\t\t\tthrow new Error('NineSlice: spritesheet required');\n\n\t\tthis.ss = spritesheet;\n\t\tthis.startingIndex = startingIndex;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.ss);\n\t},\n\n\tgetImage: function()\n\t{\n\t\treturn this.ss.getImage();\n\t},\n\n\tdraw: function (g, x, y, width, height)\n\t{\n\t\tconst k = this.startingIndex;\n\n\t\tlet leftWidth = this.ss.getFrame(k+0).width;\n\t\tlet rightWidth = this.ss.getFrame(k+2).width;\n\t\tlet midWidth = this.ss.getFrame(k+1).width;\n\n\t\tlet topHeight = this.ss.getFrame(k+0).height;\n\t\tlet bottomHeight = this.ss.getFrame(k+6).height;\n\t\tlet midHeight = this.ss.getFrame(k+3).height;\n\n\t\tlet n = int((width - leftWidth - rightWidth) / midWidth);\n\t\tlet m = int((height - topHeight - bottomHeight) / midHeight);\n\n\t\tlet x1 = x;\n\t\tlet y1 = y;\n\n\t\t// Corners\n\t\tthis.ss.getFrame(k+0).draw(g, x1, y1);\n\t\tthis.ss.getFrame(k+2).draw(g, x1 + leftWidth + n*midWidth, y1);\n\t\tthis.ss.getFrame(k+6).draw(g, x1, y1 + topHeight + m*midHeight);\n\t\tthis.ss.getFrame(k+8).draw(g, x1 + leftWidth + n*midWidth, y1 + topHeight + m*midHeight);\n\n\t\t// Top/Bottom\n\t\tfor (let i = 0; i < n; i++) {\n\t\t\tthis.ss.getFrame(k+1).draw(g, x1 + leftWidth + i*midWidth, y1);\n\t\t\tthis.ss.getFrame(k+7).draw(g, x1 + leftWidth + i*midWidth, y1 + topHeight + m*midHeight);\n\t\t}\n\n\t\t// Left/Right\n\t\tfor (let i = 0; i < m; i++) {\n\t\t\tthis.ss.getFrame(k+3).draw(g, x1, y1 + topHeight + i*midHeight);\n\t\t\tthis.ss.getFrame(k+5).draw(g, x1 + leftWidth + n*midWidth, y1 + topHeight + i*midHeight);\n\t\t}\n\n\t\t// Center\n\t\tfor (let j = 0; j < m; j++)\n\t\tfor (let i = 0; i < n; i++) {\n\t\t\tthis.ss.getFrame(k+4).draw(g, x1 + leftWidth + i*midWidth, y1 + topHeight + j*midHeight);\n\t\t}\n\t}\n});\n\nRecycler.createPool(NineSlice, 512);\n\n\n/**\n * Repeated drawable.\n */\nconst Repeated = Drawable.extend\n({\n\tclassName: 'DrawableRepeated',\n\n\tdrawable: null,\n\n\t__ctor: function (drawable)\n\t{\n\t\tthis._super.Drawable.__ctor(drawable);\n\t\tthis.drawable = drawable;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.drawable);\n\t},\n\n\tdrawf: function (g, sx, sy, swidth, sheight, tx, ty, twidth, theight, fwidth=null, fheight=null)\n\t{\n\t\tthis.drawable.drawf(g, sx, sy, swidth, sheight, tx, ty, twidth, theight, this.width, this.height);\n\t}\n});\n\nRecycler.createPool(Repeated, 512);\n\n\n/**\n * Clipped drawable.\n */\nconst Clipped = Drawable.extend\n({\n\tclassName: 'DrawableClipped',\n\n\tdrawable: null,\n\n\t__ctor: function (drawable)\n\t{\n\t\tthis._super.Drawable.__ctor(drawable);\n\t\tthis.drawable = drawable;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.drawable);\n\t},\n\n\tdraw: function (g, x, y, width=null, height=null)\n\t{\n\t\tlet img = this.getImage();\n\t\n\t\twidth = width ?? this.width;\n\t\theight = height ?? this.height;\n\n\t\tthis.drawable.drawf (g,\n\t\t\tthis.drawable.sx, this.drawable.sy, width*img.rscale, height*img.rscale,\n\t\t\tx, y, width, height);\n\t}\n});\n\nRecycler.createPool(Clipped, 512);\n\n\n/**\n * Centered drawable.\n */\nconst Centered = Drawable.extend\n({\n\tclassName: 'DrawableCentered',\n\n\tdrawable: null,\n\toffsX: 0,\n\toffsY: 0,\n\n\t__ctor: function (drawable, offsX, offsY)\n\t{\n\t\tthis._super.Drawable.__ctor(drawable);\n\n\t\tthis.drawable = drawable;\n\t\tthis.offsX = offsX;\n\t\tthis.offsY = offsY;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.drawable);\n\t},\n\n\tdraw: function (g, x, y, width=null, height=null)\n\t{\n\t\twidth = width ?? this.width;\n\t\theight = height ?? this.height;\n\n\t\tthis.drawable.draw(g, x+this.offsX+(width-this.width)*0.5, y+this.offsY+(height-this.height)*0.5, this.width, this.height);\n\t}\n});\n\nRecycler.createPool(Centered, 512);\n\n\n/**\n * Static drawable.\n */\nconst Static = Drawable.extend\n({\n\tclassName: 'DrawableStatic',\n\n\tdrawable: null,\n\toffsX: 0,\n\toffsY: 0,\n\n\t__ctor: function (drawable, offsX, offsY)\n\t{\n\t\tthis._super.Drawable.__ctor(drawable);\n\n\t\tthis.drawable = drawable;\n\t\tthis.offsX = offsX;\n\t\tthis.offsY = offsY;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.drawable);\n\t},\n\n\tdraw: function (g, x, y, width=null, height=null)\n\t{\n\t\tthis.drawable.draw(g, x+this.offsX, y+this.offsY, width, height);\n\t}\n});\n\nRecycler.createPool(Static, 512);\n\n\n/**\n * Drawable group.\n */\nconst Group = Drawable.extend\n({\n\tclassName: 'DrawableGroup',\n\n\tlist: null,\n\n\t__ctor: function (list)\n\t{\n\t\tthis._super.Drawable.__ctor();\n\n\t\tthis.list = list;\n\n\t\tthis.width = 0;\n\t\tthis.height = 0;\n\n\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t{\n\t\t\tif (this.list[i].width > this.width) this.width = this.list[i].width;\n\t\t\tif (this.list[i].height > this.height) this.height = this.list[i].height;\n\t\t}\n\n\t\tthis.swidth = this.width;\n\t\tthis.sheight = this.height;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tif (this.list !== null)\n\t\t{\n\t\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\t\tdispose(this.list[i]);\n\n\t\t\tthis.list = null;\n\t\t}\n\t},\n\n\tdraw: function (g, x, y, width=null, height=null)\n\t{\n\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\tthis.list[i].draw(g, x, y, width, height);\n\t},\n\n\trender: function (g, elem)\n\t{\n\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\tthis.list[i].render(g, elem);\n\t}\n});\n\nRecycler.createPool(Group, 512);\n\n\n/**\n * Drawable made with a composition of tiles from a nine-slice spritesheet to create a rectangle.\n * !static nineSlice (spritesheet: Spritesheet, startingIndex?:number|0) : Drawable;\n */\nDrawable.nineSlice = function (spritesheet, startingIndex=0) { return NineSlice.Pool.alloc(spritesheet, startingIndex); }\n/**\n * Drawable made with a composition of tiles from a nine-slice spritesheet to create a rectangle.\n * !nineSlice (startingIndex?:number|0) : Drawable;\n */\nDrawable.prototype.nineSlice = function(startingIndex=0) { return NineSlice.Pool.alloc(this, startingIndex); }\n\n/**\n * Drawable tiles to the target size.\n * !static repeated (drawable: Drawable) : Drawable;\n */\nDrawable.repeated = function (drawable) { return Repeated.Pool.alloc(drawable); }\n/**\n * Drawable tiles to the target size.\n * !repeated () : Drawable;\n */\nDrawable.prototype.repeated = function () { return Repeated.Pool.alloc(this); }\n\n/**\n * Drawable clipped to the target size.\n * !static clipped (drawable: Drawable) : Drawable;\n */\nDrawable.clipped = function (drawable) { return Clipped.Pool.alloc(drawable); }\n/**\n * Drawable clipped to the target size.\n * !clipped () : Drawable;\n */\nDrawable.prototype.clipped = function () { return Clipped.Pool.alloc(this); }\n\n/**\n * Drawable centered to the target rectangle.\n * !static centered (drawable: Drawable, offsX?: number, offsY?: number) : Drawable;\n */\nDrawable.centered = function (drawable, offsX, offsY) { return Centered.Pool.alloc(drawable, offsX, offsY); }\n/**\n * Drawable centered to the target rectangle.\n * !centered (offsX?: number, offsY?: number) : Drawable;\n */\nDrawable.prototype.centered = function (offsX, offsY) { return Centered.Pool.alloc(this, offsX, offsY); }\n\n/**\n * Drawable as-is without stretching it.\n * !static static (drawable: Drawable, offsX?: number, offsY?: number) : Drawable;\n */\nDrawable.static = function (drawable, offsX, offsY) { return Static.Pool.alloc(drawable, offsX, offsY); }\n/**\n * Drawable as-is without stretching it.\n * !static (offsX?: number, offsY?: number) : Drawable;\n */\nDrawable.prototype.static = function (offsX, offsY) { return Static.Pool.alloc(this, offsX, offsY); }\n\n/**\n * Creates a drawable group.\n * !static group (...args: Array<Drawable>) : Drawable;\n */\nDrawable.group = function (...args) { return Group.Pool.alloc(args); }\n\n\n//!/class\n\n//!namespace Drawable\n//!namespace Pool\n\n\t/**\n\t * Allocates a drawable object.\n\t * !function alloc () : Drawable;\n\t */\n\nRecycler.createPool(Drawable, 512);\nexport default Drawable;\n","/*\n**\tresources/drawable\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Drawable from '../flow/drawable.js';\n\nexport default Drawable.extend\n({\n\tclassName: 'DrawableResource',\n\n\tr: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type !== 'image')\n\t\t\tthrow new Error ('Resource is not an image.');\n\n\t\tthis._super.Drawable.__ctor(r.data, r.width, r.height);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\t}\n});\n","/*\n**\tresources/custom.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Canvas from '../system/canvas.js';\nimport Drawable from '../flow/drawable.js';\n\n//![import \"../system/canvas\"]\n\nexport default Drawable.extend\n({\n\tclassName: 'DrawableCustom',\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != 'object')\n\t\t\tthrow new Error ('Resource is not an object.');\n\n\t\tthis._super.Drawable.__ctor(null, r.width, r.height);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tCanvas.renderImage(r.width, r.height,\n\t\t(g) => {\n\t\t\tif (this.r.draw !== null && typeof(this.r.draw) === 'function') {\n\t\t\t\tthis.r.draw(g, this.r);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tg.fillStyle(this.r.color);\n\t\t\t\tg.fillRect(0, 0, this.r.width, this.r.height);\n\t\t\t}\n\t\t},\n\t\t(img) => {\n\t\t\tthis.resource = img;\n\t\t\tthis.swidth = this.resource.width;\n\t\t\tthis.sheight = this.resource.height;\n\t\t});\n\t}\n});\n","/*\n**\tresources/spritesheet.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Drawable from '../flow/drawable.js';\n\n/*\n\tIf source is \"image\":\n\t\tconfig: {\n\t\t\tsheetWidth: int, frameWidth: int, frameHeight: int?, numFrames: int?\n\t\t\t--OR--\n\t\t\tnumFrames: int, frameWidth: int, frameHeight: int?\n\t\t}\n\n\tIf source is \"images\":\n\t\tconfig: {\n\t\t\tframeWidth: int, frameHeight: int\n\t\t}\n\t\t\n\tNOTE: The sheetWidth, frameWidth and frameHeight should reflect the real image size. The system will automatically scale it if the source image is smaller/bigger.\n*/\n\nconst FrameDrawable = Drawable.extend\n({\n\tspritesheet: null,\n\tframeIndex: 0,\n\n\t__ctor: function (spritesheet, frameIndex)\n\t{\n\t\tthis._super.Drawable.__ctor(null, spritesheet.width, spritesheet.height);\n\n\t\tthis.spritesheet = spritesheet;\n\t\tthis.frameIndex = frameIndex;\n\n\t\tthis.width = spritesheet.width;\n\t\tthis.height = spritesheet.height;\n\n\t\tthis.swidth = spritesheet.frameWidth;\n\t\tthis.sheight = spritesheet.frameHeight;\n\t}\n});\n\nexport default Drawable.extend\n({\n\tclassName: 'Spritesheet',\n\n\tnumCols: 0,\n\tnumFrames: 0,\n\n\tframeCache: null,\n\n\t__ctor: function (r)\n\t{\n\t\tthis._super.Drawable.__ctor();\n\n\t\tif ((r.type != 'image' && r.type != 'images'))\n\t\t\tthrow new Error ('Resource is not a sprite sheet.');\n\n\t\tvar r_scale, v_scale;\n\n\t\tif (r.type == 'image')\n\t\t{\n\t\t\tif (!r.config.sheetWidth && (!r.config.numFrames || !r.config.frameWidth))\n\t\t\t\tthrow new Error (r.resName + ': required sheetWidth or numFrames+frameWidth');\n\n\t\t\tif (!r.config.sheetWidth)\n\t\t\t\tr.config.sheetWidth = r.width; //r.config.numFrames * r.config.frameWidth;\n\n\t\t\tif (!r.config.frameHeight)\n\t\t\t\tr.config.frameHeight = r.data.height;\n\n\t\t\tr_scale = r.data.width / r.config.sheetWidth;\n\t\t\tv_scale = r.width / r.config.sheetWidth;\n\t\t}\n\t\telse // r.type == 'images'\n\t\t{\n\t\t\tif (!r.config) r.config = { };\n\n\t\t\tif (!r.config.frameWidth)\n\t\t\t\tr.config.frameWidth = r.data[0].width;\n\n\t\t\tif (!r.config.frameHeight)\n\t\t\t\tr.config.frameHeight = r.data[0].height;\n\n\t\t\tr_scale = r.data[0].data.width / r.config.frameWidth;\n\t\t\tv_scale = r.data[0].width / r.config.frameWidth;\n\t\t}\n\n\t\t// Physical frame dimensions.\n\t\tthis.frameWidth = (r.config.frameWidth * r_scale);\n\t\tthis.frameHeight = (r.config.frameHeight * r_scale);\n\n\t\t// Logical frame dimensions.\n\t\tthis.width = r.config.frameWidth * v_scale;\n\t\tthis.height = r.config.frameHeight * v_scale;\n\n\t\tif (r.type == 'image')\n\t\t{\n\t\t\tthis.numCols = int(r.data.width / this.frameWidth);\n\t\t\tthis.numRows = Math.ceil(r.data.height / this.frameHeight);\n\n\t\t\tthis.numFrames = r.config.numFrames || (this.numCols * this.numRows);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.numCols = this.numRows = 0;\n\t\t\tthis.numFrames = r.data.length;\n\t\t}\n\n\t\tthis.frameCache = { };\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\t// Preload frameCache.\n\t\tfor (let i = 0; i < this.numFrames; i++)\n\t\t\tthis.getFrame(i);\n\t},\n\n\tgetFrame: function (x, y=null)\n\t{\n\t\tlet frameIndex = y !== null ? y*this.numCols+x : x;\n\t\tif (frameIndex < 0 || frameIndex >= this.numFrames)\n\t\t\tthrow new Error ('frameIndex out of range');\n\n\t\tif (this.frameCache[frameIndex])\n\t\t\treturn this.frameCache[frameIndex];\n\n\t\tlet frameObject = new FrameDrawable (this, frameIndex);\n\n\t\tif (this.numCols != 0)\n\t\t{\n\t\t\tframeObject.sy = int(frameIndex / this.numCols) * this.frameHeight;\n\t\t\tframeObject.sx = (frameIndex % this.numCols) * this.frameWidth;\n\t\t\tframeObject.resource = this.r.data;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tframeObject.resource = this.r.data[frameIndex].data;\n\t\t}\n\n\t\treturn this.frameCache[frameIndex] = frameObject;\n\t},\n\n\tgetImage: function()\n\t{\n\t\treturn this.getFrame(0).getImage();\n\t},\n\n\tgetDrawable: function()\n\t{\n\t\treturn this.getFrame(0);\n\t}\n});\n","/*\n**\tresources/spritesheet-animation.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Spritesheet from './spritesheet.js';\nimport System from '../system/system.js';\nimport List from '../utils/list.js';\nimport Recycler from '../utils/recycler.js';\nimport Drawable from '../flow/drawable.js';\n\n//![import \"./spritesheet\"]\n//![import \"../system/system\"]\n//![import \"../utils/list\"]\n//![import \"../utils/recycler\"]\n\n/*\n\tanim: {\n\t\tdef: string, fps: int?,\n\n\t\tseq: {\n\t\t\tseq1: { loop: bool?, group: [ [int, int, ...], ... ] },\n\t\t\tseq2: { loop: bool?, group: [ [int, int, ...], ... ] },\n\t\t\tseq2: { loop: bool?, group: \"0-12\" },\n\t\t\tseq2: { loop: bool?, group: \"4 1 1 2 3\" },\n\t\t},\n\n\t\ttrans: {\n\t\t\tseq1: {\n\t\t\t\tseq2: [ seq_name, seq_name, ... ]\n\t\t\t}\n\t\t}\n\t}\n\n\tNOTE: When specifying a group such as \"0,12\" it means to draw tiles 0 and the 12 in that single frame.\n*/\n\nexport const Animation = Drawable.extend\n({\n\tclassName: 'Animation',\n\n\tseq: null, seq_i: 0,\n\ttrans: null, trans_i: 0, trans_t: null,\n\n\tqueue: null,\n\n\tfps: 0, frameSeconds: 0, time: 0,\n\n\tframeNumber: -1,\n\n\tfinished: false,\n\t_paused: false,\n\n\tfinishedCallback: null,\n\tfinishedCallbackHandler: null,\n\tfinishedCallbackContext: null,\n\n\tframeCallback: null,\n\n\t__ctor: function (anim, seq, fps)\n\t{\n\t\tthis._super.Drawable.__ctor(anim.getImage(), anim.width, anim.height);\n\n\t\tthis.anim = anim;\n\t\tthis.queue = List.Pool.alloc();\n\n\t\tthis.seq = seq;\n\t\tthis.seq_i = 0;\n\n\t\tthis.trans = null;\n\t\tthis.trans_i = 0;\n\t\tthis.trans_t = null;\n\n\t\tthis.frameNumber = -1;\n\t\tthis.finished = false;\n\t\tthis._paused = false;\n\n\t\tthis.finishedCallback = null;\n\t\tthis.finishedCallbackHandler = null;\n\t\tthis.finishedCallbackContext = null;\n\t\tthis.frameCallback = null;\n\n\t\tthis.fps = fps;\n\t\tthis.setFps (this.seq.fps || this.fps);\n\t},\n\n\t__dtor: function ()\n\t{\n\t\tthis.queue.free();\n\n\t\tif (this.finishedCallbackHandler)\n\t\t\tthis.finishedCallbackHandler.free();\n\n\t\tif (this.finishedCallbackContext)\n\t\t\tthis.finishedCallbackContext.free();\n\t},\n\n\tsetFps: function (fps)\n\t{\n\t\tthis.frameSeconds = 1.0 / fps;\n\t\tthis.time = 0;\n\n\t\treturn this;\n\t},\n\n\tpaused: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._paused;\n\n\t\tthis._paused = value;\n\t\treturn this;\n\t},\n\n\tinitialDelay: function (dt)\n\t{\n\t\tthis.time = -dt;\n\t\treturn this;\n\t},\n\n\tonFinished: function (callback)\n\t{\n\t\tthis.finishedCallback = callback;\n\t\treturn this;\n\t},\n\n\tthen: function (callback, context=null)\n\t{\n\t\tif (callback === false && this.finishedCallback === this.thenCallback)\n\t\t{\n\t\t\tthis.finishedCallbackHandler.clear();\n\t\t\tthis.finishedCallbackContext.clear();\n\t\t}\n\n\t\tif (!callback) return this;\n\n\t\tif (this.finishedCallback !== this.thenCallback)\n\t\t{\n\t\t\tthis.finishedCallback = this.thenCallback;\n\t\t\tthis.finishedCallbackHandler = List.Pool.alloc();\n\t\t\tthis.finishedCallbackContext = List.Pool.alloc();\n\t\t}\n\n\t\tthis.finishedCallbackHandler.push(callback);\n\t\tthis.finishedCallbackContext.push(context);\n\t\treturn this;\n\t},\n\n\tthenCallback: function ()\n\t{\n\t\tif (!this.finishedCallbackHandler.length)\n\t\t\treturn false;\n\n\t\tlet context = this.finishedCallbackContext.shift();\n\t\tthis.finishedCallbackHandler.shift()(this, context);\n\t},\n\n\tonFrame: function (fn)\n\t{\n\t\tthis.frameCallback = fn;\n\t\treturn this;\n\t},\n\n\tsetFrame: function (i)\n\t{\n\t\tthis.seq_i = int(i) % this.seq.group.length;\n\t\treturn this;\n\t},\n\n\tgetFrame: function (normalized)\n\t{\n\t\treturn normalized === true ? (this.seq_i / (this.seq.group.length-1)) : this.seq_i;\n\t},\n\n\tgetLength: function ()\n\t{\n\t\treturn this.seq.group.length;\n\t},\n\n\tdraw: function (g, x=0, y=0, width=null, height=null)\n\t{\n\t\tif (this.time < 0)\n\t\t{\n\t\t\tif (!this._paused)\n\t\t\t{\n\t\t\t\tthis.time += this.frameNumber === System.frameNumber ? 0 : System.frameDelta;\n\t\t\t\tthis.frameNumber = System.frameNumber;\n\t\t\t}\n\n\t\t\tif (this.time > 0) this.time = 0;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.seq_i === this.seq.group.length)\n\t\t{\n\t\t\tlet t = this.seq.group[this.seq_i-1];\n\n\t\t\tif (g !== null)\n\t\t\t{\n\t\t\t\tfor (let i = 0; i < t.length; i++)\n\t\t\t\t\tthis.anim.getFrame(t[i]).draw(g, x, y, width, height);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet t = this.seq.group[this.seq_i];\n\n\t\tif (g !== null)\n\t\t{\n\t\t\tfor (let i = 0; i < t.length; i++)\n\t\t\t\tthis.anim.getFrame(t[i]).draw(g, x, y, width, height);\n\t\t}\n\n\t\tif (!this._paused)\n\t\t{\n\t\t\tthis.time += this.frameNumber === System.frameNumber ? 0 : System.frameDelta;\n\t\t\tthis.frameNumber = System.frameNumber;\n\t\t}\n\n\t\tif (this.time >= this.frameSeconds)\n\t\t{\n\t\t\tconst frameIndex = this.seq_i;\n\n\t\t\tthis.time -= this.frameSeconds;\n\t\t\tthis.seq_i++;\n\n\t\t\tif (this.seq_i === this.seq.group.length)\n\t\t\t{\n\t\t\t\tif (this.trans != null)\n\t\t\t\t{\n\t\t\t\t\tif (++this.trans_i === this.trans.length)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.trans = null;\n\t\t\t\t\t\tthis.seq = this.trans_t;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tthis.seq = this.trans[this.trans_i];\n\n\t\t\t\t\tthis.setFps (this.seq.fps || this.fps);\n\n\t\t\t\t\tthis.seq_i = 0;\n\t\t\t\t\tthis.time = 0;\n\n\t\t\t\t\tthis.finished = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (this.seq.loop)\n\t\t\t\t\t\tthis.seq_i = 0;\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.finished = true;\n\n\t\t\t\t\t\tif (this.finishedCallback)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.finishedCallback(this) === false)\n\t\t\t\t\t\t\t\tthis.finishedCallback = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.queue.length)\n\t\t\t\t\t\tthis.use(this.queue.shift(), true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.frameCallback)\n\t\t\t{\n\t\t\t\tif (this.frameCallback(frameIndex, this.seq.group.length-1, this) === false)\n\t\t\t\t\tthis.frameCallback = null;\n\t\t\t}\n\t\t}\n\t},\n\n\tgetImage: function()\n\t{\n\t\treturn this.anim.getImage();\n\t},\n\n\tgetDrawable: function()\n\t{\n\t\treturn this;\n\t},\n\n\tadvance: function ()\n\t{\n\t\tthis.paused (false);\n\t\tthis.draw (null, 0, 0);\n\t},\n\n\tgetSequenceName: function ()\n\t{\n\t\treturn (this.trans === null ? this.seq : this.trans_t).name;\n\t},\n\n\tuse: function (seqName, force=false)\n\t{\n\t\tlet seq = this.trans === null ? this.seq : this.trans_t;\n\n\t\tif (seq.name === seqName && !this.finished && force !== true)\n\t\t\treturn false;\n\n\t\tif (seq.trans && seq.trans[seqName])\n\t\t{\n\t\t\tthis.trans_t = this.anim.a.seq[seqName];\n\n\t\t\tthis.trans = seq.trans[seqName];\n\t\t\tthis.trans_i = 0;\n\n\t\t\tthis.seq = this.trans[this.trans_i];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (force === true)\n\t\t\t\tthis.trans = null;\n\n\t\t\tthis.seq = this.anim.a.seq[seqName];\n\t\t}\n\n\t\tthis.setFps (this.seq.fps || this.fps);\n\n\t\tthis.seq_i = 0;\n\t\tthis.time = 0;\n\n\t\tthis.finished = false;\n\t\treturn true;\n\t},\n\n\tplay: function (name)\n\t{\n\t\tthis.use(name);\n\t\treturn this;\n\t},\n\n\tsetQueue: function (list)\n\t{\n\t\tif (!List.isInstance(list))\n\t\t\tthrow new Error('setQueue: Parameter must be an instance of List');\n\n\t\tif (this.queue != null)\n\t\t\tthis.queue.clear().free();\n\n\t\tthis.queue = list;\n\t\tthis.use(this.queue.shift(), true);\n\t},\n\n\tenqueue: function (seqName, force=false)\n\t{\n\t\tlet seq = this.trans === null ? this.seq : this.trans_t;\n\n\t\tlet lastName = this.queue.length > 0 ? this.queue[this.queue.length-1] : seq.name;\n\n\t\tif (seq.name === seqName && seq.loop)\n\t\t\treturn this;\n\n\t\tif (lastName === seqName && !force)\n\t\t\treturn this;\n\n\t\tif (seq.loop || this.finished)\n\t\t{\n\t\t\tthis.use(seqName, true);\n\t\t\treturn this;\n\t\t}\n\n\t\tthis.queue.push(seqName);\n\t\treturn this;\n\t}\n});\n\nRecycler.createPool(Animation);\n\n/* ********************************************************** */\nexport default Spritesheet.extend\n({\n\tclassName: 'SpritesheetAnimation',\n\n\tdefaultDrawable: null,\n\tsharedAnim: null,\n\n\tr: null,\n\ta: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (!r.anim) throw new Error (\"Animation descriptors not found.\");\n\n\t\tthis._super.Spritesheet.__ctor (r);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tlet t = this.a = this.r.anim;\n\n\t\tif (t.initialized) return;\n\n\t\tif (!t.def) t.def = 'def';\n\t\tif (!t.seq) t.seq = { };\n\n\t\t// Create default sequence if it wasn't defined.\n\t\tif (!t.seq[t.def] && (t.def == 'def' || t.def == 'defloop'))\n\t\t{\n\t\t\tlet p = { loop: (t.def == 'def' ? false : true), group: [ ] };\n\n\t\t\tfor (let i = 0; i < this.numFrames; i++) {\n\t\t\t\tp.group.push([i]);\n\t\t\t}\n\n\t\t\tt.seq[t.def] = p;\n\t\t}\n\n\t\tif (!t.seq[t.def])\n\t\t\tthrow new Error ('Undefined default sequence: ' + t.def);\n\n\t\tif (!t.fps) t.fps = 25;\n\n\t\tt.def = t.seq[t.def];\n\n\t\tlet frameIndex = 0;\n\n\t\tfor (let i in t.seq)\n\t\t{\n\t\t\tt.seq[i].name = i;\n\n\t\t\tif (!t.seq[i].loop)\n\t\t\t\tt.seq[i].loop = false;\n\n\t\t\tif (typeof(t.seq[i].group) == 'string')\n\t\t\t{\n\t\t\t\tlet a, b, c;\n\n\t\t\t\tif (t.seq[i].group.indexOf(' ') != -1)\n\t\t\t\t{\n\t\t\t\t\ta = t.seq[i].group.split(' ');\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\tfor (let j in a)\n\t\t\t\t\t\tt.seq[i].group.push([int(a[j])]);\n\t\t\t\t}\n\t\t\t\telse if (t.seq[i].group.indexOf('-') != -1)\n\t\t\t\t{\n\t\t\t\t\tc = t.seq[i].group.split('-');\n\t\t\t\t\t\n\t\t\t\t\ta = int(c[0]);\n\t\t\t\t\tb = int(c[1]);\n\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\tif (a < b) {\n\t\t\t\t\t\tfor (c = a; c <= b; c++)\n\t\t\t\t\t\t\tt.seq[i].group.push([c]);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tfor (c = a; c >= b; c--)\n\t\t\t\t\t\t\tt.seq[i].group.push([c]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ta = int(t.seq[i].group);\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\twhile (a--) t.seq[i].group.push([frameIndex++]);\n\t\t\t\t}\n\n\t\t\t\tt.seq[i].count = t.seq[i].group.length;\n\t\t\t}\n\t\t}\n\n\t\tif (t.trans)\n\t\t{\n\t\t\tfor (let i in t.trans)\n\t\t\t{\n\t\t\t\tt.seq[i].trans = t.trans[i];\n\n\t\t\t\tfor (let j in t.trans[i])\n\t\t\t\t{\n\t\t\t\t\tfor (let k = 0; k < t.trans[i][j].length; k++)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet n = t.trans[i][j][k];\n\n\t\t\t\t\t\tif (!t.seq[n]) throw new Error ('Undefined sequence: ' + n);\n\t\t\t\t\t\tt.trans[i][j][k] = t.seq[n];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tt.initialized = true;\n\t},\n\n\tgetSharedAnimation: function (initialseq=null)\n\t{\n\t\tif (this.sharedAnim === null)\n\t\t{\n\t\t\tthis.sharedAnim = Animation.Pool.alloc(this, initialseq ? this.a.seq[initialseq] : this.a.def, this.a.fps);\n\t\t\tthis.sharedAnim.lockInstance(true);\n\n\t\t\treturn this.sharedAnim;\n\t\t}\n\n\t\treturn this.sharedAnim.play(initialseq ? initialseq : this.a.def.name);\n\t},\n\n\tgetAnimation: function (initialseq=null, fps=null)\n\t{\n\t\treturn Animation.Pool.alloc(this, initialseq ? this.a.seq[initialseq] : this.a.def, fps || this.a.fps);\n\t},\n\n\tgetSequence: function (name)\n\t{\n\t\treturn this.a.seq[name];\n\t},\n\n\tgetDrawable: function()\n\t{\n\t\tif (this.defaultDrawable === null)\n\t\t\tthis.defaultDrawable = this.getAnimation();\n\n\t\treturn this.defaultDrawable;\n\t}\n});\n","/*\n**\tresources/spritefont.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Canvas from '../system/canvas.js';\n\n//![import \"../system/canvas\"]\n\n/*\n\tfont: {\n\t\tsheetWidth: int?, charWidth: int, charHeight: int, charset: string, widths: [char, width, ...],\n\t\treverseDraw: bool?, paddingX: int?, paddingY: int?, spacingX: int?, spacingY: int?\n\t}\n*/\n\nexport default Class.extend\n({\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != 'image' || !r.font)\n\t\t\tthrow new Error ('Resource is not a sprite font.');\n\n\t\tif (!r.font.sheetWidth)\n\t\t\tr.font.sheetWidth = r.width;\n\n\t\tlet r_scale = r.data.width / r.font.sheetWidth;\n\t\tlet v_scale = r.width / r.font.sheetWidth;\n\n\t\tthis.r_charWidth = (r.font.charWidth * r_scale);\n\t\tthis.r_charHeight = (r.font.charHeight * r_scale);\n\n\t\tthis.charWidth = (r.font.charWidth * v_scale);\n\t\tthis.charHeight = (r.font.charHeight * v_scale);\n\n\t\tthis.paddingX = (r.font.paddingX || 0) * v_scale;\n\t\tthis.paddingY = (r.font.paddingY || 0) * v_scale;\n\n\t\tthis.spacingX = (r.font.spacingX || 0) * v_scale;\n\t\tthis.spacingY = (r.font.spacingY || 0) * v_scale;\n\n\t\tthis.reverseDraw = r.font.reverseDraw || false;\n\n\t\tlet cols = int(r.font.sheetWidth / r.font.charWidth);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tlet n = r.font.charset.length;\n\t\tlet k = 0;\n\t\tlet y = 0;\n\n\t\tthis.charTable = { };\n\n\t\twhile (k < n)\n\t\t{\n\t\t\tlet x = 0;\n\n\t\t\tfor (let i = 0; i < cols && k < n; i++)\n\t\t\t{\n\t\t\t\tlet c = r.font.charset[k++];\n\n\t\t\t\tthis.charTable[c] = { hidden: false, x: x, y: y, charWidth: this.charWidth, r_charWidth: this.r_charWidth, spacingX: 0 };\n\n\t\t\t\tx += this.r_charWidth;\n\t\t\t}\n\n\t\t\ty += this.r_charHeight;\n\t\t}\n\n\t\tif (!(' ' in this.charTable))\n\t\t\tthis.charTable[' '] = { hidden: true, charWidth: int((this.charWidth + this.paddingX)*2/3), r_charWidth: this.r_charWidth, spacingX: 0 };\n\n\t\tif (!r.font.widths) return;\n\n\t\tn = r.font.widths.length;\n\n\t\tfor (let i = 0; i < n; i += 2)\n\t\t{\n\t\t\tlet w = r.font.widths[i+1] * v_scale;\n\t\t\tlet s = r.font.widths[i];\n\n\t\t\tif (typeof(s) === 'number')\n\t\t\t\ts = String.fromCharCode(s);\n\n\t\t\tfor (let j = 0; j < s.length; j++)\n\t\t\t{\n\t\t\t\tif (s[j] in this.charTable)\n\t\t\t\t\tthis.charTable[s[j]].spacingX = w - this.charTable[s[j]].charWidth;\n\t\t\t}\n\t\t}\n\t},\n\n\tdrawText: function (g, x, y, text)\n\t{\n\t\tlet n = text.length;\n\n\t\tlet pX = -2*this.paddingX + this.spacingX;\n\n\t\tx -= this.paddingX;\n\t\ty -= this.paddingY;\n\n\t\tif (!this.reverseDraw)\n\t\t{\n\t\t\tfor (let i = 0; i < n; i++)\n\t\t\t{\n\t\t\t\tlet c = this.charTable[text[i]];\n\t\t\t\tif (!c) continue;\n\n\t\t\t\tif (!c.hidden)\n\t\t\t\t\tg.drawImage (this.r.data, c.x, c.y, c.r_charWidth, this.r_charHeight, x, y, c.charWidth, this.charHeight, null, null, c.charWidth, this.charHeight);\n\n\t\t\t\tx += c.charWidth + pX + c.spacingX;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let i = 0; i < n-1; i++)\n\t\t\t{\n\t\t\t\tlet c = this.charTable[text[i]];\n\t\t\t\tif (!c) continue;\n\n\t\t\t\tx += c.charWidth + pX;\n\t\t\t}\n\n\t\t\tfor (let i = n-1; i >= 0; i--)\n\t\t\t{\n\t\t\t\tlet c = this.charTable[text[i]];\n\t\t\t\tif (!c) continue;\n\n\t\t\t\tif (!c.hidden)\n\t\t\t\t\tg.drawImage (this.r.data, c.x, c.y, c.r_charWidth, this.r_charHeight, x, y, c.charWidth, this.charHeight, null, null, c.charWidth, this.charHeight);\n\n\t\t\t\tx -= c.charWidth + pX + c.spacingX;\n\t\t\t}\n\t\t}\n\t},\n\n\tmeasureWidth: function (text)\n\t{\n\t\tlet n = text.length;\n\t\tlet x = 0;\n\n\t\tlet pX = -2*this.paddingX + this.spacingX;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tlet c = this.charTable[text[i]];\n\t\t\tif (!c) continue;\n\n\t\t\tx += c.charWidth + pX + c.spacingX;\n\t\t}\n\n\t\treturn x;\n\t},\n\n\tmeasureHeight: function (text)\n\t{\n\t\treturn this.charHeight - 2*this.paddingY + this.spacingY;\n\t}\n});\n\n\nCanvas.prototype.drawText = function (r, x, y, text)\n{\n\tr.drawText (this, x, y, text);\n};\n\nCanvas.prototype.drawTextAligned = function (r, x, y, w, h, ax, ay, text)\n{\n\tif (ax == 0) // Align-Center\n\t\tx = x + ((w - r.measureWidth(text)) >> 1);\n\telse if (ax < 0) // Align-Left\n\t\tx = x - ax - 1;\n\telse if (ax > 0) // Align-Right\n\t\tx = x + w - ax + 1 - r.measureWidth(text);\n\n\tif (ay == 0) // Align-Center\n\t\ty = y + ((h - r.measureHeight(text)) >> 1);\n\telse if (ay < 0) // Align-Top\n\t\ty = y - ay - 1;\n\telse if (ay > 0) // Align-Bottom\n\t\ty = y + h - ay + 1 - r.measureHeight(text);\n\n\tr.drawText (this, x, y, text);\n};\n\nCanvas.prototype.drawTextAligned2 = function (r, bounds, ax, ay, text)\n{\n\tthis.drawTextAligned (r, bounds.x1, bounds.y1, bounds.width(), bounds.height(), ax, ay, text);\n};\n","/*\n**\tresources/resources.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rinn } from 'rinn';\nimport System from '../system/system.js';\nimport Canvas from '../system/canvas.js';\nimport Log from '../system/log.js';\n\n//[import '../system/system']\n//[import '../system/canvas']\n//[import '../system/log']\n\nconst Resources = { };\n\nimport * as Wrappers from './wrappers.js';\n\nlet reported = false;\n\n\n//!namespace Resources\n\n\t//!type ConfigOptions =\n\n\t\t/**\n\t\t * Enables integer scaling. When enabled, calling `resizeImage` with `pixelated` parameter set to `true` will cause images to be resized to integer\n\t\t * factors. When disabled, images will be resized using the half/double method to eventually end up reaching the exact target size.\n\t\t *\n\t\t * @default true\n\t\t * !integerScalingEnabled?: boolean;\n\t\t */\n\t\t/**\n\t\t * Default value for the `pixelated` parameter of image resources. Controls whether to use integer scaling when resizing images. Also controls the default\n\t\t * scaling filter (LINEAR/NEAREST) the image will use when converted to a WebGL2 texture.\n\t\t * \n\t\t * @default false\n\t\t * !pixelated?: boolean;\n\t\t */\n\t\t/**\n\t\t * Default value for the `filter` parameter of image resources. When an image does not have the `pixelated` property nor `filter`, this value will be used.\n\t\t * \n\t\t * @default NEAREST\n\t\t * !filter?: 'LINEAR'|'NEAREST';\n\t\t */\n\t\t/**\n\t\t * Default value for the `original` parameter of image resources. When set to `true`, no resizing will take place on the image resource at all and the\n\t\t * original will be used as-is.\n\t\t * \n\t\t * @default false\n\t\t * !original?: boolean;\n\t\t */\n\n\t//!/type\n\n//!/namespace\n\n//:/**\n//: * Provides functionality to load and manipulate resources (images, audio, etc).\n//: */\n\n//!class Resources\n\nObject.assign(Resources,\n{\n\t/**\n\t * Enables integer scaling. When enabled, calling `resizeImage` with `pixelated` parameter set to `true` will cause images to be resized to integer\n\t * factors. When disabled, images will be resized using the half/double method to eventually end up reaching the exact target size.\n\t *\n\t * @default true\n\t * !static integerScalingEnabled: boolean;\n\t */\n\tintegerScalingEnabled: true,\n\n\t/**\n\t * Default value for the `pixelated` parameter of image resources. Controls whether to use integer scaling when resizing images. Also controls the default\n\t * scaling filter (LINEAR/NEAREST) the image will use when converted to a WebGL2 texture.\n\t * \n\t * @default false\n\t * !static pixelated: boolean;\n\t */\n\tpixelated: false,\n\n\t/**\n\t * Default value for the `filter` parameter of image resources. When an image does not have the `pixelated` property nor `filter`, this value will be used.\n\t * \n\t * @default LINEAR\n\t * !static filter: 'LINEAR'|'NEAREST';\n\t */\n\tfilter: 'LINEAR',\n\n\t/**\n\t * Default value for the `original` parameter of image resources. When set to `true`, no resizing will take place on the image resource at all and the\n\t * original will be used as-is.\n\t * \n\t * @default false\n\t * !static original: boolean;\n\t */\n\toriginal: false,\n\n\t/**\n\t * Configures the resources object with the specified options.\n\t * !static config (options: Resources.ConfigOptions) : void;\n\t */\n\tconfig: function (opts)\n\t{\n\t\tif (opts !== null)\n\t\t\tObject.assign(this, opts);\n\t},\n\n\t/**\n\t * Loads a list of resources. The list parameter is actually a dictionary with objects as shown in the example below.\n\t *\n\t * { type: \"image\", wrapper: \"\", src: \"assets/ui/btn-left.png\", width: 64, \\[ height: 64 \\], scale: 1, pixelated: false, filter: null, original: false }\n\t * { type: \"images\", wrapper: \"\", src: \"assets/ui/##.png\", count: 16, width: 64, \\[ height: 64 \\], pixelated: false }\n\t * { type: \"audio\", wrapper: \"\", src: \"assets/ui/tap.wav\", track: \"sfx|music\" }\n\t * { type: \"audios\", wrapper: \"\", src: \"assets/ui/snd-##.wav\", count: 4 }\n\t * { type: \"json\", wrapper: \"\", src: \"assets/config.json\" }\n\t * { type: \"data\", wrapper: \"\", src: \"assets/config.dat\" }\n\t * { type: \"text\", wrapper: \"\", src: \"assets/config.frag\" }\n\t * { type: \"object\", wrapper: \"\" }\n\t * \n\t * @param list - Map of resources to load.\n\t * @param progressCallback - Executed once for every resource loaded.\n\t * @param completeCallback - Executed when all resources have been loaded.\n\t * !static load (list: { \\[id: string\\] : object }, progressCallback: (index: number, count: number, ratio: number, name: string) => void, completeCallback: (list: { \\[id: string\\] : object }) => void) : void;\n\t */\n\tload: function (list, progressCallback, completeCallback, keyList, index)\n\t{\n\t\tif (!keyList)\n\t\t{\n\t\t\tkeyList = Object.keys(list);\n\n\t\t\tfor (let i in keyList)\n\t\t\t{\n\t\t\t\tif (!('__loaded' in list[keyList[i]]))\n\t\t\t\t\tlist[keyList[i]].__clone = Rinn.clone(list[keyList[i]]);\n\t\t\t}\n\n\t\t\tindex = 0;\n\t\t}\n\n\t\twhile (index < keyList.length && ('__loaded' in list[keyList[index]]))\n\t\t\tindex++;\n\n\t\tif (progressCallback)\n\t\t\tprogressCallback (index, keyList.length, index / keyList.length, keyList[index]);\n\n\t\tif (index == keyList.length)\n\t\t{\n\t\t\tif (completeCallback)\n\t\t\t\tcompleteCallback(list);\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet r = list[keyList[index]];\n\n\t\tr.resName = keyList[index];\n\n\t\tswitch (r.type)\n\t\t{\n\t\t\tcase \"image\":\n\t\t\t\tr.data = new Image ();\n\n\t\t\t\tr.data.onload = function ()\n\t\t\t\t{\n\t\t\t\t\tvar ratio = r.data.width / r.data.height;\n\n\t\t\t\t\tif (r.scale)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.width = int(r.data.width*r.scale);\n\t\t\t\t\t\tr.height = int(r.data.height*r.scale);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!r.hasOwnProperty('extraScale'))\n\t\t\t\t\t\tr.extraScale = 0.0;\n\n\t\t\t\t\tif (!r.width && !r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.width = r.data.width;\n\t\t\t\t\t\tr.height = r.data.height;\n\t\t\t\t\t}\n\t\t\t\t\telse if (r.width && !r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.height = int(r.width / ratio);\n\t\t\t\t\t}\n\t\t\t\t\telse if (!r.width && r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.width = int(ratio * r.height);\n\t\t\t\t\t}\n\n\t\t\t\t\tr.owidth = r.data.width;\n\t\t\t\t\tr.oheight = r.data.height;\n\n\t\t\t\t\tif (!r.hasOwnProperty('filter'))\n\t\t\t\t\t\tr.filter = !r.hasOwnProperty('pixelated') ? Resources.filter : (r.pixelated === true ? 'NEAREST' : Resources.filter);\n\n\t\t\t\t\tif (!r.hasOwnProperty('pixelated'))\n\t\t\t\t\t\tr.pixelated = Resources.pixelated;\n\n\t\t\t\t\tif (!r.hasOwnProperty('original'))\n\t\t\t\t\t\tr.original = Resources.original;\n\n\t\t\t\t\tif ((r.data.width != r.width || r.data.height != r.height || r.extraScale != 0.0) && r.original !== true)\n\t\t\t\t\t{\n//let t = hrnow();//violet\n\t\t\t\t\t\tr.data = Resources.resizeImage (r, r.width * (r.extraScale + (r.pixelated ? System.integerScaleFactor : System.scaleFactor)), r.height * (r.extraScale + (r.pixelated ? System.integerScaleFactor : System.scaleFactor)), r.pixelated, true);\n//console.log((hrnow() - t) + ': resize to ' + (r.width * (r.pixelated ? System.integerScaleFactor : System.scaleFactor)) + 'x' + (r.height * (r.pixelated ? System.integerScaleFactor : System.scaleFactor)));\n\t\t\t\t\t}\n\n\t\t\t\t\tr.rscale = r.data.width / r.width;\n\n\t\t\t\t\tr.data.rscale = r.rscale;\n\t\t\t\t\tr.data.filter = r.filter;\n\t\t\t\t\tr.data.targetWidth = r.width;\n\t\t\t\t\tr.data.targetHeight = r.height;\n\n\t\t\t\t\t// Pre-draw on an offscreen canvas, used to prevent a delay when rendering an image for the first time on some browsers.\n\t\t\t\t\tSystem.tempDisplayBuffer.drawImage(r.data, 0, 0);\n\t\t\t\t\tSystem.renderer.prepareImage(r.data);\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index+1);\n\t\t\t\t};\n\n\t\t\t\tr.data.onerror = function () {\n\t\t\t\t\tconsole.error (\"Error: Unable to load: \" + r.resName);\n\t\t\t\t};\n\n\t\t\t\tr.data.src = r.src + \"?r=\" + Math.random();\n\t\t\t\tbreak;\n\n\t\t\tcase \"images\":\n\n\t\t\t\tvar src = r.src;\n\n\t\t\t\tvar d0 = src.indexOf(\"#\");\n\t\t\t\tvar d1 = src.lastIndexOf(\"#\");\n\t\t\t\tvar dN = d1 - d0 + 1;\n\n\t\t\t\tif (d0 == -1)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'src' attribute requires one or more '#' marks.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!r.count)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'count' attribute was not found.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tr._i = 0;\n\t\t\t\tr.data = [ ];\n\n\t\t\t\tvar cb = function ()\n\t\t\t\t{\n\t\t\t\t\tif (r._i == r.count)\n\t\t\t\t\t{\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// violet :add support for extraScale\n\t\t\t\t\tvar tmp = { type: \"image\", width: r.width, height: r.height, scale: r.scale };\n\n\t\t\t\t\ttmp.src = r.src.substr(0, d0) + ((r._i++) / Math.pow(10,dN)).toFixed(dN).substr(2) + r.src.substr(d1+1);\n\t\t\t\t\ttmp.data = new Image ();\n\t\t\t\t\ttmp.resName = r.resName + \"#\" + (r._i - 1);\n\n\t\t\t\t\ttmp.data.onload = function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar ratio = tmp.data.width / tmp.data.height;\n\n\t\t\t\t\t\tif (tmp.scale)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = int(tmp.data.width*tmp.scale);\n\t\t\t\t\t\t\ttmp.height = int(tmp.data.height*tmp.scale);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!tmp.width && !tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = tmp.data.width;\n\t\t\t\t\t\t\ttmp.height = tmp.data.height;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (tmp.width && !tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.height = int(tmp.width / ratio);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!tmp.width && tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = int(ratio * tmp.height);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (r._i == 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tr.owidth = tmp.data.width;\n\t\t\t\t\t\t\tr.oheight = tmp.data.height;\n\n\t\t\t\t\t\t\tif (!r.hasOwnProperty('filter'))\n\t\t\t\t\t\t\t\tr.filter = !r.hasOwnProperty('pixelated') ? Resources.filter : (r.pixelated === true ? 'NEAREST' : Resources.filter);\n\n\t\t\t\t\t\t\tif (!r.hasOwnProperty('pixelated'))\n\t\t\t\t\t\t\t\tr.pixelated = Resources.pixelated;\n\n\t\t\t\t\t\t\tif (!r.hasOwnProperty('original'))\n\t\t\t\t\t\t\t\tr.original = Resources.original;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttmp.pixelated = r.pixelated;\n\t\t\t\t\t\ttmp.filter = r.filter;\n\t\t\t\t\t\ttmp.original = r.original;\n\n\t\t\t\t\t\tif ((tmp.data.width != tmp.width || tmp.data.height != tmp.height) && tmp.original !== true)\n\t\t\t\t\t\t{\n//let t = hrnow();//violet\n\t\t\t\t\t\t\ttmp.data = Resources.resizeImage (tmp, tmp.width * (r.pixelated ? System.integerScaleFactor : System.scaleFactor), tmp.height * (tmp.pixelated ? System.integerScaleFactor : System.scaleFactor), tmp.pixelated, true);\n//console.log((hrnow() - t) + ': resize to ' + (tmp.width * (r.pixelated ? System.integerScaleFactor : System.scaleFactor)) + 'x' + (tmp.height * (r.pixelated ? System.integerScaleFactor : System.scaleFactor)));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttmp.rscale = tmp.data.width / tmp.width;\n\n\t\t\t\t\t\ttmp.data.rscale = tmp.rscale;\n\t\t\t\t\t\ttmp.data.filter = tmp.filter;\n\t\t\t\t\t\ttmp.data.targetWidth = tmp.width;\n\t\t\t\t\t\ttmp.data.targetHeight = tmp.height;\n\n\t\t\t\t\t\tif (r._i == 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tr.width = tmp.width;\n\t\t\t\t\t\t\tr.height = tmp.height;\n\t\t\t\t\t\t\tr.rscale = tmp.rscale;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tSystem.tempDisplayBuffer.drawImage(tmp.data, 0, 0);\n\t\t\t\t\t\tSystem.renderer.prepareImage(tmp.data);\n\n\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\tcb();\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.onerror = function () {\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName);\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.src = tmp.src + \"?r=\" + Math.random();\n\t\t\t\t};\n\n\t\t\t\tcb();\n\t\t\t\tbreak;\n\n\t\t\tcase \"audio\":\n\n\t\t\t\tif (!r.track) r.track = \"sfx\";\n\n\t\t\t\tif (global.plugins && global.plugins.NativeAudio && r.track == \"sfx\")\n\t\t\t\t{\n\t\t\t\t\tif (!reported) {\n\t\t\t\t\t\tLog.write('ENGINE_NATIVEAUDIO');\n\t\t\t\t\t\treported = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tr.engine = Wrappers.Sound.ENGINE_NATIVEAUDIO;\n\t\t\t\t\tr.data = \"snd_\" + index;\n\n\t\t\t\t\tglobal.plugins.NativeAudio.preloadSimple(r.data, r.src,\n\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\t\t\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction(e) {\n\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load (sfx): \" + r.resName + \"\\n\" + e);\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (global.audioContext)\n\t\t\t\t{\n\t\t\t\t\tif (!reported) {\n\t\t\t\t\t\tLog.write('ENGINE_WEBAUDIO');\n\t\t\t\t\t\treported = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tr.engine = Wrappers.Sound.ENGINE_WEBAUDIO;\n\n\t\t\t\t\tfetchAudioBuffer (r.src + \"?r=\" + Math.random())\n\t\t\t\t\t.then (audioBuffer => {\n\t\t\t\t\t\tr.data = audioBuffer;\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\t\t\n\t\t\t\t\t})\n\t\t\t\t\t.catch (err => {\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName);\n\t\t\t\t\t});\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!reported) {\n\t\t\t\t\tLog.write('ENGINE_HTML5');\n\t\t\t\t\treported = true;\n\t\t\t\t}\n\n\t\t\t\tr.data = new Audio ();\n\t\t\t\tr.engine = Wrappers.Sound.ENGINE_HTML5;\n\n\t\t\t\tr.data.oncanplaythrough = function ()\n\t\t\t\t{\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t};\n\n\t\t\t\tr.data.onerror = function ()\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName);\n\t\t\t\t};\n\n\t\t\t\tr.data.src = r.src + \"?r=\" + Math.random();\n\t\t\t\tbreak;\n\n\t\t\tcase \"audios\":\n\n\t\t\t\tvar src = r.src;\n\n\t\t\t\tvar d0 = src.indexOf(\"#\");\n\t\t\t\tvar d1 = src.lastIndexOf(\"#\");\n\t\t\t\tvar dN = d1 - d0 + 1;\n\n\t\t\t\tif (d0 == -1)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'src' attribute requires one or more '#' marks.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!r.count)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'count' attribute was not found.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tr._i = 0;\n\t\t\t\tr.data = [ ];\n\n\t\t\t\tvar cb = function ()\n\t\t\t\t{\n\t\t\t\t\tif (r._i == r.count)\n\t\t\t\t\t{\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar tmp = { type: \"audio\", track: r.track };\n\n\t\t\t\t\ttmp.src = r.src.substr(0, d0) + ((r._i++) / Math.pow(10,dN)).toFixed(dN).substr(2) + r.src.substr(d1+1);\n\t\t\t\t\ttmp.resName = r.resName + \"#\" + (r._i - 1);\n\n\t\t\t\t\tif (!tmp.track) tmp.track = \"sfx\";\n\n\t\t\t\t\tif (global.plugins && global.plugins.NativeAudio && tmp.track == \"sfx\")\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_NATIVEAUDIO;\n\t\t\t\t\t\ttmp.data = \"snd_\" + index + \"_\" + r._i;\n\t\n\t\t\t\t\t\tglobal.plugins.NativeAudio.preloadSimple(tmp.data, tmp.src,\n\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\t\t\tcb();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfunction(e) {\n\t\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load (sfx): \" + tmp.resName + \"\\n\" + e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (global.audioContext)\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_WEBAUDIO;\n\n\t\t\t\t\t\tfetchAudioBuffer (tmp.src + \"?r=\" + Math.random())\n\t\t\t\t\t\t.then (audioBuffer => {\n\t\t\t\t\t\t\ttmp.data = audioBuffer;\n\t\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\t\tcb();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch (err => {\n\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\ttmp.data = new Audio ();\n\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_HTML5;\n\n\t\t\t\t\ttmp.data.oncanplaythrough = function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\tcb();\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.onerror = function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName);\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.src = tmp.src + \"?r=\" + Math.random();\n\t\t\t\t};\n\n\t\t\t\tcb();\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"json\":\n\n\t\t\t\tfetchd (r.src + \"?r=\" + Math.random(), { responseType: 'json' }).then(function(json)\n\t\t\t\t{\n\t\t\t\t\tr.data = json;\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t})\n\t\t\t\t.catch(function(err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName + \". Error: \" + err);\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"data\":\n\n\t\t\t\tfetchd (r.src + \"?r=\" + Math.random()).then(function(arraybuffer)\n\t\t\t\t{\n\t\t\t\t\tr.data = arraybuffer;\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t})\n\t\t\t\t.catch(function(err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName + \". Error: \" + err);\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"text\":\n\n\t\t\t\tfetchd (r.src + \"?r=\" + Math.random()).then(function(arrayBuffer)\n\t\t\t\t{\n\t\t\t\t\tr.data = String.fromCharCode.apply(null, new Uint8Array(arrayBuffer));\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t})\n\t\t\t\t.catch(function(err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName + \". Error: \" + err);\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"object\":\n\t\t\t\tr.data = { };\n\n\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\tbreak;\n\t\t}\n\t},\n\n\t/**\n\t * Unloads the specified list of resources.\n\t * !static unload (list: { \\[id: string\\] : object }) : void;\n\t */\n\tunload: function (list)\n\t{\n\t\tthrow new Error('IMPLEMENTED UNLOAD!');\n\n\t\tvar __original;\n\n\t\tfor (var i in list)\n\t\t{\n\t\t\tif (i == \"__original\")\n\t\t\t{\n\t\t\t\t__original = list[i];\n\t\t\t\tdelete list[i];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (list[i].r)\n\t\t\t{\n\t\t\t\tdispose(list[i]);\n\t\t\t\tlist[i] = list[i].r;\n\t\t\t}\n\n\t\t\tswitch (list[i].type)\n\t\t\t{\n\t\t\t\tcase \"audio\":\n\t\t\t\t\t// violet: unload audio if using NativeAudio\n\t\t\t\t\t// global.plugins.NativeAudio.unload\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"audios\":\n\t\t\t\t\t// violet: unload audio if using NativeAudio\n\t\t\t\t\t// global.plugins.NativeAudio.unload\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"images\":\n\t\t\t\t\tfor (var j = 0; j < list[i].data.length; j++)\n\t\t\t\t\t\tdispose (list[i].data[j]);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tdispose (list[i].data);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tlist[i].data = null;\n\t\t\tdelete list[i];\n\t\t}\n\n\t\tfor (var i in __original)\n\t\t\tlist[i] = __original[i];\n\t},\n\n\t/**\n\t * Executes post-load actions on a resource.\n\t */\n\tonLoaded: function (list, index)\n\t{\n\t\tvar r = list[index];\n\t\tif (!r.wrapper || !(r.wrapper in Wrappers)) return;\n\n\t\tlist[index] = new Wrappers[r.wrapper] (r);\n\t\tlist[index].__loaded = true;\n\t},\n\n\t/**\n\t * Resizes the given image to the specified size.\n\t * !static resizeImage (image: HTMLImageElement, targetWidth: number, targetHeight: number, pixelated?: boolean, discardOriginal?: boolean) : HTMLImageElement;\n\t */\n\tresizeImage: function (image, dw, dh, pixelated, discardOriginal)\n\t{\n\t\tvar sw = image.data.width;\n\t\tvar sh = image.data.height;\n\n\t\tdw = int(dw);\n\t\tdh = int(dh);\n\n\t\tif (sw == dw && sh == dh)\n\t\t\treturn image.data;\n\n\t\tif (!this.integerScalingEnabled && pixelated) pixelated = null;\n\n\t\tif (!pixelated)\n\t\t{\n\t\t\tpixelated = pixelated === null ? false : true;\n\n\t\t\tvar temp = new Canvas ({ hidden: true, antialias: pixelated }).resize (sw, sh);\n\t\t\ttemp.drawImage (image.data, 0, 0);\n\n\t\t\twhile (true)\n\t\t\t{\n\t\t\t\tvar tw = sw >> 1;\n\t\t\t\tvar th = sh >> 1;\n\n\t\t\t\tif (tw <= dw || th <= dh)\n\t\t\t\t\tbreak;\n\n\t\t\t\tvar output = new Canvas ({ hidden: true, antialias: pixelated }).resize (tw, th);\n\t\t\t\toutput.drawImage (temp.elem, 0, 0, tw, th);\n\t\t\t\ttemp.dispose ();\n\n\t\t\t\tsw = tw;\n\t\t\t\tsh = th;\n\n\t\t\t\ttemp = output;\n\t\t\t}\n\n\t\t\tvar output = new Canvas ({ hidden: true, antialias: pixelated }).resize (dw, dh);\n\t\t\toutput.drawImage (temp.elem, 0, 0, dw, dh);\n\t\t\ttemp.dispose ();\n\n\t\t\tif (discardOriginal)\n\t\t\t\tdispose (image.data);\n\n\t\t\treturn output.elem;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (int(dw / sw) > 0)\n\t\t\t{\n\t\t\t\tvar ratio = int((dw / sw) + 0.9);\n\n\t\t\t\tdw = ratio * sw;\n\t\t\t\tdh = ratio * sh;\n\n\t\t\t\tvar rep_x = dw / sw;\n\t\t\t\tvar rep_y = dh / sh;\n\n\t\t\t\tvar output = new Canvas ({ hidden: true, antialias: false }).resize (dw, dh);\n\n\t\t\t\tvar temp = new Canvas ({ hidden: true, antialias: false }).resize (sw, sh);\n\t\t\t\ttemp.drawImage (image.data, 0, 0);\n\n\t\t\t\tfor (var j = 0; j < sh; j++)\n\t\t\t\t{\n\t\t\t\t\tvar s = temp.getImageData(0, j, sw, 1).data;\n\t\t\t\t\tvar sp = 0;\n\n\t\t\t\t\tfor (var i = 0; i < sw && sp < s.length; i++, sp += 4)\n\t\t\t\t\t{\n\t\t\t\t\t\toutput.fillStyle(\"rgba(\"+s[sp]+\",\"+s[sp+1]+\",\"+s[sp+2]+\",\"+(s[sp+3] / 255)+\")\");\n\t\t\t\t\t\toutput.fillRect(i*rep_x, j*rep_y, rep_x, rep_y);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttemp.dispose();\n\n\t\t\t\treturn output.elem;\n\t\t\t}\n\n\t\t\treturn this.resizeImage (image, dw, dh, null, discardOriginal);\n\t\t}\n\t},\n\n\t/**\n\t * Flips an image horizontally.\n\t * !static flipImageHorz (image: HTMLImageElement) : HTMLImageElement;\n\t */\n\tflipImageHorz: function (image)\n\t{\n\t\tvar temp = new Canvas ({ hidden: true }).resize (image.data.width, image.data.height);\n\n\t\ttemp.translate(image.data.width, 0);\n\t\ttemp.scale(-1, 1);\n\n\t\ttemp.drawImage (image.data, 0, 0);\n\t\treturn temp.elem;\n\t},\n\n\t/**\n\t * Flips an image vertically.\n\t * !static flipImageVert (image: HTMLImageElement) : HTMLImageElement;\n\t */\n\tflipImageVert: function (image)\n\t{\n\t\tvar temp = new Canvas ({ hidden: true }).resize (image.data.width, image.data.height);\n\n\t\ttemp.translate(0, image.data.height);\n\t\ttemp.scale(1, -1);\n\n\t\ttemp.drawImage (image.data, 0, 0);\n\t\treturn temp.elem;\n\t},\n\n\t/**\n\t * Forces the browser to show a download dialog.\n\t * !static showDownload (filename: string, dataUrl: string) : void;\n\t */\n\tshowDownload: function (filename, dataUrl)\n\t{\n\t\tvar link = document.createElement(\"a\");\n\t\tlink.href = dataUrl;\n\n\t\tlink.style.display = 'none';\n\t\tlink.download = filename;\n\t\tlink.target = \"_blank\";\n\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t},\n\n\t/**\n\t * Forces the browser to show a file selection dialog.\n\t * !static showFilePicker (allowMultiple: boolean, accept: string, callback: (files: Array<File>) => void) : void;\n\t */\n\tshowFilePicker: function (allowMultiple, accept, callback)\n\t{\n\t\tvar input = document.createElement(\"input\");\n\n\t\tinput.type = \"file\";\n\t\tinput.accept = accept;\n\t\tinput.style.display = 'none';\n\t\tinput.multiple = allowMultiple;\n\n\t\tdocument.body.appendChild(input);\n\n\t\tinput.onchange = function ()\n\t\t{\n\t\t\tcallback(input.files);\n\t\t};\n\n\t\tdocument.body.onfocus = function ()\n\t\t{\n\t\t\tdocument.body.onfocus = null;\n\t\t\tdocument.body.removeChild(input);\n\t\t};\n\n\t\tinput.click();\n\t},\n\n\t/**\n\t * Loads a file using FileReader and returns the result as a dataURL.\n\t * !static loadAsDataURL (file: File, callback: (dataUrl: string) => void) : void;\n\t */\n\tloadAsDataURL: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsDataURL(file);\n\t},\n\n\t/**\n\t * Loads a file using FileReader and returns the result as text.\n\t * !static loadAsText (file: File, callback: (text: string) => void) : void;\n\t */\n\tloadAsText: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsText(file);\n\t},\n\n\t/**\n\t * Loads a file using FileReader and returns the result as an array buffer.\n\t * !static loadAsArrayBuffer (file: File, callback: (buff: ArrayBuffer) => void) : void;\n\t */\n\tloadAsArrayBuffer: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsArrayBuffer(file);\n\t},\n\n\t/**\n\t * Loads an array of File objects using FileReader and returns them as data URLs.\n\t * !static loadAllAsDataURL (fileList: Array<File>, callback: (urlList: Array<{name:string, size:number, url:string}>) => void) : void;\n\t */\n\tloadAllAsDataURL: function (fileList, callback)\n\t{\n\t\tvar result = [];\n\n\t\tif (!fileList || !fileList.length)\n\t\t{\n\t\t\tcallback(result);\n\t\t\treturn;\n\t\t}\n\n\t\tvar loadNext = function (i)\n\t\t{\n\t\t\tif (i == fileList.length)\n\t\t\t{\n\t\t\t\tcallback(result);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tResources.loadAsDataURL (fileList[i], function(url) {\n\t\t\t\tresult.push({ name: fileList[i].name, size: fileList[i].size, url: url });\n\t\t\t\tloadNext(i+1);\n\t\t\t});\n\t\t};\n\n\t\tloadNext(0);\n\t}\n});\n\n//!/class\n\nexport default Resources;\n","/*\n**\tresources/sound.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Resources from './resources.js';\n\n//![import \"./resources\"]\n\n/*\n\ttrack: string (music|sfx)\n*/\n\nconst Sound = Class.extend\n({\n\tr: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"audio\")\n\t\t\tthrow new Error (\"Resource is not audio.\");\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tthis.track = Sound[this.r.track.toUpperCase()];\n\t},\n\n\tplay: function (callback, volume)\n\t{\n\t\treturn Sound.play (this, callback, volume);\n\t},\n\n\tplayLoop: function (callback, volume)\n\t{\n\t\treturn Sound.playLoop (this, callback, volume);\n\t}\n});\n\nSound.ENGINE_HTML5 = 1;\nSound.ENGINE_WEBAUDIO = 2;\nSound.ENGINE_NATIVEAUDIO = 3;\n\nObject.assign(Sound,\n{\n\tMASTER: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tSFX: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tMUSIC: {\n\t\tenabled: true,\n\t\tvolume: 0.8\n\t},\n\n\tVOICE: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tMAX_POOL_SIZE: 100,\n\n\tpool: [ ],\n\tactive: [ ],\n\n\tregister: function (node)\n\t{\n\t\tif (node.registered) return;\n\n\t\tnode.registered = true;\n\t\tthis.active.push(node);\n\t},\n\n\tunregister: function (node)\n\t{\n\t\tif (!node.registered) return;\n\n\t\tnode.registered = false;\n\n\t\tvar i = Sound.active.indexOf(node);\n\t\tif (i == -1) return;\n\n\t\tSound.active.splice(i, 1);\n\t},\n\n\tupdateNode: function (node, cmd)\n\t{\n\t\tswitch (node.snd.r.engine)\n\t\t{\n\t\t\tcase Sound.ENGINE_WEBAUDIO:\n\t\t\t\treturn this.updateNode_webaudio(node, cmd);\n\n\t\t\tcase Sound.ENGINE_NATIVEAUDIO:\n\t\t\t\treturn this.updateNode_nativeaudio(node, cmd);\n\t\t}\n\n\t\treturn this.updateNode_audio(node, cmd);\n\t},\n\n\t// Web Audio.\n\talloc_webaudio: function (node)\n\t{\n\t\tnode.gainNode = audioContext.createGain();\n\t\tnode.gainNode.gain.value = 0;\n\t\tnode.gainNode.connect(audioContext.destination);\n\n\t\tnode.res = audioContext.createBufferSource();\n\t\tnode.res.buffer = node.snd.r.data;\n\t\tnode.res.loop = false;\n\t\tnode.res.connect(node.gainNode);\n\t\tnode.res.node = node;\n\t},\n\n\tfree_webaudio: function (node)\n\t{\n\t\tif (!node.res) return;\n\n\t\tnode.gainNode.disconnect();\n\n\t\tnode.res = null;\n\t\tnode.gainNode = null;\n\t},\n\n\t// Native Audio (Cordova plugin).\n\talloc_nativeaudio: function (node)\n\t{\n\t\tnode.res = true;\n\t},\n\n\tfree_nativeaudio: function (node)\n\t{\n\t\tnode.res = false;\n\t},\n\n\t// HTML5 Audio.\n\talloc_audio: function (node)\n\t{\n\t\tif (!this.pool.length)\n\t\t\titem = node.cloneNode();\n\t\telse\n\t\t\titem = this.pool.pop();\n\n\t\titem._src = node.src;\n\t\treturn item;\n\t},\n\n\tfree_audio: function (node)\n\t{\n\t\tif (this.pool.length == this.MAX_POOL_SIZE)\n\t\t\treturn;\n\n\t\t//BUG: This causes a GET request of \"/null\" on Chromium.\n\t\t//node.src = null;\n\n\t\tthis.pool.push(node);\n\t},\n\n\t/* *********************** */\n\tupdateNode_webaudio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tvar volume = Sound.MASTER.volume * node.snd.track.volume * node.volume;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t\tSound.alloc_webaudio(node);\n\n\t\t\t\tnode.playTime = hrnow();\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.onended = Sound.onended_webaudio;\n\t\t\t\tnode.gainNode.gain.value = volume;\n\n\t\t\t\ttry {\n\t\t\t\t\tnode.res.start(0, node.startTime/1000.0);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_webaudio(node);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.gainNode.gain.value = volume;\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\n\t\t\t\t\tSound.free_webaudio(node);\n\t\n\t\t\t\t\tif (node.callback) node.callback();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\t\t\t\tnode.res.onended = null;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tnode.res.stop();\n\n\t\t\t\tSound.free_webaudio(node);\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime += hrnow() - node.playTime;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = true;\n\t\t\t\tnode.res.onended = null;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tnode.res.stop();\n\n\t\t\t\tSound.free_webaudio(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.loop = false;\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_webaudio: function (e)\n\t{\n\t\tvar node = e.currentTarget.node;\n\n\t\tif (node.playing && node.loop != 0)\n\t\t{\n\t\t\tSound.free_webaudio(node);\n\n\t\t\tif (node.loop != -1)\n\t\t\t\tnode.loop--;\n\n\t\t\tnode.startTime = 0;\n\t\t\tnode.playing = false;\n\t\t\tnode.pause = false;\n\n\t\t\tSound.updateNode_webaudio (node, 'play');\n\t\t\treturn;\n\t\t}\n\n\t\tnode.res.onended = null;\n\t\tnode.res.volume = 0;\n\n\t\tSound.updateNode_webaudio (node, 'stop');\n\t},\n\n\t/* *********************** */\n\tupdateNode_nativeaudio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t\tSound.alloc_nativeaudio(node);\n\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\ttry {\n\t\t\t\t\tglobal.plugins.NativeAudio.play (node.snd.r.data, null, null, function() { Sound.onended_nativeaudio(node); } );\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_nativeaudio(node);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tglobal.plugins.NativeAudio.stop (node.snd.r.data, null);\n\n\t\t\t\tSound.free_nativeaudio(node);\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_nativeaudio: function (node)\n\t{\n\t\tSound.updateNode_nativeaudio (node, 'stop');\n\t},\n\n\tupdateNode_audio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tvar volume = Sound.MASTER.volume * node.snd.track.volume * node.volume;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t{\n\t\t\t\t\tnode.res = Sound.alloc_audio (node.snd.r.data);\n\t\t\t\t\tnode.res.node = node;\n\t\t\t\t\tnode.res.src = node.res._src;\n\t\t\t\t}\n\n\t\t\t\tnode.playTime = hrnow();\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.onended = Sound.onended_audio;\n\t\t\t\tnode.res.currentTime = node.startTime/1000.0;\n\t\t\t\tnode.res.volume = volume;\n\n\t\t\t\ttry {\n\t\t\t\t\tnode.res.play();\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_audio (node.res);\n\t\t\t\t\tnode.res = null;\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.res.volume = volume;\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\n\t\t\t\t\tSound.free_audio (node.res);\n\t\t\t\t\tnode.res = null;\n\t\n\t\t\t\t\tif (node.callback) node.callback();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tSound.unregister (node);\n\t\t\t\tnode.res.pause();\n\n\t\t\t\tSound.free_audio (node.res);\n\t\t\t\tnode.res = null;\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime += hrnow() - node.playTime;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = true;\n\n\t\t\t\tSound.unregister (node);\n\t\t\t\tnode.res.pause();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_audio: function (e)\n\t{\n\t\tvar node = e.currentTarget.node;\n\n\t\tif (node.playing && node.loop != 0)\n\t\t{\n\t\t\tif (node.loop != -1)\n\t\t\t\tnode.loop--;\n\n\t\t\tnode.startTime = 0;\n\t\t\tnode.playing = false;\n\t\t\tnode.pause = false;\n\n\t\t\tSound.updateNode_audio (node, 'play');\n\t\t\treturn;\n\t\t}\n\n\t\tnode.res.onended = null;\n\t\tnode.res.volume = 0;\n\n\t\tSound.updateNode_audio (node, 'stop');\n\t},\n\n\t/* *************************************** */\n\t/* PUBLIC */\n\n\tenableTrack: function (track)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.enabled = true;\n\t},\n\n\tdisableTrack: function (track)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.enabled = false;\n\t},\n\n\tsetVolume: function (track, value)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.volume = value;\n\t},\n\n\tcreateNode: function (snd, volume)\n\t{\n\t\tvar node = { };\n\n\t\tnode.startVolume = volume;\n\t\tnode.volume = volume;\n\t\tnode.snd = snd;\n\t\tnode.loop = 0;\n\t\tnode.playing = false;\n\t\tnode.paused = false;\n\t\tnode.startTime = 0;\n\t\tnode.playTime = 0;\n\t\tnode.callback = null;\n\t\tnode.timer = null;\n\t\tnode.res = null;\n\n\t\treturn node;\n\t},\n\n\tplay: function (snd, completeCallback, volume)\n\t{\n\t\tif (!this.MASTER.enabled || !snd || !snd.track.enabled)\n\t\t\treturn null;\n\n\t\tvar volume = (volume !== undefined && volume !== null) ? volume : 1.0;\n\n\t\tvar node = this.createNode(snd, volume);\n\t\tnode.callback = completeCallback;\n\n\t\treturn this.updateNode(node, 'play');\n\t},\n\n\tplayLoop: function (snd, completeCallback, volume)\n\t{\n\t\tif (!this.MASTER.enabled || !snd || !snd.track.enabled)\n\t\t\treturn null;\n\n\t\tvolume = (volume !== undefined && volume !== null) ? volume : 1.0;\n\t\n\t\tvar node = this.createNode(snd, volume);\n\t\tnode.callback = completeCallback;\n\t\tnode.loop = -1;\n\n\t\treturn this.updateNode(node, 'play');\n\t},\n\n\tstop: function (node, callback)\n\t{\n\t\tif (!node) return null;\n\n\t\tif (callback && callback !== true) node.callback = callback;\n\t\treturn this.updateNode(node, callback === true ? 'stop' : 'softstop');\n\t},\n\n\tpause: function (node)\n\t{\n\t\tif (!node) return null;\n\n\t\treturn this.updateNode(node, 'pause');\n\t},\n\n\tresume: function (node)\n\t{\n\t\tif (!node) return null;\n\n\t\treturn this.updateNode (node, 'play');\n\t},\n\n\tfadeOut: function (node, millis, callback)\n\t{\n\t\tif (!node) return;\n\n\t\tif (!node.playing || node.timer)\n\t\t{\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar startTime = hrnow();\n\t\tnode.startVolume = node.volume;\n\n\t\tnode.timer = setInterval (function()\n\t\t{\n\t\t\tvar t = ((hrnow() - startTime) / millis);\n\t\t\tif (t > 1) t = 1;\n\n\t\t\tnode.volume = node.startVolume*(1-t);\n\t\t\tSound.updateNode(node, 'setvolume');\n\n\t\t\tif (t == 1)\n\t\t\t{\n\t\t\t\tclearInterval (node.timer);\n\t\t\t\tnode.timer = null;\n\n\t\t\t\tif (callback === true)\n\t\t\t\t\tSound.updateNode(node, 'stop');\n\t\t\t\telse\n\t\t\t\t\tSound.updateNode(node, 'pause');\n\n\t\t\t\tif (callback && callback !== true)\n\t\t\t\t\tcallback();\n\t\t\t}\n\t\t},\n\t\t50);\n\t},\n\n\tfadeIn: function (node, millis, callback)\n\t{\n\t\tif (!node) return;\n\n\t\tif (node.playing || node.timer)\n\t\t{\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar startTime = hrnow();\n\n\t\tnode.volume = 0;\n\t\tthis.updateNode(node, 'play');\n\n\t\tnode.timer = setInterval (function()\n\t\t{\n\t\t\tvar t = ((hrnow() - startTime) / millis);\n\t\t\tif (t > 1) t = 1;\n\n\t\t\tnode.volume = node.startVolume*t;\n\t\t\tSound.updateNode(node, 'setvolume');\n\n\t\t\tif (t == 1)\n\t\t\t{\n\t\t\t\tclearInterval (node.timer);\n\t\t\t\tnode.timer = null;\n\n\t\t\t\tif (callback) callback();\n\t\t\t}\n\t\t},\n\t\t50);\n\t}\n});\n\n/**\n * \tCreates a descriptor for an audio resource.\n */\nResources.Audio = function (src, opts=null)\n{\n\treturn { type: \"audio\", wrapper: \"Sound\", src: src, ...opts };\n};\n\nexport default Sound;\n","/*\n**\tresources/sound-array.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Sound from './sound.js';\n\n//![import \"./sound.js\"]\n\n/*\n\ttrack: string (music|sfx)\n\tmode: sequential|random\n*/\n\nexport default Class.extend\n({\n\tr: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"audios\")\n\t\t\tthrow new Error (\"Resource is not audios.\");\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tif (!this.r.track)\n\t\t\tthis.r.track = \"sfx\";\n\n\t\tif (!this.r.mode)\n\t\t\tthis.r.mode = \"random\";\n\n\t\tthis.track = Sound[this.r.track.toUpperCase()];\n\n\t\tthis.sounds = [];\n\t\tthis.lastIndex = -1;\n\n\t\tfor (var i = 0; i < this.r.data.length; i++)\n\t\t{\n\t\t\tthis.sounds.push(new Sound (Object.assign (this.r.data[i], { track: this.r.track })));\n\t\t}\n\t},\n\n\tgetRandomSound: function ()\n\t{\n\t\tif (this.r.mode == \"random\")\n\t\t\treturn this.sounds[randr(0, this.sounds.length-1)];\n\n\t\tthis.lastIndex = ++this.lastIndex % this.sounds.length;\n\t\treturn this.sounds[this.lastIndex];\n\t},\n\n\tplay: function (callback, volume)\n\t{\n\t\treturn Sound.play (this.getRandomSound(), callback, volume);\n\t},\n\n\tplayLoop: function (callback, volume)\n\t{\n\t\treturn Sound.playLoop (this.getRandomSound(), callback, volume);\n\t},\n\n\tplayAt: function (index, callback, volume)\n\t{\n\t\treturn Sound.play (this.sounds[index % this.sounds.length], callback, volume);\n\t},\n\n\tplayLoopAt: function (index, callback, volume)\n\t{\n\t\treturn Sound.playLoop (this.sounds[index % this.sounds.length], callback, volume);\n\t}\n});\n","/*\n**\tresources/wrappers.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n//![import './drawable']\nimport _Drawable from './drawable.js'; export const Drawable = _Drawable;\n//![import './custom']\nimport _Custom from './custom.js'; export const Custom = _Custom;\n//![import './spritesheet']\nimport _Spritesheet from './spritesheet.js'; export const Spritesheet = _Spritesheet;\n//![import './spritesheet-animation']\nimport _SpritesheetAnimation from './spritesheet-animation.js'; export const SpritesheetAnimation = _SpritesheetAnimation;\n//![import './spritefont']\nimport _SpriteFont from './spritefont.js'; export const SpriteFont = _SpriteFont;\n//![import './sound']\nimport _Sound from './sound.js'; export const Sound = _Sound;\n//![import './sound-array']\nimport _SoundArray from './sound-array.js'; export const SoundArray = _SoundArray;\n","/*\n**\tutils/priority-queue.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\n\n//!class PriorityQueue\n\nexport default Class.extend\n({\n\tclassName: 'PriorityQueue',\n\n\tqueue: null,\n\tqueueKeys: null,\n\torder: null,\n\n\t/**\n\t * \tConstructs an priority queue.\n\t * \t!constructor();\n\t */\n\t__ctor: function()\n\t{\n\t\tthis.queue = { };\n\t\tthis.queueKeys = [];\n\t},\n\n\t/**\n\t * \tAdds an object to the priority queue.\n\t * \t!add (obj: object) : object;\n\t */\n\tadd: function (object)\n\t{\n\t\tif (object == null)\n\t\t\treturn null;\n\n\t\tif (!('priority' in object))\n\t\t\tobject.priority = 50;\n\n\t\tif (!(object.priority in this.queue))\n\t\t{\n\t\t\tthis.queue[object.priority] = { is_dirty: false, list: [ ] };\n\t\t\tthis.queueKeys.push(object.priority);\n\n\t\t\tthis.order = Object.keys(this.queue).sort((a,b) => a-b);\n\t\t}\n\n\t\tif (this.queue[object.priority].list.indexOf(object) === -1)\n\t\t\tthis.queue[object.priority].list.push(object);\n\n\t\treturn object;\n\t},\n\n\t/**\n\t * \tMarks an object to be removed from the priority queue. Use `cleanup` to actually remove them.\n\t * \t!remove (obj: object) : object;\n\t */\n\tremove: function (object)\n\t{\n\t\tif (object == null)\n\t\t\treturn null;\n\n\t\tif (!('priority' in object))\n\t\t\tobject.priority = 50;\n\n\t\tif (!(object.priority in this.queue))\n\t\t\treturn object;\n\n\t\tlet i = this.queue[object.priority].list.indexOf(object);\n\t\tif (i === -1) return object;\n\n\t\tthis.queue[object.priority].is_dirty = true;\n\t\tthis.queue[object.priority].list[i] = null;\n\n\t\treturn object;\n\t},\n\n\t/**\n\t * \tRuns a cleanup of the queue by removing any objects marked to be removed.\n\t * \t!cleanup() : void;\n\t */\n\tcleanup: function()\n\t{\n\t\tfor (let i = 0; i < this.queueKeys.length; i++)\n\t\t{\n\t\t\tlet q = this.queue[this.queueKeys[i]];\n\t\t\tif (!q.is_dirty) continue;\n\n\t\t\tfor (let j = 0; j < q.list.length; j++)\n\t\t\t{\n\t\t\t\tif (q.list[j] == null)\n\t\t\t\t{\n\t\t\t\t\tq.list.splice(j--, 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tq.is_dirty = false;\n\t\t}\n\t},\n\n\t/**\n\t * \tRuns the specified callback for each object in the queue. Executed in order of priority (from low number to high number).\n\t * \t@param callback - Return `false` to stop the forEach execution immediately.\n\t * \t!forEach (callback: (obj: object) => boolean) : void;\n\t */\n\tforEach: function (callback)\n\t{\n\t\tlet is_dirty = false;\n\t\tlet is_complete = false;\n\n\t\tfor (let i = 0; !is_complete && i < this.order.length; i++)\n\t\t{\n\t\t\tlet list = this.queue[this.order[i]].list;\n\n\t\t\tfor (let j = 0; !is_complete && j < list.length; j++)\n\t\t\t{\n\t\t\t\tif (list[j] != null)\n\t\t\t\t{\n\t\t\t\t\tif (callback(list[j]) === false)\n\t\t\t\t\t\tis_complete = true;\n\t\t\t\t}\n\n\t\t\t\tif (list[j] == null)\n\t\t\t\t\tis_dirty = true;\n\t\t\t}\n\t\t}\n\n\t\tif (is_dirty) this.cleanup();\n\t},\n\n\t/**\n\t * \tRuns the specified callback for each object in the queue. Executed in reverse order of priority (from high number to low number).\n\t * \t@param callback - Return `false` to stop the forEachRev execution immediately.\n\t * \t!forEachRev (callback: (obj: object) => boolean) : void;\n\t */\n\tforEachRev: function (callback)\n\t{\n\t\tlet is_dirty = false;\n\t\tlet is_complete = false;\n\n\t\tfor (let i = this.order.length-1; !is_complete && i >= 0; i--)\n\t\t{\n\t\t\tlet list = this.queue[this.order[i]].list;\n\n\t\t\tfor (let j = list.length-1; !is_complete && j >= 0; j--)\n\t\t\t{\n\t\t\t\tif (list[j] != null)\n\t\t\t\t{\n\t\t\t\t\tif (callback(list[j]) === false)\n\t\t\t\t\t\tis_complete = true;\n\t\t\t\t}\n\n\t\t\t\tif (list[j] == null)\n\t\t\t\t\tis_dirty = true;\n\t\t\t}\n\t\t}\n\n\t\tif (is_dirty) this.cleanup();\n\t},\n\n\t/**\n\t * \tRuns the specified callback for each object in the queue. Executed in order of priority (from low number to high number). When\n\t * \tthe cycle finishes the given `finishedCallback` will be executed.\n\t * \t@param callback - Return `false` to stop the forEachAsync execution immediately. Must manually execute `next` when finished.\n\t * \t!forEachAsync (callback: (obj: object, next: Function) => boolean) : void;\n\t */\n\tforEachAsync: function (callback, finishedCallback=null)\n\t{\n\t\tlet _ = this;\n\n\t\tlet is_dirty = false;\n\t\tlet is_complete = false;\n\n\t\tlet i = -1;\n\t\tlet j = -1;\n\n\t\tlet list = null;\n\n\t\tlet next_j = function()\n\t\t{\n\t\t\tj++;\n\n\t\t\tif (!is_complete && j < list.length)\n\t\t\t{\n\t\t\t\tif (list[j] != null)\n\t\t\t\t{\n\t\t\t\t\tif (callback(list[j], next_j) === false)\n\t\t\t\t\t\tis_complete = true;\n\t\t\t\t}\n\n\t\t\t\tif (list[j] == null)\n\t\t\t\t\tis_dirty = true;\n\n\t\t\t\tif (is_complete) next_j();\n\t\t\t}\n\t\t\telse\n\t\t\t\tnext_i();\n\t\t};\n\n\t\tlet next_i = function()\n\t\t{\n\t\t\ti++;\n\n\t\t\tif (!is_complete && i < _.order.length)\n\t\t\t{\n\t\t\t\tlist = _.queue[_.order[i]].list;\n\t\t\t\tj = -1;\n\t\t\t\tnext_j();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (is_dirty) _.cleanup();\n\t\t\t\tif (finishedCallback) finishedCallback();\n\t\t\t}\n\t\t};\n\n\t\tnext_i();\n\t},\n\n\t/**\n\t * \tRuns the specified callback for each object in the queue. Executed in reverse order of priority (from high number to low number). When\n\t * \tthe cycle finishes the given `finishedCallback` will be executed.\n\t * \t@param callback - Return `false` to stop the forEachRevAsync execution immediately. Must manually execute `next` when finished.\n\t * \t!forEachRevAsync (callback: (obj: object, next: Function) => boolean) : void;\n\t */\n\tforEachRevAsync: function (callback)\n\t{\n\t\talert('NOT IMPLEMENTED: forEachRevAsync');\n\t}\n});\n","/*\n**\tutils/callback.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Recycler from './recycler.js';\n\n//![import \"./recycler\"]\n\n//:/**\n//: * \tDefines a callback node. Contains a callback function, and up to six arguments.\n//: */\n\n//!class Callback\n\nconst Callback = Class.extend\n({\n\tclassName: 'Callback',\n\n\t/*\n\t**\tCallback function.\n\t*/\n\tcallback: null,\n\n\t/*\n\t**\tOptional arguments.\n\t*/\n\targ0: null,\n\targ1: null,\n\targ2: null,\n\targ3: null,\n\targ4: null,\n\targ5: null,\n\n\t/*\n\t**\tLink to the previous and next callback.\n\t*/\n\tprev: null,\n\tnext: null,\n\n\t/**\n\t * \tInitializes the callback with the specified arguments.\n\t * \t!constructor (callback: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any);\n\t */\n\t__ctor: function (callback, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tthis.callback = callback;\n\n\t\tthis.arg0 = arg0;\n\t\tthis.arg1 = arg1;\n\t\tthis.arg2 = arg2;\n\t\tthis.arg3 = arg3;\n\t\tthis.arg4 = arg4;\n\t\tthis.arg5 = arg5;\n\n\t\tthis.prev = null;\n\t\tthis.next = null;\n\t},\n\n\t/*\n\t**\tDestructs the instance.\n\t*/\n\t__dtor: function()\n\t{\n\t\tthis.callback = null;\n\n\t\tthis.arg0 = null;\n\t\tthis.arg1 = null;\n\t\tthis.arg2 = null;\n\t\tthis.arg3 = null;\n\t\tthis.arg4 = null;\n\t\tthis.arg5 = null;\n\n\t\tthis.prev = null;\n\t\tthis.next = null;\n\t},\n\n\t/*\n\t**\tReturns true if the specified arguments are the same as the callback. Compares from left to right. All null values are ignored.\n\t*/\n\tisEqual: function (callback=null, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tif (callback !== null && Callback.isInstance(callback))\n\t\t\treturn callback === this;\n\n\t\tif (callback !== null && this.callback !== callback)\n\t\t\treturn false;\n\n\t\tif (arg0 !== null && this.arg0 !== arg0)\n\t\t\treturn false;\n\n\t\tif (arg1 !== null && this.arg1 !== arg1)\n\t\t\treturn false;\n\n\t\tif (arg2 !== null && this.arg2 !== arg2)\n\t\t\treturn false;\n\n\t\tif (arg3 !== null && this.arg3 !== arg3)\n\t\t\treturn false;\n\n\t\tif (arg4 !== null && this.arg4 !== arg4)\n\t\t\treturn false;\n\n\t\tif (arg5 !== null && this.arg5 !== arg5)\n\t\t\treturn false;\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tExecutes the callback. Returns `false` if the callback has finished and should be removed.\n\t * \t@param host - Host object.\n\t * \t!exec (host: Object) : boolean;\n\t */\n\texec: function (host)\n\t{\n\t\tif (this.callback !== null)\n\t\t\treturn this.callback (host, this.arg0, this.arg1, this.arg2, this.arg3, this.arg4, this.arg5);\n\n\t\treturn true;\n\t}\n});\n\n//!/class\n\n//!namespace Callback\n//!namespace Pool\n\n/**\n * \tAllocates a callback with the specified arguments.\n * \t!function alloc (callback: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) : Callback;\n */\n\nRecycler.createPool(Callback, 16384, 6144);\nexport default Callback;\n","/*\n**\tutils/handler.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Recycler from './recycler.js';\nimport Callback from './callback.js';\n\n//![import \"./recycler\"]\n//![import \"./callback\"]\n\n//:/**\n//: * \tThe handler class allows zero or more callbacks to be attached, such that when the `exec` method of the handler is invoked, all attached callbacks will also be executed.\n//: */\n\n//!class Handler\n\nconst Handler = Class.extend\n({\n\tclassName: 'Handler',\n\n\t/**\n\t * \tHandler host element or value.\n\t * \t!host: any;\n\t */\n\thost: null,\n\n\t/**\n\t * \tTop and bottom of the linked list.\n\t */\n\ttop: null,\n\tbottom: null,\n\n\t/**\n\t * \tInitializes the Handler instance.\n\t * \t!constructor (host?: any);\n\t */\n\t__ctor: function (host=null)\n\t{\n\t\tthis.host = host;\n\n\t\tthis.top = null;\n\t\tthis.bottom = null;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tRemoves all callbacks from the handler.\n\t*/\n\t__dtor: function()\n\t{\n\t\tthis.remove();\n\t},\n\n\t/**\n\t * \tAdds the specified callback to the handler.\n\t * \t!add (callback: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) : Callback;\n\t */\n\tadd: function (callback, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tlet node = Callback.isInstance(callback) ? callback : Callback.Pool.alloc(callback, arg0, arg1, arg2, arg3, arg4, arg5);\n\n\t\tnode.prev = this.bottom;\n\n\t\tif (this.bottom !== null)\n\t\t\tthis.bottom.next = node;\n\n\t\tthis.bottom = node;\n\n\t\tif (this.top === null)\n\t\t\tthis.top = node;\n\n\t\treturn node;\n\t},\n\n\t/**\n\t * \tUnlinks a callback from the handler.\n\t * \t!unlink (node: Callback) : Handler;\n\t */\n\tunlink: function (node)\n\t{\n\t\tif (node.prev) node.prev.next = node.next;\n\t\tif (node.next) node.next.prev = node.prev;\n\n\t\tif (this.top === node)\n\t\t\tthis.top = node.next;\n\n\t\tif (this.bottom === node)\n\t\t\tthis.bottom = node.prev;\n\n\t\tnode.prev = null;\n\t\tnode.next = null;\n\n\t\tdispose(node);\n\t},\n\n\t/**\n\t * \tRemoves all callbacks matching the specified arguments.\n\t * \t!remove (callback?: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) : Handler;\n\t */\n\tremove: function (callback=null, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tif (callback !== null && Callback.isInstance(callback))\n\t\t{\n\t\t\tthis.unlink(callback);\n\t\t\treturn this;\n\t\t}\n\n\t\tlet node = this.top;\n\n\t\twhile (node !== null)\n\t\t{\n\t\t\tlet next = node.next;\n\n\t\t\tif (node.isEqual(callback, arg0, arg1, arg2, arg3, arg4, arg5))\n\t\t\t\tthis.unlink(node);\n\n\t\t\tnode = next;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the first callback matching the specified arguments.\n\t * \t!find (callback: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) : Callback;\n\t */\n\tfind: function (callback, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tlet node = this.top;\n\n\t\twhile (node !== null)\n\t\t{\n\t\t\tif (node.isEqual(callback, arg0, arg1, arg2, arg3, arg4, arg5))\n\t\t\t\treturn node;\n\n\t\t\tnode = node.next;\n\t\t}\n\n\t\treturn null;\n\t},\n\n\t/**\n\t * \tExecutes all callbacks in the handler.\n\t * \t!exec(host?: any) : void;\n\t */\n\texec: function (host=null)\n\t{\n\t\tlet node = this.top;\n\n\t\thost = host ?? this.host;\n\n\t\twhile (node !== null)\n\t\t{\n\t\t\tlet next = node.next;\n\n\t\t\tif (node.exec(host) === false)\n\t\t\t\tthis.unlink(node);\n\n\t\t\tnode = next;\n\t\t}\n\t},\n\n\t/**\n\t * \tExecutes the first callback matching the specified arguments.\n\t * \t!execf (callback?: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) : void;\n\t */\n\texecf: function (callback=null, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tlet node = this.top;\n\n\t\twhile (node !== null)\n\t\t{\n\t\t\tlet next = node.next;\n\n\t\t\tif (node.isEqual(callback, arg0, arg1, arg2, arg3, arg4, arg5))\n\t\t\t{\n\t\t\t\tif (node.exec(this.host) === false)\n\t\t\t\t\tthis.unlink(node);\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tnode = next;\n\t\t}\n\t},\n\n\t/**\n\t * \tExecutes the specified callback.\n\t * \t!execc (node: Callback, host?: any) : void;\n\t */\n\texecc: function (node, host=null)\n\t{\n\t\tif (node.exec(host ?? this.host) === false)\n\t\t\tthis.unlink(node);\n\t}\n});\n\n//!/class\n\n//!namespace Handler\n//!namespace Pool\n\n/**\n * \tAllocates a new handler instance.\n * \t!function alloc (host?: Object) : Handler;\n */\n\nRecycler.createPool(Handler, 16384, 6144);\nexport default Handler;\n","/*\n**\tmath/rect.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"../utils/recycler\"]\n//![import \"./vec2\"]\n\n//:/**\n//: * \tRepresents a 2D rectangle.\n//: */\n\n//!class Rect\n\nconst Rect = Class.extend\n({\n\tclassName: 'Rect',\n\n\t/**\n\t * \tCoordinates of the rectangle (cx and cy are for the center). Note that this fields are readonly they should be\n\t * \tmodified through methods only.\n\t */\n\n\t/**\n\t * \t!readonly cx: number;\n\t */\n\tcx: 0,\n\t/**\n\t * \t!readonly cy: number;\n\t */\n\tcy: 0,\n\t/**\n\t * \t!readonly x1: number;\n\t */\n\tx1: 0,\n\t/**\n\t * \t!readonly y1: number;\n\t */\n\ty1: 0,\n\t/**\n\t * \t!readonly x2: number;\n\t */\n\tx2: 0,\n\t/**\n\t * \t!readonly y2: number;\n\t */\n\ty2: 0,\n\n\t/**\n\t * \tConstructs a rectangle of zero size, centered at (0, 0).\n\t * \t!constructor();\n\t */\n\t/**\n\t * \tConstructs a rectangle centered at (0, 0) with the specified size.\n\t * \t!constructor (width: number, height: number);\n\t */\n\t/**\n\t * \tConstructs a rectangle with the specified coordinates.\n\t * \t!constructor (x1: number, y1: number, x2: number, y2: number);\n\t */\n\t__ctor: function (x1=null, y1=null, x2=null, y2=null)\n\t{\n\t\tif (x1 === null)\n\t\t{\n\t\t\tthis.x1 = this.y1 = this.x2 = this.y2 = this.cx = this.cy = 0;\n\t\t\treturn this;\n\t\t}\n\n\t\tif (x2 === null)\n\t\t{\n\t\t\tthis.set (0, 0, 0, 0);\n\t\t\tthis.resize (x1, y1);\n\t\t\treturn this;\n\t\t}\n\n\t\treturn this.set(x1, y1, x2, y2);\n\t},\n\n\t/*\n\t**\tDestructor.\n\t*/\n\t__dtor: function ()\n\t{\n\t},\n\n\t/**\n\t * \tReturns a clone of the rectangle.\n\t * \t!clone() : Rect;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Rect.Rool.alloc(this.x1, this.y1, this.x2, this.y2);\n\t},\n\n\t/**\n\t * \tSets all coordinates of the rectangle to zero.\n\t * \t!zero() : Rect;\n\t */\n\tzero: function ()\n\t{\n\t\tthis.cx = 0; this.cy = 0;\n\t\tthis.x1 = 0; this.y1 = 0;\n\t\tthis.x2 = 0; this.y2 = 0;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets all coordinates of the rectangle to `null` for subsequent use with `extendWithPoint`.\n\t * \t!reset() : Rect;\n\t */\n\treset: function ()\n\t{\n\t\tthis.cx = null; this.cy = null;\n\t\tthis.x1 = null; this.y1 = null;\n\t\tthis.x2 = null; this.y2 = null;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tExtends the rectangle to contain the specified vector coordinates.\n\t * \t!extendWithPoint (v: Vec2) : Rect;\n\t */\n\t/**\n\t * \tExtends the rectangle to contain the specified point.\n\t * \t!extendWithPoint (x: number, y: number) : Rect;\n\t */\n\textendWithPoint: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tconst r = x;\n\t\t\tx = r.x;\n\t\t\ty = r.y;\n\t\t}\n\n\t\tif (this.x1 === null || x < this.x1) this.x1 = x;\n\t\tif (this.y1 === null || y < this.y1) this.y1 = y;\n\t\tif (this.x2 === null || x > this.x2) this.x2 = x;\n\t\tif (this.y2 === null || y > this.y2) this.y2 = y;\n\n\t\tthis.cx = (this.x1 + this.x2) / 2;\n\t\tthis.cy = (this.y1 + this.y2) / 2;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tTranslates the rectangle by the given deltas.\n\t * \t!translate (dx: number, dy: number) : Rect;\n\t */\n\ttranslate: function (dx, dy)\n\t{\n\t\tthis.x1 += dx; this.y1 += dy;\n\t\tthis.x2 += dx; this.y2 += dy;\n\t\tthis.cx += dx; this.cy += dy;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMoves the center of the rectangle to the specified position.\t \n\t * \t@param normalized - When `true` the arguments `x` and `y` are treated as normalized ranging from 0 to 1 (inclusive).\n\t * \t!centerAt (x: number, y: number, normalized?: false) : Rect;\n\t */\n\tcenterAt: function (x, y, normalized=false)\n\t{\n\t\tif (normalized == true)\n\t\t{\n\t\t\tx = this.x1 + x*(this.x2 - this.x1);\n\t\t\ty = this.y1 + y*(this.y2 - this.y1);\n\t\t}\n\n\t\treturn this.translate (x - this.cx, y - this.cy);\n\t},\n\n\t/**\n\t * \tCopies the coordinates of the specified rectangle.\n\t * \t!set (r: Rect) : Rect;\n\t */\n\t/**\n\t * \tSets the coordinates of the rectangle.\n\t * \t!set (x1: number, y1: number, x2: number, y2: number) : Rect;\n\t */\n\tset: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\tthis.cx = (x1 + x2) / 2;\n\t\tthis.cy = (y1 + y2) / 2;\n\n\t\tthis.x1 = x1;\n\t\tthis.y1 = y1;\n\t\tthis.x2 = x2;\n\t\tthis.y2 = y2;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns `true` if the given rectangle coordinates are equal.\n\t * \t!equals (r: Rect) : boolean;\n\t */\n\t/**\n\t * \tReturns `true` if the coordinates are equal.\n\t * \t!equals (x1: number, y1: number, x2: number, y2: number) : boolean;\n\t */\n\tequals: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\treturn x1 == this.x1 && x2 == this.x2 && y1 == this.y1 && y2 == this.y2;\n\t},\n\n\t/**\n\t * \tReturns `true` if the specified rectangle is contained in the current one.\n\t * \t!contains (r: Rect) : boolean;\n\t */\n\t/**\n\t * \tReturns `true` if the specified rectangle is contained in the current one.\n\t * \t!contains (x1: number, y1: number, x2: number, y2: number) : boolean;\n\t */\n\tcontains: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\treturn (x1 == Math.max(this.x1, x1)) && (y1 == Math.max(this.y1, y1)) && (x2 == Math.min(this.x2, x2)) && (y2 == Math.min(this.y2, y2));\n\t},\n\n\t/**\n\t * \tSets the coordinates of the rectangle to the union of it and the given one.\n\t * \t!setAsUnion (r: Rect) : Rect;\n\t */\n\t/**\n\t * \tSets the coordinates of the rectangle to the union of it and the given one.\n\t * \t!setAsUnion (x1: number, y1: number, x2: number, y2: number) : Rect;\n\t */\n\tsetAsUnion: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\tthis.x1 = Math.min(this.x1, x1);\n\t\tthis.y1 = Math.min(this.y1, y1);\n\t\tthis.x2 = Math.max(this.x2, x2);\n\t\tthis.y2 = Math.max(this.y2, y2);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns `true` if the rectangles intersect.\n\t * \t!intersects (r: Rect) : boolean;\n\t */\n\t/**\n\t * \tReturns `true` if the rectangles intersect.\n\t * \t!intersects (x1: number, y1: number, x2: number, y2: number) : boolean;\n\t */\n\tintersects: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\tlet _x1 = Math.max(this.x1, x1);\n\t\tlet _y1 = Math.max(this.y1, y1);\n\t\tlet _x2 = Math.min(this.x2, x2);\n\t\tlet _y2 = Math.min(this.y2, y2);\n\n\t\treturn Math.max(0, _y2-_y1) * Math.max(0, _x2-_x1) > 0;\n\t},\n\n\t/**\n\t * \tSets the coordinates of the rectangle to the intersection of it and the given one.\n\t * \t@returns Boolean indicating if the intersection is non-empty.\n\t * \t!setAsIntersection (r: Rect) : boolean;\n\t */\n\t/**\n\t * \tSets the coordinates of the rectangle to the intersection of it and the given one.\n\t * \t@returns Boolean indicating if the intersection is non-empty.\n\t * \t!setAsIntersection (x1: number, y1: number, x2: number, y2: number) : boolean;\n\t */\n\tsetAsIntersection: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\tthis.x1 = Math.max(this.x1, x1);\n\t\tthis.y1 = Math.max(this.y1, y1);\n\t\tthis.x2 = Math.min(this.x2, x2);\n\t\tthis.y2 = Math.min(this.y2, y2);\n\n\t\treturn Math.max(0, this.y2-this.y1) * Math.max(0, this.x2-this.x1) > 0;\n\t},\n\n\t/**\n\t * \tResizes the rectangle to the given size using its center or top-left corner as reference.\n\t * \t@param topLeftRelative - When `true` reference will be top-left corner, set to `false` to use the center.\n\t * \t@param normalized - When `true` the `w` and `h` will be treated as normalized ranging from 0 to 1 (inclusive).\n\t * \t!resize (w: number, h: number, normalized?: boolean, topLeftRelative?: boolean) : Rect;\n\t */\n\tresize: function (w, h, topLeftRelative=false, normalized=false)\n\t{\n\t\tif (normalized == true)\n\t\t{\n\t\t\tw *= (this.x2 - this.x1);\n\t\t\th *= (this.y2 - this.y1);\n\t\t}\n\n\t\tif (topLeftRelative == true)\n\t\t{\n\t\t\tthis.x2 = this.x1 + w;\n\t\t\tthis.y2 = this.y1 + h;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tw /= 2; h /= 2;\n\n\t\t\tthis.x1 = this.cx - w; this.y1 = this.cy - h;\n\t\t\tthis.x2 = this.cx + w; this.y2 = this.cy + h;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResizes the rectangle using the specified deltas, relative to its center or top-left corner.\n\t * \t@param topLeftRelative - When `true` reference will be top-left corner, set to `false` to use the center.\n\t * \t!resizeBy (dw: number, dh: number, topLeftRelative?: boolean) : Rect;\n\t */\n\tresizeBy: function (dw, dh, topLeftRelative=false)\n\t{\n\t\tif (topLeftRelative == true)\n\t\t{\n\t\t\tthis.x2 += dw;\n\t\t\tthis.y2 += dh;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdw /= 2; dh /= 2;\n\n\t\t\tthis.x1 -= dw; this.y1 -= dh;\n\t\t\tthis.x2 += dw; this.y2 += dh;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the width of the rectangle.\n\t * \t!width() : number;\n\t */\n\twidth: function ()\n\t{\n\t\treturn this.x2 - this.x1;\n\t},\n\n\t/**\n\t * \tReturns the height of the rectangle.\t \n\t * \t!height() : number;\n\t */\n\theight: function ()\n\t{\n\t\treturn this.y2 - this.y1;\n\t},\n\n\t/**\n\t * \tReturns the normalized center X-coordinate of the rectangle.\n\t * \t!ncx() : number;\n\t */\n\tncx: function ()\n\t{\n\t\treturn (this.cx - this.x1) / (this.x2 - this.x1);\n\t},\n\n\t/**\n\t * \tReturns the normalized center Y-coordinate of the rectangle.\n\t * \t!ncy() : number;\n\t */\n\tncy: function ()\n\t{\n\t\treturn (this.cy - this.y1) / (this.y2 - this.y1);\n\t},\n\n\t/**\n\t * \tReturns `true` if the rectangle is a right rectangle, that is: x1 < x2 and y1 < y2.\n\t * \t!isRight() : boolean;\n\t */\n\tisRight: function ()\n\t{\n\t\treturn this.x1 <= this.x2 && this.y1 <= this.y2;\n\t},\n\n\t/**\n\t * \tReturns `true` if the specified point is contained in the rectangle.\n\t * \t@param tol - Used to specify a tolerance value (default is zero).\n\t * \t!containsPoint (x: number, y: number, tol?: number) : boolean;\n\t */\n\tcontainsPoint: function (x, y, tol=0)\n\t{\n\t\treturn (this.x1-tol <= x && x <= this.x2+tol) && (this.y1-tol <= y && y <= this.y2+tol);\n\t},\n\n\t/**\n\t * \tReturns the area of the rectangle.\n\t * \t@param strict - Indicates if the area is returned only if the rectangle is a right rectangle. \t \n\t * \t!area (strict?: boolean) : number;\n\t */\n\tarea: function (strict)\n\t{\n\t\treturn strict ? (this.isRight() ? (this.y2-this.y1)*(this.x2-this.x1) : 0) : ((this.y2-this.y1)*(this.x2-this.x1));\n\t},\n\n\t/**\n\t * \tSets the components of the rectangle to their rounded-down integer parts.\n\t * \t!floor() : Rect;\n\t */\n\tfloor: function()\n\t{\n\t\tthis.x1 = Math.floor(this.x1);\n\t\tthis.y1 = Math.floor(this.y1);\n\t\tthis.x2 = Math.floor(this.x2);\n\t\tthis.y2 = Math.floor(this.y2);\n\t\tthis.cx = Math.floor(this.cx);\n\t\tthis.cy = Math.floor(this.cy);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the components of the rectangle to their rounded-up integer parts.\n\t * \t!ceil() : Rect;\n\t */\n\tceil: function()\n\t{\n\t\tthis.x1 = Math.ceil(this.x1);\n\t\tthis.y1 = Math.ceil(this.y1);\n\t\tthis.x2 = Math.ceil(this.x2);\n\t\tthis.y2 = Math.ceil(this.y2);\n\t\tthis.cx = Math.ceil(this.cx);\n\t\tthis.cy = Math.ceil(this.cy);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the string representation of the rectangle.\n\t * \t!toString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn \"(\" + this.x1.toFixed(2) + \", \" + this.y1.toFixed(2) + \", \" + this.x2.toFixed(2) + \", \" + this.y2.toFixed(2) + \")\";\n\t},\n\n\t/**\n\t * \tFlattens the rectangle.\n\t * \t!flatten() : Array<number>;\n\t */\n\tflatten: function ()\n\t{\n\t\treturn [this.x1, this.y1, this.x2, this.y2];\n\t},\n\n\t/**\n\t * \tUnflattens the rectangle.\n\t * \t!unflatten(input: Array<number>) : Rect;\n\t */\n\tunflatten: function (o)\n\t{\n\t\tthis.set (o[0], o[1], o[2], o[3]);\n\t\treturn this;\n\t}\n});\n\n//!/class\n\n//!namespace Rect\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a new rectangle of zero size.\n\t * \t!function alloc() : Rect;\n\t */\n\t/**\n\t * \tAllocates a new rectangle centered at (0, 0) with the specified size.\n\t * \t!function alloc (width: number, height: number) : Rect;\n\t */\n\t/**\n\t * \tAllocates a new rectangle with the specified coordinates.\n\t * \t!function alloc (x1: number, y1: number, x2: number, y2: number) : Rect;\n\t */\n\nRecycler.createPool (Rect, 4096, 2048);\nexport default Rect;\n","/*\n**\tmath/tfunction.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\n\n//:/**\n//: * \tDescribes a function dependent of time (t-function), multiple sampling points (t,y) can be added, this class\n//: * \tprovides methods to access any value for a given time, or the integral of a time range.\n//: */\n\n//!class TFunction\n\nconst TFunction = Class.extend\n({\n\tclassName: 'TFunction',\n\n\t/**\n\t * \tContains the time values `t` in the t-function, for each time value there is a corresponding `y` and `f`.\n\t * \t!t: Array<number>;\n\t */\n\tt: null,\n\n\t/**\n\t * \tContains the values (y) for each of the time values (t) in the t-function.\n\t * \t!y: Array<number>;\n\t */\n\ty: null,\n\n\t/**\n\t * \tContains the easing function (f) for each of the time values (t).\n\t * \t!f: Array< (t:number) => number >;\n\t */\n\tf: null,\n\n\t/**\n\t * \tConstructs the time function.\n\t * \t@param value - Initial value of the t-function for t=0, defaults to 0.\n\t * \t!constructor (value?: number);\n\t */\n\t__ctor: function (value=0)\n\t{\n\t\tthis.reset(value);\n\t},\n\n\t/**\n\t * \tResets the t-function to its initial state.\n\t * \t@param value - Initial value of the t-function for t=0. Default is 0.\n\t * \t!reset (value?: number) : TFunction;\n\t */\n\treset: function (value=0)\n\t{\n\t\tthis.t = [0];\n\t\tthis.y = [value];\n\t\tthis.f = [null];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResets the t-function and copies data from the specified source.\n\t * \t@param src - Source TFunction.\n\t * \t@param t0 - Initial time, if none specified will be assumed to be the min time of the source.\n\t * \t@param t1 - Final time, if none specified will be assumed to the the max time of the source.\n\t * \t@returns A TFunction or `null` if the specified time range could not be resolved.\n\t * \t!copyFrom (src: TFunction, t0: number, t1: number) : TFunction;\n\t */\n\tcopyFrom: function (src, t0, t1)\n\t{\n\t\tthis.t = [];\n\t\tthis.y = [];\n\t\tthis.f = [];\n\n\t\tif (t0 == null && t1 == null)\n\t\t{\n\t\t\tfor (let i = 0; i < src.t.length; i++)\n\t\t\t{\n\t\t\t\tthis.t.push(src.t[i]);\n\t\t\t\tthis.y.push(src.y[i]);\n\t\t\t\tthis.f.push(src.f[i]);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\tif (t0 == null) t0 = src.t[0];\n\t\tif (t1 == null) t1 = src.t[src.t.length-1];\n\n\t\tif (t0 < src.t[0]) t0 = src.t[0];\n\n\t\tlet i0 = src.find(t0);\n\t\tlet i1 = src.find(t1);\n\n\t\tif (i0 == null) return null;\n\t\tif (i1 == null) return null;\n\n\t\tif (src.t[i0] != t0) {\n\t\t\tthis.set(t0, src.getAt(t0), src.f[i0]);\n\t\t\ti0++;\n\t\t}\n\n\t\tfor (let i = i0; i <= i1; i++)\n\t\t\tthis.set(src.t[i], src.y[i], src.f[i]);\n\n\t\tif (src.t[i1] != t1)\n\t\t{\n\t\t\tlet dt = (t1 - src.t[i1]) / Math.ceil(Math.log(t1 - src.t[i1]));\n\t\t\tlet t = this.t[this.t.length-1];\n\n\t\t\tif (dt <= 0) dt = 1;\ndt = t1-t; // Force just one step.\n\t\t\twhile (t != t1)\n\t\t\t{\n\t\t\t\tif (t+dt > t1)\n\t\t\t\t\tdt = t1 - t;\n\n\t\t\t\tt += dt;\n\t\t\t\tthis.set(float4(t), src.getAt(t), src.f[i1]);\n\t\t\t}\n\t\t}\n\t\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCreates a new t-function with the same values as the current one.\n\t * \t@param t0 - Initial time, if none specified will be assumed to be the min time of the source.\n\t * \t@param t1 - Final time, if none specified will be assumed to the the max time of the source.\n\t * \t!clone (t0: number, t1: number) : TFunction;\n\t */\n\tclone: function (t0, t1)\n\t{\n\t\treturn (new TFunction()).copyFrom(this, t0, t1);\n\t},\n\n\t/**\n\t * \tReturns the maximum time value in the t-function plus the given delta.\n\t * \t@param delta - Delta value to add to the result.\n\t * \t!endTime (delta?: number) : number;\n\t */\n\tendTime: function (delta=0)\n\t{\n\t\treturn this.t[this.t.length-1] + delta;\n\t},\n\n\t/**\n\t * \tReturns the start time of the t-function plus the given delta.\n\t * \t@param delta - Delta value to add to the result.\n\t * \t!startTime (delta?: number) : number;\n\t */\n\tstartTime: function (delta=0)\n\t{\n\t\treturn this.t[0] + delta;\n\t},\n\n\t/**\n\t * \tFinds the index of a sampling point whose sampling range contains the given time.\n\t * \t@param time - Time value to search.\n\t * \t@returns Index of the sampling point or `null` if not within range.\n\t * \t!find (time: number) : number|null;\n\t */\n\tfind: function (time)\n\t{\n\t\tif (time < this.t[0])\n\t\t\treturn null;\n\n\t\tconst n = this.t.length;\n\n\t\tfor (let i = 1; i < n; i++)\n\t\t{\n\t\t\tif (time < this.t[i])\n\t\t\t\treturn i-1;\n\t\t}\n\n\t\treturn n-1;\n\t},\n\n\t/**\n\t * \tSets a sampling point (t,y).\n\t * \t@param t - Time value of the sampling point.\n\t * \t@param y - Y-value for the given t.\n\t * \t@param f - Easing function.\n\t * \t!set (t: number, y: number, f?: (t: number) => number) : TFunction;\n\t */\n\tset: function (t, y, f=null)\n\t{\n\t\tlet i = this.find(t);\n\t\tif (i == null) return false;\n\n\t\tif (this.t[i] == t)\n\t\t{\n\t\t\tthis.y[i] = y;\n\t\t\tif (f != null) this.f[i] = f;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ti++;\n\t\t\tthis.t.splice(i, 0, t);\n\t\t\tthis.y.splice(i, 0, y);\n\t\t\tthis.f.splice(i, 0, f);\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tReturns the last Y-value in the t-function.\n\t *\t!get() : number;\n\t */\n\tget: function ()\n\t{\n\t\treturn this.y[this.y.length-1];\n\t},\n\n\t/**\n\t * \tReturns the Y-value in the t-function corresponding to some point in time (t).\n\t * \t@param t - Time (t) value.\n\t * \t!getAt (t: number) : number;\n\t */\n\tgetAt: function (t)\n\t{\n\t\tlet i0 = this.find(t);\n\t\tif (i0 == null) return 0;\n\n\t\tlet i1 = i0 + 1;\n\n\t\tif (this.t[i0] == t || i1 >= this.t.length || this.y[i0] == this.y[i1] || this.f[i0] == null)\n\t\t\treturn this.y[i0];\n\n\t\tif (this.f[i0] == null)\n\t\t\treturn this.y[i0];\n\n\t\tlet x = t;\n\t\tlet x0 = this.t[i0];\n\t\tlet x1 = this.t[i1];\n\t\tlet y0 = this.y[i0];\n\t\tlet y1 = this.y[i1];\n\n\t\tt = (x - x0) / (x1 - x0);\n\t\tt = this.f[i0](t);\n\n\t\treturn t*y1 + (1-t)*y0;\n\t},\n\n\t/**\n\t * \tReturns the approximate definite integral of the t-function for the given time range.\n\t * \t@param t0 - Initial time value, defaults to minimum time of the t-function.\n\t * \t@param t1 - Final time value, defaults to the maximum time of the t-function.\n\t * \t@param c0 - Constant of integration, defaults to 0.\n\t * \t@returns Definite integral of t-function from t0 to t1.\n\t * \t!integral (t0?: number, t1?: number, c0?: number) : number;\n\t */\n\tintegral: function (t0=null, t1=null, c0=0)\n\t{\n\t\tif (t0 == null) t0 = this.t[0];\n\t\tif (t1 == null) t1 = this.t[this.t.length-1];\n\n\t\tif (t0 < this.t[0]) t0 = this.t[0];\n\n\t\tlet sign = 1;\n\n\t\tif (t0 > t1) {\n\t\t\tlet tmp; tmp = t0; t0 = t1; t1 = tmp;\n\t\t\tsign = -1;\n\t\t}\n\n\t\tlet accum = c0;\n\n\t\tfor (let time = t0; time < t1; )\n\t\t{\n\t\t\tlet i0 = this.find(time);\n\t\t\tif (i0 == null) return 0;\n\n\t\t\tlet i1 = i0 + 1;\n\n\t\t\tlet x0 = Math.max(this.t[i0], time);\n\t\t\tlet x1 = Math.min(i1 < this.t.length ? this.t[i1] : t1, t1);\n\n\t\t\tlet y0 = this.getAt(x0);\n\t\t\tlet y1 = this.getAt(x1);\n\n\t\t\tlet dx = x1 - x0;\n\t\t\tlet dy = y1 - y0;\n\n\t\t\tif (this.f[i0] == null)\n\t\t\t\taccum += y0*dx;\n\t\t\telse\n\t\t\t\taccum += 0.5*dy*(x1+x0) - x0*dy + y0*dx;\n\n\t\t\ttime += dx;\n\t\t}\n\n\t\treturn sign*accum;\n\t},\n\n\t/**\n\t * \tReturns the approximate definite second integral of the t-function for the given time range.\n\t * \t@param t0 - Initial time value, defaults to minimum time of the t-function.\n\t * \t@param t1 - Final time value, defaults to the maximum time of the t-function.\n\t * \t@param c0 - Constant of integration, defaults to 0.\n\t * \t@returns Definite second integral of t-function from t0 to t1.\n\t * \t!integral (t0?: number, t1?: number, c0?: number) : number;\n\t */\n\tsecond_integral: function (t0=null, t1=null, c0=0)\n\t{\n\t\tif (t0 == null) t0 = this.t[0];\n\t\tif (t1 == null) t1 = this.t[this.t.length-1];\n\n\t\tlet a0 = TFunction.Temp1.copyFrom(this, this.t[0], t0).integrate(c0).integral();\n\t\tlet a1 = TFunction.Temp2.copyFrom(this, this.t[0], t1).integrate(c0).integral();\n\n\t\treturn a1 - a0;\n\t},\n\n\t/**\n\t * \tTransforms the t-function to its integral. For every sampling range in the t-function their Y-value will be set to the integral\n\t * \tof the sampling range plus any previous integrals.\n\t *\n\t * \t@param c0 - Constant of integration. Defaults to 0.\n\t * \t!integrate (c0?: number) : TFunction;\n\t */\n\tintegrate: function (c0=0)\n\t{\n\t\tlet y = [];\n\n\t\ty.push(c0);\n\n\t\tfor (let i = 1; i < this.t.length; i++)\n\t\t\ty.push(y[i-1] + this.integral(this.t[i-1], this.t[i]));\n\n\t\tthis.y = y;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tTransforms the t-function Y-values to the accumulated sum of each Y-value plus the given c0.\n\t * \t@param c0 - Initial value (defaults to 0).\n\t * \t!accumulate(c0?: number) : TFunction;\n\t */\n\taccumulate: function (c0=0)\n\t{\n\t\tthis.y[0] += c0;\n\n\t\tfor (let i = 1; i < this.t.length; i++)\n\t\t\tthis.y[i] += this.y[i-1];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tRemoves all sampling-points located before the given index.\n\t *\t!chopLeft (i: number) : TFunction;\n\t */\n\tchopLeft: function (i)\n\t{\n\t\tthis.t.splice(0, i);\n\t\tthis.f.splice(0, i);\n\t\tthis.y.splice(0, i);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tRemoves all sampling-points located after the given index.\n\t * \t!chopRight (i: number) : TFunction;\n\t */\n\tchopRight: function (i)\n\t{\n\t\tthis.t.splice(i+1, this.t.length-i-1);\n\t\tthis.f.splice(i+1, this.f.length-i-1);\n\t\tthis.y.splice(i+1, this.y.length-i-1);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMaps the Y-value to other Y-values using the specified mapping function.\n\t * \t@param fn - Receives parameters `y` (y-value), `t` (t-value), and `i` (index).\n\t * \t!map (fn: (y: number, t: number, i: number) => number) : TFunction;\n\t */\n\tmap: function (fn)\n\t{\n\t\tfor (let i = 0; i < this.y.length; i++)\n\t\t\tthis.y[i] = fn (this.y[i], this.t[i], i);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns a string representation of the variable state.\n\t * \t!toString (c0?: number) : string;\n\t */\n\ttoString: function(c0=0)\n\t{\n\t\tlet s = '';\n\t\tlet n = 10;\n\n\t\tconst pad = function (value, n, char)\n\t\t{\n\t\t\tvalue = value.toString();\n\n\t\t\tif (char == null) char = ' ';\n\t\t\tchar = char[0];\n\n\t\t\twhile (value.length < n)\n\t\t\t\tvalue += char;\n\n\t\t\treturn value;\n\t\t};\n\n\t\ts += '\\n';\n\t\ts += pad(' Time', n) + ' ' + pad(' Value', n) + ' ' + pad(' Integral', n) + '\\n';\n\t\ts += pad('', n, '-') + ' ' + pad('', n, '-') + ' ' + pad('', n, '-') + '\\n';\n\n\t\tfor (let i = 0; i < this.t.length; i++)\n\t\t{\n\t\t\ts += pad(' '+float4(this.t[i]), n) + ' ' + pad(' '+float4(this.y[i]), n) + ' ' + pad(' '+float4(this.integral(this.t[0], this.t[i], c0)), n) + '\\n';\n\t\t}\n\n\t\treturn s;\n\t}\n});\n\nTFunction.Temp1 = new TFunction();\nTFunction.Temp2 = new TFunction();\n\nexport default TFunction;\n","/*\n**\tmath/point2.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"../utils/recycler\"]\n//![import \"./vec2\"]\n\n//:/**\n//: * \tRepresentation of a point in 2D space. The coordinate values are upscaled by a fixed number of bits to allow\n//: * \tsub-pixel translations (internally), but the public values will always be integers.\n//: */\n\n//!class Point2\n\nconst Point2 = Class.extend\n({\n\tclassName: 'Point2',\n\n\t/**\n\t * \tUpscaled coordinates of the point.\n\t * \t!readonly ux: number;\n\t * \t!readonly uy: number;\n\t */\n\tux: 0, uy: 0,\n\n\t/**\n\t * \tCoordinates of the point.\n\t * \t!readonly x: number;\n\t * \t!readonly y: number;\n\t */\n\tx: 0, y: 0,\n\n\t/**\n\t *\tConstructs the Point2 instance from another Point2.\n\t * \t!constructor (value: Point2);\n\t */\n\t/**\n\t *\tConstructs the Point2 instance from a Vec2.\n\t * \t!constructor (value: Vec2);\n\t */\n\t/**\n\t *\tConstructs the Point2 instance with the specified coordinates.\n\t * \t!constructor (x?: number, y?: number);\n\t */\n\t__ctor: function (x=null, y=null)\n\t{\n\t\treturn this.set(x, y);\n\t},\n\n\t/**\n\t *\tPopulates the downscaled coordinates.\n\t */\n\tdownscale: function ()\n\t{\n\t\tthis.x = downscale(this.ux);\n\t\tthis.y = downscale(this.uy);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tClones the point coordinates into a new Point2 object.\n\t * \t!clone() : Point2;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Point2.Pool.alloc(this);\n\t},\n\n\t/**\n\t *\tSets the coordinates of the point from another Point2.\n\t *\t!set (value: Point2) : Point2;\n\t */\n\t/**\n\t *\tSets the coordinates of the point from a Vec2 object.\n\t *\t!set (value: Vec2) : Point2;\n\t */\n\t/**\n\t *\tSets the coordinates of the point.\n\t *\t@param upscaled - When `true` the specified values are assumed to have already been upscaled.\n\t *\n\t *\t!set (x: number, y: number, upscaled?: boolean) : Point2;\n\t */\n\tset: function (x, y=null, upscaled=false)\n\t{\n\t\tif (x === null) {\n\t\t\tx = 0;\n\t\t\ty = 0;\n\t\t}\n\t\telse if (y === null)\n\t\t{\n\t\t\tif (Point2.isInstance(x)) {\n\t\t\t\ty = x.uy;\n\t\t\t\tx = x.ux;\n\t\t\t} else { // Point2\n\t\t\t\ty = upscale(x.y);\n\t\t\t\tx = upscale(x.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (!upscaled) {\n\t\t\t\tx = upscale(x);\n\t\t\t\ty = upscale(y);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux = x;\n\t\tthis.uy = y;\n\n\t\treturn this.downscale(this);\n\t},\n\n\t/**\n\t * \tSets the X-coordinate of the point.\n\t * \t!setX (x: number) : Point2;\n\t */\n\tsetX: function (x)\n\t{\n\t\tthis.ux = upscale(x);\n\t\treturn this.downscale(this);\n\t},\n\n\t/**\n\t * \tSets the Y-coordinate of the point.\n\t * \t!setY (y: number) : Point2;\n\t */\n\tsetY: function (y)\n\t{\n\t\tthis.uy = upscale(y);\n\t\treturn this.downscale(this);\n\t},\n\n\t/**\n\t * \tSets the coordinates of the point to zero.\n\t * \t!zero() : Point2;\n\t */\n\tzero: function()\n\t{\n\t\treturn this.set(0, 0);\n\t},\n\n\t/**\n\t * \tReturns true if the point coordinates are both zero.\n\t * \t!isZero() : boolean;\n\t */\n\tisZero: function()\n\t{\n\t\treturn this.x == 0 && this.y == 0;\n\t},\n\n\t/**\n\t *\tReturns true if the coordinates of the point have the same values as the given Point2.\n\t *\t!equals (value: Point2) : boolean;\n\t */\n\t/**\n\t *\tReturns true if the coordinates of the point have the same values as the given Vec2.\n\t *\t!equals (value: Vec2) : boolean;\n\t */\n\t/**\n\t *\tReturns true if the coordinates of the point have the same values as the given ones.\n\t *\t!equals (x: number, y: number) : boolean;\n\t */\n\tequals: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tif (Point2.isInstance(x)) {\n\t\t\t\ty = x.y;\n\t\t\t\tx = x.x;\n\t\t\t} else { // Point2\n\t\t\t\ty = int(x.y);\n\t\t\t\tx = int(x.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tx = int(x);\n\t\t\ty = int(y);\n\t\t}\n\n\t\treturn this.x == x && this.y == y;\n\t},\n\n\t/**\n\t *\tAdds the coordinates of the given Point2 to the point.\n\t *\t!add (value: Point2) : Point2;\n\t */\n\t/**\n\t *\tAdds the coordinates of the given Vec2 to the point.\n\t *\t!add (value: Vec2) : Point2;\n\t */\n\t/**\n\t *\tAdds the given delta values to the point.\n\t *\t@param upscaled - When `true` the specified values are assumed to have already been upscaled.\n\t *\t!add (dx: number, dy: number, upscaled?: boolean) : Point2;\n\t */\n\tadd: function (dx, dy=null, upscaled=false)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tif (Point2.isInstance(dx)) {\n\t\t\t\tdy = dx.uy;\n\t\t\t\tdx = dx.ux;\n\t\t\t} else { // Point2\n\t\t\t\tdy = upscale(dx.y);\n\t\t\t\tdx = upscale(dx.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (!upscaled) {\n\t\t\t\tdx = upscale(dx);\n\t\t\t\tdy = upscale(dy);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux += dx, this.uy += dy;\n\t\treturn this.downscale();\n\t},\n\n\t/**\n\t *\tSubtracts the coordinates of the given Point2 from the point.\n\t *\t!sub (value: Point2) : Point2;\n\t */\n\t/**\n\t *\tSubtracts the coordinates of the given Vec2 from the point.\n\t *\t!sub (value: Vec2) : Point2;\n\t */\n\t/**\n\t *\tSubtracts the given delta values from the point.\n\t *\t@param upscaled - When `true` the specified values are assumed to have already been upscaled.\n\t *\t!sub (dx: number, dy: number, upscaled?: boolean) : Point2;\n\t */\n\tsub: function (dx, dy, upscaled=false)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tif (Point2.isInstance(dx)) {\n\t\t\t\tdy = dx.uy;\n\t\t\t\tdx = dx.ux;\n\t\t\t} else { // Point2\n\t\t\t\tdy = upscale(dx.y);\n\t\t\t\tdx = upscale(dx.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (!upscaled) {\n\t\t\t\tdx = upscale(dx);\n\t\t\t\tdy = upscale(dy);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux -= dx, this.uy -= dy;\n\t\treturn this.downscale();\n\t},\n\n\t/**\n\t * \tReturns the string representation of the coordinates of the point.\n\t * \ttoString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn `(${this.x}, ${this.y})`;\n\t}\n});\n\n//!/class\n\n//!namespace Point2\n//!namespace Pool\n\n/**\n *\tAllocates a Point2 instance from another Point2.\n * \t!function alloc (value: Point2) : Point2;\n */\n/**\n *\tAllocates a Point2 instance from a Vec2.\n * \t!function alloc (value: Vec2) : Point2;\n */\n/**\n *\tAllocates a Point2 instance with the specified coordinates.\n * \t!function alloc (x?: number, y?: number) : Point2;\n */\n\nRecycler.createPool (Point2, 2048, 1024);\nexport default Point2;\n","/*\n**\tmath/bounds2.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Recycler from '../utils/recycler.js';\nimport Point2 from './point2.js';\nimport Rect from './rect.js';\n\n//![import \"../utils/recycler\"]\n//![import \"./point2\"]\n//![import \"./rect\"]\n\n//:/**\n//: * \tRepresentation of a bounding box in 2D space. The component values are upscaled by a fixed number of bits to allow sub-pixel\n//: * \ttranslations (internally), but the public values will always be integers.\n//: */\n\n//!class Bounds2\n\nconst Bounds2 = Class.extend\n({\n\tclassName: 'Bounds2',\n\n\t/**\n\t * \tCoordinates of the bounds (cx and cy are for the center). Note that this fields are read only and should be\n\t * \tmodified through methods only.\n\t */\n\n\t/**\n\t * \t!readonly cx: number;\n\t */\n\tcx: 0,\n\t/**\n\t * \t!readonly cy: number;\n\t */\n\tcy: 0,\n\t/**\n\t * \t!readonly x1: number;\n\t */\n\tx1: 0,\n\t/**\n\t * \t!readonly y1: number;\n\t */\n\ty1: 0,\n\t/**\n\t * \t!readonly x2: number;\n\t */\n\tx2: 0,\n\t/**\n\t * \t!readonly y2: number;\n\t */\n\ty2: 0,\n\n\t/**\n\t * \tUpscaled coordinates.\n\t */\n\tucx: 0, ucy: 0,\n\tux1: 0, uy1: 0,\n\tux2: 0, uy2: 0,\n\n\t/**\n\t * !constructor ();\n\t */\n\t/**\n\t * !constructor (bounds: Bounds2);\n\t */\n\t/**\n\t * !constructor (rect: Rect);\n\t */\n\t/**\n\t * !constructor (width: number, height: number);\n\t */\n\t/**\n\t * !constructor (x1: number, y1: number, x2: number, y2: number, upscaled?: boolean|false);\n\t */\n\t__ctor: function (x1=null, y1=null, x2=null, y2=null, upscaled=false)\n\t{\n\t\tif (x1 === null)\n\t\t{\n\t\t\tthis.ux1 = this.uy1 = this.ux2 = this.uy2 = this.ucx = this.ucy = 0;\n\t\t\treturn this.downscale();\n\t\t}\n\n\t\tif (y1 !== null && x2 === null)\n\t\t\treturn this.set(0, 0, 0, 0).resize(x1, y1);\n\n\t\treturn this.set(x1, y1, x2, y2, upscaled);\n\t},\n\n\t/**\n\t * Populates the downscaled components.\n\t */\n\tdownscale: function ()\n\t{\n\t\tthis.x1 = downscale(this.ux1);\n\t\tthis.y1 = downscale(this.uy1);\n\t\tthis.x2 = downscale(this.ux2);\n\t\tthis.y2 = downscale(this.uy2);\n\t\tthis.cx = downscale(this.ucx);\n\t\tthis.cy = downscale(this.ucy);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Truncates the components to remove fractional parts.\n\t * !trunc() : Bounds2;\n\t */\n\ttrunc: function ()\n\t{\n\t\tthis.ux1 = upscale(this.x1);\n\t\tthis.uy1 = upscale(this.y1);\n\t\tthis.ux2 = upscale(this.x2);\n\t\tthis.uy2 = upscale(this.y2);\n\t\tthis.ucx = upscale(this.cx);\n\t\tthis.ucy = upscale(this.cy);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Clones the bounds and returns a new object.\n\t * !clone() : Bounds2;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Bounds2.Pool.alloc(this.ux1, this.uy1, this.ux2, this.uy2, true);\n\t},\n\n\t/**\n\t * Sets the components to zero.\n\t * !zero() : Bounds2;\n\t */\n\tzero: function ()\n\t{\n\t\tthis.ux1 = 0; this.uy1 = 0;\n\t\tthis.ux2 = 0; this.uy2 = 0;\n\t\tthis.ucx = 0; this.ucy = 0;\n\n\t\treturn this.downscale();\n\t},\n\n\t/**\n\t * Resets the component values to `null` for subsequent use with `setAsUnion`.\n\t * !reset() : Bounds2;\n\t */\n\treset: function ()\n\t{\n\t\tthis.ux1 = null; this.uy1 = null;\n\t\tthis.ux2 = null; this.uy2 = null;\n\t\tthis.ucx = null; this.ucy = null;\n\n\t\tthis.x1 = null; this.y1 = null;\n\t\tthis.x2 = null; this.y2 = null;\n\t\tthis.cx = null; this.cy = null;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Translates the bounds by the given deltas.\n\t * !translate (point: Point2) : Bounds2;\n\t */\n\t/**\n\t * Translates the bounds by the given deltas.\n\t * !translate (vec: Vec2) : Bounds2;\n\t */\n\t/**\n\t * Translates the bounds by the given deltas.\n\t * !translate (dx: number, dy: number, upscaled?: boolean) : Bounds2;\n\t */\n\ttranslate: function (dx, dy=null, upscaled=false)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tif (Point2.isInstance(dx)) {\n\t\t\t\tdy = dx.uy;\n\t\t\t\tdx = dx.ux;\n\t\t\t} else { // Vec2\n\t\t\t\tdy = upscale(dx.y);\n\t\t\t\tdx = upscale(dx.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (!upscaled) {\n\t\t\t\tdx = upscale(dx);\n\t\t\t\tdy = upscale(dy);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux1 += dx; this.uy1 += dy;\n\t\tthis.ux2 += dx; this.uy2 += dy;\n\t\tthis.ucx += dx; this.ucy += dy;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tSets the coordinates of the bounds.\n\t**\n\t**\tBounds2 set (Bounds2 b)\n\t**\tBounds2 set (Rect r)\n\t**\tBounds2 set (float x1, float y1, float x2, float y2, bool upscaled=false)\n\t*/\n\tset: function (x1, y1=null, x2=null, y2=null, upscaled=false)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.uy2;\n\t\t\t\tx2 = x1.ux2;\n\t\t\t\ty1 = x1.uy1;\n\t\t\t\tx1 = x1.ux1;\n\t\t\t} else {\n\t\t\t\ty2 = upscale(x1.y2);\n\t\t\t\tx2 = upscale(x1.x2);\n\t\t\t\ty1 = upscale(x1.y1);\n\t\t\t\tx1 = upscale(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!upscaled) {\n\t\t\t\tx1 = upscale(x1);\n\t\t\t\ty1 = upscale(y1);\n\t\t\t\tx2 = upscale(x2);\n\t\t\t\ty2 = upscale(y2);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux1 = x1;\n\t\tthis.uy1 = y1;\n\t\tthis.ux2 = x2;\n\t\tthis.uy2 = y2;\n\n\t\tthis.ucx = (x1 + x2) >> 1;\n\t\tthis.ucy = (y1 + y2) >> 1;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tAdds the specified coordinates to the current ones.\n\t**\n\t**\tBounds2 add (Bounds2 b)\n\t**\tBounds2 add (Rect r)\n\t**\tBounds2 add (float x1, float y1, float x2, float y2, bool upscaled=false)\n\t*/\n\tadd: function (x1, y1=null, x2=null, y2=null, upscaled=false)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.uy2;\n\t\t\t\tx2 = x1.ux2;\n\t\t\t\ty1 = x1.uy1;\n\t\t\t\tx1 = x1.ux1;\n\t\t\t} else {\n\t\t\t\ty2 = upscale(x1.y2);\n\t\t\t\tx2 = upscale(x1.x2);\n\t\t\t\ty1 = upscale(x1.y1);\n\t\t\t\tx1 = upscale(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!upscaled) {\n\t\t\t\tx1 = upscale(x1);\n\t\t\t\ty1 = upscale(y1);\n\t\t\t\tx2 = upscale(x2);\n\t\t\t\ty2 = upscale(y2);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux1 += x1;\n\t\tthis.uy1 += y1;\n\t\tthis.ux2 += x2;\n\t\tthis.uy2 += y2;\n\n\t\tthis.ucx += (x1 + x2) >> 1;\n\t\tthis.ucy += (y1 + y2) >> 1;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tReturns true if the integer coordinates have the same values as the given argument.\n\t**\n\t**\tbool equals (Bounds2 b)\n\t**\tbool equals (Rect r)\n\t**\tbool equals (float x1, float y1, float x2, float y2)\n\t*/\n\tequals: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.y2;\n\t\t\t\tx2 = x1.x2;\n\t\t\t\ty1 = x1.y1;\n\t\t\t\tx1 = x1.x1;\n\t\t\t} else {\n\t\t\t\ty2 = int(x1.y2);\n\t\t\t\tx2 = int(x1.x2);\n\t\t\t\ty1 = int(x1.y1);\n\t\t\t\tx1 = int(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx1 = int(x1);\n\t\t\ty1 = int(y1);\n\t\t\tx2 = int(x2);\n\t\t\ty2 = int(y2);\n\t\t}\n\n\t\treturn x1 == this.x1 && x2 == this.x2 && y1 == this.y1 && y2 == this.y2;\n\t},\n\n\t/*\n\t**\tReturns a bool indicating if the specified bounds are contained by the current bounds.\n\t**\n\t**\tbool contains (Bounds2 b)\n\t**\tbool contains (Rect r)\n\t**\tbool contains (float x1, float y1, float x2, float y2)\n\t*/\n\tcontains: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.y2;\n\t\t\t\tx2 = x1.x2;\n\t\t\t\ty1 = x1.y1;\n\t\t\t\tx1 = x1.x1;\n\t\t\t} else {\n\t\t\t\ty2 = int(x1.y2);\n\t\t\t\tx2 = int(x1.x2);\n\t\t\t\ty1 = int(x1.y1);\n\t\t\t\tx1 = int(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx1 = int(x1);\n\t\t\ty1 = int(y1);\n\t\t\tx2 = int(x2);\n\t\t\ty2 = int(y2);\n\t\t}\n\n\t\treturn (x1 == Math.max(this.x1, x1)) && (y1 == Math.max(this.y1, y1)) && (x2 == Math.min(this.x2, x2)) && (y2 == Math.min(this.y2, y2));\n\t},\n\n\t/*\n\t**\tExtends the coordinates to ensure the specified argument is contained.\n\t**\n\t**\tBounds2 setAsUnion (Bounds2 b)\n\t**\tBounds2 setAsUnion (Rect r)\n\t**\tBounds2 setAsUnion (Point2 p)\n\t**\tBounds2 setAsUnion (Vec2 v)\n\t**\tBounds2 setAsUnion (float x, float y)\n\t**\tBounds2 setAsUnion (float x1, float y1, float x2, float y2)\n\t*/\n\tsetAsUnion: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1))\n\t\t\t{\n\t\t\t\tthis.setAsUnion(x1.ux1, x1.uy1, true);\n\t\t\t\tthis.setAsUnion(x1.ux2, x1.uy2, true);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t\telse if (Rect.isInstance(x1))\n\t\t\t{\n\t\t\t\tthis.setAsUnion(x1.x1, x1.y1);\n\t\t\t\tthis.setAsUnion(x1.x2, x1.y2);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t\telse if (Point2.isInstance(x1))\n\t\t\t{\n\t\t\t\ty1 = x1.uy;\n\t\t\t\tx1 = x1.ux;\n\t\t\t}\n\t\t\telse // Vec2\n\t\t\t{\n\t\t\t\ty1 = upscale(x1.y);\n\t\t\t\tx1 = upscale(x1.x);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (y2 !== null)\n\t\t\t{\n\t\t\t\tthis.setAsUnion(x1, y1);\n\t\t\t\tthis.setAsUnion(x2, y2);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (x2 !== true)\n\t\t\t\t{\n\t\t\t\t\tx1 = upscale(x1);\n\t\t\t\t\ty1 = upscale(y1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.ux1 === null || x1 < this.ux1) this.ux1 = x1;\n\t\tif (this.uy1 === null || y1 < this.uy1) this.uy1 = y1;\n\t\tif (this.ux2 === null || x1 > this.ux2) this.ux2 = x1;\n\t\tif (this.uy2 === null || y1 > this.uy2) this.uy2 = y1;\n\n\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tReturns a bool indicating if the integer components of the bounds intersect with the specified argument.\n\t**\n\t**\tbool intersects (Bounds2 b)\n\t**\tbool intersects (Rect r)\n\t**\tbool intersects (float x1, float y1, float x2, float y2)\n\t*/\n\tintersects: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.y2;\n\t\t\t\tx2 = x1.x2;\n\t\t\t\ty1 = x1.y1;\n\t\t\t\tx1 = x1.x1;\n\t\t\t} else {\n\t\t\t\ty2 = int(x1.y2);\n\t\t\t\tx2 = int(x1.x2);\n\t\t\t\ty1 = int(x1.y1);\n\t\t\t\tx1 = int(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx1 = int(x1);\n\t\t\ty1 = int(y1);\n\t\t\tx2 = int(x2);\n\t\t\ty2 = int(y2);\n\t\t}\n\n\t\tlet _x1 = Math.max(this.x1, x1);\n\t\tlet _y1 = Math.max(this.y1, y1);\n\t\tlet _x2 = Math.min(this.x2, x2);\n\t\tlet _y2 = Math.min(this.y2, y2);\n\n\t\treturn Math.max(0, _y2-_y1) * Math.max(0, _x2-_x1) > 0;\n\t},\n\n\t/*\n\t**\tSets the bounds to the intersection formed by the current bounds and the given argument.\n\t**\n\t**\tBounds2 setAsIntersection (Bounds2 b)\n\t**\tBounds2 setAsIntersection (Rect r)\n\t**\tBounds2 setAsIntersection (float x1, float y1, float x2, float y2)\n\t*/\n\tsetAsIntersection: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.y2;\n\t\t\t\tx2 = x1.x2;\n\t\t\t\ty1 = x1.y1;\n\t\t\t\tx1 = x1.x1;\n\t\t\t} else {\n\t\t\t\ty2 = int(x1.y2);\n\t\t\t\tx2 = int(x1.x2);\n\t\t\t\ty1 = int(x1.y1);\n\t\t\t\tx1 = int(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx1 = int(x1);\n\t\t\ty1 = int(y1);\n\t\t\tx2 = int(x2);\n\t\t\ty2 = int(y2);\n\t\t}\n\n\t\tthis.ux1 = upscale(Math.max(this.x1, x1));\n\t\tthis.uy1 = upscale(Math.max(this.y1, y1));\n\t\tthis.ux2 = upscale(Math.min(this.x2, x2));\n\t\tthis.uy2 = upscale(Math.min(this.y2, y2));\n\n\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\n\t\tthis.downscale();\n\n\t\treturn Math.max(0, this.uy2-this.uy1) * Math.max(0, this.ux2-this.ux1) > 0;\n\t},\n\n\t/**\n\t * Resizes the bounds to the given size using center or top-left as reference.\t \n\t * @param {boolean} topLeftRelative @default `false`\n\t * !resize (width:number, height:number, topLeftRelative?:boolean) : Bounds2;\n\t */\n\tresize: function (width, height, topLeftRelative=false)\n\t{\n\t\twidth = width !== null ? upscale(width) : (this.ux2 - this.ux1);\n\t\theight = height !== null ? upscale(height) : (this.uy2 - this.uy1);\n\n\t\tif (topLeftRelative === true)\n\t\t{\n\t\t\tthis.ux2 = this.ux1 + width;\n\t\t\tthis.uy2 = this.uy1 + height;\n\n\t\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\t\t}\n\t\telse\n\t\t{\n\t\t\twidth >>= 1; height >>= 1;\n\n\t\t\tthis.ux1 = this.ucx - width; this.uy1 = this.ucy - height;\n\t\t\tthis.ux2 = this.ucx + width; this.uy2 = this.ucy + height;\n\t\t}\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tResizes the bounds using the specified deltas (using the center or top-left corner as reference).\n\t**\n\t**\tBounds2 resizeBy (float dwidth, float dheight, bool topLeftRelative=false)\n\t*/\n\tresizeBy: function (dwidth, dheight, topLeftRelative=false)\n\t{\n\t\tdwidth = upscale(dwidth);\n\t\tdheight = upscale(dheight);\n\n\t\tif (topLeftRelative === true)\n\t\t{\n\t\t\tthis.ux2 += dwidth;\n\t\t\tthis.uy2 += dheight;\n\n\t\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdwidth >>= 1; dheight >>= 1;\n\n\t\t\tthis.ux1 -= dwidth; this.uy1 -= dheight;\n\t\t\tthis.ux2 += dwidth; this.uy2 += dheight;\n\t\t}\n\n\t\treturn this.downscale();\n\t},\n\n\t/**\n\t * Returns the width of the bounds.\n\t * !width(): number\n\t */\n\twidth: function ()\n\t{\n\t\treturn this.x2 - this.x1;\n\t},\n\n\t/**\n\t * Returns the height of the bounds.\n\t * !height(): number\n\t */\n\theight: function ()\n\t{\n\t\treturn this.y2 - this.y1;\n\t},\n\n\t/**\n\t * Returns true if the bounds are in forward position (x1 < x2 and y1 < y2).\n\t * !isForward() : boolean;\n\t */\n\tisForward: function ()\n\t{\n\t\treturn this.ux1 <= this.ux2 && this.uy1 <= this.uy2;\n\t},\n\n\t/**\n\t * Returns true if the specified point is within the bounds. The `tol` parameter is used to specify a tolerance value.\n\t * !containsPoint (x: number, y: number, tol?: number) : boolean;\n\t */\n\tcontainsPoint: function (x, y, tol=0)\n\t{\n\t\tx = upscale(x);\n\t\ty = upscale(y);\n\t\ttol = upscale(tol);\n\n\t\treturn (this.ux1-tol <= x && x <= this.ux2+tol) && (this.uy1-tol <= y && y <= this.uy2+tol);\n\t},\n\n\t/**\n\t * Returns the area of the bounds. When strict is true, the area will be returned only if the bounds are forward.\n\t * !area (strict?: boolean|false) : number;\n\t */\n\tarea: function (strict=false)\n\t{\n\t\treturn strict ? (this.isForward() ? (this.y2-this.y1)*(this.x2-this.x1) : 0) : ((this.y2-this.y1)*(this.x2-this.x1));\n\t},\n\n\t/**\n\t * Returns the string representation of the rect coordinates.\n\t * !toString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn '(' + this.x1 + ', ' + this.y1 + ', ' + this.x2 + ', ' + this.y2 + ')';\n\t},\n\n\t/**\n\t * Flattens the contents of the bounds.\n\t * !flatten() : \\[number,number,number,number\\];\n\t */\n\tflatten: function ()\n\t{\n\t\treturn [this.ux1, this.uy1, this.ux2, this.uy2];\n\t},\n\n\t/**\n\t * Unflattens the given array into the bounds object.\n\t * !unflatten (data: \\[number,number,number,number\\]) : Bounds2;\n\t */\n\tunflatten: function (x)\n\t{\n\t\tthis.ux1 = x[0];\n\t\tthis.uy1 = x[1];\n\t\tthis.ux2 = x[2];\n\t\tthis.uy2 = x[3];\n\n\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\n\t\treturn this.downscale();\n\t}\n});\n\n//!/class\n\n//!namespace Rect\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a new object of zero size.\n\t * \t!function alloc() : Bounds2;\n\t */\n\nRecycler.createPool (Bounds2, 8192, 3072);\nexport default Bounds2;\n","/*\n**\tfroxel/anim/easing.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tCollection of useful easing functions.\n*/\n\n//!namespace Easing\n\nconst Easing =\n{\n\t/* ******************************************** */\n\t//!namespace Linear\n\tLinear:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Back\n\tBack:\n\t{\n\t\tk: 1.70158,\n\n\t\t/**\n\t\t * \t!function IN (t: number, k?: number) : number;\n\t\t */\n\t\tIN: function (t, k=null)\n\t\t{\n\t\t\tif (k === null) k = Easing.Back.k;\n\t\t\treturn t*t*((k+1)*t - k);\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number, k?: number) : number;\n\t\t */\n\t\tOUT: function (t, k=null)\n\t\t{\n\t\t\treturn 1 - Easing.Back.IN(1 - t, k);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number, k?: number) : number;\n\t\t */\n\t\tIN_OUT: function (t, k=null)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Back.IN(t*2, k)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Back.OUT((t-0.5)*2, k)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Bounce\n\tBounce:\n\t{\n\t\tgetConst: function (t)\n\t\t{\n\t\t\tif (t < 1.0/2.75)\n\t\t\t\treturn 7.5625 * t * t;\n\t\t\telse if (t < 2.0/2.75)\n\t\t\t\treturn 7.5625 * (t -= 1.5/2.75)*t + 0.75;\n\t\t\telse if (t < 2.5/2.75)\n\t\t\t\treturn 7.5625 * (t -= 2.250/2.75) * t + 0.9375;\n\n\t\t\treturn 7.5625 * (t -= 2.625/2.75) * t + 0.984375;\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Bounce.getConst(1-t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn Easing.Bounce.getConst(t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn (1 - Easing.Bounce.getConst(1-2*t))/2;\n\t\t\telse\n\t\t\t\treturn (Easing.Bounce.getConst((t-0.5)*2)/2)+0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Circ\n\tCirc:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Math.sqrt(1 - t*t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Circ.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\t\treturn Easing.Circ.IN(t*2)/2;\n\t\t\t\telse\n\t\t\t\t\treturn Easing.Circ.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Cubic\n\tCubic:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Cubic.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Cubic.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Cubic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Expo\n\tExpo:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn Math.pow(2, 12*(t-1));\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn -Math.pow(2, -12*t) + 1;\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif ((t *= 2) < 1)\n\t\t\t\treturn Math.pow (2, 12 * (t - 1)) / 2;\n\t\t\telse\n\t\t\t\treturn (-Math.pow (2, -12 * (t - 1)) + 2) / 2;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Power\n\tPower:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number, p?: number) : number;\n\t\t */\n\t\tIN: function (t, p=12)\n\t\t{\n\t\t\treturn Math.pow(t, p);\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number, p?: number) : number;\n\t\t */\n\t\tOUT: function (t, p=12)\n\t\t{\n\t\t\treturn 1 - Easing.Power.IN(1 - t, p);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number, p?: number) : number;\n\t\t */\n\t\tIN_OUT: function (t, p=12)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Power.IN(t*2, p)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Power.OUT((t-0.5)*2, p)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Quad\n\tQuad:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quad.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Quad.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Quad.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Quartic\n\tQuartic:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t*t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quartic.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Quartic.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Quartic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Quintic\n\tQuintic:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t*t*t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quintic.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\t\treturn Easing.Quintic.IN(t*2)/2;\n\t\t\t\telse\n\t\t\t\t\treturn Easing.Quintic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Sine\n\tSine:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Math.sin (1.5708 * (1 - t));\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn Math.sin (1.5708 * t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn (Math.cos (3.1416*t) - 1) / -2;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Step\n\tStep:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t}\n\t}\n};\n\nexport default Easing;\n","/*\n**\tflow/boot.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport PriorityQueue from '../utils/priority-queue.js';\n\n//![import \"../utils/priority-queue\"]\n\n//!class Boot\n\nconst Boot =\n{\n\tmodules: new PriorityQueue(),\n\n\t/**\n\t * \tRegisters a new boot module.\n\t * \t!static register (module: Boot.Module) : Boot.Module;\n\t */\n\tregister: function (module)\n\t{\n\t\treturn this.modules.add(module);\n\t},\n\n\t/**\n\t * \tRemoves a boot module.\n\t * \t!static unregister (module: Boot.Module) : void;\n\t */\n\tunregister: function (module)\n\t{\n\t\tthis.modules.remove(module);\n\t\tthis.modules.cleanup();\n\t},\n\n\t/**\n\t * \tExecutes the startup sequence.\n\t * \t!static startup (finishedCallback?: () => void) : void;\n\t */\n\tstartup: function (finishedCallback=null)\n\t{\n\t\tthis.modules.forEachAsync((m,r) => { if (m.onStartup(r) !== false) r(); }, finishedCallback);\n\t},\n\n\t/**\n\t * \tExecutes the shutdown sequence.\n\t * \t!static shutdown (finishedCallback?: () => void) : void;\n\t */\n\tshutdown: function (finishedCallback=null)\n\t{\n\t\tthis.modules.forEachAsyncRev( (m,r) => { if (m.onShutdown(r) !== false) r(); }, finishedCallback);\n\t}\n};\n\n//!/class\n\n//!namespace Boot\n//!interface Module\n\nBoot.Module = Class.extend\n({\n\tclassName: \"Module\",\n\n\t/**\n\t * \tPriority of the module (from 0 to 100), lower number means higher priority.\n\t * \t!priority: number;\n\t */\n\tpriority: 5,\n\n\t__ctor: function()\n\t{\n\t\tBoot.register(this);\n\t},\n\n\t__dtor: function()\n\t{\n\t\tBoot.unregister(this);\n\t},\n\n\t/**\n\t * \tShould return `false` if the method is async. When async ensure to call `next` once the operation is complete.\n\t * \t!onStartup (next: () => void) : boolean;\n\t */\n\tonStartup: function (next)\n\t{\n\t},\n\n\t/**\n\t * \tShould return `false` if the method is async. When async ensure to call `next` once the operation is complete.\n\t * \t!onShutdown (next: () => void) : boolean;\n\t */\n\tonShutdown: function (next)\n\t{\n\t}\n});\n\n//!/interface\n//!/namespace\n\nexport default Boot;\n","/*\n**\tfxl/system.js\n**\n**\tCopyright (c) 2016-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport System from '../system/system.js';\nimport Resources from '../resources/resources.js';\nimport Boot from '../flow/boot.js';\nimport Handler from '../utils/handler.js';\n\n//!class sys\n\nconst system =\n{\n\t/**\n\t * Indicates if the system module has already been initialized.\n\t */\n\tinitialized: false,\n\n\t/**\n\t * Screen width (available after calling `init`).\n\t * !static readonly screenWidth: number;\n\t */\n\tscreenWidth: 0,\n\n\t/**\n\t * Screen height (available after calling `init`).\n\t * !static readonly screenHeight: number;\n\t */\n\tscreenHeight: 0,\n\n\t/**\n\t * Primary renderer (available after calling `init`).\n\t * !static readonly renderer: Canvas;\n\t */\n\trenderer: null,\n\n\t/**\n\t * Logical system time (mirrors the value of System.frameTime).\n\t * !static readonly time: Number;\n\t */\n\ttime: 0,\n\n\t/**\n\t * Logical system delta time (mirrors the value of System.frameDelta).\n\t * !static readonly dt: Number;\n\t */\n\tdt: 0,\n\n\t/**\n\t * Timeout update handler.\n\t */\n\t_timeout: null,\n\n\t/**\n\t * Interval update handler.\n\t */\n\t_interval: null,\n\n\t/**\n\t * Time span update handler.\n\t */\n\t_span: null,\n\n\t/**\n\t * Update handler executed on every frame start.\n\t * !static readonly update: Handler;\n\t */\n\tupdate: null,\n\n\t/**\n\t * Draw handler executed on every frame start.\n\t * !static readonly draw: Handler;\n\t */\n\tdraw: null,\n\n\t/**\n\t * Executed when the system is paused.\n\t * !static onPaused: (fromExternalEvent: boolean) => void;\n\t */\n\tonPaused: null,\n\n\t/**\n\t * Executed when the system is resumed.\n\t * !static onResumed: (fromExternalEvent: boolean) => void;\n\t */\n\tonResumed: null,\n\n\t/**\n\t * System initialization options.\n\t */\n\toptions:\n\t{\n\t\t/**\n\t\t * \tTells the system to enable WebGL support.\n\t\t */\n\t\tgl: true,\n\n\t\t/**\n\t\t * \tIndicates if on-screen logging should be enabled.\n\t\t */\n\t\tlog: false,\n\n\t\t/**\n\t\t * \tEnables or disables antialised canvas. Set to `false` when pixel-perfect is desired.\n\t\t */\n\t\tantialias: false,\n\n\t\t/**\n\t\t * \tBackground of the system canvas.\n\t\t */\n\t\tbackground: '#000000',\n\n\t\t/**\n\t\t * \tDesired orientaton of the display.\n\t\t */\n\t\torientation: 'automatic',\n\n\t\t/**\n\t\t * \tDesired display width. When not specified (null) the maximum screen width to maintain the aspect ratio will be used.\n\t\t */\n\t\tscreenWidth: null,\n\n\t\t/**\n\t\t * \tDesired display height. When not specified (null) the maximum screen height to maintain the aspect ratio will be used.\n\t\t */\n\t\tscreenHeight: null,\n\n\t\t/**\n\t\t * \tTarget frames per second (FPS). Used to determine delay between frames.\n\t\t */\n\t\tfps: 144,\n\n\t\t/**\n\t\t * \tMinimum allowed frames per second (FPS). If system FPS drops below this value, the `frameDelta` property of System will be truncated to 1/minFps.\n\t\t */\n\t\tminFps: 24,\n\n\t\t/**\n\t\t * \tIndicates if recycler pool preallocation should be automatically executed. Additionally if this value is a number, it will be used as\n\t\t * \tmaximum preallocation parameter for the recycler.\n\t\t */\n\t\tpreallocate: true\n\t},\n\n\t/**\n\t * Initializes the system with the specified options.\n\t * !static init (options: System.Options) : Promise<void>;\n\t */\n\t/**\n\t * Initializes the system using the default options.\n\t * !static init () : Promise<void>;\n\t */\n\tinit: function (options)\n\t{\n\t\treturn new Promise ((resolve, reject) =>\n\t\t{\n\t\t\tif (this.initialized)\n\t\t\t\treturn resolve();\n\n\t\t\tObject.assign(this.options, options);\n\n\t\t\tResources.config ({ pixelated: !this.options.antialias, filter: this.options.antialias ? 'LINEAR' : 'NEAREST' });\n\t\t\tSystem.init (this.options);\n\n\t\t\tSystem.updateQueueAdd\n\t\t\t({\n\t\t\t\tupdate: function(dt)\n\t\t\t\t{\n\t\t\t\t\tsystem.time = System.frameTime;\n\t\t\t\t\tsystem.dt = dt;\n\n\t\t\t\t\tsystem._timeout.exec(dt);\n\t\t\t\t\tsystem._interval.exec(dt);\n\t\t\t\t\tsystem._span.exec(dt);\n\n\t\t\t\t\tsystem.update.exec(dt);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tSystem.drawQueueAdd\n\t\t\t({\n\t\t\t\tdraw: function(g)\n\t\t\t\t{\n\t\t\t\t\tsystem.draw.exec(g);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tBoot.startup(function()\n\t\t\t{\n\t\t\t\tSystem.start();\n\n\t\t\t\tsystem.screenWidth = System.screenWidth;\n\t\t\t\tsystem.screenHeight = System.screenHeight;\n\t\t\t\tsystem.renderer = System.renderer;\n\n\t\t\t\tsystem._timeout = Handler.Pool.alloc();\n\t\t\t\tsystem._interval = Handler.Pool.alloc();\n\t\t\t\tsystem._span = Handler.Pool.alloc();\n\n\t\t\t\tsystem.update = Handler.Pool.alloc();\n\t\t\t\tsystem.draw = Handler.Pool.alloc();\n\n\t\t\t\twindow.onblur = function() {\n\t\t\t\t\tsystem.pause(true);\n\t\t\t\t};\n\n\t\t\t\twindow.onfocus = function() {\n\t\t\t\t\tsystem.resume(true);\n\t\t\t\t};\n\n\t\t\t\tsystem.initialized = true;\n\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Pauses the system.\n\t * !static pause (fromExternalEvent?: boolean|false) : void;\n\t */\n\tpause: function (fromExternalEvent=false)\n\t{\n\t\tif (system.onPaused !== null)\n\t\t\tsystem.onPaused(fromExternalEvent);\n\t},\n\n\t/**\n\t * Resumes the system.\n\t * !static resume (fromExternalEvent?: boolean|false) : void;\n\t */\n\tresume: function (fromExternalEvent=false)\n\t{\n\t\tif (system.onResumed !== null)\n\t\t\tsystem.onResumed(fromExternalEvent);\n\t},\n\n\t/**\n\t * Creates a timeout callback.\n\t * !static timeout (duration: number, callback: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any) : void;\n\t */\n\ttimeout: function (duration, callback, arg0=null, arg1=null, arg2=null, arg3=null)\n\t{\n\t\tthis._timeout.add(this._updateTimeout, duration, callback, arg0, arg1, arg2, arg3);\n\t},\n\n\t_updateTimeout: function (dt, _, callback, arg0, arg1, arg2, arg3)\n\t{\n\t\tthis.arg0 -= dt;\n\t\tif (this.arg0 > 0) return true;\n\n\t\tcallback (arg0, arg1, arg2, arg3);\n\t\treturn false;\n\t},\n\n\t/**\n\t * Creates an interval callback.\n\t * !static interval (period: number, callback: Function, arg0?: any, arg1?: any, arg2?: any) : void;\n\t */\n\tinterval: function (period, callback, arg0=null, arg1=null, arg2=null)\n\t{\n\t\tthis._interval.add(this._updateInterval, 0, period, callback, arg0, arg1, arg2);\n\t},\n\n\t_updateInterval: function (dt, _0, _1, callback, arg0, arg1, arg2)\n\t{\n\t\tthis.arg0 += dt;\n\t\tif (this.arg0 < this.arg1) return true;\n\n\t\tthis.arg0 -= this.arg1;\n\t\treturn callback (arg0, arg1, arg2);\n\t},\n\n\t/**\n\t * Creates a a time-span callback.\n\t * !static span (period: number, callback: (t:number, ...args:any) => boolean, arg0?: any, arg1?: any, arg2?: any) : void;\n\t */\n\tspan: function (duration, callback, arg0=null, arg1=null, arg2=null)\n\t{\n\t\tthis._span.add(this._updateSpan, 0, duration, callback, arg0, arg1, arg2);\n\t},\n\n\t_updateSpan: function (dt, _0, _1, callback, arg0, arg1, arg2)\n\t{\n\t\tthis.arg0 += dt;\n\t\tif (this.arg0 > this.arg1) this.arg0 = this.arg1;\n\n\t\tif (callback (this.arg0/this.arg1, arg0, arg1, arg2) === false)\n\t\t\treturn false;\n\n\t\treturn this.arg0 !== this.arg1;\n\t}\n};\n\nexport default system;\n","/*\n**\tfroxel/anim/block.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport List from '../utils/list.js';\nimport Recycler from '../utils/recycler.js';\n\n//!class Block\n\nconst Block = Class.extend\n({\n\tclassName: 'Anim:Block',\n\n\tcommands: null,\n\n\tfirst: true,\n\tcurrent: false,\n\ttime: 0,\n\n\t/**\n\t * \tInitializes the block to its initial state.\n\t * \t!init() : Block;\n\t */\n\tinit: function()\n\t{\n\t\tthis.commands = List.Pool.alloc();\n\t\tthis.reset(0);\n\t\treturn this;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis.commands.free();\n\t},\n\n\t/**\n\t * \tAdds a command to the block.\n\t * \t!add (cmd: Command) : Command;\n\t */\n\tadd: function(cmd)\n\t{\n\t\tthis.commands.push(cmd);\n\t\treturn cmd;\n\t},\n\n\t/**\n\t * \tClones the block.\n\t * \t!clone() : Block;\n\t */\n\tclone: function()\n\t{\n\t\tlet block = Block.alloc();\n\n\t\tfor (let node = this.commands.top; node !== null; node = node.next)\n\t\t\tblock.commands.push(node.value.clone());\n\n\t\treturn block;\n\t},\n\n\t/**\n\t * \tClears the block by removing all commands and resetting it to initial state.\n\t * \t!clear() : Block;\n\t */\n\tclear: function()\n\t{\n\t\tthis.commands.clear();\n\t\tthis.reset(0);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResets the block to its initial state. Does not remove commands.\n\t * \t!reset (time: number) : Block;\n\t */\n\treset: function (time=0)\n\t{\n\t\tthis.first = true;\n\t\tthis.current = null;\n\t\tthis.time = time;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the block to use the first command in the next call to `update`.\n\t * \t!restart() : Block;\n\t */\n\trestart: function()\n\t{\n\t\tthis.first = true;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns `true` if all commands in the block have been executed to completion.\n\t * \t!isFinished() : boolean;\n\t */\n\tisFinished: function()\n\t{\n\t\tif (this.first === true)\n\t\t{\n\t\t\tthis.current = this.commands.top;\n\t\t\tthis.first = false;\n\t\t}\n\n\t\treturn this.current === null;\n\t},\n\n\t/**\n\t * \tExecutes the next command in the block. Returns `true` when block execution is complete.\n\t * \t!update (anim: Anim) : boolean;\n\t */\n\tupdate: function (anim)\n\t{\n\t\twhile (!this.isFinished())\n\t\t{\n\t\t\tlet r = this.current.value.update(anim, this);\n\t\t\tif (r !== true) return r;\n\n\t\t\tthis.current = this.current.next;\n\t\t}\n\n\t\treturn true;\n\t}\n});\n\n/**\n * \tAllocates a new block.\n * \t!static alloc () : Block;\n */\n\n/**\n * \tAllocates a new block and initializes it.\n * \t!static calloc () : Block;\n */\n\nRecycler.attachTo(Block, 8192);\nexport default Block;\n","/*\n**\tfroxel/anim/command.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport List from '../utils/list.js';\nimport Recycler from '../utils/recycler.js';\n\n//!class Command\n\nconst Command = Class.extend\n({\n\tclassName: 'Anim:Command',\n\n\t/**\n\t * \tObject having the code of the operation to execute.\n\t */\n\top: null,\n\n\t/**\n\t * \tIndicates if execution of the command has started.\n\t */\n\tstarted: false,\n\n\t/**\n\t * \tField related to the command.\n\t */\n\tfield: null,\n\n\t/**\n\t * \tValue related to the field of the command.\n\t */\n\tvalue: null,\n\n\t/**\n\t * \tDuration of the command.\n\t */\n\tduration: 0, _duration: 0,\n\n\t/**\n\t * \tNumber of cicles of the command.\n\t */\n\tcount: 0, _count: 0,\n\n\t/**\n\t * \tInitial value for the command's field.\n\t */\n\tstartValue: 0, _startValue: 0,\n\n\t/**\n\t * \tFinal value for the command's field.\n\t */\n\tendValue: 0, _endValue: 0,\n\n\t/**\n\t * \tEasing function to use to interpolate values of the command's field.\n\t */\n\teasing: null,\n\n\t_cur: null,\n\t_last: null,\n\n\t/**\n\t * \tBlock where the command is stored.\n\t */\n\tblock: null, /* Block */\n\n\t/**\n\t * \tBlocks to execute (for commands having multiple blocks).\n\t */\n\tblocks: null, /* List<Block> */\n\n\t/**\n\t * \tTable with values.\n\t */\n\ttable: null,\n\n\t/**\n\t * \tSound resource.\n\t */\n\tsnd: null,\n\n\t/**\n\t * \tFunction to execute.\n\t */\n\tfn: null,\n\n\t/**\n\t * \tInitializes the command.\n\t * \t!init (op: object) : Command;\n\t */\n\tinit: function (op, autoInit)\n\t{\n\t\tthis.op = op;\n\t\tthis.started = false;\n\n\t\tthis.block = null;\n\t\tthis.blocks = null;\n\t\n\t\tthis.table = null;\n\t\tthis.snd = null;\n\t\tthis.fn = null;\n\n\t\tif (autoInit !== false)\n\t\t\top.init(this, false);\n\n\t\treturn this;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tif (this.block !== null) this.block.clear().free();\n\t\tif (this.blocks !== null) this.blocks.clear().free();\n\t},\n\n\tclone: function()\n\t{\n\t\tlet cmd = Command.alloc(this.op, false);\n\n\t \tcmd.field = this.field\n\t \tcmd.value = this.value\n\t \tcmd.duration = this.duration\n\t \tcmd.count = this.count\n\t \tcmd.startValue = this.startValue\n\t \tcmd.endValue = this.endValue\n\t \tcmd.easing = this.easing;\n\t\tcmd.table = this.table;\n\t\tcmd.snd = this.snd;\n\t\tcmd.fn = this.fn;\n\n\t\tif (this.block !== null)\n\t\t\tcmd.block = this.block.clone();\n\n\t\tif (this.blocks !== null)\n\t\t{\n\t\t\tcmd.blocks = List.Pool.alloc();\n\n\t\t\tfor (let node = this.blocks.top; node !== null; node = node.next)\n\t\t\t\tcmd.blocks.push(node.value.clone());\n\t\t}\n\n\t\treturn cmd;\n\t},\n\n\t/**\n\t * \tExecuted when the command properties are ready, to initialize the operation code.\n\t * \t!ready() : void;\n\t */\n\tready: function()\n\t{\n\t\tthis.op.init(this, true);\n\t},\n\n\t/**\n\t * \tUpdates the command execution.\n\t * \t!update (anim: Anim, block: Block) : boolean;\n\t */\n\tupdate: function(anim, block)\n\t{\n\t\treturn this.op.update(anim, block, this);\n\t}\n});\n\n/**\n * \tAllocates a new command.\n * \t!static alloc () : Command;\n */\n\n/**\n * \tAllocates a new command and initializes it.\n * \t!static calloc () : Command;\n */\n\nRecycler.attachTo(Command);\nexport default Command;\n","/*\n**\tfroxel/anim/parallel.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport List from '../utils/list.js';\nimport Block from './block.js';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t\tif (!postinit)\n\t\t{\n\t\t\tcmd.block = Block.alloc();\n\t\t\tcmd.blocks = List.Pool.alloc();\n\t\t\treturn;\n\t\t}\n\n\t\tlet i;\n\n\t\twhile ((i = cmd.block.commands.shift()) != null)\n\t\t{\n\t\t\tlet block = Block.alloc();\n\t\t\tblock.add(i);\n\t\t\tcmd.blocks.push(block);\n\t\t}\n\n\t\tcmd.block.free();\n\t\tcmd.block = null;\n\t},\n\n\tupdate: function (anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tfor (let i = cmd.blocks.top; i !== null; i = i.next)\n\t\t\t{\n\t\t\t\ti.value.reset (block.time);\n\t\t\t}\n\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet time = block.time;\n\t\tlet n = 0, m = 0;\n\n\t\tfor (let i = cmd.blocks.top; i !== null; i = i.next)\n\t\t{\n\t\t\tlet r = i.value.update(anim);\n\t\t\tif (r === true) n++; else if (r === null) m++;\n\n\t\t\tif (i.value.time > time)\n\t\t\t\ttime = i.value.time;\n\t\t}\n\n\t\tif ((n+m) != cmd.blocks.length)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time = time;\n\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/serial.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Block from './block.js';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t\tif (!postinit)\n\t\t\tcmd.block = Block.alloc();\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd.block.reset (block.time);\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet r = cmd.block.update(anim);\n\t\tif (r !== true) return r;\n\n\t\tcmd.started = false;\n\t\tblock.time = cmd.block.time;\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/serial.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Block from './block.js';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t\tif (!postinit)\n\t\t\tcmd.block = Block.alloc();\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd.block.reset (block.time);\n\t\t\tcmd._count = cmd.count;\n\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet r = cmd.block.update(anim);\n\t\tif (r !== true) return r;\n\n\t\tif (cmd._count <= 1)\n\t\t{\n\t\t\tcmd.started = false;\n\t\t\tblock.time = cmd.block.time;\n\t\t\treturn true;\n\t\t}\n\n\t\tcmd.block.restart();\n\t\tcmd._count--;\n\t\treturn false;\n\t}\n};\n","/*\n**\tfroxel/anim/set.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tanim.setValue(cmd.field, anim.getValue(cmd.field, cmd.value));\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/restart.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tblock.restart();\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/wait.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rinn } from 'rinn';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._duration = Rinn.typeOf(cmd.duration) === 'string' ? anim.getValue(cmd.duration) : cmd.duration;\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tif (anim.time < block.time + cmd._duration)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time += cmd._duration;\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/range.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rinn } from 'rinn';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._startValue = anim.getValue(cmd.field, cmd.startValue);\n\t\t\tcmd._duration = Rinn.typeOf(cmd.duration) === 'string' ? anim.getValue(cmd.duration) : cmd.duration;\n\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tcmd._endValue = anim.getValue(cmd.field, cmd.endValue, cmd._startValue);\n\n\t\tlet t = 1.0;\n\n\t\tif (anim.time < block.time + cmd._duration)\n\t\t\tt = (anim.time - block.time) / cmd._duration;\n\n\t\tif (cmd.easing && t != 1.0)\n\t\t\tanim.setValue(cmd.field, cmd.easing(t)*(cmd._endValue - cmd._startValue) + cmd._startValue);\n\t\telse\n\t\t\tanim.setValue(cmd.field, t*(cmd._endValue - cmd._startValue) + cmd._startValue);\n\n\t\tif (t != 1.0)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time += cmd._duration;\n\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/rand.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rinn } from 'rinn';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._duration = Rinn.typeOf(cmd.duration) === 'string' ? anim.getValue(cmd.duration) : cmd.duration;\n\t\t\tcmd._last = null;\n\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet t = 1.0;\n\n\t\tif (anim.time < block.time + cmd._duration)\n\t\t\tt = (anim.time - block.time) / cmd._duration;\n\n\t\tif (cmd.easing && t != 1.0)\n\t\t\tcmd._cur = int(cmd.easing(t)*cmd.count);\n\t\telse\n\t\t\tcmd._cur = int(t*cmd.count);\n\n\t\tif (cmd._cur != cmd._last)\n\t\t{\n\t\t\tlet val = anim.getValue(cmd.field);\n\n\t\t\twhile (true) {\n\t\t\t\tlet i = int(Math.random()*(cmd.endValue - cmd.startValue + 1)) + cmd.startValue;\n\t\t\t\tif (i != val) break;\n\t\t\t}\n\n\t\t\tanim.setValue(cmd.field, i);\n\t\t\tcmd._last = cmd._cur;\n\t\t}\n\n\t\tif (t != 1.0)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time += cmd._duration;\n\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/randt.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rinn } from 'rinn';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t\tif (!postinit) return;\n\n\t\tlet table = [ ];\n\n\t\tfor (let i = 0; i < cmd.count; i++)\n\t\t\ttable.push ((i % (cmd.endValue - cmd.startValue + 1)) + cmd.startValue);\n\n\t\tfor (let i = cmd.count >> 2; i > 0; i--)\n\t\t{\n\t\t\tlet a = int(Math.random() * cmd.count);\n\t\t\tlet b = int(Math.random() * cmd.count);\n\n\t\t\tlet c = table[b];\n\t\t\ttable[b] = table[a];\n\t\t\ttable[a] = c;\n\t\t}\n\n\t\tcmd.table = table;\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._duration = Rinn.typeOf(cmd.duration) === 'string' ? anim.getValue(cmd.duration) : cmd.duration;\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet t = 1.0;\n\t\tlet i;\n\n\t\tif (anim.time < block.time + cmd._duration)\n\t\t\tt = (anim.time - block.time) / cmd._duration;\n\n\t\tif (cmd.easing && t != 1.0)\n\t\t\ti = cmd.easing(t)*(cmd.count-1);\n\t\telse\n\t\t\ti = t*(cmd.count-1);\n\n\t\tanim.setValue(cmd.field, cmd.table[int((i + cmd.count) % cmd.count)]);\n\n\t\tif (t != 1.0)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time += cmd._duration;\n\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/anim.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport List from '../utils/list.js';\nimport Recycler from '../utils/recycler.js';\nimport sys from '../fxl/system.js';\n\n//![import \"../utils/list\"]\n//![import \"../utils/recycler\"]\n\nimport Block from './block.js';\nimport Command from './command.js';\n\n//![import \"./block\"]\n//![import \"./command\"]\n\nimport PARALLEL from './parallel.js';\nimport SERIAL from './serial.js';\nimport REPEAT from './repeat.js';\nimport SET from './set.js';\nimport RESTART from './restart.js';\nimport WAIT from './wait.js';\nimport RANGE from './range.js';\nimport RAND from './rand.js';\nimport RANDT from './randt.js';\n\n//:/**\n//: * \tClass to animate properties using commands.\n//: */\n\n//!class Anim\n\nconst Anim = Class.extend\n({\n\tclassName: 'Anim',\n\n\tinitialData: null,\n\tdata: null,\n\n\tblockStack: null,\n\tcmdStack: null,\n\n\ttimeScale: 1,\n\tblock: null,\n\ttime: 0,\n\n\tpaused: false,\n\tfinished: false,\n\trunning: false,\n\n\tfinishedCallback: null,\n\tfinishedCallbackHandler: null,\n\tfinishedCallbackContext: null,\n\n\tautoDispose: false,\n\n\t__ctor: function ()\n\t{\n\t\t// VIOLET: Possibly optimize this { } objects.\n\t\tthis.initialData = { };\n\t\tthis.data = { };\n\n\t\tthis.block = Block.alloc();\n\t\tthis.blockStack = List.Pool.alloc();\n\t\tthis.cmdStack = List.Pool.alloc();\n\n\t\tthis.running = false;\n\t\tthis.autoDispose = false;\n\n\t\tthis.finishedCallback = null;\n\t\tthis.finishedCallbackHandler = null;\n\t\tthis.finishedCallbackContext = null;\n\n\t\treturn this.reset();\n\t},\n\n\t__dtor: function ()\n\t{\n\t\tthis.block.free();\n\t\tthis.blockStack.clear().free();\n\t\tthis.cmdStack.clear().free();\n\n\t\tif (this.finishedCallbackHandler !== null)\n\t\t{\n\t\t\tthis.finishedCallbackHandler.free();\n\t\t\tthis.finishedCallbackHandler = null;\n\t\t}\n\n\t\tif (this.finishedCallbackContext !== null)\n\t\t{\n\t\t\tthis.finishedCallbackContext.free();\n\t\t\tthis.finishedCallbackContext = null;\n\t\t}\n\t},\n\n\tcopyTo: function (target)\n\t{\n\t\ttarget.clear();\n\n\t\tdispose(target.block);\n\t\ttarget.block = this.block.clone();\n\n\t\ttarget.initialData = this.initialData;\n\t\treturn target.reset();\n\t},\n\n\tclone: function (autoDispose=false)\n\t{\n\t\tlet anim = new Anim();\n\t\tanim.autoDispose = autoDispose;\n\n\t\tthis.copyTo(anim);\n\t\treturn anim;\n\t},\n\n\tonFinished: function (callback)\n\t{\n\t\tthis.finishedCallback = callback;\n\t\treturn this;\n\t},\n\n\tthen: function (callback, context=null)\n\t{\n\t\tif (!callback) return this;\n\n\t\tif (this.finishedCallback !== this.thenCallback)\n\t\t{\n\t\t\tthis.finishedCallback = this.thenCallback;\n\n\t\t\tif (this.finishedCallbackHandler === null)\n\t\t\t{\n\t\t\t\tthis.finishedCallbackHandler = List.Pool.alloc();\n\t\t\t\tthis.finishedCallbackContext = List.Pool.alloc();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.finishedCallbackHandler.reset();\n\t\t\t\tthis.finishedCallbackContext.reset();\n\t\t\t}\n\t\t}\n\n\t\tthis.finishedCallbackHandler.push(callback);\n\t\tthis.finishedCallbackContext.push(context);\n\t\treturn this;\n\t},\n\n\tthenCallback: function ()\n\t{\n\t\tif (!this.finishedCallbackHandler.length)\n\t\t\treturn false;\n\n\t\tlet context = this.finishedCallbackContext.shift();\n\t\tthis.finishedCallbackHandler.shift()(this, context);\n\t},\n\n\t/*\n\t**\tClears the object, removes all commands and callbacks. The `initialData` and `data` objects aren't changed.\n\t*/\n\tclear: function ()\n\t{\n\t\tthis.blockStack.clear();\n\t\tthis.cmdStack.clear();\n\t\tthis.block.clear();\n\n\t\tthis.paused = false;\n\t\tthis.finished = false;\n\t\tthis.time = 0;\n\t\tthis.timeScale = 1;\n\n\t\tif (this.finishedCallbackHandler !== null)\n\t\t{\n\t\t\tthis.finishedCallbackHandler.free();\n\t\t\tthis.finishedCallbackHandler = null;\n\t\t}\n\n\t\tif (this.finishedCallbackContext !== null)\n\t\t{\n\t\t\tthis.finishedCallbackContext.free();\n\t\t\tthis.finishedCallbackContext = null;\n\t\t}\n\n\t\tthis.finishedCallback = null;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tResets the animation to its initial state.\n\t*/\n\treset: function ()\n\t{\n\t\tthis.blockStack.clear();\n\t\tthis.cmdStack.clear();\n\t\tthis.block.reset();\n\n\t\tthis.paused = false;\n\t\tthis.finished = false;\n\t\tthis.time = 0;\n\t\tthis.timeScale = 1;\n\n\t\tObject.assign (this.data, this.initialData);\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the initial data.\n\t*/\n\tinitial: function (data=null)\n\t{\n\t\tif (data !== null)\n\t\t\tthis.initialData = data;\n\n\t\tObject.assign (this.data, this.initialData);\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the time scale (animation speed).\n\t*/\n\tspeed: function (value)\n\t{\n\t\tthis.timeScale = value > 0.0 ? value : 1.0;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the output data object.\n\t*/\n\toutput: function (data)\n\t{\n\t\tthis.data = data;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tPauses the animation.\n\t*/\n\tpause: function ()\n\t{\n\t\tif (!this.paused)\n\t\t\tthis.paused = true;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tResumes the animation.\n\t*/\n\tresume: function ()\n\t{\n\t\tthis.finished = false;\n\t\tthis.paused = false;\n\n\t\tif (!this.running)\n\t\t\tthis.run(false);\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tBegins execution of the animation.\n\t*/\n\trun: function (reset=true)\n\t{\n\t\tif (this.running)\n\t\t\treturn this;\n\n\t\tif (reset == true)\n\t\t\tthis.reset();\n\n\t\tsys.update.add(this.update, this);\n\t\tthis.running = true;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the value of a field.\n\t*/\n\tsetValue: function (fieldName, value)\n\t{\n\t\tlet curr = this.data;\n\n\t\tif (typeof(fieldName) !== 'string')\n\t\t{\n\t\t\tif (typeof(fieldName) === 'function')\n\t\t\t{\n\t\t\t\tfieldName (this, value);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet i = 0;\n\n\t\t\t\twhile (curr !== null && i < fieldName.length-1)\n\t\t\t\t\tcurr = curr[fieldName[i++]];\n\n\t\t\t\tcurr[fieldName[i]] = value;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tcurr[fieldName] = value;\n\t},\n\n\t/*\n\t**\tReturns the value of a field. Performs special transforms to the value if certain prefix is found.\n\t*/\n\tgetValue: function (fieldName, value=null, initialValue=null)\n\t{\n\t\tlet curr = this.data;\n\t\t\n\t\tif (typeof(fieldName) !== 'string')\n\t\t{\n\t\t\tif (typeof(fieldName) === 'function')\n\t\t\t{\n\t\t\t\tcurr = fieldName (this, null);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet i = 0;\n\n\t\t\t\twhile (curr !== null && i < fieldName.length)\n\t\t\t\t\tcurr = curr[fieldName[i++]];\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tcurr = curr[fieldName];\n\n\t\tif (value === null)\n\t\t\tvalue = curr;\n\n\t\tif (initialValue === null)\n\t\t\tinitialValue = curr;\n\n\t\tif (typeof(value) === 'string')\n\t\t{\n\t\t\tswitch(value[0])\n\t\t\t{\n\t\t\t\tcase '+':\n\t\t\t\t\tvalue = initialValue + Number(value.substr(1));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase '-':\n\t\t\t\t\tvalue = initialValue - Number(value.substr(1));\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tvalue = Number(value);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\telse if (typeof(value) === 'function')\n\t\t\tvalue = value (curr, initialValue, this);\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * Updates the animation by the specified delta, which must be in the same unit as the duration of the commands.\n\t * Returns false when the animation has been completed.\n\t *\n\t * @param {number} dt\n\t * @returns {boolean}\n\t */\n\tupdate: function (dt, self=null)\n\t{\n\t\tif (self === null)\n\t\t\tself = this;\n\n\t\tif (self.paused || self.block.isFinished())\n\t\t{\n\t\t\tself.running = false;\n\t\t\treturn false;\n\t\t}\n\n\t\tself.time += dt*self.timeScale*Anim.timeScale;\n\n\t\tif (self.block.update(self) !== true)\n\t\t\treturn true;\n\n\t\tlet finished = self.finished;\n\t\tlet count = self.block.length;\n\t\tlet block = self.block;\n\n\t\tself.finished = true;\n\n\t\tif (!finished && self.finishedCallback !== null)\n\t\t{\n\t\t\tif (self.finishedCallback(self.data, self) === false)\n\t\t\t\tself.finishedCallback = null;\n\n\t\t\tif (self.block !== block || self.block.length != count)\n\t\t\t{\n\t\t\t\tself.resume();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\tself.running = false;\n\n\t\tif (self.autoDispose)\n\t\t\tdispose(self);\n\n\t\treturn false;\n\t},\n\n\t/*\n\t**\tEnsures that the field name is correct for subsequent rules.\n\t*/\n\tprepareFieldName: function (value)\n\t{\n\t\tif (typeof(value) === 'function')\n\t\t\treturn value;\n\n\t\treturn value.indexOf('.') != -1 ? value.split('.') : value;\n\t},\n\n\t/* ****************************************************************************************** */\n\n\t/*\n\t**\tRuns the subsequent commands in parallel. Should end the parallel block by calling end().\n\t*/\n\tparallel: function ()\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(PARALLEL));\n\n\t\tthis.blockStack.push (this.block);\n\t\tthis.cmdStack.push (cmd);\n\n\t\tthis.block = cmd.block;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tRuns the subsequent commands in series. Should end the serial block by calling end().\n\t*/\n\tserial: function ()\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(SERIAL));\n\n\t\tthis.blockStack.push (this.block);\n\t\tthis.cmdStack.push (cmd);\n\n\t\tthis.block = cmd.block;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tRepeats a block the specified number of times.\n\t*/\n\trepeat: function (count)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(REPEAT));\n\t\tcmd.count = count;\n\n\t\tthis.blockStack.push (this.block);\n\t\tthis.cmdStack.push (cmd);\n\n\t\tthis.block = cmd.block;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tEnds a parallel(), serial() or repeat() block.\n\t*/\n\tend: function ()\n\t{\n\t\tthis.cmdStack.pop().ready();\n\t\tthis.block = this.blockStack.pop();\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the value of a variable.\n\t*/\n\tset: function (field, value)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(SET));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.value = value;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tRestarts the current block.\n\t*/\n\trestart: function ()\n\t{\n\t\tthis.block.add(Command.alloc(RESTART));\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tWaits for the specified duration.\n\t*/\n\twait: function (duration)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(WAIT));\n\n\t\tcmd.duration = duration;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the range of a variable.\n\t*/\n\trange: function (field, duration, startValue, endValue, easing=null)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(RANGE));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.duration = duration;\n\t\tcmd.startValue = startValue;\n\t\tcmd.endValue = endValue;\n\t\tcmd.easing = easing;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the range of a variable, using the current value as startValue.\n\t*/\n\trangeTo: function (field, duration, endValue, easing=null)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(RANGE));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.duration = duration;\n\t\tcmd.startValue = null;\n\t\tcmd.endValue = endValue;\n\t\tcmd.easing = easing;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tGenerates a certain amount of random numbers in the given range (inclusive).\n\t*/\n\trand: function (field, duration, count, startValue, endValue, easing=null)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(RAND));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.duration = duration;\n\t\tcmd.count = count;\n\t\tcmd.startValue = startValue;\n\t\tcmd.endValue = endValue;\n\t\tcmd.easing = easing;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tGenerates a certain amount of random numbers in the given range (inclusive). This uses a static random table to determine the next values.\n\t*/\n\trandt: function (field, duration, count, startValue, endValue, easing)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(RANDT));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.duration = duration;\n\t\tcmd.count = count;\n\t\tcmd.startValue = startValue;\n\t\tcmd.endValue = endValue;\n\t\tcmd.easing = easing;\n\n\t\tcmd.ready();\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tPlays a sound.\n\t*/\n\tplay: function (snd)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(PLAY));\n\t\tcmd.snd = snd;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tExecutes a function.\n\t*/\n\texec: function (fn)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(EXEC));\n\t\tcmd.fn = fn;\n\n\t\treturn this;\n\t},\n\n\t/* ********************************************************** */\n\n\t_bounds_x1: function (anim, value)\n\t{\n\t\tif (value === null)\n\t\t\treturn anim.data.bounds.x1;\n\n\t\tanim.data.translate(int(value) - anim.data.bounds.x1, 0);\n\t},\n\n\t_bounds_y1: function (anim, value)\n\t{\n\t\tif (value === null)\n\t\t\treturn anim.data.bounds.y1;\n\n\t\tanim.data.translate(0, int(value) - anim.data.bounds.y1);\n\t},\n\n\t/*\n\t**\tSets X coordinate.\n\t*/\n\tsetX: function (value)\n\t{\n\t\treturn this.set(this._bounds_x1, value);\n\t},\n\n\t/*\n\t**\tSets Y coordinate.\n\t*/\n\tsetY: function (value)\n\t{\n\t\treturn this.set(this._bounds_y1, value);\n\t},\n\n\t/*\n\t**\tSets X and Y coordinates.\n\t*/\n\tposition: function (x, y)\n\t{\n\t\treturn this.set(this._bounds_x1, x).set(this._bounds_y1, y);\n\t},\n\n\t/*\n\t**\tTranslates the X coordinate.\n\t*/\n\ttranslateX: function (duration, deltaValue, easing)\n\t{\n\t\treturn this.range(this._bounds_x1, duration, null, (deltaValue < 0 ? '-' : '+') + Math.abs(deltaValue), easing);\n\t},\n\n\t/*\n\t**\tTranslates the Y coordinate.\n\t*/\n\ttranslateY: function (duration, deltaValue, easing)\n\t{\n\t\treturn this.range(this._bounds_y1, duration, null, (deltaValue < 0 ? '-' : '+') + Math.abs(deltaValue), easing);\n\t},\n\n\t/*\n\t**\tTranslates the X and Y coordinates.\n\t*/\n\ttranslate: function (duration, deltaValueX, deltaValueY, easingX, easingY=null)\n\t{\n\t\treturn this.parallel()\n\t\t\t\t\t.range(this._bounds_x1, duration, null, (deltaValueX < 0 ? '-' : '+') + Math.abs(deltaValueX), easingX)\n\t\t\t\t\t.range(this._bounds_y1, duration, null, (deltaValueY < 0 ? '-' : '+') + Math.abs(deltaValueY), easingY ? easingY : easingX)\n\t\t\t\t.end();\n\t},\n\n\t/*\n\t**\tSets the X and Y coordinates to the specified values.\n\t*/\n\tmoveTo: function (duration, endValueX, endValueY, easingX, easingY=null)\n\t{\n\t\treturn this.parallel()\n\t\t\t\t.range(this._bounds_x1, duration, null, endValueX, easingX)\n\t\t\t\t.range(this._bounds_y1, duration, null, endValueY, easingY ? easingY : easingX)\n\t\t\t\t.end();\n\t},\n\n\t/*\n\t**\tSets the X coordinate to the specified value.\n\t*/\n\tmoveX: function (duration, endValue, easing=null)\n\t{\n\t\treturn this.range(this._bounds_x1, duration, null, endValue, easing);\n\t},\n\n\t/*\n\t**\tSets the Y coordinate to the specified value.\n\t*/\n\tmoveY: function (duration, endValue, easing=null)\n\t{\n\t\treturn this.range(this._bounds_y1, duration, null, endValue, easing);\n\t},\n\n\t/*\n\t**\tScales the X coordinate.\n\t*/\n\tscaleX: function (duration, endValue, easing)\n\t{\n\t\treturn this.range('sx', duration, null, endValue, easing);\n\t},\n\n\t/*\n\t**\tScales the Y coordinate.\n\t*/\n\tscaleY: function (duration, endValue, easing)\n\t{\n\t\treturn this.range('sy', duration, null, endValue, easing);\n\t},\n\n\t/*\n\t**\tScales the X and Y coordinates.\n\t*/\n\tscale: function (duration, endValueX, endValueY, easingX, easingY=null)\n\t{\n\t\treturn this.parallel()\n\t\t\t\t.range('sx', duration, null, endValueX, easingX)\n\t\t\t\t.range('sy', duration, null, endValueY, easingY ? easingY : easingX)\n\t\t\t\t.end();\n\t},\n\n\t/*\n\t**\tRotates a certain number of radians.\n\t*/\n\trotate: function (duration, deltaValue, easing)\n\t{\n\t\treturn this.range('angle', duration, null, (deltaValue < 0 ? '-' : '+') + Math.abs(deltaValue), easing);\n\t}\n});\n\n/*\n**\tGlobal time scale.\n*/\nAnim.timeScale = 1.0;\n\n/*\n**\tSets the global time scale (animation speed).\n*/\nAnim.speed = function (value)\n{\n\tAnim.timeScale = value > 0.0 ? value : 1.0;\n};\n\nRecycler.createPool(Anim, 8192);\nexport default Anim;\n","/*\n**\tflow/grid-element.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Bounds2 from '../math/bounds2.js';\nimport Handler from '../utils/handler.js';\n\n//![import \"../math/bounds2\"]\n//![import \"../utils/handler\"]\n\n//:/**\n//: * \tDescribes an element that can be added to a grid.\n//: */\n\n//!class GridElement\n\nconst GridElement = Class.extend\n({\n\t/*\n\t**\tName of the class (for inheritance purposes).\n\t*/\n\tclassName: 'GridElement',\n\n\t/**\n\t * \tIdentifier of the element (string).\n\t * \t!id: string;\n\t */\n\tid: null,\n\n\t/**\n\t * \tBounds of the element.\n\t * \t!bounds: Bounds2;\n\t */\n\tbounds: null,\n\n\t/**\n\t * \tFlags of the element (see constants of this class).\n\t * \t!flags: number;\n\t */\n\tflags: 0,\n\n\t/**\n\t * \tGeneric data of the element, used to store some value or object.\n\t * \t!data: object;\n\t */\n\tdata: null,\n\n\t/**\n\t * \tExtension object of the element, can be used to implement specific functionality.\n\t * \t!ext: object;\n\t */\n\text: null,\n\n\t/**\n\t * \tThe container where the element is stored.\n\t */\n\tcontainer: null,\n\n\t/**\n\t * \tRemoval callback node added by Grid.\n\t */\n\t_grid_remove_node: null,\n\n\t/**\n\t * \tRemover runs when the `remove` method of the element is called or when the element is destroyed.\n\t */\n\tremover: null,\n\n\t/**\n\t * \tConstructs the instance at the specified position and with the specified size.\n\t * \t!constructor (x: number, y: number, width: number, height: number);\n\t */\n\t__ctor: function (x, y, width, height)\n\t{\n\t\tthis.bounds = Bounds2.Pool.alloc();\n\n\t\tthis.bounds.translate (x, y);\n\t\tthis.bounds.resize (width, height, true);\n\n\t\tthis.flags = GridElement.ALIVE | GridElement.VISIBLE | GridElement.DIRTY | GridElement.DEPTH_FLAG;\n\t\tthis.data = null;\n\t\tthis.ext = null;\n\n\t\tthis.remover = Handler.Pool.alloc(this);\n\t},\n\n\t/**\n\t * \tRemoves the element from its container and destroys it.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.alive(false);\n\n\t\tif (this.data !== null)\n\t\t{\n\t\t\tdispose(this.data);\n\t\t\tthis.data = null;\n\t\t}\n\n\t\tthis.remover.exec();\n\t\tthis.remover.free();\n\n\t\tthis.bounds.free();\n\t},\n\n\t/**\n\t * \tSets the identifier of the element.\n\t * \t!setId (value: string) : GridElement;\n\t */\n\tsetId: function (value)\n\t{\n\t\tthis.id = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets bits of the element flags.\n\t * \t!setFlags (value: number) : GridElement;\n\t */\n\tsetFlags: function (value)\n\t{\n\t\tthis.flags |= value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tClears bits from the element flags.\n\t * \t!clearFlags (value: number) : GridElement;\n\t */\n\tclearFlags: function (value)\n\t{\n\t\tthis.flags &= ~value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns true if masking (bitwise AND) the flags by the specified flag bits results in the given value.\n\t * \t!getFlags (andMask: number, value?: number) : boolean;\n\t */\n\tgetFlags: function (andMask, value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn (this.flags & andMask) === andMask;\n\n\t\treturn (this.flags & andMask) === value;\n\t},\n\n\t/**\n\t * \tSets the generic data of the element. Will be disposed when the element is destroyed.\n\t * \t!setData (data: object) : GridElement;\n\t */\n\tsetData: function (data)\n\t{\n\t\tthis.data = data;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the generic data of the element.\n\t * \t!getData() : object;\n\t */\n\tgetData: function()\n\t{\n\t\treturn this.data;\n\t},\n\n\t/**\n\t * \tSets the extension object of the element. Calls to functions of this object should be done using the `exec` method.\n\t * \t!setExt (extensionObject: object) : GridElement;\n\t */\n\tsetExt: function (extensionObject)\n\t{\n\t\tthis.ext = extensionObject;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the extension object of the element.\n\t * \t!getExt() : object;\n\t */\n\tgetExt: function()\n\t{\n\t\treturn this.ext;\n\t},\n\n\t/**\n\t * Executes a function of the extension object.\n\t * @param {string} name\n\t * !exec (name: string, ...args: any) : any;\n\t */\n\texec: function(name, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null, arg6=null, arg7=null, arg8=null, arg9=null)\n\t{\n\t\tif (this.ext === null || !this.ext.hasOwnProperty(name))\n\t\t\treturn false;\n\n\t\treturn this.ext[name] (this, arg0, arg1, arg2, arg3, arg4, arg5, arg6, arg7, arg8, arg9);\n\t},\n\n\t/**\n\t * Sets the visible flag.\n\t * @param {boolean} value - New visibility value.\n\t * @param {boolean} forced - When `true` forces to ignore the VISIBLE_LOCK flag.\n\t * !visible (value: boolean, forced?: boolean|false) : GridElement;\n\t */\n\t/**\n\t * Returns the visible flag.\n\t * !visible() : boolean;\n\t */\n\tvisible: function (value=null, forced=false)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.VISIBLE);\n\n\t\tif (!forced && this.flags & GridElement.VISIBLE_LOCK)\n\t\t\treturn this;\n\n\t\tthis.flags &= ~GridElement.VISIBLE;\n\t\tif (value) this.flags |= GridElement.VISIBLE;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the visible-lock flag.\n\t * \t!visibleLock (value: boolean) : GridElement;\n\t */\n\t/**\n\t * \tReturns the visible-lock flag.\n\t * \t!visibleLock() : boolean;\n\t */\n\tvisibleLock: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.VISIBLE_LOCK);\n\n\t\tthis.flags &= ~GridElement.VISIBLE_LOCK;\n\t\tif (value) this.flags |= GridElement.VISIBLE_LOCK;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the alive flag.\n\t * \t!alive (value: boolean) : GridElement;\n\t */\n\t/**\n\t * \tReturns the alive flag.\n\t * \t!alive() : boolean;\n\t */\n\talive: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.ALIVE);\n\n\t\tthis.flags &= ~GridElement.ALIVE;\n\t\tif (value) this.flags |= GridElement.ALIVE;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the dirty flag.\n\t * \t!alive (value: boolean) : GridElement;\n\t */\n\t/**\n\t * \tReturns the dirty flag.\n\t * \t!alive() : boolean;\n\t */\n\tdirty: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.DIRTY);\n\n\t\tthis.flags &= ~GridElement.DIRTY;\n\t\tif (value) this.flags |= GridElement.DIRTY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the depth-flag-enabled flag.\n\t * \t!depthFlagEnabled (value: boolean) : GridElement;\n\t */\n\t/**\n\t * \tReturns the depth-flag-enabled flag.\n\t * \t!depthFlagEnabled() : boolean;\n\t */\n\tdepthFlagEnabled: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.DEPTH_FLAG_ENABLED);\n\n\t\tthis.flags &= ~GridElement.DEPTH_FLAG_ENABLED;\n\t\tif (value) this.flags |= GridElement.DEPTH_FLAG_ENABLED;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the depth-flag flag. To actually use the depth-test, you have to enable the depth-flag using `depthFlagEnabled`.\n\t * \t!depthFlagEnabled (value: boolean) : GridElement;\n\t */\n\t/**\n\t * \tReturns the depth-flag flag.\n\t * \t!depthFlagEnabled() : boolean;\n\t */\n\tdepthFlag: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.DEPTH_FLAG);\n\n\t\tthis.flags &= ~GridElement.DEPTH_FLAG;\n\t\tif (value) this.flags |= GridElement.DEPTH_FLAG;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tRemoves the element from the container and returns itself.\n\t * \t!remove() : GridElement;\n\t */\n\tremove: function()\n\t{\n\t\tthis.remover.exec();\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSyncs the actual location of the specified element with its storage location (if alive and dirty).\n\t * \t!sync() : GridElement;\n\t */\n\tsync: function()\n\t{\n\t\tif (this.container === null || !this.getFlags(GridElement.ALIVE | GridElement.DIRTY))\n\t\t\treturn this;\n\n\t\tthis.container.sync(this);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the width and height of the element.\n\t * \t!resize (width: number, height: number) : GridElement;\n\t */\n\tresize: function (width, height)\n\t{\n\t\tthis.flags |= GridElement.DIRTY;\n\t\tthis.bounds.resize (width ?? this.bounds.width(), height ?? this.bounds.height(), true);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResizes the element by the specified deltas.\n\t * \t!resizeBy (deltaWidth: number, deltaHeight: number) : GridElement;\n\t */\n\tresizeBy: function (dWidth, dHeight)\n\t{\n\t\treturn this.resize(this.bounds.width() + dWidth, this.bounds.height() + dHeight);\n\t},\n\n\t/**\n\t * \tMoves the element by the specified deltas.\n\t * \t@param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * \t!translate (dx: number, dy: number, upscaled?: boolean) : GridElement;\n\t */\n\ttranslate: function (dx, dy, upscaled=false)\n\t{\n\t\tthis.flags |= GridElement.DIRTY;\n\t\tthis.bounds.translate (dx, dy, upscaled);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the position of the element. Any parameter set to `null` will cause it not to be changed.\n\t * \t!setPosition (x: number, y: number) : GridElement;\n\t */\n\t/**\n\t * \tSets the position of the element. Any parameter set to `null` will cause it not to be changed.\n\t * \t!setPosition (pointer: {x:number, y:number}) : GridElement;\n\t */\n\tsetPosition: function (x, y=false)\n\t{\n\t\tif (y === false) {\n\t\t\ty = x.y;\n\t\t\tx = x.x;\n\t\t}\n\n\t\treturn this.translate (x !== null ? upscale(x)-this.bounds.ux1 : 0, y !== null ? upscale(y)-this.bounds.uy1 : 0, true);\n\t}\n});\n\n/*\n**\tGrid element flags.\n*/\nGridElement.ALIVE \t\t\t\t= \t0x0001;\nGridElement.VISIBLE \t\t\t= \t0x0002;\nGridElement.VISIBLE_LOCK \t\t= \t0x0004;\nGridElement.DIRTY \t\t\t\t= \t0x0008;\nGridElement.DEPTH_FLAG_ENABLED\t= \t0x0010;\nGridElement.DEPTH_FLAG\t\t\t= \t0x0020;\nGridElement.WRAP_EXTENTS\t\t=\t0x0040;\n\nGridElement.USERDEF\t\t=\t0x0100; /* Bits 8 to 30 : 23 flags  */\nGridElement.LAST_FLAG\t=\t0x0080;\n\n/**\n * \tClass-level function to allocate a new flag.\n * \t!static allocFlag() : number;\n */\nGridElement.allocFlag = function()\n{\n\tlet flag = GridElement.LAST_FLAG;\n\tif (flag === 0x4000_0000) throw new Error ('allocFlag: out of bit space to allocate another flag');\n\n\tflag <<= 1;\n\tGridElement.LAST_FLAG = flag;\n\n\treturn flag;\n};\n\nexport default GridElement;\n","/*\n**\tflow/grid.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport GridElement from './grid-element.js';\nimport List from '../utils/list.js';\n\n//![import \"./grid-element\"]\n//![import \"../utils/list\"]\n\n//:/**\n//: * \tDescribes an optimized data structure to store 2D spatially indexed elements.\n//: */\n\n//!class Grid\n\nconst Grid = Class.extend\n({\n\t/**\n\t * \tName of the class (for inheritance purposes).\n\t */\n\tclassName: 'Grid',\n\n\t/**\n\t * \tActual grid of data, stored linearly. Contains several entries each of which can be either null or a List containing grid elements.\n\t */\n\tgrid: null,\n\n\t/**\n\t * \tNumber of elements active in the grid.\n\t * \t!readonly count: number;\n\t */\n\tcount: 0,\n\n\t/**\n\t * \tThe X and Y offsets to be added to all input coordinates. Used to ensure that a negative coordinate always ends up positive, calculated\n\t * \tusing the width and height of the grid.\n\t */\n\toffsx: 0, offsy: 0,\n\n\t/**\n\t * \tDivisors for the X and Y coordinates respectively. All input coordinates (after offseting) will be divided by these values to map them\n\t * \tto a grid entry (list) where the element can be added.\n\t */\n\tkx: 0, ky: 0,\n\n\t/**\n\t * \tStride to calculate an index with a Y-coordinate.\n\t */\n\tstride: 0,\n\n\t/**\n\t * \tIndicates if the grid should match regions with exact precision by comparing region to element bounds intersection.\n\t * \t!verifyIntersection: boolean;\n\t */\n\tverifyIntersection: true,\n\n\t/**\n\t * \tConstructs a grid with the specified maximum width and height. The final effective coordinate range will be -(width/2) to (width/2)for X,\n\t * \tand -(height/2) to (height/2) for Y.\n\t * \n\t * \tNote that the width, height and divisors kx and ky will be converted to their closest base-2 value. This is done to ensure shifts can be used\n\t * \tto quickly divide the input coordinates.\n\t * \n\t * \t!constructor (width: number, height: number, kx: number, ky?: number);\n\t */\n\t__ctor: function (width, height, kx, ky=null)\n\t{\n\t\twidth = 1 << Math.ceil(Math.log2(width));\n\t\theight = 1 << Math.ceil(Math.log2(height));\n\n\t\tthis.offsx = width >> 1;\n\t\tthis.offsy = height >> 1;\n\n\t\tif (ky === null)\n\t\t\tky = kx;\n\n\t\tkx = Math.floor(Math.log2(kx));\n\t\tky = Math.floor(Math.log2(ky));\n\n\t\tthis.kx = kx;\n\t\tthis.ky = ky;\n\n\t\tlet w = width >> kx;\n\t\tlet h = height >> ky;\n\n\t\tif (!w) {\n\t\t\tkx = Math.log2(width);\n\t\t\tw = 1;\n\t\t}\n\n\t\tif (!h) {\n\t\t\tky = Math.log2(height);\n\t\t\th = 1;\n\t\t}\n\n\t\tthis.grid = new Array(w*h).fill(null);\n\t\tthis.stride = w;\n\t},\n\n\t/**\n\t * \tDestroys all lists and elements in the grid.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis.grid = null;\n\t},\n\n\t/**\n\t * \tDestroys all lists and elements in the grid.\n\t * \t!clear() : void;\n\t */\n\tclear: function()\n\t{\n\t\tfor (let i = 0; i < this.grid.length; i++)\n\t\t{\n\t\t\tif (this.grid[i] === null)\n\t\t\t\tcontinue;\n\n\t\t\tlet j;\n\n\t\t\twhile ((j = this.grid[i].shift()) !== null)\n\t\t\t{\n\t\t\t\tj.remover.remove(this._remove, this);\n\t\t\t\tj.container = null;\n\n\t\t\t\tdispose(j);\n\t\t\t}\n\n\t\t\tthis.grid[i].free();\n\t\t\tthis.grid[i] = null;\n\t\t}\n\n\t\tthis.count = 0;\n\t},\n\n\t/**\n\t * \tDestroys all lists in the grid. Elements will not be destroyed.\n\t * \t!reset() : void;\n\t */\n\treset: function()\n\t{\n\t\tfor (let i = 0; i < this.grid.length; i++)\n\t\t{\n\t\t\tif (this.grid[i] === null)\n\t\t\t\tcontinue;\n\n\t\t\tlet j;\n\n\t\t\twhile ((j = this.grid[i].shift()) !== null)\n\t\t\t{\n\t\t\t\tj.remover.remove(this._remove, this);\n\t\t\t\tj.container = null;\n\t\t\t}\n\n\t\t\tthis.grid[i].free();\n\t\t\tthis.grid[i] = null;\n\t\t}\n\n\t\tthis.count = 0;\n\t},\n\n\t/**\n\t * \tAdds an element to the grid. Returns `true` if successful, or `false` if the element is outside of the grid bounds.\n\t * \t!add (elem: GridElement) : boolean;\n\t */\n\tadd: function (elem)\n\t{\n\t\tif (!GridElement.isInstance(elem))\n\t\t\tthrow new Error ('argument must be a GridElement');\n\n\t\tlet i = int((elem.bounds.y1+this.offsy) >> this.ky) * this.stride + int((elem.bounds.x1+this.offsx) >> this.kx);\n\t\tif (i < 0 || i >= this.grid.length) return false;\n\n\t\tif (this.grid[i] === null)\n\t\t\tthis.grid[i] = List.Pool.alloc();\n\n\t\tthis.grid[i].push(elem);\n\t\tthis.count++;\n\n\t\telem.container = this;\n\t\telem._grid_remove_node = elem.remover.add(this._remove, this, i, this.grid[i].bottom);\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tCallback to remove an element from the grid (called by Handler).\n\t */\n\t_remove: function (elem, self, index, node)\n\t{\n\t\tself.grid[index].remove(node);\n\t\tself.count--;\n\n\t\telem.container = null;\n\t\treturn false;\n\t},\n\n\t/**\n\t * \tRemoves the element from the grid and returns it.\n\t * \t!remove (elem: GridElement) : GridElement;\n\t */\n\tremove: function (elem)\n\t{\n\t\telem.remover.execc(this._grid_remove_node);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tUpdates the storage location of the specified element. Returns `true` if successful, or `false` if the element is outside of the grid bounds (in\n\t * \twhich case the element will be removed), or if the element does not belong to this grid.\n\t * \t!sync (elem: GridElement) : boolean;\n\t */\n\tsync: function (elem)\n\t{\n\t\telem.clearFlags(GridElement.DIRTY);\n\n\t\tlet node = elem._grid_remove_node;\n\n\t\tlet i = int((elem.bounds.y1+this.offsy) >> this.ky) * this.stride + int((elem.bounds.x1+this.offsx) >> this.kx);\n\t\tif (i < 0 || i >= this.grid.length)\n\t\t{\n\t\t\telem.remover.execc(node);\n\t\t\treturn false;\n\t\t}\n\n\t\tif (node.arg1 === i)\n\t\t\treturn true;\n\n\t\tthis.grid[node.arg1].remove(node.arg2);\n\n\t\tif (this.grid[i] === null)\n\t\t\tthis.grid[i] = List.Pool.alloc();\n\n\t\tthis.grid[i].push(elem);\n\n\t\tnode.arg1 = i;\n\t\tnode.arg2 = this.grid[i].bottom;\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tExecutes the specified callback function for each element that intersects the given bounds and has the specified flags set. The process is immediately\n\t * \tstopped if the callback returns `false`.\n\t * \t!forEachInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number, callback: (elem: GridElement, context?: object) => boolean, context?: object) : void;\n\t */\n\tforEachInRegion: function (bounds, flagsAndMask, flagsValue, callback, context)\n\t{\n\t\tlet j0 = ((bounds.y1+this.offsy) - (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet j1 = ((bounds.y2+this.offsy) + (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet i0 = ((bounds.x1+this.offsx) - (1<<this.kx-1) >> this.kx);\n\t\tlet i1 = ((bounds.x2+this.offsx) + (1<<this.kx-1) >> this.kx);\n\n\t\tlet n = this.grid.length-1;\n\n\t\tif (j0 < 0) j0 = 0; if (j1 < 0) j1 = 0;\n\t\tif (i0 < 0) i0 = 0; if (i1 < 0) i1 = 0;\n\t\tif (j0 > n) j0 = n; if (j1 > n) j1 = n;\n\t\tif (i0 > n) i0 = n; if (i1 > n) i1 = n;\n\n\t\tfor (let j = j0; j <= j1; j += this.stride)\n\t\t{\n\t\t\tfor (let i = i0; i <= i1; i++)\n\t\t\t{\n\t\t\t\tlet k = j + i;\n\t\t\t\tif (k > n || this.grid[k] === null) continue;\n\n\t\t\t\tfor (let e = this.grid[k].top; e; e = e.next)\n\t\t\t\t{\n\t\t\t\t\t// First check the element flags.\n\t\t\t\t\tif (!e.value.getFlags(flagsAndMask, flagsValue)) continue;\n\n\t\t\t\t\t// Verify exact intersection only on elements located on the edges of the indexed-based approximated rectangle.\n\t\t\t\t\tif (this.verifyIntersection && (j <= j0+1 || i <= i0+1 || j >= j1-1 || i >= i1-1) && !e.value.bounds.intersects(bounds))\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tif (callback(e.value, context) === false)\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * \tCollects all elements that intersect the given bounds and have the specified flags set. Returns a new List, remember to call `free` after using it.\n\t * \t!selectInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : List;\n\t */\n\tselectInRegion: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\tlet j0 = ((bounds.y1+this.offsy) - (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet j1 = ((bounds.y2+this.offsy) + (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet i0 = ((bounds.x1+this.offsx) - (1<<this.kx-1) >> this.kx);\n\t\tlet i1 = ((bounds.x2+this.offsx) + (1<<this.kx-1) >> this.kx);\n\n\t\tlet n = this.grid.length-1;\n\n\t\tif (j0 < 0) j0 = 0; if (j1 < 0) j1 = 0;\n\t\tif (i0 < 0) i0 = 0; if (i1 < 0) i1 = 0;\n\t\tif (j0 > n) j0 = n; if (j1 > n) j1 = n;\n\t\tif (i0 > n) i0 = n; if (i1 > n) i1 = n;\n\n\t\tlet list = List.Pool.alloc();\n\n\t\tfor (let j = j0; j <= j1; j += this.stride)\n\t\t{\n\t\t\tfor (let i = i0; i <= i1; i++)\n\t\t\t{\n\t\t\t\tlet k = j + i;\n\t\t\t\tif (k > n || this.grid[k] === null) continue;\n\n\t\t\t\tfor (let e = this.grid[k].top; e; e = e.next)\n\t\t\t\t{\n\t\t\t\t\t// First check the element flags.\n\t\t\t\t\tif (!e.value.getFlags(flagsAndMask, flagsValue)) continue;\n\n\t\t\t\t\t// Verify exact intersection only on elements located on the edges of the indexed-based approximated rectangle.\n\t\t\t\t\tif (this.verifyIntersection && (j <= j0+1 || i <= i0+1 || j >= j1-1 || i >= i1-1) && !e.value.bounds.intersects(bounds))\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tlist.push(e.value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn list;\n\t},\n\n\t/**\n\t * \tCounts all elements that intersect the given bounds and have the specified flags set.\n\t * \t!countInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : number;\n\t */\n\tcountInRegion: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\tlet j0 = ((bounds.y1+this.offsy) - (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet j1 = ((bounds.y2+this.offsy) + (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet i0 = ((bounds.x1+this.offsx) - (1<<this.kx-1) >> this.kx);\n\t\tlet i1 = ((bounds.x2+this.offsx) + (1<<this.kx-1) >> this.kx);\n\n\t\tlet n = this.grid.length-1;\n\n\t\tif (j0 < 0) j0 = 0; if (j1 < 0) j1 = 0;\n\t\tif (i0 < 0) i0 = 0; if (i1 < 0) i1 = 0;\n\t\tif (j0 > n) j0 = n; if (j1 > n) j1 = n;\n\t\tif (i0 > n) i0 = n; if (i1 > n) i1 = n;\n\n\t\tlet m = 0;\n\n\t\tfor (let j = j0; j <= j1; j += this.stride)\n\t\t{\n\t\t\tfor (let i = i0; i <= i1; i++)\n\t\t\t{\n\t\t\t\tlet k = j + i;\n\t\t\t\tif (k > n || this.grid[k] === null) continue;\n\n\t\t\t\tfor (let e = this.grid[k].top; e; e = e.next)\n\t\t\t\t{\n\t\t\t\t\t// First check the element flags.\n\t\t\t\t\tif (!e.value.getFlags(flagsAndMask, flagsValue)) continue;\n\n\t\t\t\t\t// Verify exact intersection only on elements located on the edges of the indexed-based approximated rectangle.\n\t\t\t\t\tif (this.verifyIntersection && (j <= j0+1 || i <= i0+1 || j >= j1-1 || i >= i1-1) && !e.value.bounds.intersects(bounds))\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tm++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn m;\n\t},\n\n\t/**\n\t * \tReturns the first element that intersect the given bounds and have the specified flags set.\n\t * \t!selectFirst (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : GridElement;\n\t */\n\tselectFirst: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\tlet j0 = ((bounds.y1+this.offsy) - (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet j1 = ((bounds.y2+this.offsy) + (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet i0 = ((bounds.x1+this.offsx) - (1<<this.kx-1) >> this.kx);\n\t\tlet i1 = ((bounds.x2+this.offsx) + (1<<this.kx-1) >> this.kx);\n\n\t\tlet n = this.grid.length-1;\n\n\t\tif (j0 < 0) j0 = 0; if (j1 < 0) j1 = 0;\n\t\tif (i0 < 0) i0 = 0; if (i1 < 0) i1 = 0;\n\t\tif (j0 > n) j0 = n; if (j1 > n) j1 = n;\n\t\tif (i0 > n) i0 = n; if (i1 > n) i1 = n;\n\n\t\tfor (let j = j0; j <= j1; j += this.stride)\n\t\t{\n\t\t\tfor (let i = i0; i <= i1; i++)\n\t\t\t{\n\t\t\t\tlet k = j + i;\n\t\t\t\tif (k > n || this.grid[k] === null) continue;\n\n\t\t\t\tfor (let e = this.grid[k].top; e; e = e.next)\n\t\t\t\t{\n\t\t\t\t\t// First check the element flags.\n\t\t\t\t\tif (!e.value.getFlags(flagsAndMask, flagsValue)) continue;\n\n\t\t\t\t\t// Verify exact intersection only on elements located on the edges of the indexed-based approximated rectangle.\n\t\t\t\t\tif (this.verifyIntersection && (j <= j0+1 || i <= i0+1 || j >= j1-1 || i >= i1-1) && !e.value.bounds.intersects(bounds))\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\treturn e.value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n});\n\nexport default Grid;\n","/*\n**\tflow/container.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\n\n//:/**\n//: * \tA container is responsible to store elements for their subsequent rendering. The actual storage mechanism used can vary and must be implemented by derived\n//: * \tclasses (see `GridContainer` and `SimpleContainer`).\n//: */\n\n//!class Container\n\nconst Container = Class.extend\n({\n\tclassName: 'Container',\n\n\t/**\n\t * \tViewport bounds currently active. Set by the Scene class before calling `draw`.\n\t * \t!viewportBounds: Bounds2;\n\t */\n\tviewportBounds: null,\n\n\t/**\n\t * \tWidth of the container.\n\t * \t!width: number;\n\t */\n\twidth: 0,\n\n\t/**\n\t * \tHeight of the container.\n\t * \t!height: number;\n\t */\n\theight: 0,\n\n\t/**\n\t * \tDepth (z-value) of the container, calculated by the scene.\n\t * \t!zvalue: number;\n\t */\n\tzvalue: 0,\n\n\t/**\n\t * \tScene object to which this container belongs.\n\t * \t!scene: Scene;\n\t */\n\tscene: null,\n\n\t/**\n\t * \tFlags of the object (see constants at the bottom of this file).\n\t * \t!flags: number;\n\t */\n\tflags: 0,\n\n\t/**\n\t * \tCurrently active display buffer for rendering operations (used by drawElement).\n\t * \t!g: Canvas;\n\t */\n\tg: null,\n\n\t/**\n\t * \tTotal number of elements in the container.\n\t * \t!readonly elementCount: number;\n\t */\n\telementCount: 0,\n\n\t/**\n\t * \tTotal number of elements drawn on the last draw operation.\n\t * \t!readonly drawCount: number;\n\t */\n\tdrawCount: 0,\n\n\t/**\n\t * \tConstructs the container with the default size (32768 x 32768).\n\t * \tconstructor ();\n\t */\n\t/**\n\t * \tConstructs the container with the specified size.\n\t * \t!constructor (width: number, height: number);\n\t */\n\t__ctor: function (width=32768, height=32768)\n\t{\n\t\tthis.width = width;\n\t\tthis.height = height;\n\n\t\tthis.flags = Container.VISIBLE | Container.DEPTH_FLAG;\n\t},\n\n\t/**\n\t * \tDestroys the container.\n\t */\n\t__dtor: function()\n\t{\n\t},\n\n\t/**\n\t * \tReturns the value of the `visible` flag.\n\t * \t!visible() : boolean;\n\t */\n\t/**\n\t * \tSets the value of the `visible` flag.\n\t * \t!visible(value: boolean) : Container;\n\t */\n\tvisible: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Container.VISIBLE);\n\n\t\tthis.flags &= ~Container.VISIBLE;\n\t\tif (value) this.flags |= Container.VISIBLE;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the value of the `depthFlag` flag.\n\t * \t!depthFlag() : boolean;\n\t */\n\t/**\n\t * \tSets the value of the `depthFlag` flag.\n\t * \t!depthFlag(value: boolean) : Container;\n\t */\n\tdepthFlag: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Container.DEPTH_FLAG);\n\n\t\tthis.flags &= ~Container.DEPTH_FLAG;\n\t\tif (value) this.flags |= Container.DEPTH_FLAG;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the active viewport bounds.\n\t * \t!setViewportBounds (bounds: Bounds2) : Container;\n\t */\n\tsetViewportBounds: function (bounds)\n\t{\n\t\tthis.viewportBounds = bounds;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tDraws the specified element.\n\t * \t!drawElement (elem: Element, self: Container) : boolean;\n\t */\n\tdrawElement: function (elem, self)\n\t{\n\t\tself.drawCount++;\n\t\treturn elem.draw(self.g);\n\t},\n\n\t/**\n\t * \tUpdates the Z-value of the specified element. Should be called after adding an element and after/before every sync.\n\t * \t!syncZ (elem: Element) : void;\n\t */\n\tsyncZ: function (elem)\n\t{\n\t\telem.__zvalue = this.zvalue + ((elem._zvalue + elem.bounds.y2) & ((1 << 18) - 1));\n\t\t//elem.__zvalue = this.zvalue + (1 << 18) - ((elem._zvalue + elem.bounds.y2 + (1 << 18)) & ((1 << 18) - 1));\n\t},\n\n\t/**\n\t * \tSyncs the actual location of the specified element with its storage location. Returns true if successful.\n\t * \t!sync (elem: Element) : boolean;\n\t */\n\tsync: function (elem)\n\t{\n\t\tthrow new Error ('Container::sync not implemented');\n\t},\n\n\t/**\n\t * \tClears the container to empty. All contained elements will be destroyed.\n\t * \t!clear() : void;\n\t */\n\tclear: function() /* @override */\n\t{\n\t\tthrow new Error ('Container::clear not implemented');\n\t},\n\n\t/**\n\t * \tResets the container to empty. Contained elements are not destroyed. Use `clear` if that is your intention.\n\t * \t!reset() : void;\n\t */\n\treset: function() /* @override */\n\t{\n\t\tthrow new Error ('Container::reset not implemented');\n\t},\n\n\t/**\n\t * \tAdds an element to the container. Returns boolean indicating if successful.\n\t * \t!add (elem: Element) : boolean;\n\t */\n\tadd: function (elem) /* @override */\n\t{\n\t\tthrow new Error ('Container::add not implemented');\n\t},\n\n\t/**\n\t * \tRemoves an element from the container and returns it.\n\t * \t!remove (elem: Element) : Element;\n\t */\n\tremove: function (elem) /* @override */\n\t{\n\t\tthrow new Error ('Container::remove not implemented');\n\t},\n\n\t/**\n\t * \tPrepares the canvas with depth flag configuration and Z-value to draw the contained elements.\n\t * \t!draw (g: Canvas) : void;\n\t */\n\tdraw: function(g)\n\t{\n\t\tif (!this.visible()) return;\n\n\t\tlet depthFlagChanged = g.pushDepthFlag(this.flags & Container.DEPTH_FLAG);\n\n\t\tg.zvalue = this.zvalue;\n\n\t\tthis.drawCount = -1;\n\t\tthis.g = g;\n\n\t\tthis.render();\n\n\t\tif (depthFlagChanged) g.popDepthFlag();\n\t},\n\n\t/**\n\t * \tActually draws the contained elements.\n\t * \t!render() : void;\n\t */\n\trender: function()\n\t{\n\t\tthrow new Error ('Container::render not implemented');\n\t}\n});\n\n\n/*\n**\tConstants.\n*/\nContainer.VISIBLE = 0x001;\nContainer.DEPTH_FLAG = 0x002;\n\nexport default Container;\n","/*\n**\tflow/viewport.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Bounds2 from '../math/bounds2.js';\nimport Point2 from '../math/point2.js';\n\n//![import \"../math/point2\"]\n//![import \"../math/bounds2\"]\n//![import \"../math/rect\"]\n//![import \"../system/canvas\"]\n\n//:/**\n//: * \tViewport class controls the current visible rectangle of a container.\n//: */\n\n//!class Viewport\n\nconst Viewport = Class.extend\n({\n\tclassName: 'Viewport',\n\n\t/**\n\t * \tDimensions of the viewport.\n\t *\n\t * \t!readonly width: number;\n\t * \t!readonly height: number;\n\t */\n\twidth: 0, initialWidth: 0,\n\theight: 0, initialHeight: 0,\n\n\t/**\n\t * \tPosition of the top-left corner of the viewport in screen space.\n\t */\n\tsx: 0,\n\tsy: 0,\n\n\t/**\n\t * \tPosition of the center of the viewport in the container.\n\t */\n\tx: 0,\n\ty: 0,\n\n\t/**\n\t * \tRatio for the viewport's center (value from -1 to 1), used when focusing to use a different focus point instead of the exact center.\n\t */\n\tcenterRatioX: 0,\n\tcenterRatioY: 0,\n\n\t/**\n\t * \tPosition offset, used to move the viewport around without affecting the focus point.\n\t */\n\toffset: null,\n\n\t/**\n\t * \tBoundaries of the container, set by `setContainerBounds`.\n\t *\n\t * \t!readonly container: Bounds2;\n\t */\n\tcontainer: null,\n\n\t/**\n\t * \tThe focus factor determines the ratio of a smaller viewport on which the current focus point must  be contained. If the focus point is not inside the\n\t * \tsmaller viewport scrolling will be performed.\n\t */\n\tfocusFactorX: 0,\n\tfocusFactorY: 0,\n\n\t/**\n\t * \tFocus target rectangle and its offsets. When the viewport is updated it will automatically focus on this rect.\n\t */\n\tfocusRect: null,\n\tfocusOffsX: 0,\n\tfocusOffsY: 0,\n\n\t/**\n\t * \tEnabled focus axes. Used by the `update` method to figure which axis to update.\n\t */\n\tfocusAxisX: true,\n\tfocusAxisY: true,\n\n\t/**\n\t * \tFlags of the viewport.\n\t */\n\tflags: 0,\n\n\t/**\n\t * \tViewport scale.\n\t */\n\tscale: 1,\n\n\t/**\n\t * \tGlobal scale, used to scale the entire canvas including the viewport. Useful for debugging viewport bounds.\n\t */\n\tglobalScale: 1,\n\n\t/**\n\t * \tBounds of the viewport in world space. Used to determine which elements lie inside the viewport.\n\t *\n\t * \t!readonly bounds: Bounds2;\n\t */\n\tbounds: null,\n\n\t/**\n\t * \tExtra padding for the viewport bounds. Used to extend the viewport bounds without altering the original viewport size nor the world bounds.\n\t */\n\tpadding: null,\n\n\t/**\n\t * \tBounds of the focus area of the viewport in world space. When the `focusRect` moves outside this area the viewport will be panned to keep it inside these bounds.\n\t * \n\t * \t!readonly focusBounds: Bounds2;\n\t */\n\tfocusBounds: null,\n\n\t/**\n\t * \tBounds of the viewport in screen space, used as target rendering area.\n\t *\n\t *\t!readonly screenBounds: Bounds2;\n\t */\n\tscreenBounds: null,\n\n\t/**\n\t * \tTemporal Point2 object used as temporary result for `toWorldSpace` and `toScreenSpace`.\n\t */\n\ttmpPoint: null,\n\n\t/**\n\t * \tConstructs the viewport with the specified size and container dimensions.\n\t *\n\t * \t@param sx - Screen position X.\n\t * \t@param sy - Screen position Y.\n\t * \t@param width - Viewport width.\n\t * \t@param height - Viewport height.\n\t * \t@param containerWidth - Container width.\n\t * \t@param containerHeight - Container height.\n\t *\n\t * \t!constructor (sx: number, sy: number, width: number, height: number, containerWidth: number, containerHeight: number);\n\t */\n\t__ctor: function (sx, sy, width, height, containerWidth, containerHeight)\n\t{\n\t\tthis.focusFactorX = 0.4;\n\t\tthis.focusFactorY = 0.4;\n\t\tthis.focusRect = null;\n\n\t\tthis.sx = sx;\n\t\tthis.sy = sy;\n\t\tthis.width = this.initialWidth = width;\n\t\tthis.height = this.initialHeight = height;\n\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\n\t\tthis.bounds = Bounds2.Pool.alloc();\n\t\tthis.padding = null;\n\n\t\tthis.focusBounds = Bounds2.Pool.alloc();\n\t\tthis.screenBounds = Bounds2.Pool.alloc();\n\t\tthis.container = Bounds2.Pool.alloc();\n\t\tthis.offset = Point2.Pool.alloc();\n\n\t\tthis.flags = Viewport.ENABLED;\n\t\tthis.tmpPoint = Point2.Pool.alloc();\n\n\t\tthis.setContainerBounds(-containerWidth>>1, -containerHeight>>1, containerWidth>>1, containerHeight>>1);\n\n\t\tthis.updateScreenBounds();\n\t\tthis.updateBounds();\n\t},\n\n\t/**\n\t * \tDestructs the viewport.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis.bounds.free();\n\t\tthis.focusBounds.free();\n\t\tthis.screenBounds.free();\n\t\tthis.container.free();\n\t\tthis.tmpPoint.free();\n\n\t\tif (this.padding !== null)\n\t\t\tthis.padding.free();\n\t},\n\n\t/**\n\t * \tReturns the value of the `enabled` flag.\n\t *\n\t * \t!enabled() : boolean;\n\t */\n\t/**\n\t * \tSets the `enabled` flag.\n\t *\n\t * \t!enabled (value: boolean) : Viewport;\n\t */\n\tenabled: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Viewport.ENABLED);\n\n\t\tthis.flags &= ~Viewport.ENABLED;\n\t\tif (value) this.flags |= Viewport.ENABLED;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the value of the `topLeft` flag.\n\t * \t!topLeft() : boolean;\n\t */\n\t/**\n\t * \tSets the `topLeft` flag.\n\t * \t!topLeft (value: boolean) : Viewport;\n\t */\n\ttopLeft: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Viewport.TOP_LEFT);\n\n\t\tthis.flags &= ~Viewport.TOP_LEFT;\n\t\tif (value) this.flags |= Viewport.TOP_LEFT;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the container bounds. Used to ensure the viewport bounds are never outside these limits.\n\t *\n\t * \t!setContainerBounds (x1: number, y1: number, x2: number, y2: number) : Viewport;\n\t */\n\t/**\n\t * \tSets the container bounds. Used to ensure the viewport bounds are never outside these limits.\n\t *\n\t * \t!setContainerBounds (v: Bounds2|Rect) : Viewport;\n\t */\n\tsetContainerBounds: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\ty2 = x1.y2;\n\t\t\tx2 = x1.x2;\n\t\t\ty1 = x1.y1;\n\t\t\tx1 = x1.x1;\n\t\t}\n\n\t\tthis.width = this.initialWidth;\n\t\tthis.height = this.initialHeight;\n\n\t\tif (this.width > x2-x1) this.width = x2-x1;\n\t\tif (this.height > y2-y1) this.height = y2-y1;\n\n\t\tthis.container.set(x1, y1, x2, y2);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the viewport padding.\n\t *\n\t * \t!setPadding (value: number) : Viewport;\n\t */\n\t/**\n\t * \tSets the padding of each side of the viewport (left, top, right and bottom).\n\t *\n\t * \t!setPadding (x1: number, y1: number, x2: number, y2: number) : Viewport;\n\t */\n\tsetPadding: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (this.padding === null)\n\t\t\tthis.padding = Bounds2.Pool.alloc();\n\n\t\tif (y1 === null)\n\t\t{\n\t\t\tx2 = y2 = x1;\n\t\t\tx1 = y1 = -x1;\n\t\t}\n\n\t\tthis.padding.set(x1, y1, x2, y2);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tUpdates the bound rect of the viewport.\n\t */\n\tupdateBounds: function (truncateToContainer=false)\n\t{\n\t\tlet w, h, ws, hs;\n\t\tlet x1, y1, x2, y2;\n\n\t\tw = this.width >> 1;\n\t\th = this.height >> 1;\n\n\t\tws = (w/this.scale);\n\t\ths = (h/this.scale);\n\n\t\tx1 = this.x-ws+this.offset.x;\n\t\ty1 = this.y-hs+this.offset.y;\n\t\tx2 = this.x+ws+this.offset.x;\n\t\ty2 = this.y+hs+this.offset.y;\n\n\t\tif (truncateToContainer)\n\t\t{\n\t\t\tif (x1 < this.container.x1)\n\t\t\t\tthis.offset.setX(this.container.x1 - this.x + ws);\n\t\t\telse if (x2 > this.container.x2)\n\t\t\t\tthis.offset.setX(this.container.x2 - this.x - ws);\n\n\t\t\tif (y1 < this.container.y1)\n\t\t\t\tthis.offset.setY(this.container.y1 - this.y + hs);\n\t\t\telse if (y2 > this.container.y2)\n\t\t\t\tthis.offset.setY(this.container.y2 - this.y - hs);\n\n\t\t\tx1 = this.x-ws+this.offset.x;\n\t\t\ty1 = this.y-hs+this.offset.y;\n\t\t\tx2 = this.x+ws+this.offset.x;\n\t\t\ty2 = this.y+hs+this.offset.y;\n\t\t}\n\n\t\tthis.bounds.set (x1, y1, x2, y2);\n\n\t\tif (this.padding !== null)\n\t\t\tthis.bounds.add (this.padding);\n\n\t\tthis.focusBounds.set (\n\t\t\tthis.x - (this.focusFactorX*w + this.centerRatioX*w)/this.scale, this.y - (this.focusFactorY*h + this.centerRatioY*h)/this.scale,\n\t\t\tthis.x + (this.focusFactorX*w + this.centerRatioX*w)/this.scale, this.y + (this.focusFactorY*h + this.centerRatioY*h)/this.scale\n\t\t);\n\t},\n\n\t/**\n\t * \tUpdates the screen bound rect of the viewport.\n\t */\n\tupdateScreenBounds: function ()\n\t{\n\t\tthis.screenBounds.set (this.sx, this.sy, this.sx + this.width, this.sy + this.height);\n\t},\n\n\t/**\n\t * \tResizes the viewport to the specified size.\n\t *\n\t * \t!resize (width: number|null, height: number|null) : Viewport;\n\t */\n\tresize: function (width, height)\n\t{\n\t\tthis.width = this.initialWidth = width ?? this.width;\n\t\tthis.height = this.initialHeight = height ?? this.height;\n\n\t\tthis.updateScreenBounds();\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResizes the viewport by the specified deltas.\n\t *\n\t * \t!resizeBy (dWidth: number, dHeight: number) : Viewport;\n\t */\n\tresizeBy: function (dWidth, dHeight)\n\t{\n\t\tthis.width += dWidth;\n\t\tthis.height += dHeight;\n\n\t\tthis.initialWidth = this.width;\n\t\tthis.initialHeight = this.height;\n\n\t\tthis.updateScreenBounds();\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the position of the viewport's center within the world and resets the relative offset to zero.\n\t * Setting any parameter to `null` will cause it not to be changed.\n\t * \n\t * !setPosition (x: number|null, y: number|null) : Viewport;\n\t */\n\tsetPosition: function (x, y)\n\t{\n\t\tthis.x = x ?? this.x;\n\t\tthis.y = y ?? this.y;\n\n\t\tthis.offset.set(0, 0);\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the position of the viewport relative to the current focus point.\n\t * \n\t * \t!setOffsets (dx: number, dy: number) : Viewport;\n\t */\n\tsetOffsets: function (dx, dy)\n\t{\n\t\tthis.offset.set(dx, dy);\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the scale of the viewport.\n\t * \n\t * \t!setScale (value: number) : Viewport;\n\t */\n\tsetScale: function (value)\n\t{\n\t\tthis.scale = value;\n\t\tthis.updateBounds();\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the scale of the viewport.\n\t * \n\t * \t!getScale () : number;\n\t */\n\tgetScale: function ()\n\t{\n\t\treturn this.scale;\n\t},\n\n\t/**\n\t * \tSets the global scale of the viewport.\n\t * \n\t * \t!setGlobalScale (value: number) : Viewport;\n\t */\n\tsetGlobalScale: function (value)\n\t{\n\t\tthis.globalScale = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the global scale of the viewport.\n\t * \n\t * \t!getGlobalScale () : number;\n\t */\n\tgetGlobalScale: function ()\n\t{\n\t\treturn this.globalScale;\n\t},\n\n\t/**\n\t * \tSets the center ratio of the viewport (values from -1 to 1, default is 0). Used to focus on a different point instead of the exact center.\n\t * \n\t * \t!setCenter (rx: number, ry: number) : Viewport;\n\t */\n\tsetCenter: function (rx, ry)\n\t{\n\t\tthis.centerRatioX = rx;\n\t\tthis.centerRatioY = ry;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMoves the viewport within the world. Values are relative to the current focus point.\n\t *\t@param truncateToContainer - When `true` the final viewport bounds will be ensured to not lie outside the container bounds.\n\t *\n\t * \t!translate (dx: number, dy: number, truncateToContainer?: boolean) : Viewport;\n\t */\n\ttranslate: function (dx, dy, truncateToContainer=false)\n\t{\n\t\tthis.offset.add(dx, dy);\n\n\t\tthis.updateBounds(truncateToContainer);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the screen position of the viewport.\n\t * \n\t * \t!setScreenPosition (sx: number, sy: number) : number;\n\t */\n\tsetScreenPosition: function (sx, sy)\n\t{\n\t\tthis.sx = sx;\n\t\tthis.sy = sy;\n\n\t\tthis.updateScreenBounds();\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the X coordinate of the viewport's focus point inside the world.\n\t * \t@param absolute - When `true`, the focus point X (without offset) will be returned.\n\t * \t\n\t * \t!getX (absolute?: boolean) : number;\n\t */\n\tgetX: function (absolute=false)\n\t{\n\t\treturn this.x + (absolute ? 0 : this.offset.x);\n\t},\n\n\t/**\n\t * \tReturns the Y coordinate of the viewport's focus point inside the world.\n\t * \t@param absolute - When `true`, the focus point Y (without offset) will be returned.\n\t * \t\n\t * \t!getY (absolute?: boolean) : number;\n\t */\n\tgetY: function (absolute=false)\n\t{\n\t\treturn this.y + (absolute ? 0 : this.offset.y);\n\t},\n\n\t/**\n\t * \tReturns the X position of the viewport inside the world relative to the current focus point.\n\t * \n\t * \t!getOffsetX() : void;\n\t */\n\tgetOffsetX: function ()\n\t{\n\t\treturn this.offset.x;\n\t},\n\n\t/**\n\t * \tReturns the Y position of the viewport inside the world relative to the current focus point.\n\t * \n\t * \t!getOffsetY() : void;\n\t */\n\tgetOffsetY: function ()\n\t{\n\t\treturn this.offset.y;\n\t},\n\n\t/**\n\t * \tReturns the width of the viewport.\n\t * \n\t * \t!getWidth() : number;\n\t */\n\tgetWidth: function ()\n\t{\n\t\treturn this.width;\n\t},\n\n\t/**\n\t * \tReturns the height of the viewport.\n\t * \n\t * \t!getHeight() : number;\n\t */\n\tgetHeight: function ()\n\t{\n\t\treturn this.height;\n\t},\n\n\t/**\n\t * \tMoves the viewport X coordinate to focus on the specified line or coordinate. Method `updateBounds` should be called afterwards.\n\t * \n\t * \t!focusX (x0: number, x1?: number, factor?: number) : Viewport;\n\t */\n\tfocusX: function (i0, i1=null, kx=null)\n\t{\n\t\tif (kx === null) kx = this.focusFactorX;\n\t\tif (i1 === null) i1 = i0;\n\n\t\tlet w = this.width >> 1;\n\n\t\tlet x1 = this.x - int((kx*w + this.centerRatioX*w)/this.scale);\n\t\tlet x2 = this.x + int((kx*w + this.centerRatioX*w)/this.scale);\n\n\t\tif (x1 == x2)\n\t\t\ti0 = i1 = (i0 + i1) >> 1;\n\n\t\tlet nx = this.x;\n\n\t\tif (i0 < x1) nx += (i0 - x1);\n\t\telse if (i1 > x2) nx += (i1 - x2);\n\n\t\tx1 = nx - w;\n\t\tx2 = nx + w;\n\n\t\tif (x1 < this.container.x1) nx = this.container.x1 + w;\n\t\tif (x2 > this.container.x2) nx = this.container.x2 - w;\n\n\t\tthis.x = nx;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMoves the viewport Y coordinate to focus on the specified line or coordinate. Method `updateBounds` should be called afterwards.\n\t * \n\t * \t!focusY (y0: number, y1?: number, factor?: number) : Viewport;\n\t */\n\tfocusY: function (j0, j1=null, ky=null)\n\t{\n\t\tif (ky === null) ky = this.focusFactorY;\n\t\tif (j1 === null) j1 = j0;\n\n\t\tlet h = this.height >> 1;\n\n\t\tlet y1 = this.y - int((ky*h + this.centerRatioY*h)/this.scale);\n\t\tlet y2 = this.y + int((ky*h + this.centerRatioY*h)/this.scale);\n\n\t\tif (y1 == y2)\n\t\t\tj0 = j1 = (j0 + j1) >> 1;\n\n\t\tlet ny = this.y;\n\n\t\tif (j0 < y1) ny += (j0 - y1);\n\t\telse if (j1 > y2) ny += (j1 - y2);\n\n\t\ty1 = ny - h;\n\t\ty2 = ny + h;\n\n\t\tif (y1 < this.container.y1) ny = this.container.y1 + h;\n\t\tif (y2 > this.container.y2) ny = this.container.y2 - h;\n\n\t\tthis.y = ny;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tUpdates the viewport to focus on the focusRect. Takes into account enabled axes.\n\t *\n\t * \t!update (dt?: number) : void;\n\t */\n\tupdate: function (dt=0)\n\t{\n\t\tif (this.focusRect === null)\n\t\t\treturn;\n\n\t\tif (this.focusAxisX)\n\t\t\tthis.focusX (this.focusRect.x1 + this.focusOffsX, this.focusRect.x2 + this.focusOffsX);\n\n\t\tif (this.focusAxisY)\n\t\t\tthis.focusY (this.focusRect.y1 + this.focusOffsY, this.focusRect.y2 + this.focusOffsY);\n\n\t\tthis.updateBounds();\n\t},\n\n\t/**\n\t * \tUpdates the viewport to focus on the focusRect ignoring the enabled axes.\n\t *\n\t * \t!updateForced (dt?: number) : void;\n\t */\n\tupdateForced: function (dt=0)\n\t{\n\t\tif (this.focusRect === null)\n\t\t\treturn;\n\n\t\tthis.focusX (this.focusRect.x1 + this.focusOffsX, this.focusRect.x2 + this.focusOffsX);\n\t\tthis.focusY (this.focusRect.y1 + this.focusOffsY, this.focusRect.y2 + this.focusOffsY);\n\n\t\tthis.updateBounds();\n\t},\n\n\t/**\n\t * \tTracks a specified rectangle by maintaining focus on it (a call to `update` must be made on every frame update).\n\t * \n\t * \t!setFocusRect (rect: Rect|Bounds2, offsX?: number, offsY? :number) : Viewport;\n\t */\n\tsetFocusRect: function (rect, offsX=0, offsY=0)\n\t{\n\t\tthis.focusRect = rect;\n\n\t\tthis.focusOffsX = offsX;\n\t\tthis.focusOffsY = offsY;\n\n\t\tthis.update(0);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the focus offsets of the viewport. Used to translate the viewport without altering the focus point.\n\t *\n\t * \t!setFocusOffsets (offsX: number, offsY: number) : Viewport;\n\t */\n\tsetFocusOffsets: function (offsX, offsY)\n\t{\n\t\tthis.focusOffsX = offsX;\n\t\tthis.focusOffsY = offsY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the enabled flag of the focus axes. Only enabled axes will be updated when calling `update`.\n\t * \n\t * \t!setFocusAxes (enabledX: boolean, enabledY: boolean) : Viewport;\n\t */\n\tsetFocusAxes: function (enabledX, enabledY)\n\t{\n\t\tthis.focusAxisX = enabledX;\n\t\tthis.focusAxisY = enabledY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the focus factor of the viewport (value from 0 to 1), that is, the ratio of the smaller focus viewport.\n\t * \n\t * \t!setFocusFactor (valueX: number, valueY: number) : Viewport;\n\t */\n\tsetFocusFactor: function (valueX, valueY)\n\t{\n\t\tthis.focusFactorX = valueX;\n\t\tthis.focusFactorY = valueY === undefined ? valueX : valueY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tApplies the viewport clipping area to the specified canvas.\n\t * \n\t * \t!applyClip (g: Canvas) : void;\n\t */\n\tapplyClip: function (g)\n\t{\n\t\tg.clip(this.screenBounds.x1, this.screenBounds.y1, this.screenBounds.width(), this.screenBounds.height());\n\t},\n\n\t/**\n\t * \tApplies the viewport transform to the specified canvas.\n\t * \n\t * \t!applyTransform (g: Canvas) : void;\n\t */\n\tapplyTransform: function (g)\n\t{\n\t\tif (!(this.flags & Viewport.TOP_LEFT))\n\t\t\tg.translate (this.screenBounds.cx, this.screenBounds.cy);\n\t\telse\n\t\t\tg.translate (this.screenBounds.x1, this.screenBounds.y1);\n\n\t\tif (this.scale != 1.0)\n\t\t\tg.scale (this.scale, this.scale);\n\n\t\tif (this.globalScale != 1.0)\n\t\t\tg.scale (this.globalScale, this.globalScale);\n\n\t\tif (!(this.flags & Viewport.TOP_LEFT))\n\t\t\tg.translate (-this.bounds.cx, -this.bounds.cy);\n\t\telse\n\t\t\tg.translate (-this.bounds.x1, -this.bounds.y1);\n\n\t\tg.updateTransform();\n\t},\n\n\t/**\n\t * \tConverts a point from screen-space to world-space.\n\t * \t@returns Temporal Point2 object.\n\t *\n\t * \t!toWorldSpace (input: Point2|Vec2|{x:number,y:number}, floor?: boolean) : Point2;\n\t */\n\t/**\n\t * \tConverts a point from screen-space to world-space.\n\t * \t@returns Temporal Point2 object.\n\t *\n\t * \t!toWorldSpace (x: number, y: number, floor?: boolean) : Point2;\n\t */\n\ttoWorldSpace: function (x, y=null, floor=false)\n\t{\n\t\tif (y === null || y === true)\n\t\t{\n\t\t\tfloor = y === true;\n\t\t\ty = x.y;\n\t\t\tx = x.x;\n\t\t}\n\n\t\tlet refX, refY;\n\n\t\tif (!(this.flags & Viewport.TOP_LEFT))\n\t\t{\n\t\t\trefX = this.screenBounds.cx;\n\t\t\trefY = this.screenBounds.cy;\n\n\t\t\tif (floor) {\n\t\t\t\tx = ((x - int(refX)) / this.scale) + int(this.bounds.cx);\n\t\t\t\ty = ((y - int(refY)) / this.scale) + int(this.bounds.cy);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tx = ((x - refX) / this.scale) + this.bounds.cx;\n\t\t\t\ty = ((y - refY) / this.scale) + this.bounds.cy;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\trefX = this.screenBounds.x1;\n\t\t\trefY = this.screenBounds.y1;\n\n\t\t\tif (floor) {\n\t\t\t\tx = ((x - int(refX)) / this.scale) + int(this.bounds.x1);\n\t\t\t\ty = ((y - int(refY)) / this.scale) + int(this.bounds.y1);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tx = ((x - refX) / this.scale) + this.bounds.x1;\n\t\t\t\ty = ((y - refY) / this.scale) + this.bounds.y1;\n\t\t\t}\n\t\t}\n\n\t\treturn this.tmpPoint.set(x, y);\n\t},\n\n\t/**\n\t * \tConverts a point from world-space to screen-space.\n\t * \t@returns Temporal Point2 object.\n\t *\n\t * \t!toScreenSpace (input: Point2|Vec2|{x:number,y:number}, floor?: boolean) : Point2;\n\t */\n\t/**\n\t * \tConverts a point from world-space to screen-space.\n\t * \t@returns Temporal Point2 object.\n\t *\n\t * \t!toScreenSpace (x: number, y: number, floor?: boolean) : Point2;\n\t */\n\ttoScreenSpace: function (x, y=null, floor=false)\n\t{\n\t\tif (y === null || y === true)\n\t\t{\n\t\t\tfloor = y === true;\n\t\t\ty = x.y;\n\t\t\tx = x.x;\n\t\t}\n\n\t\tlet refX, refY;\n\n\t\tif (!(this.flags & Viewport.TOP_LEFT))\n\t\t{\n\t\t\trefX = this.screenBounds.cx;\n\t\t\trefY = this.screenBounds.cy;\n\n\t\t\tif (floor) {\n\t\t\t\tx = (x - int(this.bounds.cx)) * this.scale + int(refX);\n\t\t\t\ty = (y - int(this.bounds.cy)) * this.scale + int(refY);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tx = (x - this.bounds.cx) * this.scale + refX;\n\t\t\t\ty = (y - this.bounds.cy) * this.scale + refY;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\trefX = this.screenBounds.x1;\n\t\t\trefY = this.screenBounds.y1;\n\n\t\t\tif (floor) {\n\t\t\t\tx = (x - int(this.bounds.x1)) * this.scale + int(refX);\n\t\t\t\ty = (y - int(this.bounds.y1)) * this.scale + int(refY);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tx = (x - this.bounds.x1) * this.scale + refX;\n\t\t\t\ty = (y - this.bounds.y1) * this.scale + refY;\n\t\t\t}\n\t\t}\n\n\t\treturn this.tmpPoint.set(x, y);\n\t}\n});\n\n/*\n**\tConstants.\n*/\nViewport.ENABLED = 0x001;\nViewport.TOP_LEFT = 0x002;\n\nexport default Viewport;\n","/*\n**\tflow/element.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport GridElement from './grid-element.js';\nimport G from '../system/globals.js';\nimport Recycler from '../utils/recycler.js';\nimport System from '../system/system.js';\nimport Canvas from '../system/canvas.js';\nimport ShaderProgram from '../system/shader-program.js';\n\n//![import \"./grid-element\"]\n//![import \"../system/globals\"]\n//![import \"../utils/recycler\"]\n//![import \"../system/system\"]\n//![import \"../system/canvas\"]\n//![import \"../system/shader-program\"]\n\n//:/**\n//: * Describes an element that can be rendered to the screen.\n//: */\n\n//!class Element extends GridElement\n\nconst Element = GridElement.extend\n({\n\tclassName: 'Element',\n\n\t/**\n\t * Parent group to whom this element is related.\n\t * !group: Group;\n\t */\n\tgroup: null,\n\n\t/**\n\t * Drawable object to render to the display.\n\t * !img: Drawable;\n\t */\n\timg: null,\n\n\t/**\n\t * Indicates if the bounds of the element should be drawn (for debugging purposes). You can set it to a boolean or to a number from 1 to 7 to\n\t * draw the bounds with a different predefined color.\n\t * !debugBounds: boolean|number;\n\t */\n\tdebugBounds: false,\n\n\t/**\n\t * Basic depth (z-value) of the element (used for depth micro-adjustments).\n\t */\n\t_zvalue: 0,\n\n\t/**\n\t * Actual depth (z-value) of the element, calculated by the container.\n\t */\n\t__zvalue: 0,\n\n\t/**\n\t * Alpha value of the element.\n\t */\n\t_alpha: 1.0,\n\n\t/**\n\t * Element shader program.\n\t */\n\t_shaderProgram: null,\n\n\t/**\n\t * Function used to set the uniforms of the shader.\n\t */\n\t_uniformSetter: null,\n\n\t/**\n\t * Function used to render the element. Called by `draw` after rendering configuration has been set.\n\t * @type {(g:Canvas, elem:Element, img:Drawable) => void}\n\t */\n\trender: null,\n\n\t/**\n\t * Constructs a drawable element at the specified position with the given drawable.\n\t * !constructor (x: number, y: number, width: number, height: number, img?: Drawable);\n\t */\n\t/**\n\t * Constructs a drawable element at the specified position with the given drawable.\n\t * !constructor (x: number, y: number, img?: Drawable);\n\t */\n\t__ctor: function(x, y, width=null, height=null, img=null)\n\t{\n\t\tif (width === null)\n\t\t\twidth = height = 0;\n\n\t\tif (height === null)\n\t\t{\n\t\t\timg = width;\n\t\t\twidth = img.width;\n\t\t\theight = img.height;\n\t\t}\n\n\t\tthis._super.GridElement.__ctor(x, y, width, height);\n\t\tthis.img = img !== null ? img.getDrawable() : img;\n\n\t\tthis.group = null;\n\t\tthis.debugBounds = false;\n\n\t\tthis._zvalue = 0;\n\t\tthis.__zvalue = 0;\n\t\tthis._alpha = 1.0;\n\n\t\tthis._shaderProgram = null;\n\t\tthis._uniformSetter = null;\n\n\t\tthis.render = null;\n\t},\n\n\t/**\n\t * Destroys the element.\n\t */\n\t__dtor: function()\n\t{\n\t\tif (this.img !== null)\n\t\t{\n\t\t\tdispose(this.img);\n\t\t\tthis.img = null;\n\t\t}\n\n\t\tthis._super.GridElement.__dtor();\n\t},\n\n\t/**\n\t * Destroys the element later by adding it to the scene's destruction queue. If the element has no container, it will be destroyed immediately.\n\t * !destroyLater() : void;\n\t */\n\tdestroyLater: function()\n\t{\n\t\tif (!this.alive()) return;\n\n\t\tif (this.container !== null)\n\t\t\tthis.container.scene.disposeLater(this);\n\t\telse\n\t\t\tdispose(this);\n\t},\n\n\t/**\n\t * Returns the `debugBounds` of the element.\n\t * @returns {number}\n\t * !debug () : number;\n\t */\n\t/**\n\t * Sets the `debugBounds` of the element.\n\t * @param {boolean|number} value\n\t * @returns {Element}\n\t * !debug (value: number) : Element;\n\t */\n\tdebug: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this.debugBounds;\n\n\t\tthis.debugBounds = value === 0 ? true : value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the alpha value of the element.\n\t * @returns {number}\n\t * !alpha () : number;\n\t */\n\t/**\n\t * Sets the alpha value of the element.\n\t * @param {number} value\n\t * @returns {Element}\n\t * !alpha (value: number) : Element;\n\t */\n\talpha: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._alpha;\n\n\t\tthis._alpha = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the zvalue of the element.\n\t * @returns {number}\n\t * !zvalue () : number;\n\t */\n\t/**\n\t * Sets the zvalue of the element.\n\t * @param {number} value\n\t * @returns {Element}\n\t * !zvalue (value: number) : Element;\n\t */\n\tzvalue: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._zvalue;\n\n\t\tthis._zvalue = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the shader program of the element.\n\t * @returns {ShaderProgram}\n\t * !shaderProgram () : ShaderProgram;\n\t */\n\t/**\n\t * Sets the shader program of the element.\n\t * @param {ShaderProgram} shaderProgram\n\t * @returns {Element}\n\t * !shaderProgram (shaderProgram: ShaderProgram|string) : Element;\n\t */\n\tshaderProgram: function (shaderProgram=false)\n\t{\n\t\tif (shaderProgram === false)\n\t\t\treturn this._shaderProgram;\n\n\t\tif (typeof(shaderProgram) === 'string')\n\t\t\tshaderProgram = ShaderProgram.get(shaderProgram);\n\n\t\tthis._shaderProgram = shaderProgram;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the uniform setter function.\n\t * @param { (pgm:ShaderProgram, elem:Element, gl:WebGLRenderingContext) => void } uniformSetter\n\t * @returns {Element}\n\t * !uniformSetter (uniformSetter: (pgm:ShaderProgram, elem:Element, gl:WebGLRenderingContext) => void) : Element;\n\t */\n\tuniformSetter: function (uniformSetter)\n\t{\n\t\tthis._uniformSetter = uniformSetter;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Draws the element on the specified canvas.\n\t * @param {Canvas} g\n\t */\n\tdraw: function(g)\n\t{\n\t\tif (this.img !== null || this.render !== null)\n\t\t{\n\t\t\tlet shaderChanged = this._shaderProgram !== null ? g.pushShaderProgram(this._shaderProgram) : false;\n\t\t\tlet depthFlagChanged = this.depthFlagEnabled() ? g.pushDepthFlag(this.depthFlag()) : false;\n\n\t\t\tif (this._shaderProgram !== null && this._uniformSetter !== null && g.gl !== null)\n\t\t\t\tthis._uniformSetter (g.getShaderProgram(), this, g.gl);\n\n\t\t\tg.zvalue = this.__zvalue;\n\n\t\t\tif (this._alpha != 1.0)\n\t\t\t{\n\t\t\t\tg.pushAlpha();\n\t\t\t\tg.alpha(this._alpha);\n\t\t\t}\n\n\t\t\tif (this.render !== null)\n\t\t\t\tthis.render(g, this, this.img);\n\t\t\telse\n\t\t\t\tthis.img.render(g, this);\n\n\t\t\tif (depthFlagChanged) g.popDepthFlag();\n\t\t\tif (shaderChanged) g.popShaderProgram();\n\n\t\t\tif (this._alpha != 1.0)\n\t\t\t\tg.popAlpha();\n\t\t}\n\n\t\t/* *********** */\n\t\tif (G.debugBounds || this.debugBounds)\n\t\t{\n\t\t\tlet m = g.getMatrix();\n\t\t\tg = System.displayBuffer2;\n\t\n\t\t\tg.pushMatrix();\n\t\t\tg.loadMatrix(m);\n\t\t\tg.fillStyle(Element.getDebugColor(this.debugBounds));\n\t\t\tg.fillRect(this.bounds.x1, this.bounds.y1, this.bounds.width(), this.bounds.height());\n\t\t\tg.popMatrix();\n\t\t}\n\t},\n\n\t/**\n\t * Changes the function used to render the element.\n\t * @param { (g:Canvas, elem:Element, img:Drawable) => void } renderFunction\n\t * @returns {Element}\n\t */\n\trenderWith: function (renderFunction)\n\t{\n\t\tthis.render = renderFunction ?? null;\n\t\treturn this;\n\t}\n});\n\n/**\n * Colors for the bounds debugging.\n * !static debugColors : Array<string>;\n */\nElement.debugColors = [\n\t'rgba(0,255,255,0.35)', // Cyan\n\t'rgba(255,255,0,0.35)', // Yellow\n\t'rgba(255,0,255,0.35)', // Magenta\n\t'rgba(255,255,255,0.35)', // White\n\t'rgba(255,0,0,0.35)', // Red\n\t'rgba(0,255,0,0.35)', // Green\n\t'rgba(0,0,255,0.35)', // Blue\n\t'rgba(128,128,128,0.35)' // Gray\n];\n\n/**\n * Returns an RGBA color for the given `debugBounds` value.\n * !static getDebugColor (debugBounds: boolean|number) : string;\n */\nElement.getDebugColor = function (debugBounds)\n{\n\tif (debugBounds === true || debugBounds === false)\n\t\tdebugBounds = 0;\n\n\treturn Element.debugColors[(~~debugBounds) & 7];\n};\n\n//!/class\n\n//!namespace Element\n//!namespace Pool\n\n\t/**\n\t * Allocates a drawable element at the specified position with the given drawable.\n\t * !function alloc (x: number, y: number, width: number, height: number, img?: Drawable) : Element;\n\t */\n\t/**\n\t * Allocates a drawable element at the specified position with the given drawable.\n\t * !function alloc (x: number, y: number, img?: Drawable) : Element;\n\t */\n\nRecycler.createPool(Element);\nexport default Element;\n","/*\n**\tflow/group.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Element from './element.js';\nimport List from '../utils/list.js';\nimport Point2 from '../math/point2.js';\nimport Recycler from '../utils/recycler.js';\nimport GridElement from './grid-element.js';\n\n//![import \"./element\"]\n//![import \"../utils/list\"]\n//![import \"../math/point2\"]\n//![import \"../utils/recycler\"]\n\nconst tempPoint = Point2.Pool.alloc();\n\n//:/**\n//: * \tGroups one or more elements into a single one.\n//: */\n\n//!class Group extends Element\n\nconst Group = Element.extend\n({\n\tclassName: 'Group',\n\n\t/**\n\t * List of elements in the group.\n\t * !readonly children: List;\n\t */\n\tchildren: null,\n\n\t/**\n\t * \tVirtual zero reference point.\n\t * \t!readonly ref: Point2;\n\t */\n\tref: null,\n\n\t/**\n\t * \tConstructs an empty Group element.\n\t * \t!constructor (id?: string);\n\t */\n\t__ctor: function (id=null)\n\t{\n\t\tthis._super.Element.__ctor(0, 0, 0, 0);\n\n\t\tthis.children = List.Pool.alloc();\n\t\tthis.bounds.reset();\n\n\t\tthis.ref = Point2.Pool.alloc();\n\t\tthis.setId(id);\n\t},\n\n\t/**\n\t * \tDestroys the group and all children.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis.children.free();\n\t\tthis.ref.free();\n\n\t\tthis._super.Element.__dtor();\n\t},\n\n\t/**\n\t * \tAdds the group itself and all children to the scene's destruction queue. If any element has no container, it will be destroyed immediately.\n\t * \t!destroyLater() : void;\n\t */\n\tdestroyLater: function()\n\t{\n\t\tif (!this.alive()) return;\n\n\t\tlet i;\n\n\t\twhile ((i = this.children.shift()) != null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.group = null;\n\t\t\ti.destroyLater();\n\t\t}\n\n\t\tthis._super.Element.destroyLater();\n\t},\n\n\t/**\n\t * \tRemoves and destroys all child elements.\n\t * \t!clear() : Group;\n\t */\n\tclear: function()\n\t{\n\t\tlet i;\n\n\t\twhile ((i = this.children.shift()) != null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.group = null;\n\t\t\tdispose(i);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tRemoves all child elements but does not destroy them.\n\t * \t!reset() : Group;\n\t */\n\treset: function()\n\t{\n\t\tlet i;\n\n\t\twhile ((i = this.children.shift()) != null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.group = null;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the wrapExtents flag of the group.\n\t * @returns {boolean}\n\t * !wrapExtents () : boolean;\n\t */\n\t/**\n\t * Sets the wrapExtents flag of the group.\n\t * @param {boolean} value\n\t * @returns {Group}\n\t * !wrapExtents (value: boolean) : Group;\n\t */\n\twrapExtents: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.WRAP_EXTENTS);\n\n\t\tthis.flags &= ~GridElement.WRAP_EXTENTS;\n\t\tif (value) this.flags |= GridElement.WRAP_EXTENTS;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tAdds a child element to the group. If the element has its `id` property set, it will be added to the group as a\n\t * \tproperty, which can be accessed directly using the element identifier or using the `getChild` method.\n\t * \t!addChild (elem: Element) : Element;\n\t */\n\taddChild: function (elem, relative=false)\n\t{\n\t\tif (!elem) return elem;\n\n\t\tlet initial = this.bounds.x1 === null;\n\n\t\tif (initial || (this.flags & GridElement.WRAP_EXTENTS))\n\t\t{\n\t\t\tif (initial || elem.bounds.x1 < this.bounds.x1) this.ltranslate(elem.bounds.x1 - this.bounds.x1, 0);\n\t\t\tif (initial || elem.bounds.y1 < this.bounds.y1) this.ltranslate(0, elem.bounds.y1 - this.bounds.y1);\n\t\t\tif (initial || elem.bounds.x2 > this.bounds.x2) this.resizeBy(elem.bounds.x2 - this.bounds.x2, 0);\n\t\t\tif (initial || elem.bounds.y2 > this.bounds.y2) this.resizeBy(0, elem.bounds.y2 - this.bounds.y2);\n\t\t}\n\n\t\tthis.children.push(elem);\n\n\t\tif (elem.id !== null)\n\t\t\tthis[elem.id] = elem;\n\n\t\tif (relative === true)\n\t\t\telem.translate(this.bounds.x1, this.bounds.y1);\n\n\t\telem.group = this;\n\t\telem.remover.add(this._remove, this, this.children.bottom);\n\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tReturn the child element matching the specified identifier.\n\t * \t!child (id: string) : Element;\n\t */\n\tgetChild: function (id)\n\t{\n\t\treturn this[id] || null;\n\t},\n\n\t/**\n\t * \tCallback to remove an element from the container (called by Handler).\n\t */\n\t_remove: function (elem, self, node)\n\t{\n\t\tself.children.remove(node);\n\t\telem.group = null;\n\n\t\tif (elem.id !== null)\n\t\t\tself[elem.id] = null;\n\n\t\treturn false;\n\t},\n\n\t/**\n\t * \tRemoves an element from the container and returns it.\n\t * \t!removeChild (elem: Element) : Element;\n\t */\n\tremoveChild: function (elem)\n\t{\n\t\tif (!elem || elem.group !== this)\n\t\t\treturn elem;\n\n\t\telem.remover.execf(this._remove, this);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tSyncs the actual location of the specified element with its storage location. Returns `true` if successful.\n\t */\n\tsync: function()\n\t{\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.sync();\n\n\t\treturn this._super.Element.sync();\n\t},\n\n\t/**\n\t * \tLocal group translation, moves only the group by the specified deltas. Child elements remain in position.\n\t * \t@param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * \t!ltranslate (dx: number, dy: number, upscaled?: boolean) : Group;\n\t */\n\tltranslate: function (dx, dy, upscaled=false)\n\t{\n\t\treturn this._super.Element.translate(dx, dy, upscaled);\n\t},\n\n\t/**\n\t * \tMoves the group and all children by the specified deltas.\n\t * \t@param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * \t!ltranslate (dx: number, dy: number, upscaled?: boolean) : Group;\n\t */\n\ttranslate: function (dx, dy, upscaled=false)\n\t{\n\t\tlet _dx = this.bounds.x1;\n\t\tlet _dy = this.bounds.y1;\n\n\t\tthis._super.Element.translate(dx, dy, upscaled);\n\t\tthis.ref.add(dx, dy, upscaled);\n\n\t\t_dx = this.bounds.x1 - _dx;\n\t\t_dy = this.bounds.y1 - _dy;\n\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.translate(_dx, _dy);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns a temporal Point2, describing the extra offset introduced by the group when translating a child element by the specified deltas.\n\t * \t@param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * \t!getOffsets (dx: number, dy: number, upscaled?: boolean) : Point2;\n\t */\n\tgetOffsets: function (dx, dy, upscaled=false)\n\t{\n\t\ttempPoint.set(this.bounds.ux1, this.bounds.uy1, true);\n\n\t\tlet _dx = tempPoint.x;\n\t\tlet _dy = tempPoint.y;\n\n\t\ttempPoint.add(dx, dy, upscaled);\n\n\t\t_dx = tempPoint.x - _dx;\n\t\t_dy = tempPoint.y - _dy;\n\n\t\ttempPoint.set(_dx, _dy);\n\n\t\ttempPoint.x -= dx;\n\t\ttempPoint.y -= dy;\n\n\t\treturn tempPoint;\n\t},\n\n\t/**\n\t * \tSets bits of the element flags in the group and all children.\n\t * \t!setFlags (value: number) : Group;\n\t */\n\tsetFlags: function (value)\n\t{\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.setFlags(value);\n\n\t\treturn this._super.Element.setFlags(value);\n\t},\n\n\t/**\n\t * \tClears bits from the group and all children flags.\n\t * \t!clearFlags (value: number) : Group;\n\t */\n\tclearFlags: function (value)\n\t{\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.clearFlags(value);\n\n\t\treturn this._super.Element.clearFlags(value);\n\t},\n\n\t/**\n\t * Sets the visible flag of the group and all children.\n\t * @param {boolean} value - New visibility value.\n\t * @param {boolean} forced - When `true` forces to ignore the VISIBLE_LOCK flag.\n\t * !visible (value: boolean, forced?: boolean|false) : GridElement;\n\t */\n\t/**\n\t * Returns the visible flag.\n\t * !visible() : boolean;\n\t */\n\tvisible: function (value=null, forced=false)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._super.Element.visible();\n\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.visible(value, forced);\n\n\t\treturn this._super.Element.visible(value, forced);\n\t},\n\n\t/**\n\t * Returns the alpha value of the group.\n\t * @returns {number}\n\t * !alpha () : number;\n\t */\n\t/**\n\t * Sets the alpha value of the group and all children.\n\t * @param {number} value\n\t * @returns {Element}\n\t * !alpha (value: number) : Element;\n\t */\n\talpha: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._super.Element.alpha();\n\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.alpha(value);\n\n\t\treturn this._super.Element.alpha(value);\n\t}\n});\n\n//!/class\n\n//!namespace Group\n//!namespace Pool\n\n\t/**\n\t * \tAllocates an empty Group element.\n\t * \t!function alloc (id?: string) : Group;\n\t */\n\nRecycler.createPool(Group);\nexport default Group;\n","/*\n**\tflow/scene.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Container from './container.js';\nimport Viewport from './viewport.js';\nimport Group from './group.js';\nimport Bounds2 from '../math/bounds2.js';\nimport List from '../utils/list.js';\nimport Handler from '../utils/handler.js';\nimport globals from '../system/globals.js';\n\n//![import \"./container\"]\n//![import \"./viewport\"]\n//![import \"./group\"]\n//![import \"../math/bounds2\"]\n//![import \"../utils/list\"]\n//![import \"../utils/handler\"]\n//![import \"../system/globals\"]\n\n//:/**\n//: * \tA scene is a set of containers, viewports and groups. Rendering is done in their specific index-based order.\n//: */\n\n//!class Scene\n\nconst Scene = Class.extend\n({\n\tclassName: 'Scene',\n\n\t/**\n\t * \tMinimum dimensions of the scene (smallest container size).\n\t * \t!readonly minWidth: number;\n\t * \t!readonly minHeight: number;\n\t */\n\tminWidth: null,\n\tminHeight: null,\n\n\t/**\n\t * \tMaximum dimensions of the scene (largest container size).\n\t * \t!readonly maxWidth: number;\n\t * \t!readonly maxHeight: number;\n\t */\n\tmaxWidth: null,\n\tmaxHeight: null,\n\n\t/**\n\t * \tList of containers.\n\t */\n\tcontainers: null,\n\n\t/**\n\t * \tList of viewports.\n\t */\n\tviewports: null,\n\n\t/**\n\t * \tActive viewport bounds, used to select items in a visible region.\n\t * \t!readonly viewportBounds: Bounds2;\n\t */\n\tviewportBounds: null,\n\n\t/**\n\t * \tList of Group elements.\n\t */\n\tgroupList: null,\n\n\t/**\n\t * \tNamed Group elements.\n\t */\n\tgroups: null,\n\n\t/**\n\t * \tDisposal queue.\n\t */\n\tdisposalQueue: null,\n\n\t/**\n\t * \tFirst updater. Runs before any other update calls.\n\t * \t!readonly fupdater: Handler;\n\t */\n\tfupdater: null,\n\n\t/**\n\t * \tGeneral updater. Runs after the first updater and before synchronizer.\n\t * \t!readonly updater: Handler;\n\t */\n\tupdater: null,\n\n\t/**\n\t * \tSynchronizer. Run after general updater, and before viewport synchronization.\n\t * \t!readonly synchronizer: Handler;\n\t */\n\tsynchronizer: null,\n\n\t/**\n\t * \tLast updater. Runs after all other update calls.\n\t * \t!readonly lupdater: Handler;\n\t */\n\tlupdater: null,\n\n\t/**\n\t * \tDestroyer runs when the scene is destroyed.\n\t * \t!readonly destroyer: Handler;\n\t */\n\tdestroyer: null,\n\n\t/**\n\t * \tCurrent delta time. Set upon entering the `update` method. Reflects the same value as System.frameDelta.\n\t * \t!readonly dt: number;\n\t */\n\tdt: 0,\n\n\t/**\n\t * \tFlags of the object (see constants at the bottom of this file).\n\t */\n\tflags: 0,\n\n\t/**\n\t * \tTotal number of elements drawn on the last draw operation.\n\t * \t!readonly drawCount: number;\n\t */\n\tdrawCount: 0,\n\n\t/**\n\t * \tScene object pointing to itself.\n\t */\n\tscene: null,\n\n\t/**\n\t * \tBase depth (z-value) of the scene.\n\t * \t!readonly zvalue: number;\n\t */\n\tzvalue: null,\n\n\t/**\n\t * \tConstructs an empty scene with the specified index.\n\t * \t@param index - Index for the scene. Used to calculate the base z-value of the scene. Valid range is from 0 to 3.\n\t * \t!constructor (index: number);\n\t */\n\t__ctor: function(index)\n\t{\n\t\tthis.containers = [];\n\n\t\t/**\n\t\t * \tZ-value is a 24-bit value constructed as:\n\t\t *\t\t2-bits: Scene Index\n\t\t *\t\t4-bits: Container Index\n\t\t *\t\t18-bits: Element z-value\n\t\t */\n\t\tthis.zvalue = (index & 3) << (18+4);\n\n\t\tthis.viewports = [];\n\t\tthis.viewportBounds = Bounds2.Pool.alloc();\n\n\t\tthis.groupList = List.Pool.alloc();\n\t\tthis.groups = { };\n\n\t\tthis.disposalQueue = List.Pool.alloc();\n\n\t\tthis.fupdater = Handler.Pool.alloc(this);\n\t\tthis.updater = Handler.Pool.alloc(this);\n\t\tthis.synchronizer = Handler.Pool.alloc(this);\n\t\tthis.lupdater = Handler.Pool.alloc(this);\n\t\tthis.destroyer = Handler.Pool.alloc(this);\n\n\t\tthis.flags = Scene.VISIBLE;\n\t\tthis.scene = this;\n\t},\n\n\t/**\n\t * \tDestroys the instance along with all containers, viewports and groups.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.disposeQueued();\n\t\tthis.disposalQueue.free();\n\n\t\tthis.destroyer.exec();\n\t\tthis.destroyer.free();\n\n\t\tthis.fupdater.free();\n\t\tthis.updater.free();\n\t\tthis.synchronizer.free();\n\t\tthis.lupdater.free();\n\n\t\tlet i;\n\n\t\twhile ((i = this.groupList.shift()) !== null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.container = null;\n\t\t\tdispose(i);\n\t\t}\n\n\t\tfor (i = 0; i < this.containers.length; i++)\n\t\t{\n\t\t\tif (!this.containers[i]) continue;\n\n\t\t\tthis.containers[i].scene = null;\n\t\t\tdispose(this.containers[i]);\n\n\t\t\tthis.containers[i] = null;\n\t\t}\n\n\t\tfor (i = 0; i < this.viewports.length; i++)\n\t\t{\n\t\t\tif (!this.viewports[i]) continue;\n\n\t\t\tdispose(this.viewports[i]);\n\t\t\tthis.viewports[i] = null;\n\t\t}\n\n\t\tthis.viewportBounds.free();\n\t\tthis.groupList.free();\n\t},\n\n\t/**\n\t * \tClears the scene leaving only viewports.\n\t * \t!clear() : void;\n\t */\n\tclear: function()\n\t{\n\t\tthis.disposeQueued();\n\n\t\tlet i;\n\n\t\twhile ((i = this.groupList.shift()) !== null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.container = null;\n\t\t\tdispose(i);\n\t\t}\n\n\t\tfor (i = 0; i < this.containers.length; i++)\n\t\t{\n\t\t\tif (this.containers[i])\n\t\t\t\tthis.containers[i].clear();\n\t\t}\n\t},\n\n\t/**\n\t * \tReturns the value of the `visible` flag.\n\t * \t!visible() : boolean;\n\t */\n\t/**\n\t * \tSets the value of the `visible` flag.\n\t * \t!visible(value: boolean) : Container;\n\t */\n\tvisible: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Scene.VISIBLE);\n\n\t\tthis.flags &= ~Scene.VISIBLE;\n\t\tif (value) this.flags |= Scene.VISIBLE;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets a container at the specified index.\n\t * \t@param index - Index of the container, valid range is from 0 to 15.\n\t * \t!setContainer (index: number, container: Container) : Scene;\n\t */\n\tsetContainer: function (index, container)\n\t{\n\t\tif (index < 0) return this;\n\t\tindex &= 15;\n\n\t\tif (container === null)\n\t\t{\n\t\t\tthis.containers[index].scene = null;\n\t\t\tthis.containers[index] = null;\n\t\t\treturn this;\n\t\t}\n\n\t\tif (!Container.isInstance(container))\n\t\t\tthrow new Error('Scene: Unable to set container at index ' + index + ': argument is not a Container');\n\n\t\tif (this.minWidth === null || container.width < this.minWidth) this.minWidth = container.width;\n\t\tif (this.minHeight === null || container.height < this.minHeight) this.minHeight = container.height;\n\t\tif (this.maxWidth === null || container.width > this.maxWidth) this.maxWidth = container.width;\n\t\tif (this.maxHeight === null || container.height > this.maxHeight) this.maxHeight = container.height;\n\n\t\tcontainer.scene = this;\n\t\tcontainer.zvalue = this.zvalue + (index << 18);\n\n\t\tthis.containers[index] = container;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the container at the specified index.\n\t * \t!getContainer (index: number) : Container;\n\t */\n\tgetContainer: function (index)\n\t{\n\t\treturn index < 0 || index >= this.containers.length ? null : this.containers[index];\n\t},\n\n\t/**\n\t * \tSets a viewport at the specified index.\n\t * \t!setViewport (index: number, viewport: Viewport) : Scene;\n\t */\n\tsetViewport: function (index, viewport)\n\t{\n\t\tif (index < 0) return this;\n\n\t\tif (viewport !== null && !Viewport.isInstance(viewport))\n\t\t\tthrow new Error('Scene: Unable to set viewport at index ' + index + ': argument is not a Viewport.');\n\n\t\tthis.viewports[index] = viewport;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the viewport at the specified index.\n\t * \t!getViewport (index: number) : Viewport;\n\t */\n\tgetViewport: function (index)\n\t{\n\t\treturn index < 0 || index >= this.viewports.length ? null : this.viewports[index];\n\t},\n\n\t/**\n\t * \tAdds the given element to the disposal queue. To be destroyed on the next call to `disposeQueued`.\n\t * \t!disposeLater (elem: Element) : void;\n\t */\n\tdisposeLater: function (elem)\n\t{\n\t\tif (!elem.alive()) return;\n\n\t\tthis.disposalQueue.push(elem);\n\t\telem.alive(false);\n\t},\n\n\t/**\n\t * \tDisposes all elements in the disposal queue.\n\t * \t!disposeQueued() : void;\n\t */\n\tdisposeQueued: function ()\n\t{\n\t\tlet elem;\n\n\t\twhile ((elem = this.disposalQueue.shift()) !== null)\n\t\t\tdispose(elem);\n\t},\n\n\t/**\n\t * \tAdds a group to the scene.\n\t * \t!addGroup (group: Group) : boolean;\n\t */\n\taddGroup: function (group)\n\t{\n\t\tif (!Group.isInstance(group))\n\t\t\tthrow new Error ('argument must be a Group');\n\n\t\tthis.groupList.push(group);\n\n\t\tif (group.id !== null)\n\t\t\tthis.groups[group.id] = group;\n\n\t\tgroup.container = this;\n\t\tgroup.remover.add(this._removeGroup, this, this.groupList.bottom);\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tCallback to remove a group from the scene (called by Handler).\n\t */\n\t_removeGroup: function (group, self, node)\n\t{\n\t\tgroup.container = null;\n\t\tself.groupList.remove(node);\n\n\t\tif (group.id !== null)\n\t\t\tself.groups[group.id] = null;\n\n\t\treturn false;\n\t},\n\n\t/**\n\t * \tRemoves a group from the scene.\n\t * \t!removeGroup (group: Group) : Group;\n\t */\n\tremoveGroup: function (group)\n\t{\n\t\tgroup.remover.execf(this._remove, this);\n\t\treturn group;\n\t},\n\n\t/**\n\t * \tSyncs the actual location of the specified element with its storage location. Returns `true` if successful.\n\t * \t!sync (group: Group) : boolean;\n\t */\n\tsync: function (group)\n\t{\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tDraws the scene, by executing the `draw` method on each container. The entire scene will be drawn once for each viewport, and\n\t * \tthe visible region rules of each viewport will be applied.\n\t * \t!draw (g: Canvas) : void;\n\t */\n\tdraw: function (g)\n\t{\n\t\tif (!this.visible()) return;\n\n\t\tthis.drawCount = 0;\n\n\t\tif (!this.viewports.length)\n\t\t{\n\t\t\tthis.drawContainers(g, null);\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let viewportIndex = 0; viewportIndex < this.viewports.length; viewportIndex++)\n\t\t{\n\t\t\tlet viewport = this.viewports[viewportIndex];\n\t\t\tif (!viewport || !viewport.enabled()) continue;\n\n\t\t\tglobals.viewport = viewport;\n\n\t\t\tg.pushClip();\n\t\t\tg.pushMatrix();\n\n\t\t\tviewport.applyClip(g);\n\t\t\tviewport.applyTransform(g);\n\n\t\t\tthis.viewportBounds.set(viewport.bounds);//.resizeBy(2, 2);\n\t\t\tthis.drawContainers(g, this.viewportBounds);\n\n\t\t\tg.popMatrix();\n\t\t\tg.popClip();\n\t\t}\n\t},\n\n\t/**\n\t * \tDraws the scene containers and passes the specified viewport bounds to the container.\n\t * \t!drawContainers (g: Canvas, viewportBounds: Bounds2) : void;\n\t */\n\tdrawContainers: function (g, viewportBounds)\n\t{\n\t\ttry\n\t\t{\n\t\t\tfor (let i = 0; i < this.containers.length; i++)\n\t\t\t{\n\t\t\t\tif (!this.containers[i])\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis.containers[i].setViewportBounds(viewportBounds);\n\t\t\t\tthis.containers[i].draw(g);\n\n\t\t\t\tthis.drawCount += this.containers[i].drawCount;\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tif (e.message !== 'FRAME_END') {\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * \tUpdates the scene viewports.\n\t */\n\tupdateViewports: function ()\n\t{\n\t\tfor (let i = 0; i < this.viewports.length; i++)\n\t\t{\n\t\t\tif (!this.viewports[i])\n\t\t\t\tcontinue;\n\n\t\t\tthis.viewports[i].update(this.dt);\n\t\t}\n\t},\n\n\t/**\n\t * \tRuns a scene update cycle.\n\t * \t!update (dt: number) : void;\n\t */\n\tupdate: function (dt)\n\t{\n\t\tthis.dt = dt;\n\t\tthis.fupdater.exec();\n\n\t\tthis.updater.exec();\n\t\tthis.disposeQueued();\n\t\tthis.synchronizer.exec();\n\t\tthis.updateViewports();\n\n\t\tthis.lupdater.exec();\n\t}\n});\n\n\n/**\n * \tConstants.\n */\nScene.VISIBLE = 0x001;\n\nexport default Scene;\n","/*\n**\tflow/updater.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport List from '../utils/list.js';\nimport Element from './element.js';\n\n//![import \"../utils/list\"]\n//![import \"./element\"]\n\n//:/**\n//: * \tAn updater is used to update one or more elements and synchronize their position with their container.\n//: */\n\n//!class Updater\n\nconst Updater = Class.extend\n({\n\tclassName: 'Updater',\n\n\t/**\n\t * \tScene where the updater is attached.\n\t * \t!readonly scene: Scene;\n\t */\n\tscene: null,\n\n\t/**\n\t * \tList of elements.\n\t */\n\tlist: null,\n\n\t/**\n\t * \tCallback passed when constructing the updater.\n\t */\n\t__update: null,\n\t__context: null,\n\n\t/**\n\t * \tPre-update and post-update callbacks. Set using the `preupdate` and `postupdate` methods.\n\t */\n\t__preupdate: null,\n\t__postupdate: null,\n\n\t/**\n\t * \tConstructs the updater linked to the specified scene.\n\t * \t!constructor (scene: Scene, update: (elem: Element, dt: number, context: object) => boolean, context?: object);\n\t */\n\t__ctor: function (scene, update=null, context=null)\n\t{\n\t\tthis.list = List.Pool.alloc();\n\t\tthis.scene = scene;\n\n\t\tthis.__update = update;\n\t\tthis.__context = context;\n\n\t\tthis.__preupdate = null;\n\t\tthis.__postupdate = null;\n\n\t\tthis.scene.updater.add(this._update, this);\n\t\tthis.scene.synchronizer.add(this._sync, this);\n\t\tthis.scene.destroyer.add(this._destroy, this);\n\t},\n\n\t/**\n\t * \tDestroys the instance. All elements will just be removed.\n\t */\n\t__dtor: function()\n\t{\n\t\tlet i;\n\n\t\tthis.scene.updater.remove(this._update, this);\n\t\tthis.scene.synchronizer.remove(this._sync, this);\n\t\tthis.scene.destroyer.remove(this._destroy, this);\n\n\t\twhile ((i = this.list.shift()) !== null) {\n\t\t\ti.remover.remove(this._remove, this);\n\t\t}\n\n\t\tthis.list.free();\n\t},\n\n\t/**\n\t * \tDestroyer callback.\n\t */\n\t_destroy: function (scene, self)\n\t{\n\t\tdispose(self);\n\t},\n\n\n\t/**\n\t * \tResets the updater by removing all elements.\n\t * \t!reset () : Updater;\n\t */\n\treset: function ()\n\t{\n\t\twhile ((i = this.list.shift()) !== null) {\n\t\t\ti.remover.remove(this._remove, this);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tClears the updater by destroying all elements.\n\t * \t!clear () : Updater;\n\t */\n\tclear: function ()\n\t{\n\t\twhile ((i = this.list.shift()) !== null) {\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\tdispose(i);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the pre-update callback.\n\t * \t!preupdate (callback: (list: List, dt: number, updater: Updater) => Updater) : Updater;\n\t */\n\tpreUpdate: function (callback)\n\t{\n\t\tthis.__preupdate = callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the post-update callback.\n\t * \t!postupdate (callback: (list: List, dt: number, updater: Updater) => Updater) : Updater;\n\t */\n\tpostUpdate: function (callback)\n\t{\n\t\tthis.__postupdate = callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tAdds an element to the updater.\n\t * \t!add (elem: Element) : boolean;\n\t */\n\tadd: function (elem)\n\t{\n\t\tif (!Element.isInstance(elem))\n\t\t\tthrow new Error ('argument must be an Element');\n\n\t\tthis.list.push(elem);\n\n\t\telem.remover.add(this._remove, this, this.list.bottom);\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tCallback to remove an element from the updater (called by Handler).\n\t */\n\t_remove: function (elem, self, node)\n\t{\n\t\tself.list.remove(node);\n\t\treturn false;\n\t},\n\n\t/**\n\t * \tRemoves an element from the updater.\n\t * \t!remove (elem: Element) : Element;\n\t */\n\tremove: function (elem)\n\t{\n\t\telem.remover.execf(this._remove, this);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tCallback for the synchronizer.\n\t */\n\t_sync: function (scene, self)\n\t{\n\t\tfor (let i = self.list.top; i; i = i.next)\n\t\t\ti.value.sync();\n\t},\n\n\t/**\n\t * \tCallback for the updater.\n\t */\n\t_update: function (scene, self)\n\t{\n\t\tself.update(scene.dt);\n\t},\n\n\t/**\n\t * \tRuns an update cycle.\n\t * \t!update (dt: number) : void;\n\t */\n\tupdate: function (dt)\n\t{\n\t\tif (this.__preupdate !== null)\n\t\t\tthis.__preupdate (this.list, dt, this.__context);\n\n\t\tif (this.__update !== null)\n\t\t{\n\t\t\tlet next = null;\n\t\t\tfor (let i = this.list.top; i; i = next)\n\t\t\t{\n\t\t\t\tnext = i.next;\n\n\t\t\t\tif (this.__update (i.value, dt, this.__context) === false)\n\t\t\t\t\tthis.remove(i.value);\n\t\t\t}\n\t\t}\n\n\t\tif (this.__postupdate !== null)\n\t\t\tthis.__postupdate (this.list, dt, this.__context);\n\t}\n});\n\nexport default Updater;\n","/*\n**\tflow/simple-container.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Container from './container.js';\nimport GridElement from './grid-element.js';\nimport Element from './element.js';\nimport List from '../utils/list.js';\n\n//![import \"./container\"]\n//![import \"./grid-element\"]\n//![import \"./element\"]\n//![import \"../utils/list\"]\n\n//:/**\n//: * \tA simple container is a container that uses a linked-list to storage the elements.\n//: */\n\n//!class SimpleContainer extends Container\n\nexport default Container.extend\n({\n\tclassName: 'SimpleContainer',\n\n\t/**\n\t * List containing the elements.\n\t * !readonly list: List;\n\t */\n\tlist: null,\n\n\t/**\n\t * Constructs the container with the specified size.\n\t * !constructor (width: number, height: number);\n\t */\n\t__ctor: function (width, height)\n\t{\n\t\tthis._super.Container.__ctor (width, height);\n\t\tthis.list = List.Pool.alloc();\n\n\t\tthis.depthFlag(false);\n\t},\n\n\t/**\n\t * Destroys the container and all contained elements.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis.list.free();\n\n\t\tthis._super.Container.__dtor();\n\t},\n\n\t/**\n\t * Syncs the actual location of the specified element with its storage location. Returns true if successful.\n\t * !override sync (elem: Element) : boolean;\n\t */\n\tsync: function (elem)\n\t{\n\t\tthis.syncZ(elem);\n\t\treturn true;\n\t},\n\n\t/**\n\t * Clears the container to empty. All contained elements will be destroyed.\n\t * !override clear() : void;\n\t */\n\tclear: function()\n\t{\n\t\tlet i;\n\n\t\twhile ((i = this.list.shift()) !== null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.container = null;\n\t\t\tdispose(i);\n\t\t}\n\n\t\tthis.elementCount = 0;\n\t},\n\n\t/**\n\t * Resets the container to empty. Contained elements are not destroyed. Use `clear` if that is your intention.\n\t * !override reset() : void;\n\t */\n\treset: function()\n\t{\n\t\tlet i;\n\n\t\twhile ((i = this.list.shift()) !== null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.container = null;\n\t\t}\n\n\t\tthis.elementCount = 0;\n\t},\n\n\t/**\n\t * Adds an element to the container. Returns boolean indicating if successful.\n\t * !override add (elem: Element) : boolean;\n\t */\n\tadd: function (elem)\n\t{\n\t\tif (!Element.isInstance(elem))\n\t\t\tthrow new Error ('argument must be an Element');\n\n\t\tthis.list.push(elem);\n\t\tthis.elementCount++;\n\n\t\telem.container = this;\n\t\telem.remover.add(this._remove, this, this.list.bottom);\n\n\t\tthis.syncZ(elem);\n\t\treturn true;\n\t},\n\n\t/**\n\t * Callback to remove an element from the container (called by Handler).\n\t */\n\t_remove: function (elem, self, node)\n\t{\n\t\tself.list.remove(node);\n\t\tself.elementCount--;\n\n\t\telem.container = null;\n\t\treturn false;\n\t},\n\n\t/**\n\t * Removes an element from the container and returns it.\n\t * !override remove (elem: Element) : Element;\n\t */\n\tremove: function (elem)\n\t{\n\t\telem.remover.execf(this._remove, this);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * Actually draws the contained elements. Does not take the active viewport into account (hence simple container).\n\t * !override render() : void;\n\t */\n\trender: function()\n\t{\n\t\tlet flags = GridElement.ALIVE | GridElement.VISIBLE;\n\n\t\tfor (let i = this.list.top; i; i = i.next)\n\t\t{\n\t\t\tif (!i.value.getFlags(flags))\n\t\t\t\tcontinue;\n\n\t\t\tif (this.drawElement(i.value, this) === false)\n\t\t\t\tbreak;\n\t\t}\n\t}\n});\n","/*\n**\tflow/grid-container.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Container from './container.js';\nimport Grid from './grid.js';\nimport GridElement from './grid-element.js';\nimport Element from './element.js';\nimport globals from '../system/globals.js';\nimport System from '../system/system.js';\n\n//![import \"./container\"]\n//![import \"./grid\"]\n//![import \"./grid-element\"]\n//![import \"./element\"]\n//![import \"../system/globals\"]\n//![import \"../system/system\"]\n\n//:/**\n//: * \tA grid container is a container that uses an optimized spatial grid structure to store the elements.\n//: */\n\n//!class GridContainer extends Container\n\nexport default Container.extend\n({\n\tclassName: 'GridContainer',\n\n\t/**\n\t * \tGrid containing the elements.\n\t * \t!readonly grid: Grid;\n\t */\n\tgrid: null,\n\n\t/**\n\t * \tIndicates if the container bound should be drawn.\n\t * \t!debugBounds: boolean;\n\t */\n\tdebugBounds: false,\n\n\t/**\n\t * \tConstructs the grid container with the default size (32768x32768) and divisor (64).\n\t * \t!constructor ();\n\t */\n\t/**\n\t * \tConstructs the grid container with the specified size and divisor.\n\t * \t!constructor (width: number, height: number, divisorX: number, divisorY?: number);\n\t */\n\t__ctor: function (width=32768, height=32768, divisorX=64, divisorY=null)\n\t{\n\t\tthis._super.Container.__ctor (width, height);\n\t\tthis.grid = new Grid (width, height, divisorX, divisorY);\n\t},\n\n\t/**\n\t * \tDestroys the container and all contained elements.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis._super.Container.__dtor();\n\t},\n\n\t/**\n\t * \tSyncs the actual location of the specified element with its storage location. Returns true if successful.\n\t * \t!override sync (elem: Element) : boolean;\n\t */\n\tsync: function (elem)\n\t{\n\t\tthis.syncZ(elem);\n\t\treturn this.grid.sync(elem);\n\t},\n\n\t/**\n\t * \tClears the container to empty. All contained elements will be destroyed.\n\t * \t!override clear() : void;\n\t */\n\tclear: function()\n\t{\n\t\tthis.grid.clear();\n\t},\n\n\t/**\n\t * \tResets the container to empty. Contained elements are not destroyed. Use `clear` if that is your intention.\n\t * \t!override reset() : void;\n\t */\n\treset: function()\n\t{\n\t\tthis.grid.reset();\n\t},\n\n\t/**\n\t * \tAdds an element to the container. Returns boolean indicating if successful.\n\t * \t!override add (elem: Element) : boolean;\n\t */\n\tadd: function (elem)\n\t{\n\t\tif (!Element.isInstance(elem))\n\t\t\tthrow new Error ('argument must be an Element');\n\n\t\tif (!this.grid.add(elem))\n\t\t\treturn false;\n\n\t\telem.container = this;\n\t\tthis.elementCount = this.grid.count;\n\n\t\tthis.syncZ(elem);\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tRemoves an element from the container and returns it.\n\t * \t!override remove (elem: Element) : Element;\n\t */\n\tremove: function (elem)\n\t{\n\t\tthis.grid.remove(elem);\n\t\tthis.elementCount = this.grid.count;\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tActually draws the contained elements.\n\t * \t!override render() : void;\n\t */\n\trender: function()\n\t{\n\t\tthis.grid.forEachInRegion(this.viewportBounds, GridElement.ALIVE | GridElement.VISIBLE, GridElement.ALIVE | GridElement.VISIBLE, this.drawElement, this);\n\n\t\tif (!this.debugBounds || this.viewportBounds === null)\n\t\t\treturn;\n\n\t\tlet g = System.displayBuffer2;\n\n\t\tg.pushMatrix();\n\t\tg.loadMatrix(this.g.getMatrix());\n\n\t\tlet y0 = ((this.viewportBounds.y1+this.grid.offsy - (1<<this.grid.ky-1)) >> this.grid.ky) * this.grid.stride;\n\t\tlet y1 = ((this.viewportBounds.y2+this.grid.offsy) + (1<<this.grid.ky-1) >> this.grid.ky) * this.grid.stride;\n\t\tlet x0 = ((this.viewportBounds.x1+this.grid.offsx - (1<<this.grid.kx-1)) >> this.grid.kx);\n\t\tlet x1 = ((this.viewportBounds.x2+this.grid.offsx) + (1<<this.grid.kx-1) >> this.grid.kx);\n\n\t\ty0 = (int(y0 / this.grid.stride) << this.grid.ky) - this.grid.offsy;\n\t\ty1 = (int(y1 / this.grid.stride) << this.grid.ky) - this.grid.offsy + (1 << this.grid.ky);\n\t\tx0 = (x0 << this.grid.kx) - this.grid.offsx;\n\t\tx1 = (x1 << this.grid.kx) - this.grid.offsx + (1 << this.grid.kx);\n\n\t\tg.fillStyle('rgba(255,0,0,0.2)');\n\t\tg.fillRect(x0, y0, x1-x0+1, y1-y0+1);\n\n\t\ty0 = this.viewportBounds.y1;\n\t\ty1 = this.viewportBounds.y2;\n\t\tx0 = this.viewportBounds.x1;\n\t\tx1 = this.viewportBounds.x2;\n\n\t\tg.lineWidth(1/System.canvasScaleFactor);\n\t\tg.strokeStyle('#fff');\n\t\tg.strokeRect(x0, y0, x1-x0+1, y1-y0+1);\n\n\t\tg.lineWidth(1/System.canvasScaleFactor);\n\t\tg.strokeStyle('#008');\n\t\tfor (let y = globals.viewport.container.y1+this.grid.offsy; y < globals.viewport.container.y2+this.grid.offsy; y += (1 << this.grid.ky))\n\t\tfor (let x = globals.viewport.container.x1+this.grid.offsx; x < globals.viewport.container.x2+this.grid.offsx; x += (1 << this.grid.kx))\n\t\t{\n\t\t\tg.strokeRect(x-this.grid.offsx, y-this.grid.offsy, (1 << this.grid.kx), (1 << this.grid.ky));\n\t\t}\n\n\t\tg.popMatrix();\n\t},\n\n\t/**\n\t * \tExecutes the specified callback for each element that intersects the given bounds and has the specified flags set. The process is\n\t * \timmediately stopped if the callback returns `false`.\n\t * \t!forEachInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number, callback: (elem: Element, context?: object) => boolean, context?: object) : void;\n\t */\n\tforEachInRegion: function (bounds, flagsAndMask, flagsValue, callback, context)\n\t{\n\t\tthis.grid.forEachInRegion (bounds, flagsAndMask, flagsValue, callback, context);\n\t},\n\n\t/**\n\t * \tCollects all elements that intersect the given bounds and have the specified flags set. Returns a new List, remember to call `free` after using it.\n\t * \t!selectInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : List;\n\t */\n\tselectInRegion: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\treturn this.grid.selectInRegion (bounds, flagsAndMask, flagsValue);\n\t},\n\n\t/**\n\t * \tCounts all elements that intersect the given bounds and have the specified flags set.\n\t * \t!countInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : number;\n\t */\n\tcountInRegion: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\treturn this.grid.countInRegion (bounds, flagsAndMask, flagsValue);\n\t},\n\n\t/**\n\t * \tReturns the first element that intersect the given bounds and have the specified flags set.\n\t * \t!selectFirst (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : Element;\n\t */\n\tselectFirst: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\treturn this.grid.selectFirst (bounds, flagsAndMask, flagsValue);\n\t}\n});\n","/*\n**\tflow/mask.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Element from './element.js';\nimport System from '../system/system.js';\nimport Recycler from '../utils/recycler.js';\nimport globals from '../system/globals.js';\n\n//![import \"./element\"]\n//![import \"../system/system\"]\n//![import \"../utils/recycler\"]\n\n//:/**\n//: * \tDescribes an element mask. Used for collision detection.\n//: */\n\n//!class Mask extends Element\n\nconst Mask = Element.extend\n({\n\tclassName: 'Mask',\n\n\t/**\n\t * \tType of the mask (user defined).\n\t * \t!type: number;\n\t */\n\ttype: 0,\n\n\t/**\n\t * \tConstructs the Mask element.\n\t * \t!constructor (type: number, x: number, y: number, width: number, height: number);\n\t */\n\t__ctor: function(type, x, y, width, height)\n\t{\n\t\tthis._super.Element.__ctor(x, y, width, height);\n\n\t\tthis.type = type;\n\t},\n\n\t/**\n\t * \tDraws the element on the specified canvas.\n\t * \t!draw (g: Canvas) : void;\n\t */\n\tdraw: function(g)\n\t{\n\t\tif (!globals.debugMasks && !this.debugBounds)\n\t\t\treturn;\n\n\t\tlet m = g.getMatrix();\n\t\tg = System.displayBuffer2;\n\n\t\tg.pushMatrix();\n\t\tg.loadMatrix(m);\n\t\tg.fillStyle(Element.getDebugColor(this.debugBounds));\n\t\tg.fillRect(this.bounds.x1, this.bounds.y1, this.bounds.width(), this.bounds.height());\n\t\tg.popMatrix();\n\t}\n});\n\n//!/class\n\n//!namespace Mask\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a new Mask element.\n\t * \t!function alloc (type: number, x: number, y: number, width: number, height: number) : Mask;\n\t */\n\nRecycler.createPool(Mask);\nexport default Mask;\n","/*\n**\tflow/label.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Element from './element.js';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"./element\"]\n//![import \"../utils/recycler\"]\n\n//:/**\n//: * \tDescribes an element that can be rendered to the screen.\n//: */\n\n//!class Label extends Element\n\nconst Label = Element.extend\n({\n\tclassName: 'Label',\n\n\t/**\n\t * \tText to render.\n\t * \t!readonly text: string;\n\t */\n\ttext: null,\n\n\t/**\n\t * \tSpritefont resource.\n\t * \t!readonly font: Spritefont;\n\t */\n\tfont: null,\n\n\t/**\n\t * \tIndicates if the `text` property changed.\n\t */\n\t_dirty: false,\n\n\t/**\n\t * Current text width.\n\t * !readonly textWidth: number;\n\t */\n\ttextWidth: null,\n\n\t/**\n\t * Current text height.\n\t * !readonly textHeight: number;\n\t */\n\ttextHeight: null,\n\n\t/**\n\t * \tAlignment properties of the label.\n\t */\n\t_align: -1, /* -1=LEFT, 0=CENTER, 1=RIGHT */\n\t_valign: -1, /* -1=TOP, 0=MIDDLE, 1=BOTTOM */\n\n\t/**\t\n\t * Position offset for the text. Calculated based on alignment properties.\n\t */\n\ttextOffsetX: null,\n\ttextOffsetY: null,\n\n\t/**\n\t * \tConstructs a label element at the specified position with the given text.\n\t * \t!constructor (x: number, y: number, font: object, text: string);\n\t */\n\t__ctor: function(x, y, font, text)\n\t{\n\t\tthis._super.Element.__ctor(x, y, 4, 4);\n\n\t\tthis.text = text;\n\t\tthis.font = font;\n\n\t\tthis._align = -1;\n\t\tthis._valign = -1;\n\n\t\tthis.renderWith(this.renderText);\n\t\tthis._dirty = true;\n\t},\n\n\t/**\n\t * \tSets the horizontal alignment value of the label.\n\t * \t@param value - Use -1 for LEFT, 0 for CENTER, and 1 for RIGHT.\n\t * \t!align (value: number) : Label;\n\t */\n\talign: function (value)\n\t{\n\t\tif (this._align === value)\n\t\t\treturn this;\n\n\t\tthis._align = value;\n\t\tthis.textOffsetX = null;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the vertical alignment value of the label.\n\t * \t@param value - Use -1 for TOP, 0 for MIDDLE, and 1 for BOTTOM.\n\t * \t!valign (value: number) : Label;\n\t */\n\tvalign: function(value)\n\t{\n\t\tif (this._valign === value)\n\t\t\treturn this;\n\n\t\tthis._valign = value;\n\t\tthis.textOffsetY = null;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the text value of the label.\n\t * \t!setText (value: string) : Label;\n\t */\n\tsetText: function (value)\n\t{\n\t\tif (this.text === value)\n\t\t\treturn this;\n\n\t\tthis.text = value;\n\t\tthis._dirty = true;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the font resource to use.\n\t * \t!setFont (font: Spritefont) : Label;\n\t */\n\tsetFont: function (font)\n\t{\n\t\tif (this.font === font)\n\t\t\treturn this;\n\n\t\tthis.font = font;\n\t\tthis._dirty = true;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Updates the text related properties (textWidth, textHeight, textOffsetX and textOffsetY). Automatically\n\t * called before the label is drawn. Recalculates only if text changed since last call.\n\t */\n\tupdate: function()\n\t{\n\t\tif (this._dirty)\n\t\t{\n\t\t\tthis.textWidth = this.font.measureWidth(this.text);\n\t\t\tthis.textHeight = this.font.measureHeight(this.text);\n\n\t\t\tthis.textOffsetX = null;\n\t\t\tthis.textOffsetY = null;\n\n\t\t\tthis._dirty = false;\n\t\t}\n\n\t\tif (this.textOffsetX === null) {\n\t\t\tif (this._align < 0) this.textOffsetX = 0;\n\t\t\telse if (this._align === 0) this.textOffsetX = -this.textWidth >> 1;\n\t\t\telse this.textOffsetX = -this.textWidth;\n\t\t}\n\n\t\tif (this.textOffsetY === null) {\n\t\t\tif (this._valign < 0) this.textOffsetY = 0;\n\t\t\telse if (this._valign === 0) this.textOffsetY = -this.textHeight >> 1;\n\t\t\telse this.textOffsetY = -this.textHeight;\n\t\t}\n\t},\n\n\t/**\n\t * \tRenders the element to the graphics surface.\n\t */\n\trenderText: function(g, elem, img)\n\t{\n\t\telem.update();\n\t\telem.font.drawText (g, elem.bounds.x1 + elem.textOffsetX, elem.bounds.y1 + elem.textOffsetY, elem.text);\n\t}\n});\n\n//!/class\n\n//!namespace Label\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a label element at the specified position with the given text.\n\t * \t!function alloc (x: number, y: number, font: object, text: string) : Label;\n\t */\n\n\nRecycler.createPool(Label);\nexport default Label;\n","/*\n**\tflow/keyboard-handler\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport PriorityQueue from '../utils/priority-queue.js';\nimport Boot from './boot.js';\nimport System from '../system/system.js';\n\n//![import \"../utils/priority-queue\"]\n//![import \"./boot\"]\n//![import \"../system/system\"]\n\n//!namespace KeyboardHandler\n\n\t//!interface EventHandler\n\n\t\t/**\n\t\t * \tHandler for keyboard events.\n\t\t * \t!onKeyboardEvent (action: System.KeyboardEventType, keyCode: number, keyState: object) : boolean;\n\t\t */\n\n\t//!/interface\n\n//!/namespace\n\n//:/**\n//: * \tUsed to attach keyboard event handlers to the system.\n//: */\n\n//!class KeyboardHandler\n\nexport default Boot.Module.create\n({\n\thandlers: null,\n\n\t__ctor: function ()\n\t{\n\t\tconst self = this;\n\n\t\tthis._super.Module.__ctor();\n\n\t\tthis.handlers = new PriorityQueue();\n\n\t\tthis._callOnKeyboardEvent = function (handler) {\n\t\t\treturn self.callOnKeyboardEvent(handler);\n\t\t};\n\t},\n\n\t/**\n\t * \tRegisters a new keyboard event handler.\n\t * \t!static register (handler: KeyboardHandler.EventHandler) : KeyboardHandler.EventHandler;\n\t */\n\tregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.add(handler);\n\n\t\t\tif ('init' in handler)\n\t\t\t\thandler.init();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"KeyboardHandler (register): \" + e.message);\n\t\t}\n\n\t\treturn handler;\n\t},\n\n\t/**\n\t * \tRemoves a keyboard event handler.\n\t * \t!static unregister (handler: KeyboardHandler.EventHandler) : void;\n\t */\n\tunregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.remove(handler);\n\t\t\tthis.handlers.cleanup();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"KeyboardHandler (unregister): \" + e.message);\n\t\t}\n\t},\n\n\tcallOnKeyboardEvent: function (handler)\n\t{\n\t\treturn handler.onKeyboardEvent(this._action, this._keyCode, this._keyState);\n\t},\n\n\tonStartup: function()\n\t{\n\t\tSystem.onKeyboardEvent = (action, keyCode, keyState) =>\n\t\t{\n\t\t\tthis._action = action;\n\t\t\tthis._keyCode = keyCode;\n\t\t\tthis._keyState = keyState;\n\n\t\t\tthis.handlers.forEach(this._callOnKeyboardEvent);\n\t\t};\n\t},\n\n\tonShutdown: function()\n\t{\n\t\tSystem.onKeyboardEvent = null;\n\t}\n});\n","/*\n**\tflow/pointer-handler\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport PriorityQueue from '../utils/priority-queue.js';\nimport Boot from './boot.js';\nimport System from '../system/system.js';\n\n//![import \"../utils/priority-queue\"]\n//![import \"./boot\"]\n//![import \"../system/system\"]\n\n//!namespace PointerHandler\n\n\t//!interface EventHandler\n\n\t\t/**\n\t\t * \tHandler for pointer events.\n\t\t * \t!onPointerEvent (action: System.PointerEventType, pointer: object, pointers: object) : boolean;\n\t\t */\n\n\t//!/interface\n\n//!/namespace\n\n//:/**\n//: * \tUsed to attach pointer event handlers to the system.\n//: */\n\n//!class PointerHandler\n\nexport default Boot.Module.create\n({\n\thandlers: null,\n\n\t__ctor: function ()\n\t{\n\t\tconst self = this;\n\n\t\tthis._super.Module.__ctor();\n\n\t\tthis.handlers = new PriorityQueue();\n\n\t\tthis._callOnPointerEvent = function (handler) {\n\t\t\treturn self.callOnPointerEvent(handler);\n\t\t};\n\t},\n\n\t/**\n\t * \tRegisters a new pointer event handler.\n\t * \t!static register (handler: PointerHandler.EventHandler) : PointerHandler.EventHandler;\n\t */\n\tregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.add(handler);\n\n\t\t\tif ('init' in handler)\n\t\t\t\thandler.init();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"PointerHandler (register): \" + e.message);\n\t\t}\n\n\t\treturn handler;\n\t},\n\n\t/**\n\t * \tRemoves a pointer event handler.\n\t * \t!static unregister (handler: PointerHandler.EventHandler) : void;\n\t */\n\tunregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.remove(handler);\n\t\t\tthis.handlers.cleanup();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"PointerHandler (unregister): \" + e.message);\n\t\t}\n\t},\n\n\tcallOnPointerEvent: function (handler)\n\t{\n\t\treturn handler.onPointerEvent(this._action, this._p, this._pointers);\n\t},\n\n\tonStartup: function()\n\t{\n\t\tSystem.onPointerEvent = (action, p, pointers) =>\n\t\t{\n\t\t\tthis._action = action;\n\t\t\tthis._p = p;\n\t\t\tthis._pointers = pointers;\n\n\t\t\tthis.handlers.forEach(this._callOnPointerEvent);\n\t\t};\n\t},\n\n\tonShutdown: function()\n\t{\n\t\tSystem.onPointerEvent = null;\n\t}\n});\n","/*\n**\tflow/screen-controls\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport KeyboardHandler from './keyboard-handler.js';\nimport PointerHandler from './pointer-handler.js';\nimport System from '../system/system.js';\n\n//![import \"./keyboard-handler\"]\n//![import \"./pointer-handler\"]\n//![import \"../system/system\"]\n\n/**\n**\n*/\n\nconst ScreenControls =\n({\n\tpriority: 5,\n\n\tlist: [ ],\n\tdummy: { },\n\n\thoverEnabled: false,\n\tzindexEnabled: false,\n\tlastFrame: 0,\n\n\t/*\n\t**\tAdds an item to the ScreenControls control list. The item should be an object with the following mandatory methods:\n\t**\n\t**\t\tbool containsPoint (float pointerX, float pointerY)\n\t**\t\tvoid pointerActivate (Object pointer)\n\t**\t\tvoid pointerDeactivate (Object pointer)\n\t**\t\tvoid pointerUpdate (float pointerX, float pointerY, Object pointer)\n\t**\t\tvoid hover (bool status, Object pointer)\n\t**\t\tbool focusLock\n\t**\n\t**\t\tbool keyboardEvents\n\t**\t\tbool keyDown (int keyCode, object keyArgs)\n\t**\t\tbool keyUp (int keyCode, object keyArgs)\n\t*/\n\tadd: function (c)\n\t{\n\t\tif (this.zindexEnabled && !('zindex' in c))\n\t\t\tc.zindex = 0;\n\n\t\tif (this.list.indexOf(c) === -1)\n\t\t\tthis.list.push(c);\n\t},\n\n\tremove: function (c)\n\t{\n\t\tvar i = this.list.indexOf(c);\n\t\tif (i !== -1) this.list.splice(i, 1);\n\t},\n\n\tsetHoverEnabled: function (value)\n\t{\n\t\tthis.hoverEnabled = value;\n\t},\n\n\tsetZIndexEnabled: function (value)\n\t{\n\t\tthis.zindexEnabled = value;\n\t},\n\n\tfindTarget: function (x, y, filter)\n\t{\n\t\tif (this.zindexEnabled && this.lastFrame != System.frameNumber)\n\t\t{\n\t\t\tlet zindex = this.list[0].zindex;\n\n\t\t\tfor (let item of this.list)\n\t\t\t{\n\t\t\t\tif (item.zindex > zindex)\n\t\t\t\t{\n\t\t\t\t\tthis.list = this.list.sort((a,b) => b.zindex - a.zindex);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tzindex = item.zindex;\n\t\t\t}\n\n\t\t\tthis.lastFrame = System.frameNumber;\n\t\t}\n\n\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t{\n\t\t\tif (!this.list[i]) continue;\n\n\t\t\tif (filter != null && filter(this.list[i]) === false)\n\t\t\t\tcontinue;\n\n\t\t\tif (this.list[i].containsPoint(x, y))\n\t\t\t\treturn this.list[i];\n\t\t}\n\n\t\treturn null;\n\t},\n\n\tfilterHover: function (i)\n\t{\n\t\treturn 'hover' in i;\n\t},\n\n\tonPointerEvent: function (action, p, pointers)\n\t{\n\t\tlet _continue = true;\n\t\tlet tmp = null;\n\n\t\tswitch (action)\n\t\t{\n\t\t\tcase System.PointerEventType.POINTER_DOWN:\n\n\t\t\t\tif (p._ref != null)\n\t\t\t\t{\n\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\ttmp.pointerDeactivate(p);\n\t\t\t\t}\n\n\t\t\t\ttmp = this.findTarget(p.x, p.y);\n\t\t\t\tif (tmp != null)\n\t\t\t\t{\n\t\t\t\t\t(p._ref = tmp).pointerActivate(p);\n\t\t\t\t\t_continue = false;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_DRAG_START:\n\t\t\t\tif (p._ref != null) _continue = false;\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_DRAG_MOVE:\n\t\t\t\tif (this.hoverEnabled)\n\t\t\t\t{\n\t\t\t\t\tif (p._refh != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (p._refh.containsPoint(p.x, p.y))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp = p._refh; p._refh = null;\n\t\t\t\t\t\t\ttmp.hover(false, p);\n\t\t\n\t\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, this.filterHover);\n\t\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, this.filterHover);\n\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (p._ref != null)\n\t\t\t\t{\n\t\t\t\t\tif (p._ref.containsPoint(p.x, p.y) || p._ref.focusLock == true)\n\t\t\t\t\t{\n\t\t\t\t\t\tp._ref.pointerUpdate (p.x, p.y, p);\n\t\t\t\t\t\t_continue = false;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\t\ttmp.pointerDeactivate(p);\n\t\n\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y);\n\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t(p._ref = tmp).pointerActivate(p);\n\t\t\t\t\t\t\t_continue = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttmp = this.findTarget(p.x, p.y);\n\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t{\n\t\t\t\t\t\t(p._ref = tmp).pointerActivate(p);\n\t\t\t\t\t\t_continue = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_MOVE:\n\t\t\t\tif (this.hoverEnabled)\n\t\t\t\t{\n\t\t\t\t\tif (p._refh != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (p._refh.containsPoint(p.x, p.y))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp = p._refh; p._refh = null;\n\t\t\t\t\t\t\ttmp.hover(false, p);\n\t\t\n\t\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, this.filterHover);\n\t\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, this.filterHover);\n\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (p._ref == null) break;\n\n\t\t\t\tif (p._ref.containsPoint(p.x, p.y) || p._ref.focusLock == true)\n\t\t\t\t{\n\t\t\t\t\tp._ref.pointerUpdate (p.x, p.y, p);\n\t\t\t\t\t_continue = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\ttmp.pointerDeactivate(p);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_DRAG_STOP:\n\t\t\t\tif (p._ref != null) _continue = false;\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_UP:\n\t\t\t\tif (p._ref != null)\n\t\t\t\t{\n\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\ttmp.pointerDeactivate(p);\n\n\t\t\t\t\t_continue = false;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn _continue;\n\t},\n\n\tonKeyboardEvent: function (action, keyCode, keyArgs)\n\t{\n\t\tswitch (action)\n\t\t{\n\t\t\tcase System.KeyboardEventType.KEY_DOWN:\n\n\t\t\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!this.list[i] || !this.list[i].keyboardEvents) continue;\n\n\t\t\t\t\tif (this.list[i].keyDown(keyCode, keyArgs) === false)\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.KeyboardEventType.KEY_UP:\n\n\t\t\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!this.list[i] || !this.list[i].keyboardEvents) continue;\n\n\t\t\t\t\tif (this.list[i].keyUp(keyCode, keyArgs) === false)\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n});\n\nPointerHandler.register(ScreenControls);\nKeyboardHandler.register(ScreenControls);\n\nexport default ScreenControls;\n","/*\n**\tflow/button\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Group from './group.js';\nimport Mask from './mask.js';\nimport ScreenControls from './screen-controls.js';\n\n//![import \"./group.js\"]\n//![import \"./mask.js\"]\n//![import \"./screen-controls.js\"]\n\n/**\n * \tButton class provides an easy way to add push-button support to the world.\n */\n\n//!class Button extends Group\n\nexport default Group.extend\n({\n\t/**\n\t * \tIndicates if once focus is obtained it is locked until the user releases it.\n\t * \t@default false\n\t *\t!focusLock: boolean;\n\t */\n\tfocusLock: false,\n\n\t/**\n\t * \tIndicates if keyboard events are enabled on this object.\n\t * \t@default true\n\t *\t!keyboardEvents: boolean;\n\t */\n\tkeyboardEvents: true,\n\n\t/**\n\t * \tCurrent pressed status of the button.\n\t *\t!isPressed: boolean;\n\t */\n\tisPressed: false,\n\n\t/**\n\t * \tPrevious pressed status of the button.\n\t *\t!wasPressed: boolean;\n\t */\n\twasPressed: false,\n\n\t/**\n\t * \tImage to draw when the button is unpressed.\n\t *\t!unpressedImg: Drawable;\n\t */\n\tunpressedImg: null,\n\n\t/**\n\t * \tImage to draw when the button is pressed.\n\t *\t!pressedImg: Drawable;\n\t */\n\tpressedImg: null,\n\n\t/**\n\t * \tKey code related to the button. Used only if not `null`.\n\t * \t@default null\n\t *\t!keyCode: KeyCode;\n\t */\n\tkeyCode: null,\n\n\t/**\n\t * \tHitbox element.\n\t * \t!readonly hitbox: Mask;\n\t */\n\thitbox: null,\n\n\t/**\n\t * \tHandlers for the button events.\n\t */\n\t_onButtonDown: null,\n\t_onButtonUp: null,\n\t_onTap: null,\n\t_onChange: null,\n \n\t/**\n\t * \tCreates the button with the specified parameters. Automatically adds it to the screen controls.\n\t * \t!constructor (container: Container, x: number, y: number, unpressedImg?: Drawable, pressedImg?: Drawable);\n\t */\n\t__ctor: function (container, x, y, unpressedImg=null, pressedImg=null)\n\t{\n\t\tthis._super.Group.__ctor();\n\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg ?? unpressedImg;\n\t\tthis.hitbox = null;\n\n\t\tlet hitbox = Mask.Pool.alloc (0, x, y, this.unpressedImg ? this.unpressedImg.width : 16, this.unpressedImg ? this.unpressedImg.height : 16).visible(false).visibleLock(true).debug(2);\n\t\tthis.addChild(hitbox);\n\n\t\tcontainer.add(hitbox);\n\t\tcontainer.add(this);\n\n\t\tthis.hitbox = hitbox;\n\n\t\tthis._onButtonDown = null;\n\t\tthis._onButtonUp = null;\n\t\tthis._onTap = null;\n\t\tthis._onChange = this._default_onChange;\n\n\t\tthis.reset();\n\t\tScreenControls.add(this);\n\t},\n\n\t/**\n\t * \tRemoves the button from the screen controls and destroys it.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis._super.Group.__dtor();\n\t\tScreenControls.remove(this);\n\t},\n\n\t/**\n\t * \tSets the width and height of the button and the hitbox.\n\t * \t!resize (width: number, height: number) : GridElement;\n\t */\n\tresize: function (width, height)\n\t{\n\t\tthis._super.Group.resize(width, height);\n\n\t\tif (this.hitbox !== null)\n\t\t\tthis.hitbox.resize(width, height);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResizes the button and hitbox by the specified deltas.\n\t * \t!resizeBy (deltaWidth: number, deltaHeight: number) : GridElement;\n\t */\n\tresizeBy: function (dWidth, dHeight)\n\t{\n\t\tthis._super.Group.resizeBy(dWidth, dHeight);\n\n\t\tif (this.hitbox !== null)\n\t\t\tthis.hitbox.resizeBy(dWidth, dHeight);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tChanges the pressed/unpressed images of the button.\n\t * \t!setImage (unpressedImg: Drawable, pressedImg?: Drawable) : Button;\n\t */\n\tsetImage: function (unpressedImg, pressedImg=null)\n\t{\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg || unpressedImg;\n\n\t\tthis.reset();\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tChanges the key code of the button.\n\t * \t!setKeyCode (value: KeyCode) : Button;\n\t */\n\tsetKeyCode: function (value)\n\t{\n\t\tthis.keyCode = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResets the button to its initial state.\n\t * \t!reset() : void;\n\t */\n\treset: function ()\n\t{\n\t\tthis.img = this.unpressedImg;\n\t\tthis._onChange (this.isPressed = false, this.wasPressed = false, this);\n\t},\n\n\t/**\n\t * \tButton pointer update event. Not required for the button control.\n\t * \t!pointerUpdate (pointerX: number, pointerY: number, pointer: object) : void;\n\t */\n\tpointerUpdate: function (pointerX, pointerY, pointer)\n\t{\n\t},\n\n\t/**\n\t * \tSets the pressed state of the button.\n\t * \t!setStatus (value: boolean) : Button;\n\t */\n\tsetStatus: function (value)\n\t{\n\t\tif ((this.isPressed && value) || (!this.isPressed && !value))\n\t\t\treturn this;\n\n\t\tthis.updateStatus (value);\n\n\t\tthis.img = this.isPressed ? this.pressedImg : this.unpressedImg;\n\t\tthis._onChange (this.isPressed, this.wasPressed, this);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMoves the `isPressed` value of the button to `wasPressed`, and updates `isPressed` with the given value. If none provided, `isPressed` is unchanged.\n\t *\t!updateStatus (value?: boolean) : Button;\n\t */\n\tupdateStatus: function (value=null)\n\t{\n\t\tthis.wasPressed = this.isPressed;\n\t\tthis.isPressed = value === null ? this.isPressed : value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCalled when the PointerEventType.POINTER_DOWN event starts within the bounding box of the button.\n\t * \t!pointerActivate (pointer: object) : void;\n\t */\n\tpointerActivate: function (pointer)\n\t{\n\t\tthis.setStatus(true);\n\t},\n\n\t/**\n\t * \tCalled when the PointerEventType.POINTER_UP event is fired with the \"_ref\" attribute pointing to this object.\n\t *\t!pointerDeactivate (pointer: object) : void;\n\t */\n\tpointerDeactivate: function (pointer)\n\t{\n\t\tthis.setStatus(false);\n\t},\n\n\t/**\n\t * \tReturns `true` if the button contains the specified point.\n\t * \t!containsPoint (x: number, y: number) : boolean;\n\t */\n\tcontainsPoint: function(x, y)\n\t{\n\t\tif (!this.visible())\n\t\t\treturn false;\n\n\t\treturn this.hitbox.bounds.containsPoint(x, y);\n\t},\n\n\t/**\n\t * \tExecuted after any change in the status of the button. Be careful when overriding this, because when so, the `onTap` method will not work.\n\t * \t!onChange (isPressed: boolean, wasPressed: boolean, button: Button) : void;\n\t */\n\t_default_onChange: function (isPressed, wasPressed, button)\n\t{\n\t\tif (isPressed != wasPressed)\n\t\t{\n\t\t\tif (isPressed && this._onButtonDown)\n\t\t\t\tthis._onButtonDown();\n\t\t\telse if (!isPressed && this._onButtonUp)\n\t\t\t\tthis._onButtonUp();\n\t\t}\n\n\t\tif (!isPressed && wasPressed && this._onTap)\n\t\t\tthis._onTap();\n\t},\n\n\t/**\n\t * \tKey down event, handles the keys that control the button.\n\t * \t!keyDown (keyCode: KeyCode, keyArgs: object) : boolean|null;\n\t */\n\tkeyDown: function (keyCode, keyArgs)\n\t{\n\t\tif (keyCode === this.keyCode)\n\t\t{\n\t\t\tthis.pointerActivate();\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * \tKey up event, handles the keys that control the button.\n\t * \t!keyUp (keyCode: KeyCode, keyArgs: object) : boolean|null;\n\t */\n\tkeyUp: function (keyCode, keyArgs)\n\t{\n\t\tif (keyCode === this.keyCode)\n\t\t{\n\t\t\tthis.pointerDeactivate();\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * \tSets the handler for the on-change event. Executed when the button state changes. Setting this callback will cause onButtonDown,\n\t * \tonButtonUp and onTap to no longer work. Set the callback to `null` to return it to the default state.\n\t * \n\t * \t!onChange (callback: (isPressed: boolean, wasPressed: boolean, buttons: Button) => void) : Button;\n\t */\n\tonChange: function (callback)\n\t{\n\t\tthis._onChange = callback === null ? this._default_onChange : callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the handler for the button-down event. Executed when the button is pressed. Fired only if the `onChange` method was not overriden.\n\t * !onButtonDown (callback: () => void) : Button;\n\t */\n\t/**\n\t * Executes the onButtonDown handler.\n\t * !onButtonDown() : void;\n\t */\n\tonButtonDown: function (callback=true)\n\t{\n\t\tif (callback === true) {\n\t\t\tif (this._onButtonDown) this._onButtonDown();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._onButtonDown = callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the handler for the button-up event. Executed when the button is released. Fired only if the `onChange` method was not overriden.\n\t * \t!onButtonUp (callback: () => void) : Button;\n\t */\n\t/**\n\t * Executes the onButtonUp handler.\n\t * !onButtonUp() : void;\n\t */\n\tonButtonUp: function (callback=true)\n\t{\n\t\tif (callback === true) {\n\t\t\tif (this._onButtonUp) this._onButtonUp();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._onButtonUp = callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the handler for the on-tap event. Executed when the button is tapped (pressed and then released). Fired only if the `onChange` method was not overriden.\n\t * \t!onTap (callback: () => void) : Button;\n\t */\n\t/**\n\t * Executes the onTap handler.\n\t * !onTap() : void;\n\t */\n\tonTap: function (callback=true)\n\t{\n\t\tif (callback === true) {\n\t\t\tif (this._onTap) this._onTap();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._onTap = callback;\n\t\treturn this;\n\t}\n});\n","/*\n**\tflow/stick\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Group from './group.js';\nimport Mask from './mask.js';\nimport ScreenControls from './screen-controls.js';\nimport KeyCode from '../system/keycode.js';\n\n//![import \"./group\"]\n//![import \"./mask\"]\n//![import \"./screen-controls\"]\n//![import \"../system/keycode\"]\n\n/**\n * \tStick class provides an easy way to add directional control sticks to the world.\n */\n\n//!class Stick extends Group\n\nexport default Group.extend\n({\n\t/**\n\t * \tIndicates if once focus is obtained it is locked until the user releases it.\n\t * \t@default true\n\t *\t!focusLock: boolean;\n\t */\n\tfocusLock: true,\n\n\t/**\n\t * \tIndicates if keyboard events are enabled on this object.\n\t * \t@default true\n\t *\t!keyboardEvents: boolean;\n\t */\n\tkeyboardEvents: true,\n\n\t/**\n\t * \tCurrent pressed status of the stick.\n\t *\t!isPressed: boolean;\n\t */\n\tisPressed: false,\n\n\t/**\n\t * \tPrevious pressed status of the stick.\n\t *\t!wasPressed: boolean;\n\t */\n\twasPressed: false,\n\n\t\t/**\n\t\t * \tImage to draw when the stick is unpressed (outer circle).\n\t\t *\t!unpressedImg: Drawable;\n\t\t */\n\t\tunpressedImg: null,\n\n\t\t/**\n\t\t * \tImage to draw when the stick is pressed (outer circle).\n\t\t *\t!pressedImg: Drawable;\n\t\t */\n\t\tpressedImg: null,\n\n\t/**\n\t * \tImage to draw when the stick is unpressed (inner circle).\n\t *\t!unpressedImgInner: Drawable;\n\t */\n\tunpressedImgInner: null,\n\n\t/**\n\t * \tImage to draw when the stick is pressed (inner circle).\n\t *\t!pressedImgInner: Drawable;\n\t */\n\tpressedImgInner: null,\n\n\t\t/**\n\t\t * \tNumber of steps for the angle. Used to snap the stick movement to discrete steps.\n\t\t * \t!angleSteps: number;\n\t\t */\n\t\tangleSteps: 0,\n\n\t\t/**\n\t\t * \tNumber of steps for the radius of the stick. Used to snap the stick movement to discrete steps.\n\t\t * \t!radiusSteps: number;\n\t\t */\n\t\tradiusSteps: 0,\n\n\t/**\n\t * Center reference coordinates. Set when the pointer is activated.\n\t */\n\trefX: null,\n\trefY: null,\n\n\t/*\n\t**\tDirection (X and Y), magnitude and angle of the stick vector. The dirx and diry are normalized.\n\t*/\n\trdirx: 0,\n\trdiry: 0,\n\n\tdirx: 0,\n\tdiry: 0,\n\n\tmagnitude: 0,\n\tangle: 0,\n\n\t/*\n\t**\tFrozen stick state. Set by calling `freezeState`.\n\t*/\n\tfrdirx: 0, frdiry: 0, fdirx: 0, fdiry: 0, fmagnitude: 0, fangle: 0,\n\n\t/*\n\t**\tIndicates the displacement in X and Y directions of the inner stick. This is calculated when the update() method is called.\n\t*/\n\tdispx: 0, dispy: 0,\n\n\t/*\n\t**\tCurrent radius of the inner stick (how far it moved). And maximum radius that the inner stick can move.\n\t*/\n\tradius: 0, maxRadius: 0,\n\n\t/*\n\t**\tDead zone values for each axis.\n\t*/\n\tdeadZoneX: 0, deadZoneY: 0,\n\n\t/*\n\t**\tHitbox element.\n\t*/\n\thitbox: 0,\n\n\t/**\n\t * \tHandlers for the stick events.\n\t */\n\t_onChange: null,\n \n\t/**\n\t * \tCreates the stick with the specified parameters. Automatically adds it to the screen controls.\n\t * \t!constructor (container: Container, x: number, y: number, maxRadius: number, unpressedImg: Drawable, unpressedImgInner: Drawable, pressedImg?: Drawable, pressedImgInner?: Drawable);\n\t */\n\t__ctor: function (container, x, y, maxRadius, unpressedImg, unpressedImgInner, pressedImg=null, pressedImgInner=null)\n\t{\n\t\tthis._super.Group.__ctor();\n\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg || unpressedImg;\n\n\t\tthis.unpressedImgInner = unpressedImgInner;\n\t\tthis.pressedImgInner = pressedImgInner || unpressedImgInner;\n\n\t\tthis.maxRadius = maxRadius;\n\n\t\tthis.deadZoneX = 0;\n\t\tthis.deadZoneY = 0;\n\n\t\tthis.hitbox = Mask.Pool.alloc (0, x, y, (this.unpressedImg ?? this.unpressedImgInner).width, (this.unpressedImg ?? this.unpressedImgInner).height).visible(false).visibleLock(true).debug(2);\n\t\tthis.addChild(this.hitbox);\n\n\t\tcontainer.add(this.hitbox);\n\t\tcontainer.add(this);\n\n\t\tthis._onChange = null;\n\n\t\tthis.renderWith(this.renderStick);\n\t\tScreenControls.add(this);\n\t},\n\n\t/**\n\t * \tRemoves the button from the screen controls and destroys it.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis._super.Group.__dtor();\n\t\tScreenControls.remove(this);\n\t},\n\n\t/**\n\t * \tChanges the pressed/unpressed images of the outer stick.\n\t * \t!setImage (unpressedImg: Drawable, pressedImg?: Drawable) : Stick;\n\t */\n\tsetImage: function (unpressedImg, pressedImg=null)\n\t{\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg || unpressedImg;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tChanges the pressed/unpressed images of the inner stick.\n\t * \t!setImageInner (unpressedImg: Drawable, pressedImg?: Drawable) : Stick;\n\t */\n\tsetImageInner: function (unpressedImg, pressedImg=null)\n\t{\n\t\tthis.unpressedImgInner = unpressedImg;\n\t\tthis.pressedImgInner = pressedImg || unpressedImg;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the number of angle-steps for the stick.\n\t * \t!setAngleSteps (n: number) : Stick;\n\t */\n\tsetAngleSteps: function (n)\n\t{\n\t\tthis.angleSteps = n;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the number of radius-steps for the stick.\n\t * \t!setRadiusSteps (n: number) : Stick;\n\t */\n\tsetRadiusSteps: function (n)\n\t{\n\t\tthis.radiusSteps = n;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the dead zone values (normalized).\n\t * \t!setDeadZone (deadZoneX: number, deadZoneY: number) : Stick;\n\t */\n\tsetDeadZone: function (deadZoneX, deadZoneY)\n\t{\n\t\tthis.deadZoneX = deadZoneX;\n\t\tthis.deadZoneY = deadZoneY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResets the button to its initial state.\n\t * \t!reset() : void;\n\t */\n\treset: function ()\n\t{\n\t\tthis.dispx = 0;\n\t\tthis.dispy = 0;\n\n\t\tthis.rdirx = 0;\n\t\tthis.rdiry = 0;\n\n\t\tthis.dirx = 0;\n\t\tthis.diry = 0;\n\t\tthis.magnitude = 0;\n\n\t\tif (this._onChange)\n\t\t\tthis._onChange (this.dirx, this.diry, this.magnitude, this.angle, this);\n\t},\n\n\t/**\n\t * \tRenders the stick in the canvas.\n\t * \t!renderStick (g: Canvas) : void;\n\t */\n\trenderStick: function (g, elem, img)\n\t{\n\t\tif (elem.isPressed)\n\t\t{\n\t\t\tif (elem.pressedImg)\n\t\t\t\telem.pressedImg.draw (g, elem.bounds.x1, elem.bounds.y1);\n\n\t\t\tif (elem.pressedImgInner)\n\t\t\t\telem.pressedImgInner.draw (g, elem.bounds.x1 + elem.dispx, elem.bounds.y1 + elem.dispy);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (elem.unpressedImg)\n\t\t\t\telem.unpressedImg.draw (g, elem.bounds.x1, elem.bounds.y1);\n\n\t\t\tif (elem.unpressedImgInner)\n\t\t\t\telem.unpressedImgInner.draw (g, elem.bounds.x1, elem.bounds.y1);\n\t\t}\n\t},\n\n\t/**\n\t * \tButton pointer update event. Not required for the button control.\n\t * \t!pointerUpdate (pointerX: number, pointerY: number, pointer: object) : void;\n\t */\n\tpointerUpdate: function (pointerX, pointerY)\n\t{\n\t\tlet dx, dy;\n\n\t\tdx = pointerX - this.refX;\n\t\tdy = pointerY - this.refY;\n\n\t\tthis.angle = Math.atan2(-dy, dx);\n\t\tthis.radius = Math.sqrt(dx*dx + dy*dy);\n\n\t\tif (this.radius > this.maxRadius)\n\t\t\tthis.radius = this.maxRadius;\n\n\t\tif (this.angleSteps)\n\t\t{\n\t\t\tlet fs = (2*Math.PI / this.angleSteps);\n\t\t\tthis.angle = int((this.angle + Math.PI + fs/2) / fs) * fs - Math.PI;\n\t\t}\n\n\t\tif (this.radiusSteps)\n\t\t{\n\t\t\tlet fs = (this.maxRadius / this.radiusSteps);\n\t\t\tthis.radius = int((this.radius + fs/2) / fs) * fs;\n\t\t}\n\n\t\tthis.rdirx = Math.min(1, Math.max(dx / this.maxRadius, -1));\n\t\tthis.rdiry = Math.min(1, Math.max(dy / this.maxRadius, -1));\n\n\t\tthis.dispx = this.radius * Math.cos(this.angle);\n\t\tthis.dispy = this.radius * -Math.sin(this.angle);\n\n\t\tif (this.radius > 0)\n\t\t{\n\t\t\tthis.dirx = this.dispx / this.radius;\n\t\t\tthis.diry = this.dispy / this.radius;\n\n\t\t\tthis.magnitude = this.radius / this.maxRadius;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.dirx = 0;\n\t\t\tthis.diry = 0;\n\n\t\t\tthis.magnitude = 0;\n\t\t}\n\n\t\tif (Math.abs(this.rdirx) < this.deadZoneX) {\n\t\t\tthis.rdirx = 0;\n\t\t\tthis.dirx = 0;\n\t\t}\n\n\t\tif (Math.abs(this.rdiry) < this.deadZoneY) {\n\t\t\tthis.rdiry = 0;\n\t\t\tthis.diry = 0;\n\t\t}\n\n\t\tif (this._onChange)\n\t\t\tthis._onChange (this.dirx, this.diry, this.magnitude, this.angle, this);\n\t},\n\n\t/**\n\t * \tCalled when the PointerEventType.POINTER_DOWN event starts within the bounding box of the stick.\n\t * \t!pointerActivate (pointer: object) : void;\n\t */\n\tpointerActivate: function (pointer)\n\t{\n\t\tthis.wasPressed = this.isPressed;\n\t\tthis.isPressed = 1;\n\n\t\tthis.refX = pointer.x;\n\t\tthis.refY = pointer.y;\n\n\t\tthis.pointerUpdate(pointer.x, pointer.y);\n\t},\n\n\t/**\n\t * \tCalled when the PointerEventType.POINTER_UP event is fired with the \"_ref\" attribute pointing to this object.\n\t *\t!pointerDeactivate (pointer: object) : void;\n\t */\n\tpointerDeactivate: function (pointer)\n\t{\n\t\tthis.wasPressed = this.isPressed;\n\t\tthis.isPressed = 0;\n\n\t\tthis.reset();\n\t},\n\n\t/**\n\t * \tReturns `true` if the stick contains the specified point.\n\t * \t!containsPoint (x: number, y: number) : boolean;\n\t */\n\tcontainsPoint: function(x, y)\n\t{\n\t\tif (!this.visible())\n\t\t\treturn false;\n\n\t\treturn this.hitbox.bounds.containsPoint(x, y);\n\t},\n\n\t/**\n\t * \tSets the direction of the stick, the provided deltas should be normalized in the \\[-1, 1\\] range.\n\t * \t!setDirection (dx: number, dy: number, deadZoneX?: number, deadZoneY?: number) : boolean;\n\t */\n\tsetDirection: function (dx, dy, deadZoneX=0.10, deadZoneY=0.10)\n\t{\n\t\tif (Math.abs(dx) < deadZoneX) dx = 0;\n\t\tif (Math.abs(dy) < deadZoneY) dy = 0;\n\n\t\tthis.wasPressed = this.isPressed;\n\t\tthis.isPressed = dx == 0 && dy == 0 ? 0 : 1;\n\n\t\tthis.pointerUpdate (this.bounds.cx + dx*this.maxRadius, this.bounds.cy + dy*this.maxRadius);\n\t\treturn false;\n\t},\n\n\t/**\n\t * \tSaves the current state of the stick in the f* variables (fdirx, fdiry, etc). When the `lastValid` parameter is true, the values will\n\t * \tbe saved on each field only if the current value is not zero.\n\t * \t!freezeState (lastValid?: boolean) : Stick;\n\t */\n\tfreezeState: function (lastValid=false)\n\t{\n\t\tthis.frdirx = lastValid ? (this.rdirx != 0 ? this.rdirx : this.frdirx) : this.rdirx;\n\t\tthis.frdiry = lastValid ? (this.rdiry != 0 ? this.rdiry : this.frdiry) : this.rdiry;\n\t\tthis.fdirx = lastValid ? (this.dirx != 0 ? this.dirx : this.fdirx) : this.dirx;\n\t\tthis.fdiry = lastValid ? (this.diry != 0 ? this.diry : this.fdiry) : this.diry;\n\t\tthis.fmagnitude = lastValid ? (this.magnitude != 0 ? this.magnitude : this.fmagnitude) : this.magnitude;\n\t\tthis.fangle = lastValid ? (this.angle != 0 ? this.angle : this.fangle) : this.angle;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tKey down event, handles the keys that control the direction of the stick.\n\t * \t!keyDown (keyCode: KeyCode, keyArgs: object) : boolean|null;\n\t */\n\tkeyDown: function (keyCode, keyArgs)\n\t{\n\t\tlet dx = 0;\n\t\tlet dy = 0;\n\n\t\tif (keyArgs[KeyCode.UP] === true) dy = -this.maxRadius;\n\t\tif (keyArgs[KeyCode.LEFT] === true) dx = -this.maxRadius;\n\t\tif (keyArgs[KeyCode.DOWN] === true) dy = this.maxRadius;\n\t\tif (keyArgs[KeyCode.RIGHT] === true) dx = this.maxRadius;\n\n\t\tif (keyCode === KeyCode.UP || keyCode === KeyCode.LEFT || keyCode === KeyCode.DOWN || keyCode === KeyCode.RIGHT)\n\t\t{\n\t\t\tdx = this.bounds.cx + dx;\n\t\t\tdy = this.bounds.cy + dy;\n\n\t\t\tthis.wasPressed = this.isPressed;\n\t\t\tthis.isPressed = 1;\n\n\t\t\tthis.pointerUpdate (dx, dy);\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * \tKey up event, handles the keys that control the direction of the stick.\n\t * \t!keyUp (keyCode: KeyCode, keyArgs: object) : boolean|null;\n\t */\n\tkeyUp: function (keyCode, keyArgs)\n\t{\n\t\tlet dx = 0;\n\t\tlet dy = 0;\n\n\t\tif (keyArgs[KeyCode.UP] === true) dy = -this.maxRadius;\n\t\tif (keyArgs[KeyCode.LEFT] === true) dx = -this.maxRadius;\n\t\tif (keyArgs[KeyCode.DOWN] === true) dy = this.maxRadius;\n\t\tif (keyArgs[KeyCode.RIGHT] === true) dx = this.maxRadius;\n\n\t\tif (keyCode === KeyCode.UP || keyCode === KeyCode.LEFT || keyCode === KeyCode.DOWN || keyCode === KeyCode.RIGHT)\n\t\t{\n\t\t\tthis.pointerUpdate (this.bounds.cx + dx, this.bounds.cy + dy);\n\n\t\t\tif (dx === 0 && dy === 0)\n\t\t\t{\n\t\t\t\tthis.wasPressed = this.isPressed;\n\t\t\t\tthis.isPressed = 0;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * \tSets the handler for the on-change event. Executed after any change in the direction of the stick.\n\t * \t!onChange (callback: (dirx: number, diry: number, magnitude: number, angle: number, stick: Stick) => void) : Stick;\n\t */\n\tonChange: function (callback)\n\t{\n\t\tthis._onChange = callback;\n\t\treturn this;\n\t}\n});\n","/*\n**\tfxl/world.js\n**\n**\tCopyright (c) 2016-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport System from '../system/system.js';\nimport Scene from '../flow/scene.js';\nimport Viewport from '../flow/viewport.js';\nimport Bounds2 from '../math/bounds2.js';\nimport GridContainer from '../flow/grid-container.js';\nimport Element from '../flow/element.js';\nimport Label from '../flow/label.js';\nimport Group from '../flow/group.js';\nimport Updater from '../flow/updater.js';\nimport SimpleContainer from '../flow/simple-container.js';\nimport Mask from '../flow/mask.js';\nimport system from './system.js';\nimport globals from '../system/globals.js';\n\n//!/**\n//! * \tWorld system allows to manage scenes, containers, viewports and display elements.\n//! */\n\n//!class world\n\nconst world =\n{\n\t/**\n\t * World scene constants.\n\t *\n\t * !static readonly SCENE_MAIN: number;\n\t * !static readonly SCENE_HUD: number;\n\t */\n\tSCENE_MAIN: 0,\n\tSCENE_HUD: 1,\n\n\t/**\n\t * Default layers for the SCENE_MAIN scene.\n\t *\n\t * !static readonly LAYER_BG0: number;\n\t * !static readonly LAYER_BG1: number;\n\t * !static readonly LAYER_BG2: number;\n\t * !static readonly LAYER_BG3: number;\n\t * !static readonly LAYER_BG4: number;\n\t * !static readonly LAYER_MAIN: number;\n\t * !static readonly LAYER_FG0: number;\n\t * !static readonly LAYER_FG1: number;\n\t * !static readonly LAYER_FG2: number;\n\t * !static readonly LAYER_FG3: number;\n\t * !static readonly LAYER_FG4: number;\n\t * !static readonly LAYER_MASK: number;\n\t */\n\tLAYER_BG0: 0,\n\tLAYER_BG1: 1,\n\tLAYER_BG2: 2,\n\tLAYER_BG3: 3,\n\tLAYER_BG4: 4,\n\tLAYER_MAIN: 5,\n\tLAYER_FG0: 6,\n\tLAYER_FG1: 7,\n\tLAYER_FG2: 8,\n\tLAYER_FG3: 9,\n\tLAYER_FG4: 10,\n\tLAYER_MASK: 11,\n\n\t/**\n\t * Default layers for the SCENE_HUD scene.\n\t *\n\t * !static readonly LAYER_HUD_BG0: number;\n\t * !static readonly LAYER_HUD_BG1: number;\n\t * !static readonly LAYER_HUD_BG2: number;\n\t * !static readonly LAYER_HUD_MAIN: number;\n\t * !static readonly LAYER_HUD_FG0: number;\n\t * !static readonly LAYER_HUD_FG1: number;\n\t * !static readonly LAYER_HUD_FG2: number;\n\t */\n \tLAYER_HUD_BG0: 0,\n\tLAYER_HUD_BG1: 1,\n\tLAYER_HUD_BG2: 2,\n\tLAYER_HUD_MAIN: 3,\n\tLAYER_HUD_FG0: 4,\n\tLAYER_HUD_FG1: 5,\n\tLAYER_HUD_FG2: 6,\n\n\t/**\n\t *\tRegistered scenes.\n\t */\n\t_scenes: [],\n\n\t/**\n\t * Active scene set by `selectScene`.\n\t * !static activeScene: Scene;\n\t */\n\tactiveScene: null,\n\n\t/**\n\t *\tRegistered viewports.\n\t */\n\t_viewports: [],\n\n\t/**\n\t * Active viewport set by `selectViewport`.\n\t * !static activeViewport: Viewport;\n\t */\n\tactiveViewport: null,\n\n\t/**\n\t * Active container set by `selectContainer`.\n\t * !static activeContainer: Container;\n\t */\n\tactiveContainer: null,\n\n\t/**\n\t * Currently active group (set by `createGroup`).\n\t * !static activeGroup: Group;\n\t */\n\tactiveGroup: null,\n\n\t/**\n\t * Last used group (set by `endGroup`).\n\t * !static lastGroup: Group;\n\t */\n\tlastGroup: null,\n\n\t/**\n\t * Last element created by `createElement`, or `createLabel`.\n\t * !static lastElement: Element;\n\t */\n\tlastElement: null,\n\n\t/**\n\t * Dimensions of the world.\n\t * !static readonly bounds: Bounds2;\n\t */\n\tbounds: Bounds2.Pool.alloc(),\n\n\t/**\n\t * Initializes the world with the default scenes, viewports and layers.\n\t * !static init (worldWidth?: number, worldHeight?: number, divisorX?: number, divisorY?: number) : void;\n\t */\n\tinit: function (worldWidth=32768, worldHeight=32768, divisorX=null, divisorY=null)\n\t{\n\t\tif (divisorX === null)\n\t\t\tdivisorX = Math.max(worldWidth, worldHeight) / 512;\n\n\t\tif (divisorX < 16)\n\t\t\tdivisorX = 16;\n\n\t\tif (divisorY !== null && divisorY < 16)\n\t\t\tdivisorY = 16;\n\n\t\tthis.bounds.zero().resize(worldWidth, worldHeight);\n\n\t\tthis.createScene(world.SCENE_MAIN);\n\t\tthis.setContainer(world.LAYER_BG0, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_BG1, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_BG2, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_BG3, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_BG4, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_MAIN, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_FG0, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_FG1, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_FG2, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_FG3, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_FG4, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\n\t\tthis.setContainer(world.LAYER_MASK, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.getContainer(world.LAYER_MASK).visible(false);\n\t\tthis.createViewport(0);\n\n\t\tthis.createScene(world.SCENE_HUD);\n\t\tthis.setContainer(world.LAYER_HUD_BG0, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_BG1, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_BG2, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_MAIN, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_FG0, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_FG1, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_FG2, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t},\n\n\t/**\n\t * Creates a scene at the specified index and automatically selects it.\n\t * !static createScene (index: number) : void;\n\t */\n\tcreateScene: function (index)\n\t{\n\t\tif (this._scenes[index])\n\t\t{\n\t\t\tSystem.queueRemove(this._scenes[index]);\n\t\t\tglobal.dispose(this._scenes[index]);\n\t\t}\n\n\t\tthis._scenes[index] = new Scene(index);\n\t\tSystem.queueAdd(this._scenes[index]);\n\n\t\tthis.selectScene(index);\n\t},\n\n\t/**\n\t * Returns the scene at the specified index (or the active scene if no index provided).\n\t * !static getScene (index?: number) : Scene;\n\t */\n\tgetScene: function (index=null)\n\t{\n\t\tif (index === null)\n\t\t\treturn this.activeScene;\n\n\t\tif (index < 0 || index >= this._scenes.length)\n\t\t\treturn null;\n\n\t\treturn this._scenes[index];\n\t},\n\n\t/**\n\t * Selects the active scene for subsequence scene-level operations.\n\t * !static selectScene (index: number) : boolean;\n\t */\n\tselectScene: function (index)\n\t{\n\t\tif (index < 0 || index >= this._scenes.length || !this._scenes[index])\n\t\t\treturn false;\n\n\t\tthis.activeScene = this._scenes[index];\n\t\tthis.activeContainer = null;\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * Creates a viewport at the specified index, attaches it to the active scene and selects it. Use this only after attaching all\n\t * containers to the scene or the `maxWidth` and `maxHeight` properties of the scene will not be properly set yet.\n\t *\n\t * !static createViewport (index: number) : void;\n\t */\n\tcreateViewport: function (index)\n\t{\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('createViewport: use `selectScene` first to select the active scene.');\n\n\t\tif (this._viewports[index])\n\t\t{\n\t\t\tglobal.dispose(this._viewports[index]);\n\t\t\tthis.activeScene.setViewport(index, null);\n\t\t}\n\n\t\tthis._viewports[index] = new Viewport(\n\t\t\t0, 0,\n\t\t\tsystem.screenWidth, system.screenHeight,\n\t\t\tthis.activeScene.maxWidth, this.activeScene.maxHeight\n\t\t);\n\n\t\tthis.activeScene.setViewport(index, this._viewports[index]);\n\n\t\tthis.selectViewport(index);\n\t},\n\n\t/**\n\t * Returns a viewport given its index (or the active viewport if no index provided).\n\t * !static getViewport (index?: number) : Viewport;\n\t */\n\tgetViewport: function (index=null)\n\t{\n\t\tif (index === null)\n\t\t\treturn this.activeViewport;\n\n\t\tif (index < 0 || index >= this._viewports.length)\n\t\t\treturn null;\n\n\t\treturn this._viewports[index];\n\t},\n\n\t/**\n\t * Selects the active viewport.\n\t * !static selectViewport (index: number) : boolean;\n\t */\n\tselectViewport: function (index)\n\t{\n\t\tif (index < 0 || index >= this._viewports.length || !this._viewports[index])\n\t\t\treturn false;\n\n\t\tthis.activeViewport = this._viewports[index];\n\t\treturn true;\n\t},\n\n\t/**\n\t * Sets a container in the active scene at the specified index and returns it.\n\t * !static setContainer (index: number, container: Container) : Container;\n\t */\n\tsetContainer: function (index, container)\n\t{\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('setContainer: use `selectScene` first to select the active scene.');\n\n\t\tthis.activeScene.setContainer (index, container);\n\t\treturn container;\n\t},\n\n\t/**\n\t * Returns the container at the specified index in the active scene (or the active container if no index provided).\n\t * !static getContainer (index?: number) : Container;\n\t */\n\tgetContainer: function (index=null, throwErrors=false)\n\t{\n\t\tif (index === null)\n\t\t{\n\t\t\tif (this.activeContainer === null && throwErrors)\n\t\t\t\tthrow new Error ('getContainer: container index not specified and default container not set.');\n\n\t\t\treturn this.activeContainer;\n\t\t}\n\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('getContainer: use `selectScene` first to select the active scene.');\n\n\t\tlet container = this.activeScene.getContainer(index);\n\t\tif (container === null && throwErrors)\n\t\t\tthrow new Error ('getContainer: container index out of bounds.');\n\n\t\treturn container;\n\t},\n\n\t/**\n\t * Selects the active container.\n\t * !static selectContainer (index: number) : boolean;\n\t */\n\tselectContainer: function (index)\n\t{\n\t\tthis.activeContainer = this.getContainer(index, true);\n\t\treturn this.activeContainer !== null;\n\t},\n\n\t/**\n\t * Changes the visibility of the LAYER_MASK to enable (or disable) mask bounds rendering.\n\t * @param {boolean} value\n\t * @param {boolean} allMasks If set to `false` only masks having `debugBounds` to non-false will be drawn.\n\t * !static showMasks (value: boolean, allMasks?: boolean) : void;\n\t */\n\tshowMasks: function (value, allMasks=true)\n\t{\n\t\tworld.getScene(world.SCENE_MAIN).getContainer(world.LAYER_MASK).visible(value);\n\t\tglobals.debugMasks = allMasks;\n\t},\n\n\t/**\n\t * Creates a group in the active scene and selects it as the active group.\n\t * !static createGroup (id?: string) : Group;\n\t */\n\tcreateGroup: function(id=null)\n\t{\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('createGroup: use selectScene first to select the active scene.');\n\n\t\tthis.activeGroup = Group.Pool.alloc(id);\n\t\tthis.activeScene.addGroup(this.activeGroup);\n\n\t\treturn this.activeGroup;\n\t},\n\n\t/**\n\t * If coordinates are provided the group will be translated to the specified position. It will then set `lastGroup`, and nullify `activeGroup`.\n\t * !static endGroup (x?: number, y?: number) : Group;\n\t */\n\tendGroup: function(x=null, y=null)\n\t{\n\t\tif (x !== null && y !== null)\n\t\t\tthis.activeGroup.translate(x, y);\n\n\t\tthis.lastGroup = this.activeGroup;\n\t\tthis.activeGroup = null;\n\n\t\treturn this.lastGroup.sync();\n\t},\n\n\t/**\n\t * Creates a named Element and adds it to the specified container (or the active one) in the active scene.\n\t * If a group is active, the element will be attached to the group.\n\t * \n\t * !static createElement (id: string, x: number, y: number, img?: Drawable, containerIndex?: number) : Element;\n\t */\n\t/**\n\t * Creates an Element and adds it to the specified container (or the active one) in the active scene.\n\t * If a group is active, the element will be attached to the group.\n\t * \n\t * !static createElement (x: number, y: number, img?: Drawable, containerIndex?: number) : Element;\n\t */\n\tcreateElement: function (id, x, y, img=null, containerIndex=null)\n\t{\n\t\tif (typeof(id) !== 'string')\n\t\t{\n\t\t\tcontainerIndex = img;\n\t\t\timg = y;\n\t\t\ty = x;\n\t\t\tx = id;\n\t\t\tid = null;\n\t\t}\n\n\t\tlet container = this.getContainer(containerIndex);\n\n\t\tlet elem = Element.Pool.alloc(x, y, img);\n\t\tcontainer.add(elem.setId(id));\n\n\t\tif (this.activeGroup !== null)\n\t\t\tthis.activeGroup.addChild(elem);\n\n\t\tthis.lastElement = elem;\n\t\treturn elem;\n\t},\n\n\t/**\n\t * Creates a named mask and adds it to the specified container or LAYER_MASK if none provided.\n\t * If a group is active, the mask will be attached to the group.\n\t * \n\t * !static createMask (id: string, type: number, x?: number, y?: number, width?: number, height?: number, containerIndex?: number) : Mask;\n\t */\n\tcreateMask: function (id, type, x=null, y=null, width=null, height=null, containerIndex=null)\n\t{\n\t\tlet container = this.getContainer(containerIndex || world.LAYER_MASK);\n\n\t\tif (x === null)\n\t\t{\n\t\t\tif (this.activeGroup === null)\n\t\t\t\tthrow new Error ('createMask: create a group first to use default masks.');\n\n\t\t\tx = this.activeGroup.bounds.x1;\n\t\t\ty = this.activeGroup.bounds.y1;\n\t\t\twidth = this.activeGroup.bounds.width();\n\t\t\theight = this.activeGroup.bounds.height();\n\t\t}\n\n\t\tlet mask = Mask.Pool.alloc(type, x, y, width, height);\n\t\tcontainer.add(mask.setId(id));\n\n\t\tif (this.activeGroup !== null)\n\t\t\tthis.activeGroup.addChild(mask);\n\n\t\treturn mask;\n\t},\n\n\t/**\n\t * Creates a named label element and adds it to the specified container (or the active one) in the active scene.\n\t * If a group is active, the label element will be attached to the group.\n\t * \n\t * !static createLabel (id: string, x: number, y: number, font: object, text: string, containerIndex?: number) : Label;\n\t */\n\t/**\n\t * Creates a label element and adds it to the specified container (or the active one) in the active scene.\n\t * If a group is active, the label element will be attached to the group.\n\t * \n\t * !static createLabel (x: number, y: number, font: object, text: string, containerIndex?: number) : Label;\n\t */\n\tcreateLabel: function (id, x, y, font, text, containerIndex=null)\n\t{\n\t\tif (typeof(id) !== 'string')\n\t\t{\n\t\t\tcontainerIndex = text;\n\t\t\ttext = font;\n\t\t\tfont = y;\n\t\t\ty = x;\n\t\t\tx = id;\n\t\t\tid = null;\n\t\t}\n\n\t\tlet container = this.getContainer(containerIndex);\n\n\t\tlet elem = Label.Pool.alloc(x, y, font, text);\n\t\tcontainer.add(elem.setId(id));\n\n\t\tif (this.activeGroup !== null)\n\t\t\tthis.activeGroup.addChild(elem);\n\n\t\tthis.lastElement = elem;\n\t\treturn elem;\n\t},\n\n\t/**\n\t * Creates a new updater, attaches it to the active scene and returns it.\n\t * !static createUpdater (update?: (elem: Element, dt: number, context: object) => boolean, context?: object) : Updater;\n\t */\n\tcreateUpdater: function (update=null, context=null)\n\t{\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('createUpdater: use selectScene first to select the active scene.');\n\n\t\treturn new Updater (this.activeScene, update, context);\n\t}\n};\n\n//!/class\n\nexport default world;\n","\n//!/**\n//! * Registered resources. Initially these are resource descriptors, but after a call to `res.load` these will be fully loaded resources.\n//! */\n//:const r : { \\[key: string\\]: any };\n\nconst r = {\n};\n\nexport default r;\n","\nimport Resources from '../resources/resources.js';\n\nimport r from './r.js';\n\n/**\n * \tResource manager allows to specify resource descriptors to load them.\n */\n\n//!class res\n\nconst res =\n{\n\t/**\n\t * Configures the resources object with the specified options.\n\t * !static config (options: Resources.ConfigOptions) : void;\n\t */\n\tconfig: function (opts)\n\t{\n\t\tResources.config(opts);\n\t},\n\n\t/**\n\t * \tLoads all registered resources that have not been loaded yet.\n\t * \t!static load (progressCallback?: (level: number, resourceName: string) => void) : Promise<void>;\n\t */\n\tload: function(progressCallback=null)\n\t{\n\t\treturn new Promise (function (resolve, reject)\n\t\t{\n\t\t\tResources.load (r,\n\t\t\t\tfunction (index, total, value, name) {\n\t\t\t\t\tif (progressCallback) progressCallback(value, name);\n\t\t\t\t},\n\t\t\t\tfunction () {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t},\n\n\t/**\n\t * \tReturns a resource given its identifier.\n\t * \t@param id - Resource identifier.\n\t * \t!static get (id: string) : object;\n\t */\n\tget: function (id)\n\t{\n\t\treturn r[id];\n\t},\n\n\t/**\n\t * \tChecks if the ID exists in the fxl `r` map, throws an error if it does.\n\t */\n\t__resIdMustNotExist: function (id)\n\t{\n\t\tif (id in r) throw new Error ('Resource identifier `' + id + '` is already in use');\n\t},\n\n\t/**\n\t * \tRegisters a solid-color resource.\n\t * \t@param id - Resource identifier.\n\t * \n\t * \t!static color (id: string, color: string, width: number, height: number) : object;\n\t */\n\tcolor: function (id, color, width, height)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'object', wrapper: 'Custom', color: color, width: width, height: height };\n\t},\n\n\t/**\n\t * \tRegisters a custom drawable resource.\n\t * \t@param id - Resource identifier.\n\t * \n\t * \t!static custom (id: string, width: number, height: number, drawFunction: (g: Canvas) => void) : object;\n\t */\n\tcustom: function (id, width, height, drawFunction, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'object', wrapper: 'Custom', width: width, height: height, draw: drawFunction, ...opts };\n\t},\n\n\t/**\n\t * \tRegisters an image resource.\n\t * \t@param id - Resource identifier.\n\t * \n\t * \t!static image (id: string, path: string, opts?: object) : object;\n\t */\n\timage: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'image', wrapper: 'Drawable', src: path, ...opts };\n\t},\n\n\t/**\n\t * \tRegisters a multi image resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file. Ensure to add the \"#\" marks to replace the file index (i.e. \"image-##.png\").\n\t * \t@param count - Number of images to load (from 0 to count-1).\n\t * \n\t * \t!static images (id: string, path: string, count: number, frameWidth?: number, frameHeight?: number, optsA?: object, optsB?: object) : object;\n\t */\n\timages: function (id, path, count, frameWidth=null, frameHeight=null, optsA=null, optsB=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\t\treturn r[id] = { type: 'images', wrapper: 'Spritesheet', src: path, count: count, width: frameWidth, height: frameHeight,\n\t\t\tconfig: {\n\t\t\t\tframeWidth: frameWidth, frameHeight: frameHeight, ...optsA\n\t\t\t},\n\t\t\t...optsB\n\t\t};\n\t},\n\n\t/**\n\t * \tRegisters an spritesheet resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static spritesheet (id: string, path: string, frameWidth: number, frameHeight: number, numFrames?: number, optsA?: object, optsB?: object) : object;\n\t */\n\tspritesheet: function (id, path, frameWidth, frameHeight, numFrames=0, optsA=null, optsB=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'image', wrapper: 'Spritesheet', src: path,\n\t\t\tconfig: {\n\t\t\t\tframeWidth: frameWidth, frameHeight: frameHeight, numFrames: numFrames, ...optsA\n\t\t\t},\n\t\t\t...optsB\n\t\t};\n\t},\n\n\t/**\n\t * \tRegisters a spritesheet animation resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static animation (id: string, path: string, frameWidth: number, frameHeight: number, numFrames?: number, configOptions?: object, resOptions?: object) : object;\n\t */\n\tanimation: function (id, path, frameWidth, frameHeight, numFrames=null, configOptions=null, resOptions=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'image', wrapper: 'SpritesheetAnimation', src: path,\n\t\t\tconfig: {\n\t\t\t\tframeWidth: frameWidth, frameHeight: frameHeight, numFrames: numFrames, ...configOptions\n\t\t\t},\n\n\t\t\tanim: {\n\t\t\t\tdef: null, fps: 15, seq: { }, trans: { }\n\t\t\t},\n\n\t\t\t...resOptions,\n\n\t\t\tfps: function(value) {\n\t\t\t\tthis.anim.fps = value;\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\tseq: function(id, loop, group, fps=null)\n\t\t\t{\n\t\t\t\tthis.anim.seq[id] = { loop: loop, group: group };\n\n\t\t\t\tif (fps !== null)\n\t\t\t\t\tthis.anim.seq[id].fps = fps;\n\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\ttrans: function(srcSeq, dstSeq, group)\n\t\t\t{\n\t\t\t\tif (!(srcSeq in this.anim.trans))\n\t\t\t\t\tthis.anim.trans[srcSeq] = { };\n\n\t\t\t\tthis.anim.trans[srcSeq][dstSeq] = group;\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\tdef: function(value) {\n\t\t\t\tthis.anim.def = value;\n\t\t\t\treturn this;\n\t\t\t}\n\t\t};\n\t},\n\n\t/**\n\t * \tRegisters a spritefont animation resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static spritefont (id: string, path: string, charWidth: number, charHeight: number, charset: string, optsA?: object, optsB?: object) : object;\n\t */\n\tspritefont: function (id, path, charWidth, charHeight, charset, optsA=null, optsB=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\t\t\n\t\treturn r[id] = { type: 'image', wrapper: 'SpriteFont', src: path,\n\t\t\tfont: {\n\t\t\t\tcharWidth: charWidth, charHeight: charHeight, charset: charset, ...optsA\n\t\t\t},\n\t\t\t...optsB\n\t\t};\n\t},\n\n\t/**\n\t * \tRegisters a JSON data resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static json (id: string, path: string, opts?: object) : object;\n\t */\n\tjson: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'json', src: path, ...opts };\n\t},\n\n\t/**\n\t * \tRegisters a binary data resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static data (id: string, path: string, opts?: object) : object;\n\t */\n\tdata: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'data', src: path, ...opts };\n\t},\n\n\t/**\n\t * \tRegisters a text data resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static text (id: string, path: string, opts?: object) : object;\n\t */\n\ttext: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'text', src: path, ...opts };\n\t},\n\n\t/**\n\t * \tRegisters a sound effect audio resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static sfx (id: string, path: string, opts?: object) : object;\n\t */\n\tsfx: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'audio', wrapper: 'Sound', src: path, track: 'sfx', ...opts };\n\t},\n\n\t/**\n\t * \tRegisters a multi sound effect audio resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file. Ensure to add the \"#\" marks to replace the file index (i.e. \"sound-##.ogg\").\n\t * \t@param count - Number of sounds to load (from 0 to count-1).\n\t * \t@param mode - Playback mode, can be `sequential` (default) or `random`.\n\t * \n\t * \t!static sfxm (id: string, path: string, count: number, mode?: string) : object;\n\t */\n\tsfxm: function (id, path, count, mode='sequential')\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\t\treturn r[id] = { type: 'audios', wrapper: 'SoundArray', src: path, count: count, track: 'sfx', mode: mode };\n\t},\n\n\t/**\n\t * \tRegisters an music audio resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static music (id: string, path: string) : object;\n\t */\n\tmusic: function (id, path)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'audio', wrapper: 'Sound', src: path, track: 'music' };\n\t}\n};\n\nexport default res;\n","/*\n**\tfxl/gamepad.js\n**\n**\tCopyright (c) 2016-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Stick from '../flow/stick.js';\nimport Button from '../flow/button.js';\n\n//![import '../flow/stick.js']\n//![import '../flow/button.js']\n\n/**\n * Gamepads are input objects that allow sticks and buttons to be added to it.\n */\n\n//!class Gamepad\n\nconst Gamepad = Class.extend\n({\n\t/**\n\t * Contains the sticks of the gamepad.\n\t * !readonly sticks: { \\[key:string\\]: Stick };\n\t */\n\tsticks: null,\n\n\t/**\n\t * Contains the buttons of the gamepad.\n\t * !readonly buttons: { \\[key:string\\]: Button };\n\t */\n\tbuttons: null,\n\n\t/**\n\t * World scene where the container is defined.\n\t */\n\tscene: null,\n\n\t/**\n\t * Container where the gamepad controls will be created.\n\t */\n\tcontainer: null,\n\n\t/**\n\t * Indicates the visible state of the gamepad.\n\t */\n\t_visible: true,\n\n\t/**\n\t * Constructs a new gamepad object.\n\t * !constructor (scene: Scene, containerIndex: number);\n\t */\n\t__ctor: function(scene, containerIndex)\n\t{\n\t\tthis.sticks = { };\n\t\tthis.buttons = { };\n\n\t\tthis.scene = scene;\n\t\tthis.layer = scene.getContainer(containerIndex);\n\t},\n\n\t/**\n\t * Creates a new stick control and adds it to the gamepad.\n\t * !addStick (id: string, x: number, y: number, outerDrawable: Drawable, innerDrawable: Drawable, maxRadius?: number|0) : Stick;\n\t */\n\taddStick: function (id, x, y, outerDrawable, innerDrawable, maxRadius=0)\n\t{\n\t\tif (maxRadius == 0)\n\t\t\tmaxRadius = outerDrawable.width - innerDrawable.width;\n\n\t\tlet stick = new Stick (this.layer, x, y, maxRadius, outerDrawable, innerDrawable);\n\n\t\tthis.sticks[id] = stick;\n\t\tthis[id] = stick;\n\n\t\treturn stick;\n\t},\n\n\t/**\n\t * Creates a new button control and adds it to the gamepad.\n\t * !addButton (id: string, x: number, y: number, unpressedDrawable?: Drawable|null, pressedDrawable?: Drawable|null) : Button;\n\t */\n\taddButton: function (id, x, y, unpressedDrawable=null, pressedDrawable=null)\n\t{\n\t\tlet button = new Button (this.layer, x, y, unpressedDrawable, pressedDrawable);\n\n\t\tthis.buttons[id] = button;\n\t\tthis[id] = button;\n\n\t\treturn button;\n\t},\n\n\t/**\n\t * Returns the `visible` property of the gamepad.\n\t * !visible() : boolean;\n\t */\n\t/**\n\t * Sets the `visible` property of the gamepad.\n\t * !visible (value: boolean) : Gamepad;\n\t */\n\tvisible: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._visible;\n\n\t\tthis._visible = value;\n\n\t\tfor (let i in this.sticks)\n\t\t\tthis.sticks[i].visible(value);\n\n\t\tfor (let i in this.buttons)\n\t\t\tthis.buttons[i].visible(value);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the `visible` property of all masks to the specified value.\n\t * !showMasks (value: boolean) : Gamepad;\n\t */\n\tshowMasks: function (value)\n\t{\n\t\tfor (let i in this.sticks)\n\t\t\tthis.sticks[i].hitbox.visible(value, true);\n\n\t\tfor (let i in this.buttons)\n\t\t\tthis.buttons[i].hitbox.visible(value, true);\n\n\t\treturn this;\n\t}\n});\n\n//!/class\n\nexport default Gamepad;\n","/*\n**\tfxl/input.js\n**\n**\tCopyright (c) 2016-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport PointerHandler from '../flow/pointer-handler.js';\nimport world from './world.js';\nimport system from './system.js';\nimport Gamepad from './gamepad.js';\n\n//!namespace input\n//:[import './gamepad.js']\n//!/namespace\n\n//!class input\n\n/**\n *\tInput system allows to create gamepads and manage the system cursor.\n */\n\nconst input =\n{\n\t/**\n\t * Registered gamepads.\n\t */\n\t_gamepads: [],\n\n\t/**\n\t * Currently active gamepad.\n\t * !static activeGamepad: input.Gamepad;\n\t */\n\tactiveGamepad: null,\n\n\t/**\n\t * Last created button.\n\t * !static lastButton: Button;\n\t */\n\tlastButton: null,\n\n\t/**\n\t * Last created stick.\n\t * !static lastStick: Stick;\n\t */\n\tlastStick: null,\n\n\t/**\n\t * Cursor object, used to control the state of the single-cursor input.\n\t */\n\tcursor:\n\t{\n\t\t/**\n\t\t * Indicates if the single-cursor input has been enabled.\n\t\t */\n\t\t_enabled: null,\n\n\t\t/**\n\t\t * Handler callback for cursor events.\n\t\t */\n\t\t_handler: null,\n\n\t\t/**\n\t\t * Cursor element used when the single-cursor input is enabled.\n\t\t */\n\t\t_element: null,\n\n\t\t/**\n\t\t * Pointer state related to the cursor when single-cursor input is enabled.\n\t\t */\n\t\tpointer: null,\n\n\t\t/**\n\t\t * Returns the element used for single-cursor input.\n\t\t */\n\t\telement: function (elem=false)\n\t\t{\n\t\t\tif (elem === false)\n\t\t\t\treturn this._element;\n\n\t\t\tthis._element = elem;\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Hides or shows the native cursor.\n\t\t */\n\t\tnative: function (value)\n\t\t{\n\t\t\tif (!value && system.renderer.elem.style.cursor !== 'none')\n\t\t\t\tsystem.renderer.elem.style.cursor = 'none';\n\t\t\telse if (value && system.renderer.elem.style.cursor === 'none')\n\t\t\t\tsystem.renderer.elem.style.removeProperty('cursor');\n\t\t},\n\n\t\t/**\n\t\t * Enables or disables the single-cursor input.\n\t\t */\n\t\tenabled: function (value=null)\n\t\t{\n\t\t\tif (value === null)\n\t\t\t\treturn this._enabled;\n\n\t\t\tif (this._enabled === value)\n\t\t\t\treturn this;\n\n\t\t\tthis._enabled = value;\n\n\t\t\tif (value === true)\n\t\t\t{\n\t\t\t\tif (this._element !== null)\n\t\t\t\t\tsystem.renderer.elem.style.cursor = 'none';\n\n\t\t\t\tPointerHandler.register(this.pointerHandler);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsystem.renderer.elem.style.removeProperty('cursor');\n\t\t\t\tPointerHandler.unregister(this.pointerHandler);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Sets the callback to execute when a cursor event happens.\n\t\t * @param { (action:number, pointer:object) => void } callback\n\t\t */\n\t\thandler: function (callback)\n\t\t{\n\t\t\tthis._handler = callback;\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Pointer event handler for single-cursor input.\n\t\t */\n\t\tpointerHandler:\n\t\t{\n\t\t\tpriority: 50,\n\n\t\t\tonPointerEvent: function (action, pointer, pointers)\n\t\t\t{\n\t\t\t\tif (!input.cursor._enabled)\n\t\t\t\t\treturn;\n\n\t\t\t\tinput.cursor.pointer = pointer;\n\n\t\t\t\tif (input.cursor._element !== null)\n\t\t\t\t\tinput.cursor._element.setPosition(pointer.x, pointer.y);\n\n\t\t\t\tif (input.cursor._handler !== null)\n\t\t\t\t\tinput.cursor._handler (action, pointer);\n\t\t\t},\n\t\t},\n\t},\n\n\t/**\n\t * Creates a gamepad object and attaches it to the SCENE_HUD in the specified layer (defaults to LAYER_HUD_MAIN).\n\t * !static createGamepad (index: number, layerIndex?: number) : input.Gamepad;\n\t */\n\tcreateGamepad: function (index, layerIndex=null)\n\t{\n\t\tlayerIndex = layerIndex !== null ? layerIndex : world.LAYER_HUD_MAIN;\n\n\t\tworld.selectScene(world.SCENE_HUD);\n\t\tworld.selectContainer(layerIndex);\n\n\t\tthis._gamepads[index] = new Gamepad (world.activeScene, layerIndex);\n\t\tthis.selectGamepad(index);\n\n\t\treturn this.activeGamepad;\n\t},\n\n\t/**\n\t * Returns a gamepad given its index.\n\t * !static getGamepad (index: number) : input.Gamepad;\n\t */\n\tgetGamepad: function (index)\n\t{\n\t\tif (index < 0 || index >= this._gamepads.length)\n\t\t\treturn null;\n\n\t\treturn this._gamepads[index] || null;\n\t},\n\n\t/**\n\t * Selects the active gamepad for subsequent gamepad-level operations.\n\t * !static selectGamepad (index: number) : boolean;\n\t */\n\tselectGamepad: function (index)\n\t{\n\t\tthis.activeGamepad = this.getGamepad(index);\n\t\treturn true;\n\t},\n\n\t/**\n\t * Sets the value of `debugBounds` on the specified gamepad. If index is `null`, all gamepads will be selected.\n\t * !static debugGamepad (index: number, value: boolean) : void;\n\t */\n\tdebugGamepad: function (index, value)\n\t{\n\t\tif (index === null)\n\t\t{\n\t\t\tfor (let i = 0; i < this._gamepads.length; i++)\n\t\t\t{\n\t\t\t\tif (!this._gamepads[i])\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis.debugGamepad(i, value);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis._gamepads[index].debug(value);\n\t},\n\n\t/**\n\t * Adds an stick control to the active gamepad.\n\t * !static stick (id: string, x: number, y: number, outerDrawable: Drawable, innerDrawable: Drawable, maxRadius?: number|0) : Stick;\n\t */\n\tstick: function (id, x, y, outerDrawable, innerDrawable, maxRadius=0)\n\t{\n\t\tif (this.activeGamepad === null)\n\t\t\tthrow new Error ('input.addStick: use input.selectGamepad first to select the active gamepad.');\n\n\t\treturn this.lastStick = this.activeGamepad.addStick (id, x, y, outerDrawable, innerDrawable, maxRadius);\n\t},\n\n\t/**\n\t * Adds a button control to the active gamepad.\n\t * !static button (id: string, x: number, y: number, unpressedDrawable?: Drawable|null, pressedDrawable?: Drawable|null) : Button;\n\t */\n\tbutton: function (id, x, y, unpressedDrawable=null, pressedDrawable=null)\n\t{\n\t\tif (this.activeGamepad === null)\n\t\t\tthrow new Error ('input.addButton: use input.selectGamepad first to select the active gamepad.');\n\n\t\treturn this.lastButton = this.activeGamepad.addButton (id, x, y, unpressedDrawable, pressedDrawable);\n\t}\n};\n\n//!/class\n\nexport default input;\n","\nimport Bounds2 from '../math/bounds2.js';\nimport GridElement from '../flow/grid-element.js';\nimport Handler from '../utils/handler.js';\n\nimport world from './world.js';\n\n/**\n * \tMask used to isolate the super-type of a type.\n */\nconst SUPER_TYPE_MASK = 0xFFFFF000;\n\n/**\n * \tThe collider system is responsible of detecting collisions and performing the respective actions.\n */\n\n//!class collider\n\nconst collider =\n{\n\t/**\n\t * \tFlag used to exclude from collision checks.\n\t *\t!static readonly FLAG_EXCLUDE: number;\n\t */\n\tFLAG_EXCLUDE: GridElement.allocFlag(),\n\n\t/**\n\t * \tContact rules, define what to do when certain types of elements are in contact.\n\t */\n\tcontactRules: { },\n\n\t/**\n\t * \tTruncation rules, indicate which type of elements are not allowed to penetrate each other.\n\t */\n\ttruncationRules: { },\n\n\t/**\n\t *\tScene where the mask layer is contained.\n\t */\n\tscene: null,\n\n\t/**\n\t *\tLayer containing the element masks.\n\t */\n\tmaskLayer: null,\n\n\t/**\n\t *\tFirst updater.\n\t *\t!static fupdater: Handler;\n\t */\n\tfupdater: null,\n\n\t/**\n\t *\tLast updater.\n\t *\t!static lupdater: Handler;\n\t */\n\tlupdater: null,\n\n\t/**\n\t *\tFlags used to filter elements.\n\t *\t!static flagsAnd: number;\n\t *\t!static flagsValue: number;\n\t */\n\tflagsAnd: 0,\n\tflagsValue: 0,\n\n\t/**\n\t *\tCurrent collider state fields.\n\t *\t!static state: {\n\t */\n\tstate:\n\t{\n\t\t/**\n\t\t * \tContact area.\n\t\t *\t!contact: Bounds2;\n\t\t */\n\t\tcontact: Bounds2.Pool.alloc(),\n\n\t\t/**\n\t\t * \tContact flags.\n\t\t * \t!flags: collider.Contact;\n\t\t */\n\t\tflags: 0,\n\n\t\t/**\n\t\t * \tFinal delta value for X-coordinate calculated by `translate`.\n\t\t *\t!dx: number;\n\t\t */\n\t\tdx: 0,\n\n\t\t/**\n\t\t * \tFinal delta value for Y-coordinate calculated by `translate`.\n\t\t *\t!dy: number;\n\t\t */\n\t\tdy: 0,\n\n\t\tbounds: Bounds2.Pool.alloc(),\n\n\t\tx: new Array(32).fill(0),\n\t\ty: new Array(32).fill(0),\n\t\tv0x: new Array(32).fill(0),\n\t\tv0y: new Array(32).fill(0),\n\t\tv1x: new Array(32).fill(0),\n\t\tv1y: new Array(32).fill(0),\n\t\tv2x: new Array(32).fill(0),\n\t\tv2y: new Array(32).fill(0),\n\n\t\tcount: 0,\n\t\ttarget: 0,\n\n\t\tv0: 0, w0: 0, delta0: 0,\n\t\tv1: 0, w1: 0, delta1: 0,\n\n\t\tw2: 0,\n\t\tt_dx: 0,\n\t\tt_dy: 0,\n\t},\n\t//:}\n\n\t/**\n\t *\tEnables the collider system on the specified scene and layer.\n\t * \t@param sceneIndex - Scene to attach the collider updater methods. Uses world.SCENE_MAIN if none specified.\n\t * \t@param layerIndex - Index within the scene of the layer where element masks are stored. Uses world.LAYER_MASK if none specified.\n\t * \t!static enable (sceneIndex?: number, layerIndex?: number) : void;\n\t */\n\tenable: function(sceneIndex=null, layerIndex=null)\n\t{\n\t\tthis.scene = world.getScene(sceneIndex || world.SCENE_MAIN);\n\t\tthis.maskLayer = this.scene.getContainer(layerIndex || world.LAYER_MASK);\n\n\t\tthis.flagsAnd = GridElement.ALIVE | GridElement.VISIBLE | collider.FLAG_EXCLUDE;\n\t\tthis.flagsValue = GridElement.ALIVE | GridElement.VISIBLE;\n\n\t\tthis.scene.fupdater.add(this.firstUpdate, this);\n\t\tthis.scene.lupdater.add(this.lastUpdate, this);\n\n\t\tthis.fupdater = Handler.Pool.alloc(this);\n\t\tthis.lupdater = Handler.Pool.alloc(this);\n\t},\n\n\t/**\n\t *\tDisables the collider system.\n\t *\t!static disable() : void;\n\t */\n\tdisable: function()\n\t{\n\t\tthis.scene.fupdater.remove(this.update, this);\n\t\tthis.maskLayer = null;\n\n\t\tthis.fupdater.free();\n\t\tthis.lupdater.free();\n\t},\n\n\t/**\n\t * \tRuns a first update cycle `fupdater` will be executed.\n\t */\n\tfirstUpdate: function(scene, self)\n\t{\n\t\tself.fupdater.exec();\n\t},\n\n\t/**\n\t * \tRuns a last update cycle `lupdater` will be executed.\n\t */\n\tlastUpdate: function(scene, self)\n\t{\n\t\tself.lupdater.exec();\n\t},\n\n\t/**\n\t * \tUtility object containing actions that are executed later on the next update cycle.\n\t * \t!static later: {\n\t */\n\tlater:\n\t{\n\t\t/**\n\t\t *\tRuns the specified callback.\n\t\t *\t!run (elem: Element, callback: Function, arg1?: any, arg2?: any, arg3?: any) : void;\n\t\t */\n\t\trun: function (elem, callback, arg1, arg2, arg3)\n\t\t{\n\t\t\tcollider.fupdater.add(this._run, elem, callback, arg1, arg2, arg3);\n\t\t},\n\n\t\t/**\n\t\t *\tSets the element's visibility flag.\n\t\t * \t!setVisible (elem: Element, value: boolean) : void;\n\t\t */\n\t\tsetVisible: function (elem, value)\n\t\t{\n\t\t\tcollider.fupdater.add(this._setVisible, elem, value);\n\t\t},\n\n\t\t/**\n\t\t *\tSets an attribute of an object to a given value.\n\t\t * \t!setValue (obj: Object, name: string, value: any) : void;\n\t\t */\n\t\tsetValue: function (obj, name, value)\n\t\t{\n\t\t\tcollider.fupdater.add(this._setValue, obj, name, value);\n\t\t},\n\n\t\t/**\n\t\t *\tSets the element's flags.\n\t\t *\t!setFlags (elem: Element, value: number) : void;\n\t\t */\n\t\tsetFlags: function (elem, value)\n\t\t{\n\t\t\tcollider.fupdater.add(this._setFlags, elem, value);\n\t\t},\n\n\t\t/**\n\t\t *\tClears the element's flags.\n\t\t * \t!clearFlags (elem: Element, value: number) : void;\n\t\t */\n\t\tclearFlags: function (elem, value)\n\t\t{\n\t\t\tcollider.fupdater.add(this._clearFlags, elem, value);\n\t\t},\n\n\t\t/* ******* */\n\n\t\t_run: function (host, elem, callback, arg1, arg2, arg3)\n\t\t{\n\t\t\tcallback (host, elem, arg1, arg2, arg3);\n\t\t\treturn false;\n\t\t},\n\n\t\t_setVisible: function (host, elem, value)\n\t\t{\n\t\t\telem.visible(value);\n\t\t\treturn false;\n\t\t},\n\n\t\t_setValue: function (host, obj, name, value)\n\t\t{\n\t\t\tobj[name] = value;\n\t\t\treturn false;\n\t\t},\n\n\t\t_setFlags: function (host, elem, value)\n\t\t{\n\t\t\telem.setFlags(value);\n\t\t\treturn false;\n\t\t},\n\n\t\t_clearFlags: function (host, elem, value)\n\t\t{\n\t\t\telem.clearFlags(value);\n\t\t\treturn false;\n\t\t}\n\t},\n\t//!}\n\n\t/**\n\t * \tAdds a contact rule.\n\t * \t@param primaryType - Type of the primary element.\n\t * \t@param secondaryType - Type of the secondary element.\n\t * \t@param callback - Callback to execute when contact is detected.\n\t * \t@param context - Optional value passed as last parameter to the callback.\n\t * \t!static contact (primaryType: number, secondaryType: number, callback: (primary: Mask, secondary: Mask, context?: any) => void, context?: any) : collider;\n\t */\n\tcontact: function (primaryType, secondaryType, callback, context=null)\n\t{\n\t\tif (!(primaryType in this.contactRules))\n\t\t\tthis.contactRules[primaryType] = { };\n\n\t\tthis.contactRules[primaryType][secondaryType] = { callback: callback, context: context };\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tAdds a truncation rule.\n\t * \t@param primaryType - Type or super-type of the primary element.\n\t * \t@param secondaryType - Type or super-type of the secondary element.\n\t * \t@param callback - Returns boolean indicating if the truncation rule should be applied.\n\t * \t@param context - Optional value passed as last parameter to the callback.\n\t * \t:static truncate (primaryType: number, secondaryType: number, callback?: (primary: Mask, secondary: Mask, context?: any) => void, context?: any) : collider;\n\t */\n\t/**\n\t * \tAdds a truncation rule.\n\t * \t@param primaryType - Type or super-type of the primary element.\n\t * \t@param secondaryType - Type or super-type of the secondary element.\n\t * \t@param value - Indicates the status of the truncation rule.\n\t * \t!static truncate (primaryType: number, secondaryType: number, value: boolean) : collider;\n\t */\n\ttruncate: function (primaryType, secondaryType, callback=null, context=null)\n\t{\n\t\tif (!(primaryType in this.truncationRules))\n\t\t\tthis.truncationRules[primaryType] = { };\n\n\t\tthis.truncationRules[primaryType][secondaryType] = { callback: callback, context: context };\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tLoads the contact flags in the collider state.\n\t *\t!static getContactFlags (boundsA: Bounds2, boundsB: Bounds2) : number;\n\t */\n\tgetContactFlags: function (boundsA, boundsB)\n\t{\n\t\tthis.state.contact.set(boundsA).setAsIntersection(boundsB);\n\t\tlet contact = this.state.contact;\n\n\t\tthis.state.flags = 0;\n\t\tthis.state.numFlags = 0;\n\n\t\tif (contact.x1 == boundsB.x1)\n\t\t{\n\t\t\tthis.state.flags |= collider.Contact.LEFT; // LEFT\n\t\t\tthis.state.numFlags++;\n\t\t}\n\n\t\tif (contact.x2 == boundsB.x2)\n\t\t{\n\t\t\tthis.state.flags |= collider.Contact.RIGHT; // RIGHT\n\t\t\tthis.state.numFlags++;\n\t\t}\n\n\t\tif (contact.y1 == boundsB.y1)\n\t\t{\n\t\t\tthis.state.flags |= collider.Contact.TOP; // TOP\n\t\t\tthis.state.numFlags++;\n\t\t}\n\n\t\tif (contact.y2 == boundsB.y2)\n\t\t{\n\t\t\tthis.state.flags |= collider.Contact.BOTTOM; // BOTTOM\n\t\t\tthis.state.numFlags++;\n\t\t}\n\n\t\treturn this.state.flags;\n\t},\n\n\tcalc: function (store0, sign, a, v0a, v1a, v1b)\n\t{\n\t\tlet n = this.state.count;\n\t\tlet delta = null;\n\t\tlet v = 0;\n\n\t\tif (sign > 0)\n\t\t{\n\t\t\tfor (let i = 0; i < n; i++)\n\t\t\t{\n\t\t\t\tif (!v0a[i] || !v1a[i] || a[i] < 0) continue;\n\n\t\t\t\tif (delta === null || a[i] > delta)\n\t\t\t\t\tdelta = a[i];\n\n\t\t\t\tv1a[i] = v1b[i] = 0;\n\t\t\t\tv += v0a[i];\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let i = 0; i < n; i++)\n\t\t\t{\n\t\t\t\tif (!v0a[i] || !v1a[i] || a[i] > 0) continue;\n\n\t\t\t\tif (delta === null || a[i] < delta)\n\t\t\t\t\tdelta = a[i];\n\n\t\t\t\tv1a[i] = v1b[i] = 0;\n\t\t\t\tv += v0a[i];\n\t\t\t}\n\t\t}\n\n\t\tif (delta === null)\n\t\t\tdelta = 0;\n\n\t\tif (store0) {\n\t\t\tthis.state.v0 = v;\n\t\t\tthis.state.w0 = Math.abs(delta);\n\t\t\tthis.state.delta0 = delta;\n\t\t} else {\n\t\t\tthis.state.v1 = v;\n\t\t\tthis.state.w1 = Math.abs(delta);\n\t\t\tthis.state.delta1 = delta;\n\t\t}\n\t},\n\n\tattemptSelect: function (swapped)\n\t{\n\t\tif (this.state.v1 + this.state.v0 === this.state.target)\n\t\t{\n\t\t\tif (this.state.w2 === null || this.state.w1 + this.state.w0 < this.state.w2)\n\t\t\t{\n\t\t\t\tthis.state.w2 = this.state.w1 + this.state.w0;\n\n\t\t\t\tif (!swapped) {\n\t\t\t\t\tthis.state.t_dx = this.state.delta1;\n\t\t\t\t\tthis.state.t_dy = this.state.delta0;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.state.t_dx = this.state.delta0;\n\t\t\t\t\tthis.state.t_dy = this.state.delta1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tload0: function()\n\t{\n\t\tlet n = this.state.count;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tthis.state.v1x[i] = this.state.v0x[i];\n\t\t\tthis.state.v1y[i] = this.state.v0y[i];\n\t\t}\n\t},\n\n\tsave1: function()\n\t{\n\t\tlet n = this.state.count;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tthis.state.v2x[i] = this.state.v1x[i];\n\t\t\tthis.state.v2y[i] = this.state.v1y[i];\n\t\t}\n\t},\n\n\tload1: function()\n\t{\n\t\tlet n = this.state.count;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tthis.state.v1x[i] = this.state.v2x[i];\n\t\t\tthis.state.v1y[i] = this.state.v2y[i];\n\t\t}\n\t},\n\n\tresolveXpos: function (single=false)\n\t{\n\t\tthis.calc (single, 1, this.state.x, this.state.v0x, this.state.v1x, this.state.v1y);\n\t\tif (single) return true;\n\n\t\tthis.save1();\n\t\tif (this.resolveYpos(true)) this.attemptSelect(false);\n\n\t\tthis.load1();\n\t\tif (this.resolveYneg(true)) this.attemptSelect(false);\n\n\t\tthis.load0();\n\t},\n\n\tresolveXneg: function (single=false)\n\t{\n\t\tthis.calc (single, -1, this.state.x, this.state.v0x, this.state.v1x, this.state.v1y);\n\t\tif (single) return true;\n\n\t\tthis.save1();\n\t\tif (this.resolveYpos(true)) this.attemptSelect(false);\n\n\t\tthis.load1();\n\t\tif (this.resolveYneg(true)) this.attemptSelect(false);\n\n\t\tthis.load0();\n\t},\n\n\tresolveYpos: function (single=false)\n\t{\n\t\tthis.calc (single, 1, this.state.y, this.state.v0y, this.state.v1y, this.state.v1x);\n\t\tif (single) return true;\n\n\t\tthis.save1();\n\t\tif (this.resolveXpos(true)) this.attemptSelect(true);\n\n\t\tthis.load1();\n\t\tif (this.resolveXneg(true)) this.attemptSelect(true);\n\n\t\tthis.load0();\n\t},\n\n\tresolveYneg: function (single=false)\n\t{\n\t\tthis.calc (single, -1, this.state.y, this.state.v0y, this.state.v1y, this.state.v1x);\n\t\tif (single) return true;\n\n\t\tthis.save1();\n\t\tif (this.resolveXpos(true)) this.attemptSelect(true);\n\n\t\tthis.load1();\n\t\tif (this.resolveXneg(true)) this.attemptSelect(true);\n\n\t\tthis.load0();\n\t},\n\n\t/**\n\t * \tCompletes the translation on the current group.\n\t */\n\tcommit: function ()\n\t{\n\t\tif (!this.state.group.alive())\n\t\t\treturn;\n\n\t\tthis.state.group.translate (this.state.dx, this.state.dy);\n\t\tthis.state.group.clearFlags (collider.FLAG_EXCLUDE);\n\t},\n\n\t/**\n\t * \tAttempts to move the specified group by the given deltas. Any collisions detected on the mask will trigger the respective actions.\n\t * \t@param mask - Mask element.\n\t * \t@param dx - X delta value.\n\t * \t@param dy - Y delta value.\n\t * \t!static translate (mask: Mask, dx: number, dy: number) : void;\n\t */\n\t/**\n\t * \tAttempts to move the specified group by the given deltas. Any collisions detected on the mask will trigger the respective actions.\n\t * \t@param mask - Mask element.\n\t * \t@param group - Group where the mask is stored.\n\t * \t@param dx - X delta value.\n\t * \t@param dy - Y delta value.\n\t * \t!static translate (mask: Mask, group: Group, dx: number, dy: number) : void;\n\t */\n\ttranslate: function (mask, group=null, dx=0, dy=0)\n\t{\n\t\tif (typeof(group) === 'number')\n\t\t{\n\t\t\tdy = dx;\n\t\t\tdx = group;\n\t\t\tgroup = null;\n\t\t}\n\n\t\tif (!mask) return;\n\n\t\tif (!group) group = mask.group;\n\n\t\tif (!group.alive() || !mask.alive())\n\t\t\treturn;\n\n\t\tthis.state.mask = mask;\n\t\tthis.state.group = group;\n\n\t\tthis.state.dx = downscalef(upscale(dx));\n\t\tthis.state.dy = downscalef(upscale(dy));\n\n\t\tif (!this.maskLayer || !mask.visible())\n\t\t\treturn this.commit();\n\n\t\tlet truncationRules = this.truncationRules[mask.type];\n\t\tif (!truncationRules)\n\t\t{\n\t\t\ttruncationRules = this.truncationRules[mask.type & SUPER_TYPE_MASK];\n\t\t\tif (!truncationRules)\n\t\t\t{\n\t\t\t\tthis.commit();\n\t\t\t\treturn this.scan(mask, group);\n\t\t\t}\n\t\t}\n\n\t\tthis.state.offs = group.getOffsets(this.state.dx, this.state.dy);\n\t\tthis.state.bounds.set(mask.bounds).translate(this.state.offs.x+this.state.dx, this.state.offs.y+this.state.dy);\n\n\t\tgroup.setFlags (collider.FLAG_EXCLUDE);\n\n\t\tlet collisionItems = this.maskLayer.selectInRegion(this.state.bounds, this.flagsAnd, this.flagsValue);\n\t\tif (collisionItems.length === 0)\n\t\t{\n\t\t\tcollisionItems.free();\n\t\t\treturn this.commit();\n\t\t}\n\n\t\tlet n = 0;\n\t\tlet v = 0;\n\n\t\twhile (true)\n\t\t{\n\t\t\tlet item = collisionItems.shift();\n\t\t\tif (item === null) break;\n\n\t\t\tlet allowsTruncation = truncationRules[item.type];\n\t\t\tif (!allowsTruncation)\n\t\t\t{\n\t\t\t\tallowsTruncation = truncationRules[item.type & SUPER_TYPE_MASK];\n\t\t\t\tif (!allowsTruncation) continue;\n\t\t\t}\n\n\t\t\tif (allowsTruncation.callback === false || (allowsTruncation.callback !== null && allowsTruncation.callback !== true && !allowsTruncation.callback(mask, item, allowsTruncation.context)))\n\t\t\t\tcontinue;\n\n\t\t\tlet width = Math.min(this.state.bounds.x2, item.bounds.x2) - Math.max(this.state.bounds.x1, item.bounds.x1);\n\t\t\tlet height = Math.min(this.state.bounds.y2, item.bounds.y2) - Math.max(this.state.bounds.y1, item.bounds.y1);\n\n\t\t\tthis.state.v0x[n] = 0;\n\t\t\tthis.state.v0y[n] = 0;\n\n\t\t\tif (Math.min(this.state.bounds.width(), item.bounds.width()) != width) {\n\t\t\t\tthis.state.x[n] = absmin(this.state.bounds.x2 - item.bounds.x1, this.state.bounds.x1 - item.bounds.x2);\n\t\t\t\tthis.state.v0x[n] = 1;\n\t\t\t}\n\n\t\t\tif (Math.min(this.state.bounds.height(), item.bounds.height()) != height) {\n\t\t\t\tthis.state.y[n] = absmin(this.state.bounds.y2 - item.bounds.y1, this.state.bounds.y1 - item.bounds.y2);\n\t\t\t\tthis.state.v0y[n] = 1;\n\t\t\t}\n\n\t\t\tlet sv = this.state.v0x[n] + this.state.v0y[n];\n\t\t\tv += sv;\n\n\t\t\tif (sv > 1) {\n\t\t\t\tthis.state.v0x[n] = sv;\n\t\t\t\tthis.state.v0y[n] = sv;\n\t\t\t}\n\n\t\t\tthis.state.v1x[n] = this.state.v0x[n];\n\t\t\tthis.state.v1y[n] = this.state.v0y[n];\n\n\t\t\tn++;\n\t\t}\n\n\t\tcollisionItems.free();\n\n\t\tif (v == 0)\n\t\t{\n\t\t\tthis.commit();\n\t\t\treturn this.scan(mask, group);\n\t\t}\n\n\t\tthis.state.target = v;\n\t\tthis.state.count = n;\n\t\tthis.state.w2 = null;\n\n\t\tthis.resolveXpos();\n\t\tthis.resolveXneg();\n\t\tthis.resolveYpos();\n\t\tthis.resolveYneg();\n\n\t\tif (this.state.w2 !== null)\n\t\t{\n\t\t\tlet contactRules = this.contactRules[mask.type];\n\t\t\tif (!contactRules) contactRules = this.contactRules[mask.type & SUPER_TYPE_MASK];\n\n\t\t\tif (contactRules)\n\t\t\t{\n\t\t\t\tthis.state.bounds.set(mask.bounds).translate(this.state.offs.x+this.state.dx-this.state.t_dx*0.5, this.state.offs.y+this.state.dy-this.state.t_dy*0.5);\n\n\t\t\t\tcollisionItems = this.maskLayer.selectInRegion(this.state.bounds, this.flagsAnd, this.flagsValue);\n\n\t\t\t\twhile (mask.alive())\n\t\t\t\t{\n\t\t\t\t\tlet item = collisionItems.shift();\n\t\t\t\t\tif (item === null) break;\n\n\t\t\t\t\tif (!item.alive())\n\t\t\t\t\t\tcontinue;\n\t\t\n\t\t\t\t\tlet contact = contactRules[item.type];\n\t\t\t\t\tif (!contact)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontact = contactRules[item.type & SUPER_TYPE_MASK];\n\t\t\t\t\t\tif (!contact) continue;\n\t\t\t\t\t}\n\n\t\t\t\t\tcontact.callback (mask, item, contact.context);\n\t\t\t\t}\n\n\t\t\t\tcollisionItems.free();\n\t\t\t}\n\n\t\t\tthis.state.dx -= this.state.t_dx;\n\t\t\tthis.state.dy -= this.state.t_dy;\n\t\t}\n\n\t\tthis.commit();\n\t},\n\n\t/**\n\t *\tScans for collisions against the specified mask.\n\t * \t@param mask - Mask element.\n\t * \t!static scan (mask: Mask) : void;\n\t */\n\t/**\n\t *\tScans for collisions against the specified mask.\n\t * \t@param mask - Mask element.\n\t * \t@param group - Group where the mask is stored.\n\t * \t!static scan (mask: Mask, group: Group) : void;\n\t */\n\tscan: function (mask, group=null)\n\t{\n\t\tif (!group) group = mask.group;\n\n\t\tif (!group || !group.alive() || !mask.alive())\n\t\t\treturn;\n\n\t\tthis.state.mask = mask;\n\t\tthis.state.group = group;\n\n\t\tif (!this.maskLayer || !mask.visible())\n\t\t\treturn;\n\n\t\tlet contactRules = this.contactRules[mask.type];\n\t\tif (!contactRules) contactRules = this.contactRules[mask.type & SUPER_TYPE_MASK];\n\t\tif (!contactRules) return;\n\t\n\t\tgroup.setFlags (collider.FLAG_EXCLUDE);\n\t\tlet collisionItems = this.maskLayer.selectInRegion(mask.bounds, this.flagsAnd, this.flagsValue);\n\t\tgroup.clearFlags (collider.FLAG_EXCLUDE);\n\n\t\twhile (mask.alive())\n\t\t{\n\t\t\tlet item = collisionItems.shift();\n\t\t\tif (item === null) break;\n\n\t\t\tif (!item.alive())\n\t\t\t\tcontinue;\n\n\t\t\tlet contact = contactRules[item.type];\n\t\t\tif (!contact)\n\t\t\t{\n\t\t\t\tcontact = contactRules[item.type & SUPER_TYPE_MASK];\n\t\t\t\tif (!contact) continue;\n\t\t\t}\n\n\t\t\tcontact.callback (mask, item, contact.context);\n\t\t}\n\n\t\tcollisionItems.free();\n\t}\n};\n\n/**\n * \tContact flag bits.\n */\n\n//!/class\n\n//!namespace collider\n//!enum Contact\n\ncollider.Contact = {\n\t//!LEFT\n\tLEFT: 1,\n\t//!RIGHT\n\tRIGHT: 2,\n\t//!HORIZONTAL\n\tHORIZONTAL: 1|2,\n\t//!TOP\n\tTOP: 4,\n\t//!BOTTOM\n\tBOTTOM: 8,\n\t//!VERTICAL\n\tVERTICAL: 4|8,\n};\n\n//!/enum\n//!/namespace\n\nexport default collider;\n","//@ts-check\n\n//!namespace fxl\n\n//![import \"./system\"]\nimport _sys from './system.js';\nexport const sys = _sys;\n\n//![import \"./world\"]\nimport _world from './world.js';\nexport const world = _world;\n\n//![import \"./r\"]\nimport _r from './r.js';\nexport const r = _r;\n\n//![import \"./resources\"]\nimport _res from './resources.js';\nexport const res = _res;\n\n//![import \"./input\"]\nimport _input from './input.js';\nexport const input = _input;\n\n//![import \"./collider\"]\nimport _collider from './collider.js';\nexport const collider = _collider;\n\n//!/namespace\n","/*\n**\tfroxel\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n//!//@ts-check\n\n// *********************************************\n// rinn\n\nimport * as rinn from 'rinn';\nexport const Class = rinn.Class;\nexport const Schema = rinn.Schema;\nexport const Template = rinn.Template;\n\n// *********************************************\n// system\n\n//![import \"system/globals\"]\nimport _globals from './system/globals.js'; export const globals = _globals;\n\n//![import \"system/glx\"]\nimport _glx from './system/glx.js'; export const glx = _glx;\n\n//![import \"system/glsl\"]\nimport _glsl from './system/glsl.js'; export const glsl = _glsl;\n\n//![import \"system/system\"]\nimport _System from './system/system.js'; export const System = _System;\n\n//![import \"system/timer\"]\nimport _Timer from './system/timer.js'; export const Timer = _Timer;\n\n//![import \"system/random\"]\nimport _Random from './system/random.js'; export const Random = _Random;\n\n//![import \"system/keycode\"]\nimport _KeyCode from './system/keycode.js'; export const KeyCode = _KeyCode;\n\n//![import \"system/canvas\"]\nimport _Canvas from './system/canvas.js'; export const Canvas = _Canvas;\n\n//![import \"system/perf\"]\nimport _Perf from './system/perf.js'; export const Perf = _Perf;\n\n//![import \"system/log\"]\nimport _Log from './system/log.js'; export const Log = _Log;\n\n//![import \"system/shader\"]\nimport _Shader from './system/shader.js'; export const Shader = _Shader;\n\n//![import \"system/shader-program\"]\nimport _ShaderProgram from './system/shader-program.js'; export const ShaderProgram = _ShaderProgram;\n\n//![import \"system/framebuffer\"]\nimport _Framebuffer from './system/framebuffer.js'; export const Framebuffer = _Framebuffer;\n\n\n// *********************************************\n// resources\n\n//![import \"resources/wrappers\"]\nimport * as _Wrappers from './resources/wrappers.js'; export const Wrappers = _Wrappers;\n\n//![import \"resources/resources\"]\nimport _Resources from './resources/resources.js'; export const Resources = _Resources;\nimport _Sound from './resources/sound.js'; export const Sound = _Sound;\n\n\n// *********************************************\n// utils\n\n//![import \"utils/recycler\"]\nimport _Recycler from './utils/recycler.js'; export const Recycler = _Recycler;\n\n//![import \"utils/linkable\"]\nimport _Linkable from './utils/linkable.js'; export const Linkable = _Linkable;\n\n//![import \"utils/list\"]\nimport _List from './utils/list.js'; export const List = _List;\n\n//![import \"utils/priority-queue\"]\nimport _PriorityQueue from './utils/priority-queue.js'; export const PriorityQueue = _PriorityQueue;\n\n//![import \"utils/handler\"]\nimport _Handler from './utils/handler.js'; export const Handler = _Handler;\n\n\n// *********************************************\n// math\n\n//![import \"math/matrix\"]\nimport _Matrix from './math/matrix.js'; export const Matrix = _Matrix;\n\n//![import \"math/rect\"]\nimport _Rect from './math/rect.js'; export const Rect = _Rect;\n\n//![import \"math/vec2\"]\nimport _Vec2 from './math/vec2.js'; export const Vec2 = _Vec2;\n\n//![import \"math/tfunction\"]\nimport _TFunction from './math/tfunction.js'; export const TFunction = _TFunction;\n\n//![import \"math/bounds2\"]\nimport _Bounds2 from './math/bounds2.js'; export const Bounds2 = _Bounds2;\n\n//![import \"math/point2\"]\nimport _Point2 from './math/point2.js'; export const Point2 = _Point2;\n\n\n// *********************************************\n// anim\n\n//![import \"anim/easing\"]\nimport _Easing from './anim/easing.js'; export const Easing = _Easing;\n\n//![import \"anim/anim\"]\nimport _Anim from './anim/anim.js'; export const Anim = _Anim;\n\n\n// *********************************************\n// flow\n\n//![import \"flow/boot\"]\nimport _Boot from './flow/boot.js'; export const Boot = _Boot;\n\n//![import \"flow/grid-element\"]\nimport _GridElement from './flow/grid-element.js'; export const GridElement = _GridElement;\n\n//![import \"flow/grid\"]\nimport _Grid from './flow/grid.js'; export const Grid = _Grid;\n\n//![import \"flow/scene\"]\nimport _Scene from './flow/scene.js'; export const Scene = _Scene;\n\n//![import \"flow/viewport\"]\nimport _Viewport from './flow/viewport.js'; export const Viewport = _Viewport;\n\n//![import \"flow/updater\"]\nimport _Updater from './flow/updater.js'; export const Updater = _Updater;\n\n//![import \"flow/container\"]\nimport _Container from './flow/container.js'; export const Container = _Container;\n\n//![import \"flow/simple-container\"]\nimport _SimpleContainer from './flow/simple-container.js'; export const SimpleContainer = _SimpleContainer;\n\n//![import \"flow/grid-container\"]\nimport _GridContainer from './flow/grid-container.js'; export const GridContainer = _GridContainer;\n\n//![import \"flow/group\"]\nimport _Group from './flow/group.js'; export const Group = _Group;\n\n//![import \"flow/drawable\"]\nimport _Drawable from './flow/drawable.js'; export const Drawable = _Drawable;\n\n//![import \"flow/element\"]\nimport _Element from './flow/element.js'; export const Element = _Element;\n\n//![import \"flow/mask\"]\nimport _Mask from './flow/mask.js'; export const Mask = _Mask;\n\n//![import \"flow/label\"]\nimport _Label from './flow/label.js'; export const Label = _Label;\n\n//![import \"flow/keyboard-handler\"]\nimport _KeyboardHandler from './flow/keyboard-handler.js'; export const KeyboardHandler = _KeyboardHandler;\n\n//![import \"flow/pointer-handler\"]\nimport _PointerHandler from './flow/pointer-handler.js'; export const PointerHandler = _PointerHandler;\n\n//![import \"flow/screen-controls\"]\nimport _ScreenControls from './flow/screen-controls.js'; export const ScreenControls = _ScreenControls;\n\n//![import \"flow/button\"]\nimport _Button from './flow/button.js'; export const Button = _Button;\n\n//![import \"flow/stick\"]\nimport _Stick from './flow/stick.js'; export const Stick = _Stick;\n\n\n// *********************************************\n// fxl\n\n//![import \"fxl/fxl\"]\nimport * as fxl from './fxl/fxl.js';\nexport default fxl;\n\n//!export default fxl;\n"],"names":["$72b5ef15c666663a$var$XOR","value","x","$72b5ef15c666663a$var$SHL","$72b5ef15c666663a$export$2e2bcd8739ae039","$5m6ff$Class","extend","state","index","seed","__ctor","this","setSeed","i","length","nextInt32","a","b","c","d","nextInt16","nextInt8","nextFloat","$52308e123f4aa9e7$export$2e2bcd8739ae039","BACKSPACE","TAB","ENTER","SHIFT","CTRL","ESC","SPACE","PGUP","PGDN","END","HOME","INS","DEL","LEFT","UP","RIGHT","DOWN","NUM_PLUS","NUM_MINUS","NUM_ASTERISK","NUM_SLASH","NUM_DOT","NUM_0","NUM_1","NUM_2","NUM_3","NUM_4","NUM_5","NUM_6","NUM_7","NUM_8","NUM_9","D0","D1","D2","D3","D4","D5","D6","D7","D8","D9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","$fc8826bcf15f6a4c$var$recyclingFacilities","$fc8826bcf15f6a4c$var$totalPreallocated","$fc8826bcf15f6a4c$var$Recycler","$parcel$global","Recycler","$fc8826bcf15f6a4c$export$2e2bcd8739ae039","attachTo","targetClass","maxPoolSize","minPoolSize","prototype","className","Error","int","recyclerPool","recyclerPoolMax","objectId","recyclerNextObjectId","recyclerCreated","recyclerRecycled","recyclerMissed","recyclerLength","recyclerActive","preallocated","preallocate","maximum","n","Math","min","push","allocate","item","alloc","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","init","free","console","error","__dtor","lockInstance","abs","showStats","name","list","log","debug","toFixed","group","groupEnd","createPool","Pool","_super","maxPreallocationsPerPool","$c7b5c39937cf8757$var$Linkable","prev","next","clear","unlink","linkAfter","ref","linkBefore","$c7b5c39937cf8757$export$2e2bcd8739ae039","$86dafe4d6db05951$var$List","top","bottom","reset","clone","$5m6ff$Rinn","ni","dispose","first","last","getAt","getNodeAt","sgetNode","remove","isInstance","insertBefore","insertAfter","unshift","shift","pop","append","forEach","fn","context","forEachRev","find","filter","toArray","array","$86dafe4d6db05951$export$2e2bcd8739ae039","$5c2694bfdc66d5dd$var$Timer","vsync","interval","callback","handle","isRunning","startTime","rTime","sTime","lTime","tDelta","_onTimeout","onTimeout","_onTimeout_b","runNow","hrnow","tError","runAfter","start","immediate","scale","onStarted","timeout","requestAnimationFrame","clearTimeout","setTimeout","stop","onStopped","$5c2694bfdc66d5dd$export$2e2bcd8739ae039","$a4b342ac3362bd53$var$Vec2","y","set","v","setX","setY","zero","isZero","equals","neg","inv","translate","dx","dy","rotate","angle","cos","sin","add","sub","fx","fy","floor","fract","dot","magnitude","squared","sqrt","normalize","majorAxis","minorAxis","sign","toString","$a4b342ac3362bd53$export$2e2bcd8739ae039","$2c0bd2a12449dee2$var$temp","Float32Array","fill","$2c0bd2a12449dee2$var$temp2","$2c0bd2a12449dee2$var$Matrix","data","identity","i1","target","scalef","scalar","matr","cost","sint","sx","sy","applyTo","nx","ny","transpose","j","i2","det","adj","inverse","loadIdentity","$2c0bd2a12449dee2$export$2e2bcd8739ae039","$3b48d37d030fb3de$var$gl","BufferTarget","BufferUsage","gl","setContext","ARRAY_BUFFER","ELEMENT_ARRAY_BUFFER","COPY_READ_BUFFER","COPY_WRITE_BUFFER","TRANSFORM_FEEDBACK_BUFFER","UNIFORM_BUFFER","PIXEL_PACK_BUFFER","PIXEL_UNPACK_BUFFER","STATIC_DRAW","DYNAMIC_DRAW","STREAM_DRAW","STATIC_READ","DYNAMIC_READ","STREAM_READ","STATIC_COPY","DYNAMIC_COPY","STREAM_COPY","getParameter","getFloat32Array","offset","buff","createBufferFrom","usage","createBuffer","bindBuffer","bufferData","$3b48d37d030fb3de$export$2e2bcd8739ae039","$17804ea60ae7de13$var$glsl","snippets","source","get","hasOwnProperty","replace","code","alreadyImported","split","trim","startsWith","str","substring","join","process","indexOf","$17804ea60ae7de13$export$2e2bcd8739ae039","$6ae2bc60983ac51b$var$Shader","id","type","shaderId","put","compile","deleteShader","createShader","Type","VERTEX","VERTEX_SHADER","FRAGMENT","FRAGMENT_SHADER","GEOMETRY_SHADER","shaderSource","compileShader","getShaderInfoLog","map","shaders","shader","GEOMETRY","$6ae2bc60983ac51b$export$2e2bcd8739ae039","$94a08bc4d86d0255$var$ShaderProgram","locations","programId","_uniformSetter","deleteProgram","uniformSetter","attach","bindLocations","bindAttribLocation","getAttribLocation","getUniformLocation","getUniformBlockLocation","getUniformBlockIndex","getUniformBlockSize","uniformBlock","getActiveUniformBlockParameter","UNIFORM_BLOCK_DATA_SIZE","createUniformBlockBuffer","size","bindBufferBase","preloadLocations","link","createProgram","attachShader","linkProgram","activate","useProgram","getStatus","getProgramParameter","LINK_STATUS","getError","getProgramInfoLog","uniform1f","location","v0","uniform1fv","uniform1i","uniform1iv","uniform2f","v1","uniform2fv","uniform2i","uniform2iv","uniform3f","v2","uniform3fv","uniform3i","uniform3iv","uniform4f","v3","uniform4fv","uniform4i","uniform4iv","programs","shaderProgram","$94a08bc4d86d0255$export$2e2bcd8739ae039","$b16e0e25b9c4d361$var$Canvas","options","opts","elem","background","width","height","hidden","absolute","antialias","headless","document","passThruCanvas","createElement","body","appendChild","style","position","left","getContext","desynchronized","alpha","stencil","$1f7690c6f8a8b714$export$2e2bcd8739ae039","$a87a8fa439a9ba4f$export$2e2bcd8739ae039","write","matrixStack","alphaStack","depthFlagStack","shaderProgramStack","transform","_globalScale","_alpha","_depthFlag","updateTransform","strokeStyle","fillStyle","resize","initGl","setBackground","parentNode","imageSmoothingEnabled","renderingContext","pushClip","popClip","setTransform","e","f","toDataURL","mime","params","beginPath","moveTo","closePath","lineTo","rect","w","h","stroke","fillRect","strokeRect","clip","quadraticCurveTo","cpx","cpy","bezierCurveTo","cx1","cy1","cx2","cy2","arc","r","sA","eA","cw","arcTo","x1","y1","x2","y2","fillText","text","maxWidth","strokeText","measureText","createImageData","getImageData","putImageData","drawImage","img","sw","sh","dw","dh","textureWidth","textureHeight","frameWidth","frameHeight","getBoundingClientRect","gl1","glDefaultProgram","glQuickProgram","glBlitProgram","getAllErrors","setShaderProgram","vao0","createVertexArray","bindVertexArray","vertexAttribPointer","FLOAT","FALSE","BYTES_PER_ELEMENT","enableVertexAttribArray","clearColor","enable","DEPTH_TEST","clearDepth","depthFunc","GEQUAL","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","m_quad","m_texture","v_resolution","zvalue","glTextureReady","program","targetWidth","targetHeight","time","glActiveTextureId","glTextureId","glActiveShader","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","rscale","uniformMatrix3fv","drawArrays","TRIANGLE_STRIP","drawRect","prepareImage","image","texture","createTexture","texStorage2D","RGBA8","texSubImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","setWrapRepeat","REPEAT","applyConfig","imageRendering","removeChild","color","backgroundColor","parseInt","substr","g","_width","_height","SCISSOR_TEST","scissor","viewport","globalScale","flipped","isFlipped","toDataUrl","toPngBase64","_contextAttribute","lineCap","lineJoin","lineWidth","miterLimit","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","clearRect","STENCIL_BUFFER_BIT","DEPTH_BUFFER_BIT","COLOR_BUFFER_BIT","end","flush","colorMask","blit","disable","clearPath","pushMatrix","popMatrix","pushAlpha","popAlpha","setDepthFlag","getDepthFlag","pushDepthFlag","popDepthFlag","getShaderProgram","pushShaderProgram","popShaderProgram","loadMatrix","getMatrix","appendMatrix","useNative","ellipse","ox","oy","xe","ye","xm","ym","circle","PI","line","enablePointerEvents","pointerHandler","pointerScale","pointerOffset","_","_evt","action","buttons","lbuttons","containedBy","pointerHandlers","evt","rx","clientX","ry","clientY","dragging","ldx","ldy","ddx","ddy","onmousedown","onmouseup","onmousemove","setPointerScale","setPointerOffset","addPointerHandler","random","removePointerHandler","splice","renderImage","draw","completed","Image","onload","$3da7ad9a68ba8878$export$2e2bcd8739ae039","renderer","src","$b16e0e25b9c4d361$export$2e2bcd8739ae039","$3da7ad9a68ba8878$var$System","flags","renderingEnabled","renderingPaused","defaultOptions","overdraw","orientation","fps","minFps","screenWidth","screenHeight","extraScaleFactor","maxScaleFactor","fullscreen","offsX","offsY","devicePixelRatio","backingStoreRatio","canvasPixelRatio","canvasScaleFactor","scaleFactor","initialMatrix","displayBuffer2","displayBuffer3","tempDisplayBuffer","keyState","ctrl","alt","keyCode","pointerState","updateQueue","drawQueue","timeScale","frameInterval","fixedFrameInterval","maxFrameInterval","frameDelta","frameTime","frameNumber","perf","lastTime","numFrames","numSamples","updateTimeTotal","drawTimeTotal","extraTimeTotal","averageFps","averageUpdateTime","averageDrawTime","averageExtraTime","self","o","onresize","onWindowResized","frameTimer","delta","onFrame","pointerEvents","display0","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","onkeydown","onKeyboardEvent","KeyboardEventType","KEY_DOWN","onkeyup","endTime","KEY_UP","pointerConvX","reverseRender","pointerConvY","ontouchstart","preventDefault","touches","changedTouches","identifier","isActive","isDragging","button","wheelDelta","wheelAccum","p","onPointerEvent","PointerEventType","POINTER_DOWN","ontouchend","deltaTime","POINTER_DRAG_STOP","POINTER_UP","ontouchcancel","ontouchmove","POINTER_DRAG_START","POINTER_DRAG_MOVE","POINTER_MOVE","oncontextmenu","onwheel","deltaY","POINTER_WHEEL","which","pause","resume","resetPerf","tmp","now","update","notRendering","_screenWidth","screen","_screenHeight","innerWidth","innerHeight","targetScreenWidth","targetScreenHeight","marginLeft","marginTop","integerScaleFactor","onCanvasResized","updateQueueAdd","handler","updateQueueRemove","drawQueueAdd","drawQueueRemove","queueAdd","queueRemove","dt","interpolate","dst","duration","easing","count","interpolator","t","pointer","pointers","$a87a8fa439a9ba4f$var$Log","activated","paused","maxsize","debugEcho","vars","msg","fontSize","showFps","showIndex","_y","s","ii","$1f7690c6f8a8b714$var$globals","debugBounds","debugMasks","rand0","rand1","rand2","px","SCALE","obj","audioContext","AudioContext","latencyHint","sampleRate","baseLatency","fetchd","url","Promise","resolve","reject","responseType","request","XMLHttpRequest","open","response","onerror","send","fetchAudioBuffer","then","arrayBuffer","decodeAudioData","audioBuffer","catch","err","bool","float","parseFloat","float2","float3","float4","rad","deg","rand","randf","randrf","randr","round","randtf","performance","randvar","randitem","arr","getLineSegmentIntersection","ls1_x1","ls1_y1","ls1_x2","ls1_y2","ls2_x1","ls2_y1","ls2_x2","ls2_y2","dyA","dxA","dyB","dxB","max","tA","tB","lineSegmentIntersects","rotatePoint","stepValue","minValue","maxValue","numSteps","alignValue","step","FIXED_POINT_BITS","upscale","downscale","downscalef","falign","absmin","absmax","repeat","out","lpad","val","char","charAt","rpad","$9eb1e603ef9a4599$var$Perf","accumSize","expectedValue","lastFeed","lastUpdate","stdSum","stdCount","$9eb1e603ef9a4599$export$2e2bcd8739ae039","begin","feed","report","avg","std","pow","Flags","SAMPLES","MIN","MAX","AVG","EXPECTED","undefined","STDDEV","AVG_STDDEV","ALL","$659ff5622d06b7a8$var$Framebuffer","framebufferId","attachments","attachmentTypes","drawBuffers","drawBufferIds","$659ff5622d06b7a8$var$attachmentPointIds","$659ff5622d06b7a8$var$initAttachmentPointIds","createFramebuffer","Array","MAX_ATTACHMENT_POINTS","TEXTURE","deleteTexture","deleteRenderbuffer","deleteFramebuffer","frameBufferId","attachmentPoint","DEPTH","RENDERBUFFER","FRAMEBUFFER_BINDING","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","framebufferRenderbuffer","createColorBuffer","tex","createDepthBuffer","createRenderbuffer","bindRenderbuffer","renderbufferStorage","DEPTH_COMPONENT24","createStencilBuffer","DEPTH_STENCIL","getTexture","getRenderBuffer","bind","unbind","$659ff5622d06b7a8$var$defaultDrawBuffers","isComplete","result","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","COLOR0","COLOR1","COLOR2","COLOR3","COLOR4","COLOR5","COLOR6","COLOR7","STENCIL","BACK","COLOR_ATTACHMENT0","COLOR_ATTACHMENT1","COLOR_ATTACHMENT2","COLOR_ATTACHMENT3","COLOR_ATTACHMENT4","COLOR_ATTACHMENT5","COLOR_ATTACHMENT6","COLOR_ATTACHMENT7","DEPTH_ATTACHMENT","STENCIL_ATTACHMENT","DEPTH_STENCIL_ATTACHMENT","$659ff5622d06b7a8$export$2e2bcd8739ae039","$11e9573d2381bb46$var$Drawable","resource","swidth","sheight","isInstanceOf","drawable","getDrawable","getImage","drawf","tx","ty","twidth","theight","fwidth","fheight","render","bounds","$11e9573d2381bb46$var$NineSlice","ss","startingIndex","spritesheet","Drawable","instanceOf","k","leftWidth","getFrame","rightWidth","midWidth","topHeight","bottomHeight","midHeight","m","$11e9573d2381bb46$var$Repeated","$11e9573d2381bb46$var$Clipped","$11e9573d2381bb46$var$Centered","$11e9573d2381bb46$var$Static","$11e9573d2381bb46$var$Group","nineSlice","repeated","clipped","centered","static","args","$11e9573d2381bb46$export$2e2bcd8739ae039","$95a97e1c0f1f1b0c$export$2e2bcd8739ae039","wrapper","$691eaf083e1187f8$export$2e2bcd8739ae039","$deb78e94f2ebc2c8$var$FrameDrawable","frameIndex","$deb78e94f2ebc2c8$export$2e2bcd8739ae039","numCols","frameCache","r_scale","v_scale","config","sheetWidth","resName","numRows","ceil","frameObject","$a732373ca436b9d4$export$c35d437ae5945fcd","seq","seq_i","trans","trans_i","trans_t","queue","frameSeconds","finished","_paused","finishedCallback","finishedCallbackHandler","finishedCallbackContext","frameCallback","anim","setFps","initialDelay","onFinished","thenCallback","setFrame","normalized","getLength","loop","use","advance","getSequenceName","seqName","force","play","setQueue","enqueue","lastName","$a732373ca436b9d4$export$2e2bcd8739ae039","defaultDrawable","sharedAnim","Spritesheet","initialized","def","getSharedAnimation","initialseq","getAnimation","getSequence","$e4f355af270762d0$export$2e2bcd8739ae039","r_charWidth","charWidth","r_charHeight","charHeight","paddingX","paddingY","spacingX","spacingY","reverseDraw","cols","charset","charTable","widths","String","fromCharCode","drawText","pX","measureWidth","measureHeight","drawTextAligned","ax","ay","drawTextAligned2","$dcd62cc629bc100a$var$Resources","$dcd62cc629bc100a$var$reported","Object","assign","integerScalingEnabled","pixelated","original","load","progressCallback","completeCallback","keyList","keys","__clone","ratio","extraScale","owidth","oheight","resizeImage","onLoaded","d0","dN","d1","lastIndexOf","_i","cb","track","plugins","NativeAudio","engine","$ed89b7fb0c78ec06$exports","Sound","ENGINE_NATIVEAUDIO","preloadSimple","ENGINE_WEBAUDIO","Audio","ENGINE_HTML5","oncanplaythrough","json","arraybuffer","apply","Uint8Array","unload","__loaded","discardOriginal","temp","rep_x","rep_y","output","sp","tw","th","flipImageHorz","flipImageVert","showDownload","filename","dataUrl","href","display","download","click","showFilePicker","allowMultiple","accept","input","multiple","onchange","files","onfocus","loadAsDataURL","file","reader","FileReader","readAsDataURL","loadAsText","readAsText","loadAsArrayBuffer","readAsArrayBuffer","loadAllAsDataURL","fileList","loadNext","$dcd62cc629bc100a$export$2e2bcd8739ae039","$dd0bde34cb4e9ab9$var$Sound","toUpperCase","volume","playLoop","MASTER","enabled","SFX","MUSIC","VOICE","MAX_POOL_SIZE","pool","active","register","node","registered","unregister","updateNode","cmd","snd","updateNode_webaudio","updateNode_nativeaudio","updateNode_audio","alloc_webaudio","gainNode","createGain","gain","connect","destination","res","createBufferSource","buffer","free_webaudio","disconnect","alloc_nativeaudio","free_nativeaudio","alloc_audio","cloneNode","_src","free_audio","playing","playTime","onended","onended_webaudio","currentTarget","onended_nativeaudio","onended_audio","currentTime","enableTrack","disableTrack","setVolume","createNode","startVolume","timer","fadeOut","millis","setInterval","clearInterval","fadeIn","$dd0bde34cb4e9ab9$export$2e2bcd8739ae039","$8c5f63acb0421354$export$2e2bcd8739ae039","mode","sounds","lastIndex","getRandomSound","playAt","playLoopAt","$ed89b7fb0c78ec06$export$f35845279390eafd","$ed89b7fb0c78ec06$export$922ad9063d3cdee8","$ed89b7fb0c78ec06$export$674d2eb4debbef0c","$ed89b7fb0c78ec06$export$7faa71ea66a694bb","$ed89b7fb0c78ec06$export$e1896ac0c4970221","$ed89b7fb0c78ec06$export$85990f0f98a390bb","$ed89b7fb0c78ec06$export$bc40a15752ef9732","$750603a7f06aed01$export$2e2bcd8739ae039","queueKeys","order","object","priority","is_dirty","sort","cleanup","q","is_complete","forEachAsync","next_j","next_i","forEachRevAsync","alert","$7731e5b07d6f81ab$var$Callback","arg0","arg1","arg2","arg3","arg4","arg5","isEqual","exec","host","$7731e5b07d6f81ab$export$2e2bcd8739ae039","$80312b8048e1e4af$var$Handler","execf","execc","$80312b8048e1e4af$export$2e2bcd8739ae039","$1de3a1302e9acf85$var$Rect","cx","cy","Rool","extendWithPoint","centerAt","contains","setAsUnion","intersects","_x1","_y1","_x2","_y2","setAsIntersection","topLeftRelative","resizeBy","ncx","ncy","isRight","containsPoint","tol","area","strict","flatten","unflatten","$1de3a1302e9acf85$export$2e2bcd8739ae039","$04b06e8451752669$var$TFunction","copyFrom","t0","t1","i0","x0","y0","integral","c0","accum","second_integral","Temp1","integrate","Temp2","accumulate","chopLeft","chopRight","n1","pad","$04b06e8451752669$export$2e2bcd8739ae039","$dd9816a8236ffeac$var$Point2","ux","uy","upscaled","$dd9816a8236ffeac$export$2e2bcd8739ae039","$ca6170c791b7e6a4$var$Bounds2","ucx","ucy","ux1","uy1","ux2","uy2","trunc","dwidth","dheight","isForward","$ca6170c791b7e6a4$export$2e2bcd8739ae039","$301e8e3e4abff79a$var$Easing","Linear","IN","OUT","IN_OUT","Back","Bounce","getConst","Circ","Cubic","Expo","Power","Quad","Quartic","Quintic","Sine","Step","$301e8e3e4abff79a$export$2e2bcd8739ae039","$364f0cff5c52d36b$var$Boot","modules","module","startup","onStartup","shutdown","forEachAsyncRev","onShutdown","Module","$364f0cff5c52d36b$export$2e2bcd8739ae039","$d9dcf14844c52b19$var$system","_timeout","_interval","_span","onPaused","onResumed","window","onblur","fromExternalEvent","_updateTimeout","period","_updateInterval","_0","_1","span","_updateSpan","$d9dcf14844c52b19$export$2e2bcd8739ae039","$60d3ec472af74098$var$Block","commands","current","block","restart","isFinished","$60d3ec472af74098$export$2e2bcd8739ae039","$eeaadc6c71e5f167$var$Command","op","started","field","_duration","_count","startValue","_startValue","endValue","_endValue","_cur","_last","blocks","table","autoInit","ready","$eeaadc6c71e5f167$export$2e2bcd8739ae039","$df7e188c2505314b$export$2e2bcd8739ae039","postinit","$5901e08333080d4a$export$2e2bcd8739ae039","$801b529a9ec796c9$export$2e2bcd8739ae039","$8736652f5a601279$export$2e2bcd8739ae039","setValue","getValue","$21f83eb059273b8e$export$2e2bcd8739ae039","$ada4b87a8e76f567$export$2e2bcd8739ae039","typeOf","$55d40f73196b8e83$export$2e2bcd8739ae039","$a701d41931b399f2$export$2e2bcd8739ae039","$9b27d8ea3cb6205d$export$2e2bcd8739ae039","$ca3370090cdcbadc$var$Anim","initialData","blockStack","cmdStack","running","autoDispose","copyTo","initial","speed","run","fieldName","curr","initialValue","Number","prepareFieldName","parallel","serial","wait","range","rangeTo","randt","PLAY","EXEC","_bounds_x1","_bounds_y1","translateX","deltaValue","translateY","deltaValueX","deltaValueY","easingX","easingY","endValueX","endValueY","moveX","moveY","scaleX","scaleY","$ca3370090cdcbadc$export$2e2bcd8739ae039","$49f3f1509fd80bcd$var$GridElement","ext","container","_grid_remove_node","remover","ALIVE","VISIBLE","DIRTY","DEPTH_FLAG","alive","setId","setFlags","clearFlags","getFlags","andMask","setData","getData","setExt","extensionObject","getExt","arg6","arg7","arg8","arg9","visible","forced","VISIBLE_LOCK","visibleLock","dirty","depthFlagEnabled","DEPTH_FLAG_ENABLED","depthFlag","sync","dWidth","dHeight","setPosition","WRAP_EXTENTS","USERDEF","LAST_FLAG","allocFlag","flag","$49f3f1509fd80bcd$export$2e2bcd8739ae039","$100a4d49ed368f5a$export$2e2bcd8739ae039","grid","offsx","offsy","kx","ky","stride","verifyIntersection","log2","_remove","forEachInRegion","flagsAndMask","flagsValue","j0","j1","selectInRegion","countInRegion","selectFirst","$1f50e3ada780a2b6$var$Container","viewportBounds","scene","elementCount","drawCount","setViewportBounds","drawElement","syncZ","__zvalue","_zvalue","depthFlagChanged","$1f50e3ada780a2b6$export$2e2bcd8739ae039","$b64e31659f1a25fc$var$Viewport","initialWidth","initialHeight","centerRatioX","centerRatioY","focusFactorX","focusFactorY","focusRect","focusOffsX","focusOffsY","focusAxisX","focusAxisY","padding","focusBounds","screenBounds","tmpPoint","containerWidth","containerHeight","ENABLED","setContainerBounds","updateScreenBounds","updateBounds","topLeft","TOP_LEFT","setPadding","truncateToContainer","ws","hs","setOffsets","setScale","getScale","setGlobalScale","getGlobalScale","setCenter","setScreenPosition","getX","getY","getOffsetX","getOffsetY","getWidth","getHeight","focusX","focusY","updateForced","setFocusRect","setFocusOffsets","setFocusAxes","enabledX","enabledY","setFocusFactor","valueX","valueY","applyClip","applyTransform","toWorldSpace","refX","refY","toScreenSpace","$b64e31659f1a25fc$export$2e2bcd8739ae039","$9b30ad6d1299b3d3$var$Element","_shaderProgram","GridElement","destroyLater","disposeLater","shaderChanged","getDebugColor","renderWith","renderFunction","debugColors","$9b30ad6d1299b3d3$export$2e2bcd8739ae039","$f718881f2631daf0$var$tempPoint","$f718881f2631daf0$var$Group","children","Element","wrapExtents","addChild","relative","ltranslate","getChild","_dx","_dy","getOffsets","$f718881f2631daf0$export$2e2bcd8739ae039","$3ba35af12de0a658$var$Scene","minWidth","minHeight","maxHeight","containers","viewports","groupList","groups","disposalQueue","fupdater","updater","synchronizer","lupdater","destroyer","disposeQueued","setContainer","getContainer","setViewport","getViewport","addGroup","_removeGroup","removeGroup","viewportIndex","drawContainers","message","updateViewports","$3ba35af12de0a658$export$2e2bcd8739ae039","$faed73b716fda0f5$export$2e2bcd8739ae039","__update","__context","__preupdate","__postupdate","_update","_sync","_destroy","preUpdate","postUpdate","$2c2356faab0cebc6$export$2e2bcd8739ae039","Container","$223bfc058f9bbe82$export$2e2bcd8739ae039","divisorX","divisorY","$f001bd2c3818fdbc$var$Mask","$f001bd2c3818fdbc$export$2e2bcd8739ae039","$6e90fc390f215f10$var$Label","_dirty","textWidth","textHeight","_align","_valign","textOffsetX","textOffsetY","renderText","align","valign","setText","setFont","$6e90fc390f215f10$export$2e2bcd8739ae039","$3a68d8fd4c091a14$export$2e2bcd8739ae039","create","handlers","_callOnKeyboardEvent","callOnKeyboardEvent","_action","_keyCode","_keyState","$54d7c266f6706352$export$2e2bcd8739ae039","_callOnPointerEvent","callOnPointerEvent","_p","_pointers","$da851dc647123369$var$ScreenControls","dummy","hoverEnabled","zindexEnabled","lastFrame","zindex","setHoverEnabled","setZIndexEnabled","findTarget","filterHover","_continue","_ref","pointerDeactivate","pointerActivate","_refh","hover","focusLock","pointerUpdate","keyArgs","keyboardEvents","keyDown","keyUp","$da851dc647123369$export$2e2bcd8739ae039","$998ee52e9c6f9e4a$export$2e2bcd8739ae039","isPressed","wasPressed","unpressedImg","pressedImg","hitbox","_onButtonDown","_onButtonUp","_onTap","_onChange","Group","_default_onChange","setImage","setKeyCode","pointerX","pointerY","setStatus","updateStatus","onChange","onButtonDown","onButtonUp","onTap","$9e8f05f6fd17f1d0$export$2e2bcd8739ae039","unpressedImgInner","pressedImgInner","angleSteps","radiusSteps","rdirx","rdiry","dirx","diry","frdirx","frdiry","fdirx","fdiry","fmagnitude","fangle","dispx","dispy","radius","maxRadius","deadZoneX","deadZoneY","_unpressedImg","_unpressedImg1","renderStick","setImageInner","setAngleSteps","setRadiusSteps","setDeadZone","atan2","fs","setDirection","freezeState","lastValid","$3137a121ad4437b9$var$world","SCENE_MAIN","SCENE_HUD","LAYER_BG0","LAYER_BG1","LAYER_BG2","LAYER_BG3","LAYER_BG4","LAYER_MAIN","LAYER_FG0","LAYER_FG1","LAYER_FG2","LAYER_FG3","LAYER_FG4","LAYER_MASK","LAYER_HUD_BG0","LAYER_HUD_BG1","LAYER_HUD_BG2","LAYER_HUD_MAIN","LAYER_HUD_FG0","LAYER_HUD_FG1","LAYER_HUD_FG2","_scenes","activeScene","_viewports","activeViewport","activeContainer","activeGroup","lastGroup","lastElement","worldWidth","worldHeight","createScene","createViewport","selectScene","getScene","selectViewport","throwErrors","selectContainer","showMasks","allMasks","createGroup","endGroup","containerIndex","createMask","mask","createLabel","createUpdater","$3137a121ad4437b9$export$2e2bcd8739ae039","$cb8e28d0e5c2cdb6$export$2e2bcd8739ae039","$11997e42c92f64bb$export$2e2bcd8739ae039","total","__resIdMustNotExist","custom","drawFunction","path","images","optsA","optsB","animation","id1","configOptions","resOptions","srcSeq","dstSeq","spritefont","sfx","sfxm","music","$1d8971ef6fa3b258$export$2e2bcd8739ae039","sticks","_visible","layer","addStick","outerDrawable","innerDrawable","stick","addButton","unpressedDrawable","pressedDrawable","$8f435d02e422e88e$var$input","_gamepads","activeGamepad","lastButton","lastStick","cursor","_enabled","_handler","_element","element","native","removeProperty","createGamepad","layerIndex","selectGamepad","getGamepad","debugGamepad","$8f435d02e422e88e$export$2e2bcd8739ae039","$a894eaf30945f11e$var$collider","FLAG_EXCLUDE","contactRules","truncationRules","maskLayer","flagsAnd","contact","v0x","v0y","v1x","v1y","v2x","v2y","w0","delta0","w1","delta1","w2","t_dx","t_dy","sceneIndex","firstUpdate","later","_run","setVisible","_setVisible","_setValue","_setFlags","_clearFlags","primaryType","secondaryType","truncate","getContactFlags","boundsA","boundsB","numFlags","Contact","TOP","BOTTOM","calc","store0","v0a","v1a","v1b","attemptSelect","swapped","load0","save1","load1","resolveXpos","single","resolveYpos","resolveYneg","resolveXneg","commit","scan","offs","collisionItems","allowsTruncation","sv","HORIZONTAL","VERTICAL","$3966bdf4914014e3$export$773cc7fa6f8304c3","$3966bdf4914014e3$export$f965ae91e38a1274","$3966bdf4914014e3$export$43caf9889c228507","$3966bdf4914014e3$export$a79e2b3ea5d10ee0","$3966bdf4914014e3$export$b7e3ae3d7c15e42e","$3966bdf4914014e3$export$5fa227701309b621","$bb627624112967de$export$4c85e640eb41c31b","$bb627624112967de$export$19342e026b58ebb7","$5m6ff$Schema","$bb627624112967de$export$14416b8d99d47caa","$5m6ff$Template","$bb627624112967de$export$816be348776d53c1","$bb627624112967de$export$7c09191825db112d","$bb627624112967de$export$c1b1a45ed915aad9","$bb627624112967de$export$e1dae5660003ffa7","$bb627624112967de$export$c57e9b2d8b9e4de","$bb627624112967de$export$a92776769f460054","$bb627624112967de$export$e9e0d96f49f57c33","$bb627624112967de$export$8d01c972ee8b14a9","$bb627624112967de$export$7c4f444dab5ed59","$bb627624112967de$export$ce30dbb46644d06c","$bb627624112967de$export$462bb059fed9d9e5","$bb627624112967de$export$cb01d642ebc0a347","$bb627624112967de$export$eff95f126aa67cfb","$bb627624112967de$export$573ab5fe783d8aac","$bb627624112967de$export$e9a269813a6315a4","$bb627624112967de$export$85990f0f98a390bb","$bb627624112967de$export$fe264c04f294fd15","$bb627624112967de$export$1034c64782e66715","$bb627624112967de$export$54c2e3dc7acea9f5","$bb627624112967de$export$8fbd1ac8e83536df","$bb627624112967de$export$a428cd33b25d5283","$bb627624112967de$export$5b12bf1653c0dd85","$bb627624112967de$export$c79fc6492f3af13d","$bb627624112967de$export$ac4bca90992eed1","$bb627624112967de$export$c9b44e90c5031de0","$bb627624112967de$export$3dc3622b48e72adc","$bb627624112967de$export$79f93ddd76e66d40","$bb627624112967de$export$cea96571ebbff9dd","$bb627624112967de$export$deefd61317ad2797","$bb627624112967de$export$5a2130c936f86fb8","$bb627624112967de$export$cfb3877ce19bb838","$bb627624112967de$export$ef2184bd89960b14","$bb627624112967de$export$38af1803e3442a7f","$bb627624112967de$export$d5c6c08dc2d3ca7","$bb627624112967de$export$3386beb5bc3bfa","$bb627624112967de$export$42a852a2b6b56249","$bb627624112967de$export$eeaa45a7d92663a6","$bb627624112967de$export$cc55614734af2d87","$bb627624112967de$export$eb2fcfdbd7ba97d4","$bb627624112967de$export$f35845279390eafd","$bb627624112967de$export$db77ccec0bb4ccac","$bb627624112967de$export$991dcf7284de63d","$bb627624112967de$export$b04be29aa201d4f5","$bb627624112967de$export$474b8119f9aaf6a9","$bb627624112967de$export$63d5558963a08ef6","$bb627624112967de$export$f9b7ad1c9b000a93","$bb627624112967de$export$353f5b6fc5456de1","$bb627624112967de$export$85a6520672683043","$bb627624112967de$export$2e2bcd8739ae039","$3966bdf4914014e3$exports"],"version":3,"file":"froxel.m.js.map"}