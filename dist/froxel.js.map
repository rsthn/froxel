{"mappings":"g2BACA,SAAAA,eAAAC,EAAAC,EAAAC,EAAAC,GAAAC,OAAAC,eAAAL,EAAAC,EAAA,CAAAK,IAAAJ,EAAAK,IAAAJ,EAAAK,YAAA,EAAAC,cAAA,I,+VAAA,IAAAC,gBAAA,oBAAAC,sBAAA,oBAAAC,UAAA,oBAAAC,mBAAA,IAAAC,8BAAA,GAAAC,gBAAA,GAAAC,cAAA,GAAAC,cAAAP,gBAAAQ,kBAAA,MAAAD,8BAAA,SAAAjB,GAAA,GAAAA,KAAAe,gBAAA,OAAAA,gBAAAf,GAAAmB,QAAA,GAAAnB,KAAAgB,cAAA,KAAAf,EAAAe,cAAAhB,UAAAgB,cAAAhB,GAAA,IAAAE,EAAA,CAAAkB,GAAApB,EAAAmB,QAAA,WAAAJ,gBAAAf,GAAAE,EAAAD,EAAAoB,KAAAnB,EAAAiB,QAAAjB,IAAAiB,SAAAjB,EAAAiB,QAAA,IAAAhB,EAAA,IAAAmB,MAAA,uBAAAtB,EAAA,WAAAG,EAAAoB,KAAA,mBAAApB,GAAAc,cAAAO,SAAA,SAAAxB,EAAAC,GAAAe,cAAAhB,GAAAC,GAAAS,gBAAAQ,kBAAAD,6BAAAO,SAAA,kBAAAC,OAAAN,SAAApB,eAAA0B,OAAAN,QAAA,eAAAO,2CAAA,IAAAC,QAAAV,cAAA,S,8BAQAS,yCACA,CAMCE,QAAS,SAAUC,MAAOC,KAEzB,MAAqB,iBAAVD,OAEgB,KAAtBA,MAAME,OAAO,EAAG,GAAaF,MAAQC,IAAIxB,IAAIuB,MAAME,OAAO,IAC/B,KAAtBF,MAAME,OAAO,EAAG,KAAYF,MAAQC,IAAID,MAAME,OAAO,KAEzC,iBAAVF,MACHG,KAAKH,OAENA,OAGAA,OAQTI,KAAM,SAAUC,EAAOC,EAAOC,EAAMP,GAEnC,OAAQM,GAEP,IAAK,MAEJ,GADAN,EAAQQ,SAASR,GACbS,MAAMT,GAAQ,MAAM,IAAIP,MAAOa,GACnC,MAED,IAAK,QAEJ,GADAN,EAAQU,WAAWV,GACfS,MAAMT,GAAQ,MAAM,IAAIP,MAAOa,GACnC,MAED,IAAK,SACJN,EAAQA,QAA0C,GAAKA,EAAMW,WAC7D,MAED,IAAK,MACJ,QAAIX,QAAkBA,EAAiB,CACtCA,EAAQA,EAAQ,EAAI,EACpB,MAID,GADAA,EAAQQ,SAASR,GACbS,MAAMT,GAAQ,MAAM,IAAIP,MAAOa,GAEnCN,EAAQA,EAAQ,EAAI,EACpB,MAED,IAAK,QACJ,GAA0B,SAAtBF,QAAAc,QAAKC,OAAOb,GACf,MAED,GAAIA,QACJ,CACCA,EAAQ,GACR,MAGD,MAAM,IAAIP,MAAOa,GAGlB,IAAK,OACJ,GAAc,SAAVN,QAAoBA,EAAgB,CACvCA,KACA,MAGD,GAAc,UAAVA,QAAqBA,EAAiB,CACzCA,KACA,MAGD,MAAM,IAAIP,MAAOa,GAInB,OAAON,GAORK,MAAO,SAAUA,EAAOC,EAAOC,EAAMP,GAEpC,IAAIc,EAASC,KAAKhB,QAAQO,EAAOD,GACjC,IAAKS,EAAQ,MAAM,IAAIrB,MAAOa,GAE9B,OAAKN,EAGEc,EAAOE,OAAQhB,GAFd,IAAIc,GASbG,IAAK,SAAUZ,EAAOC,EAAOC,EAAMP,GAElC,IAAIc,EAASC,KAAKhB,QAAQO,EAAOD,GACjC,OAAKL,EAEEF,QAAAc,QAAKM,aAAaJ,EAAQd,GAFd,IAAIc,GAUxBK,QAAS,SAAUd,EAAOC,EAAOC,EAAMP,GAEtC,IAAIc,EAASC,KAAKhB,QAAQO,EAAOD,GAGjC,GAFKL,IAAOA,EAAQ,KAEfc,GAAgC,SAAtBhB,QAAAc,QAAKC,OAAOb,GAC1B,MAAM,IAAIP,MAAOa,GAElB,IAAK,IAAIc,EAAI,EAAGA,EAAIpB,EAAMqB,OAAQD,IACjCpB,EAAMoB,GAAKtB,QAAAc,QAAKM,aAAaJ,EAAQd,EAAMoB,IAE5C,OAAOpB,GAQRsB,UAAW,SAAUjB,EAAOC,EAAOC,EAAMP,GAExC,IAAIuB,KAQJ,GAN0B,UAAtBzB,QAAAc,QAAKC,OAAOP,KAEXA,EAAMiB,SAAQA,EAASjB,EAAMiB,QACjCjB,EAAQA,EAAMN,OAGXM,EAAO,OAAON,EAElB,GAA0B,SAAtBF,QAAAc,QAAKC,OAAOb,GACf,MAAM,IAAIP,MAAOa,GAElB,IAAK,IAAIc,EAAI,EAAGA,EAAIpB,EAAMqB,OAAQD,IAEjC,GAAgB,MAAZpB,EAAMoB,GACV,CACC,IAAIG,EAGH,MAAM,IAAI9B,MAAOa,GAFjBN,EAAMwB,OAAQJ,IAAK,GAMtB,OAAOpB,GAQRyB,eAAgB,SAAUpB,EAAOC,EAAOC,EAAMP,GAE7C,IAAIuB,KAQJ,GAN0B,UAAtBzB,QAAAc,QAAKC,OAAOP,KAEXA,EAAMiB,SAAQA,EAASjB,EAAMiB,QACjCjB,EAAQA,EAAMN,QAGVM,EAAO,OAAON,EAEnB,GAA0B,SAAtBF,QAAAc,QAAKC,OAAOb,GACf,MAAM,IAAIP,MAAOa,GAElB,IAAK,IAAIc,EAAI,EAAGA,EAAIpB,EAAMqB,OAAQD,IAEjC,GAAgB,MAAZpB,EAAMoB,KAGLpB,EAAMoB,GAAGM,cACd,CACC,IAAIH,EAGH,MAAM,IAAI9B,MAAOa,GAFjBN,EAAMwB,OAAQJ,IAAK,GAMtB,OAAOpB,GAOR2B,SAAU,SAAUtB,EAAOC,EAAOC,EAAMP,GAEvC,GAAIA,QACH,MAAM,IAAIP,MAAOa,EAAQ,GAAK,QAE/B,GAEM,UAFER,QAAAc,QAAKC,OAAOb,IAGlB,GAAoB,GAAhBA,EAAMqB,OAAa,MAAM,IAAI5B,MAAOa,EAAQ,GAAK,aAIrD,GAA+B,GAA3BN,EAAMW,WAAWU,OAAa,MAAM,IAAI5B,MAAOa,EAAQ,GAAK,QAIlE,OAAON,GAOR4B,OAAQ,SAAUvB,EAAOC,EAAOC,EAAMP,GAErC,GAAIA,EAAMW,WAAWU,OAASf,EAC7B,MAAM,IAAIb,MAAOa,GAElB,OAAON,GAOR6B,OAAQ,SAAUxB,EAAOC,EAAOC,EAAMP,GAErC,GAAIA,EAAMW,WAAWU,OAASf,EAC7B,MAAM,IAAIb,MAAOa,GAElB,OAAON,GAOR8B,OAAQ,SAAUzB,EAAOC,EAAOC,EAAMP,GAErC,GAAIU,WAAWV,GAASM,EACvB,MAAM,IAAIb,MAAOa,GAElB,OAAON,GAOR+B,OAAQ,SAAU1B,EAAOC,EAAOC,EAAMP,GAErC,GAAIU,WAAWV,GAASM,EACvB,MAAM,IAAIb,MAAOa,GAElB,OAAON,GAORgC,SAAU,SAAU3B,EAAOC,EAAOC,EAAMP,GAEvC,GAA0B,SAAtBF,QAAAc,QAAKC,OAAOb,IAAqBA,EAAMqB,OAASf,EACnD,MAAM,IAAIb,MAAOa,GAElB,OAAON,GAORiC,SAAU,SAAU5B,EAAOC,EAAOC,EAAMP,GAEvC,GAA0B,SAAtBF,QAAAc,QAAKC,OAAOb,IAAqBA,EAAMqB,OAASf,EACnD,MAAM,IAAIb,MAAOa,GAElB,OAAON,GAQRkC,QAAS,SAAU7B,EAAOC,EAAOC,EAAMP,GAEtC,IAAKmC,OAAAvB,QAAMN,GAAO8B,KAAMpC,EAAMW,YAC7B,MAAM,IAAIlB,MAAOa,GAElB,OAAON,GAQRqC,MAAO,SAAUhC,EAAOC,EAAOC,EAAMP,GAEpC,GAA0B,SAAtBF,QAAAc,QAAKC,OAAOP,GAChB,CACC,IAAK,IAAIgC,OAAO,KAAKhC,EAAMK,WAAW,MAAMyB,KAAMpC,EAAMW,YACvD,MAAM,IAAIlB,MAAOa,GAElB,OAAON,EAGR,OAAIM,EAAMiC,QAAQvC,EAAMW,YACvB,MAAM,IAAIlB,MAAOa,EAAMkC,KAAK,MAE7B,OAAOxC,GAORyC,MAAO,SAAUpC,EAAOC,EAAOC,EAAMP,GAEpC,OAAOM,EAAQN,EAAMW,WAAW+B,cAAgB1C,GAOjD2C,MAAO,SAAUtC,EAAOC,EAAOC,EAAMP,GAEpC,OAAOM,EAAQN,EAAMW,WAAWiC,cAAgB5C,O,0FCtWlD,MAAM6C,EAAO,G,IACbC,EAAeD,EAUbA,EAAAE,YAAA,SAAAC,GAGFA,GAAAC,YAAA,WAOCD,M,OAmB2BE,KAAG,SAAaC,GAC1C,WAAAC,SAAA,SAAAC,EAAAC,GAGFL,WAAAI,EAAAF,OAcEN,EAAAhC,OAAA,SAAA0C,GAGF,OAAAA,aAAAC,MAAA,QAOS,OAAJD,EAAI,eAEEA,GAAO5C,WACjBiC,e,EAcMa,gBAAG,SAAAF,G,OAIRV,EAAShC,OAAA0C,IAGV,IAAS,QACR,aAGF,S,YA+BOG,MAAI,SAAQC,G,IAEhBJ,EAAKV,EAEAhC,OAAA8C,G,GAEH,U,EAAS,C,aAMTvC,EAAA,EAAOA,EAAKuC,EAAItC,OAASD,IAAEmC,EAAAK,KAAAf,EAAAa,MAAAC,EAAAvC,UAE7B,cAAAmC,EAAA,CAGF,GAAO,UAAOI,GAAA,mBAAAA,EAAAD,MAAA,OAAAC,EAAAD,QACbH,EAAA,GAGF,QAAAnC,KAAAuC,EAAAJ,EAAAnC,GAAAyB,EAAAa,MAAAC,EAAAvC,SAOMmC,EAAKI,EAQV,OAAOJ,G,EAgBgBM,MACrB,SAAYC,KAACC,G,GACd,SAAAlB,EAAAhC,OAAAiD,GAAA,QAAA1C,EAAA,EAAAA,EAAA2C,EAAA1C,OAAAD,IAAA,CAED,IAAO4C,EAAKD,EAAA3C,GACX,YAAAyB,EAAAhC,OAAAmD,GAAAF,EAAAF,KAAAI,QAGF,QAAAC,EAAA,EAAAA,EAAAD,EAAA3C,OAAA4C,IAAAH,EAAAF,KAAAf,EAAAa,MAAAM,EAAAC,UASE,GACQ,UADJpB,EAA6BhC,OAChCiD,GAAwB,IAAI,IAAEI,EAAA,EAAAA,EAAAH,EAAA1C,OAAA6C,IAAA,CAC/B,IAAAjE,EAAA8D,EAAAG,GAED,GAAgC,UAAzBrB,EAAyBhC,OAAAZ,GAC/B,QAAAkE,KAAAlE,EAAA4C,EAAAY,gBAAAxD,EAAAkE,IAGFA,KAAAL,EAAAjB,EAAAgB,MAAAC,EAAAK,GAAAlE,EAAAkE,IAOcL,EAAMK,GAAItB,EACfa,MAAMzD,EAAAkE,IAEPL,EAAAK,GACNlE,EAAAkE,GAKD,OAAOL,G,EAmBLM,SAAA,SAAAN,KAAAC,G,IAED,IAAA3C,EAAO,EAAGA,EAAA2C,EAAA1C,OAAAD,IAAA,QAAA6C,KAAAF,EAAA3C,GAAA0C,EAAAG,GAAAF,EAAA3C,GAAA6C,G,OACVH,G,EAQSO,eAAA,SAAAC,EAAAC,GACT,SAAAD,GAAA,MAAAC,EAAA,SAGF,GAAAD,IAAAC,EAAA,SAOC,QAAQnD,KAAGmD,EACV,GAAAD,EAAAlD,IAAAmD,EAAAnD,GAAA,SAUD,UAaDyB,EAAA2B,UAAA,SAAAR,EAAAT,EAAAkB,GAOC,QAAOrD,EAAK,EAAA4C,GAAU5C,EAAG4C,EAAA3C,OAAAD,IACxB,GAAAL,KAAAsD,eAAAL,EAAA5C,GAAAmC,GAAA,OAAAkB,EAAAT,EAAA5C,KAUD,QAAOqD,GAAY,M,EAsBhBC,aAAA,SAAAzE,EAAA0E,G,SAIF1E,IAAO0E,GAA0B,iBAAV1E,KACtBA,aAAY0E,GACZ,iBAAkB1E,GAAYA,EAAEyE,aAAMC,K,EAuBdpC,QAAC,SAAcqC,EAAA5E,EAAA6E,MAEzC,GAAIA,EAAW,CAGb,IAAI,IAAAzD,EAAA,EAAWA,EAACwD,EAAavD,OAAKD,IAEjC,GAAAwD,EAAAxD,KAAApB,EAAA,OAAAoB,EAKD,S,IAEC,IAAAA,KAAAwD,EAGH,GAAOA,EAAAxD,KAAApB,EAAA,OAAAoB,E,i2BC/WR,IAAA0D,EACA,CACCC,iEACAC,oCACAC,+BACA1E,yBACA2E,sBACAC,mBACAC,6DCZD,IAAAtF,OAAAV,cAAA,SCAAU,OAAAV,cAAA;cAsBA;MAAAiG,4BAAA,aAsBAA,4BAAAV,OAAAU,4B,4BAc2BC,OAAK,GAe/BD,4BAAuBE,UAAcC,UAC7B,QAURH,4BAAkBE,UAAmBE,OAAA,a,4BAOxBF,UAAAG,OAAA,a,4BAUOH,UAAUb,aAAc,SAAUc,G,OAClD,O,IACC,mB,EAAAA,IAAAD,UAAAC,UAEQ,iBAAJA,IAAIA,IAAAG,UAAAH,WACXzE,KAAAyE,eAAAzE,KAAAuE,OAAAM,eAAAJ,KAoBFH,4BAAuBQ,WAAA,SAAAC,EAAAN,GAEvB,OAAa,OAATM,GAAqB,OAAPN,GACdM,EAASpB,aAAYc,I,4BAQxBD,UAAkCQ,eAAA,W,IAClCT,EAAAvE,KAAAiF,YAAAV,OAEAW,EAAA,G,MACAlH,EAAAgC,K,IAEA,IAAAK,KAAAkE,EAAA,CACA,IAAI/B,EAAA,GAKJ2C,EAAAZ,EAAAlE,GAAAmE,UAGG,IAAC,IAAMtB,KAAGiC,EACO,aAAPpG,OAAOc,QAAAC,OAAAqF,EAAAjC,MAEdV,EAAAU,GAAK,SAAAjB,GACX,gBAAAmD,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,GAGF,OAAA7D,EAAAxD,KAAAT,EAAAoH,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAGAC,IAPa,CAYZX,EAAAjC,KAGCgC,EAAK7E,GAAAmC,E,KAEJ+B,OAAAW,G,4BAkBAa,QAAA,SAAAC,GAEF,IAAAhI,EAAOgC,KAAO4D,OACbW,EAAAvG,EAAAuG,OAGFX,EAAA5F,EAAA4F,OAKC,GAAmB,aAAZ7E,OAAKc,QAAOC,OAAAkG,GAAA,CAIpB,QAAA3F,KAAA2F,EAAApC,OAAA,SAAAvC,KAAAhB,KAAArC,EAAAqC,GAAA2F,EAAApC,OAAAvD,IAMEtB,OAAAc,QAAAwD,SAAArF,EAAAwG,UAAAwB,EAAApC,OAAAY,WAQGzF,OAASc,QAAIwD,SAAAkB,EAAAyB,EAAApC,OAAAW,QAGRyB,EAAKpC,OAAAY,UAAiBC,YAC/BF,EAAAyB,EAAApC,OAAAY,UAAAC,WAAAuB,EAAApC,aACK7E,OAAKc,QAAAwD,SAAArF,EAAAwG,UAAAwB,GAMV,O,EAHCzB,OAAUA,E,EACVX,SAED5F,G,4BAOCwG,UAAAyB,QAAA,SAAAC,EAAAC,GAED,OAAAA,EAAA7F,OAAA,OAA+B4F,E,MAG9BtC,EAAU,YAASwC,GAMnBpG,KAAAgF,iBAEDhF,KAAA0E,OAAA2B,MAAArG,KAAyBoG,IAMzBxC,EAAOA,OAAKA,EACXA,EAAAW,OAAA,GAEFD,4BAAAyB,QAAAtH,KAAqBmF,EAANsC,U,kzBCnQfnH,OAAAV,cAAA,S,yCAuBWiI,yCAAAC,OAAA,CAYV9B,UAAA,QAeA+B,OAAA,K,KAoBC,K,KAKA,K,eAeA,K,KAIA,KAKDC,IAAA,K,SASC,K,qBAiCMD,EAASE,EAAMC,EAAUC,EAC7BC,EAAAC,G,YACCN,E,UAGAG,E,UAEAC,E,eAGIC,E,eAEJC,E,UAGFJ,E,oBAeD,WAaD,OAXA1G,KAAA+G,KAAA,KAOC/G,KAAKyG,IAAA,GACLzG,KAAAgH,UACAhH,KAAAK,KAEDL,M,UAgBQ,SAAKf,GAEZ,OADAe,KAAAwG,OAAAvH,EACAe,M,u9BCtLDsG,yCAGAC,OAAS,C,UAUR,kB,UAUO,K,UAYP,K,OAO6B,W,KAAQU,UAAS,I,aAE9C,SAAAhI,GAWA,OATDe,KAAAkH,UAAAjI,EASCe,M,iBAiBO,SACF2G,EAAYQ,EAAIC,EAAYC,G,SAE1BV,EACEW,MAAI,MAEEX,EAAUrG,OAAK,G,EAC3BqG,EAAArG,OAAA,EAAAqG,EAAA,Q,OACD3G,KAAAiH,UAAAzH,KAAAQ,KAAAiH,UAAAzH,GAAA,I,KAGFyH,UAAAzH,GAAAqD,KAAA,CACC0E,GAAIA,EAGJJ,QAAQA,EAERC,QAAUA,E,KAETC,E,OAEI,I,0BA4BM,SAAUV,EAAWQ,EAAAC,GAEjC,IAAI5H,GADJmH,EAAWA,EAAUW,MAAA,MACFX,EAAUrG,OAAG,GAE5BiH,EAAKZ,EAAUrG,OAClB,EAAIqG,EAAQ,GAAQ,KAErB,GAAS,KAALnH,EAAK,IAAU,IAClB0D,KAAIlD,KAAGiH,UAKJ,IAHC,IAAIP,EAAO1G,KAAIiH,UAAW/D,GAI/B7C,EAAA,EAAAA,EAAAqG,EAAApG,OAAAD,IAAA,CACM,IAAImH,KAETL,IAAAK,KAAAd,EAAArG,GAAA8G,aAEUC,IAAAI,KAAAd,EAAArG,GAAA+G,aACXG,IAAAC,KAAAd,EAAArG,GAAAkH,OAEDC,GAAAd,EAAAjG,OAAAJ,IAAA,OAWK,CAEJ,IAAQL,KAAKiH,UAAUzH,GAAQ,OAAEQ,KAM/B,IAJM0G,EAAO1G,KAEdiH,UAAczH,GAELa,EAAG,EAAIA,EAACqG,EAAApG,OAAaD,IAEpBmH,KAEJL,IAAMK,EAAOA,GAAGd,EAAMrG,GACzB8G,UAASA,GAENC,IAAII,EAAMA,GAAId,EAAMrG,GAAA+G,aACxBG,IAAAC,KAAAd,EAAArG,GAAAkH,OACDC,GAAAd,EAAAjG,OAAAJ,IAAA,G,OAODL,M,aAuBM,SAAK2G,EAAkBC,EAASC,EAAQC,GAC/C,IAAAJ,EAAA,G,GACAC,IAAAW,MAAA,M,swBC/NFvI,OAAAV,cAAA,S,8BAQA,IAAIoJ,6BAASC,yCAAgBnB,OAC5B,CAIA9B,UAAW,QAMXkD,SAAU,KAMVC,YAAa,KAKbP,KAAM,KAKNQ,YAAa,KAKbC,QAAS,EAMTC,OAAQ,EAQRrD,OAAQ,SAAU2C,EAAMM,GAMvB,GAJA3H,KAAKuE,OAAOyD,gBAAgBtD,SAE5B1E,KAAKqH,KAAO,GAEI,MAAZM,EAEH3H,KAAKiI,MAAON,UAGb,CACC,IAAInF,EAAI,KAER,IAAKxC,KAAK2H,UAAY3H,KAAK4H,YAC3B,CACCpF,EAAI,GAEJ,IAAK,IAAInC,KAAKL,KAAK4H,YACnB,CACC,IAAI1E,EAAIlD,KAAK4H,YAAYvH,GACX,OAAV6C,EAAEgF,cAAgBhF,EAAEgF,IAMF,mBAAXhF,EAAEgF,IACZ1F,EAAEnC,GAAK6C,EAAEgF,MAET1F,EAAEnC,GAAK6C,EAAEgF,IAPT1F,EAAEnC,GAAK,MAWVL,KAAKiI,MAAMzF,GAGZxC,KAAKmI,OAEO,MAARd,GACHrH,KAAKrC,IAAK0J,MAEPrH,KAAK4H,aAAa5H,KAAKoI,SAE3BpI,KAAKqI,SAUNJ,MAAO,SAAUN,EAAUW,GAE1B,IAAKtI,KAAK2H,SACV,CACC,IAAKA,GAAuC,WAA1B5I,OAAAc,QAAKC,OAAO6H,IAAoD,aAA1B5I,OAAAc,QAAKC,OAAO6H,GACnE,OAAO3H,KAERA,KAAK2H,SAAWA,EAQjB,MALmC,aAA/B5I,OAAAc,QAAKC,OAAOE,KAAK2H,UACpB3H,KAAKqH,KAAOrH,KAAK2H,WAEjB3H,KAAKqH,KAAOtI,OAAAc,QAAK8C,MAAM3C,KAAK2H,eAEtBW,QAAsBX,EAAsB3H,KAAOA,KAAKoI,OAAO,UAQvED,KAAM,aASNE,MAAO,aASPE,OAAQ,SAAUtJ,GAGjB,OADAe,KAAK8H,SAAW7I,EAAQ,KACjBe,MASRwI,UAAW,SAAUhJ,EAAMP,GAE1B,IAAKe,KAAK4H,cAAgB5H,KAAK4H,YAAYpI,GAC1C,OAAOP,EAER,IAAI2I,EAAc5H,KAAK4H,YAAYpI,GAE/BiJ,EAASxJ,EAEb,IAAK,IAAIyJ,KAAUd,EAElB,GAAKH,6BAAOkB,YAAYD,GAGxB,IACCD,EAAShB,6BAAOkB,YAAYD,GAAS1I,KAAM4H,EAAYc,GAASlJ,EAAMiJ,GAEvE,MAAOrL,GAEN,GAAiB,QAAbA,EAAEwL,QACL,MAED,MAAM,IAAIlK,MAAO,eAAegK,KAAUd,EAAYc,2BAAgClJ,OAIxF,OAAOiJ,GAWRI,KAAM,SAAUrJ,EAAMP,GAErB,IAAKe,KAAK4H,cAAgB5H,KAAK4H,YAAYpI,GAG1C,OADAQ,KAAKqH,KAAK7H,GAAQP,EACXA,EAGR,IAAI2I,EAAc5H,KAAK4H,YAAYpI,GAG/BiJ,GADSzI,KAAKqH,KAAK7H,GACVP,GAEb,IAAK,IAAIyJ,KAAUd,EAElB,GAAKH,6BAAOkB,YAAYD,GAGxB,IACCD,EAAShB,6BAAOkB,YAAYD,GAAS1I,KAAM4H,EAAYc,GAASlJ,EAAMiJ,GAEvE,MAAOrL,GAEN,GAAiB,QAAbA,EAAEwL,QACL,MAEI5I,KAAK8H,SACT9H,KAAK8I,cAAe,kBAAmB,CAAEC,WAAYL,EAAQE,QAASxL,EAAEwL,QAASpJ,KAAMA,EAAMP,MAAOA,IAErG,MAIF,OAAQe,KAAKqH,KAAK7H,GAAQiJ,GAS3BO,eAAgB,SAAUxJ,EAAMyJ,EAAMhK,EAAOiK,GAE5C,IAAIC,EAAO,CAAE3J,KAAMA,EAAM4J,IAAKH,EAAMhK,MAAOA,EAAOoK,MAAOrJ,KAAK+H,QAE1DuB,EAAMtJ,KAAK8I,cAAe,mBAAoBK,GAE7CD,EAGJlJ,KAAKqH,KAAK7H,GAAQ2J,EAAKlK,MAFvBkK,EAAKlK,MAAQe,KAAK6I,KAAMrJ,EAAM2J,EAAKlK,OAIzB,MAAPqK,GAAeA,EAAI7C,IAAInG,aAAUgJ,EAAI7C,IAAI,KAG7CzG,KAAK8I,cAAe,mBAAqBtJ,EAAM2J,GAC/CnJ,KAAK8I,cAAe,kBAAmBK,GAEvCnJ,KAAK6H,YAAYhF,KAAMrD,KAWxB7B,IAAK,WAEJ,IAAIJ,EAAIgM,UAAUjJ,OACdkJ,KAAejB,KAenB,IAbKhL,EAAI,GAAW,GAALA,GAAuC,UAA7BwB,OAAAc,QAAKC,OAAOyJ,UAAU,MAAoD,WAA/BxK,OAAAc,QAAKC,OAAOyJ,UAAUhM,EAAE,WAE3FiM,EAAQD,YAAYhM,MACCgL,MAGH,GAAfvI,KAAK+H,SAER/H,KAAK6H,YAAc,IAGpB7H,KAAK+H,SAEI,GAALxK,GAECyC,KAAKqH,KAAKkC,UAAU,MAAQA,UAAU,IAAMC,KAE1CxJ,KAAK8H,SAAYS,EAGrBvI,KAAK6I,KAAMU,UAAU,GAAIA,UAAU,IAFnCvJ,KAAKgJ,eAAgBO,UAAU,GAAIvJ,KAAKqH,KAAKkC,UAAU,IAAKvJ,KAAKwI,UAAWe,UAAU,GAAIA,UAAU,WAOtG,IAAK,IAAIlJ,KAAKkJ,UAAU,IAEnBvJ,KAAKqH,KAAKhH,KAAOkJ,UAAU,GAAGlJ,IAAMmJ,KAElCxJ,KAAK8H,SAAYS,EAGrBvI,KAAK6I,KAAMxI,EAAGkJ,UAAU,GAAGlJ,IAF3BL,KAAKgJ,eAAgB3I,EAAGL,KAAKqH,KAAKhH,GAAIL,KAAKwI,UAAWnI,EAAGkJ,UAAU,GAAGlJ,MAU1E,QAHOL,KAAK+H,SAAU/H,KAAK6H,YAAYvH,QAAWiI,GAAWvI,KAAK8H,SACjE9H,KAAK8I,cAAe,eAAgB,CAAEW,OAAQzJ,KAAK6H,cAE7C7H,MAQR0J,IAAK,SAAUlK,GAEd,OAAOA,KAAQQ,KAAKqH,MAcrB3J,IAAK,SAAU8B,EAAM0I,GAEpB,OAAwB,GAApBqB,UAAUjJ,aAAed,EACrBQ,KAAKqH,KAEW,GAApBkC,UAAUjJ,aAAed,EACrBQ,KAAK2J,UAEW,GAApBJ,UAAUjJ,iBACNN,KAAKqH,KAAK7H,GAAsB0I,EAEjClI,KAAKqH,KAAK7H,IAQlBoK,OAAQ,SAAUpK,EAAM0I,GAEvB,OAAwB,GAApBqB,UAAUjJ,iBACNN,KAAKqH,KAAK7H,GAAsB0I,EAEjCzI,SAAUO,KAAKqH,KAAK7H,KAQ5BqK,SAAU,SAAUrK,EAAM0I,GAEzB,OAAwB,GAApBqB,UAAUjJ,iBACNN,KAAKqH,KAAK7H,GAAsB0I,EAEjCvI,WAAYK,KAAKqH,KAAK7H,KAS9BsK,QAAS,SAAUtK,EAAM0I,GAOxB,MAAa,UAJZ1I,EADuB,GAApB+J,UAAUjJ,iBACNN,KAAKqH,KAAK7H,GAAsB0I,EAEhClI,KAAKqH,KAAK7H,UAEKA,GAGV,UAATA,QAAoBA,KAGjBC,SAAUD,IASlBuK,aAAc,SAAUvK,GAEvB,IAAIwK,EAAIhK,KAER,MAAO,CACNtC,IAAK,WACJ,OAAOsM,EAAEtM,IAAI8B,IAGd7B,IAAK,SAASsB,GACb+K,EAAErM,IAAI6B,EAAMP,MAaf8J,WAAY,SAAU3F,EAAO2F,EAAY9J,GAExC,GAAwB,GAApBsK,UAAUjJ,QAAmC,GAApBiJ,UAAUjJ,QAAoC,GAApBiJ,UAAUjJ,QAAqC,UAAtBvB,OAAAc,QAAKC,OAAOsD,GAC5F,CAIC,OAHIpD,KAAK4H,cAAgB5H,KAAKiF,YAAYT,UAAUoD,cACnD5H,KAAK4H,YAAc7I,OAAAc,QAAK8C,MAAO3C,KAAK4H,cAE7B2B,UAAUjJ,QAEjB,KAAK,EACJvB,OAAAc,QAAKwD,SAAUrD,KAAK4H,YAAaxE,GACjC,MAED,KAAK,EACJrE,OAAAc,QAAKwD,SAAUrD,KAAK4H,YAAYxE,GAAQ2F,GACxC,MAED,KAAK,EACJ/I,KAAK4H,YAAYxE,GAAO2F,GAAc9J,EAIxC,OAAOe,KAGR,OAAQoD,EAAepD,KAAK4H,YAAYxE,GAAxBpD,MAUjB2J,QAAS,SAAUM,EAAMC,GAExB,GAAID,EAGH,OAAY,OADR5C,EAAOrH,KAAK2J,YAAQ,IACC,MAEzBtC,EAAY8C,MAAInK,KAAKoK,UACd/C,GAGR,IAAKrH,KAAK4H,cAAgB5H,KAAK2H,SAC9B,OAAO3H,KAAKqH,KAEb,IAAKrH,KAAKW,cACT,MAAO,GAER,IAAIiH,EAAc5H,KAAK4H,YACnByC,EAAOrK,KAAK2H,SAA0C,YAA9B5I,OAAAc,QAAKC,OAAOE,KAAK2H,UAA0B3H,KAAK2H,WAAa3H,KAAK2H,SAAY3H,KAAK4H,YAE3GP,EAAO,GAEX,IAAK,IAAIhH,KAAKL,KAAKqH,KAElB,GAAMhH,KAAKgK,EAAX,CAEA,GAAIzC,GAAeA,EAAYvH,GAC/B,CACC,IAAIiK,EAAK1C,EAAYvH,GAErB,GAAIiK,EAAGhL,MACP,CACC+H,EAAKhH,GAAKL,KAAKqH,KAAKhH,GAAKL,KAAKqH,KAAKhH,GAAGsJ,QAAQO,GAAS,KACvD,SAGD,GAAII,EAAGlK,QACP,CACCiH,EAAKhH,GAAK,GAEV,IAAK,IAAI6C,EAAI,EAAGA,EAAIlD,KAAKqH,KAAKhH,GAAGC,OAAQ4C,IACxCmE,EAAKhH,GAAG6C,GAAKlD,KAAKqH,KAAKhH,GAAG6C,GAAKlD,KAAKqH,KAAKhH,GAAG6C,GAAGyG,QAAQO,GAAS,KAEjE,SAGD,GAAII,EAAGpK,IACP,CACCmH,EAAKhH,GAAKL,KAAKqH,KAAKhH,GAAKL,KAAKqH,KAAKhH,GAAGsJ,UAAY,KAClD,UAIFtC,EAAKhH,GAAKL,KAAKqH,KAAKhH,GAGrB,OAAOgH,GASR7G,OAAQ,SAAUhB,EAAM8I,GAEvB,GAAyB,SAArBvJ,OAAAc,QAAKC,OAAON,GAChB,CACC,IAAK,IAAIa,EAAI,EAAGA,EAAIb,EAAKc,OAAQD,WACzBL,KAAKqH,KAAK7H,EAAKa,SAEnBiI,GAAsBtI,KAAK8H,SAC9B9H,KAAK8I,cAAe,kBAAmB,CAAEW,OAAQjK,gBAI3CQ,KAAKqH,KAAK7H,QAEb8I,GAAsBtI,KAAK8H,SAC9B9H,KAAK8I,cAAe,kBAAmB,CAAEW,OAAQ,CAACjK,MAcrD4I,OAAQ,SAAUqB,EAAQP,GAEzB,GAAIlJ,KAAK8H,QAAS,OAAO9H,KASzB,GAPmB,GAAfA,KAAK+H,SAER/H,KAAK6H,YAAc,IAGpB7H,KAAK+H,SAED0B,GAAiC,UAAvB1K,OAAAc,QAAKC,OAAO2J,GAEzBzJ,KAAKgJ,eAAgBS,EAAQzJ,KAAKqH,KAAKoC,GAASzJ,KAAKqH,KAAKoC,GAASP,QAE/D,GAAIO,GAAiC,SAAvB1K,OAAAc,QAAKC,OAAO2J,GAE9B,IAAK,IAAIpJ,KAAKoJ,EACbzJ,KAAKgJ,eAAgB3I,EAAGL,KAAKqH,KAAKhH,GAAIL,KAAKqH,KAAKhH,GAAI6I,QAIrD,IAAK,IAAI7I,KAAKL,KAAKqH,KAClBrH,KAAKgJ,eAAgB3I,EAAGL,KAAKqH,KAAKhH,GAAIL,KAAKqH,KAAKhH,GAAI6I,GAMtD,QAHOlJ,KAAK+H,QAAW/H,KAAK8H,SAAuC,GAA3B9H,KAAK6H,YAAYvH,aAAemJ,GACvEzJ,KAAK8I,cAAe,eAAgB,CAAEW,OAAQzJ,KAAK6H,cAE7C7H,MAWRuK,SAAU,SAAUd,GAEnB,IAAKzJ,KAAK4H,YAAa,OAAO5H,KAE9B,GAAIyJ,GAAiC,UAAvB1K,OAAAc,QAAKC,OAAO2J,GAEzBzJ,KAAK6I,KAAMY,EAAQzJ,KAAKqH,KAAKoC,SAI7B,IAAK,IAAIpJ,KAAKL,KAAKqH,KAEdoC,OAAU1K,OAAAc,QAAK2B,QAAQiI,EAAQpJ,IAGnCL,KAAK6I,KAAMxI,EAAGL,KAAKqH,KAAKhH,IAI1B,OAAOL,MASRW,YAAa,WAEZ,IAAKX,KAAK4H,YAAa,SAEvB,IAEC,IAAK,IAAIvH,KAAKL,KAAKqH,KAClBrH,KAAKwI,UAAWnI,EAAGL,KAAKqH,KAAKhH,IAE9B,SAED,MAAOjD,IAGP,UAQDoN,QAAS,SAAUC,EAAUtD,EAASC,GAErCpH,KAAK0K,iBAAkB,mBAAqBD,EAAUtD,EAASC,IAQhEuD,UAAW,SAAUF,EAAUtD,EAASC,GAEvCpH,KAAK4K,oBAAqB,mBAAqBH,EAAUtD,EAASC,IAQnEyD,MAAO,SAAUJ,EAAUtD,GAIH,IAFvBsD,EAAWA,EAASnD,MAAM,MAEbhH,SAEZmK,EAAS,GAAKA,EAAS,GACvBA,EAAS,GAAK,SAGfzK,KAAK0K,iBAAkBD,EAAS,GAAG,oBAAoBA,EAAS,IAAI,SAAUnB,EAAKlD,GAClFe,EAASf,EAAKnH,MAAOmH,EAAMkD,OAS7BwB,QAAS,SAAUL,GAGK,IADvBA,EAAWA,EAASnD,MAAM,MACbhH,SAEZmK,EAAS,GAAKA,EAAS,GACvBA,EAAS,GAAK,SAGfzK,KAAK4K,oBAAqBH,EAAS,GAAG,oBAAoBA,EAAS,KAMpEM,QAAS,SAAUvL,EAAMP,EAAM,MAE9B,OAAOe,KAAKrC,IAAI6B,EAAMP,OAQvBW,SAAU,WAET,OAAOb,OAAAc,QAAKmL,UAAUhL,KAAKtC,YAU7B+J,6BAAOkB,YAAcsC,OAAApL,Q,IAErBqL,yCAAezD,6BCttBf1I,OAAAV,cAAA,SAOA8M,yCAAeD,yCAAM3E,OACpB,CAIA9B,UAAW,YAKX2G,MAAOF,yCAKPG,SAAU,KAKVC,OAAQ,KAKRC,OAAQ,KAKR5D,SACA,CACC0D,SAAU,MAMXzD,YACA,CACCyD,SAAU,CACThM,KAAM,QACNe,QAAS,WAOXsE,OAAQ,YAAa0B,GAEpBpG,KAAKsL,OAAS,GACdtL,KAAKuL,OAAS,EAEdvL,KAAKuE,OAAOiH,MAAM9G,UAAU0B,IAM7BiC,MAAO,WAENrI,KAAKyL,YAAc,aAAeC,KAAKC,MAAQ,gBAE/C3L,KAAKqL,SAAWrL,KAAKqH,KAAKgE,UAQ3BO,MAAO,SAAUC,EAAKC,GAGrB,OADIA,GAAQA,EAAKpB,kBAAkBoB,EAAKpB,iBAAkB1K,KAAKyL,YAAazL,KAAK+L,aAAc/L,KAAM6L,GAC9FC,GAQRE,QAAS,SAAUF,GAGlB,OADIA,GAAQA,EAAKlB,qBAAqBkB,EAAKlB,oBAAqB5K,KAAKyL,aAC9DK,GAQRC,aAAc,SAAUzC,EAAKlD,EAAMyF,GAElC7L,KAAKiM,aAAc,cAAe,CAAEzN,GAAIqN,EAAKC,KAAMxC,EAAI9C,SAAU0F,KAAM5C,GACtE6C,QAASnM,KAAKiM,aAAc,eAAgB,CAAExC,OAAQ,CAAC,eAAgB2C,UAQzE9L,OAAQ,WAEP,OAAON,KAAKqH,KAAKgE,SAAS/K,QAQ3B+L,MAAO,WAEN,IAAK,IAAIhM,EAAI,EAAGA,EAAIL,KAAKqH,KAAKgE,SAAUhL,IACvCL,KAAKgM,QAAShM,KAAKqH,KAAKgE,SAAShL,IAUlC,OARAL,KAAKsL,OAAS,GACdtL,KAAKuL,OAAS,EAEdvL,KAAKqL,SAAWrL,KAAKqH,KAAKgE,SAAW,GAErCrL,KAAKiM,aAAc,gBAClBE,QAASnM,KAAKiM,aAAc,eAAgB,CAAExC,OAAQ,CAAC,eAAgB2C,SAEjEpM,MASRsM,QAAS,SAAUjF,GAGlB,GADArH,KAAKqM,SACAhF,EAAM,OAAOrH,KAElB,IAAK,IAAIK,EAAI,EAAGA,EAAIgH,EAAK/G,OAAQD,IACjC,CACC,IAAIyL,EAAO/M,OAAAc,QAAKM,aAAaH,KAAKoL,MAAO/D,EAAKhH,IAE9CL,KAAKsL,OAAOzI,KAAK7C,KAAKuL,UACtBvL,KAAKqH,KAAKgE,SAASxI,KAAKiJ,GAExB9L,KAAK4L,MAAM5L,KAAKuL,OAAO,EAAGO,GAM3B,OAHA9L,KAAKiM,aAAc,gBAClBE,QAASnM,KAAKiM,aAAc,eAAgB,CAAExC,OAAQ,CAAC,eAAgB2C,SAEjEpM,MAQRuM,QAAS,WAER,OAAOvM,KAAKqH,KAAKgE,UAQlBmB,MAAO,SAAUC,GAEhB,OAAIA,EAAQ,GAAKA,GAASzM,KAAKqH,KAAKgE,SAAS/K,OACrC,KAEDN,KAAKqH,KAAKgE,SAASoB,IAQ3BC,SAAU,SAAUD,GAEnB,GAAIA,EAAQ,GAAKA,GAASzM,KAAKqH,KAAKgE,SAAS/K,OAC5C,OAAO,KAER,IAAIwL,EAAO9L,KAAKqH,KAAKgE,SAAS5K,OAAOgM,EAAO,GAAG,GAC3CjO,EAAKwB,KAAKsL,OAAO7K,OAAOgM,EAAO,GAAG,GAOtC,OALAzM,KAAKgM,QAASF,GAEd9L,KAAKiM,aAAc,cAAe,CAAEzN,GAAIA,EAAIsN,KAAMA,IACjDK,QAASnM,KAAKiM,aAAc,eAAgB,CAAExC,OAAQ,CAAC,eAAgB2C,SAEjEN,GASRa,MAAO,SAAUF,EAAOX,GAEvB,QAAIW,EAAQ,GAAKA,GAASzM,KAAKqH,KAAKgE,SAAS/K,SAG7CwL,EAAO/M,OAAAc,QAAKM,aAAaH,KAAKoL,MAAOU,GAErC9L,KAAKgM,QAAQhM,KAAKqH,KAAKgE,SAASoB,IAChCzM,KAAKqH,KAAKgE,SAASoB,GAASX,EAC5B9L,KAAK4L,MAAM5L,KAAKsL,OAAOmB,GAAQX,GAE/B9L,KAAKiM,aAAc,cAAe,CAAEzN,GAAIwB,KAAKsL,OAAOmB,GAAQX,KAAMA,IACjEK,QAASnM,KAAKiM,aAAc,eAAgB,CAAExC,OAAQ,CAAC,eAAgB2C,cAUzEQ,SAAU,SAAUH,GAEnB,QAAIA,EAAQ,GAAKA,GAASzM,KAAKqH,KAAKgE,SAAS/K,SAG7CN,KAAKiM,aAAc,cAAe,CAAEzN,GAAIwB,KAAKsL,OAAOmB,GAAQX,KAAM9L,KAAKqH,KAAKgE,SAASoB,KACpFN,QAASnM,KAAKiM,aAAc,eAAgB,CAAExC,OAAQ,CAAC,eAAgB2C,cAWzEvJ,KAAM,SAAUiJ,GAEf,OAAIA,GAA6B,UAArB/M,OAAAc,QAAKC,OAAOgM,GAChB,MAERA,EAAO/M,OAAAc,QAAKM,aAAaH,KAAKoL,MAAOU,GAErC9L,KAAKsL,OAAOzI,KAAK7C,KAAKuL,UACtBvL,KAAKqH,KAAKgE,SAASxI,KAAMiJ,GACzB9L,KAAK4L,MAAM5L,KAAKuL,OAAO,EAAGO,GAE1B9L,KAAKiM,aAAc,YAAa,CAAEzN,GAAIwB,KAAKsL,OAAOtL,KAAKsL,OAAOhL,OAAO,GAAIwL,KAAMA,EAAMe,SAAU,SAC9FV,QAASnM,KAAKiM,aAAc,eAAgB,CAAExC,OAAQ,CAAC,eAAgB2C,SAEjEN,IAQRgB,IAAK,WAEJ,OAAO9M,KAAKgM,QAAQhM,KAAKqH,KAAKgE,SAASyB,QASxCC,QAAS,SAAUjB,GAElB,OAAIA,GAA6B,UAArB/M,OAAAc,QAAKC,OAAOgM,GAChB,MAERA,EAAO/M,OAAAc,QAAKM,aAAaH,KAAKoL,MAAOU,GAErC9L,KAAKsL,OAAOyB,QAAQ/M,KAAKuL,UACzBvL,KAAKqH,KAAKgE,SAAS0B,QAASjB,GAC5B9L,KAAK4L,MAAM5L,KAAKuL,OAAO,EAAGO,GAE1B9L,KAAKiM,aAAc,YAAa,CAAEzN,GAAIwB,KAAKsL,OAAO,GAAIQ,KAAMA,EAAMe,SAAU,SAC3EV,QAASnM,KAAKiM,aAAc,eAAgB,CAAExC,OAAQ,CAAC,eAAgB2C,SAEjEN,IAQRkB,MAAO,WAEN,OAAOhN,KAAKgM,QAAQhM,KAAKqH,KAAKgE,SAAS2B,UAUxCC,KAAM,SAAU5F,EAAM6F,MAIrB,IAFA,IAAI7B,EAAWrL,KAAKqH,KAAKgE,SAEhBhL,EAAI,EAAGA,EAAIgL,EAAS/K,OAAQD,IAEpC,GAAItB,OAAAc,QAAKyD,eAAgB+H,EAAShL,GAAGgH,KAAMA,GAC1C,OAAO6F,EAAY7B,EAAShL,GAAKA,EAGnC,OAAO6M,EAAY,WC3UrBnO,OAAAV,cAAA,S,iCAasC,C,cACtB2H,G,MACH,CAED2D,QAAS,SAAE1K,EAAemI,GACtB,OAAOnI,GAEbkO,UAAA,SAAAlO,EAAAmI,GAEK,OAAQnI,IAKrB,OAAO+G,EAAAjH,OAAAc,QAAAwD,SAAA+J,EAAApH,GAAAoH,G,yBAILC,6BAAAC,KAAA,CAED3D,QAAS,SAAE1K,EAAemI,GACzB,OAAgB,MAATnI,EAAgBA,EAAMW,WAAa,MAEzCuN,UAAA,SAAAlO,EAAAmI,GACH,aAAAnI,IAAAW,WAAA,S,0BAQEyN,6BAAAC,KAAA,CAED3D,QAAS,SAAE1K,EAAemI,GACzB,QAASnI,GAERkO,UAAA,SAAAlO,EAAAmI,GACH,QAAAnI,M,OAOC,SAAQsO,G,OAERF,6BACAC,KAAA,C,WACMC,E,oBAEL,SAAAtO,GAIA,OAFDe,KAASwN,aAAevO,EAElBe,M,QAKL,SAAaf,EAAAmI,GAIb,OAHAnI,EAAAU,WAAAV,GAEDe,KAAWwN,WAAe,IAAEvO,KAASA,EAAAwO,KAAAC,IAAA,GAAA1N,KAAAwN,aAAAC,KAAAC,IAAA,GAAA1N,KAAAwN,aAC7BvO,GAENkO,UAAA,SAAAlO,EAAAmI,GACH,OAAAzH,WAAAV,O,cAQQ0O,G,oCAEgBL,KAAA,C,SACtBK,E,QACA,SAAA1O,GAGA,OADDe,KAAS4N,SAAU3O,EACbe,M,QAEL,SAAAf,EAAAmI,GAGA,OADDnI,IAAWA,EACHe,KAAG4N,SAAa3O,EAAS,MAAAA,EAAA,GAE/BkO,UAAA,SAAAlO,EAAAmI,GACH,UAAAnI,M,aAQE,W,oCAEyBqO,KAAA,C,QAEP,SAAArO,EAAamI,G,OAEP,MAARnI,EAAoB,G,EACpBA,EAAQW,WACX,YAAAwH,IAEGA,EAAOqF,MAAI,GAEXrF,EAAQyG,QAAQ,IAEnB5O,KAAAmI,EAAAqF,QAEDrF,EAAOyG,QAAahL,KAAC5D,GACxBmI,EAAAqF,MAAAxN,GAAAmI,EAAAyG,QAAAvN,QAIU8G,EAAKqF,MAAQxN,KAEzBkO,UAAA,SAAAlO,EAAAmI,GACN,aAAAnI,GAAA,GAAAA,EAAA,KAAAmI,EAAAyG,UAAA5O,EAAA,O,eAOM6O,G,OACRT,6BAAaC,KAAA,CAEbS,SAAOD,E,kBAEN,K,MACA,SAAAE,GAGY,OADAhO,KAAAiO,OAAcD,EACThO,M,GAER,SAAAX,GAGT,OADDW,KAAQ+N,SAAU1O,EACZW,M,OAEL,SAAAkO,GAIA,OAFDlO,KAASmO,QAAUD,EAEdlO,M,QAIa,SAASf,EAAMmI,G,GAEtB,MAATnI,EAAS,OAAY,K,IAGNuD,EAAE,G,IACjB,IAAAnC,EAAA,EAAAA,EAAApB,EAAAqB,OAAAD,IAEmBL,KAACmO,UAAAnO,KAAAmO,QAAAlP,EAAAoB,OACZmC,EAAAK,KAAA7C,KAAA+N,SAAApE,QAAA1K,EAAAoB,GAAA+G,IAIT,OAAI5E,G,UAIC4L,eAAenP,EAAMmI,GAKd,GAAS,MAATnI,EAAS,YACZ,IAAAuD,EAAA,GACF,QAAAnC,EAAA,EAAAA,EAAApB,EAAAqB,OAAAD,IAAAmC,EAAAK,WAAA7C,KAAA+N,SAAAZ,UAAAlO,EAAAoB,GAAA+G,IACN,OAAA5E,M,OAQO,W,oCAEyB8K,KAAA,C,WAAM,G,SAAQ,SAAQ9N,EAAIH,EAAAgP,EAAA,MAM/C,O,KANiDC,WAAUzL,KAAA,CAAErD,OAAsBgH,OAAAhH,EACnFH,KAAOA,EACVgP,aAIQrO,M,cAAoC,SAAQR,EAAAgH,EAAAnH,EAAAgP,EAAA,MAM7D,O,KAN+DC,WAAUzL,KAAA,CAAErD,OAAsBgH,SACrFnH,KAAOA,EACVgP,aAILrO,M,QAIA,SAAQf,EAAQmI,G,GAEX,MAARnI,EAAQ,Y,IAERuD,E,UAKI+L,SAAmB,CAEvB/L,EAED,GACC,IAAI,IAAInC,EAAA,EAAAA,EAAAL,KAAAsO,WAAAhO,OAAAD,IAAAL,KAAAsO,WAAAjO,GAAAmG,UAAAvH,EAAAuD,EAAAxC,KAAAsO,WAAAjO,GAAAb,MAAAQ,KAAAsO,WAAAjO,GAAAhB,KAAAsK,QAAA1K,EAAAe,KAAAsO,WAAAjO,GAAAmG,QAAAY,GAEH5E,EAAAxC,KAAQsO,WAAWjO,GAACb,MAAUQ,KAACsO,WAEnCjO,GAAIhB,KAAKsK,QAAU3J,KAAIsO,WAAUjO,GAAKgO,SAC9BjH,O,CAIT5E,EAAA,GAEW,IAAQ,IAACnC,EAAA,EAAAA,EAAAL,KAAAsO,WAAAhO,OAAAD,IAAAL,KAAAsO,WAAAjO,GAAAmG,UAAAvH,EAAAuD,EAAAK,KAAA7C,KAAAsO,WAAAjO,GAAAhB,KAAAsK,QAAA1K,EAAAe,KAAAsO,WAAAjO,GAAAmG,QAAAY,IACZ5E,EAAAK,KAAA7C,KAAAsO,WAAAjO,GAAAhB,KAAAsK,QAAA3J,KAAAsO,WAAAjO,GAAAgO,SAAAjH,IAIT,OAAI5E,G,UAIA4L,eAAgBnP,EAASmI,G,GAUnB,M,EAAK,OAAM,KAMT,IAAA5E,EAAQ,GACX,QAAA4E,EAAAmH,SAAA,QAAAlO,EAAA,EAAAA,EAAAL,KAAAsO,WAAAhO,OAAAD,IAAAmC,EAAAxC,KAAAsO,WAAAjO,GAAAb,YAAAQ,KAAAsO,WAAAjO,GAAAhB,KAAA8N,UAAAnN,KAAAsO,WAAAjO,GAAAb,QAAAP,IAAAe,KAAAsO,WAAAjO,GAAAb,MAAAQ,KAAAsO,WAAAjO,GAAAgO,SAAAjH,QACF,QAAAjE,EAAA,EAAAA,EAAAnD,KAAAsO,WAAAhO,OAAA6C,IAAAX,EAAAxC,KAAAsO,WAAAnL,GAAA3D,YAAAQ,KAAAsO,WAAAnL,GAAA9D,KAAA8N,UAAAhK,KAAAlE,IAAAkE,GAAAnD,KAAAsO,WAAAnL,GAAAkL,SAAAjH,GACT,OAAA5E,M,eAQUgM,G,oCAEwBlB,KAAA,C,aACbkB,E,YACV,SAAAC,GAIG,OAFJzO,KAAS0O,aAAeD,EAEbzO,MAGX2J,QAAS,SAAE1K,EAAAmI,GAEnB,OAAgB,MAATnI,EAAgB,KAAOA,EAAM0K,QAASvC,IAEtC+F,UAAAiB,eAAAnP,EAAAmI,GACT,aAAAnI,EAAA,eAAAe,KAAA0O,cAAAvB,UAAAlO,EAAAmI,O,kBAcOuH,EAAQC,G,oCACDtB,KAAA,C,SACZqB,EAEDtP,KAAIuP,E,KAEH,SAASpP,GAET,OADAQ,KAAAyK,SAAYjL,EACZQ,M,GAIA,SAASX,GAIT,OAFAW,KAAKX,KAACA,EAEFW,M,QAGF,SAAMf,EAASmI,G,GAIZ,MAHJnI,EAGS,OAAK,KAGH,IAAAuD,EASZ,WARS4E,EAAAmH,UAED/L,EAAW,GAEfA,EAAAxC,KAAKyK,UAAUzK,KAAOX,KAAKsK,QAAA1K,EAAAe,KAAAyK,UAAArD,IAE1B5E,EAAOxC,KAAAX,KAAAsK,QAAA1K,EAAAe,KAAAyK,UAAArD,GAER5E,G,UAKe4L,eAAEnP,EAAAmI,GACZ,SAAAnI,EAAA,YACF,IAAAuD,EAAA,GAKI,WAJb4E,EAAAmH,SAAA/L,EAAAxC,KAAAyK,gBAAAzK,KAAAX,KAAA8N,UAAAlO,EAAAe,KAAAyK,UAAArD,GAGE5E,EAAAxC,KAAAyK,gBAAAzK,KAAAX,KAAA8N,UAAAlO,EAAAmI,GACW5E,M,mDAYX8K,KAAA,C,QACE,SAASrO,EAAAmI,G,GACH,MAAPnI,EAAe,OAAE,K,QACjBmI,EAAAmH,SAAA,OAAAtP,EAEW,IAAAuD,EAAQ,GACX,QAAAnC,KAAApB,EAEDuD,EAASK,KAAExC,GAEfmC,EAAAK,KAAK5D,EAAQoB,IAKjB,OAAKmC,G,UAKc,SAAEvD,EAAAmI,GACZ,SAAAnI,EAAA,YACF,QAAAmI,EAAAmH,SAAA,OAAAtP,EACT,IAAAuD,EAAA,GAEY,QAAAnC,EACV,EAAAA,EAAApB,EAAAqB,OAAAD,GAAA,EAAAmC,EAAAvD,EAAAoB,IAAApB,EAAAoB,EAAA,GACW,OAAAmC,M,wDAOkC8K,KAAA,C,WAAM,G,MAAI,K,KACvD,SAAWrO,EAACI,GAOZ,OANAW,KAAA6O,WAAAhM,KAAA,CAEKiM,GAAUA,IAChB7P,EACKI,IAEJW,M,KAIA,SAASf,G,OAETe,KAAKf,MAAKA,EAETe,M,QAIW,SAAYf,EAAAmI,GACf,SAAAnI,EAAA,YAED,IAAS,IAAEoB,KAAAL,KAAA6O,WAEf,QAAAxO,EAAK,GAAIL,KAAIf,OAAc,OAAAoB,EAAA,GAAAsJ,QAAA1K,EAAAmI,G,OAI9B,M,UAIkBgH,eAAKnP,EAAAmI,GACf,SAAAnI,EAAA,YAEF,QAAAoB,KAAAL,KAAA6O,WACT,QAAAxO,EAAA,GAAAL,KAAAf,OAAA,aAAAoB,EAAA,GAAA8M,UAAAlO,EAAAmI,GAGF,iB,mHCtaCd,yCAG0BC,OAAA,CAK1B9B,UAAA,c,WAOQ,KASPkF,QAAA,SAAAvC,G,iRC5BD2H,yCAGoBxI,OAAA,C,UAYd,a,eAML,K,MAQA,KAMD7B,OAAA,SAAAsK,GAOAA,MAAAhP,KAAAgP,gBAKKA,IAAYhP,KAAAiP,WAAAC,yCAAAC,SAAA,SAAAC,GAAAF,yCAAAzM,QAAA4M,GAAAL,KAChBhP,KAAKiI,S,cAUI,WACT,IAAIqH,EAAQtP,KAACsP,MAEbtP,KAAKiI,QAGL,QAAO5H,KAAKiP,EAAAtP,KAAAuP,IAAAlP,I,sBAeG,a,MAMf,WAWA,OAVAL,KAAAsP,MAAA,GAEDtP,KAAAwP,wBAQMxP,M,MASJ,WAED,IAAAsP,EAAYtP,KAAAsP,MACZtP,KAAAiI,QAED,QAAA5H,EAAA,EAAAA,EAAAiP,EAAAhP,OAAAD,IAEEL,KACFyP,cAAUH,EACVjP,GAAA,GACC,OAAOL,M,KAiBP,SAAAiC,EAAAyN,GAeA,MAbD,mBAAAzN,EAAAjC,KAAAsP,MAAAK,MAAA,SAAAC,EAAAC,GAKC,OAAYD,EAAA3N,IAAM4N,EAAA5N,MAAc,SAAAyN,KAAA,MAGjC1P,KAAAsP,MAAAK,KAAA1N,GAKKjC,M,SAmBJ,SAAY8P,EAAQC,GACpB,IAAA/P,KAAAsP,MAAA,YAED,QAAAjP,EAAA,EAAAA,EAAAL,KAAAsP,MAAAhP,OAAAD,IAKK,KAAC0P,IAAchR,OAAAc,QAAAyD,eAAAtD,KAAAsP,MAAAjP,GAAA0P,KAGPhR,OAAGc,QAAUyD,eAAAtD,KAAAsP,MAAAjP,GAAAyP,GAAA,OAAA9P,KAAAsP,MAAAjP,GAGzB,OAAI,M,SAWH,W,OAEAL,KAAKsP,O,OAKN,WACA,OAAAtP,KAAAsP,MAAAhP,QAUD0P,QAAA,WAKC,OAAOhQ,KAAKsP,MAAMhP,Q,QASlB,SAAAwL,GAED,OAAA9L,KAAAsP,MAAA9N,QAAAsK,I,MAYC,SAAWW,EAAQwD,MAGnB,OAFIxD,EAAC,GAAqB,GAArBwD,IAA4BxD,GAAAzM,KAAAsP,MAAAhP,QAE1BmM,GAAK,GAAAA,EAAAzM,KAAAsP,MAAAhP,OAAAN,KAAAsP,MAAA7C,GAAA,M,MASZ,WAED,OAAAzM,KAAAwM,MAAA,I,KAaC,WACA,OAAAxM,KAAAwM,UAAA,I,MAcA,SAAYC,EAAAX,GACZ,IAAAA,IAAA9L,KAAAkQ,kBAAApE,GAAA,OAAA9L,KAWA,GATDyM,EAAA,IAAAA,EAAA,GAMKA,EAAKzM,KAAOsP,MACfhP,SAAWmM,EAACzM,KAAAsP,MAAAhP,QAEC,GAATmM,EAAYzM,KAAGsP,MAAKvC,QAAMjB,QAG/B,GAAOW,GAAKzM,KAAAsP,MAAAhP,OAAAN,KAAAsP,MAAAzM,KAAAiJ,OACZ,CAED,IAAAsB,EAAApN,KAAAsP,MAAA7O,OAAA,EAAAgM,GAKKW,EAAIvK,KAACiJ,GAGJ9L,KAAKsP,MAAQlC,EAAA+C,OAAMnQ,KAAQsP,OAGhCtP,KAAOwP,wBAQP,OALDxP,KAAAoQ,YAAAtE,GAKK9L,MASL+M,QAAA,SAAAjB,GAKC,OAAO9L,KAAKqQ,MAAA,EAAAvE,IAgBZjJ,KAAA,SAAAiJ,G,qhCCzWF/M,OAAAV,cAAA,SAiBA,IAAIiS,+BACJ,CAICC,UAOAC,cAAe,SAAUC,EAAUC,EAAUC,EAAWC,KAAcC,EAAK,GAE1E,IAAIC,EAAS,SAAUC,EAAQ,KAAMC,EAAQ,EAAGC,EAAQ,EACpDC,EAAM,GAAIC,EAAQ,GAAIC,EAASD,EAAOE,KAuD1C,SAASC,EAAMjS,EAAMgI,GA8BpB,GA5BY,YAARhI,EAEHgI,EAAOiJ,+BAASE,cAAenJ,EAAMqJ,EAAUC,KAAiB,GAEhD,SAARtR,GAERgI,EAAOiJ,+BAASE,cAAenJ,EAAMqJ,EAAUC,KAAkB,GACjEtR,EAAO,cAEkB,SAArBN,OAAAc,QAAKC,OAAOuH,KAEfhI,EAAOgI,EAAK,GAAGhI,KACfgI,EAAOA,EAAK,GAAGA,OAGA,oBAARhI,EAERgI,EAAOiJ,+BAASE,cAAenJ,EAAKkK,OAAOjK,MAAM,MAAMkK,KAAInR,GAAKA,EAAEkR,SAAQ9P,KAAK,MAAOiP,EAAUC,KAAkB,GAElG,eAARtR,EAERgI,EAAOiJ,+BAASE,cAAenJ,EAAMqJ,EAAUC,KAAkB,GAEjD,mBAARtR,IAERgI,EAAOiJ,+BAASE,cAAenJ,EAAM,IAAK,OAAY,IAG3C,eAARhI,GAAiC,mBAARA,GAAqC,oBAARA,EAEzD,IAAK,IAAIoS,EAAI,EAAGA,EAAIpK,EAAK/G,OAAQmR,IAEhCN,EAAMtO,KAAKwE,EAAKoK,SAIjBN,EAAMtO,KAAK,CAAExD,KAAMA,EAAMgI,KAAMA,IAE5BgK,IAEHD,EAAOvO,KAAKsO,EAAQ,IACpBE,OAAS,IAhGPT,IAEHH,EAAWA,EAASc,OACpBT,EAAS,aACTE,EAAQ,GAERI,EAAOvO,KAAKsO,EAAQ,KAGrBV,GAAY,KA2FZ,IAAK,IAAItN,EAAI,EAAGA,EAAIsN,EAASnQ,OAAQ6C,IAEpC,GAAmB,MAAfsN,EAAStN,GAAb,CAOA,OAAQ6N,GAEP,KAAK,EACe,MAAfP,EAAStN,GAEZ4N,EAAQ,SAEAN,EAAStN,IAAMuN,GAA6B,KAAjBD,EAAStN,EAAE,IAE9C6N,EAAQ,EAAGC,EAAQ,EACnBF,EAAQ,SACRD,EAAS,eAEDL,EAAStN,IAAMuN,GAA6B,KAAjBD,EAAStN,EAAE,IAE9C6N,EAAQ,EAAGC,EAAQ,EACnBF,EAAQ,SACRD,EAAS,mBACT3N,KAEQsN,EAAStN,IAAMuN,GAA6B,KAAjBD,EAAStN,EAAE,IAE9C6N,EAAQ,GAAIC,EAAQ,EACpBF,EAAQ,SACRD,EAAS,SACT3N,KAEQsN,EAAStN,IAAMuN,GAEvBM,EAAQ,EAAGC,EAAQ,EACnBF,EAAQ,SACRD,EAAS,YAITI,GAAOT,EAAStN,GAGjB,MAED,KAAK,EACJ,GAAmB,MAAfsN,EAAStN,GAEZ,MAAM,IAAIzE,MAAO,2CAGlB,GAAI+R,EAAStN,IAAMwN,EACnB,CAGC,GAFAM,IAEIA,EAAQ,EACX,MAAM,IAAIvS,MAAO,0BAA4BiS,GAE9C,GAAa,GAATM,EACJ,CACCD,EAAQ,EACRD,EAAQD,EACR,YAGOL,EAAStN,IAAMuN,GAEvBO,IAGDC,GAAOT,EAAStN,GAChB,MAED,KAAK,GACJ,GAAmB,MAAfsN,EAAStN,GACb,CACC4N,EAAQD,EACR,MAEI,GAAmB,KAAfL,EAAStN,GAClB,CACCmO,EAAMR,EAAQI,GACdI,EAAM,SAAU,KAEhBR,EAAS,aACTI,EAAM,GACN,MAEI,GAA0C,MAAtCT,EAAStN,GAAGuO,uBACrB,CAKC,IAJAX,EAAQD,EACRA,EAAS,aACTO,KAE6C,MAAtCZ,EAAStN,GAAGuO,wBAAgCvO,IACnDA,IAEA,MAEI,GAAIsN,EAAStN,IAAMuN,GAA6B,KAAjBD,EAAStN,EAAE,GAC/C,CACK+N,IAAKH,EAAQD,GACjBE,EAAQ,GAAIC,EAAQ,EAAGH,EAAS,cAChC,MAEI,GAAIL,EAAStN,IAAMuN,GAA6B,KAAjBD,EAAStN,EAAE,GAC/C,CACK+N,IAAKH,EAAQD,GACjBE,EAAQ,GAAIC,EAAQ,EAAGH,EAAS,mBAChC3N,IACA,MAEI,GAAmB,KAAfsN,EAAStN,GAClB,CACK+N,IAAKH,EAAQD,GACjBE,EAAQ,GAAIC,EAAQ,EAAGH,EAAS,cAChC,MAEI,GAAmB,KAAfL,EAAStN,GAClB,CACK+N,IAAKH,EAAQD,GACjBE,EAAQ,GAAIC,EAAQ,EAAGH,EAAS,cAChC,MAEI,GAAmB,KAAfL,EAAStN,GAClB,CACK+N,IAAKH,EAAQD,GACjBE,EAAQ,GAAIC,EAAQ,EAAGH,EAAS,kBAChC,MAEI,GAAIL,EAAStN,IAAMuN,GAA6B,KAAjBD,EAAStN,EAAE,GAC/C,CACK+N,IAAKH,EAAQD,GACjBE,EAAQ,GAAIC,EAAQ,EAAGH,EAAS,SAChC3N,IACA,MAEI,GAAIsN,EAAStN,IAAMuN,EACxB,CACKQ,GAAKI,EAAMR,EAAQI,GACvBF,EAAQ,GAAIC,EAAQ,EAAGC,EAAM,GAAIJ,EAAS,QAC1CI,GAAOT,EAAStN,GAChB,MAGa,cAAV2N,IAEHQ,EAAMR,EAAQI,GACdA,EAAM,GACNJ,EAAS,cAGVI,GAAOT,EAAStN,GAChB,MAED,KAAK,GACJ,GAAmB,MAAfsN,EAAStN,GACZ,MAAM,IAAIzE,MAAO,2CAElB,GAAI+R,EAAStN,IAAMwN,EACnB,CAGC,GAFAM,IAEIA,EAAQ,EACX,MAAM,IAAIvS,MAAO,0BAA4BiS,GAE9C,GAAa,GAATM,IAEHD,EAAQ,GAEM,eAAVF,GAAqC,mBAAVA,GAAyC,oBAAVA,GAC7D,WAGML,EAAStN,IAAMuN,GAEvBO,IAGDC,GAAOT,EAAStN,GAChB,MAED,KAAK,GACJ,GAAmB,MAAfsN,EAAStN,GACZ,MAAM,IAAIzE,MAAO,2CAElB,GAAI+R,EAAStN,IAAMwN,EACnB,CAGC,GAFAM,IAEIA,EAAQ,EACX,MAAM,IAAIvS,MAAO,0BAA4BiS,GAE9C,GAAa,GAATM,EACJ,CACmB,GAAdC,EAAI5Q,QAES,KAAV4Q,EAAI,IAAuB,KAAVA,EAAI,IAAuB,KAAVA,EAAI,KAC3CA,EAAMR,EAAWQ,EAAMP,GAGzBK,EAAQ,EACRD,EAAQD,EACR,YAGOL,EAAStN,IAAMuN,GAEvBO,IAGDC,GAAOT,EAAStN,GAChB,MAED,KAAK,GACJ,GAAmB,MAAfsN,EAAStN,GACZ,MAAM,IAAIzE,MAAO,2CAElB,GAAI+R,EAAStN,IAAMwN,EACnB,CAGC,GAFAM,IAEIA,EAAQ,EACX,MAAM,IAAIvS,MAAO,0BAA4BiS,GAE9C,GAAa,GAATM,EACJ,CACiB,KAAVC,EAAI,IAAuB,KAAVA,EAAI,IAAuB,KAAVA,EAAI,KAC3CA,EAAMR,EAAWQ,EAAMP,GAExBK,EAAQ,GACR,YAGOP,EAAStN,IAAMuN,GAEvBO,IAGDC,GAAOT,EAAStN,GAChB,MAED,KAAK,GACJ,GAAmB,MAAfsN,EAAStN,GAEZ,MAAM,IAAIzE,MAAO,2CAGlB,GAAmB,KAAf+R,EAAStN,GACb,CAGC,GAFA8N,IAEIA,EAAQ,EACX,MAAM,IAAIvS,MAAO,4BAElB,GAAa,GAATuS,IAEHD,EAAQ,GAEM,eAAVF,GAAqC,mBAAVA,GAAyC,oBAAVA,GAC7D,MAIHI,GAAOT,EAAStN,GAChB,MAED,KAAK,GACJ,GAAmB,MAAfsN,EAAStN,GAEZ,MAAM,IAAIzE,MAAO,2CAGlB,GAAmB,KAAf+R,EAAStN,GACb,CAGC,GAFA8N,IAEIA,EAAQ,EACX,MAAM,IAAIvS,MAAO,4BAElB,GAAa,GAATuS,IAEHD,EAAQ,GAEM,eAAVF,GAAqC,mBAAVA,GAAyC,oBAAVA,GAC7D,MAIHI,GAAOT,EAAStN,GAChB,MAED,KAAK,GACJ,GAAmB,MAAfsN,EAAStN,GAEZ,MAAM,IAAIzE,MAAO,2CAGlB,GAAmB,KAAf+R,EAAStN,GACb,CAGC,GAFA8N,IAEIA,EAAQ,EACX,MAAM,IAAIvS,MAAO,4BAElB,GAAa,GAATuS,IAEHD,EAAQ,GAEM,eAAVF,GAAqC,mBAAVA,GAAyC,oBAAVA,GAC7D,MAIHI,GAAOT,EAAStN,GAId4N,IAEHO,EAAMP,EAAOG,GACbH,EAAQG,EAAM,SAjUdA,GAAO,KACPA,GAAOT,IAAWtN,GAoUpB,IAAKyN,EACL,CACC,IAAIvQ,EAAI,EACR,KAAOA,EAAI+Q,EAAO9Q,QAEK,UAAlB8Q,EAAO/Q,GAAGhB,MAAsC,IAAlB+R,EAAO/Q,GAAGgH,MAC3C+J,EAAO3Q,OAAOJ,EAAG,GAMnB,IADAA,EAAI+Q,EAAO9Q,OAAO,EACXD,EAAI,GAEY,UAAlB+Q,EAAO/Q,GAAGhB,MAAsC,IAAlB+R,EAAO/Q,GAAGgH,MAC3C+J,EAAO3Q,OAAOJ,IAAK,GAKA,GAAjB+Q,EAAO9Q,QACV8Q,EAAOvO,KAAK,CAAExD,KAAM,SAAUgI,KAAM,KAMtC,OAHIwJ,GA1bJ,SAASc,EAAU1S,GAElB,GAAqB,iBAAVA,EACX,CACC,GAAIA,aAAiBwD,MAEpB,IAAK,IAAIpC,EAAI,EAAGA,EAAIpB,EAAMqB,OAAQD,IACjCsR,EAAS1S,EAAMoB,SAIhBpB,EAAMoI,KAAOsK,EAAS1S,EAAMoI,MAG7B,OAAOpI,EAGR,IAAK,IAAIoB,EAAI,EAAGA,EAAIpB,EAAMqB,OAAQD,IAEjC,GAAgB,MAAZpB,EAAMoB,GACV,CACC,IAAI/C,EAAI2B,EAAMoB,EAAE,GAEhB,OAAQ/C,GAEP,IAAK,IAAKA,EAAI,KAAM,MACpB,IAAK,IAAKA,EAAI,KAAM,MACpB,IAAK,IAAKA,EAAI,KAAM,MACpB,IAAK,IAAKA,EAAI,KAAM,MACpB,IAAK,IAAKA,EAAI,KAAM,MACpB,IAAK,IAAKA,EAAI,IAAM,MACpB,IAAK,IAAKA,EAAI,IAAM,MACpB,IAAK,IAAKA,EAAI,IAGf2B,EAAQA,EAAME,OAAO,EAAGkB,GAAK/C,EAAI2B,EAAME,OAAOkB,EAAE,GAIlD,OAAOpB,EAvCR,CA2bUmS,GAEHA,GASRQ,MAAO,SAAUnB,GAEhB,OAAOzQ,KAAKwQ,cAAcC,EAASc,OAAQ,IAAK,SAQjDM,MAAO,SAAUV,GAEhB,IAAK,IAAI9Q,EAAI,EAAGA,EAAI8Q,EAAM7Q,OAAQD,IAEZ,YAAjB8Q,EAAM9Q,GAAGhB,OAEZ8R,EAAM1Q,OAAOJ,EAAG,GAChBA,KAIF,OAAO8Q,GASRW,OAAQ,SAAUX,EAAO9J,EAAMZ,EAAI,OAAQsL,EAAK,eAE/C,IAAIC,EAAI,GAGR,GAAY,OAARD,EACJ,CACC,IAAIE,KACAC,KAEArB,EAAOxJ,EACP8K,EAAO,KACPC,KACAlB,EAAM,GAEV,IAAK,IAAI7Q,EAAI,EAAGA,EAAI8Q,EAAM7Q,QAAkB,MAAR+G,EAAchH,IAEjD,OAAQ8Q,EAAM9Q,GAAGhB,MAEhB,IAAK,aACL,IAAK,SACJ6R,GAAOC,EAAM9Q,GAAGgH,KAChB8K,EAAO,KACP,MAED,IAAK,WACJA,EAAOnS,KAAK8R,OAAOX,EAAM9Q,GAAGgH,KAAMwJ,EAAM,MAAO,YAC/CK,GAAuB,iBAATiB,EAAoBA,EAAO,GACzC,MAED,IAAK,cACJjB,GAAOlR,KAAK8R,OAAOX,EAAM9Q,GAAGgH,KAAMwJ,EAAM,MAAO,eAC/CsB,EAAO,KACP,MAED,IAAK,SACJ,GAAKA,GAAwB,iBAATA,EAmCnB9K,EAAO8K,MAlCR,CAGC,IAFW,IAAPjB,IAAWA,EAAM,UAIpB,GAAc,KAAVA,EAAI,GAEPA,EAAMA,EAAI/R,OAAO,GACjB8S,SAEI,IAAc,KAAVf,EAAI,GAMZ,MAJAA,EAAMA,EAAI/R,OAAO,GACjB+S,KAMF,GAAW,QAAPhB,GAAyB,MAAR7J,EACrB,CACC,IAAI+F,EAAM/F,EAGG,QAFbA,EAAO6J,KAAQ7J,EAAQA,EAAK6J,GAAO,OAEdkB,GAEhBlB,KAAOZ,+BAAS+B,YACnBhL,EAAOiJ,+BAAS+B,UAAUnB,GAAM,KAAM,KAAM9D,IAG9CgF,MAMFlB,EAAM,GAKT,KAAc,IAAPA,GAEN,GAAc,KAAVA,EAAI,GAEPA,EAAMA,EAAI/R,OAAO,GACjB8S,SAEI,IAAc,KAAVf,EAAI,GAMZ,MAJAA,EAAMA,EAAI/R,OAAO,GACjB+S,KAMF,GAAW,QAAPhB,EACJ,CACC,IAAIoB,KAeJ,GAbY,MAARjL,EAEG6J,KAAO7J,EAMZA,EAAOA,EAAK6J,IAJZoB,KACAjL,EAAO,MAMRiL,KAEGA,GAA0B,GAAhBnB,EAAM7Q,QAEI,GAAnBgQ,+BAASC,OACZ,MAAM,IAAI7R,MAAO,wBAAwBwS,EAAI,gBAI5B,iBAAT7J,IAEN4K,IACH5K,EAAOA,EAAKkL,aAAc,SAASA,aAAc,QAAQA,aAAc,SAEpEL,IACH7K,EAAO,IAAMA,EAAO,MAGtB2K,EAAEnP,KAAKwE,GAIR,GAAW,UAAPZ,EACJ,CACC,IAAIoK,EAAOxJ,EACP8K,EAAO,KACPC,KACAlB,EAAM,GAEV,IAAK,IAAI7Q,EAAI,EAAGA,EAAI8Q,EAAM7Q,QAAkB,MAAR+G,EAAchH,IAEjD,OAAQ8Q,EAAM9Q,GAAGhB,MAEhB,IAAK,aACL,IAAK,SACJ6R,GAAOC,EAAM9Q,GAAGgH,KAChB8K,EAAO,KACP,MAED,IAAK,WACJA,EAAOnS,KAAK8R,OAAOX,EAAM9Q,GAAGgH,KAAMwJ,EAAM,MAAO,YAC/CK,GAAuB,iBAATiB,EAAoBA,EAAO,GACzC,MAED,IAAK,cACJjB,GAAOlR,KAAK8R,OAAOX,EAAM9Q,GAAGgH,KAAMwJ,EAAM,MAAO,eAC/CsB,EAAO,KACP,MAED,IAAK,SACJ,GAAKA,GAAwB,iBAATA,EAiCnB9K,EAAO8K,MAhCR,CAGC,IAFW,IAAPjB,IAAWA,EAAM,UAIpB,GAAc,KAAVA,EAAI,GAEPA,EAAMA,EAAI/R,OAAO,OAEb,IAAc,KAAV+R,EAAI,GAKZ,MAHAA,EAAMA,EAAI/R,OAAO,GAMnB,GAAW,QAAP+R,GAAyB,MAAR7J,EACrB,CACC,IAAI+F,EAAM/F,EAGG,QAFbA,EAAO6J,KAAQ7J,EAAQA,EAAK6J,GAAO,OAEdkB,GAEhBlB,KAAOZ,+BAAS+B,YACnBhL,EAAOiJ,+BAAS+B,UAAUnB,GAAM,KAAM,KAAM9D,IAG9CgF,MAMFlB,EAAM,GAKT,KAAc,IAAPA,GAEN,GAAc,KAAVA,EAAI,GAEPA,EAAMA,EAAI/R,OAAO,OAEb,IAAc,KAAV+R,EAAI,GAKZ,MAHAA,EAAMA,EAAI/R,OAAO,GAMnB,MAAc,QAAP+R,EAAgB,CAAC7J,EAAM6J,GAAO,KAItC,GAAY,MAARa,EACJ,CACC,IAAI3L,EAAO,GAOX,GALAA,EAAKvD,KAAKyN,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,OAAQ,gBAE9C,IAAIjB,EAAK,KAAMkK,+BAAS+B,YAC3BjM,EAAK,GAAK,IAAIA,EAAK,MAEdA,EAAK,KAAMkK,+BAAS+B,WAC1B,CACC,GAAuB,GAAnB/B,+BAASC,OACZ,MAAM,IAAI7R,MAAO,wBAAwB0H,EAAK,GAAG,gBAElD,MAAO,aAAaA,EAAK,MAG1B,GAAkB,KAAdA,EAAK,GAAG,GACX,OAAOkK,+BAAS+B,UAAUjM,EAAK,IAAK+K,EAAO9J,GAE5C,IAAK,IAAIhH,EAAI,EAAGA,EAAI8Q,EAAM7Q,OAAQD,IACjC+F,EAAKvD,KAAKyN,+BAASwB,OAAOX,EAAM9Q,GAAIgH,EAAM,MAAO,gBAElD2K,EAAEnP,KAAKyN,+BAAS+B,UAAUjM,EAAK,IAAKA,EAAM+K,EAAO9J,IAIlD,GAAY,YAAR0K,EACJ,CACC,GAAoB,GAAhBZ,EAAM7Q,OACV,CACC,GAAuB,GAAnB6Q,EAAM,GAAG7Q,QAAmC,UAApB6Q,EAAM,GAAG,GAAG9R,KACvC,OAAO8R,EAAM,GAAG,GAAG9J,KAEpB,GAAuB,GAAnB8J,EAAM,GAAG7Q,QAAmC,cAApB6Q,EAAM,GAAG,GAAG9R,KACxC,CACC,IAAIG,EAAO2R,EAAM,GAAG,GAAG9J,KAEvB,GAAI7H,KAAQ8Q,+BAAS+B,WAAa,IAAI7S,KAAQ8Q,+BAAS+B,UACtD,OAAO/B,+BAASwB,OAAOX,EAAO9J,EAAMZ,EAAK,MAG3C,OAAO6J,+BAASwB,OAAOX,EAAM,GAAI9J,EAAMZ,EAAK,OAG7C,OAAO6J,+BAASwB,OAAOX,EAAO9J,EAAMZ,EAAK,MAI1C,GAAY,eAARsL,EACJ,CACC,IAAItF,KAEJ,IAAK,IAAIpM,KAAK8Q,EACd,CACC,IAAI/D,EAAM,KAGV,OAFAX,IAEQpM,EAAEhB,MAET,IAAK,WACJ+N,EAAMkD,+BAASwB,OAAOzR,EAAEgH,KAAMA,EAAMZ,EAAK,YACzC,MAED,IAAK,SAAU,IAAK,aACnB2G,EAAM/M,EAAEgH,KACR,MAED,IAAK,cACJ+F,EAAMkD,+BAASwB,OAAOzR,EAAEgH,KAAMA,EAAMZ,EAAK,eAIhC,QAAPA,IAGO,QAAPA,GAAiBgG,GAAS0E,EAAM7Q,OAAO,GAG3C0R,EAAEnP,KAAKuK,KAKT,GAAW,OAAP3G,EAAc,OAAOuL,EAEzB,GAAW,QAAPvL,EAKH,MAHiB,cAAb3G,OAAOkS,KACVA,EAAIA,EAAE,IAEAA,EAIR,GAAW,QAAPvL,EAAe,OAAO,KAG1B,GAAW,OAAPA,EAEH,MAAsB,SAAlB1H,OAAAc,QAAKC,OAAOkS,GAEC,GAAZA,EAAE1R,OACE0R,EAAEvQ,KAAK,IAERuQ,EAAE,GAGHA,EAGR,GAAW,QAAPvL,GAAmC,SAAlB1H,OAAAc,QAAKC,OAAOkS,GACjC,CACC,IAAIQ,EAAKpV,GAAU,MAALA,GAA0B,iBAANA,EAAkB,QAASA,EAAIA,EAAEoU,IAAIgB,GAAG/Q,KAAK,IAAO,SAAUrE,EAAIA,EAAEqE,KAAK,IAAMrE,EAAEwC,WAAexC,EAClI4U,EAAIA,EAAER,IAAIgB,GAAG/Q,KAAK,IAGnB,OAAOuQ,GAQRS,QAAS,SAAUhC,GAIlB,OAFAA,EAAWH,+BAASsB,MAAMnB,GAEnB,SAAUpJ,EAAK,KAAM0K,EAAK,QAChC,OAAOzB,+BAASwB,OAAOrB,EAAUpJ,GAAc,GAAK0K,KAStD3S,KAAM,SAAUqR,EAAUpJ,EAAK,KAAM0K,EAAK,QAGzC,OADAtB,EAAWH,+BAASsB,MAAMnB,GACnBH,+BAASwB,OAAOrB,EAAUpJ,GAAc,GAAK0K,IAQrD9S,MAAO,SAAUkS,EAAO9J,EAAK,MAE5B,MAA6B,SAAtBtI,OAAAc,QAAKC,OAAOqR,GAAoBA,EAAQb,+BAASwB,OAAOX,EAAO9J,GAAc,GAAK,QAQ1FzI,SAAU,SAAUY,EAAMyC,GAEzBqO,+BAAS+B,UAAU7S,GAAQyC,GAQ5BxD,KAAQ,SAAUe,EAAM4G,EAAMiB,EAAK,MAElC,OAAI7H,KAAQ8Q,+BAAS+B,UACb/B,+BAAS+B,UAAU7S,GAAO4G,EAAM,KAAMiB,GAEvC,MAQRqL,eAAgB,SAAUvB,EAAO9J,EAAMhH,EAAE,EAAGsS,MAE3C,IAAIX,EAAI,GACJD,EAAO,EAEX,KAAO1R,EAAI8Q,EAAM7Q,OAAQD,GAAK,EAC9B,CACC,IAAIuS,EAAMtC,+BAASwB,OAAOX,EAAM9Q,GAAIgH,EAAM,OAErC0K,IACqBA,EAArBa,EAAIC,WAAW,KAAa,EAAeD,EAAIE,SAAS,KAAO,EAAI,GAG5D,GAARf,EACHa,EAAMA,EAAIzT,OAAO,GACD,GAAR4S,IACRa,EAAMA,EAAIzT,OAAO,EAAGyT,EAAItS,OAAO,IAG/B0R,EAAEY,GADCD,EACMrC,+BAASwB,OAAOX,EAAM9Q,EAAE,GAAIgH,EAAM,OAElC8J,EAAM9Q,EAAE,GAGnB,OAAO2R,IAWT1B,+BAAS+B,UACT,CAICU,OAAU,SAAS3M,GAAQ,OAAOrI,YAClCiV,KAAQ,SAAS5M,GAAQ,OAAO,MAChC6M,KAAQ,SAAS7M,GAAQ,UACzB8M,MAAS,SAAS9M,GAAQ,UAE1B+M,IAAO,SAAS/M,GAAQ,OAAOA,EAAK,GAAGxG,WAAWU,QAClD8S,IAAO,SAAShN,GAAQ,QAASA,EAAK,IACtC8K,IAAO,SAAS9K,GAAQ,OAAOA,EAAK,GAAGxG,YACvCyT,MAAS,SAASjN,GAAQ,OAAOzG,WAAWyG,EAAK,KACjDkN,IAAO,SAASlN,GAAQ,OAAOmN,OAAOC,aAAapN,EAAK,KACxDqN,IAAO,SAASrN,GAAQ,OAAOA,EAAK,GAAGxG,WAAW8T,WAAW,IAE7DC,IAAO,SAASvN,GAAQ,OAAQA,EAAK,IACrCwN,IAAO,SAASxN,GAAQ,OAAQA,EAAK,IACrCyN,IAAO,SAASzN,GAAQ,OAAOqH,KAAKoG,IAAIzN,EAAK,KAE7C0N,IAAO,SAAS1N,GAAQ,IAAK,IAAI/F,EAAI,EAAGA,EAAI+F,EAAK9F,OAAQD,IAAK,IAAK+F,EAAK/F,GAAI,SAAc,UAC1F0T,GAAM,SAAS3N,GAAQ,IAAK,IAAI/F,EAAI,EAAGA,EAAI+F,EAAK9F,OAAQD,IAAK,KAAM+F,EAAK/F,GAAI,SAAa,UAEzF2T,GAAM,SAAS5N,GAAQ,OAAOA,EAAK,IAAMA,EAAK,IAC9C6N,GAAM,SAAS7N,GAAQ,OAAOA,EAAK,IAAMA,EAAK,IAC9C8N,GAAM,SAAS9N,GAAQ,OAAOA,EAAK,GAAKA,EAAK,IAC7C+N,GAAM,SAAS/N,GAAQ,OAAOA,EAAK,IAAMA,EAAK,IAC9CgO,GAAM,SAAShO,GAAQ,OAAOA,EAAK,GAAKA,EAAK,IAC7CiO,GAAM,SAASjO,GAAQ,OAAOA,EAAK,IAAMA,EAAK,IAC9CkO,UAAa,SAASlO,GAAQ,QAASA,EAAK,IAC5CmO,OAAU,SAASnO,GAAQ,OAAQA,EAAK,IACxCoO,OAAU,SAASpO,GAAQ,OAA4B,GAArB3G,SAAS2G,EAAK,KAEhD,MAAO,SAASA,GAAQ,OAAOA,EAAK,IAAMA,EAAK,IAC/C,MAAO,SAASA,GAAQ,OAAOA,EAAK,IAAMA,EAAK,IAC/C,MAAO,SAASA,GAAQ,OAAOA,EAAK,GAAKA,EAAK,IAC9C,MAAO,SAASA,GAAQ,OAAOA,EAAK,IAAMA,EAAK,IAC/C,MAAO,SAASA,GAAQ,OAAOA,EAAK,GAAKA,EAAK,IAC9C,MAAO,SAASA,GAAQ,OAAOA,EAAK,IAAMA,EAAK,IAC/C,WAAY,SAASA,GAAQ,QAASA,EAAK,IAC3C,QAAS,SAASA,GAAQ,OAAQA,EAAK,IACvC,QAAS,SAASA,GAAQ,OAA4B,GAArB3G,SAAS2G,EAAK,KAE/CqO,OAAU,SAASrO,GAAQ,OAAOrH,OAAAc,QAAKC,OAAOsG,EAAK,KAEnD,IAAK,SAASA,GAAQ,IAAIsO,EAAItO,EAAK,GAAI,IAAK,IAAI/F,EAAI,EAAGA,EAAI+F,EAAK9F,OAAQD,IAAKqU,GAAKtO,EAAK/F,GAAI,OAAOqU,GAClG,IAAK,SAAStO,GAAQ,IAAIsO,EAAItO,EAAK,GAAI,IAAK,IAAI/F,EAAI,EAAGA,EAAI+F,EAAK9F,OAAQD,IAAKqU,GAAKtO,EAAK/F,GAAI,OAAOqU,GAClG,IAAK,SAAStO,GAAQ,IAAIsO,EAAItO,EAAK,GAAI,IAAK,IAAI/F,EAAI,EAAGA,EAAI+F,EAAK9F,OAAQD,IAAKqU,IAAMtO,EAAK/F,GAAI,OAAOqU,GACnG,IAAK,SAAStO,GAAQ,IAAIsO,EAAItO,EAAK,GAAI,IAAK,IAAI/F,EAAI,EAAGA,EAAI+F,EAAK9F,OAAQD,IAAKqU,GAAKtO,EAAK/F,GAAI,OAAOqU,GAClGC,IAAO,SAASvO,GAAQ,IAAIsO,EAAItO,EAAK,GAAI,IAAK,IAAI/F,EAAI,EAAGA,EAAI+F,EAAK9F,OAAQD,IAAKqU,GAAKtO,EAAK/F,GAAI,OAAOqU,GACpGE,IAAO,SAASxO,GAAQ,IAAIsO,EAAItO,EAAK,GAAI,IAAK,IAAI/F,EAAI,EAAGA,EAAI+F,EAAK9F,OAAQD,IAAKqU,GAAKtO,EAAK/F,GAAI,OAAOqU,GACpGG,IAAO,SAASzO,GAAQ,IAAIsO,EAAItO,EAAK,GAAI,IAAK,IAAI/F,EAAI,EAAGA,EAAI+F,EAAK9F,OAAQD,IAAKqU,IAAMtO,EAAK/F,GAAI,OAAOqU,GACrGI,IAAO,SAAS1O,GAAQ,IAAIsO,EAAItO,EAAK,GAAI,IAAK,IAAI/F,EAAI,EAAGA,EAAI+F,EAAK9F,OAAQD,IAAKqU,GAAKtO,EAAK/F,GAAI,OAAOqU,GACpGK,IAAO,SAAS3O,GAAQ,IAAIsO,EAAItO,EAAK,GAAI,IAAK,IAAI/F,EAAI,EAAGA,EAAI+F,EAAK9F,OAAQD,IAAKqU,GAAKtO,EAAK/F,GAAI,OAAOqU,GACpGhH,IAAO,SAAStH,GAAQ,IAAIsO,EAAItO,EAAK,GAAI,IAAK,IAAI/F,EAAI,EAAGA,EAAI+F,EAAK9F,OAAQD,IAAKqU,EAAIjH,KAAKC,IAAIgH,EAAGtO,EAAK/F,IAAK,OAAOqU,GAOhHM,KAAQ,SAAU5O,GAEjB,OAAO6O,KAAKC,UAAU9O,EAAK,KAQ5ByC,KAAQ,SAAUsI,EAAO9J,GAExB,IAAK,IAAIhH,EAAI,EAAGA,EAAE,EAAI8Q,EAAM7Q,OAAQD,GAAK,EACzC,CACC,IAAIpB,EAAQqR,+BAASrR,MAAMkS,EAAM9Q,EAAE,GAAIgH,GAEvC,GAAI8J,EAAM9Q,GAAGC,OAAS,EACtB,CACC,IAAI6U,EAAM7E,+BAASwB,OAAOX,EAAM9Q,GAAIgH,EAAM,UAC/B,MAAP8N,IAAaA,EAAI,GAAGA,EAAI,IAAMlW,QAGlCoI,EAAKiJ,+BAASrR,MAAMkS,EAAM9Q,GAAIgH,IAASpI,EAGzC,MAAO,IAQRmW,OAAU,SAAUjE,EAAO9J,GAE1B,IAAK,IAAIhH,EAAI,EAAGA,EAAI8Q,EAAM7Q,OAAQD,IAEjC,GAAI8Q,EAAM9Q,GAAGC,OAAS,EACtB,CACC,IAAI6U,EAAM7E,+BAASwB,OAAOX,EAAM9Q,GAAIgH,EAAM,UAC/B,MAAP8N,UAAoBA,EAAI,GAAGA,EAAI,gBAG5B9N,EAAKiJ,+BAASrR,MAAMkS,EAAM9Q,GAAIgH,IAGvC,OAAO,MASRkK,KAAQ,SAAUnL,GAEjB,OAAOA,EAAK,GAAyB,iBAAZA,EAAK,GAAkBA,EAAK,GAAGoL,KAAIpU,GAAKA,EAAEmU,SAAUnL,EAAK,GAAGmL,OAAU,IAQhG7P,MAAS,SAAU0E,GAElB,OAAOA,EAAK,GAAyB,iBAAZA,EAAK,GAAkBA,EAAK,GAAGoL,KAAIpU,GAAKA,EAAEuE,gBAAiByE,EAAK,GAAGzE,cAAiB,IAQ9GC,MAAS,SAAUwE,GAElB,OAAOA,EAAK,GAAyB,iBAAZA,EAAK,GAAkBA,EAAK,GAAGoL,KAAIpU,GAAKA,EAAEyE,gBAAiBuE,EAAK,GAAGvE,cAAiB,IAS9G1C,OAAU,SAAUiH,GAEnB,IAAI4L,EAAI5L,EAAKA,EAAK9F,OAAO,GAAGV,WAExByV,EAAQ,EACRpE,EAAQ,KAmBZ,OAjBmB,GAAf7K,EAAK9F,QAER+U,IAAWjP,EAAK,GAChB6K,IAAW7K,EAAK,KAIhBiP,IAAWjP,EAAK,GAChB6K,EAAQ,MAGLoE,EAAQ,IAAGA,GAASrD,EAAE1R,QACtB2Q,EAAQ,IAAGA,GAASe,EAAE1R,QAEZ,OAAV2Q,IACHA,EAAQe,EAAE1R,OAAS+U,GAEbrD,EAAE7S,OAAOkW,EAAOpE,IAQxBsB,QAAW,SAAUnM,GAEpB,OAAOA,EAAK,GAAGkB,MAAMlB,EAAK,IAAI3E,KAAK2E,EAAK,KAQzCkP,MAAS,SAAUlP,GAElB,OAAOA,EAAK,GAAyB,iBAAZA,EAAK,GAAkBA,EAAK,GAAGoL,KAAIpU,GAAKA,EAAEmV,cAAe,WAAYnM,EAAK,GAAGmM,cAAe,SAAY,IAQlI,IAAK,SAAUnM,GAEdA,EAAK4G,QACL,IAAIxN,EAAO4G,EAAK4G,QAEhB,IAAIgF,EAAI,GAER,IAAK,IAAI3R,EAAI,EAAGA,EAAI+F,EAAK9F,OAAQD,IAEhC,GAA4B,SAAxBtB,OAAAc,QAAKC,OAAOsG,EAAK/F,IACrB,CACC2R,GAAK,IAAIxS,KAET,IAAK,IAAI0D,EAAI,EAAGA,EAAIkD,EAAK/F,GAAGC,OAAQ4C,IACnC8O,GAAK5L,EAAK/F,GAAG6C,GAEd8O,GAAK,KAAKxS,UAGVwS,GAAK,IAAIxS,KAAQ4G,EAAK/F,OAAOb,KAG/B,OAAOwS,GAQR,KAAM,SAAU5L,GAEfA,EAAK4G,QACL,IAAIxN,EAAO4G,EAAK4G,QAEhB,IAAIuI,EAAO,GACPnR,EAAO,GAEX,IAAK,IAAI/D,EAAI,EAAGA,EAAI+F,EAAK9F,OAAQD,GAAK,EAEjCA,EAAE,EAAI+F,EAAK9F,OACdiV,GAAQ,IAAInP,EAAK/F,OAAO+F,EAAK/F,EAAE,MAE/B+D,EAAOgC,EAAK/F,GAGd,OAAO+D,EAAO,IAAI5E,IAAO+V,KAAQnR,MAAS5E,KAAU,IAAIA,IAAO+V,OAQhE9T,KAAQ,SAAU2E,GAEjB,OAAIA,EAAK,IAA8B,SAAxBrH,OAAAc,QAAKC,OAAOsG,EAAK,IACxBA,EAAK,GAAG3E,KAAK2E,EAAK,IAEnB,IAQRkB,MAAS,SAAUlB,GAElB,OAAIA,EAAK,IAAyB,iBAAZA,EAAK,GACnBA,EAAK,GAAGkB,MAAMlB,EAAK,IAEpB,IAQRiE,KAAQ,SAAUjE,GAEjB,OAAIA,EAAK,IAAyB,iBAAZA,EAAK,GACnB5I,OAAO6M,KAAKjE,EAAK,IAElB,IAQRoP,OAAU,SAAUpP,GAEnB,OAAIA,EAAK,IAAyB,iBAAZA,EAAK,GACnB5I,OAAOgY,OAAOpP,EAAK,IAEpB,IAWRqP,MAAS,SAAUtE,EAAO9J,GAEzB,IAAIqO,EAAWpF,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,OAC3CX,EAAO4J,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,OAEvC2K,EAAI,GACJ9O,EAAI,EAER,IAAKwD,EAAM,OAAOsL,EAElB,IAAK,IAAI3R,KAAKqG,EAEbW,EAAKqO,GAAYhP,EAAKrG,GACtBgH,EAAKqO,EAAW,MAAQxS,IACxBmE,EAAKqO,EAAW,KAAOrV,EAEvB2R,GAAK1B,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,QAOtC,cAJOA,EAAKqO,UACLrO,EAAKqO,EAAW,aAChBrO,EAAKqO,EAAW,KAEhB1D,GAYR2D,SAAY,SAAUxE,EAAO9J,GAE5B,IAAIqO,EAAWpF,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,OAC3CX,EAAO4J,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,OAEvCnE,EAAI,EAER,IAAKwD,EAAM,OAAO,KAElB,IAAK,IAAIrG,KAAKqG,EAEbW,EAAKqO,GAAYhP,EAAKrG,GACtBgH,EAAKqO,EAAW,MAAQxS,IACxBmE,EAAKqO,EAAW,KAAOrV,EAEvBiQ,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,QAOjC,cAJOA,EAAKqO,UACLrO,EAAKqO,EAAW,aAChBrO,EAAKqO,EAAW,KAEhB,MASR,KAAM,SAAUvE,EAAO9J,GAEtB,OAAIiJ,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,OAC5BiJ,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,OAEpC8J,EAAM7Q,OAAS,EACXgQ,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,OAEjC,IAQR,MAAO,SAAU8J,EAAO9J,GAGvB,OADYiJ,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,QAGrCiJ,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,QAQxCuO,IAAO,SAAUzE,EAAO9J,GAEvB,IAAK,IAAIhH,EAAI,EAAGA,EAAI8Q,EAAM7Q,OAAQD,GAAK,EACvC,CACC,GAA8C,QAA1CiQ,+BAASwB,OAAOX,EAAM9Q,GAAIgH,EAAM,OACnC,OAAOiJ,+BAASwB,OAAOX,EAAM9Q,EAAE,GAAIgH,EAAM,QAE1C,GAAIiJ,+BAASwB,OAAOX,EAAM9Q,EAAE,GAAIgH,EAAM,OACrC,OAAOiJ,+BAASwB,OAAOX,EAAM9Q,EAAE,GAAIgH,EAAM,QAG3C,MAAO,IAQRwO,QAAW,SAAU1E,EAAO9J,GAE3B,IAAIpI,EAAQqR,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,OAE5C,IAAK,IAAIhH,EAAI,EAAGA,EAAI8Q,EAAM7Q,OAAQD,GAAK,EACvC,CACC,IAAIyV,EAAaxF,+BAASwB,OAAOX,EAAM9Q,GAAIgH,EAAM,OACjD,GAAIyO,GAAc7W,GAAuB,WAAd6W,EAC1B,OAAOxF,+BAASwB,OAAOX,EAAM9Q,EAAE,GAAIgH,EAAM,QAG3C,MAAO,IAQR0O,OAAU,SAAU5E,EAAO9J,GAE1B,MAAM,IAAI3I,MAAM,cAQjBsX,UAAa,SAAU7E,EAAO9J,GAE7B,MAAM,IAAI3I,MAAM,iBAQjBuX,QAAW,SAAU9E,EAAO9J,GAE3B,GAAI8J,EAAM7Q,OAAS,GAA2B,IAAN,EAAf6Q,EAAM7Q,QAC9B,MAAO,yCAER,IAAIoV,EAAWpF,+BAASrR,MAAMkS,EAAM,GAAI9J,GACpC4J,EAAQ,KACR/E,EAAO,EAAGgK,EAAK,KACfC,EAAO,KAEX,IAAK,IAAI9V,EAAI,EAAGA,EAAI8Q,EAAM7Q,OAAO,EAAGD,GAAG,EAItC,OAFYiQ,+BAASrR,MAAMkS,EAAM9Q,GAAIgH,GAEvBxF,eAEb,IAAK,OACJqK,EAAOvM,WAAW2Q,+BAASrR,MAAMkS,EAAM9Q,EAAE,GAAIgH,IAC7C,MAED,IAAK,KACJ6O,EAAKvW,WAAW2Q,+BAASrR,MAAMkS,EAAM9Q,EAAE,GAAIgH,IAC3C,MAED,IAAK,QACJ4J,EAAQtR,WAAW2Q,+BAASrR,MAAMkS,EAAM9Q,EAAE,GAAIgH,IAC9C,MAED,IAAK,OACJ8O,EAAOxW,WAAW2Q,+BAASrR,MAAMkS,EAAM9Q,EAAE,GAAIgH,IAKhD,IAAI+O,EAAMjF,EAAMA,EAAM7Q,OAAO,GACzB2C,EAAM,GAEV,GAAW,OAAPiT,EAKH,GAHa,OAATC,IACHA,EAAOjK,EAAOgK,KAAU,GAErBC,EAAO,EAEV,IAAK,IAAI9V,EAAI6L,EAAM7L,GAAK6V,EAAI7V,GAAK8V,EAEhC,IACC9O,EAAKqO,GAAYrV,EACjB4C,EAAIJ,KAAKyN,+BAASrR,MAAMmX,EAAK/O,IAC5B,MAAOjK,GACR,IAAIoC,EAAOpC,EAAEwL,QACb,GAAY,aAARpJ,EAAqB,MACzB,GAAY,gBAARA,EAAwB,SAC5B,MAAMpC,OAMR,IAAK,IAAIiD,EAAI6L,EAAM7L,GAAK6V,EAAI7V,GAAK8V,EAEhC,IACC9O,EAAKqO,GAAYrV,EACjB4C,EAAIJ,KAAKyN,+BAASrR,MAAMmX,EAAK/O,IAC5B,MAAOjK,GACR,IAAIoC,EAAOpC,EAAEwL,QACb,GAAY,aAARpJ,EAAqB,MACzB,GAAY,gBAARA,EAAwB,SAC5B,MAAMpC,OAKL,GAAc,OAAV6T,EACT,CACc,OAATkF,IACHA,EAAO,GAER,IAAK,IAAI9V,EAAI6L,EAAM+E,EAAQ,EAAGA,IAAS5Q,GAAK8V,EAE3C,IACC9O,EAAKqO,GAAYrV,EACjB4C,EAAIJ,KAAKyN,+BAASrR,MAAMmX,EAAK/O,IAC5B,MAAOjK,GACR,IAAIoC,EAAOpC,EAAEwL,QACb,GAAY,aAARpJ,EAAqB,MACzB,GAAY,gBAARA,EAAwB,SAC5B,MAAMpC,OAKT,CACc,OAAT+Y,IACHA,EAAO,GAER,IAAK,IAAI9V,EAAI6L,GAAQ7L,GAAK8V,EAEzB,IACC9O,EAAKqO,GAAYrV,EACjB4C,EAAIJ,KAAKyN,+BAASrR,MAAMmX,EAAK/O,IAE9B,MAAOjK,GACN,IAAIoC,EAAOpC,EAAEwL,QACb,GAAY,aAARpJ,EAAqB,MACzB,GAAY,gBAARA,EAAwB,SAC5B,MAAMpC,GAMT,cADOiK,EAAKqO,GACLzS,GAQRoT,KAAQ,SAAUlF,EAAO9J,GAExB,GAAI8J,EAAM7Q,OAAS,GAA2B,IAAN,EAAf6Q,EAAM7Q,QAC9B,MAAO,sCAER,IAAIoV,EAAWpF,+BAASrR,MAAMkS,EAAM,GAAI9J,GACpC4J,EAAQ,KACR/E,EAAO,EAAGgK,GAAK,KACnB,IAAIC,EAAO,KAEX,IAAK,IAAI9V,EAAI,EAAGA,EAAI8Q,EAAM7Q,OAAO,EAAGD,GAAG,EAItC,OAFApB,MAAQqR,+BAASrR,MAAMkS,EAAM9Q,GAAIgH,GAEzBpI,MAAM4C,eAEb,IAAK,OACJqK,EAAOvM,WAAW2Q,+BAASrR,MAAMkS,EAAM9Q,EAAE,GAAIgH,IAC7C,MAED,IAAK,KACJ6O,GAAKvW,WAAW2Q,+BAASrR,MAAMkS,EAAM9Q,EAAE,GAAIgH,IAC3C,MAED,IAAK,QACJ4J,EAAQtR,WAAW2Q,+BAASrR,MAAMkS,EAAM9Q,EAAE,GAAIgH,IAC9C,MAED,IAAK,OACJ8O,EAAOxW,WAAW2Q,+BAASrR,MAAMkS,EAAM9Q,EAAE,GAAIgH,IAKhD,IAAI+O,EAAMjF,EAAMA,EAAM7Q,OAAO,GAE7B,GAAW,OAAP4V,GAKH,GAHa,OAATC,IACHA,EAAOjK,EAAOgK,MAAU,GAErBC,EAAO,EAEV,IAAK,IAAI9V,EAAI6L,EAAM7L,GAAK6V,GAAI7V,GAAK8V,EAEhC,IACC9O,EAAKqO,GAAYrV,EACjBiQ,+BAASrR,MAAMmX,EAAK/O,GACnB,MAAOjK,GACR,IAAIoC,EAAOpC,EAAEwL,QACb,GAAY,aAARpJ,EAAqB,MACzB,GAAY,gBAARA,EAAwB,SAC5B,MAAMpC,OAMR,IAAK,IAAIiD,EAAI6L,EAAM7L,GAAK6V,GAAI7V,GAAK8V,EAEhC,IACC9O,EAAKqO,GAAYrV,EACjBiQ,+BAASrR,MAAMmX,EAAK/O,GACnB,MAAOjK,GACR,IAAIoC,EAAOpC,EAAEwL,QACb,GAAY,aAARpJ,EAAqB,MACzB,GAAY,gBAARA,EAAwB,SAC5B,MAAMpC,OAKL,GAAc,OAAV6T,EACT,CACc,OAATkF,IACHA,EAAO,GAER,IAAK,IAAI9V,EAAI6L,EAAM+E,EAAQ,EAAGA,IAAS5Q,GAAK8V,EAE3C,IACC9O,EAAKqO,GAAYrV,EACjBiQ,+BAASrR,MAAMmX,EAAK/O,GACnB,MAAOjK,GACR,IAAIoC,EAAOpC,EAAEwL,QACb,GAAY,aAARpJ,EAAqB,MACzB,GAAY,gBAARA,EAAwB,SAC5B,MAAMpC,OAKT,CACc,OAAT+Y,IACHA,EAAO,GAER,IAAK,IAAI9V,EAAI6L,GAAQ7L,GAAK8V,EAEzB,IACC9O,EAAKqO,GAAYrV,EACjBiQ,+BAASrR,MAAMmX,EAAK/O,GAErB,MAAOjK,GACN,IAAIoC,EAAOpC,EAAEwL,QACb,GAAY,aAARpJ,EAAqB,MACzB,GAAY,gBAARA,EAAwB,SAC5B,MAAMpC,GAMT,cADOiK,EAAKqO,GACL,MAQRY,MAAS,SAAUnF,EAAO9J,GAEzB,GAAI8J,EAAM7Q,OAAS,EAClB,MAAO,uCAER,IAAI8V,EAAMjF,EAAM,GAEhB,WAGEb,+BAASrR,MAAMmX,EAAK/O,GAErB,MAAOjK,GACN,IAAIoC,EAAOpC,EAAEwL,QACb,GAAY,aAARpJ,EAAqB,MACzB,GAAY,gBAARA,EAAwB,SAC5B,MAAMpC,EAIR,OAAO,MAQRmZ,MAAS,SAAUpF,EAAO9J,GAEzB,IAAI2K,EAAI,GAER,IAAK,IAAI3R,EAAI,EAAGA,EAAI8Q,EAAM7Q,OAAQD,IACjC2R,GAAK1B,+BAASwB,OAAOX,EAAM9Q,GAAIgH,EAAM,OAGtC,OADAmP,QAAQC,IAAIzE,GACL,IAQR,KAAM,SAAUb,EAAO9J,GAEtB,IAAI2K,EAAI,GAER,IAAK,IAAI3R,EAAI,EAAGA,EAAI8Q,EAAM7Q,OAAQD,IACjC2R,EAAEnP,KAAKyN,+BAASwB,OAAOX,EAAM9Q,GAAIgH,EAAM,QAExC,OAAO2K,GAQR,MAAO,SAAUb,EAAO9J,GAEvB,IAAI2K,EAAI,GAER,IAAK,IAAI3R,EAAI,EAAGA,EAAI8Q,EAAM7Q,OAAQD,IACjC2R,EAAEnP,KAAKsO,EAAM9Q,IAEd,OAAO2R,GASR,KAAM,SAAUb,EAAO9J,GAEtB,OAAOiJ,+BAASoC,eAAgBvB,EAAO9J,EAAM,OAS9C,MAAO,SAAU8J,EAAO9J,GAEvB,OAAOiJ,+BAASoC,eAAgBvB,EAAO9J,EAAM,OAQ9CqP,SAAY,SAAUtQ,EAAM+K,EAAO9J,GAElC,IAAIpI,EAAQmH,EAAK,GAEjB,GAAqB,iBAAVnH,EAGV,OADAoI,EAAKsP,IAAM,2BAIZ,IAAI3E,EAAI,GAER,IAAK,IAAI3R,EAAI,EAAGA,EAAI+F,EAAK9F,OAAQD,IAE1B+F,EAAK/F,KAAMpB,IAChB+S,GAAK,KAAK5L,EAAK/F,IAGjB,MAAS,IAAL2R,IAEH3K,EAAKsP,IAAM3E,EAAE7S,OAAO,QAYtBuK,IAAO,SAAUtD,EAAM+K,EAAO9J,GAE7B,IAAIpI,EAAQmH,EAAK,GAEjB,MAA0B,UAAtBrH,OAAAc,QAAKC,OAAOb,IAGTmH,EAAK,KAAMnH,GAQnB2X,KAAQ,SAAUzF,EAAO9J,GAExB,IAAIqO,EAAWpF,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,OAE3CX,EAAO4J,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,OAC3C,IAAKX,EAAM,OAAOA,EAElB,IAAImQ,EAAiC,SAArB9X,OAAAc,QAAKC,OAAO4G,GACxB3D,EAAS8T,EAAY,GAAK,GAC1B3T,EAAI,EAER,IAAK,IAAI7C,KAAKqG,EAEbW,EAAKqO,GAAYhP,EAAKrG,GACtBgH,EAAKqO,EAAW,MAAQxS,IACxBmE,EAAKqO,EAAW,KAAOrV,EAEnBwW,EACH9T,EAAOF,KAAKyN,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,QAE5CtE,EAAO1C,GAAKiQ,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,OAO9C,cAJOA,EAAKqO,UACLrO,EAAKqO,EAAW,aAChBrO,EAAKqO,EAAW,KAEhB3S,GAQRoL,QAAW,SAAUgD,EAAO9J,GAE3B,IAAIqO,EAAWpF,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,OAE3CX,EAAO4J,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,OAC3C,IAAKX,EAAM,OAAOA,EAElB,IAAImQ,EAAiC,SAArB9X,OAAAc,QAAKC,OAAO4G,GACxB3D,EAAS8T,EAAY,GAAK,GAC1B3T,EAAI,EAER,IAAK,IAAI7C,KAAKqG,EAEbW,EAAKqO,GAAYhP,EAAKrG,GACtBgH,EAAKqO,EAAW,MAAQxS,IACxBmE,EAAKqO,EAAW,KAAOrV,IAEjBiQ,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,SAEjCwP,EACH9T,EAAOF,KAAK6D,EAAKrG,IAEjB0C,EAAO1C,GAAKqG,EAAKrG,IAQpB,cAJOgH,EAAKqO,UACLrO,EAAKqO,EAAW,aAChBrO,EAAKqO,EAAW,KAEhB3S,GASR+O,OAAU,SAAU1L,EAAM+K,EAAO9J,GAEhC,OAAOiJ,+BAASwB,OAAQxB,+BAASE,cAAepK,EAAK,GAAI,IAAK,KAAqB,GAAfA,EAAK9F,OAAc8F,EAAK,GAAKiB,IAQlGyP,MAAS,SAAU3F,EAAO9J,GAEzB,IAAI8N,EAAM7E,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,UAE1C,IAAK8N,GAAiC,mBAAnBA,EAAI,GAAGA,EAAI,IAC7B,MAAM,IAAIzW,MAAO,iCAAmC4R,+BAASwB,OAAOX,EAAM,GAAI9J,EAAM,OAAOmK,KAAInR,GAAU,MAALA,EAAY,IAAMA,IAAGoB,KAAK,KAE/H,IAAI2E,EAAO,GAEX,IAAK,IAAI2Q,EAAI,EAAGA,EAAI5F,EAAM7Q,OAAQyW,IACjC3Q,EAAKvD,KAAKyN,+BAASrR,MAAMkS,EAAM4F,GAAI1P,IAEpC,OAAO8N,EAAI,GAAGA,EAAI,OAAQ/O,K,IAI5B4Q,yCAAe1G,+BTz2DR,MAAM2G,0CAAOlY,OAAAc,QACPqX,0CAAQ5Q,yCACR6Q,yCAAQC,yCACRC,0CAAkB3P,yCAClB4P,0CAAQpM,yCACRqM,0CAAYpM,yCACZqM,0CAAStI,yCACTuI,0CAAc1I,yCACd2I,0CAAaC,yCACbC,0CAAWZ,4CUhBxB,IAAAa,OAAAxZ,cAAA,SCJAwZ,OAAAxZ,cAAA,SAEA,MAAMyZ,0BAAM,CAAC7Y,EAAOyV,IAAoB,YAAbzV,EAAQyV,GAC7BqD,0BAAM,CAAC9Y,EAAOyV,IAAMzV,IAAWyV,EAAM,WACrCsD,0BAAM,CAAC/Y,EAAOyV,IAAMzV,GAAUyV,EAAK;;CAQnCuD,6BAASJ,OAAAK,MAAM3R,OACpB,CAIAyK,MAAO,KAKPvE,MAAO,EAMP0L,KAAM,EAKNlH,MAAO,EAQPvM,OAAQ,SAASyT,EAAK,YAErBnY,KAAKoY,QAAQD,IASdC,QAAS,SAASnZ,GAEjBe,KAAKmY,KAAOlZ,EAEZe,KAAKyM,MAAQ,EACbzM,KAAKiR,MAAQ,EAEbjR,KAAKgR,MAAQ,CACZ,WAAY,WAAY,WAAY,WACpC,WAAY,WAAY,WAAY,WACpC,WAAY,WAAY,WAAY,UACpC,WAAY,WAAY,WAAY,YAGrC,IAAK,IAAI3Q,EAAI,EAAGA,EAAIL,KAAKgR,MAAM1Q,OAAQD,IACtCL,KAAKgR,MAAM3Q,GAAKyX,0BAAI9X,KAAKgR,MAAM3Q,GAAIL,KAAKmY,MAEzC,OAAOnY,MAORqY,UAAW,WAEV,IAAIzI,EAAGC,EAAGyI,EAAGC,EAgBb,OAdAvY,KAAKiR,MAAQjR,KAAMiR,MAAQ,EAAK,WAEhCrB,EAAI5P,KAAKgR,MAAMhR,KAAKyM,OACpB6L,EAAItY,KAAKgR,MAAMhR,KAAMyM,MAAQ,GAAM,IACnCoD,EAAIiI,0BAAIA,0BAAIA,0BAAIlI,EAAG0I,GAAIN,0BAAIpI,EAAG,KAAMoI,0BAAIM,EAAG,KAC3CA,EAAItY,KAAKgR,MAAMhR,KAAMyM,MAAQ,EAAK,IAClC6L,EAAIR,0BAAIQ,EAAGP,0BAAIO,EAAG,KAClB1I,EAAI5P,KAAKgR,MAAMhR,KAAKyM,OAASqL,0BAAIjI,EAAGyI,GACpCC,EAAIT,0BAAIlI,EAAe,WAAZoI,0BAAIpI,EAAG,IAElB5P,KAAKyM,MAAQzM,KAAMyM,MAAQ,GAAM,GACjCmD,EAAI5P,KAAKgR,MAAMhR,KAAKyM,OAEpBzM,KAAKgR,MAAMhR,KAAKyM,OAASqL,0BAAIA,0BAAIA,0BAAIA,0BAAIA,0BAAIlI,EAAGC,GAAI0I,GAAIP,0BAAIpI,EAAG,IAAKoI,0BAAInI,EAAG,KAAMmI,0BAAIM,EAAG,KACxD,WAAzBtY,KAAKgR,MAAMhR,KAAKyM,QAOxB+L,UAAW,WAEV,OAA0B,MAAnBxY,KAAKqY,aAObI,SAAU,WAET,OAA0B,IAAnBzY,KAAKqY,aAObK,UAAW,WAEV,OAAO1Y,KAAKqY,YAAc,c,IAI5BM,yCAAeV;;ACvHfW,yCACA,CACCC,UAAW;;AAEXC,IAAK;;AAELC,MAAO;;AAEPC,MAAO;;AAEPC,KAAM;;AAENC,IAAK;;AAELC,MAAO;;AAGPC,KAAM;;AAENC,KAAM;;AAGNC,IAAK;;AAELC,KAAM;;AAGNC,IAAK;;AAELC,IAAK;;AAGLC,KAAM;;AAENC,GAAI;;AAEJC,MAAO;;AAEPC,KAAM;;AAGNC,SAAU;;AAEVC,UAAW;;AAEXC,aAAc;;AAEdC,UAAW;;AAEXC,QAAS;;AAGTC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAEPC,MAAO;;AAGPC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAEJC,GAAI;;AAGJC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAEHC,EAAG;;AAGHC,UAAW;;AAEXC,MAAO;;AAEPC,MAAO;;AAGPC,SAAU;;AAEVC,SAAU;;AAEVC,UAAW;;AAGXC,UAAW;;AAEXC,MAAO;;AAGPC,MAAO;;AAEPC,IAAK;;AAELC,MAAO,KChLR9F,OAAAxZ,cAAA,SCAAwZ,OAAAxZ,cAAA,SCAA,MAAMuf,0CAAsB,GAC5B,IAAIC,wCAAoB,EAExB,MAAMC,+BAAW,GACjB5f,eAAO6f,SAAWD,+B,IAClBE,yCAAeF;qBAkBfA;+BAASG,SAAW,SAAUC,EAAaC,EAAY,KAAMC,EAAY,MAExE,IAAKF,EAAY1Z,UAAUC,UAC1B,MAAM,IAAI/F,MAAO,0DAElB,KAAM,WAAYwf,EAAY1Z,WAC7B,MAAM,IAAI9F,MAAO,mBAAmBwf,EAAY1Z,UAAUC,UAAU,8BAErE,KAAM,SAAUyZ,EAAY1Z,WAC3B,MAAM,IAAI9F,MAAO,mBAAmBwf,EAAY1Z,UAAUC,UAAU,4BAEjD,OAAhB2Z,IACHA,EAAchL,IAAkB,KAAd+K,IAEnBP,0CAAoBM,EAAY1Z,UAAUC,WAAayZ,EAEvDA,EAAYG,aAAe,IAAI5b,MAAM0b,GAAaG,KAAK,MACvDJ,EAAYK,gBAAkBJ,EAE9BD,EAAY1Z,UAAUga,SAAW,EACjCN,EAAY1Z,UAAUia,WAAa,EAEnCP,EAAYQ,qBAAuB,EACnCR,EAAYS,gBAAkB,EAC9BT,EAAYU,iBAAmB,EAC/BV,EAAYW,gBAAkB,EAC9BX,EAAYY,eAAiB,EAC7BZ,EAAYa,eAAiB,EAE7B,IAAIC,GAAe,EAKnBd,EAAYe,YAAc,SAAUC,EAAQ,MAE3C,GAAIF,EACH,OAED,IAAIzhB,EAAgB,OAAZ2hB,EAAmBd,EAAc3Q,KAAK0R,IAAID,EAASd,GAE3D,IAAK,IAAI/d,EAAI,EAAGA,EAAI9C,EAAG8C,IAEtB6d,EAAYG,aAAaH,EAAYY,kBAAoB,IAAIZ,EAC7DL,0CAGDmB,GAAe,GAOhBd,EAAYkB,SAAW,WAEtB,IAAItT,EAmBJ,OAjB4B,IAAxB9L,KAAK8e,gBAERhT,EAAO,IAAIoS,EACXA,EAAYS,oBAIZ7S,EAAO9L,KAAKqe,eAAere,KAAK8e,gBAChCZ,EAAYU,oBAGbV,EAAYa,iBAEZjT,EAAK0S,WAAaxe,KAAK0e,qBACvB5S,EAAK2S,WAAa,EAElBze,KAAK0e,sBAAwB,WACtB5S,GAQRoS,EAAYmB,MAAQ,SAASja,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAEhH,OAAOqY,EAAYkB,WAAWjX,KAAK/C,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,IAOxEqY,EAAY1Z,UAAU8a,KAAO,WAE5B,OAAItf,KAAKwe,SAAW,EACZxe,KAEc,IAAlBA,KAAKwe,UAERhI,QAAQ+I,MAAO,uCAAyCrB,EAAY1Z,UAAUC,WACvEzE,SAGFA,KAAKye,WAAa,IAGxBze,KAAK2E,SACL3E,KAAKwe,SAAW,EAEZN,EAAYY,gBAAkBX,EACjCD,EAAYW,kBAEZX,EAAYG,aAAaH,EAAYY,kBAAoB9e,KAE1Dke,EAAYa,kBAVJ/e,OAmBTke,EAAY1Z,UAAUgb,aAAe,SAAUvgB,GAI9C,OAFAe,KAAKwe,SAAW/Q,KAAKoG,IAAI7T,KAAKwe,UAC1Bvf,IAAOe,KAAKwe,UAAYxe,KAAKwe,UAC1Bxe,MAQRke,EAAY1Z,UAAUib,YAAc,SAAUxO,EAAM,GAGnD,OADAjR,KAAKye,YAAcxN,EACZjR,OAST8d,+BAAS4B,UAAY,SAAUlgB,EAAK,MAEnC,IAAIkH,EAAOkX,0CAIX,GAFApH,QAAQC,IAAI,uBAAyBoH,0CAExB,IAATre,EAAJ,CAgBA,GAAa,OAATA,EACJ,CACC,GAAqB,iBAAVA,EACX,CACC,IAAI8Y,EAAIsF,0CAAoBpe,GAE5B,YADAgX,QAAQmJ,MAAOngB,EAAO,MAAW8Y,EAAEqG,gBAAgBrG,EAAEiG,gBAAzB,KAA2CqB,QAAQ,GAAG,mBAAqBtH,EAAEqG,gBAAkB,YAAYrG,EAAEyG,eAAe,WAAazG,EAAE+F,aAAa/d,OAAS,cAAgBgY,EAAEsG,iBAAmB,iBAAmBtG,EAAEwG,eAAiB,aAAexG,EAAEuG,gBAAkB,YAAcvG,EAAEiG,gBAAkBjG,EAAEwG,iBAIhVpY,EAAOlH,EAGRgX,QAAQqJ,MAAM,wBAEd,IAAK,IAAIxf,KAAKqG,EACd,CACC,IAAI4R,EAAI5R,EAAKrG,GACRiY,EAAEqG,iBAEPnI,QAAQmJ,MAAOtf,EAAI,MAAWiY,EAAEqG,gBAAgBrG,EAAEiG,gBAAzB,KAA2CqB,QAAQ,GAAG,mBAAqBtH,EAAEqG,gBAAkB,YAAYrG,EAAEyG,eAAe,WAAazG,EAAE+F,aAAa/d,OAAS,cAAgBgY,EAAEsG,iBAAmB,iBAAmBtG,EAAEwG,eAAiB,aAAexG,EAAEuG,gBAAkB,YAAcvG,EAAEiG,gBAAkBjG,EAAEwG,iBAG7UtI,QAAQsJ,eAtCR,CAECtJ,QAAQqJ,MAAM,wBAEd,IAAK,IAAIxf,KAAKqG,EACd,CACC,IAAI4R,EAAI5R,EAAKrG,GACRiY,EAAEqG,iBAEPnI,QAAQmJ,MAAOtf,EAAI,MAAWiY,EAAEqG,gBAAgBrG,EAAEiG,gBAAzB,KAA2CqB,QAAQ,GAAG,mBAAqBtH,EAAEqG,gBAAkB,YAAYrG,EAAEyG,eAAe,WAAazG,EAAE+F,aAAa/d,OAAS,cAAgBgY,EAAEsG,iBAAmB,iBAAmBtG,EAAEwG,eAAiB,aAAexG,EAAEuG,gBAAkB,YAAcvG,EAAEiG,gBAAkBjG,EAAEwG,iBAG7UtI,QAAQsJ,aAuCVhC,+BAASiC,WAAa,SAAU7B,EAAaC,EAAY,KAAMC,EAAY,MAE1E,MAAM5e,EAAO0e,EAAY1Z,UAAUC,UACnC,IAAKjF,EAAM,MAAM,IAAId,MAAO,wDAE5B,MAAMshB,EAAO9B,EAAY3X,OACxB,CACA9B,UAAWyZ,EAAY1Z,UAAUC,UAEjCC,OAAQ,aAGRyD,KAAM,SAAS/C,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAGlG,OADA7F,KAAKuE,OAAO/E,GAAMkF,OAAOU,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,GACtD7F,QAOT,OAHA8d,+BAASG,SAAS+B,EAAM7B,EAAaC,GACrCF,EAAY8B,KAAOA,EAEZ9B,GASRJ,+BAASmB,YAAc,SAAUgB,EAAyB,MAEzDpC,wCAAoB,EAEpB,IAAK,IAAIxd,KAAKud,0CACbA,0CAAoBvd,GAAG4e,YAAYgB,GAEpC,OAAOpC;;;AD9PR,MAAMqC,+BAAWrI,OAAAK,MAAM3R,OACtB,CACA9B,UAAW,WAMXwE,KAAM,KAMNlC,KAAM,KAMN9H,MAAO,KAMPyF,OAAQ,SAAUzF,GAEjBe,KAAKf,MAAQA,EACbe,KAAKqM,SAMN1H,OAAQ,WAEP3E,KAAKmgB,UAON9T,MAAO,WAGN,OADArM,KAAK+G,KAAO/G,KAAKiJ,KAAO,KACjBjJ,MAORogB,UAAW,SAAUjL,GAEpBnV,KAAKiJ,KAAOkM,EACZnV,KAAK+G,KAAOoO,EAAMA,EAAIpO,KAAO,KAEzBoO,IAECA,EAAIpO,OAAMoO,EAAIpO,KAAKkC,KAAOjJ,MAC9BmV,EAAIpO,KAAO/G,OAQbqgB,WAAY,SAAUlL,GAErBnV,KAAKiJ,KAAOkM,EAAMA,EAAIlM,KAAO,KAC7BjJ,KAAK+G,KAAOoO,EAERA,IAECA,EAAIlM,OAAMkM,EAAIlM,KAAKlC,KAAO/G,MAC9BmV,EAAIlM,KAAOjJ,OAQbmgB,OAAQ,WAKP,OAHIngB,KAAKiJ,OAAMjJ,KAAKiJ,KAAKlC,KAAO/G,KAAK+G,MACjC/G,KAAK+G,OAAM/G,KAAK+G,KAAKkC,KAAOjJ,KAAKiJ,MAE9BjJ,KAAKqM;;;iBAcd2R;yCAAS+B,WAAYG,+BAAU,MAAO,M,IACtCI,yCAAeJ;;;aDxGf;MAAMK,2BAAO1I,OAAAK,MAAM3R,OAClB,CAIA9B,UAAW,OAMX+b,IAAK,KAMLC,OAAQ,KAMRngB,OAAQ,EAMRoE,OAAQ,WAEP1E,KAAKwgB,IAAM,KACXxgB,KAAKygB,OAAS,KACdzgB,KAAKM,OAAS,GAOfqE,OAAQ,WAEP3E,KAAKiI,SAONtF,MAAO,WAEN,IAAI+D,EAAO6Z,2BAAKP,KAAKX,QAErB,IAAK,IAAIhf,EAAIL,KAAKwgB,IAAKngB,EAAGA,EAAIA,EAAE0G,KAC/BL,EAAK7D,KAAKgV,OAAA6I,KAAK/d,MAAMtC,EAAEpB,QAExB,OAAOyH,GAOR2F,MAAO,WAEN,IAAIhM,EAAGsgB,EAEP,IAAKtgB,EAAIL,KAAKwgB,IAAKngB,EAAGA,EAAIsgB,EAEzBA,EAAKtgB,EAAE0G,KACP6Z,QAAQvgB,EAAEif,OAAOrgB,OAMlB,OAHAe,KAAKwgB,IAAMxgB,KAAKygB,OAAS,KACzBzgB,KAAKM,OAAS,EAEPN,MAORiI,MAAO,WAEN,IAAI5H,EAAGsgB,EAEP,IAAKtgB,EAAIL,KAAKwgB,IAAU,MAALngB,EAAWA,EAAIsgB,EAEjCA,EAAKtgB,EAAE0G,KACP1G,EAAEif,OAMH,OAHAtf,KAAKwgB,IAAMxgB,KAAKygB,OAAS,KACzBzgB,KAAKM,OAAS,EAEPN,MAORoS,MAAO,WAEN,OAAoB,OAAbpS,KAAKwgB,IAAexgB,KAAKwgB,IAAIvhB,MAAQ,MAO7CkT,KAAM,WAEL,OAAuB,OAAhBnS,KAAKygB,OAAkBzgB,KAAKygB,OAAOxhB,MAAQ,MAOnDuN,MAAO,SAAUC,GAEhB,IAAIpM,EAAI,KACR,IAAKA,EAAIL,KAAKwgB,IAAKngB,GAAKoM,KAAU,EAAGpM,EAAIA,EAAE0G,MAC3C,OAAY,MAAL1G,EAAYA,EAAEpB,MAAQ,MAO9B4hB,UAAW,SAAUpU,GAEpB,IAAIpM,EAAI,KACR,IAAKA,EAAIL,KAAKwgB,IAAKngB,GAAKoM,IAASpM,EAAIA,EAAE0G,MACvC,OAAO1G,GAORygB,SAAU,SAAU7hB,GAEnB,IAAK,IAAIoB,EAAIL,KAAKwgB,IAAKngB,EAAGA,EAAIA,EAAE0G,KAC/B,GAAI1G,EAAEpB,QAAUA,EAAO,OAAOoB,EAE/B,OAAO,MAORG,OAAQ,SAAUH,GAKjB,OAHS,MAALA,GAAcigB,yCAASS,WAAW1gB,KACrCA,EAAIL,KAAK8gB,SAASzgB,IAEdA,GAEAA,EAAE4I,OAAMjJ,KAAKwgB,IAAMngB,EAAE0G,MACrB1G,EAAE0G,OAAM/G,KAAKygB,OAASpgB,EAAE4I,MAE7BjJ,KAAKM,SACED,EAAEif,OAAOrgB,OAND,MAahB+hB,aAAc,SAAU7L,EAAKlW,GAE5B,IAAKkW,EAAK,OAAOnV,KAEjB,IAAIK,EAAIigB,yCAASN,KAAKX,MAAMpgB,GAM5B,OALAoB,EAAEggB,WAAYlL,GAEVA,GAAOnV,KAAKwgB,MAAKxgB,KAAKwgB,IAAMngB,GAChCL,KAAKM,SAEErB,GAORgiB,YAAa,SAAU9L,EAAKlW,GAE3B,IAAKkW,EAAK,OAAOnV,KAEjB,IAAIK,EAAIigB,yCAASN,KAAKX,MAAMpgB,GAM5B,OALAoB,EAAE+f,UAAWjL,GAETA,GAAOnV,KAAKygB,SAAQzgB,KAAKygB,OAASpgB,GACtCL,KAAKM,SAEErB,GAOR8N,QAAS,SAAU9N,GAElB,IAAIoB,EAAIigB,yCAASN,KAAKX,MAAMpgB,GAQ5B,OANAoB,EAAEggB,WAAYrgB,KAAKwgB,KACdxgB,KAAKygB,SAAQzgB,KAAKygB,OAASpgB,GAEhCL,KAAKwgB,IAAMngB,EACXL,KAAKM,SAEErB,GAOR+N,MAAO,WAEN,IAAI3M,EAAIL,KAAKwgB,IACb,OAAKngB,IAECL,KAAKwgB,IAAMngB,EAAE0G,QAAO/G,KAAKygB,OAAS,MACxCzgB,KAAKM,SAEED,EAAEif,OAAOrgB,OALD,MAYhB4D,KAAM,SAAU5D,GAEf,IAAIoB,EAAIigB,yCAASN,KAAKX,MAAMpgB,GAQ5B,OANAoB,EAAE+f,UAAWpgB,KAAKygB,QACbzgB,KAAKwgB,MAAKxgB,KAAKwgB,IAAMngB,GAE1BL,KAAKygB,OAASpgB,EACdL,KAAKM,SAEErB,GAOR6N,IAAK,WAEJ,IAAIzM,EAAIL,KAAKygB,OACb,OAAKpgB,IAECL,KAAKygB,OAASpgB,EAAE4I,QAAOjJ,KAAKwgB,IAAM,MACxCxgB,KAAKM,SAEED,EAAEif,OAAOrgB,OALD,MAYhBiiB,OAAQ,SAAUxa,GAEjB,IAAK,IAAIrG,EAAIqG,EAAK8Z,IAAKngB,EAAGA,EAAIA,EAAE0G,KAC/B/G,KAAK6C,KAAKxC,EAAEpB,OAEb,OAAOe,MAQRmhB,QAAS,SAAUlf,EAAImF,EAAQ,MAE9B,IAAIuZ,EAEJ,IAAK,IAAItgB,EAAIL,KAAKwgB,IAAKngB,EAAGA,EAAIsgB,EAG7B,GADAA,EAAKtgB,EAAE0G,MACgC,IAAnC9E,EAAI5B,EAAEpB,MAAOoB,EAAGL,KAAMoH,GAAoB,OAAO,EAGtD,OAAO,GAQRga,WAAY,SAAUnf,EAAImF,EAAQ,MAEjC,IAAIuZ,EAEJ,IAAK,IAAItgB,EAAIL,KAAKygB,OAAQpgB,EAAGA,EAAIsgB,EAGhC,GADAA,EAAKtgB,EAAE4I,MACgC,IAAnChH,EAAI5B,EAAEpB,MAAOoB,EAAGL,KAAMoH,GAAoB,OAAO,EAGtD,OAAO,GAOR6F,KAAM,SAAUhL,EAAImF,EAAQ,MAE3B,IAAK,IAAI/G,EAAIL,KAAKwgB,IAAKngB,EAAGA,EAAIA,EAAE0G,KAC/B,GAAI9E,EAAG5B,EAAEpB,MAAOmI,GAAU,OAAO/G,EAAEpB,MAEpC,OAAO,MAORoiB,OAAQ,SAAUpf,EAAImF,EAAQ,MAE7B,IAAIV,EAAO6Z,2BAAKP,KAAKX,QAErB,IAAK,IAAIhf,EAAIL,KAAKwgB,IAAKngB,EAAGA,EAAIA,EAAE0G,KAC3B9E,EAAG5B,EAAEpB,MAAOmI,IAAUV,EAAK7D,KAAKxC,EAAEpB,OAEvC,OAAOyH,GAOR4a,QAAS,WAER,IAAIC,EAAQ,GAEZ,IAAK,IAAIlhB,EAAIL,KAAKwgB,IAAKngB,EAAGA,EAAIA,EAAE0G,KAC/Bwa,EAAM1e,KAAKxC,EAAEpB,OAEd,OAAOsiB;;;iBAcTvD;yCAAS+B,WAAYQ,2BAAM,MAAO,M,IAClCiB,yCAAejB;cGnXf;MAAMkB,4BAAQ,SAAUC,EAAOC,EAAUzT,GAExClO,KAAKkO,SAAWA,EAChBlO,KAAK2hB,SAAWA,EAChB3hB,KAAK0hB,MAAQA,EACb1hB,KAAK4hB,OAAS,KAEd5hB,KAAK6hB,WAAY,EACjB7hB,KAAK8hB,UAAY,EACjB9hB,KAAK+hB,MAAQ,EACb/hB,KAAKgiB,MAAQ,EACbhiB,KAAKiiB,MAAQ,EACbjiB,KAAKkiB,OAAS,EAEdliB,KAAKmiB,WAAa,KACjBniB,KAAKoiB,aAGNpiB,KAAKqiB,aAAe,KACnBriB,KAAKsiB,WAOPb,4BAAMjd,UAAU4d,UAAY,WAE3B,IAAKpiB,KAAK6hB,UAAW,OAErB7hB,KAAK+hB,MAAQQ,QAAUviB,KAAK8hB,UAE5B,IAAIU,EAASxiB,KAAK+hB,OAAS/hB,KAAKgiB,MAAQhiB,KAAK2hB,UACzCa,EAAS,EAEZxiB,KAAKyiB,UAAUD,IAIhBxiB,KAAKgiB,OAAShiB,KAAK2hB,UAAY,EAAIvO,IAAIoP,EAASxiB,KAAK2hB,WAErD3hB,KAAKkiB,OAASM,EAAS,EAAIxiB,KAAK2hB,SAAY3hB,KAAK+hB,MAAQ/hB,KAAKiiB,MAC9DjiB,KAAKiiB,MAAQjiB,KAAK+hB,MAElB/hB,KAAKyiB,SAASziB,KAAMgiB,MAAQhiB,KAAK2hB,UAAaY,QAAUviB,KAAK8hB,YAC7D9hB,KAAKkO,SAASlO,KAAKkiB,OAAQliB,QAW5ByhB,4BAAMjd,UAAU6Q,MAAQ,SAAUqN,GAAU,EAAOC,EAAM,GAEpD3iB,KAAK6hB,YAET7hB,KAAK8hB,UAAYS,QACjBviB,KAAK6hB,WAAY,EAEjB7hB,KAAKgiB,MAAQ,EACbhiB,KAAKiiB,MAAQ,EAEbjiB,KAAK4iB,YAEDF,GACH1iB,KAAKkO,SAAU,EAAGlO,MAEnBA,KAAKyiB,SAASziB,KAAK2hB,SAASgB,KAQ7BlB,4BAAMjd,UAAUie,SAAW,SAAUI,GAEb7iB,KAAK0hB,MAE3BoB,sBAAsB9iB,KAAKqiB,eAIxBriB,KAAK4hB,QACRmB,aAAa/iB,KAAK4hB,QAEnB5hB,KAAK4hB,OAAS1f,WAAWlC,KAAKmiB,WAAYU,KAQ3CpB,4BAAMjd,UAAU8d,OAAS,WAEpBtiB,KAAK4hB,QACRmB,aAAa/iB,KAAK4hB,QAEnB5hB,KAAK4hB,OAAS1f,WAAWlC,KAAKmiB,WAAY,IAQ3CV,4BAAMjd,UAAUwe,KAAO,WAEjBhjB,KAAK6hB,YAEN7hB,KAAK4hB,SAERmB,aAAa/iB,KAAK4hB,QAClB5hB,KAAK4hB,OAAS,MAGf5hB,KAAK6hB,WAAY,EACjB7hB,KAAKijB,cAQNxB,4BAAMjd,UAAUoe,UAAY,aAS5BnB,4BAAMjd,UAAUye,UAAY,a,IAI5BC,yCAAezB,4BCxJf5J,OAAAxZ,cAAA,SCAAwZ,OAAAxZ,cAAA,SCAAwZ,OAAAxZ,cAAA;;;AAWA,MAAM8kB,2BAAOtL,OAAAK,MAAM3R,OAClB,CACA9B,UAAW,OAOXiQ,EAAG,EAAG0O,EAAG,EAUT1e,OAAQ,SAAUgQ,EAAE,KAAM0O,EAAE,MAE3B,OAAOpjB,KAAKrC,IAAI+W,EAAG0O,IAOpBzgB,MAAO,WAEN,OAAOwgB,2BAAKnD,KAAKX,MAAMrf,OAWxBrC,IAAK,SAAU+W,EAAG0O,EAAE,MAEnB,GAAU,OAAN1O,EACHA,EAAI,EACJ0O,EAAI,OAEA,GAAU,OAANA,EAAY,CACpB,IAAIpV,EAAI0G,EACRA,EAAI1G,EAAE0G,EACN0O,EAAIpV,EAAEoV,EAMP,OAHApjB,KAAK0U,EAAIA,EACT1U,KAAKojB,EAAIA,EAEFpjB,MAORqjB,KAAM,SAAU3O,GAGf,OADA1U,KAAK0U,EAAIA,EACF1U,MAORsjB,KAAM,SAAUF,GAGf,OADApjB,KAAKojB,EAAIA,EACFpjB,MAORujB,KAAM,WAEL,OAAOvjB,KAAKrC,IAAI,EAAG,IAOpB6lB,OAAQ,WAEP,OAAiB,GAAVxjB,KAAK0U,GAAoB,GAAV1U,KAAKojB,GAW5BK,OAAQ,SAAU/O,EAAG0O,EAAE,MAEtB,GAAU,OAANA,EACJ,CACC,IAAIpV,EAAI0G,EACRA,EAAI1G,EAAE0G,EACN0O,EAAIpV,EAAEoV,EAGP,OAAOpjB,KAAK0U,GAAKA,GAAK1U,KAAKojB,GAAKA,GAOjCxP,IAAK,WAGJ,OADA5T,KAAK0U,GAAK1U,KAAK0U,EAAG1U,KAAKojB,GAAKpjB,KAAKojB,EAC1BpjB,MAOR0jB,IAAK,WAGJ,OADA1jB,KAAK0U,EAAI,EAAI1U,KAAK0U,EAAG1U,KAAKojB,EAAI,EAAIpjB,KAAKojB,EAChCpjB,MAOR6T,IAAK,WAIJ,OAFA7T,KAAK0U,EAAI1U,KAAK0U,EAAI,GAAK1U,KAAK0U,EAAI1U,KAAK0U,EACrC1U,KAAKojB,EAAIpjB,KAAKojB,EAAI,GAAKpjB,KAAKojB,EAAIpjB,KAAKojB,EAC9BpjB,MAWR2jB,UAAW,SAAUC,EAAIC,EAAG,MAE3B,GAAW,OAAPA,EACJ,CACC,IAAI7V,EAAI4V,EACRA,EAAK5V,EAAE0G,EACPmP,EAAK7V,EAAEoV,EAIR,OADApjB,KAAK0U,GAAKkP,EAAI5jB,KAAKojB,GAAKS,EACjB7jB,MAWR8jB,OAAQ,SAAUC,EAAOC,EAAG,EAAGC,EAAG,GAEjC,IAAIvP,GAAK1U,KAAK0U,EAAIsP,GAAIvW,KAAKyW,IAAIH,IAAU/jB,KAAKojB,EAAIa,GAAIxW,KAAK0W,IAAIJ,GAC3DX,GAAKpjB,KAAKojB,EAAIa,GAAIxW,KAAKyW,IAAIH,IAAU/jB,KAAK0U,EAAIsP,GAAIvW,KAAK0W,IAAIJ,GAK/D,OAHA/jB,KAAK0U,EAAIA,EAAIsP,EACbhkB,KAAKojB,EAAIA,EAAIa,EAENjkB,MAWRuP,IAAK,SAAUqU,EAAIC,EAAG,MAErB,GAAW,OAAPA,EACJ,CACC,IAAI7V,EAAI4V,EACRA,EAAK5V,EAAE0G,EACPmP,EAAK7V,EAAEoV,EAIR,OADApjB,KAAK0U,GAAKkP,EAAI5jB,KAAKojB,GAAKS,EACjB7jB,MAWR8U,IAAK,SAAU8O,EAAIC,EAAG,MAErB,GAAW,OAAPA,EACJ,CACC,IAAI7V,EAAI4V,EACRA,EAAK5V,EAAE0G,EACPmP,EAAK7V,EAAEoV,EAIR,OADApjB,KAAK0U,GAAKkP,EAAI5jB,KAAKojB,GAAKS,EACjB7jB,MAeR2iB,MAAO,SAAUyB,EAAIC,EAAG,MAEvB,GAAW,OAAPA,EAEH,GAAIlB,2BAAKpC,WAAWqD,GAAK,CACxB,IAAIpW,EAAIoW,EACRA,EAAKpW,EAAE0G,EACP2P,EAAKrW,EAAEoV,OAEPiB,EAAKD,EAKP,OADApkB,KAAK0U,GAAK0P,EAAIpkB,KAAKojB,GAAKiB,EACjBrkB,MAORskB,MAAO,WAKN,OAHAtkB,KAAK0U,EAAItB,IAAIpT,KAAK0U,GAClB1U,KAAKojB,EAAIhQ,IAAIpT,KAAKojB,GAEXpjB,MAORukB,MAAO,WAKN,OAHAvkB,KAAK0U,EAAI1U,KAAK0U,EAAItB,IAAIpT,KAAK0U,GAC3B1U,KAAKojB,EAAIpjB,KAAKojB,EAAIhQ,IAAIpT,KAAKojB,GAEpBpjB,MAWRwkB,IAAK,SAAU9P,EAAG0O,EAAE,MAEnB,GAAU,OAANA,EACJ,CACC,IAAIpV,EAAI0G,EACRA,EAAI1G,EAAE0G,EACN0O,EAAIpV,EAAEoV,EAGP,OAAOpjB,KAAK0U,EAAEA,EAAI1U,KAAKojB,EAAEA,GAO1BqB,UAAW,SAAUC,GAAQ,GAE5B,OAAOA,EAAW1kB,KAAK0U,EAAE1U,KAAK0U,EAAI1U,KAAKojB,EAAEpjB,KAAKojB,EAAK3V,KAAKkX,KAAK3kB,KAAK0U,EAAE1U,KAAK0U,EAAI1U,KAAKojB,EAAEpjB,KAAKojB,IAO1FwB,UAAW,WAEV,OAAO5kB,KAAKwjB,SAAWxjB,KAAOA,KAAK2iB,MAAO,EAAI3iB,KAAKykB,cAOpDI,UAAW,WAGV,OADIpX,KAAKoG,IAAI7T,KAAK0U,GAAKjH,KAAKoG,IAAI7T,KAAKojB,GAAIpjB,KAAKojB,EAAI,EAAQpjB,KAAK0U,EAAI,EAC5D1U,MAOR8kB,UAAW,WAGV,OADIrX,KAAKoG,IAAI7T,KAAK0U,GAAKjH,KAAKoG,IAAI7T,KAAKojB,GAAIpjB,KAAKojB,EAAI,EAAQpjB,KAAK0U,EAAI,EAC5D1U,MAOR+kB,KAAM,WAIL,OAFA/kB,KAAK0U,EAAK1U,KAAK0U,EAAS1U,KAAK0U,EAAI,GAAI,EAAK,EAAvB,EACnB1U,KAAKojB,EAAKpjB,KAAKojB,EAASpjB,KAAKojB,EAAI,GAAI,EAAK,EAAvB,EACZpjB,MAORJ,SAAU,WAET,MAAO,IAAII,KAAK0U,MAAM1U,KAAKojB;;;iBAkB7BpF;yCAAS+B,WAAYoD,2BAAM,KAAM,M,IACjC6B,yCAAe7B;;oBD7Xf;MAAM8B,2BAAO,IAAIC,aAAa,GAAG5G,KAAK,GAChC6G,4BAAQ,IAAID,aAAa,GAAG5G,KAAK,GAQjC8G,6BAASvN,OAAAK,MAAM3R,OACpB,CACA9B,UAAW,SAMX4C,KAAM,KAcN3C,OAAQ,SAASzF,EAAM,MAEJ,OAAde,KAAKqH,OACRrH,KAAKqH,KAAO,IAAI6d,aAAa,IAEhB,OAAVjmB,EACHe,KAAKrC,IAAIsB,GAETe,KAAKqlB,YAOP9B,KAAM,WAGL,OADAvjB,KAAKqH,KAAKiX,KAAK,GACRte,MAORse,KAAM,SAAUrf,GAGf,OADAe,KAAKqH,KAAKiX,KAAKrf,GACRe,MAWRrC,IAAK,SAAUsB,GAad,OAXImmB,6BAAOrE,WAAW9hB,GAGrBe,KAAKqH,KAAK1J,IAAIsB,EAAMoI,MAKpBrH,KAAKqH,KAAK1J,IAAIsB,GAGRe,MAORqlB,SAAU,SAAUC,EAAO,MAQ1B,OANe,OAAXA,IACHA,EAAStlB,KAAKqH,MAEfie,EAAOhH,KAAK,GACZgH,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAAK,EAE7BtlB,MAORulB,OAAQ,SAAUC,GAEjB,IAAK,IAAInlB,EAAI,EAAGA,EAAI,EAAGA,IAAKL,KAAKqH,KAAKhH,IAAMmlB,EAC5C,OAAOxlB,MAOR2C,MAAO,WAEN,OAAOyiB,6BAAOpF,KAAKX,MAAMrf,OAO1BkhB,OAAQ,SAAUuE,GAkBjB,OAhBIA,aAAgBL,+BACnBK,EAAOA,EAAKpe,MAGb4d,2BAAKtnB,IAAIqC,KAAKqH,MAEdrH,KAAKqH,KAAK,GAAKoe,EAAK,GAAGR,2BAAK,GAAKQ,EAAK,GAAGR,2BAAK,GAAKQ,EAAK,GAAGR,2BAAK,GAChEjlB,KAAKqH,KAAK,GAAKoe,EAAK,GAAGR,2BAAK,GAAKQ,EAAK,GAAGR,2BAAK,GAAKQ,EAAK,GAAGR,2BAAK,GAChEjlB,KAAKqH,KAAK,GAAKoe,EAAK,GAAGR,2BAAK,GAAKQ,EAAK,GAAGR,2BAAK,GAAKQ,EAAK,GAAGR,2BAAK,GAChEjlB,KAAKqH,KAAK,GAAKoe,EAAK,GAAGR,2BAAK,GAAKQ,EAAK,GAAGR,2BAAK,GAAKQ,EAAK,GAAGR,2BAAK,GAChEjlB,KAAKqH,KAAK,GAAKoe,EAAK,GAAGR,2BAAK,GAAKQ,EAAK,GAAGR,2BAAK,GAAKQ,EAAK,GAAGR,2BAAK,GAChEjlB,KAAKqH,KAAK,GAAKoe,EAAK,GAAGR,2BAAK,GAAKQ,EAAK,GAAGR,2BAAK,GAAKQ,EAAK,GAAGR,2BAAK,GAChEjlB,KAAKqH,KAAK,GAAKoe,EAAK,GAAGR,2BAAK,GAAKQ,EAAK,GAAGR,2BAAK,GAAKQ,EAAK,GAAGR,2BAAK,GAChEjlB,KAAKqH,KAAK,GAAKoe,EAAK,GAAGR,2BAAK,GAAKQ,EAAK,GAAGR,2BAAK,GAAKQ,EAAK,GAAGR,2BAAK,GAChEjlB,KAAKqH,KAAK,GAAKoe,EAAK,GAAGR,2BAAK,GAAKQ,EAAK,GAAGR,2BAAK,GAAKQ,EAAK,GAAGR,2BAAK,GAEzDjlB,MAOR2jB,UAAW,SAAUjP,EAAG0O,GAEvB,OAAS,GAAL1O,GAAe,GAAL0O,IAId6B,2BAAKtnB,IAAIqC,KAAKqH,MAEdrH,KAAKqH,KAAK,GAAKqN,EAAEuQ,2BAAK,GAAK7B,EAAE6B,2BAAK,GAAKA,2BAAK,GAC5CjlB,KAAKqH,KAAK,GAAKqN,EAAEuQ,2BAAK,GAAK7B,EAAE6B,2BAAK,GAAKA,2BAAK,GAC5CjlB,KAAKqH,KAAK,GAAKqN,EAAEuQ,2BAAK,GAAK7B,EAAE6B,2BAAK,GAAKA,2BAAK,IAPpCjlB,MAgBT8jB,OAAQ,SAAUC,GAEjB,GAAa,GAATA,EACH,OAAO/jB,KAERA,KAAKqlB,SAASF,6BAEd,IAAIO,EAAOjY,KAAKyW,IAAIH,GAChB4B,EAAOlY,KAAK0W,IAAIJ,GAOpB,OALAoB,4BAAM,GAAKO,EACXP,4BAAM,IAAMQ,EACZR,4BAAM,GAAKQ,EACXR,4BAAM,GAAKO,EAEJ1lB,KAAKkhB,OAAOiE,8BAOpBxC,MAAO,SAAUiD,EAAIC,GAEpB,OAAU,GAAND,GAAiB,GAANC,EACP7lB,MAERA,KAAKqlB,SAASF,6BAEdA,4BAAM,GAAKS,EACXT,4BAAM,GAAKU,EAEJ7lB,KAAKkhB,OAAOiE,+BAWpBW,QAAS,SAAUpR,EAAG0O,EAAE,MAEvB,GAAU,OAANA,EACJ,CACC,MAAMpV,EAAI0G,EACVA,EAAI1G,EAAE0G,EACN0O,EAAIpV,EAAEoV,EAGP,IAAI2C,EAAK/lB,KAAKqH,KAAK,GAAGqN,EAAI1U,KAAKqH,KAAK,GAAG+b,EAAIpjB,KAAKqH,KAAK,GACjD2e,EAAKhmB,KAAKqH,KAAK,GAAGqN,EAAI1U,KAAKqH,KAAK,GAAG+b,EAAIpjB,KAAKqH,KAAK,GAErD,OAAO2d,yCAAKhF,KAAKX,MAAM0G,EAAIC,IAO5BC,UAAW,WAEVhB,2BAAK3G,KAAK,GAEV,IAAK,IAAIpb,EAAI,EAAGA,EAAI,EAAGA,IACvB,IAAK,IAAI7C,EAAI,EAAGA,EAAI,EAAGA,IACtB4kB,2BAAO,EAAF/hB,EAAI7C,GAAKL,KAAKqH,KAAO,EAAFhH,EAAI6C,GAK7B,OAFAlD,KAAKqH,KAAK1J,IAAIsnB,4BAEPjlB,MAORkmB,IAAK,WAEJ,OAAOlmB,KAAKqH,KAAK,IAAMrH,KAAKqH,KAAK,GAAGrH,KAAKqH,KAAK,GAAKrH,KAAKqH,KAAK,GAAGrH,KAAKqH,KAAK,IACxErH,KAAKqH,KAAK,IAAMrH,KAAKqH,KAAK,GAAGrH,KAAKqH,KAAK,GAAKrH,KAAKqH,KAAK,GAAGrH,KAAKqH,KAAK,IACnErH,KAAKqH,KAAK,IAAMrH,KAAKqH,KAAK,GAAGrH,KAAKqH,KAAK,GAAKrH,KAAKqH,KAAK,GAAGrH,KAAKqH,KAAK,KAQtE8e,IAAK,WAmBJ,MAAM,IAAIznB,MAAM,oBAOjB0nB,QAAS,WAER,IAAIF,EAAMlmB,KAAKkmB,MACf,OAAKA,EAEElmB,KAAKmmB,MAAMZ,OAAO,EAAEW,GAFV,MASlBtmB,SAAU,WAET,MAAO,IAAII,KAAKqH,KAAK,OAAOrH,KAAKqH,KAAK,OAAOrH,KAAKqH,KAAK,SAASrH,KAAKqH,KAAK,OAAOrH,KAAKqH,KAAK,OAAOrH,KAAKqH,KAAK,SAASrH,KAAKqH,KAAK,OAAOrH,KAAKqH,KAAK,OAAOrH,KAAKqH,KAAK,WAQnK+d,6BAAOiB,aAAe,SAAUf,GAE/BA,EAAOhH,KAAK,GACZgH,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAAK;;;;AAqBrCtH,yCAAS+B,WAAYqF,6BAAQ,KAAM,M,IACnCkB,yCAAelB,6BEpVfvN,OAAAxZ,cAAA,SCAAwZ,OAAAxZ,cAAA;;;;;;;;;;;;;;;;;AC4BA,MAAMkoB,0BACN,CACCC,aAAc,GACdC,YAAa,GAMbC,GAAI,KAMJC,WAAY,SAAUvf,GAuBrB,OArBApH,KAAK0mB,GAAKtf,EAEVpH,KAAKwmB,aAAaI,aAAe5mB,KAAK0mB,GAAGE,aACzC5mB,KAAKwmB,aAAaK,qBAAuB7mB,KAAK0mB,GAAGG,qBACjD7mB,KAAKwmB,aAAaM,iBAAmB9mB,KAAK0mB,GAAGI,iBAC7C9mB,KAAKwmB,aAAaO,kBAAoB/mB,KAAK0mB,GAAGK,kBAC9C/mB,KAAKwmB,aAAaQ,0BAA4BhnB,KAAK0mB,GAAGM,0BACtDhnB,KAAKwmB,aAAaS,eAAiBjnB,KAAK0mB,GAAGO,eAC3CjnB,KAAKwmB,aAAaU,kBAAoBlnB,KAAK0mB,GAAGQ,kBAC9ClnB,KAAKwmB,aAAaW,oBAAsBnnB,KAAK0mB,GAAGS,oBAEhDnnB,KAAKymB,YAAYW,YAAcpnB,KAAK0mB,GAAGU,YACvCpnB,KAAKymB,YAAYY,aAAernB,KAAK0mB,GAAGW,aACxCrnB,KAAKymB,YAAYa,YAActnB,KAAK0mB,GAAGY,YACvCtnB,KAAKymB,YAAYc,YAAcvnB,KAAK0mB,GAAGa,YACvCvnB,KAAKymB,YAAYe,aAAexnB,KAAK0mB,GAAGc,aACxCxnB,KAAKymB,YAAYgB,YAAcznB,KAAK0mB,GAAGe,YACvCznB,KAAKymB,YAAYiB,YAAc1nB,KAAK0mB,GAAGgB,YACvC1nB,KAAKymB,YAAYkB,aAAe3nB,KAAK0mB,GAAGiB,aACxC3nB,KAAKymB,YAAYmB,YAAc5nB,KAAK0mB,GAAGkB,YAEhC5nB,MAOR6nB,aAAc,SAAUroB,GAEvB,OAAOQ,KAAK0mB,GAAGmB,aAAa7nB,KAAK0mB,GAAGlnB,KAOrCsoB,gBAAiB,SAAUzgB,EAAM0gB,EAAQznB,GAExC,GAAe,IAAXynB,GAAgBznB,IAAW+G,EAAK/G,QAE/B+G,aAAgB6d,aACnB,OAAO7d,EAGT,IAAI2gB,EAAO,IAAI9C,aAAa5kB,GAE5B,IAAK,IAAID,EAAI,EAAGA,EAAIC,EAAQD,IAC3B2nB,EAAK3nB,GAAKgH,EAAKhH,EAAE0nB,GAElB,OAAOC,GASRC,iBAAkB,SAAU5gB,EAAMie,EAAO,KAAM4C,EAAM,KAAMH,EAAO,KAAMznB,EAAO,MAE9EglB,EAASA,GAAUiB,0BAAIC,aAAaI,aACpCsB,EAAQA,GAAS3B,0BAAIE,YAAYW,YAEjC,IAAIY,EAAOhoB,KAAK0mB,GAAGyB,eAKnB,OAJAnoB,KAAK0mB,GAAG0B,WAAY9C,EAAQ0C,GAC5BhoB,KAAK0mB,GAAG2B,WAAY/C,EAAQtlB,KAAK8nB,gBAAgBzgB,EAAM0gB,GAAU,EAAGznB,GAAU+G,EAAK/G,QAAS4nB,GAGrFF,I;AAMTM,yCAAe/B;aClHf;MAAMgC,2BACN,CAICC,SAAU,GAMV7qB,IAAK,SAAU6B,EAAMgH,GAEpBxG,KAAKwoB,SAAShpB,GAAQgH,GAOvB9I,IAAK,SAAU8B,GAEd,OAAOQ,KAAKwoB,SAAS3jB,eAAerF,GAAQQ,KAAKwoB,SAAShpB,GAAQ,IAMnE+S,QAAS,SAAU5T,EAAM8pB,GAExB9pB,EAAOA,EAAK2I,MAAM,MAElB,IAAK,IAAIjH,EAAI,EAAGA,EAAI1B,EAAK2B,OAAQD,IACjC,CACC,IAAIpB,EAAQN,EAAK0B,GAAGkR,OAEpB,GAAItS,EAAM4T,WAAW,WACrB,CACC,IAAI3B,EAAM,GAEV,IAAK,IAAI1R,KAAQP,EAAMypB,UAAU,GAAGphB,MAAM,KAEzC9H,EAAOA,EAAK+R,OAERkX,EAAgB5jB,eAAerF,KAGnCipB,EAAgBjpB,IAAQ,EAExB0R,GAAOqX,2BAAKhW,QAAQgW,2BAAK7qB,IAAI8B,GAAOipB,GAAmB,MAGxD9pB,EAAK0B,GAAK6Q,GAIZ,OAAOvS,EAAK8C,KAAK,OAYlBknB,QAAS,SAAUhqB,GAUlB,OANkC,KAFlCA,EAAOA,EAAK4S,QAEH/P,QAAQ,eAChB7C,EAAO,2BAA6BA,IAEJ,IAA7BA,EAAK6C,QAAQ,cAChB7C,EAAO,oBAAsBA,GAEvBqB,KAAKuS,QAAQ5T,EAAM,M;AAM5BiqB,yCAAeL,2BAMfA,2BAAK5qB,IAAI,YAAa,6QActB4qB,2BAAK5qB,IAAI,YAAa,yNAYtB4qB,2BAAK5qB,IAAI,UAAW,+EAMpB4qB,2BAAK5qB,IAAI,UAAW,+EAOpB4qB,2BAAK5qB,IAAI,OAAQ,kNAejB4qB,2BAAK5qB,IAAI,QAAS,+MAclB4qB,2BAAK5qB,IAAI,aAAc,kOAUvB4qB,2BAAK5qB,IAAI,iBAAkB,+OAS3B4qB,2BAAK5qB,IAAI,WAAY,mKAQrB4qB,2BAAK5qB,IAAI,OAAQ,gHAMjB4qB,2BAAK5qB,IAAI,QAAS,0FAMlB4qB,2BAAK5qB,IAAI,SAAU,gIAMnB4qB,2BAAK5qB,IAAI,OAAQ,uJAUjB4qB,2BAAK5qB,IAAI,YAAa;;;;AF9MtB,MAAMkrB,6BAAShR,OAAAK,MAAM3R,OACpB,CAKA/H,GAAI,KAMJa,KAAM,EAMNypB,SAAU,KAkBVpkB,OAAQ,SAAUlG,EAAIa,EAAK,KAAMmH,EAAO,MAExB,OAAXA,GAA4B,OAATnH,GAAkC,iBAAVA,IAE9CmH,EAASnH,EACTA,EAAO,MAGK,OAATA,IAEHA,EAAOb,EACPA,EAAK,MAGNqqB,6BAAOE,IAAI/oB,KAAKxB,GAAKA,EAAIwB,MACzBA,KAAKX,KAAOA,EAEZW,KAAK8oB,SAAW,KAED,OAAXtiB,GACHxG,KAAKyS,QAAQjM,IAMf7B,OAAQ,WAEP2jB,yCAAI5B,GAAGsC,aAAahpB,KAAK8oB,UACzBD,6BAAOroB,OAAOR,KAAKxB,KAOpBiU,QAAS,SAAUjM,GAElB,IAAIkgB,EAAK4B,yCAAI5B,GACb1mB,KAAK8oB,SAAWpC,EAAGuC,aAAcjpB,KAAKX,OAASwpB,6BAAOvb,KAAK4b,OAASxC,EAAGyC,cAAiBnpB,KAAKX,OAASwpB,6BAAOvb,KAAK8b,SAAW1C,EAAG2C,gBAAkB3C,EAAG4C,iBAErJ9iB,EAASoiB,yCAAKD,QAAQniB,GAEtBkgB,EAAG6C,aAAavpB,KAAK8oB,SAAUtiB,GAC/BkgB,EAAG8C,cAAcxpB,KAAK8oB,UAEtB,IAAIvJ,EAAQmH,EAAG+C,iBAAiBzpB,KAAK8oB,UACrC,GAAIvJ,EAEH,MADA/I,QAAQ+I,MAAM/Y,EAAOc,MAAM,MAAMkK,KAAI,CAACnR,EAAEoM,IAAUA,EAAU,KAAOpM,IAAGoB,KAAK,OACrE,IAAI/C,OAAQsB,KAAKxB,GAAK,IAAMwB,KAAKxB,GAAK,KAAO,IAAM+gB,GAG1D,OAAOvf;SAST6oB;6BAAOa,QAAU,GAMjBb,6BAAOE,IAAM,SAAUvqB,EAAImrB,GAEtBnrB,IAAIwB,KAAK0pB,QAAQlrB,GAAMmrB,IAO5Bd,6BAAOnrB,IAAM,SAAUc,GAEtB,OAAOwB,KAAK0pB,QAAQlrB,IAOrBqqB,6BAAOroB,OAAS,SAAUhC,UAElBwB,KAAK0pB,QAAQlrB;;;AAWrBqqB,6BAAOvb,KAAO,CACb4b,OAAQ;;AAERE,SAAU;;AAEVQ,SAAU,G;AAMXC,yCAAehB;;;;sBDhJf;MAAMiB,oCAAgBjS,OAAAK,MAAM3R,OAC3B,CAIAwjB,UAAW,KAMXvrB,GAAI,KAMJkrB,QAAS,KAMTM,UAAW,KAMXtlB,OAAQ,SAAUlG,EAAG,MAEpBwB,KAAKxB,GAAKA,EAEVwB,KAAK0pB,QAAU,GACf1pB,KAAKgqB,UAAY,KAEjBhqB,KAAK+pB,UAAY,GAEjB/pB,KAAKiqB,eAAiB,KAEtBH,oCAAcf,IAAIvqB,EAAIwB,OAMvB2E,OAAQ,WAEP,IAAI+hB,EAAK4B,yCAAI5B,GACb,IAAKA,EAAI,OAAO1mB,KAEhB0mB,EAAGwD,cAAclqB,KAAKgqB,WACtBF,oCAActpB,OAAOR,KAAKxB,KAS3B2rB,cAAe,SAAUA,GAGxB,OADAnqB,KAAKiqB,eAAiBE,EACfnqB,MAORoqB,OAAQ,SAAUT,GAKjB,GAHuB,iBAAZA,IACVA,EAASE,yCAAOnsB,IAAIisB,KAEhBA,EACJ,MAAM,IAAIjrB,MAAO,8CAGlB,OADAsB,KAAK0pB,QAAQ7mB,KAAK8mB,GACX3pB,MAMRqqB,cAAe,WAEd/B,yCAAI5B,GAAG4D,mBAAoBtqB,KAAKgqB,UAAW,EAAG,aAO/CO,kBAAmB,SAAU/qB,GAK5B,OAHKQ,KAAK+pB,UAAUllB,eAAerF,KAClCQ,KAAK+pB,UAAUvqB,GAAQ8oB,yCAAI5B,GAAG6D,kBAAmBvqB,KAAKgqB,UAAWxqB,IAE3DQ,KAAK+pB,UAAUvqB,IAOvBgrB,mBAAoB,SAAUhrB,GAK7B,OAHKQ,KAAK+pB,UAAUllB,eAAerF,KAClCQ,KAAK+pB,UAAUvqB,GAAQ8oB,yCAAI5B,GAAG8D,mBAAoBxqB,KAAKgqB,UAAWxqB,IAE5DQ,KAAK+pB,UAAUvqB,IAOvBirB,wBAAyB,SAAUjrB,GAKlC,OAHKQ,KAAK+pB,UAAUllB,eAAerF,KAClCQ,KAAK+pB,UAAUvqB,GAAQ8oB,yCAAI5B,GAAGgE,qBAAsB1qB,KAAKgqB,UAAWxqB,IAE9DQ,KAAK+pB,UAAUvqB,IAOvBmrB,oBAAqB,SAAUC,GAK9B,MAH6B,iBAAlBA,IACVA,EAAe5qB,KAAKyqB,wBAAwBG,IAEtCtC,yCAAI5B,GAAGmE,+BAA+B7qB,KAAKgqB,UAAWY,EAActC,yCAAI5B,GAAGoE,0BAOnFC,yBAA0B,SAAUH,GAEN,iBAAlBA,IACVA,EAAe5qB,KAAKyqB,wBAAwBG,IAE7C,IAAII,EAAOhrB,KAAK2qB,oBAAoBC,GAChC5C,EAAOM,yCAAIL,iBAAkB,IAAI/C,aAAa8F,GAAM1M,KAAK,GAAIgK,yCAAI9B,aAAaS,eAAgBqB,yCAAI7B,YAAYY,cAElHiB,yCAAI5B,GAAGuE,eAAgB3C,yCAAI9B,aAAaS,eAAgB,EAAGe,IAM5DkD,iBAAkB,WAEjBlrB,KAAKwqB,mBAAmB,UACxBxqB,KAAKwqB,mBAAmB,WAExBxqB,KAAKwqB,mBAAmB,eACxBxqB,KAAKwqB,mBAAmB,aACxBxqB,KAAKwqB,mBAAmB,UAExBxqB,KAAKwqB,mBAAmB,gBACxBxqB,KAAKwqB,mBAAmB,gBAExBxqB,KAAKwqB,mBAAmB,WACxBxqB,KAAKwqB,mBAAmB,WACxBxqB,KAAKwqB,mBAAmB,gBAExBxqB,KAAKwqB,mBAAmB,YAExBxqB,KAAKuqB,kBAAkB,aAOxBY,KAAM,WAEL,IAAIzE,EAAK4B,yCAAI5B,GACb,IAAKA,EAAI,OAAO1mB,KAEhBA,KAAKgqB,UAAYtD,EAAG0E,gBAEpB,IAAK,IAAIzB,KAAU3pB,KAAK0pB,QACvBhD,EAAG2E,aAAcrrB,KAAKgqB,UAAWL,EAAOb,UAMzC,OAJA9oB,KAAKqqB,gBACL3D,EAAG4E,YAAatrB,KAAKgqB,WACrBhqB,KAAKkrB,mBAEElrB,MAORurB,SAAU,WAET,IAAI7E,EAAK4B,yCAAI5B,GACRA,IAELA,EAAG8E,WAAYxrB,KAAKgqB,WAEQ,OAAxBhqB,KAAKiqB,gBACRjqB,KAAKiqB,eAAgBjqB,KAAM0mB,KAO7B+E,UAAW,WAEV,IAAI/E,EAAK4B,yCAAI5B,GACb,OAAKA,GAEEA,EAAGgF,oBAAoB1rB,KAAKgqB,UAAWtD,EAAGiF,cAOlDC,SAAU,WAET,IAAIlF,EAAK4B,yCAAI5B,GACb,OAAKA,EAEkB,OAAnB1mB,KAAKgqB,UACD,+BAEDtD,EAAGmF,kBAAkB7rB,KAAKgqB,WALjB,IAYjB8B,UAAW,SAAUC,EAAUC,GAM9B,MAJyB,iBAAdD,IACVA,EAAW/rB,KAAKwqB,mBAAmBuB,IAEpCzD,yCAAI5B,GAAGoF,UAAWC,EAAUC,GACrBhsB,MAORisB,WAAY,SAAUF,EAAU9sB,GAM/B,MAJyB,iBAAd8sB,IACVA,EAAW/rB,KAAKwqB,mBAAmBuB,IAEpCzD,yCAAI5B,GAAGuF,WAAYF,EAAU9sB,GACtBe,MAORksB,UAAW,SAAUH,EAAUC,GAM9B,MAJyB,iBAAdD,IACVA,EAAW/rB,KAAKwqB,mBAAmBuB,IAEpCzD,yCAAI5B,GAAGwF,UAAWH,EAAUC,GACrBhsB,MAORmsB,WAAY,SAAUJ,EAAU9sB,GAM/B,MAJyB,iBAAd8sB,IACVA,EAAW/rB,KAAKwqB,mBAAmBuB,IAEpCzD,yCAAI5B,GAAGyF,WAAYJ,EAAU9sB,GACtBe,MAORosB,UAAW,SAAUL,EAAUC,EAAIK,GAMlC,MAJyB,iBAAdN,IACVA,EAAW/rB,KAAKwqB,mBAAmBuB,IAEpCzD,yCAAI5B,GAAG0F,UAAWL,EAAUC,EAAIK,GACzBrsB,MAORssB,WAAY,SAAUP,EAAU9sB,GAM/B,MAJyB,iBAAd8sB,IACVA,EAAW/rB,KAAKwqB,mBAAmBuB,IAEpCzD,yCAAI5B,GAAG4F,WAAYP,EAAU9sB,GACtBe,MAORusB,UAAW,SAAUR,EAAUC,EAAIK,GAMlC,MAJyB,iBAAdN,IACVA,EAAW/rB,KAAKwqB,mBAAmBuB,IAEpCzD,yCAAI5B,GAAG6F,UAAWR,EAAUC,EAAIK,GACzBrsB,MAORwsB,WAAY,SAAUT,EAAU9sB,GAM/B,MAJyB,iBAAd8sB,IACVA,EAAW/rB,KAAKwqB,mBAAmBuB,IAEpCzD,yCAAI5B,GAAG8F,WAAYT,EAAU9sB,GACtBe,MAORysB,UAAW,SAAUV,EAAUC,EAAIK,EAAIK,GAMtC,MAJyB,iBAAdX,IACVA,EAAW/rB,KAAKwqB,mBAAmBuB,IAEpCzD,yCAAI5B,GAAG+F,UAAWV,EAAUC,EAAIK,EAAIK,GAC7B1sB,MAOR2sB,WAAY,SAAUZ,EAAU9sB,GAM/B,MAJyB,iBAAd8sB,IACVA,EAAW/rB,KAAKwqB,mBAAmBuB,IAEpCzD,yCAAI5B,GAAGiG,WAAYZ,EAAU9sB,GACtBe,MAOR4sB,UAAW,SAAUb,EAAUC,EAAIK,EAAIK,GAMtC,MAJyB,iBAAdX,IACVA,EAAW/rB,KAAKwqB,mBAAmBuB,IAEpCzD,yCAAI5B,GAAGkG,UAAWb,EAAUC,EAAIK,EAAIK,GAC7B1sB,MAOR6sB,WAAY,SAAUd,EAAU9sB,GAM/B,MAJyB,iBAAd8sB,IACVA,EAAW/rB,KAAKwqB,mBAAmBuB,IAEpCzD,yCAAI5B,GAAGmG,WAAYd,EAAU9sB,GACtBe,MAOR8sB,UAAW,SAAUf,EAAUC,EAAIK,EAAIK,EAAIK,GAM1C,MAJyB,iBAAdhB,IACVA,EAAW/rB,KAAKwqB,mBAAmBuB,IAEpCzD,yCAAI5B,GAAGoG,UAAWf,EAAUC,EAAIK,EAAIK,EAAIK,GACjC/sB,MAORgtB,WAAY,SAAUjB,EAAU9sB,GAM/B,MAJyB,iBAAd8sB,IACVA,EAAW/rB,KAAKwqB,mBAAmBuB,IAEpCzD,yCAAI5B,GAAGsG,WAAYjB,EAAU9sB,GACtBe,MAORitB,UAAW,SAAUlB,EAAUC,EAAIK,EAAIK,EAAIK,GAM1C,MAJyB,iBAAdhB,IACVA,EAAW/rB,KAAKwqB,mBAAmBuB,IAEpCzD,yCAAI5B,GAAGuG,UAAWlB,EAAUC,EAAIK,EAAIK,EAAIK,GACjC/sB,MAORktB,WAAY,SAAUnB,EAAU9sB,GAM/B,MAJyB,iBAAd8sB,IACVA,EAAW/rB,KAAKwqB,mBAAmBuB,IAEpCzD,yCAAI5B,GAAGwG,WAAYnB,EAAU9sB,GACtBe,QAQT8pB,oCAAcqD,SAAW,GAOzBrD,oCAAcsD,OAAS,SAAU5uB,EAAIgI,GAEpC,IAAI6mB,EAAK,KAAMC,EAAS,KACpBC,EAAK,KAAMC,EAAS,KACpBC,EAAK,KAAMC,EAAS,KAEpBC,EAAS,KAEb,IAAK,IAAIxqB,KAAKqD,EAAOc,MAAM,MAC3B,CACC,IAAI0G,EAAI7K,EAAEoO,OAEV,GAAIvD,EAAE6E,WAAW,MACjB,CAGC,GAFA7E,EAAIA,EAAE1G,MAAM,KAAKkK,KAAInR,GAAKA,EAAEkR,SAEf,YAATvD,EAAE,GAAkB,CACnBA,EAAE1N,OAAS,IAAGgtB,EAAStf,EAAE,IAClB,OAAPqf,IAAaA,EAAK,IACtBM,EAASN,EACT,SAGD,GAAa,YAATrf,EAAE,GAAkB,CACnBA,EAAE1N,OAAS,IAAGktB,EAASxf,EAAE,IAClB,OAAPuf,IAAaA,EAAK,IACtBI,EAASJ,EACT,SAID,GAAa,YAATvf,EAAE,GAAkB,CACnBA,EAAE1N,OAAS,IAAGotB,EAAS1f,EAAE,IAClB,OAAPyf,IAAaA,EAAK,IACtBE,EAASF,EACT,UAIa,OAAXE,GACHA,EAAO9qB,KAAKM,GAGd,IAAIyqB,EAAM,IAAI9D,oCAActrB,GAQ5B,GALW,OAAP6uB,IAAaA,EAAKA,EAAG5rB,KAAK,MAAM8P,QACzB,OAAPgc,IAAaA,EAAKA,EAAG9rB,KAAK,MAAM8P,QACzB,OAAPkc,IAAaA,EAAKA,EAAGhsB,KAAK,MAAM8P,QAGzB,OAAP8b,GAA6B,IAAdA,EAAG/sB,QAGrB,GADA+sB,EAAKxD,yCAAOnsB,IAAI4vB,GACL,OAAPD,EAAa,MAAM,IAAI3uB,MAAM,4BAA8B4uB,QAEhD,OAAPD,GAA6B,IAAdA,EAAG/sB,SAC1B+sB,EAAK,MAEN,GAAW,OAAPE,GAA6B,IAAdA,EAAGjtB,QAGrB,GADAitB,EAAK1D,yCAAOnsB,IAAI8vB,GACL,OAAPD,EAAa,MAAM,IAAI7uB,MAAM,8BAAgC8uB,QAElD,OAAPD,GAA6B,IAAdA,EAAGjtB,SAC1BitB,EAAK,MAEN,GAAW,OAAPE,GAA6B,IAAdA,EAAGntB,QAGrB,GADAmtB,EAAK5D,yCAAOnsB,IAAIgwB,GACL,OAAPD,EAAa,MAAM,IAAI/uB,MAAM,8BAAgCgvB,QAElD,OAAPD,GAA6B,IAAdA,EAAGntB,SAC1BmtB,EAAK,MAqBN,OAlBW,OAAPJ,IAAaA,EAAKxD,yCAAOnsB,IAAI,aACtB,OAAP6vB,IAAaA,EAAK1D,yCAAOnsB,IAAI,aAGtB,OAAP2vB,GAA8B,iBAARA,IACzBA,EAAK,IAAIxD,yCAAQyD,EAAQzD,yCAAOvc,KAAK4b,OAAQmE,IAEnC,OAAPE,GAA8B,iBAARA,IACzBA,EAAK,IAAI1D,yCAAQ2D,EAAQ3D,yCAAOvc,KAAK8b,SAAUmE,IAErC,OAAPE,GAA8B,iBAARA,IACzBA,EAAK,IAAI5D,yCAAQ6D,EAAQ7D,yCAAOvc,KAAKsc,SAAU6D,IAGrC,OAAPJ,GAAaO,EAAIxD,OAAOiD,GACjB,OAAPE,GAAaK,EAAIxD,OAAOmD,GACjB,OAAPE,GAAaG,EAAIxD,OAAOqD,GAErBG,EAAIzC,QAOZrB,oCAAcf,IAAM,SAAUvqB,EAAIqvB,GAE7BrvB,IAAIwB,KAAKmtB,SAAS3uB,GAAMqvB,IAO7B/D,oCAAcpsB,IAAM,SAAUc,GAE7B,OAAOwB,KAAKmtB,SAAS3uB,IAOtBsrB,oCAActpB,OAAS,SAAUhC,UAEzBwB,KAAKmtB,SAAS3uB,I,IAGtBsvB,yCAAehE,oCIvlBfjS,OAAAxZ,cAAA;;;AAiBA0vB,yCAAelW,OAAAK,MAAM3R,OACpB,CACA9B,UAAW,UAMXupB,UAAW,KAMXC,MAAO,EAMPC,OAAQ,EAMRC,YAAa,EAMbC,aAAc,EAMdC,OAAQ,EAMRhN,OAAQ,SAMRiN,KAAM,gBAMNC,OAAQ,EAKRC,WAAW,EAKXC,OAAQ,KAMR/pB,OAAQ,SAAUupB,EAAOC,EAAQC,EAAY,KAAMC,EAAa,MAE/DpuB,KAAKguB,UAAY,KAEjBhuB,KAAKiuB,MAAQA,EACbjuB,KAAKkuB,OAASA,EACdluB,KAAKmuB,YAAcA,GAAeF,EAClCjuB,KAAKouB,aAAeA,GAAgBF,EAEpCluB,KAAKquB,OAASruB,KAAKiuB,MAAQjuB,KAAKmuB,YAChCnuB,KAAKqhB,OAAS,SACdrhB,KAAKsuB,KAAO,gBACZtuB,KAAKuuB,OAAS,GAOfG,KAAM,WAEL,MAAMhI,EAAK4B,yCAAI5B,GAaf,OAXuB,OAAnB1mB,KAAKguB,YACRhuB,KAAKguB,UAAYtH,EAAGiI,iBAErBjI,EAAGkI,YAAYlI,EAAGmI,WAAY7uB,KAAKguB,YAEZ,IAAnBhuB,KAAKwuB,YAERxuB,KAAKwuB,UAAY,KACjBxuB,KAAKof,YAGCsH,GAORtH,SAAU,WAET,IAAuB,IAAnBpf,KAAKwuB,UACR,OAAOxuB,KAERA,KAAKwuB,WAAY,EAEjB,MAAM9H,EAAK1mB,KAAK0uB,OAUhB,OARA1uB,KAAK8uB,YAAYpI,GACjB1mB,KAAK+uB,UAAUrI,GAEX1mB,KAAKuuB,OAAS,EACjB7H,EAAGsI,aAAatI,EAAGmI,WAAY7uB,KAAKuuB,OAAQ7H,EAAGuI,MAAOjvB,KAAKiuB,MAAOjuB,KAAKkuB,QAEvExH,EAAGsI,aAAatI,EAAGmI,WAAY,EAAGnI,EAAGuI,MAAOjvB,KAAKiuB,MAAOjuB,KAAKkuB,QAEvDluB,MAOR8uB,YAAa,SAAUI,EAAI,MAE1B,MAAMxI,EAAKwI,GAAOlvB,KAAK0uB,OA6BvB,OA3BI1uB,KAAKuuB,OAAS,EAEG,YAAhBvuB,KAAKqhB,QAERqF,EAAGyI,cAAczI,EAAGmI,WAAYnI,EAAG0I,mBAAoB1I,EAAG2I,uBAC1D3I,EAAGyI,cAAczI,EAAGmI,WAAYnI,EAAG4I,mBAAoB5I,EAAG6I,WAI1D7I,EAAGyI,cAAczI,EAAGmI,WAAYnI,EAAG0I,mBAAoB1I,EAAG8I,sBAC1D9I,EAAGyI,cAAczI,EAAGmI,WAAYnI,EAAG4I,mBAAoB5I,EAAG+I,SAKvC,YAAhBzvB,KAAKqhB,QAERqF,EAAGyI,cAAczI,EAAGmI,WAAYnI,EAAG0I,mBAAoB1I,EAAG6I,SAC1D7I,EAAGyI,cAAczI,EAAGmI,WAAYnI,EAAG4I,mBAAoB5I,EAAG6I,WAI1D7I,EAAGyI,cAAczI,EAAGmI,WAAYnI,EAAG0I,mBAAoB1I,EAAG+I,QAC1D/I,EAAGyI,cAAczI,EAAGmI,WAAYnI,EAAG4I,mBAAoB5I,EAAG+I,SAIrDzvB,MAOR+uB,UAAW,SAAUG,EAAI,MAExB,MAAMxI,EAAKwI,GAAOlvB,KAAK0uB,OAkBvB,MAhBkB,WAAd1uB,KAAKsuB,MAER5H,EAAGyI,cAAczI,EAAGmI,WAAYnI,EAAGgJ,eAAgBhJ,EAAGiJ,QACtDjJ,EAAGyI,cAAczI,EAAGmI,WAAYnI,EAAGkJ,eAAgBlJ,EAAGiJ,SAEhC,oBAAd3vB,KAAKsuB,MAEb5H,EAAGyI,cAAczI,EAAGmI,WAAYnI,EAAGgJ,eAAgBhJ,EAAGmJ,iBACtDnJ,EAAGyI,cAAczI,EAAGmI,WAAYnI,EAAGkJ,eAAgBlJ,EAAGmJ,mBAItDnJ,EAAGyI,cAAczI,EAAGmI,WAAYnI,EAAGgJ,eAAgBhJ,EAAGoJ,eACtDpJ,EAAGyI,cAAczI,EAAGmI,WAAYnI,EAAGkJ,eAAgBlJ,EAAGoJ,gBAGhD9vB,MAOR+vB,UAAW,SAAU1O,GAIpB,OAFArhB,KAAKqhB,OAASA,EACS,OAAnBrhB,KAAKguB,WAAoBhuB,KAAK8uB,cAC3B9uB,MAORgwB,QAAS,SAAU1B,GAIlB,OAFAtuB,KAAKsuB,KAAOA,EACW,OAAnBtuB,KAAKguB,WAAoBhuB,KAAK+uB,YAC3B/uB,MAORiwB,UAAW,SAAU1B,GAIpB,GAFAvuB,KAAKuuB,OAASA,EAES,OAAnBvuB,KAAKguB,YAAyC,IAAnBhuB,KAAKwuB,WAAsBxuB,KAAKuuB,OAAS,EACxE,CACC,MAAM7H,EAAK1mB,KAAK0uB,OAChBhI,EAAGwJ,eAAexJ,EAAGmI,YAGtB,OAAO7uB,MAORmwB,OAAQ,SAAUC,EAAOC,EAAQ,EAAGC,EAAQ,GAE3C,MAAM5J,EAAK1mB,KAAK0uB,OAOhB,OALAhI,EAAG6J,cAAc7J,EAAGmI,WAAY,EAAGwB,EAASC,EAAS7iB,KAAK0R,IAAIiR,EAAMnC,MAAOjuB,KAAKiuB,OAAQxgB,KAAK0R,IAAIiR,EAAMlC,OAAQluB,KAAKkuB,QAASxH,EAAG8J,KAAM9J,EAAG+J,cAAeL,GAEpJpwB,KAAKuuB,OAAS,GACjB7H,EAAGwJ,eAAexJ,EAAGmI,YAEf7uB,MAOR0wB,aAAc,SAAUC,EAAQ,MAK/B,OAHoB,OAAhB3wB,KAAKyuB,SACRzuB,KAAKyuB,OAAS,IAAImC,yCAAQ,CAAElK,IAAI,EAAOmK,QAAQ,EAAM5C,MAAOjuB,KAAKiuB,MAAOC,OAAQluB,KAAKkuB,OAAQ4C,UAA2B,WAAhB9wB,KAAKqhB,UAAwBsP,KAE/H3wB,MAOR+wB,UAAW,WAEV,OAAO/wB,KAAKyuB,QAQbuC,aAAc,SAAU9iB,EAAS,MAEhC,GAAoB,OAAhBlO,KAAKyuB,OAGR,OADiB,OAAbvgB,GAAmBA,IAChBlO,KAGR,IAAIixB,EAAM,IAAIC,MAUd,OATAD,EAAIE,OAAS,KAEZnxB,KAAKmwB,OAAOc,GACZA,EAAM,KAEW,OAAb/iB,GAAmBA,KAGxB+iB,EAAIG,IAAMpxB,KAAKyuB,OAAO4C,YACfrxB,MAORsxB,cAAe,WAQd,OANoB,OAAhBtxB,KAAKyuB,SAERzuB,KAAKyuB,OAAO7N,UACZ5gB,KAAKyuB,OAAS,MAGRzuB,MAcRuxB,aAAc,SAAUZ,EAASa,EAAO,MAYvC,MAVwB,mBAAbb,IAEVa,EAASb,EACTA,EAAU,MAGXa,EAAOxxB,KAAK0wB,aAAaC,IAEzB3wB,KAAKgxB,eACLhxB,KAAKsxB,gBACEtxB;;;;;;;;;;;;;;;APvRT,MAAMyxB,6BAAS,SAAUd,EAAQ,MAEhC,IAAIe,EAAO,CACV9uB,KAAM,KACN8jB,IAAI,EACJiL,WAAY,UACZ1D,MAAO,EACPC,OAAQ,EACR2C,QAAQ,EACRe,UAAU,EACVd,WAAW,KACRH,GAGJ,MAAMkB,GAAW3zB,eAAO4zB,SAGP,MAAbJ,EAAK9uB,MAER5C,KAAK4C,KAAQivB,EAAqDha,OAAA6I,KAAK/d,MAAM8uB,6BAAOM,gBAA5D7zB,eAAO4zB,SAASE,cAAc,UAElD9zB,eAAO4zB,UAA2B,GAAfJ,EAAKb,SAE3B3yB,eAAO4zB,SAASG,KAAKC,YAAalyB,KAAK4C,OAEjB,IAAlB8uB,EAAKE,WACR5xB,KAAK4C,KAAKuvB,MAAMtlB,SAAW,WAC3B7M,KAAK4C,KAAKuvB,MAAMC,KAAO,IACvBpyB,KAAK4C,KAAKuvB,MAAM3R,IAAM,OAMxBxgB,KAAK4C,KAAO8uB,EAAK9uB,KAGb5C,KAAK4C,KAAKyvB,cAEC,IAAZX,EAAKhL,IAAgBmL,GAcxB7xB,KAAKoH,QAAUpH,KAAK4C,KAAKyvB,WAAW,KAAM,CAAEC,gBAAgB,IAC5DtyB,KAAK0mB,GAAK,OAbV1mB,KAAK0mB,GAAK1mB,KAAK4C,KAAKyvB,WAAW,SAAU,CAAEC,gBAAgB,EAAOC,uBAAuB,EAAOC,OAAO,EAAOC,SAAS,IAEpG,OAAfC,yCAAQhM,IACX4B,yCAAI3B,WAAW+L,yCAAQhM,GAAK1mB,KAAK0mB,IAElC1mB,KAAK6tB,cAAgB,KACrB7tB,KAAKoH,QAAU,KAEfurB,yCAAIC,MAAMtK,yCAAIT,aAAa,WAAa,KAAOS,yCAAIT,aAAa,8BASjE7nB,KAAK6yB,YAAcrR,yCAAKxB,KAAKX,QAC7Brf,KAAK8yB,WAAatR,yCAAKxB,KAAKX,QAC5Brf,KAAK+yB,eAAiBvR,yCAAKxB,KAAKX,QAChCrf,KAAKgzB,mBAAqBxR,yCAAKxB,KAAKX,QAEpCrf,KAAKylB,KAAOa,yCAAOtG,KAAKX,QACxBrf,KAAKizB,UAAY3M,yCAAOtG,KAAKX,QAG7Brf,KAAKkzB,aAAe,EACpBlzB,KAAKmzB,OAAS,EACdnzB,KAAKozB,YAAa,EAGlBpzB,KAAKqzB,kBACLrzB,KAAKszB,YAAY,QACjBtzB,KAAKuzB,UAAU,QAEX7B,EAAKzD,OAASyD,EAAKxD,QACvBluB,KAAKwzB,OAAQ9B,EAAKzD,MAAOyD,EAAKxD,QAEd,OAAZluB,KAAK0mB,IACR1mB,KAAKyzB,SAENzzB,KAAK8wB,UAAYY,EAAKZ,UACtB9wB,KAAK0zB,cAAehC,EAAKC,cAG1BF,6BAAOM,eACP,CACC4B,WAAY,KAEZC,uBAAuB,EAEvBzB,MAAO,GAGPlE,MAAO,IACPC,OAAQ,IAERmE,WAAY,SAAUwB,GACrB,OAAO7zB,MAGR8zB,SAAU,aAGVC,QAAS,aAGTpR,MAAO,SAAUiD,EAAIC,KAGrB/B,OAAQ,SAAUC,KAGlBJ,UAAW,SAAUjP,EAAG0O,KAGxB4Q,aAAc,SAAUpkB,EAAGC,EAAGyI,EAAGC,EAAGnb,EAAGoV,KAGvC6gB,gBAAiB,aAGjBY,UAAW,SAAUC,EAAMC,GAC1B,MAAO,IAGRC,UAAW,aAGXC,OAAQ,SAAU3f,EAAG0O,KAGrBkR,UAAW,aAGXC,OAAQ,aAGRC,KAAM,SAAS9f,EAAG0O,EAAGqR,EAAGC,KAGxBpW,KAAM,aAGNqW,OAAQ,aAGRC,SAAU,SAASlgB,EAAG0O,EAAGqR,EAAGC,KAG5BG,WAAY,SAASngB,EAAG0O,EAAGqR,EAAGC,KAG9BI,KAAM,aAGNC,iBAAkB,SAAUC,EAAKC,EAAKvgB,EAAG0O,KAGzC8R,cAAe,SAAUC,EAAKC,EAAKC,EAAKC,EAAK5gB,EAAG0O,KAGhDmS,IAAK,SAAU7gB,EAAG0O,EAAG9lB,EAAGk4B,EAAIC,EAAIC,KAGhCC,MAAO,SAAUC,EAAIC,EAAIC,EAAIC,EAAIz4B,KAGjC04B,SAAU,SAAU5xB,EAAMsQ,EAAG0O,EAAG6S,KAGhCC,WAAY,SAAU9xB,EAAMsQ,EAAG0O,EAAG6S,KAGlCE,YAAa,SAAU/xB,GACtB,MAAO,CAAE6pB,MAAO,IAGjBmI,gBAAiB,SAAU3B,EAAGC,GAC7B,MAAO,CAAEzG,MAAOwG,EAAGvG,OAAQwG,IAG5B2B,aAAc,SAAU3hB,EAAG0O,EAAGqR,EAAGC,GAChC,MAAO,CAAEzG,MAAOwG,EAAGvG,OAAQwG,EAAGrtB,KAAM,KAGrCivB,aAAc,SAAUjvB,EAAMqN,EAAG0O,KAGjCmT,UAAW,SAAUtF,EAAKrL,EAAG,EAAGC,EAAG,EAAG2Q,EAAG,KAAMC,EAAG,KAAM7S,EAAG,KAAMC,EAAG,KAAM6S,EAAG,KAAMC,EAAG,KAAMC,EAAa,KAAMC,EAAc,KAAMC,EAAW,KAAMC,EAAY,QAGhKC,sBAAuB,WACtB,MAAO,CAAE5E,KAAM,EAAG5R,IAAK,KAOzBiR,6BAAOjtB,UAAUivB,OAAS,WAEzB,IAAIwD,EAAKj3B,KAAK0mB,GAkId,GA7HA1mB,KAAKk3B,eAAiB,IAAIpJ,yCAAc,SAExC,IAAIjE,yCAAQ,aAAcA,yCAAOvc,KAAK4b,OACtC,oZAmBA,IAAIW,yCAAQ,aAAcA,yCAAOvc,KAAK8b,SACtC,0RAmBAppB,KAAKm3B,iBAAmB,IAAIrJ,yCAAc,OAE1C,IAAIjE,yCAAQ,WAAYA,yCAAOvc,KAAK4b,OACpC,2WAmBA,IAAIW,yCAAQ,WAAYA,yCAAOvc,KAAK8b,SACpC,2OAgBAppB,KAAKo3B,cAAgB,IAAItJ,yCAAc,QAEvC,IAAIjE,yCAAQ,YAAaA,yCAAOvc,KAAK4b,OACrC,uUAgBA,IAAIW,yCAAQ,YAAaA,yCAAOvc,KAAK8b,SACrC,+JAWAppB,KAAKm3B,iBAAiB/M,OAAO,YAC7BpqB,KAAKm3B,iBAAiB/M,OAAO,YAE7BpqB,KAAKk3B,eAAe9M,OAAO,cAC3BpqB,KAAKk3B,eAAe9M,OAAO,cAE3BpqB,KAAKo3B,cAAchN,OAAO,aAC1BpqB,KAAKo3B,cAAchN,OAAO,aAE1BpqB,KAAKm3B,iBAAiBhM,OACtBnrB,KAAKk3B,eAAe/L,OACpBnrB,KAAKo3B,cAAcjM,QAEdnrB,KAAKm3B,iBAAiB1L,YAC1B,MAAM,IAAI/sB,MAAOsB,KAAKm3B,iBAAiBE,gBAExC,IAAKr3B,KAAKk3B,eAAezL,YACxB,MAAM,IAAI/sB,MAAOsB,KAAKk3B,eAAeG,gBAEtC,IAAKr3B,KAAKo3B,cAAc3L,YACvB,MAAM,IAAI/sB,MAAOsB,KAAKo3B,cAAcC,gBAErCr3B,KAAKs3B,iBAAiBxJ,yCAAcpwB,IAAI,QAKxCsC,KAAKu3B,KAAON,EAAGO,oBACfP,EAAGQ,gBAAgBz3B,KAAKu3B,MAExBjP,yCAAIL,iBAAiB,CAAE,EAAK,EAAK,EAAM,EAAK,EAAK,EAAM,EAAK,EAAK,EAAM,EAAK,EAAK,GAAOK,yCAAI9B,aAAaI,aAAc0B,yCAAI7B,YAAYW,aAEvI6P,EAAGS,oBAAoB13B,KAAK6tB,cAActD,kBAAkB,YAAa,EAAG0M,EAAGU,MAAOV,EAAGW,MAAO,EAAE1S,aAAa2S,kBAAmB,EAAE3S,aAAa2S,mBACjJZ,EAAGa,wBAAwB93B,KAAK6tB,cAActD,kBAAkB,aAKhE0M,EAAGc,WAAY,EAAK,EAAK,EAAK,GAE9Bd,EAAGe,OAAQf,EAAGgB,YACdhB,EAAGiB,WAAY,GACfjB,EAAGkB,UAAWlB,EAAGmB,QAEjBnB,EAAGoB,QAAQpB,EAAGqB,QAGdrB,EAAGe,OAAQf,EAAGsB,OACdtB,EAAGuB,YAAavB,EAAGwB,gCAAgC,GACnDxB,EAAGyB,sBAAuBzB,EAAG0B,SAAU1B,EAAG0B,UAC1C1B,EAAG2B,UAAW3B,EAAG4B,IAAK5B,EAAG6B,qBAOzB94B,KAAK+4B,OAAS,IAAI7T,aAAa,GAAG5G,KAAK,GACvCte,KAAKg5B,UAAY,IAAI9T,aAAa,GAAG5G,KAAK,GAC1Cte,KAAKi5B,aAAe,IAAI/T,aAAa,GAAG5G,KAAK,GAC7Cte,KAAKk5B,OAAS,EAEd5S,yCAAOD,aAAarmB,KAAK+4B,QACzBzS,yCAAOD,aAAarmB,KAAKg5B,WAGzBh5B,KAAKu2B,UAAY,SAAUtF,EAAKrL,EAAIC,EAAI2Q,EAAIC,EAAI7S,EAAIC,EAAI6S,EAAIC,EAAIC,EAAa,KAAMC,EAAc,KAAMC,EAAW,KAAMC,EAAY,MAEnI,IAAK9F,EAAIjD,UACR,OAED,IAAItH,EAAK1mB,KAAK0mB,GACVyS,EAAUn5B,KAAK6tB,cAEE,OAAjB+I,IAEHA,EAAe3F,EAAIhD,MACnB4I,EAAgB5F,EAAI/C,QAGF,OAAf4I,IAEHA,EAAa7F,EAAI9C,YACjB4I,EAAc9F,EAAI7C,cAGnB+K,EAAQnM,WAAY,eAAgBhtB,KAAKi5B,cACzCE,EAAQrN,UAAW,SAAU4G,yCAAQ0G,MACrCD,EAAQrN,UAAW,UAAW9rB,KAAKkzB,cACnCiG,EAAQrN,UAAW,UAAW9rB,KAAKmzB,QACnCgG,EAAQrN,UAAW,UAAW9rB,KAAKk5B,QAE/Bl5B,KAAKq5B,kBAAoBpI,EAAIjD,WAAahuB,KAAKs5B,eAAiBH,IAEnEzS,EAAG6S,cAAe7S,EAAG8S,UACrB9S,EAAGkI,YAAalI,EAAGmI,WAAYoC,EAAIjD,WAEnCmL,EAAQjN,UAAW,WAAY,GAC/BiN,EAAQrM,UAAW,eAAgBgK,EAAW7F,EAAI5C,OAAOuI,EAAcG,EAAY9F,EAAI5C,OAAOwI,EAAeC,EAAYC,GAEzH/2B,KAAKq5B,gBAAkBpI,EAAIjD,UAC3BhuB,KAAKs5B,aAAeH,GAGrBn5B,KAAK+4B,OAAO,GAAKrC,EACjB12B,KAAK+4B,OAAO,GAAKpC,EACjB32B,KAAK+4B,OAAO,GAAKnV,EACjB5jB,KAAK+4B,OAAO,GAAKlV,EAEjB7jB,KAAKg5B,UAAU,GAAKxC,EAAKI,EACzB52B,KAAKg5B,UAAU,GAAKvC,EAAKI,EACzB72B,KAAKg5B,UAAU,GAAKpT,EAAKgR,EACzB52B,KAAKg5B,UAAU,GAAKnT,EAAKgR,EAEzBnQ,EAAG+S,iBAAkBN,EAAQ3O,mBAAmB,gBAAgB,EAAOxqB,KAAKizB,UAAU5rB,MACtFqf,EAAG+S,iBAAkBN,EAAQ3O,mBAAmB,WAAW,EAAOxqB,KAAK+4B,QACvErS,EAAG+S,iBAAkBN,EAAQ3O,mBAAmB,cAAc,EAAOxqB,KAAKg5B,WAE1EtS,EAAGgT,WAAYhT,EAAGiT,eAAgB,EAAG,IAKtC35B,KAAK45B,SAAW,SAAUllB,EAAG0O,EAAGqR,EAAGC,EAAGzD,EAAI,MAEzC,IAAIvK,EAAK1mB,KAAK0mB,GACVyS,EAAUn5B,KAAK6tB,cAEnBsL,EAAQnM,WAAY,eAAgBhtB,KAAKi5B,cACzCE,EAAQrN,UAAW,SAAU4G,yCAAQ0G,MACrCD,EAAQrN,UAAW,UAAW9rB,KAAKkzB,cACnCiG,EAAQrN,UAAW,UAAW9rB,KAAKmzB,QAEnCnzB,KAAKq5B,gBAAkB,KAEvBr5B,KAAK+4B,OAAO,GAAKtE,EACjBz0B,KAAK+4B,OAAO,GAAKrE,EACjB10B,KAAK+4B,OAAO,GAAKrkB,EACjB1U,KAAK+4B,OAAO,GAAK3V,EAEjBpjB,KAAKg5B,UAAU,GAAK,EACpBh5B,KAAKg5B,UAAU,GAAK,EACpBh5B,KAAKg5B,UAAU,GAAK,EACpBh5B,KAAKg5B,UAAU,GAAK,EAEpBtS,EAAG+S,iBAAkBN,EAAQ3O,mBAAmB,gBAAgB,EAAOxqB,KAAKizB,UAAU5rB,MACtFqf,EAAG+S,iBAAkBN,EAAQ3O,mBAAmB,WAAW,EAAOxqB,KAAK+4B,QACvErS,EAAG+S,iBAAkBN,EAAQ3O,mBAAmB,cAAc,EAAOxqB,KAAKg5B,WAC1EtS,EAAGoF,UAAWqN,EAAQ3O,mBAAmB,WAAYxqB,KAAKk5B,QAC1DxS,EAAGgT,WAAYhT,EAAGiT,eAAgB,EAAG,KAQvClI,6BAAOjtB,UAAUq1B,aAAe,SAAUzJ,GAIzCvY,OAAAK,MAAM4hB,OAAO/L,yCAASqC,EAAO,CAAEnC,MAAOmC,EAAMnC,MAAOC,OAAQkC,EAAMlC,SAAUiC,OAAOC,IAOnFqB,6BAAOjtB,UAAUmqB,cAAgB,SAAUV,EAAOC,EAAQ7M,EAAO,UAAWkN,EAAO,GAElF,OAAO,IAAIR,yCAASE,EAAOC,GAAQ6B,UAAU1O,GAAQ4O,UAAU1B,GAAQnP,YAMxEqS,6BAAOjtB,UAAUu1B,YAAc,WAER,GAAlB/5B,KAAK8wB,WAEY,MAAhB9wB,KAAKoH,UACRpH,KAAKoH,QAAQwsB,uBAAwB,GAEtC5zB,KAAK4C,KAAKuvB,MAAM6H,eAAiB,gBAIb,MAAhBh6B,KAAKoH,UACRpH,KAAKoH,QAAQwsB,uBAAwB,GAEtC5zB,KAAK4C,KAAKuvB,MAAM6H,eAAiB,SAOnCvI,6BAAOjtB,UAAUoc,QAAU,WAEtB5gB,KAAK4C,KAAK+wB,YACb3zB,KAAK4C,KAAK+wB,WAAWsG,YAAaj6B,KAAK4C,MAExC5C,KAAK6yB,YAAYvT,OACjBtf,KAAK8yB,WAAWxT,OAChBtf,KAAK+yB,eAAezT,OACpBtf,KAAKgzB,mBAAmB1T,OAExBtf,KAAKylB,KAAO,KACZzlB,KAAKoH,QAAU,KACfpH,KAAK4C,KAAO,MAOb6uB,6BAAOjtB,UAAUkvB,cAAgB,SAAUwG,GAK1C,GAHAl6B,KAAK4C,KAAKuvB,MAAMR,WAAauI,EAC7Bl6B,KAAKm6B,gBAAkBD,EAEP,OAAZl6B,KAAK0mB,GACT,CACC,GAAoB,GAAhBwT,EAAM55B,OACT,MAAM,IAAI5B,MAAO,oFAElB,IAAIpB,EAAImC,SAASy6B,EAAM/6B,OAAO,EAAE,GAAI,IAAM,IACtCi7B,EAAI36B,SAASy6B,EAAM/6B,OAAO,EAAE,GAAI,IAAM,IACtC0Q,EAAIpQ,SAASy6B,EAAM/6B,OAAO,EAAE,GAAI,IAAM,IAE1Ca,KAAK0mB,GAAGqR,WAAYz6B,EAAG88B,EAAGvqB,EAAG,KAQ/B4hB,6BAAOjtB,UAAUgvB,OAAS,SAAUvF,EAAOC,GAE1C,IAAIsG,EAAOx0B,KAAK4C,KAAKo0B,wBAEhB/I,IAAOA,EAAQuG,EAAKvG,OACpBC,IAAQA,EAASsG,EAAKtG,QAE3BluB,KAAK4C,KAAKqrB,MAAQA,EAClBjuB,KAAK4C,KAAKsrB,OAASA,EAEnBluB,KAAKiuB,MAAQjuB,KAAK4C,KAAKqrB,MACvBjuB,KAAKkuB,OAASluB,KAAK4C,KAAKsrB,OAExBluB,KAAKq6B,OAASjnB,IAAIpT,KAAKiuB,MAAQjuB,KAAKkzB,cACpClzB,KAAKs6B,QAAUlnB,IAAIpT,KAAKkuB,OAASluB,KAAKkzB,cAEtC,IAAIxM,EAAK1mB,KAAK0mB,GAsBd,OArBU,MAANA,IAEHA,EAAGsR,OAAQtR,EAAG6T,cACd7T,EAAG8T,QAAS,EAAG,EAAGx6B,KAAKiuB,MAAOjuB,KAAKkuB,QACnCxH,EAAG+T,SAAU,EAAG,EAAGz6B,KAAKiuB,MAAOjuB,KAAKkuB,QAEhCluB,KAAKi5B,eAMRj5B,KAAKi5B,aAAa,GAAKj5B,KAAKiuB,MAC5BjuB,KAAKi5B,aAAa,GAAKj5B,KAAKkuB,OAE5BluB,KAAKi5B,aAAa,GAAKj5B,KAAKiuB,MAC5BjuB,KAAKi5B,aAAa,GAAKj5B,KAAKkuB,SAI9BluB,KAAK+5B,cACE/5B,MAORyxB,6BAAOjtB,UAAUk2B,YAAc,SAAUz7B,GAaxC,OAXAe,KAAKkzB,aAAej0B,EAEpBe,KAAKq6B,OAASjnB,IAAIpT,KAAKiuB,MAAQjuB,KAAKkzB,cACpClzB,KAAKs6B,QAAUlnB,IAAIpT,KAAKkuB,OAASluB,KAAKkzB,cAEtClzB,KAAKqmB,eAIJrmB,KAAK2iB,MAAM1jB,EAAOA,GAEZe,MAORyxB,6BAAOjtB,UAAUm2B,QAAU,SAAU17B,GAuBpC,OArBIA,GAEHe,KAAKq6B,OAASjnB,IAAIpT,KAAKkuB,OAASluB,KAAKkzB,cACrClzB,KAAKs6B,QAAUlnB,IAAIpT,KAAKiuB,MAAQjuB,KAAKkzB,gBAIrClzB,KAAKq6B,OAASjnB,IAAIpT,KAAKiuB,MAAQjuB,KAAKkzB,cACpClzB,KAAKs6B,QAAUlnB,IAAIpT,KAAKkuB,OAASluB,KAAKkzB,eAGxB,MAAXlzB,KAAK0mB,IAAc1mB,KAAKi5B,eAE3Bj5B,KAAKi5B,aAAa,GAAKj5B,KAAKiuB,MAC5BjuB,KAAKi5B,aAAa,GAAKj5B,KAAKkuB,OAE5BluB,KAAKi5B,aAAa,GAAKh6B,EAAQe,KAAKkuB,OAASluB,KAAKiuB,MAClDjuB,KAAKi5B,aAAa,GAAKh6B,EAAQe,KAAKiuB,MAAQjuB,KAAKkuB,QAGlDluB,KAAK46B,UAAY37B,EACVe,MAORyxB,6BAAOjtB,UAAUsvB,SAAW,WAE3B,OAAO9zB,MAORyxB,6BAAOjtB,UAAUuvB,QAAU,WAK1B,OAHe,MAAX/zB,KAAK0mB,IACR1mB,KAAK0mB,GAAG8T,QAAQ,EAAG,EAAGx6B,KAAKiuB,MAAOjuB,KAAKkuB,QAEjCluB,MAORyxB,6BAAOjtB,UAAU6sB,UAAY,SAAU6C,EAAK,YAAaC,EAAO,MAE/D,OAAOn0B,KAAK4C,KAAKqxB,UAAWC,EAAMC,IAOnC1C,6BAAOjtB,UAAUq2B,YAAc,WAE9B,OAAO76B,KAAK4C,KAAKqxB,UAAU,aAAa90B,OAAO,KAMhDsyB,6BAAOjtB,UAAUs2B,kBAAoB,SAAUt7B,EAAMP,EAAM,MAE1D,GAAKe,KAAKoH,QAEV,OAAc,OAAVnI,GAEHe,KAAKoH,QAAQ5H,GAAQP,EACde,MAGDA,KAAKoH,QAAQ5H,IAWrBiyB,6BAAOjtB,UAAU+uB,UAAY,SAAUt0B,GAEtC,OAAOe,KAAK86B,kBAAmB,YAAa77B,IAW7CwyB,6BAAOjtB,UAAU8uB,YAAc,SAAUr0B,GAExC,OAAOe,KAAK86B,kBAAmB,cAAe77B,IAW/CwyB,6BAAOjtB,UAAUu2B,QAAU,SAAU97B,GAEpC,OAAOe,KAAK86B,kBAAmB,UAAW77B,IAY3CwyB,6BAAOjtB,UAAUw2B,SAAW,SAAU/7B,GAErC,OAAOe,KAAK86B,kBAAmB,WAAY77B,IAW5CwyB,6BAAOjtB,UAAUy2B,UAAY,SAAUh8B,GAEtC,OAAOe,KAAK86B,kBAAmB,YAAa77B,IAW7CwyB,6BAAOjtB,UAAU02B,WAAa,SAAUj8B,GAEvC,OAAOe,KAAK86B,kBAAmB,aAAc77B,IAW9CwyB,6BAAOjtB,UAAU22B,YAAc,SAAUl8B,GAExC,OAAOe,KAAK86B,kBAAmB,cAAe77B,IAW/CwyB,6BAAOjtB,UAAU42B,cAAgB,SAAUn8B,GAE1C,OAAOe,KAAK86B,kBAAmB,gBAAiB77B,IAWjDwyB,6BAAOjtB,UAAU62B,cAAgB,SAAUp8B,GAE1C,OAAOe,KAAK86B,kBAAmB,gBAAiB77B,IAWjDwyB,6BAAOjtB,UAAU82B,WAAa,SAAUr8B,GAEvC,OAAOe,KAAK86B,kBAAmB,aAAc77B,IAW9CwyB,6BAAOjtB,UAAU+2B,KAAO,SAAUt8B,GAEjC,OAAOe,KAAK86B,kBAAmB,OAAQ77B,IAWxCwyB,6BAAOjtB,UAAUg3B,UAAY,SAAUv8B,GAEtC,OAAOe,KAAK86B,kBAAmB,YAAa77B,IAW7CwyB,6BAAOjtB,UAAUi3B,aAAe,SAAUx8B,GAEzC,OAAOe,KAAK86B,kBAAmB,eAAgB77B,IAWhDwyB,6BAAOjtB,UAAUk3B,YAAc,SAAUz8B,EAAM,MAE9C,OAAc,OAAVA,EAGIe,KAAKmzB,QAFZnzB,KAAKmzB,OAASl0B,EAIRe,KAAKwyB,MAAM,KAWnBf,6BAAOjtB,UAAUm3B,yBAA2B,SAAU18B,GAErD,OAAOe,KAAK86B,kBAAmB,2BAA4B77B,IAQ5DwyB,6BAAOjtB,UAAU6uB,gBAAkB,WAGlC,OADArzB,KAAKg0B,aAAch0B,KAAKylB,KAAKpe,KAAK,GAAIrH,KAAKylB,KAAKpe,KAAK,GAAIrH,KAAKylB,KAAKpe,KAAK,GAAIrH,KAAKylB,KAAKpe,KAAK,GAAIrH,KAAKylB,KAAKpe,KAAK,GAAIrH,KAAKylB,KAAKpe,KAAK,IAC1HrH,MAQRyxB,6BAAOjtB,UAAUwvB,aAAe,SAAUpkB,EAAGC,EAAGyI,EAAGC,EAAGnb,EAAGoV,GAExD,OAAqB,OAAjBxS,KAAKoH,SAERpH,KAAKizB,UAAU5rB,KAAK,GAAKuI,EACzB5P,KAAKizB,UAAU5rB,KAAK,GAAKwI,EACzB7P,KAAKizB,UAAU5rB,KAAK,GAAK,EACzBrH,KAAKizB,UAAU5rB,KAAK,GAAKiR,EACzBtY,KAAKizB,UAAU5rB,KAAK,GAAKkR,EACzBvY,KAAKizB,UAAU5rB,KAAK,GAAK,EACzBrH,KAAKizB,UAAU5rB,KAAK,GAAK+L,IAAIhW,GAC7B4C,KAAKizB,UAAU5rB,KAAK,GAAK+L,IAAIZ,GAC7BxS,KAAKizB,UAAU5rB,KAAK,GAAK,EAElBrH,OAIRA,KAAKoH,QAAQ4sB,aAAcpkB,EAAGC,EAAGyI,EAAGC,EAAGnF,IAAIhW,GAAIgW,IAAIZ,IAC5CxS,OAQRyxB,6BAAOjtB,UAAUowB,SAAW,SAAUlgB,EAAG0O,EAAGqR,EAAGC,GAG9C,OADA10B,KAAKoH,QAAQwtB,SAAUlgB,EAAG0O,EAAGqR,EAAGC,GACzB10B,MAQRyxB,6BAAOjtB,UAAUqwB,WAAa,SAAUngB,EAAG0O,EAAGqR,EAAGC,GAGhD,OADA10B,KAAKoH,QAAQytB,WAAYngB,EAAG0O,EAAGqR,EAAGC,GAC3B10B,MAQRyxB,6BAAOjtB,UAAUo3B,UAAY,SAAUlnB,EAAG0O,EAAGqR,EAAGC,GAG/C,OADA10B,KAAKoH,QAAQw0B,UAAWlnB,EAAG0O,EAAGqR,EAAGC,GAC1B10B,MAQRyxB,6BAAOjtB,UAAU4vB,UAAY,WAG5B,OADAp0B,KAAKoH,QAAQgtB,YACNp0B,MAQRyxB,6BAAOjtB,UAAU6vB,OAAS,SAAU3f,EAAG0O,GAGtC,OADApjB,KAAKoH,QAAQitB,OAAQ3f,EAAG0O,GACjBpjB,MAQRyxB,6BAAOjtB,UAAU8vB,UAAY,WAG5B,OADAt0B,KAAKoH,QAAQktB,YACNt0B,MAQRyxB,6BAAOjtB,UAAU+vB,OAAS,SAAU7f,EAAG0O,GAGtC,OADApjB,KAAKoH,QAAQmtB,OAAQ7f,EAAG0O,GACjBpjB,MAQRyxB,6BAAOjtB,UAAUgwB,KAAO,SAAU9f,EAAG0O,EAAGqR,EAAGC,GAG1C,OADA10B,KAAKoH,QAAQotB,KAAM9f,EAAG0O,EAAGqR,EAAGC,GACrB10B,MAQRyxB,6BAAOjtB,UAAU8Z,KAAO,SAAUrf,EAAM,MAIvC,OAFIA,GAAOe,KAAKuzB,UAAWt0B,GAC3Be,KAAKoH,QAAQkX,OACNte,MAQRyxB,6BAAOjtB,UAAUmwB,OAAS,SAAU11B,EAAM,MAIzC,OAFIA,GAAOe,KAAKszB,YAAar0B,GAC7Be,KAAKoH,QAAQutB,SACN30B,MAQRyxB,6BAAOjtB,UAAUswB,KAAO,SAAUpgB,EAAG0O,EAAG6K,EAAOC,GAe9C,OAbgB,OAAZluB,KAAK0mB,KAERhS,GAAK1U,KAAKkzB,aACV9P,GAAKpjB,KAAKkzB,aACVjF,GAASjuB,KAAKkzB,aACdhF,GAAUluB,KAAKkzB,aAEXlzB,KAAK46B,UACR56B,KAAK0mB,GAAG8T,QAAQx6B,KAAKiuB,MAAM7K,EAAE8K,EAAO,EAAGluB,KAAKkuB,OAAOxZ,EAAEuZ,EAAM,EAAGC,EAAQD,GAEtEjuB,KAAK0mB,GAAG8T,QAAQ9lB,EAAG1U,KAAKkuB,OAAO9K,EAAE8K,EAAO,EAAGD,EAAOC,IAG7CluB,MAQRyxB,6BAAOjtB,UAAUuwB,iBAAmB,SAAUC,EAAKC,EAAKvgB,EAAG0O,GAG1D,OADApjB,KAAKoH,QAAQ2tB,iBAAkBC,EAAKC,EAAKvgB,EAAG0O,GACrCpjB,MAQRyxB,6BAAOjtB,UAAU0wB,cAAgB,SAAUC,EAAKC,EAAKC,EAAKC,EAAK5gB,EAAG0O,GAGjE,OADApjB,KAAKoH,QAAQ8tB,cAAeC,EAAKC,EAAKC,EAAKC,EAAK5gB,EAAG0O,GAC5CpjB,MAQRyxB,6BAAOjtB,UAAU+wB,IAAM,SAAU7gB,EAAG0O,EAAG9lB,EAAGk4B,EAAIC,EAAIC,GAGjD,OADA11B,KAAKoH,QAAQmuB,IAAK7gB,EAAG0O,EAAG9lB,EAAGk4B,EAAIC,EAAIC,GAC5B11B,MAQRyxB,6BAAOjtB,UAAUmxB,MAAQ,SAAUC,EAAIC,EAAIC,EAAIC,EAAIz4B,GAGlD,OADA0C,KAAKoH,QAAQuuB,MAAOC,EAAIC,EAAIC,EAAIC,EAAIz4B,GAC7B0C,MAQRyxB,6BAAOjtB,UAAUwxB,SAAW,SAAU5xB,EAAMsQ,EAAG0O,EAAG6S,EAAS,KAG1D,OADAj2B,KAAKoH,QAAQ4uB,SAAU5xB,EAAMsQ,EAAG0O,EAAG6S,GAC5Bj2B,MAQRyxB,6BAAOjtB,UAAU0xB,WAAa,SAAU9xB,EAAMsQ,EAAG0O,EAAG6S,EAAS,KAG5D,OADAj2B,KAAKoH,QAAQ8uB,WAAY9xB,EAAMsQ,EAAG0O,EAAG6S,GAC9Bj2B,MASRyxB,6BAAOjtB,UAAU2xB,YAAc,SAAU/xB,GAExC,OAAOpE,KAAKoH,QAAQ+uB,YAAY/xB,GAAM6pB,OASvCwD,6BAAOjtB,UAAU4xB,gBAAkB,SAAU3B,EAAGC,GAE/C,OAAO10B,KAAKoH,QAAQgvB,gBAAiB3B,EAAGC,IASzCjD,6BAAOjtB,UAAU6xB,aAAe,SAAU3hB,EAAG0O,EAAGqR,EAAGC,GAElD,OAAO10B,KAAKoH,QAAQivB,aAAc3hB,EAAG0O,EAAGqR,EAAGC,IAS5CjD,6BAAOjtB,UAAU8xB,aAAe,SAAUjvB,EAAMqN,EAAG0O,GAGlD,OADApjB,KAAKoH,QAAQkvB,aAAcjvB,EAAMqN,EAAG0O,GAC7BpjB,MAWRyxB,6BAAOjtB,UAAU+xB,UAAY,SAAUtF,EAAKrL,EAAG,EAAGC,EAAG,EAAG2Q,EAAG,KAAMC,EAAG,KAAM7S,EAAG,KAAMC,EAAG,KAAM6S,EAAG,KAAMC,EAAG,MAEvG,GAAW,OAAPH,EAEHx2B,KAAKoH,QAAQmvB,UAAWtF,EAAK7d,IAAIwS,GAAKxS,IAAIyS,SAEtC,GAAW,OAAPjC,EAER5jB,KAAKoH,QAAQmvB,UAAWtF,EAAK7d,IAAIwS,GAAKxS,IAAIyS,GAAKzS,IAAIojB,GAAKpjB,IAAIqjB,QAG7D,CACC,IAAIlxB,EAAK6N,IAAIojB,GACThxB,EAAK4N,IAAIqjB,GACb,IAAKlxB,IAAOC,EAAI,OAAOxF,KAEvB,IAAI2F,EAAKyN,IAAIsjB,GACT9wB,EAAKwN,IAAIujB,GACb,IAAKhxB,IAAOC,EAAI,OAAO5F,KAEvBA,KAAKoH,QAAQmvB,UAAWtF,EAAK7d,IAAIwS,GAAKxS,IAAIyS,GAAKtgB,EAAIC,EAAI4N,IAAIwQ,GAAKxQ,IAAIyQ,GAAKle,EAAIC,GAG9E,OAAO5F,MAYRyxB,6BAAOjtB,UAAU6H,MAAQ,SAAU8tB,EAAgB,MAElD,OAAe,MAAXn6B,KAAK0mB,IAER1mB,KAAK0mB,GAAGra,MAAMrM,KAAK0mB,GAAGmV,mBAAqB77B,KAAK0mB,GAAGoV,iBAAmB97B,KAAK0mB,GAAGqV,kBAC9E/7B,KAAKq5B,gBAAkB,KAChBr5B,OAGJm6B,EAEHn6B,KAAK27B,yBAAyB,eAAeD,YAAY,GAAKnI,WAA8B,IAApB4G,EAA2BA,EAAkBn6B,KAAKm6B,iBAAiBvF,SAAS,EAAG,EAAG50B,KAAKq6B,OAAQr6B,KAAKs6B,UAI5Kt6B,KAAK4C,KAAKqrB,MAAQjuB,KAAKiuB,MACvBjuB,KAAK+5B,eAGN/5B,KAAKqzB,kBACErzB,OAORyxB,6BAAOjtB,UAAU6Q,MAAQ,aAOzBoc,6BAAOjtB,UAAUw3B,IAAM,aAOvBvK,6BAAOjtB,UAAUuM,MAAQ,aAezB0gB,6BAAOjtB,UAAUy3B,KAAO,SAAUjO,EAAWC,EAAOC,EAAQL,EAAc,MAEzE,IAAInH,EAAK1mB,KAAK0mB,GACH,OAAPA,IAEJmH,EAAgBA,GAAiB7tB,KAAKo3B,cAEtCp3B,KAAKs3B,iBAAiBzJ,GACtBnH,EAAG2R,QAAS3R,EAAGuR,YAEdvR,EAAG6S,cAAe7S,EAAG8S,UACrB9S,EAAGkI,YAAalI,EAAGmI,WAAYb,GAC/BH,EAAc3B,UAAW,WAAY,GAErC2B,EAAcb,WAAY,eAAgBhtB,KAAKi5B,cAC/CpL,EAAc/B,UAAW,SAAU4G,yCAAQ0G,MAC3CvL,EAAc/B,UAAW,UAAW9rB,KAAKkzB,cACzCrF,EAAc/B,UAAW,UAAW9rB,KAAKmzB,QAEzCnzB,KAAK+4B,OAAO,GAAK/4B,KAAKiuB,MACtBjuB,KAAK+4B,OAAO,GAAK/4B,KAAKkuB,OACtBluB,KAAK+4B,OAAO,GAAK,EACjB/4B,KAAK+4B,OAAO,GAAK,EAEjB/4B,KAAKg5B,UAAU,GAAKh5B,KAAKiuB,MAAQA,EACjCjuB,KAAKg5B,UAAU,GAAKh5B,KAAKkuB,OAASA,EAClCluB,KAAKg5B,UAAU,GAAK,EACpBh5B,KAAKg5B,UAAU,GAAK,EAEpBtS,EAAG+S,iBAAkB5L,EAAcrD,mBAAmB,WAAW,EAAOxqB,KAAK+4B,QAC7ErS,EAAG+S,iBAAkB5L,EAAcrD,mBAAmB,cAAc,EAAOxqB,KAAKg5B,WAChFtS,EAAGgT,WAAYhT,EAAGiT,eAAgB,EAAG,GAEtC35B,KAAKs3B,iBAAiBxJ,yCAAcpwB,IAAI,QACxCgpB,EAAGsR,OAAQtR,EAAGuR,cAQfxG,6BAAOjtB,UAAUyD,MAAQ,SAAUi0B,GAAU,GAQ5C,OANAl8B,KAAKuzB,UAAU,WAAWD,YAAY,WAAWyH,QAAQ,QAAQC,SAAS,SACzEC,UAAU,KAAKC,WAAW,MAAMC,YAAY,WAAWC,cAAc,KACrEC,cAAc,KAAKC,WAAW,KAAKI,YAAY,OAAOC,yBAAyB,eAE5EO,GAAWl8B,KAAKo0B,YAAYE,YAEzBt0B,MAMRyxB,6BAAOjtB,UAAU23B,WAAa,WAK7B,OAHAn8B,KAAK6yB,YAAYhwB,KAAK7C,KAAKylB,MAC3BzlB,KAAKylB,KAAOzlB,KAAKylB,KAAK9iB,QAEf3C,MAMRyxB,6BAAOjtB,UAAU43B,UAAY,WAK5B,OAHAp8B,KAAKylB,KAAKnG,OACVtf,KAAKylB,KAAOzlB,KAAK6yB,YAAY/lB,MAEtB9M,KAAKqzB,mBAUb5B,6BAAOjtB,UAAUguB,MAAQ,SAAUvzB,GAOlC,OALAe,KAAKmzB,QAAUl0B,EAEXe,KAAKoH,SAAuB,OAAZpH,KAAK0mB,KACxB1mB,KAAKoH,QAAQs0B,YAAc17B,KAAKmzB,QAE1BnzB,MAMRyxB,6BAAOjtB,UAAU63B,UAAY,WAG5B,OADAr8B,KAAK8yB,WAAWjwB,KAAM7C,KAAK07B,eACpB17B,MAQRyxB,6BAAOjtB,UAAU83B,SAAW,WAG3B,OADAt8B,KAAK07B,YAAY17B,KAAK8yB,WAAWhmB,OAC1B9M,MAMRyxB,6BAAOjtB,UAAU+3B,aAAe,SAAUt9B,GAEzC,IAAIynB,EAAK1mB,KAAK0mB,GACH,OAAPA,IAEAznB,GAEHynB,EAAGsR,OAAQtR,EAAGuR,YACdj4B,KAAKozB,YAAa,IAIlB1M,EAAG2R,QAAS3R,EAAGuR,YACfj4B,KAAKozB,YAAa,KAOpB3B,6BAAOjtB,UAAUg4B,aAAe,WAE/B,OAAOx8B,KAAKozB,YAOb3B,6BAAOjtB,UAAUi4B,cAAgB,SAAUx9B,EAAM,MAEhD,GAAc,OAAVA,EAIH,OAFAA,IAAUA,KAEIe,KAAKozB,aAGnBpzB,KAAK+yB,eAAelwB,KAAK7C,KAAKozB,YAC9BpzB,KAAKu8B,aAAat9B,IAEX,GAGRe,KAAK+yB,eAAelwB,KAAK7C,KAAKozB,aAM/B3B,6BAAOjtB,UAAUk4B,aAAe,WAE/B18B,KAAKu8B,aAAav8B,KAAK+yB,eAAejmB,QAMvC2kB,6BAAOjtB,UAAU8yB,iBAAmB,SAAU6B,GAGlC,OADFn5B,KAAK0mB,KAGd1mB,KAAK6tB,cAAgBsL,EACrBn5B,KAAK6tB,cAActC,aAMpBkG,6BAAOjtB,UAAUm4B,iBAAmB,WAEnC,OAAO38B,KAAK6tB,eAOb4D,6BAAOjtB,UAAUo4B,kBAAoB,SAAUzD,EAAQ,MAEtD,GAAgB,OAAZA,EAEH,OAAIA,IAAYn5B,KAAK6tB,gBAGrB7tB,KAAKgzB,mBAAmBnwB,KAAK7C,KAAK6tB,eAClC7tB,KAAKs3B,iBAAiB6B,IAEf,GAGRn5B,KAAKgzB,mBAAmBnwB,KAAK7C,KAAK6tB,gBAMnC4D,6BAAOjtB,UAAUq4B,iBAAmB,WAEnC78B,KAAKs3B,iBAAiBt3B,KAAKgzB,mBAAmBlmB,QAU/C2kB,6BAAOjtB,UAAU6hB,aAAe,WAG/B,OADArmB,KAAKylB,KAAKJ,WACHrlB,KAAKqzB,mBAUb5B,6BAAOjtB,UAAUs4B,WAAa,SAAUrX,GAGvC,OADAzlB,KAAKylB,KAAK9nB,IAAI8nB,GACPzlB,KAAKqzB,mBAUb5B,6BAAOjtB,UAAUu4B,UAAY,SAAUp6B,GAAM,GAE5C,OAAOA,EAAQ3C,KAAKylB,KAAK9iB,QAAU3C,KAAKylB,MAUzCgM,6BAAOjtB,UAAUw4B,aAAe,SAAUvX,GAGzC,OADAzlB,KAAKylB,KAAKvE,OAAOuE,GACVzlB,KAAKqzB,mBAWb5B,6BAAOjtB,UAAUme,MAAQ,SAAUiD,EAAIC,EAAIoX,GAAU,GAEpD,OAAIA,GACHj9B,KAAKoH,QAAQub,MAAOiD,EAAIC,GACjB7lB,OAGRA,KAAKylB,KAAK9C,MAAOiD,EAAIC,GACd7lB,KAAKqzB,oBAWb5B,6BAAOjtB,UAAUsf,OAAS,SAAUC,EAAOkZ,GAAU,GAEpD,OAAIA,GACHj9B,KAAKoH,QAAQ0c,OAAQC,GACd/jB,OAGRA,KAAKylB,KAAK3B,OAAOC,GACV/jB,KAAKqzB,oBAWb5B,6BAAOjtB,UAAUmf,UAAY,SAAUjP,EAAG0O,EAAG6Z,GAAU,GAEtD,OAAIA,GACHj9B,KAAKoH,QAAQuc,UAAUjP,EAAG0O,GACnBpjB,OAGRA,KAAKylB,KAAK9B,UAAUjP,EAAG0O,GAChBpjB,KAAKqzB,oBAUb5B,6BAAOjtB,UAAU04B,QAAU,SAAUxoB,EAAG0O,EAAGqR,EAAGC,GAE7C,IAAIyI,EAAK1I,EAAG,EAAG,SAAU2I,EAAK1I,EAAG,EAAG,SAChC2I,EAAK3oB,EAAE+f,EAAE,EAAG6I,EAAKla,EAAEsR,EAAE,EAAG6I,EAAK7oB,EAAE+f,EAAE,EAAG+I,EAAKpa,EAAEsR,EAAE,EASjD,OAPA10B,KAAKo0B,YAAaC,OAAO3f,EAAG8oB,GAC5Bx9B,KAAKk1B,cAAexgB,EAAG8oB,EAAKJ,EAAIG,EAAKJ,EAAI/Z,EAAGma,EAAIna,GAChDpjB,KAAKk1B,cAAeqI,EAAKJ,EAAI/Z,EAAGia,EAAIG,EAAKJ,EAAIC,EAAIG,GACjDx9B,KAAKk1B,cAAemI,EAAIG,EAAKJ,EAAIG,EAAKJ,EAAIG,EAAIC,EAAID,GAClDt9B,KAAKk1B,cAAeqI,EAAKJ,EAAIG,EAAI5oB,EAAG8oB,EAAKJ,EAAI1oB,EAAG8oB,GAChDx9B,KAAKs0B,YAEEt0B,MAYRyxB,6BAAOjtB,UAAUi5B,OAAS,SAAU/oB,EAAG0O,EAAG9lB,EAAGq3B,GAQ5C,OANA30B,KAAKo0B,YACLp0B,KAAKu1B,IAAI7gB,EAAG0O,EAAG9lB,EAAG,EAAG,EAAEmQ,KAAKiwB,IAC5B19B,KAAKs0B,YAEDK,GAAQ30B,KAAK20B,OAAOA,GAEjB30B,MAYRyxB,6BAAOjtB,UAAUm5B,KAAO,SAAU/H,EAAIC,EAAIC,EAAIC,EAAIpB,GAQjD,OANA30B,KAAKo0B,YACLp0B,KAAKq0B,OAAOuB,EAAIC,GAChB71B,KAAKu0B,OAAOuB,EAAIC,GAChB/1B,KAAKs0B,YAEDK,GAAQ30B,KAAK20B,OAAOA,GACjB30B,MAYRyxB,6BAAOjtB,UAAUo5B,oBAAsB,WAEtC,GAAI59B,KAAK69B,eAAgB,OAAO79B,KAEhCA,KAAK89B,aAAe,CAAElY,GAAI,EAAGC,GAAI,GACjC7lB,KAAK+9B,cAAgB,CAAErpB,EAAG,EAAG0O,EAAG,GAEhC,IAAI4a,EAAIh+B,KAEJi+B,EACJ,CACCC,OAAQ,GACRC,QAAS,EAAGC,SAAU,EACtB1pB,EAAG,EAAG0O,EAAG,EAETib,YAAa,SAAU3pB,EAAG0O,EAAGqR,EAAGC,GAC/B,OAAO10B,KAAK0U,GAAKA,GAAK1U,KAAK0U,GAAMA,EAAE+f,EAAE,GAAMz0B,KAAKojB,GAAKA,GAAKpjB,KAAKojB,GAAMA,EAAEsR,EAAE,IAuD3E,OAnDA10B,KAAKs+B,gBAAkB,GAEvBt+B,KAAK69B,eAAiB,SAAUl/B,EAAM2K,GAErC,IAAIkrB,EAAOx0B,KAAK4C,KAAKo0B,wBAErBiH,EAAKC,OAASv/B,EACds/B,EAAKE,QAAU70B,EAAI60B,QACnBF,EAAKvpB,EAAIupB,EAAKM,GAAKnrB,IAAI9J,EAAIk1B,QAAUhK,EAAKpC,MAC1C6L,EAAK7a,EAAI6a,EAAKQ,GAAKrrB,IAAI9J,EAAIo1B,QAAUlK,EAAKhU,KAE1Cyd,EAAKvpB,GAAKupB,EAAMvpB,EAAIspB,EAAED,cAAcrpB,EAAK,EAAIspB,EAAEF,aAAalY,IAAMoY,EAAEF,aAAalY,GACjFqY,EAAK7a,GAAK6a,EAAM7a,EAAI4a,EAAED,cAAc3a,EAAK,EAAI4a,EAAEF,aAAajY,IAAMmY,EAAEF,aAAajY,GAEjFoY,EAAKU,UAAW,EAEZV,EAAKE,UAAYF,EAAKG,WAEzBH,EAAKrY,GAAKqY,EAAKvpB,EACfupB,EAAKpY,GAAKoY,EAAK7a,EAEf6a,EAAKW,IAAMX,EAAKY,IAAM,GAGnBZ,EAAKE,SAAWF,EAAKG,WAExBH,EAAKU,UAAW,EAEhBV,EAAKra,GAAKqa,EAAKvpB,EAAIupB,EAAKrY,GACxBqY,EAAKpa,GAAKoa,EAAK7a,EAAI6a,EAAKpY,GAExBoY,EAAKa,IAAMb,EAAKra,GAAKqa,EAAKW,IAC1BX,EAAKc,IAAMd,EAAKpa,GAAKoa,EAAKY,IAE1BZ,EAAKW,IAAMX,EAAKra,GAChBqa,EAAKY,IAAMZ,EAAKpa,IAGjBoa,EAAKG,SAAWH,EAAKE,QAErB,IAAK,IAAI99B,EAAI,EAAGA,EAAIL,KAAKs+B,gBAAgBh+B,SAE8B,IAAlEN,KAAKs+B,gBAAgBj+B,GAAG,GAAI49B,EAAMj+B,KAAKs+B,gBAAgBj+B,GAAG,IAFdA,OAOlDL,KAAK4C,KAAKo8B,YAAc,SAAS11B,GAAQ00B,EAAEH,eAAe,OAAQv0B,IAClEtJ,KAAK4C,KAAKq8B,UAAY,SAAS31B,GAAO00B,EAAEH,eAAe,KAAMv0B,IAC7DtJ,KAAK4C,KAAKs8B,YAAc,SAAS51B,GAAO00B,EAAEH,eAAe,OAAQv0B,IAE1DtJ,MAURyxB,6BAAOjtB,UAAU26B,gBAAkB,SAAUvZ,EAAIC,GAGhD,OADA7lB,KAAK89B,aAAe,CAAElY,GAAIA,EAAIC,GAAIA,GAC3B7lB,MAURyxB,6BAAOjtB,UAAU46B,iBAAmB,SAAU1qB,EAAG0O,GAGhD,OADApjB,KAAK+9B,cAAgB,CAAErpB,EAAGA,EAAG0O,EAAGA,GACzBpjB,MAWRyxB,6BAAOjtB,UAAU66B,kBAAoB,SAAUnxB,EAAU9G,GAMxD,OAJApH,KAAK49B,sBAEL59B,KAAKs+B,gBAAgBz7B,KAAM,CAAC7C,KAAKs+B,gBAAgBh+B,OAAO,IAAI8S,IAAkB,IAAd3F,KAAK6xB,UAAepxB,EAAU9G,IAEvFpH,KAAKs+B,gBAAgBt+B,KAAKs+B,gBAAgBh+B,OAAO,GAAG,IAU5DmxB,6BAAOjtB,UAAU+6B,qBAAuB,SAAU/gC,GAEjD,GAAKwB,KAAKs+B,gBAEV,IAAK,IAAIj+B,EAAI,EAAGA,EAAIL,KAAKs+B,gBAAgBh+B,OAAQD,IAEhD,GAAIL,KAAKs+B,gBAAgBj+B,GAAG,IAAM7B,EAClC,CACCwB,KAAKs+B,gBAAgB79B,OAAOJ,EAAG,GAC/B,QASHoxB,6BAAO+N,YAAc,SAAUvR,EAAOC,EAAQuR,EAAMC,GAEnD,IAAItF,EAAI,IAAI3I,6BAAQ,CAAEZ,QAAQ,EAAM5C,MAAOA,EAAOC,OAAQA,EAAQ4C,UAAW6O,yCAAOhP,QAAQG,YAE5F2O,EAAKrF,GACL,IAAIn2B,EAAMm2B,EAAE/I,YAERJ,EAAM,IAAIC,MACdD,EAAIE,OAAS,KAEZF,EAAI5P,OAASse,yCAAOhP,QAAQG,UAAY,SAAW,UACnDG,EAAI5C,OAAS,EACb4C,EAAI9C,YAAcF,EAClBgD,EAAI7C,aAAeF,EAEnByR,yCAAOC,SAAS/F,aAAa5I,GAC7ByO,EAAUzO,EAAKhtB,IAGhBgtB,EAAIG,IAAMntB,EACVm2B,EAAExZ,WAQH6Q,6BAAOoO,kBAAoB,SAAUC,EAAQ7R,EAAOC,EAAQuR,EAAMC,GAEjE,IAAItF,EAAI,IAAI3I,6BAAQ,CAAEZ,QAAQ,EAAM5C,MAAOA,EAAOC,OAAQA,EAAQ4C,UAAW6O,yCAAOhP,QAAQG,YAE5F2O,EAAKrF,GACL,IAAIn2B,EAAMm2B,EAAE/I,YAERJ,EAAM,IAAIC,MACdD,EAAIE,OAAS,KAEZF,EAAI5P,OAASse,yCAAOhP,QAAQG,UAAY,SAAW,UACnDG,EAAI5C,OAAS,EACb4C,EAAI9C,YAAcF,EAClBgD,EAAI7C,aAAeF,EACnB+C,EAAI1C,OAASuR,EAEbH,yCAAOC,SAAS/F,aAAa5I,GAC7ByO,EAAUzO,EAAKhtB,IAGhBgtB,EAAIG,IAAMntB,EACVm2B,EAAExZ,W,IAGHgQ,yCAAea;;;;;;uBQn5Df;MAAMsO,6BAAS;;;AAOdA,kBAA2B,CAC1BC,SAAU,EACVC,OAAQ;;;AAOTF,iBAA0B,CACzBG,aAAgB,GAChBC,WAAc,GACdC,aAAgB,GAChBC,mBAAoB,GACpBC,kBAAmB,GACnBC,kBAAmB,GACnBC,cAAgB;;;;;;;;;;AA8MlBhjC,OAAOijC,OAAOV,6BACd,CAICW,MACA,CACCC,kBAAkB,EAClBC,iBAAiB,GAMlBC,eACA,CACClP,WAAY,UACZjL,IAAI,EACJjQ,KAAK,EAELqqB,UAAU,EACVhQ,WAAW,EACXiQ,YAAa,EAEbC,IAAK,IACLC,OAAQ,GACRvf,OAAO,EAEPwf,YAAa,KACbC,aAAc,KAEdC,iBAAkB,EAClBC,eAAgB,KAEhBC,YAAY,GAObJ,YAAa,EAMbC,aAAc,EAMdJ,YAAa,EAKbQ,MAAO,EAAGC,MAAO,EAKjBC,iBAAkB,EAAGC,kBAAmB,EAAGC,iBAAkB,EAAGC,kBAAmB,EAAGC,YAAa,EAMnGC,cAAe,KAMflC,SAAU,KAMVmC,eAAgB,KAMhBC,eAAgB,KAKhBC,kBAAmB,KAMnBC,SAAU,CAAE9I,KAAM,EAAGpsB,OAAO,EAAOm1B,MAAM,EAAOC,KAAK,EAAOC,QAAS,GAMrEC,SAAU,GAKVC,YAAa,KAKbC,UAAW,KAMXC,UAAW,EAMXC,cAAe,EAMfC,mBAAoB,EAMpBC,iBAAkB,EAMlBC,WAAY,EAMZC,UAAW,EAMXC,YAAa,EAKbC,KACA,CAIClhB,UAAW,EACXmhB,SAAU,EAKVC,UAAW,EAKXC,WAAY,EAKZC,gBAAiB,EACjBC,cAAe,EACfC,eAAgB,EAChBC,eAAgB,EAKhBvC,IAAK,EACLwC,WAAY,EACZC,kBAAmB,EACnBC,gBAAiB,EACjBC,iBAAkB,EAClBC,iBAAkB,GAOnBz7B,KAAM,SAAUwoB,EAAQ,MAEvB,IAAI3yB,EAAOgC,KAEPwC,EAAI,IAAKxC,KAAK6gC,kBAAmBlQ,GACrC3wB,KAAK2wB,QAAUnuB,GAGkB,IAA7BxC,KAAK2wB,QAAQ1R,eAEiB,IAA7Bjf,KAAK2wB,QAAQ1R,YAChBjB,yCAASiB,cAETjB,yCAASiB,YAAYjf,KAAK2wB,QAAQ1R,cAIhCzc,EAAE0+B,aAAe1+B,EAAE2+B,cAAiC,WAAjB3+B,EAAEu+B,cACxCv+B,EAAEu+B,YAAcv+B,EAAE0+B,YAAc1+B,EAAE2+B,aAAe,YAAc,YAEhEnhC,KAAK+gC,YAAcv+B,EAAEu+B,YAErB/gC,KAAKuiC,YAAc/gB,yCAAKxB,KAAKX,QAC7Brf,KAAKwiC,UAAYhhB,yCAAKxB,KAAKX,QAG3Brf,KAAK0iC,cAAgB,IAAOlgC,EAAEw+B,IAC9BhhC,KAAK4iC,iBAAmB,IAAOpgC,EAAEy+B,OAEjC/iC,eAAO2lC,SAAW,WAAa7lC,EAAK8lC,mBAEpC9jC,KAAK+jC,WAAa,IAAI7gB,yCAAO1gB,EAAEkf,MAAO1hB,KAAK0iC,eAAgBsB,GAAUhkC,KAAKikC,QAAQD,KAGlFhkC,KAAK4/B,SAAW,IAAIhP,yCAAQ,CAAElK,GAAIlkB,EAAEkkB,GAAI9jB,KAAM,KAAMgvB,UAAU,EAAMf,QAAQ,EAAOC,UAAWtuB,EAAEsuB,UAAWa,WAAYnvB,EAAEmvB,aAEzH3xB,KAAK+hC,eAAiB,IAAInR,yCAAQ,CAAElK,IAAI,EAAO9jB,KAAM,KAAMgvB,UAAU,EAAMf,QAAQ,EAAOC,UAAWtuB,EAAEsuB,UAAWa,WAAY,SAC9H3xB,KAAK+hC,eAAen/B,KAAKuvB,MAAM+R,cAAgB,OAE/ClkC,KAAKgiC,eAAiB,IAAIpR,yCAAQ,CAAElK,IAAI,EAAO9jB,KAAM,KAAMgvB,UAAU,EAAMf,QAAQ,EAAOC,UAAWtuB,EAAEsuB,UAAWa,WAAY,SAC9H3xB,KAAKgiC,eAAep/B,KAAKuvB,MAAM+R,cAAgB,OAE/ClkC,KAAKiiC,kBAAoB,IAAIrR,yCAAQ,CAAEC,QAAQ,EAAMC,UAAWtuB,EAAEsuB,YAAa0C,OAAO,IAAK,KAE3F,IAAI2Q,EAAWnkC,KAAK4/B,SAASh9B,KAG7B5C,KAAKyhC,iBAAmBvjC,eAAOujC,kBAAoB,EAEnDzhC,KAAK0hC,mBAA6B,IAATl/B,EAAEkkB,GAAc,EAAK1mB,KAAK4/B,SAASx4B,QAAQg9B,8BAC7DpkC,KAAK4/B,SAASx4B,QAAQi9B,2BACtBrkC,KAAK4/B,SAASx4B,QAAQk9B,0BACtBtkC,KAAK4/B,SAASx4B,QAAQm9B,yBACtBvkC,KAAK4/B,SAASx4B,QAAQo9B,wBAA0B,EAEvDxkC,KAAK2hC,iBAAmB3hC,KAAKyhC,iBAAmBzhC,KAAK0hC,kBAErD3B,6BAAO+D,iBAAgB,GAGvB5lC,eAAOumC,UAAY,SAAUn7B,GAE5B,GAAIA,EAAIgc,SAAWpnB,eAAO4zB,SAASG,KAAnC,CAGA,GAAIj0B,EAAKkkC,SAAS54B,EAAI+4B,SACrB,OAAO,EAOR,OALArkC,EAAKkkC,SAAS54B,EAAI+4B,UAAW,EAE7BrkC,EAAKkkC,SAASG,QAAU/4B,EAAI+4B,QAC5BrkC,EAAKkkC,SAASpgB,UAAYS,QAElBjZ,EAAI+4B,SAEX,KAAK,GACJrkC,EAAKkkC,SAASl1B,OAAQ,EACtB,MAED,KAAK,GACJhP,EAAKkkC,SAASC,MAAO,EACrB,MAED,KAAK,GACJnkC,EAAKkkC,SAASE,KAAM,EAKtB,OAAIpkC,EAAKkkC,SAASC,MAAQ74B,EAAI+4B,SAAWzpB,yCAAQE,KAEhD9a,EAAKkkC,SAAS54B,EAAI+4B,UAAW,GACtB,IAGmF,IAAvFrkC,EAAK0mC,gBAAiB1mC,EAAK2mC,kBAAkB3E,SAAU12B,EAAI+4B,QAASrkC,EAAKkkC,gBAA7E,IAIDhkC,eAAO0mC,QAAU,SAAUt7B,GAE1B,GAAIA,EAAIgc,SAAWpnB,eAAO4zB,SAASG,KAAnC,CAGA,IAAKj0B,EAAKkkC,SAAS54B,EAAI+4B,SACtB,OAAO,EAMR,OAJArkC,EAAKkkC,SAAS54B,EAAI+4B,UAAW,EAC7BrkC,EAAKkkC,SAAS2C,QAAUtiB,QACxBvkB,EAAKkkC,SAASG,QAAU/4B,EAAI+4B,QAEpB/4B,EAAI+4B,SAEX,KAAK,GACJrkC,EAAKkkC,SAASl1B,OAAQ,EACtB,MAED,KAAK,GACJhP,EAAKkkC,SAASC,MAAO,EACrB,MAED,KAAK,GACJnkC,EAAKkkC,SAASE,KAAM,EAItB,OAAyF,IAArFpkC,EAAK0mC,gBAAiB1mC,EAAK2mC,kBAAkB1E,OAAQ32B,EAAI+4B,QAASrkC,EAAKkkC,gBAA3E,IAMD,MAAM4C,EAAe,SAAUpwB,EAAG0O,GAEjC,OAAO2c,6BAAOgF,cAAgB3xB,IAAI2sB,6BAAOmB,YAAY,GAAK9d,EAAE2c,6BAAOyB,OAAOzB,6BAAO6B,mBAAqBxuB,KAAKsB,EAAEqrB,6BAAOwB,OAAOxB,6BAAO6B,oBAG7HoD,EAAe,SAAUtwB,EAAG0O,GAEjC,OAAO2c,6BAAOgF,cAAgB3xB,KAAKsB,EAAEqrB,6BAAOwB,OAAOxB,6BAAO6B,mBAAqBxuB,KAAKgQ,EAAE2c,6BAAOyB,OAAOzB,6BAAO6B,oBAIxG,iBAAkB1jC,gBAErBimC,EAASc,aAAe,SAAU37B,GAEjCA,EAAI47B,iBAEJ,IAAIC,EAAU77B,EAAI87B,eAElB,IAAK,IAAI/kC,EAAI,EAAGA,EAAI8kC,EAAQ7kC,OAAQD,IACpC,CACM0/B,6BAAOuC,SAAS6C,EAAQ9kC,GAAGglC,cAE/BtF,6BAAOuC,SAAS6C,EAAQ9kC,GAAGglC,YAAc,CACvC7mC,GAAI2mC,EAAQ9kC,GAAGglC,WAAYC,UAAU,EAAOC,YAAY,EACxD3f,GAAI,EAAGC,GAAI,EAAGnR,EAAG,EAAG0O,EAAG,EAAGQ,GAAI,EAAGC,GAAI,EAAG2hB,OAAQ,EAChDC,WAAY,EAAGC,WAAY,IAI9B,IAAIC,EAAI5F,6BAAOuC,SAAS6C,EAAQ9kC,GAAGglC,YAEnCM,EAAEL,UAAW,EACbK,EAAEJ,YAAa,EACfI,EAAEH,OAAS,EAEXG,EAAE7jB,UAAYS,QAEdojB,EAAEjxB,EAAIixB,EAAE/f,GAAKkf,EAAaK,EAAQ9kC,GAAGm+B,QAAS2G,EAAQ9kC,GAAGq+B,SACzDiH,EAAEviB,EAAIuiB,EAAE9f,GAAKmf,EAAaG,EAAQ9kC,GAAGm+B,QAAS2G,EAAQ9kC,GAAGq+B,SAEzDqB,6BAAO6F,eAAgB7F,6BAAO8F,iBAAiB3F,aAAcyF,EAAG5F,6BAAOuC,UAGxE,OAAO,GAGR6B,EAAS2B,WAAa,SAAUx8B,GAE/BA,EAAI47B,iBAEJ,IAAIC,EAAU77B,EAAI87B,eAElB,IAAK,IAAI/kC,EAAI,EAAGA,EAAI8kC,EAAQ7kC,OAAQD,IACpC,CACC,IAAK0/B,6BAAOuC,SAAS6C,EAAQ9kC,GAAGglC,YAC/B,SAED,IAAIM,EAAI5F,6BAAOuC,SAAS6C,EAAQ9kC,GAAGglC,YAEnCM,EAAEd,QAAUtiB,QACZojB,EAAEI,UAAYJ,EAAEd,QAAUc,EAAE7jB,UAE5B6jB,EAAEjxB,EAAIowB,EAAaK,EAAQ9kC,GAAGm+B,QAAS2G,EAAQ9kC,GAAGq+B,SAClDiH,EAAEviB,EAAI4hB,EAAaG,EAAQ9kC,GAAGm+B,QAAS2G,EAAQ9kC,GAAGq+B,SAE9CiH,EAAEJ,YACLxF,6BAAO6F,eAAgB7F,6BAAO8F,iBAAiBtF,kBAAmBoF,EAAG5F,6BAAOuC,UAE7EvC,6BAAO6F,eAAgB7F,6BAAO8F,iBAAiB1F,WAAYwF,EAAG5F,6BAAOuC,UAErEqD,EAAEL,UAAW,EACbK,EAAEJ,YAAa,EAEfI,EAAEH,OAAS,EAGZ,OAAO,GAGRrB,EAAS6B,cAAgB,SAAU18B,GAElCA,EAAI47B,iBAEJ,IAAIC,EAAU77B,EAAI87B,eAElB,IAAK,IAAI/kC,EAAI,EAAGA,EAAI8kC,EAAQ7kC,OAAQD,IACpC,CACC,IAAK0/B,6BAAOuC,SAAS6C,EAAQ9kC,GAAGglC,YAC/B,SAED,IAAIM,EAAI5F,6BAAOuC,SAAS6C,EAAQ9kC,GAAGglC,YAEnCM,EAAEjxB,EAAIowB,EAAaK,EAAQ9kC,GAAGm+B,QAAS2G,EAAQ9kC,GAAGq+B,SAClDiH,EAAEviB,EAAI4hB,EAAaG,EAAQ9kC,GAAGm+B,QAAS2G,EAAQ9kC,GAAGq+B,SAElDqB,6BAAO6F,eAAgBD,EAAEJ,WAAaxF,6BAAO8F,iBAAiBtF,kBAAoBR,6BAAO8F,iBAAiB1F,WAAYwF,EAAG5F,6BAAOuC,UAEhIqD,EAAEL,UAAW,EACbK,EAAEJ,YAAa,EAEfI,EAAEH,OAAS,EAGZ,OAAO,GAGRrB,EAAS8B,YAAc,SAAU38B,GAEhCA,EAAI47B,iBAEJ,IAAIC,EAAU77B,EAAI87B,eAElB,IAAK,IAAI/kC,EAAI,EAAGA,EAAI8kC,EAAQ7kC,OAAQD,IACpC,CACC,IAAK0/B,6BAAOuC,SAAS6C,EAAQ9kC,GAAGglC,YAC/B,SAED,IAAIM,EAAI5F,6BAAOuC,SAAS6C,EAAQ9kC,GAAGglC,YAE/BM,EAAEL,WAAaK,EAAEJ,aAEpBxF,6BAAO6F,eAAgB7F,6BAAO8F,iBAAiBxF,mBAAoBsF,EAAG5F,6BAAOuC,UAC7EqD,EAAEJ,YAAa,GAGhBI,EAAEjxB,EAAIowB,EAAaK,EAAQ9kC,GAAGm+B,QAAS2G,EAAQ9kC,GAAGq+B,SAClDiH,EAAEviB,EAAI4hB,EAAaG,EAAQ9kC,GAAGm+B,QAAS2G,EAAQ9kC,GAAGq+B,SAElDiH,EAAE/hB,GAAK+hB,EAAEjxB,EAAIixB,EAAE/f,GACf+f,EAAE9hB,GAAK8hB,EAAEviB,EAAIuiB,EAAE9f,GAEfka,6BAAO6F,eAAgBD,EAAEJ,WAAaxF,6BAAO8F,iBAAiBvF,kBAAoBP,6BAAO8F,iBAAiBzF,aAAcuF,EAAG5F,6BAAOuC,UAGnI,OAAO,KAMR6B,EAAS+B,cAAgB,SAAU58B,GAGlC,OADAA,EAAI47B,kBACG,GAGRf,EAASgC,QAAU,SAAU78B,GAE5BA,EAAI47B,iBAECnF,6BAAOuC,SAAS,KAEpBvC,6BAAOuC,SAAS,GAAK,CACnB9jC,GAAI,EAAG8mC,UAAU,EAAOC,YAAY,EACpC3f,GAAI,EAAGC,GAAI,EAAGnR,EAAG,EAAG0O,EAAG,EAAGQ,GAAI,EAAGC,GAAI,EAAG2hB,OAAQ,EAChDC,WAAY,EAAGC,WAAY,IAI9B,IAAIC,EAAI5F,6BAAOuC,SAAS,GAQxB,OANAqD,EAAEjxB,EAAIowB,EAAax7B,EAAIk1B,QAASl1B,EAAIo1B,SACpCiH,EAAEviB,EAAI4hB,EAAa17B,EAAIk1B,QAASl1B,EAAIo1B,SACpCiH,EAAEF,WAAan8B,EAAI88B,OACnBT,EAAED,YAAcp8B,EAAI88B,OAEpBrG,6BAAO6F,eAAgB7F,6BAAO8F,iBAAiBrF,cAAemF,EAAG5F,6BAAOuC,WACjE,GAGR6B,EAASnF,YAAc,SAAU11B,GAEhCA,EAAI47B,iBAECnF,6BAAOuC,SAAS,KAEpBvC,6BAAOuC,SAAS,GAAK,CACnB9jC,GAAI,EAAG8mC,UAAU,EAAOC,YAAY,EACpC3f,GAAI,EAAGC,GAAI,EAAGnR,EAAG,EAAG0O,EAAG,EAAGQ,GAAI,EAAGC,GAAI,EAAG2hB,OAAQ,EAChDC,WAAY,EAAGC,WAAY,IAI9B,IAAIC,EAAI5F,6BAAOuC,SAAS,GAUxB,OARAqD,EAAEL,UAAW,EACbK,EAAEJ,YAAa,EACfI,EAAEH,OAASl8B,EAAI+8B,MAEfV,EAAEjxB,EAAIixB,EAAE/f,GAAKkf,EAAax7B,EAAIk1B,QAASl1B,EAAIo1B,SAC3CiH,EAAEviB,EAAIuiB,EAAE9f,GAAKmf,EAAa17B,EAAIk1B,QAASl1B,EAAIo1B,SAE3CqB,6BAAO6F,eAAgB7F,6BAAO8F,iBAAiB3F,aAAcyF,EAAG5F,6BAAOuC,WAChE,GAGR6B,EAASlF,UAAY,SAAU31B,GAI9B,GAFAA,EAAI47B,kBAECnF,6BAAOuC,SAAS,GACpB,OAAO,EAER,IAAIqD,EAAI5F,6BAAOuC,SAAS,GAExBqD,EAAEjxB,EAAIowB,EAAax7B,EAAIk1B,QAASl1B,EAAIo1B,SACpCiH,EAAEviB,EAAI4hB,EAAa17B,EAAIk1B,QAASl1B,EAAIo1B,SAEhCiH,EAAEJ,YACLxF,6BAAO6F,eAAgB7F,6BAAO8F,iBAAiBtF,kBAAmBoF,EAAG5F,6BAAOuC,UAE7EvC,6BAAO6F,eAAgB7F,6BAAO8F,iBAAiB1F,WAAYwF,EAAG5F,6BAAOuC,UAErEqD,EAAEL,UAAW,EACbK,EAAEJ,YAAa,EAEfI,EAAEH,OAAS,GAGZrB,EAASjF,YAAc,SAAU51B,GAIhC,GAFAA,EAAI47B,kBAECnF,6BAAOuC,SAAS,GACpB,OAAO,EAER,IAAIqD,EAAI5F,6BAAOuC,SAAS,GAexB,OAbIqD,EAAEL,WAAaK,EAAEJ,aAEpBxF,6BAAO6F,eAAgB7F,6BAAO8F,iBAAiBxF,mBAAoBsF,EAAG5F,6BAAOuC,UAC7EqD,EAAEJ,YAAa,GAGhBI,EAAEjxB,EAAIowB,EAAax7B,EAAIk1B,QAASl1B,EAAIo1B,SACpCiH,EAAEviB,EAAI4hB,EAAa17B,EAAIk1B,QAASl1B,EAAIo1B,SAEpCiH,EAAE/hB,GAAK+hB,EAAEjxB,EAAIixB,EAAE/f,GACf+f,EAAE9hB,GAAK8hB,EAAEviB,EAAIuiB,EAAE9f,GAEfka,6BAAO6F,eAAgBD,EAAEJ,WAAaxF,6BAAO8F,iBAAiBvF,kBAAoBP,6BAAO8F,iBAAiBzF,aAAcuF,EAAG5F,6BAAOuC,WAC3H,KAKK,IAAV9/B,EAAEiU,KAAckc,yCAAIqF,UAOzBoB,KAAM,WAEL,OAAOp5B,KAAK8iC,WAObztB,MAAO,WAENrV,KAAK8jC,kBAEL9jC,KAAK0gC,MAAME,iBAAkB,EAC7B5gC,KAAK+jC,WAAW1uB,SAOjB2N,KAAM,WAELhjB,KAAK0gC,MAAME,iBAAkB,EAC7B5gC,KAAK+jC,WAAW/gB,QAOjBsjB,MAAO,WAENtmC,KAAK0gC,MAAME,iBAAkB,GAO9Bx0B,OAAQ,WAEPpM,KAAK0gC,MAAME,iBAAkB,EAC7B5gC,KAAKumC,aAONtC,QAAS,SAAUD,GAElB,IACI52B,EADAzB,EAAM4W,QAGNyhB,EAAQhkC,KAAK4iC,mBAChBoB,EAAQhkC,KAAK4iC,kBAEkB,IAA5B5iC,KAAK2iC,qBACRqB,EAAQhkC,KAAK2iC,oBAET3iC,KAAK0gC,MAAMC,mBAAoB3gC,KAAK0gC,MAAME,iBAM/CoD,GAAShkC,KAAKyiC,UAEdziC,KAAK6iC,WAAamB,EAAQ,IAC1BhkC,KAAK8iC,WAAa9iC,KAAK6iC,WACvBnQ,yCAAQ0G,KAAOp5B,KAAK8iC,UAEpB9iC,KAAK+iC,cAGL31B,EAAMmV,QACNviB,KAAKoI,OAAQpI,KAAK6iC,YAClB7iC,KAAKgjC,KAAKI,iBAAmB7gB,QAAUnV,EAGvCA,EAAMmV,QACNviB,KAAKy/B,OACLz/B,KAAKgjC,KAAKK,eAAiB9gB,QAAUnV,EAGrCpN,KAAKgjC,KAAKC,SAAWt3B,EACrB3L,KAAKgjC,KAAKE,YAEVljC,KAAKgjC,KAAKO,gBAAkBhhB,QAAU5W,GAEtCq4B,EAAQhkC,KAAKgjC,KAAKC,SAAWjjC,KAAKgjC,KAAKlhB,WAC3B,MAEX9hB,KAAKgjC,KAAKhC,IAAM5tB,IAAwB,IAApBpT,KAAKgjC,KAAKE,UAAiBc,GAI/ChkC,KAAKgjC,KAAKQ,WAAapwB,KAAKpT,KAAMgjC,KAAKQ,WAAWxjC,KAAKgjC,KAAKG,WAAcnjC,KAAKgjC,KAAKhC,MAAQhhC,KAAKgjC,KAAKG,WAAa,IACnHnjC,KAAKgjC,KAAKS,kBAAoBrwB,KAAKpT,KAAMgjC,KAAKS,kBAAkBzjC,KAAKgjC,KAAKG,WAAyC,IAA1BnjC,KAAKgjC,KAAKI,gBAAuBpjC,KAAKgjC,KAAKE,YAAeljC,KAAKgjC,KAAKG,WAAa,IAC1KnjC,KAAKgjC,KAAKU,gBAAkBtwB,KAAKpT,KAAMgjC,KAAKU,gBAAgB1jC,KAAKgjC,KAAKG,WAAuC,IAAxBnjC,KAAKgjC,KAAKK,cAAqBrjC,KAAKgjC,KAAKE,YAAeljC,KAAKgjC,KAAKG,WAAa,IACpKnjC,KAAKgjC,KAAKW,iBAAmBvwB,KAAKpT,KAAMgjC,KAAKW,iBAAiB3jC,KAAKgjC,KAAKG,WAAwC,IAAzBnjC,KAAKgjC,KAAKM,eAAsBtjC,KAAKgjC,KAAKE,YAAeljC,KAAKgjC,KAAKG,WAAa,IACvKnjC,KAAKgjC,KAAKY,iBAAmBxwB,KAAKpT,KAAMgjC,KAAKY,iBAAiB5jC,KAAKgjC,KAAKG,WAAwC,IAAzBnjC,KAAKgjC,KAAKO,eAAsBvjC,KAAKgjC,KAAKE,YAAeljC,KAAKgjC,KAAKG,WAAa,IACvKnjC,KAAKgjC,KAAKG,aAEVnjC,KAAKgjC,KAAKlhB,UAAYnW,EACtB3L,KAAKgjC,KAAKC,SAAWt3B,EACrB3L,KAAKgjC,KAAKE,UAAY,EACtBljC,KAAKgjC,KAAKI,gBAAkB,EAC5BpjC,KAAKgjC,KAAKK,cAAgB,EAC1BrjC,KAAKgjC,KAAKM,eAAiB,EAC3BtjC,KAAKgjC,KAAKO,eAAiB,IAhD3BvjC,KAAKy/B,QAwDPqE,gBAAiB,SAAU0C,GAAa,GAGvC,GAAI,aAActoC,eAEb8B,KAAK2wB,QAAQ2Q,YAEhBthC,KAAKymC,aAAerzB,IAAIlV,eAAOwoC,OAAOzY,OACtCjuB,KAAK2mC,cAAgBvzB,IAAIlV,eAAOwoC,OAAOxY,UAIvCluB,KAAKymC,aAAevoC,eAAO0oC,WAC3B5mC,KAAK2mC,cAAgBzoC,eAAO2oC,kBAQ7B,GAHA7mC,KAAKymC,aAAezmC,KAAK2wB,QAAQuQ,YACjClhC,KAAK2mC,cAAgB3mC,KAAK2wB,QAAQwQ,aAEF,MAA5BnhC,KAAK2wB,QAAQuQ,aAAoD,MAA7BlhC,KAAK2wB,QAAQwQ,aACpD,MAAM,IAAIziC,MAAO,qEAIfsB,KAAMymC,aAAezmC,KAAK2mC,eAAqC,aAApB3mC,KAAK+gC,aAAgC/gC,KAAKymC,aAAezmC,KAAK2mC,eAAqC,YAApB3mC,KAAK+gC,aAElI/gC,KAAKkhC,YAAclhC,KAAK2mC,cACxB3mC,KAAKmhC,aAAenhC,KAAKymC,aAEzBzmC,KAAK+kC,eAAgB,IAIrB/kC,KAAKkhC,YAAclhC,KAAKymC,aACxBzmC,KAAKmhC,aAAenhC,KAAK2mC,cAEzB3mC,KAAK+kC,eAAgB,GAItB,IAAI+B,EAAoB9mC,KAAK2wB,QAAQuQ,YACjC6F,EAAqB/mC,KAAK2wB,QAAQwQ,aAEZ,OAAtB2F,GAAqD,OAAvBC,IAEP,OAAtBD,GAAqD,OAAvBC,GAEjCD,EAAoB9mC,KAAKkhC,YACzB6F,EAAqB/mC,KAAKmhC,cAEI,OAAtB2F,EAERA,EAAoB1zB,IAAI,GAAMpT,KAAKkhC,aAAelhC,KAAK2wB,QAAQwQ,aAAenhC,KAAKmhC,eAEpD,OAAvB4F,IAERA,EAAqB3zB,IAAI,GAAMpT,KAAKmhC,cAAgBnhC,KAAK2wB,QAAQuQ,YAAclhC,KAAKkhC,gBAKtF,IAAIA,EAAc4F,EACd3F,EAAe4F,EAEM,cAArB/mC,KAAK+gC,aAA+BG,GAAeC,IAElDD,EAAeC,GAAgBnhC,KAAKkhC,YAAclhC,KAAKmhC,cAAkBD,EAAcC,GAAgBnhC,KAAKkhC,YAAclhC,KAAKmhC,gBAElID,EAAcC,EACdA,EAAe2F,GAKjB9mC,KAAK4hC,kBAAoB,EAErBV,GAAeC,EAElBnhC,KAAK4hC,kBAAoBn0B,KAAK0R,IAAInf,KAAKkhC,YAAcA,EAAalhC,KAAKmhC,aAAeA,GAE9ED,EAERlhC,KAAK4hC,kBAAoB5hC,KAAKkhC,YAAcA,EAEpCC,IAERnhC,KAAK4hC,kBAAoB5hC,KAAKmhC,aAAeA,GAI9C,IAAIsF,EAAezmC,KAAKkhC,YACpByF,EAAgB3mC,KAAKmhC,aAQzB,GANID,IAAalhC,KAAKkhC,YAAcA,GAChCC,IAAcnhC,KAAKmhC,aAAeA,GAEtCnhC,KAAKuhC,MAAQnuB,IAA6D,IAAxDqzB,EAAezmC,KAAKkhC,YAAYlhC,KAAK4hC,oBACvD5hC,KAAKwhC,MAAQpuB,IAA+D,IAA1DuzB,EAAgB3mC,KAAKmhC,aAAanhC,KAAK4hC,oBAErD5hC,KAAK+kC,cACT,CACC,IAAI33B,EAAMpN,KAAKuhC,MACfvhC,KAAKuhC,MAAQvhC,KAAKwhC,MAClBxhC,KAAKwhC,MAAQp0B,EAGdpN,KAAK6hC,YAAc7hC,KAAK4hC,kBAAoB5hC,KAAK2hC,iBACjD3hC,KAAK6hC,YAAczuB,IAAI,GAAMpT,KAAK6hC,aAE9B7hC,KAAK2wB,QAAQ0Q,eAAiB,GAAKrhC,KAAK6hC,YAAc7hC,KAAK2wB,QAAQ0Q,iBACtErhC,KAAK6hC,YAAc7hC,KAAK2wB,QAAQ0Q,gBAEjCrhC,KAAK0gC,MAAMC,kBAAmB,EAO1B,aAAcziC,iBACjBA,eAAO4zB,SAASG,KAAKE,MAAMgI,gBAAkBn6B,KAAK4/B,SAASzF,iBAKvDn6B,KAAK+kC,eAgBT/kC,KAAK4/B,SAASpM,OAAQxzB,KAAKmhC,aAAanhC,KAAK6hC,YAAa7hC,KAAKkhC,YAAYlhC,KAAK6hC,aAChF7hC,KAAK4/B,SAASh9B,KAAKuvB,MAAMlE,MAAQ7a,IAAIpT,KAAKmhC,aAAanhC,KAAK4hC,kBAAkB,IAAO,KACrF5hC,KAAK4/B,SAASh9B,KAAKuvB,MAAMjE,OAAS9a,IAAIpT,KAAKkhC,YAAYlhC,KAAK4hC,kBAAkB,IAAO,KAErF5hC,KAAK+hC,eAAevO,OAAQxzB,KAAKmhC,aAAanhC,KAAK6hC,YAAa7hC,KAAKkhC,YAAYlhC,KAAK6hC,aACtF7hC,KAAK+hC,eAAen/B,KAAKuvB,MAAMlE,MAAQ7a,IAAIpT,KAAKmhC,aAAanhC,KAAK4hC,kBAAkB,IAAO,KAC3F5hC,KAAK+hC,eAAen/B,KAAKuvB,MAAMjE,OAAS9a,IAAIpT,KAAKkhC,YAAYlhC,KAAK4hC,kBAAkB,IAAO,KAE3F5hC,KAAKgiC,eAAexO,OAAQmT,EAAeF,GAC3CzmC,KAAKgiC,eAAep/B,KAAKuvB,MAAMlE,MAAQ0Y,EAAgB,KACvD3mC,KAAKgiC,eAAep/B,KAAKuvB,MAAMjE,OAASuY,EAAe,OAxBvDzmC,KAAK4/B,SAASpM,OAAQxzB,KAAKkhC,YAAYlhC,KAAK6hC,YAAa7hC,KAAKmhC,aAAanhC,KAAK6hC,aAChF7hC,KAAK4/B,SAASh9B,KAAKuvB,MAAMlE,MAAQ7a,IAAIpT,KAAKkhC,YAAYlhC,KAAK4hC,kBAAkB,IAAO,KACpF5hC,KAAK4/B,SAASh9B,KAAKuvB,MAAMjE,OAAS9a,IAAIpT,KAAKmhC,aAAanhC,KAAK4hC,kBAAkB,IAAO,KAEtF5hC,KAAK+hC,eAAevO,OAAQxzB,KAAKkhC,YAAYlhC,KAAK6hC,YAAa7hC,KAAKmhC,aAAanhC,KAAK6hC,aACtF7hC,KAAK+hC,eAAen/B,KAAKuvB,MAAMlE,MAAQ7a,IAAIpT,KAAKkhC,YAAYlhC,KAAK4hC,kBAAkB,IAAO,KAC1F5hC,KAAK+hC,eAAen/B,KAAKuvB,MAAMjE,OAAS9a,IAAIpT,KAAKmhC,aAAanhC,KAAK4hC,kBAAkB,IAAO,KAE5F5hC,KAAKgiC,eAAexO,OAAQiT,EAAcE,GAC1C3mC,KAAKgiC,eAAep/B,KAAKuvB,MAAMlE,MAAQwY,EAAe,KACtDzmC,KAAKgiC,eAAep/B,KAAKuvB,MAAMjE,OAASyY,EAAgB,MAiBzD3mC,KAAK4/B,SAASh9B,KAAKuvB,MAAM6U,WAAahnC,KAAKuhC,MAAQ,KACnDvhC,KAAK4/B,SAASh9B,KAAKuvB,MAAM8U,UAAYjnC,KAAKwhC,MAAQ,KAElDxhC,KAAK+hC,eAAen/B,KAAKuvB,MAAM6U,WAAahnC,KAAKuhC,MAAQ,KACzDvhC,KAAK+hC,eAAen/B,KAAKuvB,MAAM8U,UAAYjnC,KAAKwhC,MAAQ,KAExDxhC,KAAK4/B,SAASvZ,eACdrmB,KAAK+hC,eAAe1b,eACpBrmB,KAAKgiC,eAAe3b,eAEI,GAApBrmB,KAAK6hC,cAER7hC,KAAK4/B,SAASlF,YAAY16B,KAAK6hC,aAC/B7hC,KAAK+hC,eAAerH,YAAY16B,KAAK6hC,cAGlC7hC,KAAK+kC,eAER/kC,KAAK4/B,SAAS9b,OAAOrW,KAAKiwB,GAAG,GAC7B19B,KAAK4/B,SAASjc,WAAW3jB,KAAKkhC,YAAa,GAC3ClhC,KAAK4/B,SAASjF,SAAQ,GAEtB36B,KAAK+hC,eAAeje,OAAOrW,KAAKiwB,GAAG,GACnC19B,KAAK+hC,eAAepe,WAAW3jB,KAAKkhC,YAAa,GACjDlhC,KAAK+hC,eAAepH,SAAQ,GAE5B36B,KAAKgiC,eAAele,OAAOrW,KAAKiwB,GAAG,GACnC19B,KAAKgiC,eAAere,WAAW8iB,EAAc,GAC7CzmC,KAAKgiC,eAAerH,SAAQ,KAI5B36B,KAAK4/B,SAASjF,SAAQ,GACtB36B,KAAK+hC,eAAepH,SAAQ,GAC5B36B,KAAKgiC,eAAerH,SAAQ,IAI7B36B,KAAK6hC,aAAe7hC,KAAK2wB,QAAQyQ,iBAE7BphC,KAAK2wB,QAAQ0Q,eAAiB,GAAKrhC,KAAK6hC,YAAc7hC,KAAK2wB,QAAQ0Q,iBACtErhC,KAAK6hC,YAAc7hC,KAAK2wB,QAAQ0Q,gBAEjCrhC,KAAKknC,mBAAqB9zB,IAAIpT,KAAK6hC,YAAc,IACjD7hC,KAAKumC,YAEDvmC,KAAK8hC,eACR9hC,KAAK8hC,cAAcxiB,OAEpBtf,KAAK8hC,cAAgB9hC,KAAK4/B,SAAS7C,WAAU,GAEzB,GAAhByJ,IAEHxmC,KAAK0gC,MAAMC,kBAAmB,EAC9B3gC,KAAKmnC,gBAAiBnnC,KAAKkhC,YAAalhC,KAAKmhC,gBAQ/CgG,gBAAiB,SAAUjG,EAAaC,KAQxCoF,UAAW,WAEVvmC,KAAKgjC,KAAKlhB,UAAYS,QACtBviB,KAAKgjC,KAAKC,SAAW1gB,QAErBviB,KAAKgjC,KAAKE,UAAY,EACtBljC,KAAKgjC,KAAKI,gBAAkB,EAC5BpjC,KAAKgjC,KAAKK,cAAgB,EAC1BrjC,KAAKgjC,KAAKM,eAAiB,EAC3BtjC,KAAKgjC,KAAKO,eAAiB,EAE3BvjC,KAAKgjC,KAAKG,WAAa,EACvBnjC,KAAKgjC,KAAKhC,IAAM,EAChBhhC,KAAKgjC,KAAKQ,WAAa,EACvBxjC,KAAKgjC,KAAKS,kBAAoB,EAC9BzjC,KAAKgjC,KAAKU,gBAAkB,EAC5B1jC,KAAKgjC,KAAKW,iBAAmB,EAC7B3jC,KAAKgjC,KAAKY,iBAAmB,GAQ9BwD,eAAgB,SAAUjgC,GAGzB,OADAnH,KAAKuiC,YAAY1/B,KAAMsE,GAChBnH,KAAKuiC,YAAY9hB,QAYzB4mB,kBAAmB,SAAUlgC,GAE5BnH,KAAKuiC,YAAY/hC,OAAQ8f,yCAASS,WAAW5Z,GAAWA,EAAUnH,KAAKuiC,YAAYzhB,SAAS3Z,KAQ7FmgC,aAAc,SAAUngC,GAGvB,OADAnH,KAAKwiC,UAAU3/B,KAAMsE,GACdnH,KAAKwiC,UAAU/hB,QAYvB8mB,gBAAiB,SAAUpgC,GAE1BnH,KAAKwiC,UAAUhiC,OAAQ8f,yCAASS,WAAW5Z,GAAWA,EAAUnH,KAAKwiC,UAAU1hB,SAAS3Z,KAQzFqgC,SAAU,SAAUrgC,GAEnBnH,KAAKuiC,YAAY1/B,KAAMsE,GACvBnH,KAAKwiC,UAAU3/B,KAAMsE,IAQtBsgC,YAAa,SAAUtgC,GAEtBnH,KAAKuiC,YAAY/hC,OAAQR,KAAKuiC,YAAYzhB,SAAS3Z,IACnDnH,KAAKwiC,UAAUhiC,OAAQR,KAAKwiC,UAAU1hB,SAAS3Z,KAMhDiB,OAAQ,SAAUs/B,GAEjB,IAEC,IAAI3gC,EAEJ,IAAK,IAAInE,EAAO5C,KAAKuiC,YAAY/hB,IAAK5d,EAAMA,EAAOmE,EAElDA,EAAOnE,EAAKmE,MAEkB,IAA1BnE,EAAK3D,MAAMmJ,OAAOs/B,IACrB1nC,KAAKqnC,kBAAkBzkC,GAG1B,MAAOxF,GAGN,MADA2iC,6BAAO/c,OACD5lB,IAORqiC,KAAM,WAEoB,OAArBz/B,KAAK4/B,SAASlZ,IACjB1mB,KAAK4/B,SAASvqB,QAEVrV,KAAK2wB,QAAQmQ,WAEjB9gC,KAAK4/B,SAASvzB,QACdrM,KAAK+hC,eAAe11B,QACpBrM,KAAKgiC,eAAe31B,SAGrB,IAEC,IAAItF,EAEJ,IAAK,IAAInE,EAAO5C,KAAKwiC,UAAUhiB,IAAK5d,EAAMA,EAAOmE,EAEhDA,EAAOnE,EAAKmE,KACZnE,EAAK3D,MAAMwgC,KAAKz/B,KAAK4/B,UAGG,OAArB5/B,KAAK4/B,SAASlZ,KAEjB1mB,KAAK4/B,SAAS7uB,QACd/Q,KAAK4/B,SAAS5D,OAGhB,MAAO5+B,GAGN,MADA2iC,6BAAO/c,OACD5lB,IAURuqC,YAAa,SAAUvW,EAAKwW,EAAKC,EAAUC,EAAQ55B,GAGlD,IAAIkrB,EAAO,GACP/xB,EAAO,GACP4J,EAAQ,EAEZ,IAAK,IAAI2kB,KAAKxE,EAEbgI,EAAKxD,GAAK,EACVvuB,EAAKuuB,GAAKxE,EAAIwE,GACd3kB,IAGD,IAAI82B,EACJ,CACC3/B,OAAQ,SAASs/B,GAEhB,IAAK,IAAIhzB,KAAK0kB,EACd,CACC,GAAIA,EAAK1kB,IAAMmzB,EAASnzB,GACvB,SAED0kB,EAAK1kB,IAAMgzB,EACPtO,EAAK1kB,IAAMmzB,EAASnzB,KAEvB0kB,EAAK1kB,GAAKmzB,EAASnzB,GACnBzD,KAGD,IAAI5T,EAAIyqC,EAAOpzB,GAAI0kB,EAAK1kB,GAAKmzB,EAASnzB,IACtCrN,EAAKqN,IAAM,EAAErX,GAAG+zB,EAAI1c,GAAKrX,EAAEuqC,EAAIlzB,GAKhC,GAFAxG,EAAU7G,EAAe,GAAT4J,GAEH,GAATA,EACH,OAAO,IAIV8uB,6BAAOqH,eAAeW,GACtBA,EAAa3/B,OAAO,IAOrBs8B,gBAAiB,SAAUxG,EAAQmE,EAASrxB,GAE3C,OAAO,GAOR40B,eAAgB,SAAU1H,EAAQ8J,EAAS1F,GAE1C,OAAO,K;AAMT3C,yCAAeI;;;gBCh3Cf;MAAMkI,0BACN,CAKCC,SAAS,EAMTC,QAAQ,EAMRC,QAAS,GAET/gC,KAAMma,yCAAKxB,KAAKX,QAChBpO,MAAO,EAMPo3B,WAAW,EAMXnO,MAAO,OAMPvI,WAAY,UAMZ2W,KAAM,GAMN1V,MAAO,SAAU2V,GAKhB,IAHAvoC,KAAKqH,KAAKxE,KAAK0lC,GACfvoC,KAAKiR,QAEEjR,KAAKqH,KAAK/G,OAASN,KAAKooC,SAC9BpoC,KAAKqH,KAAK2F,QAEPhN,KAAKqoC,WACR7xB,QAAQmJ,MAAM3f,KAAKiR,MAAQ,KAAOs3B,IAOpCl8B,MAAO,WAENrM,KAAKqH,KAAKY,QACVjI,KAAKiR,MAAQ,GAcd+mB,OAAQ,SAAUtjB,EAAE,EAAG0O,EAAE,EAAGolB,EAAS,IAAKC,GAAQ,EAAMC,GAAU,GAEjE,GAAI1oC,KAAKkoC,QAAS,OAClBloC,KAAKkoC,SAAU,EAEVO,IAASrlB,GAAK,IACnB,IAAIulB,EAAKvlB,EAETuc,yCAAO2H,aAAc,CAAE7H,KAAM,WAE5B,GAAIwI,0BAAIE,OAAQ,OAEhB,IAAI/6B,EAAMmV,QAEV,MAAM6X,EAAIuF,yCAAOqC,eAEjB5H,EAAEmB,KAAK,QAAQiN,EAAS,gBACxBpO,EAAEqB,aAAa,OAEf,IAAIzpB,EAAI,GAERoR,EAAIulB,GAEY,IAAZF,GAAwC,GAAnB9I,yCAAOqD,KAAKhC,MAGpChvB,EAAI,QAAU2tB,yCAAOqD,KAAKhC,IAAM,IAAMrB,yCAAOqD,KAAKQ,WAAa,YAAc7D,yCAAOqD,KAAKS,kBAAoB,UAAY9D,yCAAOqD,KAAKU,gBAAkB,WAAa/D,yCAAOqD,KAAKY,iBAE5KqE,0BAAItW,aACPyI,EAAE7G,UAAU0U,0BAAItW,YAChByI,EAAExF,SAAUlgB,EAAE,EAAG0O,EAAE,EAAGgX,EAAEjE,YAAYnkB,GAAG,EAAGw2B,EAAS,IAGpDpO,EAAE7G,UAAU0U,0BAAI/N,OAChBE,EAAEpE,SAAShkB,EAAG0C,EAAG0O,IAGlBpR,EAAI,GAEJ,IAAK,IAAI3R,KAAK4nC,0BAAIK,KACjBt2B,GAAK3R,EAAI,KAAO4nC,0BAAIK,KAAKjoC,GAAK,KAErB,KAAN2R,IAEHoR,GAAK,GAED6kB,0BAAItW,aACPyI,EAAE7G,UAAU0U,0BAAItW,YAChByI,EAAExF,SAAUlgB,EAAE,EAAG0O,EAAE,EAAGgX,EAAEjE,YAAYnkB,GAAG,EAAGw2B,EAAS,IAGpDpO,EAAE7G,UAAU0U,0BAAI/N,OAChBE,EAAEpE,SAAShkB,EAAG0C,EAAG0O,IAGlB,IAAIjgB,EAAI,EACR,IAAK,IAAIylC,EAAKX,0BAAI5gC,KAAKmZ,IAAKooB,EAAIA,EAAKA,EAAG7hC,KAAM5D,IAE7C6O,GAAK02B,EAAY,KAAOT,0BAAIh3B,MAAMg3B,0BAAI5gC,KAAK/G,OAAO6C,EAAE,GAAK,KAAO,MAAQylC,EAAG3pC,MAEvEgpC,0BAAItW,aACPyI,EAAE7G,UAAU0U,0BAAItW,YAChByI,EAAExF,SAAUlgB,EAAE,EAAG0O,EAAE,EAAE,GAAKolB,EAAS,IAAIrlC,EAAE,GAAK,EAAGi3B,EAAEjE,YAAYnkB,GAAG,EAAGw2B,EAAS,IAG/EpO,EAAE7G,UAAU0U,0BAAI/N,OAChBE,EAAEpE,SAAShkB,EAAG0C,EAAG0O,EAAE,EAAE,GAAKolB,EAAS,IAAIrlC,EAAE,IAG1CiK,EAAOmV,QAAUnV,EACjBuyB,yCAAOqD,KAAKK,eAAiBj2B,EAC7BuyB,yCAAOqD,KAAKM,gBAAkBl2B,MAQhCk5B,MAAO,WAENtmC,KAAKmoC,QAAS,GAQf/7B,OAAQ,WAEPpM,KAAKmoC,QAAS,I,IAKhBxV,yCAAesV;;;;oBChLf;MAAMY,8BACN,CAKCniB,GAAI,KAMJ0S,KAAM,EAMNqB,SAAU,KAMVqO,aAAa,EAMbC,YAAY,EASZC,MAAO,IAAIrwB,yCACXswB,MAAO,IAAItwB,yCACXuwB,MAAO,IAAIvwB,0C,IAGZ+Z,yCAAemW;;iBAUf3qC;eAAOirC,GAAK,SAASlqC,GAEpB,OAAOA,EAAMwc,EAAE2tB,OAOhBlrC,eAAO0iB,QAAU,SAAU1hB,GAE1B,GAAY,OAARA,GAAgC,iBAATA,EAG3B,MAAI,SAAUA,EACNA,EAAIogB,OAER,YAAapgB,EACTA,EAAI0hB,eAER,WAAY1hB,GACfA,EAAIyF,WAOF,iBAAkBzG,gBAErBA,eAAOmrC,aAAe,IAAIC,aAAa,CAAEC,YAAa,cAAeC,WAAY,QACjF7W,yCAAIC,MAAM,gCAAkE,IAAhC10B,eAAOmrC,aAAaI,aAAoB,QAGpFvrC,eAAOmrC,aAAe,KAMvBnrC,eAAOwrC,OAAS,SAAUzlC,EAAK0sB,GAE9B,OAAO,IAAItuB,SAAS,CAACC,EAASC,KAExBouB,IAASA,EAAU,IAClB,iBAAkBA,IAAUA,EAAQgZ,aAAe,eAEzD,IAAIC,EAAU,IAAIC,eAClBD,EAAQE,KAAK,MAAO7lC,GAAK,GAEzB,IAAK,IAAI5D,KAAKswB,EAASiZ,EAAQvpC,GAAKswB,EAAQtwB,GAE5CupC,EAAQzY,OAAS,WAChB7uB,EAASsnC,EAAQG,WAGlBH,EAAQI,QAAU,WACjBznC,EAAQ,wCAGTqnC,EAAQK,WAQV/rC,eAAOgsC,iBAAmB,SAAUjmC,GAEnC,OAAO,IAAI5B,SAAQ,CAACC,EAASC,KAEvBrE,eAAOmrC,aAMZK,OAAOzlC,GACNkmC,MAAKC,GAAef,aAAagB,gBAAgBD,KACjDD,MAAKG,GAAehoC,EAAQgoC,KAC5BC,OAAM5zB,GAAOpU,EAAOoU,KAPpBpU,EAAQ,sCAeXrE,eAAOkV,IAAM,SAAUnU,GAEtB,OAAOA,GAAS,GAOjBf,eAAOssC,KAAO,SAAUvrC,GAEvB,OAAc,IAAVA,IAA4B,IAAVA,EACdA,EAEK,QAATA,GAGS,SAATA,KAGMA,GAOXf,eAAOmV,MAAQ,SAAUpU,GAExB,OAAOU,WAAWV,IAOnBf,eAAOusC,OAAS,SAAUxrC,GAEzB,OAAOmU,IAAW,IAANnU,GAAY,KAOzBf,eAAOwsC,OAAS,SAAUzrC,GAEzB,OAAOmU,IAAW,IAANnU,GAAa,KAO1Bf,eAAOysC,OAAS,SAAU1rC,GAEzB,OAAOmU,IAAW,IAANnU,GAAc,KAO3Bf,eAAO0sC,IAAM,SAAUC,GAEtB,OAAOA,EAAQp9B,KAAKiwB,GAAG,KAOxBx/B,eAAO4sC,IAAM,SAAUC,GAEtB,OAAOA,EAASt9B,KAAKiwB,GAAI,KAO1Bx/B,eAAO8sC,KAAO,WAEb,OAAOnC,8BAAQG,MAAMxwB,aAOtBta,eAAO+sC,MAAQ,WAEd,OAAOpC,8BAAQG,MAAMtwB,aAOtBxa,eAAOgtC,OAAS,SAAUt7B,EAAGC,GAE5B,IAAIxS,EAAIwrC,8BAAQG,MAAMtwB,YACtB,OAAOrb,EAAEwS,GAAK,EAAExS,GAAGuS,GAOpB1R,eAAOitC,MAAQ,SAAUv7B,EAAGC,GAE3B,IAAIxS,EAAIwrC,8BAAQG,MAAMtwB,YACtB,OAAOjL,KAAK29B,MAAM/tC,EAAEwS,GAAK,EAAExS,GAAGuS,IAQ/B1R,eAAOmtC,MAAQ,SAAUz7B,EAAGC,EAAGtS,EAAG+tC,GAAiB,GAElD,IAAIC,EAAQ,GAGR/jC,EAAIoI,EACR,IAAK,IAAIvP,EAAI,EAAGA,EAAI9C,EAAG8C,IAAKmH,IAE3B+jC,EAAM1oC,KAAK2E,GACPA,EAAE,EAAIqI,IAAGrI,EAAIoI,EAAE,GAIpB,MAAM5F,EAAIzM,IAAM,EAChB,IAAK,IAAI4F,EAAI,EAAGA,EAAI6G,EAAG7G,IACvB,CACCyM,EAAIu7B,MAAMhoC,EAAE,EAAG5F,EAAE,GAEjB,IAAI6P,EAAMm+B,EAAMpoC,GAChBooC,EAAMpoC,GAAKooC,EAAM37B,GACjB27B,EAAM37B,GAAKxC,EAIZ,IAAKk+B,EAAkB,OAAOC,EAE9B,IAAIroC,EAAI3F,EAAE,EACV,IAAK,IAAIkU,EAAI,EAAGA,EAAIlU,EAAGkU,IACvB,CACC,GAAI85B,EAAM95B,KAAO85B,EAAM95B,EAAE,GACxB,SAED,KAAM85B,EAAM95B,KAAO85B,EAAMroC,MAElBA,EAAI,IACTA,EAAI3F,EAAE,EACNiZ,QAAQC,IAAI,OAId,IAAIrJ,EAAMm+B,EAAM95B,GAChB85B,EAAM95B,GAAK85B,EAAMroC,GACjBqoC,EAAMroC,GAAKkK,EAGZ,OAAOm+B,GAORrtC,eAAOstC,OAAS,SAAU57B,EAAGC,EAAGtS,GAI/B,IAFA,IAAImJ,EAAO,GAEFrG,EAAI,EAAGA,EAAI9C,EAAG8C,IACtBqG,EAAK7D,KAAKqoC,OAAOt7B,EAAGC,IAErB,OAAOnJ,GAORxI,eAAOqkB,MAAQ,WAEd,OAAOkpB,YAAY9/B,OAOpBzN,eAAOwtC,QAAU,SAAU97B,EAAGC,GAE7B,OAAO,WAAa,OAAOs7B,MAAMv7B,EAAGC,KAOrC3R,eAAOytC,SAAW,SAAU1oC,EAAK2M,EAAE,KAAMC,EAAE,MAK1C,OAHU,OAAND,IAAYA,EAAI,GACV,OAANC,IAAYA,EAAI5M,EAAI3C,OAAS,GAE1B,WAAa,OAAO2C,EAAIkoC,MAAMv7B,EAAGC,MAOzC3R,eAAO0tC,2BAA6B,SAAUC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,GAGrG,GAAIP,GAAUI,GAAUH,GAAUI,GAAUH,GAAUI,GAAUH,GAAUI,EACzE,OAAO,EAIR,IAAIC,EAAML,EAASF,EACfQ,EAAMP,EAASF,EACfU,EAAMH,EAASF,EACfM,EAAML,EAASF,EAGnB,GAAW,GAAPI,GAAmB,GAAPE,EAChB,CACC,GAAIT,GAAUI,EAAQ,OAVb,EAYT,IAAItW,EAAKnoB,KAAKg/B,IAAIZ,EAAQI,GAG1B,OAAIrW,EAFKnoB,KAAK0R,IAAI4sB,EAAQI,GAbjB,GAiBDvW,EAAKiW,GAAUS,EAIxB,GAAW,GAAPA,GAAmB,GAAPE,EAChB,CACC,GAAIX,GAAUI,EAAQ,OAvBb,EAyBT,IAAIpW,EAAKpoB,KAAKg/B,IAAIX,EAAQI,GAG1B,OAAIrW,EAFKpoB,KAAK0R,IAAI6sB,EAAQI,GA1BjB,GA8BDvW,EAAKiW,GAAUO,EAIxB,GAAW,GAAPC,EAGH,OAAI,GADAI,GAAMH,GAAKV,EAASI,GAAUO,GAAKN,EAASJ,KAAYU,EAAMH,KACpDK,EAAK,GAGf,GADAC,GAAMd,EAASI,GAAUO,IACfG,EAAK,EAxCV,EA0CFD,EAIR,IAKIC,EAGAD,EAPA78B,EAAI08B,EAAID,EAAME,EAAIH,EAEtB,OAAS,GAALx8B,GAGA,GADA88B,GALIN,GAAKJ,EAASJ,GAAUS,GAAKR,EAASI,IAKjCr8B,IACC88B,EAAK,GAGf,GADAD,GAAMF,EAAIG,EAAKV,EAASJ,GAAUS,IACxBI,EAAK,EAvDT,EAyDHA,GAORxuC,eAAO0uC,sBAAwB,SAAUf,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,GAEhG,IAAI/uC,EAAIuuC,2BAA4BC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,EAAQC,GAC5F,OAAO/uC,GAAK,GAAKA,GAAK,GAWvBa,eAAO2uC,YAAc,SAAU9oB,EAAOrP,EAAG0O,EAAGY,EAAG,EAAGC,EAAG,GAEpD,MAAO,CACNvP,EAAGsP,GAAMtP,EAAEsP,GAAIvW,KAAKyW,IAAIH,IAAUX,EAAEa,GAAIxW,KAAK0W,IAAIJ,GACjDX,EAAGa,GAAMb,EAAEa,GAAIxW,KAAKyW,IAAIH,IAAUrP,EAAEsP,GAAIvW,KAAK0W,IAAIJ,KAQnD7lB,eAAO4uC,UAAY,SAAU7tC,EAAO8tC,EAAUC,EAAUC,GAEvD,OAAOx/B,KAAO29B,MAAM6B,GAAYhuC,EAAQ8tC,IAAaC,EAAWD,IAAcE,GAAaD,EAAWD,GAAYA,GAOnH7uC,eAAOgvC,WAAa,SAAUjuC,EAAOkX,GAEpC,OAAO1I,KAAK29B,MAAMnsC,EAAMkX,GAAMA,GAO/BjY,eAAOivC,iBAAmB,EAM1BjvC,eAAOkvC,QAAU,SAAUnuC,GAE1B,OAAOA,GAAU,GAAKkuC,mBAAsB,GAO7CjvC,eAAOmvC,UAAY,SAAUpuC,GAE5B,OAAOA,GAASkuC,kBAOjBjvC,eAAOovC,WAAa,SAAUruC,GAE7B,OAAOA,GAAS,GAAKkuC,mBAOtBjvC,eAAOqvC,OAAS,SAAUtuC,GAEzB,OAAOquC,WAAWF,QAAQnuC,KAO3Bf,eAAOqmB,MAAQ,SAAStlB,GAEvB,OAAOA,IAAWA,GAOnBf,eAAOsvC,OAAS,SAAS59B,EAAGC,GAE3B,OAAOpC,KAAKoG,IAAIjE,GAAKnC,KAAKoG,IAAIhE,GAAKD,EAAIC,GAOxC3R,eAAOuvC,OAAS,SAAS79B,EAAGC,GAE3B,OAAOpC,KAAKoG,IAAIjE,GAAKnC,KAAKoG,IAAIhE,GAAKD,EAAIC,GAOxC3R,eAAOwvC,OAAS,SAAUx8B,EAAKD,GAE9B,IAAI08B,EAAM,GAEV,KAAO18B,KAAU,GAChB08B,GAAOz8B,EAER,OAAOy8B,GAORzvC,eAAO0vC,KAAO,SAAU9+B,EAAKkc,EAAM6iB,EAAK,KAGvC,OADA/+B,EAAMA,EAAIlP,WACH8tC,OAAOG,EAAKC,OAAO,GAAI9iB,EAAKlc,EAAIxO,QAAUwO,GAOlD5Q,eAAO6vC,KAAO,SAAUj/B,EAAKkc,EAAM6iB,EAAK,KAGvC,OADA/+B,EAAMA,EAAIlP,YACG8tC,OAAOG,EAAKC,OAAO,GAAI9iB,EAAKlc,EAAIxO,SAO9CpC,eAAO8vC,KAAO,SAAU/uC,GAEvB,MAAuB,IAAfA,EAAQ,IAOjBf,eAAO+vC,MAAQ,SAAUhvC,GAExB,OAAe,EAARA,EAAc,GAOtBf,eAAOgwC,MAAQ,SAAUjvC,EAAOkvC,EAAG,EAAKvY,EAAG,GAE1C,OAAO32B,EAAQkvC,EAAKA,EAAMlvC,EAAQ22B,EAAKA,EAAK32B,GAO7Cf,eAAOsT,IAAM,SAAUvS,EAAOmG,EAAIC,EAAI+oC,EAAIC,GAEzC,OAASpvC,EAAQmG,IAAKipC,EAAKD,IAAO/oC,EAAKD,GAAOgpC,GAO/ClwC,eAAOowC,IAAM,SAAU55B,EAAG0O,EAAGxT,GAE5B,OAAO8E,GAAG,EAAE9E,GAAKwT,EAAExT;;AC5mBpB,MAAM2+B,2BAAO,SAAUC,EAAWC,EAAc,MAE/CzuC,KAAKqH,KAAO,GACZrH,KAAKwuC,UAAYA,EAEjBxuC,KAAKyuC,cAAgBA,EAErBzuC,KAAK0uC,SAAW,EAChB1uC,KAAK2uC,WAAa,EAElB3uC,KAAK4uC,OAAS,EACd5uC,KAAK6uC,SAAW,G,IAGjBC,yCAAeP,2BAMfA,2BAAK/pC,UAAUuqC,MAAQ,WACtB/uC,KAAK8hB,UAAY2pB,YAAY9/B,OAO9B4iC,2BAAK/pC,UAAUw3B,IAAM,WACpBh8B,KAAKgvC,KAAMvD,YAAY9/B,MAAQ3L,KAAK8hB,YAOrCysB,2BAAK/pC,UAAUwqC,KAAO,SAAU/vC,GAE/Be,KAAKqH,KAAKxE,KAAK5D,GACfe,KAAK0uC,WAED1uC,KAAKqH,KAAK/G,QAAUN,KAAKwuC,YAG7BxuC,KAAKivC,SACLjvC,KAAKqH,KAAO,KAObknC,2BAAK/pC,UAAU4D,OAAS,WAEvB,IAAI+W,EAAM,KACNstB,EAAM,KACNyC,EAAM,EACNC,EAAM,EAEV,IAAK,IAAI9uC,EAAI,EAAGA,EAAIL,KAAKqH,KAAK/G,OAAQD,IAErC8e,EAAc,OAARA,EAAenf,KAAKqH,KAAKhH,GAAKoN,KAAK0R,IAAIA,EAAKnf,KAAKqH,KAAKhH,IAC5DosC,EAAc,OAARA,EAAezsC,KAAKqH,KAAKhH,GAAKoN,KAAKg/B,IAAIA,EAAKzsC,KAAKqH,KAAKhH,IAC5D6uC,GAAOlvC,KAAKqH,KAAKhH,GAGlB6uC,GAAOlvC,KAAKqH,KAAK/G,OAEjB,IAAIlD,EAA2B,OAAvB4C,KAAKyuC,cAAyBzuC,KAAKyuC,cAAgBS,EAE3D,IAAK,IAAI/rC,EAAI,EAAGA,EAAInD,KAAKqH,KAAK/G,OAAQ6C,IAAKgsC,GAAO1hC,KAAKC,IAAI1N,KAAKqH,KAAKlE,GAAK/F,EAAG,GAa7E,OAXA+xC,EAAM1hC,KAAKkX,KAAKwqB,EAAMnvC,KAAKqH,KAAK/G,QAEhCN,KAAK4uC,QAAUO,EACfnvC,KAAK6uC,WAEL7uC,KAAKmf,IAAMA,EACXnf,KAAKysC,IAAMA,EACXzsC,KAAKkvC,IAAMA,EACXlvC,KAAKmvC,IAAMA,EAEXnvC,KAAK2uC,WAAa3uC,KAAK0uC,SAChB1uC,MAORuuC,2BAAK/pC,UAAUyqC,OAAS,SAAUvO,EAAM,KAEvC,IAAIiN,EAAM,GAaV,OAXI3tC,KAAK2uC,YAAc3uC,KAAK0uC,UAC3B1uC,KAAKoI,SAEFs4B,EAAQ6N,2BAAKa,MAAMC,UAAS1B,GAAO,MAAQ3tC,KAAK6uC,UAChDnO,EAAQ6N,2BAAKa,MAAME,MAAK3B,IAAe,IAAPA,EAAY,KAAO,IAAM,QAAU3tC,KAAKmf,KACxEuhB,EAAQ6N,2BAAKa,MAAMG,MAAK5B,IAAe,IAAPA,EAAY,KAAO,IAAM,QAAU3tC,KAAKysC,KACxE/L,EAAQ6N,2BAAKa,MAAMI,MAAK7B,IAAe,IAAPA,EAAY,KAAO,IAAM,QAAU3tC,KAAKkvC,IAAItvB,QAAQ,IACpF8gB,EAAQ6N,2BAAKa,MAAMK,WAAU9B,IAAe,IAAPA,EAAY,KAAO,UAA8B+B,IAAvB1vC,KAAKyuC,cAA8B,MAAQzuC,KAAKyuC,cAAgB,KAC/H/N,EAAQ6N,2BAAKa,MAAMO,SAAQhC,IAAe,IAAPA,EAAY,KAAO,IAAM,WAAa3tC,KAAKmvC,IAAIvvB,QAAQ,IAC1F8gB,EAAQ6N,2BAAKa,MAAMQ,aAAYjC,IAAe,IAAPA,EAAY,KAAO,IAAM,gBAAkB3tC,KAAK4uC,OAAS5uC,KAAK6uC,UAAUjvB,QAAQ,IAEpH+tB;;;;AAQRY,2BAAKa,MAAQ,CACZC,QAAS;;AAETC,IAAK;;AAELC,IAAK;;AAELC,IAAK;;AAELC,SAAU;;AAEVE,OAAQ;;AAERC,WAAY;;AAEZC,IAAK;AC1IN,IAAAh4B,OAAAxZ,cAAA;;sBAWA;MAAMyxC,kCAAcj4B,OAAAK,MAAM3R,OACzB,CAIAwpC,cAAe,KAKfC,YAAa,KAKbC,gBAAiB,KAKjBhiB,MAAO,EAKPC,OAAQ,EAKRgiB,YAAa,KACbC,cAAe,KAQfzrC,OAAQ,SAAUupB,EAAM,KAAMC,EAAO,MAEjB,OAAfwE,yCAAQhM,KAGkB,OAA1B0pB,yCAAmB,IACtBC,6CAAuB3d,yCAAQhM,IAEhC1mB,KAAK+vC,cAAgBrd,yCAAQhM,GAAG4pB,oBAEhCtwC,KAAKkwC,YAAc,GACnBlwC,KAAKmwC,cAAgB,GAMrBnwC,KAAKiuB,MAAQA,GAAS0R,yCAAOC,SAAS3R,MACtCjuB,KAAKkuB,OAASA,GAAUyR,yCAAOC,SAAS1R,OAErCluB,KAAKgwC,YAAc,IAAIvtC,MAAMqtC,kCAAYS,uBAAuBjyB,KAAK,MACrEte,KAAKiwC,gBAAkB,IAAIxtC,MAAMqtC,kCAAYS,uBAAuBjyB,KAAK,QAM7E3Z,OAAQ,WAEP,IAAI+hB,EAAKgM,yCAAQhM,GACjB,GAAW,OAAPA,EAAJ,CAEA,IAAK,IAAIrmB,EAAI,EAAGA,EAAIL,KAAKgwC,YAAY1vC,OAAQD,IAEhB,OAAxBL,KAAKgwC,YAAY3vC,KAEhBL,KAAKiwC,gBAAgB5vC,KAAOyvC,kCAAYU,QAC3C9pB,EAAG+pB,cAAczwC,KAAKgwC,YAAY3vC,IAElCqmB,EAAGgqB,mBAAmB1wC,KAAKgwC,YAAY3vC,KAI1CqmB,EAAGiqB,kBAAkB3wC,KAAK4wC,iBAU3BxmB,OAAQ,SAAUymB,EAAiBC,EAASzxC,EAAK,MAEhD,IAAIqnB,EAAKgM,yCAAQhM,GACjB,GAAW,OAAPA,EAAa,OAEJ,OAATrnB,IACHA,EAAOwxC,EAAkBf,kCAAYiB,MAAQjB,kCAAYU,QAAUV,kCAAYkB,cAEhFhxC,KAAKgwC,YAAYa,GAAmBC,EACpC9wC,KAAKiwC,gBAAgBY,GAAmBxxC,EAEpCwxC,EAAkBf,kCAAYiB,QAAuD,IAA9C/wC,KAAKkwC,YAAY1uC,QAAQqvC,KAEnE7wC,KAAKkwC,YAAYrtC,KAAKguC,GACtB7wC,KAAKmwC,cAActtC,KAAKutC,yCAAmBS,KAG5C,IAAI5nC,EAAOyd,EAAGmB,aAAanB,EAAGuqB,qBAG9B,OAFAvqB,EAAGwqB,gBAAiBxqB,EAAGyqB,YAAanxC,KAAK+vC,eAEjC1wC,GAEP,KAAKywC,kCAAYU,QAChB9pB,EAAG0qB,qBAAsB1qB,EAAGyqB,YAAaf,yCAAmBS,GAAkBnqB,EAAGmI,WAAYiiB,EAAS,GACtG,MAED,KAAKhB,kCAAYkB,aAChBtqB,EAAG2qB,wBAAyB3qB,EAAGyqB,YAAaf,yCAAmBS,GAAkBnqB,EAAGsqB,aAAcF,GAIpGpqB,EAAGwqB,gBAAiBxqB,EAAGyqB,YAAaloC,IAUrCqoC,kBAAmB,SAAUT,EAAiB5iB,EAAM,KAAMC,EAAO,MAEhE,IAAIxH,EAAKgM,yCAAQhM,GACjB,GAAW,OAAPA,EAAa,OAAO,KAEV,OAAVuH,IAAgBA,EAAQjuB,KAAKiuB,OAClB,OAAXC,IAAiBA,EAASluB,KAAKkuB,QAEnC,IAAIqjB,EAAM7qB,EAAGiI,gBAUb,OATAjI,EAAGkI,YAAalI,EAAGmI,WAAY0iB,GAE/B7qB,EAAGsI,aAActI,EAAGmI,WAAY,EAAGnI,EAAGuI,MAAOhB,EAAOC,GACpDxH,EAAGyI,cAAezI,EAAGmI,WAAYnI,EAAG0I,mBAAoB1I,EAAG6I,SAC3D7I,EAAGyI,cAAezI,EAAGmI,WAAYnI,EAAG4I,mBAAoB5I,EAAG6I,SAC3D7I,EAAGyI,cAAezI,EAAGmI,WAAYnI,EAAGgJ,eAAgBhJ,EAAGoJ,eACvDpJ,EAAGyI,cAAezI,EAAGmI,WAAYnI,EAAGkJ,eAAgBlJ,EAAGoJ,eAEvD9vB,KAAKoqB,OAAOymB,EAAiBU,GACtBA,GAURC,kBAAmB,SAAUvjB,EAAM,KAAMC,EAAO,MAE/C,IAAIxH,EAAKgM,yCAAQhM,GACjB,GAAW,OAAPA,EAAa,OAAO,KAEV,OAAVuH,IAAgBA,EAAQjuB,KAAKiuB,OAClB,OAAXC,IAAiBA,EAASluB,KAAKkuB,QAEnC,IAAIqjB,EAAM7qB,EAAG+qB,qBAKb,OAJA/qB,EAAGgrB,iBAAkBhrB,EAAGsqB,aAAcO,GACtC7qB,EAAGirB,oBAAqBjrB,EAAGsqB,aAActqB,EAAGkrB,kBAAmB3jB,EAAOC,GAEtEluB,KAAKoqB,OAAO0lB,kCAAYiB,MAAOQ,GACxBA,GAURM,oBAAqB,SAAU5jB,EAAM,KAAMC,EAAO,MAEjD,IAAIxH,EAAKgM,yCAAQhM,GACjB,GAAW,OAAPA,EAAa,OAAO,KAEV,OAAVuH,IAAgBA,EAAQjuB,KAAKiuB,OAClB,OAAXC,IAAiBA,EAASluB,KAAKkuB,QAEnC,IAAIqjB,EAAM7qB,EAAGiI,gBAUb,OATAjI,EAAGkI,YAAalI,EAAGmI,WAAY0iB,GAE/B7qB,EAAGsI,aAActI,EAAGmI,WAAY,EAAGnI,EAAGorB,cAAe7jB,EAAOC,GAC5DxH,EAAGyI,cAAezI,EAAGmI,WAAYnI,EAAG0I,mBAAoB1I,EAAG6I,SAC3D7I,EAAGyI,cAAezI,EAAGmI,WAAYnI,EAAG4I,mBAAoB5I,EAAG6I,SAC3D7I,EAAGyI,cAAezI,EAAGmI,WAAYnI,EAAGgJ,eAAgBhJ,EAAGoJ,eACvDpJ,EAAGyI,cAAezI,EAAGmI,WAAYnI,EAAGkJ,eAAgBlJ,EAAGoJ,eAEvD9vB,KAAKoqB,OAAO0lB,kCAAYgC,cAAeP,GAChCA,GAORQ,WAAY,SAAUlB,GAErB,OAAI7wC,KAAKiwC,gBAAgBY,KAAqBf,kCAAYU,QAClD,KAEDxwC,KAAKgwC,YAAYa,IAOzBmB,gBAAiB,SAAUnB,GAE1B,OAAI7wC,KAAKiwC,gBAAgBY,KAAqBf,kCAAYkB,aAClD,KAEDhxC,KAAKgwC,YAAYa,IAMzBniB,KAAM,WAEL,IAAIhI,EAAKgM,yCAAQhM,GACN,OAAPA,IAEJA,EAAGwqB,gBAAiBxqB,EAAGyqB,YAAanxC,KAAK+vC,eAEzCrpB,EAAGwpB,YAAalwC,KAAKmwC,eACrBzpB,EAAG+T,SAAU,EAAG,EAAGz6B,KAAKiuB,MAAOjuB,KAAKkuB,UAMrC+jB,OAAQ,WAEP,IAAIvrB,EAAKgM,yCAAQhM,GACN,OAAPA,IAEJA,EAAGwqB,gBAAiBxqB,EAAGyqB,YAAa,MAEpCzqB,EAAGwpB,YAAagC,0CAChBxrB,EAAG+T,SAAU,EAAG,EAAGkF,yCAAOC,SAAS3R,MAAO0R,yCAAOC,SAAS1R,UAM3DikB,WAAY,WAEX,IAAIzrB,EAAKgM,yCAAQhM,GACjB,GAAW,OAAPA,EAAa,OAAO,EAExB,IAAIzd,EAAOyd,EAAGmB,aAAanB,EAAGuqB,qBAC9BvqB,EAAGwqB,gBAAiBxqB,EAAGyqB,YAAanxC,KAAK+vC,eACzC,IAAIqC,EAAS1rB,EAAG2rB,uBAAuB3rB,EAAGyqB,aAG1C,OAFAzqB,EAAGwqB,gBAAiBxqB,EAAGyqB,YAAaloC,GAE7BmpC,IAAW1rB,EAAG4rB,wBAQvBxC,kCAAYU,QAAU,EACtBV,kCAAYkB,aAAe,EAK3BlB,kCAAYyC,OAAW,EACvBzC,kCAAY0C,OAAW,EACvB1C,kCAAY2C,OAAW,EACvB3C,kCAAY4C,OAAW,EACvB5C,kCAAY6C,OAAW,EACvB7C,kCAAY8C,OAAW,EACvB9C,kCAAY+C,OAAW,EACvB/C,kCAAYgD,OAAW,EACvBhD,kCAAYiB,MAAW,EACvBjB,kCAAYiD,QAAY,EACxBjD,kCAAYgC,cAAgB,GAE5BhC,kCAAYS,sBAAwB,GAKpC,MAAMH,yCAAqB,IAAI3tC,MAAMqtC,kCAAYS,uBAAuBjyB,KAAK,MACvE4zB,yCAAqB,IAAIzvC,MAAM,GAAG6b,KAAK,MAKvC+xB,6CAAyB,SAAU3pB,GAExCwrB,yCAAmB,GAAKxrB,EAAGssB,KAE3B5C,yCAAmBN,kCAAYyC,QAAU7rB,EAAGusB,kBAC5C7C,yCAAmBN,kCAAY0C,QAAU9rB,EAAGwsB,kBAC5C9C,yCAAmBN,kCAAY2C,QAAU/rB,EAAGysB,kBAC5C/C,yCAAmBN,kCAAY4C,QAAUhsB,EAAG0sB,kBAC5ChD,yCAAmBN,kCAAY6C,QAAUjsB,EAAG2sB,kBAC5CjD,yCAAmBN,kCAAY8C,QAAUlsB,EAAG4sB,kBAC5ClD,yCAAmBN,kCAAY+C,QAAUnsB,EAAG6sB,kBAC5CnD,yCAAmBN,kCAAYgD,QAAUpsB,EAAG8sB,kBAC5CpD,yCAAmBN,kCAAYiB,OAASrqB,EAAG+sB,iBAC3CrD,yCAAmBN,kCAAYiD,SAAWrsB,EAAGgtB,mBAC7CtD,yCAAmBN,kCAAYgC,eAAiBprB,EAAGitB,0B,IAGpDC,yCAAe9D,kC,8uBC/Uf,IAAAj4B,OAAAxZ,cAAA;iBAQA;MAAMw1C,+BAAWh8B,OAAAK,MAAM3R,OACtB,CACA9B,UAAW,WAOXqvC,SAAU,KAOV7lB,MAAO,EAOPC,OAAQ,EAORtI,GAAI,EAOJC,GAAI,EAOJkuB,OAAQ,EAORC,QAAS,EAQTtvC,OAAQ,SAAUovC,EAAS,KAAM7lB,EAAM,KAAMC,EAAO,MAEnD,GAAIrW,OAAA6I,KAAK/c,aAAamwC,EAAUD,gCAChC,CACC,IAAII,EAAWH,EAEf9zC,KAAK8zC,SAAWG,EAASH,SACzB9zC,KAAKiuB,MAAQA,GAASgmB,EAAShmB,MAC/BjuB,KAAKkuB,OAASA,GAAU+lB,EAAS/lB,OAEjCluB,KAAK4lB,GAAKquB,EAASruB,GACnB5lB,KAAK6lB,GAAKouB,EAASpuB,GACnB7lB,KAAK+zC,OAASE,EAASF,OACvB/zC,KAAKg0C,QAAUC,EAASD,aAIxBh0C,KAAK8zC,SAAWA,EAEhB9zC,KAAK4lB,GAAK,EACV5lB,KAAK6lB,GAAK,EAEN7lB,KAAK8zC,UAER9zC,KAAKiuB,MAAQA,GAAS6lB,EAAS3lB,YAC/BnuB,KAAKkuB,OAASA,GAAU4lB,EAAS1lB,aAEjCpuB,KAAK+zC,OAASD,EAAS7lB,MACvBjuB,KAAKg0C,QAAUF,EAAS5lB,SAIxBluB,KAAKiuB,MAAQA,EACbjuB,KAAKkuB,OAASA,EAEdluB,KAAK+zC,OAAS9lB,EACdjuB,KAAKg0C,QAAU9lB,IASlBgmB,YAAa,WAEZ,OAAOl0C,MASRm0C,SAAU,WAET,OAAOn0C,KAAK8zC,UAOb/B,WAAY,WAEX,OAAO/xC,KAAK8zC,UAObtgB,OAAQ,SAAUvF,EAAOC,GAaxB,OAXAD,EAAkB,OAAVA,GAA4B,IAAVA,GAAiBA,EAAgBjuB,KAAKiuB,MAChEC,EAAoB,OAAXA,GAA8B,IAAXA,GAAkBA,EAAkBluB,KAAKkuB,QAEvD,IAAVD,EACHA,EAAQC,GAAQluB,KAAKiuB,MAAMjuB,KAAKkuB,SACb,IAAXA,IACRA,EAASD,GAAOjuB,KAAKkuB,OAAOluB,KAAKiuB,QAElCjuB,KAAKiuB,MAAQA,EACbjuB,KAAKkuB,OAASA,EAEPluB,MAORy/B,KAAM,SAAUrF,EAAG1lB,EAAG0O,EAAG6K,EAAM,KAAMC,EAAO,MAE3CD,EAAQA,GAASjuB,KAAKiuB,MACtBC,EAASA,GAAUluB,KAAKkuB,OAExBluB,KAAKo0C,MAAMha,EAAGp6B,KAAK4lB,GAAI5lB,KAAK6lB,GAAI7lB,KAAK+zC,OAAQ/zC,KAAKg0C,QAASt/B,EAAG0O,EAAG6K,EAAOC,IAOzEkmB,MAAO,SAAUha,EAAGxU,EAAIC,EAAIkuB,EAAQC,EAASK,EAAIC,EAAIC,EAAQC,EAASC,EAAO,KAAMC,EAAQ,MAE1Fta,EAAE7D,UAAWv2B,KAAK8zC,SACjBluB,EAAIC,EAAIkuB,EAAQC,EAChBK,EAAIC,EAAIC,EAAQC,EAChB,KAAM,KAAMC,GAAUF,EAAQG,GAAWF,IAO3ChjB,OAAQ,SAAU4I,EAAGx3B,GAEpB5C,KAAKy/B,KAAMrF,EAAGx3B,EAAK+xC,OAAO/e,GAAIhzB,EAAK+xC,OAAO9e,GAAIjzB,EAAK+xC,OAAO1mB,QAASrrB,EAAK+xC,OAAOzmB,aAQ3E0mB,gCAAYf,+BAASttC,OAC1B,CACA9B,UAAW,oBAEXowC,GAAI,KACJC,cAAe,EAEfpwC,OAAQ,SAAUqwC,EAAaD,GAI9B,GAFA90C,KAAKuE,OAAOywC,SAAStwC,OAAOqwC,GAER,OAAhBA,IAAyBl9B,OAAAK,MAAMpT,WAAWiwC,EAAa,eAC1D,MAAM,IAAIr2C,MAAM,mCAEjBsB,KAAK60C,GAAKE,EACV/0C,KAAK80C,cAAgBA,GAGtBnwC,OAAQ,WAEPic,QAAQ5gB,KAAK60C,KAGd9C,WAAY,WAEX,OAAO/xC,KAAK60C,GAAG9C,cAGhBtS,KAAM,SAAUrF,EAAG1lB,EAAG0O,EAAG6K,EAAOC,GAE/B,MAAM1mB,EAAIxH,KAAK80C,cAEf,IAAIG,EAAYj1C,KAAK60C,GAAGK,SAAS1tC,EAAE,GAAGymB,MAClCknB,EAAan1C,KAAK60C,GAAGK,SAAS1tC,EAAE,GAAGymB,MACnCmnB,EAAWp1C,KAAK60C,GAAGK,SAAS1tC,EAAE,GAAGymB,MAEjConB,EAAYr1C,KAAK60C,GAAGK,SAAS1tC,EAAE,GAAG0mB,OAClConB,EAAet1C,KAAK60C,GAAGK,SAAS1tC,EAAE,GAAG0mB,OACrCqnB,EAAYv1C,KAAK60C,GAAGK,SAAS1tC,EAAE,GAAG0mB,OAElC3wB,EAAI6V,KAAK6a,EAAQgnB,EAAYE,GAAcC,GAC3CprC,EAAIoJ,KAAK8a,EAASmnB,EAAYC,GAAgBC,GAE9C3f,EAAKlhB,EACLmhB,EAAKzS,EAGTpjB,KAAK60C,GAAGK,SAAS1tC,EAAE,GAAGi4B,KAAKrF,EAAGxE,EAAIC,GAClC71B,KAAK60C,GAAGK,SAAS1tC,EAAE,GAAGi4B,KAAKrF,EAAGxE,EAAKqf,EAAY13C,EAAE63C,EAAUvf,GAC3D71B,KAAK60C,GAAGK,SAAS1tC,EAAE,GAAGi4B,KAAKrF,EAAGxE,EAAIC,EAAKwf,EAAYrrC,EAAEurC,GACrDv1C,KAAK60C,GAAGK,SAAS1tC,EAAE,GAAGi4B,KAAKrF,EAAGxE,EAAKqf,EAAY13C,EAAE63C,EAAUvf,EAAKwf,EAAYrrC,EAAEurC,GAG9E,IAAK,IAAIl1C,EAAI,EAAGA,EAAI9C,EAAG8C,IACtBL,KAAK60C,GAAGK,SAAS1tC,EAAE,GAAGi4B,KAAKrF,EAAGxE,EAAKqf,EAAY50C,EAAE+0C,EAAUvf,GAC3D71B,KAAK60C,GAAGK,SAAS1tC,EAAE,GAAGi4B,KAAKrF,EAAGxE,EAAKqf,EAAY50C,EAAE+0C,EAAUvf,EAAKwf,EAAYrrC,EAAEurC,GAI/E,IAAK,IAAIpyC,EAAI,EAAGA,EAAI6G,EAAG7G,IACtBnD,KAAK60C,GAAGK,SAAS1tC,EAAE,GAAGi4B,KAAKrF,EAAGxE,EAAIC,EAAKwf,EAAYlyC,EAAEoyC,GACrDv1C,KAAK60C,GAAGK,SAAS1tC,EAAE,GAAGi4B,KAAKrF,EAAGxE,EAAKqf,EAAY13C,EAAE63C,EAAUvf,EAAKwf,EAAYlyC,EAAEoyC,GAI/E,IAAK,IAAIryC,EAAI,EAAGA,EAAI8G,EAAG9G,IACvB,IAAK,IAAIuO,EAAI,EAAGA,EAAIlU,EAAGkU,IACtBzR,KAAK60C,GAAGK,SAAS1tC,EAAE,GAAGi4B,KAAKrF,EAAGxE,EAAKqf,EAAYxjC,EAAE2jC,EAAUvf,EAAKwf,EAAYnyC,EAAEqyC,MAKjFx3B,SAASgC,WAAW60B,gCAAW,KAM/B,MAAMY,+BAAW3B,+BAASttC,OACzB,CACA9B,UAAW,mBAEXwvC,SAAU,KAEVvvC,OAAQ,SAAUuvC,GAEjBj0C,KAAKuE,OAAOywC,SAAStwC,OAAOuvC,GAC5Bj0C,KAAKi0C,SAAWA,GAGjBtvC,OAAQ,WAEPic,QAAQ5gB,KAAKi0C,WAGdG,MAAO,SAAUha,EAAGxU,EAAIC,EAAIkuB,EAAQC,EAASK,EAAIC,EAAIC,EAAQC,EAASC,EAAO,KAAMC,EAAQ,MAE1F10C,KAAKi0C,SAASG,MAAMha,EAAGxU,EAAIC,EAAIkuB,EAAQC,EAASK,EAAIC,EAAIC,EAAQC,EAASx0C,KAAKiuB,MAAOjuB,KAAKkuB,WAI5FnQ,SAASgC,WAAWy1B,+BAAU,KAM9B,MAAMC,8BAAU5B,+BAASttC,OACxB,CACA9B,UAAW,kBAEXwvC,SAAU,KAEVvvC,OAAQ,SAAUuvC,GAEjBj0C,KAAKuE,OAAOywC,SAAStwC,OAAOuvC,GAC5Bj0C,KAAKi0C,SAAWA,GAGjBtvC,OAAQ,WAEPic,QAAQ5gB,KAAKi0C,WAGdxU,KAAM,SAAUrF,EAAG1lB,EAAG0O,EAAG6K,EAAM,KAAMC,EAAO,MAE3C,IAAI+C,EAAMjxB,KAAK+xC,aAEf9jB,EAAQA,GAASjuB,KAAKiuB,MACtBC,EAASA,GAAUluB,KAAKkuB,OAExBluB,KAAKi0C,SAASG,MAAOha,EACpBp6B,KAAKi0C,SAASruB,GAAI5lB,KAAKi0C,SAASpuB,GAAIoI,EAAMgD,EAAI5C,OAAQH,EAAO+C,EAAI5C,OACjE3Z,EAAG0O,EAAG6K,EAAOC,MAIhBnQ,SAASgC,WAAW01B,8BAAS,KAM7B,MAAMC,+BAAW7B,+BAASttC,OACzB,CACA9B,UAAW,mBAEXwvC,SAAU,KACV1S,MAAO,EACPC,MAAO,EAEP98B,OAAQ,SAAUuvC,EAAU1S,EAAOC,GAElCxhC,KAAKuE,OAAOywC,SAAStwC,OAAOuvC,GAE5Bj0C,KAAKi0C,SAAWA,EAChBj0C,KAAKuhC,MAAQA,EACbvhC,KAAKwhC,MAAQA,GAGd78B,OAAQ,WAEPic,QAAQ5gB,KAAKi0C,WAGdxU,KAAM,SAAUrF,EAAG1lB,EAAG0O,EAAG6K,EAAM,KAAMC,EAAO,MAE3CD,EAAQA,GAASjuB,KAAKiuB,MACtBC,EAASA,GAAUluB,KAAKkuB,OAExBluB,KAAKi0C,SAASxU,KAAKrF,EAAG1lB,EAAE1U,KAAKuhC,MAAyB,IAAlBtT,EAAMjuB,KAAKiuB,OAAY7K,EAAEpjB,KAAKwhC,MAA2B,IAApBtT,EAAOluB,KAAKkuB,QAAaluB,KAAKiuB,MAAOjuB,KAAKkuB,WAIrHnQ,SAASgC,WAAW21B,+BAAU,KAM9B,MAAMC,6BAAS9B,+BAASttC,OACvB,CACA9B,UAAW,iBAEXwvC,SAAU,KACV1S,MAAO,EACPC,MAAO,EAEP98B,OAAQ,SAAUuvC,EAAU1S,EAAOC,GAElCxhC,KAAKuE,OAAOywC,SAAStwC,OAAOuvC,GAE5Bj0C,KAAKi0C,SAAWA,EAChBj0C,KAAKuhC,MAAQA,EACbvhC,KAAKwhC,MAAQA,GAGd78B,OAAQ,WAEPic,QAAQ5gB,KAAKi0C,WAGdxU,KAAM,SAAUrF,EAAG1lB,EAAG0O,EAAG6K,EAAM,KAAMC,EAAO,MAE3CluB,KAAKi0C,SAASxU,KAAKrF,EAAG1lB,EAAE1U,KAAKuhC,MAAOne,EAAEpjB,KAAKwhC,MAAOvT,EAAOC,MAI3DnQ,SAASgC,WAAW41B,6BAAQ,KAM5B,MAAMC,4BAAQ/B,+BAASttC,OACtB,CACA9B,UAAW,gBAEXiC,KAAM,KAENhC,OAAQ,SAAUgC,GAEjB1G,KAAKuE,OAAOywC,SAAStwC,SAErB1E,KAAK0G,KAAOA,EAEZ1G,KAAKiuB,MAAQ,EACbjuB,KAAKkuB,OAAS,EAEd,IAAK,IAAI7tB,EAAI,EAAGA,EAAIL,KAAK0G,KAAKpG,OAAQD,IAEjCL,KAAK0G,KAAKrG,GAAG4tB,MAAQjuB,KAAKiuB,QAAOjuB,KAAKiuB,MAAQjuB,KAAK0G,KAAKrG,GAAG4tB,OAC3DjuB,KAAK0G,KAAKrG,GAAG6tB,OAASluB,KAAKkuB,SAAQluB,KAAKkuB,OAASluB,KAAK0G,KAAKrG,GAAG6tB,QAGnEluB,KAAK+zC,OAAS/zC,KAAKiuB,MACnBjuB,KAAKg0C,QAAUh0C,KAAKkuB,QAGrBvpB,OAAQ,WAEP,GAAkB,OAAd3E,KAAK0G,KACT,CACC,IAAK,IAAIrG,EAAI,EAAGA,EAAIL,KAAK0G,KAAKpG,OAAQD,IACrCugB,QAAQ5gB,KAAK0G,KAAKrG,IAEnBL,KAAK0G,KAAO,OAId+4B,KAAM,SAAUrF,EAAG1lB,EAAG0O,EAAG6K,EAAM,KAAMC,EAAO,MAE3C,IAAK,IAAI7tB,EAAI,EAAGA,EAAIL,KAAK0G,KAAKpG,OAAQD,IACrCL,KAAK0G,KAAKrG,GAAGo/B,KAAKrF,EAAG1lB,EAAG0O,EAAG6K,EAAOC,IAGpCsD,OAAQ,SAAU4I,EAAGx3B,GAEpB,IAAK,IAAIvC,EAAI,EAAGA,EAAIL,KAAK0G,KAAKpG,OAAQD,IACrCL,KAAK0G,KAAKrG,GAAGmxB,OAAO4I,EAAGx3B,MAI1Bmb,SAASgC,WAAW61B,4BAAO,KAM3B,MAAMC,8BAAUhC,+BAASttC,OACxB,CACA9B,UAAW,kBAEXwvC,SAAU,KAEVvvC,OAAQ,SAAUuvC,GAEjBj0C,KAAKuE,OAAOywC,SAAStwC,OAAOuvC,GAC5Bj0C,KAAKi0C,SAAWA,GAGjBtvC,OAAQ,WAEPic,QAAQ5gB,KAAKi0C,WAGdG,MAAO,SAAUha,EAAGxU,EAAIC,EAAIkuB,EAAQC,EAASK,EAAIC,EAAIC,EAAQC,EAASC,EAAO,KAAMC,EAAQ,MAE1Fta,EAAE+B,aACF/B,EAAEzW,UAAU0wB,EAAGE,EAAQD,GACvBla,EAAEzX,OAAM,EAAI,GACZ3iB,KAAKi0C,SAASG,MAAMha,EAAGxU,EAAIC,EAAIkuB,EAAQC,EAAS,EAAG,EAAGO,EAAQC,EAASC,EAAQC,GAC/Eta,EAAEgC,eAIJre,SAASgC,WAAW81B,8BAAS,KAM7B,MAAMC,8BAAUjC,+BAASttC,OACxB,CACA9B,UAAW,kBAEXwvC,SAAU,KAEVvvC,OAAQ,SAAUuvC,GAEjBj0C,KAAKuE,OAAOywC,SAAStwC,OAAOuvC,GAC5Bj0C,KAAKi0C,SAAWA,GAGjBtvC,OAAQ,WAEPic,QAAQ5gB,KAAKi0C,WAGdG,MAAO,SAAUha,EAAGxU,EAAIC,EAAIkuB,EAAQC,EAASK,EAAIC,EAAIC,EAAQC,EAASC,EAAO,KAAMC,EAAQ,MAE1Fta,EAAE+B,aACF/B,EAAEzW,UAAU0wB,EAAIC,EAAGE,GACnBpa,EAAEzX,MAAM,GAAG,GACX3iB,KAAKi0C,SAASG,MAAMha,EAAGxU,EAAIC,EAAIkuB,EAAQC,EAAS,EAAG,EAAGO,EAAQC,EAASC,EAAQC,GAC/Eta,EAAEgC,eAIJre,SAASgC,WAAW+1B,8BAAS,KAS7BjC,+BAASkC,UAAY,SAAUhB,EAAaD,EAAc,GAAK,OAAOF,gCAAU50B,KAAKX,MAAM01B,EAAaD,IAKxGjB,+BAASrvC,UAAUuxC,UAAY,SAASjB,EAAc,GAAK,OAAOF,gCAAU50B,KAAKX,MAAMrf,KAAM80C,IAM7FjB,+BAASmC,SAAW,SAAU/B,GAAY,OAAOuB,+BAASx1B,KAAKX,MAAM40B,IAKrEJ,+BAASrvC,UAAUwxC,SAAW,WAAc,OAAOR,+BAASx1B,KAAKX,MAAMrf,OAMvE6zC,+BAASoC,QAAU,SAAUhC,GAAY,OAAOwB,8BAAQz1B,KAAKX,MAAM40B,IAKnEJ,+BAASrvC,UAAUyxC,QAAU,WAAc,OAAOR,8BAAQz1B,KAAKX,MAAMrf,OAMrE6zC,+BAASqC,SAAW,SAAUjC,EAAU1S,EAAOC,GAAS,OAAOkU,+BAAS11B,KAAKX,MAAM40B,EAAU1S,EAAOC,IAKpGqS,+BAASrvC,UAAU0xC,SAAW,SAAU3U,EAAOC,GAAS,OAAOkU,+BAAS11B,KAAKX,MAAMrf,KAAMuhC,EAAOC,IAMhGqS,+BAASsC,OAAS,SAAUlC,EAAU1S,EAAOC,GAAS,OAAOmU,6BAAO31B,KAAKX,MAAM40B,EAAU1S,EAAOC,IAKhGqS,+BAASrvC,UAAU2xC,OAAS,SAAU5U,EAAOC,GAAS,OAAOmU,6BAAO31B,KAAKX,MAAMrf,KAAMuhC,EAAOC,IAM5FqS,+BAASh0B,MAAQ,YAAazZ,GAAQ,OAAOwvC,4BAAM51B,KAAKX,MAAMjZ,IAM9DytC,+BAASuC,QAAU,SAAUnC,GAAY,OAAO4B,8BAAQ71B,KAAKX,MAAM40B,IAKnEJ,+BAASrvC,UAAU4xC,QAAU,WAAc,OAAOP,8BAAQ71B,KAAKX,MAAMrf,OAMrE6zC,+BAASwC,QAAU,SAAUpC,GAAY,OAAO6B,8BAAQ91B,KAAKX,MAAM40B,IAKnEJ,+BAASrvC,UAAU6xC,QAAU,WAAc,OAAOP,8BAAQ91B,KAAKX,MAAMrf;;;;AAYrE+d,SAASgC,WAAW8zB,+BAAU,K,IAC9ByC,yCAAezC,+BC7mBf0C,yCAAeD,yCAAS/vC,OACvB,CACA9B,UAAW,mBAEXnH,EAAG,KAEHoH,OAAQ,SAAUpH,GAEjB,GAAe,UAAXA,EAAE+B,KACL,MAAM,IAAIX,MAAO,6BAElBsB,KAAKuE,OAAOywC,SAAStwC,OAAOpH,EAAE+J,KAAM/J,EAAE2wB,MAAO3wB,EAAE4wB,QAE/CluB,KAAK1C,EAAIA,EACT0C,KAAK1C,EAAEk5C,QAAUx2C;ACXnBy2C,yCAAeH,yCAAS/vC,OACvB,CACA9B,UAAW,iBAEXC,OAAQ,SAAUpH,GAEjB,GAAc,UAAVA,EAAE+B,KACL,MAAM,IAAIX,MAAO,8BAElBsB,KAAKuE,OAAOywC,SAAStwC,OAAO,KAAMpH,EAAE2wB,MAAO3wB,EAAE4wB,QAE7CluB,KAAK1C,EAAIA,EACT0C,KAAK1C,EAAEk5C,QAAUx2C,MAGlBmI,KAAM,SAAU+F,GAEf0iB,yCAAO4O,YAAYx/B,KAAK1C,EAAE2wB,MAAOjuB,KAAK1C,EAAE4wB,QACvCkM,IACoB,OAAhBp6B,KAAK1C,EAAEmiC,MAAyC,mBAAjBz/B,KAAK1C,EAAEmiC,KACzCz/B,KAAK1C,EAAEmiC,KAAKrF,EAAGp6B,KAAK1C,IAGpB88B,EAAE7G,UAAUvzB,KAAK1C,EAAE48B,OACnBE,EAAExF,SAAS,EAAG,EAAG50B,KAAK1C,EAAE2wB,MAAOjuB,KAAK1C,EAAE4wB,YAGvC+C,IACAjxB,KAAK8zC,SAAW7iB,EAChBjxB,KAAK+zC,OAAS/zC,KAAK8zC,SAAS7lB,MAC5BjuB,KAAKg0C,QAAUh0C,KAAK8zC,SAAS5lB,OAC7BhgB,UChBH,MAAMwoC,oCAAgBJ,yCAAS/vC,OAC9B,CACAwuC,YAAa,KACb4B,WAAY,EAEZjyC,OAAQ,SAAUqwC,EAAa4B,EAAY7F,EAASlrB,EAAIC,EAAI2Q,EAAIC,EAAIxI,EAAM,KAAMC,EAAO,MAEtFluB,KAAKuE,OAAOywC,SAAStwC,OAAO,KAAMupB,GAAS8mB,EAAY9mB,MAAOC,GAAU6mB,EAAY7mB,QAEpFluB,KAAK+0C,YAAcA,EACnB/0C,KAAK22C,WAAaA,EAElB32C,KAAK4lB,GAAKA,EACV5lB,KAAK6lB,GAAKA,EACV7lB,KAAK+zC,OAASvd,EACdx2B,KAAKg0C,QAAUvd,EAEfz2B,KAAK8zC,SAAWhD,K,IAIlB8F,yCAAeN,yCAAS/vC,OACvB,CACA9B,UAAW,cAEXoyC,WAAY,KACZ3T,UAAW,EAEXpM,WAAY,EACZC,YAAa,EAEbryB,OAAQ,SAAUpH,GAIjB,GAFA0C,KAAKuE,OAAOywC,SAAStwC,SAEN,SAAVpH,EAAE+B,MAA6B,UAAV/B,EAAE+B,KAC3B,MAAM,IAAIX,MAAO,mCAElB,IAAIo4C,EAASC,EAuCTC,EAASC,EArCb,GAAc,SAAV35C,EAAE+B,KACN,CACC,KAAK/B,EAAE45C,OAAOC,YAAgB75C,EAAE45C,OAAOhU,WAAc5lC,EAAE45C,OAAOpgB,YAAgBx5B,EAAE45C,OAAOE,QACtF,MAAM,IAAI14C,MAAOpB,EAAE+5C,QAAU,+EAEzB/5C,EAAE45C,OAAOC,aACb75C,EAAE45C,OAAOC,WAAa75C,EAAE2wB,OAEpB3wB,EAAE45C,OAAOngB,cACbz5B,EAAE45C,OAAOngB,YAAcz5B,EAAE+J,KAAK6mB,QAE/B4oB,EAAUx5C,EAAE+J,KAAK4mB,MAAQ3wB,EAAE45C,OAAOC,WAClCJ,EAAUz5C,EAAE2wB,MAAQ3wB,EAAE45C,OAAOC,gBAIxB75C,EAAE45C,SAAQ55C,EAAE45C,OAAS,IAErB55C,EAAE45C,OAAOpgB,aACbx5B,EAAE45C,OAAOpgB,WAAax5B,EAAE+J,KAAK,GAAG4mB,OAE5B3wB,EAAE45C,OAAOngB,cACbz5B,EAAE45C,OAAOngB,YAAcz5B,EAAE+J,KAAK,GAAG6mB,QAElC4oB,EAAUx5C,EAAE+J,KAAK,GAAGA,KAAK4mB,MAAQ3wB,EAAE45C,OAAOpgB,WAC1CigB,EAAUz5C,EAAE+J,KAAK,GAAG4mB,MAAQ3wB,EAAE45C,OAAOpgB,WAItC92B,KAAK82B,WAAcx5B,EAAE45C,OAAOpgB,WAAaggB,EACzC92C,KAAK+2B,YAAez5B,EAAE45C,OAAOngB,YAAc+f,EAG3C92C,KAAKiuB,MAAQ3wB,EAAE45C,OAAOpgB,WAAaigB,EACnC/2C,KAAKkuB,OAAS5wB,EAAE45C,OAAOngB,YAAcggB,EAKvB,SAAVz5C,EAAE+B,MAEL23C,EAAU5jC,IAAI9V,EAAE+J,KAAK4mB,MAAQjuB,KAAK82B,YAClCmgB,EAAUxpC,KAAK6pC,KAAKh6C,EAAE+J,KAAK6mB,OAASluB,KAAK+2B,aAErCz5B,EAAE45C,OAAOE,OACZp3C,KAAKkjC,UAAY5lC,EAAE45C,OAAOE,OAAO92C,OAEjCN,KAAKkjC,UAAY5lC,EAAE45C,OAAOhU,WAAc8T,EAAUC,IAInDD,EAAUC,EAAU,EACpBj3C,KAAKkjC,UAAY5lC,EAAE+J,KAAK/G,QAGzBN,KAAK1C,EAAIA,EACT0C,KAAK1C,EAAEk5C,QAAUx2C,KAGjBA,KAAK62C,WAAa,GAElB,IAAK,IAAIx2C,EAAI,EAAGA,EAAIL,KAAKkjC,UAAW7iC,IACpC,CACC,IAAIk3C,EAIHA,EAFGv3C,KAAK1C,EAAE45C,OAAOE,OAEH,IAAIV,oCAAe12C,KAAMK,EAAGL,KAAK1C,EAAE+J,KAChDrH,KAAK1C,EAAE45C,OAAOE,OAAO/2C,GAAG,GAAGy2C,EAAS92C,KAAK1C,EAAE45C,OAAOE,OAAO/2C,GAAG,GAAGy2C,EAAS92C,KAAK1C,EAAE45C,OAAOE,OAAO/2C,GAAG,GAAGy2C,EAAS92C,KAAK1C,EAAE45C,OAAOE,OAAO/2C,GAAG,GAAGy2C,EACvI92C,KAAK1C,EAAE45C,OAAOE,OAAO/2C,GAAG,GAAG02C,EAAS/2C,KAAK1C,EAAE45C,OAAOE,OAAO/2C,GAAG,GAAG02C,GAExC,GAAhB/2C,KAAKg3C,QAEC,IAAIN,oCAAe12C,KAAMK,EAAGL,KAAK1C,EAAE+J,KAChDhH,EAAK22C,EAAWh3C,KAAK82B,WAAY1jB,IAAI/S,EAAI22C,GAAWh3C,KAAK+2B,YAAa/2B,KAAK82B,WAAY92B,KAAK+2B,aAI/E,IAAI2f,oCAAe12C,KAAMK,EAAGL,KAAK1C,EAAE+J,KAAKhH,GAAGgH,KACxD,EAAG,EAAGrH,KAAK82B,WAAY92B,KAAK+2B,aAG9B/2B,KAAK62C,WAAWx2C,GAAKk3C,IASvBrC,SAAU,SAAUyB,GAEnB,GAAIA,EAAa,GAAKA,GAAc32C,KAAKkjC,UACxC,MAAM,IAAIxkC,MAAO,2BAElB,OAAOsB,KAAK62C,WAAWF,IAOxB5E,WAAY,WAEX,OAAO/xC,KAAKk1C,SAAS,GAAGnD,cAOzBmC,YAAa,WAEZ,OAAOl0C,KAAKk1C,SAAS,MC9KvB72C,cAAA,SA2BO,MAAMm5C,0CAAYlB,yCAAS/vC,OACjC,CACA9B,UAAW,YAEXgzC,IAAK,KAAMC,MAAO,EAAGC,MAAO,KAC5BC,MAAO,KAEP5W,IAAK,EAAG6W,cAAe,EAAGze,KAAM,EAEhC2J,aAAa,EAEb+U,UAAU,EACVC,SAAS,EAETC,iBAAkB,KAClBC,wBAAyB,KACzBC,wBAAyB,KAEzBC,cAAe,KAEfzzC,OAAQ,SAAU0zC,EAAMX,EAAKzW,GAE5BhhC,KAAKuE,OAAOywC,SAAStwC,OAAO0zC,EAAKrG,aAAcqG,EAAKnqB,MAAOmqB,EAAKlqB,QAEhEluB,KAAKo4C,KAAOA,EACZp4C,KAAK43C,MAAQp2B,yCAAKxB,KAAKX,QAEvBrf,KAAKy3C,IAAMA,EACXz3C,KAAK03C,MAAQ,EACb13C,KAAK23C,MAAQ,KAEb33C,KAAK+iC,aAAc,EACnB/iC,KAAK83C,UAAW,EAChB93C,KAAK+3C,SAAU,EAEf/3C,KAAKg4C,iBAAmB,KACxBh4C,KAAKi4C,wBAA0B,KAC/Bj4C,KAAKk4C,wBAA0B,KAC/Bl4C,KAAKm4C,cAAgB,KAErBn4C,KAAKghC,IAAMA,EACXhhC,KAAKq4C,OAAQr4C,KAAKy3C,IAAIzW,KAAOhhC,KAAKghC,MAGnCr8B,OAAQ,WAEP3E,KAAK43C,MAAMt4B,OAEPtf,KAAKi4C,yBACRj4C,KAAKi4C,wBAAwB34B,OAE1Btf,KAAKk4C,yBACRl4C,KAAKk4C,wBAAwB54B,QAG/B+4B,OAAQ,SAAUrX,GAKjB,OAHAhhC,KAAK63C,cAAgB,EAAM7W,EAC3BhhC,KAAKo5B,KAAO,EAELp5B,MAGRmoC,OAAQ,SAAUlpC,EAAM,MAEvB,OAAc,OAAVA,EACIe,KAAK+3C,SAEb/3C,KAAK+3C,QAAU94C,EACRe,OAGRs4C,aAAc,SAAU5Q,GAGvB,OADA1nC,KAAKo5B,MAAQsO,EACN1nC,MAGRu4C,WAAY,SAAUrqC,GAGrB,OADAlO,KAAKg4C,iBAAmB9pC,EACjBlO,MAMRmqC,KAAM,SAAUj8B,EAAU9G,EAAQ,MAQjC,OANiB,IAAb8G,GAAsBlO,KAAKg4C,mBAAqBh4C,KAAKw4C,eAExDx4C,KAAKi4C,wBAAwB5rC,QAC7BrM,KAAKk4C,wBAAwB7rC,SAGzB6B,GAEDlO,KAAKg4C,mBAAqBh4C,KAAKw4C,eAElCx4C,KAAKg4C,iBAAmBh4C,KAAKw4C,aAC7Bx4C,KAAKi4C,wBAA0Bz2B,yCAAKxB,KAAKX,QACzCrf,KAAKk4C,wBAA0B12B,yCAAKxB,KAAKX,SAG1Crf,KAAKi4C,wBAAwBp1C,KAAKqL,GAClClO,KAAKk4C,wBAAwBr1C,KAAKuE,GAC3BpH,MAXeA,MAcvBw4C,aAAc,WAEb,IAAKx4C,KAAKi4C,wBAAwB33C,OACjC,OAAO,EAER,IAAI8G,EAAUpH,KAAKk4C,wBAAwBlrC,QAC3ChN,KAAKi4C,wBAAwBjrC,OAA7BhN,CAAqCA,KAAMoH,IAG5C68B,QAAS,SAAUhiC,GAGlB,OADAjC,KAAKm4C,cAAgBl2C,EACdjC,MAGRy4C,SAAU,SAAUp4C,GAGnB,OADAL,KAAK03C,MAAQtkC,IAAI/S,GAAKL,KAAKy3C,IAAI53B,MAAMvf,OAC9BN,MAGRk1C,SAAU,SAAUwD,GAEnB,OAAsB,IAAfA,EAAuB14C,KAAK03C,OAAS13C,KAAKy3C,IAAI53B,MAAMvf,OAAO,GAAMN,KAAK03C,OAG9EiB,UAAW,WAEV,OAAO34C,KAAKy3C,IAAI53B,MAAMvf,QAOvB8zC,MAAO,SAAUha,EAAGxU,EAAIC,EAAIkuB,EAAQC,EAASK,EAAIC,EAAIC,EAAQC,EAASC,EAAO,KAAMC,EAAQ,MAO1F,GAJK10C,KAAK+3C,UACT/3C,KAAKo5B,MAAQp5B,KAAK+iC,cAAgBpD,yCAAOoD,YAAc,EAAIpD,yCAAOkD,YAG/D7iC,KAAKo5B,KAAO,EAEf,YADAp5B,KAAK+iC,YAAcpD,yCAAOoD,aAkB3B,GAbmB,OAAf/iC,KAAK23C,OAAkB33C,KAAK+iC,cAAgBpD,yCAAOoD,cAEtD/iC,KAAKy3C,IAAMz3C,KAAK23C,MAChB33C,KAAK03C,MAAQ,EACb13C,KAAK23C,MAAQ,KAEb33C,KAAKo5B,KAAO,EACZp5B,KAAK83C,UAAW,EAEhB93C,KAAKq4C,OAAQr4C,KAAKy3C,IAAIzW,KAAOhhC,KAAKghC,MAI/BhhC,KAAKo5B,MAAQp5B,KAAK63C,eAAiB73C,KAAK+iC,cAAgBpD,yCAAOoD,cAAgB/iC,KAAK83C,SACxF,CACC,MAAMnB,EAAa32C,KAAK03C,MAExB13C,KAAKo5B,MAAQp5B,KAAK63C,cAClB73C,KAAK03C,QAGD13C,KAAK03C,QAAU13C,KAAKy3C,IAAI53B,MAAMvf,SAG5BN,KAAKy3C,IAAImB,KAWb54C,KAAK03C,MAAQ,GATb13C,KAAK83C,UAAW,EAEZ93C,KAAKg4C,mBAE4B,IAAhCh4C,KAAKg4C,iBAAiBh4C,QACzBA,KAAKg4C,iBAAmB,OAOvBh4C,KAAK43C,MAAMt3C,QACdN,KAAK64C,IAAI74C,KAAK43C,MAAM5qC,SAAS,IAI3BhN,KAAKm4C,gBAE8D,IAAlEn4C,KAAKm4C,cAAcxB,EAAY32C,KAAKy3C,IAAI53B,MAAMvf,OAAO,EAAGN,QAC3DA,KAAKm4C,cAAgB,MAKxB,IAAI96C,EAAI2C,KAAKy3C,IAAI53B,MAAO7f,KAAK03C,QAAU13C,KAAKy3C,IAAI53B,MAAMvf,OAASN,KAAK03C,MAAM,EAAI13C,KAAK03C,OAGnF,IAAK,IAAIr3C,EAAI,EAAGA,EAAIhD,EAAEiD,OAAQD,IAC9B,CACC,IAAIy4C,EAAQ94C,KAAKo4C,KAAKlD,SAAS73C,EAAEgD,IACjCy4C,EAAM1E,MAAMha,EAAG0e,EAAMlzB,GAAIkzB,EAAMjzB,GAAIizB,EAAM/E,OAAQ+E,EAAM9E,QAASK,EAAIC,EAAIC,EAAQC,EAASC,EAAQC,GAIlG10C,KAAK+iC,YAAcpD,yCAAOoD,aAG3BgP,WAAY,WAEX,OAAO/xC,KAAKo4C,KAAKrG,cAGlBmC,YAAa,WAEZ,OAAOl0C,MAGR+4C,QAAS,WAER/4C,KAAKmoC,QAAQ,GACbnoC,KAAKy/B,KAAM,KAAM,EAAG,IAGrBuZ,gBAAiB,WAEhB,OAAsB,OAAfh5C,KAAK23C,MAAiB33C,KAAKy3C,IAAIj4C,KAAOQ,KAAK23C,MAAMn4C,MAGzDq5C,IAAK,SAAUI,EAASC,GAAO,GAE9B,QAAIl5C,KAAKy3C,IAAIj4C,OAASy5C,IAAYj5C,KAAK83C,WAAuB,IAAXoB,KAGnDl5C,KAAK23C,MAAQ33C,KAAKo4C,KAAKxoC,EAAE6nC,IAAIwB,GAC7Bj5C,KAAK83C,UAAW,GAET,IAGRqB,KAAM,SAAU35C,EAAM05C,GAAO,GAG5B,OADAl5C,KAAK64C,IAAIr5C,EAAM05C,GACRl5C,MAGRo5C,SAAU,SAAU1yC,GAEnB,IAAK8a,yCAAKT,WAAWra,GACpB,MAAM,IAAIhI,MAAM,mDAEC,MAAdsB,KAAK43C,OACR53C,KAAK43C,MAAMvrC,QAAQiT,OAEpBtf,KAAK43C,MAAQlxC,EACb1G,KAAK64C,IAAI74C,KAAK43C,MAAM5qC,SAAS,IAG9Bb,QAAS,SAAU8sC,EAASzvC,GAAM,GAEjC,IAAIiuC,EAAMz3C,KAAKy3C,IAEX4B,EAAWr5C,KAAK43C,MAAMt3C,OAAS,EAAIN,KAAK43C,MAAM53C,KAAK43C,MAAMt3C,OAAO,GAAKm3C,EAAIj4C,KAE7E,OAAIi4C,EAAIj4C,OAASy5C,GAAWxB,EAAImB,KACxB54C,KAEJq5C,IAAaJ,GAAYzvC,EAGzBiuC,EAAImB,MAAQ54C,KAAK83C,UAEpB93C,KAAK64C,IAAII,GAAS,GACXj5C,OAGRA,KAAK43C,MAAM/0C,KAAKo2C,GACTj5C,MATCA,QAaVge,yCAAS+B,WAAWy3B,2C,IAGpB8B,yCAAe1C,yCAAYrwC,OAC1B,CACA9B,UAAW,uBAEX80C,gBAAiB,KACjBC,WAAY,KAEZl8C,EAAG,KACHsS,EAAG,KAEHlL,OAAQ,SAAUpH,GAEjB,IAAKA,EAAE86C,KAAM,MAAM,IAAI15C,MAAO,oCAE9BsB,KAAKuE,OAAOk1C,YAAY/0C,OAAQpH,GAEhC0C,KAAK1C,EAAIA,EACT0C,KAAK1C,EAAEk5C,QAAUx2C,KAEjB,IAAI3C,EAAI2C,KAAK4P,EAAI5P,KAAK1C,EAAE86C,KAExB,GAAI/6C,EAAEq8C,YAAa,OAMnB,GAJKr8C,EAAE6K,MAAK7K,EAAE6K,IAAM,OACf7K,EAAEo6C,MAAKp6C,EAAEo6C,IAAM,KAGfp6C,EAAEo6C,IAAIp6C,EAAE6K,OAAkB,OAAT7K,EAAE6K,KAAyB,WAAT7K,EAAE6K,KAC1C,CACC,IAAIy9B,EAAI,CAAEiT,KAAgB,OAATv7C,EAAE6K,IAA8B2X,MAAO,IAExD,IAAK,IAAIxf,EAAI,EAAGA,EAAIL,KAAKkjC,UAAW7iC,IACnCslC,EAAE9lB,MAAMhd,KAAK,CAACxC,IAGfhD,EAAEo6C,IAAIp6C,EAAE6K,KAAOy9B,EAGhB,IAAKtoC,EAAEo6C,IAAIp6C,EAAE6K,KACZ,MAAM,IAAIxJ,MAAO,+BAAiCrB,EAAE6K,KAEhD7K,EAAE2jC,MAAK3jC,EAAE2jC,IAAM,IAEpB3jC,EAAE6K,IAAM7K,EAAEo6C,IAAIp6C,EAAE6K,KAEhB,IAAIyuC,EAAa,EAEjB,IAAK,IAAIt2C,KAAKhD,EAAEo6C,IAOf,GALAp6C,EAAEo6C,IAAIp3C,GAAGb,KAAOa,EAEXhD,EAAEo6C,IAAIp3C,GAAGu4C,OACbv7C,EAAEo6C,IAAIp3C,GAAGu4C,MAAO,GAEa,iBAAnBv7C,EAAEo6C,IAAIp3C,GAAGwf,MACpB,CACC,IAAIjQ,EAAGC,EAAGyI,EAEV,IAAmC,GAA/Bjb,EAAEo6C,IAAIp3C,GAAGwf,MAAMre,QAAQ,KAC3B,CACCoO,EAAIvS,EAAEo6C,IAAIp3C,GAAGwf,MAAMvY,MAAM,KACzBjK,EAAEo6C,IAAIp3C,GAAGwf,MAAQ,GAEjB,IAAK,IAAI3c,KAAK0M,EACbvS,EAAEo6C,IAAIp3C,GAAGwf,MAAMhd,KAAK,CAACuQ,IAAIxD,EAAE1M,WAExB,IAAmC,GAA/B7F,EAAEo6C,IAAIp3C,GAAGwf,MAAMre,QAAQ,KAS/B,GAPA8W,EAAIjb,EAAEo6C,IAAIp3C,GAAGwf,MAAMvY,MAAM,KAEzBsI,EAAIwD,IAAIkF,EAAE,IACVzI,EAAIuD,IAAIkF,EAAE,IAEVjb,EAAEo6C,IAAIp3C,GAAGwf,MAAQ,GAEbjQ,EAAIC,EACP,IAAKyI,EAAI1I,EAAG0I,GAAKzI,EAAGyI,IACnBjb,EAAEo6C,IAAIp3C,GAAGwf,MAAMhd,KAAK,CAACyV,SAGtB,IAAKA,EAAI1I,EAAG0I,GAAKzI,EAAGyI,IACnBjb,EAAEo6C,IAAIp3C,GAAGwf,MAAMhd,KAAK,CAACyV,SAQvB,IAHA1I,EAAIwD,IAAI/V,EAAEo6C,IAAIp3C,GAAGwf,OACjBxiB,EAAEo6C,IAAIp3C,GAAGwf,MAAQ,GAEVjQ,KAAKvS,EAAEo6C,IAAIp3C,GAAGwf,MAAMhd,KAAK,CAAC8zC,MAGlCt5C,EAAEo6C,IAAIp3C,GAAG4Q,MAAQ5T,EAAEo6C,IAAIp3C,GAAGwf,MAAMvf,OAIlCjD,EAAEq8C,aAAc,GAGjBC,mBAAoB,SAAUC,EAAW,MAExC,OAAwB,OAApB55C,KAAKw5C,YAERx5C,KAAKw5C,WAAahC,0CAAUx3B,KAAKX,MAAMrf,KAAM45C,EAAa55C,KAAK4P,EAAE6nC,IAAImC,GAAc55C,KAAK4P,EAAE1H,IAAKlI,KAAK4P,EAAEoxB,KACtGhhC,KAAKw5C,WAAWh6B,cAAa,GAEtBxf,KAAKw5C,YAGNx5C,KAAKw5C,WAAWL,KAAKS,GAA0B55C,KAAK4P,EAAE1H,IAAI1I,OAGlEq6C,aAAc,SAAUD,EAAW,KAAM5Y,EAAI,MAE5C,OAAOwW,0CAAUx3B,KAAKX,MAAMrf,KAAM45C,EAAa55C,KAAK4P,EAAE6nC,IAAImC,GAAc55C,KAAK4P,EAAE1H,IAAK84B,GAAOhhC,KAAK4P,EAAEoxB,MAGnG8Y,YAAa,SAAUt6C,GAEtB,OAAOQ,KAAK4P,EAAE6nC,IAAIj4C,IAGnB00C,YAAa,WAKZ,OAH6B,OAAzBl0C,KAAKu5C,kBACRv5C,KAAKu5C,gBAAkBv5C,KAAK65C,gBAEtB75C,KAAKu5C,mBCncd1hC,OAAAxZ,cAAA;AAYA07C,yCAAeliC,OAAAK,MAAM3R,OACpB,CACA7B,OAAQ,SAAUpH,GAEjB,GAAc,SAAVA,EAAE+B,OAAoB/B,EAAEi+B,KAC3B,MAAM,IAAI78B,MAAO,kCAEbpB,EAAEi+B,KAAK4b,aACX75C,EAAEi+B,KAAK4b,WAAa75C,EAAE2wB,OAEvB,IAAI6oB,EAAUx5C,EAAE+J,KAAK4mB,MAAQ3wB,EAAEi+B,KAAK4b,WAChCJ,EAAUz5C,EAAE2wB,MAAQ3wB,EAAEi+B,KAAK4b,WAE/Bn3C,KAAKg6C,YAAe18C,EAAEi+B,KAAK0e,UAAYnD,EACvC92C,KAAKk6C,aAAgB58C,EAAEi+B,KAAK4e,WAAarD,EAEzC92C,KAAKi6C,UAAa38C,EAAEi+B,KAAK0e,UAAYlD,EACrC/2C,KAAKm6C,WAAc78C,EAAEi+B,KAAK4e,WAAapD,EAEvC/2C,KAAKo6C,UAAY98C,EAAEi+B,KAAK6e,UAAY,GAAKrD,EACzC/2C,KAAKq6C,UAAY/8C,EAAEi+B,KAAK8e,UAAY,GAAKtD,EAEzC/2C,KAAKs6C,UAAYh9C,EAAEi+B,KAAK+e,UAAY,GAAKvD,EACzC/2C,KAAKu6C,UAAYj9C,EAAEi+B,KAAKgf,UAAY,GAAKxD,EAEzC/2C,KAAKw6C,YAAcl9C,EAAEi+B,KAAKif,cAAe,EAEzC,IAAIC,EAAOrnC,IAAI9V,EAAEi+B,KAAK4b,WAAa75C,EAAEi+B,KAAK0e,WAE1Cj6C,KAAK1C,EAAIA,EACT0C,KAAK1C,EAAEk5C,QAAUx2C,KAEjB,IAAIzC,EAAID,EAAEi+B,KAAKmf,QAAQp6C,OACnBkH,EAAI,EACJ4b,EAAI,EAIR,IAFApjB,KAAK26C,UAAY,GAEVnzC,EAAIjK,GACX,CACC,IAAImX,EAAI,EAER,IAAK,IAAIrU,EAAI,EAAGA,EAAIo6C,GAAQjzC,EAAIjK,EAAG8C,IACnC,CACC,IAAIiY,EAAIhb,EAAEi+B,KAAKmf,QAAQlzC,KAEvBxH,KAAK26C,UAAUriC,GAAK,CAAEuY,QAAQ,EAAOnc,EAAGA,EAAG0O,EAAGA,EAAG62B,UAAWj6C,KAAKi6C,UAAWD,YAAah6C,KAAKg6C,YAAaM,SAAU,GAErH5lC,GAAK1U,KAAKg6C,YAGX52B,GAAKpjB,KAAKk6C,aAMX,GAHM,MAAOl6C,KAAK26C,YACjB36C,KAAK26C,UAAU,KAAO,CAAE9pB,QAAQ,EAAMopB,UAAW7mC,IAAqC,GAAhCpT,KAAKi6C,UAAYj6C,KAAKo6C,UAAY,GAAIJ,YAAah6C,KAAKg6C,YAAaM,SAAU,IAEjIh9C,EAAEi+B,KAAKqf,OAAZ,CAEAr9C,EAAID,EAAEi+B,KAAKqf,OAAOt6C,OAElB,IAAK,IAAID,EAAI,EAAGA,EAAI9C,EAAG8C,GAAK,EAC5B,CACC,IAAIo0B,EAAIn3B,EAAEi+B,KAAKqf,OAAOv6C,EAAE,GAAK02C,EACzB/kC,EAAI1U,EAAEi+B,KAAKqf,OAAOv6C,GAEJ,iBAAP2R,IACVA,EAAIuB,OAAOC,aAAaxB,IAEzB,IAAK,IAAI9O,EAAI,EAAGA,EAAI8O,EAAE1R,OAAQ4C,IAEzB8O,EAAE9O,KAAMlD,KAAK26C,YAChB36C,KAAK26C,UAAU3oC,EAAE9O,IAAIo3C,SAAW7lB,EAAIz0B,KAAK26C,UAAU3oC,EAAE9O,IAAI+2C,cAK7DY,SAAU,SAAUzgB,EAAG1lB,EAAG0O,EAAGhf,GAE5B,IAAI7G,EAAI6G,EAAK9D,OAETw6C,GAAK,EAAG96C,KAAKo6C,SAAWp6C,KAAKs6C,SAKjC,GAHA5lC,GAAK1U,KAAKo6C,SACVh3B,GAAKpjB,KAAKq6C,SAELr6C,KAAKw6C,YAcV,CACC,IAAK,IAAIn6C,EAAI,EAAGA,EAAI9C,EAAE,EAAG8C,IACzB,CACC,IAAIiY,EAAItY,KAAK26C,UAAUv2C,EAAK/D,IACvBiY,IAEL5D,GAAK4D,EAAE2hC,UAAYa,GAGpB,IAAK,IAAI33C,EAAI5F,EAAE,EAAG4F,GAAK,EAAGA,IAC1B,CACC,IAAImV,EAAItY,KAAK26C,UAAUv2C,EAAKjB,IACvBmV,IAEAA,EAAEuY,QACNuJ,EAAE7D,UAAWv2B,KAAK1C,EAAE+J,KAAMiR,EAAE5D,EAAG4D,EAAE8K,EAAG9K,EAAE0hC,YAAah6C,KAAKk6C,aAAcxlC,EAAG0O,EAAG9K,EAAE2hC,UAAWj6C,KAAKm6C,WAAY,KAAM,KAAM7hC,EAAE2hC,UAAWj6C,KAAKm6C,YAEzIzlC,GAAK4D,EAAE2hC,UAAYa,EAAKxiC,EAAEgiC,gBA7B3B,IAAK,IAAIj6C,EAAI,EAAGA,EAAI9C,EAAG8C,IACvB,CACC,IAAIiY,EAAItY,KAAK26C,UAAUv2C,EAAK/D,IACvBiY,IAEAA,EAAEuY,QACNuJ,EAAE7D,UAAWv2B,KAAK1C,EAAE+J,KAAMiR,EAAE5D,EAAG4D,EAAE8K,EAAG9K,EAAE0hC,YAAah6C,KAAKk6C,aAAcxlC,EAAG0O,EAAG9K,EAAE2hC,UAAWj6C,KAAKm6C,WAAY,KAAM,KAAM7hC,EAAE2hC,UAAWj6C,KAAKm6C,YAEzIzlC,GAAK4D,EAAE2hC,UAAYa,EAAKxiC,EAAEgiC,YA0B7BS,aAAc,SAAU32C,GAEvB,IAAI7G,EAAI6G,EAAK9D,OACToU,EAAI,EAEJomC,GAAK,EAAG96C,KAAKo6C,SAAWp6C,KAAKs6C,SAEjC,IAAK,IAAIj6C,EAAI,EAAGA,EAAI9C,EAAG8C,IACvB,CACC,IAAIiY,EAAItY,KAAK26C,UAAUv2C,EAAK/D,IACvBiY,IAEL5D,GAAK4D,EAAE2hC,UAAYa,EAAKxiC,EAAEgiC,UAG3B,OAAO5lC,GAGRsmC,cAAe,SAAU52C,GAExB,OAAOpE,KAAKm6C,WAAa,EAAEn6C,KAAKq6C,SAAWr6C,KAAKu6C,YC1JlD1iC,OAAAxZ,cAAA,SCAAwZ,OAAAxZ,cAAA,SASA,MAAM48C,gCAAY,GAIlB,IAAIC,gCAAW;;;;;kBA4Cf19C;OAAOijC,OAAOwa,gCACd,CAQCE,uBAAuB,EASvBC,WAAW,EAQX/5B,OAAQ,SASRg6B,UAAU,EAMVnE,OAAQ,SAAUxlB,GAEJ,OAATA,GACHl0B,OAAOijC,OAAOzgC,KAAM0xB,IAoBtB4pB,KAAM,SAAU50C,EAAM60C,EAAkBC,EAAkBC,EAAShvC,GAElE,IAAKgvC,EACL,CACCA,EAAUj+C,OAAO6M,KAAK3D,GAEtB,IAAK,IAAIrG,KAAKo7C,EAEP,aAAc/0C,EAAK+0C,EAAQp7C,MAChCqG,EAAK+0C,EAAQp7C,IAAIq7C,QAAU7jC,OAAA6I,KAAK/d,MAAM+D,EAAK+0C,EAAQp7C,MAGrDoM,EAAQ,EAGT,KAAOA,EAAQgvC,EAAQn7C,QAAW,aAAcoG,EAAK+0C,EAAQhvC,KAC5DA,IAKD,GAHI8uC,GACHA,EAAkB9uC,EAAOgvC,EAAQn7C,OAAQmM,EAAQgvC,EAAQn7C,OAAQmM,EAAQgvC,EAAQn7C,OAASm7C,EAAQhvC,GAAS,MAExGA,GAASgvC,EAAQn7C,OAKpB,YAHIk7C,GACHA,EAAiB90C,IAKnB,IAGI0qB,EAAKuqB,EAAIC,EAAIC,EAAIC,EAHjBx+C,EAAIoJ,EAAK+0C,EAAQhvC,IAKrB,OAJAnP,EAAE+5C,QAAUoE,EAAQhvC,GAIZnP,EAAE+B,MAET,IAAK,QACJ/B,EAAE+J,KAAO,IAAI6pB,MACb5zB,EAAE+J,KAAK8pB,OAAS/iB,iBAEf,MAAM2tC,EAAQz+C,EAAE+J,KAAK4mB,MAAQ3wB,EAAE+J,KAAK6mB,OAEhC5wB,EAAEqlB,QACLrlB,EAAE2wB,MAAQ7a,IAAI9V,EAAE+J,KAAK4mB,MAAM3wB,EAAEqlB,OAC7BrlB,EAAE4wB,OAAS9a,IAAI9V,EAAE+J,KAAK6mB,OAAO5wB,EAAEqlB,QAG3BrlB,EAAEuH,eAAe,gBACrBvH,EAAE0+C,WAAa,GAEX1+C,EAAE2wB,OAAU3wB,EAAE4wB,OAKV5wB,EAAE2wB,QAAU3wB,EAAE4wB,OAEtB5wB,EAAE4wB,OAAS9a,IAAI9V,EAAE2wB,MAAQ8tB,IAEhBz+C,EAAE2wB,OAAS3wB,EAAE4wB,SAEtB5wB,EAAE2wB,MAAQ7a,IAAI2oC,EAAQz+C,EAAE4wB,UATxB5wB,EAAE2wB,MAAQ3wB,EAAE+J,KAAK4mB,MACjB3wB,EAAE4wB,OAAS5wB,EAAE+J,KAAK6mB,QAed5wB,EAAEuH,eAAe,YACrBvH,EAAE+jB,OAAU/jB,EAAEuH,eAAe,eAAmD,IAAhBvH,EAAE89C,UAAqB,UAA3CH,gCAAU55B,QAElD/jB,EAAEuH,eAAe,eACrBvH,EAAE89C,UAAYH,gCAAUG,WAEpB99C,EAAEuH,eAAe,cACrBvH,EAAE+9C,SAAWJ,gCAAUI,UAEnB/9C,EAAE+J,KAAK4mB,OAAS3wB,EAAE2wB,OAAS3wB,EAAE+J,KAAK6mB,QAAU5wB,EAAE4wB,QAA0B,GAAhB5wB,EAAE0+C,aAAqC,IAAf1+C,EAAE+9C,WAGtF/9C,EAAE+J,WAAa4zC,gCAAUgB,YAAa3+C,EAAGA,EAAE2wB,OAAS3wB,EAAE0+C,YAAc1+C,EAAE89C,UAAYzb,yCAAOuH,mBAAqBvH,yCAAOkC,cAAevkC,EAAE4wB,QAAU5wB,EAAE0+C,YAAc1+C,EAAE89C,UAAYzb,yCAAOuH,mBAAqBvH,yCAAOkC,cAAevkC,EAAE89C,WAAW,IAI9O99C,EAAE+wB,OAAS/wB,EAAE+J,KAAK4mB,MAAQ3wB,EAAE2wB,MAE5B3wB,EAAE+J,KAAKgnB,OAAS/wB,EAAE+wB,OAClB/wB,EAAE+J,KAAKga,OAAS/jB,EAAE+jB,OAClB/jB,EAAE+J,KAAK8mB,YAAc7wB,EAAE2wB,MACvB3wB,EAAE+J,KAAK+mB,aAAe9wB,EAAE4wB,OAEpB5wB,EAAEuH,eAAe,WAAavH,EAAEixB,OAAS,IAC5CjxB,EAAE+J,KAAKknB,OAASjxB,EAAEixB,QAGnBoR,yCAAOsC,kBAAkB1L,UAAUj5B,EAAE+J,KAAM,EAAG,GAC9Cs4B,yCAAOC,SAAS/F,aAAav8B,EAAE+J,MAE/B4zC,gCAAUiB,SAAUx1C,EAAM+0C,EAAQhvC,IAAQ,KACzCwuC,gCAAUK,KAAM50C,EAAM60C,EAAkBC,EAAkBC,EAAShvC,EAAM,OAI3EnP,EAAE+J,KAAK2iC,QAAU,WAChBxzB,QAAQ+I,MAAO,0BAA4BjiB,EAAE+5C,UAG9C/5C,EAAE+J,KAAK+pB,IAAM9zB,EAAE8zB,IAAM,MAAQ3jB,KAAK6xB,SAClC,MAED,IAAK,SAMJ,GALAlO,EAAM9zB,EAAE8zB,IACRuqB,EAAKvqB,EAAI5vB,QAAQ,KACjBo6C,EAAKxqB,EAAI+qB,YAAY,KACrBN,EAAKD,EAAKD,EAAK,GAEL,GAANA,EAGH,YADAnlC,QAAQ+I,MAAO,mBAAqBjiB,EAAE+5C,QAAU,gEAIjD,IAAK/5C,EAAE2T,MAGN,YADAuF,QAAQ+I,MAAO,mBAAqBjiB,EAAE+5C,QAAU,iDAIjD/5C,EAAE8+C,GAAK,EACP9+C,EAAE+J,KAAO,GAETy0C,EAAK,WAEJ,GAAIx+C,EAAE8+C,IAAM9+C,EAAE2T,MAMb,YAJAgqC,gCAAUiB,SAAUx1C,EAAM+0C,EAAQhvC,IAAQ,KACzCwuC,gCAAUK,KAAM50C,EAAM60C,EAAkBC,EAAkBC,EAAShvC,EAAQ,MAO7E,IAAIW,EAAM,CAAE/N,KAAM,QAAS4uB,MAAO3wB,EAAE2wB,MAAOC,OAAQ5wB,EAAE4wB,OAAQvL,MAAOrlB,EAAEqlB,OAEtEvV,EAAIgkB,IAAM9zB,EAAE8zB,IAAIjyB,OAAO,EAAGw8C,IAAQr+C,EAAE8+C,KAAQ3uC,KAAKC,IAAI,GAAGmuC,IAAKj8B,QAAQi8B,GAAI18C,OAAO,GAAK7B,EAAE8zB,IAAIjyB,OAAOy8C,EAAG,GACrGxuC,EAAI/F,KAAO,IAAI6pB,MACf9jB,EAAIiqC,QAAU/5C,EAAE+5C,QAAU,KAAO/5C,EAAE8+C,GAAK,GAEpCb,GACHA,EAAkB9uC,EAAOgvC,EAAQn7C,OAAQmM,EAASgvC,EAAQn7C,QAAYhD,EAAE8+C,GAAG,GAAG9+C,EAAE2T,OAAQ,EAAIwqC,EAAQn7C,QAAShD,EAAE+5C,QAAU,KAAO/5C,EAAE8+C,GAAG,IAEtIhvC,EAAI/F,KAAK8pB,OAAS/iB,iBAEjB,IAAI2tC,EAAQ3uC,EAAI/F,KAAK4mB,MAAQ7gB,EAAI/F,KAAK6mB,OAElC9gB,EAAIuV,QAEPvV,EAAI6gB,MAAQ7a,IAAIhG,EAAI/F,KAAK4mB,MAAM7gB,EAAIuV,OACnCvV,EAAI8gB,OAAS9a,IAAIhG,EAAI/F,KAAK6mB,OAAO9gB,EAAIuV,QAGjCvV,EAAI6gB,OAAU7gB,EAAI8gB,OAKd9gB,EAAI6gB,QAAU7gB,EAAI8gB,OAE1B9gB,EAAI8gB,OAAS9a,IAAIhG,EAAI6gB,MAAQ8tB,IAEpB3uC,EAAI6gB,OAAS7gB,EAAI8gB,SAE1B9gB,EAAI6gB,MAAQ7a,IAAI2oC,EAAQ3uC,EAAI8gB,UAT5B9gB,EAAI6gB,MAAQ7gB,EAAI/F,KAAK4mB,MACrB7gB,EAAI8gB,OAAS9gB,EAAI/F,KAAK6mB,QAWX,GAAR5wB,EAAE8+C,KAEL9+C,EAAE++C,OAASjvC,EAAI/F,KAAK4mB,MACpB3wB,EAAEg/C,QAAUlvC,EAAI/F,KAAK6mB,OAEhB5wB,EAAEuH,eAAe,YACrBvH,EAAE+jB,OAAU/jB,EAAEuH,eAAe,eAAmD,IAAhBvH,EAAE89C,UAAqB,UAA3CH,gCAAU55B,QAElD/jB,EAAEuH,eAAe,eACrBvH,EAAE89C,UAAYH,gCAAUG,WAEpB99C,EAAEuH,eAAe,cACrBvH,EAAE+9C,SAAWJ,gCAAUI,WAGzBjuC,EAAIguC,UAAY99C,EAAE89C,UAClBhuC,EAAIiU,OAAS/jB,EAAE+jB,OACfjU,EAAIiuC,SAAW/9C,EAAE+9C,SAEZjuC,EAAI/F,KAAK4mB,OAAS7gB,EAAI6gB,OAAS7gB,EAAI/F,KAAK6mB,QAAU9gB,EAAI8gB,SAA4B,IAAjB9gB,EAAIiuC,WAGzEjuC,EAAI/F,WAAa4zC,gCAAUgB,YAAa7uC,EAAKA,EAAI6gB,OAAS3wB,EAAE89C,UAAYzb,yCAAOuH,mBAAqBvH,yCAAOkC,aAAcz0B,EAAI8gB,QAAU9gB,EAAIguC,UAAYzb,yCAAOuH,mBAAqBvH,yCAAOkC,aAAcz0B,EAAIguC,WAAW,IAIxNhuC,EAAIihB,OAASjhB,EAAI/F,KAAK4mB,MAAQ7gB,EAAI6gB,MAElC7gB,EAAI/F,KAAKgnB,OAASjhB,EAAIihB,OACtBjhB,EAAI/F,KAAKga,OAASjU,EAAIiU,OACtBjU,EAAI/F,KAAK8mB,YAAc/gB,EAAI6gB,MAC3B7gB,EAAI/F,KAAK+mB,aAAehhB,EAAI8gB,OAExB5wB,EAAEuH,eAAe,WAAavH,EAAEixB,OAAS,IAC5CnhB,EAAI/F,KAAKknB,OAASjxB,EAAEixB,QAET,GAARjxB,EAAE8+C,KAEL9+C,EAAE2wB,MAAQ7gB,EAAI6gB,MACd3wB,EAAE4wB,OAAS9gB,EAAI8gB,OACf5wB,EAAE+wB,OAASjhB,EAAIihB,QAGhBsR,yCAAOsC,kBAAkB1L,UAAUnpB,EAAI/F,KAAM,EAAG,GAChDs4B,yCAAOC,SAAS/F,aAAazsB,EAAI/F,MAEjC/J,EAAE+J,KAAKxE,KAAKuK,GACZ0uC,KAGD1uC,EAAI/F,KAAK2iC,QAAU,WAClBxzB,QAAQ+I,MAAM,0BAA4BnS,EAAIiqC,UAG/CjqC,EAAI/F,KAAK+pB,IAAMhkB,EAAIgkB,IAAM,MAAQ3jB,KAAK6xB,UAGvCwc,IACA,MAED,IAAK,QAGJ,GAFKx+C,EAAEi/C,QAAOj/C,EAAEi/C,MAAQ,OAEpBr+C,eAAOs+C,SAAWt+C,eAAOs+C,QAAQC,aAA0B,OAAXn/C,EAAEi/C,MACtD,CACMrB,iCACJvoB,yCAAIC,MAAM,sBACVsoB,gCAAW,GAGZ59C,EAAEo/C,OAASC,0BAASC,MAAMC,mBAC1Bv/C,EAAE+J,KAAO,OAASoF,EAElBvO,eAAOs+C,QAAQC,YAAYK,cAAcx/C,EAAE+J,KAAM/J,EAAE8zB,KAClD,WACC6pB,gCAAUiB,SAAUx1C,EAAM+0C,EAAQhvC,IAAQ,KACzCwuC,gCAAUK,KAAM50C,EAAM60C,EAAkBC,EAAkBC,EAAShvC,EAAQ,SAG7E,SAASrP,GACRoZ,QAAQ+I,MAAM,gCAAkCjiB,EAAE+5C,QAAU,KAAOj6C,MAIrE,MAGD,GAAIc,eAAOmrC,aACX,CACM6R,iCACJvoB,yCAAIC,MAAM,mBACVsoB,gCAAW,GAGZ59C,EAAEo/C,OAASC,0BAASC,MAAMG,gBAE1B7S,iBAAkB5sC,EAAE8zB,IAAM,MAAQ3jB,KAAK6xB,UACtC6K,MAAMG,IACNhtC,EAAE+J,KAAOijC,EACT2Q,gCAAUiB,SAAUx1C,EAAM+0C,EAAQhvC,IAAQ,KACzCwuC,gCAAUK,KAAM50C,EAAM60C,EAAkBC,EAAkBC,EAAShvC,EAAQ,SAG5E89B,OAAO5zB,IACPH,QAAQ+I,MAAM,0BAA4BjiB,EAAE+5C,QAAU,KAAO1gC,MAG9D,MAGIukC,iCACJvoB,yCAAIC,MAAM,gBACVsoB,gCAAW,GAGZ59C,EAAE+J,KAAO,IAAI21C,MACb1/C,EAAEo/C,OAASC,0BAASC,MAAMK,aAE1B3/C,EAAE+J,KAAK61C,iBAAmB,WAEzBjC,gCAAUiB,SAAUx1C,EAAM+0C,EAAQhvC,IAAS,KAC1CwuC,gCAAUK,KAAM50C,EAAM60C,EAAkBC,EAAkBC,EAAShvC,EAAQ,OAI7EnP,EAAE+J,KAAK2iC,QAAU,WAEhBxzB,QAAQ+I,MAAM,0BAA4BjiB,EAAE+5C,UAG7C/5C,EAAE+J,KAAK+pB,IAAM9zB,EAAE8zB,IAAM,MAAQ3jB,KAAK6xB,SAClC,MAED,IAAK,SAMJ,GALAlO,EAAM9zB,EAAE8zB,IACRuqB,EAAKvqB,EAAI5vB,QAAQ,KACjBo6C,EAAKxqB,EAAI+qB,YAAY,KACrBN,EAAKD,EAAKD,EAAK,GAEL,GAANA,EAGH,YADAnlC,QAAQ+I,MAAO,mBAAqBjiB,EAAE+5C,QAAU,gEAIjD,IAAK/5C,EAAE2T,MAGN,YADAuF,QAAQ+I,MAAO,mBAAqBjiB,EAAE+5C,QAAU,iDAIjD/5C,EAAE8+C,GAAK,EACP9+C,EAAE+J,KAAO,GAETy0C,EAAK,WAEJ,GAAIx+C,EAAE8+C,IAAM9+C,EAAE2T,MAKb,YAHAgqC,gCAAUiB,SAAUx1C,EAAM+0C,EAAQhvC,IAAQ,KACzCwuC,gCAAUK,KAAM50C,EAAM60C,EAAkBC,EAAkBC,EAAShvC,EAAQ,MAK7E,IAAIW,EAAM,CAAE/N,KAAM,QAASk9C,MAAOj/C,EAAEi/C,OAOpC,OALAnvC,EAAIgkB,IAAM9zB,EAAE8zB,IAAIjyB,OAAO,EAAGw8C,IAAQr+C,EAAE8+C,KAAQ3uC,KAAKC,IAAI,GAAGmuC,IAAKj8B,QAAQi8B,GAAI18C,OAAO,GAAK7B,EAAE8zB,IAAIjyB,OAAOy8C,EAAG,GACrGxuC,EAAIiqC,QAAU/5C,EAAE+5C,QAAU,KAAO/5C,EAAE8+C,GAAK,GAEnChvC,EAAImvC,QAAOnvC,EAAImvC,MAAQ,OAExBr+C,eAAOs+C,SAAWt+C,eAAOs+C,QAAQC,aAA4B,OAAbrvC,EAAImvC,OAEvDnvC,EAAIsvC,OAASC,0BAASC,MAAMC,mBAC5BzvC,EAAI/F,KAAO,OAASoF,EAAQ,IAAMnP,EAAE8+C,QAEpCl+C,eAAOs+C,QAAQC,YAAYK,cAAc1vC,EAAI/F,KAAM+F,EAAIgkB,KACtD,WACC9zB,EAAE+J,KAAKxE,KAAKuK,GACZ0uC,OAED,SAAS1+C,GACRoZ,QAAQ+I,MAAM,gCAAkCnS,EAAIiqC,QAAU,KAAOj6C,OAOpEc,eAAOmrC,cAEVj8B,EAAIsvC,OAASC,0BAASC,MAAMG,qBAE5B7S,iBAAkB98B,EAAIgkB,IAAM,MAAQ3jB,KAAK6xB,UACxC6K,MAAMG,IACNl9B,EAAI/F,KAAOijC,EACXhtC,EAAE+J,KAAKxE,KAAKuK,GACZ0uC,OAEAvR,OAAO5zB,IACPH,QAAQ+I,MAAM,0BAA4BnS,EAAIiqC,QAAU,KAAO1gC,QAMjEvJ,EAAI/F,KAAO,IAAI21C,MACf5vC,EAAIsvC,OAASC,0BAASC,MAAMK,aAE5B7vC,EAAI/F,KAAK61C,iBAAmB,WAE3B5/C,EAAE+J,KAAKxE,KAAKuK,GACZ0uC,KAGD1uC,EAAI/F,KAAK2iC,QAAU,WAElBxzB,QAAQ+I,MAAM,0BAA4BnS,EAAIiqC,eAG/CjqC,EAAI/F,KAAK+pB,IAAMhkB,EAAIgkB,IAAM,MAAQ3jB,KAAK6xB,YAGvCwc,IACA,MAED,IAAK,OAEJpS,OAAQpsC,EAAE8zB,IAAM,MAAQ3jB,KAAK6xB,SAAU,CAAEqK,aAAc,SAAUQ,MAAK,SAASgT,GAE9E7/C,EAAE+J,KAAO81C,EAETlC,gCAAUiB,SAAUx1C,EAAM+0C,EAAQhvC,IAAQ,KACzCwuC,gCAAUK,KAAM50C,EAAM60C,EAAkBC,EAAkBC,EAAShvC,EAAQ,SAG5E89B,OAAM,SAAS5zB,GAEfH,QAAQ+I,MAAM,0BAA4BjiB,EAAE+5C,QAAU,KAAO1gC,MAG9D,MAED,IAAK,OAEJ+yB,OAAQpsC,EAAE8zB,IAAM,MAAQ3jB,KAAK6xB,UAAU6K,MAAK,SAASiT,GAEpD9/C,EAAE+J,KAAO+1C,EAETnC,gCAAUiB,SAAUx1C,EAAM+0C,EAAQhvC,IAAQ,KACzCwuC,gCAAUK,KAAM50C,EAAM60C,EAAkBC,EAAkBC,EAAShvC,EAAQ,SAG5E89B,OAAM,SAAS5zB,GAEfH,QAAQ+I,MAAM,0BAA4BjiB,EAAE+5C,QAAU,KAAO1gC,MAG9D,MAED,IAAK,OAEJ+yB,OAAQpsC,EAAE8zB,IAAM,MAAQ3jB,KAAK6xB,UAAU6K,MAAK,SAASC,GAEpD9sC,EAAE+J,KAAOkM,OAAOC,aAAanN,MAAM,KAAM,IAAIg3C,WAAWjT,IAExD6Q,gCAAUiB,SAAUx1C,EAAM+0C,EAAQhvC,IAAQ,KACzCwuC,gCAAUK,KAAM50C,EAAM60C,EAAkBC,EAAkBC,EAAShvC,EAAQ,SAG5E89B,OAAM,SAAS5zB,GAEfH,QAAQ+I,MAAM,0BAA4BjiB,EAAE+5C,QAAU,KAAO1gC,MAG9D,MAED,IAAK,SACJrZ,EAAE+J,KAAO,GAET4zC,gCAAUiB,SAAUx1C,EAAM+0C,EAAQhvC,IAAQ,KACzCwuC,gCAAUK,KAAM50C,EAAM60C,EAAkBC,EAAkBC,EAAShvC,EAAQ,QAU/E6wC,OAAQ,SAAU52C,GAEjB,MAAM,IAAIhI,MAAM,wBAoDjBw9C,SAAU,SAAUx1C,EAAM+F,EAAOyB,GAEhC,IAAI5Q,EAAIoJ,EAAK+F,GACRnP,EAAEk5C,SAAal5C,EAAEk5C,WAAWmG,2BAMjCj2C,EAAK+F,GAAS,IAAIkwC,0BAASr/C,EAAEk5C,SAAUl5C,GAEnC,SAAUoJ,EAAK+F,GAElB/F,EAAK+F,GAAOtE,MAAK,KAChBzB,EAAK+F,GAAO8wC,UAAW,EACvBrvC,QAIDxH,EAAK+F,GAAO8wC,UAAW,EACvBrvC,MAfAA,KAuBFsvC,UAAW,SAAUv5C,GAEpB,OAAO,IAAI5B,SAAQ,CAACC,EAASC,KAC5B,MAAM6tB,EAAQ,IAAIc,MAClBd,EAAMe,OAAS,IAAM7uB,EAAQ8tB,GAC7BA,EAAM4Z,QAAU,IAAMznC,EAAO,IAAI7D,MAAM,yBACvC0xB,EAAMgB,IAAMntB,MAQdg4C,YAAa7tC,eAAgBgiB,EAAOsG,EAAIC,EAAIykB,EAAWqC,GAEtD,IAAIjnB,EAAKpG,EAAM/oB,KAAK4mB,MAChBwI,EAAKrG,EAAM/oB,KAAK6mB,OAKpB,GAHAwI,EAAKtjB,IAAIsjB,GACTC,EAAKvjB,IAAIujB,GAELH,GAAME,GAAMD,GAAME,EACrB,OAAOvG,EAAM/oB,KAId,IAFKrH,KAAKm7C,uBAAyBC,IAAWA,EAAY,MAErDA,EAmCL,CACC,GAAIhoC,IAAIsjB,EAAKF,GAAM,EACnB,CACC,IAAIulB,EAAQ3oC,IAAIsjB,EAAMF,EAAM,IAKxBknB,GAHJhnB,EAAKqlB,EAAQvlB,GAGIA,EACbmnB,GAHJhnB,EAAKolB,EAAQtlB,GAGIA,EAEb1zB,EAAS,IAAI6tB,yCAAQ,CAAEC,QAAQ,EAAMC,WAAW,IAAS0C,OAAQkD,EAAIC,GAErExtB,EAAO,IAAIynB,yCAAQ,CAAEC,QAAQ,EAAMC,WAAW,IAAS0C,OAAQgD,EAAIC,GACvEttB,EAAKotB,UAAWnG,EAAM/oB,KAAM,EAAG,GAE/B,IAAK,IAAInE,EAAI,EAAGA,EAAIuzB,EAAIvzB,IACxB,CACC,IAAI8O,EAAI7I,EAAKktB,aAAa,EAAGnzB,EAAGszB,EAAI,GAAGnvB,KACnCu2C,EAAK,EAET,IAAK,IAAIv9C,EAAI,EAAGA,EAAIm2B,GAAMonB,EAAK5rC,EAAE1R,OAAQD,IAAKu9C,GAAM,EAEnD76C,EAAOwwB,UAAU,QAAQvhB,EAAE4rC,GAAI,IAAI5rC,EAAE4rC,EAAG,GAAG,IAAI5rC,EAAE4rC,EAAG,GAAG,IAAK5rC,EAAE4rC,EAAG,GAAK,IAAK,KAC3E76C,EAAO6xB,SAASv0B,EAAEq9C,EAAOx6C,EAAEy6C,EAAOD,EAAOC,GAM3C,OAFAx0C,EAAKyX,gBAEQ5gB,KAAKw9C,UAAUz6C,EAAOsuB,aAGpC,OAAOrxB,KAAKi8C,YAAa7rB,EAAOsG,EAAIC,EAAI,KAAM8mB,GAnE/C,CAGC,IAAIt0C,EAAO,IAAIynB,yCAAQ,CAAEC,QAAQ,EAAMC,UAFvCsqB,EAA0B,OAAdA,IAEmD5nB,OAAQgD,EAAIC,GAG3E,IAFAttB,EAAKotB,UAAWnG,EAAM/oB,KAAM,EAAG,KAG/B,CACC,IAAIw2C,EAAKrnB,GAAM,EACXsnB,EAAKrnB,GAAM,EAEf,GAAIonB,GAAMnnB,GAAMonB,GAAMnnB,EACrB,MAED,IAAI5zB,EAAS,IAAI6tB,yCAAQ,CAAEC,QAAQ,EAAMC,UAAWsqB,IAAa5nB,OAAQqqB,EAAIC,GAC7E/6C,EAAOwzB,UAAWptB,EAAKvG,KAAM,EAAG,EAAGi7C,EAAIC,GACvC30C,EAAKyX,UAEL4V,EAAKqnB,EACLpnB,EAAKqnB,EAEL30C,EAAOpG,EAGR,IAAIA,EAAS,IAAI6tB,yCAAQ,CAAEC,QAAQ,EAAMC,UAAWsqB,IAAa5nB,OAAQkD,EAAIC,GAO7E,OANA5zB,EAAOwzB,UAAWptB,EAAKvG,KAAM,EAAG,EAAG8zB,EAAIC,GACvCxtB,EAAKyX,UAED68B,GACH78B,QAASwP,EAAM/oB,YAEHrH,KAAKw9C,UAAUz6C,EAAOsuB,eA4CrC0sB,cAAe,SAAU3tB,GAExB,IAAIjnB,EAAO,IAAIynB,yCAAQ,CAAEC,QAAQ,IAAQ2C,OAAQpD,EAAM/oB,KAAK4mB,MAAOmC,EAAM/oB,KAAK6mB,QAM9E,OAJA/kB,EAAKwa,UAAUyM,EAAM/oB,KAAK4mB,MAAO,GACjC9kB,EAAKwZ,OAAM,EAAI,GAEfxZ,EAAKotB,UAAWnG,EAAM/oB,KAAM,EAAG,GACxB8B,EAAKvG,MAObo7C,cAAe,SAAU5tB,GAExB,IAAIjnB,EAAO,IAAIynB,yCAAQ,CAAEC,QAAQ,IAAQ2C,OAAQpD,EAAM/oB,KAAK4mB,MAAOmC,EAAM/oB,KAAK6mB,QAM9E,OAJA/kB,EAAKwa,UAAU,EAAGyM,EAAM/oB,KAAK6mB,QAC7B/kB,EAAKwZ,MAAM,GAAG,GAEdxZ,EAAKotB,UAAWnG,EAAM/oB,KAAM,EAAG,GACxB8B,EAAKvG,MAObq7C,aAAc,SAAUC,EAAUC,GAEjC,IAAIhzB,EAAO2G,SAASE,cAAc,KAClC7G,EAAKizB,KAAOD,EAEZhzB,EAAKgH,MAAMksB,QAAU,OACrBlzB,EAAKmzB,SAAWJ,EAChB/yB,EAAK7F,OAAS,SAEdwM,SAASG,KAAKC,YAAY/G,GAC1BA,EAAKozB,QACLzsB,SAASG,KAAKgI,YAAY9O,IAO3BqzB,eAAgB,SAAUC,EAAeC,EAAQxwC,GAEhD,IAAIywC,EAAQ7sB,SAASE,cAAc,SAEnC2sB,EAAMt/C,KAAO,OACbs/C,EAAMD,OAASA,EACfC,EAAMxsB,MAAMksB,QAAU,OACtBM,EAAMC,SAAWH,EAEjB3sB,SAASG,KAAKC,YAAYysB,GAE1BA,EAAME,SAAW,WAEhB3wC,EAASywC,EAAMG,QAGhBhtB,SAASG,KAAK8sB,QAAU,WAEvBjtB,SAASG,KAAK8sB,QAAU,KACxBjtB,SAASG,KAAKgI,YAAY0kB,IAG3BA,EAAMJ,SAOPS,cAAe,SAAUC,EAAM/wC,GAE9B,IAAIgxC,EAAS,IAAIC,WAEjBD,EAAO/tB,OAAS,SAAS/zB,GACxB8Q,EAAU9Q,EAAEkoB,OAAO8sB,SAGpB8M,EAAOE,cAAcH,IAOtBI,WAAY,SAAUJ,EAAM/wC,GAE3B,IAAIgxC,EAAS,IAAIC,WAEjBD,EAAO/tB,OAAS,SAAS/zB,GACxB8Q,EAAU9Q,EAAEkoB,OAAO8sB,SAGpB8M,EAAOI,WAAWL,IAOnBM,kBAAmB,SAAUN,EAAM/wC,GAElC,IAAIgxC,EAAS,IAAIC,WAEjBD,EAAO/tB,OAAS,SAAS/zB,GACxB8Q,EAAU9Q,EAAEkoB,OAAO8sB,SAGpB8M,EAAOM,kBAAkBP,IAO1BQ,iBAAkB,SAAUC,EAAUxxC,GAErC,IAAIkkC,EAAS,GAEb,IAAKsN,IAAaA,EAASp/C,OAG1B,YADA4N,EAASkkC,GAIV,IAAIuN,EAAW,SAAUt/C,GAEpBA,GAAKq/C,EAASp/C,OAMlB26C,gCAAU+D,cAAeU,EAASr/C,IAAI,SAAS4D,GAC9CmuC,EAAOvvC,KAAK,CAAErD,KAAMkgD,EAASr/C,GAAGb,KAAMwrB,KAAM00B,EAASr/C,GAAG2qB,KAAM/mB,IAAKA,IACnE07C,EAASt/C,EAAE,MANX6N,EAASkkC,IAUXuN,EAAS,M;AAMXC,yCAAe3E;yBDp5Bf;MAAM4E,4BAAQhoC,OAAAK,MAAM3R,OACnB,CACAjJ,EAAG,KAEHoH,OAAQ,SAAUpH,GAEjB,GAAc,SAAVA,EAAE+B,KACL,MAAM,IAAIX,MAAO,0BAElBsB,KAAK1C,EAAIA,EACT0C,KAAK1C,EAAEk5C,QAAUx2C,KAEjBA,KAAKu8C,MAAQsD,4BAAM7/C,KAAK1C,EAAEi/C,MAAM56C,gBAGjCw3C,KAAM,SAAUjrC,EAAU4xC,GAEzB,OAAOD,4BAAM1G,KAAMn5C,KAAMkO,EAAU4xC,IAGpCC,SAAU,SAAU7xC,EAAU4xC,GAE7B,OAAOD,4BAAME,SAAU//C,KAAMkO,EAAU4xC,MAIzCD,4BAAM5C,aAAe,EACrB4C,4BAAM9C,gBAAkB,EACxB8C,4BAAMhD,mBAAqB,EAE3Br/C,OAAOijC,OAAOof,4BACd,CACCG,OAAQ,CACP9X,SAAS,EACT4X,OAAQ,GAGTG,IAAK,CACJ/X,SAAS,EACT4X,OAAQ,GAGTI,MAAO,CACNhY,SAAS,EACT4X,OAAQ,IAGTK,MAAO,CACNjY,SAAS,EACT4X,OAAQ,GAGTM,cAAe,IAEfC,KAAM,GACN1yB,OAAQ,GAER/uB,SAAU,SAAU0hD,GAEfA,EAAKC,aAETD,EAAKC,YAAa,EAClBvgD,KAAK2tB,OAAO9qB,KAAKy9C,KAGlBE,WAAY,SAAUF,GAErB,GAAKA,EAAKC,WAAV,CAEAD,EAAKC,YAAa,EAElB,IAAIlgD,EAAIw/C,4BAAMlyB,OAAOnsB,QAAQ8+C,IACpB,GAALjgD,GAEJw/C,4BAAMlyB,OAAOltB,OAAOJ,EAAG,KAGxBogD,WAAY,SAAUH,EAAMI,GAE3B,OAAQJ,EAAKK,IAAIrjD,EAAEo/C,QAElB,KAAKmD,4BAAM9C,gBACV,OAAO/8C,KAAK4gD,oBAAoBN,EAAMI,GAEvC,KAAKb,4BAAMhD,mBACV,OAAO78C,KAAK6gD,uBAAuBP,EAAMI,GAG3C,OAAO1gD,KAAK8gD,iBAAiBR,EAAMI,IAIpCK,eAAgB,SAAUT,GAEzBA,EAAKU,SAAW3X,aAAa4X,aAC7BX,EAAKU,SAASE,KAAKjiD,MAAQ,EAC3BqhD,EAAKU,SAASG,QAAQ9X,aAAa+X,aAEnCd,EAAKe,IAAMhY,aAAaiY,qBACxBhB,EAAKe,IAAIE,OAASjB,EAAKK,IAAIrjD,EAAE+J,KAC7Bi5C,EAAKe,IAAIzI,MAAO,EAChB0H,EAAKe,IAAIF,QAAQb,EAAKU,UACtBV,EAAKe,IAAIf,KAAOA,GAGjBkB,cAAe,SAAUlB,GAEnBA,EAAKe,MAEVf,EAAKU,SAASS,aAEdnB,EAAKe,IAAM,KACXf,EAAKU,SAAW,OAIjBU,kBAAmB,SAAUpB,GAE5BA,EAAKe,KAAM,GAGZM,iBAAkB,SAAUrB,GAE3BA,EAAKe,KAAM,GAIZO,YAAa,SAAUtB,GAQtB,OANKtgD,KAAKqgD,KAAK//C,OAGdwL,KAAO9L,KAAKqgD,KAAKvzC,MAFjBhB,KAAOw0C,EAAKuB,YAIb/1C,KAAKg2C,KAAOxB,EAAKlvB,IACVtlB,MAGRi2C,WAAY,SAAUzB,GAEjBtgD,KAAKqgD,KAAK//C,QAAUN,KAAKogD,eAM7BpgD,KAAKqgD,KAAKx9C,KAAKy9C,IAIhBM,oBAAqB,SAAUN,EAAMI,GAEpC,IAAKJ,EAAM,OAAO,KAElB,IAAIR,EAASD,4BAAMG,OAAOF,OAASQ,EAAKK,IAAIpE,MAAMuD,OAASQ,EAAKR,OAEhE,OAAQY,GAGP,IAAK,OACJ,GAAIJ,EAAK0B,QAAS,MAEb1B,EAAKe,KACTxB,4BAAMkB,eAAeT,GAEtBA,EAAK2B,SAAW1/B,QAChB+9B,EAAK0B,SAAU,EACf1B,EAAKha,OAAQ,EAEbga,EAAKe,IAAIa,QAAUrC,4BAAMsC,iBACzB7B,EAAKU,SAASE,KAAKjiD,MAAQ6gD,EAE3B,IACCQ,EAAKe,IAAIhsC,MAAM,EAAGirC,EAAKx+B,UAAU,KAElC,MAAO1kB,GAEN,OADAyiD,4BAAM2B,cAAclB,GACb,KAGRT,4BAAMjhD,SAAS0hD,GACf,MAGD,IAAK,YACJ,IAAKA,EAAKe,IAAK,MAEff,EAAKU,SAASE,KAAKjiD,MAAQ6gD,EAC3B,MAGD,IAAK,OACJ,IAAKQ,EAAK0B,SAAW1B,EAAKnY,OAC1B,CACCmY,EAAKx+B,UAAY,EACjBw+B,EAAKnY,QAAS,EAEd0X,4BAAM2B,cAAclB,GAEhBA,EAAKpyC,UAAUoyC,EAAKpyC,WACxB,MAGD,IAAKoyC,EAAKe,IAAK,MAEff,EAAKx+B,UAAY,EACjBw+B,EAAK0B,SAAU,EACf1B,EAAKha,OAAQ,EACbga,EAAKe,IAAIa,QAAU,KAEnBrC,4BAAMW,WAAWF,GACjBA,EAAKe,IAAIr+B,OAET68B,4BAAM2B,cAAclB,GAEhBA,EAAKpyC,UAAUoyC,EAAKpyC,WACxB,MAGD,IAAK,QACJ,IAAKoyC,EAAK0B,UAAY1B,EAAKe,IAC1B,MAEDf,EAAKx+B,WAAaS,QAAU+9B,EAAK2B,SACjC3B,EAAK0B,SAAU,EACf1B,EAAKha,OAAQ,EACbga,EAAKe,IAAIa,QAAU,KAEnBrC,4BAAMW,WAAWF,GACjBA,EAAKe,IAAIr+B,OAET68B,4BAAM2B,cAAclB,GACpB,MAGD,IAAK,WACJ,IAAKA,EAAK0B,SAAW1B,EAAKnY,OAC1B,CACCmY,EAAKx+B,UAAY,EACjBw+B,EAAKnY,QAAS,EACd,MAGD,IAAKmY,EAAK0B,UAAY1B,EAAKe,IAC1B,MAEDf,EAAKx+B,UAAY,EACjBw+B,EAAK0B,SAAU,EACf1B,EAAKha,OAAQ,EAEbga,EAAKe,IAAIzI,MAAO,EAIlB,OAAO0H,GAGR6B,iBAAkB,SAAU/kD,GAE3B,IAAIkjD,EAAOljD,EAAEglD,cAAc9B,KAE3B,GAAIA,EAAK0B,SAAwB,GAAb1B,EAAK1H,KAYxB,OAVAiH,4BAAM2B,cAAclB,IAEH,GAAbA,EAAK1H,MACR0H,EAAK1H,OAEN0H,EAAKx+B,UAAY,EACjBw+B,EAAK0B,SAAU,EACf1B,EAAKha,OAAQ,OAEbuZ,4BAAMe,oBAAqBN,EAAM,QAIlCA,EAAKe,IAAIa,QAAU,KACnB5B,EAAKe,IAAIvB,OAAS,EAElBD,4BAAMe,oBAAqBN,EAAM,SAIlCO,uBAAwB,SAAUP,EAAMI,GAEvC,IAAKJ,EAAM,OAAO,KAElB,OAAQI,GAGP,IAAK,OACJ,GAAIJ,EAAK0B,QAAS,MAEb1B,EAAKe,KACTxB,4BAAM6B,kBAAkBpB,GAEzBA,EAAK0B,SAAU,EACf1B,EAAKha,OAAQ,EAEb,IACCpoC,eAAOs+C,QAAQC,YAAYtD,KAAMmH,EAAKK,IAAIrjD,EAAE+J,KAAM,KAAM,MAAM,WAAaw4C,4BAAMwC,oBAAoB/B,MAEtG,MAAOljD,GAEN,OADAyiD,4BAAM8B,iBAAiBrB,GAChB,KAGRT,4BAAMjhD,SAAS0hD,GACf,MAGD,IAAK,YAoBL,IAAK,QAKL,IAAK,WAEJ,MAtBD,IAAK,OACJ,IAAKA,EAAKe,IAAK,MAEff,EAAK0B,SAAU,EACf1B,EAAKha,OAAQ,EAEbuZ,4BAAMW,WAAWF,GACjBpiD,eAAOs+C,QAAQC,YAAYz5B,KAAMs9B,EAAKK,IAAIrjD,EAAE+J,KAAM,MAElDw4C,4BAAM8B,iBAAiBrB,GAEnBA,EAAKpyC,UAAUoyC,EAAKpyC,WAc1B,OAAOoyC,GAGR+B,oBAAqB,SAAU/B,GAE9BT,4BAAMgB,uBAAwBP,EAAM,SAGrCQ,iBAAkB,SAAUR,EAAMI,GAEjC,IAAKJ,EAAM,OAAO,KAElB,IAAIR,EAASD,4BAAMG,OAAOF,OAASQ,EAAKK,IAAIpE,MAAMuD,OAASQ,EAAKR,OAEhE,OAAQY,GAGP,IAAK,OACJ,GAAIJ,EAAK0B,QAAS,MAEb1B,EAAKe,MAETf,EAAKe,IAAMxB,4BAAM+B,YAAatB,EAAKK,IAAIrjD,EAAE+J,MACzCi5C,EAAKe,IAAIf,KAAOA,EAChBA,EAAKe,IAAIjwB,IAAMkvB,EAAKe,IAAIS,MAGzBxB,EAAK2B,SAAW1/B,QAChB+9B,EAAK0B,SAAU,EACf1B,EAAKha,OAAQ,EAEbga,EAAKe,IAAIa,QAAUrC,4BAAMyC,cACzBhC,EAAKe,IAAIkB,YAAcjC,EAAKx+B,UAAU,IACtCw+B,EAAKe,IAAIvB,OAASA,EAElB,IACCQ,EAAKe,IAAIlI,OAEV,MAAO/7C,GAGN,OAFAyiD,4BAAMkC,WAAYzB,EAAKe,KACvBf,EAAKe,IAAM,KACJ,KAGRxB,4BAAMjhD,SAAS0hD,GACf,MAGD,IAAK,YACJ,IAAKA,EAAKe,IAAK,MAEff,EAAKe,IAAIvB,OAASA,EAClB,MAGD,IAAK,OACJ,IAAKQ,EAAK0B,SAAW1B,EAAKnY,OAC1B,CACCmY,EAAKx+B,UAAY,EACjBw+B,EAAKnY,QAAS,EAEd0X,4BAAMkC,WAAYzB,EAAKe,KACvBf,EAAKe,IAAM,KAEPf,EAAKpyC,UAAUoyC,EAAKpyC,WACxB,MAGD,IAAKoyC,EAAKe,IAAK,MAEff,EAAKx+B,UAAY,EACjBw+B,EAAK0B,SAAU,EACf1B,EAAKha,OAAQ,EAEbuZ,4BAAMW,WAAYF,GAClBA,EAAKe,IAAI/a,QAETuZ,4BAAMkC,WAAYzB,EAAKe,KACvBf,EAAKe,IAAM,KAEPf,EAAKpyC,UAAUoyC,EAAKpyC,WACxB,MAGD,IAAK,QACJ,IAAKoyC,EAAK0B,UAAY1B,EAAKe,IAC1B,MAEDf,EAAKx+B,WAAaS,QAAU+9B,EAAK2B,SACjC3B,EAAK0B,SAAU,EACf1B,EAAKha,OAAQ,EAEbuZ,4BAAMW,WAAYF,GAClBA,EAAKe,IAAI/a,QACT,MAGD,IAAK,WACJ,IAAKga,EAAK0B,SAAW1B,EAAKnY,OAC1B,CACCmY,EAAKx+B,UAAY,EACjBw+B,EAAKnY,QAAS,EACd,MAGD,IAAKmY,EAAK0B,UAAY1B,EAAKe,IAC1B,MAEDf,EAAKx+B,UAAY,EACjBw+B,EAAK0B,SAAU,EACf1B,EAAKha,OAAQ,EAIf,OAAOga,GAGRgC,cAAe,SAAUllD,GAExB,IAAIkjD,EAAOljD,EAAEglD,cAAc9B,KAE3B,GAAIA,EAAK0B,SAAwB,GAAb1B,EAAK1H,KAUxB,OARiB,GAAb0H,EAAK1H,MACR0H,EAAK1H,OAEN0H,EAAKx+B,UAAY,EACjBw+B,EAAK0B,SAAU,EACf1B,EAAKha,OAAQ,OAEbuZ,4BAAMiB,iBAAkBR,EAAM,QAI/BA,EAAKe,IAAIa,QAAU,KACnB5B,EAAKe,IAAIvB,OAAS,EAElBD,4BAAMiB,iBAAkBR,EAAM,SAM/BkC,YAAa,SAAUjG,GAEjBA,IAELA,EAAMrU,SAAU,IAGjBua,aAAc,SAAUlG,GAElBA,IAELA,EAAMrU,SAAU,IAGjBwa,UAAW,SAAUnG,EAAOt9C,GAEtBs9C,IAELA,EAAMuD,OAAS7gD,IAGhB0jD,WAAY,SAAUhC,EAAKb,GAE1B,IAAIQ,EAAO,GAcX,OAZAA,EAAKsC,YAAc9C,EACnBQ,EAAKR,OAASA,EACdQ,EAAKK,IAAMA,EACXL,EAAK1H,KAAO,EACZ0H,EAAK0B,SAAU,EACf1B,EAAKnY,QAAS,EACdmY,EAAKx+B,UAAY,EACjBw+B,EAAK2B,SAAW,EAChB3B,EAAKpyC,SAAW,KAChBoyC,EAAKuC,MAAQ,KACbvC,EAAKe,IAAM,KAEJf,GAGRnH,KAAM,SAAUwH,EAAKnF,EAAkBsE,GAEtC,IAAK9/C,KAAKggD,OAAO9X,UAAYyY,IAAQA,EAAIpE,MAAMrU,QAC9C,OAAO,KAEJ4X,EAASA,QAA4CA,EAAS,EAAlE,IAEIQ,EAAOtgD,KAAK2iD,WAAWhC,EAAKb,GAGhC,OAFAQ,EAAKpyC,SAAWstC,EAETx7C,KAAKygD,WAAWH,EAAM,SAG9BP,SAAU,SAAUY,EAAKnF,EAAkBsE,GAE1C,IAAK9/C,KAAKggD,OAAO9X,UAAYyY,IAAQA,EAAIpE,MAAMrU,QAC9C,OAAO,KAER4X,EAASA,QAA4CA,EAAS,EAE9D,IAAIQ,EAAOtgD,KAAK2iD,WAAWhC,EAAKb,GAIhC,OAHAQ,EAAKpyC,SAAWstC,EAChB8E,EAAK1H,MAAO,EAEL54C,KAAKygD,WAAWH,EAAM,SAG9Bt9B,KAAM,SAAUs9B,EAAMpyC,GAErB,OAAKoyC,GAEDpyC,IAAyB,IAAbA,IAAmBoyC,EAAKpyC,SAAWA,GAC5ClO,KAAKygD,WAAWH,GAAmB,IAAbpyC,EAAoB,OAAS,aAHxC,MAMnBo4B,MAAO,SAAUga,GAEhB,OAAKA,EAEEtgD,KAAKygD,WAAWH,EAAM,SAFX,MAKnBl0C,OAAQ,SAAUk0C,GAEjB,OAAKA,EAEEtgD,KAAKygD,WAAYH,EAAM,QAFZ,MAKnBwC,QAAS,SAAUxC,EAAMl+C,EAAQ8L,GAEhC,GAAKoyC,EAEL,GAAKA,EAAK0B,UAAW1B,EAAKuC,MAA1B,CAMA,IAAI/gC,EAAYS,QAChB+9B,EAAKsC,YAActC,EAAKR,OAExBQ,EAAKuC,MAAQE,aAAa,WAEzB,IAAI1lD,GAAMklB,QAAUT,GAAa1f,EAC7B/E,EAAI,IAAGA,EAAI,GAEfijD,EAAKR,OAASQ,EAAKsC,aAAa,EAAEvlD,GAClCwiD,4BAAMY,WAAWH,EAAM,aAEd,GAALjjD,IAEH2lD,cAAe1C,EAAKuC,OACpBvC,EAAKuC,MAAQ,MAEI,IAAb30C,EACH2xC,4BAAMY,WAAWH,EAAM,QAEvBT,4BAAMY,WAAWH,EAAM,SAEpBpyC,IAAyB,IAAbA,GACfA,OAGH,SA7BKA,GAAUA,KAgChB+0C,OAAQ,SAAU3C,EAAMl+C,EAAQ8L,GAE/B,GAAKoyC,EAEL,GAAIA,EAAK0B,SAAW1B,EAAKuC,MAEpB30C,GAAUA,QAFf,CAMA,IAAI4T,EAAYS,QAEhB+9B,EAAKR,OAAS,EACd9/C,KAAKygD,WAAWH,EAAM,QAEtBA,EAAKuC,MAAQE,aAAa,WAEzB,IAAI1lD,GAAMklB,QAAUT,GAAa1f,EAC7B/E,EAAI,IAAGA,EAAI,GAEfijD,EAAKR,OAASQ,EAAKsC,YAAYvlD,EAC/BwiD,4BAAMY,WAAWH,EAAM,aAEd,GAALjjD,IAEH2lD,cAAe1C,EAAKuC,OACpBvC,EAAKuC,MAAQ,KAET30C,GAAUA,OAGhB,QAOF0xC,yCAAU5C,MAAQ,SAAU5rB,EAAKM,EAAK,MAErC,MAAO,CAAEryB,KAAM,QAASm3C,QAAS,QAASplB,IAAKA,KAAQM,I,IAGxDwxB,yCAAerD,4BEvpBfhoC,OAAAxZ,cAAA;AAUA8kD,yCAAetrC,OAAAK,MAAM3R,OACpB,CACAjJ,EAAG,KAEHoH,OAAQ,SAAUpH,GAEjB,GAAc,UAAVA,EAAE+B,KACL,MAAM,IAAIX,MAAO,2BAElBsB,KAAK1C,EAAIA,EACT0C,KAAK1C,EAAEk5C,QAAUx2C,KAEZA,KAAK1C,EAAEi/C,QACXv8C,KAAK1C,EAAEi/C,MAAQ,OAEXv8C,KAAK1C,EAAEyU,OACX/R,KAAK1C,EAAEyU,KAAO,UAEf/R,KAAKu8C,MAAQ2G,yCAAMljD,KAAK1C,EAAEi/C,MAAM56C,eAEhC3B,KAAKojD,OAAS,GACdpjD,KAAKqjD,WAAY,EAEjB,IAAK,IAAIhjD,EAAI,EAAGA,EAAIL,KAAK1C,EAAE+J,KAAK/G,OAAQD,IAEvCL,KAAKojD,OAAOvgD,KAAK,IAAIqgD,yCAAO1lD,OAAOijC,OAAQzgC,KAAK1C,EAAE+J,KAAKhH,GAAI,CAAEk8C,MAAOv8C,KAAK1C,EAAEi/C,WAI7E+G,eAAgB,WAEf,MAAmB,UAAftjD,KAAK1C,EAAEyU,KACH/R,KAAKojD,OAAOjY,MAAM,EAAGnrC,KAAKojD,OAAO9iD,OAAO,KAEhDN,KAAKqjD,YAAcrjD,KAAKqjD,UAAYrjD,KAAKojD,OAAO9iD,OACzCN,KAAKojD,OAAOpjD,KAAKqjD,aAGzBlK,KAAM,SAAUjrC,EAAU4xC,GAEzB,OAAOoD,yCAAM/J,KAAMn5C,KAAKsjD,iBAAkBp1C,EAAU4xC,IAGrDC,SAAU,SAAU7xC,EAAU4xC,GAE7B,OAAOoD,yCAAMnD,SAAU//C,KAAKsjD,iBAAkBp1C,EAAU4xC,IAGzDyD,OAAQ,SAAU92C,EAAOyB,EAAU4xC,GAElC,OAAOoD,yCAAM/J,KAAMn5C,KAAKojD,OAAO32C,EAAQzM,KAAKojD,OAAO9iD,QAAS4N,EAAU4xC,IAGvE0D,WAAY,SAAU/2C,EAAOyB,EAAU4xC,GAEtC,OAAOoD,yCAAMnD,SAAU//C,KAAKojD,OAAO32C,EAAQzM,KAAKojD,OAAO9iD,QAAS4N,EAAU4xC,MChE9B,MAAM2D,0CAAWlN,yCAEfmN,0CAASjN,yCAECkN,0CAAc/M,yCAEKgN,0CAAuBtK,yCAE5CuK,0CAAa9J,yCAEvB+J,0CAAQZ,yCAEGa,0CAAaZ,yCCbtE,IAAAtrC,OAAAxZ,cAAA;AAIA2lD,yCAAensC,OAAAK,MAAM3R,OACpB,CACA9B,UAAW,gBAEXmzC,MAAO,KACPqM,UAAW,KACXC,MAAO,KAMPx/C,OAAQ,WAEP1E,KAAK43C,MAAQ,GACb53C,KAAKikD,UAAY,IAOlB10C,IAAK,SAAUxK,GAEd,OAAc,MAAVA,EACI,MAEF,aAAcA,IACnBA,EAAOo/C,SAAW,IAEbp/C,EAAOo/C,YAAYnkD,KAAK43C,QAE7B53C,KAAK43C,MAAM7yC,EAAOo/C,UAAY,CAAEC,UAAU,EAAO19C,KAAM,IACvD1G,KAAKikD,UAAUphD,KAAKkC,EAAOo/C,UAE3BnkD,KAAKkkD,MAAQ1mD,OAAO6M,KAAKrK,KAAK43C,OAAOjoC,MAAK,CAACC,EAAEC,IAAMD,EAAEC,MAGG,IAArD7P,KAAK43C,MAAM7yC,EAAOo/C,UAAUz9C,KAAKlF,QAAQuD,IAC5C/E,KAAK43C,MAAM7yC,EAAOo/C,UAAUz9C,KAAK7D,KAAKkC,GAEhCA,IAORvE,OAAQ,SAAUuE,GAEjB,GAAc,MAAVA,EACH,OAAO,KAKR,GAHM,aAAcA,IACnBA,EAAOo/C,SAAW,MAEbp/C,EAAOo/C,YAAYnkD,KAAK43C,OAC7B,OAAO7yC,EAER,IAAI1E,EAAIL,KAAK43C,MAAM7yC,EAAOo/C,UAAUz9C,KAAKlF,QAAQuD,GACjD,OAAU,IAAN1E,IAEJL,KAAK43C,MAAM7yC,EAAOo/C,UAAUC,UAAW,EACvCpkD,KAAK43C,MAAM7yC,EAAOo/C,UAAUz9C,KAAKrG,GAAK,MAHjB0E,GAYtBs/C,QAAS,WAER,IAAK,IAAIhkD,EAAI,EAAGA,EAAIL,KAAKikD,UAAU3jD,OAAQD,IAC3C,CACC,IAAIikD,EAAItkD,KAAK43C,MAAM53C,KAAKikD,UAAU5jD,IAClC,GAAKikD,EAAEF,SAAP,CAEA,IAAK,IAAIlhD,EAAI,EAAGA,EAAIohD,EAAE59C,KAAKpG,OAAQ4C,IAEjB,MAAbohD,EAAE59C,KAAKxD,IAEVohD,EAAE59C,KAAKjG,OAAOyC,IAAK,GAIrBohD,EAAEF,UAAW,KASfjjC,QAAS,SAAUjT,GAElB,IAAIk2C,GAAW,EACXG,GAAc,EAElB,IAAK,IAAIlkD,EAAI,GAAIkkD,GAAelkD,EAAIL,KAAKkkD,MAAM5jD,OAAQD,IACvD,CACC,IAAIqG,EAAO1G,KAAK43C,MAAM53C,KAAKkkD,MAAM7jD,IAAIqG,KAErC,IAAK,IAAIxD,EAAI,GAAIqhD,GAAerhD,EAAIwD,EAAKpG,OAAQ4C,IAEjC,MAAXwD,EAAKxD,KAEkB,IAAtBgL,EAASxH,EAAKxD,MACjBqhD,GAAc,GAGD,MAAX79C,EAAKxD,KACRkhD,GAAW,GAIVA,GAAUpkD,KAAKqkD,WAQpBjjC,WAAY,SAAUlT,GAErB,IAAIk2C,GAAW,EACXG,GAAc,EAElB,IAAK,IAAIlkD,EAAIL,KAAKkkD,MAAM5jD,OAAO,GAAIikD,GAAelkD,GAAK,EAAGA,IAC1D,CACC,IAAIqG,EAAO1G,KAAK43C,MAAM53C,KAAKkkD,MAAM7jD,IAAIqG,KAErC,IAAK,IAAIxD,EAAIwD,EAAKpG,OAAO,GAAIikD,GAAerhD,GAAK,EAAGA,IAEpC,MAAXwD,EAAKxD,KAEkB,IAAtBgL,EAASxH,EAAKxD,MACjBqhD,GAAc,GAGD,MAAX79C,EAAKxD,KACRkhD,GAAW,GAIVA,GAAUpkD,KAAKqkD,WASpBG,aAAc,SAAUt2C,EAAU8pC,EAAiB,MAElD,IAAIha,EAAIh+B,KAEJokD,GAAW,EACXG,GAAc,EAEdlkD,GAAI,EACJ6C,GAAI,EAEJwD,EAAO,KAEP+9C,EAAS,WAEZvhD,KAEKqhD,GAAerhD,EAAIwD,EAAKpG,QAEb,MAAXoG,EAAKxD,KAE0B,IAA9BgL,EAASxH,EAAKxD,GAAIuhD,KACrBF,GAAc,GAGD,MAAX79C,EAAKxD,KACRkhD,GAAW,GAERG,GAAaE,KAGjBC,KAGEA,EAAS,WAEZrkD,KAEKkkD,GAAelkD,EAAI29B,EAAEkmB,MAAM5jD,QAE/BoG,EAAOs3B,EAAE4Z,MAAM5Z,EAAEkmB,MAAM7jD,IAAIqG,KAC3BxD,GAAI,EACJuhD,MAIIL,GAAUpmB,EAAEqmB,UACZrM,GAAkBA,MAIxB0M,KASDC,gBAAiB,SAAUz2C,GAE1B02C,MAAM,uCC9NR/sC,OAAAxZ,cAAA,SCAAwZ,OAAAxZ,cAAA;;;AAWA,MAAMwmD,+BAAWhtC,OAAAK,MAAM3R,OACtB,CACA9B,UAAW,WAKXyJ,SAAU,KAKV42C,KAAM,KACNC,KAAM,KACNC,KAAM,KACNC,KAAM,KACNC,KAAM,KACNC,KAAM,KAKNl8C,KAAM,KACNlC,KAAM,KAMNrC,OAAQ,SAAUwJ,EAAU42C,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAEvFnlD,KAAKkO,SAAWA,EAEhBlO,KAAK8kD,KAAOA,EACZ9kD,KAAK+kD,KAAOA,EACZ/kD,KAAKglD,KAAOA,EACZhlD,KAAKilD,KAAOA,EACZjlD,KAAKklD,KAAOA,EACZllD,KAAKmlD,KAAOA,EAEZnlD,KAAKiJ,KAAO,KACZjJ,KAAK+G,KAAO,MAMbpC,OAAQ,WAEP3E,KAAKkO,SAAW,KAEhBlO,KAAK8kD,KAAO,KACZ9kD,KAAK+kD,KAAO,KACZ/kD,KAAKglD,KAAO,KACZhlD,KAAKilD,KAAO,KACZjlD,KAAKklD,KAAO,KACZllD,KAAKmlD,KAAO,KAEZnlD,KAAKiJ,KAAO,KACZjJ,KAAK+G,KAAO,MAMbq+C,QAAS,SAAUl3C,EAAS,KAAM42C,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAE7F,OAAiB,OAAbj3C,GAAqB22C,+BAAS9jC,WAAW7S,GACrCA,IAAalO,MAEJ,OAAbkO,GAAqBlO,KAAKkO,WAAaA,MAG9B,OAAT42C,GAAiB9kD,KAAK8kD,OAASA,MAGtB,OAATC,GAAiB/kD,KAAK+kD,OAASA,MAGtB,OAATC,GAAiBhlD,KAAKglD,OAASA,MAGtB,OAATC,GAAiBjlD,KAAKilD,OAASA,MAGtB,OAATC,GAAiBllD,KAAKklD,OAASA,KAGtB,OAATC,GAAiBnlD,KAAKmlD,OAASA,SAWpCE,KAAM,SAAUC,GAEf,OAAsB,OAAlBtlD,KAAKkO,UACDlO,KAAKkO,SAAUo3C,EAAMtlD,KAAK8kD,KAAM9kD,KAAK+kD,KAAM/kD,KAAKglD,KAAMhlD,KAAKilD,KAAMjlD,KAAKklD,KAAMllD,KAAKmlD;;;iBAgB3FnnC;yCAAS+B,WAAW8kC,+BAAU,MAAO,M,IACrCU,yCAAeV;;;gBDrHf;MAAMW,8BAAU3tC,OAAAK,MAAM3R,OACrB,CACA9B,UAAW,UAMX6gD,KAAM,KAKN9kC,IAAK,KACLC,OAAQ,KAMR/b,OAAQ,SAAU4gD,EAAK,MAOtB,OALAtlD,KAAKslD,KAAOA,EAEZtlD,KAAKwgB,IAAM,KACXxgB,KAAKygB,OAAS,KAEPzgB,MAMR2E,OAAQ,WAEP3E,KAAKQ,UAON+O,IAAK,SAAUrB,EAAU42C,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAEpF,IAAI7E,EAAOiF,yCAASxkC,WAAW7S,GAAYA,EAAWq3C,yCAASvlC,KAAKX,MAAMnR,EAAU42C,EAAMC,EAAMC,EAAMC,EAAMC,EAAMC,GAYlH,OAVA7E,EAAKr3C,KAAOjJ,KAAKygB,OAEG,OAAhBzgB,KAAKygB,SACRzgB,KAAKygB,OAAO1Z,KAAOu5C,GAEpBtgD,KAAKygB,OAAS6/B,EAEG,OAAbtgD,KAAKwgB,MACRxgB,KAAKwgB,IAAM8/B,GAELA,GAORngC,OAAQ,SAAUmgC,GAejB,OAbIA,EAAKr3C,OAAMq3C,EAAKr3C,KAAKlC,KAAOu5C,EAAKv5C,MACjCu5C,EAAKv5C,OAAMu5C,EAAKv5C,KAAKkC,KAAOq3C,EAAKr3C,MAEjCjJ,KAAKwgB,MAAQ8/B,IAChBtgD,KAAKwgB,IAAM8/B,EAAKv5C,MAEb/G,KAAKygB,SAAW6/B,IACnBtgD,KAAKygB,OAAS6/B,EAAKr3C,MAEpBq3C,EAAKr3C,KAAO,KACZq3C,EAAKv5C,KAAO,KAEZ6Z,QAAQ0/B,GACDtgD,MAORQ,OAAQ,SAAU0N,EAAS,KAAM42C,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAE5F,GAAiB,OAAbj3C,GAAqBq3C,yCAASxkC,WAAW7S,GAG5C,OADAlO,KAAKmgB,OAAOjS,GACLlO,KAGR,IAAIsgD,EAAOtgD,KAAKwgB,IAEhB,KAAgB,OAAT8/B,GACP,CACC,IAAIv5C,EAAOu5C,EAAKv5C,KAEZu5C,EAAK8E,QAAQl3C,EAAU42C,EAAMC,EAAMC,EAAMC,EAAMC,EAAMC,IACxDnlD,KAAKmgB,OAAOmgC,GAEbA,EAAOv5C,EAGR,OAAO/G,MAORiN,KAAM,SAAUiB,EAAU42C,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAErF,IAAI7E,EAAOtgD,KAAKwgB,IAEhB,KAAgB,OAAT8/B,GACP,CACC,GAAIA,EAAK8E,QAAQl3C,EAAU42C,EAAMC,EAAMC,EAAMC,EAAMC,EAAMC,GACxD,OAAO7E,EAERA,EAAOA,EAAKv5C,KAGb,OAAO,MAORs+C,KAAM,SAAUC,EAAK,MAEpB,IAAIhF,EAAOtgD,KAAKwgB,IAIhB,IAFA8kC,EAAOA,GAAQtlD,KAAKslD,KAEJ,OAAThF,GACP,CACC,IAAIv5C,EAAOu5C,EAAKv5C,KAEZ9H,EAAQqhD,EAAK+E,KAAKC,GACtB,GAAc,OAAVrmD,EAAgB,OAEN,IAAVA,GACHe,KAAKmgB,OAAOmgC,GAEbA,EAAOv5C,IAQT0+C,MAAO,SAAUv3C,EAAS,KAAM42C,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAE3F,IAAI7E,EAAOtgD,KAAKwgB,IAEhB,KAAgB,OAAT8/B,GACP,CACC,IAAIv5C,EAAOu5C,EAAKv5C,KAEhB,GAAIu5C,EAAK8E,QAAQl3C,EAAU42C,EAAMC,EAAMC,EAAMC,EAAMC,EAAMC,GACzD,EAC8B,IAAzB7E,EAAK+E,KAAKrlD,KAAKslD,OAClBtlD,KAAKmgB,OAAOmgC,GAEb,MAGDA,EAAOv5C,IAQT2+C,MAAO,SAAUpF,EAAMgF,EAAK,OAEU,IAAjChF,EAAK+E,KAAKC,GAAQtlD,KAAKslD,OAC1BtlD,KAAKmgB,OAAOmgC;;;iBAcftiC;yCAAS+B,WAAWylC,8BAAS,MAAO,M,IACpCG,yCAAeH,8BElNf3tC,OAAAxZ,cAAA;;;;AAYA,MAAMunD,2BAAO/tC,OAAAK,MAAM3R,OAClB,CACA9B,UAAW,OAUXuf,GAAI,EAIJC,GAAI,EAIJ2R,GAAI,EAIJC,GAAI,EAIJC,GAAI,EAIJC,GAAI,EAcJrxB,OAAQ,SAAUkxB,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAE/C,OAAW,OAAPH,GAEH51B,KAAK41B,GAAK51B,KAAK61B,GAAK71B,KAAK81B,GAAK91B,KAAK+1B,GAAK/1B,KAAKgkB,GAAKhkB,KAAKikB,GAAK,EACrDjkB,MAGG,OAAP81B,GAEH91B,KAAKrC,IAAK,EAAG,EAAG,EAAG,GACnBqC,KAAKwzB,OAAQoC,EAAIC,GACV71B,MAGDA,KAAKrC,IAAIi4B,EAAIC,EAAIC,EAAIC,IAM7BpxB,OAAQ,aAQRhC,MAAO,WAEN,OAAOijD,2BAAKC,KAAKxmC,MAAMrf,KAAK41B,GAAI51B,KAAK61B,GAAI71B,KAAK81B,GAAI91B,KAAK+1B,KAOxDxS,KAAM,WAML,OAJAvjB,KAAKgkB,GAAK,EAAGhkB,KAAKikB,GAAK,EACvBjkB,KAAK41B,GAAK,EAAG51B,KAAK61B,GAAK,EACvB71B,KAAK81B,GAAK,EAAG91B,KAAK+1B,GAAK,EAEhB/1B,MAORiI,MAAO,WAMN,OAJAjI,KAAKgkB,GAAK,KAAMhkB,KAAKikB,GAAK,KAC1BjkB,KAAK41B,GAAK,KAAM51B,KAAK61B,GAAK,KAC1B71B,KAAK81B,GAAK,KAAM91B,KAAK+1B,GAAK,KAEnB/1B,MAWR8lD,gBAAiB,SAAUpxC,EAAG0O,EAAE,MAE/B,GAAU,OAANA,EACJ,CACC,MAAM9lB,EAAIoX,EACVA,EAAIpX,EAAEoX,EACN0O,EAAI9lB,EAAE8lB,EAWP,OARgB,OAAZpjB,KAAK41B,IAAelhB,EAAI1U,KAAK41B,MAAI51B,KAAK41B,GAAKlhB,IAC/B,OAAZ1U,KAAK61B,IAAezS,EAAIpjB,KAAK61B,MAAI71B,KAAK61B,GAAKzS,IAC/B,OAAZpjB,KAAK81B,IAAephB,EAAI1U,KAAK81B,MAAI91B,KAAK81B,GAAKphB,IAC/B,OAAZ1U,KAAK+1B,IAAe3S,EAAIpjB,KAAK+1B,MAAI/1B,KAAK+1B,GAAK3S,GAE/CpjB,KAAKgkB,IAAMhkB,KAAK41B,GAAK51B,KAAK81B,IAAM,EAChC91B,KAAKikB,IAAMjkB,KAAK61B,GAAK71B,KAAK+1B,IAAM,EAEzB/1B,MAOR2jB,UAAW,SAAUC,EAAIC,GAMxB,OAJA7jB,KAAK41B,IAAMhS,EAAI5jB,KAAK61B,IAAMhS,EAC1B7jB,KAAK81B,IAAMlS,EAAI5jB,KAAK+1B,IAAMlS,EAC1B7jB,KAAKgkB,IAAMJ,EAAI5jB,KAAKikB,IAAMJ,EAEnB7jB,MAQR+lD,SAAU,SAAUrxC,EAAG0O,EAAGs1B,GAAW,GAQpC,OANkB,GAAdA,IAEHhkC,EAAI1U,KAAK41B,GAAKlhB,GAAG1U,KAAK81B,GAAK91B,KAAK41B,IAChCxS,EAAIpjB,KAAK61B,GAAKzS,GAAGpjB,KAAK+1B,GAAK/1B,KAAK61B,KAG1B71B,KAAK2jB,UAAWjP,EAAI1U,KAAKgkB,GAAIZ,EAAIpjB,KAAKikB,KAW9CtmB,IAAK,SAAUi4B,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAEvC,GAAW,OAAPF,EACJ,CACC,MAAMv4B,EAAIs4B,EACVA,EAAKt4B,EAAEs4B,GAAIC,EAAKv4B,EAAEu4B,GAClBC,EAAKx4B,EAAEw4B,GAAIC,EAAKz4B,EAAEy4B,GAWnB,OARA/1B,KAAKgkB,IAAM4R,EAAKE,GAAM,EACtB91B,KAAKikB,IAAM4R,EAAKE,GAAM,EAEtB/1B,KAAK41B,GAAKA,EACV51B,KAAK61B,GAAKA,EACV71B,KAAK81B,GAAKA,EACV91B,KAAK+1B,GAAKA,EAEH/1B,MAWRyjB,OAAQ,SAAUmS,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAE1C,GAAW,OAAPF,EACJ,CACC,MAAMv4B,EAAIs4B,EACVA,EAAKt4B,EAAEs4B,GAAIC,EAAKv4B,EAAEu4B,GAClBC,EAAKx4B,EAAEw4B,GAAIC,EAAKz4B,EAAEy4B,GAGnB,OAAOH,GAAM51B,KAAK41B,IAAME,GAAM91B,KAAK81B,IAAMD,GAAM71B,KAAK61B,IAAME,GAAM/1B,KAAK+1B,IAWtErf,SAAU,SAAUkf,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAE5C,GAAW,OAAPF,EACJ,CACC,MAAMv4B,EAAIs4B,EACVA,EAAKt4B,EAAEs4B,GAAIC,EAAKv4B,EAAEu4B,GAClBC,EAAKx4B,EAAEw4B,GAAIC,EAAKz4B,EAAEy4B,GAGnB,OAAOH,GAAOnoB,KAAKg/B,IAAIzsC,KAAK41B,GAAIA,IAASC,GAAMpoB,KAAKg/B,IAAIzsC,KAAK61B,GAAIA,IAASC,GAAMroB,KAAK0R,IAAInf,KAAK81B,GAAIA,IAASC,GAAMtoB,KAAK0R,IAAInf,KAAK+1B,GAAIA,IAWpIiwB,WAAY,SAAUpwB,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAE9C,GAAW,OAAPF,EACJ,CACC,MAAMv4B,EAAIs4B,EACVA,EAAKt4B,EAAEs4B,GAAIC,EAAKv4B,EAAEu4B,GAClBC,EAAKx4B,EAAEw4B,GAAIC,EAAKz4B,EAAEy4B,GAQnB,OALA/1B,KAAK41B,GAAKnoB,KAAK0R,IAAInf,KAAK41B,GAAIA,GAC5B51B,KAAK61B,GAAKpoB,KAAK0R,IAAInf,KAAK61B,GAAIA,GAC5B71B,KAAK81B,GAAKroB,KAAKg/B,IAAIzsC,KAAK81B,GAAIA,GAC5B91B,KAAK+1B,GAAKtoB,KAAKg/B,IAAIzsC,KAAK+1B,GAAIA,GAErB/1B,MAWRimD,WAAY,SAAUrwB,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAE9C,GAAW,OAAPF,EACJ,CACC,MAAMv4B,EAAIs4B,EACVA,EAAKt4B,EAAEs4B,GAAIC,EAAKv4B,EAAEu4B,GAClBC,EAAKx4B,EAAEw4B,GAAIC,EAAKz4B,EAAEy4B,GAGnB,IAAImwB,EAAMz4C,KAAKg/B,IAAIzsC,KAAK41B,GAAIA,GACxBuwB,EAAM14C,KAAKg/B,IAAIzsC,KAAK61B,GAAIA,GACxBuwB,EAAM34C,KAAK0R,IAAInf,KAAK81B,GAAIA,GACxBuwB,EAAM54C,KAAK0R,IAAInf,KAAK+1B,GAAIA,GAE5B,OAAOtoB,KAAKg/B,IAAI,EAAG4Z,EAAIF,GAAO14C,KAAKg/B,IAAI,EAAG2Z,EAAIF,GAAO,GAatDI,kBAAmB,SAAU1wB,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAErD,GAAW,OAAPF,EACJ,CACC,MAAMv4B,EAAIs4B,EACVA,EAAKt4B,EAAEs4B,GAAIC,EAAKv4B,EAAEu4B,GAClBC,EAAKx4B,EAAEw4B,GAAIC,EAAKz4B,EAAEy4B,GAQnB,OALA/1B,KAAK41B,GAAKnoB,KAAKg/B,IAAIzsC,KAAK41B,GAAIA,GAC5B51B,KAAK61B,GAAKpoB,KAAKg/B,IAAIzsC,KAAK61B,GAAIA,GAC5B71B,KAAK81B,GAAKroB,KAAK0R,IAAInf,KAAK81B,GAAIA,GAC5B91B,KAAK+1B,GAAKtoB,KAAK0R,IAAInf,KAAK+1B,GAAIA,GAErBtoB,KAAKg/B,IAAI,EAAGzsC,KAAK+1B,GAAG/1B,KAAK61B,IAAMpoB,KAAKg/B,IAAI,EAAGzsC,KAAK81B,GAAG91B,KAAK41B,IAAM,GAStEpC,OAAQ,SAAUiB,EAAGC,EAAG6xB,GAAgB,EAAO7N,GAAW,GAqBzD,OAnBkB,GAAdA,IAEHjkB,GAAMz0B,KAAK81B,GAAK91B,KAAK41B,GACrBlB,GAAM10B,KAAK+1B,GAAK/1B,KAAK61B,IAGC,GAAnB0wB,GAEHvmD,KAAK81B,GAAK91B,KAAK41B,GAAKnB,EACpBz0B,KAAK+1B,GAAK/1B,KAAK61B,GAAKnB,IAIpBD,GAAK,EAAGC,GAAK,EAEb10B,KAAK41B,GAAK51B,KAAKgkB,GAAKyQ,EAAGz0B,KAAK61B,GAAK71B,KAAKikB,GAAKyQ,EAC3C10B,KAAK81B,GAAK91B,KAAKgkB,GAAKyQ,EAAGz0B,KAAK+1B,GAAK/1B,KAAKikB,GAAKyQ,GAGrC10B,MAQRwmD,SAAU,SAAU9vB,EAAIC,EAAI4vB,GAAgB,GAe3C,OAbuB,GAAnBA,GAEHvmD,KAAK81B,IAAMY,EACX12B,KAAK+1B,IAAMY,IAIXD,GAAM,EAAGC,GAAM,EAEf32B,KAAK41B,IAAMc,EAAI12B,KAAK61B,IAAMc,EAC1B32B,KAAK81B,IAAMY,EAAI12B,KAAK+1B,IAAMY,GAGpB32B,MAORiuB,MAAO,WAEN,OAAOjuB,KAAK81B,GAAK91B,KAAK41B,IAOvB1H,OAAQ,WAEP,OAAOluB,KAAK+1B,GAAK/1B,KAAK61B,IAOvB4wB,IAAK,WAEJ,OAAQzmD,KAAKgkB,GAAKhkB,KAAK41B,KAAO51B,KAAK81B,GAAK91B,KAAK41B,KAO9C8wB,IAAK,WAEJ,OAAQ1mD,KAAKikB,GAAKjkB,KAAK61B,KAAO71B,KAAK+1B,GAAK/1B,KAAK61B,KAO9C8wB,QAAS,WAER,OAAO3mD,KAAK41B,IAAM51B,KAAK81B,IAAM91B,KAAK61B,IAAM71B,KAAK+1B,IAQ9C6wB,cAAe,SAAUlyC,EAAG0O,EAAGyjC,EAAI,GAElC,OAAO7mD,KAAM41B,GAAGixB,GAAOnyC,GAAKA,GAAK1U,KAAK81B,GAAG+wB,GAAS7mD,KAAK61B,GAAGgxB,GAAOzjC,GAAKA,GAAKpjB,KAAK+1B,GAAG8wB,GAQpFC,KAAM,SAAUv2C,GAEf,OAAOA,EAAUvQ,KAAK2mD,WAAa3mD,KAAK+1B,GAAG/1B,KAAK61B,KAAK71B,KAAK81B,GAAG91B,KAAK41B,IAAM,GAAO51B,KAAK+1B,GAAG/1B,KAAK61B,KAAK71B,KAAK81B,GAAG91B,KAAK41B,KAO/GtR,MAAO,WAQN,OANAtkB,KAAK41B,GAAKnoB,KAAK6W,MAAMtkB,KAAK41B,IAC1B51B,KAAK61B,GAAKpoB,KAAK6W,MAAMtkB,KAAK61B,IAC1B71B,KAAK81B,GAAKroB,KAAK6W,MAAMtkB,KAAK81B,IAC1B91B,KAAK+1B,GAAKtoB,KAAK6W,MAAMtkB,KAAK+1B,IAC1B/1B,KAAKgkB,GAAKvW,KAAK6W,MAAMtkB,KAAKgkB,IAC1BhkB,KAAKikB,GAAKxW,KAAK6W,MAAMtkB,KAAKikB,IACnBjkB,MAORs3C,KAAM,WAQL,OANAt3C,KAAK41B,GAAKnoB,KAAK6pC,KAAKt3C,KAAK41B,IACzB51B,KAAK61B,GAAKpoB,KAAK6pC,KAAKt3C,KAAK61B,IACzB71B,KAAK81B,GAAKroB,KAAK6pC,KAAKt3C,KAAK81B,IACzB91B,KAAK+1B,GAAKtoB,KAAK6pC,KAAKt3C,KAAK+1B,IACzB/1B,KAAKgkB,GAAKvW,KAAK6pC,KAAKt3C,KAAKgkB,IACzBhkB,KAAKikB,GAAKxW,KAAK6pC,KAAKt3C,KAAKikB,IAClBjkB,MAORJ,SAAU,WAET,MAAO,IAAMI,KAAK41B,GAAGhW,QAAQ,GAAK,KAAO5f,KAAK61B,GAAGjW,QAAQ,GAAK,KAAO5f,KAAK81B,GAAGlW,QAAQ,GAAK,KAAO5f,KAAK+1B,GAAGnW,QAAQ,GAAK,KAOvHjW,QAAS,WAER,MAAO,CAAC3J,KAAK41B,GAAI51B,KAAK61B,GAAI71B,KAAK81B,GAAI91B,KAAK+1B,KAOzC5oB,UAAW,SAAU3K,GAGpB,OADAxC,KAAKrC,IAAK6E,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,IACvBxC;;;iBAsBTge;yCAAS+B,WAAY6lC,2BAAM,KAAM,M,IACjCmB,yCAAenB,2BCpgBf/tC,OAAAxZ,cAAA;;AASA,MAAM2oD,gCAAYnvC,OAAAK,MAAM3R,OACvB,CACA9B,UAAW,YAMXpH,EAAG,KAMH+lB,EAAG,KAMH5Q,EAAG,KAOH9N,OAAQ,SAAUzF,EAAM,GAEvBe,KAAKiI,MAAMhJ,IAQZgJ,MAAO,SAAUhJ,EAAM,GAMtB,OAJAe,KAAK3C,EAAI,CAAC,GACV2C,KAAKojB,EAAI,CAACnkB,GACVe,KAAKwS,EAAI,CAAC,MAEHxS,MAWRinD,SAAU,SAAU71B,EAAK81B,EAAIC,GAM5B,GAJAnnD,KAAK3C,EAAI,GACT2C,KAAKojB,EAAI,GACTpjB,KAAKwS,EAAI,GAEC,MAAN00C,GAAoB,MAANC,EAClB,CACC,IAAK,IAAI9mD,EAAI,EAAGA,EAAI+wB,EAAI/zB,EAAEiD,OAAQD,IAEjCL,KAAK3C,EAAEwF,KAAKuuB,EAAI/zB,EAAEgD,IAClBL,KAAKojB,EAAEvgB,KAAKuuB,EAAIhO,EAAE/iB,IAClBL,KAAKwS,EAAE3P,KAAKuuB,EAAI5e,EAAEnS,IAGnB,OAAOL,KAGE,MAANknD,IAAYA,EAAK91B,EAAI/zB,EAAE,IACjB,MAAN8pD,IAAYA,EAAK/1B,EAAI/zB,EAAE+zB,EAAI/zB,EAAEiD,OAAO,IAEpC4mD,EAAK91B,EAAI/zB,EAAE,KAAI6pD,EAAK91B,EAAI/zB,EAAE,IAE9B,IAAI+pD,EAAKh2B,EAAInkB,KAAKi6C,GACd/jD,EAAKiuB,EAAInkB,KAAKk6C,GAElB,GAAU,MAANC,EAAY,OAAO,KACvB,GAAU,MAANjkD,EAAY,OAAO,KAEnBiuB,EAAI/zB,EAAE+pD,IAAOF,IAChBlnD,KAAKrC,IAAIupD,EAAI91B,EAAI5kB,MAAM06C,GAAK91B,EAAI5e,EAAE40C,IAClCA,KAGD,IAAK,IAAI/mD,EAAI+mD,EAAI/mD,GAAK8C,EAAI9C,IACzBL,KAAKrC,IAAIyzB,EAAI/zB,EAAEgD,GAAI+wB,EAAIhO,EAAE/iB,GAAI+wB,EAAI5e,EAAEnS,IAEpC,GAAI+wB,EAAI/zB,EAAE8F,IAAOgkD,EACjB,CACC,IAAIzf,GAAMyf,EAAK/1B,EAAI/zB,EAAE8F,IAAOsK,KAAK6pC,KAAK7pC,KAAKgJ,IAAI0wC,EAAK/1B,EAAI/zB,EAAE8F,KACtD9F,EAAI2C,KAAK3C,EAAE2C,KAAK3C,EAAEiD,OAAO,GAI7B,IAFIonC,GAAM,IAAGA,EAAK,GACrBA,EAAKyf,EAAG9pD,EACEA,GAAK8pD,GAEP9pD,EAAEqqC,EAAKyf,IACVzf,EAAKyf,EAAK9pD,GAEXA,GAAKqqC,EACL1nC,KAAKrC,IAAIgtC,OAAOttC,GAAI+zB,EAAI5kB,MAAMnP,GAAI+zB,EAAI5e,EAAErP,IAI1C,OAAOnD,MASR2C,MAAO,SAAUukD,EAAIC,GAEpB,OAAO,IAAKH,iCAAaC,SAASjnD,KAAMknD,EAAIC,IAQ7CtiB,QAAS,SAAUb,EAAM,GAExB,OAAOhkC,KAAK3C,EAAE2C,KAAK3C,EAAEiD,OAAO,GAAK0jC,GAQlCliB,UAAW,SAAUkiB,EAAM,GAE1B,OAAOhkC,KAAK3C,EAAE,GAAK2mC,GASpB/2B,KAAM,SAAUmsB,GAEf,GAAIA,EAAOp5B,KAAK3C,EAAE,GACjB,OAAO,KAER,MAAME,EAAIyC,KAAK3C,EAAEiD,OAEjB,IAAK,IAAID,EAAI,EAAGA,EAAI9C,EAAG8C,IAEtB,GAAI+4B,EAAOp5B,KAAK3C,EAAEgD,GACjB,OAAOA,EAAE,EAGX,OAAO9C,EAAE,GAUVI,IAAK,SAAUN,EAAG+lB,EAAG5Q,EAAE,MAEtB,IAAInS,EAAIL,KAAKiN,KAAK5P,GAClB,OAAS,MAALgD,IAEAL,KAAK3C,EAAEgD,IAAMhD,GAEhB2C,KAAKojB,EAAE/iB,GAAK+iB,EACH,MAAL5Q,IAAWxS,KAAKwS,EAAEnS,GAAKmS,KAI3BnS,IACAL,KAAK3C,EAAEoD,OAAOJ,EAAG,EAAGhD,GACpB2C,KAAKojB,EAAE3iB,OAAOJ,EAAG,EAAG+iB,GACpBpjB,KAAKwS,EAAE/R,OAAOJ,EAAG,EAAGmS,KAGd,IAOR9U,IAAK,WAEJ,OAAOsC,KAAKojB,EAAEpjB,KAAKojB,EAAE9iB,OAAO,IAQ7BkM,MAAO,SAAUnP,GAEhB,IAAI+pD,EAAKpnD,KAAKiN,KAAK5P,GACnB,GAAU,MAAN+pD,EAAY,OAAO,EAEvB,IAAIjkD,EAAKikD,EAAK,EAEd,GAAIpnD,KAAK3C,EAAE+pD,IAAO/pD,GAAK8F,GAAMnD,KAAK3C,EAAEiD,QAAUN,KAAKojB,EAAEgkC,IAAOpnD,KAAKojB,EAAEjgB,IAAqB,MAAdnD,KAAKwS,EAAE40C,GAChF,OAAOpnD,KAAKojB,EAAEgkC,GAEf,GAAkB,MAAdpnD,KAAKwS,EAAE40C,GACV,OAAOpnD,KAAKojB,EAAEgkC,GAEf,IAAI1yC,EAAIrX,EACJ8wC,EAAKnuC,KAAK3C,EAAE+pD,GACZxxB,EAAK51B,KAAK3C,EAAE8F,GACZkkD,EAAKrnD,KAAKojB,EAAEgkC,GACZvxB,EAAK71B,KAAKojB,EAAEjgB,GAKhB,OAHA9F,GAAKqX,EAAIy5B,IAAOvY,EAAKuY,IACrB9wC,EAAI2C,KAAKwS,EAAE40C,GAAI/pD,IAENw4B,GAAM,EAAEx4B,GAAGgqD,GAWrBC,SAAU,SAAUJ,EAAG,KAAMC,EAAG,KAAMI,EAAG,GAE9B,MAANL,IAAYA,EAAKlnD,KAAK3C,EAAE,IAClB,MAAN8pD,IAAYA,EAAKnnD,KAAK3C,EAAE2C,KAAK3C,EAAEiD,OAAO,IAEtC4mD,EAAKlnD,KAAK3C,EAAE,KAAI6pD,EAAKlnD,KAAK3C,EAAE,IAEhC,IAAI0nB,EAAO,EAEX,GAAImiC,EAAKC,EAAI,CACZ,IAAI/5C,EAAKA,EAAM85C,EAAIA,EAAKC,EAAIA,EAAK/5C,EACjC2X,GAAO,EAGR,IAAIyiC,EAAQD,EAEZ,IAAK,IAAInuB,EAAO8tB,EAAI9tB,EAAO+tB,GAC3B,CACC,IAAIC,EAAKpnD,KAAKiN,KAAKmsB,GACnB,GAAU,MAANguB,EAAY,OAAO,EAEvB,IAAIjkD,EAAKikD,EAAK,EAEVjZ,EAAK1gC,KAAKg/B,IAAIzsC,KAAK3C,EAAE+pD,GAAKhuB,GAC1BxD,EAAKnoB,KAAK0R,IAAIhc,EAAKnD,KAAK3C,EAAEiD,OAASN,KAAK3C,EAAE8F,GAAMgkD,EAAIA,GAEpDE,EAAKrnD,KAAKwM,MAAM2hC,GAGhBvqB,EAAKgS,EAAKuY,EACVtqB,EAHK7jB,KAAKwM,MAAMopB,GAGNyxB,EAEI,MAAdrnD,KAAKwS,EAAE40C,GACVI,GAASH,EAAGzjC,EAEZ4jC,GAAS,GAAI3jC,GAAI+R,EAAGuY,GAAMA,EAAGtqB,EAAKwjC,EAAGzjC,EAEtCwV,GAAQxV,EAGT,OAAOmB,EAAKyiC,GAWbC,gBAAiB,SAAUP,EAAG,KAAMC,EAAG,KAAMI,EAAG,GAErC,MAANL,IAAYA,EAAKlnD,KAAK3C,EAAE,IAClB,MAAN8pD,IAAYA,EAAKnnD,KAAK3C,EAAE2C,KAAK3C,EAAEiD,OAAO,IAE1C,IAAI8E,EAAK4hD,gCAAUU,MAAMT,SAASjnD,KAAMA,KAAK3C,EAAE,GAAI6pD,GAAIS,UAAUJ,GAAID,WAGrE,OAFSN,gCAAUY,MAAMX,SAASjnD,KAAMA,KAAK3C,EAAE,GAAI8pD,GAAIQ,UAAUJ,GAAID,WAEzDliD,GAUbuiD,UAAW,SAAUJ,EAAG,GAEvB,IAAInkC,EAAI,GAERA,EAAEvgB,KAAK0kD,GAEP,IAAK,IAAIlnD,EAAI,EAAGA,EAAIL,KAAK3C,EAAEiD,OAAQD,IAClC+iB,EAAEvgB,KAAKugB,EAAE/iB,EAAE,GAAKL,KAAKsnD,SAAStnD,KAAK3C,EAAEgD,EAAE,GAAIL,KAAK3C,EAAEgD,KAGnD,OADAL,KAAKojB,EAAIA,EACFpjB,MAQR6nD,WAAY,SAAUN,EAAG,GAExBvnD,KAAKojB,EAAE,IAAMmkC,EAEb,IAAK,IAAIlnD,EAAI,EAAGA,EAAIL,KAAK3C,EAAEiD,OAAQD,IAClCL,KAAKojB,EAAE/iB,IAAML,KAAKojB,EAAE/iB,EAAE,GAEvB,OAAOL,MAOR8nD,SAAU,SAAUznD,GAMnB,OAJAL,KAAK3C,EAAEoD,OAAO,EAAGJ,GACjBL,KAAKwS,EAAE/R,OAAO,EAAGJ,GACjBL,KAAKojB,EAAE3iB,OAAO,EAAGJ,GAEVL,MAOR+nD,UAAW,SAAU1nD,GAMpB,OAJAL,KAAK3C,EAAEoD,OAAOJ,EAAE,EAAGL,KAAK3C,EAAEiD,OAAOD,EAAE,GACnCL,KAAKwS,EAAE/R,OAAOJ,EAAE,EAAGL,KAAKwS,EAAElS,OAAOD,EAAE,GACnCL,KAAKojB,EAAE3iB,OAAOJ,EAAE,EAAGL,KAAKojB,EAAE9iB,OAAOD,EAAE,GAE5BL,MAQRwR,IAAK,SAAUvP,GAEd,IAAK,IAAI5B,EAAI,EAAGA,EAAIL,KAAKojB,EAAE9iB,OAAQD,IAClCL,KAAKojB,EAAE/iB,GAAK4B,EAAIjC,KAAKojB,EAAE/iB,GAAIL,KAAK3C,EAAEgD,GAAIA,GAEvC,OAAOL,MAORJ,SAAU,SAAS2nD,EAAG,GAErB,IAAIv1C,EAAI,GACJg2C,EAAI,GAER,MAAMC,EAAM,SAAUhpD,EAAO1B,EAAGswC,GAO/B,IALA5uC,EAAQA,EAAMW,WAEF,MAARiuC,IAAcA,EAAO,KACzBA,EAAOA,EAAK,GAEL5uC,EAAMqB,OAAS/C,GACrB0B,GAAS4uC,EAEV,OAAO5uC,GAGR+S,GAAK,KACLA,GAAKi2C,EAAI,QAASD,GAAK,IAAMC,EAAI,SAAUD,GAAK,IAAMC,EAAI,YAAaD,GAAK,KAC5Eh2C,GAAKi2C,EAAI,GAAID,EAAG,KAAO,IAAMC,EAAI,GAAID,EAAG,KAAO,IAAMC,EAAI,GAAID,EAAG,KAAO,KAEvE,IAAK,IAAI3nD,EAAI,EAAGA,EAAIL,KAAK3C,EAAEiD,OAAQD,IAElC2R,GAAKi2C,EAAI,IAAItd,OAAO3qC,KAAK3C,EAAEgD,IAAK2nD,GAAK,IAAMC,EAAI,IAAItd,OAAO3qC,KAAKojB,EAAE/iB,IAAK2nD,GAAK,IAAMC,EAAI,IAAItd,OAAO3qC,KAAKsnD,SAAStnD,KAAK3C,EAAE,GAAI2C,KAAK3C,EAAEgD,GAAIknD,IAAMS,GAAK,KAGhJ,OAAOh2C,KAITg1C,gCAAUU,MAAQ,IAAIV,gCACtBA,gCAAUY,MAAQ,IAAIZ,gC,IAEtBkB,yCAAelB,gCCtafnvC,OAAAxZ,cAAA,SCAAwZ,OAAAxZ,cAAA;;;;AAaA,MAAM8pD,6BAAStwC,OAAAK,MAAM3R,OACpB,CACA9B,UAAW,SAOX2jD,GAAI,EAAGC,GAAI,EAOX3zC,EAAG,EAAG0O,EAAG,EAcT1e,OAAQ,SAAUgQ,EAAE,KAAM0O,EAAE,MAE3B,OAAOpjB,KAAKrC,IAAI+W,EAAG0O,IAMpBiqB,UAAW,WAIV,OAFArtC,KAAK0U,EAAI24B,UAAUrtC,KAAKooD,IACxBpoD,KAAKojB,EAAIiqB,UAAUrtC,KAAKqoD,IACjBroD,MAOR2C,MAAO,WAEN,OAAOwlD,6BAAOnoC,KAAKX,MAAMrf,OAiB1BrC,IAAK,SAAU+W,EAAG0O,EAAE,KAAMklC,GAAS,GA0BlC,OAxBU,OAAN5zC,GACHA,EAAI,EACJ0O,EAAI,GAEU,OAANA,EAEJ+kC,6BAAOpnC,WAAWrM,IACrB0O,EAAI1O,EAAE2zC,GACN3zC,EAAIA,EAAE0zC,KAENhlC,EAAIgqB,QAAQ14B,EAAE0O,GACd1O,EAAI04B,QAAQ14B,EAAEA,KAIE,IAAb4zC,IACH5zC,EAAI04B,QAAQ14B,GACZ0O,EAAIgqB,QAAQhqB,IAIdpjB,KAAKooD,GAAK1zC,EACV1U,KAAKqoD,GAAKjlC,EAEHpjB,KAAKqtC,UAAUrtC,OAOvBqjB,KAAM,SAAU3O,GAGf,OADA1U,KAAKooD,GAAKhb,QAAQ14B,GACX1U,KAAKqtC,UAAUrtC,OAOvBsjB,KAAM,SAAUF,GAGf,OADApjB,KAAKqoD,GAAKjb,QAAQhqB,GACXpjB,KAAKqtC,UAAUrtC,OAOvBujB,KAAM,WAEL,OAAOvjB,KAAKrC,IAAI,EAAG,IAOpB6lB,OAAQ,WAEP,OAAiB,GAAVxjB,KAAK0U,GAAoB,GAAV1U,KAAKojB,GAe5BK,OAAQ,SAAU/O,EAAG0O,EAAE,MAiBtB,OAfU,OAANA,EAEC+kC,6BAAOpnC,WAAWrM,IACrB0O,EAAI1O,EAAE0O,EACN1O,EAAIA,EAAEA,IAEN0O,EAAIhQ,IAAIsB,EAAE0O,GACV1O,EAAItB,IAAIsB,EAAEA,KAIXA,EAAItB,IAAIsB,GACR0O,EAAIhQ,IAAIgQ,IAGFpjB,KAAK0U,GAAKA,GAAK1U,KAAKojB,GAAKA,GAgBjC7T,IAAK,SAAUqU,EAAIC,EAAG,KAAMykC,GAAS,GAoBpC,OAlBW,OAAPzkC,EAECskC,6BAAOpnC,WAAW6C,IACrBC,EAAKD,EAAGykC,GACRzkC,EAAKA,EAAGwkC,KAERvkC,EAAKupB,QAAQxpB,EAAGR,GAChBQ,EAAKwpB,QAAQxpB,EAAGlP,KAIA,IAAb4zC,IACH1kC,EAAKwpB,QAAQxpB,GACbC,EAAKupB,QAAQvpB,IAIf7jB,KAAKooD,IAAMxkC,EAAI5jB,KAAKqoD,IAAMxkC,EACnB7jB,KAAKqtC,aAgBbv4B,IAAK,SAAU8O,EAAIC,EAAIykC,GAAS,GAoB/B,OAlBW,OAAPzkC,EAECskC,6BAAOpnC,WAAW6C,IACrBC,EAAKD,EAAGykC,GACRzkC,EAAKA,EAAGwkC,KAERvkC,EAAKupB,QAAQxpB,EAAGR,GAChBQ,EAAKwpB,QAAQxpB,EAAGlP,KAIA,IAAb4zC,IACH1kC,EAAKwpB,QAAQxpB,GACbC,EAAKupB,QAAQvpB,IAIf7jB,KAAKooD,IAAMxkC,EAAI5jB,KAAKqoD,IAAMxkC,EACnB7jB,KAAKqtC,aAObztC,SAAU,WAET,MAAO,IAAII,KAAK0U,MAAM1U,KAAKojB;;;iBAsB7BpF;yCAAS+B,WAAYooC,6BAAQ,KAAM,M,IACnCI,yCAAeJ;;;;gBDzQf;MAAMK,8BAAU3wC,OAAAK,MAAM3R,OACrB,CACA9B,UAAW,UAUXuf,GAAI,EAIJC,GAAI,EAIJ2R,GAAI,EAIJC,GAAI,EAIJC,GAAI,EAIJC,GAAI,EAKJ0yB,IAAK,EAAGC,IAAK,EACbC,IAAK,EAAGC,IAAK,EACbC,IAAK,EAAGC,IAAK,EAiBbpkD,OAAQ,SAAUkxB,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMuyB,GAAS,GAE9D,OAAW,OAAP1yB,GAEH51B,KAAK2oD,IAAM3oD,KAAK4oD,IAAM5oD,KAAK6oD,IAAM7oD,KAAK8oD,IAAM9oD,KAAKyoD,IAAMzoD,KAAK0oD,IAAM,EAC3D1oD,KAAKqtC,aAGF,OAAPxX,GAAsB,OAAPC,EACX91B,KAAKrC,IAAI,EAAG,EAAG,EAAG,GAAG61B,OAAOoC,EAAIC,GAEjC71B,KAAKrC,IAAIi4B,EAAIC,EAAIC,EAAIC,EAAIuyB,IAMjCjb,UAAW,WASV,OAPArtC,KAAK41B,GAAKyX,UAAUrtC,KAAK2oD,KACzB3oD,KAAK61B,GAAKwX,UAAUrtC,KAAK4oD,KACzB5oD,KAAK81B,GAAKuX,UAAUrtC,KAAK6oD,KACzB7oD,KAAK+1B,GAAKsX,UAAUrtC,KAAK8oD,KACzB9oD,KAAKgkB,GAAKqpB,UAAUrtC,KAAKyoD,KACzBzoD,KAAKikB,GAAKopB,UAAUrtC,KAAK0oD,KAElB1oD,MAOR+oD,MAAO,WASN,OAPA/oD,KAAK2oD,IAAMvb,QAAQptC,KAAK41B,IACxB51B,KAAK4oD,IAAMxb,QAAQptC,KAAK61B,IACxB71B,KAAK6oD,IAAMzb,QAAQptC,KAAK81B,IACxB91B,KAAK8oD,IAAM1b,QAAQptC,KAAK+1B,IACxB/1B,KAAKyoD,IAAMrb,QAAQptC,KAAKgkB,IACxBhkB,KAAK0oD,IAAMtb,QAAQptC,KAAKikB,IAEjBjkB,MAOR2C,MAAO,WAEN,OAAO6lD,8BAAQxoC,KAAKX,MAAMrf,KAAK2oD,IAAK3oD,KAAK4oD,IAAK5oD,KAAK6oD,IAAK7oD,KAAK8oD,KAAK,IAOnEvlC,KAAM,WAML,OAJAvjB,KAAK2oD,IAAM,EAAG3oD,KAAK4oD,IAAM,EACzB5oD,KAAK6oD,IAAM,EAAG7oD,KAAK8oD,IAAM,EACzB9oD,KAAKyoD,IAAM,EAAGzoD,KAAK0oD,IAAM,EAElB1oD,KAAKqtC,aAObplC,MAAO,WAUN,OARAjI,KAAK2oD,IAAM,KAAM3oD,KAAK4oD,IAAM,KAC5B5oD,KAAK6oD,IAAM,KAAM7oD,KAAK8oD,IAAM,KAC5B9oD,KAAKyoD,IAAM,KAAMzoD,KAAK0oD,IAAM,KAE5B1oD,KAAK41B,GAAK,KAAM51B,KAAK61B,GAAK,KAC1B71B,KAAK81B,GAAK,KAAM91B,KAAK+1B,GAAK,KAC1B/1B,KAAKgkB,GAAK,KAAMhkB,KAAKikB,GAAK,KAEnBjkB,MAeR2jB,UAAW,SAAUC,EAAIC,EAAG,KAAMykC,GAAS,GAuB1C,OArBW,OAAPzkC,EAEC0kC,yCAAOxnC,WAAW6C,IACrBC,EAAKD,EAAGykC,GACRzkC,EAAKA,EAAGwkC,KAERvkC,EAAKupB,QAAQxpB,EAAGR,GAChBQ,EAAKwpB,QAAQxpB,EAAGlP,KAIA,IAAb4zC,IACH1kC,EAAKwpB,QAAQxpB,GACbC,EAAKupB,QAAQvpB,IAIf7jB,KAAK2oD,KAAO/kC,EAAI5jB,KAAK4oD,KAAO/kC,EAC5B7jB,KAAK6oD,KAAOjlC,EAAI5jB,KAAK8oD,KAAOjlC,EAC5B7jB,KAAKyoD,KAAO7kC,EAAI5jB,KAAK0oD,KAAO7kC,EAErB7jB,KAAKqtC,aAUb1vC,IAAK,SAAUi4B,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMuyB,GAAS,GAkCtD,OAhCW,OAAPzyB,EAEC2yB,8BAAQznC,WAAW6U,IACtBG,EAAKH,EAAGkzB,IACRhzB,EAAKF,EAAGizB,IACRhzB,EAAKD,EAAGgzB,IACRhzB,EAAKA,EAAG+yB,MAER5yB,EAAKqX,QAAQxX,EAAGG,IAChBD,EAAKsX,QAAQxX,EAAGE,IAChBD,EAAKuX,QAAQxX,EAAGC,IAChBD,EAAKwX,QAAQxX,EAAGA,MAKA,IAAb0yB,IACH1yB,EAAKwX,QAAQxX,GACbC,EAAKuX,QAAQvX,GACbC,EAAKsX,QAAQtX,GACbC,EAAKqX,QAAQrX,IAIf/1B,KAAK2oD,IAAM/yB,EACX51B,KAAK4oD,IAAM/yB,EACX71B,KAAK6oD,IAAM/yB,EACX91B,KAAK8oD,IAAM/yB,EAEX/1B,KAAKyoD,IAAM7yB,EAAME,GAAO,EACxB91B,KAAK0oD,IAAM7yB,EAAME,GAAO,EAEjB/1B,KAAKqtC,aAUb99B,IAAK,SAAUqmB,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,KAAMuyB,GAAS,GAkCtD,OAhCW,OAAPzyB,EAEC2yB,8BAAQznC,WAAW6U,IACtBG,EAAKH,EAAGkzB,IACRhzB,EAAKF,EAAGizB,IACRhzB,EAAKD,EAAGgzB,IACRhzB,EAAKA,EAAG+yB,MAER5yB,EAAKqX,QAAQxX,EAAGG,IAChBD,EAAKsX,QAAQxX,EAAGE,IAChBD,EAAKuX,QAAQxX,EAAGC,IAChBD,EAAKwX,QAAQxX,EAAGA,MAKA,IAAb0yB,IACH1yB,EAAKwX,QAAQxX,GACbC,EAAKuX,QAAQvX,GACbC,EAAKsX,QAAQtX,GACbC,EAAKqX,QAAQrX,IAIf/1B,KAAK2oD,KAAO/yB,EACZ51B,KAAK4oD,KAAO/yB,EACZ71B,KAAK6oD,KAAO/yB,EACZ91B,KAAK8oD,KAAO/yB,EAEZ/1B,KAAKyoD,KAAO7yB,EAAME,GAAO,EACzB91B,KAAK0oD,KAAO7yB,EAAME,GAAO,EAElB/1B,KAAKqtC,aAUb5pB,OAAQ,SAAUmS,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAwB1C,OAtBW,OAAPF,EAEC2yB,8BAAQznC,WAAW6U,IACtBG,EAAKH,EAAGG,GACRD,EAAKF,EAAGE,GACRD,EAAKD,EAAGC,GACRD,EAAKA,EAAGA,KAERG,EAAK3iB,IAAIwiB,EAAGG,IACZD,EAAK1iB,IAAIwiB,EAAGE,IACZD,EAAKziB,IAAIwiB,EAAGC,IACZD,EAAKxiB,IAAIwiB,EAAGA,MAKbA,EAAKxiB,IAAIwiB,GACTC,EAAKziB,IAAIyiB,GACTC,EAAK1iB,IAAI0iB,GACTC,EAAK3iB,IAAI2iB,IAGHH,GAAM51B,KAAK41B,IAAME,GAAM91B,KAAK81B,IAAMD,GAAM71B,KAAK61B,IAAME,GAAM/1B,KAAK+1B,IAUtErf,SAAU,SAAUkf,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAwB5C,OAtBW,OAAPF,EAEC2yB,8BAAQznC,WAAW6U,IACtBG,EAAKH,EAAGG,GACRD,EAAKF,EAAGE,GACRD,EAAKD,EAAGC,GACRD,EAAKA,EAAGA,KAERG,EAAK3iB,IAAIwiB,EAAGG,IACZD,EAAK1iB,IAAIwiB,EAAGE,IACZD,EAAKziB,IAAIwiB,EAAGC,IACZD,EAAKxiB,IAAIwiB,EAAGA,MAKbA,EAAKxiB,IAAIwiB,GACTC,EAAKziB,IAAIyiB,GACTC,EAAK1iB,IAAI0iB,GACTC,EAAK3iB,IAAI2iB,IAGHH,GAAOnoB,KAAKg/B,IAAIzsC,KAAK41B,GAAIA,IAASC,GAAMpoB,KAAKg/B,IAAIzsC,KAAK61B,GAAIA,IAASC,GAAMroB,KAAK0R,IAAInf,KAAK81B,GAAIA,IAASC,GAAMtoB,KAAK0R,IAAInf,KAAK+1B,GAAIA,IAapIiwB,WAAY,SAAUpwB,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAE9C,GAAW,OAAPF,EACJ,CACC,GAAI2yB,8BAAQznC,WAAW6U,GAItB,OAFA51B,KAAKgmD,WAAWpwB,EAAG+yB,IAAK/yB,EAAGgzB,KAAK,GAChC5oD,KAAKgmD,WAAWpwB,EAAGizB,IAAKjzB,EAAGkzB,KAAK,GACzB9oD,KAEH,GAAI+mD,yCAAKhmC,WAAW6U,GAIxB,OAFA51B,KAAKgmD,WAAWpwB,EAAGA,GAAIA,EAAGC,IAC1B71B,KAAKgmD,WAAWpwB,EAAGE,GAAIF,EAAGG,IACnB/1B,KAECuoD,yCAAOxnC,WAAW6U,IAE1BC,EAAKD,EAAGyyB,GACRzyB,EAAKA,EAAGwyB,KAIRvyB,EAAKuX,QAAQxX,EAAGxS,GAChBwS,EAAKwX,QAAQxX,EAAGlhB,QAIlB,CACC,GAAW,OAAPqhB,EAIH,OAFA/1B,KAAKgmD,WAAWpwB,EAAIC,GACpB71B,KAAKgmD,WAAWlwB,EAAIC,GACb/1B,MAII,IAAP81B,IAEHF,EAAKwX,QAAQxX,GACbC,EAAKuX,QAAQvX,IAahB,OARiB,OAAb71B,KAAK2oD,KAAgB/yB,EAAK51B,KAAK2oD,OAAK3oD,KAAK2oD,IAAM/yB,IAClC,OAAb51B,KAAK4oD,KAAgB/yB,EAAK71B,KAAK4oD,OAAK5oD,KAAK4oD,IAAM/yB,IAClC,OAAb71B,KAAK6oD,KAAgBjzB,EAAK51B,KAAK6oD,OAAK7oD,KAAK6oD,IAAMjzB,IAClC,OAAb51B,KAAK8oD,KAAgBjzB,EAAK71B,KAAK8oD,OAAK9oD,KAAK8oD,IAAMjzB,GAEnD71B,KAAKyoD,IAAMzoD,KAAM2oD,IAAM3oD,KAAK6oD,KAAQ,EACpC7oD,KAAK0oD,IAAM1oD,KAAM4oD,IAAM5oD,KAAK8oD,KAAQ,EAE7B9oD,KAAKqtC,aAUb4Y,WAAY,SAAUrwB,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAEnC,OAAPF,EAEC2yB,8BAAQznC,WAAW6U,IACtBG,EAAKH,EAAGG,GACRD,EAAKF,EAAGE,GACRD,EAAKD,EAAGC,GACRD,EAAKA,EAAGA,KAERG,EAAK3iB,IAAIwiB,EAAGG,IACZD,EAAK1iB,IAAIwiB,EAAGE,IACZD,EAAKziB,IAAIwiB,EAAGC,IACZD,EAAKxiB,IAAIwiB,EAAGA,MAKbA,EAAKxiB,IAAIwiB,GACTC,EAAKziB,IAAIyiB,GACTC,EAAK1iB,IAAI0iB,GACTC,EAAK3iB,IAAI2iB,IAGV,IAAImwB,EAAMz4C,KAAKg/B,IAAIzsC,KAAK41B,GAAIA,GACxBuwB,EAAM14C,KAAKg/B,IAAIzsC,KAAK61B,GAAIA,GACxBuwB,EAAM34C,KAAK0R,IAAInf,KAAK81B,GAAIA,GACxBuwB,EAAM54C,KAAK0R,IAAInf,KAAK+1B,GAAIA,GAE5B,OAAOtoB,KAAKg/B,IAAI,EAAG4Z,EAAIF,GAAO14C,KAAKg/B,IAAI,EAAG2Z,EAAIF,GAAO,GAUtDI,kBAAmB,SAAU1wB,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAkCrD,OAhCW,OAAPF,EAEC2yB,8BAAQznC,WAAW6U,IACtBG,EAAKH,EAAGG,GACRD,EAAKF,EAAGE,GACRD,EAAKD,EAAGC,GACRD,EAAKA,EAAGA,KAERG,EAAK3iB,IAAIwiB,EAAGG,IACZD,EAAK1iB,IAAIwiB,EAAGE,IACZD,EAAKziB,IAAIwiB,EAAGC,IACZD,EAAKxiB,IAAIwiB,EAAGA,MAKbA,EAAKxiB,IAAIwiB,GACTC,EAAKziB,IAAIyiB,GACTC,EAAK1iB,IAAI0iB,GACTC,EAAK3iB,IAAI2iB,IAGV/1B,KAAK2oD,IAAMvb,QAAQ3/B,KAAKg/B,IAAIzsC,KAAK41B,GAAIA,IACrC51B,KAAK4oD,IAAMxb,QAAQ3/B,KAAKg/B,IAAIzsC,KAAK61B,GAAIA,IACrC71B,KAAK6oD,IAAMzb,QAAQ3/B,KAAK0R,IAAInf,KAAK81B,GAAIA,IACrC91B,KAAK8oD,IAAM1b,QAAQ3/B,KAAK0R,IAAInf,KAAK+1B,GAAIA,IAErC/1B,KAAKyoD,IAAMzoD,KAAM2oD,IAAM3oD,KAAK6oD,KAAQ,EACpC7oD,KAAK0oD,IAAM1oD,KAAM4oD,IAAM5oD,KAAK8oD,KAAQ,EAEpC9oD,KAAKqtC,YAEE5/B,KAAKg/B,IAAI,EAAGzsC,KAAK8oD,IAAI9oD,KAAK4oD,KAAOn7C,KAAKg/B,IAAI,EAAGzsC,KAAK6oD,IAAI7oD,KAAK2oD,KAAO,GAU1En1B,OAAQ,SAAUvF,EAAOC,EAAQq4B,GAAgB,GA0BhD,OAxBAt4B,EAAkB,OAAVA,GAA4B,IAAVA,GAAiBmf,QAAQnf,GAAiBjuB,KAAK6oD,IAAM7oD,KAAK2oD,IACpFz6B,EAAoB,OAAXA,GAA8B,IAAXA,GAAkBkf,QAAQlf,GAAmBluB,KAAK8oD,IAAM9oD,KAAK4oD,KAE3E,IAAV36B,EACHA,EAAQC,EAAOluB,KAAK+7C,SACD,IAAX7tB,IACRA,EAASD,EAAMjuB,KAAK+7C,UAEG,IAApBwK,GAEHvmD,KAAK6oD,IAAM7oD,KAAK2oD,IAAM16B,EACtBjuB,KAAK8oD,IAAM9oD,KAAK4oD,IAAM16B,EAEtBluB,KAAKyoD,IAAMzoD,KAAM2oD,IAAM3oD,KAAK6oD,KAAQ,EACpC7oD,KAAK0oD,IAAM1oD,KAAM4oD,IAAM5oD,KAAK8oD,KAAQ,IAIpC76B,IAAU,EAAGC,IAAW,EAExBluB,KAAK2oD,IAAM3oD,KAAKyoD,IAAMx6B,EAAOjuB,KAAK4oD,IAAM5oD,KAAK0oD,IAAMx6B,EACnDluB,KAAK6oD,IAAM7oD,KAAKyoD,IAAMx6B,EAAOjuB,KAAK8oD,IAAM9oD,KAAK0oD,IAAMx6B,GAG7CluB,KAAKqtC,aAObmZ,SAAU,SAAUwC,EAAQC,EAAS1C,GAAgB,GA0BpD,OAxBAyC,GAAoB,IAAXA,GAAkB5b,QAAQ4b,GACnCC,GAAsB,IAAZA,GAAmB7b,QAAQ6b,IAEtB,IAAXD,EACHA,EAASC,EAAQjpD,KAAK+7C,SACF,IAAZkN,IACRA,EAAUD,EAAOhpD,KAAK+7C,UAEC,IAApBwK,GAEHvmD,KAAK6oD,KAAOG,EACZhpD,KAAK8oD,KAAOG,EAEZjpD,KAAKyoD,IAAMzoD,KAAM2oD,IAAM3oD,KAAK6oD,KAAQ,EACpC7oD,KAAK0oD,IAAM1oD,KAAM4oD,IAAM5oD,KAAK8oD,KAAQ,IAIpCE,IAAW,EAAGC,IAAY,EAE1BjpD,KAAK2oD,KAAOK,EAAQhpD,KAAK4oD,KAAOK,EAChCjpD,KAAK6oD,KAAOG,EAAQhpD,KAAK8oD,KAAOG,GAG1BjpD,KAAKqtC,aAObpf,MAAO,WAEN,OAAOjuB,KAAK81B,GAAK91B,KAAK41B,IAOvB1H,OAAQ,WAEP,OAAOluB,KAAK+1B,GAAK/1B,KAAK61B,IAOvBkmB,MAAO,WAEN,OAAQ/7C,KAAK81B,GAAK91B,KAAK41B,KAAO51B,KAAK+1B,GAAK/1B,KAAK61B,KAO9CqzB,UAAW,WAEV,OAAOlpD,KAAK2oD,KAAO3oD,KAAK6oD,KAAO7oD,KAAK4oD,KAAO5oD,KAAK8oD,KAOjDlC,cAAe,SAAUlyC,EAAG0O,EAAGyjC,EAAI,GAMlC,OAJAnyC,EAAI04B,QAAQ14B,GACZ0O,EAAIgqB,QAAQhqB,GACZyjC,EAAMzZ,QAAQyZ,GAEP7mD,KAAM2oD,IAAI9B,GAAOnyC,GAAKA,GAAK1U,KAAK6oD,IAAIhC,GAAS7mD,KAAK4oD,IAAI/B,GAAOzjC,GAAKA,GAAKpjB,KAAK8oD,IAAIjC,GAOxFC,KAAM,SAAUv2C,GAAO,GAEtB,OAAOA,EAAUvQ,KAAKkpD,aAAelpD,KAAK+1B,GAAG/1B,KAAK61B,KAAK71B,KAAK81B,GAAG91B,KAAK41B,IAAM,GAAO51B,KAAK+1B,GAAG/1B,KAAK61B,KAAK71B,KAAK81B,GAAG91B,KAAK41B,KAOjHh2B,SAAU,WAET,MAAO,IAAMI,KAAK41B,GAAK,KAAO51B,KAAK61B,GAAK,KAAO71B,KAAK81B,GAAK,KAAO91B,KAAK+1B,GAAK,KAO3EpsB,QAAS,WAER,MAAO,CAAC3J,KAAK2oD,IAAK3oD,KAAK4oD,IAAK5oD,KAAK6oD,IAAK7oD,KAAK8oD,MAO5C37C,UAAW,SAAUuH,GAUpB,OARA1U,KAAK2oD,IAAMj0C,EAAE,GACb1U,KAAK4oD,IAAMl0C,EAAE,GACb1U,KAAK6oD,IAAMn0C,EAAE,GACb1U,KAAK8oD,IAAMp0C,EAAE,GAEb1U,KAAKyoD,IAAMzoD,KAAM2oD,IAAM3oD,KAAK6oD,KAAQ,EACpC7oD,KAAK0oD,IAAM1oD,KAAM4oD,IAAM5oD,KAAK8oD,KAAQ,EAE7B9oD,KAAKqtC;;;iBAcdrvB;yCAAS+B,WAAYyoC,8BAAS,KAAM,M,IACpCW,yCAAeX;mBE3pBf;MAAMY,6BACN;AAGCC,OACA,CAICC,GAAI,SAAUjsD,GAEb,OAAOA,GAMRksD,IAAK,SAAUlsD,GAEd,OAAOA,GAMRmsD,OAAQ,SAAUnsD,GAEjB,OAAOA;;;AAOTosD,KACA,CACCjiD,EAAG,QAKH8hD,GAAI,SAAUjsD,EAAGmK,EAAE,MAGlB,OADU,OAANA,IAAYA,EAAI4hD,6BAAOK,KAAKjiD,GACzBnK,EAAEA,IAAImK,EAAE,GAAGnK,EAAImK,IAMvB+hD,IAAK,SAAUlsD,EAAGmK,EAAE,MAEnB,OAAO,EAAI4hD,6BAAOK,KAAKH,GAAG,EAAIjsD,EAAGmK,IAMlCgiD,OAAQ,SAAUnsD,EAAGmK,EAAE,MAEtB,OAAInK,EAAI,GACA+rD,6BAAOK,KAAKH,GAAK,EAAFjsD,EAAKmK,GAAG,EAEvB4hD,6BAAOK,KAAKF,IAAY,GAAPlsD,EAAE,IAAQmK,GAAG,EAAI;;;AAO5CkiD,OACA,CACCC,SAAU,SAAUtsD,GAEnB,OAAIA,EAAI,EAAI,KACJ,OAASA,EAAIA,EACZA,EAAI,EAAI,KACT,QAAUA,GAAK,IAAI,MAAMA,EAAI,IAC5BA,EAAI,IAAI,KACT,QAAUA,GAAK,KAAM,MAAQA,EAAI,MAElC,QAAUA,GAAK,MAAM,MAAQA,EAAI,SAMzCisD,GAAI,SAAUjsD,GAEb,OAAO,EAAI+rD,6BAAOM,OAAOC,SAAS,EAAEtsD,IAMrCksD,IAAK,SAAUlsD,GAEd,OAAO+rD,6BAAOM,OAAOC,SAAStsD,IAM/BmsD,OAAQ,SAAUnsD,GAEjB,OAAIA,EAAI,IACC,EAAI+rD,6BAAOM,OAAOC,SAAS,EAAE,EAAEtsD,IAAI,EAEpC+rD,6BAAQM,OAAOC,SAAiB,GAAPtsD,EAAE,KAAQ,EAAG;;;AAOhDusD,KACA,CAICN,GAAI,SAAUjsD,GAEb,OAAO,EAAIoQ,KAAKkX,KAAK,EAAItnB,EAAEA,IAM5BksD,IAAK,SAAUlsD,GAEd,OAAO,EAAI+rD,6BAAOQ,KAAKN,GAAG,EAAIjsD,IAM/BmsD,OAAQ,SAAUnsD,GAEjB,OAAIA,EAAI,GACC+rD,6BAAOQ,KAAKN,GAAK,EAAFjsD,GAAK,EAEpB+rD,6BAAOQ,KAAKL,IAAY,GAAPlsD,EAAE,KAAQ,EAAI;;;AAO1CwsD,MACA,CAICP,GAAI,SAAUjsD,GAEb,OAAOA,EAAEA,EAAEA,GAMZksD,IAAK,SAAUlsD,GAEd,OAAO,EAAI+rD,6BAAOS,MAAMP,GAAG,EAAIjsD,IAMhCmsD,OAAQ,SAAUnsD,GAEjB,OAAIA,EAAI,GACA+rD,6BAAOS,MAAMP,GAAK,EAAFjsD,GAAK,EAErB+rD,6BAAOS,MAAMN,IAAY,GAAPlsD,EAAE,KAAQ,EAAI;;;AAO1CysD,KACA,CAICR,GAAI,SAAUjsD,GAEb,OAAOoQ,KAAKC,IAAI,EAAG,IAAIrQ,EAAE,KAM1BksD,IAAK,SAAUlsD,GAEd,OAA6B,EAArBoQ,KAAKC,IAAI,GAAG,GAAIrQ,IAMzBmsD,OAAQ,SAAUnsD,GAEjB,OAAKA,GAAK,GAAK,EACPoQ,KAAKC,IAAK,EAAG,IAAMrQ,EAAI,IAAM,GAEG,EAA9BoQ,KAAKC,IAAK,GAAG,IAAOrQ,EAAI,KAAW;;;AAO/C0sD,MACA,CAICT,GAAI,SAAUjsD,EAAGsoC,EAAE,IAElB,OAAOl4B,KAAKC,IAAIrQ,EAAGsoC,IAMpB4jB,IAAK,SAAUlsD,EAAGsoC,EAAE,IAEnB,OAAO,EAAIyjB,6BAAOW,MAAMT,GAAG,EAAIjsD,EAAGsoC,IAMnC6jB,OAAQ,SAAUnsD,EAAGsoC,EAAE,IAEtB,OAAItoC,EAAI,GACA+rD,6BAAOW,MAAMT,GAAK,EAAFjsD,EAAKsoC,GAAG,EAExByjB,6BAAOW,MAAMR,IAAY,GAAPlsD,EAAE,IAAQsoC,GAAG,EAAI;;;AAO7CqkB,KACA,CAICV,GAAI,SAAUjsD,GAEb,OAAOA,EAAEA,GAMVksD,IAAK,SAAUlsD,GAEd,OAAO,EAAI+rD,6BAAOY,KAAKV,GAAG,EAAIjsD,IAM/BmsD,OAAQ,SAAUnsD,GAEjB,OAAIA,EAAI,GACA+rD,6BAAOY,KAAKV,GAAK,EAAFjsD,GAAK,EAEpB+rD,6BAAOY,KAAKT,IAAY,GAAPlsD,EAAE,KAAQ,EAAI;;;AAOzC4sD,QACA,CAICX,GAAI,SAAUjsD,GAEb,OAAOA,EAAEA,EAAEA,EAAEA,GAMdksD,IAAK,SAAUlsD,GAEd,OAAO,EAAI+rD,6BAAOa,QAAQX,GAAG,EAAIjsD,IAMlCmsD,OAAQ,SAAUnsD,GAEjB,OAAIA,EAAI,GACA+rD,6BAAOa,QAAQX,GAAK,EAAFjsD,GAAK,EAEvB+rD,6BAAOa,QAAQV,IAAY,GAAPlsD,EAAE,KAAQ,EAAI;;;AAO5C6sD,QACA,CAICZ,GAAI,SAAUjsD,GAEb,OAAOA,EAAEA,EAAEA,EAAEA,EAAEA,GAMhBksD,IAAK,SAAUlsD,GAEd,OAAO,EAAI+rD,6BAAOc,QAAQZ,GAAG,EAAIjsD,IAMlCmsD,OAAQ,SAAUnsD,GAEjB,OAAIA,EAAI,GACC+rD,6BAAOc,QAAQZ,GAAK,EAAFjsD,GAAK,EAEvB+rD,6BAAOc,QAAQX,IAAY,GAAPlsD,EAAE,KAAQ,EAAI;;;AAO7C8sD,KACA,CAICb,GAAI,SAAUjsD,GAEb,OAAO,EAAIoQ,KAAK0W,IAAK,QAAU,EAAI9mB,KAMpCksD,IAAK,SAAUlsD,GAEd,OAAOoQ,KAAK0W,IAAK,OAAS9mB,IAM3BmsD,OAAQ,SAAUnsD,GAEjB,OAAQoQ,KAAKyW,IAAK,OAAO7mB,GAAK,IAAK;;;AAOrC+sD,KACA,CAICd,GAAI,SAAUjsD,GAEb,OAAY,GAALA,EAAW,EAAI,GAMvBksD,IAAK,SAAUlsD,GAEd,OAAY,GAALA,EAAW,EAAI,GAMvBmsD,OAAQ,SAAUnsD,GAEjB,OAAY,GAALA,EAAW,EAAI,K,IAKzBgtD,yCAAejB,6BC1ZfvxC,OAAAxZ,cAAA,SCAAwZ,OAAAxZ,cAAA;;;AAOA,MAAMisD,2BACN,CACCC,QAAS,IAAIvG,yCAMbplD,SAAU,SAAUC,GAEnB,OAAOmB,KAAKuqD,QAAQh7C,IAAI1Q,IAOzB2hD,WAAY,SAAU3hD,GAErBmB,KAAKuqD,QAAQ/pD,OAAO3B,GACpBmB,KAAKuqD,QAAQlG,WAOdmG,QAAS,SAAUxS,EAAiB,MAEnCh4C,KAAKuqD,QAAQ/F,cAAa,CAACx6C,EAAE1M,MAA+B,IAAnB0M,EAAEygD,UAAUntD,IAAcA,MAAQ06C,IAO5E0S,SAAU,SAAU1S,EAAiB,MAEpCh4C,KAAKuqD,QAAQI,iBAAiB,CAAC3gD,EAAE1M,MAAgC,IAApB0M,EAAE4gD,WAAWttD,IAAcA,MAAQ06C;;;mBASlFsS;2BAAKO,OAAShzC,OAAAK,MAAM3R,OACnB,CACA9B,UAAW,SAMX0/C,SAAU,EAEVz/C,OAAQ,WAEP4lD,2BAAK1rD,SAASoB,OAGf2E,OAAQ,WAEP2lD,2BAAK9J,WAAWxgD,OAOjByqD,UAAW,SAAU1jD,KAQrB6jD,WAAY,SAAU7jD,O;;AAQvB+jD,yCAAeR;YCvFf;MAAMS,6BACN,CAICrR,aAAa,EAMbxY,YAAa,EAMbC,aAAc,EAMdvB,SAAU,KAMVxG,KAAM,EAMNsO,GAAI,EAKJsjB,SAAU,KAKVC,UAAW,KAKXC,MAAO,KAMP9iD,OAAQ,KAMRq3B,KAAM,KAMN0rB,SAAU,KAMVC,UAAW,KAKXz6B,QACA,CAICjK,IAAI,EAKJjQ,KAAK,EAKLqa,WAAW,EAKXa,WAAY,UAKZoP,YAAa,YAKbG,YAAa,KAKbC,aAAc,KAKdH,IAAK,IAKLC,OAAQ,GAMRhiB,aAAa,GAWd9W,KAAM,SAAUwoB,GAEf,OAAO,IAAItuB,SAAS,CAACC,EAASC,KAE7B,GAAIvC,KAAK05C,YACR,OAAOp3C,IAER9E,OAAOijC,OAAOzgC,KAAK2wB,QAASA,GAE5BivB,yCAAU1I,OAAQ,CAAEkE,WAAYp7C,KAAK2wB,QAAQG,UAAWzP,OAAQrhB,KAAK2wB,QAAQG,UAAY,SAAW,YACpG6O,yCAAOx3B,KAAMnI,KAAK2wB,SAElBgP,yCAAOyH,eACN,CACAh/B,OAAQ,SAASs/B,GAEhBqjB,6BAAO3xB,KAAOuG,yCAAOmD,UACrBioB,6BAAOrjB,GAAKA,EAEZqjB,6BAAOC,SAAS3F,KAAK3d,GACrBqjB,6BAAOE,UAAU5F,KAAK3d,GACtBqjB,6BAAOG,MAAM7F,KAAK3d,GAElBqjB,6BAAO3iD,OAAOi9C,KAAK3d,MAIrB/H,yCAAO2H,aACN,CACA7H,KAAM,SAASrF,GAEd2wB,6BAAOtrB,KAAK4lB,KAAKjrB,MAInB0wB,yCAAKN,SAAQ,WAEZ7qB,yCAAOtqB,QAEP01C,6BAAO7pB,YAAcvB,yCAAOuB,YAC5B6pB,6BAAO5pB,aAAexB,yCAAOwB,aAC7B4pB,6BAAOnrB,SAAWD,yCAAOC,SAEzBmrB,6BAAOC,SAAWrF,yCAAQ3lC,KAAKX,QAC/B0rC,6BAAOE,UAAYtF,yCAAQ3lC,KAAKX,QAChC0rC,6BAAOG,MAAQvF,yCAAQ3lC,KAAKX,QAE5B0rC,6BAAO3iD,OAASu9C,yCAAQ3lC,KAAKX,QAC7B0rC,6BAAOtrB,KAAOkmB,yCAAQ3lC,KAAKX,QAE3BphB,OAAOotD,OAAS,WACfN,6BAAOzkB,OAAM,IAGdroC,OAAO8gD,QAAU,WAChBgM,6BAAO3+C,QAAO,IAGf2+C,6BAAOrR,aAAc,EAErBp3C,WASHgkC,MAAO,SAAUglB,GAAkB,GAEV,OAApBP,6BAAOI,UACVJ,6BAAOI,SAASG,IAOlBl/C,OAAQ,SAAUk/C,GAAkB,GAEV,OAArBP,6BAAOK,WACVL,6BAAOK,UAAUE,IAOnBzoC,QAAS,SAAUglB,EAAU35B,EAAU42C,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAE5E,OAAOjlD,KAAKgrD,SAASz7C,IAAIvP,KAAKurD,eAAgB1jB,EAAU35B,EAAU42C,EAAMC,EAAMC,EAAMC,IAOrFuG,cAAe,SAAUlL,GAExBtgD,KAAKgrD,SAASxqD,OAAO8/C,IAGtBiL,eAAgB,SAAU7jB,EAAI1J,EAAG9vB,EAAU42C,EAAMC,EAAMC,EAAMC,GAG5D,OADAjlD,KAAK8kD,MAAQpd,EACT1nC,KAAK8kD,KAAO,IAEhB52C,EAAU42C,EAAMC,EAAMC,EAAMC,IACrB,IAORtjC,SAAU,SAAU8pC,EAAQv9C,EAAU42C,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAEhE,OAAOhlD,KAAKirD,UAAU17C,IAAIvP,KAAK0rD,gBAAiB,EAAGD,EAAQv9C,EAAU42C,EAAMC,EAAMC,IAOlF2G,eAAgB,SAAUrL,GAEzBtgD,KAAKirD,UAAUzqD,OAAO8/C,IAGvBoL,gBAAiB,SAAUhkB,EAAIkkB,EAAIC,EAAI39C,EAAU42C,EAAMC,EAAMC,GAG5D,OADAhlD,KAAK8kD,MAAQpd,EACT1nC,KAAK8kD,KAAO9kD,KAAK+kD,OAErB/kD,KAAK8kD,MAAQ9kD,KAAK+kD,KACX72C,EAAU42C,EAAMC,EAAMC,KAO9B8G,KAAM,SAAUjkB,EAAU35B,EAAU42C,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAE9D,OAAOhlD,KAAKkrD,MAAM37C,IAAIvP,KAAK+rD,YAAa,EAAGlkB,EAAU35B,EAAU42C,EAAMC,EAAMC,IAO5EgH,WAAY,SAAU1L,GAErBtgD,KAAKkrD,MAAM1qD,OAAO8/C,IAGnByL,YAAa,SAAUrkB,EAAIkkB,EAAIC,EAAI39C,EAAU42C,EAAMC,EAAMC,GAQxD,OANAhlD,KAAK8kD,MAAQpd,EACT1nC,KAAK8kD,KAAO9kD,KAAK+kD,OACpBrd,GAAM1nC,KAAK8kD,KAAO9kD,KAAK+kD,KACvB/kD,KAAK8kD,KAAO9kD,KAAK+kD,OAG2C,IAAzD72C,EAAUlO,KAAK8kD,KAAK9kD,KAAK+kD,KAAMrd,EAAIod,EAAMC,EAAMC,IAG5ChlD,KAAK8kD,OAAS9kD,KAAK+kD,O,IAI5BkH,yCAAelB,6BChUflzC,OAAAxZ,cAAA,SAIA,IAAI6tD,6BAAS,EACb,SAASC,iCAGR,OADAD,6BAASA,6BAAU,EAAK,WACjBA;cAKR;MAAME,4BAAQv0C,OAAAK,MAAM3R,OACnB,CACA9B,UAAW,aAEX4nD,SAAU,KAEVC,SAAS,EACTC,SAAS,EACTC,MAAO,EACPpzB,KAAM,EAMNjxB,KAAM,WAIL,OAFAnI,KAAKqsD,SAAW7qC,yCAAKxB,KAAKX,QAC1Brf,KAAKiI,MAAM,GACJjI,MAGR2E,OAAQ,WAEP3E,KAAKqM,QACLrM,KAAKqsD,SAAS/sC,QAOfrO,MAAO,WAEN,OAAOjR,KAAKqsD,SAAS/rD,QAOtBiP,IAAK,SAAUmxC,GAUd,OARA1gD,KAAKqsD,SAASxpD,KAAK69C,IAEE,IAAjB1gD,KAAKssD,SAAsC,OAAjBtsD,KAAKusD,UAElCvsD,KAAKusD,QAAUvsD,KAAKqsD,SAAS5rC,OAC7BzgB,KAAKwsD,MAAQL,kCAGPzL,GAOR/9C,MAAO,WAEN,IAAI8pD,EAAQL,4BAAM/sC,QAElB,IAAK,IAAIihC,EAAOtgD,KAAKqsD,SAAS7rC,IAAc,OAAT8/B,EAAeA,EAAOA,EAAKv5C,KAC7D0lD,EAAMJ,SAASxpD,KAAKy9C,EAAKrhD,MAAM0D,SAEhC,OAAO8pD,GAORpgD,MAAO,WAKN,OAHArM,KAAKqsD,SAAShgD,QACdrM,KAAKiI,MAAM,GAEJjI,MAORiI,MAAO,SAAUmxB,EAAK,GAOrB,OALAp5B,KAAKssD,SAAU,EACftsD,KAAKusD,QAAU,KACfvsD,KAAKo5B,KAAOA,EACZp5B,KAAKwsD,MAAQL,iCAENnsD,MAOR0sD,QAAS,WAKR,OAHA1sD,KAAKssD,SAAU,EACftsD,KAAKwsD,MAAQL,iCAENnsD,MAOR2sD,WAAY,WAQX,OANqB,IAAjB3sD,KAAKssD,UAERtsD,KAAKusD,QAAUvsD,KAAKqsD,SAAS7rC,IAC7BxgB,KAAKssD,SAAU,GAGQ,OAAjBtsD,KAAKusD,SAObnkD,OAAQ,SAAUgwC,GAEjB,MAAQp4C,KAAK2sD,cACb,CACC,IAAIrvD,EAAI0C,KAAKusD,QAAQttD,MAAMmJ,OAAOgwC,EAAMp4C,MACxC,IAAU,IAAN1C,EAAY,OAAOA,EAEvB0C,KAAKusD,QAAUvsD,KAAKusD,QAAQxlD,KAG7B,OAAO,KAcTiX,yCAASC,SAASmuC,4BAAO,M,IACzBQ,yCAAeR,4BCnKfv0C,OAAAxZ,cAAA;;AAMA,MAAMwuD,8BAAUh1C,OAAAK,MAAM3R,OACrB,CACA9B,UAAW,eAKXqoD,GAAI,KAKJC,SAAS,EAKT3zB,KAAM,EAKNh2B,MAAO,KAKPnE,MAAO,KAKP4oC,SAAU,EAAGmlB,UAAW,EAKxB/7C,MAAO,EAAGg8C,OAAQ,EAKlBC,WAAY,EAAGC,YAAa,EAK5BC,SAAU,EAAGC,UAAW,EAKxBvlB,OAAQ,KAERwlB,KAAM,KACNC,MAAO,KAKPd,MAAO,KAKPe,OAAQ,KAKRjiB,MAAO,KAKPoV,IAAK,KAKL1+C,GAAI,KAMJkG,KAAM,SAAU2kD,EAAIW,GAenB,OAbAztD,KAAK8sD,GAAKA,EACV9sD,KAAK+sD,SAAU,EAEf/sD,KAAKysD,MAAQ,KACbzsD,KAAKwtD,OAAS,KAEdxtD,KAAKurC,MAAQ,KACbvrC,KAAK2gD,IAAM,KACX3gD,KAAKiC,GAAK,MAEO,IAAbwrD,GACHX,EAAG3kD,KAAKnI,MAAM,GAERA,MAGR2E,OAAQ,WAEY,OAAf3E,KAAKysD,OAAgBzsD,KAAKysD,MAAMpgD,QAAQiT,OACxB,OAAhBtf,KAAKwtD,QAAiBxtD,KAAKwtD,OAAOnhD,QAAQiT,QAG/C3c,MAAO,WAEN,IAAI+9C,EAAMmM,8BAAQxtC,MAAMrf,KAAK8sD,IAAI,GAgBjC,GAdCpM,EAAIt9C,MAAQpD,KAAKoD,MACjBs9C,EAAIzhD,MAAQe,KAAKf,MACjByhD,EAAI7Y,SAAW7nC,KAAK6nC,SACpB6Y,EAAIzvC,MAAQjR,KAAKiR,MACjByvC,EAAIwM,WAAaltD,KAAKktD,WACtBxM,EAAI0M,SAAWptD,KAAKotD,SACpB1M,EAAI5Y,OAAS9nC,KAAK8nC,OACnB4Y,EAAInV,MAAQvrC,KAAKurC,MACjBmV,EAAIC,IAAM3gD,KAAK2gD,IACfD,EAAIz+C,GAAKjC,KAAKiC,GAEK,OAAfjC,KAAKysD,QACR/L,EAAI+L,MAAQzsD,KAAKysD,MAAM9pD,SAEJ,OAAhB3C,KAAKwtD,OACT,CACC9M,EAAI8M,OAAShsC,yCAAKxB,KAAKX,QAEvB,IAAK,IAAIihC,EAAOtgD,KAAKwtD,OAAOhtC,IAAc,OAAT8/B,EAAeA,EAAOA,EAAKv5C,KAC3D25C,EAAI8M,OAAO3qD,KAAKy9C,EAAKrhD,MAAM0D,SAG7B,OAAO+9C,GAORr4C,MAAO,WAENrI,KAAK8sD,GAAG3kD,KAAKnI,MAAM,IAOpBoI,OAAQ,SAASgwC,EAAMqU,GAEtB,OAAOzsD,KAAK8sD,GAAG1kD,OAAOgwC,EAAMqU,EAAOzsD,SAcrCge,yCAASC,SAAS4uC,+B,IAClBa,yCAAeb,8BC5Kfc,yCACA,CACCxlD,KAAM,SAASu4C,EAAKkN,GAAS,GAE5B,IAAKA,EAIJ,OAFAlN,EAAI+L,MAAQG,yCAAMvtC,aAClBqhC,EAAI8M,OAAShsC,yCAAKxB,KAAKX,SAIxB,IAAIhf,EAEJ,KAA2C,OAAnCA,EAAIqgD,EAAI+L,MAAMJ,SAASr/C,UAC/B,CACC,IAAIy/C,EAAQG,yCAAMvtC,QAClBotC,EAAMl9C,IAAIlP,GACVqgD,EAAI8M,OAAO3qD,KAAK4pD,GAGjB/L,EAAI+L,MAAMntC,OACVohC,EAAI+L,MAAQ,MAGbrkD,OAAQ,SAAUgwC,EAAMqU,EAAO/L,GAE9B,IAAoB,IAAhBA,EAAIqM,QACR,CACC,IAAK,IAAI1sD,EAAIqgD,EAAI8M,OAAOhtC,IAAW,OAANngB,EAAYA,EAAIA,EAAE0G,KAE9C1G,EAAEpB,MAAMgJ,MAAOwkD,EAAMrzB,MAGtBsnB,EAAIqM,SAAU,EAGf,IAAI3zB,EAAOqzB,EAAMrzB,KACb77B,EAAI,EAAGyM,EAAI,EAEf,IAAK,IAAI3J,EAAIqgD,EAAI8M,OAAOhtC,IAAW,OAANngB,EAAYA,EAAIA,EAAE0G,KAC/C,CACC,IAAIzJ,EAAI+C,EAAEpB,MAAMmJ,OAAOgwC,IACb,IAAN96C,EAAYC,IAAoB,OAAND,GAAY0M,IAEtC3J,EAAEpB,MAAMm6B,KAAOA,IAClBA,EAAO/4B,EAAEpB,MAAMm6B,MAGjB,OAAI77B,EAAGyM,GAAM02C,EAAI8M,OAAOltD,SAGxBogD,EAAIqM,SAAU,EACdN,EAAMrzB,KAAOA,GAEN,KCvDTy0B,yCACA,CACC1lD,KAAM,SAASu4C,EAAKkN,GAAS,GAEvBA,IACJlN,EAAI+L,MAAQG,yCAAMvtC,UAGpBjX,OAAQ,SAASgwC,EAAMqU,EAAO/L,IAET,IAAhBA,EAAIqM,UAEPrM,EAAI+L,MAAMxkD,MAAOwkD,EAAMrzB,MACvBsnB,EAAIqM,SAAU,GAGf,IAAIzvD,EAAIojD,EAAI+L,MAAMrkD,OAAOgwC,GACzB,OAAU,IAAN96C,EAAmBA,GAEvBojD,EAAIqM,SAAU,EACdN,EAAMrzB,KAAOsnB,EAAI+L,MAAMrzB,MAChB,KCrBT00B,yCACA,CACC3lD,KAAM,SAASu4C,EAAKkN,GAAS,GAEvBA,IACJlN,EAAI+L,MAAQG,yCAAMvtC,UAGpBjX,OAAQ,SAASgwC,EAAMqU,EAAO/L,IAET,IAAhBA,EAAIqM,UAEPrM,EAAI+L,MAAMxkD,MAAOwkD,EAAMrzB,MACvBsnB,EAAIuM,OAASvM,EAAIzvC,MAEjByvC,EAAIqM,SAAU,GAGf,IAAIzvD,EAAIojD,EAAI+L,MAAMrkD,OAAOgwC,GACzB,OAAU,IAAN96C,EAAmBA,EAEnBojD,EAAIuM,QAAU,GAEjBvM,EAAIqM,SAAU,EACdN,EAAMrzB,KAAOsnB,EAAI+L,MAAMrzB,MAChB,IAGRsnB,EAAI+L,MAAMC,UACVhM,EAAIuM,UACG,KChCTc,yCACA,CACC5lD,KAAM,SAASu4C,EAAKkN,GAAS,KAI7BxlD,OAAQ,SAASgwC,EAAMqU,EAAO/L,GAG7B,OADAtI,EAAK4V,SAAStN,EAAIt9C,MAAOg1C,EAAK6V,SAASvN,EAAIt9C,MAAOs9C,EAAIzhD,SAC/C,ICTTivD,yCACA,CACC/lD,KAAM,SAASu4C,EAAKkN,GAAS,KAI7BxlD,OAAQ,SAASgwC,EAAMqU,EAAO/L,GAG7B,OADA+L,EAAMC,WACC,ICTT70C,OAAAxZ,cAAA,SAEA8vD,yCACA,CACChmD,KAAM,SAASu4C,EAAKkN,GAAS,KAI7BxlD,OAAQ,SAASgwC,EAAMqU,EAAO/L,GAQ7B,OANoB,IAAhBA,EAAIqM,UAEPrM,EAAIsM,UAA0C,WAA9Bn1C,OAAA6I,KAAK5gB,OAAO4gD,EAAI7Y,UAAyBuQ,EAAK6V,SAASvN,EAAI7Y,UAAY6Y,EAAI7Y,SAC3F6Y,EAAIqM,SAAU,KAGX3U,EAAKhf,KAAOqzB,EAAMrzB,KAAOsnB,EAAIsM,aAGjCtM,EAAIqM,SAAU,EACdN,EAAMrzB,MAAQsnB,EAAIsM,WACX,KCrBTn1C,OAAAxZ,cAAA,SAEA+vD,yCACA,CACCjmD,KAAM,SAASu4C,EAAKkN,GAAS,KAI7BxlD,OAAQ,SAASgwC,EAAMqU,EAAO/L,IAET,IAAhBA,EAAIqM,UAEPrM,EAAIyM,YAAc/U,EAAK6V,SAASvN,EAAIt9C,MAAOs9C,EAAIwM,YAC/CxM,EAAIsM,UAA0C,WAA9Bn1C,OAAA6I,KAAK5gB,OAAO4gD,EAAI7Y,UAAyBuQ,EAAK6V,SAASvN,EAAI7Y,UAAY6Y,EAAI7Y,SAE3F6Y,EAAIqM,SAAU,GAGfrM,EAAI2M,UAAYjV,EAAK6V,SAASvN,EAAIt9C,MAAOs9C,EAAI0M,SAAU1M,EAAIyM,aAE3D,IAAI9vD,EAAI,EAUR,OARI+6C,EAAKhf,KAAOqzB,EAAMrzB,KAAOsnB,EAAIsM,YAChC3vD,GAAK+6C,EAAKhf,KAAOqzB,EAAMrzB,MAAQsnB,EAAIsM,WAEhCtM,EAAI5Y,QAAe,GAALzqC,EACjB+6C,EAAK4V,SAAStN,EAAIt9C,MAAOs9C,EAAI5Y,OAAOzqC,IAAIqjD,EAAI2M,UAAY3M,EAAIyM,aAAezM,EAAIyM,aAE/E/U,EAAK4V,SAAStN,EAAIt9C,MAAO/F,GAAGqjD,EAAI2M,UAAY3M,EAAIyM,aAAezM,EAAIyM,aAE3D,GAAL9vD,IAGJqjD,EAAIqM,SAAU,EACdN,EAAMrzB,MAAQsnB,EAAIsM,WAEX,KCpCTn1C,OAAAxZ,cAAA,SAEAgwD,yCACA,CACClmD,KAAM,SAASu4C,EAAKkN,GAAS,KAI7BxlD,OAAQ,SAASgwC,EAAMqU,EAAO/L,IAET,IAAhBA,EAAIqM,UAEPrM,EAAIsM,UAA0C,WAA9Bn1C,OAAA6I,KAAK5gB,OAAO4gD,EAAI7Y,UAAyBuQ,EAAK6V,SAASvN,EAAI7Y,UAAY6Y,EAAI7Y,SAC3F6Y,EAAI6M,MAAQ,KAEZ7M,EAAIqM,SAAU,GAGf,IAAI1vD,EAAI,EAUR,GARI+6C,EAAKhf,KAAOqzB,EAAMrzB,KAAOsnB,EAAIsM,YAChC3vD,GAAK+6C,EAAKhf,KAAOqzB,EAAMrzB,MAAQsnB,EAAIsM,WAEhCtM,EAAI5Y,QAAe,GAALzqC,EACjBqjD,EAAI4M,KAAOl6C,IAAIstC,EAAI5Y,OAAOzqC,GAAGqjD,EAAIzvC,OAEjCyvC,EAAI4M,KAAOl6C,IAAI/V,EAAEqjD,EAAIzvC,OAElByvC,EAAI4M,MAAQ5M,EAAI6M,MACpB,CACC,IAAIz+C,EAAMspC,EAAK6V,SAASvN,EAAIt9C,OAE5B,OAAa,CAEZ,GADQgQ,IAAI3F,KAAK6xB,UAAUohB,EAAI0M,SAAW1M,EAAIwM,WAAa,IAAMxM,EAAIwM,YAC5Dp+C,EAAK,MAGfspC,EAAK4V,SAAStN,EAAIt9C,MAAO/C,GACzBqgD,EAAI6M,MAAQ7M,EAAI4M,KAGjB,OAAS,GAALjwD,IAGJqjD,EAAIqM,SAAU,EACdN,EAAMrzB,MAAQsnB,EAAIsM,WAEX,KC/CTn1C,OAAAxZ,cAAA,SAEAiwD,yCACA,CACCnmD,KAAM,SAASu4C,EAAKkN,GAAS,GAE5B,IAAKA,EAAU,OAEf,IAAIriB,EAAQ,GAEZ,IAAK,IAAIlrC,EAAI,EAAGA,EAAIqgD,EAAIzvC,MAAO5Q,IAC9BkrC,EAAM1oC,KAAMxC,GAAMqgD,EAAI0M,SAAW1M,EAAIwM,WAAa,GAAMxM,EAAIwM,YAE7D,IAAK,IAAI/pD,EAAIu9C,EAAIzvC,OAAS,EAAG9N,EAAI,EAAGA,IACpC,CACC,IAAIyM,EAAIwD,IAAI3F,KAAK6xB,SAAWohB,EAAIzvC,OAC5BpB,EAAIuD,IAAI3F,KAAK6xB,SAAWohB,EAAIzvC,OAE5BqH,EAAIizB,EAAM17B,GACd07B,EAAM17B,GAAK07B,EAAM37B,GACjB27B,EAAM37B,GAAK0I,EAGZooC,EAAInV,MAAQA,GAGbnjC,OAAQ,SAASgwC,EAAMqU,EAAO/L,IAET,IAAhBA,EAAIqM,UAEPrM,EAAIsM,UAA0C,WAA9Bn1C,OAAA6I,KAAK5gB,OAAO4gD,EAAI7Y,UAAyBuQ,EAAK6V,SAASvN,EAAI7Y,UAAY6Y,EAAI7Y,SAC3F6Y,EAAIqM,SAAU,GAGf,IACI1sD,EADAhD,EAAI,EAaR,OAVI+6C,EAAKhf,KAAOqzB,EAAMrzB,KAAOsnB,EAAIsM,YAChC3vD,GAAK+6C,EAAKhf,KAAOqzB,EAAMrzB,MAAQsnB,EAAIsM,WAGnC3sD,EADGqgD,EAAI5Y,QAAe,GAALzqC,EACbqjD,EAAI5Y,OAAOzqC,IAAIqjD,EAAIzvC,MAAM,GAEzB5T,GAAGqjD,EAAIzvC,MAAM,GAElBmnC,EAAK4V,SAAStN,EAAIt9C,MAAOs9C,EAAInV,MAAMn4B,KAAK/S,EAAIqgD,EAAIzvC,OAASyvC,EAAIzvC,SAEpD,GAAL5T,IAGJqjD,EAAIqM,SAAU,EACdN,EAAMrzB,MAAQsnB,EAAIsM,WAEX,KCrDTuB,yCACA,CACCpmD,KAAM,SAAUu4C,EAAKkN,GAAS,KAI9BxlD,OAAQ,SAAUgwC,EAAMqU,EAAO/L,IAEV,IAAhBA,EAAIqM,UAEPrM,EAAI6M,MAAQnV,EAAKhf,KACjBsnB,EAAIqM,SAAU,EACdrM,EAAItnB,KAAOgf,EAAKhf,MAGjB,IAAIsO,EAAK0Q,EAAKhf,KAAOsnB,EAAI6M,MAKzB,OAJA7M,EAAI6M,MAAQnV,EAAKhf,KACjBsnB,EAAItnB,MAAQsO,GAGF,IADFgZ,EAAIz+C,GAAGylC,EAAI0Q,EAAK/wC,KAAMq5C,EAAKtI,KAGnCsI,EAAIqM,SAAU,GACP,KCvBTyB,yCACA,CACCrmD,KAAM,SAAUu4C,EAAKkN,GAAS,KAI9BxlD,OAAQ,SAAUgwC,EAAMqU,EAAO/L,GAG9B,OADAA,EAAIC,IAAIxH,QACD;;AfuBT,MAAMsV,2BAAO52C,OAAAK,MAAM3R,OAClB,CACA9B,UAAW,OAEXiqD,YAAa,KACbC,WAAY,KACZC,SAAU,KACVnC,MAAO,KAEPzU,iBAAkB,KAClBC,wBAAyB,KACzBC,wBAAyB,KAMzB7wC,KAAM,KAMNo7B,UAAW,EAMXrJ,KAAM,EAMN+O,QAAQ,EAMR2P,UAAU,EAMV+W,SAAS,EAMTC,aAAa,EAObpqD,OAAQ,WAiBP,OAdA1E,KAAK0uD,YAAc,GACnB1uD,KAAKqH,KAAO,GAEZrH,KAAKysD,MAAQG,yCAAMvtC,QACnBrf,KAAK2uD,WAAantC,yCAAKxB,KAAKX,QAC5Brf,KAAK4uD,SAAWptC,yCAAKxB,KAAKX,QAE1Brf,KAAK6uD,SAAU,EACf7uD,KAAK8uD,aAAc,EAEnB9uD,KAAKg4C,iBAAmB,KACxBh4C,KAAKi4C,wBAA0B,KAC/Bj4C,KAAKk4C,wBAA0B,KAExBl4C,KAAKiI,SAMbtD,OAAQ,WAEP3E,KAAKysD,MAAMntC,OACXtf,KAAK2uD,WAAWtiD,QAAQiT,OACxBtf,KAAK4uD,SAASviD,QAAQiT,OAEe,OAAjCtf,KAAKi4C,0BAERj4C,KAAKi4C,wBAAwB34B,OAC7Btf,KAAKi4C,wBAA0B,MAGK,OAAjCj4C,KAAKk4C,0BAERl4C,KAAKk4C,wBAAwB54B,OAC7Btf,KAAKk4C,wBAA0B,OAUjC6W,OAAQ,SAAUzpC,GAQjB,OANAA,EAAOjZ,QAEPuU,QAAQ0E,EAAOmnC,OACfnnC,EAAOmnC,MAAQzsD,KAAKysD,MAAM9pD,QAE1B2iB,EAAOopC,YAAc1uD,KAAK0uD,YACnBppC,EAAOrd,SASftF,MAAO,SAAUmsD,GAAY,GAE5B,IAAI1W,EAAO,IAAIqW,2BAIf,OAHArW,EAAK0W,YAAcA,EAEnB9uD,KAAK+uD,OAAO3W,GACLA,GASRG,WAAY,SAAUrqC,GAGrB,OADAlO,KAAKg4C,iBAAmB9pC,EACjBlO,MAURmqC,KAAM,SAAUj8B,EAAU9G,EAAQ,MAEjC,OAAK8G,GAEDlO,KAAKg4C,mBAAqBh4C,KAAKw4C,eAElCx4C,KAAKg4C,iBAAmBh4C,KAAKw4C,aAEQ,OAAjCx4C,KAAKi4C,yBAERj4C,KAAKi4C,wBAA0Bz2B,yCAAKxB,KAAKX,QACzCrf,KAAKk4C,wBAA0B12B,yCAAKxB,KAAKX,UAIzCrf,KAAKi4C,wBAAwBhwC,QAC7BjI,KAAKk4C,wBAAwBjwC,UAI/BjI,KAAKi4C,wBAAwBp1C,KAAKqL,GAClClO,KAAKk4C,wBAAwBr1C,KAAKuE,GAC3BpH,MApBeA,MAuBvBw4C,aAAc,SAAUnxC,EAAMrJ,GAE7B,IAAKA,EAAKi6C,wBAAwB33C,OACjC,OAAO,EAER,IAAI8G,EAAUpJ,EAAKk6C,wBAAwBlrC,QAC3C,OAAOhP,EAAKi6C,wBAAwBjrC,OAA7BhP,CAAqCA,EAAMoJ,IAQnDiF,MAAO,WAwBN,OAtBArM,KAAK2uD,WAAWtiD,QAChBrM,KAAK4uD,SAASviD,QACdrM,KAAKysD,MAAMpgD,QAEXrM,KAAKmoC,QAAS,EACdnoC,KAAK83C,UAAW,EAChB93C,KAAKo5B,KAAO,EACZp5B,KAAKyiC,UAAY,EAEoB,OAAjCziC,KAAKi4C,0BAERj4C,KAAKi4C,wBAAwB34B,OAC7Btf,KAAKi4C,wBAA0B,MAGK,OAAjCj4C,KAAKk4C,0BAERl4C,KAAKk4C,wBAAwB54B,OAC7Btf,KAAKk4C,wBAA0B,MAGhCl4C,KAAKg4C,iBAAmB,KACjBh4C,MAQRiI,MAAO,WAYN,OAVAjI,KAAK2uD,WAAWtiD,QAChBrM,KAAK4uD,SAASviD,QACdrM,KAAKysD,MAAMxkD,QAEXjI,KAAKmoC,QAAS,EACdnoC,KAAK83C,UAAW,EAChB93C,KAAKo5B,KAAO,EACZp5B,KAAKyiC,UAAY,EAEjBjlC,OAAOijC,OAAQzgC,KAAKqH,KAAMrH,KAAK0uD,aACxB1uD,MAQRqkD,QAAS,WAWR,OATArkD,KAAK2uD,WAAWtiD,QAChBrM,KAAK4uD,SAASviD,QACdrM,KAAKysD,MAAMpgD,QAEXrM,KAAKmoC,QAAS,EACdnoC,KAAK83C,UAAW,EAChB93C,KAAKo5B,KAAO,EACZp5B,KAAKyiC,UAAY,EAEVziC,MAcRgvD,QAAS,SAAU3nD,EAAK,MAMvB,OAJa,OAATA,IACHrH,KAAK0uD,YAAcrnD,GAEpB7J,OAAOijC,OAAQzgC,KAAKqH,KAAMrH,KAAK0uD,aACxB1uD,MASRivD,MAAO,SAAUhwD,GAGhB,OADAe,KAAKyiC,UAAYxjC,EAAQ,EAAMA,EAAQ,EAChCe,MASR+C,OAAQ,SAAUsE,GAGjB,OADArH,KAAKqH,KAAOA,EACLrH,MAQRsmC,MAAO,WAKN,OAHKtmC,KAAKmoC,SACTnoC,KAAKmoC,QAAS,GAERnoC,MAQRoM,OAAQ,WAQP,OANApM,KAAK83C,UAAW,EAChB93C,KAAKmoC,QAAS,EAETnoC,KAAK6uD,SACT7uD,KAAKkvD,KAAI,GAEHlvD,MASRkvD,IAAK,SAAUjnD,GAAM,GAEpB,OAAIjI,KAAK6uD,UAGI,GAAT5mD,GACHjI,KAAKiI,QAENgkD,yCAAI7jD,OAAOmH,IAAIvP,KAAKoI,OAAQpI,MAC5BA,KAAK6uD,SAAU,GANP7uD,MAgBTguD,SAAU,SAAUmB,EAAWlwD,GAE9B,IAAImwD,EAAOpvD,KAAKqH,KAEhB,GAA0B,iBAAf8nD,EAEV,GAA0B,mBAAfA,EAEVA,EAAWnvD,KAAMf,OAGlB,CACC,IAAIoB,EAAI,EAER,KAAgB,OAAT+uD,GAAiB/uD,EAAI8uD,EAAU7uD,OAAO,GAC5C8uD,EAAOA,EAAKD,EAAU9uD,MAEvB+uD,EAAKD,EAAU9uD,IAAMpB,OAItBmwD,EAAKD,GAAalwD,GAUpBgvD,SAAU,SAAUkB,EAAWlwD,EAAM,KAAMowD,EAAa,MAEvD,IAAID,EAAOpvD,KAAKqH,KAEhB,GAA0B,iBAAf8nD,EAEV,GAA0B,mBAAfA,EAEVC,EAAOD,EAAWnvD,KAAM,UAGzB,CACC,IAAIK,EAAI,EAER,KAAgB,OAAT+uD,GAAiB/uD,EAAI8uD,EAAU7uD,QACrC8uD,EAAOA,EAAKD,EAAU9uD,WAIxB+uD,EAAOA,EAAKD,GAQb,GANc,OAAVlwD,IACHA,EAAQmwD,GAEY,OAAjBC,IACHA,EAAeD,GAEM,iBAAXnwD,EAEV,OAAOA,EAAM,IAEZ,IAAK,IACJA,EAAQowD,EAAeC,OAAOrwD,EAAME,OAAO,IAC3C,MAED,IAAK,IACJF,EAAQowD,EAAeC,OAAOrwD,EAAME,OAAO,IAC3C,MAED,QACCF,EAAQqwD,OAAOrwD,OAIS,mBAAXA,IACfA,EAAQA,EAAOmwD,EAAMC,EAAcrvD,OAEpC,OAAOf,GAWRmJ,OAAQ,SAAUs/B,EAAI1pC,EAAK,MAK1B,GAHa,OAATA,IACHA,EAAOgC,MAEJhC,EAAKmqC,QAAUnqC,EAAKyuD,MAAME,aAG7B,OADA3uD,EAAK6wD,SAAU,GACR,EAKR,GAFA7wD,EAAKo7B,MAAQsO,EAAG1pC,EAAKykC,UAAUgsB,2BAAKhsB,WAEJ,IAA5BzkC,EAAKyuD,MAAMrkD,OAAOpK,GACrB,OAAO,EAER,IAAI85C,EAAW95C,EAAK85C,SAChB0U,EAAQxuD,EAAKyuD,MAAMD,MACnBC,EAAQzuD,EAAKyuD,MAIjB,OAFAzuD,EAAK85C,UAAW,EAEXA,GAAsC,OAA1B95C,EAAKg6C,oBAE0B,IAA3Ch6C,EAAKg6C,iBAAiBh6C,EAAKqJ,KAAMrJ,KACpCA,EAAKg6C,iBAAmB,MAErBh6C,EAAKyuD,QAAUA,GAASzuD,EAAKyuD,MAAMD,OAASA,IAOjDxuD,EAAK6wD,SAAU,EAEX7wD,EAAK8wD,aACRluC,QAAQ5iB,IAEF,IAVLA,EAAKoO,UACE,IAiBVmjD,iBAAkB,SAAUtwD,GAE3B,MAAsB,mBAAXA,EACHA,GAEqB,GAAtBA,EAAMuC,QAAQ,KAAavC,EAAMqI,MAAM,KAAOrI,GAUtDuwD,SAAU,WAET,IAAI9O,EAAM1gD,KAAKysD,MAAMl9C,IAAIm+C,yCAAQruC,MAAMsuC,2CAMvC,OAJA3tD,KAAK2uD,WAAW9rD,KAAM7C,KAAKysD,OAC3BzsD,KAAK4uD,SAAS/rD,KAAM69C,GAEpB1gD,KAAKysD,MAAQ/L,EAAI+L,MACVzsD,MAQRyvD,OAAQ,WAEP,IAAI/O,EAAM1gD,KAAKysD,MAAMl9C,IAAIm+C,yCAAQruC,MAAMwuC,2CAMvC,OAJA7tD,KAAK2uD,WAAW9rD,KAAM7C,KAAKysD,OAC3BzsD,KAAK4uD,SAAS/rD,KAAM69C,GAEpB1gD,KAAKysD,MAAQ/L,EAAI+L,MACVzsD,MASR0tC,OAAQ,SAAUz8B,GAEjB,IAAIyvC,EAAM1gD,KAAKysD,MAAMl9C,IAAIm+C,yCAAQruC,MAAMyuC,2CAOvC,OANApN,EAAIzvC,MAAQA,EAEZjR,KAAK2uD,WAAW9rD,KAAM7C,KAAKysD,OAC3BzsD,KAAK4uD,SAAS/rD,KAAM69C,GAEpB1gD,KAAKysD,MAAQ/L,EAAI+L,MACVzsD,MAQRg8B,IAAK,WAIJ,OAFAh8B,KAAK4uD,SAAS9hD,MAAMzE,QACpBrI,KAAKysD,MAAQzsD,KAAK2uD,WAAW7hD,MACtB9M,MAURrC,IAAK,SAAUyF,EAAOnE,GAErB,IAAIyhD,EAAM1gD,KAAKysD,MAAMl9C,IAAIm+C,yCAAQruC,MAAM0uC,2CAKvC,OAHArN,EAAIt9C,MAAQpD,KAAKuvD,iBAAiBnsD,GAClCs9C,EAAIzhD,MAAQA,EAELe,MAQR0sD,QAAS,WAGR,OADA1sD,KAAKysD,MAAMl9C,IAAIm+C,yCAAQruC,MAAM6uC,2CACtBluD,MASRmC,KAAM,SAAU0lC,GAMf,OAJU7nC,KAAKysD,MAAMl9C,IAAIm+C,yCAAQruC,MAAM8uC,2CAEnCtmB,SAAWA,EAER7nC,MAaR0vD,MAAO,SAAUtsD,EAAOykC,EAAUqlB,EAAYE,EAAUtlB,EAAO,MAE9D,IAAI4Y,EAAM1gD,KAAKysD,MAAMl9C,IAAIm+C,yCAAQruC,MAAM+uC,2CAQvC,OANA1N,EAAIt9C,MAAQpD,KAAKuvD,iBAAiBnsD,GAClCs9C,EAAI7Y,SAAWA,EACf6Y,EAAIwM,WAAaA,EACjBxM,EAAI0M,SAAWA,EACf1M,EAAI5Y,OAASA,EAEN9nC,MAYR2vD,QAAS,SAAUvsD,EAAOykC,EAAUulB,EAAUtlB,EAAO,MAEpD,IAAI4Y,EAAM1gD,KAAKysD,MAAMl9C,IAAIm+C,yCAAQruC,MAAM+uC,2CAQvC,OANA1N,EAAIt9C,MAAQpD,KAAKuvD,iBAAiBnsD,GAClCs9C,EAAI7Y,SAAWA,EACf6Y,EAAIwM,WAAa,KACjBxM,EAAI0M,SAAWA,EACf1M,EAAI5Y,OAASA,EAEN9nC,MAcRgrC,KAAM,SAAU5nC,EAAOykC,EAAU52B,EAAOi8C,EAAYE,EAAUtlB,EAAO,MAEpE,IAAI4Y,EAAM1gD,KAAKysD,MAAMl9C,IAAIm+C,yCAAQruC,MAAMgvC,2CASvC,OAPA3N,EAAIt9C,MAAQpD,KAAKuvD,iBAAiBnsD,GAClCs9C,EAAI7Y,SAAWA,EACf6Y,EAAIzvC,MAAQA,EACZyvC,EAAIwM,WAAaA,EACjBxM,EAAI0M,SAAWA,EACf1M,EAAI5Y,OAASA,EAEN9nC,MAgBRqrC,MAAO,SAAUjoC,EAAOykC,EAAU52B,EAAOi8C,EAAYE,EAAUtlB,GAE9D,IAAI4Y,EAAM1gD,KAAKysD,MAAMl9C,IAAIm+C,yCAAQruC,MAAMivC,2CAWvC,OATA5N,EAAIt9C,MAAQpD,KAAKuvD,iBAAiBnsD,GAClCs9C,EAAI7Y,SAAWA,EACf6Y,EAAIzvC,MAAQA,EACZyvC,EAAIwM,WAAaA,EACjBxM,EAAI0M,SAAWA,EACf1M,EAAI5Y,OAASA,EAEb4Y,EAAIr4C,QAEGrI,MASRm5C,KAAM,SAAUwH,GAKf,OAHU3gD,KAAKysD,MAAMl9C,IAAIm+C,yCAAQruC,MAAMmvC,2CACnC7N,IAAMA,EAEH3gD,MASRqlD,KAAM,SAAUpjD,GAKf,OAHUjC,KAAKysD,MAAMl9C,IAAIm+C,yCAAQruC,MAAMkvC,2CACnCtsD,GAAKA,EAEFjC,MAKR4vD,WAAY,SAAUxX,EAAMn5C,GAE3B,GAAc,OAAVA,EACH,OAAOm5C,EAAK/wC,KAAKstC,OAAO/e,GAEzBwiB,EAAK/wC,KAAKsc,UAAUvQ,IAAInU,GAASm5C,EAAK/wC,KAAKstC,OAAO/e,GAAI,IAGvDi6B,WAAY,SAAUzX,EAAMn5C,GAE3B,GAAc,OAAVA,EACH,OAAOm5C,EAAK/wC,KAAKstC,OAAO9e,GAEzBuiB,EAAK/wC,KAAKsc,UAAU,EAAGvQ,IAAInU,GAASm5C,EAAK/wC,KAAKstC,OAAO9e,KAStDxS,KAAM,SAAUpkB,GAEf,OAAOe,KAAKrC,IAAIqC,KAAK4vD,WAAY3wD,IASlCqkB,KAAM,SAAUrkB,GAEf,OAAOe,KAAKrC,IAAIqC,KAAK6vD,WAAY5wD,IAUlC4N,SAAU,SAAU6H,EAAG0O,GAEtB,OAAOpjB,KAAKrC,IAAIqC,KAAK4vD,WAAYl7C,GAAG/W,IAAIqC,KAAK6vD,WAAYzsC,IAW1D0sC,WAAY,SAAUjoB,EAAUkoB,EAAYjoB,GAE3C,OAAO9nC,KAAK0vD,MAAM1vD,KAAK4vD,WAAY/nB,EAAU,MAAOkoB,EAAa,EAAI,IAAM,KAAOtiD,KAAKoG,IAAIk8C,GAAajoB,IAWzGkoB,WAAY,SAAUnoB,EAAUkoB,EAAYjoB,GAE3C,OAAO9nC,KAAK0vD,MAAM1vD,KAAK6vD,WAAYhoB,EAAU,MAAOkoB,EAAa,EAAI,IAAM,KAAOtiD,KAAKoG,IAAIk8C,GAAajoB,IAazGnkB,UAAW,SAAUkkB,EAAUooB,EAAaC,EAAaC,EAASC,EAAQ,MAEzE,OAAOpwD,KAAKwvD,WACRE,MAAM1vD,KAAK4vD,WAAY/nB,EAAU,MAAOooB,EAAc,EAAI,IAAM,KAAOxiD,KAAKoG,IAAIo8C,GAAcE,GAC9FT,MAAM1vD,KAAK6vD,WAAYhoB,EAAU,MAAOqoB,EAAc,EAAI,IAAM,KAAOziD,KAAKoG,IAAIq8C,GAAcE,GAAoBD,GACnHn0B,OAaJ3H,OAAQ,SAAUwT,EAAUwoB,EAAWC,EAAWH,EAAQ,KAAMC,EAAQ,MAEvE,OAAOpwD,KAAKwvD,WACTE,MAAM1vD,KAAK4vD,WAAY/nB,EAAU,KAAMwoB,EAAWF,GAClDT,MAAM1vD,KAAK6vD,WAAYhoB,EAAU,KAAMyoB,EAAWF,GAAoBD,GACtEn0B,OAUJu0B,MAAO,SAAU1oB,EAAUulB,EAAUtlB,EAAO,MAE3C,OAAO9nC,KAAK0vD,MAAM1vD,KAAK4vD,WAAY/nB,EAAU,KAAMulB,EAAUtlB,IAU9D0oB,MAAO,SAAU3oB,EAAUulB,EAAUtlB,EAAO,MAE3C,OAAO9nC,KAAK0vD,MAAM1vD,KAAK6vD,WAAYhoB,EAAU,KAAMulB,EAAUtlB,IAU9D2oB,OAAQ,SAAU5oB,EAAUulB,EAAUtlB,GAErC,OAAO9nC,KAAK0vD,MAAM,KAAM7nB,EAAU,KAAMulB,EAAUtlB,IAUnD4oB,OAAQ,SAAU7oB,EAAUulB,EAAUtlB,GAErC,OAAO9nC,KAAK0vD,MAAM,KAAM7nB,EAAU,KAAMulB,EAAUtlB,IAanDnlB,MAAO,SAAUklB,EAAUwoB,EAAWC,EAAWH,EAASC,EAAQ,MAEjE,OAAOpwD,KAAKwvD,WACTE,MAAM,KAAM7nB,EAAU,KAAMwoB,EAAWF,GACvCT,MAAM,KAAM7nB,EAAU,KAAMyoB,EAAWF,GAAoBD,GAC3Dn0B,OAWJlY,OAAQ,SAAU+jB,EAAUkoB,EAAYjoB,GAEvC,OAAO9nC,KAAK0vD,MAAM,QAAS7nB,EAAU,MAAOkoB,EAAa,EAAI,IAAM,KAAOtiD,KAAKoG,IAAIk8C,GAAajoB,MAQlG2mB,2BAAKhsB,UAAY,EAOjBgsB,2BAAKQ,MAAQ,SAAUhwD,GAEtBwvD,2BAAKhsB,UAAYxjC,EAAQ,EAAMA,EAAQ,GAGxC+e,yCAAS+B,WAAW0uC,2BAAM,M,IAC1BkC,yCAAelC,2BgBj9Bf52C,OAAAxZ,cAAA;;;;AAaA,MAAMuyD,kCAAc/4C,OAAAK,MAAM3R,OACzB,CAIA9B,UAAW,cAMXjG,GAAI,KAMJm2C,OAAQ,KAMRjU,MAAO,EAMPr5B,KAAM,KAMNwpD,IAAK,KAMLhtD,UAAW,KAKXitD,kBAAmB,KAMnBC,QAAS,KAMTrsD,OAAQ,SAAUgQ,EAAG0O,EAAG6K,EAAOC,GAE9BluB,KAAK20C,OAASwU,yCAAQnpC,KAAKX,QAE3Brf,KAAK20C,OAAOhxB,UAAWjP,EAAG0O,GAC1BpjB,KAAK20C,OAAOnhB,OAAQvF,EAAOC,GAAQ,GAEnCluB,KAAK0gC,MAAQkwB,kCAAYI,MAAQJ,kCAAYK,QAAUL,kCAAYM,MAAQN,kCAAYO,WACvFnxD,KAAKqH,KAAO,KACZrH,KAAK6wD,IAAM,KAEX7wD,KAAK+wD,QAAUpL,yCAAQ3lC,KAAKX,MAAMrf,OAMnC2E,OAAQ,WAEP3E,KAAKoxD,OAAM,GAEO,OAAdpxD,KAAKqH,OAERuZ,QAAQ5gB,KAAKqH,MACbrH,KAAKqH,KAAO,MAGbrH,KAAK+wD,QAAQ1L,OACbrlD,KAAK+wD,QAAQzxC,OAEbtf,KAAK20C,OAAOr1B,QAOb+xC,MAAO,SAAUpyD,GAGhB,OADAe,KAAKxB,GAAKS,EACHe,MAORsxD,SAAU,SAAUryD,GAGnB,OADAe,KAAK0gC,OAASzhC,EACPe,MAORuxD,WAAY,SAAUtyD,GAGrB,OADAe,KAAK0gC,QAAUzhC,EACRe,MAORwxD,SAAU,SAAUC,EAASxyD,EAAM,MAElC,OAAc,OAAVA,GACKe,KAAK0gC,MAAQ+wB,KAAaA,GAE3BzxD,KAAK0gC,MAAQ+wB,KAAaxyD,GAQnCqN,QAAS,SAAUjF,GAOlB,OALArH,KAAKqH,KAAOA,EAEM,OAAdrH,KAAKqH,OACRrH,KAAKqH,KAAKi+C,KAAOtlD,MAEXA,MAORuM,QAAS,WAER,OAAOvM,KAAKqH,MAObqqD,OAAQ,SAAUC,GAGjB,OADA3xD,KAAK6wD,IAAMc,EACJ3xD,MAOR4xD,OAAQ,WAEP,OAAO5xD,KAAK6wD,KAQbxL,KAAM,SAAS7lD,EAAMslD,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAM0M,EAAK,KAAMC,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAE5H,OAAiB,OAAbhyD,KAAK6wD,MAAkD,IAAlC7wD,KAAK6wD,IAAIhsD,eAAerF,IAG1CQ,KAAK6wD,IAAIrxD,GAAOQ,KAAM8kD,EAAMC,EAAMC,EAAMC,EAAMC,EAAMC,EAAM0M,EAAMC,EAAMC,EAAMC,IAapFC,QAAS,SAAUhzD,EAAM,KAAMi6C,GAAO,GAErC,OAAc,OAAVj6C,KACOe,KAAK0gC,MAAQkwB,kCAAYK,WAErB,IAAX/X,GAAgE,IAA3Cl5C,KAAK0gC,MAAQkwB,kCAAYsB,gBAGlDlyD,KAAK0gC,QAAUkwB,kCAAYK,SACb,IAAVhyD,IAAgBe,KAAK0gC,OAASkwB,kCAAYK,UAHtCjxD,OAgBTmyD,YAAa,SAAUlzD,EAAM,MAE5B,OAAc,OAAVA,KACOe,KAAK0gC,MAAQkwB,kCAAYsB,eAEpClyD,KAAK0gC,QAAUkwB,kCAAYsB,cACb,IAAVjzD,IAAgBe,KAAK0gC,OAASkwB,kCAAYsB,cAEvClyD,OAWRoxD,MAAO,SAAUnyD,EAAM,MAEtB,OAAc,OAAVA,KACOe,KAAK0gC,MAAQkwB,kCAAYI,QAEpChxD,KAAK0gC,QAAUkwB,kCAAYI,OACb,IAAV/xD,IAAgBe,KAAK0gC,OAASkwB,kCAAYI,OAEvChxD,OAWRoyD,MAAO,SAAUnzD,EAAM,MAEtB,OAAc,OAAVA,KACOe,KAAK0gC,MAAQkwB,kCAAYM,QAEpClxD,KAAK0gC,QAAUkwB,kCAAYM,OACb,IAAVjyD,IAAgBe,KAAK0gC,OAASkwB,kCAAYM,OAEvClxD,OAWRqyD,iBAAkB,SAAUpzD,EAAM,MAEjC,OAAc,OAAVA,KACOe,KAAK0gC,MAAQkwB,kCAAY0B,qBAEpCtyD,KAAK0gC,QAAUkwB,kCAAY0B,oBACb,IAAVrzD,IAAgBe,KAAK0gC,OAASkwB,kCAAY0B,oBAEvCtyD,OAWRuyD,UAAW,SAAUtzD,EAAM,MAE1B,OAAc,OAAVA,KACOe,KAAK0gC,MAAQkwB,kCAAYO,aAEpCnxD,KAAK0gC,QAAUkwB,kCAAYO,YACb,IAAVlyD,IAAgBe,KAAK0gC,OAASkwB,kCAAYO,YAEvCnxD,OAORQ,OAAQ,WAGP,OADAR,KAAK+wD,QAAQ1L,OACNrlD,MAORwyD,KAAM,WAEL,OAAuB,OAAnBxyD,KAAK6D,YAA+E,IAAzD7D,KAAKwxD,SAASZ,kCAAYI,MAAQJ,kCAAYM,QAG7ElxD,KAAK6D,UAAU2uD,KAAKxyD,MAFZA,MAUTwzB,OAAQ,SAAUvF,EAAOC,GAIxB,OAFAluB,KAAK0gC,OAASkwB,kCAAYM,MAC1BlxD,KAAK20C,OAAOnhB,OAAQvF,EAAOC,GAAQ,GAC5BluB,MAORwmD,SAAU,SAAUwC,EAAQC,GAI3B,OAFAjpD,KAAK0gC,OAASkwB,kCAAYM,MAC1BlxD,KAAK20C,OAAO6R,SAAUwC,EAAQC,GAAS,GAChCjpD,MAQR2jB,UAAW,SAAUC,EAAIC,EAAIykC,GAAS,GAIrC,OAFAtoD,KAAK0gC,OAASkwB,kCAAYM,MAC1BlxD,KAAK20C,OAAOhxB,UAAWC,EAAIC,EAAIykC,GACxBtoD,MAWRyyD,YAAa,SAAU/9C,EAAG0O,GAAE,GAO3B,OALU,IAANA,IACHA,EAAI1O,EAAE0O,EACN1O,EAAIA,EAAEA,GAGA1U,KAAK2jB,UAAiB,OAANjP,EAAa04B,QAAQ14B,GAAG1U,KAAK20C,OAAOgU,IAAM,EAAS,OAANvlC,EAAagqB,QAAQhqB,GAAGpjB,KAAK20C,OAAOiU,IAAM,GAAG,MAOnHgI,kCAAYI,MAAa,EACzBJ,kCAAYK,QAAc,EAC1BL,kCAAYsB,aAAkB,EAC9BtB,kCAAYM,MAAa,EACzBN,kCAAY0B,mBAAsB,GAClC1B,kCAAYO,WAAgB,GAC5BP,kCAAY8B,aAAgB,GAE5B9B,kCAAY+B,QAAW,IACvB/B,kCAAYgC,UAAY,IAMxBhC,kCAAYiC,UAAY,WAEvB,IAAIC,EAAOlC,kCAAYgC,UACvB,GAAa,aAATE,EAAsB,MAAM,IAAIp0D,MAAO,wDAK3C,OAHAo0D,IAAS,EACTlC,kCAAYgC,UAAYE,EAEjBA,G,IAGRC,yCAAenC,kCC1af/4C,OAAAxZ,cAAA;;;;AAaA,MAAM20D,2BAAOn7C,OAAAK,MAAM3R,OAClB,CAIA9B,UAAW,OAKXwuD,KAAM,KAMNhiD,MAAO,EAMPiiD,MAAO,EAAGC,MAAO,EAMjBC,GAAI,EAAGC,GAAI,EAKXC,OAAQ,EAMRC,oBAAoB,EAWpB7uD,OAAQ,SAAUupB,EAAOC,EAAQklC,EAAIC,EAAG,MAEvCplC,EAAQ,GAAKxgB,KAAK6pC,KAAK7pC,KAAK+lD,KAAKvlC,IACjCC,EAAS,GAAKzgB,KAAK6pC,KAAK7pC,KAAK+lD,KAAKtlC,IAElCluB,KAAKkzD,MAAQjlC,GAAS,EACtBjuB,KAAKmzD,MAAQjlC,GAAU,EAEZ,OAAPmlC,IACHA,EAAKD,GAENA,EAAK3lD,KAAK6W,MAAM7W,KAAK+lD,KAAKJ,IAC1BC,EAAK5lD,KAAK6W,MAAM7W,KAAK+lD,KAAKH,IAE1BrzD,KAAKozD,GAAKA,EACVpzD,KAAKqzD,GAAKA,EAEV,IAAI5+B,EAAIxG,GAASmlC,EACb1+B,EAAIxG,GAAUmlC,EAEb5+B,IACJ2+B,EAAK3lD,KAAK+lD,KAAKvlC,GACfwG,EAAI,GAGAC,IACJ2+B,EAAK5lD,KAAK+lD,KAAKtlC,GACfwG,EAAI,GAGL10B,KAAKizD,KAAO,IAAIxwD,MAAMgyB,EAAEC,GAAGpW,KAAK,MAChCte,KAAKszD,OAAS7+B,GAMf9vB,OAAQ,WAEP3E,KAAKqM,QACLrM,KAAKizD,KAAO,MAWb1iD,OAAQ,SAAUtR,EAAM,MAEvB,OAAc,OAAVA,EACIe,KAAKuzD,oBAEbvzD,KAAKuzD,mBAAqBt0D,EACnBe,OAORqM,MAAO,WAEN,IAAK,IAAIhM,EAAI,EAAGA,EAAIL,KAAKizD,KAAK3yD,OAAQD,IACtC,CACC,GAAqB,OAAjBL,KAAKizD,KAAK5yD,GACb,SAED,IAAI6C,EAEJ,KAAsC,QAA9BA,EAAIlD,KAAKizD,KAAK5yD,GAAG2M,UAExB9J,EAAE6tD,QAAQvwD,OAAOR,KAAKyzD,QAASzzD,MAC/BkD,EAAEW,UAAY,KAEd+c,QAAQ1d,GAGTlD,KAAKizD,KAAK5yD,GAAGif,OACbtf,KAAKizD,KAAK5yD,GAAK,KAGhBL,KAAKiR,MAAQ,GAOdhJ,MAAO,WAEN,IAAK,IAAI5H,EAAI,EAAGA,EAAIL,KAAKizD,KAAK3yD,OAAQD,IACtC,CACC,GAAqB,OAAjBL,KAAKizD,KAAK5yD,GACb,SAED,IAAI6C,EAEJ,KAAsC,QAA9BA,EAAIlD,KAAKizD,KAAK5yD,GAAG2M,UAExB9J,EAAE6tD,QAAQvwD,OAAOR,KAAKyzD,QAASzzD,MAC/BkD,EAAEW,UAAY,KAGf7D,KAAKizD,KAAK5yD,GAAGif,OACbtf,KAAKizD,KAAK5yD,GAAK,KAGhBL,KAAKiR,MAAQ,GAOd1B,IAAK,SAAU3M,GAEd,IAAqC,IAAjCmwD,yCAAYhyC,WAAWne,GAC1B,MAAM,IAAIlE,MAAO,kCAElB,IAAI2B,EAAI+S,IAAIxQ,EAAM+xC,OAAO9e,GAAG71B,KAAKmzD,OAAUnzD,KAAKqzD,IAAMrzD,KAAKszD,OAASlgD,IAAIxQ,EAAM+xC,OAAO/e,GAAG51B,KAAKkzD,OAAUlzD,KAAKozD,IAC5G,QAAI/yD,EAAI,GAAKA,GAAKL,KAAKizD,KAAK3yD,UAEP,OAAjBN,KAAKizD,KAAK5yD,KACbL,KAAKizD,KAAK5yD,GAAKmhB,yCAAKxB,KAAKX,SAE1Brf,KAAKizD,KAAK5yD,GAAGwC,KAAKD,GAClB5C,KAAKiR,QAELrO,EAAKiB,UAAY7D,KACjB4C,EAAKkuD,kBAAoBluD,EAAKmuD,QAAQxhD,IAAIvP,KAAKyzD,QAASzzD,KAAMK,EAAGL,KAAKizD,KAAK5yD,GAAGogB,SAEvE,IAMRgzC,QAAS,SAAU7wD,EAAM5E,EAAMyO,EAAO6zC,GAMrC,OAJAtiD,EAAKi1D,KAAKxmD,GAAOjM,OAAO8/C,GACxBtiD,EAAKiT,QAELrO,EAAKiB,UAAY,MACV,GAORrD,OAAQ,SAAUoC,GAGjB,OADAA,EAAKmuD,QAAQrL,MAAM1lD,KAAK8wD,mBACjBluD,GAQR4vD,KAAM,SAAU5vD,GAEfA,EAAK2uD,WAAWwB,yCAAY7B,OAE5B,IAAI5Q,EAAO19C,EAAKkuD,kBAEZzwD,EAAI+S,IAAIxQ,EAAM+xC,OAAO9e,GAAG71B,KAAKmzD,OAAUnzD,KAAKqzD,IAAMrzD,KAAKszD,OAASlgD,IAAIxQ,EAAM+xC,OAAO/e,GAAG51B,KAAKkzD,OAAUlzD,KAAKozD,IAC5G,OAAI/yD,EAAI,GAAKA,GAAKL,KAAKizD,KAAK3yD,QAE3BsC,EAAKmuD,QAAQrL,MAAMpF,IACZ,IAGJA,EAAKyE,OAAS1kD,IAGlBL,KAAKizD,KAAK3S,EAAKyE,MAAMvkD,OAAO8/C,EAAK0E,MAEZ,OAAjBhlD,KAAKizD,KAAK5yD,KACbL,KAAKizD,KAAK5yD,GAAKmhB,yCAAKxB,KAAKX,SAE1Brf,KAAKizD,KAAK5yD,GAAGwC,KAAKD,GAElB09C,EAAKyE,KAAO1kD,EACZigD,EAAK0E,KAAOhlD,KAAKizD,KAAK5yD,GAAGogB,SAVjB,IAoBTizC,gBAAiB,SAAU/e,EAAQgf,EAAcC,EAAY1lD,EAAU9G,GAEtE,IAAIysD,GAAMlf,EAAQ9e,GAAG71B,KAAKmzD,OAAU,GAAGnzD,KAAKqzD,GAAG,IAAMrzD,KAAKqzD,IAAMrzD,KAAKszD,OACjEQ,GAAMnf,EAAQ5e,GAAG/1B,KAAKmzD,OAAU,GAAGnzD,KAAKqzD,GAAG,IAAMrzD,KAAKqzD,IAAMrzD,KAAKszD,OACjElM,EAAMzS,EAAQ/e,GAAG51B,KAAKkzD,OAAU,GAAGlzD,KAAKozD,GAAG,IAAMpzD,KAAKozD,GACtDjwD,EAAMwxC,EAAQ7e,GAAG91B,KAAKkzD,OAAU,GAAGlzD,KAAKozD,GAAG,IAAMpzD,KAAKozD,GAEtD71D,EAAIyC,KAAKizD,KAAK3yD,OAAO,EAErBuzD,EAAK,IAAGA,EAAK,GAAOC,EAAK,IAAGA,EAAK,GACjC1M,EAAK,IAAGA,EAAK,GAAOjkD,EAAK,IAAGA,EAAK,GACjC0wD,EAAKt2D,IAAGs2D,EAAKt2D,GAAOu2D,EAAKv2D,IAAGu2D,EAAKv2D,GACjC6pD,EAAK7pD,IAAG6pD,EAAK7pD,GAAO4F,EAAK5F,IAAG4F,EAAK5F,GAErC,IAAK,IAAI2F,EAAI2wD,EAAI3wD,GAAK4wD,EAAI5wD,GAAKlD,KAAKszD,OAEnC,IAAK,IAAIjzD,EAAI+mD,EAAI/mD,GAAK8C,EAAI9C,IAC1B,CACC,IAAImH,EAAItE,EAAI7C,EACZ,KAAImH,EAAIjK,GAAsB,OAAjByC,KAAKizD,KAAKzrD,IAEvB,IAAK,IAAIpK,EAAI4C,KAAKizD,KAAKzrD,GAAGgZ,IAAKpjB,EAAGA,EAAIA,EAAE2J,KACxC,CACC,MAAMiH,EAAI5Q,EAAE6B,MAGZ,IAA6C,IAAzC+O,EAAEwjD,SAASmC,EAAcC,OAGG,IAA5B5zD,KAAKuzD,qBAAgCrwD,GAAK2wD,EAAG,GAAKxzD,GAAK+mD,EAAG,GAAKlkD,GAAK4wD,EAAG,GAAKzzD,GAAK8C,EAAG,KAEnF6K,EAAE2mC,OAAO7e,GAAK6e,EAAO/e,IAAM5nB,EAAE2mC,OAAO5e,GAAK4e,EAAO9e,IAAM7nB,EAAE2mC,OAAO/e,GAAK+e,EAAO7e,IAAM9nB,EAAE2mC,OAAO9e,GAAK8e,EAAO5e,MAI9E,IAAzB7nB,EAASF,EAAG5G,IACf,UAUL2sD,eAAgB,SAAUpf,EAAQgf,EAAcC,GAE/C,IAAIC,GAAMlf,EAAQ9e,GAAG71B,KAAKmzD,OAAU,GAAGnzD,KAAKqzD,GAAG,IAAMrzD,KAAKqzD,IAAMrzD,KAAKszD,OACjEQ,GAAMnf,EAAQ5e,GAAG/1B,KAAKmzD,OAAU,GAAGnzD,KAAKqzD,GAAG,IAAMrzD,KAAKqzD,IAAMrzD,KAAKszD,OACjElM,EAAMzS,EAAQ/e,GAAG51B,KAAKkzD,OAAU,GAAGlzD,KAAKozD,GAAG,IAAMpzD,KAAKozD,GACtDjwD,EAAMwxC,EAAQ7e,GAAG91B,KAAKkzD,OAAU,GAAGlzD,KAAKozD,GAAG,IAAMpzD,KAAKozD,GAEtD71D,EAAIyC,KAAKizD,KAAK3yD,OAAO,EAErBuzD,EAAK,IAAGA,EAAK,GAAOC,EAAK,IAAGA,EAAK,GACjC1M,EAAK,IAAGA,EAAK,GAAOjkD,EAAK,IAAGA,EAAK,GACjC0wD,EAAKt2D,IAAGs2D,EAAKt2D,GAAOu2D,EAAKv2D,IAAGu2D,EAAKv2D,GACjC6pD,EAAK7pD,IAAG6pD,EAAK7pD,GAAO4F,EAAK5F,IAAG4F,EAAK5F,GAErC,IAAImJ,EAAO8a,yCAAKxB,KAAKX,QAErB,IAAK,IAAInc,EAAI2wD,EAAI3wD,GAAK4wD,EAAI5wD,GAAKlD,KAAKszD,OAEnC,IAAK,IAAIjzD,EAAI+mD,EAAI/mD,GAAK8C,EAAI9C,IAC1B,CACC,IAAImH,EAAItE,EAAI7C,EACZ,KAAImH,EAAIjK,GAAsB,OAAjByC,KAAKizD,KAAKzrD,IAEvB,IAAK,IAAIpK,EAAI4C,KAAKizD,KAAKzrD,GAAGgZ,IAAKpjB,EAAGA,EAAIA,EAAE2J,KACxC,CACC,MAAMiH,EAAI5Q,EAAE6B,OAGiC,IAAzC+O,EAAEwjD,SAASmC,EAAcC,MAGG,IAA5B5zD,KAAKuzD,qBAAgCrwD,GAAK2wD,EAAG,GAAKxzD,GAAK+mD,EAAG,GAAKlkD,GAAK4wD,EAAG,GAAKzzD,GAAK8C,EAAG,KAEnF6K,EAAE2mC,OAAO7e,GAAK6e,EAAO/e,IAAM5nB,EAAE2mC,OAAO5e,GAAK4e,EAAO9e,IAAM7nB,EAAE2mC,OAAO/e,GAAK+e,EAAO7e,IAAM9nB,EAAE2mC,OAAO9e,GAAK8e,EAAO5e,KAI3GrvB,EAAK7D,KAAKmL,KAKb,OAAOtH,GAORstD,cAAe,SAAUrf,EAAQgf,EAAcC,GAE9C,IAAIC,GAAMlf,EAAQ9e,GAAG71B,KAAKmzD,OAAU,GAAGnzD,KAAKqzD,GAAG,IAAMrzD,KAAKqzD,IAAMrzD,KAAKszD,OACjEQ,GAAMnf,EAAQ5e,GAAG/1B,KAAKmzD,OAAU,GAAGnzD,KAAKqzD,GAAG,IAAMrzD,KAAKqzD,IAAMrzD,KAAKszD,OACjElM,EAAMzS,EAAQ/e,GAAG51B,KAAKkzD,OAAU,GAAGlzD,KAAKozD,GAAG,IAAMpzD,KAAKozD,GACtDjwD,EAAMwxC,EAAQ7e,GAAG91B,KAAKkzD,OAAU,GAAGlzD,KAAKozD,GAAG,IAAMpzD,KAAKozD,GAEtD71D,EAAIyC,KAAKizD,KAAK3yD,OAAO,EAErBuzD,EAAK,IAAGA,EAAK,GAAOC,EAAK,IAAGA,EAAK,GACjC1M,EAAK,IAAGA,EAAK,GAAOjkD,EAAK,IAAGA,EAAK,GACjC0wD,EAAKt2D,IAAGs2D,EAAKt2D,GAAOu2D,EAAKv2D,IAAGu2D,EAAKv2D,GACjC6pD,EAAK7pD,IAAG6pD,EAAK7pD,GAAO4F,EAAK5F,IAAG4F,EAAK5F,GAErC,IAAIyM,EAAI,EAER,IAAK,IAAI9G,EAAI2wD,EAAI3wD,GAAK4wD,EAAI5wD,GAAKlD,KAAKszD,OAEnC,IAAK,IAAIjzD,EAAI+mD,EAAI/mD,GAAK8C,EAAI9C,IAC1B,CACC,IAAImH,EAAItE,EAAI7C,EACZ,KAAImH,EAAIjK,GAAsB,OAAjByC,KAAKizD,KAAKzrD,IAEvB,IAAK,IAAIpK,EAAI4C,KAAKizD,KAAKzrD,GAAGgZ,IAAKpjB,EAAGA,EAAIA,EAAE2J,KACxC,CACC,MAAMiH,EAAI5Q,EAAE6B,OAGiC,IAAzC+O,EAAEwjD,SAASmC,EAAcC,MAGG,IAA5B5zD,KAAKuzD,qBAAgCrwD,GAAK2wD,EAAG,GAAKxzD,GAAK+mD,EAAG,GAAKlkD,GAAK4wD,EAAG,GAAKzzD,GAAK8C,EAAG,KAEnF6K,EAAE2mC,OAAO7e,GAAK6e,EAAO/e,IAAM5nB,EAAE2mC,OAAO5e,GAAK4e,EAAO9e,IAAM7nB,EAAE2mC,OAAO/e,GAAK+e,EAAO7e,IAAM9nB,EAAE2mC,OAAO9e,GAAK8e,EAAO5e,KAI3G/rB,MAKH,OAAOA,GAORiqD,YAAa,SAAUtf,EAAQgf,EAAcC,GAE5C,IAAIC,GAAMlf,EAAQ9e,GAAG71B,KAAKmzD,OAAU,GAAGnzD,KAAKqzD,GAAG,IAAMrzD,KAAKqzD,IAAMrzD,KAAKszD,OACjEQ,GAAMnf,EAAQ5e,GAAG/1B,KAAKmzD,OAAU,GAAGnzD,KAAKqzD,GAAG,IAAMrzD,KAAKqzD,IAAMrzD,KAAKszD,OACjElM,EAAMzS,EAAQ/e,GAAG51B,KAAKkzD,OAAU,GAAGlzD,KAAKozD,GAAG,IAAMpzD,KAAKozD,GACtDjwD,EAAMwxC,EAAQ7e,GAAG91B,KAAKkzD,OAAU,GAAGlzD,KAAKozD,GAAG,IAAMpzD,KAAKozD,GAEtD71D,EAAIyC,KAAKizD,KAAK3yD,OAAO,EAErBuzD,EAAK,IAAGA,EAAK,GAAOC,EAAK,IAAGA,EAAK,GACjC1M,EAAK,IAAGA,EAAK,GAAOjkD,EAAK,IAAGA,EAAK,GACjC0wD,EAAKt2D,IAAGs2D,EAAKt2D,GAAOu2D,EAAKv2D,IAAGu2D,EAAKv2D,GACjC6pD,EAAK7pD,IAAG6pD,EAAK7pD,GAAO4F,EAAK5F,IAAG4F,EAAK5F,GAErC,IAAK,IAAI2F,EAAI2wD,EAAI3wD,GAAK4wD,EAAI5wD,GAAKlD,KAAKszD,OAEnC,IAAK,IAAIjzD,EAAI+mD,EAAI/mD,GAAK8C,EAAI9C,IAC1B,CACC,IAAImH,EAAItE,EAAI7C,EACZ,KAAImH,EAAIjK,GAAsB,OAAjByC,KAAKizD,KAAKzrD,IAEvB,IAAK,IAAIpK,EAAI4C,KAAKizD,KAAKzrD,GAAGgZ,IAAKpjB,EAAGA,EAAIA,EAAE2J,KACxC,CACC,MAAMiH,EAAI5Q,EAAE6B,MAGZ,IAA6C,IAAzC+O,EAAEwjD,SAASmC,EAAcC,MAGG,IAA5B5zD,KAAKuzD,sBAAgCrwD,GAAK2wD,EAAG,GAAKxzD,GAAK+mD,EAAG,GAAKlkD,GAAK4wD,EAAG,GAAKzzD,GAAK8C,EAAG,MAEnF6K,EAAE2mC,OAAO7e,GAAK6e,EAAO/e,IAAM5nB,EAAE2mC,OAAO5e,GAAK4e,EAAO9e,IAAM7nB,EAAE2mC,OAAO/e,GAAK+e,EAAO7e,IAAM9nB,EAAE2mC,OAAO9e,GAAK8e,EAAO5e,KAI3G,OAAO/nB,GAKV,OAAO,Q,IAITkmD,yCAAelB,2BClcfn7C,OAAAxZ,cAAA,SCAAwZ,OAAAxZ,cAAA;;AAUA,MAAM81D,gCAAYt8C,OAAAK,MAAM3R,OACvB,CACA9B,UAAW,YAMX2vD,eAAgB,KAMhBnmC,MAAO,EAMPC,OAAQ,EAMRgL,OAAQ,EAMRm7B,MAAO,KAMP3zB,MAAO,EAMPtG,EAAG,KAMHk6B,aAAc,EAMdC,UAAW,EAOXC,MAAO,KAUP9vD,OAAQ,SAAUupB,EAAM,MAAOC,EAAO,OAErCluB,KAAKiuB,MAAQA,EACbjuB,KAAKkuB,OAASA,EAEdluB,KAAK0gC,MAAQyzB,gCAAUlD,QAAUkD,gCAAUhD,WAC3CnxD,KAAKw0D,MAAQ7O,yCAAQ3lC,KAAKX,MAAMrf,OAMjC2E,OAAQ,WAEP3E,KAAKw0D,MAAMl1C,QAWZ2yC,QAAS,SAAUhzD,EAAM,MAExB,OAAc,OAAVA,KACOe,KAAK0gC,MAAQyzB,gCAAUlD,UAElCjxD,KAAK0gC,QAAUyzB,gCAAUlD,SACX,IAAVhyD,IAAgBe,KAAK0gC,OAASyzB,gCAAUlD,SAErCjxD,OAWRuyD,UAAW,SAAUtzD,EAAM,MAE1B,OAAc,OAAVA,KACOe,KAAK0gC,MAAQyzB,gCAAUhD,aAElCnxD,KAAK0gC,QAAUyzB,gCAAUhD,YACX,IAAVlyD,IAAgBe,KAAK0gC,OAASyzB,gCAAUhD,YAErCnxD,OAORy0D,kBAAmB,SAAU9f,GAG5B,OADA30C,KAAKo0D,eAAiBzf,EACf30C,MAOR00D,YAAa,SAAU9xD,EAAM5E,GAG5B,OADAA,EAAKu2D,YACE3xD,EAAK68B,KAAKzhC,EAAKo8B,IAOvBu6B,MAAO,SAAU/xD,GAEhBA,EAAKgyD,SAAW50D,KAAKk5B,QAAUt2B,EAAMiyD,QAAUjyD,EAAK+xC,OAAO5e,GAAO,SAQnEy8B,KAAM,SAAU5vD,GAEf,MAAM,IAAIlE,MAAO,oCAOlB2N,MAAO,WAEN,MAAM,IAAI3N,MAAO,qCAOlBuJ,MAAO,WAEN,MAAM,IAAIvJ,MAAO,qCAOlB6Q,IAAK,SAAU3M,GAEd,MAAM,IAAIlE,MAAO,mCAOlB8B,OAAQ,SAAUoC,GAEjB,MAAM,IAAIlE,MAAO,sCAOlB+gC,KAAM,SAASrF,GAEd,IAAuB,IAAnBp6B,KAAKiyD,UAAqB,OAE9B,IAAI6C,EAAmB16B,EAAEqC,cAAcz8B,KAAK0gC,MAAQyzB,gCAAUhD,YAE9D/2B,EAAElB,OAASl5B,KAAKk5B,OAEhBl5B,KAAKu0D,UAAY,EACjBv0D,KAAKo6B,EAAIA,EAETp6B,KAAKwxB,SACLxxB,KAAKw0D,MAAMnP,KAAKjrB,IAES,IAArB06B,GAA2B16B,EAAEsC,gBAOlClL,OAAQ,WAEP,MAAM,IAAI9yB,MAAO,wCAQnBy1D,gCAAUlD,QAAU,EACpBkD,gCAAUhD,WAAa,E,IAEvB4D,yCAAeZ,gCC3Pft8C,OAAAxZ,cAAA;;;;;;AAeA,MAAM22D,+BAAWn9C,OAAAK,MAAM3R,OACtB,CACA9B,UAAW,WAQXwpB,MAAO,EAAGgnC,aAAc,EACxB/mC,OAAQ,EAAGgnC,cAAe,EAK1BtvC,GAAI,EACJC,GAAI,EAKJnR,EAAG,EACH0O,EAAG,EAKH+xC,aAAc,EACdC,aAAc,EAKdrtC,OAAQ,KAORlkB,UAAW,KAMXwxD,aAAc,EACdC,aAAc,EAKdC,UAAW,KACXC,WAAY,EACZC,WAAY,EAKZC,YAAY,EACZC,YAAY,EAKZj1B,MAAO,EAKP/d,MAAO,EAKP+X,YAAa,EAObia,OAAQ,KAKRihB,QAAS,KAOTC,YAAa,KAObC,aAAc,KAKdC,SAAU,KAcVrxD,OAAQ,SAAUkhB,EAAIC,EAAIoI,EAAOC,EAAQ8nC,EAAgBC,GAExDj2D,KAAKq1D,aAAe,GACpBr1D,KAAKs1D,aAAe,GACpBt1D,KAAKu1D,UAAY,KAEjBv1D,KAAK4lB,GAAKA,EACV5lB,KAAK6lB,GAAKA,EACV7lB,KAAKiuB,MAAQjuB,KAAKi1D,aAAehnC,EACjCjuB,KAAKkuB,OAASluB,KAAKk1D,cAAgBhnC,EAEnCluB,KAAK0U,EAAI,EACT1U,KAAKojB,EAAI,EAETpjB,KAAK20C,OAASwU,yCAAQnpC,KAAKX,QAC3Brf,KAAK41D,QAAU,KAEf51D,KAAK61D,YAAc1M,yCAAQnpC,KAAKX,QAChCrf,KAAK81D,aAAe3M,yCAAQnpC,KAAKX,QACjCrf,KAAK6D,UAAYslD,yCAAQnpC,KAAKX,QAC9Brf,KAAK+nB,OAASwgC,yCAAOvoC,KAAKX,QAE1Brf,KAAK0gC,MAAQs0B,+BAASkB,QACtBl2D,KAAK+1D,SAAWxN,yCAAOvoC,KAAKX,QAE5Brf,KAAKm2D,oBAAoBH,GAAgB,GAAIC,GAAiB,EAAGD,GAAgB,EAAGC,GAAiB,GAErGj2D,KAAKo2D,qBACLp2D,KAAKq2D,gBAMN1xD,OAAQ,WAEP3E,KAAK20C,OAAOr1B,OACZtf,KAAK61D,YAAYv2C,OACjBtf,KAAK81D,aAAax2C,OAClBtf,KAAK6D,UAAUyb,OACftf,KAAK+1D,SAASz2C,OAEO,OAAjBtf,KAAK41D,SACR51D,KAAK41D,QAAQt2C,QAaf4oB,QAAS,SAAUjpC,EAAM,MAExB,OAAc,OAAVA,KACOe,KAAK0gC,MAAQs0B,+BAASkB,UAEjCl2D,KAAK0gC,QAAUs0B,+BAASkB,QACpBj3D,IAAOe,KAAK0gC,OAASs0B,+BAASkB,SAE3Bl2D,OAWRs2D,QAAS,SAAUr3D,EAAM,MAExB,OAAc,OAAVA,KACOe,KAAK0gC,MAAQs0B,+BAASuB,WAEjCv2D,KAAK0gC,QAAUs0B,+BAASuB,SACpBt3D,IAAOe,KAAK0gC,OAASs0B,+BAASuB,UAE3Bv2D,OAaRm2D,mBAAoB,SAAUvgC,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAiBtD,OAfW,OAAPF,IAEHE,EAAKH,EAAGG,GACRD,EAAKF,EAAGE,GACRD,EAAKD,EAAGC,GACRD,EAAKA,EAAGA,IAGT51B,KAAKiuB,MAAQjuB,KAAKi1D,aAClBj1D,KAAKkuB,OAASluB,KAAKk1D,cAEfl1D,KAAKiuB,MAAQ6H,EAAGF,IAAI51B,KAAKiuB,MAAQ6H,EAAGF,GACpC51B,KAAKkuB,OAAS6H,EAAGF,IAAI71B,KAAKkuB,OAAS6H,EAAGF,GAE1C71B,KAAK6D,UAAUlG,IAAIi4B,EAAIC,EAAIC,EAAIC,GACxB/1B,MAaRw2D,WAAY,SAAU5gC,EAAIC,EAAG,KAAMC,EAAG,KAAMC,EAAG,MAY9C,OAVqB,OAAjB/1B,KAAK41D,UACR51D,KAAK41D,QAAUzM,yCAAQnpC,KAAKX,SAElB,OAAPwW,IAEHC,EAAKC,EAAKH,EACVA,EAAKC,GAAMD,GAGZ51B,KAAK41D,QAAQj4D,IAAIi4B,EAAIC,EAAIC,EAAIC,GACtB/1B,MAMRq2D,aAAc,SAAUI,GAAoB,GAE3C,IAAIhiC,EAAGC,EAAGgiC,EAAIC,EACV/gC,EAAIC,EAAIC,EAAIC,EAEhBtB,EAAIz0B,KAAKiuB,OAAS,EAClByG,EAAI10B,KAAKkuB,QAAU,EAEnBwoC,EAAMjiC,EAAEz0B,KAAK2iB,MACbg0C,EAAMjiC,EAAE10B,KAAK2iB,MAEbiT,EAAK51B,KAAK0U,EAAEgiD,EAAG12D,KAAK+nB,OAAOrT,EAC3BmhB,EAAK71B,KAAKojB,EAAEuzC,EAAG32D,KAAK+nB,OAAO3E,EAC3B0S,EAAK91B,KAAK0U,EAAEgiD,EAAG12D,KAAK+nB,OAAOrT,EAC3BqhB,EAAK/1B,KAAKojB,EAAEuzC,EAAG32D,KAAK+nB,OAAO3E,EAEvBqzC,IAEC7gC,EAAK51B,KAAK6D,UAAU+xB,GACvB51B,KAAK+nB,OAAO1E,KAAKrjB,KAAK6D,UAAU+xB,GAAK51B,KAAK0U,EAAIgiD,GACtC5gC,EAAK91B,KAAK6D,UAAUiyB,IAC5B91B,KAAK+nB,OAAO1E,KAAKrjB,KAAK6D,UAAUiyB,GAAK91B,KAAK0U,EAAIgiD,GAE3C7gC,EAAK71B,KAAK6D,UAAUgyB,GACvB71B,KAAK+nB,OAAOzE,KAAKtjB,KAAK6D,UAAUgyB,GAAK71B,KAAKojB,EAAIuzC,GACtC5gC,EAAK/1B,KAAK6D,UAAUkyB,IAC5B/1B,KAAK+nB,OAAOzE,KAAKtjB,KAAK6D,UAAUkyB,GAAK/1B,KAAKojB,EAAIuzC,GAE/C/gC,EAAK51B,KAAK0U,EAAEgiD,EAAG12D,KAAK+nB,OAAOrT,EAC3BmhB,EAAK71B,KAAKojB,EAAEuzC,EAAG32D,KAAK+nB,OAAO3E,EAC3B0S,EAAK91B,KAAK0U,EAAEgiD,EAAG12D,KAAK+nB,OAAOrT,EAC3BqhB,EAAK/1B,KAAKojB,EAAEuzC,EAAG32D,KAAK+nB,OAAO3E,GAG5BpjB,KAAK20C,OAAOh3C,IAAKi4B,EAAIC,EAAIC,EAAIC,GAER,OAAjB/1B,KAAK41D,SACR51D,KAAK20C,OAAOplC,IAAKvP,KAAK41D,SAEvB51D,KAAK61D,YAAYl4D,IAChBqC,KAAK0U,GAAK1U,KAAKq1D,aAAa5gC,EAAIz0B,KAAKm1D,aAAa1gC,GAAGz0B,KAAK2iB,MAAO3iB,KAAKojB,GAAKpjB,KAAKs1D,aAAa5gC,EAAI10B,KAAKo1D,aAAa1gC,GAAG10B,KAAK2iB,MAC3H3iB,KAAK0U,GAAK1U,KAAKq1D,aAAa5gC,EAAIz0B,KAAKm1D,aAAa1gC,GAAGz0B,KAAK2iB,MAAO3iB,KAAKojB,GAAKpjB,KAAKs1D,aAAa5gC,EAAI10B,KAAKo1D,aAAa1gC,GAAG10B,KAAK2iB,QAO7HyzC,mBAAoB,WAEnBp2D,KAAK81D,aAAan4D,IAAKqC,KAAK4lB,GAAI5lB,KAAK6lB,GAAI7lB,KAAK4lB,GAAK5lB,KAAKiuB,MAAOjuB,KAAK6lB,GAAK7lB,KAAKkuB,SAQ/EsF,OAAQ,SAAUvF,EAAOC,GAQxB,OANAluB,KAAKiuB,MAAQjuB,KAAKi1D,aAAehnC,GAASjuB,KAAKiuB,MAC/CjuB,KAAKkuB,OAASluB,KAAKk1D,cAAgBhnC,GAAUluB,KAAKkuB,OAElDluB,KAAKo2D,qBACLp2D,KAAKq2D,eAEEr2D,MAQRwmD,SAAU,SAAUwC,EAAQC,GAW3B,OATAjpD,KAAKiuB,OAAS+6B,EACdhpD,KAAKkuB,QAAU+6B,EAEfjpD,KAAKi1D,aAAej1D,KAAKiuB,MACzBjuB,KAAKk1D,cAAgBl1D,KAAKkuB,OAE1BluB,KAAKo2D,qBACLp2D,KAAKq2D,eAEEr2D,MASRyyD,YAAa,SAAU/9C,EAAG0O,GAQzB,OANApjB,KAAK0U,EAAIA,GAAK1U,KAAK0U,EACnB1U,KAAKojB,EAAIA,GAAKpjB,KAAKojB,EAEnBpjB,KAAK+nB,OAAOpqB,IAAI,EAAG,GACnBqC,KAAKq2D,eAEEr2D,MAQR42D,WAAY,SAAUhzC,EAAIC,GAKzB,OAHA7jB,KAAK+nB,OAAOpqB,IAAIimB,EAAIC,GACpB7jB,KAAKq2D,eAEEr2D,MAQR62D,SAAU,SAAU53D,GAInB,OAFAe,KAAK2iB,MAAQ1jB,EACbe,KAAKq2D,eACEr2D,MAQR82D,SAAU,WAET,OAAO92D,KAAK2iB,OAQbo0C,eAAgB,SAAU93D,GAGzB,OADAe,KAAK06B,YAAcz7B,EACZe,MAQRg3D,eAAgB,WAEf,OAAOh3D,KAAK06B,aAQbu8B,UAAW,SAAU14B,EAAIE,GAKxB,OAHAz+B,KAAKm1D,aAAe52B,EACpBv+B,KAAKo1D,aAAe32B,EAEbz+B,MASR2jB,UAAW,SAAUC,EAAIC,EAAI4yC,GAAoB,GAKhD,OAHAz2D,KAAK+nB,OAAOxY,IAAIqU,EAAIC,GAEpB7jB,KAAKq2D,aAAaI,GACXz2D,MAQRk3D,kBAAmB,SAAUtxC,EAAIC,GAMhC,OAJA7lB,KAAK4lB,GAAKA,EACV5lB,KAAK6lB,GAAKA,EAEV7lB,KAAKo2D,qBACEp2D,MASRm3D,KAAM,SAAUvlC,GAAS,GAExB,OAAO5xB,KAAK0U,GAAKkd,EAAW,EAAI5xB,KAAK+nB,OAAOrT,IAS7C0iD,KAAM,SAAUxlC,GAAS,GAExB,OAAO5xB,KAAKojB,GAAKwO,EAAW,EAAI5xB,KAAK+nB,OAAO3E,IAQ7Ci0C,WAAY,WAEX,OAAOr3D,KAAK+nB,OAAOrT,GAQpB4iD,WAAY,WAEX,OAAOt3D,KAAK+nB,OAAO3E,GAQpBm0C,SAAU,WAET,OAAOv3D,KAAKiuB,OAQbupC,UAAW,WAEV,OAAOx3D,KAAKkuB,QAQbupC,OAAQ,SAAUrQ,EAAIjkD,EAAG,KAAMiwD,EAAG,MAEtB,OAAPA,IAAaA,EAAKpzD,KAAKq1D,cAChB,OAAPlyD,IAAaA,EAAKikD,GAEtB,IAAI3yB,EAAIz0B,KAAKiuB,OAAS,EAElB2H,EAAK51B,KAAK0U,EAAItB,KAAKggD,EAAG3+B,EAAIz0B,KAAKm1D,aAAa1gC,GAAGz0B,KAAK2iB,OACpDmT,EAAK91B,KAAK0U,EAAItB,KAAKggD,EAAG3+B,EAAIz0B,KAAKm1D,aAAa1gC,GAAGz0B,KAAK2iB,OAEpDiT,GAAME,IACTsxB,EAAKjkD,EAAKikD,EAAMjkD,GAAO,GAExB,IAAI4iB,EAAK/lB,KAAK0U,EAYd,OAVI0yC,EAAKxxB,EAAI7P,GAAOqhC,EAAKxxB,EAChBzyB,EAAK2yB,IAAI/P,GAAO5iB,EAAK2yB,GAE9BF,EAAK7P,EAAK0O,EACVqB,EAAK/P,EAAK0O,EAENmB,EAAK51B,KAAK6D,UAAU+xB,KAAI7P,EAAK/lB,KAAK6D,UAAU+xB,GAAKnB,GACjDqB,EAAK91B,KAAK6D,UAAUiyB,KAAI/P,EAAK/lB,KAAK6D,UAAUiyB,GAAKrB,GAErDz0B,KAAK0U,EAAIqR,EACF/lB,MAQR03D,OAAQ,SAAU7D,EAAIC,EAAG,KAAMT,EAAG,MAEtB,OAAPA,IAAaA,EAAKrzD,KAAKs1D,cAChB,OAAPxB,IAAaA,EAAKD,GAEtB,IAAIn/B,EAAI10B,KAAKkuB,QAAU,EAEnB2H,EAAK71B,KAAKojB,EAAIhQ,KAAKigD,EAAG3+B,EAAI10B,KAAKo1D,aAAa1gC,GAAG10B,KAAK2iB,OACpDoT,EAAK/1B,KAAKojB,EAAIhQ,KAAKigD,EAAG3+B,EAAI10B,KAAKo1D,aAAa1gC,GAAG10B,KAAK2iB,OAEpDkT,GAAME,IACT89B,EAAKC,EAAKD,EAAMC,GAAO,GAExB,IAAI9tC,EAAKhmB,KAAKojB,EAYd,OAVIywC,EAAKh+B,EAAI7P,GAAO6tC,EAAKh+B,EAChBi+B,EAAK/9B,IAAI/P,GAAO8tC,EAAK/9B,GAE9BF,EAAK7P,EAAK0O,EACVqB,EAAK/P,EAAK0O,EAENmB,EAAK71B,KAAK6D,UAAUgyB,KAAI7P,EAAKhmB,KAAK6D,UAAUgyB,GAAKnB,GACjDqB,EAAK/1B,KAAK6D,UAAUkyB,KAAI/P,EAAKhmB,KAAK6D,UAAUkyB,GAAKrB,GAErD10B,KAAKojB,EAAI4C,EACFhmB,MAQRoI,OAAQ,SAAUs/B,EAAG,GAEG,OAAnB1nC,KAAKu1D,YAGLv1D,KAAK01D,YACR11D,KAAKy3D,OAAQz3D,KAAKu1D,UAAU3/B,GAAK51B,KAAKw1D,WAAYx1D,KAAKu1D,UAAUz/B,GAAK91B,KAAKw1D,YAExEx1D,KAAK21D,YACR31D,KAAK03D,OAAQ13D,KAAKu1D,UAAU1/B,GAAK71B,KAAKy1D,WAAYz1D,KAAKu1D,UAAUx/B,GAAK/1B,KAAKy1D,YAE5Ez1D,KAAKq2D,iBAQNsB,aAAc,SAAUjwB,EAAG,GAEH,OAAnB1nC,KAAKu1D,YAGTv1D,KAAKy3D,OAAQz3D,KAAKu1D,UAAU3/B,GAAK51B,KAAKw1D,WAAYx1D,KAAKu1D,UAAUz/B,GAAK91B,KAAKw1D,YAC3Ex1D,KAAK03D,OAAQ13D,KAAKu1D,UAAU1/B,GAAK71B,KAAKy1D,WAAYz1D,KAAKu1D,UAAUx/B,GAAK/1B,KAAKy1D,YAE3Ez1D,KAAKq2D,iBAQNuB,aAAc,SAAUpjC,EAAM+M,EAAM,EAAGC,EAAM,GAQ5C,OANAxhC,KAAKu1D,UAAY/gC,EAEjBx0B,KAAKw1D,WAAaj0B,EAClBvhC,KAAKy1D,WAAaj0B,EAElBxhC,KAAKoI,OAAO,GACLpI,MAQR63D,gBAAiB,SAAUt2B,EAAOC,GAKjC,OAHAxhC,KAAKw1D,WAAaj0B,EAClBvhC,KAAKy1D,WAAaj0B,EAEXxhC,MAQR83D,aAAc,SAAUC,EAAUC,GAKjC,OAHAh4D,KAAK01D,WAAaqC,EAClB/3D,KAAK21D,WAAaqC,EAEXh4D,MAQRi4D,eAAgB,SAAUC,EAAQC,GAKjC,OAHAn4D,KAAKq1D,aAAe6C,EACpBl4D,KAAKs1D,kBAA0B5lB,IAAXyoB,EAAuBD,EAASC,EAE7Cn4D,MAQRo4D,UAAW,SAAUh+B,GAEpBA,EAAEtF,KAAK90B,KAAK81D,aAAalgC,GAAI51B,KAAK81D,aAAajgC,GAAI71B,KAAK81D,aAAa7nC,QAASjuB,KAAK81D,aAAa5nC,WAQjGmqC,eAAgB,SAAUj+B,GAEnBp6B,KAAK0gC,MAAQs0B,+BAASuB,SAG3Bn8B,EAAEzW,UAAW3jB,KAAK81D,aAAalgC,GAAI51B,KAAK81D,aAAajgC,IAFrDuE,EAAEzW,UAAW3jB,KAAK81D,aAAa9xC,GAAIhkB,KAAK81D,aAAa7xC,IAIpC,GAAdjkB,KAAK2iB,OACRyX,EAAEzX,MAAO3iB,KAAK2iB,MAAO3iB,KAAK2iB,OAEH,GAApB3iB,KAAK06B,aACRN,EAAEzX,MAAO3iB,KAAK06B,YAAa16B,KAAK06B,aAE3B16B,KAAK0gC,MAAQs0B,+BAASuB,SAG3Bn8B,EAAEzW,WAAY3jB,KAAK20C,OAAO/e,IAAK51B,KAAK20C,OAAO9e,IAF3CuE,EAAEzW,WAAY3jB,KAAK20C,OAAO3wB,IAAKhkB,KAAK20C,OAAO1wB,IAI5CmW,EAAE/G,mBAeHilC,aAAc,SAAU5jD,EAAG0O,EAAE,KAAMkB,GAAM,GASxC,IAAIi0C,EAAMC,EA+BV,OAtCU,OAANp1C,IAAoB,IAANA,IAEjBkB,GAAc,IAANlB,EACRA,EAAI1O,EAAE0O,EACN1O,EAAIA,EAAEA,GAKD1U,KAAK0gC,MAAQs0B,+BAASuB,UAgB3BgC,EAAOv4D,KAAK81D,aAAalgC,GACzB4iC,EAAOx4D,KAAK81D,aAAajgC,GAErBvR,GACH5P,GAAMA,EAAItB,IAAImlD,IAASv4D,KAAK2iB,MAASvP,IAAIpT,KAAK20C,OAAO/e,IACrDxS,GAAMA,EAAIhQ,IAAIolD,IAASx4D,KAAK2iB,MAASvP,IAAIpT,KAAK20C,OAAO9e,MAGrDnhB,GAAMA,EAAI6jD,GAAQv4D,KAAK2iB,MAAS3iB,KAAK20C,OAAO/e,GAC5CxS,GAAMA,EAAIo1C,GAAQx4D,KAAK2iB,MAAS3iB,KAAK20C,OAAO9e,MAvB7C0iC,EAAOv4D,KAAK81D,aAAa9xC,GACzBw0C,EAAOx4D,KAAK81D,aAAa7xC,GAErBK,GACH5P,GAAMA,EAAItB,IAAImlD,IAASv4D,KAAK2iB,MAASvP,IAAIpT,KAAK20C,OAAO3wB,IACrDZ,GAAMA,EAAIhQ,IAAIolD,IAASx4D,KAAK2iB,MAASvP,IAAIpT,KAAK20C,OAAO1wB,MAGrDvP,GAAMA,EAAI6jD,GAAQv4D,KAAK2iB,MAAS3iB,KAAK20C,OAAO3wB,GAC5CZ,GAAMA,EAAIo1C,GAAQx4D,KAAK2iB,MAAS3iB,KAAK20C,OAAO1wB,KAkBvCjkB,KAAK+1D,SAASp4D,IAAI+W,EAAG0O,IAe7Bq1C,cAAe,SAAU/jD,EAAG0O,EAAE,KAAMkB,GAAM,GASzC,IAAIi0C,EAAMC,EA+BV,OAtCU,OAANp1C,IAAoB,IAANA,IAEjBkB,GAAc,IAANlB,EACRA,EAAI1O,EAAE0O,EACN1O,EAAIA,EAAEA,GAKD1U,KAAK0gC,MAAQs0B,+BAASuB,UAgB3BgC,EAAOv4D,KAAK81D,aAAalgC,GACzB4iC,EAAOx4D,KAAK81D,aAAajgC,GAErBvR,GACH5P,GAAKA,EAAItB,IAAIpT,KAAK20C,OAAO/e,KAAO51B,KAAK2iB,MAAQvP,IAAImlD,GACjDn1C,GAAKA,EAAIhQ,IAAIpT,KAAK20C,OAAO9e,KAAO71B,KAAK2iB,MAAQvP,IAAIolD,KAGjD9jD,GAAKA,EAAI1U,KAAK20C,OAAO/e,IAAM51B,KAAK2iB,MAAQ41C,EACxCn1C,GAAKA,EAAIpjB,KAAK20C,OAAO9e,IAAM71B,KAAK2iB,MAAQ61C,KAvBzCD,EAAOv4D,KAAK81D,aAAa9xC,GACzBw0C,EAAOx4D,KAAK81D,aAAa7xC,GAErBK,GACH5P,GAAKA,EAAItB,IAAIpT,KAAK20C,OAAO3wB,KAAOhkB,KAAK2iB,MAAQvP,IAAImlD,GACjDn1C,GAAKA,EAAIhQ,IAAIpT,KAAK20C,OAAO1wB,KAAOjkB,KAAK2iB,MAAQvP,IAAIolD,KAGjD9jD,GAAKA,EAAI1U,KAAK20C,OAAO3wB,IAAMhkB,KAAK2iB,MAAQ41C,EACxCn1C,GAAKA,EAAIpjB,KAAK20C,OAAO1wB,IAAMjkB,KAAK2iB,MAAQ61C,IAkBnCx4D,KAAK+1D,SAASp4D,IAAI+W,EAAG0O,MAO9B4xC,+BAASkB,QAAU,EACnBlB,+BAASuB,SAAW,E,IAEpBmC,yCAAe1D;;;;;;;oCCj0Bf;MAAM2D,8BAAU5F,yCAAYxsD,OAC3B,CACA9B,UAAW,UAMXob,MAAO,KAMPoR,IAAK,KAOL6X,aAAa,EAKb+rB,QAAS,EAKTD,SAAU,EAKVzhC,OAAQ,EAKRylC,eAAgB,KAKhB3uC,eAAgB,KAMhBuH,OAAQ,KAUR9sB,OAAQ,SAASgQ,EAAG0O,EAAG6K,EAAM,KAAMC,EAAO,KAAM+C,EAAI,MAErC,OAAVhD,IACHA,EAAQC,EAAS,GAEH,OAAXA,IAGHD,GADAgD,EAAMhD,GACMA,MACZC,EAAS+C,EAAI/C,QAGdluB,KAAKuE,OAAOs0D,YAAYn0D,OAAOgQ,EAAG0O,EAAG6K,EAAOC,GAC5CluB,KAAKixB,IAAc,OAARA,EAAeA,EAAIijB,cAAgBjjB,EAE9CjxB,KAAK6f,MAAQ,KACb7f,KAAK8oC,aAAc,EAEnB9oC,KAAK60D,QAAU,EACf70D,KAAK40D,SAAW,EAChB50D,KAAKmzB,OAAS,EAEdnzB,KAAK44D,eAAiB,KACtB54D,KAAKiqB,eAAiB,KAEtBjqB,KAAKwxB,OAAS,MAMf7sB,OAAQ,WAEU,OAAb3E,KAAKixB,MAERrQ,QAAQ5gB,KAAKixB,KACbjxB,KAAKixB,IAAM,MAGZjxB,KAAKuE,OAAOs0D,YAAYl0D,UAOzBm0D,aAAc,YAEQ,IAAjB94D,KAAKoxD,UAEc,OAAnBpxD,KAAK6D,UACR7D,KAAK6D,UAAUwwD,MAAM0E,aAAa/4D,MAElC4gB,QAAQ5gB,QAcV2f,MAAO,SAAU1gB,EAAM,MAEtB,OAAc,OAAVA,EACIe,KAAK8oC,aAEb9oC,KAAK8oC,YAAwB,IAAV7pC,GAAqBA,EACjCe,OAOR6Q,KAAM,WAEL,IAAIA,EAAO7Q,KAEX,KAAsB,OAAf6Q,EAAKgP,OACXhP,EAAOA,EAAKgP,MAEb,OAAOhP,GAcR2hB,MAAO,SAAUvzB,EAAM,MAEtB,OAAc,OAAVA,EACIe,KAAKmzB,QAEbnzB,KAAKmzB,OAASl0B,EACPe,OAcRk5B,OAAQ,SAAUj6B,EAAM,MAEvB,OAAc,OAAVA,EACIe,KAAK60D,SAEb70D,KAAK60D,QAAU51D,EACRe,OAcR6tB,cAAe,SAAUA,GAAc,GAEtC,OAAsB,IAAlBA,EACI7tB,KAAK44D,gBAEiB,iBAAnB/qC,IACVA,EAAgBC,yCAAcpwB,IAAImwB,IAEnC7tB,KAAK44D,eAAiB/qC,EACf7tB,OASRmqB,cAAe,SAAUA,GAGxB,OADAnqB,KAAKiqB,eAAiBE,EACfnqB,MAORy/B,KAAM,SAASrF,GAEd,KAAIp6B,KAAKmzB,QAAU,GAAnB,CAIA,GAAiB,OAAbnzB,KAAKixB,KAAgC,OAAhBjxB,KAAKwxB,OAC9B,CACqB,IAAhBxxB,KAAKmzB,SAERiH,EAAEiC,YACFjC,EAAE5H,MAAMxyB,KAAKmzB,SAGd,IAAI6lC,EAAwC,OAAxBh5D,KAAK44D,gBAA0Bx+B,EAAEwC,kBAAkB58B,KAAK44D,gBACxE9D,IAAmB90D,KAAKqyD,oBAAqBj4B,EAAEqC,cAAcz8B,KAAKuyD,aAE1C,OAAxBvyD,KAAK44D,gBAAmD,OAAxB54D,KAAKiqB,gBAAoC,OAATmQ,EAAE1T,IACrE1mB,KAAKiqB,eAAgBmQ,EAAEuC,mBAAoB38B,KAAMo6B,EAAE1T,IAEpD0T,EAAElB,OAASl5B,KAAK40D,SAEI,OAAhB50D,KAAKwxB,OACRxxB,KAAKwxB,OAAO4I,EAAGp6B,KAAMA,KAAKixB,KAE1BjxB,KAAKixB,IAAIO,OAAO4I,EAAGp6B,OAEK,IAArB80D,GAA2B16B,EAAEsC,gBACX,IAAlBs8B,GAAwB5+B,EAAEyC,mBAEV,IAAhB78B,KAAKmzB,QACRiH,EAAEkC,WAKJ,IAAsB,IAAlB5J,yCAAEoW,cAA8C,IAArB9oC,KAAK8oC,aAAwB9oC,KAAK8oC,YAAc,EAC/E,CACC,IAAI9+B,EAAIowB,EAAE2C,aACV3C,EAAIuF,yCAAOoC,gBAET5F,aACF/B,EAAE0C,WAAW9yB,GACbowB,EAAE7G,UAAUolC,8BAAQM,cAAcj5D,KAAK8oC,cACvC1O,EAAExF,SAAS50B,KAAK20C,OAAO/e,GAAI51B,KAAK20C,OAAO9e,GAAI71B,KAAK20C,OAAO1mB,QAASjuB,KAAK20C,OAAOzmB,UAC5EkM,EAAEgC,eASJ88B,WAAY,SAAUC,GAGrB,OADAn5D,KAAKwxB,OAAS2nC,GAAkB,KACzBn5D,QAQT24D,8BAAQS,YAAc,CACrB,uBACA,uBACA,uBACA,yBACA,qBACA,qBACA,qBACA,0BAODT,8BAAQM,cAAgB,SAAUnwB,GAKjC,OAHoB,IAAhBA,IAAwC,IAAhBA,IAC3BA,EAAc,GAER6vB,8BAAQS,YAA8B,IAAftwB;;;;AAiB/B9qB,yCAAS+B,WAAW44C,+B,IACpBU,yCAAeV;;;;+BCvVf;MAAMW,gCAAY/Q,yCAAOvoC,KAAKX,QAQxBk6C,4BAAQF,yCAAQ9yD,OACrB,CACA9B,UAAW,QAMX+0D,SAAU,KAMVrkD,IAAK,KAMLzQ,OAAQ,SAAUlG,EAAG,MAEpBwB,KAAKuE,OAAOk1D,QAAQ/0D,OAAO,EAAG,EAAG,EAAG,GAEpC1E,KAAKw5D,SAAWh4C,yCAAKxB,KAAKX,QAC1Brf,KAAK20C,OAAO1sC,QAEZjI,KAAKmV,IAAMozC,yCAAOvoC,KAAKX,QACvBrf,KAAKqxD,MAAM7yD,IAMZmG,OAAQ,WAEP3E,KAAKqM,QACLrM,KAAKw5D,SAASl6C,OACdtf,KAAKmV,IAAImK,OAETtf,KAAKuE,OAAOk1D,QAAQ90D,UAOrBm0D,aAAc,WAEb,IAAqB,IAAjB94D,KAAKoxD,QAAmB,OAE5B,IAAI/wD,EAEJ,KAAsC,OAA9BA,EAAIL,KAAKw5D,SAASxsD,UAEzB3M,EAAE0wD,QAAQvwD,OAAOR,KAAKyzD,QAASzzD,MAC/BK,EAAEwf,MAAQ,KACVxf,EAAEy4D,eAGH94D,KAAKuE,OAAOk1D,QAAQX,gBAOrBzsD,MAAO,WAEN,IAAIhM,EAEJ,KAAsC,OAA9BA,EAAIL,KAAKw5D,SAASxsD,UAEzB3M,EAAE0wD,QAAQvwD,OAAOR,KAAKyzD,QAASzzD,MAC/BK,EAAEwf,MAAQ,KACVe,QAAQvgB,GAGT,OAAOL,MAORiI,MAAO,WAEN,IAAI5H,EAEJ,KAAsC,OAA9BA,EAAIL,KAAKw5D,SAASxsD,UAEzB3M,EAAE0wD,QAAQvwD,OAAOR,KAAKyzD,QAASzzD,MAC/BK,EAAEwf,MAAQ,KAGX,OAAO7f,MAcR05D,YAAa,SAAUz6D,EAAM,MAE5B,OAAc,OAAVA,KACOe,KAAK0gC,MAAQqyB,yCAAYL,eAEpC1yD,KAAK0gC,QAAUqyB,yCAAYL,cACb,IAAVzzD,IAAgBe,KAAK0gC,OAASqyB,yCAAYL,cAEvC1yD,OAQR25D,SAAU,SAAU/2D,EAAMqN,GAAS,GAElC,GAAa,OAATrN,EAAe,OAAO,KAE1B,IAAIosD,EAA6B,OAAnBhvD,KAAK20C,OAAO/e,GAqB1B,OAnBgB,IAAZo5B,GAAgE,IAA3ChvD,KAAK0gC,MAAQqyB,yCAAYL,kBAEjC,IAAZ1D,GAAoBpsD,EAAK+xC,OAAO/e,GAAK51B,KAAK20C,OAAO/e,KAAI51B,KAAK45D,WAAWh3D,EAAK+xC,OAAO/e,GAAK51B,KAAK20C,OAAO/e,GAAI,KAC1F,IAAZo5B,GAAoBpsD,EAAK+xC,OAAO9e,GAAK71B,KAAK20C,OAAO9e,KAAI71B,KAAK45D,WAAW,EAAGh3D,EAAK+xC,OAAO9e,GAAK71B,KAAK20C,OAAO9e,MACzF,IAAZm5B,GAAoBpsD,EAAK+xC,OAAO7e,GAAK91B,KAAK20C,OAAO7e,KAAI91B,KAAKwmD,SAAS5jD,EAAK+xC,OAAO7e,GAAK91B,KAAK20C,OAAO7e,GAAI,KACxF,IAAZk5B,GAAoBpsD,EAAK+xC,OAAO5e,GAAK/1B,KAAK20C,OAAO5e,KAAI/1B,KAAKwmD,SAAS,EAAG5jD,EAAK+xC,OAAO5e,GAAK/1B,KAAK20C,OAAO5e,KAGxG/1B,KAAKw5D,SAAS32D,KAAKD,GAEH,OAAZA,EAAKpE,KACRwB,KAAK4C,EAAKpE,IAAMoE,IAEA,IAAbqN,GACHrN,EAAK+gB,UAAU3jB,KAAK20C,OAAO/e,GAAI51B,KAAK20C,OAAO9e,IAE5CjzB,EAAKid,MAAQ7f,KACb4C,EAAKmuD,QAAQxhD,IAAIvP,KAAKyzD,QAASzzD,KAAMA,KAAKw5D,SAAS/4C,QAE5C7d,GAORi3D,SAAU,SAAUr7D,GAEnB,OAAOwB,KAAKxB,IAAO,MAMpBi1D,QAAS,SAAU7wD,EAAM5E,EAAMsiD,GAQ9B,OANAtiD,EAAKw7D,SAASh5D,OAAO8/C,GACrB19C,EAAKid,MAAQ,KAEG,OAAZjd,EAAKpE,KACRR,EAAK4E,EAAKpE,IAAM,OAEV,GAORy7B,YAAa,SAAUr3B,GAEtB,OAAa,OAATA,GAAiBA,EAAKid,QAAU7f,MAGpC4C,EAAKmuD,QAAQtL,MAAMzlD,KAAKyzD,QAASzzD,MAFzB4C,GAST4vD,KAAM,WAEL,IAAK,IAAInyD,EAAIL,KAAKw5D,SAASh5C,IAAKngB,EAAGA,EAAIA,EAAE0G,KACxC1G,EAAEpB,MAAMuzD,OAET,OAAOxyD,KAAKuE,OAAOk1D,QAAQjH,QAQ5BoH,WAAY,SAAUh2C,EAAIC,EAAIykC,GAAS,GAEtC,OAAOtoD,KAAKuE,OAAOk1D,QAAQ91C,UAAUC,EAAIC,EAAIykC,IAQ9C3kC,UAAW,SAAUC,EAAIC,EAAIykC,GAAS,GAErC,IAAIwR,EAAM95D,KAAK20C,OAAO/e,GAClBmkC,EAAM/5D,KAAK20C,OAAO9e,GAEtB71B,KAAKuE,OAAOk1D,QAAQ91C,UAAUC,EAAIC,EAAIykC,GACtCtoD,KAAKmV,IAAI5F,IAAIqU,EAAIC,EAAIykC,GAErBwR,EAAM95D,KAAK20C,OAAO/e,GAAKkkC,EACvBC,EAAM/5D,KAAK20C,OAAO9e,GAAKkkC,EAEvB,IAAK,IAAI15D,EAAIL,KAAKw5D,SAASh5C,IAAKngB,EAAGA,EAAIA,EAAE0G,KACxC1G,EAAEpB,MAAM0kB,UAAUm2C,EAAKC,GAExB,OAAO/5D,MAQRg6D,WAAY,SAAUp2C,EAAIC,EAAIykC,GAAS,GAEtCgR,gCAAU37D,IAAIqC,KAAK20C,OAAOgU,IAAK3oD,KAAK20C,OAAOiU,KAAK,GAEhD,IAAIkR,EAAMR,gCAAU5kD,EAChBqlD,EAAMT,gCAAUl2C,EAYpB,OAVAk2C,gCAAU/pD,IAAIqU,EAAIC,EAAIykC,GAEtBwR,EAAMR,gCAAU5kD,EAAIolD,EACpBC,EAAMT,gCAAUl2C,EAAI22C,EAEpBT,gCAAU37D,IAAIm8D,EAAKC,GAEnBT,gCAAU5kD,GAAKkP,EACf01C,gCAAUl2C,GAAKS,EAERy1C,iCAORhI,SAAU,SAAUryD,GAEnB,IAAK,IAAIoB,EAAIL,KAAKw5D,SAASh5C,IAAKngB,EAAGA,EAAIA,EAAE0G,KACxC1G,EAAEpB,MAAMqyD,SAASryD,GAElB,OAAOe,KAAKuE,OAAOk1D,QAAQnI,SAASryD,IAOrCsyD,WAAY,SAAUtyD,GAErB,IAAK,IAAIoB,EAAIL,KAAKw5D,SAASh5C,IAAKngB,EAAGA,EAAIA,EAAE0G,KACxC1G,EAAEpB,MAAMsyD,WAAWtyD,GAEpB,OAAOe,KAAKuE,OAAOk1D,QAAQlI,WAAWtyD,IAavCgzD,QAAS,SAAUhzD,EAAM,KAAMi6C,GAAO,GAErC,GAAc,OAAVj6C,EACH,OAAOe,KAAKuE,OAAOk1D,QAAQxH,UAE5B,IAAK,IAAI5xD,EAAIL,KAAKw5D,SAASh5C,IAAKngB,EAAGA,EAAIA,EAAE0G,KACxC1G,EAAEpB,MAAMgzD,QAAQhzD,EAAOi6C,GAExB,OAAOl5C,KAAKuE,OAAOk1D,QAAQxH,QAAQhzD,EAAOi6C,IAc3C1mB,MAAO,SAAUvzB,EAAM,MAEtB,GAAc,OAAVA,EACH,OAAOe,KAAKuE,OAAOk1D,QAAQjnC,QAE5B,IAAK,IAAInyB,EAAIL,KAAKw5D,SAASh5C,IAAKngB,EAAGA,EAAIA,EAAE0G,KACxC1G,EAAEpB,MAAMuzB,MAAMvzB,GAEf,OAAOe,KAAKuE,OAAOk1D,QAAQjnC,MAAMvzB;;;;;AAcnC+e,yCAAS+B,WAAWw5C,6B,IACpBU,yCAAeV;;;;;;;;cJ3Uf;MAAMW,4BAAQriD,OAAAK,MAAM3R,OACnB,CACA9B,UAAW,QAOX01D,SAAU,KACVC,UAAW,KAOXnkC,SAAU,KACVokC,UAAW,KAKXC,WAAY,KAKZC,UAAW,KAMXnG,eAAgB,KAKhBoG,UAAW,KAKXC,OAAQ,KAKRC,cAAe,KAMfC,SAAU,KAMVC,QAAS,KAMTC,aAAc,KAMdC,SAAU,KAMVC,UAAW,KAMXrzB,GAAI,EAKJhH,MAAO,EAMP6zB,UAAW,EAKXF,MAAO,KAMPn7B,OAAQ,KAMR15B,KAAM,KAQNkF,OAAQ,SAAU+H,EAAOjN,EAAK,MAE7BQ,KAAKs6D,WAAa,GAQlBt6D,KAAKk5B,QAAkB,EAARzsB,IAAe,GAC9BzM,KAAKR,KAAgB,OAATA,EAAgBA,EAAQ,SAAWiN,EAE/CzM,KAAKu6D,UAAY,GACjBv6D,KAAKo0D,eAAiBjL,yCAAQnpC,KAAKX,QAEnCrf,KAAKw6D,UAAYh5C,yCAAKxB,KAAKX,QAC3Brf,KAAKy6D,OAAS,GAEdz6D,KAAK06D,cAAgBl5C,yCAAKxB,KAAKX,QAE/Brf,KAAK26D,SAAWhV,yCAAQ3lC,KAAKX,MAAMrf,MACnCA,KAAK46D,QAAUjV,yCAAQ3lC,KAAKX,MAAMrf,MAClCA,KAAK66D,aAAelV,yCAAQ3lC,KAAKX,MAAMrf,MACvCA,KAAK86D,SAAWnV,yCAAQ3lC,KAAKX,MAAMrf,MACnCA,KAAK+6D,UAAYpV,yCAAQ3lC,KAAKX,MAAMrf,MAEpCA,KAAK0gC,MAAQw5B,4BAAMjJ,QACnBjxD,KAAKq0D,MAAQr0D,MAMd2E,OAAQ,WAaP,IAAItE,EAEJ,IAbAL,KAAKg7D,gBACLh7D,KAAK06D,cAAcp7C,OAEnBtf,KAAK+6D,UAAU1V,OACfrlD,KAAK+6D,UAAUz7C,OAEftf,KAAK26D,SAASr7C,OACdtf,KAAK46D,QAAQt7C,OACbtf,KAAK66D,aAAav7C,OAClBtf,KAAK86D,SAASx7C,OAI0B,QAAhCjf,EAAIL,KAAKw6D,UAAUxtD,UAE1B3M,EAAE0wD,QAAQvwD,OAAOR,KAAKyzD,QAASzzD,MAC/BK,EAAEwD,UAAY,KACd+c,QAAQvgB,GAGT,IAAKA,EAAI,EAAGA,EAAIL,KAAKs6D,WAAWh6D,OAAQD,IAElCL,KAAKs6D,WAAWj6D,KAErBL,KAAKs6D,WAAWj6D,GAAGg0D,MAAQ,KAC3BzzC,QAAQ5gB,KAAKs6D,WAAWj6D,IAExBL,KAAKs6D,WAAWj6D,GAAK,MAGtB,IAAKA,EAAI,EAAGA,EAAIL,KAAKu6D,UAAUj6D,OAAQD,IAEjCL,KAAKu6D,UAAUl6D,KAEpBugB,QAAQ5gB,KAAKu6D,UAAUl6D,IACvBL,KAAKu6D,UAAUl6D,GAAK,MAGrBL,KAAKo0D,eAAe90C,OACpBtf,KAAKw6D,UAAUl7C,QAOhBjT,MAAO,WAIN,IAAIhM,EAEJ,IAJAL,KAAKg7D,gBAImC,QAAhC36D,EAAIL,KAAKw6D,UAAUxtD,UAE1B3M,EAAE0wD,QAAQvwD,OAAOR,KAAKyzD,QAASzzD,MAC/BK,EAAEwD,UAAY,KACd+c,QAAQvgB,GAGT,IAAKA,EAAI,EAAGA,EAAIL,KAAKs6D,WAAWh6D,OAAQD,IAEnCL,KAAKs6D,WAAWj6D,IACnBL,KAAKs6D,WAAWj6D,GAAGgM,SAYtB4lD,QAAS,SAAUhzD,EAAM,MAExB,OAAc,OAAVA,KACOe,KAAK0gC,MAAQw5B,4BAAMjJ,UAE9BjxD,KAAK0gC,QAAUw5B,4BAAMjJ,QACjBhyD,IAAOe,KAAK0gC,OAASw5B,4BAAMjJ,SAExBjxD,OAQRi7D,aAAc,SAAUxuD,EAAO5I,GAE9B,GAAI4I,EAAQ,EAAG,OAAOzM,KAGtB,GAFAyM,GAAS,GAES,OAAd5I,EAIH,OAFA7D,KAAKs6D,WAAW7tD,GAAO4nD,MAAQ,KAC/Br0D,KAAKs6D,WAAW7tD,GAAS,KAClBzM,KAGR,IAAK+0D,yCAAUh0C,WAAWld,GACzB,MAAM,IAAInF,MAAM,2CAA6C+N,EAAQ,iCAWtE,OATsB,OAAlBzM,KAAKm6D,UAAqBt2D,EAAUoqB,MAAQjuB,KAAKm6D,YAAUn6D,KAAKm6D,SAAWt2D,EAAUoqB,QAClE,OAAnBjuB,KAAKo6D,WAAsBv2D,EAAUqqB,OAASluB,KAAKo6D,aAAWp6D,KAAKo6D,UAAYv2D,EAAUqqB,SACvE,OAAlBluB,KAAKi2B,UAAqBpyB,EAAUoqB,MAAQjuB,KAAKi2B,YAAUj2B,KAAKi2B,SAAWpyB,EAAUoqB,QAClE,OAAnBjuB,KAAKq6D,WAAsBx2D,EAAUqqB,OAASluB,KAAKq6D,aAAWr6D,KAAKq6D,UAAYx2D,EAAUqqB,QAE7FrqB,EAAUwwD,MAAQr0D,KAClB6D,EAAUq1B,OAASl5B,KAAKk5B,QAAUzsB,GAAS,IAE3CzM,KAAKs6D,WAAW7tD,GAAS5I,EAClB7D,MAORk7D,aAAc,SAAUzuD,GAEvB,OAAOA,EAAQ,GAAKA,GAASzM,KAAKs6D,WAAWh6D,OAAS,KAAON,KAAKs6D,WAAW7tD,IAO9E0uD,YAAa,SAAU1uD,EAAOguB,GAE7B,GAAIhuB,EAAQ,EAAG,OAAOzM,KAEtB,GAAiB,OAAby6B,IAAsBi+B,yCAAS33C,WAAW0Z,GAC7C,MAAM,IAAI/7B,MAAM,0CAA4C+N,EAAQ,iCAGrE,OADAzM,KAAKu6D,UAAU9tD,GAASguB,EACjBz6B,MAORo7D,YAAa,SAAU3uD,GAEtB,OAAOA,EAAQ,GAAKA,GAASzM,KAAKu6D,UAAUj6D,OAAS,KAAON,KAAKu6D,UAAU9tD,IAO5EssD,aAAc,SAAUn2D,GAElBA,EAAKwuD,UAEVpxD,KAAK06D,cAAc73D,KAAKD,GACxBA,EAAKwuD,OAAM,KAOZ4J,cAAe,WAEd,IAAIp4D,EAEJ,KAA+C,QAAvCA,EAAO5C,KAAK06D,cAAc1tD,UACjC4T,QAAQhe,IAOVy4D,SAAU,SAAUx7C,GAEnB,IAAKo6C,yCAAMl5C,WAAWlB,GACrB,MAAM,IAAInhB,MAAO,4BAUlB,OARAsB,KAAKw6D,UAAU33D,KAAKgd,GAEH,OAAbA,EAAMrhB,KACTwB,KAAKy6D,OAAO56C,EAAMrhB,IAAMqhB,GAEzBA,EAAMhc,UAAY7D,KAClB6f,EAAMkxC,QAAQxhD,IAAIvP,KAAKs7D,aAAct7D,KAAMA,KAAKw6D,UAAU/5C,SAEnD,GAMR66C,aAAc,SAAUz7C,EAAO7hB,EAAMsiD,GAQpC,OANAzgC,EAAMhc,UAAY,KAClB7F,EAAKw8D,UAAUh6D,OAAO8/C,GAEL,OAAbzgC,EAAMrhB,KACTR,EAAKy8D,OAAO56C,EAAMrhB,IAAM,OAElB,GAOR+8D,YAAa,SAAU17C,GAGtB,OADAA,EAAMkxC,QAAQtL,MAAMzlD,KAAKyzD,QAASzzD,MAC3B6f,GAOR2yC,KAAM,SAAU3yC,GAEf,OAAO,GAQR4f,KAAM,SAAUrF,GAEf,GAAKp6B,KAAKiyD,UAAV,CAIA,GAFAjyD,KAAKu0D,UAAY,EAEbv0D,KAAKu6D,UAAUj6D,OAElB,IAAK,IAAIk7D,EAAgB,EAAGA,EAAgBx7D,KAAKu6D,UAAUj6D,OAAQk7D,IACnE,CACC,IAAI/gC,EAAWz6B,KAAKu6D,UAAUiB,GACzB/gC,GAAaA,EAASyN,YAE3BxV,yCAAQ+H,SAAWA,EAEnBL,EAAEtG,WACFsG,EAAE+B,aAEF1B,EAAS29B,UAAUh+B,GACnBK,EAAS49B,eAAej+B,GAExBp6B,KAAKo0D,eAAez2D,IAAI88B,EAASka,QACjC30C,KAAKy7D,eAAerhC,EAAGp6B,KAAKo0D,gBAE5Bh6B,EAAEgC,YACFhC,EAAErG,gBAIH/zB,KAAKy7D,eAAerhC,EAAG,MAEpBzH,yCAAIuV,UACPvV,yCAAI2V,KAAKtoC,KAAKR,MAAQQ,KAAKu0D,aAO7BkH,eAAgB,SAAUrhC,EAAGg6B,GAE5B,IAAK,IAAI/zD,EAAI,EAAGA,EAAIL,KAAKs6D,WAAWh6D,OAAQD,IAEtCL,KAAKs6D,WAAWj6D,KAGrBL,KAAKs6D,WAAWj6D,GAAGo0D,kBAAkBL,GACrCp0D,KAAKs6D,WAAWj6D,GAAGo/B,KAAKrF,GAExBp6B,KAAKu0D,WAAav0D,KAAKs6D,WAAWj6D,GAAGk0D,YAOvCmH,gBAAiB,WAEhB,IAAK,IAAIr7D,EAAI,EAAGA,EAAIL,KAAKu6D,UAAUj6D,OAAQD,IAErCL,KAAKu6D,UAAUl6D,IAGpBL,KAAKu6D,UAAUl6D,GAAG+H,OAAOpI,KAAK0nC,KAQhCt/B,OAAQ,SAAUs/B,GAEjB1nC,KAAK0nC,GAAKA,EACV1nC,KAAK26D,SAAStV,OAEdrlD,KAAK46D,QAAQvV,OACbrlD,KAAKg7D,gBACLh7D,KAAK66D,aAAaxV,OAClBrlD,KAAK07D,kBAEL17D,KAAK86D,SAASzV,UAQhB6U,4BAAMjJ,QAAU,E,IAEhB0K,yCAAezB,4BKxffriD,OAAAxZ,cAAA;;;;AAaA,MAAMu9D,8BAAU/jD,OAAAK,MAAM3R,OACrB,CACA9B,UAAW,UAMX4vD,MAAO,KAKP3tD,KAAM,KAKNm1D,SAAU,KACVC,UAAW,KAKXC,YAAa,KACbC,aAAc,KAMdt3D,OAAQ,SAAU2vD,EAAOjsD,EAAO,KAAMhB,EAAQ,MAE7CpH,KAAK0G,KAAO8a,yCAAKxB,KAAKX,QACtBrf,KAAKq0D,MAAQA,EAEbr0D,KAAK67D,SAAWzzD,EAChBpI,KAAK87D,UAAY10D,EAEjBpH,KAAK+7D,YAAc,KACnB/7D,KAAKg8D,aAAe,KAEpBh8D,KAAKq0D,MAAMuG,QAAQrrD,IAAIvP,KAAKi8D,QAASj8D,MACrCA,KAAKq0D,MAAMwG,aAAatrD,IAAIvP,KAAKk8D,MAAOl8D,MACxCA,KAAKq0D,MAAM0G,UAAUxrD,IAAIvP,KAAKm8D,SAAUn8D,OAMzC2E,OAAQ,WAEP,IAAItE,EAMJ,IAJAL,KAAKq0D,MAAMuG,QAAQp6D,OAAOR,KAAKi8D,QAASj8D,MACxCA,KAAKq0D,MAAMwG,aAAar6D,OAAOR,KAAKk8D,MAAOl8D,MAC3CA,KAAKq0D,MAAM0G,UAAUv6D,OAAOR,KAAKm8D,SAAUn8D,MAER,QAA3BK,EAAIL,KAAK0G,KAAKsG,UACrB3M,EAAE0wD,QAAQvwD,OAAOR,KAAKyzD,QAASzzD,MAGhCA,KAAK0G,KAAK4Y,QAMX68C,SAAU,SAAU9H,EAAOr2D,GAE1B4iB,QAAQ5iB,IAQTiK,MAAO,WAEN,KAAmC,QAA3B5H,EAAIL,KAAK0G,KAAKsG,UACrB3M,EAAE0wD,QAAQvwD,OAAOR,KAAKyzD,QAASzzD,MAGhC,OAAOA,MAORqM,MAAO,WAEN,KAAmC,QAA3BhM,EAAIL,KAAK0G,KAAKsG,UACrB3M,EAAE0wD,QAAQvwD,OAAOR,KAAKyzD,QAASzzD,MAC/B4gB,QAAQvgB,GAGT,OAAOL,MAORo8D,UAAW,SAAUluD,GAGpB,OADAlO,KAAK+7D,YAAc7tD,EACZlO,MAORq8D,WAAY,SAAUnuD,GAGrB,OADAlO,KAAKg8D,aAAe9tD,EACblO,MAORuP,IAAK,SAAU3M,GAEd,IAAKy2D,yCAAQt4C,WAAWne,GACvB,MAAM,IAAIlE,MAAO,qCAKlB,OAHAsB,KAAK0G,KAAK7D,KAAKD,GAEfA,EAAKmuD,QAAQxhD,IAAIvP,KAAKyzD,QAASzzD,KAAMA,KAAK0G,KAAK+Z,QACxC7d,GAMR6wD,QAAS,SAAU7wD,EAAM5E,EAAMsiD,GAG9B,OADAtiD,EAAK0I,KAAKlG,OAAO8/C,IACV,GAOR9/C,OAAQ,SAAUoC,GAGjB,OADAA,EAAKmuD,QAAQtL,MAAMzlD,KAAKyzD,QAASzzD,MAC1B4C,GAMRs5D,MAAO,SAAU7H,EAAOr2D,GAEvB,IAAK,IAAIqC,EAAIrC,EAAK0I,KAAK8Z,IAAKngB,EAAGA,EAAIA,EAAE0G,KACpC1G,EAAEpB,MAAMuzD,QAMVyJ,QAAS,SAAU5H,EAAOr2D,GAEzBA,EAAKoK,OAAOisD,EAAM3sB,KAOnBt/B,OAAQ,SAAUs/B,GAKjB,GAHyB,OAArB1nC,KAAK+7D,aACR/7D,KAAK+7D,YAAa/7D,KAAK0G,KAAMghC,EAAI1nC,KAAK87D,WAEjB,OAAlB97D,KAAK67D,SACT,CACC,IAAI90D,EAAO,KACX,IAAK,IAAI1G,EAAIL,KAAK0G,KAAK8Z,IAAKngB,EAAGA,EAAI0G,EAElCA,EAAO1G,EAAE0G,MAE2C,IAAhD/G,KAAK67D,SAAUx7D,EAAEpB,MAAOyoC,EAAI1nC,KAAK87D,YACpC97D,KAAKQ,OAAOH,EAAEpB,OAIS,OAAtBe,KAAKg8D,cACRh8D,KAAKg8D,aAAch8D,KAAK0G,KAAMghC,EAAI1nC,KAAK87D,c,IAI1CQ,yCAAeV;;;;;ACnMfW,yCAAexH,yCAAUxuD,OACxB,CACA9B,UAAW,kBAMXiC,KAAM,KAUNhC,OAAQ,SAAUupB,EAAM,EAAGC,EAAO,GAEjCluB,KAAKuE,OAAOi4D,UAAU93D,OAAQupB,EAAOC,GACrCluB,KAAK0G,KAAO8a,yCAAKxB,KAAKX,QAEtBrf,KAAKuyD,WAAU,IAMhB5tD,OAAQ,WAEP3E,KAAKqM,QACLrM,KAAK0G,KAAK4Y,OAEVtf,KAAKuE,OAAOi4D,UAAU73D,UAOvB6tD,KAAM,SAAU5vD,GAGf,OADA5C,KAAK20D,MAAM/xD,IACJ,GAORyJ,MAAO,WAEN,IAAIhM,EAEJ,KAAmC,QAA3BA,EAAIL,KAAK0G,KAAKsG,UAErB3M,EAAE0wD,QAAQvwD,OAAOR,KAAKyzD,QAASzzD,MAC/BK,EAAEwD,UAAY,KACd+c,QAAQvgB,GAGTL,KAAKs0D,aAAe,GAOrBrsD,MAAO,WAEN,IAAI5H,EAEJ,KAAmC,QAA3BA,EAAIL,KAAK0G,KAAKsG,UAErB3M,EAAE0wD,QAAQvwD,OAAOR,KAAKyzD,QAASzzD,MAC/BK,EAAEwD,UAAY,KAGf7D,KAAKs0D,aAAe,GAOrB/kD,IAAK,SAAU3M,GAEd,IAAKy2D,yCAAQt4C,WAAWne,GACvB,MAAM,IAAIlE,MAAO,+BASlB,OAPAsB,KAAK0G,KAAK7D,KAAKD,GACf5C,KAAKs0D,eAEL1xD,EAAKiB,UAAY7D,KACjB4C,EAAKmuD,QAAQxhD,IAAIvP,KAAKyzD,QAASzzD,KAAMA,KAAK0G,KAAK+Z,QAE/CzgB,KAAK20D,MAAM/xD,GACJA,GAMR6wD,QAAS,SAAU7wD,EAAM5E,EAAMsiD,GAM9B,OAJAtiD,EAAK0I,KAAKlG,OAAO8/C,GACjBtiD,EAAKs2D,eAEL1xD,EAAKiB,UAAY,MACV,GAORrD,OAAQ,SAAUoC,GAGjB,OADAA,EAAKmuD,QAAQtL,MAAMzlD,KAAKyzD,QAASzzD,MAC1B4C,GAOR4uB,OAAQ,WAEP,IAAIkP,EAAQqyB,yCAAY/B,MAAQ+B,yCAAY9B,QAE5C,IAAK,IAAI5wD,EAAIL,KAAK0G,KAAK8Z,IAAKngB,KAEK,IAA5BA,EAAEpB,MAAMuyD,SAAS9wB,KAGmB,IAApC1gC,KAAK00D,YAAYr0D,EAAEpB,MAAOe,OALAK,EAAIA,EAAE0G;;;;;;;AC/HvC01D,yCAAe1H,yCAAUxuD,OACxB,CACA9B,UAAW,gBAMXwuD,KAAM,KAMNnqB,aAAa,EAUbpkC,OAAQ,SAAUupB,EAAM,MAAOC,EAAO,MAAOwuC,EAAS,GAAIC,EAAS,MAElE38D,KAAKuE,OAAOi4D,UAAU93D,OAAQupB,EAAOC,GACrCluB,KAAKizD,KAAO,IAAIiB,yCAAMjmC,EAAOC,EAAQwuC,EAAUC,IAMhDh4D,OAAQ,WAEP3E,KAAKqM,QACLrM,KAAKuE,OAAOi4D,UAAU73D,UAOvB6tD,KAAM,SAAU5vD,GAGf,OADA5C,KAAK20D,MAAM/xD,GACJ5C,KAAKizD,KAAKT,KAAK5vD,IAOvByJ,MAAO,WAENrM,KAAKizD,KAAK5mD,SAOXpE,MAAO,WAENjI,KAAKizD,KAAKhrD,SAOXsH,IAAK,SAAU3M,GAEd,IAAKy2D,yCAAQt4C,WAAWne,GACvB,MAAM,IAAIlE,MAAO,+BAElB,OAAKsB,KAAKizD,KAAK1jD,IAAI3M,IAGnBA,EAAKiB,UAAY7D,KACjBA,KAAKs0D,aAAet0D,KAAKizD,KAAKhiD,MAE9BjR,KAAK20D,MAAM/xD,GACJA,GANC,MAaTpC,OAAQ,SAAUoC,GAIjB,OAFA5C,KAAKizD,KAAKzyD,OAAOoC,GACjB5C,KAAKs0D,aAAet0D,KAAKizD,KAAKhiD,MACvBrO,GAOR4uB,OAAQ,WAIP,GAFAxxB,KAAKizD,KAAKS,gBAAgB1zD,KAAKo0D,eAAgBrB,yCAAY/B,MAAQ+B,yCAAY9B,QAAS8B,yCAAY/B,MAAQ+B,yCAAY9B,QAASjxD,KAAK00D,YAAa10D,OAE1H,IAArBA,KAAK8oC,aAAiD,OAAxB9oC,KAAKo0D,eACtC,OAED,IAAIh6B,EAAIuF,yCAAOoC,eAEf3H,EAAE+B,aACF/B,EAAE0C,WAAW98B,KAAKo6B,EAAE2C,aAEpB,IAAIsqB,GAAMrnD,KAAMo0D,eAAev+B,GAAG71B,KAAKizD,KAAKE,OAAS,GAAGnzD,KAAKizD,KAAKI,GAAG,IAAOrzD,KAAKizD,KAAKI,IAAMrzD,KAAKizD,KAAKK,OAClGz9B,GAAM71B,KAAMo0D,eAAer+B,GAAG/1B,KAAKizD,KAAKE,OAAU,GAAGnzD,KAAKizD,KAAKI,GAAG,IAAMrzD,KAAKizD,KAAKI,IAAMrzD,KAAKizD,KAAKK,OAClGnlB,EAAMnuC,KAAMo0D,eAAex+B,GAAG51B,KAAKizD,KAAKC,OAAS,GAAGlzD,KAAKizD,KAAKG,GAAG,IAAOpzD,KAAKizD,KAAKG,GAClFx9B,EAAM51B,KAAMo0D,eAAet+B,GAAG91B,KAAKizD,KAAKC,OAAU,GAAGlzD,KAAKizD,KAAKG,GAAG,IAAMpzD,KAAKizD,KAAKG,GAEtF/L,GAAMj0C,IAAIi0C,EAAKrnD,KAAKizD,KAAKK,SAAWtzD,KAAKizD,KAAKI,IAAMrzD,KAAKizD,KAAKE,MAC9Dt9B,GAAMziB,IAAIyiB,EAAK71B,KAAKizD,KAAKK,SAAWtzD,KAAKizD,KAAKI,IAAMrzD,KAAKizD,KAAKE,OAAS,GAAKnzD,KAAKizD,KAAKI,IACtFllB,GAAMA,GAAMnuC,KAAKizD,KAAKG,IAAMpzD,KAAKizD,KAAKC,MACtCt9B,GAAMA,GAAM51B,KAAKizD,KAAKG,IAAMpzD,KAAKizD,KAAKC,OAAS,GAAKlzD,KAAKizD,KAAKG,IAE9Dh5B,EAAE7G,UAAU,qBACZ6G,EAAExF,SAASuZ,EAAIkZ,EAAIzxB,EAAGuY,EAAG,EAAGtY,EAAGwxB,EAAG,GAElCA,EAAKrnD,KAAKo0D,eAAev+B,GACzBA,EAAK71B,KAAKo0D,eAAer+B,GACzBoY,EAAKnuC,KAAKo0D,eAAex+B,GACzBA,EAAK51B,KAAKo0D,eAAet+B,GAEzBsE,EAAEa,UAAU,EAAE0E,yCAAOiC,mBACrBxH,EAAE9G,YAAY,QACd8G,EAAEvF,WAAWsZ,EAAIkZ,EAAIzxB,EAAGuY,EAAG,EAAGtY,EAAGwxB,EAAG,GAEpCjtB,EAAEa,UAAU,EAAE0E,yCAAOiC,mBACrBxH,EAAE9G,YAAY,QACd,IAAK,IAAIlQ,EAAIsP,yCAAQ+H,SAAS52B,UAAUgyB,GAAG71B,KAAKizD,KAAKE,MAAO/vC,EAAIsP,yCAAQ+H,SAAS52B,UAAUkyB,GAAG/1B,KAAKizD,KAAKE,MAAO/vC,GAAM,GAAKpjB,KAAKizD,KAAKI,GACpI,IAAK,IAAI3+C,EAAIge,yCAAQ+H,SAAS52B,UAAU+xB,GAAG51B,KAAKizD,KAAKC,MAAOx+C,EAAIge,yCAAQ+H,SAAS52B,UAAUiyB,GAAG91B,KAAKizD,KAAKC,MAAOx+C,GAAM,GAAK1U,KAAKizD,KAAKG,GAEnIh5B,EAAEvF,WAAWngB,EAAE1U,KAAKizD,KAAKC,MAAO9vC,EAAEpjB,KAAKizD,KAAKE,MAAQ,GAAKnzD,KAAKizD,KAAKG,GAAM,GAAKpzD,KAAKizD,KAAKI,IAGzFj5B,EAAEgC,aAQHs3B,gBAAiB,SAAU/e,EAAQgf,EAAcC,EAAY1lD,EAAU9G,GAEtEpH,KAAKizD,KAAKS,gBAAiB/e,EAAQgf,EAAcC,EAAY1lD,EAAU9G,IAOxE2sD,eAAgB,SAAUpf,EAAQgf,EAAcC,GAE/C,OAAO5zD,KAAKizD,KAAKc,eAAgBpf,EAAQgf,EAAcC,IAOxDI,cAAe,SAAUrf,EAAQgf,EAAcC,GAE9C,OAAO5zD,KAAKizD,KAAKe,cAAerf,EAAQgf,EAAcC,IAOvDK,YAAa,SAAUtf,EAAQgf,EAAcC,GAE5C,OAAO5zD,KAAKizD,KAAKgB,YAAatf,EAAQgf,EAAcC;;;;;ACzLtD,MAAMgJ,2BAAOvD,yCAAQ9yD,OACpB,CACA9B,UAAW,OAMXpF,KAAM,EAMNqF,OAAQ,SAASrF,EAAMqV,EAAG0O,EAAG6K,EAAOC,GAEnCluB,KAAKuE,OAAOk1D,QAAQ/0D,OAAOgQ,EAAG0O,EAAG6K,EAAOC,GAExCluB,KAAKX,KAAOA,GAObogC,KAAM,SAASrF,GAEd,IAA2B,IAAvB1H,yCAAQqW,cAA8C,IAArB/oC,KAAK8oC,aAA8C,IAArB9oC,KAAK8oC,aACvE,OAED,IAAI9+B,EAAIowB,EAAE2C,aACV3C,EAAIuF,yCAAOoC,gBAET5F,aACF/B,EAAE0C,WAAW9yB,GACbowB,EAAE7G,UAAU8lC,yCAAQJ,cAAcj5D,KAAK8oC,cACvC1O,EAAExF,SAAS50B,KAAK20C,OAAO/e,GAAI51B,KAAK20C,OAAO9e,GAAI71B,KAAK20C,OAAO1mB,QAASjuB,KAAK20C,OAAOzmB,UAC5EkM,EAAEgC;;;iBAcJpe;yCAAS+B,WAAW68C,4B,IACpBC,yCAAeD;;;8BCvDf;MAAME,4BAAQzD,yCAAQ9yD,OACrB,CACA9B,UAAW,QAKXmhB,GAAI,EAAGC,GAAI,EAMXzhB,KAAM,KAQNm3B,KAAM,KAKNwhC,QAAQ,EAMRC,UAAW,KAMXC,WAAY,KAKZC,QAAQ,EACRC,SAAS,EAKTC,YAAa,KACbC,YAAa,KAMb34D,OAAQ,SAASgQ,EAAG0O,EAAGmY,EAAMn3B,GAE5BpE,KAAKuE,OAAOk1D,QAAQ/0D,OAAO1E,KAAK4lB,GAAKlR,EAAG1U,KAAK6lB,GAAKzC,EAAG,EAAG,GAExDpjB,KAAKoE,KAAO,KACZpE,KAAKu7B,KAAOA,EAEZv7B,KAAKk9D,QAAS,EACdl9D,KAAKm9D,SAAU,EAEfn9D,KAAKk5D,WAAWl5D,KAAKs9D,YACrBt9D,KAAKu9D,QAAQn5D,IAQdo5D,MAAO,SAAUv+D,GAEhB,OAAIe,KAAKk9D,SAAWj+D,EACZe,MAERA,KAAKk9D,OAASj+D,EACde,KAAKo9D,YAAc,KACZp9D,KAAKoI,WAQbq1D,OAAQ,SAASx+D,GAEhB,OAAIe,KAAKm9D,UAAYl+D,EACbe,MAERA,KAAKm9D,QAAUl+D,EACfe,KAAKq9D,YAAc,KACZr9D,KAAKoI,WAObm1D,QAAS,SAAUt+D,GAElB,OAAIe,KAAKoE,OAASnF,EACVe,MAERA,KAAKoE,KAAOnF,EACZe,KAAK+8D,QAAS,EACP/8D,KAAKoI,WASbs1D,QAAS,SAAUniC,GAElB,OAAIv7B,KAAKu7B,OAASA,EACVv7B,MAERA,KAAKu7B,KAAOA,EACZv7B,KAAK+8D,QAAS,EACP/8D,KAAKoI,WAObA,OAAQ,WAiCP,OA/BoB,IAAhBpI,KAAK+8D,SAER/8D,KAAKo9D,YAAc,KACnBp9D,KAAKq9D,YAAc,KAEnBr9D,KAAKg9D,UAAYh9D,KAAKu7B,KAAKwf,aAAa/6C,KAAKoE,MAC7CpE,KAAKi9D,WAAaj9D,KAAKu7B,KAAKyf,cAAch7C,KAAKoE,MAE/CpE,KAAK+8D,QAAS,EAEd/8D,KAAK20C,OAAOnhB,OAAOxzB,KAAKg9D,UAAWh9D,KAAKi9D,YAAY,IAG5B,OAArBj9D,KAAKo9D,cAEJp9D,KAAKk9D,OAAS,EAAGl9D,KAAKo9D,YAAc,EACf,IAAhBp9D,KAAKk9D,OAAcl9D,KAAKo9D,aAAep9D,KAAKg9D,WAAa,EAC7Dh9D,KAAKo9D,aAAep9D,KAAKg9D,UAE9Bh9D,KAAK20C,OAAOhxB,WAAW3jB,KAAK20C,OAAO/e,GAAK51B,KAAK4lB,GAAK5lB,KAAKo9D,YAAa,IAG5C,OAArBp9D,KAAKq9D,cAEJr9D,KAAKm9D,QAAU,EAAGn9D,KAAKq9D,YAAc,EACf,IAAjBr9D,KAAKm9D,QAAen9D,KAAKq9D,aAAer9D,KAAKi9D,YAAc,EAC/Dj9D,KAAKq9D,aAAer9D,KAAKi9D,WAE9Bj9D,KAAK20C,OAAOhxB,UAAU,GAAI3jB,KAAK20C,OAAO9e,GAAK71B,KAAK6lB,GAAK7lB,KAAKq9D,cAGpDr9D,MAQR2jB,UAAW,SAAUC,EAAIC,EAAIykC,GAAS,GAUrC,OARAtoD,KAAKuE,OAAOk1D,QAAQ91C,UAAUC,EAAIC,EAAIykC,GAEtCtoD,KAAK4lB,GAAK5lB,KAAK20C,OAAO/e,GACtB51B,KAAK6lB,GAAK7lB,KAAK20C,OAAO9e,GAEtB71B,KAAKo9D,YAAc,KACnBp9D,KAAKq9D,YAAc,KAEZr9D,KAAKoI,UAMbk1D,WAAY,SAASljC,EAAGx3B,EAAMquB,GAE7BruB,EAAK24B,KAAKsf,SAAUzgB,EAAGx3B,EAAK+xC,OAAO/e,GAAIhzB,EAAK+xC,OAAO9e,GAAIjzB,EAAKwB;;;iBAe9D4Z;yCAAS+B,WAAW+8C,6B,IACpBa,yCAAeb;;;;;;;;AC7Lfc,yCAAe9S,yCAAKD,OAAOz9B,OAC1B,CACAywC,SAAU,KAEVn5D,OAAQ,WAEP,MAAM1G,EAAOgC,KAEbA,KAAKuE,OAAOsmD,OAAOnmD,SAEnB1E,KAAK69D,SAAW,IAAI7Z,yCAEpBhkD,KAAK89D,qBAAuB,SAAU32D,GACrC,OAAOnJ,EAAK+/D,oBAAoB52D,KAQlCvI,SAAU,SAAUuI,GAEnB,IACCnH,KAAK69D,SAAStuD,IAAIpI,GAEd,SAAUA,GACbA,EAAQgB,OAEV,MAAO/K,GACN,MAAM,IAAIsB,MAAO,+BAAiCtB,EAAEwL,SAGrD,OAAOzB,GAORq5C,WAAY,SAAUr5C,GAErB,IACCnH,KAAK69D,SAASr9D,OAAO2G,GACrBnH,KAAK69D,SAASxZ,UAEf,MAAOjnD,GACN,MAAM,IAAIsB,MAAO,iCAAmCtB,EAAEwL,WAIxDm1D,oBAAqB,SAAU52D,GAE9B,OAAOA,EAAQu9B,gBAAgB1kC,KAAKg+D,QAASh+D,KAAKi+D,SAAUj+D,KAAKk+D,YAMlEzT,UAAW,WAEV9qB,yCAAO+E,gBAAkB,CAACxG,EAAQmE,EAASH,KAE1CliC,KAAKg+D,QAAU9/B,EACfl+B,KAAKi+D,SAAW57B,EAChBriC,KAAKk+D,UAAYh8B,EAEjBliC,KAAK69D,SAAS18C,QAAQnhB,KAAK89D,wBAO7BlT,WAAY,WAEXjrB,yCAAO+E,gBAAkB;;;;;;;;AC5E3By5B,yCAAerT,yCAAKD,OAAOz9B,OAC1B,CACAywC,SAAU,KAEVn5D,OAAQ,WAEP,MAAM1G,EAAOgC,KAEbA,KAAKuE,OAAOsmD,OAAOnmD,SAEnB1E,KAAK69D,SAAW,IAAI7Z,yCAEpBhkD,KAAKo+D,oBAAsB,SAAUj3D,GACpC,OAAOnJ,EAAKqgE,mBAAmBl3D,KAQjCvI,SAAU,SAAUuI,GAEnB,IACCnH,KAAK69D,SAAStuD,IAAIpI,GAEd,SAAUA,GACbA,EAAQgB,OAEV,MAAO/K,GACN,MAAM,IAAIsB,MAAO,8BAAgCtB,EAAEwL,SAGpD,OAAOzB,GAORq5C,WAAY,SAAUr5C,GAErB,IACCnH,KAAK69D,SAASr9D,OAAO2G,GACrBnH,KAAK69D,SAASxZ,UAEf,MAAOjnD,GACN,MAAM,IAAIsB,MAAO,gCAAkCtB,EAAEwL,WAIvDy1D,mBAAoB,SAAUl3D,GAE7B,OAAOA,EAAQy+B,eAAe5lC,KAAKg+D,QAASh+D,KAAKs+D,GAAIt+D,KAAKu+D,YAM3D9T,UAAW,WAEV9qB,yCAAOiG,eAAiB,CAAC1H,EAAQyH,EAAGrD,KAEnCtiC,KAAKg+D,QAAU9/B,EACfl+B,KAAKs+D,GAAK34B,EACV3lC,KAAKu+D,UAAYj8B,EAEjBtiC,KAAK69D,SAAS18C,QAAQnhB,KAAKo+D,uBAO7BxT,WAAY,WAEXjrB,yCAAOiG,eAAiB;;;;;;;;;ACvC1B,MAAM44B,qCACL,CACAra,SAAU,EAKVsa,QAAS9Y,yCAKTj/C,KAAM,GAKNg4D,WAAW,EAKXC,YAAY,EAKZC,UAAW,EAMXrvD,IAAK,SAAUpI,IAEqB,IAA/BnH,KAAK0G,KAAKlF,QAAQ2F,IACrBnH,KAAK0G,KAAK7D,KAAKsE,IAOjB3G,OAAQ,SAAU2G,GAEjB,IAAI9G,EAAIL,KAAK0G,KAAKlF,QAAQ2F,IAChB,IAAN9G,GAAUL,KAAK0G,KAAKjG,OAAOJ,EAAG,IAWnCw+D,MAAO,SAAU5/D,EAAM,MAEtB,GAAc,OAAVA,EACH,OAAOe,KAAK0+D,UAEb1+D,KAAK0+D,UAAYz/D,GAWlB6/D,OAAQ,SAAU7/D,EAAM,MAEvB,GAAc,OAAVA,EACH,OAAOe,KAAK2+D,WAEb3+D,KAAK2+D,WAAa1/D,GAGnB8/D,WAAY,SAAUrqD,EAAG0O,EAAG/B,EAAO,MAGlC,GAAIrhB,KAAK2+D,YAAc3+D,KAAK4+D,WAAaj/B,yCAAOoD,YAChD,CACC,IAAI+7B,EAAS9+D,KAAK0G,KAAK,GAAGo4D,OAE1B,IAAK,IAAIhzD,KAAQ9L,KAAK0G,KACtB,CACC,GAAIoF,EAAKgzD,OAASA,EAClB,CACC9+D,KAAK0G,KAAO1G,KAAK0G,KAAKiJ,MAAK,CAACC,EAAEC,IAAMA,EAAEivD,OAASlvD,EAAEkvD,SACjD,MAGDA,EAAShzD,EAAKgzD,OAGf9+D,KAAK4+D,UAAYj/B,yCAAOoD,YAGzB,IAAK,IAAI1iC,EAAI,EAAGA,EAAIL,KAAK0G,KAAKpG,OAAQD,IAErC,GAAKL,KAAK0G,KAAKrG,KAEA,OAAXghB,IAA4C,IAAzBA,EAAOrhB,KAAK0G,KAAKrG,MAGpCL,KAAK0G,KAAKrG,GAAGumD,cAAclyC,EAAG0O,GACjC,OAAOpjB,KAAK0G,KAAKrG,GAGnB,OAAO,MAQR2+D,YAAa,SAAU3+D,GAEtB,MAAO,UAAWA,GAUnBulC,eAAgB,SAAU1H,EAAQyH,EAAGrD,GAEpC,IAAItsB,GAAY,EACZ5I,EAAM,KAEV,OAAQ8wB,GAEP,KAAKyB,yCAAOkG,iBAAiB3F,aAEd,MAAVyF,EAAEs5B,OAEL7xD,EAAMu4B,EAAEs5B,KAAMt5B,EAAEs5B,KAAO,KACvB7xD,EAAI8xD,kBAAkBv5B,IAGvBv4B,EAAMpN,KAAK++D,WAAWp5B,EAAEjxB,EAAGixB,EAAEviB,GAClB,MAAPhW,KAEFu4B,EAAEs5B,KAAO7xD,GAAK+xD,gBAAgBx5B,GAC/B3vB,GAAY,GAGb,MAED,KAAK2pB,yCAAOkG,iBAAiBxF,mBACd,MAAVsF,EAAEs5B,OAAcjpD,GAAY,GAChC,MAED,KAAK2pB,yCAAOkG,iBAAiBvF,kBACxBtgC,KAAK0+D,YAEO,MAAX/4B,EAAEy5B,MAEDz5B,EAAEy5B,MAAMxY,cAAcjhB,EAAEjxB,EAAGixB,EAAEviB,KAKhChW,EAAMu4B,EAAEy5B,MAAOz5B,EAAEy5B,MAAQ,KACzBhyD,EAAIyxD,OAAM,EAAOl5B,GAEjBv4B,EAAMpN,KAAK++D,WAAWp5B,EAAEjxB,EAAGixB,EAAEviB,EAAGpjB,KAAKg/D,aAC1B,MAAP5xD,IACFu4B,EAAEy5B,MAAQhyD,GAAKyxD,OAAM,EAAMl5B,KAK9Bv4B,EAAMpN,KAAK++D,WAAWp5B,EAAEjxB,EAAGixB,EAAEviB,EAAGpjB,KAAKg/D,aAC1B,MAAP5xD,IACFu4B,EAAEy5B,MAAQhyD,GAAKyxD,OAAM,EAAMl5B,KAIjB,MAAVA,EAAEs5B,KAEDt5B,EAAEs5B,KAAKrY,cAAcjhB,EAAEjxB,EAAGixB,EAAEviB,IAA0B,GAApBuiB,EAAEs5B,KAAKI,WAE5C15B,EAAEs5B,KAAKK,cAAe35B,EAAEjxB,EAAGixB,EAAEviB,EAAGuiB,GAChC3vB,GAAY,IAIZ5I,EAAMu4B,EAAEs5B,KAAMt5B,EAAEs5B,KAAO,KACvB7xD,EAAI8xD,kBAAkBv5B,GAEtBv4B,EAAMpN,KAAK++D,WAAWp5B,EAAEjxB,EAAGixB,EAAEviB,GAClB,MAAPhW,KAEFu4B,EAAEs5B,KAAO7xD,GAAK+xD,gBAAgBx5B,GAC/B3vB,GAAY,KAMd5I,EAAMpN,KAAK++D,WAAWp5B,EAAEjxB,EAAGixB,EAAEviB,GAClB,MAAPhW,KAEFu4B,EAAEs5B,KAAO7xD,GAAK+xD,gBAAgBx5B,GAC/B3vB,GAAY,IAId,MAED,KAAK2pB,yCAAOkG,iBAAiBzF,aA0B5B,GAzBIpgC,KAAK0+D,YAEO,MAAX/4B,EAAEy5B,MAEDz5B,EAAEy5B,MAAMxY,cAAcjhB,EAAEjxB,EAAGixB,EAAEviB,KAKhChW,EAAMu4B,EAAEy5B,MAAOz5B,EAAEy5B,MAAQ,KACzBhyD,EAAIyxD,OAAM,EAAOl5B,GAEjBv4B,EAAMpN,KAAK++D,WAAWp5B,EAAEjxB,EAAGixB,EAAEviB,EAAGpjB,KAAKg/D,aAC1B,MAAP5xD,IACFu4B,EAAEy5B,MAAQhyD,GAAKyxD,OAAM,EAAMl5B,KAK9Bv4B,EAAMpN,KAAK++D,WAAWp5B,EAAEjxB,EAAGixB,EAAEviB,EAAGpjB,KAAKg/D,aAC1B,MAAP5xD,IACFu4B,EAAEy5B,MAAQhyD,GAAKyxD,OAAM,EAAMl5B,KAIjB,MAAVA,EAAEs5B,KAAc,MAEhBt5B,EAAEs5B,KAAKrY,cAAcjhB,EAAEjxB,EAAGixB,EAAEviB,IAA0B,GAApBuiB,EAAEs5B,KAAKI,WAE5C15B,EAAEs5B,KAAKK,cAAe35B,EAAEjxB,EAAGixB,EAAEviB,EAAGuiB,GAChC3vB,GAAY,IAIZ5I,EAAMu4B,EAAEs5B,KAAMt5B,EAAEs5B,KAAO,KACvB7xD,EAAI8xD,kBAAkBv5B,IAGvB,MAED,KAAKhG,yCAAOkG,iBAAiBtF,kBACd,MAAVoF,EAAEs5B,OAAcjpD,GAAY,GAChC,MAED,KAAK2pB,yCAAOkG,iBAAiB1F,WACd,MAAVwF,EAAEs5B,OAEL7xD,EAAMu4B,EAAEs5B,KAAMt5B,EAAEs5B,KAAO,KACvB7xD,EAAI8xD,kBAAkBv5B,GAEtB3vB,GAAY,GAMf,OAAOA,GAUR0uB,gBAAiB,SAAUxG,EAAQmE,EAASk9B,GAE3C,OAAQrhC,GAEP,KAAKyB,yCAAOgF,kBAAkB3E,SAE7B,IAAK,IAAI3/B,EAAI,EAAGA,EAAIL,KAAK0G,KAAKpG,UAExBN,KAAK0G,KAAKrG,KAAOL,KAAK0G,KAAKrG,GAAGm/D,iBAEY,IAA3Cx/D,KAAK0G,KAAKrG,GAAGo/D,QAAQp9B,EAASk9B,IAJGl/D,KAQtC,MAED,KAAKs/B,yCAAOgF,kBAAkB1E,OAE7B,IAAK,IAAI98B,EAAI,EAAGA,EAAInD,KAAK0G,KAAKpG,UAExBN,KAAK0G,KAAKvD,KAAOnD,KAAK0G,KAAKvD,GAAGq8D,iBAEU,IAAzCx/D,KAAK0G,KAAKvD,GAAGu8D,MAAMr9B,EAASk9B,IAJKp8D,MAWxC,OAAO;SAMTg7D;yCAAev/D,SAAS4/D,sCACxBZ,yCAAgBh/D,SAAS4/D,sC,IAEzBmB,yCAAenB;;;;AC3XfoB,yCAAe3F,yCAAM1zD,OACpB,CAMA84D,WAAW,EAOXG,gBAAgB,EAMhBK,WAAW,EAMXC,YAAY,EAMZC,aAAc,KAMdC,WAAY,KAOZ39B,QAAS,KAMT49B,OAAQ,KAKRC,cAAe,KACfC,YAAa,KACbC,OAAQ,KACRC,UAAW,KAMX37D,OAAQ,SAAUb,EAAW6Q,EAAG0O,EAAG28C,EAAa,KAAMC,EAAW,MAEhEhgE,KAAKuE,OAAO+7D,MAAM57D,SAElB1E,KAAK+/D,aAAeA,EACpB//D,KAAKggE,WAAaA,GAAcD,EAChC//D,KAAKigE,OAAS,KAEd,IAAIA,EAASpD,yCAAK78C,KAAKX,MAAO,EAAG3K,EAAG0O,EAAGpjB,KAAK+/D,aAAe//D,KAAK+/D,aAAa9xC,MAAQ,GAAIjuB,KAAK+/D,aAAe//D,KAAK+/D,aAAa7xC,OAAS,IAAI+jC,SAAQ,GAAOE,aAAY,GAAMxyC,MAAM,GACnL3f,KAAK25D,SAASsG,GAEdp8D,EAAU0L,IAAI0wD,GACdp8D,EAAU0L,IAAIvP,MAEdA,KAAKigE,OAASA,EAEdjgE,KAAKkgE,cAAgB,KACrBlgE,KAAKmgE,YAAc,KACnBngE,KAAKogE,OAAS,KACdpgE,KAAKqgE,UAAYrgE,KAAKugE,kBAEtBvgE,KAAKiI,QACL03D,yCAAepwD,IAAIvP,OAMpB2E,OAAQ,WAEP3E,KAAKuE,OAAO+7D,MAAM37D,SAClBg7D,yCAAen/D,OAAOR,OAOvBwzB,OAAQ,SAAUvF,EAAOC,GAOxB,OALAluB,KAAKuE,OAAO+7D,MAAM9sC,OAAOvF,EAAOC,GAEZ,OAAhBluB,KAAKigE,QACRjgE,KAAKigE,OAAOzsC,OAAOvF,EAAOC,GAEpBluB,MAORwmD,SAAU,SAAUwC,EAAQC,GAO3B,OALAjpD,KAAKuE,OAAO+7D,MAAM9Z,SAASwC,EAAQC,GAEf,OAAhBjpD,KAAKigE,QACRjgE,KAAKigE,OAAOzZ,SAASwC,EAAQC,GAEvBjpD,MAORwgE,SAAU,SAAUT,EAAcC,EAAW,MAM5C,OAJAhgE,KAAK+/D,aAAeA,EACpB//D,KAAKggE,WAAaA,GAAcD,EAEhC//D,KAAKiI,QACEjI,MAORygE,WAAY,SAAUxhE,GAGrB,OADAe,KAAKqiC,QAAUpjC,EACRe,MAORiI,MAAO,WAIN,OAFAjI,KAAKixB,IAAMjxB,KAAK+/D,aAChB//D,KAAKqgE,UAAWrgE,KAAK6/D,WAAY,EAAO7/D,KAAK8/D,YAAa,EAAO9/D,MAC1DA,MAORs/D,cAAe,SAAUoB,EAAUC,EAAU34B,KAQ7C44B,UAAW,SAAU3hE,GAEpB,OAAIe,KAAK6/D,YAAc5gE,IAGvBe,KAAK6gE,aAAc5hE,GAEnBe,KAAKixB,IAAMjxB,KAAK6/D,UAAY7/D,KAAKggE,WAAahgE,KAAK+/D,aACnD//D,KAAKqgE,UAAWrgE,KAAK6/D,UAAW7/D,KAAK8/D,WAAY9/D,OALzCA,MAcT6gE,aAAc,SAAU5hE,EAAM,MAI7B,OAFAe,KAAK8/D,WAAa9/D,KAAK6/D,UACvB7/D,KAAK6/D,UAAsB,OAAV5gE,EAAiBe,KAAK6/D,UAAY5gE,EAC5Ce,MAORm/D,gBAAiB,SAAUn3B,GAE1BhoC,KAAK4gE,WAAU,IAOhB1B,kBAAmB,SAAUl3B,GAE5BhoC,KAAK4gE,WAAU,IAOhBha,cAAe,SAASlyC,EAAG0O,GAE1B,SAAKpjB,KAAKiyD,WAAajyD,KAAKwyB,SAAW,IAGhCxyB,KAAKigE,OAAOtrB,OAAOiS,cAAclyC,EAAG0O,IAO5Cm9C,kBAAmB,SAAUV,EAAWC,EAAYt6B,GAE/Cq6B,IAAcC,IAEbD,GAAa7/D,KAAKkgE,cACrBlgE,KAAKkgE,iBACIL,GAAa7/D,KAAKmgE,aAC3BngE,KAAKmgE,gBAGFN,GAAaC,GAAc9/D,KAAKogE,QACpCpgE,KAAKogE,UAOPX,QAAS,SAAUp9B,EAASk9B,GAE3B,GAAIl9B,IAAYriC,KAAKqiC,QAGpB,OADAriC,KAAKm/D,mBACE,GAQTO,MAAO,SAAUr9B,EAASk9B,GAEzB,GAAIl9B,IAAYriC,KAAKqiC,QAGpB,OADAriC,KAAKk/D,qBACE,GAUT4B,SAAU,SAAU5yD,GAGnB,OADAlO,KAAKqgE,UAAyB,OAAbnyD,EAAoBlO,KAAKugE,kBAAoBryD,EACvDlO,MAWR+gE,aAAc,SAAU7yD,GAAS,GAEhC,IAAiB,IAAbA,EAMJ,OADAlO,KAAKkgE,cAAgBhyD,EACdlO,KALFA,KAAKkgE,eAAelgE,KAAKkgE,iBAgB/Bc,WAAY,SAAU9yD,GAAS,GAE9B,IAAiB,IAAbA,EAMJ,OADAlO,KAAKmgE,YAAcjyD,EACZlO,KALFA,KAAKmgE,aAAangE,KAAKmgE,eAgB7Bc,MAAO,SAAU/yD,GAAS,GAEzB,IAAiB,IAAbA,EAMJ,OADAlO,KAAKogE,OAASlyD,EACPlO,KALFA,KAAKogE,QAAQpgE,KAAKogE;;;;;AC1UzBc,yCAAejH,yCAAM1zD,OACpB,CAMA84D,WAAW,EAKXG,gBAAgB,EAMhBK,WAAW,EAMXC,YAAY,EAMZC,aAAc,KAMdC,WAAY,KAMZmB,kBAAmB,KAMnBC,gBAAiB,KAMjBC,WAAY,EAMZC,YAAa,EAMb//B,MAAO,EAMPC,MAAO,EAMP+/B,MAAO,EAMPC,MAAO,EAMPC,KAAM,EAMNC,KAAM,EAMNj9C,UAAW,EAMXV,MAAO,EAKP49C,OAAQ,EAAGC,OAAQ,EAAGC,MAAO,EAAGC,MAAO,EAAGC,WAAY,EAAGC,OAAQ,EAKjEC,MAAO,EAAGC,MAAO,EAKjBC,OAAQ,EAAGC,UAAW,EAKtBC,UAAW,EAAGC,UAAW,EAKzBrC,OAAQ,KAKRI,UAAW,KAKX1mD,GAAI,KACJE,KAAM,KACNH,KAAM,KACNE,MAAO,KAKP2oD,QAAS,KAAMC,QAAS,KACxBC,QAAS,KAAMC,QAAS,KAMxBh+D,OAAQ,SAAUb,EAAW6Q,EAAG0O,EAAGg/C,EAAWrC,EAAcoB,EAAmBnB,EAAW,KAAMoB,EAAgB,MAE/GphE,KAAKuE,OAAO+7D,MAAM57D,SAElB1E,KAAK+/D,aAAeA,EACpB//D,KAAKggE,WAAaA,GAAcD,EAEhC//D,KAAKmhE,kBAAoBA,EACzBnhE,KAAKohE,gBAAkBA,GAAmBD,EAE1CnhE,KAAKoiE,UAAYA,EAEjBpiE,KAAKqiE,UAAY,EACjBriE,KAAKsiE,UAAY,EAEjBtiE,KAAKuhC,MAAQ,EACbvhC,KAAKwhC,MAAQ,EAEbxhC,KAAKuiE,SAAU,EACfviE,KAAKwiE,SAAU,EACfxiE,KAAKyiE,SAAU,EACfziE,KAAK0iE,SAAU,EAEf1iE,KAAKigE,OAASpD,yCAAK78C,KAAKX,MAAO,EAAG3K,EAAG0O,GAAIpjB,KAAK+/D,cAAgB//D,KAAKmhE,mBAAmBlzC,OAAQjuB,KAAK+/D,cAAgB//D,KAAKmhE,mBAAmBjzC,QAAQ+jC,SAAQ,GAAOE,aAAY,GAAMxyC,MAAM,GAC1L3f,KAAK25D,SAAS35D,KAAKigE,QAEnBp8D,EAAU0L,IAAIvP,KAAKigE,QACnBp8D,EAAU0L,IAAIvP,MAEdA,KAAKqgE,UAAY,KAEjBrgE,KAAKk5D,WAAWl5D,KAAK2iE,aACrBhD,yCAAepwD,IAAIvP,OAMpB2E,OAAQ,WAEP3E,KAAKuE,OAAO+7D,MAAM37D,SAClBg7D,yCAAen/D,OAAOR,OAOvB4iE,SAAU,SAAUC,EAAGjqD,yCAAQe,GAAImpD,EAAKlqD,yCAAQiB,KAAMuY,EAAKxZ,yCAAQc,KAAMqpD,EAAMnqD,yCAAQgB,OAQtF,OANA5Z,KAAK2Z,GAAKkpD,EACV7iE,KAAK6Z,KAAOipD,EACZ9iE,KAAK0Z,KAAO0Y,EACZpyB,KAAK4Z,MAAQmpD,EAEb/iE,KAAKw/D,gBAAiB,EACfx/D,MAWRgjE,YAAa,SAAU/jE,EAAM,MAE5B,OAAc,OAAVA,EACIe,KAAKw/D,gBAEbx/D,KAAKw/D,eAAiBvgE,EACfe,OAORijE,UAAW,SAAUrtC,EAAIC,EAAIC,EAAIC,GAMhC,OAJA/1B,KAAKuiE,QAAU3sC,EACf51B,KAAKwiE,QAAU3sC,EACf71B,KAAKyiE,QAAU3sC,EACf91B,KAAK0iE,QAAU3sC,EACR/1B,MAORwgE,SAAU,SAAUT,EAAcC,EAAW,MAI5C,OAFAhgE,KAAK+/D,aAAeA,EACpB//D,KAAKggE,WAAaA,GAAcD,EACzB//D,MAORkjE,cAAe,SAAUnD,EAAcC,EAAW,MAIjD,OAFAhgE,KAAKmhE,kBAAoBpB,EACzB//D,KAAKohE,gBAAkBpB,GAAcD,EAC9B//D,MAORmjE,cAAe,SAAU5lE,GAGxB,OADAyC,KAAKqhE,WAAa9jE,EACXyC,MAORojE,eAAgB,SAAU7lE,GAGzB,OADAyC,KAAKshE,YAAc/jE,EACZyC,MAWRqjE,YAAa,SAAUhB,EAAWC,EAAU,MAK3C,OAHAtiE,KAAKqiE,UAAYA,EACjBriE,KAAKsiE,UAAYA,GAAaD,EAEvBriE,MAORiI,MAAO,WAeN,OAbAjI,KAAKiiE,MAAQ,EACbjiE,KAAKkiE,MAAQ,EAEbliE,KAAKuhE,MAAQ,EACbvhE,KAAKwhE,MAAQ,EAEbxhE,KAAKyhE,KAAO,EACZzhE,KAAK0hE,KAAO,EACZ1hE,KAAKykB,UAAY,EAEbzkB,KAAKqgE,WACRrgE,KAAKqgE,UAAWrgE,KAAKyhE,KAAMzhE,KAAK0hE,KAAM1hE,KAAKykB,UAAWzkB,KAAK+jB,MAAO/jB,MAE5DA,MAMR2iE,YAAa,SAAUvoC,EAAGx3B,EAAMquB,GAE3BruB,EAAKi9D,WAEJj9D,EAAKo9D,YACRp9D,EAAKo9D,WAAWvgC,KAAMrF,EAAGx3B,EAAK+xC,OAAO/e,GAAKhzB,EAAK2+B,MAAO3+B,EAAK+xC,OAAO9e,GAAKjzB,EAAK4+B,OAEzE5+B,EAAKw+D,iBACRx+D,EAAKw+D,gBAAgB3hC,KAAMrF,EAAGx3B,EAAK+xC,OAAO/e,GAAKhzB,EAAK2+B,MAAQ3+B,EAAKq/D,MAAOr/D,EAAK+xC,OAAO9e,GAAKjzB,EAAK4+B,MAAQ5+B,EAAKs/D,SAIxGt/D,EAAKm9D,cACRn9D,EAAKm9D,aAAatgC,KAAMrF,EAAGx3B,EAAK+xC,OAAO/e,GAAKhzB,EAAK2+B,MAAO3+B,EAAK+xC,OAAO9e,GAAKjzB,EAAK4+B,OAE3E5+B,EAAKu+D,mBACRv+D,EAAKu+D,kBAAkB1hC,KAAMrF,EAAGx3B,EAAK+xC,OAAO/e,GAAKhzB,EAAK2+B,MAAO3+B,EAAK+xC,OAAO9e,GAAKjzB,EAAK4+B,SAOtF89B,cAAe,SAAUoB,EAAUC,GAElC,IAAI/8C,EAAIC,EAyBR,GAvBAD,EAAK88C,GAAY1gE,KAAK20C,OAAO3wB,GAAKhkB,KAAKuhC,OACvC1d,EAAK88C,GAAY3gE,KAAK20C,OAAO1wB,GAAKjkB,KAAKwhC,OAEvCxhC,KAAK+jB,MAAQtW,KAAK61D,OAAOz/C,EAAID,GAC7B5jB,KAAKmiE,OAAS10D,KAAKkX,KAAKf,EAAGA,EAAKC,EAAGA,GAE/B7jB,KAAKmiE,OAASniE,KAAKoiE,aAED,IAAjBpiE,KAAKuiE,UACRviE,KAAKuhC,OAAS9zB,KAAKyW,IAAIlkB,KAAK+jB,QAAQ/jB,KAAKmiE,OAASniE,KAAKoiE,WAClC,OAAjBpiE,KAAKuiE,SAAoBviE,KAAM20C,OAAO3wB,GAAGhkB,KAAKuhC,MAASvhC,KAAKuiE,UAASviE,KAAKuhC,MAAQvhC,KAAKuiE,QAAUviE,KAAK20C,OAAO3wB,IAC5F,OAAjBhkB,KAAKyiE,SAAoBziE,KAAM20C,OAAO3wB,GAAGhkB,KAAKuhC,MAASvhC,KAAKyiE,UAASziE,KAAKuhC,MAAQvhC,KAAKyiE,QAAUziE,KAAK20C,OAAO3wB,MAG7F,IAAjBhkB,KAAKwiE,UACRxiE,KAAKwhC,QAAU/zB,KAAK0W,IAAInkB,KAAK+jB,QAAQ/jB,KAAKmiE,OAASniE,KAAKoiE,WACnC,OAAjBpiE,KAAKwiE,SAAoBxiE,KAAM20C,OAAO1wB,GAAGjkB,KAAKwhC,MAASxhC,KAAKwiE,UAASxiE,KAAKwhC,MAAQxhC,KAAKwiE,QAAUxiE,KAAK20C,OAAO1wB,IAC5F,OAAjBjkB,KAAK0iE,SAAoB1iE,KAAM20C,OAAO1wB,GAAGjkB,KAAKwhC,MAASxhC,KAAK0iE,UAAS1iE,KAAKwhC,MAAQxhC,KAAK0iE,QAAU1iE,KAAK20C,OAAO1wB,KAGlHjkB,KAAKmiE,OAASniE,KAAKoiE,WAGhBpiE,KAAKqhE,WACT,CACC,IAAI9zC,EAAM,EAAE9f,KAAKiwB,GAAK19B,KAAKqhE,WAC3BrhE,KAAK+jB,MAAQ3Q,KAAKpT,KAAK+jB,MAAQtW,KAAKiwB,GAAKnQ,EAAG,GAAKA,GAAMA,EAAK9f,KAAKiwB,GAGlE,GAAI19B,KAAKshE,YACT,CACC,IAAI/zC,EAAMvtB,KAAKoiE,UAAYpiE,KAAKshE,YAChCthE,KAAKmiE,OAAS/uD,KAAKpT,KAAKmiE,OAAS50C,EAAG,GAAKA,GAAMA,EAGhDvtB,KAAKuhE,MAAQ9zD,KAAK0R,IAAI,EAAG1R,KAAKg/B,IAAI7oB,EAAK5jB,KAAKoiE,WAAW,IACvDpiE,KAAKwhE,MAAQ/zD,KAAK0R,IAAI,EAAG1R,KAAKg/B,IAAI5oB,EAAK7jB,KAAKoiE,WAAW,IAEvDpiE,KAAKiiE,MAAQjiE,KAAKmiE,OAAS10D,KAAKyW,IAAIlkB,KAAK+jB,OACzC/jB,KAAKkiE,MAAQliE,KAAKmiE,QAAU10D,KAAK0W,IAAInkB,KAAK+jB,OAEtC/jB,KAAKmiE,OAAS,GAEjBniE,KAAKyhE,KAAOzhE,KAAKiiE,MAAQjiE,KAAKmiE,OAC9BniE,KAAK0hE,KAAO1hE,KAAKkiE,MAAQliE,KAAKmiE,OAE9BniE,KAAKykB,UAAYzkB,KAAKmiE,OAASniE,KAAKoiE,YAIpCpiE,KAAKyhE,KAAO,EACZzhE,KAAK0hE,KAAO,EAEZ1hE,KAAKykB,UAAY,GAGdhX,KAAKoG,IAAI7T,KAAKuhE,OAASvhE,KAAKqiE,YAC/BriE,KAAKuhE,MAAQ,EACbvhE,KAAKyhE,KAAO,GAGTh0D,KAAKoG,IAAI7T,KAAKwhE,OAASxhE,KAAKsiE,YAC/BtiE,KAAKwhE,MAAQ,EACbxhE,KAAK0hE,KAAO,GAGT1hE,KAAKqgE,WACRrgE,KAAKqgE,UAAWrgE,KAAKyhE,KAAMzhE,KAAK0hE,KAAM1hE,KAAKykB,UAAWzkB,KAAK+jB,MAAO/jB,OAMpEm/D,gBAAiB,SAAUn3B,GAE1BhoC,KAAK8/D,WAAa9/D,KAAK6/D,UACvB7/D,KAAK6/D,UAAY,EAEjB7/D,KAAKuhC,MAAQ,EACbvhC,KAAKwhC,MAAQ,EAEbxhC,KAAKs/D,cAAct3B,EAAQtzB,EAAGszB,EAAQ5kB,IAMvC87C,kBAAmB,SAAUl3B,GAE5BhoC,KAAK8/D,WAAa9/D,KAAK6/D,UACvB7/D,KAAK6/D,UAAY,EAEjB7/D,KAAKuhC,MAAQ,EACbvhC,KAAKwhC,MAAQ,EAEbxhC,KAAKiI,SAON2+C,cAAe,SAASlyC,EAAG0O,GAE1B,SAAKpjB,KAAKiyD,WAAajyD,KAAKwyB,SAAW,IAGhCxyB,KAAKigE,OAAOtrB,OAAOiS,cAAclyC,EAAG0O,IAO5CmgD,aAAc,SAAU3/C,EAAIC,EAAIw+C,EAAU,GAAMC,EAAU,IASzD,OAPI70D,KAAKoG,IAAI+P,GAAMy+C,IAAWz+C,EAAK,GAC/BnW,KAAKoG,IAAIgQ,GAAMy+C,IAAWz+C,EAAK,GAEnC7jB,KAAK8/D,WAAa9/D,KAAK6/D,UACvB7/D,KAAK6/D,UAAkB,GAANj8C,GAAiB,GAANC,EAAU,EAAI,EAE1C7jB,KAAKs/D,cAAet/D,KAAK20C,OAAO3wB,GAAKJ,EAAG5jB,KAAKoiE,UAAWpiE,KAAK20C,OAAO1wB,GAAKJ,EAAG7jB,KAAKoiE,YAC1E,GASRoB,YAAa,SAAUC,GAAU,GAShC,OAPAzjE,KAAK2hE,OAAS8B,EAA2B,GAAdzjE,KAAKuhE,MAAavhE,KAAKuhE,MAAQvhE,KAAK2hE,OAAU3hE,KAAKuhE,MAC9EvhE,KAAK4hE,OAAS6B,EAA2B,GAAdzjE,KAAKwhE,MAAaxhE,KAAKwhE,MAAQxhE,KAAK4hE,OAAU5hE,KAAKwhE,MAC9ExhE,KAAK6hE,MAAQ4B,EAA0B,GAAbzjE,KAAKyhE,KAAYzhE,KAAKyhE,KAAOzhE,KAAK6hE,MAAS7hE,KAAKyhE,KAC1EzhE,KAAK8hE,MAAQ2B,EAA0B,GAAbzjE,KAAK0hE,KAAY1hE,KAAK0hE,KAAO1hE,KAAK8hE,MAAS9hE,KAAK0hE,KAC1E1hE,KAAK+hE,WAAa0B,EAA+B,GAAlBzjE,KAAKykB,UAAiBzkB,KAAKykB,UAAYzkB,KAAK+hE,WAAc/hE,KAAKykB,UAC9FzkB,KAAKgiE,OAASyB,EAA2B,GAAdzjE,KAAK+jB,MAAa/jB,KAAK+jB,MAAQ/jB,KAAKgiE,OAAUhiE,KAAK+jB,MAEvE/jB,MAMRy/D,QAAS,SAAUp9B,EAASk9B,GAE3B,IAAI37C,EAAK,EACLC,EAAK,EAUT,GARA7jB,KAAKuhC,MAAQ,EACbvhC,KAAKwhC,MAAQ,GAEY,IAArB+9B,EAAQv/D,KAAK2Z,MAAckK,GAAM7jB,KAAKoiE,YACf,IAAvB7C,EAAQv/D,KAAK0Z,QAAgBkK,GAAM5jB,KAAKoiE,YACjB,IAAvB7C,EAAQv/D,KAAK6Z,QAAgBgK,EAAK7jB,KAAKoiE,YACf,IAAxB7C,EAAQv/D,KAAK4Z,SAAiBgK,EAAK5jB,KAAKoiE,WAExC//B,IAAYriC,KAAK2Z,IAAM0oB,IAAYriC,KAAK0Z,MAAQ2oB,IAAYriC,KAAK6Z,MAAQwoB,IAAYriC,KAAK4Z,MAY7F,OAVA5Z,KAAK8/D,WAAa9/D,KAAK6/D,UACvB7/D,KAAK6/D,UAAY,EAEP,GAANj8C,GAAiB,GAANC,IAEdD,GAAM,MACNC,GAAM,OAGP7jB,KAAKs/D,cAAet/D,KAAK20C,OAAO3wB,GAAKJ,EAAI5jB,KAAK20C,OAAO1wB,GAAKJ,IACnD,GAOT67C,MAAO,SAAUr9B,EAASk9B,GAEzB,IAAI37C,EAAK,EACLC,EAAK,EAUT,GARA7jB,KAAKuhC,MAAQ,EACbvhC,KAAKwhC,MAAQ,GAEY,IAArB+9B,EAAQv/D,KAAK2Z,MAAckK,GAAM7jB,KAAKoiE,YACf,IAAvB7C,EAAQv/D,KAAK0Z,QAAgBkK,GAAM5jB,KAAKoiE,YACjB,IAAvB7C,EAAQv/D,KAAK6Z,QAAgBgK,EAAK7jB,KAAKoiE,YACf,IAAxB7C,EAAQv/D,KAAK4Z,SAAiBgK,EAAK5jB,KAAKoiE,WAExC//B,IAAYriC,KAAK2Z,IAAM0oB,IAAYriC,KAAK0Z,MAAQ2oB,IAAYriC,KAAK6Z,MAAQwoB,IAAYriC,KAAK4Z,MAgB7F,OAdU,GAANgK,GAAiB,GAANC,IAEdD,GAAM,MACNC,GAAM,OAGP7jB,KAAKs/D,cAAet/D,KAAK20C,OAAO3wB,GAAKJ,EAAI5jB,KAAK20C,OAAO1wB,GAAKJ,GAE/C,IAAPD,GAAmB,IAAPC,IAEf7jB,KAAK8/D,WAAa9/D,KAAK6/D,UACvB7/D,KAAK6/D,UAAY,IAGX,GAQTiB,SAAU,SAAU5yD,GAGnB,OADAlO,KAAKqgE,UAAYnyD,EACVlO,Q;;;;;AC5jBT,MAAM0jE,4BACN,CAOCC,WAAY,EACZC,UAAW,EAkBXC,UAAW,EACXC,UAAW,EACXC,UAAW,EACXC,UAAW,EACXC,UAAW,EACXC,WAAY,EACZC,UAAW,EACXC,UAAW,EACXC,UAAW,EACXC,UAAW,EACXC,UAAW,GACXC,WAAY,GAaXC,cAAe,EAChBC,cAAe,EACfC,cAAe,EACfC,eAAgB,EAChBC,cAAe,EACfC,cAAe,EACfC,cAAe,EAKfC,QAAS,GAMTC,YAAa,KAKbC,WAAY,GAMZC,eAAgB,KAMhBC,gBAAiB,KAMjBC,YAAa,KAMbC,UAAW,KAMXC,YAAa,KAMb5wB,OAAQwU,yCAAQnpC,KAAKX,QAMrBlX,KAAM,SAAUq9D,EAAW,MAAOC,EAAY,MAAO/I,EAAS,KAAMC,EAAS,MAEhD,IAAxB38D,KAAKglE,QAAQ1kE,SAGA,OAAbo8D,IACHA,EAAWjvD,KAAKg/B,IAAI+4B,EAAYC,GAAe,KAE5C/I,EAAW,KACdA,EAAW,IAEK,OAAbC,GAAqBA,EAAW,KACnCA,EAAW,IAEZ38D,KAAK20C,OAAOpxB,OAAOiQ,OAAOgyC,EAAYC,GAEtCzlE,KAAK0lE,YAAYhC,4BAAMC,WAAY,cACnC3jE,KAAKi7D,aAAayI,4BAAMG,UAAW,IAAIpH,yCAAe+I,EAAYC,EAAa/I,EAAUC,IACzF38D,KAAKi7D,aAAayI,4BAAMI,UAAW,IAAIrH,yCAAe+I,EAAYC,EAAa/I,EAAUC,IACzF38D,KAAKi7D,aAAayI,4BAAMK,UAAW,IAAItH,yCAAe+I,EAAYC,EAAa/I,EAAUC,IACzF38D,KAAKi7D,aAAayI,4BAAMM,UAAW,IAAIvH,yCAAe+I,EAAYC,EAAa/I,EAAUC,IACzF38D,KAAKi7D,aAAayI,4BAAMO,UAAW,IAAIxH,yCAAe+I,EAAYC,EAAa/I,EAAUC,IACzF38D,KAAKi7D,aAAayI,4BAAMQ,WAAY,IAAIzH,yCAAe+I,EAAYC,EAAa/I,EAAUC,IAC1F38D,KAAKi7D,aAAayI,4BAAMS,UAAW,IAAI1H,yCAAe+I,EAAYC,EAAa/I,EAAUC,IACzF38D,KAAKi7D,aAAayI,4BAAMU,UAAW,IAAI3H,yCAAe+I,EAAYC,EAAa/I,EAAUC,IACzF38D,KAAKi7D,aAAayI,4BAAMW,UAAW,IAAI5H,yCAAe+I,EAAYC,EAAa/I,EAAUC,IACzF38D,KAAKi7D,aAAayI,4BAAMY,UAAW,IAAI7H,yCAAe+I,EAAYC,EAAa/I,EAAUC,IACzF38D,KAAKi7D,aAAayI,4BAAMa,UAAW,IAAI9H,yCAAe+I,EAAYC,EAAa/I,EAAUC,IAEzF38D,KAAKi7D,aAAayI,4BAAMc,WAAY,IAAI/H,yCAAe+I,EAAYC,EAAa/I,EAAUC,IAC1F38D,KAAKk7D,aAAawI,4BAAMc,YAAYvS,SAAQ,GAC5CjyD,KAAK2lE,eAAe,GAEpB3lE,KAAK0lE,YAAYhC,4BAAME,UAAW,aAClC5jE,KAAKi7D,aAAayI,4BAAMe,cAAe,IAAIlI,yCAAiBtQ,yCAAO/qB,YAAa+qB,yCAAO9qB,eACvFnhC,KAAKi7D,aAAayI,4BAAMgB,cAAe,IAAInI,yCAAiBtQ,yCAAO/qB,YAAa+qB,yCAAO9qB,eACvFnhC,KAAKi7D,aAAayI,4BAAMiB,cAAe,IAAIpI,yCAAiBtQ,yCAAO/qB,YAAa+qB,yCAAO9qB,eACvFnhC,KAAKi7D,aAAayI,4BAAMkB,eAAgB,IAAIrI,yCAAiBtQ,yCAAO/qB,YAAa+qB,yCAAO9qB,eACxFnhC,KAAKi7D,aAAayI,4BAAMmB,cAAe,IAAItI,yCAAiBtQ,yCAAO/qB,YAAa+qB,yCAAO9qB,eACvFnhC,KAAKi7D,aAAayI,4BAAMoB,cAAe,IAAIvI,yCAAiBtQ,yCAAO/qB,YAAa+qB,yCAAO9qB,eACvFnhC,KAAKi7D,aAAayI,4BAAMqB,cAAe,IAAIxI,yCAAiBtQ,yCAAO/qB,YAAa+qB,yCAAO9qB,iBAOxFukC,YAAa,SAAUj5D,EAAOjN,EAAK,MAYlC,OAVIQ,KAAKglE,QAAQv4D,KAEhBkzB,yCAAO8H,YAAYznC,KAAKglE,QAAQv4D,IAChCvO,eAAO0iB,QAAQ5gB,KAAKglE,QAAQv4D,KAG7BzM,KAAKglE,QAAQv4D,GAAS,IAAIkvD,yCAAMlvD,EAAOjN,GACvCmgC,yCAAO6H,SAASxnC,KAAKglE,QAAQv4D,IAE7BzM,KAAK4lE,YAAYn5D,GACVzM,KAAKglE,QAAQv4D,IAOrBo5D,SAAU,SAAUp5D,EAAM,MAEzB,OAAc,OAAVA,EACIzM,KAAKilE,YAETx4D,EAAQ,GAAKA,GAASzM,KAAKglE,QAAQ1kE,OAC/B,KAEDN,KAAKglE,QAAQv4D,IAOrBm5D,YAAa,SAAUn5D,GAEtB,QAAIA,EAAQ,GAAKA,GAASzM,KAAKglE,QAAQ1kE,SAAWN,KAAKglE,QAAQv4D,MAG/DzM,KAAKilE,YAAcjlE,KAAKglE,QAAQv4D,GAChCzM,KAAKolE,gBAAkB,MAEhB,IASRO,eAAgB,SAAUl5D,GAEzB,GAAyB,OAArBzM,KAAKilE,YACR,MAAM,IAAIvmE,MAAO,uEAEdsB,KAAKklE,WAAWz4D,KAEnBvO,eAAO0iB,QAAQ5gB,KAAKklE,WAAWz4D,IAC/BzM,KAAKilE,YAAY9J,YAAY1uD,EAAO,OAGrCzM,KAAKklE,WAAWz4D,GAAS,IAAIisD,yCAC5B,EAAG,EACHzM,yCAAO/qB,YAAa+qB,yCAAO9qB,aAC3BnhC,KAAKilE,YAAYhvC,SAAUj2B,KAAKilE,YAAY5K,WAG7Cr6D,KAAKilE,YAAY9J,YAAY1uD,EAAOzM,KAAKklE,WAAWz4D,IAEpDzM,KAAK8lE,eAAer5D,IAOrB2uD,YAAa,SAAU3uD,EAAM,MAE5B,OAAc,OAAVA,EACIzM,KAAKmlE,eAET14D,EAAQ,GAAKA,GAASzM,KAAKklE,WAAW5kE,OAClC,KAEDN,KAAKklE,WAAWz4D,IAOxBq5D,eAAgB,SAAUr5D,GAEzB,QAAIA,EAAQ,GAAKA,GAASzM,KAAKklE,WAAW5kE,SAAWN,KAAKklE,WAAWz4D,MAGrEzM,KAAKmlE,eAAiBnlE,KAAKklE,WAAWz4D,IAC/B,IAORwuD,aAAc,SAAUxuD,EAAO5I,GAE9B,GAAyB,OAArB7D,KAAKilE,YACR,MAAM,IAAIvmE,MAAO,qEAGlB,OADAsB,KAAKilE,YAAYhK,aAAcxuD,EAAO5I,GAC/BA,GAORq3D,aAAc,SAAUzuD,EAAM,KAAMs5D,GAAY,GAE/C,GAAc,OAAVt5D,EACJ,CACC,GAA6B,OAAzBzM,KAAKolE,iBAA4BW,EACpC,MAAM,IAAIrnE,MAAO,8EAElB,OAAOsB,KAAKolE,gBAGb,GAAyB,OAArBplE,KAAKilE,YACR,MAAM,IAAIvmE,MAAO,qEAElB,IAAImF,EAAY7D,KAAKilE,YAAY/J,aAAazuD,GAC9C,GAAkB,OAAd5I,GAAsBkiE,EACzB,MAAM,IAAIrnE,MAAO,gDAElB,OAAOmF,GAORmiE,gBAAiB,SAAUv5D,GAG1B,OADAzM,KAAKolE,gBAAkBplE,KAAKk7D,aAAazuD,GAAO,GAChB,OAAzBzM,KAAKolE,iBASba,UAAW,SAAUhnE,EAAOinE,GAAS,GAEpCxC,4BAAMmC,SAASnC,4BAAMC,YAAYzI,aAAawI,4BAAMc,YAAYvS,QAAQhzD,GACxEyzB,yCAAQqW,WAAam9B,GAOtBC,YAAa,SAAS3nE,EAAG,MAExB,GAAyB,OAArBwB,KAAKilE,YACR,MAAM,IAAIvmE,MAAO,kEAKlB,OAHAsB,KAAKqlE,YAAcpL,yCAAMj6C,KAAKX,MAAM7gB,GACpCwB,KAAKilE,YAAY5J,SAASr7D,KAAKqlE,aAExBrlE,KAAKqlE,aAObe,SAAU,SAAS1xD,EAAE,KAAM0O,EAAE,MAQ5B,OANU,OAAN1O,GAAoB,OAAN0O,GACjBpjB,KAAKqlE,YAAY1hD,UAAUjP,EAAG0O,GAE/BpjB,KAAKslE,UAAYtlE,KAAKqlE,YACtBrlE,KAAKqlE,YAAc,KAEZrlE,KAAKslE,UAAU9S,QAevBxgC,cAAe,SAAUxzB,EAAIkW,EAAG0O,EAAG6N,EAAI,KAAMo1C,EAAe,MAExC,iBAAR7nE,IAEV6nE,EAAiBp1C,EACjBA,EAAM7N,EACNA,EAAI1O,EACJA,EAAIlW,EACJA,EAAK,MAGN,IAAIqF,EAAY7D,KAAKk7D,aAAamL,GAE9BzjE,EAAOy2D,yCAAQr5C,KAAKX,MAAM3K,EAAG0O,EAAG6N,GAOpC,OANAptB,EAAU0L,IAAI3M,EAAKyuD,MAAM7yD,IAEA,OAArBwB,KAAKqlE,aACRrlE,KAAKqlE,YAAY1L,SAAS/2D,GAE3B5C,KAAKulE,YAAc3iE,EACZA,GASR0jE,WAAY,SAAU9nE,EAAIa,EAAMqV,EAAE,KAAM0O,EAAE,KAAM6K,EAAM,KAAMC,EAAO,KAAMm4C,EAAe,MAEvF,IAAIxiE,EAAY7D,KAAKk7D,aAAamL,GAAkB3C,4BAAMc,YAE1D,GAAU,OAAN9vD,EACJ,CACC,GAAyB,OAArB1U,KAAKqlE,YACR,MAAM,IAAI3mE,MAAO,0DAElBgW,EAAI1U,KAAKqlE,YAAY1wB,OAAO/e,GAC5BxS,EAAIpjB,KAAKqlE,YAAY1wB,OAAO9e,GAC5B5H,EAAQjuB,KAAKqlE,YAAY1wB,OAAO1mB,QAChCC,EAASluB,KAAKqlE,YAAY1wB,OAAOzmB,SAGlC,IAAIq4C,EAAO1J,yCAAK78C,KAAKX,MAAMhgB,EAAMqV,EAAG0O,EAAG6K,EAAOC,GAM9C,OALArqB,EAAU0L,IAAIg3D,EAAKlV,MAAM7yD,IAEA,OAArBwB,KAAKqlE,aACRrlE,KAAKqlE,YAAY1L,SAAS4M,GAEpBA,GAeRC,YAAa,SAAUhoE,EAAIkW,EAAG0O,EAAGmY,EAAMn3B,EAAMiiE,EAAe,MAExC,iBAAR7nE,IAEV6nE,EAAiBjiE,EACjBA,EAAOm3B,EACPA,EAAOnY,EACPA,EAAI1O,EACJA,EAAIlW,EACJA,EAAK,MAGN,IAAIqF,EAAY7D,KAAKk7D,aAAamL,GAE9BzjE,EAAO+6D,yCAAM39C,KAAKX,MAAM3K,EAAG0O,EAAGmY,EAAMn3B,GAOxC,OANAP,EAAU0L,IAAI3M,EAAKyuD,MAAM7yD,IAEA,OAArBwB,KAAKqlE,aACRrlE,KAAKqlE,YAAY1L,SAAS/2D,GAE3B5C,KAAKulE,YAAc3iE,EACZA,GAOR6jE,cAAe,SAAUr+D,EAAO,KAAMhB,EAAQ,MAE7C,GAAyB,OAArBpH,KAAKilE,YACR,MAAM,IAAIvmE,MAAO,oEAElB,OAAO,IAAI49D,yCAASt8D,KAAKilE,YAAa78D,EAAQhB,K;AAMhDs/D,yCAAehD;;;MCnef;MAAMiD,wBAAI,G,IAGVC,yCAAeD;;;;;;;YCwCf;MAAME,0BACN,CAKC3vB,OAAQ,SAAUxlB,GAEjBkuB,yCAAU1I,OAAOxlB,IAOlB4pB,KAAM,SAAUC,EAAiB,MAEhC,OAAO,IAAIl5C,SAAS,SAAUC,EAASC,GAEtCq9C,yCAAUtE,KAAMsrB,0CACf,SAAUn6D,EAAOq6D,EAAO7nE,EAAOO,GAC1B+7C,GAAkBA,EAAiBt8C,EAAOO,MAE/C,WACC8C,WAUJ5E,IAAK,SAAUc,GAEd,IAAKooE,yCAAE/hE,eAAerG,GACrB,MAAM,IAAIE,MAAM,uBAAyBF,GAE1C,OAAOooE,yCAAEpoE,IAMVuoE,oBAAqB,SAAUvoE,GAE9B,GAAIooE,yCAAE/hE,eAAerG,GAAK,MAAM,IAAIE,MAAO,wBAA0BF,EAAK,wBAO3E07B,MAAO,SAAU17B,EAAI07B,EAAOjM,EAAOC,GAIlC,OAFAluB,KAAK+mE,oBAAoBvoE,GAElBooE,yCAAEpoE,GAAM,CAAEa,KAAM,SAAUm3C,QAAS,SAAUtc,MAAOA,EAAOjM,MAAOA,EAAOC,OAAQA,IAOzF84C,OAAQ,SAAUxoE,EAAIyvB,EAAOC,EAAQ+4C,EAAcv1C,EAAK,MAIvD,OAFA1xB,KAAK+mE,oBAAoBvoE,GAElBooE,yCAAEpoE,GAAM,CAAEa,KAAM,SAAUm3C,QAAS,SAAUvoB,MAAOA,EAAOC,OAAQA,EAAQuR,KAAMwnC,KAAiBv1C,IAO1GtB,MAAO,SAAU5xB,EAAI0oE,EAAMx1C,EAAK,MAI/B,OAFA1xB,KAAK+mE,oBAAoBvoE,GAElBooE,yCAAEpoE,GAAM,CAAEa,KAAM,QAASm3C,QAAS,WAAYplB,IAAK81C,KAASx1C,IAUpEy1C,OAAQ,SAAU3oE,EAAI0oE,EAAMj2D,EAAO6lB,EAAW,KAAMC,EAAY,KAAMqwC,EAAc,KAAMC,EAAW,MAGpG,OADArnE,KAAK+mE,oBAAoBvoE,GAClBooE,yCAAEpoE,GAAM,CAAEa,KAAM,SAAUm3C,QAAS,cAAeplB,IAAK81C,EAAMj2D,MAAOA,EAAOgd,MAAO6I,EAAY5I,OAAQ6I,EAC5GmgB,OAAQ,CACPpgB,WAAYA,EAAYC,YAAaA,KAAgBqwC,MAEnDC,IAiBLtyB,YAAa,SAAUv2C,EAAI0oE,EAAMpwC,EAAYC,EAAamM,EAAU,EAAGkkC,EAAc,KAAMC,EAAW,MAIrG,OAFArnE,KAAK+mE,oBAAoBvoE,GAElBooE,yCAAEpoE,GAAM,CAAEa,KAAM,QAASm3C,QAAS,cAAeplB,IAAK81C,EAC5DhwB,OAAQ,CACPpgB,WAAYA,EAAYC,YAAaA,EACrCmM,UAAiC,iBAAfA,EAA0BA,EAAY,EACxDkU,OAA8B,iBAAflU,EAA0B,KAAOA,KAC7CkkC,MAEDC,EAEHvuB,MAAO,SAAUpkC,EAAG0O,EAAGqR,EAAGC,GAMzB,OAJK10B,KAAKk3C,OAAOE,SAChBp3C,KAAKk3C,OAAOE,OAAS,IAEtBp3C,KAAKk3C,OAAOE,OAAOv0C,KAAK,CAAC6R,EAAG0O,EAAGqR,EAAGC,IAC3B10B,QAWVsnE,UAAW,SAAUC,EAAIL,EAAMpwC,EAAYC,EAAamM,EAAU,KAAMkkC,EAAc,KAAMC,EAAW,MAItG,OAFArnE,KAAK+mE,oBAAoBQ,GAElBX,yCAAEW,GAAM,CAAEloE,KAAM,QAASm3C,QAAS,uBAAwBplB,IAAK81C,EACrEhwB,OAAQ,CACPpgB,WAAYA,EAAYC,YAAaA,EAAamM,UAAWA,KAAckkC,GAG5EhvB,KAAM,CACLlwC,IAAK,KAAM84B,IAAK,GAAIyW,IAAK,GAAK+vB,MAAO,OAGnCH,EAEHrmC,IAAK,SAAS/hC,GAEb,OADAe,KAAKo4C,KAAKpX,IAAM/hC,EACTe,MAGRy3C,IAAK,SAASj5C,EAAIo6C,EAAM/4B,EAAOmhB,EAAI,MAOlC,OALAhhC,KAAKo4C,KAAKX,IAAIj5C,GAAM,CAAEo6C,KAAMA,EAAM/4B,MAAOA,GAE7B,OAARmhB,IACHhhC,KAAKo4C,KAAKX,IAAIj5C,GAAIwiC,IAAMA,GAElBhhC,MAGRwnE,MAAO,SAASC,EAAQC,EAAQ7nD,GAM/B,OAJM4nD,KAAUznE,KAAKo4C,KAAKovB,QACzBxnE,KAAKo4C,KAAKovB,MAAMC,GAAU,IAE3BznE,KAAKo4C,KAAKovB,MAAMC,GAAQC,GAAU7nD,EAC3B7f,MAGRkI,IAAK,SAASjJ,GAEb,OADAe,KAAKo4C,KAAKlwC,IAAMjJ,EACTe,QAWV2nE,WAAY,SAAUnpE,EAAI0oE,EAAMjtB,EAAWE,EAAYO,EAASktB,EAAM,KAAMC,EAAM,MAIjF,OAFA7nE,KAAK+mE,oBAAoBvoE,GAElBooE,yCAAEpoE,GAAM,CAAEa,KAAM,QAASm3C,QAAS,aAAcplB,IAAK81C,EAC3D3rC,KAAM,CACL0e,UAAWA,EAAWE,WAAYA,EAAYO,QAASA,KAAYktB,MAEjEC,IAUL1qB,KAAM,SAAU3+C,EAAI0oE,EAAMx1C,EAAK,MAI9B,OAFA1xB,KAAK+mE,oBAAoBvoE,GAElBooE,yCAAEpoE,GAAM,CAAEa,KAAM,OAAQ+xB,IAAK81C,KAASx1C,IAS9CrqB,KAAM,SAAU7I,EAAI0oE,EAAMx1C,EAAK,MAI9B,OAFA1xB,KAAK+mE,oBAAoBvoE,GAElBooE,yCAAEpoE,GAAM,CAAEa,KAAM,OAAQ+xB,IAAK81C,KAASx1C,IAS9CttB,KAAM,SAAU5F,EAAI0oE,EAAMx1C,EAAK,MAI9B,OAFA1xB,KAAK+mE,oBAAoBvoE,GAElBooE,yCAAEpoE,GAAM,CAAEa,KAAM,OAAQ+xB,IAAK81C,KAASx1C,IAS9Co2C,IAAK,SAAUtpE,EAAI0oE,EAAMx1C,EAAK,MAI7B,OAFA1xB,KAAK+mE,oBAAoBvoE,GAElBooE,yCAAEpoE,GAAM,CAAEa,KAAM,QAASm3C,QAAS,QAASplB,IAAK81C,EAAM3qB,MAAO,SAAU7qB,IAW/Eq2C,KAAM,SAAUvpE,EAAI0oE,EAAMj2D,EAAOc,EAAK,cAGrC,OADA/R,KAAK+mE,oBAAoBvoE,GAClBooE,yCAAEpoE,GAAM,CAAEa,KAAM,SAAUm3C,QAAS,aAAcplB,IAAK81C,EAAMj2D,MAAOA,EAAOsrC,MAAO,MAAOxqC,KAAMA,IAStGi2D,MAAO,SAAUxpE,EAAI0oE,GAIpB,OAFAlnE,KAAK+mE,oBAAoBvoE,GAElBooE,yCAAEpoE,GAAM,CAAEa,KAAM,QAASm3C,QAAS,QAASplB,IAAK81C,EAAM3qB,MAAO,W,IAItE0rB,yCAAepB,0BChVfhvD,OAAAxZ,cAAA;;;;AAcA,MAAM6pE,8BAAUrwD,OAAAK,MAAM3R,OACrB,CAKA4hE,OAAQ,KAMRhqC,QAAS,KAKTk2B,MAAO,KAKPxwD,UAAW,KAKXukE,UAAU,EAMVvoD,MAAO,KAMPnb,OAAQ,SAAS2vD,EAAOgS,GAEvBrmE,KAAKmoE,OAAS,GACdnoE,KAAKm+B,QAAU,GAEfn+B,KAAKq0D,MAAQA,EACbr0D,KAAKqoE,MAAQhU,EAAM6G,aAAamL,GAEhCrmE,KAAK6f,MAAQo6C,yCAAMj6C,KAAKX,SAOzBipD,SAAU,SAAU9pE,EAAIkW,EAAG0O,EAAGmlD,EAAeC,EAAepG,EAAU,GAEpD,GAAbA,IACHA,EAAYmG,EAAct6C,MAAQu6C,EAAcv6C,OAEjD,IAAIw6C,EAAQ,IAAIvH,yCAAOlhE,KAAKqoE,MAAO3zD,EAAG0O,EAAGg/C,EAAWmG,EAAeC,GAMnE,OAJAxoE,KAAKmoE,OAAO3pE,GAAMiqE,EAClBzoE,KAAKxB,GAAMiqE,EAEXzoE,KAAK6f,MAAM85C,SAAS8O,GACbA,GAORC,UAAW,SAAUlqE,EAAIkW,EAAG0O,EAAGulD,EAAkB,KAAMC,EAAgB,MAEtE,IAAIpjC,EAAS,IAAIo6B,yCAAQ5/D,KAAKqoE,MAAO3zD,EAAG0O,EAAGulD,EAAmBC,GAM9D,OAJA5oE,KAAKm+B,QAAQ3/B,GAAMgnC,EACnBxlC,KAAKxB,GAAMgnC,EAEXxlC,KAAK6f,MAAM85C,SAASn0B,GACbA,GAWRysB,QAAS,SAAUhzD,EAAM,MAExB,GAAc,OAAVA,EACH,OAAOe,KAAKooE,SAEbpoE,KAAKooE,SAAWnpE,EAEhB,IAAK,IAAIoB,KAAKL,KAAKmoE,OAClBnoE,KAAKmoE,OAAO9nE,GAAG4xD,QAAQhzD,GAExB,IAAK,IAAIkE,KAAKnD,KAAKm+B,QAClBn+B,KAAKm+B,QAAQh7B,GAAG8uD,QAAQhzD,GAEzB,OAAOe,MAORimE,UAAW,SAAUhnE,GAEpB,IAAK,IAAIoB,KAAKL,KAAKmoE,OAClBnoE,KAAKmoE,OAAO9nE,GAAG4/D,OAAOhO,QAAQhzD,GAAO,GAEtC,IAAK,IAAIwS,KAAKzR,KAAKm+B,QAClBn+B,KAAKm+B,QAAQ1sB,GAAGwuD,OAAOhO,QAAQhzD,GAAO,GAEvC,OAAOe,Q;AAMT6oE,yCAAeX;;;cCnHf;MAAMY,4BACN,CAICC,UAAW,GAMXC,cAAe,KAMfC,WAAY,KAMZC,UAAW,KAKXC,OACA,CAICC,SAAU,KAKVC,SAAU,KAKVC,SAAU,KAKVthC,QAAS,KAKTuhC,QAAS,SAAU3mE,GAAK,GAEvB,OAAa,IAATA,EACI5C,KAAKspE,UAEbtpE,KAAKspE,SAAW1mE,EACT5C,OAMRwpE,OAAQ,SAAUvqE,GAEZA,GAA+C,SAAtCgtD,yCAAOrsB,SAASh9B,KAAKuvB,MAAMg3C,OAEhClqE,GAA+C,SAAtCgtD,yCAAOrsB,SAASh9B,KAAKuvB,MAAMg3C,QAC5Cld,yCAAOrsB,SAASh9B,KAAKuvB,MAAMs3C,eAAe,UAF1Cxd,yCAAOrsB,SAASh9B,KAAKuvB,MAAMg3C,OAAS,QAQtCjhC,QAAS,SAAUjpC,EAAM,MAExB,OAAc,OAAVA,EACIe,KAAKopE,UAETppE,KAAKopE,WAAanqE,IAGtBe,KAAKopE,SAAWnqE,GAEF,IAAVA,GAEmB,OAAlBe,KAAKspE,WACRrd,yCAAOrsB,SAASh9B,KAAKuvB,MAAMg3C,OAAS,QAErChL,yCAAev/D,SAASoB,KAAK69B,kBAI7BouB,yCAAOrsB,SAASh9B,KAAKuvB,MAAMs3C,eAAe,UAC1CtL,yCAAe3d,WAAWxgD,KAAK69B,kBAdxB79B,OAwBTmH,QAAS,SAAU+G,GAGlB,OADAlO,KAAKqpE,SAAWn7D,EACTlO,MAMR69B,eACA,CACCsmB,SAAU,GAEVve,eAAgB,SAAU1H,EAAQ8J,EAAS1F,GAErCwmC,4BAAMK,OAAOC,WAGlBN,4BAAMK,OAAOnhC,QAAUA,EAEO,OAA1B8gC,4BAAMK,OAAOG,UAChBR,4BAAMK,OAAOG,SAAS7W,YAAYzqB,EAAQtzB,EAAGszB,EAAQ5kB,GAExB,OAA1B0lD,4BAAMK,OAAOE,UAChBP,4BAAMK,OAAOE,SAAUnrC,EAAQ8J,OASnCA,QACA,CAICqhC,SAAU,KAKVjiE,QAAS,KAKTe,KAAM,WAEiB,OAAlBnI,KAAKqpE,WAGTrpE,KAAKqpE,SAAW1jB,yCAAQ3lC,KAAKX,QAC7Brf,KAAKoH,QAAU,CAAE82B,OAAQ,KAAM8J,QAAS,KAAM1F,SAAU,MAExD67B,yCAAev/D,SAASoB,QAMzB4lC,eAAgB,SAAU1H,EAAQ8J,EAAS1F,GAE1CtiC,KAAKoH,QAAQ82B,OAASA,EACtBl+B,KAAKoH,QAAQ4gC,QAAUA,EACvBhoC,KAAKoH,QAAQk7B,SAAWA,EAExBtiC,KAAKqpE,SAAShkB,KAAKrlD,KAAKoH,UAOzBmI,IAAK,SAAUrB,EAAU42C,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAKnD,OAHsB,OAAlBhlD,KAAKqpE,UACRrpE,KAAKmI,OAECnI,KAAKqpE,SAAS95D,IAAKvP,KAAK0pE,kBAAmBx7D,EAAU42C,EAAMC,EAAMC,IAQzExkD,OAAQ,SAAU0N,GAEjBy7D,MAAMN,SAAS7oE,OAAQ0N,IAGxBw7D,kBAAmB,SAAUtiE,EAAS8G,EAAU42C,EAAMC,EAAMC,GAE3D,OAAO92C,EAAU9G,EAAQ82B,OAAQ92B,EAAQ4gC,QAAS8c,EAAMC,EAAMC;;AAShE4kB,SACA,CAICP,SAAU,KAKVjiE,QAAS,KAKTe,KAAM,WAEiB,OAAlBnI,KAAKqpE,WAGTrpE,KAAKqpE,SAAW1jB,yCAAQ3lC,KAAKX,QAC7Brf,KAAKoH,QAAU,CAAE82B,OAAQ,KAAMmE,QAAS,KAAMwnC,UAAW,MAEzDjM,yCAAgBh/D,SAASoB,QAM1B0kC,gBAAiB,SAAUxG,EAAQmE,EAASwnC,GAE3C7pE,KAAKoH,QAAQ82B,OAASA,EACtBl+B,KAAKoH,QAAQi7B,QAAUA,EACvBriC,KAAKoH,QAAQyiE,UAAYA,EAEzB7pE,KAAKqpE,SAAShkB,KAAKrlD,KAAKoH,UAOzBmI,IAAK,SAAUrB,EAAU42C,EAAK,KAAMC,EAAK,KAAMC,EAAK,MAKnD,OAHsB,OAAlBhlD,KAAKqpE,UACRrpE,KAAKmI,OAECnI,KAAKqpE,SAAS95D,IAAKvP,KAAK0pE,kBAAmBx7D,EAAU42C,EAAMC,EAAMC,IAQzExkD,OAAQ,SAAU0N,GAEjBlO,KAAKqpE,SAAS7oE,OAAQ0N,IAGvBw7D,kBAAmB,SAAUtiE,EAAS8G,EAAU42C,EAAMC,EAAMC,GAE3D,OAAO92C,EAAU9G,EAAQ82B,OAAQ92B,EAAQi7B,QAASj7B,EAAQyiE,UAAW/kB,EAAMC,EAAMC;;AASnF8kB,cAAe,SAAUr9D,EAAOs9D,EAAW,MAU1C,OARAA,EAA4B,OAAfA,EAAsBA,EAAarD,yCAAM9B,eAEtD8B,yCAAMd,YAAYc,yCAAM9C,WACxB8C,yCAAMV,gBAAgB+D,GAEtB/pE,KAAK+oE,UAAUt8D,GAAS,IAAIo8D,yCAASnC,yCAAMzB,YAAa8E,GACxD/pE,KAAKgqE,cAAcv9D,GAEZzM,KAAKgpE,eAObiB,WAAY,SAAUx9D,GAErB,OAAIA,EAAQ,GAAKA,GAASzM,KAAK+oE,UAAUzoE,OACjC,KAEDN,KAAK+oE,UAAUt8D,IAAU,MAOjCu9D,cAAe,SAAUv9D,GAGxB,OADAzM,KAAKgpE,cAAgBhpE,KAAKiqE,WAAWx9D,IAC9B,GAORy9D,aAAc,SAAUz9D,EAAOxN,GAE9B,GAAc,OAAVwN,EAaJzM,KAAK+oE,UAAUt8D,GAAOkT,MAAM1gB,QAX3B,IAAK,IAAIoB,EAAI,EAAGA,EAAIL,KAAK+oE,UAAUzoE,OAAQD,IAErCL,KAAK+oE,UAAU1oE,IAGpBL,KAAKkqE,aAAa7pE,EAAGpB,IAaxBwpE,MAAO,SAAUjqE,EAAIkW,EAAG0O,EAAGmlD,EAAeC,EAAepG,EAAU,GAElE,GAA2B,OAAvBpiE,KAAKgpE,cACR,MAAM,IAAItqE,MAAO,+EAElB,OAAOsB,KAAKkpE,UAAYlpE,KAAKgpE,cAAcV,SAAU9pE,EAAIkW,EAAG0O,EAAGmlD,EAAeC,EAAepG,IAO9F58B,OAAQ,SAAUhnC,EAAIkW,EAAG0O,EAAGulD,EAAkB,KAAMC,EAAgB,MAEnE,GAA2B,OAAvB5oE,KAAKgpE,cACR,MAAM,IAAItqE,MAAO,gFAElB,OAAOsB,KAAKipE,WAAajpE,KAAKgpE,cAAcN,UAAWlqE,EAAIkW,EAAG0O,EAAGulD,EAAmBC,K;AAMtFuB,yCAAerB,4BC5Xf,MAAMsB,sCAAkB,WAQlBC,+BACN,CAKCC,aAAcvX,yCAAYF,YAK1B0X,aAAc,GAKdC,gBAAiB,GAKjBnW,MAAO,KAKPoW,UAAW,KAMX9P,SAAU,KAMVG,SAAU,KAOV4P,SAAU,EACV9W,WAAY,EAMZ5iD,MACA,CAKC25D,QAASxhB,yCAAQnpC,KAAKX,QAMtBqhB,MAAO,EAMP9c,GAAI,EAMJC,GAAI,EAEJ8wB,OAAQwU,yCAAQnpC,KAAKX,QAErB3K,EAAG,IAAIjS,MAAM,IAAI6b,KAAK,GACtB8E,EAAG,IAAI3gB,MAAM,IAAI6b,KAAK,GACtBssD,IAAK,IAAInoE,MAAM,IAAI6b,KAAK,GACxBusD,IAAK,IAAIpoE,MAAM,IAAI6b,KAAK,GACxBwsD,IAAK,IAAIroE,MAAM,IAAI6b,KAAK,GACxBysD,IAAK,IAAItoE,MAAM,IAAI6b,KAAK,GACxB0sD,IAAK,IAAIvoE,MAAM,IAAI6b,KAAK,GACxB2sD,IAAK,IAAIxoE,MAAM,IAAI6b,KAAK,GAExBrN,MAAO,EACPqU,OAAQ,EAER0G,GAAI,EAAGk/C,GAAI,EAAGC,OAAQ,EACtB9+C,GAAI,EAAG++C,GAAI,EAAGC,OAAQ,EAEtBC,GAAI,EACJC,KAAM,EACNC,KAAM,GAUPxzC,OAAQ,SAAUyzC,EAAW,KAAM1B,EAAW,MAE7C/pE,KAAKq0D,MAAQqS,yCAAMb,SAAS4F,GAAc/E,yCAAM/C,YAChD3jE,KAAKyqE,UAAYzqE,KAAKq0D,MAAM6G,aAAa6O,GAAcrD,yCAAMlC,YAE7DxkE,KAAK0qE,SAAW3X,yCAAY/B,MAAQ+B,yCAAY9B,QAAUoZ,+BAASC,aACnEtqE,KAAK4zD,WAAab,yCAAY/B,MAAQ+B,yCAAY9B,QAElDjxD,KAAKq0D,MAAMsG,SAASprD,IAAIvP,KAAK0rE,YAAa1rE,MAC1CA,KAAKq0D,MAAMyG,SAASvrD,IAAIvP,KAAK2uC,WAAY3uC,MAEzCA,KAAK26D,SAAWhV,yCAAQ3lC,KAAKX,MAAMrf,MACnCA,KAAK86D,SAAWnV,yCAAQ3lC,KAAKX,MAAMrf,OAOpCq4B,QAAS,WAERr4B,KAAKq0D,MAAMsG,SAASn6D,OAAOR,KAAKoI,OAAQpI,MACxCA,KAAKyqE,UAAY,KAEjBzqE,KAAK26D,SAASr7C,OACdtf,KAAK86D,SAASx7C,QAMfosD,YAAa,SAASrX,EAAOr2D,GAE5BA,EAAK28D,SAAStV,QAMf1W,WAAY,SAAS0lB,EAAOr2D,GAE3BA,EAAK88D,SAASzV,QAOfsmB,MACA,CAKCzc,IAAK,SAAUtsD,EAAMsL,EAAU62C,EAAMC,EAAMC,GAE1ColB,+BAAS1P,SAASprD,IAAIvP,KAAK4rE,KAAMhpE,EAAMsL,EAAU62C,EAAMC,EAAMC,IAO9D4mB,WAAY,SAAUjpE,EAAM3D,GAE3BorE,+BAAS1P,SAASprD,IAAIvP,KAAK8rE,YAAalpE,EAAM3D,IAO/C+uD,SAAU,SAAU9uD,EAAKM,EAAMP,GAE9BorE,+BAAS1P,SAASprD,IAAIvP,KAAK+rE,UAAW7sE,EAAKM,EAAMP,IAOlDqyD,SAAU,SAAU1uD,EAAM3D,GAEzBorE,+BAAS1P,SAASprD,IAAIvP,KAAKgsE,UAAWppE,EAAM3D,IAO7CsyD,WAAY,SAAU3uD,EAAM3D,GAE3BorE,+BAAS1P,SAASprD,IAAIvP,KAAKisE,YAAarpE,EAAM3D,IAK/C2sE,KAAM,SAAUtmB,EAAM1iD,EAAMsL,EAAU62C,EAAMC,EAAMC,GAGjD,OADA/2C,EAAUo3C,EAAM1iD,EAAMmiD,EAAMC,EAAMC,IAC3B,GAGR6mB,YAAa,SAAUxmB,EAAM1iD,EAAM3D,GAGlC,OADA2D,EAAKqvD,QAAQhzD,IACN,GAGR8sE,UAAW,SAAUzmB,EAAMpmD,EAAKM,EAAMP,GAGrC,OADAC,EAAIM,GAAQP,GACL,GAGR+sE,UAAW,SAAU1mB,EAAM1iD,EAAM3D,GAGhC,OADA2D,EAAK0uD,SAASryD,IACP,GAGRgtE,YAAa,SAAU3mB,EAAM1iD,EAAM3D,GAGlC,OADA2D,EAAK2uD,WAAWtyD,IACT;;AAaT0rE,QAAS,SAAUuB,EAAaC,EAAej+D,EAAU9G,EAAQ,MAMhE,OAJM8kE,KAAelsE,KAAKuqE,eACzBvqE,KAAKuqE,aAAa2B,GAAe,IAElClsE,KAAKuqE,aAAa2B,GAAaC,GAAiB,CAAEj+D,SAAUA,EAAU9G,QAASA,GACxEpH,MAkBRosE,SAAU,SAAUF,EAAaC,EAAej+D,EAAS,KAAM9G,EAAQ,MAMtE,OAJM8kE,KAAelsE,KAAKwqE,kBACzBxqE,KAAKwqE,gBAAgB0B,GAAe,IAErClsE,KAAKwqE,gBAAgB0B,GAAaC,GAAiB,CAAEj+D,SAAUA,EAAU9G,QAASA,GAC3EpH,MAORqsE,gBAAiB,SAAUC,EAASC,GAEnCvsE,KAAKgR,MAAM25D,QAAQhtE,IAAI2uE,GAAShmB,kBAAkBimB,GAClD,IAAI5B,EAAU3qE,KAAKgR,MAAM25D,QA6BzB,OA3BA3qE,KAAKgR,MAAM0vB,MAAQ,EACnB1gC,KAAKgR,MAAMw7D,SAAW,EAElB7B,EAAQ/0C,IAAM22C,EAAQ32C,KAEzB51B,KAAKgR,MAAM0vB,OAAS2pC,+BAASoC,QAAQ/yD,KACrC1Z,KAAKgR,MAAMw7D,YAGR7B,EAAQ70C,IAAMy2C,EAAQz2C,KAEzB91B,KAAKgR,MAAM0vB,OAAS2pC,+BAASoC,QAAQ7yD,MACrC5Z,KAAKgR,MAAMw7D,YAGR7B,EAAQ90C,IAAM02C,EAAQ12C,KAEzB71B,KAAKgR,MAAM0vB,OAAS2pC,+BAASoC,QAAQC,IACrC1sE,KAAKgR,MAAMw7D,YAGR7B,EAAQ50C,IAAMw2C,EAAQx2C,KAEzB/1B,KAAKgR,MAAM0vB,OAAS2pC,+BAASoC,QAAQE,OACrC3sE,KAAKgR,MAAMw7D,YAGLxsE,KAAKgR,MAAM0vB,OAGnBksC,KAAM,SAAUC,EAAQ9nD,EAAMnV,EAAGk9D,EAAKC,EAAKC,GAE1C,IAAIzvE,EAAIyC,KAAKgR,MAAMC,MACf+yB,EAAQ,KACRh2B,EAAI,EAER,GAAI+W,EAAO,EAEV,IAAK,IAAI1kB,EAAI,EAAGA,EAAI9C,EAAG8C,KAEjBysE,EAAIzsE,KAAO0sE,EAAI1sE,IAAMuP,EAAEvP,GAAK,KAEnB,OAAV2jC,GAAkBp0B,EAAEvP,GAAK2jC,KAC5BA,EAAQp0B,EAAEvP,IAEX0sE,EAAI1sE,GAAK2sE,EAAI3sE,GAAK,EAClB2N,GAAK8+D,EAAIzsE,SAKV,IAAK,IAAI8C,EAAI,EAAGA,EAAI5F,EAAG4F,KAEjB2pE,EAAI3pE,KAAO4pE,EAAI5pE,IAAMyM,EAAEzM,GAAK,KAEnB,OAAV6gC,GAAkBp0B,EAAEzM,GAAK6gC,KAC5BA,EAAQp0B,EAAEzM,IAEX4pE,EAAI5pE,GAAK6pE,EAAI7pE,GAAK,EAClB6K,GAAK8+D,EAAI3pE,IAIG,OAAV6gC,IACHA,EAAQ,GAEL6oC,GACH7sE,KAAKgR,MAAMgb,GAAKhe,EAChBhO,KAAKgR,MAAMk6D,GAAKz9D,KAAKoG,IAAImwB,GACzBhkC,KAAKgR,MAAMm6D,OAASnnC,IAEpBhkC,KAAKgR,MAAMqb,GAAKre,EAChBhO,KAAKgR,MAAMo6D,GAAK39D,KAAKoG,IAAImwB,GACzBhkC,KAAKgR,MAAMq6D,OAASrnC,IAItBipC,cAAe,SAAUC,GAEpBltE,KAAKgR,MAAMqb,GAAKrsB,KAAKgR,MAAMgb,KAAOhsB,KAAKgR,MAAMsU,SAE1B,OAAlBtlB,KAAKgR,MAAMs6D,IAAetrE,KAAKgR,MAAMo6D,GAAKprE,KAAKgR,MAAMk6D,GAAKlrE,KAAKgR,MAAMs6D,MAExEtrE,KAAKgR,MAAMs6D,GAAKtrE,KAAKgR,MAAMo6D,GAAKprE,KAAKgR,MAAMk6D,GAEtCgC,GAKJltE,KAAKgR,MAAMu6D,KAAOvrE,KAAKgR,MAAMm6D,OAC7BnrE,KAAKgR,MAAMw6D,KAAOxrE,KAAKgR,MAAMq6D,SAL7BrrE,KAAKgR,MAAMu6D,KAAOvrE,KAAKgR,MAAMq6D,OAC7BrrE,KAAKgR,MAAMw6D,KAAOxrE,KAAKgR,MAAMm6D,UAUjCgC,MAAO,WAEN,IAAI5vE,EAAIyC,KAAKgR,MAAMC,MAEnB,IAAK,IAAI5Q,EAAI,EAAGA,EAAI9C,EAAG8C,IAEtBL,KAAKgR,MAAM85D,IAAIzqE,GAAKL,KAAKgR,MAAM45D,IAAIvqE,GACnCL,KAAKgR,MAAM+5D,IAAI1qE,GAAKL,KAAKgR,MAAM65D,IAAIxqE,IAIrC+sE,MAAO,WAEN,IAAI7vE,EAAIyC,KAAKgR,MAAMC,MAEnB,IAAK,IAAI5Q,EAAI,EAAGA,EAAI9C,EAAG8C,IAEtBL,KAAKgR,MAAMg6D,IAAI3qE,GAAKL,KAAKgR,MAAM85D,IAAIzqE,GACnCL,KAAKgR,MAAMi6D,IAAI5qE,GAAKL,KAAKgR,MAAM+5D,IAAI1qE,IAIrCgtE,MAAO,WAEN,IAAI9vE,EAAIyC,KAAKgR,MAAMC,MAEnB,IAAK,IAAI5Q,EAAI,EAAGA,EAAI9C,EAAG8C,IAEtBL,KAAKgR,MAAM85D,IAAIzqE,GAAKL,KAAKgR,MAAMg6D,IAAI3qE,GACnCL,KAAKgR,MAAM+5D,IAAI1qE,GAAKL,KAAKgR,MAAMi6D,IAAI5qE,IAIrCitE,YAAa,SAAUC,GAAO,GAG7B,GADAvtE,KAAK4sE,KAAMW,EAAQ,EAAGvtE,KAAKgR,MAAM0D,EAAG1U,KAAKgR,MAAM45D,IAAK5qE,KAAKgR,MAAM85D,IAAK9qE,KAAKgR,MAAM+5D,KAC3EwC,EAAQ,OAAO,EAEnBvtE,KAAKotE,QACDptE,KAAKwtE,aAAY,IAAOxtE,KAAKitE,eAAc,GAE/CjtE,KAAKqtE,QACDrtE,KAAKytE,aAAY,IAAOztE,KAAKitE,eAAc,GAE/CjtE,KAAKmtE,SAGNO,YAAa,SAAUH,GAAO,GAG7B,GADAvtE,KAAK4sE,KAAMW,GAAQ,EAAIvtE,KAAKgR,MAAM0D,EAAG1U,KAAKgR,MAAM45D,IAAK5qE,KAAKgR,MAAM85D,IAAK9qE,KAAKgR,MAAM+5D,KAC5EwC,EAAQ,OAAO,EAEnBvtE,KAAKotE,QACDptE,KAAKwtE,aAAY,IAAOxtE,KAAKitE,eAAc,GAE/CjtE,KAAKqtE,QACDrtE,KAAKytE,aAAY,IAAOztE,KAAKitE,eAAc,GAE/CjtE,KAAKmtE,SAGNK,YAAa,SAAUD,GAAO,GAG7B,GADAvtE,KAAK4sE,KAAMW,EAAQ,EAAGvtE,KAAKgR,MAAMoS,EAAGpjB,KAAKgR,MAAM65D,IAAK7qE,KAAKgR,MAAM+5D,IAAK/qE,KAAKgR,MAAM85D,KAC3EyC,EAAQ,OAAO,EAEnBvtE,KAAKotE,QACDptE,KAAKstE,aAAY,IAAOttE,KAAKitE,eAAc,GAE/CjtE,KAAKqtE,QACDrtE,KAAK0tE,aAAY,IAAO1tE,KAAKitE,eAAc,GAE/CjtE,KAAKmtE,SAGNM,YAAa,SAAUF,GAAO,GAG7B,GADAvtE,KAAK4sE,KAAMW,GAAQ,EAAIvtE,KAAKgR,MAAMoS,EAAGpjB,KAAKgR,MAAM65D,IAAK7qE,KAAKgR,MAAM+5D,IAAK/qE,KAAKgR,MAAM85D,KAC5EyC,EAAQ,OAAO,EAEnBvtE,KAAKotE,QACDptE,KAAKstE,aAAY,IAAOttE,KAAKitE,eAAc,GAE/CjtE,KAAKqtE,QACDrtE,KAAK0tE,aAAY,IAAO1tE,KAAKitE,eAAc,GAE/CjtE,KAAKmtE,SAMNQ,OAAQ,WAEF3tE,KAAKgR,MAAM6O,MAAMuxC,UAGtBpxD,KAAKgR,MAAM6O,MAAM8D,UAAW3jB,KAAKgR,MAAM4S,GAAI5jB,KAAKgR,MAAM6S,IACtD7jB,KAAKgR,MAAM6O,MAAM0xC,WAAY8Y,+BAASC,gBAkBvC3mD,UAAW,SAAU4iD,EAAM1mD,EAAM,KAAM+D,EAAG,EAAGC,EAAG,GAS/C,GAPsB,iBAAXhE,IAEVgE,EAAKD,EACLA,EAAK/D,EACLA,EAAQ,OAGJ0mD,EAAM,OAIX,GAFK1mD,IAAOA,EAAQ0mD,EAAK1mD,QAEpBA,EAAMuxC,UAAYmV,EAAKnV,QAC3B,OAQD,GANApxD,KAAKgR,MAAMu1D,KAAOA,EAClBvmE,KAAKgR,MAAM6O,MAAQA,EAEnB7f,KAAKgR,MAAM4S,GAAK0pB,WAAWF,QAAQxpB,IACnC5jB,KAAKgR,MAAM6S,GAAKypB,WAAWF,QAAQvpB,KAE9B7jB,KAAKyqE,YAAclE,EAAKtU,UAC5B,OAAOjyD,KAAK2tE,SAEb,IAAInD,EAAkBxqE,KAAKwqE,gBAAgBjE,EAAKlnE,MAChD,IAAKmrE,IAEJA,EAAkBxqE,KAAKwqE,gBAAgBjE,EAAKlnE,KAAO+qE,wCAC9CI,GAGJ,OADAxqE,KAAK2tE,SACE3tE,KAAK4tE,KAAKrH,EAAM1mD,GAIzB7f,KAAKgR,MAAM68D,KAAOhuD,EAAMm6C,WAAWh6D,KAAKgR,MAAM4S,GAAI5jB,KAAKgR,MAAM6S,IAC7D7jB,KAAKgR,MAAM2jC,OAAOh3C,IAAI4oE,EAAK5xB,QAAQhxB,UAAU3jB,KAAKgR,MAAM68D,KAAKn5D,EAAE1U,KAAKgR,MAAM4S,GAAI5jB,KAAKgR,MAAM68D,KAAKzqD,EAAEpjB,KAAKgR,MAAM6S,IAE3GhE,EAAMyxC,SAAU+Y,+BAASC,cAEzB,IAAIwD,EAAiB9tE,KAAKyqE,UAAU1W,eAAe/zD,KAAKgR,MAAM2jC,OAAQ30C,KAAK0qE,SAAU1qE,KAAK4zD,YAC1F,GAA8B,IAA1Bka,EAAextE,OAGlB,OADAwtE,EAAexuD,OACRtf,KAAK2tE,SAGb,IAAIpwE,EAAI,EACJyQ,EAAI,EAER,OACA,CACC,IAAIlC,EAAOgiE,EAAe9gE,QAC1B,GAAa,OAATlB,EAAe,MAEnB,IAAIiiE,EAAmBvD,EAAgB1+D,EAAKzM,MAC5C,IAAK0uE,IAEJA,EAAmBvD,EAAgB1+D,EAAKzM,KAAO+qE,wCAC1C2D,GAAkB,SAGxB,IAAkC,IAA9BA,EAAiB7/D,UAAqD,OAA9B6/D,EAAiB7/D,WAAmD,IAA9B6/D,EAAiB7/D,WAAsB6/D,EAAiB7/D,SAASq4D,EAAMz6D,EAAMiiE,EAAiB3mE,SAC/K,SAED,IAAI6mB,EAAQxgB,KAAK0R,IAAInf,KAAKgR,MAAM2jC,OAAO7e,GAAIhqB,EAAK6oC,OAAO7e,IAAMroB,KAAKg/B,IAAIzsC,KAAKgR,MAAM2jC,OAAO/e,GAAI9pB,EAAK6oC,OAAO/e,IACpG1H,EAASzgB,KAAK0R,IAAInf,KAAKgR,MAAM2jC,OAAO5e,GAAIjqB,EAAK6oC,OAAO5e,IAAMtoB,KAAKg/B,IAAIzsC,KAAKgR,MAAM2jC,OAAO9e,GAAI/pB,EAAK6oC,OAAO9e,IAEzG71B,KAAKgR,MAAM45D,IAAIrtE,GAAK,EACpByC,KAAKgR,MAAM65D,IAAIttE,GAAK,EAEhBkQ,KAAK0R,IAAInf,KAAKgR,MAAM2jC,OAAO1mB,QAASniB,EAAK6oC,OAAO1mB,UAAYA,IAC/DjuB,KAAKgR,MAAM0D,EAAEnX,GAAKiwC,OAAOxtC,KAAKgR,MAAM2jC,OAAO7e,GAAKhqB,EAAK6oC,OAAO/e,GAAI51B,KAAKgR,MAAM2jC,OAAO/e,GAAK9pB,EAAK6oC,OAAO7e,IACnG91B,KAAKgR,MAAM45D,IAAIrtE,GAAK,GAGjBkQ,KAAK0R,IAAInf,KAAKgR,MAAM2jC,OAAOzmB,SAAUpiB,EAAK6oC,OAAOzmB,WAAaA,IACjEluB,KAAKgR,MAAMoS,EAAE7lB,GAAKiwC,OAAOxtC,KAAKgR,MAAM2jC,OAAO5e,GAAKjqB,EAAK6oC,OAAO9e,GAAI71B,KAAKgR,MAAM2jC,OAAO9e,GAAK/pB,EAAK6oC,OAAO5e,IACnG/1B,KAAKgR,MAAM65D,IAAIttE,GAAK,GAGrB,IAAIywE,EAAKhuE,KAAKgR,MAAM45D,IAAIrtE,GAAKyC,KAAKgR,MAAM65D,IAAIttE,GAC5CyQ,GAAKggE,EAEDA,EAAK,IACRhuE,KAAKgR,MAAM45D,IAAIrtE,GAAKywE,EACpBhuE,KAAKgR,MAAM65D,IAAIttE,GAAKywE,GAGrBhuE,KAAKgR,MAAM85D,IAAIvtE,GAAKyC,KAAKgR,MAAM45D,IAAIrtE,GACnCyC,KAAKgR,MAAM+5D,IAAIxtE,GAAKyC,KAAKgR,MAAM65D,IAAIttE,GAEnCA,IAKD,GAFAuwE,EAAexuD,OAEN,GAALtR,EAGH,OADAhO,KAAK2tE,SACE3tE,KAAK4tE,KAAKrH,EAAM1mD,GAYxB,GATA7f,KAAKgR,MAAMsU,OAAStX,EACpBhO,KAAKgR,MAAMC,MAAQ1T,EACnByC,KAAKgR,MAAMs6D,GAAK,KAEhBtrE,KAAKstE,cACLttE,KAAK0tE,cACL1tE,KAAKwtE,cACLxtE,KAAKytE,cAEiB,OAAlBztE,KAAKgR,MAAMs6D,GACf,CACC,IAAIf,EAAevqE,KAAKuqE,aAAahE,EAAKlnE,MAG1C,GAFKkrE,IAAcA,EAAevqE,KAAKuqE,aAAahE,EAAKlnE,KAAO+qE,wCAE5DG,EACJ,CAKC,IAJAvqE,KAAKgR,MAAM2jC,OAAOh3C,IAAI4oE,EAAK5xB,QAAQhxB,UAAU3jB,KAAKgR,MAAM68D,KAAKn5D,EAAE1U,KAAKgR,MAAM4S,GAAmB,GAAhB5jB,KAAKgR,MAAMu6D,KAAUvrE,KAAKgR,MAAM68D,KAAKzqD,EAAEpjB,KAAKgR,MAAM6S,GAAmB,GAAhB7jB,KAAKgR,MAAMw6D,MAE7IsC,EAAiB9tE,KAAKyqE,UAAU1W,eAAe/zD,KAAKgR,MAAM2jC,OAAQ30C,KAAK0qE,SAAU1qE,KAAK4zD,YAE/E2S,EAAKnV,SACZ,CACC,IAAItlD,EAAOgiE,EAAe9gE,QAC1B,GAAa,OAATlB,EAAe,MAEnB,IAAKA,EAAKslD,QACT,SAED,IAAIuZ,EAAUJ,EAAaz+D,EAAKzM,OAC3BsrE,IAEJA,EAAUJ,EAAaz+D,EAAKzM,KAAO+qE,uCAC9BO,KAGNA,EAAQz8D,SAAUq4D,EAAMz6D,EAAM6+D,EAAQvjE,SAGvC0mE,EAAexuD,OAGhBtf,KAAKgR,MAAM4S,IAAM5jB,KAAKgR,MAAMu6D,KAC5BvrE,KAAKgR,MAAM6S,IAAM7jB,KAAKgR,MAAMw6D,KAG7BxrE,KAAK2tE,UAcNC,KAAM,SAAUrH,EAAM1mD,EAAM,MAI3B,GAFKA,IAAOA,EAAQ0mD,EAAK1mD,QAEpBA,IAAUA,EAAMuxC,UAAYmV,EAAKnV,QACrC,OAKD,GAHApxD,KAAKgR,MAAMu1D,KAAOA,EAClBvmE,KAAKgR,MAAM6O,MAAQA,GAEd7f,KAAKyqE,YAAclE,EAAKtU,UAC5B,OAED,IAAIsY,EAAevqE,KAAKuqE,aAAahE,EAAKlnE,MAE1C,GADKkrE,IAAcA,EAAevqE,KAAKuqE,aAAahE,EAAKlnE,KAAO+qE,yCAC3DG,EAAc,OAEnB1qD,EAAMyxC,SAAU+Y,+BAASC,cACzB,IAAIwD,EAAiB9tE,KAAKyqE,UAAU1W,eAAewS,EAAK5xB,OAAQ30C,KAAK0qE,SAAU1qE,KAAK4zD,YAGpF,IAFA/zC,EAAM0xC,WAAY8Y,+BAASC,cAEpB/D,EAAKnV,SACZ,CACC,IAAItlD,EAAOgiE,EAAe9gE,QAC1B,GAAa,OAATlB,EAAe,MAEnB,IAAKA,EAAKslD,QACT,SAED,IAAIuZ,EAAUJ,EAAaz+D,EAAKzM,OAC3BsrE,IAEJA,EAAUJ,EAAaz+D,EAAKzM,KAAO+qE,uCAC9BO,KAGNA,EAAQz8D,SAAUq4D,EAAMz6D,EAAM6+D,EAAQvjE,SAGvC0mE,EAAexuD;;;;AAajB+qD,QAAmB;;AAElB3wD,KAAM;;AAENE,MAAO;;AAEPq0D,WAAY;;AAEZvB,IAAK;;AAELC,OAAQ;;AAERuB,SAAU;;;;AAMXC,yCAAe9D,+BCxuBR,MAAM+D,0CAAMniB,yCAINoiB,0CAAQ3H,yCAIR4H,0CAAI1H,yCAIJ2H,0CAAMtG,yCAINuG,0CAAQrE,yCAIRsE,0CAAWN,yC7EpBXO,0CAAQ72D,OAAAK,MACRy2D,0CAAS92D,OAAA+2D,OACTC,0CAAWh3D,OAAAi3D,SAMiCC,0CAAUr8C,yCAGlBs8C,0CAAM1mD,yCAGJ2mD,0CAAOrmD,yCAGHsmD,0CAASvvC,yCAGXwvC,yCAAQjsD,yCAGNksD,0CAASz2D,yCAGP02D,0CAAUz2D,yCAGZ02D,0CAAS1+C,yCAGb2+C,yCAAOzgC,yCAGT0gC,0CAAM78C,yCAGA88C,0CAAS5lD,yCAGM6lD,0CAAgB5hD,yCAGrB6hD,0CAAc/7B,yCAGtBg8B,0CAAU7hD,yCAOA8hD,0CAAWlzB,0BAGdmzB,0CAAYlwB,yCACpBmwB,0CAAQ7sB,yCAON8sB,0CAAWhyD,yCAGXiyD,0CAAW3vD,yCAGnB4vD,0CAAO1uD,yCAGY2uD,0CAAgBnsB,yCAG7BosB,0CAAUzqB,yCAOb0qB,0CAAS/pD,yCAGbgqD,0CAAOvpB,yCAGPwpB,yCAAOvrD,yCAGGwrD,0CAAYtoB,yCAGhBuoB,0CAAUtnB,yCAGZunB,0CAASnoB,yCAOTooB,0CAAStmB,yCAGbumB,0CAAOjgB,yCAOPkgB,0CAAO/lB,yCAGQgmB,0CAAc/d,yCAG7Bge,0CAAO7c,yCAGL8c,0CAAQrV,yCAGFsV,yCAAWvY,yCAGbwY,wCAAU5U,yCAGN6U,0CAAYpc,yCAGCqc,0CAAkB7U,yCAGtB8U,0CAAgB5U,yCAGjC6U,0CAAQrX,yCAGFsX,0CAAWj7B,yCAGbk7B,0CAAUnY,yCAGhBoY,yCAAO5U,yCAGL6U,0CAAQ/T,yCAGagU,0CAAkB/T,yCAGpBgU,0CAAiBzT,yCAGjB0T,0CAAiBlS,yCAGlCmS,0CAASlS,yCAGXmS,0CAAQ7Q,yC,IAQ3D8Q,yCAAeC;sBAIf/zE;eAAOg0E,OACP,CACCh6D,MAAOw2D,0CACPE,OAAQD,0CACRG,SAAUD,0CACVsD,QAASpD,0CACTqD,IAAKpD,0CACLqD,KAAMpD,0CACNqD,OAAQpD,0CACRqD,MAAOpD,yCACPqD,OAAQpD,0CACRqD,QAASpD,0CACTqD,OAAQpD,0CACRqD,KAAMpD,yCACNqD,IAAKpD,0CACLqD,OAAQpD,0CACRqD,cAAepD,0CACfqD,YAAapD,0CACbqD,QAASpD,0CACTqD,SAAUpD,0CACVqD,UAAWpD,0CACXlzB,MAAOmzB,0CACPhyD,SAAUiyD,0CACVmD,SAAUlD,0CACVmD,KAAMlD,0CACNmD,cAAelD,0CACf1R,QAAS2R,0CACTkD,OAAQjD,0CACRkD,KAAMjD,0CACNkD,KAAMjD,yCACNkD,UAAWjD,0CACXkD,QAASjD,0CACTkD,OAAQjD,0CACRkD,OAAQjD,0CACRkD,KAAMjD,0CACNkD,KAAMjD,0CACNhY,YAAaiY,0CACbiD,KAAMhD,0CACNiD,MAAOhD,0CACPiD,SAAUhD,yCACViD,QAAShD,wCACT1U,UAAW2U,0CACXgD,gBAAiB/C,0CACjBgD,cAAe/C,0CACf/Q,MAAOgR,0CACPt8B,SAAUu8B,0CACV9X,QAAS+X,0CACT6C,KAAM5C,yCACN6C,MAAO5C,0CACP6C,gBAAiB5C,0CACjB6C,eAAgB5C,0CAChB6C,eAAgB5C,0CAChB6C,OAAQ5C,0CACR6C,MAAO5C,0CAEP6C,IAAK3C","sources":["node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/model-constraints.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/alpha.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/model-regex.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/main.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/class.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/event.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/event-dispatcher.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/model.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/model-list.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/schema.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/flattenable.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/collection.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/template.js","src/_main.js","src/system/random.js","src/system/keycode.js","src/utils/list.js","src/utils/linkable.js","src/utils/recycler.js","src/system/timer.js","src/system/canvas.js","src/math/matrix.js","src/math/vec2.js","src/system/shader-program.js","src/system/shader.js","src/system/glx.js","src/system/glsl.js","src/system/texture.js","src/system/system.js","src/system/log.js","src/system/globals.js","src/system/perf.js","src/system/framebuffer.js","src/flow/drawable.js","src/resources/drawable.js","src/resources/custom.js","src/resources/spritesheet.js","src/resources/spritesheet-animation.js","src/resources/spritefont.js","src/resources/sound.js","src/resources/resources.js","src/resources/sound-array.js","src/resources/wrappers.js","src/utils/priority-queue.js","src/utils/handler.js","src/utils/callback.js","src/math/rect.js","src/math/tfunction.js","src/math/bounds2.js","src/math/point2.js","src/anim/easing.js","src/anim/anim.js","src/flow/boot.js","src/fxl/system.js","src/anim/block.js","src/anim/command.js","src/anim/parallel.js","src/anim/serial.js","src/anim/repeat.js","src/anim/set.js","src/anim/restart.js","src/anim/wait.js","src/anim/range.js","src/anim/rand.js","src/anim/randt.js","src/anim/exec.js","src/anim/play.js","src/flow/grid-element.js","src/flow/grid.js","src/flow/scene.js","src/flow/container.js","src/flow/viewport.js","src/flow/element.js","src/flow/group.js","src/flow/updater.js","src/flow/simple-container.js","src/flow/grid-container.js","src/flow/mask.js","src/flow/label.js","src/flow/keyboard-handler.js","src/flow/pointer-handler.js","src/flow/screen-controls.js","src/flow/button.js","src/flow/stick.js","src/fxl/world.js","src/fxl/r.js","src/fxl/resources.js","src/fxl/gamepad.js","src/fxl/input.js","src/fxl/collider.js","src/fxl/fxl.js"],"sourcesContent":["\nimport Rinn from './alpha.js';\nimport Regex from './model-regex.js';\n\n/**\n**\tMap of model constraint handlers. Each function should accept parameters (in order): the model object (model), the constraint value (ctval),\n**\tthe property name (name), the property value (value) and return the corrected value once verified or throw an exception if errors occur.\n*/\n\nexport default\n{\n\t/**\n\t**\tUtility function (not a handler) to get the real value given a reference string. If the value is not a string, the value itself will\n\t**\tbe returned, if it is a string starting with '#' the model property will be returned, if starts with '@' the object property will be\n\t**\treturned, otherwise the contents of the string will eval'd and returned.\n\t*/\n\t_getref: function (value, obj)\n\t{\n\t\tif (typeof(value) == \"string\")\n\t\t{\n\t\t\tif (value.substr(0, 1) == \"#\")\t\t\tvalue = obj.get(value.substr(1));\n\t\t\telse if (value.substr(0, 1) == \"@\")\t\tvalue = obj[value.substr(1)];\n\n\t\t\tif (typeof(value) == \"string\")\n\t\t\t\treturn eval(value);\n\n\t\t\treturn value;\n\t\t}\n\t\telse\n\t\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the new value is of the valid type before storing it on the property. When possible if the\n\t**\tinput is of compatible type it will be converted to the target type.\n\t*/\n\ttype: function (model, ctval, name, value)\n\t{\n\t\tswitch (ctval)\n\t\t{\n\t\t\tcase \"int\":\n\t\t\t\tvalue = parseInt(value);\n\t\t\t\tif (isNaN(value)) throw new Error (ctval);\n\t\t\t\tbreak;\n\n\t\t\tcase \"float\":\n\t\t\t\tvalue = parseFloat(value);\n\t\t\t\tif (isNaN(value)) throw new Error (ctval);\n\t\t\t\tbreak;\n\n\t\t\tcase \"string\":\n\t\t\t\tvalue = (value === null || value === undefined) ? \"\" : value.toString();\n\t\t\t\tbreak;\n\n\t\t\tcase \"bit\":\n\t\t\t\tif (value === true || value === false) {\n\t\t\t\t\tvalue = value ? 1 : 0;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tvalue = parseInt(value);\n\t\t\t\tif (isNaN(value)) throw new Error (ctval);\n\n\t\t\t\tvalue = value ? 1 : 0;\n\t\t\t\tbreak;\n\n\t\t\tcase \"array\":\n\t\t\t\tif (Rinn.typeOf(value) == \"array\")\n\t\t\t\t\tbreak;\n\n\t\t\t\tif (value === null || value === undefined)\n\t\t\t\t{\n\t\t\t\t\tvalue = [];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tthrow new Error (ctval);\n\t\t\t\tbreak;\n\n\t\t\tcase \"bool\":\n\t\t\t\tif (value === \"true\" || value === true) {\n\t\t\t\t\tvalue = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (value === \"false\" || value === false) {\n\t\t\t\t\tvalue = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tthrow new Error (ctval);\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the field is of the specified model type.\n\t*/\n\tmodel: function (model, ctval, name, value)\n\t{\n\t\tvar mclass = this._getref(ctval, model);\n\t\tif (!mclass) throw new Error (ctval);\n\n\t\tif (!value)\n\t\t\treturn new mclass();\n\n\t\treturn mclass.ensure (value);\n\t},\n\n\n\t/**\n\t**\tVerifies that the field is of the specified class.\n\t*/\n\tcls: function (model, ctval, name, value)\n\t{\n\t\tvar mclass = this._getref(ctval, model);\n\t\tif (!value) return new mclass();\n\n\t\treturn Rinn.ensureTypeOf(mclass, value);\n\t},\n\n\n\t/**\n\t**\tVerifies that the array contents are of the specified class. Returns error if the class does not exist\n\t**\tor if the field is not an array. Therefore a type:array constraint should be used before this one.\n\t*/\n\tarrayof: function (model, ctval, name, value)\n\t{\n\t\tvar mclass = this._getref(ctval, model);\n\t\tif (!value) value = [];\n\n\t\tif (!mclass || Rinn.typeOf(value) != \"array\")\n\t\t\tthrow new Error (ctval);\n\n\t\tfor (var i = 0; i < value.length; i++)\n\t\t\tvalue[i] = Rinn.ensureTypeOf(mclass, value[i]);\n\t\t\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the array contents are not null. Returns error if the field is not an array, therefore a\n\t**\ttype:array constraint should be used before this one.\n\t*/\n\tarraynull: function (model, ctval, name, value)\n\t{\n\t\tvar remove = false;\n\n\t\tif (Rinn.typeOf(ctval) == \"object\")\n\t\t{\n\t\t\tif (ctval.remove) remove = ctval.remove;\n\t\t\tctval = ctval.value;\n\t\t}\n\n\t\tif (ctval) return value;\n\n\t\tif (Rinn.typeOf(value) != \"array\")\n\t\t\tthrow new Error (ctval);\n\n\t\tfor (var i = 0; i < value.length; i++)\n\t\t{\n\t\t\tif (value[i] == null)\n\t\t\t{\n\t\t\t\tif (remove)\n\t\t\t\t\tvalue.splice (i--, 1);\n\t\t\t\telse\n\t\t\t\t\tthrow new Error (ctval);\n\t\t\t}\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the array contents are all compliant. Returns error if the field is not an array, therefore\n\t**\ta type:array constraint should be used before this one.\n\t*/\n\tarraycompliant: function (model, ctval, name, value)\n\t{\n\t\tvar remove = false;\n\n\t\tif (Rinn.typeOf(ctval) == \"object\")\n\t\t{\n\t\t\tif (ctval.remove) remove = ctval.remove;\n\t\t\tctval = ctval.value;\n\t\t}\n\n\t\tif (!ctval) return value;\n\n\t\tif (Rinn.typeOf(value) != \"array\")\n\t\t\tthrow new Error (ctval);\n\n\t\tfor (var i = 0; i < value.length; i++)\n\t\t{\n\t\t\tif (value[i] == null)\n\t\t\t\tcontinue;\n\n\t\t\tif (!value[i].isCompliant())\n\t\t\t{\n\t\t\t\tif (remove)\n\t\t\t\t\tvalue.splice (i--, 1);\n\t\t\t\telse\n\t\t\t\t\tthrow new Error (ctval);\n\t\t\t}\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the presense of the field.\n\t*/\n\trequired: function (model, ctval, name, value)\n\t{\n\t\tif (value === null || value === undefined)\n\t\t\tthrow new Error (ctval ? \"\" : \"null\");\n\n\t\tswitch (Rinn.typeOf(value))\n\t\t{\n\t\t\tcase \"array\":\n\t\t\t\tif (value.length == 0) throw new Error (ctval ? \"\" : \"null\");\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tif (value.toString().length == 0) throw new Error (ctval ? \"\" : \"null\");\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the minimum length of the field.\n\t*/\n\tminlen: function (model, ctval, name, value)\n\t{\n\t\tif (value.toString().length < ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the maximum length of the field.\n\t*/\n\tmaxlen: function (model, ctval, name, value)\n\t{\n\t\tif (value.toString().length > ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the minimum value of the field.\n\t*/\n\tminval: function (model, ctval, name, value)\n\t{\n\t\tif (parseFloat(value) < ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the maximum value of the field.\n\t*/\n\tmaxval: function (model, ctval, name, value)\n\t{\n\t\tif (parseFloat(value) > ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the minimum number of items in the array.\n\t*/\n\tmincount: function (model, ctval, name, value)\n\t{\n\t\tif (Rinn.typeOf(value) != \"array\" || value.length < ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the maximum number of items in the array.\n\t*/\n\tmaxcount: function (model, ctval, name, value)\n\t{\n\t\tif (Rinn.typeOf(value) != \"array\" || value.length > ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the format of the field using a regular expression. The constraint value should be the name of\n\t**\tone of the Model.Regex regular expressions.\n\t*/\n\tpattern: function (model, ctval, name, value)\n\t{\n\t\tif (!Regex[ctval].test (value.toString()))\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the field is inside the specified set of options. The set can be an array or a string with\n\t**\tthe options separated by vertical bar (|). The comparison is case-sensitive.\n\t*/\n\tinset: function (model, ctval, name, value)\n\t{\n\t\tif (Rinn.typeOf(ctval) != \"array\")\n\t\t{\n\t\t\tif (!new RegExp(\"^(\"+ctval.toString()+\")$\").test (value.toString()))\n\t\t\t\tthrow new Error (ctval);\n\n\t\t\treturn value;\n\t\t}\n\n\t\tif (ctval.indexOf(value.toString()) == -1)\n\t\t\tthrow new Error (ctval.join(\"|\"));\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tSets the field to upper case.\n\t*/\n\tupper: function (model, ctval, name, value)\n\t{\n\t\treturn ctval ? value.toString().toUpperCase() : value;\n\t},\n\n\n\t/**\n\t**\tSets the field to lower case.\n\t*/\n\tlower: function (model, ctval, name, value)\n\t{\n\t\treturn ctval ? value.toString().toLowerCase() : value;\n\t}\n};\n","\r\nconst Rinn = { };\r\nexport default Rinn;\r\n\r\n/*\r\n**\tInvokes the specified function 'fn' 10ms later.\r\n**\r\n**\t>> void invokeLater (function fn);\r\n*/\r\nRinn.invokeLater = function (fn)\r\n{\r\n\tif (fn) setTimeout (function() { fn(); }, 10);\r\n};\r\n\r\n\r\n/*\r\n**\tWaits for the specified amount of milliseconds. Returns a Promise.\r\n**\r\n**\t>> Promise wait (int millis);\r\n*/\r\nRinn.wait = function (millis)\r\n{\r\n\treturn new Promise(function (resolve, reject) {\r\n\t\tsetTimeout (resolve, millis);\r\n\t});\r\n};\r\n\r\n\r\n/*\r\n**\tReturns the type of an element 'o', properly detects arrays and null types. The return string is always in lowercase.\r\n**\r\n**\t>> string typeOf (any o);\r\n*/\r\nRinn.typeOf = function (o)\r\n{\r\n\tif (o instanceof Array)\r\n\t\treturn \"array\";\r\n\r\n\tif (o === null)\r\n\t\treturn \"null\";\r\n\r\n\treturn (typeof(o)).toString().toLowerCase();\r\n};\r\n\r\n\r\n/*\r\n**\tReturns boolean indicating if the type of the element is an array or an object.\r\n**\r\n**\t>> bool isArrayOrObject (any o);\r\n*/\r\nRinn.isArrayOrObject = function (o)\r\n{\r\n\tswitch (Rinn.typeOf(o))\r\n\t{\r\n\t\tcase \"array\": case \"object\":\r\n\t\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\n\r\n/*\r\n**\tCreates a clone (deep copy) of the specified element. The element can be an array, an object or a primitive type.\r\n**\r\n**\t>> T clone (T elem);\r\n*/\r\nRinn.clone = function (elem)\r\n{\r\n\tlet o = Rinn.typeOf(elem);\r\n\r\n\tif (o === 'array')\r\n\t{\r\n\t\to = [ ];\r\n\r\n\t\tfor (let i = 0; i < elem.length; i++)\r\n\t\t\to.push (Rinn.clone(elem[i]));\r\n\t}\r\n\telse if (o === 'object')\r\n\t{\r\n\t\tif (('clone' in elem) && typeof(elem.clone) === 'function')\r\n\t\t\treturn elem.clone();\r\n\r\n\t\to = { };\r\n\r\n\t\tfor (let i in elem)\r\n\t\t\to[i] = Rinn.clone(elem[i]);\r\n\t}\r\n\telse\r\n\t{\r\n\t\to = elem;\r\n\t}\r\n\r\n\treturn o;\r\n};\r\n\r\n\r\n/*\r\n**\tMerges all given elements into the first one, object fields are cloned.\r\n**\r\n**\t>> T merge (T... elems)\r\n*/\r\nRinn.merge = function (output, ...objs)\r\n{\r\n\tif (Rinn.typeOf(output) == \"array\")\r\n\t{\r\n\t\tfor (let i = 0; i < objs.length; i++)\r\n\t\t{\r\n\t\t\tlet arr = objs[i];\r\n\r\n\t\t\tif (Rinn.typeOf(arr) != \"array\")\r\n\t\t\t{\r\n\t\t\t\toutput.push(arr);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tfor (let j = 0; j < arr.length; j++)\r\n\t\t\t\t{\r\n\t\t\t\t\toutput.push(Rinn.clone(arr[j]));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse if (Rinn.typeOf(output) == \"object\")\r\n\t{\r\n\t\tfor (let i = 0; i < objs.length; i++)\r\n\t\t{\r\n\t\t\tlet obj = objs[i];\r\n\t\t\tif (Rinn.typeOf(obj) != \"object\") continue;\r\n\r\n\t\t\tfor (let field in obj)\r\n\t\t\t{\r\n\t\t\t\tif (Rinn.isArrayOrObject(obj[field]))\r\n\t\t\t\t{\r\n\t\t\t\t\tif (field in output)\r\n\t\t\t\t\t\tRinn.merge(output[field], obj[field]);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\toutput[field] = Rinn.clone(obj[field]);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\toutput[field] = obj[field];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn output;\r\n};\r\n\r\n\r\n/*\r\n**\tAssigns all fields from the specified objects into the first one.\r\n**\r\n**\t>> object override (object output, object... objs)\r\n*/\r\nRinn.override = function (output, ...objs)\r\n{\r\n\tfor (let i = 0; i < objs.length; i++)\r\n\t{\r\n\t\tfor (let j in objs[i])\r\n\t\t{\r\n\t\t\toutput[j] = objs[i][j];\r\n\t\t}\r\n\t}\r\n\r\n\treturn output;\r\n};\r\n\r\n\r\n/*\r\n**\tCompares two objects and returns `true` if all properties in \"partial\" find a match in \"full\".\r\n*/\r\nRinn.partialCompare = function (full, partial)\r\n{\r\n\tif (full == null || partial == null) return false;\r\n\r\n\tif (full === partial)\r\n\t\treturn true;\r\n\r\n\tfor (var i in partial)\r\n\t{\r\n\t\tif (full[i] != partial[i])\r\n\t\t\treturn false;\r\n\t}\r\n\r\n\treturn true;\r\n};\r\n\r\n\r\n/*\r\n**\tPerforms a partial search for an object (o) in the specified array and returns its index or `false` if the\r\n**\tobject was not found. When `getObject` is set to `true` the object will be returned instead of an index, or\r\n**\t`null` if not found.\r\n*/\r\nRinn.arrayFind = function (arr, o, getObject)\r\n{\r\n\tfor (var i = 0; arr && i < arr.length; i++)\r\n\t{\r\n\t\tif (this.partialCompare (arr[i], o))\r\n\t\t\treturn getObject ? arr[i] : i;\r\n\t}\r\n\r\n\treturn getObject ? null : false;\r\n};\r\n\r\n\r\n/*\r\n**\tVerifies if the specified object is of class `m`, returns boolean.\r\n**\r\n**\t>> bool isTypeOf (object obj, class _class);\r\n*/\r\nRinn.isInstanceOf = function (obj, _class)\r\n{\r\n\tif (!obj || !_class || typeof(obj) !== 'object')\r\n\t\treturn false;\r\n\r\n\tif (obj instanceof _class)\r\n\t\treturn true;\r\n\r\n\tif ('isInstanceOf' in obj)\r\n\t\treturn obj.isInstanceOf(_class);\r\n\r\n\treturn false;\r\n};\r\n\r\n\r\n/*\r\n**\tTraverses the given object attempting to find the index/key that does an identical match with the specified value,\r\n**\tif not found returns -1, otherwise the index/key where the value was found.\r\n**\r\n**\t>> int indexOf (array container, T value)\r\n**\t>> string indexOf (object container, T value)\r\n*/\r\nRinn.indexOf = function (container, value, forceArray=false)\r\n{\r\n\tif (forceArray)\r\n\t{\r\n\t\tfor (let i = 0; i < container.length; i++)\r\n\t\t{\r\n\t\t\tif (container[i] === value)\r\n\t\t\t\treturn i;\r\n\t\t}\r\n\t\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tfor (let i in container)\r\n\t{\r\n\t\tif (container[i] === value)\r\n\t\t\treturn i;\r\n\t}\r\n\r\n\treturn -1;\r\n};\r\n\r\n\r\n/*\r\n**\tEscapes a string using HTML entities.\r\n**\r\n**\t>> string escape (string str);\r\n*/\r\nRinn.escape = function (str)\r\n{\r\n\treturn (str+\"\").replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\r\n};\r\n\r\n\r\n/*\r\n**\tVerifies if the specified object is of class `m`, if not it will create a new instance of `m` passing `o` as parameter.\r\n**\r\n**\t>> object ensureTypeOf (class m, object o);\r\n*/\r\nRinn.ensureTypeOf = function (m, o)\r\n{\r\n\tif (!o || !m || o instanceof m)\r\n\t\treturn o;\r\n\r\n\tif (o.isInstanceOf && m.prototype.className)\r\n\t{\r\n\t\tif (o.isInstanceOf (m.prototype.className))\r\n\t\t\treturn o;\r\n\t}\r\n\r\n\treturn new m (o);\r\n};\r\n\r\n\r\n/*\r\n**\tSerializes an object and returns its JSON string representation.\r\n**\r\n**\t>> string serialize (object o);\r\n*/\r\nRinn.serialize = function (o)\r\n{\r\n\treturn JSON.stringify(o);\r\n};\r\n\r\n\r\n/*\r\n**\tDeserializes a string in JSON format and returns the result.\r\n**\r\n**\t>> any deserialize (string s);\r\n*/\r\nRinn.deserialize = function (s)\r\n{\r\n\treturn JSON.parse(s);\r\n};\r\n\r\n\r\n/*\r\n**\tChains a new function to an existing one on some object, such that invoking the function on the object will cause\r\n**\tboth functions to run (order would be oldFunction then newFunction).\r\n**\r\n**\tIf the `conditional` flag is set to `true`, the second function will be run only if the first one returns non-false.\r\n**\tReturns an object with a single method 'unhook' which will revert the changes to leave only the original function.\r\n**\r\n**\t>> object{function unhook} hook (Object object, String functionName, function newFunction, bool conditional=false);\r\n*/\r\nRinn.hookAppend = function (object, functionName, newFunction, conditional=true)\r\n{\r\n\tconst oldFunction = object[functionName];\r\n\r\n\tif (conditional)\r\n\t{\r\n\t\tobject[functionName] = function (...args) {\r\n\t\t\tif (oldFunction.apply (this, args) !== false)\r\n\t\t\t\treturn newFunction.apply (this, args);\r\n\t\t};\r\n\t}\r\n\telse\r\n\t{\r\n\t\tobject[functionName] = function (...args) {\r\n\t\t\toldFunction.apply (this, args);\r\n\t\t\treturn newFunction.apply (this, args);\r\n\t\t};\r\n\t}\r\n\r\n\treturn { \r\n\t\tunhook: function() {\r\n\t\t\tobject[functionName] = oldFunction;\r\n\t\t}\r\n\t};\r\n};\r\n\r\n\r\n/*\r\n**\tChains a new function to an existing one on some object, such that invoking the function on the object will cause\r\n**\tboth functions to run (order would be oldFunction then newFunction).\r\n**\r\n**\tIf the `conditional` flag is set to `true`, the second function will be run only if the first one returns non-false.\r\n**\tReturns an object with a single method 'unhook' which will revert the changes to leave only the original function.\r\n**\r\n**\t>> object{function unhook} hook (Object object, String functionName, function newFunction, bool conditional=false);\r\n*/\r\nRinn.hookPrepend = function (object, functionName, newFunction, conditional=true)\r\n{\r\n\tconst oldFunction = object[functionName];\r\n\r\n\tif (conditional)\r\n\t{\r\n\t\tobject[functionName] = function (...args) {\r\n\t\t\tif (newFunction.apply (this, args) !== false)\r\n\t\t\t\treturn oldFunction.apply (this, args);\r\n\t\t};\r\n\t}\r\n\telse\r\n\t{\r\n\t\tobject[functionName] = function (...args) {\r\n\t\t\tnewFunction.apply (this, args);\r\n\t\t\treturn oldFunction.apply (this, args);\r\n\t\t};\r\n\t}\r\n\r\n\treturn { \r\n\t\tunhook: function() {\r\n\t\t\tobject[functionName] = oldFunction;\r\n\t\t}\r\n\t};\r\n};\r\n","\n/**\n**\tCommon regular expressions for pattern validation.\n*/\n\nexport default\n{\n\temail: /^[_a-z0-9-]+(\\.[_a-z0-9-]+)*@[a-z0-9-]+(\\.[a-z0-9-]+)+$/i,\n\turl: /^[\\w-]+:\\/\\/[\\w-]+(\\.\\w+)+.*$/,\n\turlNoProt: /^[\\w-]+(\\.\\w+)+.*$/,\n\tname: /^[-A-Za-z0-9_.]+$/,\n\tuname: /^['\\pL\\pN ]+$/,\n\ttext: /^[^&<>{}]*$/,\n\tutext: /^([\\r\\n\\pL\\pN\\pS &!@#$%*\\[\\]()_+=;',.\\/?:\"~-]+)$/\n};\n","\r\nimport _Rinn from './alpha.js';\r\nimport _Class from './class.js';\r\nimport _Event from './event.js';\r\nimport _EventDispatcher from './event-dispatcher.js';\r\nimport _Model from './model.js';\r\nimport _ModelList from './model-list.js';\r\nimport _Schema from './schema.js';\r\nimport _Flattenable from './flattenable.js';\r\nimport _Collection from './collection.js';\r\nimport _Template from './template.js';\r\n\r\nexport const Rinn = _Rinn;\r\nexport const Class = _Class;\r\nexport const Event = _Event;\r\nexport const EventDispatcher = _EventDispatcher;\r\nexport const Model = _Model;\r\nexport const ModelList = _ModelList;\r\nexport const Schema = _Schema;\r\nexport const Flattenable = _Flattenable;\r\nexport const Collection = _Collection;\r\nexport const Template = _Template;\r\n","\r\nimport Rinn from './alpha.js';\r\n\r\n/**\r\n * Base class used to create other classes with complex prototype based multiple inheritance while at the\r\n * same time avoiding the prototype chain for faster access. Supports calling parent class methods.\r\n */\r\n\r\n//!class Class\r\nconst Class = function ()\r\n{\r\n};\r\n\r\n/**\r\n * Reference to the class itself.\r\n */\r\nClass._class = Class;\r\n\r\n/**\r\n * Contains the methods of each of the super classes.\r\n */\r\nClass._super = { };\r\n\r\n/**\r\n * Name of the class, if none specified the class will be considered \"final\" and will not be inheritable.\r\n * !readonly string className;\r\n */\r\nClass.prototype.className = 'Class';\r\n\r\n/**\r\n * Class constructor, should initialize the instance. Invoked when the `new` keyword is used with the class.\r\n * !constructor();\r\n */\r\nClass.prototype.__ctor = function ()\r\n{\r\n};\r\n\r\n/**\r\n * Class destructor, should clear the instance and release any used resources, invoked when the global `dispose` function is called with an instance as parameter.\r\n * !__dtor() : void;\r\n */\r\nClass.prototype.__dtor = function ()\r\n{\r\n};\r\n\r\n/**\r\n * Returns true if the object is an instance of the specified class, the parameter can be a class name (string), a constructor (function) or\r\n * a class instance (object), in any cases the appropriate checks will be done.\r\n * !isInstanceOf (className: string|function|object) : boolean;\r\n */\r\nClass.prototype.isInstanceOf = function (className)\r\n{\r\n\tif (className === null)\r\n\t\treturn false;\r\n\r\n\tif (typeof(className) === 'function')\r\n\t{\r\n\t\tclassName = className.prototype.className;\r\n\t}\r\n\telse if (typeof(className) !== 'string')\r\n\t{\r\n\t\tclassName = className.__proto__.className;\r\n\t}\r\n\r\n\treturn this.className === className ? true : this._super.hasOwnProperty(className);\r\n};\r\n\r\n/**\r\n * Returns true if the given object is an instance of the specified class, the parameter can be a class name (string), a constructor (function)\r\n * or a class instance (object), in any cases the appropriate checks will be done.\r\n * !instanceOf (object: object, className: string|function|object) : boolean;\r\n */\r\nClass.instanceOf = function (object, className)\r\n{\r\n\tif (object === null || className === null)\r\n\t\treturn false;\r\n\r\n\treturn object.isInstanceOf(className);\r\n};\r\n\r\n/**\r\n * Internal method to ensure the _super field of an instance has all functions properly bound to the instance.\r\n */\r\nClass.prototype._initSuperRefs = function ()\r\n{\r\n\tlet _super = this.constructor._super;\r\n\tlet _newSuper = { };\r\n\r\n\tconst self = this;\r\n\r\n\tfor (let i in _super)\r\n\t{\r\n\t\tlet o = { };\r\n\r\n\t\tlet _prot = _super[i].prototype;\r\n\t\tfor (let j in _prot)\r\n\t\t{\r\n\t\t\tif (Rinn.typeOf(_prot[j]) !== 'function')\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\to[j] = (function(fn)\r\n\t\t\t{\r\n\t\t\t\treturn function (a0, a1, a2, a3, a4, a5, a6, a7, a8, a9, a10) {\r\n\t\t\t\t\treturn fn.call(self, a0, a1, a2, a3, a4, a5, a6, a7, a8, a9, a10);\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t(_prot[j]);\r\n\t\t}\r\n\r\n\t\t_newSuper[i] = o;\r\n\t}\r\n\r\n\tthis._super = _newSuper;\r\n};\r\n\r\n\r\n/*\r\n**\tExtends the class with the specified prototype. The prototype can be a function (class constructor) or an object. Note that the\r\n**\tclass will be modified (and returned) instead of creating a new class. Must be called at the class-level (**not** instance level).\r\n**\tWhen a class is provided all fields starting with uppercase at the class-level will not be inherited, this is used to create constants\r\n**\ton classes without having them to be copied to derived classes.\r\n**\r\n**\t>> class inherit (constructor classConstructor);\r\n**\t>> class inherit (object obj);\r\n*/\r\nClass.inherit = function (proto)\r\n{\r\n\tlet self = this._class;\r\n\r\n\tlet _super = self._super;\r\n\tlet _class = self._class;\r\n\r\n\tif (Rinn.typeOf(proto) === 'function')\r\n\t{\r\n\t\t// Move constants (uppercased properties) to the class-level instead of prototype-level.\r\n\t\tfor (let i in proto._class)\r\n\t\t\tif (!/^[A-Z]/.test(i)) self[i] = proto._class[i];\r\n\r\n\t\t// Combine methods and properties.\r\n\t\tRinn.override (self.prototype, proto._class.prototype);\r\n\r\n\t\t// Combine super references.\r\n\t\tRinn.override (_super, proto._class._super);\r\n\r\n\t\t// Add new super reference if className specified in inherited prototypes.\r\n\t\tif (proto._class.prototype.className)\r\n\t\t\t_super[proto._class.prototype.className] = proto._class;\r\n\t}\r\n\telse\r\n\t{\r\n\t\tRinn.override (self.prototype, proto);\r\n\t}\r\n\r\n\tself._super = _super;\r\n\tself._class = _class;\r\n\r\n\treturn self;\r\n};\r\n\r\n\r\n/**\r\n * Internal method used to extend a class with one or more prototypes.\r\n */\r\nClass.prototype._extend = function (base, protos)\r\n{\r\n\tif (protos.length === 0)\r\n\t\treturn base;\r\n\r\n\t//VIOLET OPTIMIZE\r\n\tconst _class = function (...args)\r\n\t{\r\n\t\tthis._initSuperRefs();\r\n\t\tthis.__ctor.apply(this, args);\r\n\t};\r\n\r\n\t_class._class = _class;\r\n\t_class._super = { };\r\n\r\n\tClass.inherit.call (_class, base);\r\n\tdelete _class.prototype.className;\r\n\r\n\tfor (let i = 0; i < protos.length; i++)\r\n\t\t_class.inherit (protos[i]);\r\n\r\n\tdelete _class._super.Class;\r\n\r\n\tif ('classInit' in _class.prototype)\r\n\t\t_class.prototype.classInit();\r\n\r\n\t_class.isInstance = function(value) {\r\n\t\treturn Rinn.isInstanceOf(value, _class);\r\n\t};\r\n\r\n\treturn _class;\r\n};\r\n\r\n\r\n/**\r\n * Creates a new class with the specified prototypes each of which can be a class constructor (function) or an object.\r\n */\r\nClass.extend = function (...protos)\r\n{\r\n\treturn this._class.prototype._extend (this, protos);\r\n};\r\n\r\n\r\n/**\r\n * Creates a new instance of a class resulting from extending the self class with the specified prototype.\r\n */\r\nClass.create = function (proto)\r\n{\r\n\treturn new (this.extend(proto)) ();\r\n};\r\n\r\n/**\r\n * Mutates the host object to be an instance of the specified class.\r\n * !static mutate (classConstructor: object, host: object, override?: object) : object;\r\n */\r\nClass.mutate = function (classConstructor, host, override=null)\r\n{\r\n\tlet zombie = new classConstructor ();\r\n\r\n\t// Copy all members from the class prototype.\r\n\tfor (let i in classConstructor.prototype)\r\n\t{\r\n\t\tif (host.hasOwnProperty(i))\r\n\t\t\tcontinue;\r\n\t\r\n\t\thost[i] = classConstructor.prototype[i];\r\n\t}\r\n\t\r\n\t// Copy all members from the zombie class instance.\r\n\tfor (let i in zombie)\r\n\t{\r\n\t\tif (host.hasOwnProperty(i))\r\n\t\t\tcontinue;\r\n\t\r\n\t\thost[i] = zombie[i];\r\n\t}\r\n\r\n\t// Rebind the super references.\r\n\tif (host._super)\r\n\t{\r\n\t\tfor (let i in host._super)\r\n\t\t{\r\n\t\t\tfor (let j in host._super[i]) {\r\n\t\t\t\thost._super[i][j] = classConstructor.prototype.constructor._super[i].prototype[j].bind(host);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Copy override members.\r\n\tif (override !== null) {\r\n\t\tfor (let i in override)\r\n\t\t\thost[i] = override[i];\r\n\t}\r\n\r\n\treturn host;\r\n};\r\n\r\nexport default Class;\r\n","\r\nimport Rinn from './alpha.js';\r\nimport Class from './class.js';\r\n\r\n/**\r\n**\tHolds the information about a triggered event. It also provides a mechanism to allow asynchronous\r\n**\tevent propagation to ensure the event chain order.\r\n*/\r\n\r\nexport default Class.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"Event\",\r\n\r\n\t/**\r\n\t**\tSource of the event.\r\n\t*/\r\n\tsource: null,\r\n\r\n\t/**\r\n\t**\tName of the event.\r\n\t*/\r\n\tname: null,\r\n\r\n\t/**\r\n\t**\tArguments of the event.\r\n\t*/\r\n\targs: null,\r\n\r\n\t/**\r\n\t**\tIndicates if the last event handler wants to use async mode.\r\n\t*/\r\n\t_async: false,\r\n\r\n\t/**\r\n\t**\tQueue of all handlers to invoke.\r\n\t*/\r\n\tlist: null,\r\n\r\n\t/**\r\n\t**\tNext event to be executed in the event chain.\r\n\t*/\r\n\tnext: null,\r\n\r\n\t/**\r\n\t**\tReturn values from event handlers.\r\n\t*/\r\n\tret: null,\r\n\r\n\t/**\r\n\t**\tOriginal root event.\r\n\t*/\r\n\toriginal: null,\r\n\r\n\t/**\r\n\t**\tIndex of the current event handler.\r\n\t*/\r\n\ti: -1,\r\n\r\n\t/**\r\n\t**\tContructs an event object with the specified parameters. Source is the event-dispatcher object, list is\r\n\t**\tan array with all the listeners to invoke. The eventName and eventArgs are the event information to be\r\n\t**\tpassed to each handler and if a callback is specified (cbHandler+cbContext) it will be executed once all\r\n\t**\tthe event handlers have been processed.\r\n\t**\r\n\t**\tEvent __ctor (source: EventDispatcher, list: Array, eventName: string, eventArgs: map, cbHandler: function, cbContext: object);\r\n\t*/\r\n\t__ctor: function (source, list, eventName, eventArgs, cbHandler, cbContext)\r\n\t{\r\n\t\tthis.source = source;\r\n\r\n\t\tthis.name = eventName;\r\n\t\tthis.args = eventArgs;\r\n\r\n\t\tthis.cbHandler = cbHandler;\r\n\t\tthis.cbContext = cbContext;\r\n\r\n\t\tthis.list = list;\r\n\t\tthis.reset();\r\n\t},\r\n\r\n\t/**\r\n\t**\tResets the event to its initial state. An event object can be reused by resetting it and then\r\n\t**\tinvoking the resume event.\r\n\t**\r\n\t**\tEvent reset ();\r\n\t*/\r\n\treset: function ()\r\n\t{\r\n\t\tthis.next = null;\r\n\t\tthis.ret = [];\r\n\r\n\t\tthis._async = false;\r\n\t\tthis.i = -1;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tChanges the source of the event.\r\n\t**\r\n\t**\tEvent setSource (object value);\r\n\t*/\r\n\tsetSource: function (value)\r\n\t{\r\n\t\tthis.source = value;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tSets the internal asynchronous flag. Should be called before a handler returns. If a handler\r\n\t**\tcalls this method it should also call resume() when async operations are finished.\r\n\t**\r\n\t**\tEvent wait ();\r\n\t*/\r\n\twait: function ()\r\n\t{\r\n\t\tthis._async = true;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tResumes event propagation. Should be called manually by event handlers that also call wait().\r\n\t**\r\n\t**\tEvent resume ();\r\n\t*/\r\n\tresume: function ()\r\n\t{\r\n\t\tthis._async = false;\r\n\r\n\t\twhile (!this._async)\r\n\t\t{\r\n\t\t\tif (++this.i >= this.list.length)\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tif (this.list[this.i].silent)\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tif (Rinn.typeOf(this.list[this.i].handler) == \"string\")\r\n\t\t\t{\r\n\t\t\t\tif (this.list[this.i].context)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (!this.list[this.i].context[this.list[this.i].handler])\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\tif (this.list[this.i].context[this.list[this.i].handler] (this, this.args, this.list[this.i].data) === false)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tif (global[this.list[this.i].handler].call (null, this, this.args, this.list[this.i].data) === false)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (this.list[this.i].handler.call (this.list[this.i].context, this, this.args, this.list[this.i].data) === false)\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._async)\r\n\t\t\treturn this;\r\n\r\n\t\tif (this.i >= this.list.length && this.next) this.next.resume();\r\n\r\n\t\tif (this.cbHandler)\r\n\t\t\tthis.cbHandler.call (this.cbContext);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tSets the \"original\" property of the event to indicate where the original event comes from.\r\n\t**\r\n\t**\tEvent from (event: Event);\r\n\t*/\r\n\tfrom: function (event)\r\n\t{\r\n\t\tthis.original = event;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tEnqueues the specified event to be executed upon the current event process is finished. The \"original\"\r\n\t**\tproperty of the chained event will be set to the current event.\r\n\t**\r\n\t**\tEvent enqueueEvent (event: Event);\r\n\t*/\r\n\tenqueue: function (event)\r\n\t{\r\n\t\tif (!event) return this;\r\n\r\n\t\tvar evt;\r\n\t\tfor (evt = this; evt.next != null; evt = evt.next);\r\n\r\n\t\tevt.next = event;\r\n\t\tevent.from (this);\r\n\r\n\t\treturn this;\r\n\t}\r\n});\r\n","\r\nimport Class from './class.js';\r\nimport Event from './event.js';\r\n\r\n/**\r\n**\tEvent dispatcher allows several event listeners to be attached, these will be invoked whenever the\r\n**\tevent that is being listened to is triggered.\r\n*/\r\n\r\nexport default Class.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"EventDispatcher\",\r\n\r\n\t/**\r\n\t**\tListeners attached to this event dispatcher. Grouped by event name.\r\n\t*/\r\n\tlisteners: null,\r\n\r\n\t/**\r\n\t**\tNamespace for event dispatching. Defaults to null. Can be modified using setNamespace().\r\n\t*/\r\n\tnamespace: null,\r\n\r\n\t/**\r\n\t**\tInitializes the event dispatcher.\r\n\t**\r\n\t**\tEventDispatcher __ctor ();\r\n\t*/\r\n\t__ctor: function ()\r\n\t{\r\n\t\tthis.listeners = { };\r\n\t},\r\n\r\n\t/**\r\n\t**\tSets the event dispatching namespace. Used to force all events dispatched to have the specified namespace.\r\n\t**\r\n\t**\tEventDispatcher setNamespace (value: string);\r\n\t*/\r\n\tsetNamespace: function (value)\r\n\t{\r\n\t\tthis.namespace = value;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tAdds an event listener for a specified event to the event dispatcher. The event name can have an optional\r\n\t**\tnamespace indicator which is added to the beginning of the event name and separated using a colon (:). This\r\n\t**\tindicator can be used to later trigger or remove all handlers of an specific namespace.\r\n\t**\r\n\t**\tEventDispatcher addEventListener (eventName: string, handler: function, context: object, data: object);\r\n\t*/\r\n\taddEventListener: function (eventName, handler, context, data)\r\n\t{\r\n\t\teventName = eventName.split(\":\");\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tif (!this.listeners[name])\r\n\t\t\tthis.listeners[name] = [];\r\n\r\n\t\tthis.listeners[name].push ({ ns: ns, handler: handler, context: context, data: data, silent: 0 });\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tRemoves an event listener from the event dispatcher. If only the name is provided all handlers with the\r\n\t**\tspecified name will be removed. If a context is provided without a handler then any handler matching the\r\n\t**\tcontext will be removed. Special event name \"*\" can be used to match all event names.\r\n\t**\r\n\t**\tEventDispatcher removeEventListener (eventName: string, handler: function, context: object);\r\n\t*/\r\n\tremoveEventListener: function (eventName, handler, context)\r\n\t{\r\n\t\teventName = eventName.split(\":\");\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tif (name == \"*\")\r\n\t\t{\r\n\t\t\tfor (var j in this.listeners)\r\n\t\t\t{\r\n\t\t\t\tvar list = this.listeners[j];\r\n\r\n\t\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar k = true;\r\n\r\n\t\t\t\t\tif (handler)\r\n\t\t\t\t\t\tk = k && list[i].handler === handler;\r\n\r\n\t\t\t\t\tif (context)\r\n\t\t\t\t\t\tk = k && list[i].context === context;\r\n\r\n\t\t\t\t\tif (ns)\r\n\t\t\t\t\t\tk = k && list[i].ns == ns;\r\n\r\n\t\t\t\t\tif (k) list.splice(i--, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (!this.listeners[name])\r\n\t\t\t\treturn this;\r\n\r\n\t\t\tvar list = this.listeners[name];\r\n\r\n\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t{\r\n\t\t\t\tvar k = true;\r\n\r\n\t\t\t\tif (handler)\r\n\t\t\t\t\tk = k && list[i].handler === handler;\r\n\r\n\t\t\t\tif (context)\r\n\t\t\t\t\tk = k && list[i].context === context;\r\n\r\n\t\t\t\tif (ns)\r\n\t\t\t\t\tk = k && list[i].ns == ns;\r\n\r\n\t\t\t\tif (k) list.splice(i--, 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tPrepares an event with the specified parameters for its later usage. The event is started when\r\n\t**\tthe resume() method is called. If a callback is specified it will be executed once all event\r\n\t**\thandlers have been processed.\r\n\t**\r\n\t**\tEvent prepareEvent (eventName: string, eventArgs: map, cbHandler: function, cbContext: object);\r\n\t**\tEvent prepareEvent (eventName: string, eventArgs: map);\r\n\t*/\r\n\tprepareEvent: function (eventName, eventArgs, cbHandler, cbContext)\r\n\t{\r\n\t\tvar list = [];\r\n\r\n\t\teventName = eventName.split(\":\");\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tif (this.listeners[name])\r\n\t\t\tlist = list.concat (this.listeners[name]);\r\n\r\n\t\tif (this.listeners[\"*\"])\r\n\t\t\tlist = list.concat (this.listeners[\"*\"]);\r\n\r\n\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\tif (list[i].silent) list.splice (i--, 1);\r\n\r\n\t\tif (ns)\r\n\t\t{\r\n\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t\tif (list[i].ns != ns) list.splice (i--, 1);\r\n\t\t}\r\n\r\n\t\treturn new Event (this, list, name, eventArgs, cbHandler, cbContext);\r\n\t},\r\n\r\n\t/**\r\n\t**\tSilences or unsilences all handlers attached to an event such that if the event fires the handler(s) will\r\n\t**\tnot be invoked. It is recommended to use a namespace to ensure other handlers will continue to be run.\r\n\t**\r\n\t**\tEventDispatcher silence (eventName: string);\r\n\t*/\r\n\tsilence: function (eventName, value)\r\n\t{\r\n\t\teventName = eventName.split(\":\");\r\n\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tvalue = value === false ? -1 : 1;\r\n\r\n\t\tif (name == \"*\")\r\n\t\t{\r\n\t\t\tfor (var j in this.listeners)\r\n\t\t\t{\r\n\t\t\t\tvar list = this.listeners[j];\r\n\r\n\t\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (ns && list[i].ns != ns)\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\tlist[i].silent += value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (!this.listeners[name])\r\n\t\t\t\treturn this;\r\n\r\n\t\t\tvar list = this.listeners[name];\r\n\r\n\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t{\r\n\t\t\t\tif (ns && list[i].ns != ns)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tlist[i].silent += value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tDispatches an event to the respective listeners. If a callback is specified it will be executed once\r\n\t**\tall event handlers have been processed.\r\n\t**\r\n\t**\tEvent dispatchEvent (eventName: string, eventArgs: map, cbHandler: function, cbContext: object);\r\n\t**\tEvent dispatchEvent (eventName: string, eventArgs: map);\r\n\t*/\r\n\tdispatchEvent: function (eventName, eventArgs, cbHandler, cbContext)\r\n\t{\r\n\t\treturn this.prepareEvent(this.namespace ? this.namespace+':'+eventName : eventName, eventArgs, cbHandler, cbContext).resume();\r\n\t}\r\n});\r\n","\nimport Rinn from './alpha.js';\nimport EventDispatcher from './event-dispatcher.js';\n\n/**\n**\tA model is a high-integrity data object used to store properties and more importantly to provide event support to notify of any\n**\tkind of change that occurs to the model's properties. Integrity of the model is maintained by optionally using property constraints.\n*/\n\nlet _Model = EventDispatcher.extend\n({\n\t/**\n\t**\tName of the class.\n\t*/\n\tclassName: \"Model\",\n\n\t/**\n\t**\tDefault properties for the model. Can be a map with the property name and its default value or a function\n\t**\treturning a map with dynamic default values. This is used to reset the model to its initial state.\n\t*/\n\tdefaults: null,\n\n\t/**\n\t**\tModel property contraints. A map with the property name and an object specifying the constraints of the\n\t**\tproperty. This is used to determine the type, format and behavior of each property in the model.\n\t*/\n\tconstraints: null,\n\n\t/**\n\t**\tProperties of the model.\n\t*/\n\tdata: null,\n\n\t/**\n\t**\tArray with the name of the properties that have changed. Populated prior modelChanged event.\n\t*/\n\tchangedList: null,\n\n\t/**\n\t**\tSilent mode indicator. While in silent mode events will not be dispatched.\n\t*/\n\t_silent: 0,\n\n\t/**\n\t**\tCurrent nesting level of the set() method. This is used to determine when all the property\n\t**\tchanges are done.\n\t*/\n\t_level: 0,\n\n\t/**\n\t**\tInitializes the model and sets the properties to the specified data object.\n\t**\n\t**\t>> Model __ctor (object data);\n\t**\t>> Model __ctor (object data, object defaults);\n\t*/\n\t__ctor: function (data, defaults)\n\t{\n\t\tthis._super.EventDispatcher.__ctor();\n\n\t\tthis.data = { };\n\n\t\tif (defaults != null)\n\t\t{\n\t\t\tthis.reset (defaults, false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet o = null;\n\n\t\t\tif (!this.defaults && this.constraints)\n\t\t\t{\n\t\t\t\to = { };\n\n\t\t\t\tfor (let i in this.constraints)\n\t\t\t\t{\n\t\t\t\t\tlet j = this.constraints[i];\n\t\t\t\t\tif (j.def === null || j.def === undefined)\n\t\t\t\t\t{\n\t\t\t\t\t\to[i] = null;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof(j.def) === 'function')\n\t\t\t\t\t\to[i] = j.def();\n\t\t\t\t\telse\n\t\t\t\t\t\to[i] = j.def;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.reset(o);\n\t\t}\n\n\t\tthis.init();\n\n\t\tif (data != null)\n\t\t\tthis.set (data, true);\n\n\t\tif (this.constraints) this.update();\n\n\t\tthis.ready();\n\t},\n\n\t/**\n\t**\tResets the model to its default state and triggers update events. If a map is provided the defaults of\n\t**\tthe model will be set to the specified map.\n\t**\n\t**\t>> Model reset (object defaults, [bool nsilent=true]);\n\t**\t>> Model reset ([bool nsilent=true]);\n\t*/\n\treset: function (defaults, nsilent)\n\t{\n\t\tif (!this.defaults)\n\t\t{\n\t\t\tif (!defaults || (Rinn.typeOf(defaults) !== 'object' && Rinn.typeOf(defaults) !== 'function'))\n\t\t\t\treturn this;\n\n\t\t\tthis.defaults = defaults;\n\t\t}\n\n\t\tif (Rinn.typeOf(this.defaults) === 'function')\n\t\t\tthis.data = this.defaults();\n\t\telse\n\t\t\tthis.data = Rinn.clone(this.defaults);\n\n\t\treturn (nsilent === false || defaults === false) ? this : this.update(null, true);\n\t},\n\n\t/**\n\t**\tInitializes the model. Called before the model properties are set.\n\t**\n\t**\t>> void init ();\n\t*/\n\tinit: function ()\n\t{\n\t},\n\n\t/**\n\t**\tInitialization epilogue. Called after initialization and after model properties are set.\n\t**\n\t**\t>> void ready ();\n\t*/\n\tready: function ()\n\t{\n\t},\n\n\t/**\n\t**\tEnables or disables silent mode. When the model is in silent mode events will not be dispatched.\n\t**\n\t**\t>> Model silent (value: bool);\n\t*/\n\tsilent: function (value)\n\t{\n\t\tthis._silent += value ? 1 : -1;\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tValidates a property name and value against the constraints defined in the model (if any). Returns the\n\t**\tfinal value if successful or throws an empty exception if errors occur.\n\t**\n\t**\t>> T _validate (string name, T value);\n\t*/\n\t_validate: function (name, value)\n\t{\n\t\tif (!this.constraints || !this.constraints[name])\n\t\t\treturn value;\n\n\t\tvar constraints = this.constraints[name];\n\n\t\tvar nvalue = value;\n\n\t\tfor (var ctname in constraints)\n\t\t{\n\t\t\tif (!_Model.Constraints[ctname])\n\t\t\t\tcontinue;\n\n\t\t\ttry {\n\t\t\t\tnvalue = _Model.Constraints[ctname] (this, constraints[ctname], name, nvalue);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tif (e.message == \"null\")\n\t\t\t\t\tbreak;\n\n\t\t\t\tthrow new Error (`Constraint [${ctname}:${constraints[ctname]}] failed on property '${name}'.`);\n\t\t\t}\n\t\t}\n\n\t\treturn nvalue;\n\t},\n\n\t/**\n\t**\tSets the value of a property and returns the value set. This method is internally used to set properties\n\t**\tone at a time. If constraints are present in the model for the specified property all constraints will be\n\t**\tverified. When constraint errors occur the constraintError event will be raised and the property value\n\t**\twill not be changed.\n\t**\n\t**\t>> T _set (string name, T value);\n\t*/\n\t_set: function (name, value)\n\t{\n\t\tif (!this.constraints || !this.constraints[name])\n\t\t{\n\t\t\tthis.data[name] = value;\n\t\t\treturn value;\n\t\t}\n\n\t\tvar constraints = this.constraints[name];\n\n\t\tvar cvalue = this.data[name];\n\t\tvar nvalue = value;\n\n\t\tfor (var ctname in constraints)\n\t\t{\n\t\t\tif (!_Model.Constraints[ctname])\n\t\t\t\tcontinue;\n\n\t\t\ttry {\n\t\t\t\tnvalue = _Model.Constraints[ctname] (this, constraints[ctname], name, nvalue);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tif (e.message == \"null\")\n\t\t\t\t\tbreak;\n\n\t\t\t\tif (!this._silent)\n\t\t\t\t\tthis.dispatchEvent (\"constraintError\", { constraint: ctname, message: e.message, name: name, value: value });\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn (this.data[name] = nvalue);\n\t},\n\n\t/**\n\t**\tTriggers property events to indicate a property is changing. First triggers \"propertyChanging\" and then\n\t**\t\"propertyChanged\". If the first event returns false the second event will not be triggered.\n\t**\n\t**\t>> void _propertyEvent (string name, T prev, T value, bool direct=false);\n\t*/\n\t_propertyEvent: function (name, prev, value, direct)\n\t{\n\t\tvar temp = { name: name, old: prev, value: value, level: this._level };\n\n\t\tvar evt = this.dispatchEvent (\"propertyChanging\", temp);\n\n\t\tif (!direct)\n\t\t\ttemp.value = this._set (name, temp.value);\n\t\telse\n\t\t\tthis.data[name] = temp.value;\n\n\t\tif (evt != null && evt.ret.length && evt.ret[0] === false)\n\t\t\treturn;\n\n\t\tthis.dispatchEvent (\"propertyChanged.\" + name, temp);\n\t\tthis.dispatchEvent (\"propertyChanged\", temp);\n\n\t\tthis.changedList.push (name);\n\t},\n\n\t/**\n\t**\tSets one or more properties of the model. Possible arguments can be two strings or a map.\n\t**\n\t**\t>> Model set (string name, T value, bool force=true);\n\t**\t>> Model set (string name, T value, bool silent=false);\n\t**\t>> Model set (string name, T value);\n\t**\t>> Model set (object data);\n\t*/\n\tset: function ()\n\t{\n\t\tvar n = arguments.length;\n\t\tvar force = false, silent = false;\n\n\t\tif ((n > 2 || (n == 2 && Rinn.typeOf(arguments[0]) == \"object\")) && Rinn.typeOf(arguments[n-1]) == \"boolean\")\n\t\t{\n\t\t\tforce = arguments[--n];\n\t\t\tif (force === false) silent = true;\n\t\t}\n\n\t\tif (this._level == 0)\n\t\t{\n\t\t\tthis.changedList = [];\n\t\t}\n\n\t\tthis._level++;\n\n\t\tif (n == 2)\n\t\t{\n\t\t\tif (this.data[arguments[0]] !== arguments[1] || force)\n\t\t\t{\n\t\t\t\tif (!this._silent && !silent)\n\t\t\t\t\tthis._propertyEvent (arguments[0], this.data[arguments[0]], this._validate (arguments[0], arguments[1]));\n\t\t\t\telse\n\t\t\t\t\tthis._set (arguments[0], arguments[1]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (var i in arguments[0])\n\t\t\t{\n\t\t\t\tif (this.data[i] !== arguments[0][i] || force)\n\t\t\t\t{\n\t\t\t\t\tif (!this._silent && !silent)\n\t\t\t\t\t\tthis._propertyEvent (i, this.data[i], this._validate (i, arguments[0][i]));\n\t\t\t\t\telse\n\t\t\t\t\t\tthis._set (i, arguments[0][i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!--this._level && this.changedList.length && !silent && !this._silent)\n\t\t\tthis.dispatchEvent (\"modelChanged\", { fields: this.changedList });\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns true if the given key exists in the model.\n\t**\n\t**\t>> boolean has (string name);\n\t*/\n\thas: function (name)\n\t{\n\t\treturn name in this.data;\n\t},\n\n\t/**\n\t**\tReturns the value of a property. If no name is specified the whole map of properties will be returned.\n\t**\tIf a boolean value of \"true\" is provided the properties map will be returned but first will be compacted\n\t**\tusing the default data to ensure only valid properties are present.\n\t**\n\t**\t>> T get (string name);\n\t**\t>> object get ();\n\t**\t>> object get (true);\n\t**\t>> object get (false);\n\t**\t\n\t*/\n\tget: function (name, def)\n\t{\n\t\tif (arguments.length == 0 || name === false)\n\t\t\treturn this.data;\n\n\t\tif (arguments.length == 1 && name === true)\n\t\t\treturn this.flatten ();\n\n\t\tif (arguments.length == 2)\n\t\t\treturn this.data[name] === undefined ? def : this.data[name];\n\n\t\treturn this.data[name];\n\t},\n\n\t/**\n\t**\tReturns the value of a property as an integer number.\n\t**\n\t**\t>> int getInt (string name, [int def]);\n\t*/\n\tgetInt: function (name, def)\n\t{\n\t\tif (arguments.length == 2)\n\t\t\treturn this.data[name] === undefined ? def : parseInt (this.data[name]);\n\n\t\treturn parseInt (this.data[name]);\n\t},\n\n\t/**\n\t**\tReturns the value of a property as a floating point number.\n\t**\n\t**\t>> float getFloat (string name, [float def]);\n\t*/\n\tgetFloat: function (name, def)\n\t{\n\t\tif (arguments.length == 2)\n\t\t\treturn this.data[name] === undefined ? def : parseFloat (this.data[name]);\n\n\t\treturn parseFloat (this.data[name]);\n\t},\n\n\t/**\n\t**\tReturns the value of a property as a boolean value (true or false).\n\t**\n\t**\t>> bool getBool (string name, [bool def]);\n\t**\t\n\t*/\n\tgetBool: function (name, def)\n\t{\n\t\tif (arguments.length == 2)\n\t\t\tname = this.data[name] === undefined ? def : this.data[name];\n\t\telse\n\t\t\tname = this.data[name];\n\n\t\tif (name === \"true\" || name === true)\n\t\t\treturn true;\n\n\t\tif (name === \"false\" || name === false)\n\t\t\treturn false;\n\n\t\treturn parseInt (name) ? true : false;\n\t},\n\n\t/**\n\t**\tReturns a reference object for a model property. The resulting object contains two methods\n\t**\tnamed \"get\" and \"set\" to modify the value of the property.\n\t**\n\t**\t>> object getReference (string name);\n\t*/\n\tgetReference: function (name)\n\t{\t\n\t\tvar m = this;\n\n\t\treturn {\n\t\t\tget: function() {\n\t\t\t\treturn m.get(name);\n\t\t\t},\n\n\t\t\tset: function(value) {\n\t\t\t\tm.set(name, value);\n\t\t\t}\n\t\t};\n\t},\n\n\t/**\n\t**\tSets or returns a constraint given the property name. \n\t**\n\t**\t>> Model constraint (string field, string constraint, T value);\n\t**\t>> Model constraint (string field, object constraint);\n\t**\t>> Model constraint (object constraints);\n\t**\t>> object constraint (string field);\n\t*/\n\tconstraint: function (field, constraint, value)\n\t{\n\t\tif (arguments.length == 3 || arguments.length == 2 || (arguments.length == 1 && Rinn.typeOf(field) == \"object\"))\n\t\t{\n\t\t\tif (this.constraints === this.constructor.prototype.constraints)\n\t\t\t\tthis.constraints = Rinn.clone (this.constraints);\n\n\t\t\tswitch (arguments.length)\n\t\t\t{\n\t\t\t\tcase 1:\n\t\t\t\t\tRinn.override (this.constraints, field);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\t\t\t\t\tRinn.override (this.constraints[field], constraint);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 3:\n\t\t\t\t\tthis.constraints[field][constraint] = value;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\treturn !field ? this : this.constraints[field];\n\t},\n\n\t/**\n\t**\tReturns a compact version of the model properties. That is, a map only with validated properties that are\n\t**\talso present in the default data map. Returns null if the object is not compliant. If the \"safe\" parameter\n\t**\tis set one last property named \"class\" will be attached, this specifies the original classPath of the object.\n\t**\n\t**\t>> object flatten ([bool safe=false]);\n\t*/\n\tflatten: function (safe, rsafe)\n\t{\n\t\tif (safe)\n\t\t{\n\t\t\tvar data = this.flatten(false, true);\n\t\t\tif (data == null) return null;\n\n\t\t\tdata[\"class\"] = this.classPath;\n\t\t\treturn data;\n\t\t}\n\n\t\tif (!this.constraints && !this.defaults)\n\t\t\treturn this.data;\n\n\t\tif (!this.isCompliant())\n\t\t\treturn { };\n\n\t\tvar constraints = this.constraints;\n\t\tvar keys = this.defaults ? (Rinn.typeOf(this.defaults) == \"function\" ? this.defaults() : this.defaults) : this.constraints;\n\n\t\tvar data = { };\n\n\t\tfor (var i in this.data)\n\t\t{\n\t\t\tif (!(i in keys)) continue;\n\n\t\t\tif (constraints && constraints[i])\n\t\t\t{\n\t\t\t\tvar ct = constraints[i];\n\n\t\t\t\tif (ct.model)\n\t\t\t\t{\n\t\t\t\t\tdata[i] = this.data[i] ? this.data[i].flatten(rsafe) : null;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (ct.arrayof)\n\t\t\t\t{\n\t\t\t\t\tdata[i] = [];\n\n\t\t\t\t\tfor (var j = 0; j < this.data[i].length; j++)\n\t\t\t\t\t\tdata[i][j] = this.data[i][j] ? this.data[i][j].flatten(rsafe) : null;\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (ct.cls)\n\t\t\t\t{\n\t\t\t\t\tdata[i] = this.data[i] ? this.data[i].flatten() : null;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdata[i] = this.data[i];\n\t\t}\n\n\t\treturn data;\n\t},\n\n\t/**\n\t**\tRemoves a property or a list of properties.\n\t**\n\t**\t>> void remove (string name, [bool nsilent=true]);\n\t**\t>> void remove (array name, [bool nsilent=true]);\n\t*/\n\tremove: function (name, nsilent)\n\t{\n\t\tif (Rinn.typeOf(name) == \"array\")\n\t\t{\n\t\t\tfor (var i = 0; i < name.length; i++)\n\t\t\t\tdelete this.data[name[i]];\n\n\t\t\tif (nsilent !== false && !this._silent)\n\t\t\t\tthis.dispatchEvent (\"propertyRemoved\", { fields: name });\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdelete this.data[name];\n\n\t\t\tif (nsilent !== false && !this._silent)\n\t\t\t\tthis.dispatchEvent (\"propertyRemoved\", { fields: [name] });\n\t\t}\n\t},\n\n\t/**\n\t**\tTriggers data change events for one or more properties. Ensure that silent mode is not enabled or else\n\t**\tthis method will have no effect. If no parameters are provided a full update will be triggered on all of\n\t**\tthe model properties.\n\t**\n\t**\t>> Model update (array fields);\n\t**\t>> Model update (string name);\n\t**\t>> Model update (bool forceModelChanged);\n\t**\t>> Model update ();\n\t*/\n\tupdate: function (fields, direct)\n\t{\n\t\tif (this._silent) return this;\n\n\t\tif (this._level == 0)\n\t\t{\n\t\t\tthis.changedList = [];\n\t\t}\n\n\t\tthis._level++;\n\n\t\tif (fields && Rinn.typeOf(fields) == 'string')\n\t\t{\n\t\t\tthis._propertyEvent (fields, this.data[fields], this.data[fields], direct);\n\t\t}\n\t\telse if (fields && Rinn.typeOf(fields) == 'array')\n\t\t{\n\t\t\tfor (var i of fields)\n\t\t\t\tthis._propertyEvent (i, this.data[i], this.data[i], direct);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (var i in this.data)\n\t\t\t\tthis._propertyEvent (i, this.data[i], this.data[i], direct);\n\t\t}\n\n\t\tif (!--this._level && !this._silent && (this.changedList.length != 0 || fields === true))\n\t\t\tthis.dispatchEvent (\"modelChanged\", { fields: this.changedList });\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tValidates one or mode model properties using the defined constraints. If no parameters are provided all of\n\t**\tthe properties in the model will be validated.\n\t**\n\t**\t>> Model validate (array fields);\n\t**\t>> Model validate (string name);\n\t**\t>> Model validate ();\n\t*/\n\tvalidate: function (fields)\n\t{\n\t\tif (!this.constraints) return this;\n\n\t\tif (fields && Rinn.typeOf(fields) == \"string\")\n\t\t{\n\t\t\tthis._set (fields, this.data[fields])\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (var i in this.data)\n\t\t\t{\n\t\t\t\tif (fields && Rinn.indexOf(fields, i) == -1)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis._set (i, this.data[i])\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tValidates all the properties in the model and returns a boolean indicating if all of them comply with the\n\t**\tconstraints defined in the model.\n\t**\n\t**\t>> bool isCompliant ();\n\t*/\n\tisCompliant: function ()\n\t{\n\t\tif (!this.constraints) return true;\n\n\t\ttry\n\t\t{\n\t\t\tfor (var i in this.data)\n\t\t\t\tthis._validate (i, this.data[i]);\n\n\t\t\treturn true;\n\t\t}\n\t\tcatch (e) {\n\t\t}\n\n\t\treturn false;\n\t},\n\n\t/**\n\t**\tRegisters an event handler for changes in a specific property of the model.\n\t**\n\t**\t>> void observe (string property, function handler, object context);\n\t*/\n\tobserve: function (property, handler, context)\n\t{\n\t\tthis.addEventListener (\"propertyChanged.\" + property, handler, context);\n\t},\n\n\t/**\n\t**\tUnregisters an event handler from changes in a specific property of the model.\n\t**\n\t**\t>> void unobserve (string property, function handler, object context);\n\t*/\n\tunobserve: function (property, handler, context)\n\t{\n\t\tthis.removeEventListener (\"propertyChanged.\" + property, handler, context);\n\t},\n\n\t/**\n\t**\tAdds a propertyChanged event handler for the given property. The property name can have an event namespace prepended and separated by colon.\n\t**\n\t**\t>> void watch (string property, function handler);\n\t*/\n\twatch: function (property, handler)\n\t{\n\t\tproperty = property.split(':');\n\n\t\tif (property.length == 1)\n\t\t{\n\t\t\tproperty[1] = property[0];\n\t\t\tproperty[0] = 'watch';\n\t\t}\n\n\t\tthis.addEventListener (property[0]+\":propertyChanged.\"+property[1], function (evt, args) {\n\t\t\thandler (args.value, args, evt);\n\t\t});\n\t},\n\n\t/**\n\t**\tRemoves propertyChanged handlers related to the specified property. The property name can have an event namespace prepended and separated by colon.\n\t**\n\t**\t>> void unwatch (string property);\n\t*/\n\tunwatch: function (property)\n\t{\n\t\tproperty = property.split(':');\n\t\tif (property.length == 1)\n\t\t{\n\t\t\tproperty[1] = property[0];\n\t\t\tproperty[0] = 'watch';\n\t\t}\n\n\t\tthis.removeEventListener (property[0]+\":propertyChanged.\"+property[1]);\n\t},\n\n\t/**\n\t * Triggers a field change event. Even if the value of the field is the same as the model's, the event will still be triggered.\n\t */\n\ttrigger: function (name, value=null)\n\t{\n\t\treturn this.set(name, value, true);\n\t},\n\n\t/**\n\t**\tSerializes the model into a string.\n\t**\n\t**\tstring toString ();\n\t*/\n\ttoString: function ()\n\t{\n\t\treturn Rinn.serialize(this.get (true));\n\t}\n});\n\n\n/**\n**\tImport model constraints.\n*/\n\nimport Constraints from './model-constraints.js';\n_Model.Constraints = Constraints;\n\nexport default _Model;\n","\nimport Rinn from './alpha.js';\nimport Model from './model.js';\n\n/**\n**\tGeneric list for models.\n*/\n\nexport default Model.extend\n({\n\t/**\n\t**\tName of the class.\n\t*/\n\tclassName: \"ModelList\",\n\n\t/**\n\t**\tClass of the items in the list, can be overriden by child classes to impose a more strict constraint.\n\t*/\n\titemt: Model,\n\n\t/**\n\t**\tMirror of data.contents\n\t*/\n\tcontents: null,\n\n\t/**\n\t**\tIDs of every item in the contents.\n\t*/\n\titemId: null,\n\n\t/**\n\t**\tAutoincremental ID for the next item to be added.\n\t*/\n\tnextId: null,\n\n\t/**\n\t**\tDefault properties of the model.\n\t*/\n\tdefaults:\n\t{\n\t\tcontents: null\n\t},\n\n\t/**\n\t**\tConstraints of the model to ensure integrity.\n\t*/\n\tconstraints:\n\t{\n\t\tcontents: {\n\t\t\ttype: \"array\",\n\t\t\tarrayof: \"@itemt\"\n\t\t}\n\t},\n\n\t/**\n\t**\tConstructor.\n\t*/\n\t__ctor: function (...args)\n\t{\n\t\tthis.itemId = [];\n\t\tthis.nextId = 0;\n\n\t\tthis._super.Model.__ctor(...args);\n\t},\n\n\t/**\n\t**\tInitialization epilogue. Called after initialization and after model properties are set.\n\t*/\n\tready: function ()\n\t{\n\t\tthis._eventGroup = \"ModelList_\" + Date.now() + \":modelChanged\";\n\n\t\tthis.contents = this.data.contents;\n\t},\n\n\t/**\n\t**\tConnects the event handlers to the item.\n\t**\n\t**\t>> Model _bind (int iid, Model item);\n\t*/\n\t_bind: function (iid, item)\n\t{\n\t\tif (item && item.addEventListener) item.addEventListener (this._eventGroup, this._onItemEvent, this, iid);\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tDisconnects the event handlers from the item.\n\t**\n\t**\t>> Model _unbind (Model item);\n\t*/\n\t_unbind: function (item)\n\t{\n\t\tif (item && item.removeEventListener) item.removeEventListener (this._eventGroup);\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tHandler for item events.\n\t**\n\t**\t>> Model _onItemEvent (Event evt, object args, int iid);\n\t*/\n\t_onItemEvent: function (evt, args, iid)\n\t{\n\t\tthis.prepareEvent (\"itemChanged\", { id: iid, item: evt.source }).from (evt)\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\t},\n\n\t/**\n\t**\tReturns the number of items in the list.\n\t**\n\t**\t>> int length ();\n\t*/\n\tlength: function ()\n\t{\n\t\treturn this.data.contents.length;\n\t},\n\n\t/**\n\t**\tClears the contents of the list.\n\t**\n\t**\t>> void clear ();\n\t*/\n\tclear: function ()\n\t{\n\t\tfor (var i = 0; i < this.data.contents; i++)\n\t\t\tthis._unbind (this.data.contents[i]);\n\n\t\tthis.itemId = [];\n\t\tthis.nextId = 0;\n\n\t\tthis.contents = this.data.contents = [];\n\n\t\tthis.prepareEvent (\"itemsCleared\")\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tSets the contents of the list with the specified array. All items will be ensured to be of the same model\n\t**\ttype as the one specified in the list.\n\t**\n\t**\t>> ModelList setData (array data);\n\t*/\n\tsetData: function (data)\n\t{\n\t\tthis.clear();\n\t\tif (!data) return this;\n\n\t\tfor (var i = 0; i < data.length; i++)\n\t\t{\n\t\t\tvar item = Rinn.ensureTypeOf(this.itemt, data[i]);\n\n\t\t\tthis.itemId.push(this.nextId++);\n\t\t\tthis.data.contents.push(item);\n\n\t\t\tthis._bind(this.nextId-1, item);\n\t\t}\n\n\t\tthis.prepareEvent (\"itemsChanged\")\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns the raw array contents of the list.\n\t**\n\t**\t>> array getData ();\n\t*/\n\tgetData: function ()\n\t{\n\t\treturn this.data.contents;\n\t},\n\n\t/**\n\t**\tReturns the item at the specified index or null if the index is out of bounds.\n\t**\n\t**\t>> Model getAt (int index);\n\t*/\n\tgetAt: function (index)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn null;\n\n\t\treturn this.data.contents[index];\n\t},\n\n\t/**\n\t**\tRemoves and returns the item at the specified index. Returns null if the index is out of bounds.\n\t**\n\t**\t>> Model removeAt (int index);\n\t*/\n\tremoveAt: function (index)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn null;\n\n\t\tlet item = this.data.contents.splice(index, 1)[0];\n\t\tlet id = this.itemId.splice(index, 1)[0];\n\n\t\tthis._unbind (item);\n\n\t\tthis.prepareEvent (\"itemRemoved\", { id: id, item: item })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume();\n\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tSets the item at the specified index. Returns false if the index is out of bounds, true otherwise. The\n\t**\titem will be ensured to be of the model defined in the list.\n\t**\n\t**\t>> bool setAt (int index, Model item);\n\t*/\n\tsetAt: function (index, item)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn false;\n\n\t\titem = Rinn.ensureTypeOf(this.itemt, item);\n\n\t\tthis._unbind(this.data.contents[index]);\n\t\tthis.data.contents[index] = item;\n\t\tthis._bind(this.itemId[index], item);\n\n\t\tthis.prepareEvent (\"itemChanged\", { id: this.itemId[index], item: item })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tNotifies a change in the item at the specified index. Returns false if the index is out of bounds.\n\t**\n\t**\t>> bool updateAt (int index);\n\t*/\n\tupdateAt: function (index)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn false;\n\n\t\tthis.prepareEvent (\"itemChanged\", { id: this.itemId[index], item: this.data.contents[index] })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tAdds an item to the bottom of the list. Returns null if the item is not an object or a model. The item\n\t**\twill be ensured to be of the model specified in the list.\n\t**\n\t**\t>> Model push (Model item);\n\t*/\n\tpush: function (item)\n\t{\n\t\tif (item && Rinn.typeOf(item) != \"object\")\n\t\t\treturn null;\n\n\t\titem = Rinn.ensureTypeOf(this.itemt, item);\n\n\t\tthis.itemId.push(this.nextId++);\n\t\tthis.data.contents.push (item);\n\t\tthis._bind(this.nextId-1, item);\n\n\t\tthis.prepareEvent (\"itemAdded\", { id: this.itemId[this.itemId.length-1], item: item, position: 'tail' })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tRemoves and returns an item from the bottom of the list.\n\t**\n\t**\t>> Model pop ();\n\t*/\n\tpop: function ()\n\t{\n\t\treturn this._unbind(this.data.contents.pop());\n\t},\n\n\t/**\n\t**\tAdds an item to the top of the list. Returns null if the item is not an object or a model. The item\n\t**\twill be ensured to be of the model specified in the list.\n\t**\n\t**\t>> Model unshift (Model item);\n\t*/\n\tunshift: function (item)\n\t{\n\t\tif (item && Rinn.typeOf(item) != \"object\")\n\t\t\treturn null;\n\n\t\titem = Rinn.ensureTypeOf(this.itemt, item);\n\n\t\tthis.itemId.unshift(this.nextId++);\n\t\tthis.data.contents.unshift (item);\n\t\tthis._bind(this.nextId-1, item);\n\n\t\tthis.prepareEvent (\"itemAdded\", { id: this.itemId[0], item: item, position: 'head' })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tRemoves and returns an item from the top of the list.\n\t**\n\t**\t>> Model shift ();\n\t*/\n\tshift: function ()\n\t{\n\t\treturn this._unbind(this.data.contents.shift());\n\t},\n\n\t/**\n\t**\tSearches for an item matching the specified partial definition and returns its index. Returns -1 if the\n\t**\titem was not found. If retObject is set to true the object will be returned instead of its index and null\n\t**\twill be returned when the item is not found.\n\t**\n\t**\tint|object find (object data, bool retObject=false);\n\t*/\n\tfind: function (data, retObject=false)\n\t{\n\t\tvar contents = this.data.contents;\n\n\t\tfor (var i = 0; i < contents.length; i++)\n\t\t{\n\t\t\tif (Rinn.partialCompare (contents[i].data, data))\n\t\t\t\treturn retObject ? contents[i] : i;\n\t\t}\n\n\t\treturn retObject ? null : -1;\n\t}\n});\n","\r\nimport Rinn from './alpha.js';\r\n\r\n/**\r\n * The utility functions in this module allow to create a very strict serialization/deserialization schema\r\n * to ensure that all values are of the specific type when stored in string format.\r\n */\r\n\r\nlet Schema =\r\n{\r\n\tType: function (proto)\r\n    {\r\n\t\tlet tmp =\r\n\t\t{\r\n            flatten: function (value, context) {\r\n                return value;\r\n            },\r\n\r\n            unflatten: function (value, context) {\r\n                return value;\r\n            }\r\n        };\r\n\r\n        return proto ? Rinn.override(tmp, proto) : tmp;\r\n    },\r\n\r\n\tString: function()\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\tflatten: function (value, context) {\r\n\t\t\t\treturn value != null ? value.toString() : null;\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn value != null ? value.toString() : null;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tInteger: function()\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\tflatten: function (value, context) {\r\n\t\t\t\treturn ~~value;\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn ~~value;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tNumber: function (precision)\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\t_precision: precision,\r\n\t\t\t_round: false,\r\n\r\n\t\t\tprecision: function (value)\r\n\t\t\t{\r\n\t\t\t\tthis._precision = ~~value;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tflatten: function (value, context)\r\n\t\t\t{\r\n\t\t\t\tvalue = parseFloat(value);\r\n\r\n\t\t\t\tif (this._precision > 0)\r\n\t\t\t\t\tvalue = (~~(value*Math.pow(10, this._precision))) / Math.pow(10, this._precision);\r\n\r\n\t\t\t\treturn value;\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn parseFloat(value);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tBool: function (compact)\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\t_compact: compact,\r\n\r\n\t\t\tcompact: function(value)\r\n\t\t\t{\r\n\t\t\t\tthis._compact = value;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tflatten: function (value, context) {\r\n\t\t\t\tvalue = ~~value;\r\n\t\t\t\treturn this._compact ? (value > 0 ? 1 : 0) : (value > 0 ? true : false);\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn (~~value) ? true : false;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tSharedString: function()\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\tflatten: function (value, context)\r\n\t\t\t{\r\n\t\t\t\tif (value == null) return 0;\r\n\r\n\t\t\t\tvalue = value.toString();\r\n\r\n                if (!(\"strings\" in context))\r\n                {\r\n                    context.index = { };\r\n                    context.strings = [ ];\r\n                }\r\n\r\n                if (!(value in context.index))\r\n                {\r\n                    context.strings.push(value);\r\n                    context.index[value] = context.strings.length;\r\n                }\r\n\r\n                return context.index[value];\r\n            },\r\n\r\n\t\t\tunflatten: function (value, context)\r\n\t\t\t{\r\n                return value == null || value == 0 ? null : context.strings[~~value - 1];\r\n            }\r\n        });\r\n    },\r\n\r\n\tArray: function (type)\r\n    {\r\n        return Schema.Type({\r\n\r\n\t\t\titemType: type,\r\n\t\t\t_debug: false,\r\n\t\t\t_filter: null,\r\n\r\n\t\t\tdebug: function(v) {\r\n\t\t\t\tthis._debug = v;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n            of: function (type) {\r\n                this.itemType = type;\r\n                return this;\r\n            },\r\n\r\n\t\t\tfilter: function (callback) {\r\n\t\t\t\tthis._filter = callback;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tflatten: function (value, context)\r\n\t\t\t{\r\n\t\t\t\tif (value == null) return null;\r\n\r\n                let o = [ ];\r\n\r\n                for (let i = 0; i < value.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (this._filter && !this._filter(value[i], i))\r\n\t\t\t\t\t\tcontinue;\r\n\r\n                    o.push(this.itemType.flatten(value[i], context));\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n\r\n\t\t\tunflatten: async function (value, context)\r\n\t\t\t{\r\n\t\t\t\tif (value == null) return null;\r\n\r\n                let o = [ ];\r\n\r\n\t\t\t\tfor (let i = 0; i < value.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\to.push(await this.itemType.unflatten(value[i], context));\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            }\r\n        });\r\n    },\r\n\r\n    Object: function()\r\n    {\r\n        return Schema.Type({\r\n\r\n            properties: [ ],\r\n\r\n            property: function (name, type, defvalue=null)\r\n            {\r\n                this.properties.push({ name: name, source: name, type: type, defvalue: defvalue });\r\n                return this;\r\n            },\r\n\r\n            propertyAlias: function (name, source, type, defvalue=null)\r\n            {\r\n                this.properties.push({ name: name, source: source, type: type, defvalue: defvalue });\r\n                return this;\r\n            },\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t{\r\n\t\t\t\t\to = { };\r\n\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (this.properties[i].source in value)\r\n\t\t\t\t\t\t\to[this.properties[i].name] = this.properties[i].type.flatten(value[this.properties[i].source], context);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\to[this.properties[i].name] = this.properties[i].type.flatten(this.properties[i].defvalue, context);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\to = [ ];\r\n\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (this.properties[i].source in value)\r\n\t\t\t\t\t\t\to.push(this.properties[i].type.flatten(value[this.properties[i].source], context));\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\to.push(this.properties[i].type.flatten(this.properties[i].defvalue, context));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n\r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o = { };\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t{\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\to[this.properties[i].name] = await this.properties[i].type.unflatten(this.properties[i].name in value ? value[this.properties[i].name] : this.properties[i].defvalue, context);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\to[this.properties[i].name] = await this.properties[i].type.unflatten(i in value ? value[i] : this.properties[i].defvalue, context);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            }\r\n        });\r\n\t},\r\n\r\n    Class: function (classConstructor)\r\n    {\r\n\t\treturn Schema.Type\r\n\t\t({\r\n            _constructor: classConstructor,\r\n\r\n            constructor: function (classConstructor)\r\n            {\r\n                this._constructor = classConstructor;\r\n                return this;\r\n            },\r\n\r\n            flatten: function (value, context)\r\n            {\r\n                return value == null ? null : value.flatten(context);\r\n            },\r\n\r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\treturn value == null ? null : await (new this._constructor()).unflatten(value, context);\r\n            }\r\n        });\r\n\t},\r\n\r\n\t/*\r\n\t**\tUsed when you want to specify just a single property.\r\n\t*/\r\n    Property: function(name, type)\r\n    {\r\n        return Schema.Type({\r\n\r\n\t\t\tproperty: name,\r\n\t\t\ttype: type,\r\n\r\n\t\t\tname: function (name)\r\n\t\t\t{\r\n\t\t\t\tthis.property = name;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tis: function (type)\r\n\t\t\t{\r\n\t\t\t\tthis.type = type;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t{\r\n\t\t\t\t\to = { };\r\n\t\t\t\t\to[this.property] = this.type.flatten(value[this.property], context);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\to = this.type.flatten(value[this.property], context);\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n\r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o = { };\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t\to[this.property] = await this.type.unflatten(value[this.property], context);\r\n\t\t\t\telse\r\n\t\t\t\t\to[this.property] = await this.type.unflatten(value, context);\r\n\r\n                return o;\r\n            }\r\n        });\r\n\t},\r\n\r\n    Map: function()\r\n    {\r\n        return Schema.Type({\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t\treturn value;\r\n\r\n\t\t\t\tlet o = [ ];\r\n\r\n\t\t\t\tfor (let i in value)\r\n\t\t\t\t{\r\n\t\t\t\t\to.push(i);\r\n\t\t\t\t\to.push(value[i]);\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n\r\n            unflatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t\treturn value;\r\n\r\n\t\t\t\tlet o = { };\r\n\r\n\t\t\t\tfor (let i = 0; i < value.length; i += 2)\r\n\t\t\t\t\to[value[i]] = value[i+1];\r\n\r\n                return o;\r\n            }\r\n        });\r\n\t},\r\n\r\n    Selector: function ()\r\n    {\r\n        return Schema.Type({\r\n\r\n\t\t\tconditions: [],\r\n\t\t\tvalue: null,\r\n\r\n\t\t\twhen: function (value, type)\r\n\t\t\t{\r\n\t\t\t\tthis.conditions.push([ (val) => val === value, type ]);\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\twith: function (value)\r\n\t\t\t{\r\n\t\t\t\tthis.value = value;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tfor (let i of this.conditions)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (i[0](this.value) === true)\r\n\t\t\t\t\t\treturn i[1].flatten(value, context);\r\n\t\t\t\t}\r\n\r\n                return null;\r\n            },\r\n\r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tfor (let i of this.conditions)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (i[0](this.value) === true)\r\n\t\t\t\t\t\treturn await i[1].unflatten(value, context);\r\n\t\t\t\t}\r\n\r\n                return null;\r\n            }\r\n\r\n        });\r\n\t}\r\n};\r\n\r\nexport default Schema;\r\n","\r\nimport Class from './class.js';\r\n\r\n/**\r\n**\tClass used to add flattening and unflattening capabilities to any object. A \"flat\" object is an object composed\r\n**\tonly of native types, that is: `null,` `boolean`, `integer`, `number`, `array` or `object`.\r\n*/\r\n\r\nexport default Class.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"Flattenable\",\r\n\r\n\t/**\r\n\t**\tType schema used to flatten/unflatten the contents of this class. See Schema class for more information.\r\n\t*/\r\n\ttypeSchema: null,\r\n\r\n\t/**\r\n\t**\tReturns the flattened contents of the object.\r\n\t*/\r\n\tflatten: function (context)\r\n\t{\r\n\t\treturn this.typeSchema.flatten(this, context);\r\n\t},\r\n\r\n\t/**\r\n\t**\tUnflattens the given object and overrides the local contents.\r\n\t*/\r\n\tunflatten: async function (value, context)\r\n\t{\r\n\t\tObject.assign(this, await this.typeSchema.unflatten(value, context));\r\n\t\tawait this.onUnflattened();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecuted when the unflatten() method is called on the object.\r\n\t*/\r\n\tonUnflattened: async function ()\r\n\t{\r\n\t}\r\n});\r\n","\r\nimport Flattenable from './flattenable.js';\r\nimport Schema from './schema.js';\r\nimport Rinn from './alpha.js';\r\n\r\n/**\r\n**\tFlattenable collection class, used to store items and manipulate them. The items should also be flattenable.\r\n*/\r\n\r\nexport default Flattenable.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"Collection\",\r\n\r\n\t/**\r\n\t**\tDescribes the type schema of the underlying items.\r\n\t*/\r\n\titemTypeSchema: null,\r\n\r\n\t/**\r\n\t**\tArray of items.\r\n\t*/\r\n\titems: null, /* Array */\r\n\r\n\t/**\r\n\t**\tConstructs the collection.\r\n\t*/\r\n\t__ctor: function (itemTypeSchema)\r\n\t{\r\n\t\tif (!itemTypeSchema) itemTypeSchema = this.itemTypeSchema;\r\n\r\n\t\tif (itemTypeSchema)\r\n\t\t\tthis.typeSchema = Schema.Property('items').is(Schema.Array().of(itemTypeSchema));\r\n\r\n\t\tthis.reset();\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecuted after the collection has been unflattened, re-adds the items to ensure onItemAdded() is called.\r\n\t*/\r\n\tonUnflattened: function()\r\n\t{\r\n\t\tlet items = this.items;\r\n\t\tthis.reset();\r\n\r\n\t\tfor (let i of items)\r\n\t\t\tthis.add(i);\r\n\t},\r\n\r\n\t/**\r\n\t * \tExecuted when the value in `items` is changed.\r\n\t */\r\n\titemsReferenceChanged: function()\r\n\t{\r\n\t},\r\n\r\n\t/*\r\n\t**\tResets the collection to empty. Note that onItemRemoved will not be called.\r\n\t*/\r\n\treset: function ()\r\n\t{\r\n\t\tthis.items = [];\r\n\t\tthis.itemsReferenceChanged();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tClears the contents of the collection (removes each item manually, onItemRemoved will be called).\r\n\t*/\r\n\tclear: function ()\r\n\t{\r\n\t\tvar items = this.items;\r\n\t\tthis.reset();\r\n\r\n\t\tfor (var i = 0; i < items.length; i++)\r\n\t\t\tthis.onItemRemoved (items[i], 0);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tSorts the collection. A comparison function should be provided, or the name of a property to sort by.\r\n\t**\r\n\t**\tObject sort (fn: Function)\r\n\t**\tObject sort (prop: string, [desc:bool=false])\r\n\t*/\r\n\tsort: function (fn, desc)\r\n\t{\r\n\t\tif (typeof(fn) != \"function\")\r\n\t\t{\r\n\t\t\tthis.items.sort(function(a, b)\r\n\t\t\t{\r\n\t\t\t\treturn (a[fn] <= b[fn] ? -1 : 1) * (desc === true ? -1 : 1);\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis.items.sort(fn);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tSearches for an item with the specified fields and returns it. The \"inc\" object is the \"inclusive\" map, meaning all fields must match\r\n\t**\tand the optional \"exc\" is the exclusive map, meaning not even one field should match.\r\n\t**\r\n\t**\tObject findItem (inc: Object, exc: Object);\r\n\t*/\t\r\n\tfindItem: function (inc, exc)\r\n\t{\r\n\t\tif (!this.items) return null;\r\n\r\n\t\tfor (var i = 0; i < this.items.length; i++)\r\n\t\t{\r\n\t\t\tif (exc && Rinn.partialCompare(this.items[i], exc))\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tif (Rinn.partialCompare(this.items[i], inc))\r\n\t\t\t\treturn this.items[i];\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the container array.\r\n\t*/\r\n\tgetItems: function ()\r\n\t{\r\n\t\treturn this.items;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the number of items in the collection.\r\n\t*/\r\n\tlength: function ()\r\n\t{\r\n\t\treturn this.items.length;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns true if the collection is empty.\r\n\t*/\r\n\tisEmpty: function ()\r\n\t{\r\n\t\treturn !this.items.length;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the index of the specified item, or -1 if not found.\r\n\t*/\r\n\tindexOf: function (item)\r\n\t{\r\n\t\treturn this.items.indexOf(item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the item at the specified index, or null if not found. When `relative` is true, negative offsets are allowed such that -1 refers to the last item.\r\n\t*/\r\n\tgetAt: function (index, relative=false)\r\n\t{\r\n\t\tif (index < 0 && relative == true)\r\n\t\t\tindex += this.items.length;\r\n\r\n\t\treturn index >= 0 && index < this.items.length ? this.items[index] : null;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the first item in the collection.\r\n\t*/\r\n\tfirst: function ()\r\n\t{\r\n\t\treturn this.getAt(0);\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the last item in the collection.\r\n\t*/\r\n\tlast: function ()\r\n\t{\r\n\t\treturn this.getAt(-1, true);\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item at the specified index, effectively moving the remaining items to the right.\r\n\t*/\r\n\taddAt: function (index, item)\r\n\t{\r\n\t\tif (!item || !this.onBeforeItemAdded (item))\r\n\t\t\treturn this;\r\n\r\n\t\tif (index < 0) index = 0;\r\n\t\tif (index > this.items.length) index = this.items.length;\r\n\r\n\t\tif (index == 0)\r\n\t\t{\r\n\t\t\tthis.items.unshift(item);\r\n\t\t}\r\n\t\telse if (index == this.items.length)\r\n\t\t{\r\n\t\t\tthis.items.push(item);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar tmp = this.items.splice(0, index);\r\n\t\t\ttmp.push(item);\r\n\r\n\t\t\tthis.items = tmp.concat(this.items);\r\n\t\t\tthis.itemsReferenceChanged();\r\n\t\t}\r\n\r\n\t\tthis.onItemAdded (item);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item to the start of the collection, onBeforeItemAdded and onItemAdded will be triggered.\r\n\t*/\r\n\tunshift: function (item)\r\n\t{\r\n\t\treturn this.addAt(0, item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item to the end of the collection, onBeforeItemAdded and onItemAdded will be triggered.\r\n\t*/\r\n\tpush: function (item)\r\n\t{\r\n\t\treturn this.addAt(this.items.length, item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item to the end of the collection, onBeforeItemAdded and onItemAdded will be triggered.\r\n\t*/\r\n\tadd: function (item)\r\n\t{\r\n\t\treturn this.push(item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves the item at the specified index. When `relative` is true, negative offsets are allowed such that -1 refers to the last item.\r\n\t*/\r\n\tremoveAt: function (index, relative=false)\r\n\t{\r\n\t\tif (index < 0 && relative == true)\r\n\t\t\tindex += this.items.length;\r\n\r\n\t\tif (index < 0 || index >= this.items.length)\r\n\t\t\treturn null;\r\n\r\n\t\tvar item = this.items[index];\r\n\t\tthis.items.splice (index, 1);\r\n\t\tthis.onItemRemoved (item, index);\r\n\r\n\t\treturn item;\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves an item from the end of the collection.\r\n\t*/\r\n\tpop: function (item)\r\n\t{\r\n\t\treturn this.removeAt(-1, true);\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves an item from the start of the collection.\r\n\t*/\r\n\tshift: function (item)\r\n\t{\r\n\t\treturn this.removeAt(0);\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves the specified item from the collection.\r\n\t*/\r\n\tremove: function (item)\r\n\t{\r\n\t\treturn this.removeAt (this.indexOf(item));\r\n\t},\r\n\r\n\t/*\r\n\t**\tRuns the specified callback for each of the items in the collection, if false is returned by the callback this function\r\n\t**\twill exit immediately. Parameters to the callback are: (item, index, collection).\r\n\t*/\r\n\tforEach: function (callback)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = 0; i < this.items.length; i++)\r\n\t\t\tif (callback (this.items[i], i, this) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecutes a method call with the specified parameters on each of the items in the collection, if false is returned by the\r\n\t**\titem's method this function will exit immediately.\r\n\t*/\r\n\tforEachCall: function (method, ...args)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = 0; i < this.items.length; i++)\r\n\t\t\tif (this.items[i][method] (...args) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExactly the same as forEach but in reverse order.\r\n\t*/\r\n\tforEachRev: function (callback)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = this.items.length-1; i >= 0; i--)\r\n\t\t\tif (callback (this.items[i], i, this) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExactly the same as forEachCall but in reverse order.\r\n\t*/\r\n\tforEachRevCall: function (method, ...args)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = this.items.length-1; i >= 0; i--)\r\n\t\t\tif (this.items[i][method] (...args) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tHandler for the beforeItemAdded event. If returns false the item will not be added.\r\n\t*/\r\n\tonBeforeItemAdded: function (item)\r\n\t{\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/*\r\n\t**\tHandler for the itemAdded event.\r\n\t*/\r\n\tonItemAdded: function (item)\r\n\t{\r\n\t},\r\n\r\n\t/*\r\n\t**\tHandler for the itemRemoved event.\r\n\t*/\r\n\tonItemRemoved: function (item)\r\n\t{\r\n\t}\r\n});\r\n","\nimport Rinn from './alpha.js';\n\n/**\n**\tTemplating module. The template formats available are shown below, note that the sym-open and sym-close symbols are by\n**\tdefault the square brackets, however those can be modified since are just parameters.\n**\n**\tHTML Escaped Output:\t\t\t[data.value]\t\t\t\t\tEscapes HTML characters from the output.\n**\tRaw Output:\t\t\t\t\t\t[!data.value]\t\t\t\t\tDoes not escape HTML characters from the output (used to output direct HTML).\n**\tDouble-Quoted Escaped Output:\t[data.value]\t\t\t\t\tEscapes HTML characters and surrounds with double quotes.\n**\tImmediate Reparse:\t\t\t\t[<....] [@....] \"...\" '...'\t\tReparses the contents as if parseTemplate() was called again.\n**\tImmediate Output:\t\t\t\t[:...]\t\t\t\t\t\t\tTakes the contents and outputs exactly as-is without format and optionally surrounded by the\n**\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsym-open and sym-close symbols when the first character is not '<', sym_open or space.\n**\tFiltered Output:\t\t\t\t[functionName ... <expr> ...]\tRuns a function call, 'expr' can be any of the allowed formats shown here (nested if desired),\n**\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfunctionName should map to one of the available expression functions registered in the\n**\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tRinn.Template.functions map, each of which have their own parameters.\n*/\n\nlet Template =\n{\n\t/*\n\t**\tStrict mode flag. When set, any undefined expression function will trigger an exception.\n\t*/\n\tstrict: false,\n\n\t/**\n\t**\tParses a template and returns the compiled 'parts' structure to be used by the 'expand' method.\n\t**\n\t**\t>> array parseTemplate (string template, char sym_open, char sym_close, bool is_tpl=false);\n\t*/\n\tparseTemplate: function (template, sym_open, sym_close, is_tpl=false, root=1)\n\t{\n\t\tlet nflush = 'string', flush = null, state = 0, count = 0;\n\t\tlet str = '', parts = [], mparts = parts, nparts = false;\n\n\t\tif (is_tpl === true)\n\t\t{\n\t\t\ttemplate = template.trim();\n\t\t\tnflush = 'identifier';\n\t\t\tstate = 10;\n\n\t\t\tmparts.push(parts = []);\n\t\t}\n\n\t\ttemplate += \"\\0\";\n\n\t\tfunction unescape (value)\n\t\t{\n\t\t\tif (typeof(value) == 'object')\n\t\t\t{\n\t\t\t\tif (value instanceof Array)\n\t\t\t\t{\n\t\t\t\t\tfor (let i = 0; i < value.length; i++)\n\t\t\t\t\t\tunescape(value[i]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvalue.data = unescape(value.data);\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < value.length; i++)\n\t\t\t{\n\t\t\t\tif (value[i] == '\\\\')\n\t\t\t\t{\n\t\t\t\t\tlet r = value[i+1];\n\n\t\t\t\t\tswitch (r)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase 'n': r = \"\\n\"; break;\n\t\t\t\t\t\tcase 'r': r = \"\\r\"; break;\n\t\t\t\t\t\tcase 'f': r = \"\\f\"; break;\n\t\t\t\t\t\tcase 'v': r = \"\\v\"; break;\n\t\t\t\t\t\tcase 't': r = \"\\t\"; break;\n\t\t\t\t\t\tcase 's': r = \"\\s\"; break;\n\t\t\t\t\t\tcase '\"': r = \"\\\"\"; break;\n\t\t\t\t\t\tcase \"'\": r = \"\\'\"; break;\n\t\t\t\t\t}\n\n\t\t\t\t\tvalue = value.substr(0, i) + r + value.substr(i+2);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\n\t\tfunction emit (type, data)\n\t\t{\n\t\t\tif (type == 'template')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, sym_open, sym_close, true, 0);\n\t\t\t}\n\t\t\telse if (type == 'parse')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, sym_open, sym_close, false, 0);\n\t\t\t\ttype = 'base-string';\n\n\t\t\t\tif (Rinn.typeOf(data) == 'array')\n\t\t\t\t{\n\t\t\t\t\ttype = data[0].type;\n\t\t\t\t\tdata = data[0].data;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (type == 'parse-trim-merge')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data.trim().split('\\n').map(i => i.trim()).join(\"\\n\"), sym_open, sym_close, false, 0);\n\t\t\t}\n\t\t\telse if (type == 'parse-merge')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, sym_open, sym_close, false, 0);\n\t\t\t}\n\t\t\telse if (type == 'parse-merge-alt')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, '{', '}', false, 0);\n\t\t\t}\n\n\t\t\tif (type == 'parse-merge' || type == 'parse-merge-alt' || type == 'parse-trim-merge')\n\t\t\t{\n\t\t\t\tfor (let i = 0; i < data.length; i++)\n\t\t\t\t{\n\t\t\t\t\tparts.push(data[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t\tparts.push({ type: type, data: data });\n\n\t\t\tif (nparts)\n\t\t\t{\n\t\t\t\tmparts.push(parts = []);\n\t\t\t\tnparts = false;\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = 0; i < template.length; i++)\n\t\t{\n\t\t\tif (template[i] == '\\\\')\n\t\t\t{\n\t\t\t\tstr += '\\\\';\n\t\t\t\tstr += template[++i];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (state)\n\t\t\t{\n\t\t\t\tcase 0:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '<')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 1; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'parse-merge';\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '@')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 1; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'parse-trim-merge';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == ':')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 12; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'string';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 1; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'template';\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tstr += template[i];\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\n\t\t\t\tcase 1:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 0;\n\t\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 10:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '.')\n\t\t\t\t\t{\n\t\t\t\t\t\temit (nflush, str);\n\t\t\t\t\t\temit ('access', '.');\n\n\t\t\t\t\t\tnflush = 'identifier';\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i].match(/[\\t\\n\\r\\f\\v ]/) != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\tnflush = 'identifier';\n\t\t\t\t\t\tnparts = true;\n\n\t\t\t\t\t\twhile (template[i].match(/[\\t\\n\\r\\f\\v ]/) != null) i++;\n\t\t\t\t\t\ti--;\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '<')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 11; count = 1; nflush = 'parse-merge';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '@')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 11; count = 1; nflush = 'parse-trim-merge';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '\"')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 14; count = 1; nflush = 'parse-merge';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '\\'')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 15; count = 1; nflush = 'parse-merge';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '`')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 16; count = 1; nflush = 'parse-merge-alt';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == ':')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 13; count = 1; nflush = 'string';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) emit (nflush, str);\n\t\t\t\t\t\tstate = 11; count = 1; str = ''; nflush = 'parse';\n\t\t\t\t\t\tstr += template[i];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (nflush != 'identifier')\n\t\t\t\t\t{\n\t\t\t\t\t\temit (nflush, str);\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tnflush = 'identifier';\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\t\n\t\t\t\tcase 11:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 12:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (str.length != 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (!(str[0] == '<' || str[0] == '[' || str[0] == ' '))\n\t\t\t\t\t\t\t\t\tstr = sym_open + str + sym_close;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tstate = 0;\n\t\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 13:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!(str[0] == '<' || str[0] == '[' || str[0] == ' '))\n\t\t\t\t\t\t\t\tstr = sym_open + str + sym_close;\n\n\t\t\t\t\t\t\tstate = 10;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 14:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == '\"')\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + '\"');\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 15:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == '\\'')\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + '\\'');\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 16:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == '`')\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + '`');\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (flush)\n\t\t\t{\n\t\t\t\temit (flush, str);\n\t\t\t\tflush = str = '';\n\t\t\t}\n\t\t}\n\n\t\tif (!is_tpl)\n\t\t{\n\t\t\tlet i = 0;\n\t\t\twhile (i < mparts.length)\n\t\t\t{\n\t\t\t\tif (mparts[i].type == 'string' && mparts[i].data == '')\n\t\t\t\t\tmparts.splice(i, 1);\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\ti = mparts.length-1;\n\t\t\twhile (i > 0)\n\t\t\t{\n\t\t\t\tif (mparts[i].type == 'string' && mparts[i].data == '')\n\t\t\t\t\tmparts.splice(i--, 1);\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (mparts.length == 0)\n\t\t\t\tmparts.push({ type: 'string', data: '' });\n\t\t}\n\n\t\tif (root)\n\t\t\tunescape(mparts);\n\n\t\treturn mparts;\n\t},\n\n\t/**\n\t**\tParses a template and returns the compiled 'parts' structure to be used by the 'expand' method. This\n\t**\tversion assumes the sym_open and sym_close chars are [ and ] respectively.\n\t**\n\t**\t>> array parse (string template);\n\t*/\n\tparse: function (template)\n\t{\n\t\treturn this.parseTemplate(template.trim(), '[', ']', false);\n\t},\n\n\t/**\n\t**\tRemoves all static parts from a parsed template.\n\t**\n\t**\t>> array clean (array parts);\n\t*/\n\tclean: function (parts)\n\t{\n\t\tfor (let i = 0; i < parts.length; i++)\n\t\t{\n\t\t\tif (parts[i].type != 'template')\n\t\t\t{\n\t\t\t\tparts.splice(i, 1);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\n\t\treturn parts;\n\t},\n\n\t/**\n\t**\tExpands a template using the given data object, ret can be set to 'text' or 'obj' allowing to expand the template as\n\t**\ta string (text) or an array of objects (obj) respectively. If none provided it will be expanded as text.\n\t**\n\t**\t>> string/array expand (array parts, object data, string ret='text', string mode='base-string');\n\t*/\n\texpand: function (parts, data, ret='text', mode='base-string')\n\t{\n\t\tlet s = [];\n\n\t\t// Expand variable parts.\n\t\tif (mode == 'var')\n\t\t{\n\t\t\tlet escape = true;\n\t\t\tlet quote = false;\n\n\t\t\tlet root = data;\n\t\t\tlet last = null;\n\t\t\tlet first = true;\n\t\t\tlet str = '';\n\n\t\t\tfor (let i = 0; i < parts.length && data != null; i++)\n\t\t\t{\n\t\t\t\tswitch (parts[i].type)\n\t\t\t\t{\n\t\t\t\t\tcase 'identifier':\n\t\t\t\t\tcase 'string':\n\t\t\t\t\t\tstr += parts[i].data;\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'template':\n\t\t\t\t\t\tlast = this.expand(parts[i].data, root, 'arg', 'template');\n\t\t\t\t\t\tstr += typeof(last) != 'object' ? last : '';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'base-string':\n\t\t\t\t\t\tstr += this.expand(parts[i].data, root, 'arg', 'base-string');\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'access':\n\t\t\t\t\t\tif (!last || typeof(last) != 'object')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (str == '') str = 'this';\n\n\t\t\t\t\t\t\twhile (true)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (str[0] == '!')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t\tescape = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if (str[0] == '$')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t\tquote = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (str != 'this' && data != null)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet tmp = data;\n\t\t\t\t\t\t\t\tdata = (str in data) ? data[str] : null;\n\n\t\t\t\t\t\t\t\tif (data === null && first)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (str in Template.functions)\n\t\t\t\t\t\t\t\t\t\tdata = Template.functions[str] (null, null, tmp);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfirst = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdata = last;\n\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile (str != '')\n\t\t\t{\n\t\t\t\tif (str[0] == '!')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\tescape = false;\n\t\t\t\t}\n\t\t\t\telse if (str[0] == '$')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\tquote = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (str != 'this')\n\t\t\t{\n\t\t\t\tlet failed = false;\n\n\t\t\t\tif (data != null)\n\t\t\t\t{\n\t\t\t\t\tif (!(str in data))\n\t\t\t\t\t{\n\t\t\t\t\t\tfailed = true;\n\t\t\t\t\t\tdata = null;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tdata = data[str];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tfailed = true;\n\n\t\t\t\tif (failed && parts.length == 1)\n\t\t\t\t{\n\t\t\t\t\tif (Template.strict == true)\n\t\t\t\t\t\tthrow new Error ('Expression function `'+str+'` not found.');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (typeof(data) == 'string')\n\t\t\t{\n\t\t\t\tif (escape)\n\t\t\t\t\tdata = data.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n\n\t\t\t\tif (quote)\n\t\t\t\t\tdata = '\"' + data + '\"';\n\t\t\t}\n\n\t\t\ts.push(data);\n\t\t}\n\n\t\t// Expand variable parts and returns a reference to it.\n\t\tif (ret == 'varref')\n\t\t{\n\t\t\tlet root = data;\n\t\t\tlet last = null;\n\t\t\tlet first = true;\n\t\t\tlet str = '';\n\n\t\t\tfor (let i = 0; i < parts.length && data != null; i++)\n\t\t\t{\n\t\t\t\tswitch (parts[i].type)\n\t\t\t\t{\n\t\t\t\t\tcase 'identifier':\n\t\t\t\t\tcase 'string':\n\t\t\t\t\t\tstr += parts[i].data;\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'template':\n\t\t\t\t\t\tlast = this.expand(parts[i].data, root, 'arg', 'template');\n\t\t\t\t\t\tstr += typeof(last) != 'object' ? last : '';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'base-string':\n\t\t\t\t\t\tstr += this.expand(parts[i].data, root, 'arg', 'base-string');\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'access':\n\t\t\t\t\t\tif (!last || typeof(last) != 'object')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (str == '') str = 'this';\n\n\t\t\t\t\t\t\twhile (true)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (str[0] == '!')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if (str[0] == '$')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (str != 'this' && data != null)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet tmp = data;\n\t\t\t\t\t\t\t\tdata = (str in data) ? data[str] : null;\n\n\t\t\t\t\t\t\t\tif (data === null && first)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (str in Template.functions)\n\t\t\t\t\t\t\t\t\t\tdata = Template.functions[str] (null, null, tmp);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfirst = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdata = last;\n\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile (str != '')\n\t\t\t{\n\t\t\t\tif (str[0] == '!')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t}\n\t\t\t\telse if (str[0] == '$')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn str != 'this' ? [data, str] : null;\n\t\t}\n\n\t\t// Expand function parts.\n\t\tif (mode == 'fn')\n\t\t{\n\t\t\tvar args = [];\n\n\t\t\targs.push(Template.expand(parts[0], data, 'text', 'base-string'));\n\n\t\t\tif ('_'+args[0] in Template.functions)\n\t\t\t\targs[0] = '_'+args[0];\n\n\t\t\tif (!(args[0] in Template.functions))\n\t\t\t{\n\t\t\t\tif (Template.strict == true)\n\t\t\t\t\tthrow new Error ('Expression function `'+args[0]+'` not found.');\n\n\t\t\t\treturn `(Unknown: ${args[0]})`;\n\t\t\t}\n\n\t\t\tif (args[0][0] == '_')\n\t\t\t\treturn Template.functions[args[0]] (parts, data);\n\n\t\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\t\targs.push(Template.expand(parts[i], data, 'arg', 'base-string'));\n\n\t\t\ts.push(Template.functions[args[0]] (args, parts, data));\n\t\t}\n\n\t\t// Template mode.\n\t\tif (mode == 'template')\n\t\t{\n\t\t\tif (parts.length == 1)\n\t\t\t{\n\t\t\t\tif (parts[0].length == 1 && parts[0][0].type == 'string')\n\t\t\t\t\treturn parts[0][0].data;\n\n\t\t\t\tif (parts[0].length == 1 && parts[0][0].type == 'identifier')\n\t\t\t\t{\n\t\t\t\t\tlet name = parts[0][0].data;\n\n\t\t\t\t\tif (name in Template.functions || '_'+name in Template.functions)\n\t\t\t\t\t\treturn Template.expand(parts, data, ret, 'fn');\n\t\t\t\t}\n\t\n\t\t\t\treturn Template.expand(parts[0], data, ret, 'var');\n\t\t\t}\n\n\t\t\treturn Template.expand(parts, data, ret, 'fn');\n\t\t}\n\n\t\t// Expand parts.\n\t\tif (mode == 'base-string')\n\t\t{\n\t\t\tlet index = -1;\n\n\t\t\tfor (let i of parts)\n\t\t\t{\n\t\t\t\tlet tmp = null;\n\t\t\t\tindex++;\n\n\t\t\t\tswitch (i.type)\n\t\t\t\t{\n\t\t\t\t\tcase 'template':\n\t\t\t\t\t\ttmp = Template.expand(i.data, data, ret, 'template');\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'string': case 'identifier':\n\t\t\t\t\t\ttmp = i.data;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'base-string':\n\t\t\t\t\t\ttmp = Template.expand(i.data, data, ret, 'base-string');\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (ret == 'void')\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (ret == 'last' && index != parts.length-1)\n\t\t\t\t\tcontinue;\n\n\t\t\t\ts.push(tmp);\n\t\t\t}\n\t\t}\n\n\t\t// Return types for direct objects.\n\t\tif (ret == 'obj') return s;\n\n\t\tif (ret == 'last')\n\t\t{\n\t\t\tif (typeOf(s) == 'Rose\\\\Arry')\n\t\t\t\ts = s[0];\n\n\t\t\treturn s;\n\t\t}\n\n\t\t// When the output is not really needed.\n\t\tif (ret == 'void') return null;\n\n\t\t// Return as argument ('object' if only one, or string if more than one), that is, the first item in the result.\n\t\tif (ret == 'arg')\n\t\t{\n\t\t\tif (Rinn.typeOf(s) == 'array')\n\t\t\t{\n\t\t\t\tif (s.length != 1)\n\t\t\t\t\treturn s.join('');\n\n\t\t\t\treturn s[0];\n\t\t\t}\n\n\t\t\treturn s;\n\t\t}\n\n\t\tif (ret == 'text' && Rinn.typeOf(s) == 'array')\n\t\t{\n\t\t\tlet f = (e => e != null && typeof(e) == 'object' ? ('map' in e ? e.map(f).join('') : ('join' in e ? e.join('') : e.toString())) : e);\n\t\t\ts = s.map(f).join('');\n\t\t}\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tParses the given template and returns a function that when called with an object will expand the template.\n\t**\n\t**\t>> object compile (string template);\n\t*/\n\tcompile: function (template)\n\t{\n\t\ttemplate = Template.parse(template);\n\n\t\treturn function (data=null, mode='text') {\n\t\t\treturn Template.expand(template, data ? data : { }, mode);\n\t\t};\n\t},\n\n\t/**\n\t**\tParses and expands the given template immediately.\n\t**\n\t**\t>> object eval (string template, object data, string mode='text');\n\t*/\n\teval: function (template, data=null, mode='text')\n\t{\n\t\ttemplate = Template.parse(template);\n\t\treturn Template.expand(template, data ? data : { }, mode);\n\t},\n\n\t/**\n\t**\tExpands the template as 'arg' and returns the result.\n\t**\n\t**\t>> object value (string parts, object data);\n\t*/\n\tvalue: function (parts, data=null)\n\t{\n\t\treturn Rinn.typeOf(parts) != 'array' ? parts : Template.expand(parts, data ? data : { }, 'arg');\n\t},\n\n\t/**\n\t**\tRegisters an expression function.\n\t**\n\t**\t>> object register (string name, function fn);\n\t*/\n\tregister: function (name, fn)\n\t{\n\t\tTemplate.functions[name] = fn;\n\t},\n\n\t/**\n\t**\tCalls an expression function.\n\t**\n\t**\t>> object call (string name, object args, object data);\n\t*/\n\t'call': function (name, args, data=null)\n\t{\n\t\tif (name in Template.functions)\n\t\t\treturn Template.functions[name] (args, null, data);\n\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tReturns a map given a 'parts' array having values of the form \"name: value\" or \":name value\".\n\t**\n\t**\t>> Map getNamedValues (array parts, object data, int i=1, bool expanded=true);\n\t*/\n\tgetNamedValues: function (parts, data, i=1, expanded=true)\n\t{\n\t\tlet s = { };\n\t\tlet mode = 0;\n\t\n\t\tfor (; i < parts.length; i += 2)\n\t\t{\n\t\t\tlet key = Template.expand(parts[i], data, 'arg');\n\n\t\t\tif (!mode) {\n\t\t\t\tif (key.startsWith(':')) mode = 1; else mode = key.endsWith(':') ? 2 : 3;\n\t\t\t}\n\n\t\t\tif (mode == 1)\n\t\t\t\tkey = key.substr(1);\n\t\t\telse if (mode == 2)\n\t\t\t\tkey = key.substr(0, key.length-1);\n\n\t\t\tif (expanded)\n\t\t\t\ts[key] = Template.expand(parts[i+1], data, 'arg');\n\t\t\telse\n\t\t\t\ts[key] = parts[i+1];\n\t\t}\n\n\t\treturn s;\n\t}\n};\n\n\n/**\n**\tTemplate functions, functions that are used to format data. Each function takes three parameters (args, parts and data). By default the function arguments\n**\tare expanded and passed via 'args' for convenience, however if the function name starts with '_' the 'args' parameter will be skipped and only (parts, data)\n**\twill be available, each 'part' must be expanded manually by calling Template.expand.\n*/\n\nTemplate.functions =\n{\n\t/**\n\t**\tExpression functions.\n\t*/\n\t'global': function(args) { return globalThis; },\n\t'null': function(args) { return null; },\n\t'true': function(args) { return true; },\n\t'false': function(args) { return false; },\n\n\t'len': function(args) { return args[1].toString().length; },\n\t'int': function(args) { return ~~args[1]; },\n\t'str': function(args) { return args[1].toString(); },\n\t'float': function(args) { return parseFloat(args[1]); },\n\t'chr': function(args) { return String.fromCharCode(args[1]); },\n\t'ord': function(args) { return args[1].toString().charCodeAt(0); },\n\n\t'not': function(args) { return !args[1]; },\n\t'neg': function(args) { return -args[1]; },\n\t'abs': function(args) { return Math.abs(args[1]); },\n\n\t'and': function(args) { for (let i = 1; i < args.length; i++) if (!args[i]) return false; return true; },\n\t'or': function(args) { for (let i = 1; i < args.length; i++) if (~~args[i]) return true; return false; },\n\n\t'eq': function(args) { return args[1] == args[2]; },\n\t'ne': function(args) { return args[1] != args[2]; },\n\t'lt': function(args) { return args[1] < args[2]; },\n\t'le': function(args) { return args[1] <= args[2]; },\n\t'gt': function(args) { return args[1] > args[2]; },\n\t'ge': function(args) { return args[1] >= args[2]; },\n\t'isnotnull': function(args) { return !!args[1]; },\n\t'isnull': function(args) { return !args[1]; },\n\t'iszero': function(args) { return parseInt(args[1]) == 0; },\n\n\t'eq?': function(args) { return args[1] == args[2]; },\n\t'ne?': function(args) { return args[1] != args[2]; },\n\t'lt?': function(args) { return args[1] < args[2]; },\n\t'le?': function(args) { return args[1] <= args[2]; },\n\t'gt?': function(args) { return args[1] > args[2]; },\n\t'ge?': function(args) { return args[1] >= args[2]; },\n\t'notnull?': function(args) { return !!args[1]; },\n\t'null?': function(args) { return !args[1]; },\n\t'zero?': function(args) { return parseInt(args[1]) == 0; },\n\n\t'typeof': function(args) { return Rinn.typeOf(args[1]); },\n\n\t'*': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x *= args[i]; return x; },\n\t'/': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x /= args[i]; return x; },\n\t'+': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= -args[i]; return x; },\n\t'-': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= args[i]; return x; },\n\t'mul': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x *= args[i]; return x; },\n\t'div': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x /= args[i]; return x; },\n\t'sum': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= -args[i]; return x; },\n\t'sub': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= args[i]; return x; },\n\t'mod': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x %= args[i]; return x; },\n\t'pow': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x = Math.pow(x, args[i]); return x; },\n\n\t/**\n\t**\tReturns the JSON representation of the expression.\n\t**\n\t**\tdump <expr>\n\t*/\n\t'dump': function (args)\n\t{\n\t\treturn JSON.stringify(args[1]);\n\t},\n\n\t/**\n\t**\tSets one or more variables in the data context.\n\t**\n\t**\tset <var-name> <expr> [<var-name> <expr>]*\n\t*/\n\t'_set': function (parts, data)\n\t{\n\t\tfor (let i = 1; i+1 < parts.length; i += 2)\n\t\t{\n\t\t\tlet value = Template.value(parts[i+1], data);\n\n\t\t\tif (parts[i].length > 1)\n\t\t\t{\n\t\t\t\tlet ref = Template.expand(parts[i], data, 'varref');\n\t\t\t\tif (ref != null) ref[0][ref[1]] = value;\n\t\t\t}\n\t\t\telse\n\t\t\t\tdata[Template.value(parts[i], data)] = value;\n\t\t}\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tRemoves one or more variables from the data context.\n\t**\n\t**\tunset <var-name> [<var-name>]*\n\t*/\n\t'_unset': function (parts, data)\n\t{\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t{\n\t\t\tif (parts[i].length > 1)\n\t\t\t{\n\t\t\t\tlet ref = Template.expand(parts[i], data, 'varref');\n\t\t\t\tif (ref != null) delete ref[0][ref[1]];\n\t\t\t}\n\t\t\telse\n\t\t\t\tdelete data[Template.value(parts[i], data)];\n\t\t}\n\n\t\treturn null;\n\t},\n\n\n\t/**\n\t**\tReturns the expression without white-space on the left or right. The expression can be a string or an array.\n\t**\n\t**\ttrim <expr>\n\t*/\n\t'trim': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.trim()) : args[1].trim()) : '';\n\t},\n\n\t/**\n\t**\tReturns the expression in uppercase. The expression can be a string or an array.\n\t**\n\t**\tupper <expr>\n\t*/\n\t'upper': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.toUpperCase()) : args[1].toUpperCase()) : '';\n\t},\n\n\t/**\n\t**\tReturns the expression in lower. The expression can be a string or an array.\n\t**\n\t**\tlower <expr>\n\t*/\n\t'lower': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.toLowerCase()) : args[1].toLowerCase()) : '';\n\t},\n\n\t/**\n\t**\tReturns a sub-string of the given string.\n\t**\n\t**\tsubstr <start> <count> <string>\n\t**\tsubstr <start> <string>\n\t*/\n\t'substr': function (args)\n\t{\n\t\tlet s = args[args.length-1].toString();\n\n\t\tlet start = 0;\n\t\tlet count = null;\n\n\t\tif (args.length == 4)\n\t\t{\n\t\t\tstart = ~~(args[1]);\n\t\t\tcount = ~~(args[2]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstart = ~~(args[1]);\n\t\t\tcount = null;\n\t\t}\n\n\t\tif (start < 0) start += s.length;\n\t\tif (count < 0) count += s.length;\n\n\t\tif (count === null)\n\t\t\tcount = s.length - start;\n\n\t\treturn s.substr(start, count);\n\t},\n\n\t/**\n\t**\tReplaces a matching string with the given replacement string in a given text.\n\t**\n\t**\treplace <search> <replacement> <text>\n\t*/\n\t'replace': function (args)\n\t{\n\t\treturn args[3].split(args[1]).join(args[2]);\n\t},\n\n\t/**\n\t**\tConverts all new-line chars in the expression to <br/>, the expression can be a string or an array.\n\t**\n\t**\tnl2br <expr>\n\t*/\n\t'nl2br': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.replace(/\\n/g, \"<br/>\")) : args[1].replace(/\\n/g, \"<br/>\")) : '';\n\t},\n\n\t/**\n\t**\tReturns the expression inside an XML tag named 'tag-name', the expression can be a string or an array.\n\t**\n\t**\t% <tag-name> <expr>\n\t*/\n\t'%': function (args)\n\t{\n\t\targs.shift();\n\t\tvar name = args.shift();\n\n\t\tlet s = '';\n\n\t\tfor (let i = 0; i < args.length; i++)\n\t\t{\n\t\t\tif (Rinn.typeOf(args[i]) == 'array')\n\t\t\t{\n\t\t\t\ts += `<${name}>`;\n\t\t\t\t\n\t\t\t\tfor (let j = 0; j < args[i].length; j++)\n\t\t\t\t\ts += args[i][j];\n\n\t\t\t\ts += `</${name}>`;\n\t\t\t}\n\t\t\telse\n\t\t\t\ts += `<${name}>${args[i]}</${name}>`;\n\t\t}\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tReturns the expression inside an XML tag named 'tag-name', attributes are supported.\n\t**\n\t**\t%% <tag-name> [<attr> <value>]* [<content>]\n\t*/\n\t'%%': function (args)\n\t{\n\t\targs.shift();\n\t\tvar name = args.shift();\n\n\t\tlet attr = '';\n\t\tlet text = '';\n\n\t\tfor (let i = 0; i < args.length; i += 2)\n\t\t{\n\t\t\tif (i+1 < args.length)\n\t\t\t\tattr += ` ${args[i]}=\"${args[i+1]}\"`;\n\t\t\telse\n\t\t\t\ttext = args[i];\n\t\t}\n\n\t\treturn text ? `<${name}${attr}>${text}</${name}>` : `<${name}${attr}/>`;\n\t},\n\n\t/**\n\t**\tJoins the given array expression into a string. The provided string-expr will be used as separator.\n\t**\n\t**\tjoin <string-expr> <array-expr>\n\t*/\n\t'join': function (args)\n\t{\n\t\tif (args[2] && Rinn.typeOf(args[2]) == 'array')\n\t\t\treturn args[2].join(args[1]);\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tSplits the given expression by the specified string. Returns an array.\n\t**\n\t**\tsplit <string-expr> <expr>\n\t*/\n\t'split': function (args)\n\t{\n\t\tif (args[2] && typeof(args[2]) == \"string\")\n\t\t\treturn args[2].split(args[1]);\n\n\t\treturn [];\n\t},\n\n\t/**\n\t**\tReturns an array with the keys of the given object-expr.\n\t**\n\t**\tkeys <object-expr>\n\t*/\n\t'keys': function (args)\n\t{\n\t\tif (args[1] && typeof(args[1]) == \"object\")\n\t\t\treturn Object.keys(args[1]);\n\n\t\treturn [];\n\t},\n\n\t/**\n\t**\tReturns an array with the values of the given object-expr.\n\t**\n\t**\tvalues <object-expr>\n\t*/\n\t'values': function (args)\n\t{\n\t\tif (args[1] && typeof(args[1]) == \"object\")\n\t\t\treturn Object.values(args[1]);\n\n\t\treturn [];\n\t},\n\n\t/**\n\t**\tConstructs a string obtained by concatenating the expanded template for each of the items in the list-expr, the mandatory varname\n\t**\tparameter (namely 'i') indicates the name of the variable that will contain the data of each item as the list-expr is\n\t**\ttraversed. Extra variables i# and i## (suffix '#' and '##') are introduced to denote the index/key and numeric index\n\t**\tof the current item respectively, note that the later will always have a numeric value.\n\t**\n\t**\teach <varname> <list-expr> <template>\n\t*/\n\t'_each': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\n\t\tlet s = '';\n\t\tlet j = 0;\n\n\t\tif (!list) return s;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\ts += Template.expand(parts[3], data, 'text');\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tExpands the given template for each of the items in the list-expr, the mandatory varname parameter (namely 'i') indicates the name of the variable\n\t**\tthat will contain the data of each item as the list-expr is traversed. Extra variables i# and i## (suffix '#' and '##') are introduced to denote\n\t**\tthe index/key and numeric index of the current item respectively, note that the later will always have a numeric value.\n\t**\n\t**\tDoes not produce any output (returns null).\n\t**\n\t**\tforeach <varname> <list-expr> <template>\n\t*/\n\t'_foreach': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\n\t\tlet j = 0;\n\n\t\tif (!list) return null;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\tTemplate.expand(parts[3], data, 'text');\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tReturns the valueA if the expression is true otherwise valueB, this is a short version of the 'if' function with the\n\t**\tdifference that the result is 'obj' instead of text.\n\t**\n\t**\t? <expr> <valueA> [<valueB>]\n\t*/\n\t'_?': function (parts, data)\n\t{\n\t\tif (Template.expand(parts[1], data, 'arg'))\n\t\t\treturn Template.expand(parts[2], data, 'arg');\n\n\t\tif (parts.length > 3)\n\t\t\treturn Template.expand(parts[3], data, 'arg');\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tReturns the valueA if it is not null (or empty or zero), otherwise returns valueB.\n\t**\n\t**\t?? <valueA> <valueB>\n\t*/\n\t'_??': function (parts, data)\n\t{\n\t\tlet value = Template.expand(parts[1], data, 'arg');\n\t\tif (value) return value;\n\t\n\t\treturn Template.expand(parts[2], data, 'arg');\n\t},\n\n\t/**\n\t**\tReturns the value if the expression is true, supports 'elif' and 'else' as well. The result of this function is always text.\n\t**\n\t**\tif <expr> <value> [elif <expr> <value>] [else <value>]\n\t*/\n\t'_if': function (parts, data)\n\t{\n\t\tfor (let i = 0; i < parts.length; i += 3)\n\t\t{\n\t\t\tif (Template.expand(parts[i], data, 'arg') == 'else')\n\t\t\t\treturn Template.expand(parts[i+1], data, 'text');\n\n\t\t\tif (Template.expand(parts[i+1], data, 'arg'))\n\t\t\t\treturn Template.expand(parts[i+2], data, 'text');\n\t\t}\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tLoads the expression value and attempts to match one case.\n\t**\n\t**\tswitch <expr> <case1> <value1> ... <caseN> <valueN> default <defvalue> \n\t*/\n\t'_switch': function (parts, data)\n\t{\n\t\tlet value = Template.expand(parts[1], data, 'arg');\n\n\t\tfor (let i = 2; i < parts.length; i += 2)\n\t\t{\n\t\t\tlet case_value = Template.expand(parts[i], data, 'arg');\n\t\t\tif (case_value == value || case_value == 'default')\n\t\t\t\treturn Template.expand(parts[i+1], data, 'text');\n\t\t}\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tExits the current inner most loop.\n\t**\n\t**\tbreak\n\t*/\n\t'_break': function (parts, data)\n\t{\n\t\tthrow new Error('EXC_BREAK');\n\t},\n\n\t/**\n\t**\tSkips execution and continues the next cycle of the current inner most loop.\n\t**\n\t**\tcontinue\n\t*/\n\t'_continue': function (parts, data)\n\t{\n\t\tthrow new Error('EXC_CONTINUE');\n\t},\n\n\t/**\n\t**\tConstructs an array with the results of repeating the specified template for a number of times.\n\t**\n\t**\trepeat <varname:i> [from <number>] [to <number>] [count <number>] [step <number>] <template>\n\t*/\n\t'_repeat': function (parts, data)\n\t{\n\t\tif (parts.length < 3 || (parts.length & 1) != 1)\n\t\t\treturn '(`repeat`: Wrong number of parameters)';\n\n\t\tlet var_name = Template.value(parts[1], data);\n\t\tlet count = null;\n\t\tlet from = 0, to = null;\n\t\tlet step = null;\n\n\t\tfor (let i = 2; i < parts.length-1; i+=2)\n\t\t{\n\t\t\tlet value = Template.value(parts[i], data);\n\n\t\t\tswitch (value.toLowerCase())\n\t\t\t{\n\t\t\t\tcase 'from':\n\t\t\t\t\tfrom = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'to':\n\t\t\t\t\tto = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'count':\n\t\t\t\t\tcount = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'step':\n\t\t\t\t\tstep = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tlet tpl = parts[parts.length-1];\n\t\tlet arr = [];\n\n\t\tif (to !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = from > to ? -1 : 1;\n\n\t\t\tif (step < 0)\n\t\t\t{\n\t\t\t\tfor (let i = from; i >= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfor (let i = from; i <= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (count !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\n\t\t\tfor (let i = from; count > 0; count--, i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t} catch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\t\n\t\t\tfor (let i = from; ; i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdelete data[var_name];\n\t\treturn arr;\n\t},\n\n\t/**\n\t**\tRepeats the specified template for a number of times.\n\t**\n\t**\tfor <varname:i> [from <number>] [to <number>] [count <number>] [step <number>] <template>\n\t*/\n\t'_for': function (parts, data)\n\t{\n\t\tif (parts.length < 3 || (parts.length & 1) != 1)\n\t\t\treturn '(`for`: Wrong number of parameters)';\n\n\t\tlet var_name = Template.value(parts[1], data);\n\t\tlet count = null;\n\t\tlet from = 0; to = null;\n\t\tlet step = null;\n\n\t\tfor (let i = 2; i < parts.length-1; i+=2)\n\t\t{\n\t\t\tvalue = Template.value(parts[i], data);\n\n\t\t\tswitch (value.toLowerCase())\n\t\t\t{\n\t\t\t\tcase 'from':\n\t\t\t\t\tfrom = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'to':\n\t\t\t\t\tto = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'count':\n\t\t\t\t\tcount = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'step':\n\t\t\t\t\tstep = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tlet tpl = parts[parts.length-1];\n\n\t\tif (to !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = from > to ? -1 : 1;\n\n\t\t\tif (step < 0)\n\t\t\t{\n\t\t\t\tfor (let i = from; i >= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfor (let i = from; i <= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (count !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\n\t\t\tfor (let i = from; count > 0; count--, i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\t\n\t\t\tfor (let i = from; ; i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdelete data[var_name];\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tRepeats the specified template infinitely until a \"break\" is found.\n\t**\n\t**\tloop <template>\n\t*/\n\t'_loop': function (parts, data)\n\t{\n\t\tif (parts.length < 2)\n\t\t\treturn '(`loop`: Wrong number of parameters)';\n\n\t\tlet tpl = parts[1];\n\n\t\twhile (true)\n\t\t{\n\t\t\ttry {\n\t\t\t\tTemplate.value(tpl, data);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tlet name = e.message;\n\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tWrites the specified arguments to the console.\n\t**\n\t**\techo <expr> [<expr>...]\n\t*/\n\t'_echo': function (parts, data)\n\t{\n\t\tlet s = '';\n\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\ts += Template.expand(parts[i], data, 'arg');\n\n\t\tconsole.log(s);\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tConstructs a list from the given arguments and returns it.\n\t**\n\t**\t# <expr> [<expr>...]\n\t*/\n\t'_#': function (parts, data)\n\t{\n\t\tlet s = [];\n\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\ts.push(Template.expand(parts[i], data, 'arg'));\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tConstructs a non-expanded list from the given arguments and returns it.\n\t**\n\t**\t## <expr> [<expr>...]\n\t*/\n\t'_##': function (parts, data)\n\t{\n\t\tlet s = [];\n\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\ts.push(parts[i]);\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tConstructs an associative array (dictionary) and returns it.\n\t**\n\t**\t& <name>: <expr> [<name>: <expr>...]\n\t**\t& :<name> <expr> [:<name> <expr>...]\n\t*/\n\t'_&': function (parts, data)\n\t{\n\t\treturn Template.getNamedValues (parts, data, 1, true);\n\t},\n\n\t/**\n\t**\tConstructs a non-expanded associative array (dictionary) and returns it.\n\t**\n\t**\t&& <name>: <expr> [<name>: <expr>...]\n\t**\t&& :<name> <expr> [:<name> <expr>...]\n\t*/\n\t'_&&': function (parts, data)\n\t{\n\t\treturn Template.getNamedValues (parts, data, 1, false);\n\t},\n\n\t/**\n\t**\tReturns true if the specified map contains all the specified keys. If it fails the global variable `err` will contain an error message.\n\t**\n\t**\tcontains <expr> <name> [<name>...]\n\t*/\n\t'contains': function (args, parts, data)\n\t{\n\t\tlet value = args[1];\n\n\t\tif (typeof(value) != 'object')\n\t\t{\n\t\t\tdata.err = 'Argument is not a Map';\n\t\t\treturn false;\n\t\t}\n\n\t\tlet s = '';\n\n\t\tfor (let i = 2; i < args.length; i++)\n\t\t{\n\t\t\tif (!(args[i] in value))\n\t\t\t\ts += ', '+args[i];\n\t\t}\n\n\t\tif (s != '')\n\t\t{\n\t\t\tdata.err = s.substr(1);\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tReturns true if the specified map has the specified key. Returns boolean.\n\t**\n\t**\thas <name> <expr>\n\t*/\n\t'has': function (args, parts, data)\n\t{\n\t\tlet value = args[2];\n\n\t\tif (Rinn.typeOf(value) != 'object')\n\t\t\treturn false;\n\n\t\treturn args[1] in value;\n\t},\n\n\t/**\n\t**\tReturns a new array/map contaning the transformed values of the array/map (evaluating the template). And just as in 'each', the i# and i## variables be available.\n\t**\n\t**\tmap <varname> <list-expr> <template>\n\t*/\n\t'_map': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\t\tif (!list) return list;\n\n\t\tlet arrayMode = Rinn.typeOf(list) == 'array' ? true : false;\n\t\tlet output = arrayMode ? [] : {};\n\t\tlet j = 0;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\tif (arrayMode)\n\t\t\t\toutput.push(Template.expand(parts[3], data, 'arg'));\n\t\t\telse\n\t\t\t\toutput[i] = Template.expand(parts[3], data, 'arg');\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn output;\n\t},\n\n\t/**\n\t**\tReturns a new array/map contaning the elements where the template evaluates to non-zero. Just as in 'each', the i# and i## variables be available.\n\t**\n\t**\tfilter <varname> <list-expr> <template>\n\t*/\n\t'_filter': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\t\tif (!list) return list;\n\n\t\tlet arrayMode = Rinn.typeOf(list) == 'array' ? true : false;\n\t\tlet output = arrayMode ? [] : {};\n\t\tlet j = 0;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\tif (~~Template.expand(parts[3], data, 'arg'))\n\t\t\t{\n\t\t\t\tif (arrayMode)\n\t\t\t\t\toutput.push(list[i]);\n\t\t\t\telse\n\t\t\t\t\toutput[i] = list[i];\n\t\t\t}\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn output;\n\t},\n\n\t/**\n\t**\tExpands the specified template string with the given data. The sym_open and sym_close will be '{' and '}' respectively.\n\t**\tIf no data is provided, current data parameter will be used.\n\t**\n\t**\texpand <template> <data>\n\t*/\n\t'expand': function (args, parts, data)\n\t{\n\t\treturn Template.expand (Template.parseTemplate (args[1], '{', '}'), args.length == 3 ? args[2] : data);\n\t},\n\n\t/**\n\t**\tCalls a function described by the given parameter.\n\t**\n\t**\tcall <function> <args...>\n\t*/\n\t'_call': function (parts, data)\n\t{\n\t\tlet ref = Template.expand(parts[1], data, 'varref');\n\n\t\tif (!ref || typeof(ref[0][ref[1]]) != 'function')\n\t\t\tthrow new Error ('Expression is not a function: ' + Template.expand(parts[1], data, 'obj').map(i => i == null ? '.' : i).join(''));\n\n\t\tlet args = [];\n\n\t\tfor (let i = 2; i < parts.length; i++)\n\t\t\targs.push(Template.value(parts[i], data));\n\n\t\treturn ref[0][ref[1]] (...args);\n\t},\n};\n\nexport default Template;\n","//!//@ts-check\n\n// *********************************************\n// rinn\n\nimport * as rinn from 'rinn';\nexport const Class = rinn.Class;\nexport const Schema = rinn.Schema;\nexport const Template = rinn.Template;\n\n// *********************************************\n// system\n\n//![import \"system/globals\"]\nimport _globals from './system/globals.js'; export const globals = _globals;\n\n//![import \"system/glx\"]\nimport _glx from './system/glx.js'; export const glx = _glx;\n\n//![import \"system/glsl\"]\nimport _glsl from './system/glsl.js'; export const glsl = _glsl;\n\n//![import \"system/system\"]\nimport _System from './system/system.js'; export const System = _System;\n\n//![import \"system/timer\"]\nimport _Timer from './system/timer.js'; export const Timer = _Timer;\n\n//![import \"system/random\"]\nimport _Random from './system/random.js'; export const Random = _Random;\n\n//![import \"system/keycode\"]\nimport _KeyCode from './system/keycode.js'; export const KeyCode = _KeyCode;\n\n//![import \"system/canvas\"]\nimport _Canvas from './system/canvas.js'; export const Canvas = _Canvas;\n\n//![import \"system/perf\"]\nimport _Perf from './system/perf.js'; export const Perf = _Perf;\n\n//![import \"system/log\"]\nimport _Log from './system/log.js'; export const Log = _Log;\n\n//![import \"system/shader\"]\nimport _Shader from './system/shader.js'; export const Shader = _Shader;\n\n//![import \"system/shader-program\"]\nimport _ShaderProgram from './system/shader-program.js'; export const ShaderProgram = _ShaderProgram;\n\n//![import \"system/framebuffer\"]\nimport _Framebuffer from './system/framebuffer.js'; export const Framebuffer = _Framebuffer;\n\n//![import \"system/texture\"]\nimport _Texture from './system/texture.js'; export const Texture = _Texture;\n\n\n// *********************************************\n// resources\n\n//![import \"resources/wrappers\"]\nimport * as _Wrappers from './resources/wrappers.js'; export const Wrappers = _Wrappers;\n\n//![import \"resources/resources\"]\nimport _Resources from './resources/resources.js'; export const Resources = _Resources;\nimport _Sound from './resources/sound.js'; export const Sound = _Sound;\n\n\n// *********************************************\n// utils\n\n//![import \"utils/recycler\"]\nimport _Recycler from './utils/recycler.js'; export const Recycler = _Recycler;\n\n//![import \"utils/linkable\"]\nimport _Linkable from './utils/linkable.js'; export const Linkable = _Linkable;\n\n//![import \"utils/list\"]\nimport _List from './utils/list.js'; export const List = _List;\n\n//![import \"utils/priority-queue\"]\nimport _PriorityQueue from './utils/priority-queue.js'; export const PriorityQueue = _PriorityQueue;\n\n//![import \"utils/handler\"]\nimport _Handler from './utils/handler.js'; export const Handler = _Handler;\n\n\n// *********************************************\n// math\n\n//![import \"math/matrix\"]\nimport _Matrix from './math/matrix.js'; export const Matrix = _Matrix;\n\n//![import \"math/rect\"]\nimport _Rect from './math/rect.js'; export const Rect = _Rect;\n\n//![import \"math/vec2\"]\nimport _Vec2 from './math/vec2.js'; export const Vec2 = _Vec2;\n\n//![import \"math/tfunction\"]\nimport _TFunction from './math/tfunction.js'; export const TFunction = _TFunction;\n\n//![import \"math/bounds2\"]\nimport _Bounds2 from './math/bounds2.js'; export const Bounds2 = _Bounds2;\n\n//![import \"math/point2\"]\nimport _Point2 from './math/point2.js'; export const Point2 = _Point2;\n\n\n// *********************************************\n// anim\n\n//![import \"anim/easing\"]\nimport _Easing from './anim/easing.js'; export const Easing = _Easing;\n\n//![import \"anim/anim\"]\nimport _Anim from './anim/anim.js'; export const Anim = _Anim;\n\n\n// *********************************************\n// flow\n\n//![import \"flow/boot\"]\nimport _Boot from './flow/boot.js'; export const Boot = _Boot;\n\n//![import \"flow/grid-element\"]\nimport _GridElement from './flow/grid-element.js'; export const GridElement = _GridElement;\n\n//![import \"flow/grid\"]\nimport _Grid from './flow/grid.js'; export const Grid = _Grid;\n\n//![import \"flow/scene\"]\nimport _Scene from './flow/scene.js'; export const Scene = _Scene;\n\n//![import \"flow/viewport\"]\nimport _Viewport from './flow/viewport.js'; export const Viewport = _Viewport;\n\n//![import \"flow/updater\"]\nimport _Updater from './flow/updater.js'; export const Updater = _Updater;\n\n//![import \"flow/container\"]\nimport _Container from './flow/container.js'; export const Container = _Container;\n\n//![import \"flow/simple-container\"]\nimport _SimpleContainer from './flow/simple-container.js'; export const SimpleContainer = _SimpleContainer;\n\n//![import \"flow/grid-container\"]\nimport _GridContainer from './flow/grid-container.js'; export const GridContainer = _GridContainer;\n\n//![import \"flow/group\"]\nimport _Group from './flow/group.js'; export const Group = _Group;\n\n//![import \"flow/drawable\"]\nimport _Drawable from './flow/drawable.js'; export const Drawable = _Drawable;\n\n//![import \"flow/element\"]\nimport _Element from './flow/element.js'; export const Element = _Element;\n\n//![import \"flow/mask\"]\nimport _Mask from './flow/mask.js'; export const Mask = _Mask;\n\n//![import \"flow/label\"]\nimport _Label from './flow/label.js'; export const Label = _Label;\n\n//![import \"flow/keyboard-handler\"]\nimport _KeyboardHandler from './flow/keyboard-handler.js'; export const KeyboardHandler = _KeyboardHandler;\n\n//![import \"flow/pointer-handler\"]\nimport _PointerHandler from './flow/pointer-handler.js'; export const PointerHandler = _PointerHandler;\n\n//![import \"flow/screen-controls\"]\nimport _ScreenControls from './flow/screen-controls.js'; export const ScreenControls = _ScreenControls;\n\n//![import \"flow/button\"]\nimport _Button from './flow/button.js'; export const Button = _Button;\n\n//![import \"flow/stick\"]\nimport _Stick from './flow/stick.js'; export const Stick = _Stick;\n\n\n// *********************************************\n// fxl\n\n//![import \"fxl/fxl\"]\nimport * as fxl from './fxl/fxl.js';\nexport default fxl;\n\n//!export default fxl;\n\nglobal.froxel =\n{\n\tClass: Class,\n\tSchema: Schema,\n\tTemplate: Template,\n\tglobals: globals,\n\tglx: glx,\n\tglsl: glsl,\n\tSystem: System,\n\tTimer: Timer,\n\tRandom: Random,\n\tKeyCode: KeyCode,\n\tCanvas: Canvas,\n\tPerf: Perf,\n\tLog: Log,\n\tShader: Shader,\n\tShaderProgram: ShaderProgram,\n\tFramebuffer: Framebuffer,\n\tTexture: Texture,\n\tWrappers: Wrappers,\n\tResources: Resources,\n\tSound: Sound,\n\tRecycler: Recycler,\n\tLinkable: Linkable,\n\tList: List,\n\tPriorityQueue: PriorityQueue,\n\tHandler: Handler,\n\tMatrix: Matrix,\n\tRect: Rect,\n\tVec2: Vec2,\n\tTFunction: TFunction,\n\tBounds2: Bounds2,\n\tPoint2: Point2,\n\tEasing: Easing,\n\tAnim: Anim,\n\tBoot: Boot,\n\tGridElement: GridElement,\n\tGrid: Grid,\n\tScene: Scene,\n\tViewport: Viewport,\n\tUpdater: Updater,\n\tContainer: Container,\n\tSimpleContainer: SimpleContainer,\n\tGridContainer: GridContainer,\n\tGroup: Group,\n\tDrawable: Drawable,\n\tElement: Element,\n\tMask: Mask,\n\tLabel: Label,\n\tKeyboardHandler: KeyboardHandler,\n\tPointerHandler: PointerHandler,\n\tScreenControls: ScreenControls,\n\tButton: Button,\n\tStick: Stick,\n\n\tfxl: fxl\n};\n","\nimport { Class } from 'rinn';\n\nconst XOR = (value, x) => (value ^ x) & 0x7FFFFFFF;\nconst SHR = (value, x) => (value >>> x)  & 0x7FFFFFFF;\nconst SHL = (value, x) => (value << x) & 0x7FFFFFFF;\n\n/**\n * Random number generator based on the WELL algorithm family.\n */\n\n//!class Random\n\nconst Random = Class.extend\n({\n\t/**\n\t * State of the generator.\n\t */\n\tstate: null,\n\n\t/**\n\t * Index of the next state value.\n\t */\n\tindex: 0,\n\n\t/**\n\t * \tSeed value of the generator. Remains constant throughout the life of the generator.\n\t * \t!readonly seed: number;\n\t */\n\tseed: 0,\n\n\t/**\n\t * Number of times the generator has been called.\n\t */\n\tcount: 0,\n\n\t/**\n\t * \tInitializes the instance of the pseudo-random number generator.\n\t * \t@param seed - Value to seed the random number generator. If none provided, default one (0xDAE7A5D3) will be used.\n\t *\n\t *\t!constructor (seed?: number);\n\t */\n\t__ctor: function(seed=0xDAE7A5D3)\n\t{\n\t\tthis.setSeed(seed);\n\t},\n\n\t/**\n\t * \tSets the seed of the pseudo-random number generator.\n\t * \t@param value - Seed value to use (32-bit unsigned integer).\n\t *\n\t *\t!setSeed (value: number) : Random;\n\t */\n\tsetSeed: function(value)\n\t{\n\t\tthis.seed = value;\n\n\t\tthis.index = 0;\n\t\tthis.count = 0;\n\n\t\tthis.state = [\n\t\t\t0xA5F7310C, 0xEF731CF3, 0xFA784322, 0x7834FC31,\n\t\t\t0xD9AF7813, 0xDE78AD13, 0x783F3418, 0xAA123176,\n\t\t\t0x871CF4D1, 0x73412FAB, 0xBAE6C710, 0x06F73481,\n\t\t\t0x8910CF15, 0x927CF813, 0xBCF7834F, 0x73F61193\n\t\t];\n\n\t\tfor (let i = 0; i < this.state.length; i++)\n\t\t\tthis.state[i] = XOR(this.state[i], this.seed);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tGenerates a 32-bit unsigned integer.\n\t *\t!nextInt32 () : number;\n\t */\n\tnextInt32: function ()\n\t{\n\t\tlet a, b, c, d;\n\n\t\tthis.count = (this.count + 1) & 0x7FFFFFFF;\n\n\t\ta = this.state[this.index];\n\t\tc = this.state[(this.index + 13) & 15];\n\t\tb = XOR(XOR(XOR(a, c), SHL(a, 16)), SHL(c, 15));\n\t\tc = this.state[(this.index + 9) & 15];\n\t\tc = XOR(c, SHR(c, 11));\n\t\ta = this.state[this.index] = XOR(b, c);\n\t\td = XOR(a, SHL(a, 5) & 0xDA442D24);\n\n\t\tthis.index = (this.index + 15) & 15;\n\t\ta = this.state[this.index];\n\n\t\tthis.state[this.index] = XOR(XOR(XOR(XOR(XOR(a, b), d), SHL(a, 2)), SHL(b, 18)), SHL(c, 28));\n\t\treturn this.state[this.index] & 0x7FFFFFFF;\n\t},\n\n\t/**\n\t * \tGenerates a 16-bit unsigned integer.\n\t *\t!nextInt16 () : number;\n\t */\n\tnextInt16: function ()\n\t{\n\t\treturn this.nextInt32() & 0xFFFF;\n\t},\n\n\t/**\n\t * \tGenerates an 8-bit unsigned integer.\n\t * \t!nextInt8 () : number;\n\t */\n\tnextInt8: function ()\n\t{\n\t\treturn this.nextInt32() & 0xFF;\n\t},\n\n\t/**\n\t * \tGenerates a floating point number between 0 an 1 (inclusive).\n\t * \t!nextFloat () : number;\n\t */\n\tnextFloat: function ()\n\t{\n\t\treturn this.nextInt32() / 0x7FFFFFFF;\n\t}\n});\n\nexport default Random;\n","\n//:/**\n//: * \tEnumeration of key codes supported by the system.\n//: */\n\n//!enum KeyCode\n\nexport default\n{\n\tBACKSPACE: 8,\n\t//!BACKSPACE\n\tTAB: 9,\n\t//!TAB\n\tENTER: 13,\n\t//!ENTER\n\tSHIFT: 16,\n\t//!SHIFT\n\tCTRL: 17,\n\t//!CTRL\n\tESC: 27,\n\t//!ESC\n\tSPACE: 32,\n\t//!SPACE\n\n\tPGUP: 33,\n\t//!PGUP\n\tPGDN: 34,\n\t//!PGDN\n\n\tEND: 35,\n\t//!END\n\tHOME: 36,\n\t//!HOME\n\n\tINS: 45,\n\t//!INS\n\tDEL: 46,\n\t//!DEL\n\n\tLEFT: 37,\n\t//!LEFT\n\tUP: 38,\n\t//!UP\n\tRIGHT: 39,\n\t//!RIGHT\n\tDOWN: 40,\n\t//!DOWN\n\n\tNUM_PLUS: 107,\n\t//!NUM_PLUS\n\tNUM_MINUS: 109,\n\t//!NUM_MINUS\n\tNUM_ASTERISK: 106,\n\t//!NUM_ASTERISK\n\tNUM_SLASH: 111,\n\t//!NUM_SLASH\n\tNUM_DOT: 110,\n\t//!NUM_DOT\n\n\tNUM_0: 96,\n\t//!NUM_0\n\tNUM_1: 97,\n\t//!NUM_1\n\tNUM_2: 98,\n\t//!NUM_2\n\tNUM_3: 99,\n\t//!NUM_3\n\tNUM_4: 100,\n\t//!NUM_4\n\tNUM_5: 101,\n\t//!NUM_5\n\tNUM_6: 102,\n\t//!NUM_6\n\tNUM_7: 103,\n\t//!NUM_7\n\tNUM_8: 104,\n\t//!NUM_8\n\tNUM_9: 105,\n\t//!NUM_9\n\n\tD0: 48,\n\t//!D0\n\tD1: 49,\n\t//!D1\n\tD2: 50,\n\t//!D2\n\tD3: 51,\n\t//!D3\n\tD4: 52,\n\t//!D4\n\tD5: 53,\n\t//!D5\n\tD6: 54,\n\t//!D6\n\tD7: 55,\n\t//!D7\n\tD8: 56,\n\t//!D8\n\tD9: 57,\n\t//!D9\n\n\tA: 65,\n\t//!A\n\tB: 66,\n\t//!B\n\tC: 67,\n\t//!C\n\tD: 68,\n\t//!D\n\tE: 69,\n\t//!E\n\tF: 70,\n\t//!F\n\tG: 71,\n\t//!G\n\tH: 72,\n\t//!H\n\tI: 73,\n\t//!I\n\tJ: 74,\n\t//!J\n\tK: 75,\n\t//!K\n\tL: 76,\n\t//!L\n\tM: 77,\n\t//!M\n\tN: 78,\n\t//!N\n\tO: 79,\n\t//!O\n\tP: 80,\n\t//!P\n\tQ: 81,\n\t//!Q\n\tR: 82,\n\t//!R\n\tS: 83,\n\t//!S\n\tT: 84,\n\t//!T\n\tU: 85,\n\t//!U\n\tV: 86,\n\t//!V\n\tW: 87,\n\t//!W\n\tX: 88,\n\t//!X\n\tY: 89,\n\t//!Y\n\tZ: 90,\n\t//!Z\n\n\tBACKQUOTE: 192,\n\t//!BACKQUOTE\n\tMINUS: 173,\n\t//!MINUS\n\tEQUAL: 61,\n\t//!EQUAL\n\n\tLBRACKET: 219,\n\t//!LBRACKET\n\tRBRACKET: 221,\n\t//!RBRACKET\n\tBACKSLASH: 220,\n\t//!BACKSLASH\n\n\tSEMICOLON: 59,\n\t//!SEMICOLON\n\tQUOTE: 222,\n\t//!QUOTE\n\n\tCOMMA: 188,\n\t//!COMMA\n\tDOT: 190,\n\t//!DOT\n\tSLASH: 191,\n\t//!SLASH\n};\n","\nimport { Rinn, Class } from 'rinn';\nimport Linkable from './linkable.js';\nimport Recycler from './recycler.js';\n\n//![import \"./linkable\"]\n//![import \"./recycler\"]\n\n//:/**\n//: * \tImplementation of a generic linked list.\n//: */\n\n//!class List\n\nconst List = Class.extend\n({\n\t/**\n\t * \tName of the class (for inheritance purposes).\n\t */\n\tclassName: \"List\",\n\n\t/**\n\t * \tPointer to the first node in the list.\n\t * \t!top: Linkable;\n\t */\n\ttop: null,\n\n\t/**\n\t * \tPointer to the last node in the list.\n\t * \t!bottom: Linkable;\n\t */\n\tbottom: null,\n\n\t/**\n\t * \tNumber of values in the list.\n\t * \t!length: number;\n\t */\n\tlength: 0,\n\n\t/**\n\t * \tInitializes the instance to an empty list.\n\t * \t!constructor();\n\t */\n\t__ctor: function ()\n\t{\n\t\tthis.top = null;\n\t\tthis.bottom = null;\n\t\tthis.length = 0;\n\t},\n\n\t/**\n\t * \tTraverses the list and destroys all nodes. The actual values are maintained. To destroy the\n\t * \tlist contents call clear() instead.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis.reset();\n\t},\n\n\t/**\n\t * \tClones all contents and returns a new list.\n\t * \t!clone() : List;\n\t */\n\tclone: function()\n\t{\n\t\tlet list = List.Pool.alloc();\n\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tlist.push(Rinn.clone(i.value));\n\n\t\treturn list;\n\t},\n\n\t/**\n\t * \tTraverses the list and destroys all nodes and values.\n\t * \t!clear() : List;\n\t */\n\tclear: function ()\n\t{\n\t\tlet i, ni;\n\n\t\tfor (i = this.top; i; i = ni)\n\t\t{\n\t\t\tni = i.next;\n\t\t\tdispose(i.free().value);\n\t\t}\n\n\t\tthis.top = this.bottom = null;\n\t\tthis.length = 0;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tTraverses the list, destroys all nodes **but** values are preserved.\n\t * \t!reset() : List;\n\t */\n\treset: function ()\n\t{\n\t\tlet i, ni;\n\n\t\tfor (i = this.top; i != null; i = ni)\n\t\t{\n\t\t\tni = i.next;\n\t\t\ti.free();\n\t\t}\n\n\t\tthis.top = this.bottom = null;\n\t\tthis.length = 0;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the first value in the list.\n\t * \t!first() : any;\n\t */\n\tfirst: function ()\n\t{\n\t\treturn this.top !== null ? this.top.value : null;\n\n\t},\n\t/**\n\t * \tReturns the last value in the list.\n\t * \t!last() : any;\n\t */\n\tlast: function ()\n\t{\n\t\treturn this.bottom !== null ? this.bottom.value : null;\n\t},\n\n\t/**\n\t * \tReturns a value given its index.\n\t * \t!getAt (index: number) : any;\n\t */\n\tgetAt: function (index)\n\t{\n\t\tlet i = null;\n\t\tfor (i = this.top; i && index-- > 0; i = i.next);\n\t\treturn i != null ? i.value : null;\n\t},\n\n\t/**\n\t * \tReturns the node at the given index.\n\t * \t!getNodeAt (index: number) : Linkable;\n\t */\n\tgetNodeAt: function (index)\n\t{\n\t\tlet i = null;\n\t\tfor (i = this.top; i && index--; i = i.next);\n\t\treturn i;\n\t},\n\n\t/**\n\t * \tReturns the node of a value given another value to compare, uses identical comparison (===) to match the value.\n\t * \t!sgetNode (value: any) : Linkable;\n\t */\n\tsgetNode: function (value)\n\t{\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tif (i.value === value) return i;\n\n\t\treturn null;\n\t},\n\n\t/**\n\t * \tRemoves the given value from the list and returns it.\n\t * \t!remove<T> (value: T) : T;\n\t */\n\tremove: function (i)\n\t{\n\t\tif (i != null && !Linkable.isInstance(i))\n\t\t\ti = this.sgetNode(i);\n\n\t\tif (!i) return null;\n\n\t\tif (!i.prev) this.top = i.next;\n\t\tif (!i.next) this.bottom = i.prev;\n\n\t\tthis.length--;\n\t\treturn i.free().value;\n\t},\n\n\t/**\n\t * \tAdds a value before the given reference node.\n\t * \t!insertBefore<T> (ref: Linkable, value: T) : T;\n\t */\n\tinsertBefore: function (ref, value)\n\t{\n\t\tif (!ref) return this;\n\n\t\tlet i = Linkable.Pool.alloc(value);\n\t\ti.linkBefore (ref);\n\n\t\tif (ref == this.top) this.top = i;\n\t\tthis.length++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * \tAdds a value after the given reference node.\n\t * \t!insertAfter<T> (ref: Linkable, value: T) : T;\n\t */\n\tinsertAfter: function (ref, value)\n\t{\n\t\tif (!ref) return this;\n\n\t\tlet i = Linkable.Pool.alloc(value);\n\t\ti.linkAfter (ref);\n\n\t\tif (ref == this.bottom) this.bottom = i;\n\t\tthis.length++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * \tAdds a value to the top of the list.\n\t * \t!unshift<T> (value: T) : T;\n\t */\n\tunshift: function (value)\n\t{\n\t\tlet i = Linkable.Pool.alloc(value);\n\n\t\ti.linkBefore (this.top);\n\t\tif (!this.bottom) this.bottom = i;\n\n\t\tthis.top = i;\n\t\tthis.length++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * \tRemoves a value from the top of the list.\n\t * \t!shift() : any;\n\t */\n\tshift: function ()\n\t{\n\t\tlet i = this.top;\n\t\tif (!i) return null;\n\n\t\tif (!(this.top = i.next)) this.bottom = null;\n\t\tthis.length--;\n\n\t\treturn i.free().value;\n\t},\n\n\t/**\n\t * \tAdds a value to the bottom of the list.\n\t * \t!push<T> (value: T) : T;\n\t */\n\tpush: function (value)\n\t{\n\t\tlet i = Linkable.Pool.alloc(value);\n\n\t\ti.linkAfter (this.bottom);\n\t\tif (!this.top) this.top = i;\n\n\t\tthis.bottom = i;\n\t\tthis.length++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * \tRemoves a value from the bottom of the list.\n\t * \t!pop() : any;\n\t */\n\tpop: function ()\n\t{\n\t\tlet i = this.bottom;\n\t\tif (!i) return null;\n\n\t\tif (!(this.bottom = i.prev)) this.top = null;\n\t\tthis.length--;\n\n\t\treturn i.free().value;\n\t},\n\n\t/**\n\t * \tAppends all contents of the given list to the current one.\n\t * \t!append (list: List) : List;\n\t */\n\tappend: function (list)\n\t{\n\t\tfor (let i = list.top; i; i = i.next)\n\t\t\tthis.push(i.value);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tTraverses the list calling the specified function for each value.\n\t * \t@param fn - Callback to execute, return `false` to stop the loop immediately.\n\t * \t!forEach(fn: (value: any, node: Linkable, list: List, context: object) => boolean, context?: object) : boolean;\n\t */\n\tforEach: function (fn, context=null)\n\t{\n\t\tlet ni;\n\t\n\t\tfor (let i = this.top; i; i = ni)\n\t\t{\n\t\t\tni = i.next;\n\t\t\tif (fn (i.value, i, this, context) === false) return false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tTraverses the list in reverse order, calling the specified function for each value.\n\t * \t@param fn - Callback to execute, return `false` to stop the loop immediately.\n\t * \t!forEachRev(fn: (value: any, node: Linkable, list: List, context: object) => boolean, context?: object) : boolean;\n\t */\n\tforEachRev: function (fn, context=null)\n\t{\n\t\tlet ni;\n\t\n\t\tfor (let i = this.bottom; i; i = ni)\n\t\t{\n\t\t\tni = i.prev;\n\t\t\tif (fn (i.value, i, this, context) === false) return false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tReturns the first value where the specified function returns `true`.\n\t * \t!find (fn: (value: any, context: object) => boolean, context?: object) : any;\n\t */\n\tfind: function (fn, context=null)\n\t{\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tif (fn(i.value, context)) return i.value;\n\n\t\treturn null;\n\t},\n\n\t/**\n\t * \tReturns an array with all values where the specified function returns `true`.\n\t * \t!filter (fn: (value: any, context: object) => boolean, context?: object) : Array<any>;\n\t */\n\tfilter: function (fn, context=null)\n\t{\n\t\tlet list = List.Pool.alloc();\n\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tif (fn(i.value, context)) list.push(i.value);\n\n\t\treturn list;\n\t},\n\n\t/**\n\t * \tReturns an array with all the values in the list.\n\t * \t!toArray() : Array<any>;\n\t */\n\ttoArray: function()\n\t{\n\t\tlet array = [];\n\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tarray.push(i.value);\n\n\t\treturn array;\n\t}\n});\n\n//!/class\n\n//!namespace List\n//!namespace Pool\n\n\t/**\n\t * \tAllocates an empty list.\n\t * \t!function alloc() : List;\n\t */\n\nRecycler.createPool (List, 16384, 6144);\nexport default List;\n","\nimport { Class } from 'rinn';\nimport Recycler from './recycler.js';\n\n//![import \"./recycler\"]\n\n//:/**\n//: * \tGeneric class for linkable items such as required by List. The responsibility of this class is to wrap a value into a linkable object.\n//: */\n\n//!class Linkable\n\nconst Linkable = Class.extend\n({\n\tclassName: \"Linkable\",\n\n\t/**\n\t * \tPointer to the previous item in the chain.\n\t * \t!readonly prev: Linkable;\n\t */\n\tprev: null, /* Linkable */\n\n\t/**\n\t * \tPointer to the next item in the chain.\n\t * \t!readonly next: Linkable;\n\t */\n\tnext: null, /* Linkable */\n\n\t/**\n\t * \tWrapped value.\n\t * \t!value: any;\n\t */\n\tvalue: null,\n\n\t/**\n\t * \tInitializes the linkable item and wraps the given value. Sets the `prev` and `next` pointers to null.\n\t * \t!constructor (value?: any);\n\t */\n\t__ctor: function (value)\n\t{\n\t\tthis.value = value;\n\t\tthis.clear();\n\t},\n\n\t/**\n\t * \tUnlinks the linkable item.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis.unlink();\n\t},\n\n\t/**\n\t * \tSets the previous/next connection pointers to null. Returns `this`.\n\t * \t!clear() : Linkable;\n\t */\n\tclear: function ()\n\t{\n\t\tthis.next = this.prev = null;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tLinks the item such that it will be located after the given reference.\n\t * \t!linkAfter (ref: Linkable) : Linkable;\n\t */\n\tlinkAfter: function (ref)\n\t{\n\t\tthis.prev = ref;\n\t\tthis.next = ref ? ref.next : null;\n\n\t\tif (ref)\n\t\t{\n\t\t\tif (ref.next) ref.next.prev = this;\n\t\t\tref.next = this;\n\t\t}\n\t},\n\n\t/**\n\t * \tLinks the item such that it will be located before the given reference.\n\t * \t!linkBefore (ref: Linkable) : Linkable;\n\t */\n\tlinkBefore: function (ref)\n\t{\n\t\tthis.prev = ref ? ref.prev : null;\n\t\tthis.next = ref;\n\n\t\tif (ref)\n\t\t{\n\t\t\tif (ref.prev) ref.prev.next = this;\n\t\t\tref.prev = this;\n\t\t}\n\t},\n\n\t/**\n\t * \tUnlinks the item by linking the `prev` and `next` together (when available) and returns `this`.\n\t * \t!unlink() : Linkable;\n\t */\n\tunlink: function () \n\t{\n\t\tif (this.prev) this.prev.next = this.next;\n\t\tif (this.next) this.next.prev = this.prev;\n\n\t\treturn this.clear();\n\t}\n});\n\n//!/class\n\n//!namespace Linkable\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a linkable item and wraps the given value. Sets the `prev` and `next` pointers to null.\n\t * \t!function alloc (value?: any) : Linkable;\n\t */\n\nRecycler.createPool (Linkable, 16384, 6144);\nexport default Linkable;\n","\nconst recyclingFacilities = { };\nlet totalPreallocated = 0;\n\nconst Recycler = { };\nglobal.Recycler = Recycler;\nexport default Recycler;\n\n//:/**\n//: * \tProvides functions to attach recycling functionality to any class for object pooling.\n//: */\n\n//!namespace Recycler\n\n/**\n * \tAttaches recycling methods (`allocate`, `alloc` and `free`) to the specified class. Class should implement method `init` to initialize the instance (and return itself)\n * \tand `__dtor` to destroy it.\n *\n * \t@param {*} maxPoolSize - Maximum number of instance to hold in the recycler.\n * \t@param {*} minPoolSize - Minimum number of instances to pre-allocate. Defaults to 0.375*`maxPoolSize` if not specified.\n * \n * \t!function attachTo (targetClass: any, maxPoolSize?: number, minPoolSize?: number) : any;\n */\n\nRecycler.attachTo = function (targetClass, maxPoolSize=8192, minPoolSize=null)\n{\n\tif (!targetClass.prototype.className)\n\t\tthrow new Error ('Unable to attach recycler methods to an unnamed class.');\n\n\tif (!('__dtor' in targetClass.prototype))\n\t\tthrow new Error ('Recycler: Class '+targetClass.prototype.className+' requires `__dtor` method.');\n\n\tif (!('init' in targetClass.prototype))\n\t\tthrow new Error ('Recycler: Class '+targetClass.prototype.className+' requires `init` method.');\n\n\tif (minPoolSize === null)\n\t\tminPoolSize = int(maxPoolSize * 0.375);\n\n\trecyclingFacilities[targetClass.prototype.className] = targetClass;\n\n\ttargetClass.recyclerPool = new Array(maxPoolSize).fill(null);\n\ttargetClass.recyclerPoolMax = maxPoolSize;\n\n\ttargetClass.prototype.objectId = 0;\n\ttargetClass.prototype.objectRefs = 0;\n\n\ttargetClass.recyclerNextObjectId = 0;\n\ttargetClass.recyclerCreated = 0;\n\ttargetClass.recyclerRecycled = 0;\n\ttargetClass.recyclerDropped = 0;\n\ttargetClass.recyclerLength = 0;\n\ttargetClass.recyclerActive = 0;\n\n\tlet preallocated = false;\n\n\t/**\n\t * \tPreallocates instances according the the minPoolSize value.\n\t */\n\ttargetClass.preallocate = function (maximum=null)\n\t{\n\t\tif (preallocated)\n\t\t\treturn;\n\n\t\tlet n = maximum === null ? minPoolSize : Math.min(maximum, minPoolSize);\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\ttargetClass.recyclerPool[targetClass.recyclerLength++] = new targetClass();\n\t\t\ttotalPreallocated++;\n\t\t}\n\n\t\tpreallocated = true;\n\t};\n\n\t/**\n\t * \tAllocates a new instance of the class. To ensure correct instance state a call to `init` must be made later.\n\t * \t@returns {object}\n\t */\n\ttargetClass.allocate = function()\n\t{\n\t\tlet item;\n\n\t\tif (this.recyclerLength === 0)\n\t\t{\n\t\t\titem = new targetClass();\n\t\t\ttargetClass.recyclerCreated++;\n\t\t}\n\t\telse\n\t\t{\n\t\t\titem = this.recyclerPool[--this.recyclerLength];\n\t\t\ttargetClass.recyclerRecycled++;\n\t\t}\n\n\t\ttargetClass.recyclerActive++;\n\n\t\titem.objectId = ++this.recyclerNextObjectId;\n\t\titem.objectRefs = 1;\n\n\t\tthis.recyclerNextObjectId &= 0x7FFFFFFF;\n\t\treturn item;\n\t};\n\n\t/**\n\t * \tAllocates an instance and initializes it. Internally runs `allocate` first and then `init` with up to 10 parameters.\n\t * \t@param {any} a0..a9 \n\t * \t@returns {object}\n\t */\n\ttargetClass.alloc = function(a0=null, a1=null, a2=null, a3=null, a4=null, a5=null, a6=null, a7=null, a8=null, a9=null)\n\t{\n\t\treturn targetClass.allocate().init(a0, a1, a2, a3, a4, a5, a6, a7, a8, a9);\n\t};\n\n\t/**\n\t * \tReleases the self object and adds it back to the pool. Duplicate call to this method will result in an error.\n\t * \t@returns {object}\n\t */\n\ttargetClass.prototype.free = function()\n\t{\n\t\tif (this.objectId < 0)\n\t\t\treturn this;\n\n\t\tif (this.objectId === 0)\n\t\t{\n\t\t\tconsole.error ('ERROR: Already released instance of ' + targetClass.prototype.className);\n\t\t\treturn this;\n\t\t}\n\n\t\tif (--this.objectRefs > 0)\n\t\t\treturn this;\n\n\t\tthis.__dtor();\n\t\tthis.objectId = 0;\n\n\t\tif (targetClass.recyclerLength >= maxPoolSize)\n\t\t\ttargetClass.recyclerDropped++;\n\t\telse\n\t\t\ttargetClass.recyclerPool[targetClass.recyclerLength++] = this;\n\n\t\ttargetClass.recyclerActive--;\n\t\treturn this;\n\t};\n\n\t/**\n\t * Sets a flag used to prevent the instance from being destroyed.\n\t * @param {boolean} value\n\t * @returns {object}\n\t */\n\ttargetClass.prototype.lockInstance = function (value)\n\t{\n\t\tthis.objectId = Math.abs(this.objectId);\n\t\tif (value) this.objectId = -this.objectId;\n\t\treturn this;\n\t};\n\n\t/**\n\t * Increases the internal reference counter by the specified value and returns the instance. If parameter is provided the default is 1.\n\t * @param {number} [count]\n\t * @returns {object}\n\t */\n\ttargetClass.prototype.instanceRef = function (count=1)\n\t{\n\t\tthis.objectRefs += count;\n\t\treturn this;\n\t};\n};\n\n/**\n * \tShows stats about all recycling facilities (or just the specified one) using `console.debug`.\n * \t@param name - Name of the class to show.\n * \t!function showStats (name?: string) : void;\n */\nRecycler.showStats = function (name=null)\n{\n\tlet list = recyclingFacilities;\n\n\tconsole.log('Total Preallocated: ' + totalPreallocated);\n\n\tif (name === true)\n\t{\n\t\tconsole.group('Recycling Facilities');\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tlet c = list[i];\n\t\t\tif (!c.recyclerCreated) continue;\n\n\t\t\tconsole.debug (i + ': '+(100*(c.recyclerCreated/c.recyclerPoolMax)).toFixed(1)+'%  =>  overhead=' + c.recyclerCreated + ', active='+c.recyclerActive+', array=' + c.recyclerPool.length + ', recycled=' + c.recyclerRecycled + ', in-recycler=' + c.recyclerLength + ', dropped=' + c.recyclerDropped + ', space=' + (c.recyclerPoolMax - c.recyclerLength));\n\t\t}\n\t\n\t\tconsole.groupEnd();\n\t\treturn;\n\t}\n\n\tif (name !== null)\n\t{\n\t\tif (typeof(name) === 'string')\n\t\t{\n\t\t\tlet c = recyclingFacilities[name];\n\t\t\tconsole.debug (name + ': '+(100*(c.recyclerCreated/c.recyclerPoolMax)).toFixed(1)+'%  =>  overhead=' + c.recyclerCreated + ', active='+c.recyclerActive+', array=' + c.recyclerPool.length + ', recycled=' + c.recyclerRecycled + ', in-recycler=' + c.recyclerLength + ', dropped=' + c.recyclerDropped + ', space=' + (c.recyclerPoolMax - c.recyclerLength));\n\t\t\treturn;\n\t\t}\n\n\t\tlist = name;\n\t}\n\n\tconsole.group('Recycling Facilities');\n\n\tfor (let i in list)\n\t{\n\t\tlet c = list[i];\n\t\tif (!c.recyclerCreated) continue;\n\n\t\tconsole.debug (i + ': '+(100*(c.recyclerCreated/c.recyclerPoolMax)).toFixed(1)+'%  =>  overhead=' + c.recyclerCreated + ', active='+c.recyclerActive+', array=' + c.recyclerPool.length + ', recycled=' + c.recyclerRecycled + ', in-recycler=' + c.recyclerLength + ', dropped=' + c.recyclerDropped + ', space=' + (c.recyclerPoolMax - c.recyclerLength));\n\t}\n\n\tconsole.groupEnd();\n};\n\n\n/**\n * \tCreate a new class extending the specified target class, this new class is a recycling facility and is placed under property `Pool` of the target class. This\n * \tmethod can be used instead of the usual `attachTo` when the target class construct/deconstruct methods need to remain untouched.\n *\n * \t@param {*} maxPoolSize - Maximum number of instance to hold in the recycler.\n * \t@param {*} minPoolSize - Minimum number of instances to pre-allocate. Defaults to 0.375*`maxPoolSize` if not specified.\n * \n *\t!function createPool (targetClass: any, maxPoolSize?: number, minPoolSize?: number) : any;\n */\nRecycler.createPool = function (targetClass, maxPoolSize=8192, minPoolSize=null)\n{\n\tconst name = targetClass.prototype.className;\n\tif (!name) throw new Error ('Unable to create pool sub-class on an unnamed class.');\n\n\tconst Pool = targetClass.extend\n\t({\n\t\tclassName: targetClass.prototype.className,\n\n\t\t__ctor: function () {\n\t\t},\n\n\t\tinit: function(a0=null, a1=null, a2=null, a3=null, a4=null, a5=null, a6=null, a7=null, a8=null, a9=null)\n\t\t{\n\t\t\tthis._super[name].__ctor(a0, a1, a2, a3, a4, a5, a6, a7, a8, a9);\n\t\t\treturn this;\n\t\t}\n\t});\n\n\tRecycler.attachTo(Pool, maxPoolSize, minPoolSize);\n\ttargetClass.Pool = Pool;\n\n\treturn targetClass;\n};\n\n\n/**\n * \tRuns the preallocation process of all registered pools. Returns the total number of instances preallocated.\n * \t@param {number|null} maxPreallocationsPerPool\n * \t!function preallocate (maxPreallocationsPerPool?: number) : number;\n */\nRecycler.preallocate = function (maxPreallocationsPerPool=null)\n{\n\ttotalPreallocated = 0;\n\n\tfor (let i in recyclingFacilities)\n\t\trecyclingFacilities[i].preallocate(maxPreallocationsPerPool);\n\n\treturn totalPreallocated;\n}\n","\n//!class Timer\n\n/**\n * \t@param vsync - Indicates if requestAnimationFrame should be used instead of setTimeout.\n * \t@param interval - Amount of milliseconds between timer activations.\n * \t@param callback - Function to execute on each timer activation.\n *\n * \t!constructor (vsync: boolean, interval: number, callback: (dt: number, timer: Timer) => void );\n */\nconst Timer = function (vsync, interval, callback)\n{\n\tthis.callback = callback;\n\tthis.interval = interval;\n\tthis.vsync = vsync;\n\tthis.handle = null;\n\n\tthis.isRunning = false;\n\tthis.startTime = 0;\n\tthis.rTime = 0;\n\tthis.sTime = 0;\n\tthis.lTime = 0;\n\tthis.tDelta = 0;\n\n\tthis._onTimeout = () => {\n\t\tthis.onTimeout();\n\t};\n\n\tthis._onTimeout_b = () => {\n\t\tthis.runNow();\n\t};\n};\n\n/**\n * \tTimer onTimeout handler.\n */\nTimer.prototype.onTimeout = function ()\n{\n\tif (!this.isRunning) return;\n\n\tthis.rTime = hrnow() - this.startTime;\n\n\tlet tError = this.rTime - (this.sTime + this.interval);\n\tif (tError < 0)\n\t{\n\t\tthis.runAfter(-tError);\n\t\treturn;\n\t}\n\n\tthis.sTime += this.interval * (1 + int(tError / this.interval));\n\n\tthis.tDelta = tError < 0 ? this.interval : (this.rTime - this.lTime);\n\tthis.lTime = this.rTime;\n\n\tthis.runAfter((this.sTime + this.interval) - (hrnow() - this.startTime));\n\tthis.callback(this.tDelta, this);\n};\n\n/**\n * \tStarts the timer and triggers `onStarted`.\n *\n * \t@param immediate - When `true` the callback will be executed immediately.\n * \t@param scale - Used to control when to trigger the first timeout, delay is timeInterval*scale.\n *\n * \t!start (immediate?: boolean, scale?: number) : void;\n */\nTimer.prototype.start = function (immediate=false, scale=1.0)\n{\n\tif (this.isRunning) return;\n\n\tthis.startTime = hrnow();\n\tthis.isRunning = true;\n\n\tthis.sTime = 0;\n\tthis.lTime = 0;\n\n\tthis.onStarted();\n\n\tif (immediate)\n\t\tthis.callback (0, this);\n\n\tthis.runAfter(this.interval*scale);\n};\n\n/**\n * \tExecutes the timer activation after the specified amount of milliseconds.\n *\n * \t!runAfter (timeout: number) : void;\n */\nTimer.prototype.runAfter = function (timeout)\n{\n\tif (process.browser && this.vsync)\n\t{\n\t\trequestAnimationFrame(this._onTimeout_b);\n\t\treturn;\n\t}\n\n\tif (this.handle)\n\t\tclearTimeout(this.handle);\n\n\tthis.handle = setTimeout(this._onTimeout, timeout);\n};\n\n/**\n * \tExecutes the timer activaton as soon as possible.\n *\n * \t!runNow() : void;\n */\nTimer.prototype.runNow = function ()\n{\n\tif (this.handle)\n\t\tclearTimeout(this.handle);\n\n\tthis.handle = setTimeout(this._onTimeout, 0);\n};\n\n/**\n * \tStops the timer and triggers `onStopped`.\n *\n * \t!stop() : void;\n */\nTimer.prototype.stop = function ()\n{\n\tif (!this.isRunning) return;\n\n\tif (this.handle)\n\t{\n\t\tclearTimeout(this.handle);\n\t\tthis.handle = null;\n\t}\n\n\tthis.isRunning = false;\n\tthis.onStopped();\n};\n\n/**\n * \tTimer started event handler.\n *\n * \t!onStarted() : void;\n */\nTimer.prototype.onStarted = function ()\n{\n};\n\n/**\n * \tTimer stopped event handler.\n *\n * \t!onStopped() : void;\n */\nTimer.prototype.onStopped = function ()\n{\n};\n\nexport default Timer;\n","\nimport { Class, Rinn } from 'rinn';\nimport Matrix from '../math/matrix.js';\nimport System from './system.js';\nimport List from '../utils/list.js';\nimport ShaderProgram from './shader-program.js';\nimport Shader from './shader.js';\nimport globals from './globals.js';\nimport Log from './log.js';\nimport glx from './glx.js';\nimport Texture from './texture.js';\n\n//![import \"../math/matrix\"]\n//![import \"./system\"]\n//![import \"../utils/list\"]\n//![import \"./shader-program\"]\n//![import \"./shader\"]\n//![import \"./globals\"]\n//![import \"./log\"]\n//![import \"./glx\"]\n//![import \"./texture\"]\n\n//!namespace Canvas\n\n\t//!type Options =\n\n\t\t/**\n\t\t * \tActual HTML5 Canvas element, if `null` a new one will be created.\n\t\t * \t!elem: HTMLCanvasElement;\n\t\t */\n\t\t\n\t\t/**\n\t\t * \tWebGL enable flag.\n\t\t * \t!gl: boolean;\n\t\t */\n\n\t\t/**\n\t\t * \tBackground of the canvas element.\n\t\t * \t!background: string;\n\t\t */\n\n\t\t/**\n\t\t * \tWidth of the canvas.\n\t\t * \t!width: number;\n\t\t */\n\n\t\t/**\n\t\t * \tHeight of the canvas.\n\t\t * \t!height: number;\n\t\t */\n\n\t\t/**\n\t\t * \tIndicates if the canvas element should be hidden from view (not attached to the document body).\n\t\t * \t!hidden: boolean;\n\t\t */\n\n\t\t/**\n\t\t * \tSet to `true` to ensure the canvas is positioned absolutly to (0, 0).\n\t\t * \t!absolute: boolean;\n\t\t */\n\n\t\t/**\n\t\t * \tUsed to control the antialias property of the canvas.\n\t\t * \t!antialias: boolean;\n\t\t */\n\n\t//!/type\n\n//!/namespace\n\n//!class Canvas\n\n/**\n * \tConstructs a canvas object. If the Canvas DOM element is not provided a new element will be created and attached to the page.\n * \t!constructor (options: Canvas.Options);\n */\n\nconst Canvas = function (options=null)\n{\n\tlet opts = {\n\t\telem: null,\n\t\tgl: false,\n\t\tbackground: '#000000',\n\t\twidth: 0,\n\t\theight: 0,\n\t\thidden: true,\n\t\tabsolute: false,\n\t\tantialias: false,\n\t\t...options\n\t};\n\n\tconst headless = global.document ? false : true;\n\n\t// Create canvas element if required.\n\tif (opts.elem == null)\n\t{\n\t\tthis.elem = !headless ? global.document.createElement('canvas') : Rinn.clone(Canvas.passThruCanvas);\n\n\t\tif (global.document && opts.hidden != true)\n\t\t{\n\t\t\tglobal.document.body.appendChild (this.elem);\n\n\t\t\tif (opts.absolute === true) {\n\t\t\t\tthis.elem.style.position = 'absolute';\n\t\t\t\tthis.elem.style.left = '0';\n\t\t\t\tthis.elem.style.top = '0';\n\t\t\t}\n\t\t}\n\t}\n\telse\n\t{\n\t\tthis.elem = opts.elem;\n\t}\n\n\tif (!this.elem.getContext) return;\n\n\tif (opts.gl === true && !headless)\n\t{\n\t\tthis.gl = this.elem.getContext('webgl2', { desynchronized: false, preserveDrawingBuffer: false, alpha: false, stencil: true });\n\n\t\tif (globals.gl === null)\n\t\t\tglx.setContext(globals.gl = this.gl);\n\n\t\tthis.shaderProgram = null;\n\t\tthis.context = null;\n\n\t\tLog.write(glx.getParameter('VERSION') + ', ' + glx.getParameter('SHADING_LANGUAGE_VERSION'));\n\t}\n\telse\n\t{\n\t\tthis.context = this.elem.getContext('2d', { desynchronized: false });\n\t\tthis.gl = null;\n\t}\n\n\t// State stack support.\n\tthis.matrixStack = List.Pool.alloc();\n\tthis.alphaStack = List.Pool.alloc();\n\tthis.depthFlagStack = List.Pool.alloc();\n\tthis.shaderProgramStack = List.Pool.alloc();\n\n\tthis.matr = Matrix.Pool.alloc();\n\tthis.transform = Matrix.Pool.alloc();\n\n\t// Default context values.\n\tthis._globalScale = 1.0;\n\tthis._alpha = 1.0;\n\tthis._depthFlag = true;\n\n\t// Set initial transformation matrix.\n\tthis.updateTransform();\n\tthis.strokeStyle(\"#fff\");\n\tthis.fillStyle(\"#fff\");\n\n\tif (opts.width && opts.height)\n\tthis.resize (opts.width, opts.height);\n\n\tif (this.gl !== null)\n\t\tthis.initGl();\n\n\tthis.antialias = opts.antialias;\n\tthis.setBackground (opts.background);\n};\n\nCanvas.passThruCanvas = \n{\n\tparentNode: null,\n\n\timageSmoothingEnabled: true,\n\n\tstyle: {\n\t},\n\n\twidth: 960,\n\theight: 540,\n\n\tgetContext: function (renderingContext) {\n\t\treturn this;\n\t},\n\n\tpushClip: function() {\n\t},\n\n\tpopClip: function() {\n\t},\n\n\tscale: function (sx, sy) {\n\t},\n\n\trotate: function (angle) {\n\t},\n\n\ttranslate: function (x, y) {\n\t},\n\n\tsetTransform: function (a, b, c, d, e, f) {\n\t},\n\n\tupdateTransform: function () {\n\t},\n\n\ttoDataURL: function (mime, params) {\n\t\treturn '';\n\t},\n\n\tbeginPath: function () {\n\t},\n\n\tmoveTo: function (x, y) {\n\t},\n\n\tclosePath: function() {\n\t},\n\n\tlineTo: function() {\n\t},\n\n\trect: function(x, y, w, h) {\n\t},\n\n\tfill: function() {\n\t},\n\n\tstroke: function() {\n\t},\n\n\tfillRect: function(x, y, w, h) {\n\t},\n\n\tstrokeRect: function(x, y, w, h) {\n\t},\n\n\tclip: function() {\n\t},\n\n\tquadraticCurveTo: function (cpx, cpy, x, y) {\n\t},\n\n\tbezierCurveTo: function (cx1, cy1, cx2, cy2, x, y) {\n\t},\n\n\tarc: function (x, y, r, sA, eA, cw) {\n\t},\n\n\tarcTo: function (x1, y1, x2, y2, r) {\n\t},\n\n\tfillText: function (text, x, y, maxWidth) {\n\t},\n\n\tstrokeText: function (text, x, y, maxWidth) {\n\t},\n\n\tmeasureText: function (text) {\n\t\treturn { width: 0 };\n\t},\n\n\tcreateImageData: function (w, h) {\n\t\treturn { width: w, height: h };\n\t},\n\n\tgetImageData: function (x, y, w, h) {\n\t\treturn { width: w, height: h, data: [] };\n\t},\n\n\tputImageData: function (data, x, y) {\n\t},\n\n\tdrawImage: function (img, sx=0, sy=0, sw=null, sh=null, dx=null, dy=null, dw=null, dh=null, textureWidth=null, textureHeight=null, frameWidth=null, frameHeight=null) {\n\t},\n\n\tgetBoundingClientRect: function () {\n\t\treturn { left: 0, top: 0 };\n\t}\n};\n\n/**\n * \tInitializes the OpenGL ES context.\n */\nCanvas.prototype.initGl = function ()\n{\n\tlet gl = this.gl;\n\n\t/**\n\t * \tCreate the frame-wrap shader program.\n\t */\n\tthis.glFWrapProgram = new ShaderProgram('fwrap');\n\n\tnew Shader ('fwrap-vert', Shader.Type.VERTEX,\n\t`\n\t\tuniform mat3 m_transform;\n\t\tuniform mat3 m_quad;\n\t\tuniform mat3 m_texture;\n\t\tuniform vec4 v_resolution;\n\t\tuniform vec4 v_frame_size;\n\t\tuniform float f_depth;\n\n\t\tin vec3 location;\n\t\tout vec2 texcoords;\n\n\t\t//@use location2d, frameTexCoords\n\n\t\tvoid main () {\n\t\t\tgl_Position = location2d (location, f_depth);\n\t\t\ttexcoords = frameTexCoords(location);\n\t\t}\n\t`);\n\n\tnew Shader ('fwrap-frag', Shader.Type.FRAGMENT,\n\t`\n\t\tuniform sampler2D texture0;\n\t\tuniform vec4 v_frame_size;\n\t\tuniform float f_alpha;\n\n\t\tin vec2 texcoords;\n\t\tout vec4 color;\n\n\t\t//@use frameTex\n\n\t\tvoid main () {\n\t\t\tcolor = frameTex(texcoords) * f_alpha;\n\t\t\tif (color.a == 0.0) discard;\n\t\t}\n\t`);\n\n\t/**\n\t * \tCreate the default shader program.\n\t */\n\tthis.glDefaultProgram = new ShaderProgram('def');\n\n\tnew Shader ('def-vert', Shader.Type.VERTEX,\n\t`\n\t\tuniform mat3 m_transform;\n\t\tuniform mat3 m_quad;\n\t\tuniform mat3 m_texture;\n\t\tuniform vec4 v_resolution;\n\t\tuniform float f_depth;\n\n\t\tin vec3 location;\n\t\tout vec2 texcoords;\n\n\t\t//@use location2d\n\n\t\tvoid main ()\n\t\t{\n\t\t\tgl_Position = location2d (location, f_depth);\n\t\t\ttexcoords = vec2(m_texture * location);\n\t\t}\n\t`);\n\n\tnew Shader ('def-frag', Shader.Type.FRAGMENT,\n\t`\n\t\tuniform sampler2D texture0;\n\t\tuniform float f_alpha;\n\n\t\tin vec2 texcoords;\n\t\tout vec4 color;\n\n\t\tvoid main() {\n\t\t\tcolor = texture(texture0, texcoords) * f_alpha;\n\t\t\tif (color.a == 0.0) discard;\n\t\t}\n\t`);\n\n\t/**\n\t * \tCreate the frame buffer blit shader program.\n\t */\n\tthis.glBlitProgram = new ShaderProgram('blit');\n\n\tnew Shader ('blit-vert', Shader.Type.VERTEX,\n\t`\n\t\tuniform vec4 v_resolution;\n\t\tuniform mat3 m_quad;\n\t\tuniform mat3 m_texture;\n\n\t\tin vec3 location;\n\t\tout vec2 texcoords;\n\n\t\t//@use snorm\n\n\t\tvoid main() {\n\t\t\tgl_Position = vec4(snorm(vec2(m_quad * location) / v_resolution.xy), 0.0, 1.0);\n\t\t\ttexcoords = vec2(m_texture * location);\n\t\t}\n\t`);\n\n\tnew Shader ('blit-frag', Shader.Type.FRAGMENT,\n\t`\n\t\tuniform sampler2D texture0;\n\t\tin vec2 texcoords;\n\t\tout vec4 color;\n\n\t\tvoid main() {\n\t\t\tcolor = texture(texture0, texcoords);\n\t\t}\n\t`);\n\n\t/* ****** */\n\tthis.glDefaultProgram.attach('def-vert');\n\tthis.glDefaultProgram.attach('def-frag');\n\n\tthis.glFWrapProgram.attach('fwrap-vert');\n\tthis.glFWrapProgram.attach('fwrap-frag');\n\n\tthis.glBlitProgram.attach('blit-vert');\n\tthis.glBlitProgram.attach('blit-frag');\n\n\tthis.glDefaultProgram.link();\n\tthis.glFWrapProgram.link();\n\tthis.glBlitProgram.link();\n\n\tif (!this.glDefaultProgram.getStatus())\n\t\tthrow new Error (this.glDefaultProgram.getAllErrors());\n\n\tif (!this.glFWrapProgram.getStatus())\n\t\tthrow new Error (this.glFWrapProgram.getAllErrors());\n\n\tif (!this.glBlitProgram.getStatus())\n\t\tthrow new Error (this.glBlitProgram.getAllErrors());\n\n\tthis.setShaderProgram(ShaderProgram.get('def'));\n\n\t/**\n\t * \tCreate the vertex buffer.\n\t */\n\tthis.vao0 = gl.createVertexArray();\n\tgl.bindVertexArray(this.vao0);\n\n\tglx.createBufferFrom([ 0.0, 0.0, 1.0,  0.0, 1.0, 1.0,  1.0, 0.0, 1.0,  1.0, 1.0, 1.0 ], glx.BufferTarget.ARRAY_BUFFER, glx.BufferUsage.STATIC_DRAW);\n\n\tgl.vertexAttribPointer(this.shaderProgram.getAttribLocation('location'), 3, gl.FLOAT, gl.FALSE, 3*Float32Array.BYTES_PER_ELEMENT, 0*Float32Array.BYTES_PER_ELEMENT);\n\tgl.enableVertexAttribArray(this.shaderProgram.getAttribLocation('location'));\n\n\t/**\n\t * \tSetup initial GL configuration.\n\t */\n\tgl.clearColor (0.0, 0.0, 0.0, 1.0);\n\n\tgl.enable (gl.DEPTH_TEST);\n\tgl.clearDepth (0.0);\n\tgl.depthFunc (gl.GEQUAL);\n\n\tgl.disable(gl.DITHER);\n\n\t// pre-multiplied blending\n\tgl.enable (gl.BLEND);\n\tgl.pixelStorei (gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\n\tgl.blendEquationSeparate (gl.FUNC_ADD, gl.FUNC_ADD);\n\tgl.blendFunc (gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n\n\t/**\n\t * \tSetup frame buffer.\n\t */\n\n\t/* *** */\n\tthis.m_quad = new Float32Array(9).fill(0);\n\tthis.m_texture = new Float32Array(9).fill(0);\n\tthis.v_resolution = new Float32Array(4).fill(0);\n\tthis.zvalue = 0;\n\n\tMatrix.loadIdentity(this.m_quad);\n\tMatrix.loadIdentity(this.m_texture);\n\n\t// drawImage (Image img, float sx, float sy, float sw, float sh, float dx, float dy, float dw, float dh, float textureWidth, float textureHeight, float frameWidth, float frameHeight);\n\tthis.drawImage = function (img, sx, sy, sw, sh, dx, dy, dw, dh, textureWidth=null, textureHeight=null, frameWidth=null, frameHeight=null)\n\t{\n\t\tif (!img.textureId)\n\t\t\treturn;\n\n\t\tlet gl = this.gl;\n\t\tlet program = this.shaderProgram;\n\n\t\tif (textureWidth === null)\n\t\t{\n\t\t\ttextureWidth = img.width;\n\t\t\ttextureHeight = img.height;\n\t\t}\n\n\t\tif (frameWidth === null)\n\t\t{\n\t\t\tframeWidth = img.targetWidth;\n\t\t\tframeHeight = img.targetHeight;\n\t\t}\n\n\t\tprogram.uniform4fv ('v_resolution', this.v_resolution);\n\t\tprogram.uniform1f ('f_time', globals.time);\n\t\tprogram.uniform1f ('f_scale', this._globalScale);\n\t\tprogram.uniform1f ('f_alpha', this._alpha);\n\t\tprogram.uniform1f ('f_depth', this.zvalue);\n\n\t\tif (this.activeTextureId !== img.textureId || this.activeShader !== program)\n\t\t{\n\t\t\tgl.activeTexture (gl.TEXTURE0);\n\t\t\tgl.bindTexture (gl.TEXTURE_2D, img.textureId);\n\n\t\t\tprogram.uniform1i ('texture0', 0);\n\t\t\tprogram.uniform4f ('v_frame_size', frameWidth*img.rscale/textureWidth, frameHeight*img.rscale/textureHeight, frameWidth, frameHeight);\n\n\t\t\tthis.activeTextureId = img.textureId;\n\t\t\tthis.activeShader = program;\n\t\t}\n\n\t\tthis.m_quad[0] = dw;\n\t\tthis.m_quad[4] = dh;\n\t\tthis.m_quad[6] = dx;\n\t\tthis.m_quad[7] = dy;\n\n\t\tthis.m_texture[0] = sw / textureWidth;\n\t\tthis.m_texture[4] = sh / textureHeight;\n\t\tthis.m_texture[6] = sx / textureWidth;\n\t\tthis.m_texture[7] = sy / textureHeight;\n\n\t\tgl.uniformMatrix3fv (program.getUniformLocation('m_transform'), false, this.transform.data);\n\t\tgl.uniformMatrix3fv (program.getUniformLocation('m_quad'), false, this.m_quad);\n\t\tgl.uniformMatrix3fv (program.getUniformLocation('m_texture'), false, this.m_texture);\n\n\t\tgl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\t};\n\n\t// TODO test if this still works\n\t// drawRect (float x, float y, float w, float h, Image img=null);\n\tthis.drawRect = function (x, y, w, h, img=null)\n\t{\n\t\tlet gl = this.gl;\n\t\tlet program = this.shaderProgram;\n\n\t\tprogram.uniform4fv ('v_resolution', this.v_resolution);\n\t\tprogram.uniform1f ('f_time', globals.time);\n\t\tprogram.uniform1f ('f_scale', this._globalScale);\n\t\tprogram.uniform1f ('f_alpha', this._alpha);\n\n\t\tthis.activeTextureId = null;\n\n\t\tthis.m_quad[0] = w;\n\t\tthis.m_quad[4] = h;\n\t\tthis.m_quad[6] = x;\n\t\tthis.m_quad[7] = y;\n\n\t\tthis.m_texture[0] = 1.0;\n\t\tthis.m_texture[4] = 1.0;\n\t\tthis.m_texture[6] = 0.0;\n\t\tthis.m_texture[7] = 0.0;\n\n\t\tgl.uniformMatrix3fv (program.getUniformLocation('m_transform'), false, this.transform.data);\n\t\tgl.uniformMatrix3fv (program.getUniformLocation('m_quad'), false, this.m_quad);\n\t\tgl.uniformMatrix3fv (program.getUniformLocation('m_texture'), false, this.m_texture);\n\t\tgl.uniform1f (program.getUniformLocation('f_depth'), this.zvalue);\n\t\tgl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\t};\n};\n\n/**\n * Prepares an image to use it on the canvas.\n * !prepareImage (image: HTMLImageElement) : void;\n */\nCanvas.prototype.prepareImage = function (image)\n{\n\t// REVIEW : ensure the properties from image aren't overwritten by `mutate`.\n\t// TODO : optimize this area or remove the method\n\tClass.mutate(Texture, image, { width: image.width, height: image.height }).upload(image);\n};\n\n/**\n * Creates a new texture of the specified size.\n * !createTexture (width: number, height: number, filter?: Texture.FilterType, mipmap?: number) : Texture;\n */\nCanvas.prototype.createTexture = function (width, height, filter='NEAREST', mipmap=0)\n{\n\treturn new Texture (width, height).setFilter(filter).setMipmap(mipmap).allocate();\n};\n\n/**\n * \tApplies the current config to the canvas (usually called after a reset on the canvas).\n */\nCanvas.prototype.applyConfig = function ()\n{\n\tif (this.antialias == false)\n\t{\n\t\tif (this.context != null)\n\t\t\tthis.context.imageSmoothingEnabled = false;\n\n\t\tthis.elem.style.imageRendering = 'crisp-edges';\n\t}\n\telse\n\t{\n\t\tif (this.context != null)\n\t\t\tthis.context.imageSmoothingEnabled = true;\n\n\t\tthis.elem.style.imageRendering = 'auto';\n\t}\n};\n\n/**\n * \tDisposes the resources used by the canvas. The HTMLCanvasElement will also be removed from the document.\n */\nCanvas.prototype.dispose = function ()\n{\n\tif (this.elem.parentNode)\n\t\tthis.elem.parentNode.removeChild (this.elem);\n\n\tthis.matrixStack.free();\n\tthis.alphaStack.free();\n\tthis.depthFlagStack.free();\n\tthis.shaderProgramStack.free();\n\n\tthis.matr = null;\n\tthis.context = null;\n\tthis.elem = null;\n};\n\n/**\n * \tSets the default background color of the canvas. Does not cause a canvas clear.\n * \t!setBackground (color: string) : void;\n */\nCanvas.prototype.setBackground = function (color)\n{\n\tthis.elem.style.background = color;\n\tthis.backgroundColor = color;\n\n\tif (this.gl !== null)\n\t{\n\t\tif (color.length != 7)\n\t\t\tthrow new Error ('Canvas.setBackground: color parameter should be CSS-style hex-rgb with 6 digits.');\n\n\t\tlet r = parseInt(color.substr(1,2), 16) / 255.0;\n\t\tlet g = parseInt(color.substr(3,2), 16) / 255.0;\n\t\tlet b = parseInt(color.substr(5,2), 16) / 255.0;\n\n\t\tthis.gl.clearColor (r, g, b, 1.0);\n\t}\n};\n\n/**\n * \tSets the canvas size.\n * \t!resize (width: number, height: number) : Canvas;\n */\nCanvas.prototype.resize = function (width, height)\n{\n\tlet rect = this.elem.getBoundingClientRect();\n\n\tif (!width) width = rect.width;\n\tif (!height) height = rect.height;\n\n\tthis.elem.width = width;\n\tthis.elem.height = height;\n\n\tthis.width = this.elem.width;\n\tthis.height = this.elem.height;\n\n\tthis._width = int(this.width / this._globalScale);\n\tthis._height = int(this.height / this._globalScale);\n\n\tlet gl = this.gl;\n\tif (gl != null)\n\t{\n\t\tgl.enable (gl.SCISSOR_TEST);\n\t\tgl.scissor (0, 0, this.width, this.height);\n\t\tgl.viewport (0, 0, this.width, this.height);\n\n\t\tif (this.v_resolution)\n\t\t{\n\t\t\t//violet:hardware scaling\n\t\t\t//this.v_resolution[0] = this._width;\n\t\t\t//this.v_resolution[1] = this._height;\n\n\t\t\tthis.v_resolution[0] = this.width;\n\t\t\tthis.v_resolution[1] = this.height;\n\n\t\t\tthis.v_resolution[2] = this.width;\n\t\t\tthis.v_resolution[3] = this.height;\n\t\t}\n\t}\n\n\tthis.applyConfig();\n\treturn this;\n};\n\n/**\n * \tSets the global canvas scale.\n * \t!globalScale (value: number) : Canvas;\n */\nCanvas.prototype.globalScale = function (value)\n{\n\tthis._globalScale = value;\n\n\tthis._width = int(this.width / this._globalScale);\n\tthis._height = int(this.height / this._globalScale);\n\n\tthis.loadIdentity();\n\n\t//violet:hardware scaling\n\t//if (this.gl === null)\n\t\tthis.scale(value, value);\n\n\treturn this;\n};\n\n/**\n * \tSets the flipped status of the canvas, that is, if the canvas coordinates are flipped (i.e. `xy` is now `yx`).\n * \t!flipped (value: boolean) : Canvas;\n */\nCanvas.prototype.flipped = function (value)\n{\n\tif (value)\n\t{\n\t\tthis._width = int(this.height / this._globalScale);\n\t\tthis._height = int(this.width / this._globalScale);\n\t}\n\telse\n\t{\n\t\tthis._width = int(this.width / this._globalScale);\n\t\tthis._height = int(this.height / this._globalScale);\n\t}\n\n\tif (this.gl != null && this.v_resolution)\n\t{\n\t\tthis.v_resolution[0] = this.width;\n\t\tthis.v_resolution[1] = this.height;\n\n\t\tthis.v_resolution[2] = value ? this.height : this.width;\n\t\tthis.v_resolution[3] = value ? this.width : this.height;\n\t}\n\n\tthis.isFlipped = value;\n\treturn this;\n};\n\n/**\n * \tSaves the clip state of the canvas. Works only in GL mode.\n * \t!pushClip() : Canvas;\n */\nCanvas.prototype.pushClip = function ()\n{\n\treturn this;\n};\n\n/**\n * \tRestores the clip state of the canvas. Works only in GL mode.\n * \t!popClip() : Canvas;\n */\nCanvas.prototype.popClip = function ()\n{\n\tif (this.gl != null)\n\t\tthis.gl.scissor(0, 0, this.width, this.height);\n\n\treturn this;\n};\n\n/**\n * \tReturns the image on the canvas as a string in DATA-URI format.\n * \t!toDataUrl (mime: string, params?: object) : string;\n */\nCanvas.prototype.toDataUrl = function (mime='image/png', params=null)\n{\n\treturn this.elem.toDataURL (mime, params);\n};\n\n/**\n * \tReturns the image as a Base-64 encoded PNG string.\n * \t!toPngBase64() : string;\n */\nCanvas.prototype.toPngBase64 = function ()\n{\n\treturn this.elem.toDataURL(\"image/png\").substr(22);\n};\n\n/**\n * \tSets or returns an attribute of the canvas context.\n */\nCanvas.prototype._contextAttribute = function (name, value=null)\n{\n\tif (!this.context) return;\n\n\tif (value !== null)\n\t{\n\t\tthis.context[name] = value;\n\t\treturn this;\n\t}\n\n\treturn this.context[name];\n};\n\n/**\n * \tSets the fill style.\n * \t!fillStyle (value: string) : Canvas;\n */\n/**\n * \tReturns the current fill style.\n * \t!fillStyle () : string;\n */\nCanvas.prototype.fillStyle = function (value)\n{\n\treturn this._contextAttribute (\"fillStyle\", value);\n};\n\n/**\n * \tSets the stroke style.\n * \t!strokeStyle (value: string) : Canvas;\n */\n/**\n * \tReturns the current strroke style.\n * \t!strokeStyle () : string;\n */\nCanvas.prototype.strokeStyle = function (value)\n{\n\treturn this._contextAttribute (\"strokeStyle\", value);\n};\n\n/**\n * \tSets the line cap style (Possible values are `butt`, `round`, or `square`. `butt` is default).\n * \t!lineCap (value: string) : Canvas;\n */\n/**\n * \tReturns the current line cap style.\n * \t!lineCap() : string;\n */\nCanvas.prototype.lineCap = function (value)\n{\n\treturn this._contextAttribute (\"lineCap\", value);\n};\n\n// violet\n\n/*\n**\tSets or returns the current line join style (bevel, round, miter. miter is default).\n**\n**\t>> Canvas lineJoin (string value);\n**\t>> string lineJoin ();\n*/\n\nCanvas.prototype.lineJoin = function (value)\n{\n\treturn this._contextAttribute (\"lineJoin\", value);\n};\n\n\n/*\n**\tSets or returns the current line width value (default 1).\n**\n**\t>> Canvas lineWidth (float value);\n**\t>> float lineWidth ();\n*/\n\nCanvas.prototype.lineWidth = function (value)\n{\n\treturn this._contextAttribute (\"lineWidth\", value);\n};\n\n\n/*\n**\tSets or returns the current miter limit value (default 10).\n**\n**\t>> Canvas miterLimit (float value);\n**\t>> float miterLimit ();\n*/\n\nCanvas.prototype.miterLimit = function (value)\n{\n\treturn this._contextAttribute (\"miterLimit\", value);\n};\n\n\n/*\n**\tSets or returns the current shadow color value (default black).\n**\n**\t>> Canvas shadowColor (string value);\n**\t>> string shadowColor ();\n*/\n\nCanvas.prototype.shadowColor = function (value)\n{\n\treturn this._contextAttribute (\"shadowColor\", value);\n};\n\n\n/*\n**\tSets or returns the current shadow X offset (default 0).\n**\n**\t>> Canvas shadowOffsetX (float value);\n**\t>> float shadowOffsetX ();\n*/\n\nCanvas.prototype.shadowOffsetX = function (value)\n{\n\treturn this._contextAttribute (\"shadowOffsetX\", value);\n};\n\n\n/*\n**\tSets or returns the current shadow Y offset (default 0).\n**\n**\t>> Canvas shadowOffsetY (float value);\n**\t>> float shadowOffsetY ();\n*/\n\nCanvas.prototype.shadowOffsetY = function (value)\n{\n\treturn this._contextAttribute (\"shadowOffsetY\", value);\n};\n\n\n/*\n**\tSets or returns the current shadow blue value (default 0).\n**\n**\t>> Canvas shadowBlur (string value);\n**\t>> string shadowBlur ();\n*/\n\nCanvas.prototype.shadowBlur = function (value)\n{\n\treturn this._contextAttribute (\"shadowBlur\", value);\n};\n\n\n/*\n**\tSets or returns the current font settings.\n**\n**\t>> Canvas font (string value);\n**\t>> string font ();\n*/\n\nCanvas.prototype.font = function (value)\n{\n\treturn this._contextAttribute (\"font\", value);\n};\n\n\n/*\n**\tSets or returns the current text align settings (start, end, left, right, center).\n**\n**\t>> Canvas textAlign (string value);\n**\t>> string textAlign ();\n*/\n\nCanvas.prototype.textAlign = function (value)\n{\n\treturn this._contextAttribute (\"textAlign\", value);\n};\n\n\n/*\n**\tSets or returns the current text base line settings (alphabetic, bottom, hanging, ideographic, middle, top. Alphabetic is default).\n**\n**\t>> Canvas textBaseline (string value);\n**\t>> string textBaseline ();\n*/\n\nCanvas.prototype.textBaseline = function (value)\n{\n\treturn this._contextAttribute (\"textBaseline\", value);\n};\n\n\n/*\n**\tSets or returns the current global alpha value.\n**\n**\t>> Canvas globalAlpha (float value);\n**\t>> float globalAlpha ();\n*/\n\nCanvas.prototype.globalAlpha = function (value=null)\n{\n\tif (value !== null)\n\t\tthis._alpha = value;\n\telse\n\t\treturn this._alpha;\n\n\treturn this.alpha(1.0);\n};\n\n\n/*\n**\tSets or returns the current global composite operation value (source-atop, source-in, source-out, source-over, destination-atop,\n**\tdestination-in, destination-out, destination-over, lighter, copy, xor).\n**\n**\t>> Canvas globalCompositeOperation (string value);\n**\t>> string globalCompositeOperation ();\n*/\nCanvas.prototype.globalCompositeOperation = function (value)\n{\n\treturn this._contextAttribute (\"globalCompositeOperation\", value);\n};\n\n/*\n**\tUpdates the underlying canvas or gl transformation matrix. \n**\n**\tCanvas updateTransform();\n*/\nCanvas.prototype.updateTransform = function()\n{\n\tthis.setTransform (this.matr.data[0], this.matr.data[1], this.matr.data[3], this.matr.data[4], this.matr.data[6], this.matr.data[7]);\n\treturn this;\n};\n\n/*\n**\tSets the canvas or gl transformation matrix to the given one.\n**\n**\tCanvas setTransform (float a, float b, float c, float d, float e, float f)\n*/\nCanvas.prototype.setTransform = function (a, b, c, d, e, f)\n{\n\tif (this.context === null)\n\t{\n\t\tthis.transform.data[0] = a;\n\t\tthis.transform.data[1] = b;\n\t\tthis.transform.data[2] = 0;\n\t\tthis.transform.data[3] = c;\n\t\tthis.transform.data[4] = d;\n\t\tthis.transform.data[5] = 0;\n\t\tthis.transform.data[6] = int(e);//Math.ceil(e);\n\t\tthis.transform.data[7] = int(f);//Math.ceil(f);\n\t\tthis.transform.data[8] = 1;\n\n\t\treturn this;\n\t}\n\n\t//this.context.setTransform (a, b, c, d, Math.ceil(e), Math.ceil(f));\n\tthis.context.setTransform (a, b, c, d, int(e), int(f));\n\treturn this;\n};\n\n/*\n**\tDraws a filled rectangle on the canvas.\n**\n**\tCanvas fillRect (float x, float y, float w, float h)\n*/\nCanvas.prototype.fillRect = function (x, y, w, h)\n{\n\tthis.context.fillRect (x, y, w, h);\n\treturn this;\n};\n\n/*\n**\tDraws an stroked rectangle on the canvas.\n**\n**\tCanvas strokeRect (float x, float y, float w, float h)\n*/\nCanvas.prototype.strokeRect = function (x, y, w, h)\n{\n\tthis.context.strokeRect (x, y, w, h);\n\treturn this;\n};\n\n/*\n**\tClears a rectangle on the canvas. All pixels will be erased.\n**\n**\tCanvas clearRect (float x, float y, float w, float h)\n*/\nCanvas.prototype.clearRect = function (x, y, w, h)\n{\n\tthis.context.clearRect (x, y, w, h);\n\treturn this;\n};\n\n/*\n**\tStarts a new path. Any previous path points will be cleared.\n**\n**\tCanvas beginPath()\n*/\nCanvas.prototype.beginPath = function ()\n{\n\tthis.context.beginPath ();\n\treturn this;\n};\n\n/*\n**\tCreates a new point in the current path.\n**\n**\tCanvas moveTo (float x, float y)\n*/\nCanvas.prototype.moveTo = function (x, y)\n{\n\tthis.context.moveTo (x, y);\n\treturn this;\n};\n\n/*\n**\tCreates a new point from the first path point to the last, and finishes the path.\n**\n**\tCanvas closePath()\n*/\nCanvas.prototype.closePath = function ()\n{\n\tthis.context.closePath ();\n\treturn this;\n};\n\n/*\n**\tDraws a line from the last point on the path to the given point.\n**\n**\tCanvas lineTo (float x, float y)\n*/\nCanvas.prototype.lineTo = function (x, y)\n{\n\tthis.context.lineTo (x, y);\n\treturn this;\n};\n\n/*\n**\tCreates a hollow rectangle path on the canvas for subsequent stroke or fill.\n**\n**\tCanvas rect (float x, float y, float w, float h)\n*/\nCanvas.prototype.rect = function (x, y, w, h)\n{\n\tthis.context.rect (x, y, w, h);\n\treturn this;\n};\n\n/*\n**\tFills the active path with the current fill style or with the one given in the value parameter.\n**\n**\tCanvas fill (string value=null)\n*/\nCanvas.prototype.fill = function (value=null)\n{\n\tif (value) this.fillStyle (value);\n\tthis.context.fill ();\n\treturn this;\n};\n\n/*\n**\tStrokes the active path with the current stroke style or with the one given in the value parameter.\n**\n**\tCanvas stroke (string value=null)\n*/\nCanvas.prototype.stroke = function (value=null)\n{\n\tif (value) this.strokeStyle (value);\n\tthis.context.stroke ();\n\treturn this;\n};\n\n/*\n**\tClips a region of the canvas so that only the region will be used for drawing. Coordinates must be in logical screen space.\n**\n**\tCanvas clip()\n*/\nCanvas.prototype.clip = function (x, y, width, height)\n{\n\tif (this.gl !== null)\n\t{\n\t\tx *= this._globalScale;\n\t\ty *= this._globalScale;\n\t\twidth *= this._globalScale;\n\t\theight *= this._globalScale;\n\n\t\tif (this.isFlipped)\n\t\t\tthis.gl.scissor(this.width-y-height-1, this.height-x-width-1, height, width);\n\t\telse\n\t\t\tthis.gl.scissor(x, this.height-y-height-1, width, height);\n\t}\n\n\treturn this;\n};\n\n/*\n**\tAdds points of a quadratic curve to the active path. A control points and one reference point must be provided.\n**\n**\tCanvas quadraticCurveTo (float cpx, float cpy, float x, float y)\n*/\nCanvas.prototype.quadraticCurveTo = function (cpx, cpy, x, y)\n{\n\tthis.context.quadraticCurveTo (cpx, cpy, x, y);\n\treturn this;\n};\n\n/*\n**\tAdds points of a bezier curve to the active path. Two control points and one reference point must be provided.\n**\n**\tCanvas bezierCurveTo (float cx1, float cy1, float cx2, float cy2, float x, float y)\n*/\nCanvas.prototype.bezierCurveTo = function (cx1, cy1, cx2, cy2, x, y)\n{\n\tthis.context.bezierCurveTo (cx1, cy1, cx2, cy2, x, y);\n\treturn this;\n};\n\n/*\n**\tAdds points of an arc the the active path. Used to draw a circle of part of it.\n**\n**\tCanvas arc (float x, float y, float r, float sA, float eA, float cw)\n*/\nCanvas.prototype.arc = function (x, y, r, sA, eA, cw)\n{\n\tthis.context.arc (x, y, r, sA, eA, cw);\n\treturn this;\n};\n\n/*\n**\tAdds points of an arc to the active path. Used to create an arc between two points.\n**\n**\tCanvas arcTo (float x1, float y1, float x2, float y2, float r)\n*/\nCanvas.prototype.arcTo = function (x1, y1, x2, y2, r)\n{\n\tthis.context.arcTo (x1, y1, x2, y2, r);\n\treturn this;\n};\n\n/*\n**\tDraws filled text on the canvas with the active font, and fillStyle properties.\n**\n**\tCanvas fillText (string text, float x, float y, float maxWidth=1000)\n*/\nCanvas.prototype.fillText = function (text, x, y, maxWidth=1000)\n{\n\tthis.context.fillText (text, x, y, maxWidth);\n\treturn this;\n};\n\n/*\n**\tDraws stroked text on the canvas with the active font, and fillStyle properties.\n**\n**\tCanvas strokeText (string text, float x, float y, float maxWidth=1000)\n*/\nCanvas.prototype.strokeText = function (text, x, y, maxWidth=1000)\n{\n\tthis.context.strokeText (text, x, y, maxWidth);\n\treturn this;\n};\n\n\n/*\n**\tMeasures the width of the given text using active font properties.\n**\n**\tfloat measureText (string text)\n*/\nCanvas.prototype.measureText = function (text)\n{\n\treturn this.context.measureText(text).width;\n};\n\n\n/*\n**\tReturns a new image data object with the specified size.\n**\n**\tImageData createImageData (float w, float h)\n*/\nCanvas.prototype.createImageData = function (w, h)\n{\n\treturn this.context.createImageData (w, h);\n};\n\n\n/*\n**\tReturns an image data object with the pixels of a rectangular area of the canvas.\n**\n**\tImageData getImageData (float x, float y, float w, float h)\n*/\nCanvas.prototype.getImageData = function (x, y, w, h)\n{\n\treturn this.context.getImageData (x, y, w, h);\n};\n\n\n/*\n**\tPuts image data on the canvas at the specified location.\n**\n**\tCanvas putImageData (ImageData data, float x, float y)\n*/\nCanvas.prototype.putImageData = function (data, x, y)\n{\n\tthis.context.putImageData (data, x, y);\n\treturn this;\n};\n\n\n/*\n**\tDraws an image on the canvas.\n**\n**\tCanvas drawImage (Image img, float x, float y)\n**\tCanvas drawImage (Image img, float x, float y, float w, float h)\n**\tCanvas drawImage (Image img, float sx, float sy, float sw, float sh, float dx, float dy, float dw, float dh)\n*/\nCanvas.prototype.drawImage = function (img, sx=0, sy=0, sw=null, sh=null, dx=null, dy=null, dw=null, dh=null)\n{\n\tif (sw === null)\n\t{\n\t\tthis.context.drawImage (img, int(sx), int(sy));\n\t}\n\telse if (dx === null)\n\t{\n\t\tthis.context.drawImage (img, int(sx), int(sy), int(sw), int(sh));\n\t}\n\telse\n\t{\n\t\tlet a3 = int(sw);\n\t\tlet a4 = int(sh);\n\t\tif (!a3 || !a4) return this;\n\n\t\tlet a7 = int(dw);\n\t\tlet a8 = int(dh);\n\t\tif (!a7 || !a8) return this;\n\n\t\tthis.context.drawImage (img, int(sx), int(sy), a3, a4, int(dx), int(dy), a7, a8);\n\t}\n\n\treturn this;\n};\n\n\n/*\n**\tClears the entire canvas. If the backgroundColor parameter is set the canvas will be cleared manually by using\n**\tthe fillRect method.\n**\n**\tCanvas clear (string backgroundColor)\n**\tCanvas clear ()\n*/\n\nCanvas.prototype.clear = function (backgroundColor=null)\n{\n\tif (this.gl != null)\n\t{\n\t\tthis.gl.clear(this.gl.STENCIL_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT | this.gl.COLOR_BUFFER_BIT);\n\t\tthis.activeTextureId = null;\n\t\treturn this;\n\t}\n\n\tif (backgroundColor)\n\t{\n\t\tthis.globalCompositeOperation(\"source-over\").globalAlpha(1.0).fillStyle(backgroundColor !== true ? backgroundColor : this.backgroundColor).fillRect(0, 0, this._width, this._height);\n\t}\n\telse\n\t{\n\t\tthis.elem.width = this.width;\n\t\tthis.applyConfig();\n\t}\n\n\tthis.updateTransform();\n\treturn this;\n};\n\n\n/*\n**\tIndicates that rendering is about to start. Used only in GL mode.\n*/\nCanvas.prototype.start = function ()\n{\n};\n\n/*\n**\tIndicates that rendering has ended. Used only in GL mode.\n*/\nCanvas.prototype.end = function ()\n{\n};\n\n/*\n**\tIndicates that rendering has been completed and any flush operation should be executed. Used only in GL mode.\n*/\nCanvas.prototype.flush = function ()\n{\n\t//let gl = this.gl;\n\t//if (gl === null) return;\n\n\t//gl.colorMask (false, false, false, true);\n\t//gl.clear (gl.COLOR_BUFFER_BIT);\n\t//gl.colorMask (true, true, true, true);\n\n\t// NOTE Add gl.flush() if not using RAF.\n};\n\n/**\n * Blits the specified texture to the active framebuffer.\n */\nCanvas.prototype.blit = function (textureId, width, height, shaderProgram=null)\n{\n\tlet gl = this.gl;\n\tif (gl === null) return;\n\n\tshaderProgram = shaderProgram || this.glBlitProgram;\n\n\tthis.setShaderProgram(shaderProgram);\n\tgl.disable (gl.DEPTH_TEST);\n\n\t\tgl.activeTexture (gl.TEXTURE0);\n\t\tgl.bindTexture (gl.TEXTURE_2D, textureId);\n\t\tshaderProgram.uniform1i ('texture0', 0);\n\n\t\tshaderProgram.uniform4fv ('v_resolution', this.v_resolution);\n\t\tshaderProgram.uniform1f ('f_time', globals.time);\n\t\tshaderProgram.uniform1f ('f_scale', this._globalScale);\n\t\tshaderProgram.uniform1f ('f_alpha', this._alpha);\n\n\t\tthis.m_quad[0] = this.width;\n\t\tthis.m_quad[4] = this.height;\n\t\tthis.m_quad[6] = 0;\n\t\tthis.m_quad[7] = 0;\n\n\t\tthis.m_texture[0] = this.width / width;\n\t\tthis.m_texture[4] = this.height / height;\n\t\tthis.m_texture[6] = 0.0;\n\t\tthis.m_texture[7] = 0.0;\n\n\t\tgl.uniformMatrix3fv (shaderProgram.getUniformLocation('m_quad'), false, this.m_quad);\n\t\tgl.uniformMatrix3fv (shaderProgram.getUniformLocation('m_texture'), false, this.m_texture);\n\t\tgl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\n\tthis.setShaderProgram(ShaderProgram.get('def'));\n\tgl.enable (gl.DEPTH_TEST);\n};\n\n/*\n**\tResets the context drawing properties to their initial values.\n**\n**\tCanvas reset (bool clearPath=false);\n*/\nCanvas.prototype.reset = function (clearPath=false)\n{\n\tthis.fillStyle(\"#000000\").strokeStyle(\"#000000\").lineCap(\"butt\").lineJoin(\"miter\")\n\t.lineWidth(\"1\").miterLimit(\"10\").shadowColor(\"#000000\").shadowOffsetX(\"0\")\n\t.shadowOffsetY(\"0\").shadowBlur(\"0\").globalAlpha(\"1.0\").globalCompositeOperation(\"source-over\");\n\n\tif (clearPath) this.beginPath().closePath();\n\n\treturn this;\n};\n\n/*\n**\tPushes the current transformation matrix into the matrix stack.\n*/\nCanvas.prototype.pushMatrix = function ()\n{\n\tthis.matrixStack.push(this.matr);\n\tthis.matr = this.matr.clone();\n\n\treturn this;\n};\n\n/*\n**\tPops a matrix from the matrix stack into the transformation matrix.\n*/\nCanvas.prototype.popMatrix = function ()\n{\n\tthis.matr.free();\n\tthis.matr = this.matrixStack.pop();\n\n\treturn this.updateTransform();\n};\n\n/*\n**\tSets or returns the relative alpha value for subsequent drawing operations.\n**\n**\t>> Canvas alpha (float value);\n**\t>> float alpha ();\n*/\n\nCanvas.prototype.alpha = function (value)\n{\n\tthis._alpha *= value;\n\n\tif (this.context && this.gl === null)\n\t\tthis.context.globalAlpha = this._alpha;\n\n\treturn this;\n};\n\n/*\n**\tPushes the current global alpha into the stack.\n*/\nCanvas.prototype.pushAlpha = function ()\n{\n\tthis.alphaStack.push (this.globalAlpha());\n\treturn this;\n};\n\n/*\n**\tPops an alpha from the stack into the global alpha.\n**\n**\t>> Canvas popAlpha();\n*/\nCanvas.prototype.popAlpha = function ()\n{\n\tthis.globalAlpha(this.alphaStack.pop());\n\treturn this;\n};\n\n/*\n**\tSets the depth-test flag.\n*/\nCanvas.prototype.setDepthFlag = function (value)\n{\n\tlet gl = this.gl;\n\tif (gl === null) return;\n\n\tif (value)\n\t{\n\t\tgl.enable (gl.DEPTH_TEST);\n\t\tthis._depthFlag = true;\n\t}\n\telse\n\t{\n\t\tgl.disable (gl.DEPTH_TEST);\n\t\tthis._depthFlag = false;\n\t}\n};\n\n/*\n**\tReturns the depth-test flag.\n*/\nCanvas.prototype.getDepthFlag = function ()\n{\n\treturn this._depthFlag;\n};\n\n/*\n**\tPushes the current depth-test flag into the depth flag stack. If a value is provided, the current flag will be pushed and set to the\n**\tgiven value only if they're different, when so, true will be returned.\n*/\nCanvas.prototype.pushDepthFlag = function (value=null)\n{\n\tif (value !== null)\n\t{\n\t\tvalue = !!value;\n\n\t\tif (value === this._depthFlag)\n\t\t\treturn false;\n\n\t\tthis.depthFlagStack.push(this._depthFlag);\n\t\tthis.setDepthFlag(value);\n\n\t\treturn true;\n\t}\n\n\tthis.depthFlagStack.push(this._depthFlag);\n};\n\n/*\n**\tPops the depth-test flag from the depth flag stack.\n*/\nCanvas.prototype.popDepthFlag = function ()\n{\n\tthis.setDepthFlag(this.depthFlagStack.pop());\n};\n\n/*\n**\tSets the active shader program.\n*/\nCanvas.prototype.setShaderProgram = function (program)\n{\n\tlet gl = this.gl;\n\tif (gl === null) return;\n\n\tthis.shaderProgram = program;\n\tthis.shaderProgram.activate();\n};\n\n/*\n**\tReturns the current shader program.\n*/\nCanvas.prototype.getShaderProgram = function ()\n{\n\treturn this.shaderProgram;\n};\n\n/*\n**\tPushes the current shader program into the stack. If a value is provided, the current shader program will be pushed and set to the\n**\tgiven one only if they're different, when so, true will be returned.\n*/\nCanvas.prototype.pushShaderProgram = function (program=null)\n{\n\tif (program !== null)\n\t{\n\t\tif (program === this.shaderProgram)\n\t\t\treturn false;\n\n\t\tthis.shaderProgramStack.push(this.shaderProgram);\n\t\tthis.setShaderProgram(program);\n\n\t\treturn true;\n\t}\n\n\tthis.shaderProgramStack.push(this.shaderProgram);\n};\n\n/*\n**\tPops the shader program from the stack.\n*/\nCanvas.prototype.popShaderProgram = function ()\n{\n\tthis.setShaderProgram(this.shaderProgramStack.pop());\n};\n\n\n/*\n**\tSets the transformation matrix to identity.\n**\n**\t>> Canvas loadIdentity();\n*/\n\nCanvas.prototype.loadIdentity = function ()\n{\n\tthis.matr.identity();\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tSets the transformation matrix to the specified one.\n**\n**\t>> Canvas loadMatrix (Matrix matr);\n*/\n\nCanvas.prototype.loadMatrix = function (matr)\n{\n\tthis.matr.set(matr);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tReturns the current transformation matrix, when `clone` is set to true, a cloned matrix will be returned.\n**\n**\t>> Matrix getMatrix(bool clone=false);\n*/\n\nCanvas.prototype.getMatrix = function (clone=false)\n{\n\treturn clone ? this.matr.clone() : this.matr;\n};\n\n\n/*\n**\tAppends a matrix to the current transformation matrix.\n**\n**\t>> Canvas appendMatrix (Matrix matr);\n*/\n\nCanvas.prototype.appendMatrix = function (matr)\n{\n\tthis.matr.append(matr);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tSets scaling factors for subsequent drawing operations. If the useNative is not set then scale with the current\n**\ttransformation matrix will be performed.\n**\n**\t>> Canvas scale (float sx, float sy, bool useNative=false);\n*/\n\nCanvas.prototype.scale = function (sx, sy, useNative=false)\n{\n\tif (useNative) {\n\t\tthis.context.scale (sx, sy);\n\t\treturn this;\n\t}\n\n\tthis.matr.scale (sx, sy);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tSets rotation factor for subsequent drawing operations. The angle is in radians. If useNative is not set\n**\tthen rotation with the transformation matrix will be used.\n**\n**\t>> Canvas rotate (float angle, bool useNative=false);\n*/\n\nCanvas.prototype.rotate = function (angle, useNative=false)\n{\n\tif (useNative) {\n\t\tthis.context.rotate (angle);\n\t\treturn this;\n\t}\n\n\tthis.matr.rotate(angle);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tMoves starting point to an specified location. If the useNative parameter is not set then translation with\n**\tthe transformation matrix will be done.\n**\n**\t>> Canvas translate (float x, float y, bool useNative=false);\n*/\n\nCanvas.prototype.translate = function (x, y, useNative=false)\n{\n\tif (useNative) {\n\t\tthis.context.translate(x, y);\n\t\treturn this;\n\t}\n\n\tthis.matr.translate(x, y);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tCreates a hollow ellipse path on the canvas for subsequent stroke or fill.\n**\n**\t>> Canvas ellipse (float x, float y, float w, float h);\n*/\n\nCanvas.prototype.ellipse = function (x, y, w, h)\n{\n\tvar ox = (w/2)*.5522848, oy = (h/2)*.5522848;\n\tvar xe = x+w-1, ye = y+h-1, xm = x+w/2, ym = y+h/2;\n\n\tthis.beginPath ().moveTo(x, ym);\n\tthis.bezierCurveTo (x, ym - oy, xm - ox, y, xm, y);\n\tthis.bezierCurveTo (xm + ox, y, xe, ym - oy, xe, ym);\n\tthis.bezierCurveTo (xe, ym + oy, xm + ox, ye, xm, ye);\n\tthis.bezierCurveTo (xm - ox, ye, x, ym + oy, x, ym);\n\tthis.closePath ();\n\n\treturn this;\n};\n\n\n/*\n**\tCreates a hollow circle path on the canvas for subsequent stroke or fill. If the stroke param is set the circle\n**\twill be drawn with the specified stroke color.\n**\n**\t>> Canvas circle (float x, float y, float r, string strokeColor);\n**\t>> Canvas circle (float x, float y, float r);\n*/\n\nCanvas.prototype.circle = function (x, y, r, stroke)\n{\n\tthis.beginPath();\n\tthis.arc(x, y, r, 0, 2*Math.PI);\n\tthis.closePath();\n\n\tif (stroke) this.stroke(stroke);\n\n\treturn this;\n};\n\n\n/*\n**\tDraws a line for subsequent stroke or fill. If the stroke param is set the line will be drawn with\n**\tthe specified stroke color.\n**\n**\t>> Canvas line (float x1, float y1, float x2, float y2, string strokeColor);\n**\t>> Canvas line (float x1, float y1, float x2, float y2);\n*/\n\nCanvas.prototype.line = function (x1, y1, x2, y2, stroke)\n{\n\tthis.beginPath();\n\tthis.moveTo(x1, y1);\n\tthis.lineTo(x2, y2);\n\tthis.closePath();\n\n\tif (stroke) this.stroke(stroke);\n\treturn this;\n};\n\n\n/*\n**\tAttaches internal listeners for mouse/pointer events on the canvas object, this is called automatically when\n**\tattaching handlers to the canvas. The actual handlers are added or removed using the addPointerHandler and\n**\tremovePointerHandler respectively.\n**\n**\t>> Canvas enablePointerEvents();\n*/\n\nCanvas.prototype.enablePointerEvents = function()\n{\n\tif (this.pointerHandler) return this;\n\n\tthis.pointerScale = { sx: 1, sy: 1 };\n\tthis.pointerOffset = { x: 0, y: 0 };\n\n\tvar _ = this;\n\n\tvar _evt =\n\t{\n\t\taction: '',\n\t\tbuttons: 0, lbuttons: 0,\n\t\tx: 0, y: 0,\n\n\t\tcontainedBy: function (x, y, w, h) {\n\t\t\treturn this.x >= x && this.x <= (x+w-1) && this.y >= y && this.y <= (y+h-1);\n\t\t}\n\t};\n\n\tthis.pointerHandlers = [];\n\n\tthis.pointerHandler = function (code, evt)\n\t{\n\t\tvar rect = this.elem.getBoundingClientRect();\n\n\t\t_evt.action = code;\n\t\t_evt.buttons = evt.buttons;\n\t\t_evt.x = _evt.rx = int(evt.clientX - rect.left);\n\t\t_evt.y = _evt.ry = int(evt.clientY - rect.top);\n\n\t\t_evt.x = ((_evt.x - _.pointerOffset.x) - 0.0*_.pointerScale.sx) / _.pointerScale.sx;\n\t\t_evt.y = ((_evt.y - _.pointerOffset.y) - 0.0*_.pointerScale.sy) / _.pointerScale.sy;\n\n\t\t_evt.dragging = false;\n\n\t\tif (_evt.buttons && !_evt.lbuttons)\n\t\t{\n\t\t\t_evt.sx = _evt.x;\n\t\t\t_evt.sy = _evt.y;\n\n\t\t\t_evt.ldx = _evt.ldy = 0;\n\t\t}\n\n\t\tif (_evt.buttons && _evt.lbuttons)\n\t\t{\n\t\t\t_evt.dragging = true;\n\n\t\t\t_evt.dx = _evt.x - _evt.sx;\n\t\t\t_evt.dy = _evt.y - _evt.sy;\n\t\t\t\n\t\t\t_evt.ddx = _evt.dx - _evt.ldx;\n\t\t\t_evt.ddy = _evt.dy - _evt.ldy;\n\n\t\t\t_evt.ldx = _evt.dx;\n\t\t\t_evt.ldy = _evt.dy;\n\t\t}\n\n\t\t_evt.lbuttons = _evt.buttons;\n\n\t\tfor (var i = 0; i < this.pointerHandlers.length; i++)\n\t\t{\n\t\t\tif (this.pointerHandlers[i][1] (_evt, this.pointerHandlers[i][2]) === false)\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tthis.elem.onmousedown = function(evt) {  _.pointerHandler('DOWN', evt); };\n\tthis.elem.onmouseup = function(evt) { _.pointerHandler('UP', evt); };\n\tthis.elem.onmousemove = function(evt) { _.pointerHandler('MOVE', evt); };\n\n\treturn this;\n};\n\n\n/*\n**\tSets the pointer scaling factors.\n**\n**\t>> Canvas setPointerScale (float sx, float sy);\n*/\n\nCanvas.prototype.setPointerScale = function (sx, sy)\n{\n\tthis.pointerScale = { sx: sx, sy: sy };\n\treturn this;\n};\n\n\n/*\n**\tSets the pointer offset that is applied after scaling.\n**\n**\t>> Canvas setPointerOffset (float x, float y);\n*/\n\nCanvas.prototype.setPointerOffset = function (x, y)\n{\n\tthis.pointerOffset = { x: x, y: y };\n\treturn this;\n};\n\n\n/*\n**\tAdds a pointer event handler, returns the handler reference id for later removal.\n**\n**\t>> string addPointerHandler (function callback, object context);\n**\t>> string addPointerHandler (function callback);\n*/\n\nCanvas.prototype.addPointerHandler = function (callback, context)\n{\n\tthis.enablePointerEvents();\n\n\tthis.pointerHandlers.push ([this.pointerHandlers.length+\"_\"+int(Math.random()*1e6), callback, context]);\n\n\treturn this.pointerHandlers[this.pointerHandlers.length-1][0];\n};\n\n\n/*\n**\tRemoves a previously attached pointer event handler.\n**\n**\t>> void removePointerHandler (string id);\n*/\n\nCanvas.prototype.removePointerHandler = function (id)\n{\n\tif (!this.pointerHandlers) return;\n\n\tfor (var i = 0; i < this.pointerHandlers.length; i++)\n\t{\n\t\tif (this.pointerHandlers[i][0] == id)\n\t\t{\n\t\t\tthis.pointerHandlers.splice(i, 1);\n\t\t\tbreak;\n\t\t}\n\t}\n};\n\n/**\n * \tExecutes the `draw` function on a new canvas of the specified width and height. Renders it into an image and runs the completed callback with the ready HTMLImageElement object.\n * \t!static renderImage (width: number, height: number, draw: (g: Canvas) => void, completed: (img: HTMLImageElement, url: string) => void) : void;\n */\nCanvas.renderImage = function (width, height, draw, completed)\n{\n\tlet g = new Canvas ({ hidden: true, width: width, height: height, antialias: System.options.antialias });\n\n\tdraw(g);\n\tlet url = g.toDataUrl();\n\n\tlet img = new Image();\n\timg.onload = () =>\n\t{\n\t\timg.filter = System.options.antialias ? 'LINEAR' : 'NEAREST';\n\t\timg.rscale = 1.0;\n\t\timg.targetWidth = width;\n\t\timg.targetHeight = height;\n\n\t\tSystem.renderer.prepareImage(img);\n\t\tcompleted(img, url);\n\t};\n\n\timg.src = url;\n\tg.dispose();\n};\n\n/**\n * Executes the `draw` function on a new canvas of the specified width and height. Renders it into an image and runs the completed callback with the ready HTMLImageElement object,\n * note that this function will generate mipmap images.\n * !static renderImageMipmap (levels: number, width: number, height: number, draw: (g: Canvas) => void, completed: (img: HTMLImageElement, url: string) => void) : void;\n */\nCanvas.renderImageMipmap = function (levels, width, height, draw, completed)\n{\n\tlet g = new Canvas ({ hidden: true, width: width, height: height, antialias: System.options.antialias });\n\n\tdraw(g);\n\tlet url = g.toDataUrl();\n\n\tlet img = new Image();\n\timg.onload = () =>\n\t{\n\t\timg.filter = System.options.antialias ? 'LINEAR' : 'NEAREST';\n\t\timg.rscale = 1.0;\n\t\timg.targetWidth = width;\n\t\timg.targetHeight = height;\n\t\timg.mipmap = levels;\n\n\t\tSystem.renderer.prepareImage(img);\n\t\tcompleted(img, url);\n\t};\n\n\timg.src = url;\n\tg.dispose();\n};\n\nexport default Canvas;\n","\nimport { Class } from 'rinn';\nimport Recycler from '../utils/recycler.js';\nimport Vec2 from './vec2.js';\n\n//![import \"../utils/recycler\"]\n//![import \"./vec2\"]\n\nconst temp = new Float32Array(9).fill(0);\nconst temp2 = new Float32Array(9).fill(0);\n\n//:/**\n//: * \tRepresents a 3x3 matrix. Provides an interface to manipulate 3x3 matrices.\n//: */\n\n//!class Matrix\n\nconst Matrix = Class.extend\n({\n\tclassName: 'Matrix',\n\n\t/**\n\t * \tActual elements of the matrix.\n\t * \t!data: Float32Array\n\t */\n\tdata: null,\n\n\t/**\n\t * \tConstructs a new matrix copying the elements from the specified matrix.\n\t * \t!constructor(value: Matrix);\n\t */\n\t/**\n\t * \tConstructs a new matrix with the values from the specified array.\n\t * \t!constructor(value: Float32Array);\n\t */\n\t/**\n\t * \tConstructs a new matrix with the identity matrix values.\n\t * \t!constructor();\n\t */\n\t__ctor: function(value=null)\n\t{\n\t\tif (this.data === null)\n\t\t\tthis.data = new Float32Array(9);\n\n\t\tif (value !== null)\n\t\t\tthis.set(value);\n\t\telse\n\t\t\tthis.identity();\n\t},\n\n\t/**\n\t * \tFills the matrix with zeroes.\n\t * \t!zero() : Matrix;\n\t */\n\tzero: function()\n\t{\n\t\tthis.data.fill(0);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tFills the matrix with the specified value.\n\t * \t!fill (value: number) : Matrix;\n\t */\n\tfill: function (value)\n\t{\n\t\tthis.data.fill(value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCopies the specified matrix elements into the current one.\n\t * \t!set (value: Matrix) : Matrix;\n\t */\n\t/**\n\t * \tSets the matrix elements from the specified array.\n\t * \t!set (value: Float32Array) : Matrix;\n\t */\n\tset: function (value)\n\t{\n\t\tif (Matrix.isInstance(value))\n\t\t{\n\t\t\t//for (let i = 0; i < 9; i++) this.data[i] = value.data[i];\n\t\t\tthis.data.set(value.data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t//for (let i = 0; i < 9; i++) this.data[i] = value[i];\n\t\t\tthis.data.set(value);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the elements of the matrix to be the identity matrix.\n\t * \t!identity() : Matrix;\n\t */\n\tidentity: function (target=null)\n\t{\n\t\tif (target === null)\n\t\t\ttarget = this.data;\n\n\t\ttarget.fill(0);\n\t\ttarget[0] = target[4] = target[8] = 1;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMultiplies all elements in the matrix by a given scalar.\n\t * \t!scalef (scalar: number) : Matrix;\n\t */\n\tscalef: function (scalar)\n\t{\n\t\tfor (let i = 0; i < 9; i++) this.data[i] *= scalar;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns a clone of the matrix.\n\t * \t!clone() : Matrix;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Matrix.Pool.alloc(this);\n\t},\n\n\t/**\n\t * \tAppends the given matrix to the current one using matrix multiplication (self * matrix).\n\t * \t!append (matrix: Matrix) : Matrix;\n\t */\n\tappend: function (matr)\n\t{\n\t\tif (matr instanceof Matrix)\n\t\t\tmatr = matr.data;\n\n\t\t//for (let i = 0; i < 9; i++) temp[i] = this.data[i];\n\t\ttemp.set(this.data);\n\n\t\tthis.data[0] = matr[0]*temp[0] + matr[1]*temp[3] + matr[2]*temp[6];\n\t\tthis.data[1] = matr[0]*temp[1] + matr[1]*temp[4] + matr[2]*temp[7];\n\t\tthis.data[2] = matr[0]*temp[2] + matr[1]*temp[5] + matr[2]*temp[8];\n\t\tthis.data[3] = matr[3]*temp[0] + matr[4]*temp[3] + matr[5]*temp[6];\n\t\tthis.data[4] = matr[3]*temp[1] + matr[4]*temp[4] + matr[5]*temp[7];\n\t\tthis.data[5] = matr[3]*temp[2] + matr[4]*temp[5] + matr[5]*temp[8];\n\t\tthis.data[6] = matr[6]*temp[0] + matr[7]*temp[3] + matr[8]*temp[6];\n\t\tthis.data[7] = matr[6]*temp[1] + matr[7]*temp[4] + matr[8]*temp[7];\n\t\tthis.data[8] = matr[6]*temp[2] + matr[7]*temp[5] + matr[8]*temp[8];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCreates a translation matrix and appends it.\n\t * \t!translate (x: number, y: number) : Matrix;\n\t */\n\ttranslate: function (x, y)\n\t{\n\t\tif (x == 0 && y == 0)\n\t\t\treturn this;\n\n\t\t//for (let i = 0; i < 9; i++) temp[i] = this.data[i];\n\t\ttemp.set(this.data);\n\n\t\tthis.data[6] = x*temp[0] + y*temp[3] + temp[6];\n\t\tthis.data[7] = x*temp[1] + y*temp[4] + temp[7];\n\t\tthis.data[8] = x*temp[2] + y*temp[5] + temp[8];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCreates a rotation matrix for the given angle (in radians) and appends it.\n\t * \t!rotate (angle: number) : Matrix;\n\t */\n\trotate: function (angle)\n\t{\n\t\tif (angle == 0)\n\t\t\treturn this;\n\n\t\tthis.identity(temp2);\n\n\t\tlet cost = Math.cos(angle);\n\t\tlet sint = Math.sin(angle);\n\n\t\ttemp2[0] = cost;\n\t\ttemp2[1] = -sint;\n\t\ttemp2[3] = sint;\n\t\ttemp2[4] = cost;\n\n\t\treturn this.append(temp2);\n\t},\n\n\t/**\n\t * \tCreates a scaling matrix and appends it.\n\t * \t!scale (sx: number, sy: number) : Matrix;\n\t */\n\tscale: function (sx, sy)\n\t{\n\t\tif (sx == 1 && sy == 1)\n\t\t\treturn this;\n\n\t\tthis.identity(temp2);\n\n\t\ttemp2[0] = sx;\n\t\ttemp2[4] = sy;\n\n\t\treturn this.append(temp2);\n\t},\n\n\t/**\n\t * \tApplies the matrix to the specified vector (matrix-vector multiplication) and returns a new Vec2.\n\t * \t!applyTo (vect: Vec2) : Vec2;\n\t */\n\t/**\n\t * \tApplies the matrix to the specified coordinates (matrix-vector multiplication) and returns a new Vec2.\n\t * \t!applyTo (x: number, y: number) : Vec2;\n\t */\n\tapplyTo: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tconst v = x;\n\t\t\tx = v.x;\n\t\t\ty = v.y;\n\t\t}\n\n\t\tlet nx = this.data[0]*x + this.data[3]*y + this.data[6];\n\t\tlet ny = this.data[1]*x + this.data[4]*y + this.data[7];\n\n\t\treturn Vec2.Pool.alloc(nx, ny);\n\t},\n\n\t/**\n\t * \tTransposes the matrix.\n\t * \t!transpose() : Matrix;\n\t */\n\ttranspose: function ()\n\t{\n\t\ttemp.fill(0);\n\n\t\tfor (let j = 0; j < 3; j++)\n\t\tfor (let i = 0; i < 3; i++)\n\t\t\ttemp[j*3+i] = this.data[i*3+j];\n\n\t\t//for (let i = 0; i < 9; i++) this.data[i] = temp[i];\n\t\tthis.data.set(temp);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the determinant of the matrix.\n\t * \t!det() : number;\n\t */\n\tdet: function ()\n\t{\n\t\treturn\tthis.data[0] * (this.data[4]*this.data[8] - this.data[5]*this.data[7]) -\n\t\t\t\tthis.data[1] * (this.data[3]*this.data[8] - this.data[5]*this.data[6]) +\n\t\t\t\tthis.data[2] * (this.data[3]*this.data[7] - this.data[4]*this.data[6])\n\t\t\t\t;\n\t},\n\n\t/**\n\t * \tReturns a new matrix with the adjoint of the current matrix.\n\t * \t!adj() : Matrix;\n\t */\n\tadj: function () // violet:verify and fix\n\t{\n\t\t/*let t = this.transpose();\n\t\tlet d = Matrix.Pool.alloc();\n\n\t\td.data[0] = (t.data[4]*t.data[8] - t.data[5]*t.data[7]);\n\t\td.data[1] = -(t.data[3]*t.data[8] - t.data[5]*t.data[6]);\n\t\td.data[2] = (t.data[3]*t.data[7] - t.data[4]*t.data[6]);\n\n\t\td.data[3] = -(t.data[1]*t.data[8] - t.data[2]*t.data[7]);\n\t\td.data[4] = (t.data[0]*t.data[8] - t.data[2]*t.data[6]);\n\t\td.data[5] = -(t.data[0]*t.data[7] - t.data[1]*t.data[6]);\n\n\t\td.data[6] = (t.data[1]*t.data[5] - t.data[2]*t.data[4]);\n\t\td.data[7] = -(t.data[0]*t.data[5] - t.data[2]*t.data[3]);\n\t\td.data[8] = (t.data[0]*t.data[4] - t.data[1]*t.data[3]);\n\n\t\tt.data = d;\n\t\treturn t;*/\n\t\tthrow new Error('NOT IMPLEMENTED');\n\t},\n\n\t/**\n\t * \tReturns a new matrix with the inverse of the current matrix.\n\t * \t!inverse() : Matrix;\n\t */\n\tinverse: function ()\n\t{\n\t\tlet det = this.det();\n\t\tif (!det) return null;\n\n\t\treturn this.adj().scalef(1/det);\n\t},\n\n\t/**\n\t * \tReturns a string representation of the matrix.\n\t * \t!toString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn `[${this.data[0]}, ${this.data[3]}, ${this.data[6]}]\\n[${this.data[1]}, ${this.data[4]}, ${this.data[7]}]\\n[${this.data[2]}, ${this.data[5]}, ${this.data[8]}]\\n`;\n\t}\n});\n\n/**\n * \tSets the components of the specified array as the identity matrix.\n * \t!static loadIdentity (target: Float32Array) : void;\n */\nMatrix.loadIdentity = function (target)\n{\n\ttarget.fill(0);\n\ttarget[0] = target[4] = target[8] = 1;\n};\n\n//!/class\n\n//!namespace Matrix\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a new matrix copying the components from the specified matrix.\n\t * \t!function alloc (value: Matrix): Matrix;\n\t */\n\t/**\n\t * \tAllocates a new matrix with the values from the specified array.\n\t * \t!function alloc (value: Float32Array): Matrix;\n\t */\n\t/**\n\t * \tAllocates a new matrix with the identity matrix values.\n\t * \t!function alloc (): Matrix;\n\t */\n\nRecycler.createPool (Matrix, 4096, 1024);\nexport default Matrix;\n","\nimport { Class } from 'rinn';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"../utils/recycler\"]\n\n//:/**\n//: * \tRepresentation of a vector in 2D space, that is, a float tuple with components x and y.\n//: */\n\n//!class Vec2\n\nconst Vec2 = Class.extend\n({\n\tclassName: 'Vec2',\n\n\t/**\n\t * \tCoordinates of the vector.\n\t * \t!x: number;\n\t * \t!y: number;\n\t */\n\tx: 0, y: 0,\n\n\t/**\n\t *\tConstructs the vector from another Vec2.\n\t * \t!constructor (value: Vec2);\n\t */\n\t/**\n\t *\tConstructs the vector with the specified coordinates.\n\t * \t!constructor (x?: number, y?: number);\n\t */\n\t__ctor: function (x=null, y=null)\n\t{\n\t\treturn this.set(x, y);\n\t},\n\n\t/**\n\t * \tClones the vector coordinates into a new Vec2 object.\n\t * \t!clone() : Vec2;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Vec2.Pool.alloc(this);\n\t},\n\n\t/**\n\t *\tSets the coordinates of the vector from a Vec2 object.\n\t *\t!set (value: Vec2) : Vec2;\n\t */\n\t/**\n\t *\tSets the coordinates of the vector.\n\t *\t!set (x: number, y: number) : Vec2;\n\t */\n\tset: function (x, y=null)\n\t{\n\t\tif (x === null) {\n\t\t\tx = 0;\n\t\t\ty = 0;\n\t\t}\n\t\telse if (y === null) {\n\t\t\tlet v = x;\n\t\t\tx = v.x;\n\t\t\ty = v.y;\n\t\t}\n\n\t\tthis.x = x;\n\t\tthis.y = y;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the X-coordinate of the vector.\n\t * \t!setX (x: number) : Vec2;\n\t */\n\tsetX: function (x)\n\t{\n\t\tthis.x = x;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the Y-coordinate of the vector.\n\t * \t!setY (y: number) : Vec2;\n\t */\n\tsetY: function (y)\n\t{\n\t\tthis.y = y;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the coordinates of the vector to zero.\n\t * \t!zero() : Vec2;\n\t */\n\tzero: function()\n\t{\n\t\treturn this.set(0, 0);\n\t},\n\n\t/**\n\t * \tReturns true if the vector coordinates are both zero.\n\t * \t!isZero() : boolean;\n\t */\n\tisZero: function()\n\t{\n\t\treturn this.x == 0 && this.y == 0;\n\t},\n\n\t/**\n\t *\tReturns true if the coordinates of the vector have the same values as the given Vec2.\n\t *\t!equals (value: Vec2) : boolean;\n\t */\n\t/**\n\t *\tReturns true if the coordinates of the vector have the same values as the given ones.\n\t *\t!equals (x: number, y: number) : boolean;\n\t */\n\tequals: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tlet v = x;\n\t\t\tx = v.x;\n\t\t\ty = v.y;\n\t\t}\n\n\t\treturn this.x == x && this.y == y;\n\t},\n\n\t/**\n\t * \tNegates the vector, that is changing the sign of each component in the vector.\n\t * \t!neg() : Vec2;\n\t */\n\tneg: function ()\n\t{\n\t\tthis.x = -this.x; this.y = -this.y;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tInverts the vector by changing each component to its reciprocal.\n\t * \t!inv() : Vec2;\n\t */\n\tinv: function ()\n\t{\n\t\tthis.x = 1 / this.x; this.y = 1 / this.y;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tChanges the components of the vector to their absolute value.\n\t * \t!abs() : Vec2;\n\t */\n\tabs: function ()\n\t{\n\t\tthis.x = this.x < 0 ? -this.x : this.x;\n\t\tthis.y = this.y < 0 ? -this.y : this.y;\n\t\treturn this;\n\t},\n\n\t/**\n\t *\tAdds the coordinates of the given Vec2 to the vector.\n\t *\t!translate (value: Vec2) : Vec2;\n\t */\n\t/**\n\t *\tAdds the given delta values to the vector.\n\t *\t!translate (dx: number, dy: number) : Vec2;\n\t */\n\ttranslate: function (dx, dy=null)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tlet v = dx;\n\t\t\tdx = v.x;\n\t\t\tdy = v.y;\n\t\t}\n\n\t\tthis.x += dx, this.y += dy;\n\t\treturn this;\n\t},\n\n\t/**\n\t *\tRotates the vector by the specified angle.\n\t *\t!rotate (angle: number) : Vec2;\n\t */\n\t/**\n\t *\tRotates the vector by the specified angle using the given origin point.\n\t *\t!rotate (angle: number, cx: number, cy: number) : Vec2;\n\t */\n\trotate: function (angle, cx=0, cy=0)\n\t{\n\t\tlet x = (this.x - cx)*Math.cos(angle) + (this.y - cy)*Math.sin(angle);\n\t\tlet y = (this.y - cy)*Math.cos(angle) - (this.x - cx)*Math.sin(angle);\n\n\t\tthis.x = x + cx;\n\t\tthis.y = y + cy;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t *\tAdds the coordinates of the given Vec2 to the vector.\n\t *\t!add (value: Vec2) : Vec2;\n\t */\n\t/**\n\t *\tAdds the given delta values to the vector.\n\t *\t!add (dx: number, dy: number) : Vec2;\n\t */\n\tadd: function (dx, dy=null)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tlet v = dx;\n\t\t\tdx = v.x;\n\t\t\tdy = v.y;\n\t\t}\n\n\t\tthis.x += dx, this.y += dy;\n\t\treturn this;\n\t},\n\n\t/**\n\t *\tSubtracts the coordinates of the given Vec2 from the vector.\n\t *\t!sub (value: Vec2) : Vec2;\n\t */\n\t/**\n\t *\tSubtracts the given delta values from the vector.\n\t *\t!sub (dx: number, dy: number) : Vec2;\n\t */\n\tsub: function (dx, dy=null)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tlet v = dx;\n\t\t\tdx = v.x;\n\t\t\tdy = v.y;\n\t\t}\n\n\t\tthis.x -= dx, this.y -= dy;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tScales each components of the vector by the respective component of the given one.\n\t * \t!scale (k: number) : Vec2;\n\t */\n\t/**\n\t * \tScales both components of the vector by the given factor.\n\t * \t!scale (k: number) : Vec2;\n\t */\n\t/**\n\t * \tScales each components of the vector by the given factors.\n\t * \t!scale (fx: number, fy: number) : Vec2;\n\t */\n\tscale: function (fx, fy=null)\n\t{\n\t\tif (fy === null)\n\t\t{\n\t\t\tif (Vec2.isInstance(fx)) {\n\t\t\t\tlet v = fx;\n\t\t\t\tfx = v.x;\n\t\t\t\tfy = v.y;\n\t\t\t} else {\n\t\t\t\tfy = fx;\n\t\t\t}\n\t\t}\n\n\t\tthis.x *= fx, this.y *= fy;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the components to their integer parts.\n\t * \t!floor() : Vec2;\n\t */\n\tfloor: function ()\n\t{\n\t\tthis.x = int(this.x);\n\t\tthis.y = int(this.y);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the components to their fractional parts.\n\t * \t!fract() : Vec2;\n\t */\n\tfract: function ()\n\t{\n\t\tthis.x = this.x - int(this.x);\n\t\tthis.y = this.y - int(this.y);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the dot product of the vectors.\n\t * \t!dot (value: Vec2) : number;\n\t */\n\t/**\n\t * \tReturns the dot product of the vector and the given values.\n\t * \t!dot (x: number, y: number) : number;\n\t */\n\tdot: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tlet v = x;\n\t\t\tx = v.x;\n\t\t\ty = v.y;\n\t\t}\n\n\t\treturn this.x*x + this.y*y;\n\t},\n\n\t/**\n\t * \tReturns the magnitude of the vector.\n\t * \t!magnitude(squared: boolean) : number;\n\t */\n\tmagnitude: function (squared=false)\n\t{\n\t\treturn squared ? (this.x*this.x + this.y*this.y) : Math.sqrt(this.x*this.x + this.y*this.y);\n\t},\n\n\t/**\n\t * \tNormalizes the vector by dividing each component by the vector magnitude to obtain a unit vector.\n\t * \t!normalize() : Vec2;\n\t */\n\tnormalize: function ()\n\t{\n\t\treturn this.isZero() ? this : this.scale (1 / this.magnitude());\n\t},\n\n\t/**\n\t * \tSets the vector to its major-axis, that is the component with the maximum absolute value.\n\t * \t!majorAxis() : Vec2;\n\t */\n\tmajorAxis: function ()\n\t{\n\t\tif (Math.abs(this.x) > Math.abs(this.y)) this.y = 0; else this.x = 0;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the vector to its minor-axis, that is the component with the minimum absolute value.\n\t * \t!minorAxis() : Vec2;\n\t */\n\tminorAxis: function ()\n\t{\n\t\tif (Math.abs(this.x) < Math.abs(this.y)) this.y = 0; else this.x = 0;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the vector to its sign-vector representation.\n\t * \t!sign() : Vec2;\n\t */\n\tsign: function ()\n\t{\n\t\tthis.x = !this.x ? 0 : (this.x < 0 ? -1 : 1);\n\t\tthis.y = !this.y ? 0 : (this.y < 0 ? -1 : 1);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the string representation of the coordinates of the vector.\n\t * \ttoString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn `(${this.x}, ${this.y})`;\n\t}\n});\n\n//!/class\n\n//!namespace Vec2\n//!namespace Pool\n\n/**\n *\tAllocates a vector from another Vec2.\n * \t!function alloc (value: Vec2) : Vec2;\n */\n/**\n *\tAllocates a vector with the specified coordinates.\n * \t!function alloc (x?: number, y?: number) : Vec2;\n */\n\nRecycler.createPool (Vec2, 4096, 2048);\nexport default Vec2;\n","\nimport { Class } from 'rinn';\nimport Shader from './shader.js';\nimport glx from './glx.js';\n\n//![import \"./shader\"]\n//![import \"./globals\"]\n//![import \"./glx\"]\n\n//:/**\n//: * Describes a shader program.\n//: */\n\n//!class ShaderProgram\n\nconst ShaderProgram = Class.extend\n({\n\t/**\n\t * Cache of locations.\n\t */\n\tlocations: null,\n\n\t/**\n\t * Identifier of the program.\n\t * !readonly id: string;\n\t */\n\tid: null,\n\n\t/**\n\t * Shaders attached to the program.\n\t * !readonly shaders: Array<Shader>;\n\t */\n\tshaders: null,\n\n\t/**\n\t * Shader program GL identifier.\n\t * !readonly programId: number;\n\t */\n\tprogramId: null,\n\n\t/**\n\t * Constructs an empty shader program with the specified identifier. Attach shaders by using the `attach` method.\n\t * !constructor (id?: string);\n\t */\n\t__ctor: function (id=null)\n\t{\n\t\tthis.id = id;\n\n\t\tthis.shaders = [];\n\t\tthis.programId = null;\n\n\t\tthis.locations = { };\n\n\t\tthis._uniformSetter = null;\n\n\t\tShaderProgram.put(id, this);\n\t},\n\n\t/**\n\t * Destroys the shader program.\n\t */\n\t__dtor: function ()\n\t{\n\t\tlet gl = glx.gl;\n\t\tif (!gl) return this;\n\n\t\tgl.deleteProgram(this.programId);\n\t\tShaderProgram.remove(this.id);\n\t},\n\n\t/**\n\t * Sets the uniform setter function.\n\t * @param { (pgm:ShaderProgram) => void } uniformSetter\n\t * @returns {Element}\n\t * !uniformSetter (uniformSetter: (pgm:ShaderProgram) => void) : ShaderProgram;\n\t */\n\tuniformSetter: function (uniformSetter)\n\t{\n\t\tthis._uniformSetter = uniformSetter;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Attaches a shader to the shader program.\n\t * !attach (shader: Shader|string) : ShaderProgram;\n\t */\n\tattach: function (shader)\n\t{\n\t\tif (typeof(shader) === 'string')\n\t\t\tshader = Shader.get(shader);\n\n\t\tif (!shader)\n\t\t\tthrow new Error ('Unable to attach shader, argument is null.');\n\n\t\tthis.shaders.push(shader);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Binds the attribute locations to their predefined values.\n\t */\n\tbindLocations: function ()\n\t{\n\t\tglx.gl.bindAttribLocation (this.programId, 0, 'location');\n\t},\n\n\t/**\n\t * Returns the location of an attribute.\n\t * !getAttribLocation (name: string) : object;\n\t */\n\tgetAttribLocation: function (name)\n\t{\n\t\tif (!this.locations.hasOwnProperty(name))\n\t\t\tthis.locations[name] = glx.gl.getAttribLocation (this.programId, name);\n\n\t\treturn this.locations[name];\n\t},\n\n\t/**\n\t * Returns the location of a uniform variable.\n\t * !getUniformLocation (name: string) : object;\n\t */\n\tgetUniformLocation: function (name)\n\t{\n\t\tif (!this.locations.hasOwnProperty(name))\n\t\t\tthis.locations[name] = glx.gl.getUniformLocation (this.programId, name);\n\n\t\treturn this.locations[name];\n\t},\n\n\t/**\n\t * Returns the location of a uniform block.\n\t * !getUniformBlockLocation (name: string) : object;\n\t */\n\tgetUniformBlockLocation: function (name)\n\t{\n\t\tif (!this.locations.hasOwnProperty(name))\n\t\t\tthis.locations[name] = glx.gl.getUniformBlockIndex (this.programId, name);\n\n\t\treturn this.locations[name];\n\t},\n\n\t/**\n\t * Returns the size of a uniform block.\n\t * !getUniformBlockSize (uniformBlock: string|object) : number;\n\t */\n\tgetUniformBlockSize: function (uniformBlock)\n\t{\n\t\tif (typeof(uniformBlock) === 'string')\n\t\t\tuniformBlock = this.getUniformBlockLocation(uniformBlock);\n\n\t\treturn glx.gl.getActiveUniformBlockParameter(this.programId, uniformBlock, glx.gl.UNIFORM_BLOCK_DATA_SIZE);\n\t},\n\t\n\t/**\n\t * Creates a buffer for a uniform block.\n\t * !createUniformBlockBuffer (uniformBlock: string|object) : Float32Array;\n\t */\n\tcreateUniformBlockBuffer: function (uniformBlock)\n\t{\n\t\tif (typeof(uniformBlock) === 'string')\n\t\t\tuniformBlock = this.getUniformBlockLocation(uniformBlock);\n\n\t\tlet size = this.getUniformBlockSize(uniformBlock);\n\t\tlet buff = glx.createBufferFrom (new Float32Array(size).fill(0), glx.BufferTarget.UNIFORM_BUFFER, glx.BufferUsage.DYNAMIC_DRAW);\n\n\t\tglx.gl.bindBufferBase (glx.BufferTarget.UNIFORM_BUFFER, 0, buff);\n\t},\n\n\t/**\n\t * Loads the locations of the predefined uniforms and attributes.\n\t */\n\tpreloadLocations: function ()\n\t{\n\t\tthis.getUniformLocation('f_time');\n\t\tthis.getUniformLocation('f_scale');\n\n\t\tthis.getUniformLocation('m_transform');\n\t\tthis.getUniformLocation('m_texture');\n\t\tthis.getUniformLocation('m_quad');\n\n\t\tthis.getUniformLocation('v_resolution');\n\t\tthis.getUniformLocation('v_frame_size');\n\n\t\tthis.getUniformLocation('f_depth');\n\t\tthis.getUniformLocation('f_alpha');\n\t\tthis.getUniformLocation('v_base_color');\n\n\t\tthis.getUniformLocation('texture0');\n\n\t\tthis.getAttribLocation('location');\n\t},\n\n\t/**\n\t * Links the shaders into the shader program. Completion can be obtained by calling `getStatus`.\n\t * !link() : ShaderProgram;\n\t */\n\tlink: function ()\n\t{\n\t\tlet gl = glx.gl;\n\t\tif (!gl) return this;\n\n\t\tthis.programId = gl.createProgram();\n\n\t\tfor (let shader of this.shaders)\n\t\t\tgl.attachShader (this.programId, shader.shaderId);\n\n\t\tthis.bindLocations();\n\t\tgl.linkProgram (this.programId);\n\t\tthis.preloadLocations();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Activates the shader program to be used in the subsequent drawing operations.\n\t * !activate() : void;\n\t */\n\tactivate: function ()\n\t{\n\t\tlet gl = glx.gl;\n\t\tif (!gl) return;\n\n\t\tgl.useProgram (this.programId);\n\n\t\tif (this._uniformSetter !== null)\n\t\t\tthis._uniformSetter (this, gl);\n\t},\n\n\t/**\n\t * Returns the link status of the program.\n\t * !getStatus() : boolean;\n\t */\n\tgetStatus: function ()\n\t{\n\t\tlet gl = glx.gl;\n\t\tif (!gl) return true;\n\n\t\treturn gl.getProgramParameter(this.programId, gl.LINK_STATUS);\n\t},\n\n\t/**\n\t * Returns the error of the last link operation.\n\t * !getError() : string;\n\t */\n\tgetError: function ()\n\t{\n\t\tlet gl = glx.gl;\n\t\tif (!gl) return '';\n\n\t\tif (this.programId === null)\n\t\t\treturn 'Program has not been linked.';\n\n\t\treturn gl.getProgramInfoLog(this.programId);\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform1f (location: string|object, v0: number) : ShaderProgram;\n\t */\n\tuniform1f: function (location, v0)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform1f (location, v0);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform1fv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform1fv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform1fv (location, value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform1i (location: string|object, v0: number) : ShaderProgram;\n\t */\n\tuniform1i: function (location, v0)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform1i (location, v0);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform1iv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform1iv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform1iv (location, value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform2f (location: string|object, v0: number, v1: number) : ShaderProgram;\n\t */\n\tuniform2f: function (location, v0, v1)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform2f (location, v0, v1);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform2fv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform2fv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform2fv (location, value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform2i (location: string|object, v0: number, v1: number) : ShaderProgram;\n\t */\n\tuniform2i: function (location, v0, v1)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform2i (location, v0, v1);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform2iv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform2iv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform2iv (location, value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform3f (location: string|object, v0: number, v1: number, v2: number) : ShaderProgram;\n\t */\n\tuniform3f: function (location, v0, v1, v2)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform3f (location, v0, v1, v2);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform3fv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform3fv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform3fv (location, value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform3i (location: string|object, v0: number, v1: number, v2: number) : ShaderProgram;\n\t */\n\tuniform3i: function (location, v0, v1, v2)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform3i (location, v0, v1, v2);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform3iv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform3iv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform3iv (location, value);\n\t\treturn this;\n\t},\n\t\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform4f (location: string|object, v0: number, v1: number, v2: number, v3: number) : ShaderProgram;\n\t */\n\tuniform4f: function (location, v0, v1, v2, v3)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform4f (location, v0, v1, v2, v3);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform4fv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform4fv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform4fv (location, value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform4i (location: string|object, v0: number, v1: number, v2: number, v3: number) : ShaderProgram;\n\t */\n\tuniform4i: function (location, v0, v1, v2, v3)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform4i (location, v0, v1, v2, v3);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a uniform.\n\t * !uniform4iv (location: string|object, value: any) : ShaderProgram;\n\t */\n\tuniform4iv: function (location, value)\n\t{\n\t\tif (typeof(location) === 'string')\n\t\t\tlocation = this.getUniformLocation(location);\n\n\t\tglx.gl.uniform4iv (location, value);\n\t\treturn this;\n\t},\n\n});\n\n/**\n * Global shader program list.\n */\nShaderProgram.programs = { };\n\n/**\n * Creates a new shader program. The specified source code allows the use of \"//@vert\", \"//@frag\" and \"//@geom\" directives to specify the code\n * blocks of the vertex, fragment and geometry shader respectively.\n * !static create (id: string, source: string) : ShaderProgram;\n */\nShaderProgram.create = function (id, source)\n{\n\tlet vs = null, vsName = null;\n\tlet fs = null, fsName = null;\n\tlet gs = null, gsName = null;\n\n\tlet active = null;\n\n\tfor (let i of source.split('\\n'))\n\t{\n\t\tlet v = i.trim();\n\n\t\tif (v.startsWith('//'))\n\t\t{\n\t\t\tv = v.split(' ').map(i => i.trim());\n\n\t\t\tif (v[0] === '//@vert') {\n\t\t\t\tif (v.length > 1) vsName = v[1];\n\t\t\t\tif (vs === null) vs = [];\n\t\t\t\tactive = vs;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (v[0] === '//@frag') {\n\t\t\t\tif (v.length > 1) fsName = v[1];\n\t\t\t\tif (fs === null) fs = [];\n\t\t\t\tactive = fs;\n\t\t\t\tcontinue;\n\n\t\t\t}\n\n\t\t\tif (v[0] === '//@geom') {\n\t\t\t\tif (v.length > 1) gsName = v[1];\n\t\t\t\tif (gs === null) gs = [];\n\t\t\t\tactive = gs;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\t\tif (active !== null)\n\t\t\tactive.push(i);\n\t}\n\n\tlet pgm = new ShaderProgram(id);\n\n\t// Convert to string.\n\tif (vs !== null) vs = vs.join('\\n').trim();\n\tif (fs !== null) fs = fs.join('\\n').trim();\n\tif (gs !== null) gs = gs.join('\\n').trim();\n\n\t// Load shaders from name if name specified without any source code.\n\tif (vs !== null && vs.length === 0)\n\t{\n\t\tvs = Shader.get(vsName);\n\t\tif (vs === null) throw new Error('Vertex shader not found: ' + vsName);\n\t}\n\telse if (vs === null || vs.length === 0)\n\t\tvs = null;\n\n\tif (fs !== null && fs.length === 0)\n\t{\n\t\tfs = Shader.get(fsName);\n\t\tif (fs === null) throw new Error('Fragment shader not found: ' + fsName);\n\t}\n\telse if (fs === null || fs.length === 0)\n\t\tfs = null;\n\n\tif (gs !== null && gs.length === 0)\n\t{\n\t\tgs = Shader.get(gsName);\n\t\tif (gs === null) throw new Error('Geometry shader not found: ' + gsName);\n\t}\n\telse if (gs === null || gs.length === 0)\n\t\tgs = null;\n\n\t// Load default if none specified.\n\tif (vs === null) vs = Shader.get('def-vert');\n\tif (fs === null) fs = Shader.get('def-frag');\n\n\t// Compile source if GLSL source specified.\n\tif (vs !== null && typeof(vs) === 'string')\n\t\tvs = new Shader (vsName, Shader.Type.VERTEX, vs);\n\n\tif (fs !== null && typeof(fs) === 'string')\n\t\tfs = new Shader (fsName, Shader.Type.FRAGMENT, fs);\n\n\tif (gs !== null && typeof(gs) === 'string')\n\t\tgs = new Shader (gsName, Shader.Type.GEOMETRY, gs);\n\n\t// Attach programs and link.\n\tif (vs !== null) pgm.attach(vs);\n\tif (fs !== null) pgm.attach(fs);\n\tif (gs !== null) pgm.attach(gs);\n\n\treturn pgm.link();\n};\n\n/**\n * Puts a shader program in the global program list under the specified identifier.\n * !static put (id: string, shaderProgram: ShaderProgram) : void;\n */\nShaderProgram.put = function (id, shaderProgram)\n{\n\tif (id) this.programs[id] = shaderProgram;\n};\n\n/**\n * Returns a shader program from the global program list given its identifier.\n * !static get (id: string) : ShaderProgram;\n */\nShaderProgram.get = function (id)\n{\n\treturn this.programs[id];\n};\n\n/**\n * Removes a shader program from the global program list.\n * !static remove (id: string) : void;\n */\nShaderProgram.remove = function (id)\n{\n\tdelete this.programs[id];\n};\n\nexport default ShaderProgram;\n","\nimport { Class } from 'rinn';\nimport glx from './glx.js';\nimport glsl from './glsl.js';\n\n//![import \"./glx\"]\n//![import \"./glsl\"]\n\n//:/**\n//: * Describes a shader object. The actual shader type is specified at construction.\n//: */\n\n//!class Shader\n\nconst Shader = Class.extend\n({\n\t/**\n\t * Identifier of the shader.\n\t * !readonly id: string;\n\t */\n\tid: null,\n\n\t/**\n\t * Type of the shader.\n\t * !readonly type: Shader.Type;\n\t */\n\ttype: 0,\n\n\t/**\n\t * Shader GL identifier.\n\t * !readonly shaderId: number;\n\t */\n\tshaderId: null,\n\n\t/**\n\t * Constructs a shader and registers with the specified id. Compile its GLSL code using the `compile` method.\n\t * !constructor (id: string, type: Shader.Type);\n\t */\n\t/**\n\t * Constructs a shader, compile its GLSL code using the `compile` method.\n\t * !constructor (type: Shader.Type);\n\t */\n\t/**\n\t * Constructs a shader with the specified GLSL code and registers with the specified id.\n\t * !constructor (id: string, type: Shader.Type, source: string);\n\t */\n\t/**\n\t * Constructs a shader with the specified GLSL code.\n\t * !constructor (type: Shader.Type, source: string);\n\t */\n\t__ctor: function (id, type=null, source=null)\n\t{\n\t\tif (source === null && type !== null && typeof(type) === 'string')\n\t\t{\n\t\t\tsource = type;\n\t\t\ttype = null;\n\t\t}\n\n\t\tif (type === null)\n\t\t{\n\t\t\ttype = id;\n\t\t\tid = null;\n\t\t}\n\n\t\tShader.put(this.id = id, this);\n\t\tthis.type = type;\n\n\t\tthis.shaderId = null;\n\n\t\tif (source !== null)\n\t\t\tthis.compile(source);\n\t},\n\n\t/**\n\t * \tDestroys the shader.\n\t */\n\t__dtor: function ()\n\t{\n\t\tglx.gl.deleteShader(this.shaderId);\n\t\tShader.remove(this.id);\n\t},\n\n\t/**\n\t * Compiles the shader and throws an exception if any compilations error occur.\n\t * !compile (source: string) : Shader;\n\t */\n\tcompile: function (source)\n\t{\n\t\tlet gl = glx.gl;\n\t\tthis.shaderId = gl.createShader (this.type === Shader.Type.VERTEX ? gl.VERTEX_SHADER : (this.type === Shader.Type.FRAGMENT ? gl.FRAGMENT_SHADER : gl.GEOMETRY_SHADER));\n\n\t\tsource = glsl.process(source);\n\n\t\tgl.shaderSource(this.shaderId, source);\n\t\tgl.compileShader(this.shaderId);\n\n\t\tlet error = gl.getShaderInfoLog(this.shaderId);\n\t\tif (error) {\n\t\t\tconsole.error(source.split(\"\\n\").map((i,index) => (index) + \": \" + i).join(\"\\n\"));\n\t\t\tthrow new Error ((this.id ? '[' + this.id + '] ' : '') + error);\n\t\t}\n\n\t\treturn this;\n\t}\n});\n\n//!/class\n\n/**\n * \tGlobal shader list.\n */\nShader.shaders = { };\n\n/**\n * \tStores a shader with the specified identifier in the global shader list.\n * \t!static put (id: string, shader: Shader) : void;\n */\nShader.put = function (id, shader)\n{\n\tif (id) this.shaders[id] = shader;\n};\n\n/**\n * \tReturns a Shader from the global shader list given its identifier.\n * \t!static get (id: string) : Shader;\n */\nShader.get = function (id)\n{\n\treturn this.shaders[id];\n};\n\n/**\n * \tRemoves a shader from the global shader list.\n * \t!static remove (id: string) : void;\n */\nShader.remove = function (id)\n{\n\tdelete this.shaders[id];\n};\n\n//!namespace Shader\n\n//:/**\n//: * \tShader types.\n//: */\n\n//!enum Type\n\nShader.Type = {\n\tVERTEX: 0,\n\t//!VERTEX\n\tFRAGMENT: 1,\n\t//!FRAGMENT\n\tGEOMETRY: 2,\n\t//!GEOMETRY\n};\n\n//!/enum\n\nexport default Shader;\n","//!namespace glx\n\n\t//!enum BufferTarget\n\t\t//:ARRAY_BUFFER\n\t\t//:ELEMENT_ARRAY_BUFFER\n\t\t//:COPY_READ_BUFFER\n\t\t//:COPY_WRITE_BUFFER\n\t\t//:TRANSFORM_FEEDBACK_BUFFER\n\t\t//:UNIFORM_BUFFER\n\t\t//:PIXEL_PACK_BUFFER\n\t\t//:PIXEL_UNPACK_BUFFER\n\t//!/enum\n\n\t//!enum BufferUsage\n\t\t//!STATIC_DRAW\n\t\t//!DYNAMIC_DRAW\n\t\t//!STREAM_DRAW\n\t\t//!STATIC_READ\n\t\t//!DYNAMIC_READ\n\t\t//!STREAM_READ\n\t\t//!STATIC_COPY\n\t\t//!DYNAMIC_COPY\n\t\t//!STREAM_COPY\n\t//!/enum\n\n//!/namespace\n\n//!class glx\n\nconst glx =\n{\n\tBufferTarget: { },\n\tBufferUsage: { },\n\n\t/**\n\t * WebGL rendering context.\n\t * !static readonly gl: WebGL2RenderingContext;\n\t */\n\tgl: null,\n\n\t/**\n\t * Sets the WebGL rendering context.\n\t * !static setContext (context: WebGL2RenderingContext) : glx;\n\t */\n\tsetContext: function (context)\n\t{\n\t\tthis.gl = context;\n\n\t\tthis.BufferTarget.ARRAY_BUFFER = this.gl.ARRAY_BUFFER;\n\t\tthis.BufferTarget.ELEMENT_ARRAY_BUFFER = this.gl.ELEMENT_ARRAY_BUFFER;\n\t\tthis.BufferTarget.COPY_READ_BUFFER = this.gl.COPY_READ_BUFFER;\n\t\tthis.BufferTarget.COPY_WRITE_BUFFER = this.gl.COPY_WRITE_BUFFER;\n\t\tthis.BufferTarget.TRANSFORM_FEEDBACK_BUFFER = this.gl.TRANSFORM_FEEDBACK_BUFFER;\n\t\tthis.BufferTarget.UNIFORM_BUFFER = this.gl.UNIFORM_BUFFER;\n\t\tthis.BufferTarget.PIXEL_PACK_BUFFER = this.gl.PIXEL_PACK_BUFFER;\n\t\tthis.BufferTarget.PIXEL_UNPACK_BUFFER = this.gl.PIXEL_UNPACK_BUFFER;\n\n\t\tthis.BufferUsage.STATIC_DRAW = this.gl.STATIC_DRAW;\n\t\tthis.BufferUsage.DYNAMIC_DRAW = this.gl.DYNAMIC_DRAW;\n\t\tthis.BufferUsage.STREAM_DRAW = this.gl.STREAM_DRAW;\n\t\tthis.BufferUsage.STATIC_READ = this.gl.STATIC_READ;\n\t\tthis.BufferUsage.DYNAMIC_READ = this.gl.DYNAMIC_READ;\n\t\tthis.BufferUsage.STREAM_READ = this.gl.STREAM_READ;\n\t\tthis.BufferUsage.STATIC_COPY = this.gl.STATIC_COPY;\n\t\tthis.BufferUsage.DYNAMIC_COPY = this.gl.DYNAMIC_COPY;\n\t\tthis.BufferUsage.STREAM_COPY = this.gl.STREAM_COPY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the value of a GL parameter.\n\t * !static getParameter (name: string) : any;\n\t */\n\tgetParameter: function (name)\n\t{\n\t\treturn this.gl.getParameter(this.gl[name]);\n\t},\n\n\t/**\n\t * Returns a slice of an array as a Float32Array.\n\t * !static getFloat32Array (data: any, offset: number, length: number) : Float32Array;\n\t */\n\tgetFloat32Array: function (data, offset, length)\n\t{\n\t\tif (offset === 0 && length === data.length)\n\t\t{\n\t\t\tif (data instanceof Float32Array)\n\t\t\t\treturn data;\n\t\t}\n\n\t\tlet buff = new Float32Array(length);\n\n\t\tfor (let i = 0; i < length; i++)\n\t\t\tbuff[i] = data[i+offset];\n\n\t\treturn buff;\n\t},\n\n\t/**\n\t * Creates a buffer from the specified array.\n\t * @param {BufferTarget} target Defaults to ARRAY_BUFFER.\n\t * @param {BufferUsage} usage Defaults to STATIC_DRAW.\n\t * !static createBufferFrom (data: any, target?: glx.BufferTarget, usage?: glx.BufferUsage, offset?: number, length?: number) : WebGLBuffer;\n\t */\n\tcreateBufferFrom: function (data, target=null, usage=null, offset=null, length=null)\n\t{\n\t\ttarget = target ?? glx.BufferTarget.ARRAY_BUFFER;\n\t\tusage = usage ?? glx.BufferUsage.STATIC_DRAW;\n\n\t\tlet buff = this.gl.createBuffer();\n\t\tthis.gl.bindBuffer (target, buff);\n\t\tthis.gl.bufferData (target, this.getFloat32Array(data, offset ?? 0, length ?? data.length), usage);\n\n\t\t//this.gl.bindBuffer (target, null);\n\t\treturn buff;\n\t}\n};\n\n//!/class\n\nexport default glx;\n","\n//:/**\n//: * Provides pre-processing to reuse GLSL code.\n//: */\n\n//!class glsl\n\nconst glsl =\n{\n\t/**\n\t * Library of GLSL code snippets.\n\t */\n\tsnippets: { },\n\n\t/**\n\t * Registers a snippet in the GLSL code library.\n\t * !static set (name: string, source: string) : void;\n\t */\n\tset: function (name, source)\n\t{\n\t\tthis.snippets[name] = source;\n\t},\n\n\t/**\n\t * Returns a snippet of code given its name.\n\t * !static get (name: string) : string;\n\t */\n\tget: function (name)\n\t{\n\t\treturn this.snippets.hasOwnProperty(name) ? this.snippets[name] : '';\n\t},\n\n\t/**\n\t * Replaces special marks in the code.\n\t */\n\treplace: function (code, alreadyImported)\n\t{\n\t\tcode = code.split('\\n');\n\n\t\tfor (let i = 0; i < code.length; i++)\n\t\t{\n\t\t\tlet value = code[i].trim();\n\n\t\t\tif (value.startsWith('//@use '))\n\t\t\t{\n\t\t\t\tlet str = '';\n\n\t\t\t\tfor (let name of value.substring(7).split(','))\n\t\t\t\t{\n\t\t\t\t\tname = name.trim();\n\n\t\t\t\t\tif (alreadyImported.hasOwnProperty(name))\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\talreadyImported[name] = true;\n\n\t\t\t\t\tstr += glsl.replace(glsl.get(name), alreadyImported) + '\\n';\n\t\t\t\t}\n\n\t\t\t\tcode[i] = str;\n\t\t\t}\n\t\t}\n\n\t\treturn code.join('\\n');\n\t},\n\n\t/**\n\t * Processes GLSL code, returns a string of GLSL code ready to be compiled.\n\t *\n\t * - If \"#version\" not specified \"#version 300 es\" will be added.\n\t * - If \"precision\" not specified \"precision highp float;\" will be added.\n\t * - Directive \"//@use\" will be replaced with the appropriate snippet(s).\n\t *\n\t * !static process (code: string) : string;\n\t */\n\tprocess: function (code)\n\t{\n\t\tcode = code.trim();\n\n\t\tif (code.indexOf('precision') === -1)\n\t\t\tcode = 'precision highp float;\\n' + code;\n\n\t\tif (code.indexOf('#version') === -1)\n\t\t\tcode = '#version 300 es\\n' + code;\n\n\t\treturn this.replace(code, { });\n\t}\n};\n\n//!/class\n\nexport default glsl;\n\n/**\n * Reusable GLSL snippets.\n */\n\nglsl.set('vert-defs', `\n\tuniform mat3 m_transform;\n\tuniform mat3 m_quad;\n\tuniform mat3 m_texture;\n\tuniform vec4 v_resolution;\n\tuniform vec4 v_frame_size;\n\tuniform float f_scale;\n\tuniform float f_time;\n\tuniform float f_depth;\n\n\tin vec3 location;\n\tout vec2 texcoords;\n`);\n\nglsl.set('frag-defs', `\n\tuniform vec4 v_resolution;\n\tuniform vec4 v_frame_size;\n\tuniform float f_scale;\n\tuniform float f_time;\n\tuniform float f_alpha;\n\tuniform sampler2D texture0;\n\n\tin vec2 texcoords;\n\tout vec4 color;\n`);\n\nglsl.set('invertX', `\n\tvec2 invertX (vec2 value) {\n\t\treturn value * vec2(-1.0, 1.0);\n\t}\n`);\n\nglsl.set('invertY', `\n\tvec2 invertY (vec2 value) {\n\t\treturn value * vec2(1.0, -1.0);\n\t}\n`);\n\n// Returns the normalized (0 to 1) value for the given signed-normalized (-1 to 1) value.\nglsl.set('norm', `\n\tfloat norm (float value) {\n\t\treturn (value + 1.0) * 0.5;\n\t}\n\n\tvec2 norm (vec2 value) {\n\t\treturn (value + 1.0) * 0.5;\n\t}\n\n\tvec3 norm (vec3 value) {\n\t\treturn (value + 1.0) * 0.5;\n\t}\n`);\n\n// Returns the signed-normalized (-1 to 1) value for the given normalized (0 to 1) value.\nglsl.set('snorm', `\n\tfloat snorm (float value) {\n\t\treturn value * 2.0 - 1.0;\n\t}\n\n\tvec2 snorm (vec2 value) {\n\t\treturn value * 2.0 - 1.0;\n\t}\n\n\tvec3 snorm (vec3 value) {\n\t\treturn value * 2.0 - 1.0;\n\t}\n`);\n\nglsl.set('location2d', `\n\t//@use invertY, snorm\n\n\tvec4 location2d (vec3 location, float depth)\n\t{\n\t\tvec2 loc = vec2(m_transform * m_quad * location) / v_resolution.xy;\n\t\treturn vec4(invertY(snorm(loc)), depth/16777216.0, 1.0);\n\t}\n`);\n\nglsl.set('frameTexCoords', `\n\tflat out vec2 v_frame_offset;\n\n\tvec2 frameTexCoords (vec3 location) {\n\t\tv_frame_offset = vec2(m_texture[2][0], m_texture[2][1]);\n\t\treturn mat2(m_texture * m_quad) * location.xy / (v_frame_size.xy * v_frame_size.zw);\n\t}\n`);\n\nglsl.set('frameTex', `\n\tflat in vec2 v_frame_offset;\n\n\tvec4 frameTex (vec2 texcoords) {\n\t\treturn texture(texture0, fract(texcoords)*v_frame_size.xy + v_frame_offset);\n\t}\n`);\n\nglsl.set('rand', `\n\tfloat rand (vec2 value) {\n\t\treturn fract(sin(dot(value, vec2(12.9898, 78.233))) * 43758.5453);\n\t}\n`);\n\nglsl.set('align', `\n\tfloat align (float value, float step) {\n\t\treturn floor(value/step)*step;\n\t}\n`);\n\nglsl.set('sqwave', `\n\tfloat sqwave (float time, float period, float dcycle) {\n\t\treturn step(mod(time, period) - dcycle*period, 0.0);\n\t}\n`);\n\nglsl.set('mask', `\n\tfloat mask (float alpha) {\n\t\treturn 1.0 - step(alpha, 0.0);\n\t}\n\n\tfloat mask (vec4 color) {\n\t\treturn 1.0 - step(color.a, 0.0);\n\t}\n`);\n\nglsl.set('luminance', `\n\tfloat luminance (vec3 color) {\n\t\treturn dot(color, vec3(0.2126, 0.7152, 0.0722));\n\t}\n\n\tfloat luminance (vec4 color) {\n\t\treturn dot(color.rgb, vec3(0.2126, 0.7152, 0.0722));\n\t}\n`);\n","\nimport { Class } from 'rinn';\nimport Canvas from './canvas';\nimport glx from './glx';\n\n//!namespace Texture\n\n\t//:type FilterType = 'NEAREST' | 'LINEAR';\n\t//:type WrapMode = 'REPEAT' | 'CLAMP_TO_EDGE' | 'MIRRORED_REPEAT';\n\n//!/namespace\n\n//:/**\n//: * Definition of a texture.\n//: */\n\n//!class Texture\n\nexport default Class.extend\n({\n\tclassName: 'Texture',\n\n\t/**\n\t * WebGL ID of the texture.\n\t * !readonly textureId: number;\n\t */\n\ttextureId: null,\n\n\t/**\n\t * Texture width (physical width).\n\t * !readonly width: number;\n\t */\n\twidth: 0,\n\n\t/**\n\t * Texture height (physical height).\n\t * !readonly height: number;\n\t */\n\theight: 0,\n\n\t/**\n\t * Target width originally requested (logical width).\n\t * !readonly targetWidth: number;\n\t */\n\ttargetWidth: 0,\n\n\t/**\n\t * Target height originally requested (logical height).\n\t * !readonly targetHeight: number;\n\t */\n\ttargetHeight: 0,\n\n\t/**\n\t * Real scale of the texture (physical width / logical width).\n\t * !readonly rscale: number;\n\t */\n\trscale: 1.0,\n\n\t/**\n\t * Texture filter.\n\t * !readonly filter: Texture.FilterType;\n\t */\n\tfilter: 'LINEAR',\n\n\t/**\n\t * Texture wrap mode.\n\t * !readonly wrap: Texture.WrapMode;\n\t */\n\twrap: 'CLAMP_TO_EDGE',\n\n\t/**\n\t * Number of mipmap levels (use 0 to disable).\n\t * !readonly mipmap: number;\n\t */\n\tmipmap: 0,\n\n\t/**\n\t * Indicates if the texture storage has already been allocated.\n\t */\n\tallocated: false,\n\n\t/**\n\t * Canvas currently attached to the texture.\n\t */\n\tcanvas: null,\n\n\t/**\n\t * Creates an empty texture of the specified size.\n\t * !constructor (width: number, height: number, targetWidth?: number, targetHeight?: number);\n\t */\n\t__ctor: function (width, height, targetWidth=null, targetHeight=null)\n\t{\n\t\tthis.textureId = null;\n\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.targetWidth = targetWidth ?? width;\n\t\tthis.targetHeight = targetHeight ?? height;\n\n\t\tthis.rscale = this.width / this.targetWidth;\n\t\tthis.filter = 'LINEAR';\n\t\tthis.wrap = 'CLAMP_TO_EDGE';\n\t\tthis.mipmap = 0;\n\t},\n\n\t/**\n\t * Binds the texture to the TEXTURE_2D target.\n\t * !bind(): WebGL2RenderingContext;\n\t */\n\tbind: function ()\n\t{\n\t\tconst gl = glx.gl;\n\n\t\tif (this.textureId === null)\n\t\t\tthis.textureId = gl.createTexture();\n\n\t\tgl.bindTexture(gl.TEXTURE_2D, this.textureId);\n\n\t\tif (this.allocated === false)\n\t\t{\n\t\t\tthis.allocated = null;\n\t\t\tthis.allocate();\n\t\t}\n\n\t\treturn gl;\n\t},\n\n\t/**\n\t * Allocates the texture storage.\n\t * !allocate(): Texture;\n\t */\n\tallocate: function ()\n\t{\n\t\tif (this.allocated === true)\n\t\t\treturn this;\n\n\t\tthis.allocated = true;\n\n\t\tconst gl = this.bind();\n\n\t\tthis.applyFilter(gl);\n\t\tthis.applyWrap(gl);\n\n\t\tif (this.mipmap > 0)\n\t\t\tgl.texStorage2D(gl.TEXTURE_2D, this.mipmap, gl.RGBA8, this.width, this.height);\n\t\telse\n\t\t\tgl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA8, this.width, this.height);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Applies the texture filter.\n\t * !applyFilter() : Texture;\n\t */\n\tapplyFilter: function (_gl=null)\n\t{\n\t\tconst gl = _gl ?? this.bind();\n\n\t\tif (this.mipmap > 0)\n\t\t{\n\t\t\tif (this.filter === 'NEAREST')\n\t\t\t{\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST_MIPMAP_LINEAR);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.filter === 'NEAREST')\n\t\t\t{\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Applies the texture wrap mode.\n\t * !applyWrap() : Texture;\n\t */\n\tapplyWrap: function (_gl=null)\n\t{\n\t\tconst gl = _gl ?? this.bind();\n\n\t\tif (this.wrap === 'REPEAT')\n\t\t{\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n\t\t}\n\t\telse if (this.wrap === 'MIRRORED_REPEAT')\n\t\t{\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.MIRRORED_REPEAT);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.MIRRORED_REPEAT);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the texture filter.\n\t * !setFilter (filter: Texture.FilterType) : Texture;\n\t */\n\tsetFilter: function (filter)\n\t{\n\t\tthis.filter = filter;\n\t\tif (this.textureId !== null) this.applyFilter();\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the texture wrap mode.\n\t * !setWrap (wrap: Texture.WrapMode) : Texture;\n\t */\n\tsetWrap: function (wrap)\n\t{\n\t\tthis.wrap = wrap;\n\t\tif (this.textureId !== null) this.applyWrap();\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the number of mipmap levels.\n\t * !setMipmap (mipmap: number) : Texture;\n\t */\n\tsetMipmap: function (mipmap)\n\t{\n\t\tthis.mipmap = mipmap;\n\n\t\tif (this.textureId !== null && this.allocated === true && this.mipmap > 0)\n\t\t{\n\t\t\tconst gl = this.bind();\n\t\t\tgl.generateMipmap(gl.TEXTURE_2D);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Uploads data to the GPU from the specified image.\n\t * !upload (image: object, targetX?: number, targetY?: number) : Texture;\n\t */\n\tupload: function (image, targetX=0, targetY=0)\n\t{\n\t\tconst gl = this.bind();\n\n\t\tgl.texSubImage2D(gl.TEXTURE_2D, 0, targetX, targetY, Math.min(image.width, this.width), Math.min(image.height, this.height), gl.RGBA, gl.UNSIGNED_BYTE, image);\n\n\t\tif (this.mipmap > 0)\n\t\t\tgl.generateMipmap(gl.TEXTURE_2D);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Creates a canvas and attaches it to the texture. The contents of the attached canvas can be uploaded to the texture by calling the `uploadCanvas` method.\n\t * !getCanvas (options?: Canvas.Options) : Texture;\n\t */\n\tcreateCanvas: function (options=null)\n\t{\n\t\tif (this.canvas === null)\n\t\t\tthis.canvas = new Canvas ({ gl: false, hidden: true, width: this.width, height: this.height, antialias: this.filter === 'LINEAR', ...options });\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the canvas attached to the texture or `null` if no canvas has been created yet (use `createCanvas` first).\n\t * !getCanvas() : Canvas;\n\t */\n\tgetCanvas: function ()\n\t{\n\t\treturn this.canvas;\n\t},\n\n\t/**\n\t * Uploads the bitmap data from the attached canvas to the texture. The callback is called when the upload is completed.\n\t * @returns {Texture}\n\t * !uploadCanvas (callback?: () => void) : Texture;\n\t */\n\tuploadCanvas: function (callback=null)\n\t{\n\t\tif (this.canvas === null)\n\t\t{\n\t\t\tif (callback !== null) callback();\n\t\t\treturn this;\n\t\t}\n\n\t\tlet img = new Image();\n\t\timg.onload = () =>\n\t\t{\n\t\t\tthis.upload(img);\n\t\t\timg = null;\n\n\t\t\tif (callback !== null) callback();\n\t\t};\n\n\t\timg.src = this.canvas.toDataUrl();\n\t\treturn this;\n\t},\n\n\t/**\n\t * Disposes the attached canvas.\n\t * @returns {Texture}\n\t */\n\tdisposeCanvas: function ()\n\t{\n\t\tif (this.canvas !== null)\n\t\t{\n\t\t\tthis.canvas.dispose();\n\t\t\tthis.canvas = null;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Allocates a canvas, executes the given render function, uploads the result to the texture and disposes the canvas.\n\t * @param {Canvas.Options} options\n\t * @param {(g: Canvas) => void} render\n\t * !uploadRender (options: Canvas.Options, render: (g: Canvas) => void) : Texture;\n\t */\n\t/**\n\t * Allocates a canvas, executes the given render function, uploads the result to the texture and disposes the canvas.\n\t * @param {(g: Canvas) => void} render\n\t * !uploadRender (render: (g: Canvas) => void) : Texture;\n\t */\n\tuploadRender: function (options, render=null)\n\t{\n\t\tif (typeof(options) === 'function')\n\t\t{\n\t\t\trender = options;\n\t\t\toptions = null;\n\t\t}\n\n\t\trender(this.createCanvas(options));\n\n\t\tthis.uploadCanvas();\n\t\tthis.disposeCanvas();\n\t\treturn this;\n\t}\n});\n\n//!/class\n","\nimport KeyCode from './keycode.js';\nimport List from '../utils/list.js';\nimport Linkable from '../utils/linkable.js';\nimport Timer from './timer.js';\nimport Canvas from './canvas.js';\nimport Log from './log.js';\nimport globals from './globals.js';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"./keycode\"]\n//![import \"../utils/list\"]\n//![import \"../utils/linkable\"]\n//![import \"./timer\"]\n//![import \"./canvas\"]\n//![import \"./globals\"]\n\nconst System = { };\n\n//!namespace System\n\n\t//:type DisplayOrientation = 'default'|'landscape'|'portrait'|'automatic'|'strict';\n\n\t//!enum KeyboardEventType\n\tSystem.KeyboardEventType = {\n\t\tKEY_DOWN: 0x001,\n\t\tKEY_UP: 0x002,\n\t\t//!KEY_DOWN\n\t\t//!KEY_UP\n\t};\n\t//!/enum\n\n\t//!enum PointerEventType\n\tSystem.PointerEventType = {\n\t\tPOINTER_DOWN: \t\t0x010,\n\t\tPOINTER_UP: \t\t0x011,\n\t\tPOINTER_MOVE: \t\t0x012,\n\t\tPOINTER_DRAG_START:\t0x013,\n\t\tPOINTER_DRAG_MOVE:\t0x014,\n\t\tPOINTER_DRAG_STOP:\t0x015,\n\t\tPOINTER_WHEEL:\t\t0x016,\n\t\t//!POINTER_DOWN\n\t\t//!POINTER_UP\n\t\t//!POINTER_MOVE\n\t\t//!POINTER_DRAG_START\n\t\t//!POINTER_DRAG_MOVE\n\t\t//!POINTER_DRAG_STOP\n\t\t//!POINTER_WHEEL\n\t};\n\t//!/enum\n\n\t//!type KeyboardState =\n\n\t\t/**\n\t\t * Time of last keyboard event.\n\t\t * !time: number;\n\t\t */\n\n\t\t/**\n\t\t * State of any of the SHIFT keys.\n\t\t * !shift: boolean;\n\t\t */\n\n\t\t/**\n\t\t * State of any of the CTRL keys.\n\t\t * !ctrl: boolean;\n\t\t */\n\n\t\t/**\n\t\t * State of the ALT key.\n\t\t * !alt: boolean;\n\t\t */\n\n\t\t/**\n\t\t * Key code of last keyboard event.\n\t\t * !keyCode: KeyCode;\n\t\t */\n\n\t//!/type\n\n\t//!type Pointer =\n\n\t\t/**\t\n\t\t * ID of the pointer.\n\t\t * !id: number;\n\t\t */\n\n\t\t/**\n\t\t * Indicates if the pointer is active (pressed).\n\t\t * !isActive: boolean;\n\t\t */\n\n\t\t/**\n\t\t * Indicates if the pointer is currently being dragged.\n\t\t * !isDragging: boolean;\n\t\t */\n\n\t\t/**\t\n\t\t * Source X-coordinate when the POINTER_DOWN event was fired.\n\t\t * !sx: number;\n\t\t */\n\n\t\t/**\n\t\t * Source Y-coordinate when the POINTER_DOWN event was fired.\n\t\t * !sy: number;\n\t\t */\n\n\t\t/**\n\t\t * Current X-coordinate of the pointer.\n\t\t * !x: number;\n\t\t */\n\n\t\t/**\t\n\t\t * Current Y-coordinate of the pointer.\n\t\t * !y: number;\n\t\t */\n\n\t\t/**\n\t\t * Delta in the X direction of the current drag event.\n\t\t * !dx: number;\n\t\t */\n\n\t\t/**\n\t\t * Delta in the Y direction of the current drag event.\n\t\t * !dy: number;\n\t\t */\n\n\t\t/**\n\t\t * Number of the button currently being pressed.\n\t\t * !button: number;\n\t\t */\n\n\t\t/**\n\t\t * Delta value of the mouse-wheel (valid only when the pointer is a mouse pointing-device).\n\t\t * !wheelDelta: number;\n\t\t */\n\n\t\t/**\n\t\t * Accumulated mouse-wheel delta. Should be set to zero (0) manually when needed.\n\t\t * !wheelAccum: number;\n\t\t */\n\n\t//!/type\n\n\t//!type Options =\n\n\t\t/**\n\t\t *\tBackground of the system canvas. Should be a full 7-digit HEX RGB color.\n\t\t *\t@default \"#000000\"\n\t\t *\t!background?: string;\n\t\t */\n\n\t\t/**\n\t\t * \tSet to `false` to disable WebGL mode.\n\t\t * \t@default true\n\t\t * \t!gl?: boolean;\n\t\t */\n\n\t\t/**\n\t\t *\tSet to `true` t o enable on-screen logging.\n\t\t *\t@default false\n\t\t *\t!log?: boolean,\n\t\t */\n\n\t\t/**\n\t\t *\tWhen `true` the renderer will not clear the buffer on each frame draw, thus allowing overdrawing on the previous frame.\n\t\t *\t@default false\n\t\t *\t!overdraw?: boolean,\n\t\t */\n\n\t\t/**\n\t\t *\tEnables or disables antialised canvas. Set to `false` when pixel-perfect is desired.\n\t\t *\t@default false\n\t\t *\t!antialias?: boolean;\n\t\t */\n\n\t\t/**\n\t\t *\tDesired orientaton of the display.\n\t\t *\t@default \"automatic\"\n\t\t *\t!orientation?: DisplayOrientation;\n\t\t */\n\n\t\t/**\n\t\t *\tDesired display width. When not specified (null) the maximum screen width to maintain the aspect ratio will be used.\n\t\t *\t@default null\n\t\t *\t!screenWidth?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tDesired display height. When not specified (null) the maximum screen height to maintain the aspect ratio will be used.\n\t\t *\t@default null\n\t\t *\t!screenHeight?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tTarget frames per second (FPS). Used to determine delay between frames.\n\t\t *\t@default 144\n\t\t *\t!fps?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tMinimum allowed frames per second (FPS). If system FPS drops below this value, the `frameDelta` property of System will be truncated to 1/minFps.\n\t\t *\t@default 10\n\t\t *\t!minFps?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tSelects which rendering mechanism to use either requestAnimationFrame when `true` or setTimeout when `false`.\n\t\t *\t@default true\n\t\t *\t!vsync?: boolean;\n\t\t */\n\n\t\t/**\n\t\t *\tExtra scale factor used to resize images. Use only when you want to render higher resolution images possibly for a very high DPI display.\n\t\t *\t@default 1\n\t\t *\t!extraScaleFactor?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tMaximum scale factor that should be used in the system. A value of `null` will cause no limit.\n\t\t *\t@default null\n\t\t *\t!maxScaleFactor?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tIndicates which method to use to find the target resolution, using `fullscreen` object when `true`, or the `window` object when `false`.\n\t\t *\t@default false\n\t\t *\t!fullscreen?: boolean;\n\t\t */\n\n\t\t/**\n\t\t * \tIndicates if recycler pool preallocation should be automatically executed. Additionally if this value is a number, it will be used as\n\t\t * \tmaximum preallocation parameter for the recycler.\n\t\t * \t@default false\n\t\t * \t!preallocate?: boolean|number;\n\t\t */\n\n\t//!/type\n\n\t//:type KeyboardEventHandler = (action: KeyboardEventType, keyCode: KeyCode, state: KeyboardState) => boolean;\n\t//:type PointerEventHandler = (action: PointerEventType, pointer: Pointer, pointers: { \\[pointerId: number\\]: Pointer }) => boolean;\n\n//!/namespace\n\n//!class System\n\nObject.assign(System,\n{\n\t/**\n\t * Renderer status flags.\n\t */\n\tflags:\n\t{\n\t\trenderingEnabled: false,\n\t\trenderingPaused: false\n\t},\n\n\t/**\n\t * Default options of the rendering system.\n\t */\n\tdefaultOptions:\n\t{\n\t\tbackground: \"#000000\",\n\t\tgl: true,\n\t\tlog: false,\n\n\t\toverdraw: false,\n\t\tantialias: true,\n\t\torientation: 0,\n\n\t\tfps: 144,\n\t\tminFps: 15,\n\t\tvsync: true,\n\n\t\tscreenWidth: null,\n\t\tscreenHeight: null,\n\n\t\textraScaleFactor: 1,\n\t\tmaxScaleFactor: null,\n\n\t\tfullscreen: false\n\t},\n\n\t/**\n\t * Screen width, available only after the system has been initialized.\n\t * !static readonly screenWidth: number;\n\t */\n\tscreenWidth: 0,\n\n\t/**\n\t * Screen height, available only after the system has been initialized.\n\t * !static readonly screenHeight: number;\n\t */\n\tscreenHeight: 0,\n\n\t/**\n\t * Current display orientation.\n\t * !static readonly orientation: System.DisplayOrientation;\n\t */\n\torientation: 0,\n\n\t/**\n\t * Coordinates of the screen's offset (for letter-box effect when the screen does not fit tightly).\n\t */\n\toffsX: 0, offsY: 0,\n\n\t/**\n\t * Device pixel ratio, canvas backing store ratio and resulting canvas ratio (devicePixelRatio / backingStoreRatio).\n\t */\n\tdevicePixelRatio: 1, backingStoreRatio: 1, canvasPixelRatio: 1, canvasScaleFactor: 1, scaleFactor: 1,\n\n\t/**\n\t * Initial transformation matrix. Should be used (if needed) instead of `loadIdentity` since the System does some transformations first.\n\t * !static readonly initialMatrix: Matrix;\n\t */\n\tinitialMatrix: null,\n\n\t/**\n\t * Primary renderer.\n\t * !static readonly renderer: Canvas;\n\t */\n\trenderer: null,\n\n\t/**\n\t * Secondary display buffer (always 2D). Has the same initial transformation matrix as the primary display buffer.\n\t * !static readonly displayBuffer2: Canvas;\n\t */\n\tdisplayBuffer2: null,\n\n\t/**\n\t * Terciary display buffer (always 2D). Is assured to have 1:1 with the screen size, initial transformation matrix not applied.\n\t * !static readonly displayBuffer3: Canvas;\n\t */\n\tdisplayBuffer3: null,\n\n\t/**\n\t * Temporal display buffer (640x480). Used to preload images.\n\t */\n\ttempDisplayBuffer: null,\n\n\t/**\n\t * Map with the status of all keys (along with other flags).\n\t * !static readonly keyState: System.KeyboardState;\n\t */\n\tkeyState: { time: 0, shift: false, ctrl: false, alt: false, keyCode: 0 },\n\n\t/**\n\t * Current status of all pointers.\n\t * !static readonly pointers: { \\[pointerId: number\\]: System.Pointer };\n\t */\n\tpointers: { },\n\n\t/**\n\t * \tThe update method of all objects will be executed when the system update() method is called.\n\t */\n\tupdateQueue: null,\n\n\t/**\n\t * The draw method of all objects will be executed when the system draw() method is called.\n\t */\n\tdrawQueue: null, /*List*/\n\n\t/**\n\t * The frame delta is multiplied by this value before each system cycle (defaults to 1).\n\t * !static timeScale: number;\n\t */\n\ttimeScale: 1,\n\n\t/**\n\t * Frame interval in milliseconds.\n\t * !static readonly frameInterval: number;\n\t */\n\tframeInterval: 0,\n\n\t/**\n\t * Fixed frame interval in milliseconds, when set to non-zero value the frame delta will always be set to this value.\n\t * !static fixedFrameInterval: number;\n\t */\n\tfixedFrameInterval: 0,\n\n\t/**\n\t * Maximum frame interval in milliseconds, if the `frameDelta` exceeds this, it will be truncated to this value. Controlled by the `minFps` value of the system initialization options.\n\t * !static readonly maxFrameInterval: number;\n\t */\n\tmaxFrameInterval: 0,\n\n\t/**\n\t * Last frame delta in seconds.\n\t * !static readonly frameDelta: number;\n\t */\n\tframeDelta: 0,\n\n\t/**\n\t * Logical system time in seconds. Updated on each cycle by the calculated `frameDelta`.\n\t * !static readonly frameTime: number;\n\t */\n\tframeTime: 0,\n\n\t/**\n\t * Current frame number.\n\t * !static readonly frameNumber: number;\n\t */\n\tframeNumber: 0,\n\n\t/**\n\t * Rendering performance data.\n\t */\n\tperf:\n\t{\n\t\t/**\n\t\t * Current time range.\n\t\t */\n\t\tstartTime: 0,\n\t\tlastTime: 0,\n\n\t\t/**\n\t\t * Number of frames drawn in the current time range.\n\t\t */\n\t\tnumFrames: 0,\n\n\t\t/**\n\t\t * Number of update and draw samples averaged in total.\n\t\t */\n\t\tnumSamples: 0,\n\n\t\t/**\n\t\t * Total time spent in update, draw and extra respectively in the current time range.\n\t\t */\n\t\tupdateTimeTotal: 0,\n\t\tdrawTimeTotal: 0,\n\t\textraTimeTotal: 0,\n\t\tframeTimeTotal: 0,\n\n\t\t/**\n\t\t * Calculated values for the last time range. The updateTime and drawTime are in microseconds.\n\t\t */\n\t\tfps: 0,\n\t\taverageFps: 0,\n\t\taverageUpdateTime: 0,\n\t\taverageDrawTime: 0,\n\t\taverageExtraTime: 0,\n\t\taverageFrameTime: 0,\n\t},\n\n\t/**\n\t * Initializes the system with the specified configuration options.\n\t * !static init (options: System.Options) : void;\n\t */\n\tinit: function (options=null)\n\t{\n\t\tlet self = this;\n\n\t\tlet o = { ...this.defaultOptions, ...options };\n\t\tthis.options = o;\n\n\t\t// Execute recycler pool data preallocation.\n\t\tif (this.options.preallocate !== false)\n\t\t{\n\t\t\tif (this.options.preallocate === true)\n\t\t\t\tRecycler.preallocate();\n\t\t\telse\n\t\t\t\tRecycler.preallocate(this.options.preallocate);\n\t\t}\n\n\t\t// Set default orientation if both target sizes were specified.\n\t\tif (o.screenWidth && o.screenHeight && o.orientation == 'default')\n\t\t\to.orientation = o.screenWidth > o.screenHeight ? 'landscape' : 'portrait';\n\n\t\tthis.orientation = o.orientation;\n\n\t\tthis.updateQueue = List.Pool.alloc();\n\t\tthis.drawQueue = List.Pool.alloc();\n\n\t\t// Attach frame event handlers.\n\t\tthis.frameInterval = 1000 / o.fps;\n\t\tthis.maxFrameInterval = 1000 / o.minFps;\n\n\t\tglobal.onresize = function() { self.onWindowResized(); };\n\n\t\tthis.frameTimer = new Timer (o.vsync, this.frameInterval, (delta) => this.onFrame(delta));\n\n\t\t// Setup canvas buffer.\n\t\tthis.renderer = new Canvas ({ gl: o.gl, elem: null, absolute: true, hidden: false, antialias: o.antialias, background: o.background });\n\n\t\tthis.displayBuffer2 = new Canvas ({ gl: false, elem: null, absolute: true, hidden: false, antialias: o.antialias, background: 'none' });\n\t\tthis.displayBuffer2.elem.style.pointerEvents = 'none';\n\n\t\tthis.displayBuffer3 = new Canvas ({ gl: false, elem: null, absolute: true, hidden: false, antialias: o.antialias, background: 'none' });\n\t\tthis.displayBuffer3.elem.style.pointerEvents = 'none';\n\n\t\tthis.tempDisplayBuffer = new Canvas ({ hidden: true, antialias: o.antialias }).resize(640, 480);\n\n\t\tlet display0 = this.renderer.elem;\n\n\t\t// Obtain device display ratios.\n\t\tthis.devicePixelRatio = global.devicePixelRatio || 1;\n\n\t\tthis.backingStoreRatio = o.gl === true ? 1 : (this.renderer.context.webkitBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.renderer.context.mozBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.renderer.context.msBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.renderer.context.oBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.renderer.context.backingStorePixelRatio || 1);\n\n\t\tthis.canvasPixelRatio = this.devicePixelRatio / this.backingStoreRatio;\n\n\t\tSystem.onWindowResized(true);\n\n\t\t// Attach keyboard event handlers.\n\t\tglobal.onkeydown = function (evt)\n\t\t{\n\t\t\tif (evt.target !== global.document.body)\n\t\t\t\treturn;\n\n\t\t\tif (self.keyState[evt.keyCode])\n\t\t\t\treturn false;\n\n\t\t\tself.keyState[evt.keyCode] = true;\n\n\t\t\tself.keyState.keyCode = evt.keyCode;\n\t\t\tself.keyState.startTime = hrnow();\n\n\t\t\tswitch (evt.keyCode)\n\t\t\t{\n\t\t\t\tcase 16: // SHIFT\n\t\t\t\t\tself.keyState.shift = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 17: // CTRL\n\t\t\t\t\tself.keyState.ctrl = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 18: // ALT\n\t\t\t\t\tself.keyState.alt = true;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// CTRL+TAB should always be handled by the browser.\n\t\t\tif (self.keyState.ctrl && evt.keyCode == KeyCode.TAB)\n\t\t\t{\n\t\t\t\tself.keyState[evt.keyCode] = false;\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (self.onKeyboardEvent (self.KeyboardEventType.KEY_DOWN, evt.keyCode, self.keyState) === false)\n\t\t\t\treturn false;\n\t\t};\n\n\t\tglobal.onkeyup = function (evt)\n\t\t{\n\t\t\tif (evt.target !== global.document.body)\n\t\t\t\treturn;\n\n\t\t\tif (!self.keyState[evt.keyCode])\n\t\t\t\treturn false;\n\n\t\t\tself.keyState[evt.keyCode] = false;\n\t\t\tself.keyState.endTime = hrnow();\n\t\t\tself.keyState.keyCode = evt.keyCode;\n\n\t\t\tswitch (evt.keyCode)\n\t\t\t{\n\t\t\t\tcase 16: // SHIFT\n\t\t\t\t\tself.keyState.shift = false;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 17: // CTRL\n\t\t\t\t\tself.keyState.ctrl = false;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 18: // ALT\n\t\t\t\t\tself.keyState.alt = false;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (self.onKeyboardEvent (self.KeyboardEventType.KEY_UP, evt.keyCode, self.keyState) === false)\n\t\t\t\treturn false;\n\t\t};\n\n\t\t// Converts pointer coordinates from physical space to screen space.\n\n\t\tconst pointerConvX = function (x, y)\n\t\t{\n\t\t\treturn System.reverseRender ? int(System.screenWidth-1 - (y-System.offsY)/System.canvasScaleFactor) : int((x-System.offsX)/System.canvasScaleFactor);\n\t\t};\n\n\t\tconst pointerConvY = function (x, y)\n\t\t{\n\t\t\treturn System.reverseRender ? int((x-System.offsX)/System.canvasScaleFactor) : int((y-System.offsY)/System.canvasScaleFactor);\n\t\t};\n\n\t\t// Attach pointer event handlers if pointer-events are available.\n\t\tif (\"ontouchstart\" in global)\n\t\t{\n\t\t\tdisplay0.ontouchstart = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tlet touches = evt.changedTouches;\n\n\t\t\t\tfor (let i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointers[touches[i].identifier])\n\t\t\t\t\t{\n\t\t\t\t\t\tSystem.pointers[touches[i].identifier] = {\n\t\t\t\t\t\t\t\tid: touches[i].identifier, isActive: false, isDragging: false,\n\t\t\t\t\t\t\t\tsx: 0, sy: 0, x: 0, y: 0, dx: 0, dy: 0, button: 0,\n\t\t\t\t\t\t\t\twheelDelta: 0, wheelAccum: 0\n\t\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tlet p = System.pointers[touches[i].identifier];\n\n\t\t\t\t\tp.isActive = true;\n\t\t\t\t\tp.isDragging = false;\n\t\t\t\t\tp.button = 1;\n\n\t\t\t\t\tp.startTime = hrnow();\n\n\t\t\t\t\tp.x = p.sx = pointerConvX(touches[i].clientX, touches[i].clientY);\n\t\t\t\t\tp.y = p.sy = pointerConvY(touches[i].clientX, touches[i].clientY);\n\n\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DOWN, p, System.pointers);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchend = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tlet touches = evt.changedTouches;\n\n\t\t\t\tfor (let i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointers[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tlet p = System.pointers[touches[i].identifier];\n\n\t\t\t\t\tp.endTime = hrnow();\n\t\t\t\t\tp.deltaTime = p.endTime - p.startTime;\n\n\t\t\t\t\tp.x = pointerConvX(touches[i].clientX, touches[i].clientY)\n\t\t\t\t\tp.y = pointerConvY(touches[i].clientX, touches[i].clientY)\n\n\t\t\t\t\tif (p.isDragging)\n\t\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DRAG_STOP, p, System.pointers);\n\n\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_UP, p, System.pointers);\n\n\t\t\t\t\tp.isActive = false;\n\t\t\t\t\tp.isDragging = false;\n\n\t\t\t\t\tp.button = 0;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchcancel = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tlet touches = evt.changedTouches;\n\n\t\t\t\tfor (let i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointers[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tlet p = System.pointers[touches[i].identifier];\n\n\t\t\t\t\tp.x = pointerConvX(touches[i].clientX, touches[i].clientY);\n\t\t\t\t\tp.y = pointerConvY(touches[i].clientX, touches[i].clientY);\n\n\t\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.PointerEventType.POINTER_DRAG_STOP : System.PointerEventType.POINTER_UP, p, System.pointers);\n\n\t\t\t\t\tp.isActive = false;\n\t\t\t\t\tp.isDragging = false;\n\n\t\t\t\t\tp.button = 0;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchmove = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tlet touches = evt.changedTouches;\n\n\t\t\t\tfor (let i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointers[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tlet p = System.pointers[touches[i].identifier];\n\n\t\t\t\t\tif (p.isActive && !p.isDragging)\n\t\t\t\t\t{\n\t\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DRAG_START, p, System.pointers);\n\t\t\t\t\t\tp.isDragging = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tp.x = pointerConvX(touches[i].clientX, touches[i].clientY);\n\t\t\t\t\tp.y = pointerConvY(touches[i].clientX, touches[i].clientY);\n\n\t\t\t\t\tp.dx = p.x - p.sx;\n\t\t\t\t\tp.dy = p.y - p.sy;\n\n\t\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.PointerEventType.POINTER_DRAG_MOVE : System.PointerEventType.POINTER_MOVE, p, System.pointers);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\t\t// Attach mouse event handlers when pointer-events are not available.\n\t\telse\n\t\t{\n\t\t\tdisplay0.oncontextmenu = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.onwheel = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointers[0])\n\t\t\t\t{\n\t\t\t\t\tSystem.pointers[0] = {\n\t\t\t\t\t\t\tid: 0, isActive: false, isDragging: false,\n\t\t\t\t\t\t\tsx: 0, sy: 0, x: 0, y: 0, dx: 0, dy: 0, button: 0,\n\t\t\t\t\t\t\twheelDelta: 0, wheelAccum: 0\n\t\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlet p = System.pointers[0];\n\n\t\t\t\tp.x = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = pointerConvY(evt.clientX, evt.clientY);\n\t\t\t\tp.wheelDelta = evt.deltaY;\n\t\t\t\tp.wheelAccum += evt.deltaY;\n\n\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_WHEEL, p, System.pointers);\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.onmousedown = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointers[0])\n\t\t\t\t{\n\t\t\t\t\tSystem.pointers[0] = {\n\t\t\t\t\t\t\tid: 0, isActive: false, isDragging: false,\n\t\t\t\t\t\t\tsx: 0, sy: 0, x: 0, y: 0, dx: 0, dy: 0, button: 0,\n\t\t\t\t\t\t\twheelDelta: 0, wheelAccum: 0\n\t\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlet p = System.pointers[0];\n\n\t\t\t\tp.isActive = true;\n\t\t\t\tp.isDragging = false;\n\t\t\t\tp.button = evt.which;\n\n\t\t\t\tp.x = p.sx = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = p.sy = pointerConvY(evt.clientX, evt.clientY);\n\n\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DOWN, p, System.pointers);\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.onmouseup = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointers[0])\n\t\t\t\t\treturn false;\n\n\t\t\t\tlet p = System.pointers[0];\n\n\t\t\t\tp.x = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = pointerConvY(evt.clientX, evt.clientY);\n\n\t\t\t\tif (p.isDragging)\n\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DRAG_STOP, p, System.pointers);\n\n\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_UP, p, System.pointers);\n\n\t\t\t\tp.isActive = false;\n\t\t\t\tp.isDragging = false;\n\n\t\t\t\tp.button = 0;\n\t\t\t};\n\n\t\t\tdisplay0.onmousemove = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointers[0])\n\t\t\t\t\treturn false;\n\n\t\t\t\tlet p = System.pointers[0];\n\n\t\t\t\tif (p.isActive && !p.isDragging)\n\t\t\t\t{\n\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DRAG_START, p, System.pointers);\n\t\t\t\t\tp.isDragging = true;\n\t\t\t\t}\n\n\t\t\t\tp.x = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = pointerConvY(evt.clientX, evt.clientY);\n\n\t\t\t\tp.dx = p.x - p.sx;\n\t\t\t\tp.dy = p.y - p.sy;\n\n\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.PointerEventType.POINTER_DRAG_MOVE : System.PointerEventType.POINTER_MOVE, p, System.pointers);\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\t// Enable log if flag is set.\n\t\tif (o.log === true) Log.enable();\n\t},\n\n\t/**\n\t * Returns the current logical time in seconds (same as reading `System.frameTime`).\n\t * !static time() : number;\n\t */\n\ttime: function()\n\t{\n\t\treturn this.frameTime;\n\t},\n\n\t/**\n\t * Starts the system and enables rendering and updates.\n\t * !static start() : void;\n\t */\n\tstart: function()\n\t{\n\t\tthis.onWindowResized();\n\n\t\tthis.flags.renderingPaused = false;\n\t\tthis.frameTimer.start();\n\t},\n\n\t/**\n\t * Stops the system by disabling both rendering and updates.\n\t * !static stop() : void;\n\t */\n\tstop: function()\n\t{\n\t\tthis.flags.renderingPaused = true;\n\t\tthis.frameTimer.stop();\n\t},\n\n\t/**\n\t * Pauses the system by disabling updates, but rendering will be continued.\n\t * !static pause() : void;\n\t */\n\tpause: function()\n\t{\n\t\tthis.flags.renderingPaused = true;\n\t},\n\n\t/**\n\t * Resumes the system after previously being paused with `pause` method.\n\t * !static resume() : void;\n\t */\n\tresume: function()\n\t{\n\t\tthis.flags.renderingPaused = false;\n\t\tthis.resetPerf();\n\t},\n\n\t/**\n\t * Executed when a frame needs to be rendered to the display buffer.\n\t * static onFrame (delta: number) : void;\n\t */\n\tonFrame: function (delta)\n\t{\n\t\tlet now = hrnow()\n\t\tlet tmp;\n\n\t\tif (delta > this.maxFrameInterval)\n\t\t\tdelta = this.maxFrameInterval;\n\n\t\tif (this.fixedFrameInterval !== 0)\n\t\t\tdelta = this.fixedFrameInterval;\n\n\t\tif (!this.flags.renderingEnabled || this.flags.renderingPaused)\n\t\t{\n\t\t\tthis.draw();\n\t\t\treturn;\n\t\t}\n\n\t\tdelta *= this.timeScale;\n\n\t\tthis.frameDelta = delta / 1000.0;\n\t\tthis.frameTime += this.frameDelta;\n\t\tglobals.time = this.frameTime;\n\n\t\tthis.frameNumber++;\n\n\t\t/* ~ */\n\t\ttmp = hrnow();\n\t\tthis.update (this.frameDelta);\n\t\tthis.perf.updateTimeTotal += hrnow() - tmp;\n\n\t\t/* ~ */\n\t\ttmp = hrnow();\n\t\tthis.draw();\n\t\tthis.perf.drawTimeTotal += hrnow() - tmp;\n\n\t\t/* ~ */\n\t\tthis.perf.lastTime = now;\n\t\tthis.perf.numFrames++;\n\n\t\tthis.perf.frameTimeTotal += hrnow() - now;\n\n\t\tdelta = this.perf.lastTime - this.perf.startTime;\n\t\tif (delta > 1000)\n\t\t{\n\t\t\tthis.perf.fps = int(this.perf.numFrames*1000 / delta);\n\n\t\t\t//this.perf.extraTimeTotal = delta - this.perf.updateTimeTotal - this.perf.drawTimeTotal;\n\n\t\t\tthis.perf.averageFps = int(((this.perf.averageFps*this.perf.numSamples) + this.perf.fps) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.averageUpdateTime = int(((this.perf.averageUpdateTime*this.perf.numSamples) + (this.perf.updateTimeTotal*1000 / this.perf.numFrames)) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.averageDrawTime = int(((this.perf.averageDrawTime*this.perf.numSamples) + (this.perf.drawTimeTotal*1000 / this.perf.numFrames)) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.averageExtraTime = int(((this.perf.averageExtraTime*this.perf.numSamples) + (this.perf.extraTimeTotal*1000 / this.perf.numFrames)) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.averageFrameTime = int(((this.perf.averageFrameTime*this.perf.numSamples) + (this.perf.frameTimeTotal*1000 / this.perf.numFrames)) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.numSamples++;\n\n\t\t\tthis.perf.startTime = now;\n\t\t\tthis.perf.lastTime = now;\n\t\t\tthis.perf.numFrames = 0;\n\t\t\tthis.perf.updateTimeTotal = 0;\n\t\t\tthis.perf.drawTimeTotal = 0;\n\t\t\tthis.perf.extraTimeTotal = 0;\n\t\t\tthis.perf.frameTimeTotal = 0;\n\t\t}\n\t},\n\n\t/**\n\t * Executed when the size of the window has changed.\n\t * static onWindowResized (notRendering?: boolean) : void;\n\t */\n\tonWindowResized: function (notRendering=false)\n\t{\n\t\t// Determine size of the screen.\n\t\tif ('document' in global)\n\t\t{\n\t\t\tif (this.options.fullscreen)\n\t\t\t{\n\t\t\t\tthis._screenWidth = int(global.screen.width);\n\t\t\t\tthis._screenHeight = int(global.screen.height);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._screenWidth = global.innerWidth;\n\t\t\t\tthis._screenHeight = global.innerHeight;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._screenWidth = this.options.screenWidth;\n\t\t\tthis._screenHeight = this.options.screenHeight;\n\n\t\t\tif (this.options.screenWidth == null && this.options.screenHeight == null)\n\t\t\t\tthrow new Error ('At least one screen dimension must be specified in headless mode.');\n\t\t}\n\n\t\t// Flip dimensions to ensure the desired orientation.\n\t\tif ((this._screenWidth < this._screenHeight && this.orientation == 'landscape') || (this._screenWidth > this._screenHeight && this.orientation == 'portrait'))\n\t\t{\n\t\t\tthis.screenWidth = this._screenHeight;\n\t\t\tthis.screenHeight = this._screenWidth;\n\n\t\t\tthis.reverseRender = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.screenWidth = this._screenWidth;\n\t\t\tthis.screenHeight = this._screenHeight;\n\n\t\t\tthis.reverseRender = false;\n\t\t}\n\n\t\t// Get target screen dimensions.\n\t\tlet targetScreenWidth = this.options.screenWidth;\n\t\tlet targetScreenHeight = this.options.screenHeight;\n\n\t\tif (targetScreenWidth === null || targetScreenHeight === null)\n\t\t{\n\t\t\tif (targetScreenWidth === null && targetScreenHeight === null)\n\t\t\t{\n\t\t\t\ttargetScreenWidth = this.screenWidth;\n\t\t\t\ttargetScreenHeight = this.screenHeight;\n\t\t\t}\n\t\t\telse if (targetScreenWidth === null)\n\t\t\t{\n\t\t\t\ttargetScreenWidth = int(0.5 + this.screenWidth * (this.options.screenHeight / this.screenHeight));\n\t\t\t}\n\t\t\telse if (targetScreenHeight === null)\n\t\t\t{\n\t\t\t\ttargetScreenHeight = int(0.5 + this.screenHeight * (this.options.screenWidth / this.screenWidth));\n\t\t\t}\n\t\t}\n\n\t\t// ***\n\t\tlet screenWidth = targetScreenWidth;\n\t\tlet screenHeight = targetScreenHeight;\n\n\t\tif (this.orientation === 'automatic' && screenWidth && screenHeight)\n\t\t{\n\t\t\tif ((screenWidth > screenHeight && this.screenWidth < this.screenHeight) || (screenWidth < screenHeight && this.screenWidth > this.screenHeight))\n\t\t\t{\n\t\t\t\tscreenWidth = screenHeight;\n\t\t\t\tscreenHeight = targetScreenWidth;\n\t\t\t}\n\t\t}\n\n\t\t// ***\n\t\tthis.canvasScaleFactor = 1;\n\n\t\tif (screenWidth && screenHeight)\n\t\t{\n\t\t\tthis.canvasScaleFactor = Math.min(this.screenWidth / screenWidth, this.screenHeight / screenHeight);\n\t\t}\n\t\telse if (screenWidth)\n\t\t{\n\t\t\tthis.canvasScaleFactor = this.screenWidth / screenWidth;\n\t\t}\n\t\telse if (screenHeight)\n\t\t{\n\t\t\tthis.canvasScaleFactor = this.screenHeight / screenHeight;\n\t\t}\n\n\t\t// ***\n\t\tlet _screenWidth = this.screenWidth;\n\t\tlet _screenHeight = this.screenHeight;\n\n\t\tif (screenWidth) this.screenWidth = screenWidth;\n\t\tif (screenHeight) this.screenHeight = screenHeight;\n\n\t\tthis.offsX = int((_screenWidth - this.screenWidth*this.canvasScaleFactor)*0.5);\n\t\tthis.offsY = int((_screenHeight - this.screenHeight*this.canvasScaleFactor)*0.5);\n\n\t\tif (this.reverseRender)\n\t\t{\n\t\t\tlet tmp = this.offsX;\n\t\t\tthis.offsX = this.offsY;\n\t\t\tthis.offsY = tmp;\n\t\t}\n\n\t\tthis.scaleFactor = this.canvasScaleFactor * this.canvasPixelRatio;\n\t\tthis.scaleFactor = int(0.7 + this.scaleFactor);\n\n\t\tif (this.options.maxScaleFactor > 0 && this.scaleFactor > this.options.maxScaleFactor)\n\t\t\tthis.scaleFactor = this.options.maxScaleFactor;\n\n\t\tthis.flags.renderingEnabled = false;\n\n\t\t/*\n\t\t**\tIf the scale is not exact, the final canvas size might not fit the entire screen perfectly (will always be a little smaller in\n\t\t**\tsuch a case), when that happens the body's background color will be quite noticeable, to mitigate that we set the body background\n\t\t**\tto the same color as the primary canvas.\n\t\t*/\n\t\tif ('document' in global)\n\t\t\tglobal.document.body.style.backgroundColor = this.renderer.backgroundColor;\n\n\t\t/*\n\t\t**\tResize all display buffers.\n\t\t*/\n\t\tif (!this.reverseRender)\n\t\t{\n\t\t\tthis.renderer.resize (this.screenWidth*this.scaleFactor, this.screenHeight*this.scaleFactor);\n\t\t\tthis.renderer.elem.style.width = int(this.screenWidth*this.canvasScaleFactor+0.5) + \"px\";\n\t\t\tthis.renderer.elem.style.height = int(this.screenHeight*this.canvasScaleFactor+0.5) + \"px\";\n\n\t\t\tthis.displayBuffer2.resize (this.screenWidth*this.scaleFactor, this.screenHeight*this.scaleFactor);\n\t\t\tthis.displayBuffer2.elem.style.width = int(this.screenWidth*this.canvasScaleFactor+0.5) + \"px\";\n\t\t\tthis.displayBuffer2.elem.style.height = int(this.screenHeight*this.canvasScaleFactor+0.5) + \"px\";\n\n\t\t\tthis.displayBuffer3.resize (_screenWidth, _screenHeight);\n\t\t\tthis.displayBuffer3.elem.style.width = _screenWidth + \"px\";\n\t\t\tthis.displayBuffer3.elem.style.height = _screenHeight + \"px\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.renderer.resize (this.screenHeight*this.scaleFactor, this.screenWidth*this.scaleFactor);\n\t\t\tthis.renderer.elem.style.width = int(this.screenHeight*this.canvasScaleFactor+0.5) + \"px\";\n\t\t\tthis.renderer.elem.style.height = int(this.screenWidth*this.canvasScaleFactor+0.5) + \"px\";\n\n\t\t\tthis.displayBuffer2.resize (this.screenHeight*this.scaleFactor, this.screenWidth*this.scaleFactor);\n\t\t\tthis.displayBuffer2.elem.style.width = int(this.screenHeight*this.canvasScaleFactor+0.5) + \"px\";\n\t\t\tthis.displayBuffer2.elem.style.height = int(this.screenWidth*this.canvasScaleFactor+0.5) + \"px\";\n\n\t\t\tthis.displayBuffer3.resize (_screenHeight, _screenWidth);\n\t\t\tthis.displayBuffer3.elem.style.width = _screenHeight + \"px\";\n\t\t\tthis.displayBuffer3.elem.style.height = _screenWidth + \"px\";\n\t\t}\n\n\t\tthis.renderer.elem.style.marginLeft = this.offsX + \"px\";\n\t\tthis.renderer.elem.style.marginTop = this.offsY + \"px\";\n\n\t\tthis.displayBuffer2.elem.style.marginLeft = this.offsX + \"px\";\n\t\tthis.displayBuffer2.elem.style.marginTop = this.offsY + \"px\";\n\n\t\tthis.renderer.loadIdentity();\n\t\tthis.displayBuffer2.loadIdentity();\n\t\tthis.displayBuffer3.loadIdentity();\n\n\t\tif (this.scaleFactor != 1)\n\t\t{\n\t\t\tthis.renderer.globalScale(this.scaleFactor);\n\t\t\tthis.displayBuffer2.globalScale(this.scaleFactor);\n\t\t}\n\n\t\tif (this.reverseRender)\n\t\t{\n\t\t\tthis.renderer.rotate(Math.PI/2);\n\t\t\tthis.renderer.translate(-this.screenWidth, 0);\n\t\t\tthis.renderer.flipped(true);\n\n\t\t\tthis.displayBuffer2.rotate(Math.PI/2);\n\t\t\tthis.displayBuffer2.translate(-this.screenWidth, 0);\n\t\t\tthis.displayBuffer2.flipped(true);\n\n\t\t\tthis.displayBuffer3.rotate(Math.PI/2);\n\t\t\tthis.displayBuffer3.translate(-_screenWidth, 0);\n\t\t\tthis.displayBuffer3.flipped(true);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.renderer.flipped(false);\n\t\t\tthis.displayBuffer2.flipped(false);\n\t\t\tthis.displayBuffer3.flipped(false);\n\t\t}\n\n\t\t/* *** */\n\t\tthis.scaleFactor *= this.options.extraScaleFactor;\n\n\t\tif (this.options.maxScaleFactor > 0 && this.scaleFactor > this.options.maxScaleFactor)\n\t\t\tthis.scaleFactor = this.options.maxScaleFactor;\n\n\t\tthis.integerScaleFactor = int(this.scaleFactor + 0.5); //0.9\n\t\tthis.resetPerf();\n\n\t\tif (this.initialMatrix)\n\t\t\tthis.initialMatrix.free();\n\n\t\tthis.initialMatrix = this.renderer.getMatrix(true);\n\n\t\tif (notRendering != true)\n\t\t{\n\t\t\tthis.flags.renderingEnabled = true;\n\t\t\tthis.onCanvasResized (this.screenWidth, this.screenHeight);\n\t\t}\n\t},\n\n\t/**\n\t * Event triggered when the canvas was resized by the system. Can be overriden.\n\t * !static onCanvasResized (screenWidth: number, screenHeight: number) : void;\n\t */\n\tonCanvasResized: function (screenWidth, screenHeight)\n\t{\n\t},\n\n\t/**\n\t * Resets the performance data.\n\t * !static resetPerf () : void;\n\t */\n\tresetPerf: function()\n\t{\n\t\tthis.perf.startTime = hrnow();\n\t\tthis.perf.lastTime = hrnow();\n\n\t\tthis.perf.numFrames = 0;\n\t\tthis.perf.updateTimeTotal = 0;\n\t\tthis.perf.drawTimeTotal = 0;\n\t\tthis.perf.extraTimeTotal = 0;\n\t\tthis.perf.frameTimeTotal = 0;\n\n\t\tthis.perf.numSamples = 0;\n\t\tthis.perf.fps = 0;\n\t\tthis.perf.averageFps = 0;\n\t\tthis.perf.averageUpdateTime = 0;\n\t\tthis.perf.averageDrawTime = 0;\n\t\tthis.perf.averageExtraTime = 0;\n\t\tthis.perf.averageFrameTime = 0;\n\t},\n\n\t/**\n\t * Adds the specified update handler to the system.\n\t * !static updateQueueAdd (handler: { update: (dt: number) => boolean }) : Linkable;\n\t * violet\n\t */\n\tupdateQueueAdd: function (handler)\n\t{\n\t\tthis.updateQueue.push (handler);\n\t\treturn this.updateQueue.bottom;\n\t},\n\n\t/**\n\t * Removes the specified update handler from the system.\n\t * !static updateQueueRemove (handler: { update: (dt: number) => boolean }) : void;\n\t * violet\n\t */\n\t/**\n\t * Removes the specified update handler node from the system.\n\t * !static updateQueueRemove (node: Linkable) : void;\n\t */\n\tupdateQueueRemove: function (handler)\n\t{\n\t\tthis.updateQueue.remove (Linkable.isInstance(handler) ? handler : this.updateQueue.sgetNode(handler));\n\t},\n\n\t/**\n\t * Adds the specified draw handler to the system.\n\t * !static drawQueueAdd (handler: { draw: (g: Canvas) => void }) : Linkable;\n\t * violet\n\t */\n\tdrawQueueAdd: function (handler)\n\t{\n\t\tthis.drawQueue.push (handler);\n\t\treturn this.drawQueue.bottom;\n\t},\n\n\t/**\n\t * Removes the specified draw handler from the system.\n\t * !static drawQueueRemove (handler: { draw: (g: Canvas) => void }) : void;\n\t * violet\n\t */\n\t/**\n\t * Removes the specified draw handler node from the system.\n\t * !static drawQueueRemove (node: Linkable) : void;\n\t */\n\tdrawQueueRemove: function (handler)\n\t{\n\t\tthis.drawQueue.remove (Linkable.isInstance(handler) ? handler : this.drawQueue.sgetNode(handler));\n\t},\n\n\t/**\n\t * Adds the specified handler to the update and draw queues.\n\t * !static queueAdd (handler: { update: (dt: number) => boolean, draw: (g: Canvas) => void }) : void;\n\t * violet\n\t */\n\tqueueAdd: function (handler)\n\t{\n\t\tthis.updateQueue.push (handler);\n\t\tthis.drawQueue.push (handler);\n\t},\n\n\t/**\n\t * Removes the specified handler from the update and draw queues.\n\t * !static queueRemove (handler: { update: (dt: number) => boolean, draw: (g: Canvas) => void }) : void;\n\t * violet\n\t */\n\tqueueRemove: function (handler)\n\t{\n\t\tthis.updateQueue.remove (this.updateQueue.sgetNode(handler));\n\t\tthis.drawQueue.remove (this.drawQueue.sgetNode(handler));\n\t},\n\n\t/**\n\t * Runs an update cycle. All objects in the `updateQueue` will have their `update method called.\n\t */\n\tupdate: function (dt)\n\t{\n\t\ttry\n\t\t{\n\t\t\tlet next;\n\n\t\t\tfor (let elem = this.updateQueue.top; elem; elem = next)\n\t\t\t{\n\t\t\t\tnext = elem.next;\n\n\t\t\t\tif (elem.value.update(dt) === false)\n\t\t\t\t\tthis.updateQueueRemove(elem);\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tSystem.stop();\n\t\t\tthrow e;\n\t\t}\t\n\t},\n\n\t/**\n\t * Runs a rendering cycle. All objects in the `drawQueue` will have their `draw` method called.\n\t */\n\tdraw: function ()\n\t{\n\t\tif (this.renderer.gl !== null)\n\t\t\tthis.renderer.start();\n\n\t\tif (!this.options.overdraw)\n\t\t{\n\t\t\tthis.renderer.clear();\n\t\t\tthis.displayBuffer2.clear();\n\t\t\tthis.displayBuffer3.clear();\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tlet next;\n\n\t\t\tfor (let elem = this.drawQueue.top; elem; elem = next)\n\t\t\t{\n\t\t\t\tnext = elem.next;\n\t\t\t\telem.value.draw(this.renderer);\n\t\t\t}\n\n\t\t\tif (this.renderer.gl !== null)\n\t\t\t{\n\t\t\t\tthis.renderer.flush();\n\t\t\t\tthis.renderer.end();\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tSystem.stop();\n\t\t\tthrow e;\n\t\t}\t\n\t},\n\n\t/**\n\t * Interpolates numeric values between two objects (`src` and `dst`) using the specified `duration` and `easing` function. Note that all four parameters `src`, `dst`,\n\t * `duration` and `easing` must be objects having the same number of values.\n\t * !static interpolate (src: object, dst: object, duration: object, easing: object, callback: (data: object, isFinished: boolean) => void) : void;\n\t */\n\t//VIOLET: Remove this from here.\n\tinterpolate: function (src, dst, duration, easing, callback)\n\t{\n\t\t//violet: not optimized\n\t\tlet time = { };\n\t\tlet data = { };\n\t\tlet count = 0;\n\n\t\tfor (let x in src)\n\t\t{\n\t\t\ttime[x] = 0.0;\n\t\t\tdata[x] = src[x]\n\t\t\tcount++;\n\t\t}\n\n\t\tlet interpolator =\n\t\t{\n\t\t\tupdate: function(dt)\n\t\t\t{\n\t\t\t\tfor (let x in time)\n\t\t\t\t{\n\t\t\t\t\tif (time[x] == duration[x])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\ttime[x] += dt;\n\t\t\t\t\tif (time[x] >= duration[x])\n\t\t\t\t\t{\n\t\t\t\t\t\ttime[x] = duration[x];\n\t\t\t\t\t\tcount--;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet t = easing[x] (time[x] / duration[x]);\n\t\t\t\t\tdata[x] = (1-t)*src[x] + t*dst[x];\n\t\t\t\t}\n\n\t\t\t\tcallback (data, count == 0);\n\n\t\t\t\tif (count == 0)\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t};\n\n\t\tSystem.updateQueueAdd(interpolator);\n\t\tinterpolator.update(0);\n\t},\n\n\t/**\n\t * Event triggered when a keyboard event is detected by the system.\n\t * !static onKeyboardEvent: System.KeyboardEventHandler;\n\t */\n\tonKeyboardEvent: function (action, keyCode, state)\n\t{\n\t\treturn true;\n\t},\n\n\t/**\n\t * Event triggered when a pointer event is detected by the system.\n\t * !static onPointerEvent: System.PointerEventHandler;\n\t */\n\tonPointerEvent: function (action, pointer, pointers)\n\t{\n\t\treturn true;\n\t}\n});\n\n//!/class\n\nexport default System;\n","\nimport System from './system.js';\nimport List from '../utils/list.js';\n\n//![import \"./system\"]\n//![import \"../utils/list\"]\n\n//:/**\n//: * \tLogging module to show logs on the system display buffer.\n//: */\n\n//!namespace Log\n\nconst Log =\n{\n\t/**\n\t * \tIndicates if the log module is enabled.\n\t *\t!let enabled: boolean;\n\t */\n\tenabled: false,\n\n\t/**\n\t * \tIndicates if the log module is paused.\n\t * \t!let paused: boolean;\n\t */\n\tpaused: false,\n\n\t/**\n\t * \tMaximum number of entries to show in the screen.\n\t * \t!let maxsize: number;\n\t */\n\tmaxsize: 30,\n\n\tdata: List.Pool.alloc(),\n\tcount: 0,\n\n\t/**\n\t * \tIndicates if output showuld also be passed to `console.debug` as secondary echo.\n\t * \t!let debugEcho: boolean;\n\t */\n\tdebugEcho: false,\n\n\t/**\n\t * \tForeground (text) color.\n\t * \t!let color: string;\n\t */\n\tcolor: '#fff',\n\n\t/**\n\t * \tBackground color.\n\t * \t!let background: string;\n\t */\n\tbackground: '#cf266a',\n\n\t/**\n\t * \tDebugging variables to show continuously at the top of the log output.\n\t * \t!let vars: object;\n\t */\n\tvars: { },\n\n\t/**\n\t * \tWrites a message to the log buffer, ensure logging has been enabled by calling `enable` first or any messages will be ignored.\n\t * \t!function write (msg: string) : void;\n\t */\n\twrite: function (msg)\n\t{\n\t\tthis.data.push(msg);\n\t\tthis.count++;\n\n\t\twhile (this.data.length > this.maxsize)\n\t\t\tthis.data.shift();\n\n\t\tif (this.debugEcho)\n\t\t\tconsole.debug(this.count + \": \" + msg);\n\t},\n\n\t/**\n\t * \tClears the current log buffer.\n\t * \t!function clear () : void;\n\t */\n\tclear: function ()\n\t{\n\t\tthis.data.reset();\n\t\tthis.count = 0;\n\t},\n\n\t/**\n\t * \tEnables on-screen logging for cool stuff.\n\t *\n\t * \t@param x - X-coordinate of the top-left corner.\n\t * \t@param y - Y-coordinate of the top-left corner.\n\t * \t@param fontSize - Desired font size in `pt` units.\n\t * \t@param showFps - Set to `true` to show FPS.\n\t * \t@param showIndex - Set to `true to show the message index.\n\t *\n\t * \t!function enable (x?: number, y?: number, fontSize?: number, showFps?: boolean, showIndex?: boolean) : void;\n\t */\n\tenable: function (x=0, y=0, fontSize=9.5, showFps=true, showIndex=true)\n\t{\n\t\tif (this.enabled) return;\n\t\tthis.enabled = true;\n\n\t\tif (!showFps) y -= 16;\n\t\tlet _y = y;\n\n\t\tSystem.drawQueueAdd ({ draw: function ()\n\t\t{\n\t\t\tif (Log.paused) return;\n\n\t\t\tlet tmp = hrnow();\n\n\t\t\tconst g = System.displayBuffer3;\n\n\t\t\tg.font('bold '+fontSize+'pt Monospace');\n\t\t\tg.textBaseline('top');\n\n\t\t\tlet s = '';\n\n\t\t\ty = _y;\n\n\t\t\tif (showFps !== false && System.perf.fps != 0)\n\t\t\t{\n\t\t\t\t//s = 'fps: ' + System.perf.fps + '/' + System.perf.averageFps + ', update: ' + System.perf.averageUpdateTime + ', draw: ' + System.perf.averageDrawTime /*+ ', extra: ' + System.perf.averageExtraTime*/ + ', frame: ' + System.perf.averageFrameTime;\n\t\t\t\ts = 'fps: ' + System.perf.fps + '/' + System.perf.averageFps + ', update:' + System.perf.averageUpdateTime + ', draw:' + System.perf.averageDrawTime + ', frame:' + System.perf.averageFrameTime;\n\n\t\t\t\tif (Log.background) {\n\t\t\t\t\tg.fillStyle(Log.background);\n\t\t\t\t\tg.fillRect (x-3, y-1, g.measureText(s)+6, fontSize+5);\n\t\t\t\t}\n\n\t\t\t\tg.fillStyle(Log.color);\n\t\t\t\tg.fillText(s, x, y);\n\t\t\t}\n\n\t\t\ts = '';\n\n\t\t\tfor (let i in Log.vars)\n\t\t\t\ts += i + ': ' + Log.vars[i] + '  ';\n\n\t\t\tif (s !== '')\n\t\t\t{\n\t\t\t\ty += 24;\n\n\t\t\t\tif (Log.background) {\n\t\t\t\t\tg.fillStyle(Log.background);\n\t\t\t\t\tg.fillRect (x-3, y-1, g.measureText(s)+6, fontSize+5);\n\t\t\t\t}\n\n\t\t\t\tg.fillStyle(Log.color);\n\t\t\t\tg.fillText(s, x, y);\n\t\t\t}\n\n\t\t\tlet i = 0;\n\t\t\tfor (let ii = Log.data.top; ii; ii = ii.next, i++)\n\t\t\t{\n\t\t\t\ts = (showIndex ? \"#\" + (Log.count-Log.data.length+i+1) + \": \" : \"> \") + ii.value;\n\n\t\t\t\tif (Log.background) {\n\t\t\t\t\tg.fillStyle(Log.background);\n\t\t\t\t\tg.fillRect (x-3, y-1+7 + (fontSize+5)*(i+1) - 1, g.measureText(s)+6, fontSize+5);\n\t\t\t\t}\n\n\t\t\t\tg.fillStyle(Log.color);\n\t\t\t\tg.fillText(s, x, y-1+7 + (fontSize+5)*(i+1));\n\t\t\t}\n\n\t\t\ttmp = (hrnow() - tmp);\n\t\t\tSystem.perf.drawTimeTotal -= tmp;\n\t\t\tSystem.perf.extraTimeTotal += tmp;\n\t\t}});\n\t},\n\n\t/**\n\t * \tPauses log rendering.\n\t * \t!function pause () : void;\n\t */\n\tpause: function ()\n\t{\n\t\tthis.paused = true;\n\t\treturn;\n\t},\n\n\t/**\n\t * \tResumes log rendering.\n\t * \t!function resume () : void;\n\t */\n\tresume: function ()\n\t{\n\t\tthis.paused = false;\n\t\treturn;\n\t}\n};\n\nexport default Log;\n","\nimport Random from './random.js';\nimport Log from './log.js';\n\n//![import \"./random\"]\n//![import \"./log\"]\n//![import \"../flow/viewport\"]\n\n//:/**\n//: * \tGlobal functions and definitions.\n//: */\n\n//!namespace globals\n\n/*\n**\tVariables and behavior flags, can be extended as needed from other modules.\n*/\nconst globals =\n{\n\t/**\n\t * Renderer's GL context.\n\t * !let gl: WebGL2RenderingContext;\n\t */\n\tgl: null,\n\n\t/**\n\t * Global system time, updated once per frame. Mirrors the `System.frameTime` property.\n\t * !let time: number;\n\t */\n\ttime: 0,\n\n\t/**\n\t * Active viewport (if any). Set by the `draw` method of the `Scene` class.\n\t * !let viewport: Viewport;\n\t */\n\tviewport: null,\n\n\t/**\n\t * Indicates if the element bounds should be drawn. Used by the `Element` class.\n\t * !let debugBounds: boolean;\n\t */\n\tdebugBounds: false,\n\n\t/**\n\t * Indicates if the mask bounds should be drawn. Used by the `Mask` class.\n\t * !let debugMasks: boolean;\n\t */\n\tdebugMasks: false,\n\n\t/**\n\t * Global random generators. Only `rand0` is used by the global random functions. The `rand1` and `rand2` can be used manually if desired.\n\t *\n\t * !const rand0: Random;\n\t * !const rand1: Random;\n\t * !const rand2: Random;\n\t */\n\trand0: new Random(),\n\trand1: new Random(),\n\trand2: new Random()\n}\n\nexport default globals;\n\n//!/namespace\n\n//!declare global\n\n/**\n * Converts the given pixel-value to actual screen pixels taking into account the current scale.\n * !function px (value: number) : number;\n */\nglobal.px = function(value)\n{\n\treturn value*C.SCALE;\n}\n\n/**\n * Disposes an object by running the first method that is found in the following order: `free`, `dispose` and finally `__dtor`.\n * !function dispose (obj: object) : void;\n */\nglobal.dispose = function (obj)\n{\n\tif (obj === null || typeof(obj) !== 'object')\n\t\treturn;\n\n\tif ('free' in obj)\n\t\treturn obj.free();\n\n\tif ('dispose' in obj)\n\t\treturn obj.dispose();\n\n\tif ('__dtor' in obj)\n\t\tobj.__dtor();\n}\n\n/**\n * Global audio context obtained when the system is initialized.\n * !let audioContext: AudioContext;\n */\nif ('AudioContext' in global)\n{\n\tglobal.audioContext = new AudioContext({ latencyHint: 'interactive', sampleRate: 44100 });\n\tLog.write('AudioContext: baseLatency=' + ~~(global.audioContext.baseLatency*1000) + ' ms' );\n}\nelse\n\tglobal.audioContext = null;\n\n/**\n * Similar to `fetch` but uses XMLHttpRequest because in some mobile browsers regular mode does not work well with ArrayBuffers.\n * !function fetchd (url: string, options?: object) : Promise<object>;\n */\nglobal.fetchd = function (url, options)\n{\n\treturn new Promise ((resolve, reject) =>\n\t{\n\t\tif (!options) options = { };\n\t\tif (!('responseType' in options)) options.responseType = 'arraybuffer';\n\n\t\tlet request = new XMLHttpRequest();\n\t\trequest.open('GET', url, true);\n\n\t\tfor (let i in options) request[i] = options[i];\n\n\t\trequest.onload = function() {\n\t\t\tresolve (request.response);\n\t\t};\n\n\t\trequest.onerror = function() {\n\t\t\treject ('Unable to fetch specified resource.');\n\t\t};\n\n\t\trequest.send();\n\t});\n}\n\n/**\n * Loads an arraybuffer from the specified URL and converts it to a AudioBuffer using the global audioContext.\n * !function fetchAudioBuffer (url: string) : Promise<AudioBuffer>;\n */\nglobal.fetchAudioBuffer = function (url)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tif (!global.audioContext)\n\t\t{\n\t\t\treject ('AudioContext is not available.');\n\t\t\treturn;\n\t\t}\n\n\t\tfetchd(url)\n\t\t.then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))\n\t\t.then(audioBuffer => resolve(audioBuffer))\n\t\t.catch(err => reject(err));\n\t});\n}\n\n/**\n * Returns the value as an integer.\n * !function int (value: number|string) : number;\n */\nglobal.int = function (value)\n{\n\treturn value >> 0;\n}\n\n/**\n * Returns the value as a boolean.\n * !function bool (value: number|string|boolean) : number;\n */\nglobal.bool = function (value)\n{\n\tif (value === true || value === false)\n\t\treturn value;\n\n\tif (value == 'true')\n\t\treturn true;\n\n\tif (value == 'false')\n\t\treturn false;\n\n\treturn !(!value);\n}\n\n/**\n * Returns the value as a floating point number.\n * !function float (value: number|string) : number;\n */\nglobal.float = function (value)\n{\n\treturn parseFloat(value);\n}\n\n/**\n * Returns the value truncated to 2 digits of precision.\n * !function float2 (value: number) : number;\n */\nglobal.float2 = function (value)\n{\n\treturn (int(value*100))/100;\n}\n\n/**\n * Returns the value truncated to 3 digits of precision.\n * !function float3 (value: number) : number;\n */\nglobal.float3 = function (value)\n{\n\treturn (int(value*1000))/1000;\n}\n\n/**\n * Returns the value truncated to 4 digits of precision.\n * !function float4 (value: number) : number;\n */\nglobal.float4 = function (value)\n{\n\treturn (int(value*10000))/10000;\n}\n\n/**\n * Converts the given value from degrees to radians.\n * !function rad (degrees: number) : number;\n */\nglobal.rad = function (degrees)\n{\n\treturn degrees*Math.PI/180.0;\n}\n\n/**\n * Converts the given value from radians to degrees.\n * !function deg (radians: number) : number;\n */\nglobal.deg = function (radians)\n{\n\treturn (radians/Math.PI)*180;\n}\n\n/**\n * Returns a random integer value from 0 to 0xFFFF (inclusive).\n * !function rand() : number;\n */\nglobal.rand = function ()\n{\n\treturn globals.rand0.nextInt16();\n}\n\n/**\n * Returns a random float from 0 to 1 (inclusive).\n * !function randf() : number;\n */\nglobal.randf = function ()\n{\n\treturn globals.rand0.nextFloat();\n}\n\n/**\n * Returns a random float within the given (inclusive) range.\n * !function randrf (startValue: number, endValue: number) : number;\n */\nglobal.randrf = function (a, b)\n{\n\tlet t = globals.rand0.nextFloat();\n\treturn t*b + (1-t)*a;\n}\n\n/**\n * Returns a random integer within the given range (inclusive).\n * !function randr (startValue: number, endValue: number) : number;\n */\nglobal.randr = function (a, b)\n{\n\tlet t = globals.rand0.nextFloat();\n\treturn Math.round(t*b + (1-t)*a);\n}\n\n/**\n * Returns a table (array) of N random integer numbers within the given range (inclusive). Ensures that the resulting\n * table has an even distribution.\n * !function randt (startValue: number, endValue: number, n: number, removeSubsequent?: boolean) : Array<number>;\n */\nglobal.randt = function (a, b, n, removeSubsequent=true)\n{\n\tlet table = [ ];\n\n\t// Generate numbers in order to even-out the probability of each.\n\tlet k = a;\n\tfor (let i = 0; i < n; i++, k++)\n\t{\n\t\ttable.push(k);\n\t\tif (k+1 > b) k = a-1;\n\t}\n\n\t// Shuffle the table.\n\tconst m = n >>> 1;\n\tfor (let i = 0; i < m; i++)\n\t{\n\t\ta = randr(i+1, n-1);\n\n\t\tlet tmp = table[i];\n\t\ttable[i] = table[a];\n\t\ttable[a] = tmp;\n\t}\n\n\t// Remove subsequent duplicates.\n\tif (!removeSubsequent) return table;\n\n\tlet j = n-1;\n\tfor (let i = 1; i < n; i++)\n\t{\n\t\tif (table[i] !== table[i-1])\n\t\t\tcontinue;\n\n\t\twhile(table[i] === table[j])\n\t\t{\n\t\t\tif (--j < 0) {\n\t\t\t\tj = n-1;\n\t\t\t\tconsole.log('!!');\n\t\t\t}\n\t\t}\n\n\t\tlet tmp = table[i];\n\t\ttable[i] = table[j];\n\t\ttable[j] = tmp;\n\t}\n\n\treturn table;\n}\n\n/**\n * Returns a table (array) of N random float numbers within the given range (inclusive).\n * !function randtf (startValue: number, endValue: number, n: number) : Array<number>;\n */\nglobal.randtf = function (a, b, n)\n{\n\tvar list = [ ];\n\n\tfor (var i = 0; i < n; i++)\n\t\tlist.push(randrf(a, b));\n\n\treturn list;\n}\n\n/**\n * Returns the high-resolution `now` counter in milliseconds (includes possibly microseconds in fractional part).\n * !function hrnow () : number;\n */\nglobal.hrnow = function ()\n{\n\treturn performance.now();\n}\n\n/**\n * Returns a function that when called produces a random integer value within the given (inclusive) range.\n * !function randvar (startValue: number, endValue: number) : () => number;\n */\nglobal.randvar = function (a, b)\n{\n\treturn function() { return randr(a, b); };\n}\n\n/**\n * Returns a function that when called returns an item from the specified array at some random index within the (inclusive) range.\n * !function randitem (arr: Array<any>, startValue?: number, endValue?: number) : () => any;\n */\nglobal.randitem = function (arr, a=null, b=null)\n{\n\tif (a === null) a = 0;\n\tif (b === null) b = arr.length - 1;\n\n\treturn function() { return arr[randr(a, b)]; };\n}\n\n/**\n * Returns the parameter 't' where two line segments intersect.\n * !function getLineSegmentIntersection (ls1_x1: number, ls1_y1: number, ls1_x2: number, ls1_y2: number, ls2_x1: number, ls2_y1: number, ls2_x2: number, ls2_y2: number) : number;\n */\nglobal.getLineSegmentIntersection = function (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2)\n{\n\t// Case #1: Identical segments.\n\tif (ls1_x1 == ls2_x1 && ls1_y1 == ls2_y1 && ls1_x2 == ls2_x2 && ls1_y2 == ls2_y2)\n\t\treturn 0;\n\n\tlet inf = 2.0;\n\n\tvar dyA = ls1_y2 - ls1_y1;\n\tvar dxA = ls1_x2 - ls1_x1;\n\tvar dyB = ls2_y2 - ls2_y1;\n\tvar dxB = ls2_x2 - ls2_x1;\n\n\t// Case #2: Horizontal vs. Horizontal\n\tif (dyA == 0 && dyB == 0)\n\t{\n\t\tif (ls1_y1 != ls2_y1) return inf;\n\n\t\tvar x1 = Math.max(ls1_x1, ls2_x1);\n\t\tvar x2 = Math.min(ls1_x2, ls2_x2);\n\n\t\tif (x1 > x2) return inf;\n\n\t\treturn (x1 - ls1_x1) / dxA;\n\t}\n\n\t// Case #3: Vertical vs. Vertical\n\tif (dxA == 0 && dxB == 0)\n\t{\n\t\tif (ls1_x1 != ls2_x1) return inf;\n\n\t\tvar y1 = Math.max(ls1_y1, ls2_y1);\n\t\tvar y2 = Math.min(ls1_y2, ls2_y2);\n\n\t\tif (y1 > y2) return inf;\n\n\t\treturn (y1 - ls1_y1) / dyA;\n\t}\n\n\t// Case #4: Vertical vs. Horizontal or Sloped\n\tif (dxA == 0)\n\t{\n\t\tvar tA = (dyB*(ls1_x1 - ls2_x1) + dxB*(ls2_y1 - ls1_y1)) / (dxB * dyA);\n\t\tif (0 > tA || tA > 1) return inf;\n\n\t\tvar tB = (ls1_x1 - ls2_x1) / dxB; \n\t\tif (0 > tB || tB > 1) return inf;\n\n\t\treturn tA;\n\t}\n\n\t// Case #5: Regular line segments.\n\tvar a = dyA*(ls2_x1 - ls1_x1) + dxA*(ls1_y1 - ls2_y1);\n\tvar b = dyB*dxA - dxB*dyA;\n\n\tif (b == 0) return inf;\n\n\tvar tB = a / b;\n\tif (0 > tB || tB > 1) return inf;\n\n\tvar tA = (dxB*tB + ls2_x1 - ls1_x1) / dxA;\n\tif (0 > tA || tA > 1) return inf;\n\n\treturn tA;\n}\n\n/**\n * Returns boolean indicating if the line segments intersect.\n * !function lineSegmentIntersects (ls1_x1: number, ls1_y1: number, ls1_x2: number, ls1_y2: number, ls2_x1: number, ls2_y1: number, ls2_x2: number, ls2_y2: number) : boolean;\n */\nglobal.lineSegmentIntersects = function (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2)\n{\n\tlet t = getLineSegmentIntersection (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2);\n\treturn t >= 0 && t <= 1.0;\n}\n\n/**\n * Rotates a point by the given angle.\n * !function rotatePoint (angle: number, x: number, y: number) : { x: number, y: number };\n */\n/**\n * Rotates a point by the given angle along the given center.\n * !function rotatePoint (angle: number, x: number, y: number, cx: number, cy: number) : { x: number, y: number };\n */\nglobal.rotatePoint = function (angle, x, y, cx=0, cy=0)\n{\n\treturn {\n\t\tx: cx + (x-cx)*Math.cos(angle) + (y-cy)*Math.sin(angle),\n\t\ty: cy + (y-cy)*Math.cos(angle) - (x-cx)*Math.sin(angle)\n\t};\n}\n\n/**\n * Returns a value snapped to a step within the given range.\n * !function stepValue (value: number, minValue: number, maxValue: number, numSteps: number) : number;\n */\nglobal.stepValue = function (value, minValue, maxValue, numSteps)\n{\n\treturn ((Math.round(numSteps * (value - minValue) / (maxValue - minValue))) / numSteps) * (maxValue - minValue) + minValue;\n}\n\n/**\n * Returns a value that is a factor of the specified step.\n * !function alignValue (value: number, step: number) : number;\n */\nglobal.alignValue = function (value, step)\n{\n\treturn Math.round(value/step)*step;\n}\n\n/**\n * Number of bits for fixed-point number (default is 8).\n * !let FIXED_POINT_BITS : number;\n*/\nglobal.FIXED_POINT_BITS = 8;\n\n/**\n * Returns a fixed-point upscaled value.\n * !function upscale (value: number) : number;\n */\nglobal.upscale = function (value)\n{\n\treturn (value * (1 << FIXED_POINT_BITS)) >> 0;\n}\n\n/**\n * Downscales a fixed-point value to its integer part.\n * !function downscale (value: number) : number;\n */\nglobal.downscale = function (value)\n{\n\treturn value >> FIXED_POINT_BITS;\n}\n\n/**\n * Downscales a fixed-point value to floating point.\n * !function downscalef (value: number) : number;\n */\nglobal.downscalef = function (value)\n{\n\treturn value / (1 << FIXED_POINT_BITS);\n}\n\n/**\n * Aligns a value to its fixed point floating point representation such that downscaling results in an integer.\n * !function falign (value: number) : number;\n */\nglobal.falign = function (value)\n{\n\treturn downscalef(upscale(value));\n}\n\n/**\n * Returns the fractional part of a value.\n * !function fract (value: number) : number;\n */\nglobal.fract = function(value)\n{\n\treturn value - (~~value);\n}\n\n/**\n * Returns the value having the minimum absolute value.\n * !function absmin (a: number, b: number) : number;\n */\nglobal.absmin = function(a, b)\n{\n\treturn Math.abs(a) < Math.abs(b) ? a : b;\n}\n\n/**\n * Returns the value having the maximum absolute value.\n * !function absmax (a: number, b: number) : number;\n */\nglobal.absmax = function(a, b)\n{\n\treturn Math.abs(a) > Math.abs(b) ? a : b;\n}\n\n/**\n * Repeats a string a number of times.\n * !function repeat (str: string, count: number) : string;\n */\nglobal.repeat = function (str, count)\n{\n\tlet out = '';\n\n\twhile (count-- > 0)\n\t\tout += str;\n\n\treturn out;\n}\n\n/**\n * Pads the given value with a character (added to the left) until the specified size is reached.\n * !function lpad (val: any, size: number, char?: string) : string;\n */\nglobal.lpad = function (val, size, char='0')\n{\n\tval = val.toString();\n\treturn repeat(char.charAt(0), size-val.length) + val;\n}\n\n/**\n * Pads the given value with a character (added to the right) until the specified size is reached.\n * !function rpad (val: any, size: number, char?: string) : string;\n */\nglobal.rpad = function (val, size, char='0')\n{\n\tval = val.toString();\n\treturn val + repeat(char.charAt(0), size-val.length);\n}\n\n/**\n * Returns the normalized (0 to 1) value for the given signed-normalized (-1 to 1) value.\n * !function norm (value: number) : number;\n */\nglobal.norm = function (value)\n{\n\treturn (value + 1.0) * 0.5;\n}\n\n/**\n * Returns the signed-normalized (-1 to 1) value for the given normalized (0 to 1) value.\n * !function snorm (value: number) : number;\n */\nglobal.snorm = function (value)\n{\n\treturn value * 2.0 - 1.0;\n}\n\n/**\n * Clamps the specified value to the [x0, x1] range.\n * !function clamp (value: number, x0?: number, x1?: number) : number;\n */\nglobal.clamp = function (value, x0=0.0, x1=1.0)\n{\n\treturn value < x0 ? x0 : (value > x1 ? x1 : value);\n}\n\n/**\n * Maps the given value from [a0, a1] to [b0, b1].\n * !function map (value: number, a0: number, a1: number, b0: number, b1: number) : number;\n */\nglobal.map = function (value, a0, a1, b0, b1)\n{\n\treturn ((value - a0)*(b1 - b0) / (a1 - a0)) + b0;\n}\n\n/**\n * Performs a linear interpolation between `x` and `y` using `a` to weight between them. The return value is computed as x*(1a)+y*a.\n * !function mix (x: number, y: number, a: number) : number;\n */\nglobal.mix = function (x, y, a)\n{\n\treturn x*(1-a) + y*a;\n}\n","\n//!class Perf\n\n/**\n * \tInitializes the performance monitoring instance.\n *\n * \t@param accumSize - Maximum amount of samples to accumulate.\n * \t@param expectedValue - Expected value (average) of resulting samples.\n * \n * \t!constructor (accumSize: number, expectedValue?: number);\n */\nconst Perf = function (accumSize, expectedValue=null)\n{\n\tthis.data = [ ];\n\tthis.accumSize = accumSize;\n\n\tthis.expectedValue = expectedValue;\n\n\tthis.lastFeed = 0;\n\tthis.lastUpdate = 0;\n\n\tthis.stdSum = 0;\n\tthis.stdCount = 0;\n};\n\nexport default Perf;\n\n/**\n * \tMarks the start time of a performance test.\n * \t!begin() : void;\n */\nPerf.prototype.begin = function () {\n\tthis.startTime = performance.now();\n};\n\n/**\n * \tMarks the end time of the performance test, the elapsed time is fed into the monitor.\n * \t!end() : void;\n */\nPerf.prototype.end = function () {\n\tthis.feed (performance.now() - this.startTime);\n};\n\n/**\n * \tFeeds a value into the monitor, auto-generates a report using `console.log` when the number of samples reaches the `accumSize` specified in the constructor.\n * \t!feed (value: number) : void;\n */\nPerf.prototype.feed = function (value)\n{\n\tthis.data.push(value);\n\tthis.lastFeed++;\n\n\tif (this.data.length != this.accumSize)\n\t\treturn;\n\n\tthis.report();\n\tthis.data = [ ];\n};\n\n/**\n * \tUpdates the `min`, `max`, `avg` `std`, `stdSum` and `stdCount` fields of the object.\n * \t!update () : void;\n */\nPerf.prototype.update = function ()\n{\n\tlet min = null;\n\tlet max = null;\n\tlet avg = 0;\n\tlet std = 0;\n\n\tfor (let i = 0; i < this.data.length; i++)\n\t{\n\t\tmin = min === null ? this.data[i] : Math.min(min, this.data[i]);\n\t\tmax = max === null ? this.data[i] : Math.max(max, this.data[i]);\n\t\tavg += this.data[i];\n\t}\n\n\tavg /= this.data.length;\n\n\tlet e = this.expectedValue !== null ? this.expectedValue : avg;\n\n\tfor (let i = 0; i < this.data.length; i++) std += Math.pow(this.data[i] - e, 2);\n\n\tstd = Math.sqrt(std / this.data.length);\n\n\tthis.stdSum += std;\n\tthis.stdCount++;\n\n\tthis.min = min;\n\tthis.max = max;\n\tthis.avg = avg;\n\tthis.std = std;\n\n\tthis.lastUpdate = this.lastFeed;\n\treturn this;\n};\n\n/**\n * \tReturns a report string with the values selected by the specified flags.\n * \t!report (flags: Perf.Flags) : string;\n */\nPerf.prototype.report = function (flags=255)\n{\n\tlet out = '';\n\n\tif (this.lastUpdate != this.lastFeed)\n\t\tthis.update();\n\n\tif (flags & Perf.Flags.SAMPLES) out += 'n: ' + this.stdCount;\n\tif (flags & Perf.Flags.MIN) out += (out != '' ? ', ' : '') + 'min: ' + this.min;\n\tif (flags & Perf.Flags.MAX) out += (out != '' ? ', ' : '') + 'max: ' + this.max;\n\tif (flags & Perf.Flags.AVG) out += (out != '' ? ', ' : '') + 'avg: ' + this.avg.toFixed(2);\n\tif (flags & Perf.Flags.EXPECTED) out += (out != '' ? ', ' : '') + (this.expectedValue !== undefined ? 'e: ' + this.expectedValue : '');\n\tif (flags & Perf.Flags.STDDEV) out += (out != '' ? ', ' : '') + 'stddev: ' + this.std.toFixed(2);\n\tif (flags & Perf.Flags.AVG_STDDEV) out += (out != '' ? ', ' : '') + 'avg_stddev: ' + (this.stdSum / this.stdCount).toFixed(2)\n\n\treturn out;\n};\n\n//!/class\n\n//!namespace Perf\n//!enum Flags\n\nPerf.Flags = {\n\tSAMPLES: 1,\n\t//!SAMPLES\n\tMIN: 2,\n\t//!MIN\n\tMAX: 4,\n\t//!MAX\n\tAVG: 8,\n\t//!AVG\n\tEXPECTED: 16,\n\t//!EXPECTED\n\tSTDDEV: 32,\n\t//!STDDEV\n\tAVG_STDDEV: 64,\n\t//!AVG_STDDEV\n\tALL: 255,\n\t//!ALL\n};\n\n//!/enum\n","\nimport { Class } from 'rinn';\nimport globals from './globals.js';\nimport System from './system.js';\n\n//![import \"./globals\"]\n//![import \"./system\"]\n\n/*\n *\tDescribes a GL framebuffer.\n */\n\nconst Framebuffer = Class.extend\n({\n\t/**\n\t *\tShader GL identifier.\n\t */\n\tframebufferId: null,\n\n\t/**\n\t *\tAttachments of the framebuffer.\n\t */\n\tattachments: null,\n\n\t/**\n\t *\tType of each attachment.\n\t */\n\tattachmentTypes: null,\n\n\t/**\n\t *\tWidth of the framebuffer.\n\t */\n\twidth: 0,\n\n\t/**\n\t *\tHeight of the framebuffer.\n\t */\n\theight: 0,\n\n\t/**\n\t *\tEnabled draw buffers.\n\t */\n\tdrawBuffers: null,\n\tdrawBufferIds: null,\n\n\t/**\n\t *\tConstructs a GL framebuffer.\n\t *\n\t * \t@param {number} width\n\t * \t@param {number} height\n\t */\n\t__ctor: function (width=null, height=null)\n\t{\n\t\tif (globals.gl === null)\n\t\t\treturn;\n\n\t\tif (attachmentPointIds[0] === null)\n\t\t\tinitAttachmentPointIds(globals.gl);\n\n\t\tthis.framebufferId = globals.gl.createFramebuffer();\n\n\t\tthis.drawBuffers = [];\n\t\tthis.drawBufferIds = [];\n\n\t\t//violet:hardware scaling\n\t\t//this.width = width || System.screenWidth;\n\t\t//this.height = height || System.screenHeight;\n\n\t\tthis.width = width || System.renderer.width;\n\t\tthis.height = height || System.renderer.height;\n\n\t   \tthis.attachments = new Array(Framebuffer.MAX_ATTACHMENT_POINTS).fill(null);\n\t   \tthis.attachmentTypes = new Array(Framebuffer.MAX_ATTACHMENT_POINTS).fill(null);\n\t},\n\n\t/**\n\t * \tDestroys the framebuffer and all attached textures.\n\t */\n\t__dtor: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return;\n\n\t\tfor (let i = 0; i < this.attachments.length; i++)\n\t\t{\n\t\t\tif (this.attachments[i] !== null)\n\t\t\t{\n\t\t\t\tif (this.attachmentTypes[i] === Framebuffer.TEXTURE)\n\t\t\t\t\tgl.deleteTexture(this.attachments[i]);\n\t\t\t\telse\n\t\t\t\t\tgl.deleteRenderbuffer(this.attachments[i]);\n\t\t\t}\n\t\t}\n\n\t\tgl.deleteFramebuffer(this.frameBufferId);\n\t},\n\n\t/**\n\t * \tAttaches a texture to a framebuffer attachment point.\n\t *\n\t * \t@param {number} attachmentPoint\n\t * \t@param {any} texture\n\t * \t@param {number} type\n\t */\n\tattach: function (attachmentPoint, texture, type=null)\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return;\n\n\t\tif (type === null)\n\t\t\ttype = attachmentPoint < Framebuffer.DEPTH ? Framebuffer.TEXTURE : Framebuffer.RENDERBUFFER;\n\n\t\tthis.attachments[attachmentPoint] = texture;\n\t\tthis.attachmentTypes[attachmentPoint] = type;\n\n\t\tif (attachmentPoint < Framebuffer.DEPTH && this.drawBuffers.indexOf(attachmentPoint) === -1)\n\t\t{\n\t\t\tthis.drawBuffers.push(attachmentPoint);\n\t\t\tthis.drawBufferIds.push(attachmentPointIds[attachmentPoint]);\n\t\t}\n\n\t\tlet prev = gl.getParameter(gl.FRAMEBUFFER_BINDING);\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, this.framebufferId);\n\n\t\tswitch (type)\n\t\t{\n\t\t\tcase Framebuffer.TEXTURE:\n\t\t\t\tgl.framebufferTexture2D (gl.FRAMEBUFFER, attachmentPointIds[attachmentPoint], gl.TEXTURE_2D, texture, 0);\n\t\t\t\tbreak;\n\n\t\t\tcase Framebuffer.RENDERBUFFER:\n\t\t\t\tgl.framebufferRenderbuffer (gl.FRAMEBUFFER, attachmentPointIds[attachmentPoint], gl.RENDERBUFFER, texture);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, prev);\n\t},\n\n\t/**\n\t * \tCreates a new color buffer texture.\n\t *\n\t * \t@param {number} width\n\t * \t@param {number} height\n\t * \t@returns {GLTexture}\n\t */\n\tcreateColorBuffer: function (attachmentPoint, width=null, height=null)\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return null;\n\n\t\tif (width === null) width = this.width;\n\t\tif (height === null) height = this.height;\n\n\t\tlet tex = gl.createTexture();\n\t\tgl.bindTexture (gl.TEXTURE_2D, tex);\n\n\t\tgl.texStorage2D (gl.TEXTURE_2D, 1, gl.RGBA8, width, height);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n\t\tthis.attach(attachmentPoint, tex);\n\t\treturn tex;\n\t},\n\n\t/**\n\t * \tCreates a new depth buffer texture.\n\t *\n\t * \t@param {number} width\n\t * \t@param {number} height\n\t * \t@returns {GLTexture}\n\t */\n\tcreateDepthBuffer: function (width=null, height=null)\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return null;\n\n\t\tif (width === null) width = this.width;\n\t\tif (height === null) height = this.height;\n\n\t\tlet tex = gl.createRenderbuffer();\n\t\tgl.bindRenderbuffer (gl.RENDERBUFFER, tex);\n\t\tgl.renderbufferStorage (gl.RENDERBUFFER, gl.DEPTH_COMPONENT24, width, height);\n\n\t\tthis.attach(Framebuffer.DEPTH, tex);\n\t\treturn tex;\n\t},\n\n\t/**\n\t * \tCreates a new stencil buffer texture.\n\t *\n\t * \t@param {number} width\n\t * \t@param {number} height\n\t * \t@returns {GLTexture}\n\t */\n\tcreateStencilBuffer: function (width=null, height=null)\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return null;\n\n\t\tif (width === null) width = this.width;\n\t\tif (height === null) height = this.height;\n\n\t\tlet tex = gl.createTexture();\n\t\tgl.bindTexture (gl.TEXTURE_2D, tex);\n\n\t\tgl.texStorage2D (gl.TEXTURE_2D, 1, gl.DEPTH_STENCIL, width, height);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n\t\tthis.attach(Framebuffer.DEPTH_STENCIL, tex);\n\t\treturn tex;\n\t},\n\n\t/**\n\t * \tReturns a texture from the specified attachment point.\n\t * \t@param {number} attachmentPoint \n\t */\n\tgetTexture: function (attachmentPoint)\n\t{\n\t\tif (this.attachmentTypes[attachmentPoint] !== Framebuffer.TEXTURE)\n\t\t\treturn null;\n\n\t\treturn this.attachments[attachmentPoint];\n\t},\n\n\t/**\n\t * \tReturns a renderbuffer from the specified attachment point.\n\t * \t@param {number} attachmentPoint \n\t */\n\tgetRenderBuffer: function (attachmentPoint)\n\t{\n\t\tif (this.attachmentTypes[attachmentPoint] !== Framebuffer.RENDERBUFFER)\n\t\t\treturn null;\n\n\t\treturn this.attachments[attachmentPoint];\n\t},\n\n\t/**\n\t *\tBinds the framebuffer for further operations.\n\t */\n\tbind: function()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return;\n\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, this.framebufferId);\n\n\t\tgl.drawBuffers (this.drawBufferIds);\n\t\tgl.viewport (0, 0, this.width, this.height);\n\t},\n\n\t/**\n\t *\tBinds the default framebuffer.\n\t */\n\tunbind: function()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return;\n\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, null);\n\n\t\tgl.drawBuffers (defaultDrawBuffers);\n\t\tgl.viewport (0, 0, System.renderer.width, System.renderer.height);\n\t},\n\n\t/**\n\t *\tReturns the status of the framebuffer. Returns true if the framebuffer is complete.\n\t */\n\tisComplete: function()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return true;\n\n\t\tlet prev = gl.getParameter(gl.FRAMEBUFFER_BINDING);\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, this.framebufferId);\n\t\tlet result = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, prev);\n\n\t\treturn result === gl.FRAMEBUFFER_COMPLETE;\n\t}\n\n});\n\n/**\n *\tTypes of attachment objects.\n */\nFramebuffer.TEXTURE = 1;\nFramebuffer.RENDERBUFFER = 2;\n\n/**\n *\tAvailable attachment points.\n */\nFramebuffer.COLOR0\t\t\t= 0;\nFramebuffer.COLOR1\t\t\t= 1;\nFramebuffer.COLOR2\t\t\t= 2;\nFramebuffer.COLOR3\t\t\t= 3;\nFramebuffer.COLOR4\t\t\t= 4;\nFramebuffer.COLOR5\t\t\t= 5;\nFramebuffer.COLOR6\t\t\t= 6;\nFramebuffer.COLOR7\t\t\t= 7;\nFramebuffer.DEPTH \t\t\t= 8;\nFramebuffer.STENCIL \t\t= 9;\nFramebuffer.DEPTH_STENCIL\t= 10;\n\nFramebuffer.MAX_ATTACHMENT_POINTS = 11;\n\n/**\n *\tGL framebuffer attachment point IDs.\n */\nconst attachmentPointIds = new Array(Framebuffer.MAX_ATTACHMENT_POINTS).fill(null);\nconst defaultDrawBuffers = new Array(1).fill(null);\n\n/**\n * \tInitializes the attachment point IDs.\n */\nconst initAttachmentPointIds = function (gl)\n{\n\tdefaultDrawBuffers[0] = gl.BACK;\n\n\tattachmentPointIds[Framebuffer.COLOR0] = gl.COLOR_ATTACHMENT0;\n\tattachmentPointIds[Framebuffer.COLOR1] = gl.COLOR_ATTACHMENT1;\n\tattachmentPointIds[Framebuffer.COLOR2] = gl.COLOR_ATTACHMENT2;\n\tattachmentPointIds[Framebuffer.COLOR3] = gl.COLOR_ATTACHMENT3;\n\tattachmentPointIds[Framebuffer.COLOR4] = gl.COLOR_ATTACHMENT4;\n\tattachmentPointIds[Framebuffer.COLOR5] = gl.COLOR_ATTACHMENT5;\n\tattachmentPointIds[Framebuffer.COLOR6] = gl.COLOR_ATTACHMENT6;\n\tattachmentPointIds[Framebuffer.COLOR7] = gl.COLOR_ATTACHMENT7;\n\tattachmentPointIds[Framebuffer.DEPTH] = gl.DEPTH_ATTACHMENT;\n\tattachmentPointIds[Framebuffer.STENCIL] = gl.STENCIL_ATTACHMENT;\n\tattachmentPointIds[Framebuffer.DEPTH_STENCIL] = gl.DEPTH_STENCIL_ATTACHMENT;\n};\n\nexport default Framebuffer;\n","\nimport { Rinn, Class } from 'rinn';\n\n//:/**\n//: * \tDescribes an object that can be drawn to a Canvas.\n//: */\n\n//!class Drawable\n\nconst Drawable = Class.extend\n({\n\tclassName: 'Drawable',\n\n\t/**\n\t * Image resource.\n\t * @protected\n\t * !readonly resource: Texture;\n\t */\n\tresource: null,\n\n\t/**\n\t * Logical width of the drawable.\n\t * @protected\n\t * !readonly width: number;\n\t */\n\twidth: 0,\n\n\t/**\n\t * Logical height of the drawable.\n\t * @protected\n\t * !readonly height: number;\n\t */\n\theight: 0,\n\n\t/**\n\t * Frame source X-offset in physical units.\n\t * @protected\n\t * !readonly sx: number;\n\t */\n\tsx: 0,\n\n\t/**\n\t * Frame source Y-position in physical units.\n\t * @protected\n\t * !readonly sy: number;\n\t */\n\tsy: 0,\n\n\t/**\n\t * Frame source width in physical units.\n\t * @protected\n\t * !readonly swidth: number;\n\t */\n\tswidth: 0,\n\n\t/**\n\t * Frame source height in physical units.\n\t * @protected\n\t * !readonly sheight: number;\n\t */\n\tsheight: 0,\n\n\t//TODO rename `resources` to `texture`\n\n\t/**\n\t * Initializes the instance.\n\t * !constructor();\n\t */\n\t__ctor: function (resource=null, width=null, height=null)\n\t{\n\t\tif (Rinn.isInstanceOf(resource, Drawable))\n\t\t{\n\t\t\tlet drawable = resource;\n\n\t\t\tthis.resource = drawable.resource;\n\t\t\tthis.width = width ?? drawable.width;\n\t\t\tthis.height = height ?? drawable.height;\n\n\t\t\tthis.sx = drawable.sx;\n\t\t\tthis.sy = drawable.sy;\n\t\t\tthis.swidth = drawable.swidth;\n\t\t\tthis.sheight = drawable.sheight;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.resource = resource;\n\n\t\t\tthis.sx = 0;\n\t\t\tthis.sy = 0;\n\n\t\t\tif (this.resource)\n\t\t\t{\n\t\t\t\tthis.width = width ?? resource.targetWidth;\n\t\t\t\tthis.height = height ?? resource.targetHeight;\n\n\t\t\t\tthis.swidth = resource.width;\n\t\t\t\tthis.sheight = resource.height;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.width = width;\n\t\t\t\tthis.height = height;\n\n\t\t\t\tthis.swidth = width;\n\t\t\t\tthis.sheight = height;\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Returns the actual independent drawable object.\n\t * !getDrawable(): Drawable;\n\t */\n\tgetDrawable: function()\n\t{\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the underlying Image object, can be used directly with Canvas.drawImage.\n\t * @deprecated\n\t * !getImage(): Texture;\n\t * TODO remove in next major version\n\t */\n\tgetImage: function()\n\t{\n\t\treturn this.resource;\n\t},\n\n\t/**\n\t * Returns the underlying texture object.\n\t * !getTexture(): Texture;\n\t */\n\tgetTexture: function()\n\t{\n\t\treturn this.resource;\n\t},\n\n\t/**\n\t * Resizes the logical dimensions of the drawable.\n\t * !resize (width: number|boolean|null, height: number|boolean|null) : Drawable;\n\t */\n\tresize: function (width, height)\n\t{\n\t\twidth = width !== null ? (width !== true ? width : true) : this.width;\n\t\theight = height !== null ? (height !== true ? height : true)  : this.height;\n\n\t\tif (width === true)\n\t\t\twidth = height*(this.width/this.height);\n\t\telse if (height === true)\n\t\t\theight = width*(this.height/this.width);\n\n\t\tthis.width = width;\n\t\tthis.height = height;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Draws the drawable on the canvas.\n\t * !draw (g: Canvas, x: number, y: number, width?: number|null, height?: number|null) : void;\n\t */\n\tdraw: function (g, x, y, width=null, height=null)\n\t{\n\t\twidth = width ?? this.width;\n\t\theight = height ?? this.height;\n\n\t\tthis.drawf(g, this.sx, this.sy, this.swidth, this.sheight, x, y, width, height);\n\t},\n\n\t/**\n\t * Draws a section of the drawable on the canvas using full parameters.\n\t * !drawf (g: Canvas, sx:number, sy:number, swidth:number, sheight:number, tx:number, ty:number, twidth:number, theight:number, fwidth?:number|null, fheight?:number|null) : void;\n\t */\n\tdrawf: function (g, sx, sy, swidth, sheight, tx, ty, twidth, theight, fwidth=null, fheight=null)\n\t{\n\t\tg.drawImage (this.resource,\n\t\t\tsx, sy, swidth, sheight,\n\t\t\ttx, ty, twidth, theight,\n\t\t\tnull, null, fwidth ?? twidth, fheight ?? theight);\n\t},\n\n\t/**\n\t * Renders the drawable for the specified element.\n\t * !render (g: Canvas, elem: Element) : void;\n\t */\n\trender: function (g, elem)\n\t{\n\t\tthis.draw (g, elem.bounds.x1, elem.bounds.y1, elem.bounds.width(), elem.bounds.height());\n\t}\n});\n\n\n/**\n * Nine-Slice Drawable.\n */\nconst NineSlice = Drawable.extend\n({\n\tclassName: 'DrawableNineSlice',\n\n\tss: null,\n\tstartingIndex: 0,\n\n\t__ctor: function (spritesheet, startingIndex)\n\t{\n\t\tthis._super.Drawable.__ctor(spritesheet);\n\n\t\tif (spritesheet === null || !Class.instanceOf(spritesheet, 'Spritesheet'))\n\t\t\tthrow new Error('NineSlice: spritesheet required');\n\n\t\tthis.ss = spritesheet;\n\t\tthis.startingIndex = startingIndex;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.ss);\n\t},\n\n\tgetTexture: function()\n\t{\n\t\treturn this.ss.getTexture();\n\t},\n\n\tdraw: function (g, x, y, width, height)\n\t{\n\t\tconst k = this.startingIndex;\n\n\t\tlet leftWidth = this.ss.getFrame(k+0).width;\n\t\tlet rightWidth = this.ss.getFrame(k+2).width;\n\t\tlet midWidth = this.ss.getFrame(k+1).width;\n\n\t\tlet topHeight = this.ss.getFrame(k+0).height;\n\t\tlet bottomHeight = this.ss.getFrame(k+6).height;\n\t\tlet midHeight = this.ss.getFrame(k+3).height;\n\n\t\tlet n = int((width - leftWidth - rightWidth) / midWidth);\n\t\tlet m = int((height - topHeight - bottomHeight) / midHeight);\n\n\t\tlet x1 = x;\n\t\tlet y1 = y;\n\n\t\t// Corners\n\t\tthis.ss.getFrame(k+0).draw(g, x1, y1);\n\t\tthis.ss.getFrame(k+2).draw(g, x1 + leftWidth + n*midWidth, y1);\n\t\tthis.ss.getFrame(k+6).draw(g, x1, y1 + topHeight + m*midHeight);\n\t\tthis.ss.getFrame(k+8).draw(g, x1 + leftWidth + n*midWidth, y1 + topHeight + m*midHeight);\n\n\t\t// Top/Bottom\n\t\tfor (let i = 0; i < n; i++) {\n\t\t\tthis.ss.getFrame(k+1).draw(g, x1 + leftWidth + i*midWidth, y1);\n\t\t\tthis.ss.getFrame(k+7).draw(g, x1 + leftWidth + i*midWidth, y1 + topHeight + m*midHeight);\n\t\t}\n\n\t\t// Left/Right\n\t\tfor (let i = 0; i < m; i++) {\n\t\t\tthis.ss.getFrame(k+3).draw(g, x1, y1 + topHeight + i*midHeight);\n\t\t\tthis.ss.getFrame(k+5).draw(g, x1 + leftWidth + n*midWidth, y1 + topHeight + i*midHeight);\n\t\t}\n\n\t\t// Center\n\t\tfor (let j = 0; j < m; j++)\n\t\tfor (let i = 0; i < n; i++) {\n\t\t\tthis.ss.getFrame(k+4).draw(g, x1 + leftWidth + i*midWidth, y1 + topHeight + j*midHeight);\n\t\t}\n\t}\n});\n\nRecycler.createPool(NineSlice, 512);\n\n\n/**\n * Repeated drawable.\n */\nconst Repeated = Drawable.extend\n({\n\tclassName: 'DrawableRepeated',\n\n\tdrawable: null,\n\n\t__ctor: function (drawable)\n\t{\n\t\tthis._super.Drawable.__ctor(drawable);\n\t\tthis.drawable = drawable;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.drawable);\n\t},\n\n\tdrawf: function (g, sx, sy, swidth, sheight, tx, ty, twidth, theight, fwidth=null, fheight=null)\n\t{\n\t\tthis.drawable.drawf(g, sx, sy, swidth, sheight, tx, ty, twidth, theight, this.width, this.height);\n\t}\n});\n\nRecycler.createPool(Repeated, 512);\n\n\n/**\n * Clipped drawable.\n */\nconst Clipped = Drawable.extend\n({\n\tclassName: 'DrawableClipped',\n\n\tdrawable: null,\n\n\t__ctor: function (drawable)\n\t{\n\t\tthis._super.Drawable.__ctor(drawable);\n\t\tthis.drawable = drawable;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.drawable);\n\t},\n\n\tdraw: function (g, x, y, width=null, height=null)\n\t{\n\t\tlet img = this.getTexture();\n\t\n\t\twidth = width ?? this.width;\n\t\theight = height ?? this.height;\n\n\t\tthis.drawable.drawf (g,\n\t\t\tthis.drawable.sx, this.drawable.sy, width*img.rscale, height*img.rscale,\n\t\t\tx, y, width, height);\n\t}\n});\n\nRecycler.createPool(Clipped, 512);\n\n\n/**\n * Centered drawable.\n */\nconst Centered = Drawable.extend\n({\n\tclassName: 'DrawableCentered',\n\n\tdrawable: null,\n\toffsX: 0,\n\toffsY: 0,\n\n\t__ctor: function (drawable, offsX, offsY)\n\t{\n\t\tthis._super.Drawable.__ctor(drawable);\n\n\t\tthis.drawable = drawable;\n\t\tthis.offsX = offsX;\n\t\tthis.offsY = offsY;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.drawable);\n\t},\n\n\tdraw: function (g, x, y, width=null, height=null)\n\t{\n\t\twidth = width ?? this.width;\n\t\theight = height ?? this.height;\n\n\t\tthis.drawable.draw(g, x+this.offsX+(width-this.width)*0.5, y+this.offsY+(height-this.height)*0.5, this.width, this.height);\n\t}\n});\n\nRecycler.createPool(Centered, 512);\n\n\n/**\n * Static drawable.\n */\nconst Static = Drawable.extend\n({\n\tclassName: 'DrawableStatic',\n\n\tdrawable: null,\n\toffsX: 0,\n\toffsY: 0,\n\n\t__ctor: function (drawable, offsX, offsY)\n\t{\n\t\tthis._super.Drawable.__ctor(drawable);\n\n\t\tthis.drawable = drawable;\n\t\tthis.offsX = offsX;\n\t\tthis.offsY = offsY;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.drawable);\n\t},\n\n\tdraw: function (g, x, y, width=null, height=null)\n\t{\n\t\tthis.drawable.draw(g, x+this.offsX, y+this.offsY, width, height);\n\t}\n});\n\nRecycler.createPool(Static, 512);\n\n\n/**\n * Drawable group.\n */\nconst Group = Drawable.extend\n({\n\tclassName: 'DrawableGroup',\n\n\tlist: null,\n\n\t__ctor: function (list)\n\t{\n\t\tthis._super.Drawable.__ctor();\n\n\t\tthis.list = list;\n\n\t\tthis.width = 0;\n\t\tthis.height = 0;\n\n\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t{\n\t\t\tif (this.list[i].width > this.width) this.width = this.list[i].width;\n\t\t\tif (this.list[i].height > this.height) this.height = this.list[i].height;\n\t\t}\n\n\t\tthis.swidth = this.width;\n\t\tthis.sheight = this.height;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tif (this.list !== null)\n\t\t{\n\t\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\t\tdispose(this.list[i]);\n\n\t\t\tthis.list = null;\n\t\t}\n\t},\n\n\tdraw: function (g, x, y, width=null, height=null)\n\t{\n\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\tthis.list[i].draw(g, x, y, width, height);\n\t},\n\n\trender: function (g, elem)\n\t{\n\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\tthis.list[i].render(g, elem);\n\t}\n});\n\nRecycler.createPool(Group, 512);\n\n\n/**\n * Draws the given drawable mirrored horizontally.\n */\nconst MirrorX = Drawable.extend\n({\n\tclassName: 'DrawableMirrorX',\n\n\tdrawable: null,\n\n\t__ctor: function (drawable)\n\t{\n\t\tthis._super.Drawable.__ctor(drawable);\n\t\tthis.drawable = drawable;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.drawable);\n\t},\n\n\tdrawf: function (g, sx, sy, swidth, sheight, tx, ty, twidth, theight, fwidth=null, fheight=null)\n\t{\n\t\tg.pushMatrix();\n\t\tg.translate(tx+twidth, ty);\n\t\tg.scale(-1, 1);\n\t\tthis.drawable.drawf(g, sx, sy, swidth, sheight, 0, 0, twidth, theight, fwidth, fheight);\n\t\tg.popMatrix();\n\t}\n});\n\nRecycler.createPool(MirrorX, 512);\n\n\n/**\n * Draws the given drawable mirrored vertically.\n */\nconst MirrorY = Drawable.extend\n({\n\tclassName: 'DrawableMirrorY',\n\n\tdrawable: null,\n\n\t__ctor: function (drawable)\n\t{\n\t\tthis._super.Drawable.__ctor(drawable);\n\t\tthis.drawable = drawable;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.drawable);\n\t},\n\n\tdrawf: function (g, sx, sy, swidth, sheight, tx, ty, twidth, theight, fwidth=null, fheight=null)\n\t{\n\t\tg.pushMatrix();\n\t\tg.translate(tx, ty+theight);\n\t\tg.scale(1, -1);\n\t\tthis.drawable.drawf(g, sx, sy, swidth, sheight, 0, 0, twidth, theight, fwidth, fheight);\n\t\tg.popMatrix();\n\t}\n});\n\nRecycler.createPool(MirrorY, 512);\n\n\n/**\n * Drawable made with a composition of tiles from a nine-slice spritesheet to create a rectangle.\n * !static nineSlice (spritesheet: object, startingIndex?:number|0) : Drawable;\n */\n//violet: type fixup\n//static nineSlice (spritesheet: Spritesheet, startingIndex?:number|0) : Drawable;\nDrawable.nineSlice = function (spritesheet, startingIndex=0) { return NineSlice.Pool.alloc(spritesheet, startingIndex); }\n/**\n * Drawable made with a composition of tiles from a nine-slice spritesheet to create a rectangle.\n * !nineSlice (startingIndex?:number|0) : Drawable;\n */\nDrawable.prototype.nineSlice = function(startingIndex=0) { return NineSlice.Pool.alloc(this, startingIndex); }\n\n/**\n * Drawable tiles to the target size.\n * !static repeated (drawable: Drawable) : Drawable;\n */\nDrawable.repeated = function (drawable) { return Repeated.Pool.alloc(drawable); }\n/**\n * Drawable tiles to the target size.\n * !repeated () : Drawable;\n */\nDrawable.prototype.repeated = function () { return Repeated.Pool.alloc(this); }\n\n/**\n * Drawable clipped to the target size.\n * !static clipped (drawable: Drawable) : Drawable;\n */\nDrawable.clipped = function (drawable) { return Clipped.Pool.alloc(drawable); }\n/**\n * Drawable clipped to the target size.\n * !clipped () : Drawable;\n */\nDrawable.prototype.clipped = function () { return Clipped.Pool.alloc(this); }\n\n/**\n * Drawable centered to the target rectangle.\n * !static centered (drawable: Drawable, offsX?: number, offsY?: number) : Drawable;\n */\nDrawable.centered = function (drawable, offsX, offsY) { return Centered.Pool.alloc(drawable, offsX, offsY); }\n/**\n * Drawable centered to the target rectangle.\n * !centered (offsX?: number, offsY?: number) : Drawable;\n */\nDrawable.prototype.centered = function (offsX, offsY) { return Centered.Pool.alloc(this, offsX, offsY); }\n\n/**\n * Drawable as-is without stretching it.\n * !static static (drawable: Drawable, offsX?: number, offsY?: number) : Drawable;\n */\nDrawable.static = function (drawable, offsX, offsY) { return Static.Pool.alloc(drawable, offsX, offsY); }\n/**\n * Drawable as-is without stretching it.\n * !static (offsX?: number, offsY?: number) : Drawable;\n */\nDrawable.prototype.static = function (offsX, offsY) { return Static.Pool.alloc(this, offsX, offsY); }\n\n/**\n * Creates a drawable group.\n * !static group (...args: Array<Drawable>) : Drawable;\n */\nDrawable.group = function (...args) { return Group.Pool.alloc(args); }\n\n/**\n * Drawable mirrored horizontally.\n * !static mirrorX (drawable: Drawable) : Drawable;\n */\nDrawable.mirrorX = function (drawable) { return MirrorX.Pool.alloc(drawable); }\n/**\n * Drawable mirrored horizontally.\n * !mirrorX () : Drawable;\n */\nDrawable.prototype.mirrorX = function () { return MirrorX.Pool.alloc(this); }\n\n/**\n * Drawable mirrored vertically.\n * !static mirrorY (drawable: Drawable) : Drawable;\n */\nDrawable.mirrorY = function (drawable) { return MirrorY.Pool.alloc(drawable); }\n/**\n * Drawable mirrored vertically.\n * !mirrorY () : Drawable;\n */\nDrawable.prototype.mirrorY = function () { return MirrorY.Pool.alloc(this); }\n\n//!/class\n\n//!namespace Drawable\n//!namespace Pool\n\n\t/**\n\t * Allocates a drawable object.\n\t * !function alloc () : Drawable;\n\t */\n\nRecycler.createPool(Drawable, 512);\nexport default Drawable;\n","\nimport Drawable from '../flow/drawable.js';\n\nexport default Drawable.extend\n({\n\tclassName: 'DrawableResource',\n\n\tr: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type !== 'image')\n\t\t\tthrow new Error ('Resource is not an image.');\n\n\t\tthis._super.Drawable.__ctor(r.data, r.width, r.height);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\t}\n});\n","\nimport Canvas from '../system/canvas.js';\nimport Drawable from '../flow/drawable.js';\n\n//![import \"../system/canvas\"]\n\nexport default Drawable.extend\n({\n\tclassName: 'DrawableCustom',\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != 'object')\n\t\t\tthrow new Error ('Resource is not an object.');\n\n\t\tthis._super.Drawable.__ctor(null, r.width, r.height);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\t},\n\n\tinit: function (callback)\n\t{\n\t\tCanvas.renderImage(this.r.width, this.r.height,\n\t\t(g) => {\n\t\t\tif (this.r.draw !== null && typeof(this.r.draw) === 'function') {\n\t\t\t\tthis.r.draw(g, this.r);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tg.fillStyle(this.r.color);\n\t\t\t\tg.fillRect(0, 0, this.r.width, this.r.height);\n\t\t\t}\n\t\t},\n\t\t(img) => {\n\t\t\tthis.resource = img;\n\t\t\tthis.swidth = this.resource.width;\n\t\t\tthis.sheight = this.resource.height;\n\t\t\tcallback();\n\t\t});\n\t}\n});\n","\nimport Drawable from '../flow/drawable.js';\n\n/*\n\tIf source is \"image\":\n\t\tconfig: {\n\t\t\tsheetWidth: int, frameWidth: int, frameHeight: int?, numFrames: int?\n\t\t\t--OR--\n\t\t\tnumFrames: int, frameWidth: int, frameHeight: int?\n\t\t\t--OR--\n\t\t\tcoords: Array<[x,y,w,h]>\n\t\t}\n\n\tIf source is \"images\":\n\t\tconfig: {\n\t\t\tframeWidth: int, frameHeight: int\n\t\t}\n\t\t\n\tNOTE: The sheetWidth, frameWidth and frameHeight should reflect the real image size. The system will automatically scale it if the source image is smaller/bigger.\n*/\n\nconst FrameDrawable = Drawable.extend\n({\n\tspritesheet: null,\n\tframeIndex: 0,\n\n\t__ctor: function (spritesheet, frameIndex, texture, sx, sy, sw, sh, width=null, height=null)\n\t{\n\t\tthis._super.Drawable.__ctor(null, width ?? spritesheet.width, height ?? spritesheet.height);\n\n\t\tthis.spritesheet = spritesheet;\n\t\tthis.frameIndex = frameIndex;\n\n\t\tthis.sx = sx;\n\t\tthis.sy = sy;\n\t\tthis.swidth = sw;\n\t\tthis.sheight = sh;\n\n\t\tthis.resource = texture;\n\t}\n});\n\nexport default Drawable.extend\n({\n\tclassName: 'Spritesheet',\n\n\tframeCache: null,\n\tnumFrames: 0,\n\n\tframeWidth: 0,\n\tframeHeight: 0,\n\n\t__ctor: function (r)\n\t{\n\t\tthis._super.Drawable.__ctor();\n\n\t\tif ((r.type != 'image' && r.type != 'images'))\n\t\t\tthrow new Error ('Resource is not a sprite sheet.');\n\n\t\tlet r_scale, v_scale;\n\n\t\tif (r.type == 'image')\n\t\t{\n\t\t\tif (!r.config.sheetWidth && (!r.config.numFrames || !r.config.frameWidth) && !r.config.coords)\n\t\t\t\tthrow new Error (r.resName + ': required `sheetWidth` or `numFrames` with `frameWidth` or `coords` array.');\n\n\t\t\tif (!r.config.sheetWidth)\n\t\t\t\tr.config.sheetWidth = r.width;\n\n\t\t\tif (!r.config.frameHeight)\n\t\t\t\tr.config.frameHeight = r.data.height;\n\n\t\t\tr_scale = r.data.width / r.config.sheetWidth;\n\t\t\tv_scale = r.width / r.config.sheetWidth;\n\t\t}\n\t\telse // r.type == 'images'\n\t\t{\n\t\t\tif (!r.config) r.config = { };\n\n\t\t\tif (!r.config.frameWidth)\n\t\t\t\tr.config.frameWidth = r.data[0].width;\n\n\t\t\tif (!r.config.frameHeight)\n\t\t\t\tr.config.frameHeight = r.data[0].height;\n\n\t\t\tr_scale = r.data[0].data.width / r.config.frameWidth;\n\t\t\tv_scale = r.data[0].width / r.config.frameWidth;\n\t\t}\n\n\t\t// Physical frame dimensions.\n\t\tthis.frameWidth = (r.config.frameWidth * r_scale);\n\t\tthis.frameHeight = (r.config.frameHeight * r_scale);\n\n\t\t// Logical frame dimensions.\n\t\tthis.width = r.config.frameWidth * v_scale;\n\t\tthis.height = r.config.frameHeight * v_scale;\n\n\t\t// Load each frame into its own FrameDrawable.\n\t\tlet numCols, numRows;\n\n\t\tif (r.type == 'image')\n\t\t{\n\t\t\tnumCols = int(r.data.width / this.frameWidth);\n\t\t\tnumRows = Math.ceil(r.data.height / this.frameHeight);\n\n\t\t\tif (r.config.coords)\n\t\t\t\tthis.numFrames = r.config.coords.length;\n\t\t\telse\n\t\t\t\tthis.numFrames = r.config.numFrames || (numCols * numRows);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnumCols = numRows = 0;\n\t\t\tthis.numFrames = r.data.length;\n\t\t}\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\t// Prepare frameCache.\n\t\tthis.frameCache = { };\n\n\t\tfor (let i = 0; i < this.numFrames; i++)\n\t\t{\n\t\t\tlet frameObject;\n\n\t\t\tif (this.r.config.coords)\n\t\t\t{\n\t\t\t\tframeObject = new FrameDrawable (this, i, this.r.data, \n\t\t\t\t\tthis.r.config.coords[i][0]*r_scale, this.r.config.coords[i][1]*r_scale, this.r.config.coords[i][2]*r_scale, this.r.config.coords[i][3]*r_scale,\n\t\t\t\t\tthis.r.config.coords[i][2]*v_scale, this.r.config.coords[i][3]*v_scale);\n\t\t\t}\n\t\t\telse if (this.numCols != 0)\n\t\t\t{\n\t\t\t\tframeObject = new FrameDrawable (this, i, this.r.data, \n\t\t\t\t\t(i % numCols) * this.frameWidth, int(i / numCols) * this.frameHeight, this.frameWidth, this.frameHeight);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tframeObject = new FrameDrawable (this, i, this.r.data[i].data, \n\t\t\t\t\t0, 0, this.frameWidth, this.frameHeight);\n\t\t\t}\n\t\n\t\t\tthis.frameCache[i] = frameObject;\n\t\t}\n\t},\n\n\t/**\n\t * Returns a frame from the spritesheet.\n\t * @param frameIndex - The index of the frame to return.\n\t * !getFrame (frameIndex: number) : Drawable;\n\t */\n\tgetFrame: function (frameIndex)\n\t{\n\t\tif (frameIndex < 0 || frameIndex >= this.numFrames)\n\t\t\tthrow new Error ('frameIndex out of range');\n\n\t\treturn this.frameCache[frameIndex];\n\t},\n\n\t/**\n\t * Returns the texture related to the spritesheet.\n\t * !getTexture() : Texture;\n\t */\n\tgetTexture: function()\n\t{\n\t\treturn this.getFrame(0).getTexture();\n\t},\n\n\t/**\n\t * Returns the default drawable of the spritesheet (first frame).\n\t * !getDrawable() : Drawable;\n\t */\n\tgetDrawable: function()\n\t{\n\t\treturn this.getFrame(0);\n\t}\n});\n","\nimport { Class } from 'rinn';\nimport Spritesheet from './spritesheet.js';\nimport System from '../system/system.js';\nimport List from '../utils/list.js';\nimport Recycler from '../utils/recycler.js';\nimport Drawable from '../flow/drawable.js';\n\n//![import \"./spritesheet\"]\n//![import \"../system/system\"]\n//![import \"../utils/list\"]\n//![import \"../utils/recycler\"]\n\n/*\n\tanim: {\n\t\tdef: string, fps: int?,\n\n\t\tseq: {\n\t\t\tseq1: { loop: bool?, group: [ [int, int, ...], ... ] },\n\t\t\tseq2: { loop: bool?, group: [ [int, int, ...], ... ] },\n\t\t\tseq2: { loop: bool?, group: \"0-12\" },\n\t\t\tseq2: { loop: bool?, group: \"4 1 1 2 3\" },\n\t\t}\n\t}\n\n\tNOTE: When specifying a group such as \"0,12\" it means to draw tiles 0 and the 12 in that single frame.\n*/\n\nexport const Animation = Drawable.extend\n({\n\tclassName: 'Animation',\n\n\tseq: null, seq_i: 0, n_seq: null,\n\tqueue: null,\n\n\tfps: 0, frameDuration: 0, time: 0,\n\n\tframeNumber: -1,\n\n\tfinished: false,\n\t_paused: false,\n\n\tfinishedCallback: null,\n\tfinishedCallbackHandler: null,\n\tfinishedCallbackContext: null,\n\n\tframeCallback: null,\n\n\t__ctor: function (anim, seq, fps)\n\t{\n\t\tthis._super.Drawable.__ctor(anim.getTexture(), anim.width, anim.height);\n\n\t\tthis.anim = anim;\n\t\tthis.queue = List.Pool.alloc();\n\n\t\tthis.seq = seq;\n\t\tthis.seq_i = 0;\n\t\tthis.n_seq = null;\n\n\t\tthis.frameNumber = -1;\n\t\tthis.finished = false;\n\t\tthis._paused = false;\n\n\t\tthis.finishedCallback = null;\n\t\tthis.finishedCallbackHandler = null;\n\t\tthis.finishedCallbackContext = null;\n\t\tthis.frameCallback = null;\n\n\t\tthis.fps = fps;\n\t\tthis.setFps (this.seq.fps || this.fps);\n\t},\n\n\t__dtor: function ()\n\t{\n\t\tthis.queue.free();\n\n\t\tif (this.finishedCallbackHandler)\n\t\t\tthis.finishedCallbackHandler.free();\n\n\t\tif (this.finishedCallbackContext)\n\t\t\tthis.finishedCallbackContext.free();\n\t},\n\n\tsetFps: function (fps)\n\t{\n\t\tthis.frameDuration = 1.0 / fps;\n\t\tthis.time = 0;\n\n\t\treturn this;\n\t},\n\n\tpaused: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._paused;\n\n\t\tthis._paused = value;\n\t\treturn this;\n\t},\n\n\tinitialDelay: function (dt)\n\t{\n\t\tthis.time = -dt;\n\t\treturn this;\n\t},\n\n\tonFinished: function (callback)\n\t{\n\t\tthis.finishedCallback = callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Adds a callback to be called when the animation finishes. Use `false` to clear all callbacks.\n\t */\n\tthen: function (callback, context=null)\n\t{\n\t\tif (callback === false && this.finishedCallback === this.thenCallback)\n\t\t{\n\t\t\tthis.finishedCallbackHandler.clear();\n\t\t\tthis.finishedCallbackContext.clear();\n\t\t}\n\n\t\tif (!callback) return this;\n\n\t\tif (this.finishedCallback !== this.thenCallback)\n\t\t{\n\t\t\tthis.finishedCallback = this.thenCallback;\n\t\t\tthis.finishedCallbackHandler = List.Pool.alloc();\n\t\t\tthis.finishedCallbackContext = List.Pool.alloc();\n\t\t}\n\n\t\tthis.finishedCallbackHandler.push(callback);\n\t\tthis.finishedCallbackContext.push(context);\n\t\treturn this;\n\t},\n\n\tthenCallback: function ()\n\t{\n\t\tif (!this.finishedCallbackHandler.length)\n\t\t\treturn false;\n\n\t\tlet context = this.finishedCallbackContext.shift();\n\t\tthis.finishedCallbackHandler.shift()(this, context);\n\t},\n\n\tonFrame: function (fn)\n\t{\n\t\tthis.frameCallback = fn;\n\t\treturn this;\n\t},\n\n\tsetFrame: function (i)\n\t{\n\t\tthis.seq_i = int(i) % this.seq.group.length;\n\t\treturn this;\n\t},\n\n\tgetFrame: function (normalized)\n\t{\n\t\treturn normalized === true ? (this.seq_i / (this.seq.group.length-1)) : this.seq_i;\n\t},\n\n\tgetLength: function ()\n\t{\n\t\treturn this.seq.group.length;\n\t},\n\n\t/**\n\t * Draws a section of the drawable on the canvas using full parameters.\n\t * !drawf (g: Canvas, sx:number, sy:number, swidth:number, sheight:number, tx:number, ty:number, twidth:number, theight:number, fwidth?:number|null, fheight?:number|null) : void;\n\t */\n\tdrawf: function (g, sx, sy, swidth, sheight, tx, ty, twidth, theight, fwidth=null, fheight=null)\n\t{\n\t\t// Update animation time only if not paused and system frame number has changed.\n\t\tif (!this._paused)\n\t\t\tthis.time += this.frameNumber === System.frameNumber ? 0 : System.frameDelta;\n\n\t\t// Delay until `time` is non-negative. Negative time is used as initial animation delay.\n\t\tif (this.time < 0) {\n\t\t\tthis.frameNumber = System.frameNumber;\n\t\t\treturn;\n\t\t}\n\n\t\t// Load next sequence if specified.\n\t\tif (this.n_seq !== null && this.frameNumber !== System.frameNumber)\n\t\t{\n\t\t\tthis.seq = this.n_seq;\n\t\t\tthis.seq_i = 0;\n\t\t\tthis.n_seq = null;\n\n\t\t\tthis.time = 0;\n\t\t\tthis.finished = false;\n\n\t\t\tthis.setFps (this.seq.fps || this.fps);\n\t\t}\n\n\t\t// Update animation frame if frame time exceeds or equals frame duration.\n\t\tif (this.time >= this.frameDuration && this.frameNumber !== System.frameNumber && !this.finished)\n\t\t{\n\t\t\tconst frameIndex = this.seq_i;\n\n\t\t\tthis.time -= this.frameDuration;\n\t\t\tthis.seq_i++;\n\n\t\t\t// Reached end of sequence.\n\t\t\tif (this.seq_i === this.seq.group.length)\n\t\t\t{\n\t\t\t\t// If loop is not enabled, trigger `finished` callback.\n\t\t\t\tif (!this.seq.loop)\n\t\t\t\t{\n\t\t\t\t\tthis.finished = true;\n\n\t\t\t\t\tif (this.finishedCallback)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.finishedCallback(this) === false)\n\t\t\t\t\t\t\tthis.finishedCallback = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tthis.seq_i = 0;\n\n\t\t\t\t// Use next sequence in the queue.\n\t\t\t\tif (this.queue.length)\n\t\t\t\t\tthis.use(this.queue.shift(), true);\n\t\t\t}\n\n\t\t\t//  Execute frame callback if registered.\n\t\t\tif (this.frameCallback)\n\t\t\t{\n\t\t\t\tif (this.frameCallback(frameIndex, this.seq.group.length-1, this) === false)\n\t\t\t\t\tthis.frameCallback = null;\n\t\t\t}\n\t\t}\n\n\t\t// Draw the current frame.\n\t\tlet t = this.seq.group[ this.seq_i === this.seq.group.length ? this.seq_i-1 : this.seq_i ];\n\n\t\t// TODO optimize this to ensure t is always just a single image\n\t\tfor (let i = 0; i < t.length; i++)\n\t\t{\n\t\t\tlet frame = this.anim.getFrame(t[i]);\n\t\t\tframe.drawf(g, frame.sx, frame.sy, frame.swidth, frame.sheight, tx, ty, twidth, theight, fwidth, fheight);\n\t\t}\n\n\t\t// Record system frame number to prevent double frame updates.\n\t\tthis.frameNumber = System.frameNumber;\n\t},\n\n\tgetTexture: function()\n\t{\n\t\treturn this.anim.getTexture();\n\t},\n\n\tgetDrawable: function()\n\t{\n\t\treturn this;\n\t},\n\n\tadvance: function ()\n\t{\n\t\tthis.paused (false);\n\t\tthis.draw (null, 0, 0);\n\t},\n\n\tgetSequenceName: function ()\n\t{\n\t\treturn this.n_seq === null ? this.seq.name : this.n_seq.name;\n\t},\n\n\tuse: function (seqName, forced=false)\n\t{\n\t\tif (this.seq.name === seqName && !this.finished && forced !== true)\n\t\t\treturn false;\n\n\t\tthis.n_seq = this.anim.a.seq[seqName];\n\t\tthis.finished = false;\n\n\t\treturn true;\n\t},\n\n\tplay: function (name, forced=false)\n\t{\n\t\tthis.use(name, forced);\n\t\treturn this;\n\t},\n\n\tsetQueue: function (list)\n\t{\n\t\tif (!List.isInstance(list))\n\t\t\tthrow new Error('setQueue: Parameter must be an instance of List');\n\n\t\tif (this.queue != null)\n\t\t\tthis.queue.clear().free();\n\n\t\tthis.queue = list;\n\t\tthis.use(this.queue.shift(), true);\n\t},\n\n\tenqueue: function (seqName, force=false)\n\t{\n\t\tlet seq = this.seq;\n\n\t\tlet lastName = this.queue.length > 0 ? this.queue[this.queue.length-1] : seq.name;\n\n\t\tif (seq.name === seqName && seq.loop)\n\t\t\treturn this;\n\n\t\tif (lastName === seqName && !force)\n\t\t\treturn this;\n\n\t\tif (seq.loop || this.finished)\n\t\t{\n\t\t\tthis.use(seqName, true);\n\t\t\treturn this;\n\t\t}\n\n\t\tthis.queue.push(seqName);\n\t\treturn this;\n\t}\n});\n\nRecycler.createPool(Animation);\n\n/* ********************************************************** */\nexport default Spritesheet.extend\n({\n\tclassName: 'SpritesheetAnimation',\n\n\tdefaultDrawable: null,\n\tsharedAnim: null,\n\n\tr: null,\n\ta: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (!r.anim) throw new Error (\"Animation descriptors not found.\");\n\n\t\tthis._super.Spritesheet.__ctor (r);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tlet t = this.a = this.r.anim;\n\n\t\tif (t.initialized) return;\n\n\t\tif (!t.def) t.def = 'def';\n\t\tif (!t.seq) t.seq = { };\n\n\t\t// Create default sequence if it wasn't defined.\n\t\tif (!t.seq[t.def] && (t.def == 'def' || t.def == 'defloop'))\n\t\t{\n\t\t\tlet p = { loop: (t.def == 'def' ? false : true), group: [ ] };\n\n\t\t\tfor (let i = 0; i < this.numFrames; i++) {\n\t\t\t\tp.group.push([i]);\n\t\t\t}\n\n\t\t\tt.seq[t.def] = p;\n\t\t}\n\n\t\tif (!t.seq[t.def])\n\t\t\tthrow new Error ('Undefined default sequence: ' + t.def);\n\n\t\tif (!t.fps) t.fps = 25;\n\n\t\tt.def = t.seq[t.def];\n\n\t\tlet frameIndex = 0;\n\n\t\tfor (let i in t.seq)\n\t\t{\n\t\t\tt.seq[i].name = i;\n\n\t\t\tif (!t.seq[i].loop)\n\t\t\t\tt.seq[i].loop = false;\n\n\t\t\tif (typeof(t.seq[i].group) == 'string')\n\t\t\t{\n\t\t\t\tlet a, b, c;\n\n\t\t\t\tif (t.seq[i].group.indexOf(' ') != -1)\n\t\t\t\t{\n\t\t\t\t\ta = t.seq[i].group.split(' ');\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\tfor (let j in a)\n\t\t\t\t\t\tt.seq[i].group.push([int(a[j])]);\n\t\t\t\t}\n\t\t\t\telse if (t.seq[i].group.indexOf('-') != -1)\n\t\t\t\t{\n\t\t\t\t\tc = t.seq[i].group.split('-');\n\t\t\t\t\t\n\t\t\t\t\ta = int(c[0]);\n\t\t\t\t\tb = int(c[1]);\n\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\tif (a < b) {\n\t\t\t\t\t\tfor (c = a; c <= b; c++)\n\t\t\t\t\t\t\tt.seq[i].group.push([c]);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tfor (c = a; c >= b; c--)\n\t\t\t\t\t\t\tt.seq[i].group.push([c]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ta = int(t.seq[i].group);\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\twhile (a--) t.seq[i].group.push([frameIndex++]);\n\t\t\t\t}\n\n\t\t\t\tt.seq[i].count = t.seq[i].group.length;\n\t\t\t}\n\t\t}\n\n\t\tt.initialized = true;\n\t},\n\n\tgetSharedAnimation: function (initialseq=null)\n\t{\n\t\tif (this.sharedAnim === null)\n\t\t{\n\t\t\tthis.sharedAnim = Animation.Pool.alloc(this, initialseq ? this.a.seq[initialseq] : this.a.def, this.a.fps);\n\t\t\tthis.sharedAnim.lockInstance(true);\n\n\t\t\treturn this.sharedAnim;\n\t\t}\n\n\t\treturn this.sharedAnim.play(initialseq ? initialseq : this.a.def.name);\n\t},\n\n\tgetAnimation: function (initialseq=null, fps=null)\n\t{\n\t\treturn Animation.Pool.alloc(this, initialseq ? this.a.seq[initialseq] : this.a.def, fps || this.a.fps);\n\t},\n\n\tgetSequence: function (name)\n\t{\n\t\treturn this.a.seq[name];\n\t},\n\n\tgetDrawable: function()\n\t{\n\t\tif (this.defaultDrawable === null)\n\t\t\tthis.defaultDrawable = this.getAnimation();\n\n\t\treturn this.defaultDrawable;\n\t}\n});\n","\nimport { Class } from 'rinn';\nimport Canvas from '../system/canvas.js';\n\n//![import \"../system/canvas\"]\n\n/*\n\tfont: {\n\t\tsheetWidth: int?, charWidth: int, charHeight: int, charset: string, widths: [char, width, ...],\n\t\treverseDraw: bool?, paddingX: int?, paddingY: int?, spacingX: int?, spacingY: int?\n\t}\n*/\n\nexport default Class.extend\n({\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != 'image' || !r.font)\n\t\t\tthrow new Error ('Resource is not a sprite font.');\n\n\t\tif (!r.font.sheetWidth)\n\t\t\tr.font.sheetWidth = r.width;\n\n\t\tlet r_scale = r.data.width / r.font.sheetWidth;\n\t\tlet v_scale = r.width / r.font.sheetWidth;\n\n\t\tthis.r_charWidth = (r.font.charWidth * r_scale);\n\t\tthis.r_charHeight = (r.font.charHeight * r_scale);\n\n\t\tthis.charWidth = (r.font.charWidth * v_scale);\n\t\tthis.charHeight = (r.font.charHeight * v_scale);\n\n\t\tthis.paddingX = (r.font.paddingX || 0) * v_scale;\n\t\tthis.paddingY = (r.font.paddingY || 0) * v_scale;\n\n\t\tthis.spacingX = (r.font.spacingX || 0) * v_scale;\n\t\tthis.spacingY = (r.font.spacingY || 0) * v_scale;\n\n\t\tthis.reverseDraw = r.font.reverseDraw || false;\n\n\t\tlet cols = int(r.font.sheetWidth / r.font.charWidth);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tlet n = r.font.charset.length;\n\t\tlet k = 0;\n\t\tlet y = 0;\n\n\t\tthis.charTable = { };\n\n\t\twhile (k < n)\n\t\t{\n\t\t\tlet x = 0;\n\n\t\t\tfor (let i = 0; i < cols && k < n; i++)\n\t\t\t{\n\t\t\t\tlet c = r.font.charset[k++];\n\n\t\t\t\tthis.charTable[c] = { hidden: false, x: x, y: y, charWidth: this.charWidth, r_charWidth: this.r_charWidth, spacingX: 0 };\n\n\t\t\t\tx += this.r_charWidth;\n\t\t\t}\n\n\t\t\ty += this.r_charHeight;\n\t\t}\n\n\t\tif (!(' ' in this.charTable))\n\t\t\tthis.charTable[' '] = { hidden: true, charWidth: int((this.charWidth + this.paddingX)*2/3), r_charWidth: this.r_charWidth, spacingX: 0 };\n\n\t\tif (!r.font.widths) return;\n\n\t\tn = r.font.widths.length;\n\n\t\tfor (let i = 0; i < n; i += 2)\n\t\t{\n\t\t\tlet w = r.font.widths[i+1] * v_scale;\n\t\t\tlet s = r.font.widths[i];\n\n\t\t\tif (typeof(s) === 'number')\n\t\t\t\ts = String.fromCharCode(s);\n\n\t\t\tfor (let j = 0; j < s.length; j++)\n\t\t\t{\n\t\t\t\tif (s[j] in this.charTable)\n\t\t\t\t\tthis.charTable[s[j]].spacingX = w - this.charTable[s[j]].charWidth;\n\t\t\t}\n\t\t}\n\t},\n\n\tdrawText: function (g, x, y, text)\n\t{\n\t\tlet n = text.length;\n\n\t\tlet pX = -2*this.paddingX + this.spacingX;\n\n\t\tx -= this.paddingX;\n\t\ty -= this.paddingY;\n\n\t\tif (!this.reverseDraw)\n\t\t{\n\t\t\tfor (let i = 0; i < n; i++)\n\t\t\t{\n\t\t\t\tlet c = this.charTable[text[i]];\n\t\t\t\tif (!c) continue;\n\n\t\t\t\tif (!c.hidden)\n\t\t\t\t\tg.drawImage (this.r.data, c.x, c.y, c.r_charWidth, this.r_charHeight, x, y, c.charWidth, this.charHeight, null, null, c.charWidth, this.charHeight);\n\n\t\t\t\tx += c.charWidth + pX + c.spacingX;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let i = 0; i < n-1; i++)\n\t\t\t{\n\t\t\t\tlet c = this.charTable[text[i]];\n\t\t\t\tif (!c) continue;\n\n\t\t\t\tx += c.charWidth + pX;\n\t\t\t}\n\n\t\t\tfor (let i = n-1; i >= 0; i--)\n\t\t\t{\n\t\t\t\tlet c = this.charTable[text[i]];\n\t\t\t\tif (!c) continue;\n\n\t\t\t\tif (!c.hidden)\n\t\t\t\t\tg.drawImage (this.r.data, c.x, c.y, c.r_charWidth, this.r_charHeight, x, y, c.charWidth, this.charHeight, null, null, c.charWidth, this.charHeight);\n\n\t\t\t\tx -= c.charWidth + pX + c.spacingX;\n\t\t\t}\n\t\t}\n\t},\n\n\tmeasureWidth: function (text)\n\t{\n\t\tlet n = text.length;\n\t\tlet x = 0;\n\n\t\tlet pX = -2*this.paddingX + this.spacingX;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tlet c = this.charTable[text[i]];\n\t\t\tif (!c) continue;\n\n\t\t\tx += c.charWidth + pX + c.spacingX;\n\t\t}\n\n\t\treturn x;\n\t},\n\n\tmeasureHeight: function (text)\n\t{\n\t\treturn this.charHeight - 2*this.paddingY + this.spacingY;\n\t}\n});\n","\nimport { Class } from 'rinn';\nimport Resources from './resources.js';\n\n//![import \"./resources\"]\n\n/*\n\ttrack: string (music|sfx)\n*/\n\nconst Sound = Class.extend\n({\n\tr: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"audio\")\n\t\t\tthrow new Error (\"Resource is not audio.\");\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tthis.track = Sound[this.r.track.toUpperCase()];\n\t},\n\n\tplay: function (callback, volume)\n\t{\n\t\treturn Sound.play (this, callback, volume);\n\t},\n\n\tplayLoop: function (callback, volume)\n\t{\n\t\treturn Sound.playLoop (this, callback, volume);\n\t}\n});\n\nSound.ENGINE_HTML5 = 1;\nSound.ENGINE_WEBAUDIO = 2;\nSound.ENGINE_NATIVEAUDIO = 3;\n\nObject.assign(Sound,\n{\n\tMASTER: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tSFX: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tMUSIC: {\n\t\tenabled: true,\n\t\tvolume: 0.8\n\t},\n\n\tVOICE: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tMAX_POOL_SIZE: 100,\n\n\tpool: [ ],\n\tactive: [ ],\n\n\tregister: function (node)\n\t{\n\t\tif (node.registered) return;\n\n\t\tnode.registered = true;\n\t\tthis.active.push(node);\n\t},\n\n\tunregister: function (node)\n\t{\n\t\tif (!node.registered) return;\n\n\t\tnode.registered = false;\n\n\t\tvar i = Sound.active.indexOf(node);\n\t\tif (i == -1) return;\n\n\t\tSound.active.splice(i, 1);\n\t},\n\n\tupdateNode: function (node, cmd)\n\t{\n\t\tswitch (node.snd.r.engine)\n\t\t{\n\t\t\tcase Sound.ENGINE_WEBAUDIO:\n\t\t\t\treturn this.updateNode_webaudio(node, cmd);\n\n\t\t\tcase Sound.ENGINE_NATIVEAUDIO:\n\t\t\t\treturn this.updateNode_nativeaudio(node, cmd);\n\t\t}\n\n\t\treturn this.updateNode_audio(node, cmd);\n\t},\n\n\t// Web Audio.\n\talloc_webaudio: function (node)\n\t{\n\t\tnode.gainNode = audioContext.createGain();\n\t\tnode.gainNode.gain.value = 0;\n\t\tnode.gainNode.connect(audioContext.destination);\n\n\t\tnode.res = audioContext.createBufferSource();\n\t\tnode.res.buffer = node.snd.r.data;\n\t\tnode.res.loop = false;\n\t\tnode.res.connect(node.gainNode);\n\t\tnode.res.node = node;\n\t},\n\n\tfree_webaudio: function (node)\n\t{\n\t\tif (!node.res) return;\n\n\t\tnode.gainNode.disconnect();\n\n\t\tnode.res = null;\n\t\tnode.gainNode = null;\n\t},\n\n\t// Native Audio (Cordova plugin).\n\talloc_nativeaudio: function (node)\n\t{\n\t\tnode.res = true;\n\t},\n\n\tfree_nativeaudio: function (node)\n\t{\n\t\tnode.res = false;\n\t},\n\n\t// HTML5 Audio.\n\talloc_audio: function (node)\n\t{\n\t\tif (!this.pool.length)\n\t\t\titem = node.cloneNode();\n\t\telse\n\t\t\titem = this.pool.pop();\n\n\t\titem._src = node.src;\n\t\treturn item;\n\t},\n\n\tfree_audio: function (node)\n\t{\n\t\tif (this.pool.length == this.MAX_POOL_SIZE)\n\t\t\treturn;\n\n\t\t//BUG: This causes a GET request of \"/null\" on Chromium.\n\t\t//node.src = null;\n\n\t\tthis.pool.push(node);\n\t},\n\n\t/* *********************** */\n\tupdateNode_webaudio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tvar volume = Sound.MASTER.volume * node.snd.track.volume * node.volume;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t\tSound.alloc_webaudio(node);\n\n\t\t\t\tnode.playTime = hrnow();\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.onended = Sound.onended_webaudio;\n\t\t\t\tnode.gainNode.gain.value = volume;\n\n\t\t\t\ttry {\n\t\t\t\t\tnode.res.start(0, node.startTime/1000.0);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_webaudio(node);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.gainNode.gain.value = volume;\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\n\t\t\t\t\tSound.free_webaudio(node);\n\t\n\t\t\t\t\tif (node.callback) node.callback();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\t\t\t\tnode.res.onended = null;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tnode.res.stop();\n\n\t\t\t\tSound.free_webaudio(node);\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime += hrnow() - node.playTime;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = true;\n\t\t\t\tnode.res.onended = null;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tnode.res.stop();\n\n\t\t\t\tSound.free_webaudio(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.loop = false;\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_webaudio: function (e)\n\t{\n\t\tvar node = e.currentTarget.node;\n\n\t\tif (node.playing && node.loop != 0)\n\t\t{\n\t\t\tSound.free_webaudio(node);\n\n\t\t\tif (node.loop != -1)\n\t\t\t\tnode.loop--;\n\n\t\t\tnode.startTime = 0;\n\t\t\tnode.playing = false;\n\t\t\tnode.pause = false;\n\n\t\t\tSound.updateNode_webaudio (node, 'play');\n\t\t\treturn;\n\t\t}\n\n\t\tnode.res.onended = null;\n\t\tnode.res.volume = 0;\n\n\t\tSound.updateNode_webaudio (node, 'stop');\n\t},\n\n\t/* *********************** */\n\tupdateNode_nativeaudio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t\tSound.alloc_nativeaudio(node);\n\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\ttry {\n\t\t\t\t\tglobal.plugins.NativeAudio.play (node.snd.r.data, null, null, function() { Sound.onended_nativeaudio(node); } );\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_nativeaudio(node);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tglobal.plugins.NativeAudio.stop (node.snd.r.data, null);\n\n\t\t\t\tSound.free_nativeaudio(node);\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_nativeaudio: function (node)\n\t{\n\t\tSound.updateNode_nativeaudio (node, 'stop');\n\t},\n\n\tupdateNode_audio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tvar volume = Sound.MASTER.volume * node.snd.track.volume * node.volume;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t{\n\t\t\t\t\tnode.res = Sound.alloc_audio (node.snd.r.data);\n\t\t\t\t\tnode.res.node = node;\n\t\t\t\t\tnode.res.src = node.res._src;\n\t\t\t\t}\n\n\t\t\t\tnode.playTime = hrnow();\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.onended = Sound.onended_audio;\n\t\t\t\tnode.res.currentTime = node.startTime/1000.0;\n\t\t\t\tnode.res.volume = volume;\n\n\t\t\t\ttry {\n\t\t\t\t\tnode.res.play();\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_audio (node.res);\n\t\t\t\t\tnode.res = null;\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.res.volume = volume;\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\n\t\t\t\t\tSound.free_audio (node.res);\n\t\t\t\t\tnode.res = null;\n\t\n\t\t\t\t\tif (node.callback) node.callback();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tSound.unregister (node);\n\t\t\t\tnode.res.pause();\n\n\t\t\t\tSound.free_audio (node.res);\n\t\t\t\tnode.res = null;\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime += hrnow() - node.playTime;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = true;\n\n\t\t\t\tSound.unregister (node);\n\t\t\t\tnode.res.pause();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_audio: function (e)\n\t{\n\t\tvar node = e.currentTarget.node;\n\n\t\tif (node.playing && node.loop != 0)\n\t\t{\n\t\t\tif (node.loop != -1)\n\t\t\t\tnode.loop--;\n\n\t\t\tnode.startTime = 0;\n\t\t\tnode.playing = false;\n\t\t\tnode.pause = false;\n\n\t\t\tSound.updateNode_audio (node, 'play');\n\t\t\treturn;\n\t\t}\n\n\t\tnode.res.onended = null;\n\t\tnode.res.volume = 0;\n\n\t\tSound.updateNode_audio (node, 'stop');\n\t},\n\n\t/* *************************************** */\n\t/* PUBLIC */\n\n\tenableTrack: function (track)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.enabled = true;\n\t},\n\n\tdisableTrack: function (track)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.enabled = false;\n\t},\n\n\tsetVolume: function (track, value)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.volume = value;\n\t},\n\n\tcreateNode: function (snd, volume)\n\t{\n\t\tvar node = { };\n\n\t\tnode.startVolume = volume;\n\t\tnode.volume = volume;\n\t\tnode.snd = snd;\n\t\tnode.loop = 0;\n\t\tnode.playing = false;\n\t\tnode.paused = false;\n\t\tnode.startTime = 0;\n\t\tnode.playTime = 0;\n\t\tnode.callback = null;\n\t\tnode.timer = null;\n\t\tnode.res = null;\n\n\t\treturn node;\n\t},\n\n\tplay: function (snd, completeCallback, volume)\n\t{\n\t\tif (!this.MASTER.enabled || !snd || !snd.track.enabled)\n\t\t\treturn null;\n\n\t\tvar volume = (volume !== undefined && volume !== null) ? volume : 1.0;\n\n\t\tvar node = this.createNode(snd, volume);\n\t\tnode.callback = completeCallback;\n\n\t\treturn this.updateNode(node, 'play');\n\t},\n\n\tplayLoop: function (snd, completeCallback, volume)\n\t{\n\t\tif (!this.MASTER.enabled || !snd || !snd.track.enabled)\n\t\t\treturn null;\n\n\t\tvolume = (volume !== undefined && volume !== null) ? volume : 1.0;\n\t\n\t\tvar node = this.createNode(snd, volume);\n\t\tnode.callback = completeCallback;\n\t\tnode.loop = -1;\n\n\t\treturn this.updateNode(node, 'play');\n\t},\n\n\tstop: function (node, callback)\n\t{\n\t\tif (!node) return null;\n\n\t\tif (callback && callback !== true) node.callback = callback;\n\t\treturn this.updateNode(node, callback === true ? 'stop' : 'softstop');\n\t},\n\n\tpause: function (node)\n\t{\n\t\tif (!node) return null;\n\n\t\treturn this.updateNode(node, 'pause');\n\t},\n\n\tresume: function (node)\n\t{\n\t\tif (!node) return null;\n\n\t\treturn this.updateNode (node, 'play');\n\t},\n\n\tfadeOut: function (node, millis, callback)\n\t{\n\t\tif (!node) return;\n\n\t\tif (!node.playing || node.timer)\n\t\t{\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar startTime = hrnow();\n\t\tnode.startVolume = node.volume;\n\n\t\tnode.timer = setInterval (function()\n\t\t{\n\t\t\tvar t = ((hrnow() - startTime) / millis);\n\t\t\tif (t > 1) t = 1;\n\n\t\t\tnode.volume = node.startVolume*(1-t);\n\t\t\tSound.updateNode(node, 'setvolume');\n\n\t\t\tif (t == 1)\n\t\t\t{\n\t\t\t\tclearInterval (node.timer);\n\t\t\t\tnode.timer = null;\n\n\t\t\t\tif (callback === true)\n\t\t\t\t\tSound.updateNode(node, 'stop');\n\t\t\t\telse\n\t\t\t\t\tSound.updateNode(node, 'pause');\n\n\t\t\t\tif (callback && callback !== true)\n\t\t\t\t\tcallback();\n\t\t\t}\n\t\t},\n\t\t50);\n\t},\n\n\tfadeIn: function (node, millis, callback)\n\t{\n\t\tif (!node) return;\n\n\t\tif (node.playing || node.timer)\n\t\t{\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar startTime = hrnow();\n\n\t\tnode.volume = 0;\n\t\tthis.updateNode(node, 'play');\n\n\t\tnode.timer = setInterval (function()\n\t\t{\n\t\t\tvar t = ((hrnow() - startTime) / millis);\n\t\t\tif (t > 1) t = 1;\n\n\t\t\tnode.volume = node.startVolume*t;\n\t\t\tSound.updateNode(node, 'setvolume');\n\n\t\t\tif (t == 1)\n\t\t\t{\n\t\t\t\tclearInterval (node.timer);\n\t\t\t\tnode.timer = null;\n\n\t\t\t\tif (callback) callback();\n\t\t\t}\n\t\t},\n\t\t50);\n\t}\n});\n\n/**\n * \tCreates a descriptor for an audio resource.\n */\nResources.Audio = function (src, opts=null)\n{\n\treturn { type: \"audio\", wrapper: \"Sound\", src: src, ...opts };\n};\n\nexport default Sound;\n","\nimport { Rinn } from 'rinn';\nimport System from '../system/system.js';\nimport Canvas from '../system/canvas.js';\nimport Log from '../system/log.js';\n\n//[import '../system/system']\n//[import '../system/canvas']\n//[import '../system/log']\n\nconst Resources = { };\n\nimport * as Wrappers from './wrappers.js';\n\nlet reported = false;\n\n\n//!namespace Resources\n\n\t//!type ConfigOptions =\n\n\t\t/**\n\t\t * Enables integer scaling. When enabled, calling `resizeImage` with `pixelated` parameter set to `true` will cause images to be resized to integer\n\t\t * factors. When disabled, images will be resized using the half/double method to eventually end up reaching the exact target size.\n\t\t *\n\t\t * @default true\n\t\t * !integerScalingEnabled?: boolean;\n\t\t */\n\t\t/**\n\t\t * Default value for the `pixelated` parameter of image resources. Controls whether to use integer scaling when resizing images.\n\t\t * \n\t\t * @default false\n\t\t * !pixelated?: boolean;\n\t\t */\n\t\t/**\n\t\t * Default value for the `filter` parameter of image resources. When an image does not have the `pixelated` property nor `filter`, this value will be used.\n\t\t * \n\t\t * @default LINEAR\n\t\t * !filter?: 'LINEAR'|'NEAREST';\n\t\t */\n\t\t/**\n\t\t * Default value for the `original` parameter of image resources. When set to `true`, no resizing at all will take place on the image resources and the\n\t\t * original image will be used as-is.\n\t\t * \n\t\t * @default false\n\t\t * !original?: boolean;\n\t\t */\n\n\t//!/type\n\n//!/namespace\n\n//:/**\n//: * Provides functionality to load and manipulate resources (images, audio, etc).\n//: */\n\n//!class Resources\n\nObject.assign(Resources,\n{\n\t/**\n\t * Enables integer scaling. When enabled, calling `resizeImage` with `pixelated` parameter set to `true` will cause images to be resized to integer\n\t * factors. When disabled, images will be resized using the half/double method to eventually end up reaching the exact target size.\n\t *\n\t * @default true\n\t * !static integerScalingEnabled: boolean;\n\t */\n\tintegerScalingEnabled: true,\n\n\t/**\n\t * Default value for the `pixelated` parameter of image resources. Controls whether to use integer scaling when resizing images. Also controls the default\n\t * scaling filter (LINEAR/NEAREST) the image will use when converted to a WebGL2 texture.\n\t * \n\t * @default false\n\t * !static pixelated: boolean;\n\t */\n\tpixelated: false,\n\n\t/**\n\t * Default value for the `filter` parameter of image resources. When an image does not have the `pixelated` property nor `filter`, this value will be used.\n\t * \n\t * @default LINEAR\n\t * !static filter: 'LINEAR'|'NEAREST';\n\t */\n\tfilter: 'LINEAR',\n\n\t/**\n\t * Default value for the `original` parameter of image resources. When set to `true`, no resizing will take place on the image resource at all and the\n\t * original will be used as-is.\n\t * \n\t * @default false\n\t * !static original: boolean;\n\t */\n\toriginal: false,\n\n\t/**\n\t * Configures the resources object with the specified options.\n\t * !static config (options: Resources.ConfigOptions) : void;\n\t */\n\tconfig: function (opts)\n\t{\n\t\tif (opts !== null)\n\t\t\tObject.assign(this, opts);\n\t},\n\n\t/**\n\t * Loads a list of resources. The list parameter is actually a dictionary with objects as shown in the example below.\n\t *\n\t * { type: \"image\", wrapper: \"\", src: \"assets/ui/btn-left.png\", width: 64, \\[ height: 64 \\], scale: 1, pixelated: false, filter: null, original: false }\n\t * { type: \"images\", wrapper: \"\", src: \"assets/ui/##.png\", count: 16, width: 64, \\[ height: 64 \\], pixelated: false }\n\t * { type: \"audio\", wrapper: \"\", src: \"assets/ui/tap.wav\", track: \"sfx|music\" }\n\t * { type: \"audios\", wrapper: \"\", src: \"assets/ui/snd-##.wav\", count: 4 }\n\t * { type: \"json\", wrapper: \"\", src: \"assets/config.json\" }\n\t * { type: \"data\", wrapper: \"\", src: \"assets/config.dat\" }\n\t * { type: \"text\", wrapper: \"\", src: \"assets/config.frag\" }\n\t * { type: \"object\", wrapper: \"\" }\n\t *\n\t * @param list - Map of resources to load.\n\t * @param progressCallback - Executed once for every resource loaded.\n\t * @param completeCallback - Executed when all resources have been loaded.\n\t * !static load (list: { \\[id: string\\] : object }, progressCallback: (index: number, count: number, ratio: number, name: string) => void, completeCallback: (list: { \\[id: string\\] : object }) => void) : void;\n\t */\n\tload: function (list, progressCallback, completeCallback, keyList, index)\n\t{\n\t\tif (!keyList)\n\t\t{\n\t\t\tkeyList = Object.keys(list);\n\n\t\t\tfor (let i in keyList)\n\t\t\t{\n\t\t\t\tif (!('__loaded' in list[keyList[i]]))\n\t\t\t\t\tlist[keyList[i]].__clone = Rinn.clone(list[keyList[i]]);\n\t\t\t}\n\n\t\t\tindex = 0;\n\t\t}\n\n\t\twhile (index < keyList.length && ('__loaded' in list[keyList[index]]))\n\t\t\tindex++;\n\n\t\tif (progressCallback)\n\t\t\tprogressCallback (index, keyList.length, index / keyList.length, index < keyList.length ? keyList[index] : null);\n\n\t\tif (index == keyList.length)\n\t\t{\n\t\t\tif (completeCallback)\n\t\t\t\tcompleteCallback(list);\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet r = list[keyList[index]];\n\t\tr.resName = keyList[index];\n\n\t\tlet src, d0, d1, dN, cb;\n\n\t\tswitch (r.type)\n\t\t{\n\t\t\tcase \"image\":\n\t\t\t\tr.data = new Image ();\n\t\t\t\tr.data.onload = async function ()\n\t\t\t\t{\n\t\t\t\t\tconst ratio = r.data.width / r.data.height;\n\n\t\t\t\t\tif (r.scale) {\n\t\t\t\t\t\tr.width = int(r.data.width*r.scale);\n\t\t\t\t\t\tr.height = int(r.data.height*r.scale);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!r.hasOwnProperty('extraScale'))\n\t\t\t\t\t\tr.extraScale = 0.0;\n\n\t\t\t\t\tif (!r.width && !r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.width = r.data.width;\n\t\t\t\t\t\tr.height = r.data.height;\n\t\t\t\t\t}\n\t\t\t\t\telse if (r.width && !r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.height = int(r.width / ratio);\n\t\t\t\t\t}\n\t\t\t\t\telse if (!r.width && r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.width = int(ratio * r.height);\n\t\t\t\t\t}\n\n\t\t\t\t\t//TODO remove this comment if nothing explodes after removing owidth and oheight.\n\t\t\t\t\t//r.owidth = r.data.width;\n\t\t\t\t\t//r.oheight = r.data.height;\n\n\t\t\t\t\tif (!r.hasOwnProperty('filter'))\n\t\t\t\t\t\tr.filter = !r.hasOwnProperty('pixelated') ? Resources.filter : (r.pixelated === true ? 'NEAREST' : Resources.filter);\n\n\t\t\t\t\tif (!r.hasOwnProperty('pixelated'))\n\t\t\t\t\t\tr.pixelated = Resources.pixelated;\n\n\t\t\t\t\tif (!r.hasOwnProperty('original'))\n\t\t\t\t\t\tr.original = Resources.original;\n\n\t\t\t\t\tif ((r.data.width != r.width || r.data.height != r.height || r.extraScale != 0.0) && r.original !== true)\n\t\t\t\t\t{\n//let t = hrnow(); //violet\n\t\t\t\t\t\tr.data = await Resources.resizeImage (r, r.width * (r.extraScale + (r.pixelated ? System.integerScaleFactor : System.scaleFactor)), r.height * (r.extraScale + (r.pixelated ? System.integerScaleFactor : System.scaleFactor)), r.pixelated, true);\n//console.log((hrnow() - t) + ': resize to ' + (r.width * (r.pixelated ? System.integerScaleFactor : System.scaleFactor)) + 'x' + (r.height * (r.pixelated ? System.integerScaleFactor : System.scaleFactor)));\n\t\t\t\t\t}\n\n\t\t\t\t\tr.rscale = r.data.width / r.width;\n\n\t\t\t\t\tr.data.rscale = r.rscale;\n\t\t\t\t\tr.data.filter = r.filter;\n\t\t\t\t\tr.data.targetWidth = r.width;\n\t\t\t\t\tr.data.targetHeight = r.height;\n\n\t\t\t\t\tif (r.hasOwnProperty('mipmap') && r.mipmap > 0)\n\t\t\t\t\t\tr.data.mipmap = r.mipmap;\n\n\t\t\t\t\t// Pre-draw on an offscreen canvas, used to prevent a delay when rendering an image for the first time on some browsers.\n\t\t\t\t\tSystem.tempDisplayBuffer.drawImage(r.data, 0, 0);\n\t\t\t\t\tSystem.renderer.prepareImage(r.data);\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index], () => {\n\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index+1);\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\tr.data.onerror = function () {\n\t\t\t\t\tconsole.error (\"Error: Unable to load: \" + r.resName);\n\t\t\t\t};\n\n\t\t\t\tr.data.src = r.src + \"?r=\" + Math.random();\n\t\t\t\tbreak;\n\n\t\t\tcase \"images\":\n\t\t\t\tsrc = r.src;\n\t\t\t\td0 = src.indexOf(\"#\");\n\t\t\t\td1 = src.lastIndexOf(\"#\");\n\t\t\t\tdN = d1 - d0 + 1;\n\n\t\t\t\tif (d0 == -1)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'src' attribute requires one or more '#' marks.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!r.count)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'count' attribute was not found.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tr._i = 0;\n\t\t\t\tr.data = [ ];\n\n\t\t\t\tcb = function ()\n\t\t\t\t{\n\t\t\t\t\tif (r._i == r.count)\n\t\t\t\t\t{\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index], () => {\n\t\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// TODO add support for extraScale\n\t\t\t\t\tlet tmp = { type: \"image\", width: r.width, height: r.height, scale: r.scale };\n\n\t\t\t\t\ttmp.src = r.src.substr(0, d0) + ((r._i++) / Math.pow(10,dN)).toFixed(dN).substr(2) + r.src.substr(d1+1);\n\t\t\t\t\ttmp.data = new Image ();\n\t\t\t\t\ttmp.resName = r.resName + \"#\" + (r._i - 1);\n\n\t\t\t\t\tif (progressCallback)\n\t\t\t\t\t\tprogressCallback (index, keyList.length, (index / keyList.length) + ((r._i-1)/r.count)*(1 / keyList.length), r.resName + '/' + (r._i-1));\n\n\t\t\t\t\ttmp.data.onload = async function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tlet ratio = tmp.data.width / tmp.data.height;\n\n\t\t\t\t\t\tif (tmp.scale)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = int(tmp.data.width*tmp.scale);\n\t\t\t\t\t\t\ttmp.height = int(tmp.data.height*tmp.scale);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!tmp.width && !tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = tmp.data.width;\n\t\t\t\t\t\t\ttmp.height = tmp.data.height;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (tmp.width && !tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.height = int(tmp.width / ratio);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!tmp.width && tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = int(ratio * tmp.height);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (r._i == 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tr.owidth = tmp.data.width;\n\t\t\t\t\t\t\tr.oheight = tmp.data.height;\n\n\t\t\t\t\t\t\tif (!r.hasOwnProperty('filter'))\n\t\t\t\t\t\t\t\tr.filter = !r.hasOwnProperty('pixelated') ? Resources.filter : (r.pixelated === true ? 'NEAREST' : Resources.filter);\n\n\t\t\t\t\t\t\tif (!r.hasOwnProperty('pixelated'))\n\t\t\t\t\t\t\t\tr.pixelated = Resources.pixelated;\n\n\t\t\t\t\t\t\tif (!r.hasOwnProperty('original'))\n\t\t\t\t\t\t\t\tr.original = Resources.original;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttmp.pixelated = r.pixelated;\n\t\t\t\t\t\ttmp.filter = r.filter;\n\t\t\t\t\t\ttmp.original = r.original;\n\n\t\t\t\t\t\tif ((tmp.data.width != tmp.width || tmp.data.height != tmp.height) && tmp.original !== true)\n\t\t\t\t\t\t{\n//let t = hrnow();//violet\n\t\t\t\t\t\t\ttmp.data = await Resources.resizeImage (tmp, tmp.width * (r.pixelated ? System.integerScaleFactor : System.scaleFactor), tmp.height * (tmp.pixelated ? System.integerScaleFactor : System.scaleFactor), tmp.pixelated, true);\n//console.log((hrnow() - t) + ': resize to ' + (tmp.width * (r.pixelated ? System.integerScaleFactor : System.scaleFactor)) + 'x' + (tmp.height * (r.pixelated ? System.integerScaleFactor : System.scaleFactor)));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttmp.rscale = tmp.data.width / tmp.width;\n\n\t\t\t\t\t\ttmp.data.rscale = tmp.rscale;\n\t\t\t\t\t\ttmp.data.filter = tmp.filter;\n\t\t\t\t\t\ttmp.data.targetWidth = tmp.width;\n\t\t\t\t\t\ttmp.data.targetHeight = tmp.height;\n\n\t\t\t\t\t\tif (r.hasOwnProperty('mipmap') && r.mipmap > 0)\n\t\t\t\t\t\t\ttmp.data.mipmap = r.mipmap;\n\t\n\t\t\t\t\t\tif (r._i == 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tr.width = tmp.width;\n\t\t\t\t\t\t\tr.height = tmp.height;\n\t\t\t\t\t\t\tr.rscale = tmp.rscale;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tSystem.tempDisplayBuffer.drawImage(tmp.data, 0, 0);\n\t\t\t\t\t\tSystem.renderer.prepareImage(tmp.data);\n\n\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\tcb();\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.onerror = function () {\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName);\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.src = tmp.src + \"?r=\" + Math.random();\n\t\t\t\t};\n\n\t\t\t\tcb();\n\t\t\t\tbreak;\n\n\t\t\tcase \"audio\":\n\t\t\t\tif (!r.track) r.track = \"sfx\";\n\n\t\t\t\tif (global.plugins && global.plugins.NativeAudio && r.track == \"sfx\")\n\t\t\t\t{\n\t\t\t\t\tif (!reported) {\n\t\t\t\t\t\tLog.write('ENGINE_NATIVEAUDIO');\n\t\t\t\t\t\treported = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tr.engine = Wrappers.Sound.ENGINE_NATIVEAUDIO;\n\t\t\t\t\tr.data = \"snd_\" + index;\n\n\t\t\t\t\tglobal.plugins.NativeAudio.preloadSimple(r.data, r.src,\n\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\tResources.onLoaded (list, keyList[index], () => {\n\t\t\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\t\t\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction(e) {\n\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load (sfx): \" + r.resName + \"\\n\" + e);\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (global.audioContext)\n\t\t\t\t{\n\t\t\t\t\tif (!reported) {\n\t\t\t\t\t\tLog.write('ENGINE_WEBAUDIO');\n\t\t\t\t\t\treported = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tr.engine = Wrappers.Sound.ENGINE_WEBAUDIO;\n\n\t\t\t\t\tfetchAudioBuffer (r.src + \"?r=\" + Math.random())\n\t\t\t\t\t.then (audioBuffer => {\n\t\t\t\t\t\tr.data = audioBuffer;\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index], () => {\n\t\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.catch (err => {\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName + \"\\n\" + err);\n\t\t\t\t\t});\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!reported) {\n\t\t\t\t\tLog.write('ENGINE_HTML5');\n\t\t\t\t\treported = true;\n\t\t\t\t}\n\n\t\t\t\tr.data = new Audio ();\n\t\t\t\tr.engine = Wrappers.Sound.ENGINE_HTML5;\n\n\t\t\t\tr.data.oncanplaythrough = function ()\n\t\t\t\t{\n\t\t\t\t\tResources.onLoaded (list, keyList[index],  () => {\n\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\tr.data.onerror = function ()\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName);\n\t\t\t\t};\n\n\t\t\t\tr.data.src = r.src + \"?r=\" + Math.random();\n\t\t\t\tbreak;\n\n\t\t\tcase \"audios\":\n\t\t\t\tsrc = r.src;\n\t\t\t\td0 = src.indexOf(\"#\");\n\t\t\t\td1 = src.lastIndexOf(\"#\");\n\t\t\t\tdN = d1 - d0 + 1;\n\n\t\t\t\tif (d0 == -1)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'src' attribute requires one or more '#' marks.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!r.count)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'count' attribute was not found.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tr._i = 0;\n\t\t\t\tr.data = [ ];\n\n\t\t\t\tcb = function ()\n\t\t\t\t{\n\t\t\t\t\tif (r._i == r.count)\n\t\t\t\t\t{\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index], () => {\n\t\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet tmp = { type: \"audio\", track: r.track };\n\n\t\t\t\t\ttmp.src = r.src.substr(0, d0) + ((r._i++) / Math.pow(10,dN)).toFixed(dN).substr(2) + r.src.substr(d1+1);\n\t\t\t\t\ttmp.resName = r.resName + \"#\" + (r._i - 1);\n\n\t\t\t\t\tif (!tmp.track) tmp.track = \"sfx\";\n\n\t\t\t\t\tif (global.plugins && global.plugins.NativeAudio && tmp.track == \"sfx\")\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_NATIVEAUDIO;\n\t\t\t\t\t\ttmp.data = \"snd_\" + index + \"_\" + r._i;\n\t\n\t\t\t\t\t\tglobal.plugins.NativeAudio.preloadSimple(tmp.data, tmp.src,\n\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\t\t\tcb();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfunction(e) {\n\t\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load (sfx): \" + tmp.resName + \"\\n\" + e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (global.audioContext)\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_WEBAUDIO;\n\n\t\t\t\t\t\tfetchAudioBuffer (tmp.src + \"?r=\" + Math.random())\n\t\t\t\t\t\t.then (audioBuffer => {\n\t\t\t\t\t\t\ttmp.data = audioBuffer;\n\t\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\t\tcb();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch (err => {\n\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName + \"\\n\" + err);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\ttmp.data = new Audio ();\n\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_HTML5;\n\n\t\t\t\t\ttmp.data.oncanplaythrough = function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\tcb();\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.onerror = function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName);\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.src = tmp.src + \"?r=\" + Math.random();\n\t\t\t\t};\n\n\t\t\t\tcb();\n\t\t\t\tbreak;\n\n\t\t\tcase \"json\":\n\n\t\t\t\tfetchd (r.src + \"?r=\" + Math.random(), { responseType: 'json' }).then(function(json)\n\t\t\t\t{\n\t\t\t\t\tr.data = json;\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index], () => {\n\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch(function(err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName + \"\\n\" + err);\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"data\":\n\n\t\t\t\tfetchd (r.src + \"?r=\" + Math.random()).then(function(arraybuffer)\n\t\t\t\t{\n\t\t\t\t\tr.data = arraybuffer;\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index], () => {\n\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch(function(err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName + \"\\n\" + err);\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"text\":\n\n\t\t\t\tfetchd (r.src + \"?r=\" + Math.random()).then(function(arrayBuffer)\n\t\t\t\t{\n\t\t\t\t\tr.data = String.fromCharCode.apply(null, new Uint8Array(arrayBuffer));\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index], () => {\n\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch(function(err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName + \"\\n\" + err);\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"object\":\n\t\t\t\tr.data = { };\n\n\t\t\t\tResources.onLoaded (list, keyList[index], () => {\n\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t}\n\t},\n\n\t/**\n\t * Unloads the specified list of resources.\n\t * !static unload (list: { \\[id: string\\] : object }) : void;\n\t */\n\tunload: function (list)\n\t{\n\t\tthrow new Error('IMPLEMENTED UNLOAD!');\n\n\t\tlet __original;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tif (i == \"__original\")\n\t\t\t{\n\t\t\t\t__original = list[i];\n\t\t\t\tdelete list[i];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (list[i].r)\n\t\t\t{\n\t\t\t\tdispose(list[i]);\n\t\t\t\tlist[i] = list[i].r;\n\t\t\t}\n\n\t\t\tswitch (list[i].type)\n\t\t\t{\n\t\t\t\tcase \"audio\":\n\t\t\t\t\t// TODO unload audio if using NativeAudio\n\t\t\t\t\t// global.plugins.NativeAudio.unload\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"audios\":\n\t\t\t\t\t// TODO unload audio if using NativeAudio\n\t\t\t\t\t// global.plugins.NativeAudio.unload\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"images\":\n\t\t\t\t\tfor (let j = 0; j < list[i].data.length; j++)\n\t\t\t\t\t\tdispose (list[i].data[j]);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tdispose (list[i].data);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tlist[i].data = null;\n\t\t\tdelete list[i];\n\t\t}\n\n\t\tfor (let i in __original)\n\t\t\tlist[i] = __original[i];\n\t},\n\n\t/**\n\t * Executes post-load actions on a resource.\n\t */\n\tonLoaded: function (list, index, callback)\n\t{\n\t\tlet r = list[index];\n\t\tif (!r.wrapper || !(r.wrapper in Wrappers))\n\t\t{\n\t\t\tcallback();\n\t\t\treturn;\n\t\t}\n\n\t\tlist[index] = new Wrappers[r.wrapper] (r);\n\n\t\tif ('init' in list[index])\n\t\t{\n\t\t\tlist[index].init(() => {\n\t\t\t\tlist[index].__loaded = true;\n\t\t\t\tcallback();\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\tlist[index].__loaded = true;\n\t\t\tcallback();\n\t\t}\n\t},\n\n\t/**\n\t * Loads an image, returns a promise.\n\t * !static loadImage (src: string) : Promise<HTMLImageElement>;\n\t */\n\tloadImage: function (url)\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst image = new Image();\n\t\t\timage.onload = () => resolve(image);\n\t\t\timage.onerror = () => reject(new Error('Unable to load image'));\n\t\t\timage.src = url;\n\t\t});\n\t},\n\n\t/**\n\t * Resizes the given image to the specified size.\n\t * !static resizeImage (image: HTMLImageElement, targetWidth: number, targetHeight: number, pixelated?: boolean, discardOriginal?: boolean) : HTMLImageElement|HTMLCanvasElement;\n\t */\n\tresizeImage: async function (image, dw, dh, pixelated, discardOriginal)\n\t{\n\t\tlet sw = image.data.width;\n\t\tlet sh = image.data.height;\n\n\t\tdw = int(dw);\n\t\tdh = int(dh);\n\n\t\tif (sw == dw && sh == dh)\n\t\t\treturn image.data;\n\n\t\tif (!this.integerScalingEnabled && pixelated) pixelated = null;\n\n\t\tif (!pixelated)\n\t\t{\n\t\t\tpixelated = pixelated === null ? false : true;\n\n\t\t\tlet temp = new Canvas ({ hidden: true, antialias: pixelated }).resize (sw, sh);\n\t\t\ttemp.drawImage (image.data, 0, 0);\n\n\t\t\twhile (true)\n\t\t\t{\n\t\t\t\tlet tw = sw >> 1;\n\t\t\t\tlet th = sh >> 1;\n\n\t\t\t\tif (tw <= dw || th <= dh)\n\t\t\t\t\tbreak;\n\n\t\t\t\tlet output = new Canvas ({ hidden: true, antialias: pixelated }).resize (tw, th);\n\t\t\t\toutput.drawImage (temp.elem, 0, 0, tw, th);\n\t\t\t\ttemp.dispose ();\n\n\t\t\t\tsw = tw;\n\t\t\t\tsh = th;\n\n\t\t\t\ttemp = output;\n\t\t\t}\n\n\t\t\tlet output = new Canvas ({ hidden: true, antialias: pixelated }).resize (dw, dh);\n\t\t\toutput.drawImage (temp.elem, 0, 0, dw, dh);\n\t\t\ttemp.dispose ();\n\n\t\t\tif (discardOriginal)\n\t\t\t\tdispose (image.data);\n\n\t\t\treturn await this.loadImage(output.toDataUrl());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (int(dw / sw) > 0)\n\t\t\t{\n\t\t\t\tlet ratio = int((dw / sw) + 0.9);\n\n\t\t\t\tdw = ratio * sw;\n\t\t\t\tdh = ratio * sh;\n\n\t\t\t\tlet rep_x = dw / sw;\n\t\t\t\tlet rep_y = dh / sh;\n\n\t\t\t\tlet output = new Canvas ({ hidden: true, antialias: false }).resize (dw, dh);\n\n\t\t\t\tlet temp = new Canvas ({ hidden: true, antialias: false }).resize (sw, sh);\n\t\t\t\ttemp.drawImage (image.data, 0, 0);\n\n\t\t\t\tfor (let j = 0; j < sh; j++)\n\t\t\t\t{\n\t\t\t\t\tlet s = temp.getImageData(0, j, sw, 1).data;\n\t\t\t\t\tlet sp = 0;\n\n\t\t\t\t\tfor (let i = 0; i < sw && sp < s.length; i++, sp += 4)\n\t\t\t\t\t{\n\t\t\t\t\t\toutput.fillStyle(\"rgba(\"+s[sp]+\",\"+s[sp+1]+\",\"+s[sp+2]+\",\"+(s[sp+3] / 255)+\")\");\n\t\t\t\t\t\toutput.fillRect(i*rep_x, j*rep_y, rep_x, rep_y);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttemp.dispose();\n\n\t\t\t\treturn await this.loadImage(output.toDataUrl());\n\t\t\t}\n\n\t\t\treturn this.resizeImage (image, dw, dh, null, discardOriginal);\n\t\t}\n\t},\n\n\t/**\n\t * Flips an image horizontally.\n\t * !static flipImageHorz (image: HTMLImageElement) : HTMLImageElement;\n\t */\n\tflipImageHorz: function (image)\n\t{\n\t\tlet temp = new Canvas ({ hidden: true }).resize (image.data.width, image.data.height);\n\n\t\ttemp.translate(image.data.width, 0);\n\t\ttemp.scale(-1, 1);\n\n\t\ttemp.drawImage (image.data, 0, 0);\n\t\treturn temp.elem;\n\t},\n\n\t/**\n\t * Flips an image vertically.\n\t * !static flipImageVert (image: HTMLImageElement) : HTMLImageElement;\n\t */\n\tflipImageVert: function (image)\n\t{\n\t\tlet temp = new Canvas ({ hidden: true }).resize (image.data.width, image.data.height);\n\n\t\ttemp.translate(0, image.data.height);\n\t\ttemp.scale(1, -1);\n\n\t\ttemp.drawImage (image.data, 0, 0);\n\t\treturn temp.elem;\n\t},\n\n\t/**\n\t * Forces the browser to show a download dialog.\n\t * !static showDownload (filename: string, dataUrl: string) : void;\n\t */\n\tshowDownload: function (filename, dataUrl)\n\t{\n\t\tlet link = document.createElement(\"a\");\n\t\tlink.href = dataUrl;\n\n\t\tlink.style.display = 'none';\n\t\tlink.download = filename;\n\t\tlink.target = \"_blank\";\n\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t},\n\n\t/**\n\t * Forces the browser to show a file selection dialog.\n\t * !static showFilePicker (allowMultiple: boolean, accept: string, callback: (files: Array<File>) => void) : void;\n\t */\n\tshowFilePicker: function (allowMultiple, accept, callback)\n\t{\n\t\tlet input = document.createElement(\"input\");\n\n\t\tinput.type = \"file\";\n\t\tinput.accept = accept;\n\t\tinput.style.display = 'none';\n\t\tinput.multiple = allowMultiple;\n\n\t\tdocument.body.appendChild(input);\n\n\t\tinput.onchange = function ()\n\t\t{\n\t\t\tcallback(input.files);\n\t\t};\n\n\t\tdocument.body.onfocus = function ()\n\t\t{\n\t\t\tdocument.body.onfocus = null;\n\t\t\tdocument.body.removeChild(input);\n\t\t};\n\n\t\tinput.click();\n\t},\n\n\t/**\n\t * Loads a file using FileReader and returns the result as a dataURL.\n\t * !static loadAsDataURL (file: File, callback: (dataUrl: string) => void) : void;\n\t */\n\tloadAsDataURL: function (file, callback)\n\t{\n\t\tlet reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsDataURL(file);\n\t},\n\n\t/**\n\t * Loads a file using FileReader and returns the result as text.\n\t * !static loadAsText (file: File, callback: (text: string) => void) : void;\n\t */\n\tloadAsText: function (file, callback)\n\t{\n\t\tlet reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsText(file);\n\t},\n\n\t/**\n\t * Loads a file using FileReader and returns the result as an array buffer.\n\t * !static loadAsArrayBuffer (file: File, callback: (buff: ArrayBuffer) => void) : void;\n\t */\n\tloadAsArrayBuffer: function (file, callback)\n\t{\n\t\tlet reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsArrayBuffer(file);\n\t},\n\n\t/**\n\t * Loads an array of File objects using FileReader and returns them as data URLs.\n\t * !static loadAllAsDataURL (fileList: Array<File>, callback: (urlList: Array<{name:string, size:number, url:string}>) => void) : void;\n\t */\n\tloadAllAsDataURL: function (fileList, callback)\n\t{\n\t\tlet result = [];\n\n\t\tif (!fileList || !fileList.length)\n\t\t{\n\t\t\tcallback(result);\n\t\t\treturn;\n\t\t}\n\n\t\tlet loadNext = function (i)\n\t\t{\n\t\t\tif (i == fileList.length)\n\t\t\t{\n\t\t\t\tcallback(result);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tResources.loadAsDataURL (fileList[i], function(url) {\n\t\t\t\tresult.push({ name: fileList[i].name, size: fileList[i].size, url: url });\n\t\t\t\tloadNext(i+1);\n\t\t\t});\n\t\t};\n\n\t\tloadNext(0);\n\t}\n});\n\n//!/class\n\nexport default Resources;\n","\nimport { Class } from 'rinn';\nimport Sound from './sound.js';\n\n//![import \"./sound.js\"]\n\n/*\n\ttrack: string (music|sfx)\n\tmode: sequential|random\n*/\n\nexport default Class.extend\n({\n\tr: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"audios\")\n\t\t\tthrow new Error (\"Resource is not audios.\");\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tif (!this.r.track)\n\t\t\tthis.r.track = \"sfx\";\n\n\t\tif (!this.r.mode)\n\t\t\tthis.r.mode = \"random\";\n\n\t\tthis.track = Sound[this.r.track.toUpperCase()];\n\n\t\tthis.sounds = [];\n\t\tthis.lastIndex = -1;\n\n\t\tfor (var i = 0; i < this.r.data.length; i++)\n\t\t{\n\t\t\tthis.sounds.push(new Sound (Object.assign (this.r.data[i], { track: this.r.track })));\n\t\t}\n\t},\n\n\tgetRandomSound: function ()\n\t{\n\t\tif (this.r.mode == \"random\")\n\t\t\treturn this.sounds[randr(0, this.sounds.length-1)];\n\n\t\tthis.lastIndex = ++this.lastIndex % this.sounds.length;\n\t\treturn this.sounds[this.lastIndex];\n\t},\n\n\tplay: function (callback, volume)\n\t{\n\t\treturn Sound.play (this.getRandomSound(), callback, volume);\n\t},\n\n\tplayLoop: function (callback, volume)\n\t{\n\t\treturn Sound.playLoop (this.getRandomSound(), callback, volume);\n\t},\n\n\tplayAt: function (index, callback, volume)\n\t{\n\t\treturn Sound.play (this.sounds[index % this.sounds.length], callback, volume);\n\t},\n\n\tplayLoopAt: function (index, callback, volume)\n\t{\n\t\treturn Sound.playLoop (this.sounds[index % this.sounds.length], callback, volume);\n\t}\n});\n","\n//![import './drawable']\nimport _Drawable from './drawable.js'; export const Drawable = _Drawable;\n//![import './custom']\nimport _Custom from './custom.js'; export const Custom = _Custom;\n//![import './spritesheet']\nimport _Spritesheet from './spritesheet.js'; export const Spritesheet = _Spritesheet;\n//![import './spritesheet-animation']\nimport _SpritesheetAnimation from './spritesheet-animation.js'; export const SpritesheetAnimation = _SpritesheetAnimation;\n//![import './spritefont']\nimport _SpriteFont from './spritefont.js'; export const SpriteFont = _SpriteFont;\n//![import './sound']\nimport _Sound from './sound.js'; export const Sound = _Sound;\n//![import './sound-array']\nimport _SoundArray from './sound-array.js'; export const SoundArray = _SoundArray;\n","\nimport { Class } from 'rinn';\n\n//!class PriorityQueue\n\nexport default Class.extend\n({\n\tclassName: 'PriorityQueue',\n\n\tqueue: null,\n\tqueueKeys: null,\n\torder: null,\n\n\t/**\n\t * \tConstructs an priority queue.\n\t * \t!constructor();\n\t */\n\t__ctor: function()\n\t{\n\t\tthis.queue = { };\n\t\tthis.queueKeys = [];\n\t},\n\n\t/**\n\t * \tAdds an object to the priority queue.\n\t * \t!add (obj: object) : object;\n\t */\n\tadd: function (object)\n\t{\n\t\tif (object == null)\n\t\t\treturn null;\n\n\t\tif (!('priority' in object))\n\t\t\tobject.priority = 50;\n\n\t\tif (!(object.priority in this.queue))\n\t\t{\n\t\t\tthis.queue[object.priority] = { is_dirty: false, list: [ ] };\n\t\t\tthis.queueKeys.push(object.priority);\n\n\t\t\tthis.order = Object.keys(this.queue).sort((a,b) => a-b);\n\t\t}\n\n\t\tif (this.queue[object.priority].list.indexOf(object) === -1)\n\t\t\tthis.queue[object.priority].list.push(object);\n\n\t\treturn object;\n\t},\n\n\t/**\n\t * \tMarks an object to be removed from the priority queue. Use `cleanup` to actually remove them.\n\t * \t!remove (obj: object) : object;\n\t */\n\tremove: function (object)\n\t{\n\t\tif (object == null)\n\t\t\treturn null;\n\n\t\tif (!('priority' in object))\n\t\t\tobject.priority = 50;\n\n\t\tif (!(object.priority in this.queue))\n\t\t\treturn object;\n\n\t\tlet i = this.queue[object.priority].list.indexOf(object);\n\t\tif (i === -1) return object;\n\n\t\tthis.queue[object.priority].is_dirty = true;\n\t\tthis.queue[object.priority].list[i] = null;\n\n\t\treturn object;\n\t},\n\n\t/**\n\t * \tRuns a cleanup of the queue by removing any objects marked to be removed.\n\t * \t!cleanup() : void;\n\t */\n\tcleanup: function()\n\t{\n\t\tfor (let i = 0; i < this.queueKeys.length; i++)\n\t\t{\n\t\t\tlet q = this.queue[this.queueKeys[i]];\n\t\t\tif (!q.is_dirty) continue;\n\n\t\t\tfor (let j = 0; j < q.list.length; j++)\n\t\t\t{\n\t\t\t\tif (q.list[j] == null)\n\t\t\t\t{\n\t\t\t\t\tq.list.splice(j--, 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tq.is_dirty = false;\n\t\t}\n\t},\n\n\t/**\n\t * \tRuns the specified callback for each object in the queue. Executed in order of priority (from low number to high number).\n\t * \t@param callback - Return `false` to stop the forEach execution immediately.\n\t * \t!forEach (callback: (obj: object) => boolean) : void;\n\t */\n\tforEach: function (callback)\n\t{\n\t\tlet is_dirty = false;\n\t\tlet is_complete = false;\n\n\t\tfor (let i = 0; !is_complete && i < this.order.length; i++)\n\t\t{\n\t\t\tlet list = this.queue[this.order[i]].list;\n\n\t\t\tfor (let j = 0; !is_complete && j < list.length; j++)\n\t\t\t{\n\t\t\t\tif (list[j] != null)\n\t\t\t\t{\n\t\t\t\t\tif (callback(list[j]) === false)\n\t\t\t\t\t\tis_complete = true;\n\t\t\t\t}\n\n\t\t\t\tif (list[j] == null)\n\t\t\t\t\tis_dirty = true;\n\t\t\t}\n\t\t}\n\n\t\tif (is_dirty) this.cleanup();\n\t},\n\n\t/**\n\t * \tRuns the specified callback for each object in the queue. Executed in reverse order of priority (from high number to low number).\n\t * \t@param callback - Return `false` to stop the forEachRev execution immediately.\n\t * \t!forEachRev (callback: (obj: object) => boolean) : void;\n\t */\n\tforEachRev: function (callback)\n\t{\n\t\tlet is_dirty = false;\n\t\tlet is_complete = false;\n\n\t\tfor (let i = this.order.length-1; !is_complete && i >= 0; i--)\n\t\t{\n\t\t\tlet list = this.queue[this.order[i]].list;\n\n\t\t\tfor (let j = list.length-1; !is_complete && j >= 0; j--)\n\t\t\t{\n\t\t\t\tif (list[j] != null)\n\t\t\t\t{\n\t\t\t\t\tif (callback(list[j]) === false)\n\t\t\t\t\t\tis_complete = true;\n\t\t\t\t}\n\n\t\t\t\tif (list[j] == null)\n\t\t\t\t\tis_dirty = true;\n\t\t\t}\n\t\t}\n\n\t\tif (is_dirty) this.cleanup();\n\t},\n\n\t/**\n\t * \tRuns the specified callback for each object in the queue. Executed in order of priority (from low number to high number). When\n\t * \tthe cycle finishes the given `finishedCallback` will be executed.\n\t * \t@param callback - Return `false` to stop the forEachAsync execution immediately. Must manually execute `next` when finished.\n\t * \t!forEachAsync (callback: (obj: object, next: Function) => boolean) : void;\n\t */\n\tforEachAsync: function (callback, finishedCallback=null)\n\t{\n\t\tlet _ = this;\n\n\t\tlet is_dirty = false;\n\t\tlet is_complete = false;\n\n\t\tlet i = -1;\n\t\tlet j = -1;\n\n\t\tlet list = null;\n\n\t\tlet next_j = function()\n\t\t{\n\t\t\tj++;\n\n\t\t\tif (!is_complete && j < list.length)\n\t\t\t{\n\t\t\t\tif (list[j] != null)\n\t\t\t\t{\n\t\t\t\t\tif (callback(list[j], next_j) === false)\n\t\t\t\t\t\tis_complete = true;\n\t\t\t\t}\n\n\t\t\t\tif (list[j] == null)\n\t\t\t\t\tis_dirty = true;\n\n\t\t\t\tif (is_complete) next_j();\n\t\t\t}\n\t\t\telse\n\t\t\t\tnext_i();\n\t\t};\n\n\t\tlet next_i = function()\n\t\t{\n\t\t\ti++;\n\n\t\t\tif (!is_complete && i < _.order.length)\n\t\t\t{\n\t\t\t\tlist = _.queue[_.order[i]].list;\n\t\t\t\tj = -1;\n\t\t\t\tnext_j();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (is_dirty) _.cleanup();\n\t\t\t\tif (finishedCallback) finishedCallback();\n\t\t\t}\n\t\t};\n\n\t\tnext_i();\n\t},\n\n\t/**\n\t * \tRuns the specified callback for each object in the queue. Executed in reverse order of priority (from high number to low number). When\n\t * \tthe cycle finishes the given `finishedCallback` will be executed.\n\t * \t@param callback - Return `false` to stop the forEachRevAsync execution immediately. Must manually execute `next` when finished.\n\t * \t!forEachRevAsync (callback: (obj: object, next: Function) => boolean) : void;\n\t */\n\tforEachRevAsync: function (callback)\n\t{\n\t\talert('NOT IMPLEMENTED: forEachRevAsync');\n\t}\n});\n","\nimport { Class } from 'rinn';\nimport Recycler from './recycler.js';\nimport Callback from './callback.js';\n\n//![import \"./recycler\"]\n//![import \"./callback\"]\n\n//:/**\n//: * The handler class allows zero or more callbacks to be attached, such that when the `exec` method is invoked, all attached callbacks will also be executed.\n//: */\n\n//!class Handler\n\nconst Handler = Class.extend\n({\n\tclassName: 'Handler',\n\n\t/**\n\t * Handler host element or value.\n\t * !host: any;\n\t */\n\thost: null,\n\n\t/**\n\t * Top and bottom of the linked list.\n\t */\n\ttop: null,\n\tbottom: null,\n\n\t/**\n\t * Initializes the Handler instance.\n\t * !constructor (host?: any);\n\t */\n\t__ctor: function (host=null)\n\t{\n\t\tthis.host = host;\n\n\t\tthis.top = null;\n\t\tthis.bottom = null;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Removes all callbacks from the handler.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.remove();\n\t},\n\n\t/**\n\t * Adds the specified callback to the handler.\n\t * !add (callback: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) : Callback;\n\t */\n\tadd: function (callback, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tlet node = Callback.isInstance(callback) ? callback : Callback.Pool.alloc(callback, arg0, arg1, arg2, arg3, arg4, arg5);\n\n\t\tnode.prev = this.bottom;\n\n\t\tif (this.bottom !== null)\n\t\t\tthis.bottom.next = node;\n\n\t\tthis.bottom = node;\n\n\t\tif (this.top === null)\n\t\t\tthis.top = node;\n\n\t\treturn node;\n\t},\n\n\t/**\n\t * Removes a callback from the handler.\n\t * !unlink (node: Callback) : Handler;\n\t */\n\tunlink: function (node)\n\t{\n\t\tif (node.prev) node.prev.next = node.next;\n\t\tif (node.next) node.next.prev = node.prev;\n\n\t\tif (this.top === node)\n\t\t\tthis.top = node.next;\n\n\t\tif (this.bottom === node)\n\t\t\tthis.bottom = node.prev;\n\n\t\tnode.prev = null;\n\t\tnode.next = null;\n\n\t\tdispose(node);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Removes all callbacks matching the specified arguments.\n\t * !remove (callback?: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) : Handler;\n\t */\n\tremove: function (callback=null, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tif (callback !== null && Callback.isInstance(callback))\n\t\t{\n\t\t\tthis.unlink(callback);\n\t\t\treturn this;\n\t\t}\n\n\t\tlet node = this.top;\n\n\t\twhile (node !== null)\n\t\t{\n\t\t\tlet next = node.next;\n\n\t\t\tif (node.isEqual(callback, arg0, arg1, arg2, arg3, arg4, arg5))\n\t\t\t\tthis.unlink(node);\n\n\t\t\tnode = next;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the first callback matching the specified arguments.\n\t * !find (callback: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) : Callback;\n\t */\n\tfind: function (callback, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tlet node = this.top;\n\n\t\twhile (node !== null)\n\t\t{\n\t\t\tif (node.isEqual(callback, arg0, arg1, arg2, arg3, arg4, arg5))\n\t\t\t\treturn node;\n\n\t\t\tnode = node.next;\n\t\t}\n\n\t\treturn null;\n\t},\n\n\t/**\n\t * Executes all callbacks in the handler.\n\t * !exec (host?: any) : void;\n\t */\n\texec: function (host=null)\n\t{\n\t\tlet node = this.top;\n\n\t\thost = host ?? this.host;\n\n\t\twhile (node !== null)\n\t\t{\n\t\t\tlet next = node.next;\n\n\t\t\tlet value = node.exec(host);\n\t\t\tif (value === null) break;\n\n\t\t\tif (value === false)\n\t\t\t\tthis.unlink(node);\n\n\t\t\tnode = next;\n\t\t}\n\t},\n\n\t/**\n\t * Executes the first callback matching the specified arguments.\n\t * !execf (callback?: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) : void;\n\t */\n\texecf: function (callback=null, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tlet node = this.top;\n\n\t\twhile (node !== null)\n\t\t{\n\t\t\tlet next = node.next;\n\n\t\t\tif (node.isEqual(callback, arg0, arg1, arg2, arg3, arg4, arg5))\n\t\t\t{\n\t\t\t\tif (node.exec(this.host) === false)\n\t\t\t\t\tthis.unlink(node);\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tnode = next;\n\t\t}\n\t},\n\n\t/**\n\t * Executes the specified callback.\n\t * !execc (node: Callback, host?: any) : void;\n\t */\n\texecc: function (node, host=null)\n\t{\n\t\tif (node.exec(host ?? this.host) === false)\n\t\t\tthis.unlink(node);\n\t}\n});\n\n//!/class\n\n//!namespace Handler\n//!namespace Pool\n\n/**\n * \tAllocates a new handler instance.\n * \t!function alloc (host?: Object) : Handler;\n */\n\nRecycler.createPool(Handler, 16384, 6144);\nexport default Handler;\n","\nimport { Class } from 'rinn';\nimport Recycler from './recycler.js';\n\n//![import \"./recycler\"]\n\n//:/**\n//: * Defines a callback node. Contains a callback function, and up to six arguments.\n//: */\n\n//!class Callback\n\nconst Callback = Class.extend\n({\n\tclassName: 'Callback',\n\n\t/**\n\t * Callback function.\n\t */\n\tcallback: null,\n\n\t/**\n\t * Optional arguments.\n\t */\n\targ0: null,\n\targ1: null,\n\targ2: null,\n\targ3: null,\n\targ4: null,\n\targ5: null,\n\n\t/**\n\t * Links to the previous and next callbacks.\n\t */\n\tprev: null,\n\tnext: null,\n\n\t/**\n\t * Initializes the callback with the specified arguments.\n\t * !constructor (callback: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any);\n\t */\n\t__ctor: function (callback, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tthis.callback = callback;\n\n\t\tthis.arg0 = arg0;\n\t\tthis.arg1 = arg1;\n\t\tthis.arg2 = arg2;\n\t\tthis.arg3 = arg3;\n\t\tthis.arg4 = arg4;\n\t\tthis.arg5 = arg5;\n\n\t\tthis.prev = null;\n\t\tthis.next = null;\n\t},\n\n\t/**\n\t * Destructs the instance.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.callback = null;\n\n\t\tthis.arg0 = null;\n\t\tthis.arg1 = null;\n\t\tthis.arg2 = null;\n\t\tthis.arg3 = null;\n\t\tthis.arg4 = null;\n\t\tthis.arg5 = null;\n\n\t\tthis.prev = null;\n\t\tthis.next = null;\n\t},\n\n\t/**\n\t * Returns true if the specified arguments are the same as the callback. Compares from left to right. All `null` values are ignored.\n\t */\n\tisEqual: function (callback=null, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tif (callback !== null && Callback.isInstance(callback))\n\t\t\treturn callback === this;\n\n\t\tif (callback !== null && this.callback !== callback)\n\t\t\treturn false;\n\n\t\tif (arg0 !== null && this.arg0 !== arg0)\n\t\t\treturn false;\n\n\t\tif (arg1 !== null && this.arg1 !== arg1)\n\t\t\treturn false;\n\n\t\tif (arg2 !== null && this.arg2 !== arg2)\n\t\t\treturn false;\n\n\t\tif (arg3 !== null && this.arg3 !== arg3)\n\t\t\treturn false;\n\n\t\tif (arg4 !== null && this.arg4 !== arg4)\n\t\t\treturn false;\n\n\t\tif (arg5 !== null && this.arg5 !== arg5)\n\t\t\treturn false;\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tExecutes the callback. Returns `false` if the callback has finished and should be removed.\n\t * \t@param host - Host object.\n\t * \t!exec (host: Object) : boolean;\n\t */\n\texec: function (host)\n\t{\n\t\tif (this.callback !== null)\n\t\t\treturn this.callback (host, this.arg0, this.arg1, this.arg2, this.arg3, this.arg4, this.arg5);\n\n\t\treturn true;\n\t}\n});\n\n//!/class\n\n//!namespace Callback\n//!namespace Pool\n\n/**\n * \tAllocates a callback with the specified arguments.\n * \t!function alloc (callback: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) : Callback;\n */\n\nRecycler.createPool(Callback, 16384, 6144);\nexport default Callback;\n","\nimport { Class } from 'rinn';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"../utils/recycler\"]\n//![import \"./vec2\"]\n\n//:/**\n//: * \tRepresents a 2D rectangle.\n//: */\n\n//!class Rect\n\nconst Rect = Class.extend\n({\n\tclassName: 'Rect',\n\n\t/**\n\t * \tCoordinates of the rectangle (cx and cy are for the center). Note that this fields are readonly they should be\n\t * \tmodified through methods only.\n\t */\n\n\t/**\n\t * \t!readonly cx: number;\n\t */\n\tcx: 0,\n\t/**\n\t * \t!readonly cy: number;\n\t */\n\tcy: 0,\n\t/**\n\t * \t!readonly x1: number;\n\t */\n\tx1: 0,\n\t/**\n\t * \t!readonly y1: number;\n\t */\n\ty1: 0,\n\t/**\n\t * \t!readonly x2: number;\n\t */\n\tx2: 0,\n\t/**\n\t * \t!readonly y2: number;\n\t */\n\ty2: 0,\n\n\t/**\n\t * \tConstructs a rectangle of zero size, centered at (0, 0).\n\t * \t!constructor();\n\t */\n\t/**\n\t * \tConstructs a rectangle centered at (0, 0) with the specified size.\n\t * \t!constructor (width: number, height: number);\n\t */\n\t/**\n\t * \tConstructs a rectangle with the specified coordinates.\n\t * \t!constructor (x1: number, y1: number, x2: number, y2: number);\n\t */\n\t__ctor: function (x1=null, y1=null, x2=null, y2=null)\n\t{\n\t\tif (x1 === null)\n\t\t{\n\t\t\tthis.x1 = this.y1 = this.x2 = this.y2 = this.cx = this.cy = 0;\n\t\t\treturn this;\n\t\t}\n\n\t\tif (x2 === null)\n\t\t{\n\t\t\tthis.set (0, 0, 0, 0);\n\t\t\tthis.resize (x1, y1);\n\t\t\treturn this;\n\t\t}\n\n\t\treturn this.set(x1, y1, x2, y2);\n\t},\n\n\t/*\n\t**\tDestructor.\n\t*/\n\t__dtor: function ()\n\t{\n\t},\n\n\t/**\n\t * \tReturns a clone of the rectangle.\n\t * \t!clone() : Rect;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Rect.Rool.alloc(this.x1, this.y1, this.x2, this.y2);\n\t},\n\n\t/**\n\t * \tSets all coordinates of the rectangle to zero.\n\t * \t!zero() : Rect;\n\t */\n\tzero: function ()\n\t{\n\t\tthis.cx = 0; this.cy = 0;\n\t\tthis.x1 = 0; this.y1 = 0;\n\t\tthis.x2 = 0; this.y2 = 0;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets all coordinates of the rectangle to `null` for subsequent use with `extendWithPoint`.\n\t * \t!reset() : Rect;\n\t */\n\treset: function ()\n\t{\n\t\tthis.cx = null; this.cy = null;\n\t\tthis.x1 = null; this.y1 = null;\n\t\tthis.x2 = null; this.y2 = null;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tExtends the rectangle to contain the specified vector coordinates.\n\t * \t!extendWithPoint (v: Vec2) : Rect;\n\t */\n\t/**\n\t * \tExtends the rectangle to contain the specified point.\n\t * \t!extendWithPoint (x: number, y: number) : Rect;\n\t */\n\textendWithPoint: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tconst r = x;\n\t\t\tx = r.x;\n\t\t\ty = r.y;\n\t\t}\n\n\t\tif (this.x1 === null || x < this.x1) this.x1 = x;\n\t\tif (this.y1 === null || y < this.y1) this.y1 = y;\n\t\tif (this.x2 === null || x > this.x2) this.x2 = x;\n\t\tif (this.y2 === null || y > this.y2) this.y2 = y;\n\n\t\tthis.cx = (this.x1 + this.x2) / 2;\n\t\tthis.cy = (this.y1 + this.y2) / 2;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tTranslates the rectangle by the given deltas.\n\t * \t!translate (dx: number, dy: number) : Rect;\n\t */\n\ttranslate: function (dx, dy)\n\t{\n\t\tthis.x1 += dx; this.y1 += dy;\n\t\tthis.x2 += dx; this.y2 += dy;\n\t\tthis.cx += dx; this.cy += dy;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMoves the center of the rectangle to the specified position.\t \n\t * \t@param normalized - When `true` the arguments `x` and `y` are treated as normalized ranging from 0 to 1 (inclusive).\n\t * \t!centerAt (x: number, y: number, normalized?: false) : Rect;\n\t */\n\tcenterAt: function (x, y, normalized=false)\n\t{\n\t\tif (normalized == true)\n\t\t{\n\t\t\tx = this.x1 + x*(this.x2 - this.x1);\n\t\t\ty = this.y1 + y*(this.y2 - this.y1);\n\t\t}\n\n\t\treturn this.translate (x - this.cx, y - this.cy);\n\t},\n\n\t/**\n\t * \tCopies the coordinates of the specified rectangle.\n\t * \t!set (r: Rect) : Rect;\n\t */\n\t/**\n\t * \tSets the coordinates of the rectangle.\n\t * \t!set (x1: number, y1: number, x2: number, y2: number) : Rect;\n\t */\n\tset: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\tthis.cx = (x1 + x2) / 2;\n\t\tthis.cy = (y1 + y2) / 2;\n\n\t\tthis.x1 = x1;\n\t\tthis.y1 = y1;\n\t\tthis.x2 = x2;\n\t\tthis.y2 = y2;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns `true` if the given rectangle coordinates are equal.\n\t * \t!equals (r: Rect) : boolean;\n\t */\n\t/**\n\t * \tReturns `true` if the coordinates are equal.\n\t * \t!equals (x1: number, y1: number, x2: number, y2: number) : boolean;\n\t */\n\tequals: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\treturn x1 == this.x1 && x2 == this.x2 && y1 == this.y1 && y2 == this.y2;\n\t},\n\n\t/**\n\t * \tReturns `true` if the specified rectangle is contained in the current one.\n\t * \t!contains (r: Rect) : boolean;\n\t */\n\t/**\n\t * \tReturns `true` if the specified rectangle is contained in the current one.\n\t * \t!contains (x1: number, y1: number, x2: number, y2: number) : boolean;\n\t */\n\tcontains: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\treturn (x1 == Math.max(this.x1, x1)) && (y1 == Math.max(this.y1, y1)) && (x2 == Math.min(this.x2, x2)) && (y2 == Math.min(this.y2, y2));\n\t},\n\n\t/**\n\t * \tSets the coordinates of the rectangle to the union of it and the given one.\n\t * \t!setAsUnion (r: Rect) : Rect;\n\t */\n\t/**\n\t * \tSets the coordinates of the rectangle to the union of it and the given one.\n\t * \t!setAsUnion (x1: number, y1: number, x2: number, y2: number) : Rect;\n\t */\n\tsetAsUnion: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\tthis.x1 = Math.min(this.x1, x1);\n\t\tthis.y1 = Math.min(this.y1, y1);\n\t\tthis.x2 = Math.max(this.x2, x2);\n\t\tthis.y2 = Math.max(this.y2, y2);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns `true` if the rectangles intersect.\n\t * \t!intersects (r: Rect) : boolean;\n\t */\n\t/**\n\t * \tReturns `true` if the rectangles intersect.\n\t * \t!intersects (x1: number, y1: number, x2: number, y2: number) : boolean;\n\t */\n\tintersects: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\tlet _x1 = Math.max(this.x1, x1);\n\t\tlet _y1 = Math.max(this.y1, y1);\n\t\tlet _x2 = Math.min(this.x2, x2);\n\t\tlet _y2 = Math.min(this.y2, y2);\n\n\t\treturn Math.max(0, _y2-_y1) * Math.max(0, _x2-_x1) > 0;\n\t},\n\n\t/**\n\t * \tSets the coordinates of the rectangle to the intersection of it and the given one.\n\t * \t@returns Boolean indicating if the intersection is non-empty.\n\t * \t!setAsIntersection (r: Rect) : boolean;\n\t */\n\t/**\n\t * \tSets the coordinates of the rectangle to the intersection of it and the given one.\n\t * \t@returns Boolean indicating if the intersection is non-empty.\n\t * \t!setAsIntersection (x1: number, y1: number, x2: number, y2: number) : boolean;\n\t */\n\tsetAsIntersection: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\tthis.x1 = Math.max(this.x1, x1);\n\t\tthis.y1 = Math.max(this.y1, y1);\n\t\tthis.x2 = Math.min(this.x2, x2);\n\t\tthis.y2 = Math.min(this.y2, y2);\n\n\t\treturn Math.max(0, this.y2-this.y1) * Math.max(0, this.x2-this.x1) > 0;\n\t},\n\n\t/**\n\t * \tResizes the rectangle to the given size using its center or top-left corner as reference.\n\t * \t@param topLeftRelative - When `true` reference will be top-left corner, set to `false` to use the center.\n\t * \t@param normalized - When `true` the `w` and `h` will be treated as normalized ranging from 0 to 1 (inclusive).\n\t * \t!resize (w: number, h: number, normalized?: boolean, topLeftRelative?: boolean) : Rect;\n\t */\n\tresize: function (w, h, topLeftRelative=false, normalized=false)\n\t{\n\t\tif (normalized == true)\n\t\t{\n\t\t\tw *= (this.x2 - this.x1);\n\t\t\th *= (this.y2 - this.y1);\n\t\t}\n\n\t\tif (topLeftRelative == true)\n\t\t{\n\t\t\tthis.x2 = this.x1 + w;\n\t\t\tthis.y2 = this.y1 + h;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tw /= 2; h /= 2;\n\n\t\t\tthis.x1 = this.cx - w; this.y1 = this.cy - h;\n\t\t\tthis.x2 = this.cx + w; this.y2 = this.cy + h;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResizes the rectangle using the specified deltas, relative to its center or top-left corner.\n\t * \t@param topLeftRelative - When `true` reference will be top-left corner, set to `false` to use the center.\n\t * \t!resizeBy (dw: number, dh: number, topLeftRelative?: boolean) : Rect;\n\t */\n\tresizeBy: function (dw, dh, topLeftRelative=false)\n\t{\n\t\tif (topLeftRelative == true)\n\t\t{\n\t\t\tthis.x2 += dw;\n\t\t\tthis.y2 += dh;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdw /= 2; dh /= 2;\n\n\t\t\tthis.x1 -= dw; this.y1 -= dh;\n\t\t\tthis.x2 += dw; this.y2 += dh;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the width of the rectangle.\n\t * \t!width() : number;\n\t */\n\twidth: function ()\n\t{\n\t\treturn this.x2 - this.x1;\n\t},\n\n\t/**\n\t * \tReturns the height of the rectangle.\t \n\t * \t!height() : number;\n\t */\n\theight: function ()\n\t{\n\t\treturn this.y2 - this.y1;\n\t},\n\n\t/**\n\t * \tReturns the normalized center X-coordinate of the rectangle.\n\t * \t!ncx() : number;\n\t */\n\tncx: function ()\n\t{\n\t\treturn (this.cx - this.x1) / (this.x2 - this.x1);\n\t},\n\n\t/**\n\t * \tReturns the normalized center Y-coordinate of the rectangle.\n\t * \t!ncy() : number;\n\t */\n\tncy: function ()\n\t{\n\t\treturn (this.cy - this.y1) / (this.y2 - this.y1);\n\t},\n\n\t/**\n\t * \tReturns `true` if the rectangle is a right rectangle, that is: x1 < x2 and y1 < y2.\n\t * \t!isRight() : boolean;\n\t */\n\tisRight: function ()\n\t{\n\t\treturn this.x1 <= this.x2 && this.y1 <= this.y2;\n\t},\n\n\t/**\n\t * \tReturns `true` if the specified point is contained in the rectangle.\n\t * \t@param tol - Used to specify a tolerance value (default is zero).\n\t * \t!containsPoint (x: number, y: number, tol?: number) : boolean;\n\t */\n\tcontainsPoint: function (x, y, tol=0)\n\t{\n\t\treturn (this.x1-tol <= x && x <= this.x2+tol) && (this.y1-tol <= y && y <= this.y2+tol);\n\t},\n\n\t/**\n\t * \tReturns the area of the rectangle.\n\t * \t@param strict - Indicates if the area is returned only if the rectangle is a right rectangle. \t \n\t * \t!area (strict?: boolean) : number;\n\t */\n\tarea: function (strict)\n\t{\n\t\treturn strict ? (this.isRight() ? (this.y2-this.y1)*(this.x2-this.x1) : 0) : ((this.y2-this.y1)*(this.x2-this.x1));\n\t},\n\n\t/**\n\t * \tSets the components of the rectangle to their rounded-down integer parts.\n\t * \t!floor() : Rect;\n\t */\n\tfloor: function()\n\t{\n\t\tthis.x1 = Math.floor(this.x1);\n\t\tthis.y1 = Math.floor(this.y1);\n\t\tthis.x2 = Math.floor(this.x2);\n\t\tthis.y2 = Math.floor(this.y2);\n\t\tthis.cx = Math.floor(this.cx);\n\t\tthis.cy = Math.floor(this.cy);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the components of the rectangle to their rounded-up integer parts.\n\t * \t!ceil() : Rect;\n\t */\n\tceil: function()\n\t{\n\t\tthis.x1 = Math.ceil(this.x1);\n\t\tthis.y1 = Math.ceil(this.y1);\n\t\tthis.x2 = Math.ceil(this.x2);\n\t\tthis.y2 = Math.ceil(this.y2);\n\t\tthis.cx = Math.ceil(this.cx);\n\t\tthis.cy = Math.ceil(this.cy);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the string representation of the rectangle.\n\t * \t!toString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn \"(\" + this.x1.toFixed(2) + \", \" + this.y1.toFixed(2) + \", \" + this.x2.toFixed(2) + \", \" + this.y2.toFixed(2) + \")\";\n\t},\n\n\t/**\n\t * \tFlattens the rectangle.\n\t * \t!flatten() : Array<number>;\n\t */\n\tflatten: function ()\n\t{\n\t\treturn [this.x1, this.y1, this.x2, this.y2];\n\t},\n\n\t/**\n\t * \tUnflattens the rectangle.\n\t * \t!unflatten(input: Array<number>) : Rect;\n\t */\n\tunflatten: function (o)\n\t{\n\t\tthis.set (o[0], o[1], o[2], o[3]);\n\t\treturn this;\n\t}\n});\n\n//!/class\n\n//!namespace Rect\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a new rectangle of zero size.\n\t * \t!function alloc() : Rect;\n\t */\n\t/**\n\t * \tAllocates a new rectangle centered at (0, 0) with the specified size.\n\t * \t!function alloc (width: number, height: number) : Rect;\n\t */\n\t/**\n\t * \tAllocates a new rectangle with the specified coordinates.\n\t * \t!function alloc (x1: number, y1: number, x2: number, y2: number) : Rect;\n\t */\n\nRecycler.createPool (Rect, 4096, 2048);\nexport default Rect;\n","\nimport { Class } from 'rinn';\n\n//:/**\n//: * \tDescribes a function dependent of time (t-function), multiple sampling points (t,y) can be added, this class\n//: * \tprovides methods to access any value for a given time, or the integral of a time range.\n//: */\n\n//!class TFunction\n\nconst TFunction = Class.extend\n({\n\tclassName: 'TFunction',\n\n\t/**\n\t * \tContains the time values `t` in the t-function, for each time value there is a corresponding `y` and `f`.\n\t * \t!t: Array<number>;\n\t */\n\tt: null,\n\n\t/**\n\t * \tContains the values (y) for each of the time values (t) in the t-function.\n\t * \t!y: Array<number>;\n\t */\n\ty: null,\n\n\t/**\n\t * \tContains the easing function (f) for each of the time values (t).\n\t * \t!f: Array< (t:number) => number >;\n\t */\n\tf: null,\n\n\t/**\n\t * \tConstructs the time function.\n\t * \t@param value - Initial value of the t-function for t=0, defaults to 0.\n\t * \t!constructor (value?: number);\n\t */\n\t__ctor: function (value=0)\n\t{\n\t\tthis.reset(value);\n\t},\n\n\t/**\n\t * \tResets the t-function to its initial state.\n\t * \t@param value - Initial value of the t-function for t=0. Default is 0.\n\t * \t!reset (value?: number) : TFunction;\n\t */\n\treset: function (value=0)\n\t{\n\t\tthis.t = [0];\n\t\tthis.y = [value];\n\t\tthis.f = [null];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResets the t-function and copies data from the specified source.\n\t * \t@param src - Source TFunction.\n\t * \t@param t0 - Initial time, if none specified will be assumed to be the min time of the source.\n\t * \t@param t1 - Final time, if none specified will be assumed to the the max time of the source.\n\t * \t@returns A TFunction or `null` if the specified time range could not be resolved.\n\t * \t!copyFrom (src: TFunction, t0: number, t1: number) : TFunction;\n\t */\n\tcopyFrom: function (src, t0, t1)\n\t{\n\t\tthis.t = [];\n\t\tthis.y = [];\n\t\tthis.f = [];\n\n\t\tif (t0 == null && t1 == null)\n\t\t{\n\t\t\tfor (let i = 0; i < src.t.length; i++)\n\t\t\t{\n\t\t\t\tthis.t.push(src.t[i]);\n\t\t\t\tthis.y.push(src.y[i]);\n\t\t\t\tthis.f.push(src.f[i]);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\tif (t0 == null) t0 = src.t[0];\n\t\tif (t1 == null) t1 = src.t[src.t.length-1];\n\n\t\tif (t0 < src.t[0]) t0 = src.t[0];\n\n\t\tlet i0 = src.find(t0);\n\t\tlet i1 = src.find(t1);\n\n\t\tif (i0 == null) return null;\n\t\tif (i1 == null) return null;\n\n\t\tif (src.t[i0] != t0) {\n\t\t\tthis.set(t0, src.getAt(t0), src.f[i0]);\n\t\t\ti0++;\n\t\t}\n\n\t\tfor (let i = i0; i <= i1; i++)\n\t\t\tthis.set(src.t[i], src.y[i], src.f[i]);\n\n\t\tif (src.t[i1] != t1)\n\t\t{\n\t\t\tlet dt = (t1 - src.t[i1]) / Math.ceil(Math.log(t1 - src.t[i1]));\n\t\t\tlet t = this.t[this.t.length-1];\n\n\t\t\tif (dt <= 0) dt = 1;\ndt = t1-t; // Force just one step.\n\t\t\twhile (t != t1)\n\t\t\t{\n\t\t\t\tif (t+dt > t1)\n\t\t\t\t\tdt = t1 - t;\n\n\t\t\t\tt += dt;\n\t\t\t\tthis.set(float4(t), src.getAt(t), src.f[i1]);\n\t\t\t}\n\t\t}\n\t\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCreates a new t-function with the same values as the current one.\n\t * \t@param t0 - Initial time, if none specified will be assumed to be the min time of the source.\n\t * \t@param t1 - Final time, if none specified will be assumed to the the max time of the source.\n\t * \t!clone (t0: number, t1: number) : TFunction;\n\t */\n\tclone: function (t0, t1)\n\t{\n\t\treturn (new TFunction()).copyFrom(this, t0, t1);\n\t},\n\n\t/**\n\t * \tReturns the maximum time value in the t-function plus the given delta.\n\t * \t@param delta - Delta value to add to the result.\n\t * \t!endTime (delta?: number) : number;\n\t */\n\tendTime: function (delta=0)\n\t{\n\t\treturn this.t[this.t.length-1] + delta;\n\t},\n\n\t/**\n\t * \tReturns the start time of the t-function plus the given delta.\n\t * \t@param delta - Delta value to add to the result.\n\t * \t!startTime (delta?: number) : number;\n\t */\n\tstartTime: function (delta=0)\n\t{\n\t\treturn this.t[0] + delta;\n\t},\n\n\t/**\n\t * \tFinds the index of a sampling point whose sampling range contains the given time.\n\t * \t@param time - Time value to search.\n\t * \t@returns Index of the sampling point or `null` if not within range.\n\t * \t!find (time: number) : number|null;\n\t */\n\tfind: function (time)\n\t{\n\t\tif (time < this.t[0])\n\t\t\treturn null;\n\n\t\tconst n = this.t.length;\n\n\t\tfor (let i = 1; i < n; i++)\n\t\t{\n\t\t\tif (time < this.t[i])\n\t\t\t\treturn i-1;\n\t\t}\n\n\t\treturn n-1;\n\t},\n\n\t/**\n\t * \tSets a sampling point (t,y).\n\t * \t@param t - Time value of the sampling point.\n\t * \t@param y - Y-value for the given t.\n\t * \t@param f - Easing function.\n\t * \t!set (t: number, y: number, f?: (t: number) => number) : TFunction;\n\t */\n\tset: function (t, y, f=null)\n\t{\n\t\tlet i = this.find(t);\n\t\tif (i == null) return false;\n\n\t\tif (this.t[i] == t)\n\t\t{\n\t\t\tthis.y[i] = y;\n\t\t\tif (f != null) this.f[i] = f;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ti++;\n\t\t\tthis.t.splice(i, 0, t);\n\t\t\tthis.y.splice(i, 0, y);\n\t\t\tthis.f.splice(i, 0, f);\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tReturns the last Y-value in the t-function.\n\t *\t!get() : number;\n\t */\n\tget: function ()\n\t{\n\t\treturn this.y[this.y.length-1];\n\t},\n\n\t/**\n\t * \tReturns the Y-value in the t-function corresponding to some point in time (t).\n\t * \t@param t - Time (t) value.\n\t * \t!getAt (t: number) : number;\n\t */\n\tgetAt: function (t)\n\t{\n\t\tlet i0 = this.find(t);\n\t\tif (i0 == null) return 0;\n\n\t\tlet i1 = i0 + 1;\n\n\t\tif (this.t[i0] == t || i1 >= this.t.length || this.y[i0] == this.y[i1] || this.f[i0] == null)\n\t\t\treturn this.y[i0];\n\n\t\tif (this.f[i0] == null)\n\t\t\treturn this.y[i0];\n\n\t\tlet x = t;\n\t\tlet x0 = this.t[i0];\n\t\tlet x1 = this.t[i1];\n\t\tlet y0 = this.y[i0];\n\t\tlet y1 = this.y[i1];\n\n\t\tt = (x - x0) / (x1 - x0);\n\t\tt = this.f[i0](t);\n\n\t\treturn t*y1 + (1-t)*y0;\n\t},\n\n\t/**\n\t * \tReturns the approximate definite integral of the t-function for the given time range.\n\t * \t@param t0 - Initial time value, defaults to minimum time of the t-function.\n\t * \t@param t1 - Final time value, defaults to the maximum time of the t-function.\n\t * \t@param c0 - Constant of integration, defaults to 0.\n\t * \t@returns Definite integral of t-function from t0 to t1.\n\t * \t!integral (t0?: number, t1?: number, c0?: number) : number;\n\t */\n\tintegral: function (t0=null, t1=null, c0=0)\n\t{\n\t\tif (t0 == null) t0 = this.t[0];\n\t\tif (t1 == null) t1 = this.t[this.t.length-1];\n\n\t\tif (t0 < this.t[0]) t0 = this.t[0];\n\n\t\tlet sign = 1;\n\n\t\tif (t0 > t1) {\n\t\t\tlet tmp; tmp = t0; t0 = t1; t1 = tmp;\n\t\t\tsign = -1;\n\t\t}\n\n\t\tlet accum = c0;\n\n\t\tfor (let time = t0; time < t1; )\n\t\t{\n\t\t\tlet i0 = this.find(time);\n\t\t\tif (i0 == null) return 0;\n\n\t\t\tlet i1 = i0 + 1;\n\n\t\t\tlet x0 = Math.max(this.t[i0], time);\n\t\t\tlet x1 = Math.min(i1 < this.t.length ? this.t[i1] : t1, t1);\n\n\t\t\tlet y0 = this.getAt(x0);\n\t\t\tlet y1 = this.getAt(x1);\n\n\t\t\tlet dx = x1 - x0;\n\t\t\tlet dy = y1 - y0;\n\n\t\t\tif (this.f[i0] == null)\n\t\t\t\taccum += y0*dx;\n\t\t\telse\n\t\t\t\taccum += 0.5*dy*(x1+x0) - x0*dy + y0*dx;\n\n\t\t\ttime += dx;\n\t\t}\n\n\t\treturn sign*accum;\n\t},\n\n\t/**\n\t * \tReturns the approximate definite second integral of the t-function for the given time range.\n\t * \t@param t0 - Initial time value, defaults to minimum time of the t-function.\n\t * \t@param t1 - Final time value, defaults to the maximum time of the t-function.\n\t * \t@param c0 - Constant of integration, defaults to 0.\n\t * \t@returns Definite second integral of t-function from t0 to t1.\n\t * \t!integral (t0?: number, t1?: number, c0?: number) : number;\n\t */\n\tsecond_integral: function (t0=null, t1=null, c0=0)\n\t{\n\t\tif (t0 == null) t0 = this.t[0];\n\t\tif (t1 == null) t1 = this.t[this.t.length-1];\n\n\t\tlet a0 = TFunction.Temp1.copyFrom(this, this.t[0], t0).integrate(c0).integral();\n\t\tlet a1 = TFunction.Temp2.copyFrom(this, this.t[0], t1).integrate(c0).integral();\n\n\t\treturn a1 - a0;\n\t},\n\n\t/**\n\t * \tTransforms the t-function to its integral. For every sampling range in the t-function their Y-value will be set to the integral\n\t * \tof the sampling range plus any previous integrals.\n\t *\n\t * \t@param c0 - Constant of integration. Defaults to 0.\n\t * \t!integrate (c0?: number) : TFunction;\n\t */\n\tintegrate: function (c0=0)\n\t{\n\t\tlet y = [];\n\n\t\ty.push(c0);\n\n\t\tfor (let i = 1; i < this.t.length; i++)\n\t\t\ty.push(y[i-1] + this.integral(this.t[i-1], this.t[i]));\n\n\t\tthis.y = y;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tTransforms the t-function Y-values to the accumulated sum of each Y-value plus the given c0.\n\t * \t@param c0 - Initial value (defaults to 0).\n\t * \t!accumulate(c0?: number) : TFunction;\n\t */\n\taccumulate: function (c0=0)\n\t{\n\t\tthis.y[0] += c0;\n\n\t\tfor (let i = 1; i < this.t.length; i++)\n\t\t\tthis.y[i] += this.y[i-1];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tRemoves all sampling-points located before the given index.\n\t *\t!chopLeft (i: number) : TFunction;\n\t */\n\tchopLeft: function (i)\n\t{\n\t\tthis.t.splice(0, i);\n\t\tthis.f.splice(0, i);\n\t\tthis.y.splice(0, i);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tRemoves all sampling-points located after the given index.\n\t * \t!chopRight (i: number) : TFunction;\n\t */\n\tchopRight: function (i)\n\t{\n\t\tthis.t.splice(i+1, this.t.length-i-1);\n\t\tthis.f.splice(i+1, this.f.length-i-1);\n\t\tthis.y.splice(i+1, this.y.length-i-1);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMaps the Y-value to other Y-values using the specified mapping function.\n\t * \t@param fn - Receives parameters `y` (y-value), `t` (t-value), and `i` (index).\n\t * \t!map (fn: (y: number, t: number, i: number) => number) : TFunction;\n\t */\n\tmap: function (fn)\n\t{\n\t\tfor (let i = 0; i < this.y.length; i++)\n\t\t\tthis.y[i] = fn (this.y[i], this.t[i], i);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns a string representation of the variable state.\n\t * \t!toString (c0?: number) : string;\n\t */\n\ttoString: function(c0=0)\n\t{\n\t\tlet s = '';\n\t\tlet n = 10;\n\n\t\tconst pad = function (value, n, char)\n\t\t{\n\t\t\tvalue = value.toString();\n\n\t\t\tif (char == null) char = ' ';\n\t\t\tchar = char[0];\n\n\t\t\twhile (value.length < n)\n\t\t\t\tvalue += char;\n\n\t\t\treturn value;\n\t\t};\n\n\t\ts += '\\n';\n\t\ts += pad(' Time', n) + ' ' + pad(' Value', n) + ' ' + pad(' Integral', n) + '\\n';\n\t\ts += pad('', n, '-') + ' ' + pad('', n, '-') + ' ' + pad('', n, '-') + '\\n';\n\n\t\tfor (let i = 0; i < this.t.length; i++)\n\t\t{\n\t\t\ts += pad(' '+float4(this.t[i]), n) + ' ' + pad(' '+float4(this.y[i]), n) + ' ' + pad(' '+float4(this.integral(this.t[0], this.t[i], c0)), n) + '\\n';\n\t\t}\n\n\t\treturn s;\n\t}\n});\n\nTFunction.Temp1 = new TFunction();\nTFunction.Temp2 = new TFunction();\n\nexport default TFunction;\n","\nimport { Class } from 'rinn';\nimport Recycler from '../utils/recycler.js';\nimport Point2 from './point2.js';\nimport Rect from './rect.js';\n\n//![import \"../utils/recycler\"]\n//![import \"./point2\"]\n//![import \"./rect\"]\n\n//:/**\n//: * \tRepresentation of a bounding box in 2D space. The component values are upscaled by a fixed number of bits to allow sub-pixel\n//: * \ttranslations (internally), but the public values will always be integers.\n//: */\n\n//!class Bounds2\n\nconst Bounds2 = Class.extend\n({\n\tclassName: 'Bounds2',\n\n\t/**\n\t * \tCoordinates of the bounds (cx and cy are for the center). Note that this fields are read only and should be\n\t * \tmodified through methods only.\n\t */\n\n\t/**\n\t * \t!readonly cx: number;\n\t */\n\tcx: 0,\n\t/**\n\t * \t!readonly cy: number;\n\t */\n\tcy: 0,\n\t/**\n\t * \t!readonly x1: number;\n\t */\n\tx1: 0,\n\t/**\n\t * \t!readonly y1: number;\n\t */\n\ty1: 0,\n\t/**\n\t * \t!readonly x2: number;\n\t */\n\tx2: 0,\n\t/**\n\t * \t!readonly y2: number;\n\t */\n\ty2: 0,\n\n\t/**\n\t * \tUpscaled coordinates.\n\t */\n\tucx: 0, ucy: 0,\n\tux1: 0, uy1: 0,\n\tux2: 0, uy2: 0,\n\n\t/**\n\t * !constructor ();\n\t */\n\t/**\n\t * !constructor (bounds: Bounds2);\n\t */\n\t/**\n\t * !constructor (rect: Rect);\n\t */\n\t/**\n\t * !constructor (width: number, height: number);\n\t */\n\t/**\n\t * !constructor (x1: number, y1: number, x2: number, y2: number, upscaled?: boolean|false);\n\t */\n\t__ctor: function (x1=null, y1=null, x2=null, y2=null, upscaled=false)\n\t{\n\t\tif (x1 === null)\n\t\t{\n\t\t\tthis.ux1 = this.uy1 = this.ux2 = this.uy2 = this.ucx = this.ucy = 0;\n\t\t\treturn this.downscale();\n\t\t}\n\n\t\tif (y1 !== null && x2 === null)\n\t\t\treturn this.set(0, 0, 0, 0).resize(x1, y1);\n\n\t\treturn this.set(x1, y1, x2, y2, upscaled);\n\t},\n\n\t/**\n\t * Populates the downscaled components.\n\t */\n\tdownscale: function ()\n\t{\n\t\tthis.x1 = downscale(this.ux1);\n\t\tthis.y1 = downscale(this.uy1);\n\t\tthis.x2 = downscale(this.ux2);\n\t\tthis.y2 = downscale(this.uy2);\n\t\tthis.cx = downscale(this.ucx);\n\t\tthis.cy = downscale(this.ucy);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Truncates the components to remove fractional parts.\n\t * !trunc() : Bounds2;\n\t */\n\ttrunc: function ()\n\t{\n\t\tthis.ux1 = upscale(this.x1);\n\t\tthis.uy1 = upscale(this.y1);\n\t\tthis.ux2 = upscale(this.x2);\n\t\tthis.uy2 = upscale(this.y2);\n\t\tthis.ucx = upscale(this.cx);\n\t\tthis.ucy = upscale(this.cy);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Clones the bounds and returns a new object.\n\t * !clone() : Bounds2;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Bounds2.Pool.alloc(this.ux1, this.uy1, this.ux2, this.uy2, true);\n\t},\n\n\t/**\n\t * Sets the components to zero.\n\t * !zero() : Bounds2;\n\t */\n\tzero: function ()\n\t{\n\t\tthis.ux1 = 0; this.uy1 = 0;\n\t\tthis.ux2 = 0; this.uy2 = 0;\n\t\tthis.ucx = 0; this.ucy = 0;\n\n\t\treturn this.downscale();\n\t},\n\n\t/**\n\t * Resets the component values to `null` for subsequent use with `setAsUnion`.\n\t * !reset() : Bounds2;\n\t */\n\treset: function ()\n\t{\n\t\tthis.ux1 = null; this.uy1 = null;\n\t\tthis.ux2 = null; this.uy2 = null;\n\t\tthis.ucx = null; this.ucy = null;\n\n\t\tthis.x1 = null; this.y1 = null;\n\t\tthis.x2 = null; this.y2 = null;\n\t\tthis.cx = null; this.cy = null;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Translates the bounds by the given deltas.\n\t * !translate (point: Point2) : Bounds2;\n\t */\n\t/**\n\t * Translates the bounds by the given deltas.\n\t * !translate (vec: Vec2) : Bounds2;\n\t */\n\t/**\n\t * Translates the bounds by the given deltas.\n\t * !translate (dx: number, dy: number, upscaled?: boolean) : Bounds2;\n\t */\n\ttranslate: function (dx, dy=null, upscaled=false)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tif (Point2.isInstance(dx)) {\n\t\t\t\tdy = dx.uy;\n\t\t\t\tdx = dx.ux;\n\t\t\t} else { // Vec2\n\t\t\t\tdy = upscale(dx.y);\n\t\t\t\tdx = upscale(dx.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (upscaled !== true) {\n\t\t\t\tdx = upscale(dx);\n\t\t\t\tdy = upscale(dy);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux1 += dx; this.uy1 += dy;\n\t\tthis.ux2 += dx; this.uy2 += dy;\n\t\tthis.ucx += dx; this.ucy += dy;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tSets the coordinates of the bounds.\n\t**\n\t**\tBounds2 set (Bounds2 b)\n\t**\tBounds2 set (Rect r)\n\t**\tBounds2 set (float x1, float y1, float x2, float y2, bool upscaled=false)\n\t*/\n\tset: function (x1, y1=null, x2=null, y2=null, upscaled=false)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.uy2;\n\t\t\t\tx2 = x1.ux2;\n\t\t\t\ty1 = x1.uy1;\n\t\t\t\tx1 = x1.ux1;\n\t\t\t} else {\n\t\t\t\ty2 = upscale(x1.y2);\n\t\t\t\tx2 = upscale(x1.x2);\n\t\t\t\ty1 = upscale(x1.y1);\n\t\t\t\tx1 = upscale(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (upscaled !== true) {\n\t\t\t\tx1 = upscale(x1);\n\t\t\t\ty1 = upscale(y1);\n\t\t\t\tx2 = upscale(x2);\n\t\t\t\ty2 = upscale(y2);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux1 = x1;\n\t\tthis.uy1 = y1;\n\t\tthis.ux2 = x2;\n\t\tthis.uy2 = y2;\n\n\t\tthis.ucx = (x1 + x2) >> 1;\n\t\tthis.ucy = (y1 + y2) >> 1;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tAdds the specified coordinates to the current ones.\n\t**\n\t**\tBounds2 add (Bounds2 b)\n\t**\tBounds2 add (Rect r)\n\t**\tBounds2 add (float x1, float y1, float x2, float y2, bool upscaled=false)\n\t*/\n\tadd: function (x1, y1=null, x2=null, y2=null, upscaled=false)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.uy2;\n\t\t\t\tx2 = x1.ux2;\n\t\t\t\ty1 = x1.uy1;\n\t\t\t\tx1 = x1.ux1;\n\t\t\t} else {\n\t\t\t\ty2 = upscale(x1.y2);\n\t\t\t\tx2 = upscale(x1.x2);\n\t\t\t\ty1 = upscale(x1.y1);\n\t\t\t\tx1 = upscale(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (upscaled !== true) {\n\t\t\t\tx1 = upscale(x1);\n\t\t\t\ty1 = upscale(y1);\n\t\t\t\tx2 = upscale(x2);\n\t\t\t\ty2 = upscale(y2);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux1 += x1;\n\t\tthis.uy1 += y1;\n\t\tthis.ux2 += x2;\n\t\tthis.uy2 += y2;\n\n\t\tthis.ucx += (x1 + x2) >> 1;\n\t\tthis.ucy += (y1 + y2) >> 1;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tReturns true if the integer coordinates have the same values as the given argument.\n\t**\n\t**\tbool equals (Bounds2 b)\n\t**\tbool equals (Rect r)\n\t**\tbool equals (float x1, float y1, float x2, float y2)\n\t*/\n\tequals: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.y2;\n\t\t\t\tx2 = x1.x2;\n\t\t\t\ty1 = x1.y1;\n\t\t\t\tx1 = x1.x1;\n\t\t\t} else {\n\t\t\t\ty2 = int(x1.y2);\n\t\t\t\tx2 = int(x1.x2);\n\t\t\t\ty1 = int(x1.y1);\n\t\t\t\tx1 = int(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx1 = int(x1);\n\t\t\ty1 = int(y1);\n\t\t\tx2 = int(x2);\n\t\t\ty2 = int(y2);\n\t\t}\n\n\t\treturn x1 == this.x1 && x2 == this.x2 && y1 == this.y1 && y2 == this.y2;\n\t},\n\n\t/*\n\t**\tReturns a bool indicating if the specified bounds are contained by the current bounds.\n\t**\n\t**\tbool contains (Bounds2 b)\n\t**\tbool contains (Rect r)\n\t**\tbool contains (float x1, float y1, float x2, float y2)\n\t*/\n\tcontains: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.y2;\n\t\t\t\tx2 = x1.x2;\n\t\t\t\ty1 = x1.y1;\n\t\t\t\tx1 = x1.x1;\n\t\t\t} else {\n\t\t\t\ty2 = int(x1.y2);\n\t\t\t\tx2 = int(x1.x2);\n\t\t\t\ty1 = int(x1.y1);\n\t\t\t\tx1 = int(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx1 = int(x1);\n\t\t\ty1 = int(y1);\n\t\t\tx2 = int(x2);\n\t\t\ty2 = int(y2);\n\t\t}\n\n\t\treturn (x1 == Math.max(this.x1, x1)) && (y1 == Math.max(this.y1, y1)) && (x2 == Math.min(this.x2, x2)) && (y2 == Math.min(this.y2, y2));\n\t},\n\n\t/*\n\t**\tExtends the coordinates to ensure the specified argument is contained.\n\t**\n\t**\tBounds2 setAsUnion (Bounds2 b)\n\t**\tBounds2 setAsUnion (Rect r)\n\t**\tBounds2 setAsUnion (Point2 p)\n\t**\tBounds2 setAsUnion (Vec2 v)\n\t**\tBounds2 setAsUnion (float x, float y)\n\t**\tBounds2 setAsUnion (float x1, float y1, float x2, float y2)\n\t*/\n\tsetAsUnion: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1))\n\t\t\t{\n\t\t\t\tthis.setAsUnion(x1.ux1, x1.uy1, true);\n\t\t\t\tthis.setAsUnion(x1.ux2, x1.uy2, true);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t\telse if (Rect.isInstance(x1))\n\t\t\t{\n\t\t\t\tthis.setAsUnion(x1.x1, x1.y1);\n\t\t\t\tthis.setAsUnion(x1.x2, x1.y2);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t\telse if (Point2.isInstance(x1))\n\t\t\t{\n\t\t\t\ty1 = x1.uy;\n\t\t\t\tx1 = x1.ux;\n\t\t\t}\n\t\t\telse // Vec2\n\t\t\t{\n\t\t\t\ty1 = upscale(x1.y);\n\t\t\t\tx1 = upscale(x1.x);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (y2 !== null)\n\t\t\t{\n\t\t\t\tthis.setAsUnion(x1, y1);\n\t\t\t\tthis.setAsUnion(x2, y2);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (x2 !== true)\n\t\t\t\t{\n\t\t\t\t\tx1 = upscale(x1);\n\t\t\t\t\ty1 = upscale(y1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.ux1 === null || x1 < this.ux1) this.ux1 = x1;\n\t\tif (this.uy1 === null || y1 < this.uy1) this.uy1 = y1;\n\t\tif (this.ux2 === null || x1 > this.ux2) this.ux2 = x1;\n\t\tif (this.uy2 === null || y1 > this.uy2) this.uy2 = y1;\n\n\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tReturns a bool indicating if the integer components of the bounds intersect with the specified argument.\n\t**\n\t**\tbool intersects (Bounds2 b)\n\t**\tbool intersects (Rect r)\n\t**\tbool intersects (float x1, float y1, float x2, float y2)\n\t*/\n\tintersects: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.y2;\n\t\t\t\tx2 = x1.x2;\n\t\t\t\ty1 = x1.y1;\n\t\t\t\tx1 = x1.x1;\n\t\t\t} else {\n\t\t\t\ty2 = int(x1.y2);\n\t\t\t\tx2 = int(x1.x2);\n\t\t\t\ty1 = int(x1.y1);\n\t\t\t\tx1 = int(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx1 = int(x1);\n\t\t\ty1 = int(y1);\n\t\t\tx2 = int(x2);\n\t\t\ty2 = int(y2);\n\t\t}\n\n\t\tlet _x1 = Math.max(this.x1, x1);\n\t\tlet _y1 = Math.max(this.y1, y1);\n\t\tlet _x2 = Math.min(this.x2, x2);\n\t\tlet _y2 = Math.min(this.y2, y2);\n\n\t\treturn Math.max(0, _y2-_y1) * Math.max(0, _x2-_x1) > 0;\n\t},\n\n\t/*\n\t**\tSets the bounds to the intersection formed by the current bounds and the given argument.\n\t**\n\t**\tBounds2 setAsIntersection (Bounds2 b)\n\t**\tBounds2 setAsIntersection (Rect r)\n\t**\tBounds2 setAsIntersection (float x1, float y1, float x2, float y2)\n\t*/\n\tsetAsIntersection: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.y2;\n\t\t\t\tx2 = x1.x2;\n\t\t\t\ty1 = x1.y1;\n\t\t\t\tx1 = x1.x1;\n\t\t\t} else {\n\t\t\t\ty2 = int(x1.y2);\n\t\t\t\tx2 = int(x1.x2);\n\t\t\t\ty1 = int(x1.y1);\n\t\t\t\tx1 = int(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx1 = int(x1);\n\t\t\ty1 = int(y1);\n\t\t\tx2 = int(x2);\n\t\t\ty2 = int(y2);\n\t\t}\n\n\t\tthis.ux1 = upscale(Math.max(this.x1, x1));\n\t\tthis.uy1 = upscale(Math.max(this.y1, y1));\n\t\tthis.ux2 = upscale(Math.min(this.x2, x2));\n\t\tthis.uy2 = upscale(Math.min(this.y2, y2));\n\n\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\n\t\tthis.downscale();\n\n\t\treturn Math.max(0, this.uy2-this.uy1) * Math.max(0, this.ux2-this.ux1) > 0;\n\t},\n\n\t/**\n\t * Resizes the bounds to the given size using the center or top-left as reference.\n\t * @param {number} width Use a value, or `true` to preserve aspect ratio, or `null` to keep it unchanged.\n\t * @param {number} height Use a value, or `true` to preserve aspect ratio, or `null` to keep it unchanged.\n\t * @param {boolean} topLeftRelative (default `false`)\n\t * !resize (width: number|boolean|null, height: number|boolean|null, topLeftRelative?: boolean) : Bounds2;\n\t */\n\tresize: function (width, height, topLeftRelative=false)\n\t{\n\t\twidth = width !== null ? (width !== true ? upscale(width) : true) : this.ux2 - this.ux1;\n\t\theight = height !== null ? (height !== true ? upscale(height) : true)  : this.uy2 - this.uy1;\n\n\t\tif (width === true)\n\t\t\twidth = height*this.ratio();\n\t\telse if (height === true)\n\t\t\theight = width/this.ratio();\n\n\t\tif (topLeftRelative === true)\n\t\t{\n\t\t\tthis.ux2 = this.ux1 + width;\n\t\t\tthis.uy2 = this.uy1 + height;\n\n\t\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\t\t}\n\t\telse\n\t\t{\n\t\t\twidth >>= 1; height >>= 1;\n\n\t\t\tthis.ux1 = this.ucx - width; this.uy1 = this.ucy - height;\n\t\t\tthis.ux2 = this.ucx + width; this.uy2 = this.ucy + height;\n\t\t}\n\n\t\treturn this.downscale();\n\t},\n\n\t/**\n\t * Resizes the bounds using the specified deltas (using the center or top-left corner as reference).\n\t * !resizeBy (dWidth: number|boolean, dHeight: number|boolean, topLeftRelative?: boolean) : Bounds2;\n\t */\n\tresizeBy: function (dWidth, dHeight, topLeftRelative=false)\n\t{\n\t\tdWidth = dWidth !== true ? upscale(dWidth) : true;\n\t\tdHeight = dHeight !== true ? upscale(dHeight) : true;\n\n\t\tif (dWidth === true)\n\t\t\tdWidth = dHeight*this.ratio();\n\t\telse if (dHeight === true)\n\t\t\tdHeight = dWidth/this.ratio();\n\n\t\tif (topLeftRelative === true)\n\t\t{\n\t\t\tthis.ux2 += dWidth;\n\t\t\tthis.uy2 += dHeight;\n\n\t\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdWidth >>= 1; dHeight >>= 1;\n\n\t\t\tthis.ux1 -= dWidth; this.uy1 -= dHeight;\n\t\t\tthis.ux2 += dWidth; this.uy2 += dHeight;\n\t\t}\n\n\t\treturn this.downscale();\n\t},\n\n\t/**\n\t * Returns the width of the bounds.\n\t * !width(): number\n\t */\n\twidth: function ()\n\t{\n\t\treturn this.x2 - this.x1;\n\t},\n\n\t/**\n\t * Returns the height of the bounds.\n\t * !height(): number\n\t */\n\theight: function ()\n\t{\n\t\treturn this.y2 - this.y1;\n\t},\n\n\t/**\n\t * Returns the aspect ratio (width divided by height).\n\t * !ratio(): number\n\t */\n\tratio: function ()\n\t{\n\t\treturn (this.x2 - this.x1) / (this.y2 - this.y1);\n\t},\n\n\t/**\n\t * Returns true if the bounds are in forward position (x1 < x2 and y1 < y2).\n\t * !isForward() : boolean;\n\t */\n\tisForward: function ()\n\t{\n\t\treturn this.ux1 <= this.ux2 && this.uy1 <= this.uy2;\n\t},\n\n\t/**\n\t * Returns true if the specified point is within the bounds. The `tol` parameter is used to specify a tolerance value.\n\t * !containsPoint (x: number, y: number, tol?: number) : boolean;\n\t */\n\tcontainsPoint: function (x, y, tol=0)\n\t{\n\t\tx = upscale(x);\n\t\ty = upscale(y);\n\t\ttol = upscale(tol);\n\n\t\treturn (this.ux1-tol <= x && x <= this.ux2+tol) && (this.uy1-tol <= y && y <= this.uy2+tol);\n\t},\n\n\t/**\n\t * Returns the area of the bounds. When strict is true, the area will be returned only if the bounds are forward.\n\t * !area (strict?: boolean|false) : number;\n\t */\n\tarea: function (strict=false)\n\t{\n\t\treturn strict ? (this.isForward() ? (this.y2-this.y1)*(this.x2-this.x1) : 0) : ((this.y2-this.y1)*(this.x2-this.x1));\n\t},\n\n\t/**\n\t * Returns the string representation of the rect coordinates.\n\t * !toString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn '(' + this.x1 + ', ' + this.y1 + ', ' + this.x2 + ', ' + this.y2 + ')';\n\t},\n\n\t/**\n\t * Flattens the contents of the bounds.\n\t * !flatten() : \\[number,number,number,number\\];\n\t */\n\tflatten: function ()\n\t{\n\t\treturn [this.ux1, this.uy1, this.ux2, this.uy2];\n\t},\n\n\t/**\n\t * Unflattens the given array into the bounds object.\n\t * !unflatten (data: \\[number,number,number,number\\]) : Bounds2;\n\t */\n\tunflatten: function (x)\n\t{\n\t\tthis.ux1 = x[0];\n\t\tthis.uy1 = x[1];\n\t\tthis.ux2 = x[2];\n\t\tthis.uy2 = x[3];\n\n\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\n\t\treturn this.downscale();\n\t}\n});\n\n//!/class\n\n//!namespace Rect\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a new object of zero size.\n\t * \t!function alloc() : Bounds2;\n\t */\n\nRecycler.createPool (Bounds2, 8192, 3072);\nexport default Bounds2;\n","\nimport { Class } from 'rinn';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"../utils/recycler\"]\n//![import \"./vec2\"]\n\n//:/**\n//: * \tRepresentation of a point in 2D space. The coordinate values are upscaled by a fixed number of bits to allow\n//: * \tsub-pixel translations (internally), but the public values will always be integers.\n//: */\n\n//!class Point2\n\nconst Point2 = Class.extend\n({\n\tclassName: 'Point2',\n\n\t/**\n\t * \tUpscaled coordinates of the point.\n\t * \t!readonly ux: number;\n\t * \t!readonly uy: number;\n\t */\n\tux: 0, uy: 0,\n\n\t/**\n\t * \tCoordinates of the point.\n\t * \t!readonly x: number;\n\t * \t!readonly y: number;\n\t */\n\tx: 0, y: 0,\n\n\t/**\n\t *\tConstructs the Point2 instance from another Point2.\n\t * \t!constructor (value: Point2);\n\t */\n\t/**\n\t *\tConstructs the Point2 instance from a Vec2.\n\t * \t!constructor (value: Vec2);\n\t */\n\t/**\n\t *\tConstructs the Point2 instance with the specified coordinates.\n\t * \t!constructor (x?: number, y?: number);\n\t */\n\t__ctor: function (x=null, y=null)\n\t{\n\t\treturn this.set(x, y);\n\t},\n\n\t/**\n\t *\tPopulates the downscaled coordinates.\n\t */\n\tdownscale: function ()\n\t{\n\t\tthis.x = downscale(this.ux);\n\t\tthis.y = downscale(this.uy);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tClones the point coordinates into a new Point2 object.\n\t * \t!clone() : Point2;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Point2.Pool.alloc(this);\n\t},\n\n\t/**\n\t *\tSets the coordinates of the point from another Point2.\n\t *\t!set (value: Point2) : Point2;\n\t */\n\t/**\n\t *\tSets the coordinates of the point from a Vec2 object.\n\t *\t!set (value: Vec2) : Point2;\n\t */\n\t/**\n\t *\tSets the coordinates of the point.\n\t *\t@param upscaled - When `true` the specified values are assumed to have already been upscaled.\n\t *\n\t *\t!set (x: number, y: number, upscaled?: boolean) : Point2;\n\t */\n\tset: function (x, y=null, upscaled=false)\n\t{\n\t\tif (x === null) {\n\t\t\tx = 0;\n\t\t\ty = 0;\n\t\t}\n\t\telse if (y === null)\n\t\t{\n\t\t\tif (Point2.isInstance(x)) {\n\t\t\t\ty = x.uy;\n\t\t\t\tx = x.ux;\n\t\t\t} else { // Point2\n\t\t\t\ty = upscale(x.y);\n\t\t\t\tx = upscale(x.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (upscaled !== true) {\n\t\t\t\tx = upscale(x);\n\t\t\t\ty = upscale(y);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux = x;\n\t\tthis.uy = y;\n\n\t\treturn this.downscale(this);\n\t},\n\n\t/**\n\t * \tSets the X-coordinate of the point.\n\t * \t!setX (x: number) : Point2;\n\t */\n\tsetX: function (x)\n\t{\n\t\tthis.ux = upscale(x);\n\t\treturn this.downscale(this);\n\t},\n\n\t/**\n\t * \tSets the Y-coordinate of the point.\n\t * \t!setY (y: number) : Point2;\n\t */\n\tsetY: function (y)\n\t{\n\t\tthis.uy = upscale(y);\n\t\treturn this.downscale(this);\n\t},\n\n\t/**\n\t * \tSets the coordinates of the point to zero.\n\t * \t!zero() : Point2;\n\t */\n\tzero: function()\n\t{\n\t\treturn this.set(0, 0);\n\t},\n\n\t/**\n\t * \tReturns true if the point coordinates are both zero.\n\t * \t!isZero() : boolean;\n\t */\n\tisZero: function()\n\t{\n\t\treturn this.x == 0 && this.y == 0;\n\t},\n\n\t/**\n\t *\tReturns true if the coordinates of the point have the same values as the given Point2.\n\t *\t!equals (value: Point2) : boolean;\n\t */\n\t/**\n\t *\tReturns true if the coordinates of the point have the same values as the given Vec2.\n\t *\t!equals (value: Vec2) : boolean;\n\t */\n\t/**\n\t *\tReturns true if the coordinates of the point have the same values as the given ones.\n\t *\t!equals (x: number, y: number) : boolean;\n\t */\n\tequals: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tif (Point2.isInstance(x)) {\n\t\t\t\ty = x.y;\n\t\t\t\tx = x.x;\n\t\t\t} else { // Point2\n\t\t\t\ty = int(x.y);\n\t\t\t\tx = int(x.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tx = int(x);\n\t\t\ty = int(y);\n\t\t}\n\n\t\treturn this.x == x && this.y == y;\n\t},\n\n\t/**\n\t *\tAdds the coordinates of the given Point2 to the point.\n\t *\t!add (value: Point2) : Point2;\n\t */\n\t/**\n\t *\tAdds the coordinates of the given Vec2 to the point.\n\t *\t!add (value: Vec2) : Point2;\n\t */\n\t/**\n\t *\tAdds the given delta values to the point.\n\t *\t@param upscaled - When `true` the specified values are assumed to have already been upscaled.\n\t *\t!add (dx: number, dy: number, upscaled?: boolean) : Point2;\n\t */\n\tadd: function (dx, dy=null, upscaled=false)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tif (Point2.isInstance(dx)) {\n\t\t\t\tdy = dx.uy;\n\t\t\t\tdx = dx.ux;\n\t\t\t} else { // Point2\n\t\t\t\tdy = upscale(dx.y);\n\t\t\t\tdx = upscale(dx.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (upscaled !== true) {\n\t\t\t\tdx = upscale(dx);\n\t\t\t\tdy = upscale(dy);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux += dx, this.uy += dy;\n\t\treturn this.downscale();\n\t},\n\n\t/**\n\t *\tSubtracts the coordinates of the given Point2 from the point.\n\t *\t!sub (value: Point2) : Point2;\n\t */\n\t/**\n\t *\tSubtracts the coordinates of the given Vec2 from the point.\n\t *\t!sub (value: Vec2) : Point2;\n\t */\n\t/**\n\t *\tSubtracts the given delta values from the point.\n\t *\t@param upscaled - When `true` the specified values are assumed to have already been upscaled.\n\t *\t!sub (dx: number, dy: number, upscaled?: boolean) : Point2;\n\t */\n\tsub: function (dx, dy, upscaled=false)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tif (Point2.isInstance(dx)) {\n\t\t\t\tdy = dx.uy;\n\t\t\t\tdx = dx.ux;\n\t\t\t} else { // Point2\n\t\t\t\tdy = upscale(dx.y);\n\t\t\t\tdx = upscale(dx.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (upscaled !== true) {\n\t\t\t\tdx = upscale(dx);\n\t\t\t\tdy = upscale(dy);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux -= dx, this.uy -= dy;\n\t\treturn this.downscale();\n\t},\n\n\t/**\n\t * \tReturns the string representation of the coordinates of the point.\n\t * \ttoString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn `(${this.x}, ${this.y})`;\n\t}\n});\n\n//!/class\n\n//!namespace Point2\n//!namespace Pool\n\n/**\n *\tAllocates a Point2 instance from another Point2.\n * \t!function alloc (value: Point2) : Point2;\n */\n/**\n *\tAllocates a Point2 instance from a Vec2.\n * \t!function alloc (value: Vec2) : Point2;\n */\n/**\n *\tAllocates a Point2 instance with the specified coordinates.\n * \t!function alloc (x?: number, y?: number) : Point2;\n */\n\nRecycler.createPool (Point2, 2048, 1024);\nexport default Point2;\n","\n/**\n**\tCollection of useful easing functions.\n*/\n\n//!namespace Easing\n\nconst Easing =\n{\n\t/* ******************************************** */\n\t//!namespace Linear\n\tLinear:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Back\n\tBack:\n\t{\n\t\tk: 1.70158,\n\n\t\t/**\n\t\t * \t!function IN (t: number, k?: number) : number;\n\t\t */\n\t\tIN: function (t, k=null)\n\t\t{\n\t\t\tif (k === null) k = Easing.Back.k;\n\t\t\treturn t*t*((k+1)*t - k);\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number, k?: number) : number;\n\t\t */\n\t\tOUT: function (t, k=null)\n\t\t{\n\t\t\treturn 1 - Easing.Back.IN(1 - t, k);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number, k?: number) : number;\n\t\t */\n\t\tIN_OUT: function (t, k=null)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Back.IN(t*2, k)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Back.OUT((t-0.5)*2, k)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Bounce\n\tBounce:\n\t{\n\t\tgetConst: function (t)\n\t\t{\n\t\t\tif (t < 1.0/2.75)\n\t\t\t\treturn 7.5625 * t * t;\n\t\t\telse if (t < 2.0/2.75)\n\t\t\t\treturn 7.5625 * (t -= 1.5/2.75)*t + 0.75;\n\t\t\telse if (t < 2.5/2.75)\n\t\t\t\treturn 7.5625 * (t -= 2.250/2.75) * t + 0.9375;\n\n\t\t\treturn 7.5625 * (t -= 2.625/2.75) * t + 0.984375;\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Bounce.getConst(1-t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn Easing.Bounce.getConst(t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn (1 - Easing.Bounce.getConst(1-2*t))/2;\n\t\t\telse\n\t\t\t\treturn (Easing.Bounce.getConst((t-0.5)*2)/2)+0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Circ\n\tCirc:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Math.sqrt(1 - t*t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Circ.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\t\treturn Easing.Circ.IN(t*2)/2;\n\t\t\t\telse\n\t\t\t\t\treturn Easing.Circ.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Cubic\n\tCubic:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Cubic.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Cubic.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Cubic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Expo\n\tExpo:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn Math.pow(2, 12*(t-1));\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn -Math.pow(2, -12*t) + 1;\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif ((t *= 2) < 1)\n\t\t\t\treturn Math.pow (2, 12 * (t - 1)) / 2;\n\t\t\telse\n\t\t\t\treturn (-Math.pow (2, -12 * (t - 1)) + 2) / 2;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Power\n\tPower:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number, p?: number) : number;\n\t\t */\n\t\tIN: function (t, p=12)\n\t\t{\n\t\t\treturn Math.pow(t, p);\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number, p?: number) : number;\n\t\t */\n\t\tOUT: function (t, p=12)\n\t\t{\n\t\t\treturn 1 - Easing.Power.IN(1 - t, p);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number, p?: number) : number;\n\t\t */\n\t\tIN_OUT: function (t, p=12)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Power.IN(t*2, p)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Power.OUT((t-0.5)*2, p)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Quad\n\tQuad:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quad.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Quad.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Quad.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Quartic\n\tQuartic:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t*t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quartic.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Quartic.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Quartic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Quintic\n\tQuintic:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t*t*t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quintic.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\t\treturn Easing.Quintic.IN(t*2)/2;\n\t\t\t\telse\n\t\t\t\t\treturn Easing.Quintic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Sine\n\tSine:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Math.sin (1.5708 * (1 - t));\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn Math.sin (1.5708 * t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn (Math.cos (3.1416*t) - 1) / -2;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Step\n\tStep:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t}\n\t}\n};\n\nexport default Easing;\n","\nimport { Class } from 'rinn';\nimport List from '../utils/list.js';\nimport Recycler from '../utils/recycler.js';\nimport sys from '../fxl/system.js';\n\n//![import \"../utils/list\"]\n//![import \"../utils/recycler\"]\n\nimport Block from './block.js';\nimport Command from './command.js';\n\n//![import \"./block\"]\n//![import \"./command\"]\n\nimport PARALLEL from './parallel.js';\nimport SERIAL from './serial.js';\nimport REPEAT from './repeat.js';\nimport SET from './set.js';\nimport RESTART from './restart.js';\nimport WAIT from './wait.js';\nimport RANGE from './range.js';\nimport RAND from './rand.js';\nimport RANDT from './randt.js';\nimport EXEC from './exec.js';\nimport PLAY from './play.js';\n\n//:/**\n//: * \tClass to animate properties using commands.\n//: */\n\n//!class Anim\n\nconst Anim = Class.extend\n({\n\tclassName: 'Anim',\n\n\tinitialData: null,\n\tblockStack: null,\n\tcmdStack: null,\n\tblock: null,\n\n\tfinishedCallback: null,\n\tfinishedCallbackHandler: null,\n\tfinishedCallbackContext: null,\n\n\t/**\n\t * Current output data object.\n\t * !data: object;\n\t */\n\tdata: null,\n\n\t/**\n\t * Current time scale (animation speed).\n\t * !readonly timeScale: number;\n\t */\n\ttimeScale: 1,\n\n\t/**\n\t * Current logical time.\n\t * !time: number;\n\t */\n\ttime: 0,\n\n\t/**\n\t * Indicates if the animation is paused.\n\t * !readonly paused: boolean;\n\t */\n\tpaused: false,\n\n\t/**\n\t * Indicates if the animation has finished.\n\t * !readonly finished: boolean;\n\t */\n\tfinished: false,\n\n\t/**\n\t * Indicates if the animation is running.\n\t * !readonly running: boolean;\n\t */\n\trunning: false,\n\n\t/**\n\t * Indicates if the anim should be automatically disposed when finished.\n\t * !autoDispose: boolean;\n\t */\n\tautoDispose: false,\n\n\t/**\n\t * Constructs a new empty Anim object.\n\t * @returns {Anim}\n\t * !constructor ();\n\t */\n\t__ctor: function ()\n\t{\n\t\t// VIOLET: Possibly optimize this { } objects.\n\t\tthis.initialData = { };\n\t\tthis.data = { };\n\n\t\tthis.block = Block.alloc();\n\t\tthis.blockStack = List.Pool.alloc();\n\t\tthis.cmdStack = List.Pool.alloc();\n\n\t\tthis.running = false;\n\t\tthis.autoDispose = false;\n\n\t\tthis.finishedCallback = null;\n\t\tthis.finishedCallbackHandler = null;\n\t\tthis.finishedCallbackContext = null;\n\n\t\treturn this.reset();\n\t},\n\n\t/**\n\t * Destructor.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis.block.free();\n\t\tthis.blockStack.clear().free();\n\t\tthis.cmdStack.clear().free();\n\n\t\tif (this.finishedCallbackHandler !== null)\n\t\t{\n\t\t\tthis.finishedCallbackHandler.free();\n\t\t\tthis.finishedCallbackHandler = null;\n\t\t}\n\n\t\tif (this.finishedCallbackContext !== null)\n\t\t{\n\t\t\tthis.finishedCallbackContext.free();\n\t\t\tthis.finishedCallbackContext = null;\n\t\t}\n\t},\n\n\t/**\n\t * Copies the anim to the specified target and returns it.\n\t * @param {Anim} target \n\t * @returns {Anim}\n\t * !copyTo (target: Anim) : Anim;\n\t */\n\tcopyTo: function (target)\n\t{\n\t\ttarget.clear();\n\n\t\tdispose(target.block);\n\t\ttarget.block = this.block.clone();\n\n\t\ttarget.initialData = this.initialData;\n\t\treturn target.reset();\n\t},\n\n\t/**\n\t * Returns a clone of the anim.\n\t * @param {boolean} autoDispose - If true, the new anim will be disposed when finished.\n\t * @returns {Anim}\n\t * !clone (autoDispose?: boolean) : Anim;\n\t */\n\tclone: function (autoDispose=false)\n\t{\n\t\tlet anim = new Anim();\n\t\tanim.autoDispose = autoDispose;\n\n\t\tthis.copyTo(anim);\n\t\treturn anim;\n\t},\n\n\t/**\n\t * Sets the callback to be called when the animation finishes.\n\t * @param {(anim: Anim, data: object) => boolean} callback\n\t * @returns {Anim}\n\t * !onFinished (callback: (anim: Anim, data: object) => boolean) : Anim;\n\t */\n\tonFinished: function (callback)\n\t{\n\t\tthis.finishedCallback = callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Adds the specified callback to be called when the animation finishes.\n\t * @param {(anim: Anim, context?: object) => boolean} callback\n\t * @param {object} context\n\t * @returns {Anim}\n\t * !then (callback: (anim: Anim, context?: object) => boolean, context?: object) : Anim;\n\t */\n\tthen: function (callback, context=null)\n\t{\n\t\tif (!callback) return this;\n\n\t\tif (this.finishedCallback !== this.thenCallback)\n\t\t{\n\t\t\tthis.finishedCallback = this.thenCallback;\n\n\t\t\tif (this.finishedCallbackHandler === null)\n\t\t\t{\n\t\t\t\tthis.finishedCallbackHandler = List.Pool.alloc();\n\t\t\t\tthis.finishedCallbackContext = List.Pool.alloc();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.finishedCallbackHandler.reset();\n\t\t\t\tthis.finishedCallbackContext.reset();\n\t\t\t}\n\t\t}\n\n\t\tthis.finishedCallbackHandler.push(callback);\n\t\tthis.finishedCallbackContext.push(context);\n\t\treturn this;\n\t},\n\n\tthenCallback: function (data, self)\n\t{\n\t\tif (!self.finishedCallbackHandler.length)\n\t\t\treturn false;\n\n\t\tlet context = self.finishedCallbackContext.shift();\n\t\treturn self.finishedCallbackHandler.shift()(self, context);\n\t},\n\n\t/**\n\t * Clears the object by removing all commands and callbacks. The `initialData` and `data` objects aren't changed.\n\t * @returns {Anim}\n\t * !clear() : Anim;\n\t */\n\tclear: function ()\n\t{\n\t\tthis.blockStack.clear();\n\t\tthis.cmdStack.clear();\n\t\tthis.block.clear();\n\n\t\tthis.paused = false;\n\t\tthis.finished = false;\n\t\tthis.time = 0;\n\t\tthis.timeScale = 1;\n\n\t\tif (this.finishedCallbackHandler !== null)\n\t\t{\n\t\t\tthis.finishedCallbackHandler.free();\n\t\t\tthis.finishedCallbackHandler = null;\n\t\t}\n\n\t\tif (this.finishedCallbackContext !== null)\n\t\t{\n\t\t\tthis.finishedCallbackContext.free();\n\t\t\tthis.finishedCallbackContext = null;\n\t\t}\n\n\t\tthis.finishedCallback = null;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Resets the animation to its initial state.\n\t * @returns {Anim}\n\t * !reset() : Anim;\n\t */\n\treset: function ()\n\t{\n\t\tthis.blockStack.clear();\n\t\tthis.cmdStack.clear();\n\t\tthis.block.reset();\n\n\t\tthis.paused = false;\n\t\tthis.finished = false;\n\t\tthis.time = 0;\n\t\tthis.timeScale = 1;\n\n\t\tObject.assign (this.data, this.initialData);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Cleans up the animation so new commands can be added. Callbacks are not removed.\n\t * @returns {Anim}\n\t * !cleanup() : Anim;\n\t */\n\tcleanup: function ()\n\t{\n\t\tthis.blockStack.clear();\n\t\tthis.cmdStack.clear();\n\t\tthis.block.clear();\n\n\t\tthis.paused = false;\n\t\tthis.finished = false;\n\t\tthis.time = 0;\n\t\tthis.timeScale = 1;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the initial data of the anim.\n\t * @param {object} data\n\t * @returns {Anim}\n\t * !initial (data: object) : Anim;\n\t */\n\t/**\n\t * Sets the anim's data to the initial values.\n\t * @returns {Anim}\n\t * !initial() : Anim;\n\t */\n\tinitial: function (data=null)\n\t{\n\t\tif (data !== null)\n\t\t\tthis.initialData = data;\n\n\t\tObject.assign (this.data, this.initialData);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the time scale (animation speed) to the specified value.\n\t * @param {number} value - The new time scale, should be greater than 0.\n\t * @returns {Anim}\n\t * !speed (value: number) : Anim;\n\t */\n\tspeed: function (value)\n\t{\n\t\tthis.timeScale = value > 0.0 ? value : 1.0;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the output data object.\n\t * @param {object} data \n\t * @returns {Anim}\n\t * !output (data: object) : Anim;\n\t */\n\toutput: function (data)\n\t{\n\t\tthis.data = data;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Pauses the animation.\n\t * @returns {Anim}\n\t * !pause() : Anim;\n\t */\n\tpause: function ()\n\t{\n\t\tif (!this.paused)\n\t\t\tthis.paused = true;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Resumes the animation.\n\t * @returns {Anim}\n\t * !resume() : Anim;\n\t */\n\tresume: function ()\n\t{\n\t\tthis.finished = false;\n\t\tthis.paused = false;\n\n\t\tif (!this.running)\n\t\t\tthis.run(false);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Starts the animation.\n\t * @param {boolean} reset - If true, the animation will be reset to its initial state.\n\t * @returns {Anim}\n\t * !run (reset?: boolean) : Anim;\n\t */\n\trun: function (reset=true)\n\t{\n\t\tif (this.running)\n\t\t\treturn this;\n\n\t\tif (reset == true)\n\t\t\tthis.reset();\n\n\t\tsys.update.add(this.update, this);\n\t\tthis.running = true;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a field.\n\t * @param {string|Function} fieldName \n\t * @param {*} value \n\t */\n\tsetValue: function (fieldName, value)\n\t{\n\t\tlet curr = this.data;\n\n\t\tif (typeof(fieldName) !== 'string')\n\t\t{\n\t\t\tif (typeof(fieldName) === 'function')\n\t\t\t{\n\t\t\t\tfieldName (this, value);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet i = 0;\n\n\t\t\t\twhile (curr !== null && i < fieldName.length-1)\n\t\t\t\t\tcurr = curr[fieldName[i++]];\n\n\t\t\t\tcurr[fieldName[i]] = value;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tcurr[fieldName] = value;\n\t},\n\n\t/**\n\t * Returns the value of a field. Performs special transforms to the value if certain prefix is found.\n\t * @param {string|Function} fieldName \n\t * @param {*} value \n\t * @param {*} initialValue \n\t * @returns {*}\n\t */\n\tgetValue: function (fieldName, value=null, initialValue=null)\n\t{\n\t\tlet curr = this.data;\n\t\t\n\t\tif (typeof(fieldName) !== 'string')\n\t\t{\n\t\t\tif (typeof(fieldName) === 'function')\n\t\t\t{\n\t\t\t\tcurr = fieldName (this, null);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet i = 0;\n\n\t\t\t\twhile (curr !== null && i < fieldName.length)\n\t\t\t\t\tcurr = curr[fieldName[i++]];\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tcurr = curr[fieldName];\n\n\t\tif (value === null)\n\t\t\tvalue = curr;\n\n\t\tif (initialValue === null)\n\t\t\tinitialValue = curr;\n\n\t\tif (typeof(value) === 'string')\n\t\t{\n\t\t\tswitch(value[0])\n\t\t\t{\n\t\t\t\tcase '+':\n\t\t\t\t\tvalue = initialValue + Number(value.substr(1));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase '-':\n\t\t\t\t\tvalue = initialValue - Number(value.substr(1));\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tvalue = Number(value);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\telse if (typeof(value) === 'function')\n\t\t\tvalue = value (curr, initialValue, this);\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * Updates the animation by the specified delta, which must be in the same unit as the duration of the commands.\n\t * Returns false when the animation has been completed.\n\t * @param {number} dt\n\t * @param {Anim} self\n\t * @returns {boolean}\n\t * !update (dt: number, self?: Anim) : boolean;\n\t */\n\tupdate: function (dt, self=null)\n\t{\n\t\tif (self === null)\n\t\t\tself = this;\n\n\t\tif (self.paused || self.block.isFinished())\n\t\t{\n\t\t\tself.running = false;\n\t\t\treturn false;\n\t\t}\n\n\t\tself.time += dt*self.timeScale*Anim.timeScale;\n\n\t\tif (self.block.update(self) !== true)\n\t\t\treturn true;\n\n\t\tlet finished = self.finished;\n\t\tlet stamp = self.block.stamp;\n\t\tlet block = self.block;\n\n\t\tself.finished = true;\n\n\t\tif (!finished && self.finishedCallback !== null)\n\t\t{\n\t\t\tif (self.finishedCallback(self.data, self) === false)\n\t\t\t\tself.finishedCallback = null;\n\n\t\t\tif (self.block !== block || self.block.stamp != stamp)\n\t\t\t{\n\t\t\t\tself.resume();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\tself.running = false;\n\n\t\tif (self.autoDispose)\n\t\t\tdispose(self);\n\n\t\treturn false;\n\t},\n\n\t/**\n\t * Ensures that the field name is correct for subsequent rules.\n\t * @param {string|Function} value \n\t * @returns {Array}\n\t */\n\tprepareFieldName: function (value)\n\t{\n\t\tif (typeof(value) === 'function')\n\t\t\treturn value;\n\n\t\treturn value.indexOf('.') != -1 ? value.split('.') : value;\n\t},\n\n\t/* ****************************************************************************************** */\n\n\t/**\n\t * Runs the subsequent commands in parallel. Should end the parallel block by calling `end`.\n\t * @returns {Anim}\n\t * !parallel() : Anim;\n\t */\n\tparallel: function ()\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(PARALLEL));\n\n\t\tthis.blockStack.push (this.block);\n\t\tthis.cmdStack.push (cmd);\n\n\t\tthis.block = cmd.block;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Runs the subsequent commands in series. Should end the serial block by calling `end`.\n\t * @returns {Anim}\n\t * !serial() : Anim;\n\t */\n\tserial: function ()\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(SERIAL));\n\n\t\tthis.blockStack.push (this.block);\n\t\tthis.cmdStack.push (cmd);\n\n\t\tthis.block = cmd.block;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Repeats a block the specified number of times.\n\t * @param {number} count \n\t * @returns {Anim}\n\t * !repeat (count: number) : Anim;\n\t */\n\trepeat: function (count)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(REPEAT));\n\t\tcmd.count = count;\n\n\t\tthis.blockStack.push (this.block);\n\t\tthis.cmdStack.push (cmd);\n\n\t\tthis.block = cmd.block;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Ends a `parallel`, `serial` or `repeat` block.\n\t * @returns {Anim}\n\t * !end() : Anim;\n\t */\n\tend: function ()\n\t{\n\t\tthis.cmdStack.pop().ready();\n\t\tthis.block = this.blockStack.pop();\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the value of a variable.\n\t * @param {string|Function} field \n\t * @param {*} value \n\t * @returns {Anim}\n\t * !set (field: string|Function, value: any) : Anim;\n\t */\n\tset: function (field, value)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(SET));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.value = value;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Restarts the current block.\n\t * @returns {Anim}\n\t * !restart() : Anim;\n\t */\n\trestart: function ()\n\t{\n\t\tthis.block.add(Command.alloc(RESTART));\n\t\treturn this;\n\t},\n\n\t/**\n\t * Waits for the specified duration.\n\t * @param {number} duration \n\t * @returns {Anim}\n\t * !wait (duration: number) : Anim;\n\t */\n\twait: function (duration)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(WAIT));\n\n\t\tcmd.duration = duration;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Animates a variable from the startValue to the endValue over the specified duration.\n\t * @param {string|Function} field \n\t * @param {number} duration \n\t * @param {number} startValue \n\t * @param {number} endValue \n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t * !range (field: string|Function, duration: number, startValue: number, endValue: number, easing?: (t: number) => number) : Anim;\n\t */\n\trange: function (field, duration, startValue, endValue, easing=null)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(RANGE));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.duration = duration;\n\t\tcmd.startValue = startValue;\n\t\tcmd.endValue = endValue;\n\t\tcmd.easing = easing;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Animates a variable from the current value to the endValue over the specified duration.\n\t * @param {string|Function} field \n\t * @param {number} duration \n\t * @param {number} endValue \n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t * !rangeTo (field: string|Function, duration: number, endValue: number, easing?: (t: number) => number) : Anim;\n\t */\n\trangeTo: function (field, duration, endValue, easing=null)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(RANGE));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.duration = duration;\n\t\tcmd.startValue = null;\n\t\tcmd.endValue = endValue;\n\t\tcmd.easing = easing;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Changes the variable with a value that is a random number in the given range (inclusive) for the specified duration.\n\t * @param {string|Function} field \n\t * @param {number} duration \n\t * @param {number} count \n\t * @param {number} startValue \n\t * @param {number} endValue \n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t * !rand (field: string|Function, duration: number, count: number, startValue: number, endValue: number, easing?: (t: number) => number) : Anim;\n\t */\n\trand: function (field, duration, count, startValue, endValue, easing=null)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(RAND));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.duration = duration;\n\t\tcmd.count = count;\n\t\tcmd.startValue = startValue;\n\t\tcmd.endValue = endValue;\n\t\tcmd.easing = easing;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Changes the variable with a value that is a random number in the given range (inclusive) for the specified duration. The difference\n\t * between this and `rand` is that this function uses a static pre-generated table of random numbers between the specified range.\n\t *\n\t * @param {string|Function} field \n\t * @param {number} duration \n\t * @param {number} count \n\t * @param {number} startValue \n\t * @param {number} endValue \n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t * !randt (field: string|Function, duration: number, count: number, startValue: number, endValue: number, easing?: (t: number) => number) : Anim;\n\t */\n\trandt: function (field, duration, count, startValue, endValue, easing)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(RANDT));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.duration = duration;\n\t\tcmd.count = count;\n\t\tcmd.startValue = startValue;\n\t\tcmd.endValue = endValue;\n\t\tcmd.easing = easing;\n\n\t\tcmd.ready();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Plays a sound.\n\t * @param {object} snd \n\t * @returns {Anim}\n\t * !play (snd: object) : Anim;\n\t */\n\tplay: function (snd)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(PLAY));\n\t\tcmd.snd = snd;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Executes a function. If continuous execution is needed, simply return `true`.\n\t * @param {(dt: number, data: object, cmd: Command, anim: Anim) => boolean} fn \n\t * @returns {Anim}\n\t * !exec (fn: (dt: number, data: object, anim: Anim) => boolean) : Anim;\n\t */\n\texec: function (fn)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(EXEC));\n\t\tcmd.fn = fn;\n\n\t\treturn this;\n\t},\n\n\t/* ********************************************************** */\n\n\t_bounds_x1: function (anim, value)\n\t{\n\t\tif (value === null)\n\t\t\treturn anim.data.bounds.x1;\n\n\t\tanim.data.translate(int(value) - anim.data.bounds.x1, 0);\n\t},\n\n\t_bounds_y1: function (anim, value)\n\t{\n\t\tif (value === null)\n\t\t\treturn anim.data.bounds.y1;\n\n\t\tanim.data.translate(0, int(value) - anim.data.bounds.y1);\n\t},\n\n\t/**\n\t * Sets X coordinate.\n\t * @param {number} value \n\t * @returns {Anim}\n\t * !setX (value: number) : Anim;\n\t */\n\tsetX: function (value)\n\t{\n\t\treturn this.set(this._bounds_x1, value);\n\t},\n\n\t/**\n\t * Sets Y coordinate.\n\t * @param {number} value \n\t * @returns {Anim}\n\t * !setY (value: number) : Anim;\n\t */\n\tsetY: function (value)\n\t{\n\t\treturn this.set(this._bounds_y1, value);\n\t},\n\n\t/**\n\t * Sets both the X and Y coordinates.\n\t * @param {number} x \n\t * @param {number} y \n\t * @returns {Anim}\n\t * !position (x: number, y: number) : Anim;\n\t */\n\tposition: function (x, y)\n\t{\n\t\treturn this.set(this._bounds_x1, x).set(this._bounds_y1, y);\n\t},\n\n\t/**\n\t * Translates the X coordinate for the specified amount over the specified duration.\n\t * @param {number} duration \n\t * @param {number} deltaValue \n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t * !translateX (duration: number, deltaValue: number, easing?: (t: number) => number) : Anim;\n\t */\n\ttranslateX: function (duration, deltaValue, easing)\n\t{\n\t\treturn this.range(this._bounds_x1, duration, null, (deltaValue < 0 ? '-' : '+') + Math.abs(deltaValue), easing);\n\t},\n\n\t/**\n\t * Translates the Y coordinate for the specified amount over the specified duration.\n\t * @param {number} duration \n\t * @param {number} deltaValue \n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t * !translateY (duration: number, deltaValue: number, easing?: (t: number) => number) : Anim;\n\t */\n\ttranslateY: function (duration, deltaValue, easing)\n\t{\n\t\treturn this.range(this._bounds_y1, duration, null, (deltaValue < 0 ? '-' : '+') + Math.abs(deltaValue), easing);\n\t},\n\n\t/**\n\t * Translates the X and Y coordinates for the specified amount over the specified duration.\n\t * @param {number} duration \n\t * @param {number} deltaValueX \n\t * @param {number} deltaValueY \n\t * @param {(t: number) => number} easingX?\n\t * @param {(t: number) => number} easingY?\n\t * @returns {Anim}\n\t * !translate (duration: number, deltaValueX: number, deltaValueY: number, easingX?: (t: number) => number, easingY?: (t: number) => number) : Anim;\n\t */\n\ttranslate: function (duration, deltaValueX, deltaValueY, easingX, easingY=null)\n\t{\n\t\treturn this.parallel()\n\t\t\t\t\t.range(this._bounds_x1, duration, null, (deltaValueX < 0 ? '-' : '+') + Math.abs(deltaValueX), easingX)\n\t\t\t\t\t.range(this._bounds_y1, duration, null, (deltaValueY < 0 ? '-' : '+') + Math.abs(deltaValueY), easingY ? easingY : easingX)\n\t\t\t\t.end();\n\t},\n\n\t/**\n\t * Translates the X and Y coordinates to the specified end values over the specified duration.\n\t * @param {numbe} duration \n\t * @param {number} endValueX \n\t * @param {number} endValueY \n\t * @param {(t: number) => number} easingX?\n\t * @param {(t: number) => number} easingY?\n\t * @returns {Anim}\n\t * !moveTo (duration: number, endValueX: number, endValueY: number, easingX?: (t: number) => number, easingY?: (t: number) => number) : Anim;\n\t */\n\tmoveTo: function (duration, endValueX, endValueY, easingX=null, easingY=null)\n\t{\n\t\treturn this.parallel()\n\t\t\t\t.range(this._bounds_x1, duration, null, endValueX, easingX)\n\t\t\t\t.range(this._bounds_y1, duration, null, endValueY, easingY ? easingY : easingX)\n\t\t\t\t.end();\n\t},\n\n\t/**\n\t * Translates the X coordinate to the specified end value over the specified duration.\n\t * @param {number} duration \n\t * @param {number} endValue \n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t */\n\tmoveX: function (duration, endValue, easing=null)\n\t{\n\t\treturn this.range(this._bounds_x1, duration, null, endValue, easing);\n\t},\n\n\t/**\n\t * Translates the Y coordinate to the specified end value over the specified duration.\n\t * @param {number} duration \n\t * @param {number} endValue \n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t */\n\tmoveY: function (duration, endValue, easing=null)\n\t{\n\t\treturn this.range(this._bounds_y1, duration, null, endValue, easing);\n\t},\n\n\t/**\n\t * Changes the `sx` (scale X) property to the specified end value over the specified duration.\n\t * @param {numbe} duration \n\t * @param {numbber} endValue \n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t */\n\tscaleX: function (duration, endValue, easing)\n\t{\n\t\treturn this.range('sx', duration, null, endValue, easing);\n\t},\n\n\t/**\n\t * Changes the `sy` (scale Y) property to the specified end value over the specified duration.\n\t * @param {number} duration \n\t * @param {numbe} endValue \n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t */\n\tscaleY: function (duration, endValue, easing)\n\t{\n\t\treturn this.range('sy', duration, null, endValue, easing);\n\t},\n\n\t/**\n\t * Changes the `sx` and `sy` (scale X and scale Y) properties to the specified end values over the specified duration.\n\t * @param {number} duration\n\t * @param {number} endValueX\n\t * @param {number} endValueY\n\t * @param {(t: number) => number} easingX?\n\t * @param {(t: number) => number} easingY?\n\t * @returns {Anim}\n\t * !scale (duration: number, endValueX: number, endValueY: number, easingX?: (t: number) => number, easingY?: (t: number) => number) : Anim;\n\t */\n\tscale: function (duration, endValueX, endValueY, easingX, easingY=null)\n\t{\n\t\treturn this.parallel()\n\t\t\t\t.range('sx', duration, null, endValueX, easingX)\n\t\t\t\t.range('sy', duration, null, endValueY, easingY ? easingY : easingX)\n\t\t\t\t.end();\n\t},\n\n\t/**\n\t * Changes the `rotation` property by the specified delta value over the specified duration.\n\t * @param {number} duration\n\t * @param {number} deltaValue\n\t * @param {(t: number) => number} easing?\n\t * @returns {Anim}\n\t * !rotate (duration: number, deltaValue: number, easing?: (t: number) => number) : Anim;\n\t */\n\trotate: function (duration, deltaValue, easing)\n\t{\n\t\treturn this.range('angle', duration, null, (deltaValue < 0 ? '-' : '+') + Math.abs(deltaValue), easing);\n\t}\n});\n\n/**\n * Global animation time scale.\n * !static timeScale: number;\n */\nAnim.timeScale = 1.0;\n\n/**\n * Sets the global time scale (animation speed).\n * @param {number} value\n * !static speed (value: number) : void;\n */\nAnim.speed = function (value)\n{\n\tAnim.timeScale = value > 0.0 ? value : 1.0;\n};\n\nRecycler.createPool(Anim, 2048);\nexport default Anim;\n","\nimport { Class } from 'rinn';\nimport PriorityQueue from '../utils/priority-queue.js';\n\n//![import \"../utils/priority-queue\"]\n\n//!class Boot\n\nconst Boot =\n{\n\tmodules: new PriorityQueue(),\n\n\t/**\n\t * \tRegisters a new boot module.\n\t * \t!static register (module: Boot.Module) : Boot.Module;\n\t */\n\tregister: function (module)\n\t{\n\t\treturn this.modules.add(module);\n\t},\n\n\t/**\n\t * \tRemoves a boot module.\n\t * \t!static unregister (module: Boot.Module) : void;\n\t */\n\tunregister: function (module)\n\t{\n\t\tthis.modules.remove(module);\n\t\tthis.modules.cleanup();\n\t},\n\n\t/**\n\t * \tExecutes the startup sequence.\n\t * \t!static startup (finishedCallback?: () => void) : void;\n\t */\n\tstartup: function (finishedCallback=null)\n\t{\n\t\tthis.modules.forEachAsync((m,r) => { if (m.onStartup(r) !== false) r(); }, finishedCallback);\n\t},\n\n\t/**\n\t * \tExecutes the shutdown sequence.\n\t * \t!static shutdown (finishedCallback?: () => void) : void;\n\t */\n\tshutdown: function (finishedCallback=null)\n\t{\n\t\tthis.modules.forEachAsyncRev( (m,r) => { if (m.onShutdown(r) !== false) r(); }, finishedCallback);\n\t}\n};\n\n//!/class\n\n//!namespace Boot\n//!interface Module\n\nBoot.Module = Class.extend\n({\n\tclassName: \"Module\",\n\n\t/**\n\t * \tPriority of the module (from 0 to 100), lower number means higher priority.\n\t * \t!priority: number;\n\t */\n\tpriority: 5,\n\n\t__ctor: function()\n\t{\n\t\tBoot.register(this);\n\t},\n\n\t__dtor: function()\n\t{\n\t\tBoot.unregister(this);\n\t},\n\n\t/**\n\t * \tShould return `false` if the method is async. When async ensure to call `next` once the operation is complete.\n\t * \t!onStartup (next: () => void) : boolean;\n\t */\n\tonStartup: function (next)\n\t{\n\t},\n\n\t/**\n\t * \tShould return `false` if the method is async. When async ensure to call `next` once the operation is complete.\n\t * \t!onShutdown (next: () => void) : boolean;\n\t */\n\tonShutdown: function (next)\n\t{\n\t}\n});\n\n//!/interface\n//!/namespace\n\nexport default Boot;\n","\nimport System from '../system/system.js';\nimport Resources from '../resources/resources.js';\nimport Boot from '../flow/boot.js';\nimport Handler from '../utils/handler.js';\n\n//!class sys\n\nconst system =\n{\n\t/**\n\t * Indicates if the system module has already been initialized.\n\t */\n\tinitialized: false,\n\n\t/**\n\t * Screen width (available after calling `init`).\n\t * !static readonly screenWidth: number;\n\t */\n\tscreenWidth: 0,\n\n\t/**\n\t * Screen height (available after calling `init`).\n\t * !static readonly screenHeight: number;\n\t */\n\tscreenHeight: 0,\n\n\t/**\n\t * Primary renderer (available after calling `init`).\n\t * !static readonly renderer: Canvas;\n\t */\n\trenderer: null,\n\n\t/**\n\t * Logical system time (mirrors the value of System.frameTime).\n\t * !static readonly time: number;\n\t */\n\ttime: 0,\n\n\t/**\n\t * Logical system delta time (mirrors the value of System.frameDelta).\n\t * !static readonly dt: number;\n\t */\n\tdt: 0,\n\n\t/**\n\t * Timeout update handler.\n\t */\n\t_timeout: null,\n\n\t/**\n\t * Interval update handler.\n\t */\n\t_interval: null,\n\n\t/**\n\t * Time span update handler.\n\t */\n\t_span: null,\n\n\t/**\n\t * Update handler executed on every frame start.\n\t * !static readonly update: Handler;\n\t */\n\tupdate: null,\n\n\t/**\n\t * Draw handler executed on every frame start.\n\t * !static readonly draw: Handler;\n\t */\n\tdraw: null,\n\n\t/**\n\t * Executed when the system is paused.\n\t * !static onPaused: (fromExternalEvent: boolean) => void;\n\t */\n\tonPaused: null,\n\n\t/**\n\t * Executed when the system is resumed.\n\t * !static onResumed: (fromExternalEvent: boolean) => void;\n\t */\n\tonResumed: null,\n\n\t/**\n\t * System initialization options.\n\t */\n\toptions:\n\t{\n\t\t/**\n\t\t * \tTells the system to enable WebGL support.\n\t\t */\n\t\tgl: true,\n\n\t\t/**\n\t\t * \tIndicates if on-screen logging should be enabled.\n\t\t */\n\t\tlog: false,\n\n\t\t/**\n\t\t * \tEnables or disables antialised canvas. Set to `false` when pixel-perfect is desired.\n\t\t */\n\t\tantialias: false,\n\n\t\t/**\n\t\t * \tBackground of the system canvas.\n\t\t */\n\t\tbackground: '#000000',\n\n\t\t/**\n\t\t * \tDesired orientaton of the display.\n\t\t */\n\t\torientation: 'automatic',\n\n\t\t/**\n\t\t * \tDesired display width. When not specified (null) the maximum screen width to maintain the aspect ratio will be used.\n\t\t */\n\t\tscreenWidth: null,\n\n\t\t/**\n\t\t * \tDesired display height. When not specified (null) the maximum screen height to maintain the aspect ratio will be used.\n\t\t */\n\t\tscreenHeight: null,\n\n\t\t/**\n\t\t * \tTarget frames per second (FPS). Used to determine delay between frames.\n\t\t */\n\t\tfps: 144,\n\n\t\t/**\n\t\t * \tMinimum allowed frames per second (FPS). If system FPS drops below this value, the `frameDelta` property of System will be truncated to 1/minFps.\n\t\t */\n\t\tminFps: 24,\n\n\t\t/**\n\t\t * \tIndicates if recycler pool preallocation should be automatically executed. Additionally if this value is a number, it will be used as\n\t\t * \tmaximum preallocation parameter for the recycler.\n\t\t */\n\t\tpreallocate: false\n\t},\n\n\t/**\n\t * Initializes the system with the specified options.\n\t * !static init (options: System.Options) : Promise<void>;\n\t */\n\t/**\n\t * Initializes the system using the default options.\n\t * !static init () : Promise<void>;\n\t */\n\tinit: function (options)\n\t{\n\t\treturn new Promise ((resolve, reject) =>\n\t\t{\n\t\t\tif (this.initialized)\n\t\t\t\treturn resolve();\n\n\t\t\tObject.assign(this.options, options);\n\n\t\t\tResources.config ({ pixelated: !this.options.antialias, filter: this.options.antialias ? 'LINEAR' : 'NEAREST' });\n\t\t\tSystem.init (this.options);\n\n\t\t\tSystem.updateQueueAdd\n\t\t\t({\n\t\t\t\tupdate: function(dt)\n\t\t\t\t{\n\t\t\t\t\tsystem.time = System.frameTime;\n\t\t\t\t\tsystem.dt = dt;\n\n\t\t\t\t\tsystem._timeout.exec(dt);\n\t\t\t\t\tsystem._interval.exec(dt);\n\t\t\t\t\tsystem._span.exec(dt);\n\n\t\t\t\t\tsystem.update.exec(dt);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tSystem.drawQueueAdd\n\t\t\t({\n\t\t\t\tdraw: function(g)\n\t\t\t\t{\n\t\t\t\t\tsystem.draw.exec(g);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tBoot.startup(function()\n\t\t\t{\n\t\t\t\tSystem.start();\n\n\t\t\t\tsystem.screenWidth = System.screenWidth;\n\t\t\t\tsystem.screenHeight = System.screenHeight;\n\t\t\t\tsystem.renderer = System.renderer;\n\n\t\t\t\tsystem._timeout = Handler.Pool.alloc();\n\t\t\t\tsystem._interval = Handler.Pool.alloc();\n\t\t\t\tsystem._span = Handler.Pool.alloc();\n\n\t\t\t\tsystem.update = Handler.Pool.alloc();\n\t\t\t\tsystem.draw = Handler.Pool.alloc();\n\n\t\t\t\twindow.onblur = function() {\n\t\t\t\t\tsystem.pause(true);\n\t\t\t\t};\n\n\t\t\t\twindow.onfocus = function() {\n\t\t\t\t\tsystem.resume(true);\n\t\t\t\t};\n\n\t\t\t\tsystem.initialized = true;\n\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Pauses the system.\n\t * !static pause (fromExternalEvent?: boolean|false) : void;\n\t */\n\tpause: function (fromExternalEvent=false)\n\t{\n\t\tif (system.onPaused !== null)\n\t\t\tsystem.onPaused(fromExternalEvent);\n\t},\n\n\t/**\n\t * Resumes the system.\n\t * !static resume (fromExternalEvent?: boolean|false) : void;\n\t */\n\tresume: function (fromExternalEvent=false)\n\t{\n\t\tif (system.onResumed !== null)\n\t\t\tsystem.onResumed(fromExternalEvent);\n\t},\n\n\t/**\n\t * Creates a timeout callback.\n\t * !static timeout (duration: number, callback: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any) : Callback;\n\t */\n\ttimeout: function (duration, callback, arg0=null, arg1=null, arg2=null, arg3=null)\n\t{\n\t\treturn this._timeout.add(this._updateTimeout, duration, callback, arg0, arg1, arg2, arg3);\n\t},\n\n\t/**\n\t * Cancels a timeout callback.\n\t * !static cancelTimeout (callback: Callback) : void;\n\t */\n\tcancelTimeout: function (node)\n\t{\n\t\tthis._timeout.remove(node);\n\t},\n\n\t_updateTimeout: function (dt, _, callback, arg0, arg1, arg2, arg3)\n\t{\n\t\tthis.arg0 -= dt;\n\t\tif (this.arg0 > 0) return true;\n\n\t\tcallback (arg0, arg1, arg2, arg3);\n\t\treturn false;\n\t},\n\n\t/**\n\t * Creates an interval callback.\n\t * !static interval (period: number, callback: Function, arg0?: any, arg1?: any, arg2?: any) : Callback;\n\t */\n\tinterval: function (period, callback, arg0=null, arg1=null, arg2=null)\n\t{\n\t\treturn this._interval.add(this._updateInterval, 0, period, callback, arg0, arg1, arg2);\n\t},\n\n\t/**\n\t * Cancels an interval callback.\n\t * !static cancelInterval (callback: Callback) : void;\n\t */\n\tcancelInterval: function (node)\n\t{\n\t\tthis._interval.remove(node);\n\t},\n\n\t_updateInterval: function (dt, _0, _1, callback, arg0, arg1, arg2)\n\t{\n\t\tthis.arg0 += dt;\n\t\tif (this.arg0 < this.arg1) return true;\n\n\t\tthis.arg0 -= this.arg1;\n\t\treturn callback (arg0, arg1, arg2);\n\t},\n\n\t/**\n\t * Creates a a time-span callback.\n\t * !static span (period: number, callback: (t:number, dt:number, ...args:any) => boolean, arg0?: any, arg1?: any, arg2?: any) : Callback;\n\t */\n\tspan: function (duration, callback, arg0=null, arg1=null, arg2=null)\n\t{\n\t\treturn this._span.add(this._updateSpan, 0, duration, callback, arg0, arg1, arg2);\n\t},\n\n\t/**\n\t * Cancels a time-span callback.\n\t * !static cancelSpan (callback: Callback) : void;\n\t */\n\tcancelSpan: function (node)\n\t{\n\t\tthis._span.remove(node);\n\t},\n\n\t_updateSpan: function (dt, _0, _1, callback, arg0, arg1, arg2)\n\t{\n\t\tthis.arg0 += dt;\n\t\tif (this.arg0 > this.arg1) {\n\t\t\tdt -= this.arg0 - this.arg1;\n\t\t\tthis.arg0 = this.arg1;\n\t\t}\n\n\t\tif (callback (this.arg0/this.arg1, dt, arg0, arg1, arg2) === false)\n\t\t\treturn false;\n\n\t\treturn this.arg0 !== this.arg1;\n\t}\n};\n\nexport default system;\n","\nimport { Class } from 'rinn';\nimport List from '../utils/list.js';\nimport Recycler from '../utils/recycler.js';\n\nlet _stamp = 0;\nfunction getStamp()\n{\n\t_stamp = (_stamp + 1) & 0x7FFFFFFF;\n\treturn _stamp;\n}\n\n//!class Block\n\nconst Block = Class.extend\n({\n\tclassName: 'Anim:Block',\n\n\tcommands: null,\n\n\tisFirst: true,\n\tcurrent: false,\n\tstamp: 0,\n\ttime: 0,\n\n\t/**\n\t * \tInitializes the block to its initial state.\n\t * \t!init() : Block;\n\t */\n\tinit: function()\n\t{\n\t\tthis.commands = List.Pool.alloc();\n\t\tthis.reset(0);\n\t\treturn this;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis.commands.free();\n\t},\n\n\t/**\n\t * Returns the number of commands in the block.\n\t * !count() : number;\n\t */\n\tcount: function()\n\t{\n\t\treturn this.commands.length;\n\t},\n\n\t/**\n\t * \tAdds a command to the block.\n\t * \t!add (cmd: Command) : Command;\n\t */\n\tadd: function (cmd)\n\t{\n\t\tthis.commands.push(cmd);\n\n\t\tif (this.isFirst === false && this.current === null)\n\t\t{\n\t\t\tthis.current = this.commands.bottom;\n\t\t\tthis.stamp = getStamp();\n\t\t}\n\n\t\treturn cmd;\n\t},\n\n\t/**\n\t * \tClones the block.\n\t * \t!clone() : Block;\n\t */\n\tclone: function()\n\t{\n\t\tlet block = Block.alloc();\n\n\t\tfor (let node = this.commands.top; node !== null; node = node.next)\n\t\t\tblock.commands.push(node.value.clone());\n\n\t\treturn block;\n\t},\n\n\t/**\n\t * \tClears the block by removing all commands and resetting it to initial state.\n\t * \t!clear() : Block;\n\t */\n\tclear: function()\n\t{\n\t\tthis.commands.clear();\n\t\tthis.reset(0);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResets the block to its initial state. Does not remove commands.\n\t * \t!reset (time: number) : Block;\n\t */\n\treset: function (time=0)\n\t{\n\t\tthis.isFirst = true;\n\t\tthis.current = null;\n\t\tthis.time = time;\n\t\tthis.stamp = getStamp();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the block to use the first command in the next call to `update`.\n\t * \t!restart() : Block;\n\t */\n\trestart: function()\n\t{\n\t\tthis.isFirst = true;\n\t\tthis.stamp = getStamp();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns `true` if all commands in the block have been executed to completion.\n\t * \t!isFinished() : boolean;\n\t */\n\tisFinished: function()\n\t{\n\t\tif (this.isFirst === true)\n\t\t{\n\t\t\tthis.current = this.commands.top;\n\t\t\tthis.isFirst = false;\n\t\t}\n\n\t\treturn this.current === null;\n\t},\n\n\t/**\n\t * \tExecutes the next command in the block. Returns `true` when block execution is complete.\n\t * \t!update (anim: Anim) : boolean;\n\t */\n\tupdate: function (anim)\n\t{\n\t\twhile (!this.isFinished())\n\t\t{\n\t\t\tlet r = this.current.value.update(anim, this);\n\t\t\tif (r !== true) return r;\n\n\t\t\tthis.current = this.current.next;\n\t\t}\n\n\t\treturn true;\n\t}\n});\n\n/**\n * \tAllocates a new block.\n * \t!static alloc () : Block;\n */\n\n/**\n * \tAllocates a new block and initializes it.\n * \t!static calloc () : Block;\n */\n\nRecycler.attachTo(Block, 2048);\nexport default Block;\n","\nimport { Class } from 'rinn';\nimport List from '../utils/list.js';\nimport Recycler from '../utils/recycler.js';\n\n//!class Command\n\nconst Command = Class.extend\n({\n\tclassName: 'Anim:Command',\n\n\t/**\n\t * Object having the code of the operation to execute.\n\t */\n\top: null,\n\n\t/**\n\t * Indicates if execution of the command has started.\n\t */\n\tstarted: false,\n\n\t/**\n\t * Time when the command started.\n\t */\n\ttime: 0,\n\n\t/**\n\t * Field related to the command.\n\t */\n\tfield: null,\n\n\t/**\n\t * Value related to the field of the command.\n\t */\n\tvalue: null,\n\n\t/**\n\t * Duration of the command.\n\t */\n\tduration: 0, _duration: 0,\n\n\t/**\n\t * Number of cicles of the command.\n\t */\n\tcount: 0, _count: 0,\n\n\t/**\n\t * Initial value for the command's field.\n\t */\n\tstartValue: 0, _startValue: 0,\n\n\t/**\n\t * Final value for the command's field.\n\t */\n\tendValue: 0, _endValue: 0,\n\n\t/**\n\t * Easing function to use to interpolate values of the command's field.\n\t */\n\teasing: null,\n\n\t_cur: null,\n\t_last: null,\n\n\t/**\n\t * Block where the command is stored.\n\t */\n\tblock: null, /* Block */\n\n\t/**\n\t * Blocks to execute (for commands having multiple blocks).\n\t */\n\tblocks: null, /* List<Block> */\n\n\t/**\n\t * Table with values.\n\t */\n\ttable: null,\n\n\t/**\n\t * Sound resource.\n\t */\n\tsnd: null,\n\n\t/**\n\t * Function to execute.\n\t */\n\tfn: null,\n\n\t/**\n\t * Initializes the command.\n\t * !init (op: object) : Command;\n\t */\n\tinit: function (op, autoInit)\n\t{\n\t\tthis.op = op;\n\t\tthis.started = false;\n\n\t\tthis.block = null;\n\t\tthis.blocks = null;\n\t\n\t\tthis.table = null;\n\t\tthis.snd = null;\n\t\tthis.fn = null;\n\n\t\tif (autoInit !== false)\n\t\t\top.init(this, false);\n\n\t\treturn this;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tif (this.block !== null) this.block.clear().free();\n\t\tif (this.blocks !== null) this.blocks.clear().free();\n\t},\n\n\tclone: function()\n\t{\n\t\tlet cmd = Command.alloc(this.op, false);\n\n\t \tcmd.field = this.field\n\t \tcmd.value = this.value\n\t \tcmd.duration = this.duration\n\t \tcmd.count = this.count\n\t \tcmd.startValue = this.startValue\n\t \tcmd.endValue = this.endValue\n\t \tcmd.easing = this.easing;\n\t\tcmd.table = this.table;\n\t\tcmd.snd = this.snd;\n\t\tcmd.fn = this.fn;\n\n\t\tif (this.block !== null)\n\t\t\tcmd.block = this.block.clone();\n\n\t\tif (this.blocks !== null)\n\t\t{\n\t\t\tcmd.blocks = List.Pool.alloc();\n\n\t\t\tfor (let node = this.blocks.top; node !== null; node = node.next)\n\t\t\t\tcmd.blocks.push(node.value.clone());\n\t\t}\n\n\t\treturn cmd;\n\t},\n\n\t/**\n\t * Executed when the command properties are ready, to initialize the operation code.\n\t * !ready() : void;\n\t */\n\tready: function()\n\t{\n\t\tthis.op.init(this, true);\n\t},\n\n\t/**\n\t * Updates the command execution.\n\t * !update (anim: Anim, block: Block) : boolean;\n\t */\n\tupdate: function(anim, block)\n\t{\n\t\treturn this.op.update(anim, block, this);\n\t}\n});\n\n/**\n * Allocates a new command.\n * !static alloc () : Command;\n */\n\n/**\n * Allocates a new command and initializes it.\n * !static calloc () : Command;\n */\n\nRecycler.attachTo(Command);\nexport default Command;\n","\nimport List from '../utils/list.js';\nimport Block from './block.js';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t\tif (!postinit)\n\t\t{\n\t\t\tcmd.block = Block.alloc();\n\t\t\tcmd.blocks = List.Pool.alloc();\n\t\t\treturn;\n\t\t}\n\n\t\tlet i;\n\n\t\twhile ((i = cmd.block.commands.shift()) != null)\n\t\t{\n\t\t\tlet block = Block.alloc();\n\t\t\tblock.add(i);\n\t\t\tcmd.blocks.push(block);\n\t\t}\n\n\t\tcmd.block.free();\n\t\tcmd.block = null;\n\t},\n\n\tupdate: function (anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tfor (let i = cmd.blocks.top; i !== null; i = i.next)\n\t\t\t{\n\t\t\t\ti.value.reset (block.time);\n\t\t\t}\n\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet time = block.time;\n\t\tlet n = 0, m = 0;\n\n\t\tfor (let i = cmd.blocks.top; i !== null; i = i.next)\n\t\t{\n\t\t\tlet r = i.value.update(anim);\n\t\t\tif (r === true) n++; else if (r === null) m++;\n\n\t\t\tif (i.value.time > time)\n\t\t\t\ttime = i.value.time;\n\t\t}\n\n\t\tif ((n+m) != cmd.blocks.length)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time = time;\n\n\t\treturn true;\n\t}\n};\n","\nimport Block from './block.js';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t\tif (!postinit)\n\t\t\tcmd.block = Block.alloc();\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd.block.reset (block.time);\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet r = cmd.block.update(anim);\n\t\tif (r !== true) return r;\n\n\t\tcmd.started = false;\n\t\tblock.time = cmd.block.time;\n\t\treturn true;\n\t}\n};\n","\nimport Block from './block.js';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t\tif (!postinit)\n\t\t\tcmd.block = Block.alloc();\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd.block.reset (block.time);\n\t\t\tcmd._count = cmd.count;\n\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet r = cmd.block.update(anim);\n\t\tif (r !== true) return r;\n\n\t\tif (cmd._count <= 1)\n\t\t{\n\t\t\tcmd.started = false;\n\t\t\tblock.time = cmd.block.time;\n\t\t\treturn true;\n\t\t}\n\n\t\tcmd.block.restart();\n\t\tcmd._count--;\n\t\treturn false;\n\t}\n};\n","\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tanim.setValue(cmd.field, anim.getValue(cmd.field, cmd.value));\n\t\treturn true;\n\t}\n};\n","\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tblock.restart();\n\t\treturn true;\n\t}\n};\n","\nimport { Rinn } from 'rinn';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._duration = Rinn.typeOf(cmd.duration) === 'string' ? anim.getValue(cmd.duration) : cmd.duration;\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tif (anim.time < block.time + cmd._duration)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time += cmd._duration;\n\t\treturn true;\n\t}\n};\n","\nimport { Rinn } from 'rinn';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._startValue = anim.getValue(cmd.field, cmd.startValue);\n\t\t\tcmd._duration = Rinn.typeOf(cmd.duration) === 'string' ? anim.getValue(cmd.duration) : cmd.duration;\n\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tcmd._endValue = anim.getValue(cmd.field, cmd.endValue, cmd._startValue);\n\n\t\tlet t = 1.0;\n\n\t\tif (anim.time < block.time + cmd._duration)\n\t\t\tt = (anim.time - block.time) / cmd._duration;\n\n\t\tif (cmd.easing && t != 1.0)\n\t\t\tanim.setValue(cmd.field, cmd.easing(t)*(cmd._endValue - cmd._startValue) + cmd._startValue);\n\t\telse\n\t\t\tanim.setValue(cmd.field, t*(cmd._endValue - cmd._startValue) + cmd._startValue);\n\n\t\tif (t != 1.0)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time += cmd._duration;\n\n\t\treturn true;\n\t}\n};\n","\nimport { Rinn } from 'rinn';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._duration = Rinn.typeOf(cmd.duration) === 'string' ? anim.getValue(cmd.duration) : cmd.duration;\n\t\t\tcmd._last = null;\n\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet t = 1.0;\n\n\t\tif (anim.time < block.time + cmd._duration)\n\t\t\tt = (anim.time - block.time) / cmd._duration;\n\n\t\tif (cmd.easing && t != 1.0)\n\t\t\tcmd._cur = int(cmd.easing(t)*cmd.count);\n\t\telse\n\t\t\tcmd._cur = int(t*cmd.count);\n\n\t\tif (cmd._cur != cmd._last)\n\t\t{\n\t\t\tlet val = anim.getValue(cmd.field);\n\n\t\t\twhile (true) {\n\t\t\t\tlet i = int(Math.random()*(cmd.endValue - cmd.startValue + 1)) + cmd.startValue;\n\t\t\t\tif (i != val) break;\n\t\t\t}\n\n\t\t\tanim.setValue(cmd.field, i);\n\t\t\tcmd._last = cmd._cur;\n\t\t}\n\n\t\tif (t != 1.0)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time += cmd._duration;\n\n\t\treturn true;\n\t}\n};\n","\nimport { Rinn } from 'rinn';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t\tif (!postinit) return;\n\n\t\tlet table = [ ];\n\n\t\tfor (let i = 0; i < cmd.count; i++)\n\t\t\ttable.push ((i % (cmd.endValue - cmd.startValue + 1)) + cmd.startValue);\n\n\t\tfor (let i = cmd.count >> 2; i > 0; i--)\n\t\t{\n\t\t\tlet a = int(Math.random() * cmd.count);\n\t\t\tlet b = int(Math.random() * cmd.count);\n\n\t\t\tlet c = table[b];\n\t\t\ttable[b] = table[a];\n\t\t\ttable[a] = c;\n\t\t}\n\n\t\tcmd.table = table;\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._duration = Rinn.typeOf(cmd.duration) === 'string' ? anim.getValue(cmd.duration) : cmd.duration;\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet t = 1.0;\n\t\tlet i;\n\n\t\tif (anim.time < block.time + cmd._duration)\n\t\t\tt = (anim.time - block.time) / cmd._duration;\n\n\t\tif (cmd.easing && t != 1.0)\n\t\t\ti = cmd.easing(t)*(cmd.count-1);\n\t\telse\n\t\t\ti = t*(cmd.count-1);\n\n\t\tanim.setValue(cmd.field, cmd.table[int((i + cmd.count) % cmd.count)]);\n\n\t\tif (t != 1.0)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time += cmd._duration;\n\n\t\treturn true;\n\t}\n};\n","\nexport default\n{\n\tinit: function (cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function (anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._last = anim.time;\n\t\t\tcmd.started = true;\n\t\t\tcmd.time = anim.time;\n\t\t}\n\n\t\tlet dt = anim.time - cmd._last;\n\t\tcmd._last = anim.time;\n\t\tcmd.time += dt;\n\n\t\tlet r = cmd.fn(dt, anim.data, cmd, anim);\n\t\tif (r === true) return false;\n\n\t\tcmd.started = false;\n\t\treturn true;\n\t}\n};\n","\nexport default\n{\n\tinit: function (cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function (anim, block, cmd)\n\t{\n\t\tcmd.snd.play();\n\t\treturn true;\n\t}\n};\n","\nimport { Class } from 'rinn';\nimport Bounds2 from '../math/bounds2.js';\nimport Handler from '../utils/handler.js';\n\n//![import \"../math/bounds2\"]\n//![import \"../utils/handler\"]\n\n//:/**\n//: * Describes an element that can be added to a grid.\n//: */\n\n//!class GridElement\n\nconst GridElement = Class.extend\n({\n\t/**\n\t * Name of the class (for inheritance purposes).\n\t */\n\tclassName: 'GridElement',\n\n\t/**\n\t * Identifier of the element (string).\n\t * !id: string;\n\t */\n\tid: null,\n\n\t/**\n\t * Bounds of the element.\n\t * !bounds: Bounds2;\n\t */\n\tbounds: null,\n\n\t/**\n\t * Flags of the element (see constants of this class).\n\t * !flags: number;\n\t */\n\tflags: 0,\n\n\t/**\n\t * Generic data of the element, used to store some value or object.\n\t * !data: object;\n\t */\n\tdata: null,\n\n\t/**\n\t * Extension object of the element, can be used to implement specific functionality.\n\t * !ext: object;\n\t */\n\text: null,\n\n\t/**\n\t * The container where the element is stored.\n\t * !readonly container: Container;\n\t */\n\tcontainer: null,\n\n\t/**\n\t * Removal callback node added by Grid.\n\t */\n\t_grid_remove_node: null,\n\n\t/**\n\t * Remover runs when the `remove` method of the element is called or when the element is destroyed.\n\t * !readonly remover: Handler;\n\t */\n\tremover: null,\n\n\t/**\n\t * Constructs the instance at the specified position and with the specified size.\n\t * !constructor (x: number, y: number, width: number, height: number);\n\t */\n\t__ctor: function (x, y, width, height)\n\t{\n\t\tthis.bounds = Bounds2.Pool.alloc();\n\n\t\tthis.bounds.translate (x, y);\n\t\tthis.bounds.resize (width, height, true);\n\n\t\tthis.flags = GridElement.ALIVE | GridElement.VISIBLE | GridElement.DIRTY | GridElement.DEPTH_FLAG;\n\t\tthis.data = null;\n\t\tthis.ext = null;\n\n\t\tthis.remover = Handler.Pool.alloc(this);\n\t},\n\n\t/**\n\t * Removes the element from its container and destroys it.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.alive(false);\n\n\t\tif (this.data !== null)\n\t\t{\n\t\t\tdispose(this.data);\n\t\t\tthis.data = null;\n\t\t}\n\n\t\tthis.remover.exec();\n\t\tthis.remover.free();\n\n\t\tthis.bounds.free();\n\t},\n\n\t/**\n\t * Sets the identifier of the element.\n\t * !setId (value: string) : GridElement;\n\t */\n\tsetId: function (value)\n\t{\n\t\tthis.id = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets bits of the element flags.\n\t * !setFlags (value: number) : GridElement;\n\t */\n\tsetFlags: function (value)\n\t{\n\t\tthis.flags |= value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Clears bits from the element flags.\n\t * !clearFlags (value: number) : GridElement;\n\t */\n\tclearFlags: function (value)\n\t{\n\t\tthis.flags &= ~value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns true if masking (bitwise AND) the flags by the specified flag bits results in the given value.\n\t * !getFlags (andMask: number, value?: number) : boolean;\n\t */\n\tgetFlags: function (andMask, value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn (this.flags & andMask) === andMask;\n\n\t\treturn (this.flags & andMask) === value;\n\t},\n\n\t/**\n\t * Sets the generic data of the element. Will be disposed when the element is destroyed. The property `host`\n\t * of the object will be set with the reference to the element.\n\t * !setData (data: object) : GridElement;\n\t */\n\tsetData: function (data)\n\t{\n\t\tthis.data = data;\n\n\t\tif (this.data !== null)\n\t\t\tthis.data.host = this;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the generic data of the element.\n\t * !getData() : object;\n\t */\n\tgetData: function()\n\t{\n\t\treturn this.data;\n\t},\n\n\t/**\n\t * Sets the extension object of the element. Calls to functions of this object should be done using the `exec` method.\n\t * !setExt (extensionObject: object) : GridElement;\n\t */\n\tsetExt: function (extensionObject)\n\t{\n\t\tthis.ext = extensionObject;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the extension object of the element.\n\t * !getExt() : object;\n\t */\n\tgetExt: function()\n\t{\n\t\treturn this.ext;\n\t},\n\n\t/**\n\t * Executes a function of the extension object.\n\t * @param {string} name\n\t * !exec (name: string, ...args: any) : any;\n\t */\n\texec: function(name, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null, arg6=null, arg7=null, arg8=null, arg9=null)\n\t{\n\t\tif (this.ext === null || this.ext.hasOwnProperty(name) === false)\n\t\t\treturn false;\n\n\t\treturn this.ext[name] (this, arg0, arg1, arg2, arg3, arg4, arg5, arg6, arg7, arg8, arg9);\n\t},\n\n\t/**\n\t * Sets the visible flag.\n\t * @param {boolean} value - New visibility value.\n\t * @param {boolean} forced - When `true` forces to ignore the VISIBLE_LOCK flag.\n\t * !visible (value: boolean, forced?: boolean|false) : GridElement;\n\t */\n\t/**\n\t * Returns the visible flag.\n\t * !visible() : boolean;\n\t */\n\tvisible: function (value=null, forced=false)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.VISIBLE);\n\n\t\tif (forced === false && (this.flags & GridElement.VISIBLE_LOCK) !== 0)\n\t\t\treturn this;\n\n\t\tthis.flags &= ~GridElement.VISIBLE;\n\t\tif (value === true) this.flags |= GridElement.VISIBLE;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the visible-lock flag.\n\t * !visibleLock (value: boolean) : GridElement;\n\t */\n\t/**\n\t * Returns the visible-lock flag.\n\t * !visibleLock() : boolean;\n\t */\n\tvisibleLock: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.VISIBLE_LOCK);\n\n\t\tthis.flags &= ~GridElement.VISIBLE_LOCK;\n\t\tif (value === true) this.flags |= GridElement.VISIBLE_LOCK;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the alive flag.\n\t * !alive (value: boolean) : GridElement;\n\t */\n\t/**\n\t * Returns the alive flag.\n\t * !alive() : boolean;\n\t */\n\talive: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.ALIVE);\n\n\t\tthis.flags &= ~GridElement.ALIVE;\n\t\tif (value === true) this.flags |= GridElement.ALIVE;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the dirty flag.\n\t * !alive (value: boolean) : GridElement;\n\t */\n\t/**\n\t * Returns the dirty flag.\n\t * !alive() : boolean;\n\t */\n\tdirty: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.DIRTY);\n\n\t\tthis.flags &= ~GridElement.DIRTY;\n\t\tif (value === true) this.flags |= GridElement.DIRTY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the depth-flag-enabled flag.\n\t * !depthFlagEnabled (value: boolean) : GridElement;\n\t */\n\t/**\n\t * Returns the depth-flag-enabled flag.\n\t * !depthFlagEnabled() : boolean;\n\t */\n\tdepthFlagEnabled: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.DEPTH_FLAG_ENABLED);\n\n\t\tthis.flags &= ~GridElement.DEPTH_FLAG_ENABLED;\n\t\tif (value === true) this.flags |= GridElement.DEPTH_FLAG_ENABLED;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the depth-flag flag. To actually use the depth-test, you have to enable the depth-flag using `depthFlagEnabled`.\n\t * !depthFlagEnabled (value: boolean) : GridElement;\n\t */\n\t/**\n\t * Returns the depth-flag flag.\n\t * !depthFlagEnabled() : boolean;\n\t */\n\tdepthFlag: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.DEPTH_FLAG);\n\n\t\tthis.flags &= ~GridElement.DEPTH_FLAG;\n\t\tif (value === true) this.flags |= GridElement.DEPTH_FLAG;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Removes the element from the container and returns itself.\n\t * !remove() : GridElement;\n\t */\n\tremove: function()\n\t{\n\t\tthis.remover.exec();\n\t\treturn this;\n\t},\n\n\t/**\n\t * Syncs the actual location of the specified element with its storage location (if alive and dirty).\n\t * !sync() : GridElement;\n\t */\n\tsync: function()\n\t{\n\t\tif (this.container === null || this.getFlags(GridElement.ALIVE | GridElement.DIRTY) === false)\n\t\t\treturn this;\n\n\t\tthis.container.sync(this);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the width and height of the element.\n\t * !resize (width: number|boolean|null, height: number|boolean|null) : GridElement;\n\t */\n\tresize: function (width, height)\n\t{\n\t\tthis.flags |= GridElement.DIRTY;\n\t\tthis.bounds.resize (width, height, true);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Resizes the element by the specified deltas.\n\t * !resizeBy (deltaWidth: number|boolean, deltaHeight: number|boolean) : GridElement;\n\t */\n\tresizeBy: function (dWidth, dHeight)\n\t{\n\t\tthis.flags |= GridElement.DIRTY;\n\t\tthis.bounds.resizeBy (dWidth, dHeight, true);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Moves the element by the specified deltas.\n\t * @param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * !translate (dx: number, dy: number, upscaled?: boolean) : GridElement;\n\t */\n\ttranslate: function (dx, dy, upscaled=false)\n\t{\n\t\tthis.flags |= GridElement.DIRTY;\n\t\tthis.bounds.translate (dx, dy, upscaled);\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the position of the element. Any parameter set to `null` will cause it not to be changed.\n\t * !setPosition (x: number, y: number) : GridElement;\n\t */\n\t/**\n\t * Sets the position of the element. Any parameter set to `null` will cause it not to be changed.\n\t * !setPosition (pointer: {x:number, y:number}) : GridElement;\n\t */\n\tsetPosition: function (x, y=false)\n\t{\n\t\tif (y === false) {\n\t\t\ty = x.y;\n\t\t\tx = x.x;\n\t\t}\n\n\t\treturn this.translate (x !== null ? upscale(x)-this.bounds.ux1 : 0, y !== null ? upscale(y)-this.bounds.uy1 : 0, true);\n\t}\n});\n\n/*\n**\tGrid element flags.\n*/\nGridElement.ALIVE \t\t\t\t= \t0x0001;\nGridElement.VISIBLE \t\t\t= \t0x0002;\nGridElement.VISIBLE_LOCK \t\t= \t0x0004;\nGridElement.DIRTY \t\t\t\t= \t0x0008;\nGridElement.DEPTH_FLAG_ENABLED\t= \t0x0010;\nGridElement.DEPTH_FLAG\t\t\t= \t0x0020;\nGridElement.WRAP_EXTENTS\t\t=\t0x0040;\n\nGridElement.USERDEF\t\t=\t0x0100; /* Bits 8 to 30 : 23 flags  */\nGridElement.LAST_FLAG\t=\t0x0080;\n\n/**\n * Class-level function to allocate a new flag.\n * !static allocFlag() : number;\n */\nGridElement.allocFlag = function()\n{\n\tlet flag = GridElement.LAST_FLAG;\n\tif (flag === 0x4000_0000) throw new Error ('allocFlag: out of bit space to allocate another flag');\n\n\tflag <<= 1;\n\tGridElement.LAST_FLAG = flag;\n\n\treturn flag;\n};\n\nexport default GridElement;\n","\nimport { Class } from 'rinn';\nimport GridElement from './grid-element.js';\nimport List from '../utils/list.js';\n\n//![import \"./grid-element\"]\n//![import \"../utils/list\"]\n\n//:/**\n//: * \tDescribes an optimized data structure to store 2D spatially indexed elements.\n//: */\n\n//!class Grid\n\nconst Grid = Class.extend\n({\n\t/**\n\t * Name of the class (for inheritance purposes).\n\t */\n\tclassName: 'Grid',\n\n\t/**\n\t * Actual grid of data, stored linearly. Contains several entries each of which can be either null or a List containing grid elements.\n\t */\n\tgrid: null,\n\n\t/**\n\t * Number of elements active in the grid.\n\t * !readonly count: number;\n\t */\n\tcount: 0,\n\n\t/**\n\t * The X and Y offsets to be added to all input coordinates. Used to ensure that a negative coordinate always ends up positive, calculated\n\t * using the width and height of the grid.\n\t */\n\toffsx: 0, offsy: 0,\n\n\t/**\n\t * Divisors for the X and Y coordinates respectively. All input coordinates (after offseting) will be divided by these values to map them\n\t * to a grid entry (list) where the element can be added.\n\t */\n\tkx: 0, ky: 0,\n\n\t/**\n\t * Stride to calculate an index with a Y-coordinate.\n\t */\n\tstride: 0,\n\n\t/**\n\t * Indicates if the grid should match regions with exact precision by comparing region to element bounds intersection.\n\t * !verifyIntersection: boolean;\n\t */\n\tverifyIntersection: true,\n\n\t/**\n\t * Constructs a grid with the specified maximum width and height. The final effective coordinate range will be -(width/2) to (width/2)for X,\n\t * and -(height/2) to (height/2) for Y.\n\t * \n\t * Note that the width, height and divisors kx and ky will be converted to their closest base-2 value. This is done to ensure shifts can be used\n\t * to quickly divide the input coordinates.\n\t * \n\t * !constructor (width: number, height: number, kx: number, ky?: number);\n\t */\n\t__ctor: function (width, height, kx, ky=null)\n\t{\n\t\twidth = 1 << Math.ceil(Math.log2(width));\n\t\theight = 1 << Math.ceil(Math.log2(height));\n\n\t\tthis.offsx = width >> 1;\n\t\tthis.offsy = height >> 1;\n\n\t\tif (ky === null)\n\t\t\tky = kx;\n\n\t\tkx = Math.floor(Math.log2(kx));\n\t\tky = Math.floor(Math.log2(ky));\n\n\t\tthis.kx = kx;\n\t\tthis.ky = ky;\n\n\t\tlet w = width >> kx;\n\t\tlet h = height >> ky;\n\n\t\tif (!w) {\n\t\t\tkx = Math.log2(width);\n\t\t\tw = 1;\n\t\t}\n\n\t\tif (!h) {\n\t\t\tky = Math.log2(height);\n\t\t\th = 1;\n\t\t}\n\n\t\tthis.grid = new Array(w*h).fill(null);\n\t\tthis.stride = w;\n\t},\n\n\t/**\n\t * Destroys all lists and elements in the grid.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis.grid = null;\n\t},\n\n\t/**\n\t * Returns the value of the `strict` intersection flag.\n\t * !strict() : boolean;\n\t */\n\t/**\n\t * Sets the `strict` intersection flag, when set, only elements that intersect with the region when using forEachInRegion and similar methods will be used.\n\t * !strict (value: boolean) : Grid;\n\t */\n\tstrict: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this.verifyIntersection;\n\n\t\tthis.verifyIntersection = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tDestroys all lists and elements in the grid.\n\t * \t!clear() : void;\n\t */\n\tclear: function()\n\t{\n\t\tfor (let i = 0; i < this.grid.length; i++)\n\t\t{\n\t\t\tif (this.grid[i] === null)\n\t\t\t\tcontinue;\n\n\t\t\tlet j;\n\n\t\t\twhile ((j = this.grid[i].shift()) !== null)\n\t\t\t{\n\t\t\t\tj.remover.remove(this._remove, this);\n\t\t\t\tj.container = null;\n\n\t\t\t\tdispose(j);\n\t\t\t}\n\n\t\t\tthis.grid[i].free();\n\t\t\tthis.grid[i] = null;\n\t\t}\n\n\t\tthis.count = 0;\n\t},\n\n\t/**\n\t * \tDestroys all lists in the grid. Elements will not be destroyed.\n\t * \t!reset() : void;\n\t */\n\treset: function()\n\t{\n\t\tfor (let i = 0; i < this.grid.length; i++)\n\t\t{\n\t\t\tif (this.grid[i] === null)\n\t\t\t\tcontinue;\n\n\t\t\tlet j;\n\n\t\t\twhile ((j = this.grid[i].shift()) !== null)\n\t\t\t{\n\t\t\t\tj.remover.remove(this._remove, this);\n\t\t\t\tj.container = null;\n\t\t\t}\n\n\t\t\tthis.grid[i].free();\n\t\t\tthis.grid[i] = null;\n\t\t}\n\n\t\tthis.count = 0;\n\t},\n\n\t/**\n\t * \tAdds an element to the grid. Returns `true` if successful, or `false` if the element is outside of the grid bounds.\n\t * \t!add (elem: GridElement) : boolean;\n\t */\n\tadd: function (elem)\n\t{\n\t\tif (GridElement.isInstance(elem) === false)\n\t\t\tthrow new Error ('argument must be a GridElement');\n\n\t\tlet i = int((elem.bounds.y1+this.offsy) >> this.ky) * this.stride + int((elem.bounds.x1+this.offsx) >> this.kx);\n\t\tif (i < 0 || i >= this.grid.length) return false;\n\n\t\tif (this.grid[i] === null)\n\t\t\tthis.grid[i] = List.Pool.alloc();\n\n\t\tthis.grid[i].push(elem);\n\t\tthis.count++;\n\n\t\telem.container = this;\n\t\telem._grid_remove_node = elem.remover.add(this._remove, this, i, this.grid[i].bottom);\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tCallback to remove an element from the grid (called by Handler).\n\t */\n\t_remove: function (elem, self, index, node)\n\t{\n\t\tself.grid[index].remove(node);\n\t\tself.count--;\n\n\t\telem.container = null;\n\t\treturn false;\n\t},\n\n\t/**\n\t * \tRemoves the element from the grid and returns it.\n\t * \t!remove (elem: GridElement) : GridElement;\n\t */\n\tremove: function (elem)\n\t{\n\t\telem.remover.execc(this._grid_remove_node);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tUpdates the storage location of the specified element. Returns `true` if successful, or `false` if the element is outside of the grid bounds (in\n\t * \twhich case the element will be removed), or if the element does not belong to this grid.\n\t * \t!sync (elem: GridElement) : boolean;\n\t */\n\tsync: function (elem)\n\t{\n\t\telem.clearFlags(GridElement.DIRTY);\n\n\t\tlet node = elem._grid_remove_node;\n\n\t\tlet i = int((elem.bounds.y1+this.offsy) >> this.ky) * this.stride + int((elem.bounds.x1+this.offsx) >> this.kx);\n\t\tif (i < 0 || i >= this.grid.length)\n\t\t{\n\t\t\telem.remover.execc(node);\n\t\t\treturn false;\n\t\t}\n\n\t\tif (node.arg1 === i)\n\t\t\treturn true;\n\n\t\tthis.grid[node.arg1].remove(node.arg2);\n\n\t\tif (this.grid[i] === null)\n\t\t\tthis.grid[i] = List.Pool.alloc();\n\n\t\tthis.grid[i].push(elem);\n\n\t\tnode.arg1 = i;\n\t\tnode.arg2 = this.grid[i].bottom;\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tExecutes the specified callback function for each element that intersects the given bounds and has the specified flags set. The process is immediately\n\t * \tstopped if the callback returns `false`.\n\t * \t!forEachInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number, callback: (elem: GridElement, context?: object) => boolean, context?: object) : void;\n\t */\n\tforEachInRegion: function (bounds, flagsAndMask, flagsValue, callback, context)\n\t{\n\t\tlet j0 = ((bounds.y1+this.offsy) - (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet j1 = ((bounds.y2+this.offsy) + (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet i0 = ((bounds.x1+this.offsx) - (1<<this.kx-1) >> this.kx);\n\t\tlet i1 = ((bounds.x2+this.offsx) + (1<<this.kx-1) >> this.kx);\n\n\t\tlet n = this.grid.length-1;\n\n\t\tif (j0 < 0) j0 = 0; if (j1 < 0) j1 = 0;\n\t\tif (i0 < 0) i0 = 0; if (i1 < 0) i1 = 0;\n\t\tif (j0 > n) j0 = n; if (j1 > n) j1 = n;\n\t\tif (i0 > n) i0 = n; if (i1 > n) i1 = n;\n\n\t\tfor (let j = j0; j <= j1; j += this.stride)\n\t\t{\n\t\t\tfor (let i = i0; i <= i1; i++)\n\t\t\t{\n\t\t\t\tlet k = j + i;\n\t\t\t\tif (k > n || this.grid[k] === null) continue;\n\n\t\t\t\tfor (let e = this.grid[k].top; e; e = e.next)\n\t\t\t\t{\n\t\t\t\t\tconst v = e.value;\n\n\t\t\t\t\t// First check the element flags.\n\t\t\t\t\tif (v.getFlags(flagsAndMask, flagsValue) === false) continue;\n\n\t\t\t\t\t// Verify exact intersection only on elements located on the edges of the indexed-based approximated rectangle.\n\t\t\t\t\tif (this.verifyIntersection === true && (j <= j0+1 || i <= i0+1 || j >= j1-1 || i >= i1-1))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (v.bounds.x2 < bounds.x1 || v.bounds.y2 < bounds.y1 || v.bounds.x1 > bounds.x2 || v.bounds.y1 > bounds.y2)\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (callback(v, context) === false)\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * \tCollects all elements that intersect the given bounds and have the specified flags set. Returns a new List, remember to call `free` after using it.\n\t * \t!selectInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : List;\n\t */\n\tselectInRegion: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\tlet j0 = ((bounds.y1+this.offsy) - (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet j1 = ((bounds.y2+this.offsy) + (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet i0 = ((bounds.x1+this.offsx) - (1<<this.kx-1) >> this.kx);\n\t\tlet i1 = ((bounds.x2+this.offsx) + (1<<this.kx-1) >> this.kx);\n\n\t\tlet n = this.grid.length-1;\n\n\t\tif (j0 < 0) j0 = 0; if (j1 < 0) j1 = 0;\n\t\tif (i0 < 0) i0 = 0; if (i1 < 0) i1 = 0;\n\t\tif (j0 > n) j0 = n; if (j1 > n) j1 = n;\n\t\tif (i0 > n) i0 = n; if (i1 > n) i1 = n;\n\n\t\tlet list = List.Pool.alloc();\n\n\t\tfor (let j = j0; j <= j1; j += this.stride)\n\t\t{\n\t\t\tfor (let i = i0; i <= i1; i++)\n\t\t\t{\n\t\t\t\tlet k = j + i;\n\t\t\t\tif (k > n || this.grid[k] === null) continue;\n\n\t\t\t\tfor (let e = this.grid[k].top; e; e = e.next)\n\t\t\t\t{\n\t\t\t\t\tconst v = e.value;\n\n\t\t\t\t\t// First check the element flags.\n\t\t\t\t\tif (v.getFlags(flagsAndMask, flagsValue) === false) continue;\n\n\t\t\t\t\t// Verify exact intersection only on elements located on the edges of the indexed-based approximated rectangle.\n\t\t\t\t\tif (this.verifyIntersection === true && (j <= j0+1 || i <= i0+1 || j >= j1-1 || i >= i1-1))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (v.bounds.x2 < bounds.x1 || v.bounds.y2 < bounds.y1 || v.bounds.x1 > bounds.x2 || v.bounds.y1 > bounds.y2)\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tlist.push(v);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn list;\n\t},\n\n\t/**\n\t * \tCounts all elements that intersect the given bounds and have the specified flags set.\n\t * \t!countInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : number;\n\t */\n\tcountInRegion: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\tlet j0 = ((bounds.y1+this.offsy) - (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet j1 = ((bounds.y2+this.offsy) + (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet i0 = ((bounds.x1+this.offsx) - (1<<this.kx-1) >> this.kx);\n\t\tlet i1 = ((bounds.x2+this.offsx) + (1<<this.kx-1) >> this.kx);\n\n\t\tlet n = this.grid.length-1;\n\n\t\tif (j0 < 0) j0 = 0; if (j1 < 0) j1 = 0;\n\t\tif (i0 < 0) i0 = 0; if (i1 < 0) i1 = 0;\n\t\tif (j0 > n) j0 = n; if (j1 > n) j1 = n;\n\t\tif (i0 > n) i0 = n; if (i1 > n) i1 = n;\n\n\t\tlet m = 0;\n\n\t\tfor (let j = j0; j <= j1; j += this.stride)\n\t\t{\n\t\t\tfor (let i = i0; i <= i1; i++)\n\t\t\t{\n\t\t\t\tlet k = j + i;\n\t\t\t\tif (k > n || this.grid[k] === null) continue;\n\n\t\t\t\tfor (let e = this.grid[k].top; e; e = e.next)\n\t\t\t\t{\n\t\t\t\t\tconst v = e.value;\n\n\t\t\t\t\t// First check the element flags.\n\t\t\t\t\tif (v.getFlags(flagsAndMask, flagsValue) === false) continue;\n\n\t\t\t\t\t// Verify exact intersection only on elements located on the edges of the indexed-based approximated rectangle.\n\t\t\t\t\tif (this.verifyIntersection === true && (j <= j0+1 || i <= i0+1 || j >= j1-1 || i >= i1-1))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (v.bounds.x2 < bounds.x1 || v.bounds.y2 < bounds.y1 || v.bounds.x1 > bounds.x2 || v.bounds.y1 > bounds.y2)\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tm++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn m;\n\t},\n\n\t/**\n\t * \tReturns the first element that intersect the given bounds and have the specified flags set.\n\t * \t!selectFirst (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : GridElement;\n\t */\n\tselectFirst: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\tlet j0 = ((bounds.y1+this.offsy) - (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet j1 = ((bounds.y2+this.offsy) + (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet i0 = ((bounds.x1+this.offsx) - (1<<this.kx-1) >> this.kx);\n\t\tlet i1 = ((bounds.x2+this.offsx) + (1<<this.kx-1) >> this.kx);\n\n\t\tlet n = this.grid.length-1;\n\n\t\tif (j0 < 0) j0 = 0; if (j1 < 0) j1 = 0;\n\t\tif (i0 < 0) i0 = 0; if (i1 < 0) i1 = 0;\n\t\tif (j0 > n) j0 = n; if (j1 > n) j1 = n;\n\t\tif (i0 > n) i0 = n; if (i1 > n) i1 = n;\n\n\t\tfor (let j = j0; j <= j1; j += this.stride)\n\t\t{\n\t\t\tfor (let i = i0; i <= i1; i++)\n\t\t\t{\n\t\t\t\tlet k = j + i;\n\t\t\t\tif (k > n || this.grid[k] === null) continue;\n\n\t\t\t\tfor (let e = this.grid[k].top; e; e = e.next)\n\t\t\t\t{\n\t\t\t\t\tconst v = e.value;\n\n\t\t\t\t\t// First check the element flags.\n\t\t\t\t\tif (v.getFlags(flagsAndMask, flagsValue) === false) continue;\n\n\t\t\t\t\t// Verify exact intersection only on elements located on the edges of the indexed-based approximated rectangle.\n\t\t\t\t\tif (this.verifyIntersection === true && (j <= j0+1 || i <= i0+1 || j >= j1-1 || i >= i1-1))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (v.bounds.x2 < bounds.x1 || v.bounds.y2 < bounds.y1 || v.bounds.x1 > bounds.x2 || v.bounds.y1 > bounds.y2)\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n});\n\nexport default Grid;\n","\nimport { Class } from 'rinn';\nimport Container from './container.js';\nimport Viewport from './viewport.js';\nimport Group from './group.js';\nimport Bounds2 from '../math/bounds2.js';\nimport List from '../utils/list.js';\nimport Handler from '../utils/handler.js';\nimport globals from '../system/globals.js';\nimport Log from '../system/log.js';\n\n//![import \"./container\"]\n//![import \"./viewport\"]\n//![import \"./group\"]\n//![import \"../math/bounds2\"]\n//![import \"../utils/list\"]\n//![import \"../utils/handler\"]\n//![import \"../system/globals\"]\n\n//:/**\n//: * \tA scene is a set of containers, viewports and groups. Rendering is done in their specific index-based order.\n//: */\n\n//!class Scene\n\nconst Scene = Class.extend\n({\n\tclassName: 'Scene',\n\n\t/**\n\t * Minimum dimensions of the scene (smallest container size).\n\t * !readonly minWidth: number;\n\t * !readonly minHeight: number;\n\t */\n\tminWidth: null,\n\tminHeight: null,\n\n\t/**\n\t * Maximum dimensions of the scene (largest container size).\n\t * !readonly maxWidth: number;\n\t * !readonly maxHeight: number;\n\t */\n\tmaxWidth: null,\n\tmaxHeight: null,\n\n\t/**\n\t * List of containers.\n\t */\n\tcontainers: null,\n\n\t/**\n\t * List of viewports.\n\t */\n\tviewports: null,\n\n\t/**\n\t * Active viewport bounds, used to select items in a visible region.\n\t * !readonly viewportBounds: Bounds2;\n\t */\n\tviewportBounds: null,\n\n\t/**\n\t * List of Group elements.\n\t */\n\tgroupList: null,\n\n\t/**\n\t * Named Group elements.\n\t */\n\tgroups: null,\n\n\t/**\n\t * Disposal queue.\n\t */\n\tdisposalQueue: null,\n\n\t/**\n\t * First updater. Runs before any other update calls.\n\t * !readonly fupdater: Handler;\n\t */\n\tfupdater: null,\n\n\t/**\n\t * General updater. Runs after the first updater and before synchronizer.\n\t * !readonly updater: Handler;\n\t */\n\tupdater: null,\n\n\t/**\n\t * Synchronizer. Run after general updater, and before viewport synchronization.\n\t * !readonly synchronizer: Handler;\n\t */\n\tsynchronizer: null,\n\n\t/**\n\t * Last updater. Runs after all other update calls.\n\t * !readonly lupdater: Handler;\n\t */\n\tlupdater: null,\n\n\t/**\n\t * Destroyer runs when the scene is destroyed.\n\t * !readonly destroyer: Handler;\n\t */\n\tdestroyer: null,\n\n\t/**\n\t * Current delta time. Set upon entering the `update` method. Reflects the same value as System.frameDelta.\n\t * !readonly dt: number;\n\t */\n\tdt: 0,\n\n\t/**\n\t * Flags of the object (see constants at the bottom of this file).\n\t */\n\tflags: 0,\n\n\t/**\n\t * Total number of elements drawn on the last draw operation.\n\t * !readonly drawCount: number;\n\t */\n\tdrawCount: 0,\n\n\t/**\n\t * Scene object pointing to itself.\n\t */\n\tscene: null,\n\n\t/**\n\t * Base depth (z-value) of the scene.\n\t * !readonly zvalue: number;\n\t */\n\tzvalue: null,\n\n\t/**\n\t * Name of the layer.\n\t * !readonly name: string;\n\t */\n\tname: null,\n\n\t/**\n\t * Constructs an empty scene with the specified index.\n\t * @param index - Index for the scene. Used to calculate the base z-value of the scene. Valid range is from 0 to 3.\n\t * @param name - Name of the scene, used for debugging purposes. If none provided SCENE_X will be used where X is the scene's index.\n\t * !constructor (index: number, name?: string);\n\t */\n\t__ctor: function (index, name=null)\n\t{\n\t\tthis.containers = [];\n\n\t\t/**\n\t\t * \tZ-value is a 24-bit value constructed as:\n\t\t *\t\t2-bits: Scene Index\n\t\t *\t\t4-bits: Container Index\n\t\t *\t\t18-bits: Element z-value\n\t\t */\n\t\tthis.zvalue = (index & 3) << (18+4);\n\t\tthis.name = name !== null ? name : (\"SCENE_\" + index);\n\n\t\tthis.viewports = [];\n\t\tthis.viewportBounds = Bounds2.Pool.alloc();\n\n\t\tthis.groupList = List.Pool.alloc();\n\t\tthis.groups = { };\n\n\t\tthis.disposalQueue = List.Pool.alloc();\n\n\t\tthis.fupdater = Handler.Pool.alloc(this);\n\t\tthis.updater = Handler.Pool.alloc(this);\n\t\tthis.synchronizer = Handler.Pool.alloc(this);\n\t\tthis.lupdater = Handler.Pool.alloc(this);\n\t\tthis.destroyer = Handler.Pool.alloc(this);\n\n\t\tthis.flags = Scene.VISIBLE;\n\t\tthis.scene = this;\n\t},\n\n\t/**\n\t * Destroys the instance along with all containers, viewports and groups.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.disposeQueued();\n\t\tthis.disposalQueue.free();\n\n\t\tthis.destroyer.exec();\n\t\tthis.destroyer.free();\n\n\t\tthis.fupdater.free();\n\t\tthis.updater.free();\n\t\tthis.synchronizer.free();\n\t\tthis.lupdater.free();\n\n\t\tlet i;\n\n\t\twhile ((i = this.groupList.shift()) !== null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.container = null;\n\t\t\tdispose(i);\n\t\t}\n\n\t\tfor (i = 0; i < this.containers.length; i++)\n\t\t{\n\t\t\tif (!this.containers[i]) continue;\n\n\t\t\tthis.containers[i].scene = null;\n\t\t\tdispose(this.containers[i]);\n\n\t\t\tthis.containers[i] = null;\n\t\t}\n\n\t\tfor (i = 0; i < this.viewports.length; i++)\n\t\t{\n\t\t\tif (!this.viewports[i]) continue;\n\n\t\t\tdispose(this.viewports[i]);\n\t\t\tthis.viewports[i] = null;\n\t\t}\n\n\t\tthis.viewportBounds.free();\n\t\tthis.groupList.free();\n\t},\n\n\t/**\n\t * Clears the scene by removing all groups and clearing the containers, leaving only viewports alive.\n\t * !clear() : void;\n\t */\n\tclear: function()\n\t{\n\t\tthis.disposeQueued();\n\n\t\tlet i;\n\n\t\twhile ((i = this.groupList.shift()) !== null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.container = null;\n\t\t\tdispose(i);\n\t\t}\n\n\t\tfor (i = 0; i < this.containers.length; i++)\n\t\t{\n\t\t\tif (this.containers[i])\n\t\t\t\tthis.containers[i].clear();\n\t\t}\n\t},\n\n\t/**\n\t * Returns the value of the `visible` flag.\n\t * !visible() : boolean;\n\t */\n\t/**\n\t * Sets the value of the `visible` flag.\n\t * !visible(value: boolean) : Container;\n\t */\n\tvisible: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Scene.VISIBLE);\n\n\t\tthis.flags &= ~Scene.VISIBLE;\n\t\tif (value) this.flags |= Scene.VISIBLE;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets a container at the specified index.\n\t * @param index - Index of the container, valid range is from 0 to 15.\n\t * !setContainer (index: number, container: Container) : Scene;\n\t */\n\tsetContainer: function (index, container)\n\t{\n\t\tif (index < 0) return this;\n\t\tindex &= 15;\n\n\t\tif (container === null)\n\t\t{\n\t\t\tthis.containers[index].scene = null;\n\t\t\tthis.containers[index] = null;\n\t\t\treturn this;\n\t\t}\n\n\t\tif (!Container.isInstance(container))\n\t\t\tthrow new Error('Scene: Unable to set container at index ' + index + ': argument is not a Container');\n\n\t\tif (this.minWidth === null || container.width < this.minWidth) this.minWidth = container.width;\n\t\tif (this.minHeight === null || container.height < this.minHeight) this.minHeight = container.height;\n\t\tif (this.maxWidth === null || container.width > this.maxWidth) this.maxWidth = container.width;\n\t\tif (this.maxHeight === null || container.height > this.maxHeight) this.maxHeight = container.height;\n\n\t\tcontainer.scene = this;\n\t\tcontainer.zvalue = this.zvalue + (index << 18);\n\n\t\tthis.containers[index] = container;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the container at the specified index.\n\t * !getContainer (index: number) : Container;\n\t */\n\tgetContainer: function (index)\n\t{\n\t\treturn index < 0 || index >= this.containers.length ? null : this.containers[index];\n\t},\n\n\t/**\n\t * Sets a viewport at the specified index.\n\t * !setViewport (index: number, viewport: Viewport) : Scene;\n\t */\n\tsetViewport: function (index, viewport)\n\t{\n\t\tif (index < 0) return this;\n\n\t\tif (viewport !== null && !Viewport.isInstance(viewport))\n\t\t\tthrow new Error('Scene: Unable to set viewport at index ' + index + ': argument is not a Viewport.');\n\n\t\tthis.viewports[index] = viewport;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the viewport at the specified index.\n\t * !getViewport (index: number) : Viewport;\n\t */\n\tgetViewport: function (index)\n\t{\n\t\treturn index < 0 || index >= this.viewports.length ? null : this.viewports[index];\n\t},\n\n\t/**\n\t * Adds the given element to the disposal queue. To be destroyed on the next call to `disposeQueued`.\n\t * !disposeLater (elem: Element) : void;\n\t */\n\tdisposeLater: function (elem)\n\t{\n\t\tif (!elem.alive()) return;\n\n\t\tthis.disposalQueue.push(elem);\n\t\telem.alive(false);\n\t},\n\n\t/**\n\t * Disposes all elements in the disposal queue.\n\t * !disposeQueued() : void;\n\t */\n\tdisposeQueued: function ()\n\t{\n\t\tlet elem;\n\n\t\twhile ((elem = this.disposalQueue.shift()) !== null)\n\t\t\tdispose(elem);\n\t},\n\n\t/**\n\t * Adds a group to the scene.\n\t * !addGroup (group: Group) : boolean;\n\t */\n\taddGroup: function (group)\n\t{\n\t\tif (!Group.isInstance(group))\n\t\t\tthrow new Error ('argument must be a Group');\n\n\t\tthis.groupList.push(group);\n\n\t\tif (group.id !== null)\n\t\t\tthis.groups[group.id] = group;\n\n\t\tgroup.container = this;\n\t\tgroup.remover.add(this._removeGroup, this, this.groupList.bottom);\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * Callback to remove a group from the scene (called by Handler).\n\t */\n\t_removeGroup: function (group, self, node)\n\t{\n\t\tgroup.container = null;\n\t\tself.groupList.remove(node);\n\n\t\tif (group.id !== null)\n\t\t\tself.groups[group.id] = null;\n\n\t\treturn false;\n\t},\n\n\t/**\n\t * Removes a group from the scene.\n\t * !removeGroup (group: Group) : Group;\n\t */\n\tremoveGroup: function (group)\n\t{\n\t\tgroup.remover.execf(this._remove, this);\n\t\treturn group;\n\t},\n\n\t/**\n\t * Syncs the actual location of the specified element with its storage location. Returns `true` if successful.\n\t * !sync (group: Group) : boolean;\n\t */\n\tsync: function (group)\n\t{\n\t\treturn true;\n\t},\n\n\t/**\n\t * Draws the scene, by executing the `draw` method on each container. The entire scene will be drawn once for each viewport, and\n\t * the visible region rules of each viewport will be applied.\n\t * !draw (g: Canvas) : void;\n\t */\n\tdraw: function (g)\n\t{\n\t\tif (!this.visible()) return;\n\n\t\tthis.drawCount = 0;\n\n\t\tif (this.viewports.length)\n\t\t{\n\t\t\tfor (let viewportIndex = 0; viewportIndex < this.viewports.length; viewportIndex++)\n\t\t\t{\n\t\t\t\tlet viewport = this.viewports[viewportIndex];\n\t\t\t\tif (!viewport || !viewport.enabled()) continue;\n\n\t\t\t\tglobals.viewport = viewport;\n\n\t\t\t\tg.pushClip();\n\t\t\t\tg.pushMatrix();\n\n\t\t\t\tviewport.applyClip(g);\n\t\t\t\tviewport.applyTransform(g);\n\n\t\t\t\tthis.viewportBounds.set(viewport.bounds);//.resizeBy(2, 2);\n\t\t\t\tthis.drawContainers(g, this.viewportBounds);\n\n\t\t\t\tg.popMatrix();\n\t\t\t\tg.popClip();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tthis.drawContainers(g, null);\n\n\t\tif (Log.enabled)\n\t\t\tLog.vars[this.name] = this.drawCount;\n\t},\n\n\t/**\n\t * Draws the scene containers and passes the specified viewport bounds to the container.\n\t * !drawContainers (g: Canvas, viewportBounds: Bounds2) : void;\n\t */\n\tdrawContainers: function (g, viewportBounds)\n\t{\n\t\tfor (let i = 0; i < this.containers.length; i++)\n\t\t{\n\t\t\tif (!this.containers[i])\n\t\t\t\tcontinue;\n\n\t\t\tthis.containers[i].setViewportBounds(viewportBounds);\n\t\t\tthis.containers[i].draw(g);\n\n\t\t\tthis.drawCount += this.containers[i].drawCount;\n\t\t}\n\t},\n\n\t/**\n\t * Updates the scene viewports.\n\t */\n\tupdateViewports: function ()\n\t{\n\t\tfor (let i = 0; i < this.viewports.length; i++)\n\t\t{\n\t\t\tif (!this.viewports[i])\n\t\t\t\tcontinue;\n\n\t\t\tthis.viewports[i].update(this.dt);\n\t\t}\n\t},\n\n\t/**\n\t * Runs a scene update cycle.\n\t * !update (dt: number) : void;\n\t */\n\tupdate: function (dt)\n\t{\n\t\tthis.dt = dt;\n\t\tthis.fupdater.exec();\n\n\t\tthis.updater.exec();\n\t\tthis.disposeQueued();\n\t\tthis.synchronizer.exec();\n\t\tthis.updateViewports();\n\n\t\tthis.lupdater.exec();\n\t}\n});\n\n\n/**\n * \tConstants.\n */\nScene.VISIBLE = 0x001;\n\nexport default Scene;\n","\nimport { Class } from 'rinn';\nimport Handler from '../utils/handler';\n\n//:/**\n//: * \tA container is responsible to store elements for their subsequent rendering. The actual storage mechanism used can vary and must be implemented by derived\n//: * \tclasses (see `GridContainer` and `SimpleContainer`).\n//: */\n\n//!class Container\n\nconst Container = Class.extend\n({\n\tclassName: 'Container',\n\n\t/**\n\t * Viewport bounds currently active. Set by the Scene class before calling `draw`.\n\t * !viewportBounds: Bounds2;\n\t */\n\tviewportBounds: null,\n\n\t/**\n\t * Width of the container.\n\t * !width: number;\n\t */\n\twidth: 0,\n\n\t/**\n\t * Height of the container.\n\t * !height: number;\n\t */\n\theight: 0,\n\n\t/**\n\t * Depth (z-value) of the container, calculated by the scene.\n\t * !zvalue: number;\n\t */\n\tzvalue: 0,\n\n\t/**\n\t * Scene object to which this container belongs.\n\t * !scene: Scene;\n\t */\n\tscene: null,\n\n\t/**\n\t * Flags of the object (see constants at the bottom of this file).\n\t * !flags: number;\n\t */\n\tflags: 0,\n\n\t/**\n\t * Currently active display buffer for rendering operations (used by drawElement).\n\t * !g: Canvas;\n\t */\n\tg: null,\n\n\t/**\n\t * Total number of elements in the container.\n\t * !readonly elementCount: number;\n\t */\n\telementCount: 0,\n\n\t/**\n\t * Total number of elements drawn on the last draw operation.\n\t * !readonly drawCount: number;\n\t */\n\tdrawCount: 0,\n\n\t// TODO This might be useless when we move to variable container/scenes mode. So, ensure you destroy this ldraw crap.\n\t/**\n\t * Draw handler executed after the scene is drawn.\n\t * !readonly ldraw: Handler;\n\t */\n\tldraw: null,\n\n\t/**\n\t * Constructs the container with the default size (32768 x 32768).\n\t * !constructor ();\n\t */\n\t/**\n\t * Constructs the container with the specified size.\n\t * !constructor (width: number, height: number);\n\t */\n\t__ctor: function (width=32768, height=32768)\n\t{\n\t\tthis.width = width;\n\t\tthis.height = height;\n\n\t\tthis.flags = Container.VISIBLE | Container.DEPTH_FLAG;\n\t\tthis.ldraw = Handler.Pool.alloc(this);\n\t},\n\n\t/**\n\t * Destroys the container.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.ldraw.free();\n\t},\n\n\t/**\n\t * Returns the value of the `visible` flag.\n\t * !visible() : boolean;\n\t */\n\t/**\n\t * Sets the value of the `visible` flag.\n\t * !visible(value: boolean) : Container;\n\t */\n\tvisible: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Container.VISIBLE);\n\n\t\tthis.flags &= ~Container.VISIBLE;\n\t\tif (value === true) this.flags |= Container.VISIBLE;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the value of the `depthFlag` flag.\n\t * !depthFlag() : boolean;\n\t */\n\t/**\n\t * Sets the value of the `depthFlag` flag.\n\t * !depthFlag(value: boolean) : Container;\n\t */\n\tdepthFlag: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Container.DEPTH_FLAG);\n\n\t\tthis.flags &= ~Container.DEPTH_FLAG;\n\t\tif (value === true) this.flags |= Container.DEPTH_FLAG;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the active viewport bounds.\n\t * !setViewportBounds (bounds: Bounds2) : Container;\n\t */\n\tsetViewportBounds: function (bounds)\n\t{\n\t\tthis.viewportBounds = bounds;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Draws the specified element.\n\t * !drawElement (elem: Element, self: Container) : boolean;\n\t */\n\tdrawElement: function (elem, self)\n\t{\n\t\tself.drawCount++;\n\t\treturn elem.draw(self.g);\n\t},\n\n\t/**\n\t * Updates the Z-value of the specified element. Should be called after adding an element and after/before every sync.\n\t * !syncZ (elem: Element) : void;\n\t */\n\tsyncZ: function (elem)\n\t{\n\t\telem.__zvalue = this.zvalue + ((elem._zvalue + elem.bounds.y2) & ((1 << 18) - 1));\n\t\t//elem.__zvalue = this.zvalue + (1 << 18) - ((elem._zvalue + elem.bounds.y2 + (1 << 18)) & ((1 << 18) - 1));\n\t},\n\n\t/**\n\t * Syncs the actual location of the specified element with its storage location. Returns true if successful.\n\t * !sync (elem: Element) : boolean;\n\t */\n\tsync: function (elem)\n\t{\n\t\tthrow new Error ('Container::sync not implemented');\n\t},\n\n\t/**\n\t * Clears the container to empty. All contained elements will be destroyed.\n\t * !clear() : void;\n\t */\n\tclear: function() /* @override */\n\t{\n\t\tthrow new Error ('Container::clear not implemented');\n\t},\n\n\t/**\n\t * Resets the container to empty. Contained elements are not destroyed. Use `clear` if that is your intention.\n\t * !reset() : void;\n\t */\n\treset: function() /* @override */\n\t{\n\t\tthrow new Error ('Container::reset not implemented');\n\t},\n\n\t/**\n\t * Adds an element to the container. Returns boolean indicating if successful.\n\t * !add (elem: Element) : Element;\n\t */\n\tadd: function (elem) /* @override */\n\t{\n\t\tthrow new Error ('Container::add not implemented');\n\t},\n\n\t/**\n\t * Removes an element from the container and returns it.\n\t * !remove (elem: Element) : Element;\n\t */\n\tremove: function (elem) /* @override */\n\t{\n\t\tthrow new Error ('Container::remove not implemented');\n\t},\n\n\t/**\n\t * Prepares the canvas with depth flag configuration and Z-value to draw the contained elements.\n\t * !draw (g: Canvas) : void;\n\t */\n\tdraw: function(g)\n\t{\n\t\tif (this.visible() === false) return;\n\n\t\tlet depthFlagChanged = g.pushDepthFlag(this.flags & Container.DEPTH_FLAG);\n\n\t\tg.zvalue = this.zvalue;\n\n\t\tthis.drawCount = 0;\n\t\tthis.g = g;\n\n\t\tthis.render();\n\t\tthis.ldraw.exec(g);\n\n\t\tif (depthFlagChanged === true) g.popDepthFlag();\n\t},\n\n\t/**\n\t * Actually draws the contained elements.\n\t * !render() : void;\n\t */\n\trender: function()\n\t{\n\t\tthrow new Error ('Container::render not implemented');\n\t}\n});\n\n\n/*\n**\tConstants.\n*/\nContainer.VISIBLE = 0x001;\nContainer.DEPTH_FLAG = 0x002;\n\nexport default Container;\n","\nimport { Class } from 'rinn';\nimport Bounds2 from '../math/bounds2.js';\nimport Point2 from '../math/point2.js';\n\n//![import \"../math/point2\"]\n//![import \"../math/bounds2\"]\n//![import \"../math/rect\"]\n//![import \"../system/canvas\"]\n\n//:/**\n//: * \tViewport class controls the current visible rectangle of a container.\n//: */\n\n//!class Viewport\n\nconst Viewport = Class.extend\n({\n\tclassName: 'Viewport',\n\n\t/**\n\t * \tDimensions of the viewport.\n\t *\n\t * \t!readonly width: number;\n\t * \t!readonly height: number;\n\t */\n\twidth: 0, initialWidth: 0,\n\theight: 0, initialHeight: 0,\n\n\t/**\n\t * \tPosition of the top-left corner of the viewport in screen space.\n\t */\n\tsx: 0,\n\tsy: 0,\n\n\t/**\n\t * \tPosition of the center of the viewport in the container.\n\t */\n\tx: 0,\n\ty: 0,\n\n\t/**\n\t * \tRatio for the viewport's center (value from -1 to 1), used when focusing to use a different focus point instead of the exact center.\n\t */\n\tcenterRatioX: 0,\n\tcenterRatioY: 0,\n\n\t/**\n\t * \tPosition offset, used to move the viewport around without affecting the focus point.\n\t */\n\toffset: null,\n\n\t/**\n\t * \tBoundaries of the container, set by `setContainerBounds`.\n\t *\n\t * \t!readonly container: Bounds2;\n\t */\n\tcontainer: null,\n\n\t/**\n\t * \tThe focus factor determines the ratio of a smaller viewport on which the current focus point must  be contained. If the focus point is not inside the\n\t * \tsmaller viewport scrolling will be performed.\n\t */\n\tfocusFactorX: 0,\n\tfocusFactorY: 0,\n\n\t/**\n\t * \tFocus target rectangle and its offsets. When the viewport is updated it will automatically focus on this rect.\n\t */\n\tfocusRect: null,\n\tfocusOffsX: 0,\n\tfocusOffsY: 0,\n\n\t/**\n\t * \tEnabled focus axes. Used by the `update` method to figure which axis to update.\n\t */\n\tfocusAxisX: true,\n\tfocusAxisY: true,\n\n\t/**\n\t * \tFlags of the viewport.\n\t */\n\tflags: 0,\n\n\t/**\n\t * \tViewport scale.\n\t */\n\tscale: 1,\n\n\t/**\n\t * \tGlobal scale, used to scale the entire canvas including the viewport. Useful for debugging viewport bounds.\n\t */\n\tglobalScale: 1,\n\n\t/**\n\t * \tBounds of the viewport in world space. Used to determine which elements lie inside the viewport.\n\t *\n\t * \t!readonly bounds: Bounds2;\n\t */\n\tbounds: null,\n\n\t/**\n\t * \tExtra padding for the viewport bounds. Used to extend the viewport bounds without altering the original viewport size nor the world bounds.\n\t */\n\tpadding: null,\n\n\t/**\n\t * \tBounds of the focus area of the viewport in world space. When the `focusRect` moves outside this area the viewport will be panned to keep it inside these bounds.\n\t * \n\t * \t!readonly focusBounds: Bounds2;\n\t */\n\tfocusBounds: null,\n\n\t/**\n\t * \tBounds of the viewport in screen space, used as target rendering area.\n\t *\n\t *\t!readonly screenBounds: Bounds2;\n\t */\n\tscreenBounds: null,\n\n\t/**\n\t * \tTemporal Point2 object used as temporary result for `toWorldSpace` and `toScreenSpace`.\n\t */\n\ttmpPoint: null,\n\n\t/**\n\t * \tConstructs the viewport with the specified size and container dimensions.\n\t *\n\t * \t@param sx - Screen position X.\n\t * \t@param sy - Screen position Y.\n\t * \t@param width - Viewport width.\n\t * \t@param height - Viewport height.\n\t * \t@param containerWidth - Container width.\n\t * \t@param containerHeight - Container height.\n\t *\n\t * \t!constructor (sx: number, sy: number, width: number, height: number, containerWidth: number, containerHeight: number);\n\t */\n\t__ctor: function (sx, sy, width, height, containerWidth, containerHeight)\n\t{\n\t\tthis.focusFactorX = 0.4;\n\t\tthis.focusFactorY = 0.4;\n\t\tthis.focusRect = null;\n\n\t\tthis.sx = sx;\n\t\tthis.sy = sy;\n\t\tthis.width = this.initialWidth = width;\n\t\tthis.height = this.initialHeight = height;\n\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\n\t\tthis.bounds = Bounds2.Pool.alloc();\n\t\tthis.padding = null;\n\n\t\tthis.focusBounds = Bounds2.Pool.alloc();\n\t\tthis.screenBounds = Bounds2.Pool.alloc();\n\t\tthis.container = Bounds2.Pool.alloc();\n\t\tthis.offset = Point2.Pool.alloc();\n\n\t\tthis.flags = Viewport.ENABLED;\n\t\tthis.tmpPoint = Point2.Pool.alloc();\n\n\t\tthis.setContainerBounds(-containerWidth>>1, -containerHeight>>1, containerWidth>>1, containerHeight>>1);\n\n\t\tthis.updateScreenBounds();\n\t\tthis.updateBounds();\n\t},\n\n\t/**\n\t * \tDestructs the viewport.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis.bounds.free();\n\t\tthis.focusBounds.free();\n\t\tthis.screenBounds.free();\n\t\tthis.container.free();\n\t\tthis.tmpPoint.free();\n\n\t\tif (this.padding !== null)\n\t\t\tthis.padding.free();\n\t},\n\n\t/**\n\t * \tReturns the value of the `enabled` flag.\n\t *\n\t * \t!enabled() : boolean;\n\t */\n\t/**\n\t * \tSets the `enabled` flag.\n\t *\n\t * \t!enabled (value: boolean) : Viewport;\n\t */\n\tenabled: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Viewport.ENABLED);\n\n\t\tthis.flags &= ~Viewport.ENABLED;\n\t\tif (value) this.flags |= Viewport.ENABLED;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the value of the `topLeft` flag.\n\t * \t!topLeft() : boolean;\n\t */\n\t/**\n\t * \tSets the `topLeft` flag.\n\t * \t!topLeft (value: boolean) : Viewport;\n\t */\n\ttopLeft: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Viewport.TOP_LEFT);\n\n\t\tthis.flags &= ~Viewport.TOP_LEFT;\n\t\tif (value) this.flags |= Viewport.TOP_LEFT;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the container bounds. Used to ensure the viewport bounds are never outside these limits.\n\t *\n\t * \t!setContainerBounds (x1: number, y1: number, x2: number, y2: number) : Viewport;\n\t */\n\t/**\n\t * \tSets the container bounds. Used to ensure the viewport bounds are never outside these limits.\n\t *\n\t * \t!setContainerBounds (v: Bounds2|Rect) : Viewport;\n\t */\n\tsetContainerBounds: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\ty2 = x1.y2;\n\t\t\tx2 = x1.x2;\n\t\t\ty1 = x1.y1;\n\t\t\tx1 = x1.x1;\n\t\t}\n\n\t\tthis.width = this.initialWidth;\n\t\tthis.height = this.initialHeight;\n\n\t\tif (this.width > x2-x1) this.width = x2-x1;\n\t\tif (this.height > y2-y1) this.height = y2-y1;\n\n\t\tthis.container.set(x1, y1, x2, y2);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the viewport padding.\n\t *\n\t * \t!setPadding (value: number) : Viewport;\n\t */\n\t/**\n\t * \tSets the padding of each side of the viewport (left, top, right and bottom).\n\t *\n\t * \t!setPadding (x1: number, y1: number, x2: number, y2: number) : Viewport;\n\t */\n\tsetPadding: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (this.padding === null)\n\t\t\tthis.padding = Bounds2.Pool.alloc();\n\n\t\tif (y1 === null)\n\t\t{\n\t\t\tx2 = y2 = x1;\n\t\t\tx1 = y1 = -x1;\n\t\t}\n\n\t\tthis.padding.set(x1, y1, x2, y2);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tUpdates the bound rect of the viewport.\n\t */\n\tupdateBounds: function (truncateToContainer=false)\n\t{\n\t\tlet w, h, ws, hs;\n\t\tlet x1, y1, x2, y2;\n\n\t\tw = this.width >> 1;\n\t\th = this.height >> 1;\n\n\t\tws = (w/this.scale);\n\t\ths = (h/this.scale);\n\n\t\tx1 = this.x-ws+this.offset.x;\n\t\ty1 = this.y-hs+this.offset.y;\n\t\tx2 = this.x+ws+this.offset.x;\n\t\ty2 = this.y+hs+this.offset.y;\n\n\t\tif (truncateToContainer)\n\t\t{\n\t\t\tif (x1 < this.container.x1)\n\t\t\t\tthis.offset.setX(this.container.x1 - this.x + ws);\n\t\t\telse if (x2 > this.container.x2)\n\t\t\t\tthis.offset.setX(this.container.x2 - this.x - ws);\n\n\t\t\tif (y1 < this.container.y1)\n\t\t\t\tthis.offset.setY(this.container.y1 - this.y + hs);\n\t\t\telse if (y2 > this.container.y2)\n\t\t\t\tthis.offset.setY(this.container.y2 - this.y - hs);\n\n\t\t\tx1 = this.x-ws+this.offset.x;\n\t\t\ty1 = this.y-hs+this.offset.y;\n\t\t\tx2 = this.x+ws+this.offset.x;\n\t\t\ty2 = this.y+hs+this.offset.y;\n\t\t}\n\n\t\tthis.bounds.set (x1, y1, x2, y2);\n\n\t\tif (this.padding !== null)\n\t\t\tthis.bounds.add (this.padding);\n\n\t\tthis.focusBounds.set (\n\t\t\tthis.x - (this.focusFactorX*w + this.centerRatioX*w)/this.scale, this.y - (this.focusFactorY*h + this.centerRatioY*h)/this.scale,\n\t\t\tthis.x + (this.focusFactorX*w + this.centerRatioX*w)/this.scale, this.y + (this.focusFactorY*h + this.centerRatioY*h)/this.scale\n\t\t);\n\t},\n\n\t/**\n\t * \tUpdates the screen bound rect of the viewport.\n\t */\n\tupdateScreenBounds: function ()\n\t{\n\t\tthis.screenBounds.set (this.sx, this.sy, this.sx + this.width, this.sy + this.height);\n\t},\n\n\t/**\n\t * \tResizes the viewport to the specified size.\n\t *\n\t * \t!resize (width: number|null, height: number|null) : Viewport;\n\t */\n\tresize: function (width, height)\n\t{\n\t\tthis.width = this.initialWidth = width ?? this.width;\n\t\tthis.height = this.initialHeight = height ?? this.height;\n\n\t\tthis.updateScreenBounds();\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResizes the viewport by the specified deltas.\n\t *\n\t * \t!resizeBy (dWidth: number, dHeight: number) : Viewport;\n\t */\n\tresizeBy: function (dWidth, dHeight)\n\t{\n\t\tthis.width += dWidth;\n\t\tthis.height += dHeight;\n\n\t\tthis.initialWidth = this.width;\n\t\tthis.initialHeight = this.height;\n\n\t\tthis.updateScreenBounds();\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the position of the viewport's center within the world and resets the relative offset to zero.\n\t * Setting any parameter to `null` will cause it not to be changed.\n\t * \n\t * !setPosition (x: number|null, y: number|null) : Viewport;\n\t */\n\tsetPosition: function (x, y)\n\t{\n\t\tthis.x = x ?? this.x;\n\t\tthis.y = y ?? this.y;\n\n\t\tthis.offset.set(0, 0);\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the position of the viewport relative to the current focus point.\n\t * \n\t * \t!setOffsets (dx: number, dy: number) : Viewport;\n\t */\n\tsetOffsets: function (dx, dy)\n\t{\n\t\tthis.offset.set(dx, dy);\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the scale of the viewport.\n\t * \n\t * \t!setScale (value: number) : Viewport;\n\t */\n\tsetScale: function (value)\n\t{\n\t\tthis.scale = value;\n\t\tthis.updateBounds();\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the scale of the viewport.\n\t * \n\t * \t!getScale () : number;\n\t */\n\tgetScale: function ()\n\t{\n\t\treturn this.scale;\n\t},\n\n\t/**\n\t * \tSets the global scale of the viewport.\n\t * \n\t * \t!setGlobalScale (value: number) : Viewport;\n\t */\n\tsetGlobalScale: function (value)\n\t{\n\t\tthis.globalScale = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the global scale of the viewport.\n\t * \n\t * \t!getGlobalScale () : number;\n\t */\n\tgetGlobalScale: function ()\n\t{\n\t\treturn this.globalScale;\n\t},\n\n\t/**\n\t * \tSets the center ratio of the viewport (values from -1 to 1, default is 0). Used to focus on a different point instead of the exact center.\n\t * \n\t * \t!setCenter (rx: number, ry: number) : Viewport;\n\t */\n\tsetCenter: function (rx, ry)\n\t{\n\t\tthis.centerRatioX = rx;\n\t\tthis.centerRatioY = ry;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMoves the viewport within the world. Values are relative to the current focus point.\n\t *\t@param truncateToContainer - When `true` the final viewport bounds will be ensured to not lie outside the container bounds.\n\t *\n\t * \t!translate (dx: number, dy: number, truncateToContainer?: boolean) : Viewport;\n\t */\n\ttranslate: function (dx, dy, truncateToContainer=false)\n\t{\n\t\tthis.offset.add(dx, dy);\n\n\t\tthis.updateBounds(truncateToContainer);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the screen position of the viewport.\n\t * \n\t * \t!setScreenPosition (sx: number, sy: number) : number;\n\t */\n\tsetScreenPosition: function (sx, sy)\n\t{\n\t\tthis.sx = sx;\n\t\tthis.sy = sy;\n\n\t\tthis.updateScreenBounds();\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the X coordinate of the viewport's focus point inside the world.\n\t * \t@param absolute - When `true`, the focus point X (without offset) will be returned.\n\t * \t\n\t * \t!getX (absolute?: boolean) : number;\n\t */\n\tgetX: function (absolute=false)\n\t{\n\t\treturn this.x + (absolute ? 0 : this.offset.x);\n\t},\n\n\t/**\n\t * \tReturns the Y coordinate of the viewport's focus point inside the world.\n\t * \t@param absolute - When `true`, the focus point Y (without offset) will be returned.\n\t * \t\n\t * \t!getY (absolute?: boolean) : number;\n\t */\n\tgetY: function (absolute=false)\n\t{\n\t\treturn this.y + (absolute ? 0 : this.offset.y);\n\t},\n\n\t/**\n\t * \tReturns the X position of the viewport inside the world relative to the current focus point.\n\t * \n\t * \t!getOffsetX() : void;\n\t */\n\tgetOffsetX: function ()\n\t{\n\t\treturn this.offset.x;\n\t},\n\n\t/**\n\t * \tReturns the Y position of the viewport inside the world relative to the current focus point.\n\t * \n\t * \t!getOffsetY() : void;\n\t */\n\tgetOffsetY: function ()\n\t{\n\t\treturn this.offset.y;\n\t},\n\n\t/**\n\t * \tReturns the width of the viewport.\n\t * \n\t * \t!getWidth() : number;\n\t */\n\tgetWidth: function ()\n\t{\n\t\treturn this.width;\n\t},\n\n\t/**\n\t * \tReturns the height of the viewport.\n\t * \n\t * \t!getHeight() : number;\n\t */\n\tgetHeight: function ()\n\t{\n\t\treturn this.height;\n\t},\n\n\t/**\n\t * \tMoves the viewport X coordinate to focus on the specified line or coordinate. Method `updateBounds` should be called afterwards.\n\t * \n\t * \t!focusX (x0: number, x1?: number, factor?: number) : Viewport;\n\t */\n\tfocusX: function (i0, i1=null, kx=null)\n\t{\n\t\tif (kx === null) kx = this.focusFactorX;\n\t\tif (i1 === null) i1 = i0;\n\n\t\tlet w = this.width >> 1;\n\n\t\tlet x1 = this.x - int((kx*w + this.centerRatioX*w)/this.scale);\n\t\tlet x2 = this.x + int((kx*w + this.centerRatioX*w)/this.scale);\n\n\t\tif (x1 == x2)\n\t\t\ti0 = i1 = (i0 + i1) >> 1;\n\n\t\tlet nx = this.x;\n\n\t\tif (i0 < x1) nx += (i0 - x1);\n\t\telse if (i1 > x2) nx += (i1 - x2);\n\n\t\tx1 = nx - w;\n\t\tx2 = nx + w;\n\n\t\tif (x1 < this.container.x1) nx = this.container.x1 + w;\n\t\tif (x2 > this.container.x2) nx = this.container.x2 - w;\n\n\t\tthis.x = nx;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMoves the viewport Y coordinate to focus on the specified line or coordinate. Method `updateBounds` should be called afterwards.\n\t * \n\t * \t!focusY (y0: number, y1?: number, factor?: number) : Viewport;\n\t */\n\tfocusY: function (j0, j1=null, ky=null)\n\t{\n\t\tif (ky === null) ky = this.focusFactorY;\n\t\tif (j1 === null) j1 = j0;\n\n\t\tlet h = this.height >> 1;\n\n\t\tlet y1 = this.y - int((ky*h + this.centerRatioY*h)/this.scale);\n\t\tlet y2 = this.y + int((ky*h + this.centerRatioY*h)/this.scale);\n\n\t\tif (y1 == y2)\n\t\t\tj0 = j1 = (j0 + j1) >> 1;\n\n\t\tlet ny = this.y;\n\n\t\tif (j0 < y1) ny += (j0 - y1);\n\t\telse if (j1 > y2) ny += (j1 - y2);\n\n\t\ty1 = ny - h;\n\t\ty2 = ny + h;\n\n\t\tif (y1 < this.container.y1) ny = this.container.y1 + h;\n\t\tif (y2 > this.container.y2) ny = this.container.y2 - h;\n\n\t\tthis.y = ny;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tUpdates the viewport to focus on the focusRect. Takes into account enabled axes.\n\t *\n\t * \t!update (dt?: number) : void;\n\t */\n\tupdate: function (dt=0)\n\t{\n\t\tif (this.focusRect === null)\n\t\t\treturn;\n\n\t\tif (this.focusAxisX)\n\t\t\tthis.focusX (this.focusRect.x1 + this.focusOffsX, this.focusRect.x2 + this.focusOffsX);\n\n\t\tif (this.focusAxisY)\n\t\t\tthis.focusY (this.focusRect.y1 + this.focusOffsY, this.focusRect.y2 + this.focusOffsY);\n\n\t\tthis.updateBounds();\n\t},\n\n\t/**\n\t * \tUpdates the viewport to focus on the focusRect ignoring the enabled axes.\n\t *\n\t * \t!updateForced (dt?: number) : void;\n\t */\n\tupdateForced: function (dt=0)\n\t{\n\t\tif (this.focusRect === null)\n\t\t\treturn;\n\n\t\tthis.focusX (this.focusRect.x1 + this.focusOffsX, this.focusRect.x2 + this.focusOffsX);\n\t\tthis.focusY (this.focusRect.y1 + this.focusOffsY, this.focusRect.y2 + this.focusOffsY);\n\n\t\tthis.updateBounds();\n\t},\n\n\t/**\n\t * \tTracks a specified rectangle by maintaining focus on it (a call to `update` must be made on every frame update).\n\t * \n\t * \t!setFocusRect (rect: Rect|Bounds2, offsX?: number, offsY? :number) : Viewport;\n\t */\n\tsetFocusRect: function (rect, offsX=0, offsY=0)\n\t{\n\t\tthis.focusRect = rect;\n\n\t\tthis.focusOffsX = offsX;\n\t\tthis.focusOffsY = offsY;\n\n\t\tthis.update(0);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the focus offsets of the viewport. Used to translate the viewport without altering the focus point.\n\t *\n\t * \t!setFocusOffsets (offsX: number, offsY: number) : Viewport;\n\t */\n\tsetFocusOffsets: function (offsX, offsY)\n\t{\n\t\tthis.focusOffsX = offsX;\n\t\tthis.focusOffsY = offsY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the enabled flag of the focus axes. Only enabled axes will be updated when calling `update`.\n\t * \n\t * \t!setFocusAxes (enabledX: boolean, enabledY: boolean) : Viewport;\n\t */\n\tsetFocusAxes: function (enabledX, enabledY)\n\t{\n\t\tthis.focusAxisX = enabledX;\n\t\tthis.focusAxisY = enabledY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the focus factor of the viewport (value from 0 to 1), that is, the ratio of the smaller focus viewport.\n\t * \n\t * \t!setFocusFactor (valueX: number, valueY: number) : Viewport;\n\t */\n\tsetFocusFactor: function (valueX, valueY)\n\t{\n\t\tthis.focusFactorX = valueX;\n\t\tthis.focusFactorY = valueY === undefined ? valueX : valueY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tApplies the viewport clipping area to the specified canvas.\n\t * \n\t * \t!applyClip (g: Canvas) : void;\n\t */\n\tapplyClip: function (g)\n\t{\n\t\tg.clip(this.screenBounds.x1, this.screenBounds.y1, this.screenBounds.width(), this.screenBounds.height());\n\t},\n\n\t/**\n\t * \tApplies the viewport transform to the specified canvas.\n\t * \n\t * \t!applyTransform (g: Canvas) : void;\n\t */\n\tapplyTransform: function (g)\n\t{\n\t\tif (!(this.flags & Viewport.TOP_LEFT))\n\t\t\tg.translate (this.screenBounds.cx, this.screenBounds.cy);\n\t\telse\n\t\t\tg.translate (this.screenBounds.x1, this.screenBounds.y1);\n\n\t\tif (this.scale != 1.0)\n\t\t\tg.scale (this.scale, this.scale);\n\n\t\tif (this.globalScale != 1.0)\n\t\t\tg.scale (this.globalScale, this.globalScale);\n\n\t\tif (!(this.flags & Viewport.TOP_LEFT))\n\t\t\tg.translate (-this.bounds.cx, -this.bounds.cy);\n\t\telse\n\t\t\tg.translate (-this.bounds.x1, -this.bounds.y1);\n\n\t\tg.updateTransform();\n\t},\n\n\t/**\n\t * \tConverts a point from screen-space to world-space.\n\t * \t@returns Temporal Point2 object.\n\t *\n\t * \t!toWorldSpace (input: Point2|Vec2|{x:number,y:number}, floor?: boolean) : Point2;\n\t */\n\t/**\n\t * \tConverts a point from screen-space to world-space.\n\t * \t@returns Temporal Point2 object.\n\t *\n\t * \t!toWorldSpace (x: number, y: number, floor?: boolean) : Point2;\n\t */\n\ttoWorldSpace: function (x, y=null, floor=false)\n\t{\n\t\tif (y === null || y === true)\n\t\t{\n\t\t\tfloor = y === true;\n\t\t\ty = x.y;\n\t\t\tx = x.x;\n\t\t}\n\n\t\tlet refX, refY;\n\n\t\tif (!(this.flags & Viewport.TOP_LEFT))\n\t\t{\n\t\t\trefX = this.screenBounds.cx;\n\t\t\trefY = this.screenBounds.cy;\n\n\t\t\tif (floor) {\n\t\t\t\tx = ((x - int(refX)) / this.scale) + int(this.bounds.cx);\n\t\t\t\ty = ((y - int(refY)) / this.scale) + int(this.bounds.cy);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tx = ((x - refX) / this.scale) + this.bounds.cx;\n\t\t\t\ty = ((y - refY) / this.scale) + this.bounds.cy;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\trefX = this.screenBounds.x1;\n\t\t\trefY = this.screenBounds.y1;\n\n\t\t\tif (floor) {\n\t\t\t\tx = ((x - int(refX)) / this.scale) + int(this.bounds.x1);\n\t\t\t\ty = ((y - int(refY)) / this.scale) + int(this.bounds.y1);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tx = ((x - refX) / this.scale) + this.bounds.x1;\n\t\t\t\ty = ((y - refY) / this.scale) + this.bounds.y1;\n\t\t\t}\n\t\t}\n\n\t\treturn this.tmpPoint.set(x, y);\n\t},\n\n\t/**\n\t * \tConverts a point from world-space to screen-space.\n\t * \t@returns Temporal Point2 object.\n\t *\n\t * \t!toScreenSpace (input: Point2|Vec2|{x:number,y:number}, floor?: boolean) : Point2;\n\t */\n\t/**\n\t * \tConverts a point from world-space to screen-space.\n\t * \t@returns Temporal Point2 object.\n\t *\n\t * \t!toScreenSpace (x: number, y: number, floor?: boolean) : Point2;\n\t */\n\ttoScreenSpace: function (x, y=null, floor=false)\n\t{\n\t\tif (y === null || y === true)\n\t\t{\n\t\t\tfloor = y === true;\n\t\t\ty = x.y;\n\t\t\tx = x.x;\n\t\t}\n\n\t\tlet refX, refY;\n\n\t\tif (!(this.flags & Viewport.TOP_LEFT))\n\t\t{\n\t\t\trefX = this.screenBounds.cx;\n\t\t\trefY = this.screenBounds.cy;\n\n\t\t\tif (floor) {\n\t\t\t\tx = (x - int(this.bounds.cx)) * this.scale + int(refX);\n\t\t\t\ty = (y - int(this.bounds.cy)) * this.scale + int(refY);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tx = (x - this.bounds.cx) * this.scale + refX;\n\t\t\t\ty = (y - this.bounds.cy) * this.scale + refY;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\trefX = this.screenBounds.x1;\n\t\t\trefY = this.screenBounds.y1;\n\n\t\t\tif (floor) {\n\t\t\t\tx = (x - int(this.bounds.x1)) * this.scale + int(refX);\n\t\t\t\ty = (y - int(this.bounds.y1)) * this.scale + int(refY);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tx = (x - this.bounds.x1) * this.scale + refX;\n\t\t\t\ty = (y - this.bounds.y1) * this.scale + refY;\n\t\t\t}\n\t\t}\n\n\t\treturn this.tmpPoint.set(x, y);\n\t}\n});\n\n/*\n**\tConstants.\n*/\nViewport.ENABLED = 0x001;\nViewport.TOP_LEFT = 0x002;\n\nexport default Viewport;\n","\nimport GridElement from './grid-element.js';\nimport G from '../system/globals.js';\nimport Recycler from '../utils/recycler.js';\nimport System from '../system/system.js';\nimport Canvas from '../system/canvas.js';\nimport ShaderProgram from '../system/shader-program.js';\n\n//![import \"./grid-element\"]\n//![import \"../system/globals\"]\n//![import \"../utils/recycler\"]\n//![import \"../system/system\"]\n//![import \"../system/canvas\"]\n//![import \"../system/shader-program\"]\n\n//:/**\n//: * Describes an element that can be rendered to the screen.\n//: */\n\n//!class Element extends GridElement\n\nconst Element = GridElement.extend\n({\n\tclassName: 'Element',\n\n\t/**\n\t * Parent group to whom this element is related.\n\t * !group: Group;\n\t */\n\tgroup: null,\n\n\t/**\n\t * Drawable object to render to the display.\n\t * !img: Drawable;\n\t */\n\timg: null,\n\n\t/**\n\t * Indicates if the bounds of the element should be drawn (for debugging purposes). You can set it to a boolean or to a number from 1 to 7 to\n\t * draw the bounds with a different predefined color.\n\t * !debugBounds: boolean|number;\n\t */\n\tdebugBounds: false,\n\n\t/**\n\t * Basic depth (z-value) of the element (used for depth micro-adjustments).\n\t */\n\t_zvalue: 0,\n\n\t/**\n\t * Actual depth (z-value) of the element, calculated by the container.\n\t */\n\t__zvalue: 0,\n\n\t/**\n\t * Alpha value of the element.\n\t */\n\t_alpha: 1.0,\n\n\t/**\n\t * Element shader program.\n\t */\n\t_shaderProgram: null,\n\n\t/**\n\t * Function used to set the uniforms of the shader.\n\t */\n\t_uniformSetter: null,\n\n\t/**\n\t * Function used to render the element. Called by `draw` after rendering configuration has been set.\n\t * @type {(g:Canvas, elem:Element, img:Drawable) => void}\n\t */\n\trender: null,\n\n\t/**\n\t * Constructs a drawable element at the specified position with the given drawable.\n\t * !constructor (x: number, y: number, width: number, height: number, img?: Drawable);\n\t */\n\t/**\n\t * Constructs a drawable element at the specified position with the given drawable.\n\t * !constructor (x: number, y: number, img?: Drawable);\n\t */\n\t__ctor: function(x, y, width=null, height=null, img=null)\n\t{\n\t\tif (width === null)\n\t\t\twidth = height = 0;\n\n\t\tif (height === null)\n\t\t{\n\t\t\timg = width;\n\t\t\twidth = img.width;\n\t\t\theight = img.height;\n\t\t}\n\n\t\tthis._super.GridElement.__ctor(x, y, width, height);\n\t\tthis.img = img !== null ? img.getDrawable() : img;\n\n\t\tthis.group = null;\n\t\tthis.debugBounds = false;\n\n\t\tthis._zvalue = 0;\n\t\tthis.__zvalue = 0;\n\t\tthis._alpha = 1.0;\n\n\t\tthis._shaderProgram = null;\n\t\tthis._uniformSetter = null;\n\n\t\tthis.render = null;\n\t},\n\n\t/**\n\t * Destroys the element.\n\t */\n\t__dtor: function()\n\t{\n\t\tif (this.img !== null)\n\t\t{\n\t\t\tdispose(this.img);\n\t\t\tthis.img = null;\n\t\t}\n\n\t\tthis._super.GridElement.__dtor();\n\t},\n\n\t/**\n\t * Destroys the element later by adding it to the scene's destruction queue. If the element has no container, it will be destroyed immediately.\n\t * !destroyLater() : void;\n\t */\n\tdestroyLater: function()\n\t{\n\t\tif (this.alive() === false) return;\n\n\t\tif (this.container !== null)\n\t\t\tthis.container.scene.disposeLater(this);\n\t\telse\n\t\t\tdispose(this);\n\t},\n\n\t/**\n\t * Returns the `debugBounds` of the element.\n\t * @returns {number}\n\t * !debug () : number;\n\t */\n\t/**\n\t * Sets the `debugBounds` of the element.\n\t * @param {boolean|number} value\n\t * @returns {Element}\n\t * !debug (value: number) : Element;\n\t */\n\tdebug: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this.debugBounds;\n\n\t\tthis.debugBounds = value === 0 ? true : value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the `root` of the element, that is, the top-most element in the hierarchy.\n\t * !root () : Element;\n\t */\n\troot: function ()\n\t{\n\t\tlet root = this;\n\n\t\twhile (root.group !== null)\n\t\t\troot = root.group;\n\n\t\treturn root;\n\t},\n\n\t/**\n\t * Returns the alpha value of the element.\n\t * @returns {number}\n\t * !alpha () : number;\n\t */\n\t/**\n\t * Sets the alpha value of the element.\n\t * @param {number} value\n\t * @returns {Element}\n\t * !alpha (value: number) : Element;\n\t */\n\talpha: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._alpha;\n\n\t\tthis._alpha = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the zvalue of the element.\n\t * @returns {number}\n\t * !zvalue () : number;\n\t */\n\t/**\n\t * Sets the zvalue of the element.\n\t * @param {number} value\n\t * @returns {Element}\n\t * !zvalue (value: number) : Element;\n\t */\n\tzvalue: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._zvalue;\n\n\t\tthis._zvalue = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the shader program of the element.\n\t * @returns {ShaderProgram}\n\t * !shaderProgram () : ShaderProgram;\n\t */\n\t/**\n\t * Sets the shader program of the element.\n\t * @param {ShaderProgram} shaderProgram\n\t * @returns {Element}\n\t * !shaderProgram (shaderProgram: ShaderProgram|string) : Element;\n\t */\n\tshaderProgram: function (shaderProgram=false)\n\t{\n\t\tif (shaderProgram === false)\n\t\t\treturn this._shaderProgram;\n\n\t\tif (typeof(shaderProgram) === 'string')\n\t\t\tshaderProgram = ShaderProgram.get(shaderProgram);\n\n\t\tthis._shaderProgram = shaderProgram;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the uniform setter function.\n\t * @param { (pgm:ShaderProgram, elem:Element, gl:WebGLRenderingContext) => void } uniformSetter\n\t * @returns {Element}\n\t * !uniformSetter (uniformSetter: (pgm:ShaderProgram, elem:Element, gl:WebGLRenderingContext) => void) : Element;\n\t */\n\tuniformSetter: function (uniformSetter)\n\t{\n\t\tthis._uniformSetter = uniformSetter;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Draws the element on the specified canvas.\n\t * @param {Canvas} g\n\t */\n\tdraw: function(g)\n\t{\n\t\tif (this._alpha <= 0.0)\n\t\t\treturn;\n\n\t\t// TODO: Figure if there's a way to reduce the number of conditions here.\n\t\tif (this.img !== null || this.render !== null)\n\t\t{\n\t\t\tif (this._alpha !== 1.0)\n\t\t\t{\n\t\t\t\tg.pushAlpha();\n\t\t\t\tg.alpha(this._alpha);\n\t\t\t}\n\n\t\t\tlet shaderChanged = this._shaderProgram !== null ? g.pushShaderProgram(this._shaderProgram) : false;\n\t\t\tlet depthFlagChanged = this.depthFlagEnabled() ? g.pushDepthFlag(this.depthFlag()) : false;\n\n\t\t\tif (this._shaderProgram !== null && this._uniformSetter !== null && g.gl !== null)\n\t\t\t\tthis._uniformSetter (g.getShaderProgram(), this, g.gl);\n\n\t\t\tg.zvalue = this.__zvalue;\n\n\t\t\tif (this.render !== null)\n\t\t\t\tthis.render(g, this, this.img);\n\t\t\telse\n\t\t\t\tthis.img.render(g, this);\n\n\t\t\tif (depthFlagChanged === true) g.popDepthFlag();\n\t\t\tif (shaderChanged === true) g.popShaderProgram();\n\n\t\t\tif (this._alpha !== 1.0)\n\t\t\t\tg.popAlpha();\n\t\t}\n\n\t\t// TODO: See if this code can be removed or improved because it takes quite a bit to check the condition.\n\t\t/* *********** */\n\t\tif (G.debugBounds === true || (this.debugBounds === true || this.debugBounds > 0))\n\t\t{\n\t\t\tlet m = g.getMatrix();\n\t\t\tg = System.displayBuffer2;\n\t\n\t\t\tg.pushMatrix();\n\t\t\tg.loadMatrix(m);\n\t\t\tg.fillStyle(Element.getDebugColor(this.debugBounds));\n\t\t\tg.fillRect(this.bounds.x1, this.bounds.y1, this.bounds.width(), this.bounds.height());\n\t\t\tg.popMatrix();\n\t\t}\n\t},\n\n\t/**\n\t * Changes the function used to render the element.\n\t * @param { (g:Canvas, elem:Element, img:Drawable) => void } renderFunction\n\t * @returns {Element}\n\t */\n\trenderWith: function (renderFunction)\n\t{\n\t\tthis.render = renderFunction ?? null;\n\t\treturn this;\n\t}\n});\n\n/**\n * Colors for the bounds debugging.\n * !static debugColors : Array<string>;\n */\nElement.debugColors = [\n\t'rgba(0,255,255,0.35)', // Cyan\n\t'rgba(255,255,0,0.35)', // Yellow\n\t'rgba(255,0,255,0.35)', // Magenta\n\t'rgba(255,255,255,0.35)', // White\n\t'rgba(255,0,0,0.35)', // Red\n\t'rgba(0,255,0,0.35)', // Green\n\t'rgba(0,0,255,0.35)', // Blue\n\t'rgba(128,128,128,0.35)' // Gray\n];\n\n/**\n * Returns an RGBA color for the given `debugBounds` value.\n * !static getDebugColor (debugBounds: boolean|number) : string;\n */\nElement.getDebugColor = function (debugBounds)\n{\n\tif (debugBounds === true || debugBounds === false)\n\t\tdebugBounds = 0;\n\n\treturn Element.debugColors[(~~debugBounds) & 7];\n};\n\n//!/class\n\n//!namespace Element\n//!namespace Pool\n\n\t/**\n\t * Allocates a drawable element at the specified position with the given drawable.\n\t * !function alloc (x: number, y: number, width: number, height: number, img?: Drawable) : Element;\n\t */\n\t/**\n\t * Allocates a drawable element at the specified position with the given drawable.\n\t * !function alloc (x: number, y: number, img?: Drawable) : Element;\n\t */\n\nRecycler.createPool(Element);\nexport default Element;\n","\nimport Element from './element.js';\nimport List from '../utils/list.js';\nimport Point2 from '../math/point2.js';\nimport Recycler from '../utils/recycler.js';\nimport GridElement from './grid-element.js';\n\n//![import \"./element\"]\n//![import \"../utils/list\"]\n//![import \"../math/point2\"]\n//![import \"../utils/recycler\"]\n\nconst tempPoint = Point2.Pool.alloc();\n\n//:/**\n//: * Groups one or more elements into a single one.\n//: */\n\n//!class Group extends Element\n\nconst Group = Element.extend\n({\n\tclassName: 'Group',\n\n\t/**\n\t * List of elements in the group.\n\t * !readonly children: List;\n\t */\n\tchildren: null,\n\n\t/**\n\t * Virtual zero reference point.\n\t * !readonly ref: Point2;\n\t */\n\tref: null,\n\n\t/**\n\t * Constructs an empty Group element.\n\t * !constructor (id?: string);\n\t */\n\t__ctor: function (id=null)\n\t{\n\t\tthis._super.Element.__ctor(0, 0, 0, 0);\n\n\t\tthis.children = List.Pool.alloc();\n\t\tthis.bounds.reset();\n\n\t\tthis.ref = Point2.Pool.alloc();\n\t\tthis.setId(id);\n\t},\n\n\t/**\n\t * Destroys the group and all children.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis.children.free();\n\t\tthis.ref.free();\n\n\t\tthis._super.Element.__dtor();\n\t},\n\n\t/**\n\t * Adds the group itself and all children to the scene's destruction queue. If any element has no container, it will be destroyed immediately.\n\t * !destroyLater() : void;\n\t */\n\tdestroyLater: function()\n\t{\n\t\tif (this.alive() === false) return;\n\n\t\tlet i;\n\n\t\twhile ((i = this.children.shift()) != null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.group = null;\n\t\t\ti.destroyLater();\n\t\t}\n\n\t\tthis._super.Element.destroyLater();\n\t},\n\n\t/**\n\t * Removes and destroys all child elements.\n\t * !clear() : Group;\n\t */\n\tclear: function()\n\t{\n\t\tlet i;\n\n\t\twhile ((i = this.children.shift()) != null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.group = null;\n\t\t\tdispose(i);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Removes all child elements but does not destroy them.\n\t * !reset() : Group;\n\t */\n\treset: function()\n\t{\n\t\tlet i;\n\n\t\twhile ((i = this.children.shift()) != null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.group = null;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the wrapExtents flag of the group.\n\t * @returns {boolean}\n\t * !wrapExtents () : boolean;\n\t */\n\t/**\n\t * Sets the wrapExtents flag of the group.\n\t * @param {boolean} value\n\t * @returns {Group}\n\t * !wrapExtents (value: boolean) : Group;\n\t */\n\twrapExtents: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.WRAP_EXTENTS);\n\n\t\tthis.flags &= ~GridElement.WRAP_EXTENTS;\n\t\tif (value === true) this.flags |= GridElement.WRAP_EXTENTS;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Adds a child element to the group. If the element has its `id` property set, it will be added to the group as a\n\t * property, which can be accessed directly using the element identifier or using the `getChild` method.\n\t * !addChild (elem: Element) : Element;\n\t */\n\taddChild: function (elem, relative=false)\n\t{\n\t\tif (elem === null) return null;\n\n\t\tlet initial = this.bounds.x1 === null;\n\n\t\tif (initial === true || (this.flags & GridElement.WRAP_EXTENTS) !== 0)\n\t\t{\n\t\t\tif (initial === true || elem.bounds.x1 < this.bounds.x1) this.ltranslate(elem.bounds.x1 - this.bounds.x1, 0);\n\t\t\tif (initial === true || elem.bounds.y1 < this.bounds.y1) this.ltranslate(0, elem.bounds.y1 - this.bounds.y1);\n\t\t\tif (initial === true || elem.bounds.x2 > this.bounds.x2) this.resizeBy(elem.bounds.x2 - this.bounds.x2, 0);\n\t\t\tif (initial === true || elem.bounds.y2 > this.bounds.y2) this.resizeBy(0, elem.bounds.y2 - this.bounds.y2);\n\t\t}\n\n\t\tthis.children.push(elem);\n\n\t\tif (elem.id !== null)\n\t\t\tthis[elem.id] = elem;\n\n\t\tif (relative === true)\n\t\t\telem.translate(this.bounds.x1, this.bounds.y1);\n\n\t\telem.group = this;\n\t\telem.remover.add(this._remove, this, this.children.bottom);\n\n\t\treturn elem;\n\t},\n\n\t/**\n\t * Return the child element matching the specified identifier.\n\t * !child (id: string) : Element;\n\t */\n\tgetChild: function (id)\n\t{\n\t\treturn this[id] || null;\n\t},\n\n\t/**\n\t * Callback to remove an element from the container (called by Handler).\n\t */\n\t_remove: function (elem, self, node)\n\t{\n\t\tself.children.remove(node);\n\t\telem.group = null;\n\n\t\tif (elem.id !== null)\n\t\t\tself[elem.id] = null;\n\n\t\treturn false;\n\t},\n\n\t/**\n\t * Removes an element from the container and returns it.\n\t * !removeChild (elem: Element) : Element;\n\t */\n\tremoveChild: function (elem)\n\t{\n\t\tif (elem === null || elem.group !== this)\n\t\t\treturn elem;\n\n\t\telem.remover.execf(this._remove, this);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * Syncs the actual location of the specified element with its storage location. Returns `true` if successful.\n\t */\n\tsync: function()\n\t{\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.sync();\n\n\t\treturn this._super.Element.sync();\n\t},\n\n\t/**\n\t * Local group translation, moves only the group by the specified deltas. Child elements remain in position.\n\t * @param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * !ltranslate (dx: number, dy: number, upscaled?: boolean) : Group;\n\t */\n\tltranslate: function (dx, dy, upscaled=false)\n\t{\n\t\treturn this._super.Element.translate(dx, dy, upscaled);\n\t},\n\n\t/**\n\t * Moves the group and all children by the specified deltas.\n\t * @param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * !translate (dx: number, dy: number, upscaled?: boolean) : Group;\n\t */\n\ttranslate: function (dx, dy, upscaled=false)\n\t{\n\t\tlet _dx = this.bounds.x1;\n\t\tlet _dy = this.bounds.y1;\n\n\t\tthis._super.Element.translate(dx, dy, upscaled);\n\t\tthis.ref.add(dx, dy, upscaled);\n\n\t\t_dx = this.bounds.x1 - _dx;\n\t\t_dy = this.bounds.y1 - _dy;\n\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.translate(_dx, _dy);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns a temporal Point2, describing the extra offset introduced by the group when translating a child element by the specified deltas.\n\t * @param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * !getOffsets (dx: number, dy: number, upscaled?: boolean) : Point2;\n\t */\n\tgetOffsets: function (dx, dy, upscaled=false)\n\t{\n\t\ttempPoint.set(this.bounds.ux1, this.bounds.uy1, true);\n\n\t\tlet _dx = tempPoint.x;\n\t\tlet _dy = tempPoint.y;\n\n\t\ttempPoint.add(dx, dy, upscaled);\n\n\t\t_dx = tempPoint.x - _dx;\n\t\t_dy = tempPoint.y - _dy;\n\n\t\ttempPoint.set(_dx, _dy);\n\n\t\ttempPoint.x -= dx;\n\t\ttempPoint.y -= dy;\n\n\t\treturn tempPoint;\n\t},\n\n\t/**\n\t * Sets bits of the element flags in the group and all children.\n\t * !setFlags (value: number) : Group;\n\t */\n\tsetFlags: function (value)\n\t{\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.setFlags(value);\n\n\t\treturn this._super.Element.setFlags(value);\n\t},\n\n\t/**\n\t * Clears bits from the group and all children flags.\n\t * !clearFlags (value: number) : Group;\n\t */\n\tclearFlags: function (value)\n\t{\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.clearFlags(value);\n\n\t\treturn this._super.Element.clearFlags(value);\n\t},\n\n\t/**\n\t * Sets the visible flag of the group and all children.\n\t * @param {boolean} value - New visibility value.\n\t * @param {boolean} forced - When `true` forces to ignore the VISIBLE_LOCK flag.\n\t * !visible (value: boolean, forced?: boolean|false) : GridElement;\n\t */\n\t/**\n\t * Returns the visible flag.\n\t * !visible() : boolean;\n\t */\n\tvisible: function (value=null, forced=false)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._super.Element.visible();\n\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.visible(value, forced);\n\n\t\treturn this._super.Element.visible(value, forced);\n\t},\n\n\t/**\n\t * Returns the alpha value of the group.\n\t * @returns {number}\n\t * !alpha () : number;\n\t */\n\t/**\n\t * Sets the alpha value of the group and all children.\n\t * @param {number} value\n\t * @returns {Element}\n\t * !alpha (value: number) : Element;\n\t */\n\talpha: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._super.Element.alpha();\n\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.alpha(value);\n\n\t\treturn this._super.Element.alpha(value);\n\t}\n});\n\n//!/class\n\n//!namespace Group\n//!namespace Pool\n\n\t/**\n\t * Allocates an empty Group element.\n\t * !function alloc (id?: string) : Group;\n\t */\n\nRecycler.createPool(Group);\nexport default Group;\n","\nimport { Class } from 'rinn';\nimport List from '../utils/list.js';\nimport Element from './element.js';\n\n//![import \"../utils/list\"]\n//![import \"./element\"]\n\n//:/**\n//: * \tAn updater is used to update one or more elements and synchronize their position with their container.\n//: */\n\n//!class Updater\n\nconst Updater = Class.extend\n({\n\tclassName: 'Updater',\n\n\t/**\n\t * \tScene where the updater is attached.\n\t * \t!readonly scene: Scene;\n\t */\n\tscene: null,\n\n\t/**\n\t * \tList of elements.\n\t */\n\tlist: null,\n\n\t/**\n\t * \tCallback passed when constructing the updater.\n\t */\n\t__update: null,\n\t__context: null,\n\n\t/**\n\t * \tPre-update and post-update callbacks. Set using the `preupdate` and `postupdate` methods.\n\t */\n\t__preupdate: null,\n\t__postupdate: null,\n\n\t/**\n\t * \tConstructs the updater linked to the specified scene.\n\t * \t!constructor (scene: Scene, update: (elem: Element, dt: number, context: object) => boolean, context?: object);\n\t */\n\t__ctor: function (scene, update=null, context=null)\n\t{\n\t\tthis.list = List.Pool.alloc();\n\t\tthis.scene = scene;\n\n\t\tthis.__update = update;\n\t\tthis.__context = context;\n\n\t\tthis.__preupdate = null;\n\t\tthis.__postupdate = null;\n\n\t\tthis.scene.updater.add(this._update, this);\n\t\tthis.scene.synchronizer.add(this._sync, this);\n\t\tthis.scene.destroyer.add(this._destroy, this);\n\t},\n\n\t/**\n\t * \tDestroys the instance. All elements will just be removed.\n\t */\n\t__dtor: function()\n\t{\n\t\tlet i;\n\n\t\tthis.scene.updater.remove(this._update, this);\n\t\tthis.scene.synchronizer.remove(this._sync, this);\n\t\tthis.scene.destroyer.remove(this._destroy, this);\n\n\t\twhile ((i = this.list.shift()) !== null) {\n\t\t\ti.remover.remove(this._remove, this);\n\t\t}\n\n\t\tthis.list.free();\n\t},\n\n\t/**\n\t * \tDestroyer callback.\n\t */\n\t_destroy: function (scene, self)\n\t{\n\t\tdispose(self);\n\t},\n\n\n\t/**\n\t * \tResets the updater by removing all elements.\n\t * \t!reset () : Updater;\n\t */\n\treset: function ()\n\t{\n\t\twhile ((i = this.list.shift()) !== null) {\n\t\t\ti.remover.remove(this._remove, this);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tClears the updater by destroying all elements.\n\t * \t!clear () : Updater;\n\t */\n\tclear: function ()\n\t{\n\t\twhile ((i = this.list.shift()) !== null) {\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\tdispose(i);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the pre-update callback.\n\t * \t!preupdate (callback: (list: List, dt: number, updater: Updater) => Updater) : Updater;\n\t */\n\tpreUpdate: function (callback)\n\t{\n\t\tthis.__preupdate = callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the post-update callback.\n\t * \t!postupdate (callback: (list: List, dt: number, updater: Updater) => Updater) : Updater;\n\t */\n\tpostUpdate: function (callback)\n\t{\n\t\tthis.__postupdate = callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tAdds an element to the updater.\n\t * \t!add (elem: Element) : Element;\n\t */\n\tadd: function (elem)\n\t{\n\t\tif (!Element.isInstance(elem))\n\t\t\tthrow new Error ('argument must be of type: Element');\n\n\t\tthis.list.push(elem);\n\n\t\telem.remover.add(this._remove, this, this.list.bottom);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tCallback to remove an element from the updater (called by Handler).\n\t */\n\t_remove: function (elem, self, node)\n\t{\n\t\tself.list.remove(node);\n\t\treturn false;\n\t},\n\n\t/**\n\t * \tRemoves an element from the updater.\n\t * \t!remove (elem: Element) : Element;\n\t */\n\tremove: function (elem)\n\t{\n\t\telem.remover.execf(this._remove, this);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tCallback for the synchronizer.\n\t */\n\t_sync: function (scene, self)\n\t{\n\t\tfor (let i = self.list.top; i; i = i.next)\n\t\t\ti.value.sync();\n\t},\n\n\t/**\n\t * \tCallback for the updater.\n\t */\n\t_update: function (scene, self)\n\t{\n\t\tself.update(scene.dt);\n\t},\n\n\t/**\n\t * \tRuns an update cycle.\n\t * \t!update (dt: number) : void;\n\t */\n\tupdate: function (dt)\n\t{\n\t\tif (this.__preupdate !== null)\n\t\t\tthis.__preupdate (this.list, dt, this.__context);\n\n\t\tif (this.__update !== null)\n\t\t{\n\t\t\tlet next = null;\n\t\t\tfor (let i = this.list.top; i; i = next)\n\t\t\t{\n\t\t\t\tnext = i.next;\n\n\t\t\t\tif (this.__update (i.value, dt, this.__context) === false)\n\t\t\t\t\tthis.remove(i.value);\n\t\t\t}\n\t\t}\n\n\t\tif (this.__postupdate !== null)\n\t\t\tthis.__postupdate (this.list, dt, this.__context);\n\t}\n});\n\nexport default Updater;\n","\nimport Container from './container.js';\nimport GridElement from './grid-element.js';\nimport Element from './element.js';\nimport List from '../utils/list.js';\n\n//![import \"./container\"]\n//![import \"./grid-element\"]\n//![import \"./element\"]\n//![import \"../utils/list\"]\n\n//:/**\n//: * \tA simple container is a container that uses a linked-list to storage the elements.\n//: */\n\n//!class SimpleContainer extends Container\n\nexport default Container.extend\n({\n\tclassName: 'SimpleContainer',\n\n\t/**\n\t * List containing the elements.\n\t * !readonly list: List;\n\t */\n\tlist: null,\n\n\t/**\n\t * Constructs the simple container with the specified size.\n\t * !constructor (width: number, height: number);\n\t */\n\t/**\n\t * Constructs the simple container.\n\t * !constructor ();\n\t */\n\t__ctor: function (width=0, height=0)\n\t{\n\t\tthis._super.Container.__ctor (width, height);\n\t\tthis.list = List.Pool.alloc();\n\n\t\tthis.depthFlag(false);\n\t},\n\n\t/**\n\t * Destroys the container and all contained elements.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis.list.free();\n\n\t\tthis._super.Container.__dtor();\n\t},\n\n\t/**\n\t * Syncs the actual location of the specified element with its storage location. Returns true if successful.\n\t * !override sync (elem: Element) : boolean;\n\t */\n\tsync: function (elem)\n\t{\n\t\tthis.syncZ(elem);\n\t\treturn true;\n\t},\n\n\t/**\n\t * Clears the container to empty. All contained elements will be destroyed.\n\t * !override clear() : void;\n\t */\n\tclear: function()\n\t{\n\t\tlet i;\n\n\t\twhile ((i = this.list.shift()) !== null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.container = null;\n\t\t\tdispose(i);\n\t\t}\n\n\t\tthis.elementCount = 0;\n\t},\n\n\t/**\n\t * Resets the container to empty. Contained elements are not destroyed. Use `clear` if that is your intention.\n\t * !override reset() : void;\n\t */\n\treset: function()\n\t{\n\t\tlet i;\n\n\t\twhile ((i = this.list.shift()) !== null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.container = null;\n\t\t}\n\n\t\tthis.elementCount = 0;\n\t},\n\n\t/**\n\t * Adds an element to the container.\n\t * !override add (elem: Element) : Element;\n\t */\n\tadd: function (elem)\n\t{\n\t\tif (!Element.isInstance(elem))\n\t\t\tthrow new Error ('argument must be an Element');\n\n\t\tthis.list.push(elem);\n\t\tthis.elementCount++;\n\n\t\telem.container = this;\n\t\telem.remover.add(this._remove, this, this.list.bottom);\n\n\t\tthis.syncZ(elem);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * Callback to remove an element from the container (called by Handler).\n\t */\n\t_remove: function (elem, self, node)\n\t{\n\t\tself.list.remove(node);\n\t\tself.elementCount--;\n\n\t\telem.container = null;\n\t\treturn false;\n\t},\n\n\t/**\n\t * Removes an element from the container and returns it.\n\t * !override remove (elem: Element) : Element;\n\t */\n\tremove: function (elem)\n\t{\n\t\telem.remover.execf(this._remove, this);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * Actually draws the contained elements. Does not take the active viewport into account (hence simple container).\n\t * !override render() : void;\n\t */\n\trender: function()\n\t{\n\t\tlet flags = GridElement.ALIVE | GridElement.VISIBLE;\n\n\t\tfor (let i = this.list.top; i; i = i.next)\n\t\t{\n\t\t\tif (i.value.getFlags(flags) === false)\n\t\t\t\tcontinue;\n\n\t\t\tif (this.drawElement(i.value, this) === false)\n\t\t\t\tbreak;\n\t\t}\n\t}\n});\n","\nimport Container from './container.js';\nimport Grid from './grid.js';\nimport GridElement from './grid-element.js';\nimport Element from './element.js';\nimport globals from '../system/globals.js';\nimport System from '../system/system.js';\n\n//![import \"./container\"]\n//![import \"./grid\"]\n//![import \"./grid-element\"]\n//![import \"./element\"]\n//![import \"../system/globals\"]\n//![import \"../system/system\"]\n\n//:/**\n//: * \tA grid container is a container that uses an optimized spatial grid structure to store the elements.\n//: */\n\n//!class GridContainer extends Container\n\nexport default Container.extend\n({\n\tclassName: 'GridContainer',\n\n\t/**\n\t * \tGrid containing the elements.\n\t * \t!readonly grid: Grid;\n\t */\n\tgrid: null,\n\n\t/**\n\t * \tIndicates if the container bound should be drawn.\n\t * \t!debugBounds: boolean;\n\t */\n\tdebugBounds: false,\n\n\t/**\n\t * \tConstructs the grid container with the default size (32768x32768) and divisor (64).\n\t * \t!constructor ();\n\t */\n\t/**\n\t * \tConstructs the grid container with the specified size and divisor.\n\t * \t!constructor (width: number, height: number, divisorX: number, divisorY?: number);\n\t */\n\t__ctor: function (width=32768, height=32768, divisorX=64, divisorY=null)\n\t{\n\t\tthis._super.Container.__ctor (width, height);\n\t\tthis.grid = new Grid (width, height, divisorX, divisorY);\n\t},\n\n\t/**\n\t * \tDestroys the container and all contained elements.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis._super.Container.__dtor();\n\t},\n\n\t/**\n\t * \tSyncs the actual location of the specified element with its storage location. Returns true if successful.\n\t * \t!override sync (elem: Element) : boolean;\n\t */\n\tsync: function (elem)\n\t{\n\t\tthis.syncZ(elem);\n\t\treturn this.grid.sync(elem);\n\t},\n\n\t/**\n\t * \tClears the container to empty. All contained elements will be destroyed.\n\t * \t!override clear() : void;\n\t */\n\tclear: function()\n\t{\n\t\tthis.grid.clear();\n\t},\n\n\t/**\n\t * \tResets the container to empty. Contained elements are not destroyed. Use `clear` if that is your intention.\n\t * \t!override reset() : void;\n\t */\n\treset: function()\n\t{\n\t\tthis.grid.reset();\n\t},\n\n\t/**\n\t * \tAdds an element to the container. Returns boolean indicating if successful.\n\t * \t!override add (elem: Element) : Element;\n\t */\n\tadd: function (elem)\n\t{\n\t\tif (!Element.isInstance(elem))\n\t\t\tthrow new Error ('argument must be an Element');\n\n\t\tif (!this.grid.add(elem))\n\t\t\treturn null;\n\n\t\telem.container = this;\n\t\tthis.elementCount = this.grid.count;\n\n\t\tthis.syncZ(elem);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tRemoves an element from the container and returns it.\n\t * \t!override remove (elem: Element) : Element;\n\t */\n\tremove: function (elem)\n\t{\n\t\tthis.grid.remove(elem);\n\t\tthis.elementCount = this.grid.count;\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tActually draws the contained elements.\n\t * \t!override render() : void;\n\t */\n\trender: function()\n\t{\n\t\tthis.grid.forEachInRegion(this.viewportBounds, GridElement.ALIVE | GridElement.VISIBLE, GridElement.ALIVE | GridElement.VISIBLE, this.drawElement, this);\n\n\t\tif (this.debugBounds === false || this.viewportBounds === null)\n\t\t\treturn;\n\n\t\tlet g = System.displayBuffer2;\n\n\t\tg.pushMatrix();\n\t\tg.loadMatrix(this.g.getMatrix());\n\n\t\tlet y0 = ((this.viewportBounds.y1+this.grid.offsy - (1<<this.grid.ky-1)) >> this.grid.ky) * this.grid.stride;\n\t\tlet y1 = ((this.viewportBounds.y2+this.grid.offsy) + (1<<this.grid.ky-1) >> this.grid.ky) * this.grid.stride;\n\t\tlet x0 = ((this.viewportBounds.x1+this.grid.offsx - (1<<this.grid.kx-1)) >> this.grid.kx);\n\t\tlet x1 = ((this.viewportBounds.x2+this.grid.offsx) + (1<<this.grid.kx-1) >> this.grid.kx);\n\n\t\ty0 = (int(y0 / this.grid.stride) << this.grid.ky) - this.grid.offsy;\n\t\ty1 = (int(y1 / this.grid.stride) << this.grid.ky) - this.grid.offsy + (1 << this.grid.ky);\n\t\tx0 = (x0 << this.grid.kx) - this.grid.offsx;\n\t\tx1 = (x1 << this.grid.kx) - this.grid.offsx + (1 << this.grid.kx);\n\n\t\tg.fillStyle('rgba(255,0,0,0.2)');\n\t\tg.fillRect(x0, y0, x1-x0+1, y1-y0+1);\n\n\t\ty0 = this.viewportBounds.y1;\n\t\ty1 = this.viewportBounds.y2;\n\t\tx0 = this.viewportBounds.x1;\n\t\tx1 = this.viewportBounds.x2;\n\n\t\tg.lineWidth(1/System.canvasScaleFactor);\n\t\tg.strokeStyle('#fff');\n\t\tg.strokeRect(x0, y0, x1-x0+1, y1-y0+1);\n\n\t\tg.lineWidth(1/System.canvasScaleFactor);\n\t\tg.strokeStyle('#008');\n\t\tfor (let y = globals.viewport.container.y1+this.grid.offsy; y < globals.viewport.container.y2+this.grid.offsy; y += (1 << this.grid.ky))\n\t\tfor (let x = globals.viewport.container.x1+this.grid.offsx; x < globals.viewport.container.x2+this.grid.offsx; x += (1 << this.grid.kx))\n\t\t{\n\t\t\tg.strokeRect(x-this.grid.offsx, y-this.grid.offsy, (1 << this.grid.kx), (1 << this.grid.ky));\n\t\t}\n\n\t\tg.popMatrix();\n\t},\n\n\t/**\n\t * \tExecutes the specified callback for each element that intersects the given bounds and has the specified flags set. The process is\n\t * \timmediately stopped if the callback returns `false`.\n\t * \t!forEachInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number, callback: (elem: Element, context?: object) => boolean, context?: object) : void;\n\t */\n\tforEachInRegion: function (bounds, flagsAndMask, flagsValue, callback, context)\n\t{\n\t\tthis.grid.forEachInRegion (bounds, flagsAndMask, flagsValue, callback, context);\n\t},\n\n\t/**\n\t * \tCollects all elements that intersect the given bounds and have the specified flags set. Returns a new List, remember to call `free` after using it.\n\t * \t!selectInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : List;\n\t */\n\tselectInRegion: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\treturn this.grid.selectInRegion (bounds, flagsAndMask, flagsValue);\n\t},\n\n\t/**\n\t * \tCounts all elements that intersect the given bounds and have the specified flags set.\n\t * \t!countInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : number;\n\t */\n\tcountInRegion: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\treturn this.grid.countInRegion (bounds, flagsAndMask, flagsValue);\n\t},\n\n\t/**\n\t * \tReturns the first element that intersect the given bounds and have the specified flags set.\n\t * \t!selectFirst (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : Element;\n\t */\n\tselectFirst: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\treturn this.grid.selectFirst (bounds, flagsAndMask, flagsValue);\n\t}\n});\n","\nimport Element from './element.js';\nimport System from '../system/system.js';\nimport Recycler from '../utils/recycler.js';\nimport globals from '../system/globals.js';\n\n//![import \"./element\"]\n//![import \"../system/system\"]\n//![import \"../utils/recycler\"]\n\n//:/**\n//: * \tDescribes an element mask. Used for collision detection.\n//: */\n\n//!class Mask extends Element\n\nconst Mask = Element.extend\n({\n\tclassName: 'Mask',\n\n\t/**\n\t * \tType of the mask (user defined).\n\t * \t!type: number;\n\t */\n\ttype: 0,\n\n\t/**\n\t * \tConstructs the Mask element.\n\t * \t!constructor (type: number, x: number, y: number, width: number, height: number);\n\t */\n\t__ctor: function(type, x, y, width, height)\n\t{\n\t\tthis._super.Element.__ctor(x, y, width, height);\n\n\t\tthis.type = type;\n\t},\n\n\t/**\n\t * \tDraws the element on the specified canvas.\n\t * \t!draw (g: Canvas) : void;\n\t */\n\tdraw: function(g)\n\t{\n\t\tif (globals.debugMasks === false && (this.debugBounds === false || this.debugBounds === 0))\n\t\t\treturn;\n\n\t\tlet m = g.getMatrix();\n\t\tg = System.displayBuffer2;\n\n\t\tg.pushMatrix();\n\t\tg.loadMatrix(m);\n\t\tg.fillStyle(Element.getDebugColor(this.debugBounds));\n\t\tg.fillRect(this.bounds.x1, this.bounds.y1, this.bounds.width(), this.bounds.height());\n\t\tg.popMatrix();\n\t}\n});\n\n//!/class\n\n//!namespace Mask\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a new Mask element.\n\t * \t!function alloc (type: number, x: number, y: number, width: number, height: number) : Mask;\n\t */\n\nRecycler.createPool(Mask);\nexport default Mask;\n","\nimport Element from './element.js';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"./element\"]\n//![import \"../utils/recycler\"]\n\n//:/**\n//: * Describes an element that can be rendered to the screen.\n//: */\n\n//!class Label extends Element\n\nconst Label = Element.extend\n({\n\tclassName: 'Label',\n\n\t/**\n\t * Original label position.\n\t */\n\tsx: 0, sy: 0,\n\n\t/**\n\t * Text to render.\n\t * !readonly text: string;\n\t */\n\ttext: null,\n\n\t/**\n\t * Spritefont resource.\n\t * !readonly font: object;\n\t */\n\t//violet: type fixup\n\t//readonly font: Spritefont;\n\tfont: null,\n\n\t/**\n\t * Indicates if the `text` property changed.\n\t */\n\t_dirty: false,\n\n\t/**\n\t * Current text width.\n\t * !readonly textWidth: number;\n\t */\n\ttextWidth: null,\n\n\t/**\n\t * Current text height.\n\t * !readonly textHeight: number;\n\t */\n\ttextHeight: null,\n\n\t/**\n\t * Alignment properties of the label.\n\t */\n\t_align: -1, /* -1=LEFT, 0=CENTER, 1=RIGHT */\n\t_valign: -1, /* -1=TOP, 0=MIDDLE, 1=BOTTOM */\n\n\t/**\t\n\t * Position offset for the text. Calculated based on alignment properties.\n\t */\n\ttextOffsetX: null,\n\ttextOffsetY: null,\n\n\t/**\n\t * Constructs a label element at the specified position with the given text.\n\t * !constructor (x: number, y: number, font: object, text: string);\n\t */\n\t__ctor: function(x, y, font, text)\n\t{\n\t\tthis._super.Element.__ctor(this.sx = x, this.sy = y, 1, 1);\n\n\t\tthis.text = null;\n\t\tthis.font = font;\n\n\t\tthis._align = -1;\n\t\tthis._valign = -1;\n\n\t\tthis.renderWith(this.renderText);\n\t\tthis.setText(text);\n\t},\n\n\t/**\n\t * Sets the horizontal alignment value of the label.\n\t * @param value - Use -1 for LEFT, 0 for CENTER, and 1 for RIGHT.\n\t * !align (value: number) : Label;\n\t */\n\talign: function (value)\n\t{\n\t\tif (this._align === value)\n\t\t\treturn this;\n\n\t\tthis._align = value;\n\t\tthis.textOffsetX = null;\n\t\treturn this.update();\n\t},\n\n\t/**\n\t * Sets the vertical alignment value of the label.\n\t * @param value - Use -1 for TOP, 0 for MIDDLE, and 1 for BOTTOM.\n\t * !valign (value: number) : Label;\n\t */\n\tvalign: function(value)\n\t{\n\t\tif (this._valign === value)\n\t\t\treturn this;\n\n\t\tthis._valign = value;\n\t\tthis.textOffsetY = null;\n\t\treturn this.update();\n\t},\n\n\t/**\n\t * Sets the text value of the label.\n\t * !setText (value: string) : Label;\n\t */\n\tsetText: function (value)\n\t{\n\t\tif (this.text === value)\n\t\t\treturn this;\n\n\t\tthis.text = value;\n\t\tthis._dirty = true;\n\t\treturn this.update();\n\t},\n\n\t/**\n\t * Sets the font resource to use.\n\t * !setFont (font: object) : Label;\n\t */\n\t//violet: type fixup\n\t//setFont (font: Spritefont) : Label;\n\tsetFont: function (font)\n\t{\n\t\tif (this.font === font)\n\t\t\treturn this;\n\n\t\tthis.font = font;\n\t\tthis._dirty = true;\n\t\treturn this.update();\n\t},\n\n\t/**\n\t * Updates the text related properties (textWidth, textHeight, textOffsetX and textOffsetY). Automatically\n\t * called before the label is drawn. Recalculates offsets only if text changed since last call.\n\t */\n\tupdate: function()\n\t{\n\t\tif (this._dirty === true)\n\t\t{\n\t\t\tthis.textOffsetX = null;\n\t\t\tthis.textOffsetY = null;\n\n\t\t\tthis.textWidth = this.font.measureWidth(this.text);\n\t\t\tthis.textHeight = this.font.measureHeight(this.text);\n\n\t\t\tthis._dirty = false;\n\n\t\t\tthis.bounds.resize(this.textWidth, this.textHeight, true);\n\t\t}\n\n\t\tif (this.textOffsetX === null)\n\t\t{\n\t\t\tif (this._align < 0) this.textOffsetX = 0;\n\t\t\telse if (this._align === 0) this.textOffsetX = -this.textWidth >> 1;\n\t\t\telse this.textOffsetX = -this.textWidth;\n\n\t\t\tthis.bounds.translate(-this.bounds.x1 + this.sx + this.textOffsetX, 0);\n\t\t}\n\n\t\tif (this.textOffsetY === null)\n\t\t{\n\t\t\tif (this._valign < 0) this.textOffsetY = 0;\n\t\t\telse if (this._valign === 0) this.textOffsetY = -this.textHeight >> 1;\n\t\t\telse this.textOffsetY = -this.textHeight;\n\n\t\t\tthis.bounds.translate(0, -this.bounds.y1 + this.sy + this.textOffsetY);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Moves the label by the specified deltas.\n\t * @param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * !translate (dx: number, dy: number, upscaled?: boolean) : Group;\n\t */\n\ttranslate: function (dx, dy, upscaled=false)\n\t{\n\t\tthis._super.Element.translate(dx, dy, upscaled);\n\n\t\tthis.sx = this.bounds.x1;\n\t\tthis.sy = this.bounds.y1;\n\n\t\tthis.textOffsetX = null;\n\t\tthis.textOffsetY = null;\n\n\t\treturn this.update();\n\t},\n\n\t/**\n\t * Renders the element to the graphics surface.\n\t */\n\trenderText: function(g, elem, img)\n\t{\n\t\telem.font.drawText (g, elem.bounds.x1, elem.bounds.y1, elem.text);\n\t}\n});\n\n//!/class\n\n//!namespace Label\n//!namespace Pool\n\n\t/**\n\t * Allocates a label element at the specified position with the given text.\n\t * !function alloc (x: number, y: number, font: object, text: string) : Label;\n\t */\n\n\nRecycler.createPool(Label);\nexport default Label;\n","\nimport PriorityQueue from '../utils/priority-queue.js';\nimport Boot from './boot.js';\nimport System from '../system/system.js';\n\n//![import \"../utils/priority-queue\"]\n//![import \"./boot\"]\n//![import \"../system/system\"]\n\n//!namespace KeyboardHandler\n\n\t//!type Handler =\n\n\t\t/**\n\t\t * Executed when the handler is attached.\n\t\t * !init?: () => void;\n\t\t */\n\n\t\t/**\n\t\t * Keyboard event handler.\n\t\t * !onKeyboardEvent: System.KeyboardEventHandler;\n\t\t */\n\n\t//!/type\n\n//!/namespace\n\n//:/**\n//: * Used to attach keyboard event handlers to the system.\n//: */\n\n//!class KeyboardHandler\n\nexport default Boot.Module.create\n({\n\thandlers: null,\n\n\t__ctor: function ()\n\t{\n\t\tconst self = this;\n\n\t\tthis._super.Module.__ctor();\n\n\t\tthis.handlers = new PriorityQueue();\n\n\t\tthis._callOnKeyboardEvent = function (handler) {\n\t\t\treturn self.callOnKeyboardEvent(handler);\n\t\t};\n\t},\n\n\t/**\n\t * Registers a keyboard event handler.\n\t * !static register (handler: KeyboardHandler.Handler) : KeyboardHandler.Handler;\n\t */\n\tregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.add(handler);\n\n\t\t\tif ('init' in handler)\n\t\t\t\thandler.init();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"KeyboardHandler (register): \" + e.message);\n\t\t}\n\n\t\treturn handler;\n\t},\n\n\t/**\n\t * Removes a keyboard event handler.\n\t * !static unregister (handler: KeyboardHandler.Handler) : void;\n\t */\n\tunregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.remove(handler);\n\t\t\tthis.handlers.cleanup();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"KeyboardHandler (unregister): \" + e.message);\n\t\t}\n\t},\n\n\tcallOnKeyboardEvent: function (handler)\n\t{\n\t\treturn handler.onKeyboardEvent(this._action, this._keyCode, this._keyState);\n\t},\n\n\t/**\n\t * Overrides the default keyboard event handler.\n\t */\n\tonStartup: function()\n\t{\n\t\tSystem.onKeyboardEvent = (action, keyCode, keyState) =>\n\t\t{\n\t\t\tthis._action = action;\n\t\t\tthis._keyCode = keyCode;\n\t\t\tthis._keyState = keyState;\n\n\t\t\tthis.handlers.forEach(this._callOnKeyboardEvent);\n\t\t};\n\t},\n\n\t/**\n\t * Removes the default keyboard handler.\n\t */\n\tonShutdown: function()\n\t{\n\t\tSystem.onKeyboardEvent = null;\n\t}\n});\n","\nimport PriorityQueue from '../utils/priority-queue.js';\nimport Boot from './boot.js';\nimport System from '../system/system.js';\n\n//![import \"../utils/priority-queue\"]\n//![import \"./boot\"]\n//![import \"../system/system\"]\n\n//!namespace PointerHandler\n\n\t//!type Handler =\n\n\t\t/**\n\t\t * Executed when the handler is attached.\n\t\t * !init?: () => void;\n\t\t */\n\n\t\t/**\n\t\t * Pointer event handler.\n\t\t * !onPointerEvent: System.PointerEventHandler;\n\t\t */\n\n\t//!/type\n\n//!/namespace\n\n//:/**\n//: * Used to attach pointer event handlers to the system.\n//: */\n\n//!class PointerHandler\n\nexport default Boot.Module.create\n({\n\thandlers: null,\n\n\t__ctor: function ()\n\t{\n\t\tconst self = this;\n\n\t\tthis._super.Module.__ctor();\n\n\t\tthis.handlers = new PriorityQueue();\n\n\t\tthis._callOnPointerEvent = function (handler) {\n\t\t\treturn self.callOnPointerEvent(handler);\n\t\t};\n\t},\n\n\t/**\n\t * Registers a pointer event handler.\n\t * !static register (handler: PointerHandler.Handler) : PointerHandler.Handler;\n\t */\n\tregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.add(handler);\n\n\t\t\tif ('init' in handler)\n\t\t\t\thandler.init();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"PointerHandler (register): \" + e.message);\n\t\t}\n\n\t\treturn handler;\n\t},\n\n\t/**\n\t * Removes a pointer event handler.\n\t * !static unregister (handler: PointerHandler.Handler) : void;\n\t */\n\tunregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.remove(handler);\n\t\t\tthis.handlers.cleanup();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"PointerHandler (unregister): \" + e.message);\n\t\t}\n\t},\n\n\tcallOnPointerEvent: function (handler)\n\t{\n\t\treturn handler.onPointerEvent(this._action, this._p, this._pointers);\n\t},\n\n\t/**\n\t * Overrides the default pointer event handler.\n\t */\n\tonStartup: function()\n\t{\n\t\tSystem.onPointerEvent = (action, p, pointers) =>\n\t\t{\n\t\t\tthis._action = action;\n\t\t\tthis._p = p;\n\t\t\tthis._pointers = pointers;\n\n\t\t\tthis.handlers.forEach(this._callOnPointerEvent);\n\t\t};\n\t},\n\n\t/**\n\t * Removes the default pointer handler.\n\t */\n\tonShutdown: function()\n\t{\n\t\tSystem.onPointerEvent = null;\n\t}\n});\n","\nimport KeyboardHandler from './keyboard-handler.js';\nimport PointerHandler from './pointer-handler.js';\nimport System from '../system/system.js';\nimport Handler from '../utils/handler.js';\n\n//![import \"./keyboard-handler\"]\n//![import \"./pointer-handler\"]\n//![import \"../system/system\"]\n\n//!namespace ScreenControls\n\n\t//!type Handler =\n\n\t\t/**\n\t\t * Indicates if the pointer focus is locked once acquired, until the pointer is released.\n\t\t * !focusLock : boolean;\n\t\t */\n\n\t\t/**\n\t\t * Indicates if keyboard events are enabled for the object.\n\t\t * !keyboardEvents : boolean;\n\t\t */\n\n\t\t/**\n\t\t * Zindex of the object. Used only if ScreenControls has zindex-flag enabled.\n\t\t * !zindex : number;\n\t\t */\n\n\t\t/**\n\t\t * Returns `true` if the object contains the specified point (screen space).\n\t\t * !containsPoint (x: number, y: number) : boolean;\n\t\t */\n\n\t\t/**\n\t\t * Called when the PointerEventType.POINTER_DOWN event starts within the bounding box of the object.\n\t\t * !pointerActivate (pointer: System.Pointer) : void;\n\t\t */\n\n\t\t/**\n\t\t * Called when the PointerEventType.POINTER_UP event is fired when this object is already activated.\n\t\t * !pointerDeactivate (pointer: System.Pointer) : void;\n\t\t */\n\n\t\t/**\n\t\t * Executed when a pointer move/drag event happens while the object is activated.\n\t\t * !pointerUpdate (x: number, y: number, pointer: System.Pointer) : void;\n\t\t */\n\n\t\t/**\n\t\t * Executed when hover-flag is enabled and a pointer entered or left the host area.\n\t\t * !hover (status: boolean, pointer: System.Pointer) : void;\n\t\t */\n\n\t\t/**\n\t\t * Executed when `keyboardEvents` flag is enabled and a KeyboardEventType.KEY_DOWN event has happened.\n\t\t * !keyDown (keyCode: KeyCode, keyArgs: System.KeyboardState) : void;\n\t\t */\n\n\t\t/**\n\t\t * Executed when `keyboardEvents` flag is enabled and a KeyboardEventType.KEY_UP event has happened.\n\t\t * !keyUp (keyCode: KeyCode, keyArgs: System.KeyboardState) : void;\n\t\t */\n\n\t//!/type\n\n//!/namespace\n\n//!class ScreenControls\n\nconst ScreenControls =\n({\n\tpriority: 5,\n\n\t/**\n\t * Handler class.\n\t */\n\tHandler: Handler,\n\n\t/**\n\t * List of handlers.\n\t */\n\tlist: [ ],\n\n\t/**\n\t * Controls if `hover` support is enabled.\n\t */\n\thoverFlag: false,\n\n\t/**\n\t * Controls if `zindex` support is enabled.\n\t */\n\tzindexFlag: false,\n\n\t/**\n\t * Last frame number when the list was sorted (when zindex is enabled).\n\t */\n\tlastFrame: 0,\n\n\t/**\n\t * Adds the specified handler to the screen controls list.\n\t * !static add (handler: ScreenControls.Handler) : void;\n\t */\n\tadd: function (handler)\n\t{\n\t\tif (this.list.indexOf(handler) === -1)\n\t\t\tthis.list.push(handler);\n\t},\n\n\t/**\n\t * Removes the specified handler from the screen controls list.\n\t * !static remove (handler: ScreenControls.Handler) : void;\n\t */\n\tremove: function (handler)\n\t{\n\t\tlet i = this.list.indexOf(handler);\n\t\tif (i !== -1) this.list.splice(i, 1);\n\t},\n\n\t/**\n\t * Returns the hover-enable flag.\n\t * !static hover() : boolean;\n\t */\n\t/**\n\t * Sets the hover-enable flag.\n\t * !static hover (value: boolean) : void;\n\t */\n\thover: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this.hoverFlag;\n\n\t\tthis.hoverFlag = value;\n\t},\n\n\t/**\n\t * Returns the zindex-enable flag.\n\t * !static zindex() : boolean;\n\t */\n\t/**\n\t * Sets the zindex-enable flag.\n\t * !static zindex (value: boolean) : void;\n\t */\n\tzindex: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this.zindexFlag;\n\n\t\tthis.zindexFlag = value;\n\t},\n\n\tfindTarget: function (x, y, filter=null)\n\t{\n\t\t// Once per frame the list is re-sorted (if required) when the zindex flag is enabled.\n\t\tif (this.zindexFlag && this.lastFrame != System.frameNumber)\n\t\t{\n\t\t\tlet zindex = this.list[0].zindex;\n\n\t\t\tfor (let item of this.list)\n\t\t\t{\n\t\t\t\tif (item.zindex > zindex)\n\t\t\t\t{\n\t\t\t\t\tthis.list = this.list.sort((a,b) => b.zindex - a.zindex);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tzindex = item.zindex;\n\t\t\t}\n\n\t\t\tthis.lastFrame = System.frameNumber;\n\t\t}\n\n\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t{\n\t\t\tif (!this.list[i]) continue;\n\n\t\t\tif (filter !== null && filter(this.list[i]) === false)\n\t\t\t\tcontinue;\n\n\t\t\tif (this.list[i].containsPoint(x, y))\n\t\t\t\treturn this.list[i];\n\t\t}\n\n\t\treturn null;\n\t},\n\n\t/**\n\t * Returns `true` if the specified object has the `hover` method.\n\t * @param {object} i \n\t * @returns {boolean}\n\t */\n\tfilterHover: function (i)\n\t{\n\t\treturn 'hover' in i;\n\t},\n\n\t/**\n\t * Pointer event handler.\n\t * @param {System.PointerEventType} action \n\t * @param {object} p \n\t * @param {object} pointers \n\t * @returns {boolean}\n\t */\n\tonPointerEvent: function (action, p, pointers)\n\t{\n\t\tlet _continue = true;\n\t\tlet tmp = null;\n\n\t\tswitch (action)\n\t\t{\n\t\t\tcase System.PointerEventType.POINTER_DOWN:\n\n\t\t\t\tif (p._ref != null)\n\t\t\t\t{\n\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\ttmp.pointerDeactivate(p);\n\t\t\t\t}\n\n\t\t\t\ttmp = this.findTarget(p.x, p.y);\n\t\t\t\tif (tmp != null)\n\t\t\t\t{\n\t\t\t\t\t(p._ref = tmp).pointerActivate(p);\n\t\t\t\t\t_continue = false;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_DRAG_START:\n\t\t\t\tif (p._ref != null) _continue = false;\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_DRAG_MOVE:\n\t\t\t\tif (this.hoverFlag)\n\t\t\t\t{\n\t\t\t\t\tif (p._refh != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (p._refh.containsPoint(p.x, p.y))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp = p._refh; p._refh = null;\n\t\t\t\t\t\t\ttmp.hover(false, p);\n\n\t\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, this.filterHover);\n\t\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, this.filterHover);\n\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (p._ref != null)\n\t\t\t\t{\n\t\t\t\t\tif (p._ref.containsPoint(p.x, p.y) || p._ref.focusLock == true)\n\t\t\t\t\t{\n\t\t\t\t\t\tp._ref.pointerUpdate (p.x, p.y, p);\n\t\t\t\t\t\t_continue = false;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\t\ttmp.pointerDeactivate(p);\n\n\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y);\n\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t(p._ref = tmp).pointerActivate(p);\n\t\t\t\t\t\t\t_continue = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttmp = this.findTarget(p.x, p.y);\n\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t{\n\t\t\t\t\t\t(p._ref = tmp).pointerActivate(p);\n\t\t\t\t\t\t_continue = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_MOVE:\n\t\t\t\tif (this.hoverFlag)\n\t\t\t\t{\n\t\t\t\t\tif (p._refh != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (p._refh.containsPoint(p.x, p.y))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp = p._refh; p._refh = null;\n\t\t\t\t\t\t\ttmp.hover(false, p);\n\n\t\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, this.filterHover);\n\t\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, this.filterHover);\n\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (p._ref == null) break;\n\n\t\t\t\tif (p._ref.containsPoint(p.x, p.y) || p._ref.focusLock == true)\n\t\t\t\t{\n\t\t\t\t\tp._ref.pointerUpdate (p.x, p.y, p);\n\t\t\t\t\t_continue = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\ttmp.pointerDeactivate(p);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_DRAG_STOP:\n\t\t\t\tif (p._ref != null) _continue = false;\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_UP:\n\t\t\t\tif (p._ref != null)\n\t\t\t\t{\n\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\ttmp.pointerDeactivate(p);\n\n\t\t\t\t\t_continue = false;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn _continue;\n\t},\n\n\t/**\n\t * Keyboard event handler.\n\t * @param {System.KeyboardEventType} action \n\t * @param {int} keyCode \n\t * @param {object} keyArgs \n\t * @returns {boolean}\n\t */\n\tonKeyboardEvent: function (action, keyCode, keyArgs)\n\t{\n\t\tswitch (action)\n\t\t{\n\t\t\tcase System.KeyboardEventType.KEY_DOWN:\n\n\t\t\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!this.list[i] || !this.list[i].keyboardEvents) continue;\n\n\t\t\t\t\tif (this.list[i].keyDown(keyCode, keyArgs) === false)\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.KeyboardEventType.KEY_UP:\n\n\t\t\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!this.list[i] || !this.list[i].keyboardEvents) continue;\n\n\t\t\t\t\tif (this.list[i].keyUp(keyCode, keyArgs) === false)\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn true;\n\t}\n});\n\n//!/class\n\nPointerHandler.register(ScreenControls);\nKeyboardHandler.register(ScreenControls);\n\nexport default ScreenControls;\n","\nimport Group from './group.js';\nimport Mask from './mask.js';\nimport ScreenControls from './screen-controls.js';\n\n//![import \"./group.js\"]\n//![import \"./mask.js\"]\n//![import \"./screen-controls.js\"]\n\n/**\n * \tButton class provides an easy way to add push-button support to the world.\n */\n\n//!class Button extends Group\n\nexport default Group.extend\n({\n\t/**\n\t * \tIndicates if once focus is obtained it is locked until the user releases it.\n\t * \t@default false\n\t *\t!focusLock: boolean;\n\t */\n\tfocusLock: false,\n\n\t/**\n\t * \tIndicates if keyboard events are enabled on this object.\n\t * \t@default true\n\t *\t!keyboardEvents: boolean;\n\t */\n\tkeyboardEvents: true,\n\n\t/**\n\t * \tCurrent pressed status of the button.\n\t *\t!isPressed: boolean;\n\t */\n\tisPressed: false,\n\n\t/**\n\t * \tPrevious pressed status of the button.\n\t *\t!wasPressed: boolean;\n\t */\n\twasPressed: false,\n\n\t/**\n\t * \tImage to draw when the button is unpressed.\n\t *\t!unpressedImg: Drawable;\n\t */\n\tunpressedImg: null,\n\n\t/**\n\t * \tImage to draw when the button is pressed.\n\t *\t!pressedImg: Drawable;\n\t */\n\tpressedImg: null,\n\n\t/**\n\t * \tKey code related to the button. Used only if not `null`.\n\t * \t@default null\n\t *\t!keyCode: KeyCode;\n\t */\n\tkeyCode: null,\n\n\t/**\n\t * \tHitbox element.\n\t * \t!readonly hitbox: Mask;\n\t */\n\thitbox: null,\n\n\t/**\n\t * \tHandlers for the button events.\n\t */\n\t_onButtonDown: null,\n\t_onButtonUp: null,\n\t_onTap: null,\n\t_onChange: null,\n \n\t/**\n\t * \tCreates the button with the specified parameters. Automatically adds it to the screen controls.\n\t * \t!constructor (container: Container, x: number, y: number, unpressedImg?: Drawable, pressedImg?: Drawable);\n\t */\n\t__ctor: function (container, x, y, unpressedImg=null, pressedImg=null)\n\t{\n\t\tthis._super.Group.__ctor();\n\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg ?? unpressedImg;\n\t\tthis.hitbox = null;\n\n\t\tlet hitbox = Mask.Pool.alloc (0, x, y, this.unpressedImg ? this.unpressedImg.width : 16, this.unpressedImg ? this.unpressedImg.height : 16).visible(false).visibleLock(true).debug(2);\n\t\tthis.addChild(hitbox);\n\n\t\tcontainer.add(hitbox);\n\t\tcontainer.add(this);\n\n\t\tthis.hitbox = hitbox;\n\n\t\tthis._onButtonDown = null;\n\t\tthis._onButtonUp = null;\n\t\tthis._onTap = null;\n\t\tthis._onChange = this._default_onChange;\n\n\t\tthis.reset();\n\t\tScreenControls.add(this);\n\t},\n\n\t/**\n\t * \tRemoves the button from the screen controls and destroys it.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis._super.Group.__dtor();\n\t\tScreenControls.remove(this);\n\t},\n\n\t/**\n\t * \tSets the width and height of the button and the hitbox.\n\t * \t!resize (width: number, height: number) : GridElement;\n\t */\n\tresize: function (width, height)\n\t{\n\t\tthis._super.Group.resize(width, height);\n\n\t\tif (this.hitbox !== null)\n\t\t\tthis.hitbox.resize(width, height);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResizes the button and hitbox by the specified deltas.\n\t * \t!resizeBy (deltaWidth: number, deltaHeight: number) : GridElement;\n\t */\n\tresizeBy: function (dWidth, dHeight)\n\t{\n\t\tthis._super.Group.resizeBy(dWidth, dHeight);\n\n\t\tif (this.hitbox !== null)\n\t\t\tthis.hitbox.resizeBy(dWidth, dHeight);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tChanges the pressed/unpressed images of the button.\n\t * \t!setImage (unpressedImg: Drawable, pressedImg?: Drawable) : Button;\n\t */\n\tsetImage: function (unpressedImg, pressedImg=null)\n\t{\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg || unpressedImg;\n\n\t\tthis.reset();\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tChanges the key code of the button.\n\t * \t!setKeyCode (value: KeyCode) : Button;\n\t */\n\tsetKeyCode: function (value)\n\t{\n\t\tthis.keyCode = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResets the button to its initial state.\n\t * \t!reset() : Button;\n\t */\n\treset: function ()\n\t{\n\t\tthis.img = this.unpressedImg;\n\t\tthis._onChange (this.isPressed = false, this.wasPressed = false, this);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tButton pointer update event. Not required for the button control.\n\t * \t!pointerUpdate (pointerX: number, pointerY: number, pointer: object) : void;\n\t */\n\tpointerUpdate: function (pointerX, pointerY, pointer)\n\t{\n\t},\n\n\t/**\n\t * \tSets the pressed state of the button.\n\t * \t!setStatus (value: boolean) : Button;\n\t */\n\tsetStatus: function (value)\n\t{\n\t\tif (this.isPressed === value)\n\t\t\treturn this;\n\n\t\tthis.updateStatus (value);\n\n\t\tthis.img = this.isPressed ? this.pressedImg : this.unpressedImg;\n\t\tthis._onChange (this.isPressed, this.wasPressed, this);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMoves the `isPressed` value of the button to `wasPressed`, and updates `isPressed` with the given value. If none provided, `isPressed` is unchanged.\n\t *\t!updateStatus (value?: boolean) : Button;\n\t */\n\tupdateStatus: function (value=null)\n\t{\n\t\tthis.wasPressed = this.isPressed;\n\t\tthis.isPressed = value === null ? this.isPressed : value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCalled when the PointerEventType.POINTER_DOWN event starts within the bounding box of the button.\n\t * \t!pointerActivate (pointer: object) : void;\n\t */\n\tpointerActivate: function (pointer)\n\t{\n\t\tthis.setStatus(true);\n\t},\n\n\t/**\n\t * \tCalled when the PointerEventType.POINTER_UP event is fired with the \"_ref\" attribute pointing to this object.\n\t *\t!pointerDeactivate (pointer: object) : void;\n\t */\n\tpointerDeactivate: function (pointer)\n\t{\n\t\tthis.setStatus(false);\n\t},\n\n\t/**\n\t * \tReturns `true` if the button contains the specified point.\n\t * \t!containsPoint (x: number, y: number) : boolean;\n\t */\n\tcontainsPoint: function(x, y)\n\t{\n\t\tif (!this.visible() || this.alpha() <= 0)\n\t\t\treturn false;\n\n\t\treturn this.hitbox.bounds.containsPoint(x, y);\n\t},\n\n\t/**\n\t * \tExecuted after any change in the status of the button. Be careful when overriding this, because when so, the `onTap`, `onButtonDown` and `onButtonUp` methods will not work.\n\t * \t!onChange (isPressed: boolean, wasPressed: boolean, button: Button) : void;\n\t */\n\t_default_onChange: function (isPressed, wasPressed, button)\n\t{\n\t\tif (isPressed !== wasPressed)\n\t\t{\n\t\t\tif (isPressed && this._onButtonDown)\n\t\t\t\tthis._onButtonDown();\n\t\t\telse if (!isPressed && this._onButtonUp)\n\t\t\t\tthis._onButtonUp();\n\t\t}\n\n\t\tif (!isPressed && wasPressed && this._onTap)\n\t\t\tthis._onTap();\n\t},\n\n\t/**\n\t * \tKey down event, handles the keys that control the button.\n\t * \t!keyDown (keyCode: KeyCode, keyArgs: object) : boolean|null;\n\t */\n\tkeyDown: function (keyCode, keyArgs)\n\t{\n\t\tif (keyCode === this.keyCode)\n\t\t{\n\t\t\tthis.pointerActivate();\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * \tKey up event, handles the keys that control the button.\n\t * \t!keyUp (keyCode: KeyCode, keyArgs: object) : boolean|null;\n\t */\n\tkeyUp: function (keyCode, keyArgs)\n\t{\n\t\tif (keyCode === this.keyCode)\n\t\t{\n\t\t\tthis.pointerDeactivate();\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * \tSets the handler for the on-change event. Executed when the button state changes. Setting this callback will cause onButtonDown,\n\t * \tonButtonUp and onTap to no longer work. Set the callback to `null` to return it to the default state.\n\t * \n\t * \t!onChange (callback: (isPressed: boolean, wasPressed: boolean, buttons: Button) => void) : Button;\n\t */\n\tonChange: function (callback)\n\t{\n\t\tthis._onChange = callback === null ? this._default_onChange : callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the handler for the button-down event. Executed when the button is pressed. Fired only if the `onChange` method was not overriden.\n\t * !onButtonDown (callback: () => void) : Button;\n\t */\n\t/**\n\t * Executes the onButtonDown handler.\n\t * !onButtonDown() : void;\n\t */\n\tonButtonDown: function (callback=true)\n\t{\n\t\tif (callback === true) {\n\t\t\tif (this._onButtonDown) this._onButtonDown();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._onButtonDown = callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the handler for the button-up event. Executed when the button is released. Fired only if the `onChange` method was not overriden.\n\t * \t!onButtonUp (callback: () => void) : Button;\n\t */\n\t/**\n\t * Executes the onButtonUp handler.\n\t * !onButtonUp() : void;\n\t */\n\tonButtonUp: function (callback=true)\n\t{\n\t\tif (callback === true) {\n\t\t\tif (this._onButtonUp) this._onButtonUp();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._onButtonUp = callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the handler for the on-tap event. Executed when the button is tapped (pressed and then released). Fired only if the `onChange` method was not overriden.\n\t * \t!onTap (callback: () => void) : Button;\n\t */\n\t/**\n\t * Executes the onTap handler.\n\t * !onTap() : void;\n\t */\n\tonTap: function (callback=true)\n\t{\n\t\tif (callback === true) {\n\t\t\tif (this._onTap) this._onTap();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._onTap = callback;\n\t\treturn this;\n\t}\n});\n","\nimport Group from './group.js';\nimport Mask from './mask.js';\nimport ScreenControls from './screen-controls.js';\nimport KeyCode from '../system/keycode.js';\n\n//![import \"./group\"]\n//![import \"./mask\"]\n//![import \"./screen-controls\"]\n//![import \"../system/keycode\"]\n\n/**\n * Stick class provides an easy way to add directional control sticks to the world.\n */\n\n//!class Stick extends Group\n\nexport default Group.extend\n({\n\t/**\n\t * Indicates if once focus is obtained it is locked until the user releases it.\n\t * @default true\n\t * !focusLock: boolean;\n\t */\n\tfocusLock: true,\n\n\t/**\n\t * Indicates if keyboard events are enabled on this object. Use `bindKeys` to enable.\n\t */\n\tkeyboardEvents: false,\n\n\t/**\n\t * Current pressed status of the stick.\n\t * !readonly isPressed: boolean;\n\t */\n\tisPressed: false,\n\n\t/**\n\t * Previous pressed status of the stick.\n\t * !readonly wasPressed: boolean;\n\t */\n\twasPressed: false,\n\n\t/**\n\t * Image to draw when the stick is unpressed (outer circle).\n\t * !readonly unpressedImg: Drawable;\n\t */\n\tunpressedImg: null,\n\n\t/**\n\t * Image to draw when the stick is pressed (outer circle).\n\t * !readonly pressedImg: Drawable;\n\t */\n\tpressedImg: null,\n\n\t/**\n\t * Image to draw when the stick is unpressed (inner circle).\n\t * !readonly unpressedImgInner: Drawable;\n\t */\n\tunpressedImgInner: null,\n\n\t/**\n\t * Image to draw when the stick is pressed (inner circle).\n\t * !readonly pressedImgInner: Drawable;\n\t */\n\tpressedImgInner: null,\n\n\t/**\n\t * Number of steps for the angle. Used to snap the stick movement to discrete steps.\n\t * !readonly angleSteps: number;\n\t */\n\tangleSteps: 0,\n\n\t/**\n\t * Number of steps for the radius of the stick. Used to snap the stick movement to discrete steps.\n\t * !readonly radiusSteps: number;\n\t */\n\tradiusSteps: 0,\n\n\t/**\n\t * Current center offset X.\n\t * !readonly offsX: number;\n\t */\n\toffsX: 0,\n\n\t/**\n\t * Current center offset Y.\n\t * !readonly offsY: number;\n\t */\n\toffsY: 0,\n\n\t/**\n\t * Raw direction in the X-axis.\n\t * !readonly rdirx: number;\n\t */\n\trdirx: 0,\n\n\t/**\n\t * Raw direction in the Y-axis.\n\t * !readonly rdiry: number;\n\t */\n\trdiry: 0,\n\n\t/*\n\t * Normalized direction in the X-axis.\n\t * !readonly dirx: number;\n\t */\n\tdirx: 0,\n\n\t/**\n\t * Normalized direction in the Y-axis.\n\t * !readonly diry: number;\n\t */\n\tdiry: 0,\n\n\t/**\n\t * Magnitude of the direction vector.\n\t * !readonly magnitude: number;\n\t */\n\tmagnitude: 0,\n\n\t/**\n\t * Angle of the direction vector.\n\t * !readonly angle: number;\n\t */\n\tangle: 0,\n\n\t/*\n\t** Frozen stick state. Set by calling `freezeState`.\n\t*/\n\tfrdirx: 0, frdiry: 0, fdirx: 0, fdiry: 0, fmagnitude: 0, fangle: 0,\n\n\t/**\n\t * Displacement of the inner stick. Calculated when the `update` method is called.\n\t */\n\tdispx: 0, dispy: 0,\n\n\t/**\n\t * Current radius of the inner stick (how far it moved). And maximum radius that the inner stick can move.\n\t */\n\tradius: 0, maxRadius: 0,\n\n\t/**\n\t * Dead zone values for each axis. Set using `setDeadZone`.\n\t */\n\tdeadZoneX: 0, deadZoneY: 0,\n\n\t/**\n\t * Hitbox element.\n\t */\n\thitbox: null,\n\n\t/**\n\t * Handler for the stick change event. Set using the `onChange` method.\n\t */\n\t_onChange: null,\n\n\t/**\n\t * Key codes to control the stick direction with the keyboard. Set using the `bindKeys` method.\n\t */\n\tUP: null,\n\tDOWN: null,\n\tLEFT: null,\n\tRIGHT: null,\n \n\t/**\n\t * Maximum limits for the stick dragging.\n\t */\n\tlimitX1: null, limitY1: null,\n\tlimitX2: null, limitY2: null,\n\n\t/**\n\t * Creates the stick with the specified parameters. Automatically adds it to the screen controls.\n\t * !constructor (container: Container, x: number, y: number, maxRadius: number, unpressedImg: Drawable, unpressedImgInner: Drawable, pressedImg?: Drawable, pressedImgInner?: Drawable);\n\t */\n\t__ctor: function (container, x, y, maxRadius, unpressedImg, unpressedImgInner, pressedImg=null, pressedImgInner=null)\n\t{\n\t\tthis._super.Group.__ctor();\n\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg || unpressedImg;\n\n\t\tthis.unpressedImgInner = unpressedImgInner;\n\t\tthis.pressedImgInner = pressedImgInner || unpressedImgInner;\n\n\t\tthis.maxRadius = maxRadius;\n\n\t\tthis.deadZoneX = 0.0;\n\t\tthis.deadZoneY = 0.0;\n\n\t\tthis.offsX = 0;\n\t\tthis.offsY = 0;\n\n\t\tthis.limitX1 = false;\n\t\tthis.limitY1 = false;\n\t\tthis.limitX2 = false;\n\t\tthis.limitY2 = false;\n\n\t\tthis.hitbox = Mask.Pool.alloc (0, x, y, (this.unpressedImg ?? this.unpressedImgInner).width, (this.unpressedImg ?? this.unpressedImgInner).height).visible(false).visibleLock(true).debug(2);\n\t\tthis.addChild(this.hitbox);\n\n\t\tcontainer.add(this.hitbox);\n\t\tcontainer.add(this);\n\n\t\tthis._onChange = null;\n\n\t\tthis.renderWith(this.renderStick);\n\t\tScreenControls.add(this);\n\t},\n\n\t/**\n\t * Removes the button from the screen controls and destroys it.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis._super.Group.__dtor();\n\t\tScreenControls.remove(this);\n\t},\n\n\t/**\n\t * Binds the stick to the specified keycodes and enables keyboard events.\n\t * !bindKeys (up?: number, down?: number, left?: number, right?: number) : Stick;\n\t */\n\tbindKeys: function (up=KeyCode.UP, down=KeyCode.DOWN, left=KeyCode.LEFT, right=KeyCode.RIGHT)\n\t{\n\t\tthis.UP = up;\n\t\tthis.DOWN = down;\n\t\tthis.LEFT = left;\n\t\tthis.RIGHT = right;\n\n\t\tthis.keyboardEvents = true;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the state of the keyboard events enable flag.\n\t * !keysEnabled () : Stick;\n\t */\n\t/**\n\t * Enables or disables keyboard interaction with the stick.\n\t * !keysEnabled (value: boolean) : Stick;\n\t */\n\tkeysEnabled: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this.keyboardEvents;\n\n\t\tthis.keyboardEvents = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the maximum dragging limits for the stick. Values of `false` will disable dragging in the respective axis. And `null` will cause the axis to be unlimited.\n\t * !setLimits (x1: number|boolean|null, y1: number|boolean|null, x2: number|null, y2: number|null) : Stick;\n\t */\n\tsetLimits: function (x1, y1, x2, y2)\n\t{\n\t\tthis.limitX1 = x1;\n\t\tthis.limitY1 = y1;\n\t\tthis.limitX2 = x2;\n\t\tthis.limitY2 = y2;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Changes the pressed/unpressed images of the outer stick.\n\t * !setImage (unpressedImg: Drawable, pressedImg?: Drawable) : Stick;\n\t */\n\tsetImage: function (unpressedImg, pressedImg=null)\n\t{\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg || unpressedImg;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Changes the pressed/unpressed images of the inner stick.\n\t * !setImageInner (unpressedImg: Drawable, pressedImg?: Drawable) : Stick;\n\t */\n\tsetImageInner: function (unpressedImg, pressedImg=null)\n\t{\n\t\tthis.unpressedImgInner = unpressedImg;\n\t\tthis.pressedImgInner = pressedImg || unpressedImg;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the number of angle-steps for the stick.\n\t * !setAngleSteps (n: number) : Stick;\n\t */\n\tsetAngleSteps: function (n)\n\t{\n\t\tthis.angleSteps = n;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the number of radius-steps for the stick.\n\t * !setRadiusSteps (n: number) : Stick;\n\t */\n\tsetRadiusSteps: function (n)\n\t{\n\t\tthis.radiusSteps = n;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the dead zone values (normalized).\n\t * !setDeadZone (deadZoneX: number, deadZoneY: number) : Stick;\n\t */\n\t/**\n\t * Sets the dead zone values (normalized).\n\t * !setDeadZone (deadZone: number) : Stick;\n\t */\n\tsetDeadZone: function (deadZoneX, deadZoneY=null)\n\t{\n\t\tthis.deadZoneX = deadZoneX;\n\t\tthis.deadZoneY = deadZoneY ?? deadZoneX;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Resets the button to its initial state.\n\t * !reset() : Stick;\n\t */\n\treset: function ()\n\t{\n\t\tthis.dispx = 0;\n\t\tthis.dispy = 0;\n\n\t\tthis.rdirx = 0;\n\t\tthis.rdiry = 0;\n\n\t\tthis.dirx = 0;\n\t\tthis.diry = 0;\n\t\tthis.magnitude = 0;\n\n\t\tif (this._onChange)\n\t\t\tthis._onChange (this.dirx, this.diry, this.magnitude, this.angle, this);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Renders the stick in the canvas.\n\t */\n\trenderStick: function (g, elem, img)\n\t{\n\t\tif (elem.isPressed)\n\t\t{\n\t\t\tif (elem.pressedImg)\n\t\t\t\telem.pressedImg.draw (g, elem.bounds.x1 + elem.offsX, elem.bounds.y1 + elem.offsY);\n\n\t\t\tif (elem.pressedImgInner)\n\t\t\t\telem.pressedImgInner.draw (g, elem.bounds.x1 + elem.offsX + elem.dispx, elem.bounds.y1 + elem.offsY + elem.dispy);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (elem.unpressedImg)\n\t\t\t\telem.unpressedImg.draw (g, elem.bounds.x1 + elem.offsX, elem.bounds.y1 + elem.offsY);\n\n\t\t\tif (elem.unpressedImgInner)\n\t\t\t\telem.unpressedImgInner.draw (g, elem.bounds.x1 + elem.offsX, elem.bounds.y1 + elem.offsY);\n\t\t}\n\t},\n\n\t/**\n\t * Button pointer update event. Not required for the button control.\n\t */\n\tpointerUpdate: function (pointerX, pointerY)\n\t{\n\t\tlet dx, dy;\n\n\t\tdx = pointerX - (this.bounds.cx + this.offsX);\n\t\tdy = pointerY - (this.bounds.cy + this.offsY);\n\n\t\tthis.angle = Math.atan2(-dy, dx);\n\t\tthis.radius = Math.sqrt(dx*dx + dy*dy);\n\n\t\tif (this.radius > this.maxRadius)\n\t\t{\n\t\t\tif (this.limitX1 !== false) {\n\t\t\t\tthis.offsX += Math.cos(this.angle)*(this.radius - this.maxRadius);\n\t\t\t\tif (this.limitX1 !== null && (this.bounds.cx+this.offsX) < this.limitX1) this.offsX = this.limitX1 - this.bounds.cx;\n\t\t\t\tif (this.limitX2 !== null && (this.bounds.cx+this.offsX) > this.limitX2) this.offsX = this.limitX2 - this.bounds.cx;\n\t\t\t}\n\n\t\t\tif (this.limitY1 !== false) {\n\t\t\t\tthis.offsY += -Math.sin(this.angle)*(this.radius - this.maxRadius);\n\t\t\t\tif (this.limitY1 !== null && (this.bounds.cy+this.offsY) < this.limitY1) this.offsY = this.limitY1 - this.bounds.cy;\n\t\t\t\tif (this.limitY2 !== null && (this.bounds.cy+this.offsY) > this.limitY2) this.offsY = this.limitY2 - this.bounds.cy;\n\t\t\t}\n\n\t\t\tthis.radius = this.maxRadius;\n\t\t}\n\n\t\tif (this.angleSteps)\n\t\t{\n\t\t\tlet fs = (2*Math.PI / this.angleSteps);\n\t\t\tthis.angle = int((this.angle + Math.PI + fs/2) / fs) * fs - Math.PI;\n\t\t}\n\n\t\tif (this.radiusSteps)\n\t\t{\n\t\t\tlet fs = (this.maxRadius / this.radiusSteps);\n\t\t\tthis.radius = int((this.radius + fs/2) / fs) * fs;\n\t\t}\n\n\t\tthis.rdirx = Math.min(1, Math.max(dx / this.maxRadius, -1));\n\t\tthis.rdiry = Math.min(1, Math.max(dy / this.maxRadius, -1));\n\n\t\tthis.dispx = this.radius * Math.cos(this.angle);\n\t\tthis.dispy = this.radius * -Math.sin(this.angle);\n\n\t\tif (this.radius > 0)\n\t\t{\n\t\t\tthis.dirx = this.dispx / this.radius;\n\t\t\tthis.diry = this.dispy / this.radius;\n\n\t\t\tthis.magnitude = this.radius / this.maxRadius;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.dirx = 0;\n\t\t\tthis.diry = 0;\n\n\t\t\tthis.magnitude = 0;\n\t\t}\n\n\t\tif (Math.abs(this.rdirx) < this.deadZoneX) {\n\t\t\tthis.rdirx = 0;\n\t\t\tthis.dirx = 0;\n\t\t}\n\n\t\tif (Math.abs(this.rdiry) < this.deadZoneY) {\n\t\t\tthis.rdiry = 0;\n\t\t\tthis.diry = 0;\n\t\t}\n\n\t\tif (this._onChange)\n\t\t\tthis._onChange (this.dirx, this.diry, this.magnitude, this.angle, this);\n\t},\n\n\t/**\n\t * Called when the PointerEventType.POINTER_DOWN event starts within the bounding box of the stick.\n\t */\n\tpointerActivate: function (pointer)\n\t{\n\t\tthis.wasPressed = this.isPressed;\n\t\tthis.isPressed = 1;\n\n\t\tthis.offsX = 0;\n\t\tthis.offsY = 0;\n\n\t\tthis.pointerUpdate(pointer.x, pointer.y);\n\t},\n\n\t/**\n\t * Called when the PointerEventType.POINTER_UP event is fired with the \"_ref\" attribute pointing to this object.\n\t */\n\tpointerDeactivate: function (pointer)\n\t{\n\t\tthis.wasPressed = this.isPressed;\n\t\tthis.isPressed = 0;\n\n\t\tthis.offsX = 0;\n\t\tthis.offsY = 0;\n\n\t\tthis.reset();\n\t},\n\n\t/**\n\t * Returns `true` if the stick contains the specified point.\n\t * !containsPoint (x: number, y: number) : boolean;\n\t */\n\tcontainsPoint: function(x, y)\n\t{\n\t\tif (!this.visible() || this.alpha() <= 0)\n\t\t\treturn false;\n\n\t\treturn this.hitbox.bounds.containsPoint(x, y);\n\t},\n\n\t/**\n\t * Sets the direction of the stick, the provided deltas should be normalized in the \\[-1, 1\\] range.\n\t * !setDirection (dx: number, dy: number, deadZoneX?: number, deadZoneY?: number) : boolean;\n\t */\n\tsetDirection: function (dx, dy, deadZoneX=0.10, deadZoneY=0.10)\n\t{\n\t\tif (Math.abs(dx) < deadZoneX) dx = 0;\n\t\tif (Math.abs(dy) < deadZoneY) dy = 0;\n\n\t\tthis.wasPressed = this.isPressed;\n\t\tthis.isPressed = dx == 0 && dy == 0 ? 0 : 1;\n\n\t\tthis.pointerUpdate (this.bounds.cx + dx*this.maxRadius, this.bounds.cy + dy*this.maxRadius);\n\t\treturn false;\n\t},\n\n\t/**\n\t * Saves the current state of the stick in the froxen state variables (fdirx, fdiry, etc). When the `lastValid` parameter is `true`, the values\n\t * will be saved only if the current value of each field is not zero.\n\t *\n\t * !freezeState (lastValid?: boolean) : Stick;\n\t */\n\tfreezeState: function (lastValid=false)\n\t{\n\t\tthis.frdirx = lastValid ? (this.rdirx != 0 ? this.rdirx : this.frdirx) : this.rdirx;\n\t\tthis.frdiry = lastValid ? (this.rdiry != 0 ? this.rdiry : this.frdiry) : this.rdiry;\n\t\tthis.fdirx = lastValid ? (this.dirx != 0 ? this.dirx : this.fdirx) : this.dirx;\n\t\tthis.fdiry = lastValid ? (this.diry != 0 ? this.diry : this.fdiry) : this.diry;\n\t\tthis.fmagnitude = lastValid ? (this.magnitude != 0 ? this.magnitude : this.fmagnitude) : this.magnitude;\n\t\tthis.fangle = lastValid ? (this.angle != 0 ? this.angle : this.fangle) : this.angle;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Key down event, handles the keys that control the direction of the stick.\n\t */\n\tkeyDown: function (keyCode, keyArgs)\n\t{\n\t\tlet dx = 0;\n\t\tlet dy = 0;\n\n\t\tthis.offsX = 0;\n\t\tthis.offsY = 0;\n\n\t\tif (keyArgs[this.UP] === true) dy = -this.maxRadius;\n\t\tif (keyArgs[this.LEFT] === true) dx = -this.maxRadius;\n\t\tif (keyArgs[this.DOWN] === true) dy = this.maxRadius;\n\t\tif (keyArgs[this.RIGHT] === true) dx = this.maxRadius;\n\n\t\tif (keyCode === this.UP || keyCode === this.LEFT || keyCode === this.DOWN || keyCode === this.RIGHT)\n\t\t{\n\t\t\tthis.wasPressed = this.isPressed;\n\t\t\tthis.isPressed = 1;\n\n\t\t\tif (dx != 0 && dy != 0)\n\t\t\t{\n\t\t\t\tdx *= 0.7071;\n\t\t\t\tdy *= 0.7071;\n\t\t\t}\n\n\t\t\tthis.pointerUpdate (this.bounds.cx + dx, this.bounds.cy + dy);\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * Key up event, handles the keys that control the direction of the stick.\n\t */\n\tkeyUp: function (keyCode, keyArgs)\n\t{\n\t\tlet dx = 0;\n\t\tlet dy = 0;\n\n\t\tthis.offsX = 0;\n\t\tthis.offsY = 0;\n\n\t\tif (keyArgs[this.UP] === true) dy = -this.maxRadius;\n\t\tif (keyArgs[this.LEFT] === true) dx = -this.maxRadius;\n\t\tif (keyArgs[this.DOWN] === true) dy = this.maxRadius;\n\t\tif (keyArgs[this.RIGHT] === true) dx = this.maxRadius;\n\n\t\tif (keyCode === this.UP || keyCode === this.LEFT || keyCode === this.DOWN || keyCode === this.RIGHT)\n\t\t{\n\t\t\tif (dx != 0 && dy != 0)\n\t\t\t{\n\t\t\t\tdx *= 0.7071;\n\t\t\t\tdy *= 0.7071;\n\t\t\t}\n\n\t\t\tthis.pointerUpdate (this.bounds.cx + dx, this.bounds.cy + dy);\n\n\t\t\tif (dx === 0 && dy === 0)\n\t\t\t{\n\t\t\t\tthis.wasPressed = this.isPressed;\n\t\t\t\tthis.isPressed = 0;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * Sets the handler for the on-change event. Executed after any change in the direction of the stick.\n\t * !onChange (callback: (dirx: number, diry: number, magnitude: number, angle: number, stick: Stick) => void) : Stick;\n\t */\n\tonChange: function (callback)\n\t{\n\t\tthis._onChange = callback;\n\t\treturn this;\n\t}\n});\n","\nimport System from '../system/system.js';\nimport Scene from '../flow/scene.js';\nimport Viewport from '../flow/viewport.js';\nimport Bounds2 from '../math/bounds2.js';\nimport GridContainer from '../flow/grid-container.js';\nimport Element from '../flow/element.js';\nimport Label from '../flow/label.js';\nimport Group from '../flow/group.js';\nimport Updater from '../flow/updater.js';\nimport SimpleContainer from '../flow/simple-container.js';\nimport Mask from '../flow/mask.js';\nimport system from './system.js';\nimport globals from '../system/globals.js';\n\n//!/**\n//! * \tWorld system allows to manage scenes, containers, viewports and display elements.\n//! */\n\n//!class world\n\nconst world =\n{\n\t/**\n\t * World scene constants.\n\t *\n\t * !static readonly SCENE_MAIN: number;\n\t * !static readonly SCENE_HUD: number;\n\t */\n\tSCENE_MAIN: 0,\n\tSCENE_HUD: 1,\n\n\t/**\n\t * Default layers for the SCENE_MAIN scene.\n\t *\n\t * !static readonly LAYER_BG0: number;\n\t * !static readonly LAYER_BG1: number;\n\t * !static readonly LAYER_BG2: number;\n\t * !static readonly LAYER_BG3: number;\n\t * !static readonly LAYER_BG4: number;\n\t * !static readonly LAYER_MAIN: number;\n\t * !static readonly LAYER_FG0: number;\n\t * !static readonly LAYER_FG1: number;\n\t * !static readonly LAYER_FG2: number;\n\t * !static readonly LAYER_FG3: number;\n\t * !static readonly LAYER_FG4: number;\n\t * !static readonly LAYER_MASK: number;\n\t */\n\tLAYER_BG0: 0,\n\tLAYER_BG1: 1,\n\tLAYER_BG2: 2,\n\tLAYER_BG3: 3,\n\tLAYER_BG4: 4,\n\tLAYER_MAIN: 5,\n\tLAYER_FG0: 6,\n\tLAYER_FG1: 7,\n\tLAYER_FG2: 8,\n\tLAYER_FG3: 9,\n\tLAYER_FG4: 10,\n\tLAYER_MASK: 11,\n\n\t/**\n\t * Default layers for the SCENE_HUD scene.\n\t *\n\t * !static readonly LAYER_HUD_BG0: number;\n\t * !static readonly LAYER_HUD_BG1: number;\n\t * !static readonly LAYER_HUD_BG2: number;\n\t * !static readonly LAYER_HUD_MAIN: number;\n\t * !static readonly LAYER_HUD_FG0: number;\n\t * !static readonly LAYER_HUD_FG1: number;\n\t * !static readonly LAYER_HUD_FG2: number;\n\t */\n \tLAYER_HUD_BG0: 0,\n\tLAYER_HUD_BG1: 1,\n\tLAYER_HUD_BG2: 2,\n\tLAYER_HUD_MAIN: 3,\n\tLAYER_HUD_FG0: 4,\n\tLAYER_HUD_FG1: 5,\n\tLAYER_HUD_FG2: 6,\n\n\t/**\n\t *\tRegistered scenes.\n\t */\n\t_scenes: [],\n\n\t/**\n\t * Active scene set by `selectScene`.\n\t * !static activeScene: Scene;\n\t */\n\tactiveScene: null,\n\n\t/**\n\t *\tRegistered viewports.\n\t */\n\t_viewports: [],\n\n\t/**\n\t * Active viewport set by `selectViewport`.\n\t * !static activeViewport: Viewport;\n\t */\n\tactiveViewport: null,\n\n\t/**\n\t * Active container set by `selectContainer`.\n\t * !static activeContainer: Container;\n\t */\n\tactiveContainer: null,\n\n\t/**\n\t * Currently active group (set by `createGroup`).\n\t * !static activeGroup: Group;\n\t */\n\tactiveGroup: null,\n\n\t/**\n\t * Last used group (set by `endGroup`).\n\t * !static lastGroup: Group;\n\t */\n\tlastGroup: null,\n\n\t/**\n\t * Last element created by `createElement`, or `createLabel`.\n\t * !static lastElement: Element;\n\t */\n\tlastElement: null,\n\n\t/**\n\t * Dimensions of the world.\n\t * !static readonly bounds: Bounds2;\n\t */\n\tbounds: Bounds2.Pool.alloc(),\n\n\t/**\n\t * Initializes the world with the default scenes, viewports and layers.\n\t * !static init (worldWidth?: number, worldHeight?: number, divisorX?: number, divisorY?: number) : void;\n\t */\n\tinit: function (worldWidth=32768, worldHeight=32768, divisorX=null, divisorY=null)\n\t{\n\t\tif (this._scenes.length !== 0)\n\t\t\treturn;\n\n\t\tif (divisorX === null)\n\t\t\tdivisorX = Math.max(worldWidth, worldHeight) / 512;\n\n\t\tif (divisorX < 16)\n\t\t\tdivisorX = 16;\n\n\t\tif (divisorY !== null && divisorY < 16)\n\t\t\tdivisorY = 16;\n\n\t\tthis.bounds.zero().resize(worldWidth, worldHeight);\n\n\t\tthis.createScene(world.SCENE_MAIN, 'SCENE_MAIN');\n\t\tthis.setContainer(world.LAYER_BG0, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_BG1, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_BG2, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_BG3, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_BG4, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_MAIN, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_FG0, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_FG1, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_FG2, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_FG3, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_FG4, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\n\t\tthis.setContainer(world.LAYER_MASK, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.getContainer(world.LAYER_MASK).visible(false);\n\t\tthis.createViewport(0);\n\n\t\tthis.createScene(world.SCENE_HUD, 'SCENE_HUD');\n\t\tthis.setContainer(world.LAYER_HUD_BG0, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_BG1, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_BG2, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_MAIN, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_FG0, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_FG1, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_FG2, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t},\n\n\t/**\n\t * Creates a scene at the specified index and automatically selects it.\n\t * !static createScene (index: number, name?: string) : Scene;\n\t */\n\tcreateScene: function (index, name=null)\n\t{\n\t\tif (this._scenes[index])\n\t\t{\n\t\t\tSystem.queueRemove(this._scenes[index]);\n\t\t\tglobal.dispose(this._scenes[index]);\n\t\t}\n\n\t\tthis._scenes[index] = new Scene(index, name);\n\t\tSystem.queueAdd(this._scenes[index]);\n\n\t\tthis.selectScene(index);\n\t\treturn this._scenes[index];\n\t},\n\n\t/**\n\t * Returns the scene at the specified index (or the active scene if no index provided).\n\t * !static getScene (index?: number) : Scene;\n\t */\n\tgetScene: function (index=null)\n\t{\n\t\tif (index === null)\n\t\t\treturn this.activeScene;\n\n\t\tif (index < 0 || index >= this._scenes.length)\n\t\t\treturn null;\n\n\t\treturn this._scenes[index];\n\t},\n\n\t/**\n\t * Selects the active scene for subsequence scene-level operations.\n\t * !static selectScene (index: number) : boolean;\n\t */\n\tselectScene: function (index)\n\t{\n\t\tif (index < 0 || index >= this._scenes.length || !this._scenes[index])\n\t\t\treturn false;\n\n\t\tthis.activeScene = this._scenes[index];\n\t\tthis.activeContainer = null;\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * Creates a viewport at the specified index, attaches it to the active scene and selects it. Use this only after attaching all\n\t * containers to the scene or the `maxWidth` and `maxHeight` properties of the scene will not be properly set yet.\n\t *\n\t * !static createViewport (index: number) : void;\n\t */\n\tcreateViewport: function (index)\n\t{\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('createViewport: use `selectScene` first to select the active scene.');\n\n\t\tif (this._viewports[index])\n\t\t{\n\t\t\tglobal.dispose(this._viewports[index]);\n\t\t\tthis.activeScene.setViewport(index, null);\n\t\t}\n\n\t\tthis._viewports[index] = new Viewport(\n\t\t\t0, 0,\n\t\t\tsystem.screenWidth, system.screenHeight,\n\t\t\tthis.activeScene.maxWidth, this.activeScene.maxHeight\n\t\t);\n\n\t\tthis.activeScene.setViewport(index, this._viewports[index]);\n\n\t\tthis.selectViewport(index);\n\t},\n\n\t/**\n\t * Returns a viewport given its index (or the active viewport if no index provided).\n\t * !static getViewport (index?: number) : Viewport;\n\t */\n\tgetViewport: function (index=null)\n\t{\n\t\tif (index === null)\n\t\t\treturn this.activeViewport;\n\n\t\tif (index < 0 || index >= this._viewports.length)\n\t\t\treturn null;\n\n\t\treturn this._viewports[index];\n\t},\n\n\t/**\n\t * Selects the active viewport.\n\t * !static selectViewport (index: number) : boolean;\n\t */\n\tselectViewport: function (index)\n\t{\n\t\tif (index < 0 || index >= this._viewports.length || !this._viewports[index])\n\t\t\treturn false;\n\n\t\tthis.activeViewport = this._viewports[index];\n\t\treturn true;\n\t},\n\n\t/**\n\t * Sets a container in the active scene at the specified index and returns it.\n\t * !static setContainer (index: number, container: Container) : Container;\n\t */\n\tsetContainer: function (index, container)\n\t{\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('setContainer: use `selectScene` first to select the active scene.');\n\n\t\tthis.activeScene.setContainer (index, container);\n\t\treturn container;\n\t},\n\n\t/**\n\t * Returns the container at the specified index in the active scene (or the active container if no index provided).\n\t * !static getContainer (index?: number) : Container;\n\t */\n\tgetContainer: function (index=null, throwErrors=false)\n\t{\n\t\tif (index === null)\n\t\t{\n\t\t\tif (this.activeContainer === null && throwErrors)\n\t\t\t\tthrow new Error ('getContainer: container index not specified and default container not set.');\n\n\t\t\treturn this.activeContainer;\n\t\t}\n\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('getContainer: use `selectScene` first to select the active scene.');\n\n\t\tlet container = this.activeScene.getContainer(index);\n\t\tif (container === null && throwErrors)\n\t\t\tthrow new Error ('getContainer: container index out of bounds.');\n\n\t\treturn container;\n\t},\n\n\t/**\n\t * Selects the active container.\n\t * !static selectContainer (index: number) : boolean;\n\t */\n\tselectContainer: function (index)\n\t{\n\t\tthis.activeContainer = this.getContainer(index, true);\n\t\treturn this.activeContainer !== null;\n\t},\n\n\t/**\n\t * Changes the visibility of the LAYER_MASK to enable (or disable) mask bounds rendering.\n\t * @param {boolean} value\n\t * @param {boolean} allMasks If set to `false` only masks having `debugBounds` to non-false will be drawn.\n\t * !static showMasks (value: boolean, allMasks?: boolean) : void;\n\t */\n\tshowMasks: function (value, allMasks=true)\n\t{\n\t\tworld.getScene(world.SCENE_MAIN).getContainer(world.LAYER_MASK).visible(value);\n\t\tglobals.debugMasks = allMasks;\n\t},\n\n\t/**\n\t * Creates a group in the active scene and selects it as the active group.\n\t * !static createGroup (id?: string) : Group;\n\t */\n\tcreateGroup: function(id=null)\n\t{\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('createGroup: use selectScene first to select the active scene.');\n\n\t\tthis.activeGroup = Group.Pool.alloc(id);\n\t\tthis.activeScene.addGroup(this.activeGroup);\n\n\t\treturn this.activeGroup;\n\t},\n\n\t/**\n\t * If coordinates are provided the group will be translated to the specified position. It will then set `lastGroup`, and nullify `activeGroup`.\n\t * !static endGroup (x?: number, y?: number) : Group;\n\t */\n\tendGroup: function(x=null, y=null)\n\t{\n\t\tif (x !== null && y !== null)\n\t\t\tthis.activeGroup.translate(x, y);\n\n\t\tthis.lastGroup = this.activeGroup;\n\t\tthis.activeGroup = null;\n\n\t\treturn this.lastGroup.sync();\n\t},\n\n\t/**\n\t * Creates a named Element and adds it to the specified container (or the active one) in the active scene.\n\t * If a group is active, the element will be attached to the group.\n\t * \n\t * !static createElement (id: string, x: number, y: number, img?: Drawable, containerIndex?: number) : Element;\n\t */\n\t/**\n\t * Creates an Element and adds it to the specified container (or the active one) in the active scene.\n\t * If a group is active, the element will be attached to the group.\n\t * \n\t * !static createElement (x: number, y: number, img?: Drawable, containerIndex?: number) : Element;\n\t */\n\tcreateElement: function (id, x, y, img=null, containerIndex=null)\n\t{\n\t\tif (typeof(id) !== 'string')\n\t\t{\n\t\t\tcontainerIndex = img;\n\t\t\timg = y;\n\t\t\ty = x;\n\t\t\tx = id;\n\t\t\tid = null;\n\t\t}\n\n\t\tlet container = this.getContainer(containerIndex);\n\n\t\tlet elem = Element.Pool.alloc(x, y, img);\n\t\tcontainer.add(elem.setId(id));\n\n\t\tif (this.activeGroup !== null)\n\t\t\tthis.activeGroup.addChild(elem);\n\n\t\tthis.lastElement = elem;\n\t\treturn elem;\n\t},\n\n\t/**\n\t * Creates a named mask and adds it to the specified container or LAYER_MASK if none provided.\n\t * If a group is active, the mask will be attached to the group.\n\t * \n\t * !static createMask (id: string, type: number, x?: number, y?: number, width?: number, height?: number, containerIndex?: number) : Mask;\n\t */\n\tcreateMask: function (id, type, x=null, y=null, width=null, height=null, containerIndex=null)\n\t{\n\t\tlet container = this.getContainer(containerIndex || world.LAYER_MASK);\n\n\t\tif (x === null)\n\t\t{\n\t\t\tif (this.activeGroup === null)\n\t\t\t\tthrow new Error ('createMask: create a group first to use default masks.');\n\n\t\t\tx = this.activeGroup.bounds.x1;\n\t\t\ty = this.activeGroup.bounds.y1;\n\t\t\twidth = this.activeGroup.bounds.width();\n\t\t\theight = this.activeGroup.bounds.height();\n\t\t}\n\n\t\tlet mask = Mask.Pool.alloc(type, x, y, width, height);\n\t\tcontainer.add(mask.setId(id));\n\n\t\tif (this.activeGroup !== null)\n\t\t\tthis.activeGroup.addChild(mask);\n\n\t\treturn mask;\n\t},\n\n\t/**\n\t * Creates a named label element and adds it to the specified container (or the active one) in the active scene.\n\t * If a group is active, the label element will be attached to the group.\n\t * \n\t * !static createLabel (id: string, x: number, y: number, font: object, text: string, containerIndex?: number) : Label;\n\t */\n\t/**\n\t * Creates a label element and adds it to the specified container (or the active one) in the active scene.\n\t * If a group is active, the label element will be attached to the group.\n\t * \n\t * !static createLabel (x: number, y: number, font: object, text: string, containerIndex?: number) : Label;\n\t */\n\tcreateLabel: function (id, x, y, font, text, containerIndex=null)\n\t{\n\t\tif (typeof(id) !== 'string')\n\t\t{\n\t\t\tcontainerIndex = text;\n\t\t\ttext = font;\n\t\t\tfont = y;\n\t\t\ty = x;\n\t\t\tx = id;\n\t\t\tid = null;\n\t\t}\n\n\t\tlet container = this.getContainer(containerIndex);\n\n\t\tlet elem = Label.Pool.alloc(x, y, font, text);\n\t\tcontainer.add(elem.setId(id));\n\n\t\tif (this.activeGroup !== null)\n\t\t\tthis.activeGroup.addChild(elem);\n\n\t\tthis.lastElement = elem;\n\t\treturn elem;\n\t},\n\n\t/**\n\t * Creates a new updater, attaches it to the active scene and returns it.\n\t * !static createUpdater (update?: (elem: Element, dt: number, context: object) => boolean, context?: object) : Updater;\n\t */\n\tcreateUpdater: function (update=null, context=null)\n\t{\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('createUpdater: use selectScene first to select the active scene.');\n\n\t\treturn new Updater (this.activeScene, update, context);\n\t}\n};\n\n//!/class\n\nexport default world;\n","\n//!/**\n//! * Registered resources. Initially these are resource descriptors, but after a call to `res.load` these will be fully loaded resources.\n//! */\n//:const r : { \\[key: string\\]: any };\n\nconst r = {\n};\n\nexport default r;\n","\nimport Resources from '../resources/resources.js';\nimport r from './r.js';\n\n// TODO add an interface to change the parameter of image resources using methods instead of passing the properties.\n\n/**\n * Resource manager allows to specify resource descriptors to load them.\n */\n\n//!namespace res\n\n\t//!type AnimationResource =\n\n\t\t/**\n\t\t * Sets the default FPS value.\n\t\t * !fps (value: number) : AnimationResource;\n\t\t */\n\n\t\t/**\n\t\t * Defines an animation sequence.\n\t\t * !seq (sequenceName: string, isLoop: boolean, frameGroup: string, fps?: number) : AnimationResource;\n\t\t */\n\n\t\t/**\n\t\t * Defines a transition sequence.\n\t\t * !trans (sourceSequenceName: string, destinationSequenceName: string, frameGroup: string) : AnimationResource;\n\t\t */\n\n\t\t/**\n\t\t * Sets the default animation sequence.\n\t\t * !def (sequenceName: string) : AnimationResource;\n\t\t */\n\n\t//!/type\n\n\t//!type SpritesheetResource =\n\n\t\t/**\n\t\t * Adds a frame to the spritesheet given its coordinates.\n\t\t * !frame (x: number, y: number, width: number, height: number) : SpritesheetResource;\n\t\t */\n\n\t//!/type\n\n//!/namespace\n\n//!class res\n\nconst res =\n{\n\t/**\n\t * Configures the resources object with the specified options.\n\t * !static config (options: Resources.ConfigOptions) : void;\n\t */\n\tconfig: function (opts)\n\t{\n\t\tResources.config(opts);\n\t},\n\n\t/**\n\t * Loads all registered resources that have not been loaded yet.\n\t * !static load (progressCallback?: (t: number, name: string) => void) : Promise<void>;\n\t */\n\tload: function (progressCallback=null)\n\t{\n\t\treturn new Promise (function (resolve, reject)\n\t\t{\n\t\t\tResources.load (r,\n\t\t\t\tfunction (index, total, value, name) {\n\t\t\t\t\tif (progressCallback) progressCallback(value, name);\n\t\t\t\t},\n\t\t\t\tfunction () {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t},\n\n\t/**\n\t * Returns a resource given its identifier.\n\t * !static get (id: string) : object;\n\t */\n\tget: function (id)\n\t{\n\t\tif (!r.hasOwnProperty(id))\n\t\t\tthrow new Error('Resource not found: ' + id);\n\n\t\treturn r[id];\n\t},\n\n\t/**\n\t * Checks if the ID exists in the fxl `r` map, throws an error if it does.\n\t */\n\t__resIdMustNotExist: function (id)\n\t{\n\t\tif (r.hasOwnProperty(id)) throw new Error ('Resource identifier `' + id + '` is already in use');\n\t},\n\n\t/**\n\t * Registers a solid-color resource.\n\t * !static color (id: string, color: string, width: number, height: number) : Texture;\n\t */\n\tcolor: function (id, color, width, height)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'object', wrapper: 'Custom', color: color, width: width, height: height };\n\t},\n\n\t/**\n\t * Registers a custom drawable resource.\n\t * !static custom (id: string, width: number, height: number, drawFunction: (g: Canvas) => void) : Texture;\n\t */\n\tcustom: function (id, width, height, drawFunction, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'object', wrapper: 'Custom', width: width, height: height, draw: drawFunction, ...opts };\n\t},\n\n\t/**\n\t * Registers an image resource.\n\t * !static image (id: string, path: string, opts?: object) : Texture;\n\t */\n\timage: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'image', wrapper: 'Drawable', src: path, ...opts };\n\t},\n\n\t/**\n\t * Registers a multi image resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file. Ensure to add the \"#\" marks to replace the file index (i.e. \"image-##.png\").\n\t * @param count - Number of images to load (from 0 to count-1).\n\t * !static images (id: string, path: string, count: number, frameWidth?: number, frameHeight?: number, configOptions?: object, resOptions?: object) : object;\n\t */\n\timages: function (id, path, count, frameWidth=null, frameHeight=null, configOptions=null, resOptions=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\t\treturn r[id] = { type: 'images', wrapper: 'Spritesheet', src: path, count: count, width: frameWidth, height: frameHeight,\n\t\t\tconfig: {\n\t\t\t\tframeWidth: frameWidth, frameHeight: frameHeight, ...configOptions\n\t\t\t},\n\t\t\t...resOptions\n\t\t};\n\t},\n\n\t/**\n\t * Registers an spritesheet resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file.\n\t * !static spritesheet (id: string, path: string, frameWidth: number, frameHeight: number, numFrames?: number, configOptions?: object, resOptions?: object) : res.SpritesheetResource;\n\t */\n\t/**\n\t * Registers an spritesheet resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file.\n\t * @param coords - Array of coordinates of each frame.\n\t * !static spritesheet (id: string, path: string, frameWidth: number, frameHeight: number, coords: Array<[x,y,w,h]>, configOptions?: object, resOptions?: object) : res.SpritesheetResource;\n\t */\n\tspritesheet: function (id, path, frameWidth, frameHeight, numFrames=0, configOptions=null, resOptions=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'image', wrapper: 'Spritesheet', src: path,\n\t\t\tconfig: {\n\t\t\t\tframeWidth: frameWidth, frameHeight: frameHeight,\n\t\t\t\tnumFrames: typeof(numFrames) === 'number' ? numFrames : 0,\n\t\t\t\tcoords: typeof(numFrames) === 'number' ? null : numFrames,\n\t\t\t\t...configOptions\n\t\t\t},\n\t\t\t...resOptions,\n\n\t\t\tframe: function (x, y, w, h)\n\t\t\t{\n\t\t\t\tif (!this.config.coords)\n\t\t\t\t\tthis.config.coords = [];\n\n\t\t\t\tthis.config.coords.push([x, y, w, h]);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t};\n\t},\n\n\t/**\n\t * Registers a spritesheet animation resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file.\n\t * !static animation (id: string, path: string, frameWidth: number, frameHeight: number, numFrames?: number, configOptions?: object, resOptions?: object) : res.AnimationResource;\n\t */\n\tanimation: function (id, path, frameWidth, frameHeight, numFrames=null, configOptions=null, resOptions=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'image', wrapper: 'SpritesheetAnimation', src: path,\n\t\t\tconfig: {\n\t\t\t\tframeWidth: frameWidth, frameHeight: frameHeight, numFrames: numFrames, ...configOptions\n\t\t\t},\n\n\t\t\tanim: {\n\t\t\t\tdef: null, fps: 15, seq: { }, trans: { }\n\t\t\t},\n\n\t\t\t...resOptions,\n\n\t\t\tfps: function(value) {\n\t\t\t\tthis.anim.fps = value;\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\tseq: function(id, loop, group, fps=null)\n\t\t\t{\n\t\t\t\tthis.anim.seq[id] = { loop: loop, group: group };\n\n\t\t\t\tif (fps !== null)\n\t\t\t\t\tthis.anim.seq[id].fps = fps;\n\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\ttrans: function(srcSeq, dstSeq, group)\n\t\t\t{\n\t\t\t\tif (!(srcSeq in this.anim.trans))\n\t\t\t\t\tthis.anim.trans[srcSeq] = { };\n\n\t\t\t\tthis.anim.trans[srcSeq][dstSeq] = group;\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\tdef: function(value) {\n\t\t\t\tthis.anim.def = value;\n\t\t\t\treturn this;\n\t\t\t}\n\t\t};\n\t},\n\n\t/**\n\t * Registers a spritefont animation resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file.\n\t * !static spritefont (id: string, path: string, charWidth: number, charHeight: number, charset: string, optsA?: object, optsB?: object) : object;\n\t */\n\tspritefont: function (id, path, charWidth, charHeight, charset, optsA=null, optsB=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\t\t\n\t\treturn r[id] = { type: 'image', wrapper: 'SpriteFont', src: path,\n\t\t\tfont: {\n\t\t\t\tcharWidth: charWidth, charHeight: charHeight, charset: charset, ...optsA\n\t\t\t},\n\t\t\t...optsB\n\t\t};\n\t},\n\n\t/**\n\t * Registers a JSON data resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file.\n\t * !static json (id: string, path: string, opts?: object) : object;\n\t */\n\tjson: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'json', src: path, ...opts };\n\t},\n\n\t/**\n\t * Registers a binary data resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file.\n\t * !static data (id: string, path: string, opts?: object) : object;\n\t */\n\tdata: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'data', src: path, ...opts };\n\t},\n\n\t/**\n\t * Registers a text data resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file.\n\t * !static text (id: string, path: string, opts?: object) : object;\n\t */\n\ttext: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'text', src: path, ...opts };\n\t},\n\n\t/**\n\t * Registers a sound effect audio resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file.\n\t * !static sfx (id: string, path: string, opts?: object) : object;\n\t */\n\tsfx: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'audio', wrapper: 'Sound', src: path, track: 'sfx', ...opts };\n\t},\n\n\t/**\n\t * Registers a multi sound effect audio resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file. Ensure to add the \"#\" marks to replace the file index (i.e. \"sound-##.ogg\").\n\t * @param count - Number of sounds to load (from 0 to count-1).\n\t * @param mode - Playback mode, can be `sequential` (default) or `random`.\n\t * !static sfxm (id: string, path: string, count: number, mode?: string) : object;\n\t */\n\tsfxm: function (id, path, count, mode='sequential')\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\t\treturn r[id] = { type: 'audios', wrapper: 'SoundArray', src: path, count: count, track: 'sfx', mode: mode };\n\t},\n\n\t/**\n\t * Registers an music audio resource.\n\t * @param id - Resource identifier.\n\t * @param path - Path to the source file.\n\t * !static music (id: string, path: string) : object;\n\t */\n\tmusic: function (id, path)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'audio', wrapper: 'Sound', src: path, track: 'music' };\n\t}\n};\n\nexport default res;\n","\nimport { Class } from 'rinn';\nimport Stick from '../flow/stick.js';\nimport Button from '../flow/button.js';\nimport Group from '../flow/group.js';\n\n//![import '../flow/stick.js']\n//![import '../flow/button.js']\n\n/**\n * Gamepads are input objects that allow sticks and buttons to be added to it.\n */\n\n//!class Gamepad\n\nconst Gamepad = Class.extend\n({\n\t/**\n\t * Contains the sticks of the gamepad.\n\t * !readonly sticks: { \\[key:string\\]: Stick };\n\t */\n\tsticks: null,\n\n\t/**\n\t * Contains the buttons of the gamepad.\n\t * !readonly buttons: { \\[key:string\\]: Button };\n\t */\n\tbuttons: null,\n\n\t/**\n\t * World scene where the container is defined.\n\t */\n\tscene: null,\n\n\t/**\n\t * Container where the gamepad controls will be created.\n\t */\n\tcontainer: null,\n\n\t/**\n\t * Indicates the visible state of the gamepad.\n\t */\n\t_visible: true,\n\n\t/**\n\t * Group containing all elements (buttons, sticks or user-added elements) that belong to the gamepad.\n\t * !readonly group: Group;\n\t */\n\tgroup: null,\n\n\t/**\n\t * Constructs a new gamepad object.\n\t * !constructor (scene: Scene, containerIndex: number);\n\t */\n\t__ctor: function(scene, containerIndex)\n\t{\n\t\tthis.sticks = { };\n\t\tthis.buttons = { };\n\n\t\tthis.scene = scene;\n\t\tthis.layer = scene.getContainer(containerIndex);\n\n\t\tthis.group = Group.Pool.alloc();\n\t},\n\n\t/**\n\t * Creates a new stick control and adds it to the gamepad.\n\t * !addStick (id: string, x: number, y: number, outerDrawable: Drawable, innerDrawable: Drawable, maxRadius?: number|0) : Stick;\n\t */\n\taddStick: function (id, x, y, outerDrawable, innerDrawable, maxRadius=0)\n\t{\n\t\tif (maxRadius == 0)\n\t\t\tmaxRadius = outerDrawable.width - innerDrawable.width;\n\n\t\tlet stick = new Stick (this.layer, x, y, maxRadius, outerDrawable, innerDrawable);\n\n\t\tthis.sticks[id] = stick;\n\t\tthis[id] = stick;\n\n\t\tthis.group.addChild(stick);\n\t\treturn stick;\n\t},\n\n\t/**\n\t * Creates a new button control and adds it to the gamepad.\n\t * !addButton (id: string, x: number, y: number, unpressedDrawable?: Drawable|null, pressedDrawable?: Drawable|null) : Button;\n\t */\n\taddButton: function (id, x, y, unpressedDrawable=null, pressedDrawable=null)\n\t{\n\t\tlet button = new Button (this.layer, x, y, unpressedDrawable, pressedDrawable);\n\n\t\tthis.buttons[id] = button;\n\t\tthis[id] = button;\n\n\t\tthis.group.addChild(button);\n\t\treturn button;\n\t},\n\n\t/**\n\t * Returns the `visible` property of the gamepad.\n\t * !visible() : boolean;\n\t */\n\t/**\n\t * Sets the `visible` property of the gamepad.\n\t * !visible (value: boolean) : Gamepad;\n\t */\n\tvisible: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._visible;\n\n\t\tthis._visible = value;\n\n\t\tfor (let i in this.sticks)\n\t\t\tthis.sticks[i].visible(value);\n\n\t\tfor (let i in this.buttons)\n\t\t\tthis.buttons[i].visible(value);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the `visible` property of all masks to the specified value.\n\t * !showMasks (value: boolean) : Gamepad;\n\t */\n\tshowMasks: function (value)\n\t{\n\t\tfor (let i in this.sticks)\n\t\t\tthis.sticks[i].hitbox.visible(value, true);\n\n\t\tfor (let i in this.buttons)\n\t\t\tthis.buttons[i].hitbox.visible(value, true);\n\n\t\treturn this;\n\t}\n});\n\n//!/class\n\nexport default Gamepad;\n","\nimport PointerHandler from '../flow/pointer-handler.js';\nimport KeyboardHandler from '../flow/keyboard-handler.js';\nimport Handler from '../utils/handler.js';\n\nimport world from './world.js';\nimport system from './system.js';\n\nimport Gamepad from './gamepad.js';\n\n//!namespace input\n\n//:[import './gamepad.js']\n\n\t//:type PointerCallback = (action: System.PointerEventType, pointer: System.Pointer, arg0?: any, arg1?: any, args2?: any) => void;\n\t//:type KeyboardCallback = (action: System.KeyboardEventType, keyCode: KeyCode, keyState: System.KeyboardState, arg0?: any, arg1?: any, args2?: any) => void;\n\n//!/namespace\n\n//!class input\n\n/**\n * Input system allows to interface with the pointer and keyboard devices. And to create on-screen gamepads.\n */\n\nconst input =\n{\n\t/**\n\t * Registered gamepads.\n\t */\n\t_gamepads: [],\n\n\t/**\n\t * Currently active gamepad.\n\t * !static activeGamepad: input.Gamepad;\n\t */\n\tactiveGamepad: null,\n\n\t/**\n\t * Last created button.\n\t * !static lastButton: Button;\n\t */\n\tlastButton: null,\n\n\t/**\n\t * Last created stick.\n\t * !static lastStick: Stick;\n\t */\n\tlastStick: null,\n\n\t/**\n\t * Cursor object, used to control the state of the single-cursor input.\n\t */\n\tcursor:\n\t{\n\t\t/**\n\t\t * Indicates if the single-cursor input has been enabled.\n\t\t */\n\t\t_enabled: null,\n\n\t\t/**\n\t\t * Handler callback for cursor events.\n\t\t */\n\t\t_handler: null,\n\n\t\t/**\n\t\t * Cursor element used when the single-cursor input is enabled.\n\t\t */\n\t\t_element: null,\n\n\t\t/**\n\t\t * Pointer state related to the cursor when single-cursor input is enabled.\n\t\t */\n\t\tpointer: null,\n\n\t\t/**\n\t\t * Returns the element used for single-cursor input.\n\t\t */\n\t\telement: function (elem=false)\n\t\t{\n\t\t\tif (elem === false)\n\t\t\t\treturn this._element;\n\n\t\t\tthis._element = elem;\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Hides or shows the native cursor.\n\t\t */\n\t\tnative: function (value)\n\t\t{\n\t\t\tif (!value && system.renderer.elem.style.cursor !== 'none')\n\t\t\t\tsystem.renderer.elem.style.cursor = 'none';\n\t\t\telse if (value && system.renderer.elem.style.cursor === 'none')\n\t\t\t\tsystem.renderer.elem.style.removeProperty('cursor');\n\t\t},\n\n\t\t/**\n\t\t * Enables or disables the single-cursor input.\n\t\t */\n\t\tenabled: function (value=null)\n\t\t{\n\t\t\tif (value === null)\n\t\t\t\treturn this._enabled;\n\n\t\t\tif (this._enabled === value)\n\t\t\t\treturn this;\n\n\t\t\tthis._enabled = value;\n\n\t\t\tif (value === true)\n\t\t\t{\n\t\t\t\tif (this._element !== null)\n\t\t\t\t\tsystem.renderer.elem.style.cursor = 'none';\n\n\t\t\t\tPointerHandler.register(this.pointerHandler);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsystem.renderer.elem.style.removeProperty('cursor');\n\t\t\t\tPointerHandler.unregister(this.pointerHandler);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Sets the callback to execute when a cursor event happens.\n\t\t * @param { (action:number, pointer:object) => void } callback\n\t\t */\n\t\thandler: function (callback)\n\t\t{\n\t\t\tthis._handler = callback;\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Pointer event handler for single-cursor input.\n\t\t */\n\t\tpointerHandler:\n\t\t{\n\t\t\tpriority: 50,\n\n\t\t\tonPointerEvent: function (action, pointer, pointers)\n\t\t\t{\n\t\t\t\tif (!input.cursor._enabled)\n\t\t\t\t\treturn;\n\n\t\t\t\tinput.cursor.pointer = pointer;\n\n\t\t\t\tif (input.cursor._element !== null)\n\t\t\t\t\tinput.cursor._element.setPosition(pointer.x, pointer.y);\n\n\t\t\t\tif (input.cursor._handler !== null)\n\t\t\t\t\tinput.cursor._handler (action, pointer);\n\t\t\t},\n\t\t},\n\t},\n\n\t/**\n\t * Pointer related functions.\n\t * !static pointer: {\n\t */\n\tpointer:\n\t{\n\t\t/**\n\t\t * Pointer handler.\n\t\t */\n\t\t_handler: null,\n\n\t\t/**\n\t\t * Context.\n\t\t */\n\t\tcontext: null,\n\n\t\t/**\n\t\t * Initializes the pointer input system.\n\t\t */\n\t\tinit: function ()\n\t\t{\n\t\t\tif (this._handler !== null)\n\t\t\t\treturn;\n\n\t\t\tthis._handler = Handler.Pool.alloc();\n\t\t\tthis.context = { action: null, pointer: null, pointers: null };\n\n\t\t\tPointerHandler.register(this);\n\t\t},\n\n\t\t/**\n\t\t * General pointer event handler.\n\t\t */\n\t\tonPointerEvent: function (action, pointer, pointers)\n\t\t{\n\t\t\tthis.context.action = action;\n\t\t\tthis.context.pointer = pointer;\n\t\t\tthis.context.pointers = pointers;\n\n\t\t\tthis._handler.exec(this.context);\n\t\t},\n\n\t\t/**\n\t\t * Adds a callback to the pointer event dispatcher.\n\t\t * !add: (callback: fxl.input.PointerCallback, arg0?: any, arg1?: any, arg2?: any) => Callback;\n\t\t */\n\t\tadd: function (callback, arg0=null, arg1=null, arg2=null)\n\t\t{\n\t\t\tif (this._handler === null)\n\t\t\t\tthis.init();\n\n\t\t\treturn this._handler.add (this._handler_callback, callback, arg0, arg1, arg2);\n\t\t},\n\n\t\t/**\n\t\t * Removes a callback from the pointer event dispatcher.\n\t\t * @param {Callback} callback - The node returned by the `add` method.\n\t\t * !remove: (callback: Callback) => void;\n\t\t */\n\t\tremove: function (callback)\n\t\t{\n\t\t\ththis._handler.remove (callback);\n\t\t},\n\n\t\t_handler_callback: function (context, callback, arg0, arg1, arg2)\n\t\t{\n\t\t\treturn callback (context.action, context.pointer, arg0, arg1, arg2);\n\t\t},\n\t},\n\t//!};\n\n\t/**\n\t * Keyboard related functions.\n\t * !keyboard: {\n\t */\n\tkeyboard:\n\t{\n\t\t/**\n\t\t * Keyboard handler.\n\t\t */\n\t\t_handler: null,\n\n\t\t/**\n\t\t * Context.\n\t\t */\n\t\tcontext: null,\n\n\t\t/**\n\t\t * Initializes the keyboard input system.\n\t\t */\n\t\tinit: function ()\n\t\t{\n\t\t\tif (this._handler !== null)\n\t\t\t\treturn;\n\n\t\t\tthis._handler = Handler.Pool.alloc();\n\t\t\tthis.context = { action: null, keyCode: null, keybState: null };\n\n\t\t\tKeyboardHandler.register(this);\n\t\t},\n\n\t\t/**\n\t\t * General keyboard event handler.\n\t\t */\n\t\tonKeyboardEvent: function (action, keyCode, keybState)\n\t\t{\n\t\t\tthis.context.action = action;\n\t\t\tthis.context.keyCode = keyCode;\n\t\t\tthis.context.keybState = keybState;\n\n\t\t\tthis._handler.exec(this.context);\n\t\t},\n\n\t\t/**\n\t\t * Adds a callback to the keyboard event dispatcher.\n\t\t * !add: (callback: fxl.input.KeyboardCallback, arg0?: any, arg1?: any, arg2?: any) => Callback;\n\t\t */\n\t\tadd: function (callback, arg0=null, arg1=null, arg2=null)\n\t\t{\n\t\t\tif (this._handler === null)\n\t\t\t\tthis.init();\n\n\t\t\treturn this._handler.add (this._handler_callback, callback, arg0, arg1, arg2);\n\t\t},\n\n\t\t/**\n\t\t * Removes a callback from the keyboard event dispatcher.\n\t\t * @param {Callback} callback - The node returned by the `add` method.\n\t\t * !remove: (callback: Callback) => void;\n\t\t */\n\t\tremove: function (callback)\n\t\t{\n\t\t\tthis._handler.remove (callback);\n\t\t},\n\n\t\t_handler_callback: function (context, callback, arg0, arg1, arg2)\n\t\t{\n\t\t\treturn callback (context.action, context.keyCode, context.keybState, arg0, arg1, arg2);\n\t\t},\n\t},\n\t//!};\n\n\t/**\n\t * Creates a gamepad object and attaches it to the SCENE_HUD in the specified layer (defaults to LAYER_HUD_MAIN).\n\t * !static createGamepad (index: number, layerIndex?: number) : input.Gamepad;\n\t */\n\tcreateGamepad: function (index, layerIndex=null)\n\t{\n\t\tlayerIndex = layerIndex !== null ? layerIndex : world.LAYER_HUD_MAIN;\n\n\t\tworld.selectScene(world.SCENE_HUD);\n\t\tworld.selectContainer(layerIndex);\n\n\t\tthis._gamepads[index] = new Gamepad (world.activeScene, layerIndex);\n\t\tthis.selectGamepad(index);\n\n\t\treturn this.activeGamepad;\n\t},\n\n\t/**\n\t * Returns a gamepad given its index.\n\t * !static getGamepad (index: number) : input.Gamepad;\n\t */\n\tgetGamepad: function (index)\n\t{\n\t\tif (index < 0 || index >= this._gamepads.length)\n\t\t\treturn null;\n\n\t\treturn this._gamepads[index] || null;\n\t},\n\n\t/**\n\t * Selects the active gamepad for subsequent gamepad-level operations.\n\t * !static selectGamepad (index: number) : boolean;\n\t */\n\tselectGamepad: function (index)\n\t{\n\t\tthis.activeGamepad = this.getGamepad(index);\n\t\treturn true;\n\t},\n\n\t/**\n\t * Sets the value of `debugBounds` on the specified gamepad. If index is `null`, all gamepads will be selected.\n\t * !static debugGamepad (index: number, value: boolean) : void;\n\t */\n\tdebugGamepad: function (index, value)\n\t{\n\t\tif (index === null)\n\t\t{\n\t\t\tfor (let i = 0; i < this._gamepads.length; i++)\n\t\t\t{\n\t\t\t\tif (!this._gamepads[i])\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis.debugGamepad(i, value);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis._gamepads[index].debug(value);\n\t},\n\n\t/**\n\t * Adds an stick control to the active gamepad.\n\t * !static stick (id: string, x: number, y: number, outerDrawable: Drawable, innerDrawable: Drawable, maxRadius?: number|0) : Stick;\n\t */\n\tstick: function (id, x, y, outerDrawable, innerDrawable, maxRadius=0)\n\t{\n\t\tif (this.activeGamepad === null)\n\t\t\tthrow new Error ('input.addStick: use input.selectGamepad first to select the active gamepad.');\n\n\t\treturn this.lastStick = this.activeGamepad.addStick (id, x, y, outerDrawable, innerDrawable, maxRadius);\n\t},\n\n\t/**\n\t * Adds a button control to the active gamepad.\n\t * !static button (id: string, x: number, y: number, unpressedDrawable?: Drawable|null, pressedDrawable?: Drawable|null) : Button;\n\t */\n\tbutton: function (id, x, y, unpressedDrawable=null, pressedDrawable=null)\n\t{\n\t\tif (this.activeGamepad === null)\n\t\t\tthrow new Error ('input.addButton: use input.selectGamepad first to select the active gamepad.');\n\n\t\treturn this.lastButton = this.activeGamepad.addButton (id, x, y, unpressedDrawable, pressedDrawable);\n\t}\n};\n\n//!/class\n\nexport default input;\n","\nimport Bounds2 from '../math/bounds2.js';\nimport GridElement from '../flow/grid-element.js';\nimport Handler from '../utils/handler.js';\n\nimport world from './world.js';\n\n/**\n * \tMask used to isolate the super-type of a type.\n */\nconst SUPER_TYPE_MASK = 0xFFFFF000;\n\n/**\n * \tThe collider system is responsible of detecting collisions and performing the respective actions.\n */\n\n//!class collider\n\nconst collider =\n{\n\t/**\n\t * \tFlag used to exclude from collision checks.\n\t *\t!static readonly FLAG_EXCLUDE: number;\n\t */\n\tFLAG_EXCLUDE: GridElement.allocFlag(),\n\n\t/**\n\t * \tContact rules, define what to do when certain types of elements are in contact.\n\t */\n\tcontactRules: { },\n\n\t/**\n\t * \tTruncation rules, indicate which type of elements are not allowed to penetrate each other.\n\t */\n\ttruncationRules: { },\n\n\t/**\n\t *\tScene where the mask layer is contained.\n\t */\n\tscene: null,\n\n\t/**\n\t *\tLayer containing the element masks.\n\t */\n\tmaskLayer: null,\n\n\t/**\n\t *\tFirst updater.\n\t *\t!static fupdater: Handler;\n\t */\n\tfupdater: null,\n\n\t/**\n\t *\tLast updater.\n\t *\t!static lupdater: Handler;\n\t */\n\tlupdater: null,\n\n\t/**\n\t *\tFlags used to filter elements.\n\t *\t!static flagsAnd: number;\n\t *\t!static flagsValue: number;\n\t */\n\tflagsAnd: 0,\n\tflagsValue: 0,\n\n\t/**\n\t *\tCurrent collider state fields.\n\t *\t!static state: {\n\t */\n\tstate:\n\t{\n\t\t/**\n\t\t * \tContact area.\n\t\t *\t!contact: Bounds2;\n\t\t */\n\t\tcontact: Bounds2.Pool.alloc(),\n\n\t\t/**\n\t\t * \tContact flags.\n\t\t * \t!flags: collider.Contact;\n\t\t */\n\t\tflags: 0,\n\n\t\t/**\n\t\t * \tFinal delta value for X-coordinate calculated by `translate`.\n\t\t *\t!dx: number;\n\t\t */\n\t\tdx: 0,\n\n\t\t/**\n\t\t * \tFinal delta value for Y-coordinate calculated by `translate`.\n\t\t *\t!dy: number;\n\t\t */\n\t\tdy: 0,\n\n\t\tbounds: Bounds2.Pool.alloc(),\n\n\t\tx: new Array(32).fill(0),\n\t\ty: new Array(32).fill(0),\n\t\tv0x: new Array(32).fill(0),\n\t\tv0y: new Array(32).fill(0),\n\t\tv1x: new Array(32).fill(0),\n\t\tv1y: new Array(32).fill(0),\n\t\tv2x: new Array(32).fill(0),\n\t\tv2y: new Array(32).fill(0),\n\n\t\tcount: 0,\n\t\ttarget: 0,\n\n\t\tv0: 0, w0: 0, delta0: 0,\n\t\tv1: 0, w1: 0, delta1: 0,\n\n\t\tw2: 0,\n\t\tt_dx: 0,\n\t\tt_dy: 0,\n\t},\n\t//:}\n\n\t/**\n\t *\tEnables the collider system on the specified scene and layer.\n\t * \t@param sceneIndex - Scene to attach the collider updater methods. Uses world.SCENE_MAIN if none specified.\n\t * \t@param layerIndex - Index within the scene of the layer where element masks are stored. Uses world.LAYER_MASK if none specified.\n\t * \t!static enable (sceneIndex?: number, layerIndex?: number) : void;\n\t */\n\tenable: function (sceneIndex=null, layerIndex=null)\n\t{\n\t\tthis.scene = world.getScene(sceneIndex || world.SCENE_MAIN);\n\t\tthis.maskLayer = this.scene.getContainer(layerIndex || world.LAYER_MASK);\n\n\t\tthis.flagsAnd = GridElement.ALIVE | GridElement.VISIBLE | collider.FLAG_EXCLUDE;\n\t\tthis.flagsValue = GridElement.ALIVE | GridElement.VISIBLE;\n\n\t\tthis.scene.fupdater.add(this.firstUpdate, this);\n\t\tthis.scene.lupdater.add(this.lastUpdate, this);\n\n\t\tthis.fupdater = Handler.Pool.alloc(this);\n\t\tthis.lupdater = Handler.Pool.alloc(this);\n\t},\n\n\t/**\n\t *\tDisables the collider system.\n\t *\t!static disable() : void;\n\t */\n\tdisable: function()\n\t{\n\t\tthis.scene.fupdater.remove(this.update, this);\n\t\tthis.maskLayer = null;\n\n\t\tthis.fupdater.free();\n\t\tthis.lupdater.free();\n\t},\n\n\t/**\n\t * \tRuns a first update cycle `fupdater` will be executed.\n\t */\n\tfirstUpdate: function(scene, self)\n\t{\n\t\tself.fupdater.exec();\n\t},\n\n\t/**\n\t * \tRuns a last update cycle `lupdater` will be executed.\n\t */\n\tlastUpdate: function(scene, self)\n\t{\n\t\tself.lupdater.exec();\n\t},\n\n\t/**\n\t * \tUtility object containing actions that are executed later on the next update cycle.\n\t * \t!static later: {\n\t */\n\tlater:\n\t{\n\t\t/**\n\t\t *\tRuns the specified callback.\n\t\t *\t!run (elem: Element, callback: Function, arg1?: any, arg2?: any, arg3?: any) : void;\n\t\t */\n\t\trun: function (elem, callback, arg1, arg2, arg3)\n\t\t{\n\t\t\tcollider.fupdater.add(this._run, elem, callback, arg1, arg2, arg3);\n\t\t},\n\n\t\t/**\n\t\t *\tSets the element's visibility flag.\n\t\t * \t!setVisible (elem: Element, value: boolean) : void;\n\t\t */\n\t\tsetVisible: function (elem, value)\n\t\t{\n\t\t\tcollider.fupdater.add(this._setVisible, elem, value);\n\t\t},\n\n\t\t/**\n\t\t *\tSets an attribute of an object to a given value.\n\t\t * \t!setValue (obj: Object, name: string, value: any) : void;\n\t\t */\n\t\tsetValue: function (obj, name, value)\n\t\t{\n\t\t\tcollider.fupdater.add(this._setValue, obj, name, value);\n\t\t},\n\n\t\t/**\n\t\t *\tSets the element's flags.\n\t\t *\t!setFlags (elem: Element, value: number) : void;\n\t\t */\n\t\tsetFlags: function (elem, value)\n\t\t{\n\t\t\tcollider.fupdater.add(this._setFlags, elem, value);\n\t\t},\n\n\t\t/**\n\t\t *\tClears the element's flags.\n\t\t * \t!clearFlags (elem: Element, value: number) : void;\n\t\t */\n\t\tclearFlags: function (elem, value)\n\t\t{\n\t\t\tcollider.fupdater.add(this._clearFlags, elem, value);\n\t\t},\n\n\t\t/* ******* */\n\n\t\t_run: function (host, elem, callback, arg1, arg2, arg3)\n\t\t{\n\t\t\tcallback (host, elem, arg1, arg2, arg3);\n\t\t\treturn false;\n\t\t},\n\n\t\t_setVisible: function (host, elem, value)\n\t\t{\n\t\t\telem.visible(value);\n\t\t\treturn false;\n\t\t},\n\n\t\t_setValue: function (host, obj, name, value)\n\t\t{\n\t\t\tobj[name] = value;\n\t\t\treturn false;\n\t\t},\n\n\t\t_setFlags: function (host, elem, value)\n\t\t{\n\t\t\telem.setFlags(value);\n\t\t\treturn false;\n\t\t},\n\n\t\t_clearFlags: function (host, elem, value)\n\t\t{\n\t\t\telem.clearFlags(value);\n\t\t\treturn false;\n\t\t}\n\t},\n\t//!}\n\n\t/**\n\t * \tAdds a contact rule.\n\t * \t@param primaryType - Type of the primary element.\n\t * \t@param secondaryType - Type of the secondary element.\n\t * \t@param callback - Callback to execute when contact is detected.\n\t * \t@param context - Optional value passed as last parameter to the callback.\n\t * \t!static contact (primaryType: number, secondaryType: number, callback: (primary: Mask, secondary: Mask, context?: any) => void, context?: any) : collider;\n\t */\n\tcontact: function (primaryType, secondaryType, callback, context=null)\n\t{\n\t\tif (!(primaryType in this.contactRules))\n\t\t\tthis.contactRules[primaryType] = { };\n\n\t\tthis.contactRules[primaryType][secondaryType] = { callback: callback, context: context };\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tAdds a truncation rule.\n\t * \t@param primaryType - Type or super-type of the primary element.\n\t * \t@param secondaryType - Type or super-type of the secondary element.\n\t * \t@param callback - Returns boolean indicating if the truncation rule should be applied.\n\t * \t@param context - Optional value passed as last parameter to the callback.\n\t * \t:static truncate (primaryType: number, secondaryType: number, callback?: (primary: Mask, secondary: Mask, context?: any) => void, context?: any) : collider;\n\t */\n\t/**\n\t * \tAdds a truncation rule.\n\t * \t@param primaryType - Type or super-type of the primary element.\n\t * \t@param secondaryType - Type or super-type of the secondary element.\n\t * \t@param value - Indicates the status of the truncation rule.\n\t * \t!static truncate (primaryType: number, secondaryType: number, value: boolean) : collider;\n\t */\n\ttruncate: function (primaryType, secondaryType, callback=null, context=null)\n\t{\n\t\tif (!(primaryType in this.truncationRules))\n\t\t\tthis.truncationRules[primaryType] = { };\n\n\t\tthis.truncationRules[primaryType][secondaryType] = { callback: callback, context: context };\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tLoads the contact flags in the collider state.\n\t *\t!static getContactFlags (boundsA: Bounds2, boundsB: Bounds2) : number;\n\t */\n\tgetContactFlags: function (boundsA, boundsB)\n\t{\n\t\tthis.state.contact.set(boundsA).setAsIntersection(boundsB);\n\t\tlet contact = this.state.contact;\n\n\t\tthis.state.flags = 0;\n\t\tthis.state.numFlags = 0;\n\n\t\tif (contact.x1 == boundsB.x1)\n\t\t{\n\t\t\tthis.state.flags |= collider.Contact.LEFT; // LEFT\n\t\t\tthis.state.numFlags++;\n\t\t}\n\n\t\tif (contact.x2 == boundsB.x2)\n\t\t{\n\t\t\tthis.state.flags |= collider.Contact.RIGHT; // RIGHT\n\t\t\tthis.state.numFlags++;\n\t\t}\n\n\t\tif (contact.y1 == boundsB.y1)\n\t\t{\n\t\t\tthis.state.flags |= collider.Contact.TOP; // TOP\n\t\t\tthis.state.numFlags++;\n\t\t}\n\n\t\tif (contact.y2 == boundsB.y2)\n\t\t{\n\t\t\tthis.state.flags |= collider.Contact.BOTTOM; // BOTTOM\n\t\t\tthis.state.numFlags++;\n\t\t}\n\n\t\treturn this.state.flags;\n\t},\n\n\tcalc: function (store0, sign, a, v0a, v1a, v1b)\n\t{\n\t\tlet n = this.state.count;\n\t\tlet delta = null;\n\t\tlet v = 0;\n\n\t\tif (sign > 0)\n\t\t{\n\t\t\tfor (let i = 0; i < n; i++)\n\t\t\t{\n\t\t\t\tif (!v0a[i] || !v1a[i] || a[i] < 0) continue;\n\n\t\t\t\tif (delta === null || a[i] > delta)\n\t\t\t\t\tdelta = a[i];\n\n\t\t\t\tv1a[i] = v1b[i] = 0;\n\t\t\t\tv += v0a[i];\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let i = 0; i < n; i++)\n\t\t\t{\n\t\t\t\tif (!v0a[i] || !v1a[i] || a[i] > 0) continue;\n\n\t\t\t\tif (delta === null || a[i] < delta)\n\t\t\t\t\tdelta = a[i];\n\n\t\t\t\tv1a[i] = v1b[i] = 0;\n\t\t\t\tv += v0a[i];\n\t\t\t}\n\t\t}\n\n\t\tif (delta === null)\n\t\t\tdelta = 0;\n\n\t\tif (store0) {\n\t\t\tthis.state.v0 = v;\n\t\t\tthis.state.w0 = Math.abs(delta);\n\t\t\tthis.state.delta0 = delta;\n\t\t} else {\n\t\t\tthis.state.v1 = v;\n\t\t\tthis.state.w1 = Math.abs(delta);\n\t\t\tthis.state.delta1 = delta;\n\t\t}\n\t},\n\n\tattemptSelect: function (swapped)\n\t{\n\t\tif (this.state.v1 + this.state.v0 === this.state.target)\n\t\t{\n\t\t\tif (this.state.w2 === null || this.state.w1 + this.state.w0 < this.state.w2)\n\t\t\t{\n\t\t\t\tthis.state.w2 = this.state.w1 + this.state.w0;\n\n\t\t\t\tif (!swapped) {\n\t\t\t\t\tthis.state.t_dx = this.state.delta1;\n\t\t\t\t\tthis.state.t_dy = this.state.delta0;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.state.t_dx = this.state.delta0;\n\t\t\t\t\tthis.state.t_dy = this.state.delta1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tload0: function()\n\t{\n\t\tlet n = this.state.count;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tthis.state.v1x[i] = this.state.v0x[i];\n\t\t\tthis.state.v1y[i] = this.state.v0y[i];\n\t\t}\n\t},\n\n\tsave1: function()\n\t{\n\t\tlet n = this.state.count;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tthis.state.v2x[i] = this.state.v1x[i];\n\t\t\tthis.state.v2y[i] = this.state.v1y[i];\n\t\t}\n\t},\n\n\tload1: function()\n\t{\n\t\tlet n = this.state.count;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tthis.state.v1x[i] = this.state.v2x[i];\n\t\t\tthis.state.v1y[i] = this.state.v2y[i];\n\t\t}\n\t},\n\n\tresolveXpos: function (single=false)\n\t{\n\t\tthis.calc (single, 1, this.state.x, this.state.v0x, this.state.v1x, this.state.v1y);\n\t\tif (single) return true;\n\n\t\tthis.save1();\n\t\tif (this.resolveYpos(true)) this.attemptSelect(false);\n\n\t\tthis.load1();\n\t\tif (this.resolveYneg(true)) this.attemptSelect(false);\n\n\t\tthis.load0();\n\t},\n\n\tresolveXneg: function (single=false)\n\t{\n\t\tthis.calc (single, -1, this.state.x, this.state.v0x, this.state.v1x, this.state.v1y);\n\t\tif (single) return true;\n\n\t\tthis.save1();\n\t\tif (this.resolveYpos(true)) this.attemptSelect(false);\n\n\t\tthis.load1();\n\t\tif (this.resolveYneg(true)) this.attemptSelect(false);\n\n\t\tthis.load0();\n\t},\n\n\tresolveYpos: function (single=false)\n\t{\n\t\tthis.calc (single, 1, this.state.y, this.state.v0y, this.state.v1y, this.state.v1x);\n\t\tif (single) return true;\n\n\t\tthis.save1();\n\t\tif (this.resolveXpos(true)) this.attemptSelect(true);\n\n\t\tthis.load1();\n\t\tif (this.resolveXneg(true)) this.attemptSelect(true);\n\n\t\tthis.load0();\n\t},\n\n\tresolveYneg: function (single=false)\n\t{\n\t\tthis.calc (single, -1, this.state.y, this.state.v0y, this.state.v1y, this.state.v1x);\n\t\tif (single) return true;\n\n\t\tthis.save1();\n\t\tif (this.resolveXpos(true)) this.attemptSelect(true);\n\n\t\tthis.load1();\n\t\tif (this.resolveXneg(true)) this.attemptSelect(true);\n\n\t\tthis.load0();\n\t},\n\n\t/**\n\t * \tCompletes the translation on the current group.\n\t */\n\tcommit: function ()\n\t{\n\t\tif (!this.state.group.alive())\n\t\t\treturn;\n\n\t\tthis.state.group.translate (this.state.dx, this.state.dy);\n\t\tthis.state.group.clearFlags (collider.FLAG_EXCLUDE);\n\t},\n\n\t/**\n\t * \tAttempts to move the specified group by the given deltas. Any collisions detected on the mask will trigger the respective actions.\n\t * \t@param mask - Mask element.\n\t * \t@param dx - X delta value.\n\t * \t@param dy - Y delta value.\n\t * \t!static translate (mask: Mask, dx: number, dy: number) : void;\n\t */\n\t/**\n\t * \tAttempts to move the specified group by the given deltas. Any collisions detected on the mask will trigger the respective actions.\n\t * \t@param mask - Mask element.\n\t * \t@param group - Group where the mask is stored.\n\t * \t@param dx - X delta value.\n\t * \t@param dy - Y delta value.\n\t * \t!static translate (mask: Mask, group: Group, dx: number, dy: number) : void;\n\t */\n\ttranslate: function (mask, group=null, dx=0, dy=0)\n\t{\n\t\tif (typeof(group) === 'number')\n\t\t{\n\t\t\tdy = dx;\n\t\t\tdx = group;\n\t\t\tgroup = null;\n\t\t}\n\n\t\tif (!mask) return;\n\n\t\tif (!group) group = mask.group;\n\n\t\tif (!group.alive() || !mask.alive())\n\t\t\treturn;\n\n\t\tthis.state.mask = mask;\n\t\tthis.state.group = group;\n\n\t\tthis.state.dx = downscalef(upscale(dx));\n\t\tthis.state.dy = downscalef(upscale(dy));\n\n\t\tif (!this.maskLayer || !mask.visible())\n\t\t\treturn this.commit();\n\n\t\tlet truncationRules = this.truncationRules[mask.type];\n\t\tif (!truncationRules)\n\t\t{\n\t\t\ttruncationRules = this.truncationRules[mask.type & SUPER_TYPE_MASK];\n\t\t\tif (!truncationRules)\n\t\t\t{\n\t\t\t\tthis.commit();\n\t\t\t\treturn this.scan(mask, group);\n\t\t\t}\n\t\t}\n\n\t\tthis.state.offs = group.getOffsets(this.state.dx, this.state.dy);\n\t\tthis.state.bounds.set(mask.bounds).translate(this.state.offs.x+this.state.dx, this.state.offs.y+this.state.dy);\n\n\t\tgroup.setFlags (collider.FLAG_EXCLUDE);\n\n\t\tlet collisionItems = this.maskLayer.selectInRegion(this.state.bounds, this.flagsAnd, this.flagsValue);\n\t\tif (collisionItems.length === 0)\n\t\t{\n\t\t\tcollisionItems.free();\n\t\t\treturn this.commit();\n\t\t}\n\n\t\tlet n = 0;\n\t\tlet v = 0;\n\n\t\twhile (true)\n\t\t{\n\t\t\tlet item = collisionItems.shift();\n\t\t\tif (item === null) break;\n\n\t\t\tlet allowsTruncation = truncationRules[item.type];\n\t\t\tif (!allowsTruncation)\n\t\t\t{\n\t\t\t\tallowsTruncation = truncationRules[item.type & SUPER_TYPE_MASK];\n\t\t\t\tif (!allowsTruncation) continue;\n\t\t\t}\n\n\t\t\tif (allowsTruncation.callback === false || (allowsTruncation.callback !== null && allowsTruncation.callback !== true && !allowsTruncation.callback(mask, item, allowsTruncation.context)))\n\t\t\t\tcontinue;\n\n\t\t\tlet width = Math.min(this.state.bounds.x2, item.bounds.x2) - Math.max(this.state.bounds.x1, item.bounds.x1);\n\t\t\tlet height = Math.min(this.state.bounds.y2, item.bounds.y2) - Math.max(this.state.bounds.y1, item.bounds.y1);\n\n\t\t\tthis.state.v0x[n] = 0;\n\t\t\tthis.state.v0y[n] = 0;\n\n\t\t\tif (Math.min(this.state.bounds.width(), item.bounds.width()) != width) {\n\t\t\t\tthis.state.x[n] = absmin(this.state.bounds.x2 - item.bounds.x1, this.state.bounds.x1 - item.bounds.x2);\n\t\t\t\tthis.state.v0x[n] = 1;\n\t\t\t}\n\n\t\t\tif (Math.min(this.state.bounds.height(), item.bounds.height()) != height) {\n\t\t\t\tthis.state.y[n] = absmin(this.state.bounds.y2 - item.bounds.y1, this.state.bounds.y1 - item.bounds.y2);\n\t\t\t\tthis.state.v0y[n] = 1;\n\t\t\t}\n\n\t\t\tlet sv = this.state.v0x[n] + this.state.v0y[n];\n\t\t\tv += sv;\n\n\t\t\tif (sv > 1) {\n\t\t\t\tthis.state.v0x[n] = sv;\n\t\t\t\tthis.state.v0y[n] = sv;\n\t\t\t}\n\n\t\t\tthis.state.v1x[n] = this.state.v0x[n];\n\t\t\tthis.state.v1y[n] = this.state.v0y[n];\n\n\t\t\tn++;\n\t\t}\n\n\t\tcollisionItems.free();\n\n\t\tif (v == 0)\n\t\t{\n\t\t\tthis.commit();\n\t\t\treturn this.scan(mask, group);\n\t\t}\n\n\t\tthis.state.target = v;\n\t\tthis.state.count = n;\n\t\tthis.state.w2 = null;\n\n\t\tthis.resolveXpos();\n\t\tthis.resolveXneg();\n\t\tthis.resolveYpos();\n\t\tthis.resolveYneg();\n\n\t\tif (this.state.w2 !== null)\n\t\t{\n\t\t\tlet contactRules = this.contactRules[mask.type];\n\t\t\tif (!contactRules) contactRules = this.contactRules[mask.type & SUPER_TYPE_MASK];\n\n\t\t\tif (contactRules)\n\t\t\t{\n\t\t\t\tthis.state.bounds.set(mask.bounds).translate(this.state.offs.x+this.state.dx-this.state.t_dx*0.5, this.state.offs.y+this.state.dy-this.state.t_dy*0.5);\n\n\t\t\t\tcollisionItems = this.maskLayer.selectInRegion(this.state.bounds, this.flagsAnd, this.flagsValue);\n\n\t\t\t\twhile (mask.alive())\n\t\t\t\t{\n\t\t\t\t\tlet item = collisionItems.shift();\n\t\t\t\t\tif (item === null) break;\n\n\t\t\t\t\tif (!item.alive())\n\t\t\t\t\t\tcontinue;\n\t\t\n\t\t\t\t\tlet contact = contactRules[item.type];\n\t\t\t\t\tif (!contact)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontact = contactRules[item.type & SUPER_TYPE_MASK];\n\t\t\t\t\t\tif (!contact) continue;\n\t\t\t\t\t}\n\n\t\t\t\t\tcontact.callback (mask, item, contact.context);\n\t\t\t\t}\n\n\t\t\t\tcollisionItems.free();\n\t\t\t}\n\n\t\t\tthis.state.dx -= this.state.t_dx;\n\t\t\tthis.state.dy -= this.state.t_dy;\n\t\t}\n\n\t\tthis.commit();\n\t},\n\n\t/**\n\t *\tScans for collisions against the specified mask.\n\t * \t@param mask - Mask element.\n\t * \t!static scan (mask: Mask) : void;\n\t */\n\t/**\n\t *\tScans for collisions against the specified mask.\n\t * \t@param mask - Mask element.\n\t * \t@param group - Group where the mask is stored.\n\t * \t!static scan (mask: Mask, group: Group) : void;\n\t */\n\tscan: function (mask, group=null)\n\t{\n\t\tif (!group) group = mask.group;\n\n\t\tif (!group || !group.alive() || !mask.alive())\n\t\t\treturn;\n\n\t\tthis.state.mask = mask;\n\t\tthis.state.group = group;\n\n\t\tif (!this.maskLayer || !mask.visible())\n\t\t\treturn;\n\n\t\tlet contactRules = this.contactRules[mask.type];\n\t\tif (!contactRules) contactRules = this.contactRules[mask.type & SUPER_TYPE_MASK];\n\t\tif (!contactRules) return;\n\t\n\t\tgroup.setFlags (collider.FLAG_EXCLUDE);\n\t\tlet collisionItems = this.maskLayer.selectInRegion(mask.bounds, this.flagsAnd, this.flagsValue);\n\t\tgroup.clearFlags (collider.FLAG_EXCLUDE);\n\n\t\twhile (mask.alive())\n\t\t{\n\t\t\tlet item = collisionItems.shift();\n\t\t\tif (item === null) break;\n\n\t\t\tif (!item.alive())\n\t\t\t\tcontinue;\n\n\t\t\tlet contact = contactRules[item.type];\n\t\t\tif (!contact)\n\t\t\t{\n\t\t\t\tcontact = contactRules[item.type & SUPER_TYPE_MASK];\n\t\t\t\tif (!contact) continue;\n\t\t\t}\n\n\t\t\tcontact.callback (mask, item, contact.context);\n\t\t}\n\n\t\tcollisionItems.free();\n\t}\n};\n\n/**\n * \tContact flag bits.\n */\n\n//!/class\n\n//!namespace collider\n//!enum Contact\n\ncollider.Contact = {\n\t//!LEFT\n\tLEFT: 1,\n\t//!RIGHT\n\tRIGHT: 2,\n\t//!HORIZONTAL\n\tHORIZONTAL: 1|2,\n\t//!TOP\n\tTOP: 4,\n\t//!BOTTOM\n\tBOTTOM: 8,\n\t//!VERTICAL\n\tVERTICAL: 4|8,\n};\n\n//!/enum\n//!/namespace\n\nexport default collider;\n","//@ts-check\n\n//!namespace fxl\n\n//![import \"./system\"]\nimport _sys from './system.js';\nexport const sys = _sys;\n\n//![import \"./world\"]\nimport _world from './world.js';\nexport const world = _world;\n\n//![import \"./r\"]\nimport _r from './r.js';\nexport const r = _r;\n\n//![import \"./resources\"]\nimport _res from './resources.js';\nexport const res = _res;\n\n//![import \"./input\"]\nimport _input from './input.js';\nexport const input = _input;\n\n//![import \"./collider\"]\nimport _collider from './collider.js';\nexport const collider = _collider;\n\n//!/namespace\n"],"names":["$parcel$export","e","t","r","n","Object","defineProperty","get","set","enumerable","configurable","$parcel$global1","globalThis","self","window","$parcel$global","$parcel$modules","$parcel$inits","parcelRequire","parcelRequire25d2","exports","id","call","Error","code","register","module","$39761b0dd175036e$export$2e2bcd8739ae039","$fMUO1","_getref","value","obj","substr","eval","type","model","ctval","name","parseInt","isNaN","parseFloat","toString","default","typeOf","mclass","this","ensure","cls","ensureTypeOf","arrayof","i","length","arraynull","remove","splice","arraycompliant","isCompliant","required","minlen","maxlen","minval","maxval","mincount","maxcount","pattern","$cAEYe","test","inset","RegExp","indexOf","join","upper","toUpperCase","lower","toLowerCase","$b7e7672d417be9d7$var$Rinn","$b7e7672d417be9d7$export$2e2bcd8739ae039","invokeLater","fn","setTimeout","wait","millis","Promise","resolve","reject","o","Array","isArrayOrObject","clone","elem","push","merge","output","objs","arr","j","i1","field","override","partialCompare","full","partial","arrayFind","getObject","isInstanceOf","_class","container","forceArray","$92a8a0aff23e2e33$export$2e2bcd8739ae039","email","url","urlNoProt","uname","text","utext","$2394d727dfd6a212$var$Class","_super","prototype","className","__ctor","__dtor","__proto__","hasOwnProperty","instanceOf","object","_initSuperRefs","constructor","_newSuper","_prot","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","a10","inherit","proto","_extend","base","protos","args","apply","$2394d727dfd6a212$export$2e2bcd8739ae039","extend","source","ret","list","eventName","eventArgs","cbHandler","cbContext","next","_async","listeners","namespace","handler","context","data","split","ns","k","$4dfa0622e14576ea$var$_Model","$c43adaf9cb6d6dd3$export$2e2bcd8739ae039","defaults","constraints","changedList","_silent","_level","EventDispatcher","reset","def","init","update","ready","nsilent","silent","_validate","nvalue","ctname","Constraints","message","_set","dispatchEvent","constraint","_propertyEvent","prev","direct","temp","old","level","evt","arguments","force","fields","has","flatten","getInt","getFloat","getBool","getReference","m","safe","rsafe","class","classPath","keys","ct","validate","observe","property","addEventListener","unobserve","removeEventListener","watch","unwatch","trigger","serialize","$4VREF","$4dfa0622e14576ea$export$2e2bcd8739ae039","$0890bed8a163f087$export$2e2bcd8739ae039","itemt","contents","itemId","nextId","Model","_eventGroup","Date","now","_bind","iid","item","_onItemEvent","_unbind","prepareEvent","from","enqueue","resume","clear","setData","getData","getAt","index","removeAt","setAt","updateAt","position","pop","unshift","shift","find","retObject","unflatten","tmp","$2710795e2347ba2a$var$Schema","Type","precision","_precision","Math","pow","compact","_compact","strings","type1","itemType","v","_debug","callback","_filter","async","defvalue","properties","symbolic","classConstructor1","classConstructor","_constructor","name1","type2","conditions","val","$32651d5f38a8a64c$export$2e2bcd8739ae039","itemTypeSchema","typeSchema","$2710795e2347ba2a$export$2e2bcd8739ae039","Property","is","of","items","add","itemsReferenceChanged","onItemRemoved","desc","sort","a","b","inc","exc","isEmpty","relative","onBeforeItemAdded","concat","onItemAdded","addAt","$d261ccdafdfe12a9$var$Template","strict","parseTemplate","template","sym_open","sym_close","is_tpl","root","nflush","flush","state","count","str","parts","mparts","nparts","emit","trim","map","i2","match","unescape","parse","clean","expand","mode","s","escape","quote","last","first","functions","failed","replace","f","compile","getNamedValues","expanded","key","startsWith","endsWith","global","null","true","false","len","int","float","chr","String","fromCharCode","ord","charCodeAt","not","neg","abs","and","or","eq","ne","lt","le","gt","ge","isnotnull","isnull","iszero","typeof","x","mul","div","sum","sub","mod","dump","JSON","stringify","ref","_unset","start","nl2br","attr","values","_each","var_name","_foreach","_if","_switch","case_value","_break","_continue","_repeat","to","step","tpl","_for","_loop","_echo","console","log","contains","err","_map","arrayMode","_call","i3","$d261ccdafdfe12a9$export$2e2bcd8739ae039","$9ffb7151b8b2d038$export$eefcfe56efaaa57d","$9ffb7151b8b2d038$export$4c85e640eb41c31b","$9ffb7151b8b2d038$export$d61e24a684f9e51","$13eda5a5dec8010f$export$2e2bcd8739ae039","$9ffb7151b8b2d038$export$ec8b666c5fe2c75a","$9ffb7151b8b2d038$export$a1edc412be3e1841","$9ffb7151b8b2d038$export$59eced47f477f85a","$9ffb7151b8b2d038$export$19342e026b58ebb7","$9ffb7151b8b2d038$export$3a9581c9ade29768","$9ffb7151b8b2d038$export$fb8073518f34e6ec","$2bcce06113365814$export$2e2bcd8739ae039","$9ffb7151b8b2d038$export$14416b8d99d47caa","$3CL91","$42e4702e58ec5fce$var$XOR","$42e4702e58ec5fce$var$SHR","$42e4702e58ec5fce$var$SHL","$42e4702e58ec5fce$var$Random","Class","seed","setSeed","nextInt32","c","d","nextInt16","nextInt8","nextFloat","$42e4702e58ec5fce$export$2e2bcd8739ae039","$87a32fa215803424$export$2e2bcd8739ae039","BACKSPACE","TAB","ENTER","SHIFT","CTRL","ESC","SPACE","PGUP","PGDN","END","HOME","INS","DEL","LEFT","UP","RIGHT","DOWN","NUM_PLUS","NUM_MINUS","NUM_ASTERISK","NUM_SLASH","NUM_DOT","NUM_0","NUM_1","NUM_2","NUM_3","NUM_4","NUM_5","NUM_6","NUM_7","NUM_8","NUM_9","D0","D1","D2","D3","D4","D5","D6","D7","D8","D9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","BACKQUOTE","MINUS","EQUAL","LBRACKET","RBRACKET","BACKSLASH","SEMICOLON","QUOTE","COMMA","DOT","SLASH","$cac8b143592e7d73$var$recyclingFacilities","$cac8b143592e7d73$var$totalPreallocated","$cac8b143592e7d73$var$Recycler","Recycler","$cac8b143592e7d73$export$2e2bcd8739ae039","attachTo","targetClass","maxPoolSize","minPoolSize","recyclerPool","fill","recyclerPoolMax","objectId","objectRefs","recyclerNextObjectId","recyclerCreated","recyclerRecycled","recyclerDropped","recyclerLength","recyclerActive","preallocated","preallocate","maximum","min","allocate","alloc","free","error","lockInstance","instanceRef","showStats","debug","toFixed","group","groupEnd","createPool","Pool","maxPreallocationsPerPool","$a220fff115a0570f$var$Linkable","unlink","linkAfter","linkBefore","$a220fff115a0570f$export$2e2bcd8739ae039","$c73414f3aa8cd9da$var$List","top","bottom","Rinn","ni","dispose","getNodeAt","sgetNode","isInstance","insertBefore","insertAfter","append","forEach","forEachRev","filter","toArray","array","$c73414f3aa8cd9da$export$2e2bcd8739ae039","$445264d030762d7a$var$Timer","vsync","interval","handle","isRunning","startTime","rTime","sTime","lTime","tDelta","_onTimeout","onTimeout","_onTimeout_b","runNow","hrnow","tError","runAfter","immediate","scale","onStarted","timeout","requestAnimationFrame","clearTimeout","stop","onStopped","$445264d030762d7a$export$2e2bcd8739ae039","$21edd9058bfa8ef7$var$Vec2","y","setX","setY","zero","isZero","equals","inv","translate","dx","dy","rotate","angle","cx","cy","cos","sin","fx","fy","floor","fract","dot","magnitude","squared","sqrt","normalize","majorAxis","minorAxis","sign","$21edd9058bfa8ef7$export$2e2bcd8739ae039","$ffcd6f0a38d315dc$var$temp","Float32Array","$ffcd6f0a38d315dc$var$temp2","$ffcd6f0a38d315dc$var$Matrix","identity","target","scalef","scalar","matr","cost","sint","sx","sy","applyTo","nx","ny","transpose","det","adj","inverse","loadIdentity","$ffcd6f0a38d315dc$export$2e2bcd8739ae039","$8056ec6610d6f975$var$glx","BufferTarget","BufferUsage","gl","setContext","ARRAY_BUFFER","ELEMENT_ARRAY_BUFFER","COPY_READ_BUFFER","COPY_WRITE_BUFFER","TRANSFORM_FEEDBACK_BUFFER","UNIFORM_BUFFER","PIXEL_PACK_BUFFER","PIXEL_UNPACK_BUFFER","STATIC_DRAW","DYNAMIC_DRAW","STREAM_DRAW","STATIC_READ","DYNAMIC_READ","STREAM_READ","STATIC_COPY","DYNAMIC_COPY","STREAM_COPY","getParameter","getFloat32Array","offset","buff","createBufferFrom","usage","createBuffer","bindBuffer","bufferData","$8056ec6610d6f975$export$2e2bcd8739ae039","$3d37cfb473d35ef0$var$glsl","snippets","alreadyImported","substring","process","$3d37cfb473d35ef0$export$2e2bcd8739ae039","$70b12fe29b3755e8$var$Shader","shaderId","put","deleteShader","createShader","VERTEX","VERTEX_SHADER","FRAGMENT","FRAGMENT_SHADER","GEOMETRY_SHADER","shaderSource","compileShader","getShaderInfoLog","shaders","shader","GEOMETRY","$70b12fe29b3755e8$export$2e2bcd8739ae039","$00b4569a92b7ec96$var$ShaderProgram","locations","programId","_uniformSetter","deleteProgram","uniformSetter","attach","bindLocations","bindAttribLocation","getAttribLocation","getUniformLocation","getUniformBlockLocation","getUniformBlockIndex","getUniformBlockSize","uniformBlock","getActiveUniformBlockParameter","UNIFORM_BLOCK_DATA_SIZE","createUniformBlockBuffer","size","bindBufferBase","preloadLocations","link","createProgram","attachShader","linkProgram","activate","useProgram","getStatus","getProgramParameter","LINK_STATUS","getError","getProgramInfoLog","uniform1f","location","v0","uniform1fv","uniform1i","uniform1iv","uniform2f","v1","uniform2fv","uniform2i","uniform2iv","uniform3f","v2","uniform3fv","uniform3i","uniform3iv","uniform4f","v3","uniform4fv","uniform4i","uniform4iv","programs","create","vs","vsName","fs","fsName","gs","gsName","active","pgm","shaderProgram","$00b4569a92b7ec96$export$2e2bcd8739ae039","$c5d53d63ad830c04$export$2e2bcd8739ae039","textureId","width","height","targetWidth","targetHeight","rscale","wrap","mipmap","allocated","canvas","bind","createTexture","bindTexture","TEXTURE_2D","applyFilter","applyWrap","texStorage2D","RGBA8","_gl","texParameteri","TEXTURE_MIN_FILTER","NEAREST_MIPMAP_LINEAR","TEXTURE_MAG_FILTER","NEAREST","LINEAR_MIPMAP_LINEAR","LINEAR","TEXTURE_WRAP_S","REPEAT","TEXTURE_WRAP_T","MIRRORED_REPEAT","CLAMP_TO_EDGE","setFilter","setWrap","setMipmap","generateMipmap","upload","image","targetX","targetY","texSubImage2D","RGBA","UNSIGNED_BYTE","createCanvas","options","$ea6ab44f7f06a4a9$export$2e2bcd8739ae039","hidden","antialias","getCanvas","uploadCanvas","img","Image","onload","src","toDataUrl","disposeCanvas","uploadRender","render","$ea6ab44f7f06a4a9$var$Canvas","opts","background","absolute","headless","document","passThruCanvas","createElement","body","appendChild","style","left","getContext","desynchronized","preserveDrawingBuffer","alpha","stencil","$f2e6a81a3fe74b9a$export$2e2bcd8739ae039","$70a42a4582ac5be9$export$2e2bcd8739ae039","write","matrixStack","alphaStack","depthFlagStack","shaderProgramStack","transform","_globalScale","_alpha","_depthFlag","updateTransform","strokeStyle","fillStyle","resize","initGl","setBackground","parentNode","imageSmoothingEnabled","renderingContext","pushClip","popClip","setTransform","toDataURL","mime","params","beginPath","moveTo","closePath","lineTo","rect","w","h","stroke","fillRect","strokeRect","clip","quadraticCurveTo","cpx","cpy","bezierCurveTo","cx1","cy1","cx2","cy2","arc","sA","eA","cw","arcTo","x1","y1","x2","y2","fillText","maxWidth","strokeText","measureText","createImageData","getImageData","putImageData","drawImage","sw","sh","dw","dh","textureWidth","textureHeight","frameWidth","frameHeight","getBoundingClientRect","gl1","glFWrapProgram","glDefaultProgram","glBlitProgram","getAllErrors","setShaderProgram","vao0","createVertexArray","bindVertexArray","vertexAttribPointer","FLOAT","FALSE","BYTES_PER_ELEMENT","enableVertexAttribArray","clearColor","enable","DEPTH_TEST","clearDepth","depthFunc","GEQUAL","disable","DITHER","BLEND","pixelStorei","UNPACK_PREMULTIPLY_ALPHA_WEBGL","blendEquationSeparate","FUNC_ADD","blendFunc","ONE","ONE_MINUS_SRC_ALPHA","m_quad","m_texture","v_resolution","zvalue","program","time","activeTextureId","activeShader","activeTexture","TEXTURE0","uniformMatrix3fv","drawArrays","TRIANGLE_STRIP","drawRect","prepareImage","mutate","applyConfig","imageRendering","removeChild","color","backgroundColor","g","_width","_height","SCISSOR_TEST","scissor","viewport","globalScale","flipped","isFlipped","toPngBase64","_contextAttribute","lineCap","lineJoin","lineWidth","miterLimit","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","clearRect","STENCIL_BUFFER_BIT","DEPTH_BUFFER_BIT","COLOR_BUFFER_BIT","end","blit","clearPath","pushMatrix","popMatrix","pushAlpha","popAlpha","setDepthFlag","getDepthFlag","pushDepthFlag","popDepthFlag","getShaderProgram","pushShaderProgram","popShaderProgram","loadMatrix","getMatrix","appendMatrix","useNative","ellipse","ox","oy","xe","ye","xm","ym","circle","PI","line","enablePointerEvents","pointerHandler","pointerScale","pointerOffset","_","_evt","action","buttons","lbuttons","containedBy","pointerHandlers","rx","clientX","ry","clientY","dragging","ldx","ldy","ddx","ddy","onmousedown","onmouseup","onmousemove","setPointerScale","setPointerOffset","addPointerHandler","random","removePointerHandler","renderImage","draw","completed","$041013b7ee2c8fb5$export$2e2bcd8739ae039","renderer","renderImageMipmap","levels","$041013b7ee2c8fb5$var$System","KEY_DOWN","KEY_UP","POINTER_DOWN","POINTER_UP","POINTER_MOVE","POINTER_DRAG_START","POINTER_DRAG_MOVE","POINTER_DRAG_STOP","POINTER_WHEEL","assign","flags","renderingEnabled","renderingPaused","defaultOptions","overdraw","orientation","fps","minFps","screenWidth","screenHeight","extraScaleFactor","maxScaleFactor","fullscreen","offsX","offsY","devicePixelRatio","backingStoreRatio","canvasPixelRatio","canvasScaleFactor","scaleFactor","initialMatrix","displayBuffer2","displayBuffer3","tempDisplayBuffer","keyState","ctrl","alt","keyCode","pointers","updateQueue","drawQueue","timeScale","frameInterval","fixedFrameInterval","maxFrameInterval","frameDelta","frameTime","frameNumber","perf","lastTime","numFrames","numSamples","updateTimeTotal","drawTimeTotal","extraTimeTotal","frameTimeTotal","averageFps","averageUpdateTime","averageDrawTime","averageExtraTime","averageFrameTime","onresize","onWindowResized","frameTimer","delta","onFrame","pointerEvents","display0","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","onkeydown","onKeyboardEvent","KeyboardEventType","onkeyup","endTime","pointerConvX","reverseRender","pointerConvY","ontouchstart","preventDefault","touches","changedTouches","identifier","isActive","isDragging","button","wheelDelta","wheelAccum","p","onPointerEvent","PointerEventType","ontouchend","deltaTime","ontouchcancel","ontouchmove","oncontextmenu","onwheel","deltaY","which","pause","resetPerf","notRendering","_screenWidth","screen","_screenHeight","innerWidth","innerHeight","targetScreenWidth","targetScreenHeight","marginLeft","marginTop","integerScaleFactor","onCanvasResized","updateQueueAdd","updateQueueRemove","drawQueueAdd","drawQueueRemove","queueAdd","queueRemove","dt","interpolate","dst","duration","easing","interpolator","pointer","$70a42a4582ac5be9$var$Log","enabled","paused","maxsize","debugEcho","vars","msg","fontSize","showFps","showIndex","_y","ii","$f2e6a81a3fe74b9a$var$globals","debugBounds","debugMasks","rand0","rand1","rand2","px","SCALE","audioContext","AudioContext","latencyHint","sampleRate","baseLatency","fetchd","responseType","request","XMLHttpRequest","open","response","onerror","send","fetchAudioBuffer","then","arrayBuffer","decodeAudioData","audioBuffer","catch","bool","float2","float3","float4","rad","degrees","deg","radians","rand","randf","randrf","randr","round","randt","removeSubsequent","table","randtf","performance","randvar","randitem","getLineSegmentIntersection","ls1_x1","ls1_y1","ls1_x2","ls1_y2","ls2_x1","ls2_y1","ls2_x2","ls2_y2","dyA","dxA","dyB","dxB","max","tA","tB","lineSegmentIntersects","rotatePoint","stepValue","minValue","maxValue","numSteps","alignValue","FIXED_POINT_BITS","upscale","downscale","downscalef","falign","absmin","absmax","repeat","out","lpad","char","charAt","rpad","norm","snorm","clamp","x0","b0","b1","mix","$66e5219664536ce1$var$Perf","accumSize","expectedValue","lastFeed","lastUpdate","stdSum","stdCount","$66e5219664536ce1$export$2e2bcd8739ae039","begin","feed","report","avg","std","Flags","SAMPLES","MIN","MAX","AVG","EXPECTED","undefined","STDDEV","AVG_STDDEV","ALL","$0f93bc736e8cef65$var$Framebuffer","framebufferId","attachments","attachmentTypes","drawBuffers","drawBufferIds","$0f93bc736e8cef65$var$attachmentPointIds","$0f93bc736e8cef65$var$initAttachmentPointIds","createFramebuffer","MAX_ATTACHMENT_POINTS","TEXTURE","deleteTexture","deleteRenderbuffer","deleteFramebuffer","frameBufferId","attachmentPoint","texture","DEPTH","RENDERBUFFER","FRAMEBUFFER_BINDING","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","framebufferRenderbuffer","createColorBuffer","tex","createDepthBuffer","createRenderbuffer","bindRenderbuffer","renderbufferStorage","DEPTH_COMPONENT24","createStencilBuffer","DEPTH_STENCIL","getTexture","getRenderBuffer","unbind","$0f93bc736e8cef65$var$defaultDrawBuffers","isComplete","result","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","COLOR0","COLOR1","COLOR2","COLOR3","COLOR4","COLOR5","COLOR6","COLOR7","STENCIL","BACK","COLOR_ATTACHMENT0","COLOR_ATTACHMENT1","COLOR_ATTACHMENT2","COLOR_ATTACHMENT3","COLOR_ATTACHMENT4","COLOR_ATTACHMENT5","COLOR_ATTACHMENT6","COLOR_ATTACHMENT7","DEPTH_ATTACHMENT","STENCIL_ATTACHMENT","DEPTH_STENCIL_ATTACHMENT","$0f93bc736e8cef65$export$2e2bcd8739ae039","$0752c36c8a8a94fd$var$Drawable","resource","swidth","sheight","drawable","getDrawable","getImage","drawf","tx","ty","twidth","theight","fwidth","fheight","bounds","$0752c36c8a8a94fd$var$NineSlice","ss","startingIndex","spritesheet","Drawable","leftWidth","getFrame","rightWidth","midWidth","topHeight","bottomHeight","midHeight","$0752c36c8a8a94fd$var$Repeated","$0752c36c8a8a94fd$var$Clipped","$0752c36c8a8a94fd$var$Centered","$0752c36c8a8a94fd$var$Static","$0752c36c8a8a94fd$var$Group","$0752c36c8a8a94fd$var$MirrorX","$0752c36c8a8a94fd$var$MirrorY","nineSlice","repeated","clipped","centered","static","mirrorX","mirrorY","$0752c36c8a8a94fd$export$2e2bcd8739ae039","$b1048ee260d224f3$export$2e2bcd8739ae039","wrapper","$ccc7f3c7c919d669$export$2e2bcd8739ae039","$d130f4d327069d4b$var$FrameDrawable","frameIndex","$d130f4d327069d4b$export$2e2bcd8739ae039","frameCache","r_scale","v_scale","numCols","numRows","config","sheetWidth","coords","resName","ceil","frameObject","$6ad2cffd9d1b5ee6$export$c35d437ae5945fcd","seq","seq_i","n_seq","queue","frameDuration","finished","_paused","finishedCallback","finishedCallbackHandler","finishedCallbackContext","frameCallback","anim","setFps","initialDelay","onFinished","thenCallback","setFrame","normalized","getLength","loop","use","frame","advance","getSequenceName","seqName","forced","play","setQueue","lastName","$6ad2cffd9d1b5ee6$export$2e2bcd8739ae039","defaultDrawable","sharedAnim","Spritesheet","initialized","getSharedAnimation","initialseq","getAnimation","getSequence","$084a5e00ca877bf8$export$2e2bcd8739ae039","r_charWidth","charWidth","r_charHeight","charHeight","paddingX","paddingY","spacingX","spacingY","reverseDraw","cols","charset","charTable","widths","drawText","pX","measureWidth","measureHeight","$fe89a08f3d52be1f$var$Resources","$fe89a08f3d52be1f$var$reported","integerScalingEnabled","pixelated","original","load","progressCallback","completeCallback","keyList","__clone","d0","d1","dN","cb","ratio","extraScale","resizeImage","onLoaded","lastIndexOf","_i","owidth","oheight","track","plugins","NativeAudio","engine","$fb16f2790102e0ed$exports","Sound","ENGINE_NATIVEAUDIO","preloadSimple","ENGINE_WEBAUDIO","Audio","ENGINE_HTML5","oncanplaythrough","json","arraybuffer","Uint8Array","unload","__loaded","loadImage","discardOriginal","rep_x","rep_y","sp","tw","th","flipImageHorz","flipImageVert","showDownload","filename","dataUrl","href","display","download","click","showFilePicker","allowMultiple","accept","input","multiple","onchange","files","onfocus","loadAsDataURL","file","reader","FileReader","readAsDataURL","loadAsText","readAsText","loadAsArrayBuffer","readAsArrayBuffer","loadAllAsDataURL","fileList","loadNext","$fe89a08f3d52be1f$export$2e2bcd8739ae039","$90fa62f30432a965$var$Sound","volume","playLoop","MASTER","SFX","MUSIC","VOICE","MAX_POOL_SIZE","pool","node","registered","unregister","updateNode","cmd","snd","updateNode_webaudio","updateNode_nativeaudio","updateNode_audio","alloc_webaudio","gainNode","createGain","gain","connect","destination","res","createBufferSource","buffer","free_webaudio","disconnect","alloc_nativeaudio","free_nativeaudio","alloc_audio","cloneNode","_src","free_audio","playing","playTime","onended","onended_webaudio","currentTarget","onended_nativeaudio","onended_audio","currentTime","enableTrack","disableTrack","setVolume","createNode","startVolume","timer","fadeOut","setInterval","clearInterval","fadeIn","$90fa62f30432a965$export$2e2bcd8739ae039","$08892f6abacbb6ce$export$2e2bcd8739ae039","sounds","lastIndex","getRandomSound","playAt","playLoopAt","$fb16f2790102e0ed$export$f35845279390eafd","$fb16f2790102e0ed$export$922ad9063d3cdee8","$fb16f2790102e0ed$export$674d2eb4debbef0c","$fb16f2790102e0ed$export$7faa71ea66a694bb","$fb16f2790102e0ed$export$e1896ac0c4970221","$fb16f2790102e0ed$export$85990f0f98a390bb","$fb16f2790102e0ed$export$bc40a15752ef9732","$fa388e5ba5a88cdf$export$2e2bcd8739ae039","queueKeys","order","priority","is_dirty","cleanup","q","is_complete","forEachAsync","next_j","next_i","forEachRevAsync","alert","$5ad24c3b3c533f1c$var$Callback","arg0","arg1","arg2","arg3","arg4","arg5","isEqual","exec","host","$5ad24c3b3c533f1c$export$2e2bcd8739ae039","$4d8bfc31fa3d230f$var$Handler","execf","execc","$4d8bfc31fa3d230f$export$2e2bcd8739ae039","$75f7867f0ec445c4$var$Rect","Rool","extendWithPoint","centerAt","setAsUnion","intersects","_x1","_y1","_x2","_y2","setAsIntersection","topLeftRelative","resizeBy","ncx","ncy","isRight","containsPoint","tol","area","$75f7867f0ec445c4$export$2e2bcd8739ae039","$94d55b5c9afc30f7$var$TFunction","copyFrom","t0","t1","i0","y0","integral","c0","accum","second_integral","Temp1","integrate","Temp2","accumulate","chopLeft","chopRight","n1","pad","$94d55b5c9afc30f7$export$2e2bcd8739ae039","$6368899a9e534bce$var$Point2","ux","uy","upscaled","$6368899a9e534bce$export$2e2bcd8739ae039","$c7e41fee2cf6e3a0$var$Bounds2","ucx","ucy","ux1","uy1","ux2","uy2","trunc","dWidth","dHeight","isForward","$c7e41fee2cf6e3a0$export$2e2bcd8739ae039","$36e98efbc8017cce$var$Easing","Linear","IN","OUT","IN_OUT","Back","Bounce","getConst","Circ","Cubic","Expo","Power","Quad","Quartic","Quintic","Sine","Step","$36e98efbc8017cce$export$2e2bcd8739ae039","$3c0d7fe046574b0f$var$Boot","modules","startup","onStartup","shutdown","forEachAsyncRev","onShutdown","Module","$3c0d7fe046574b0f$export$2e2bcd8739ae039","$577dad4304081d73$var$system","_timeout","_interval","_span","onPaused","onResumed","onblur","fromExternalEvent","_updateTimeout","cancelTimeout","period","_updateInterval","cancelInterval","_0","_1","span","_updateSpan","cancelSpan","$577dad4304081d73$export$2e2bcd8739ae039","$df7b3efe39b649f3$var$_stamp","$df7b3efe39b649f3$var$getStamp","$df7b3efe39b649f3$var$Block","commands","isFirst","current","stamp","block","restart","isFinished","$df7b3efe39b649f3$export$2e2bcd8739ae039","$7252a2f0d16954cd$var$Command","op","started","_duration","_count","startValue","_startValue","endValue","_endValue","_cur","_last","blocks","autoInit","$7252a2f0d16954cd$export$2e2bcd8739ae039","$cd2db5a4897c8fd6$export$2e2bcd8739ae039","postinit","$b4d3731cd8fed05a$export$2e2bcd8739ae039","$8e7deb3b4664f615$export$2e2bcd8739ae039","$a8c94e89a300b635$export$2e2bcd8739ae039","setValue","getValue","$5e2ea7c2fca74706$export$2e2bcd8739ae039","$d30fbbca3dc6e914$export$2e2bcd8739ae039","$fd4753ee728f640d$export$2e2bcd8739ae039","$51108995344d7c47$export$2e2bcd8739ae039","$5b070686dcbeb863$export$2e2bcd8739ae039","$872de058ddd83b81$export$2e2bcd8739ae039","$9523965bce7c4768$export$2e2bcd8739ae039","$87700f1592e85ac3$var$Anim","initialData","blockStack","cmdStack","running","autoDispose","copyTo","initial","speed","run","fieldName","curr","initialValue","Number","prepareFieldName","parallel","serial","range","rangeTo","_bounds_x1","_bounds_y1","translateX","deltaValue","translateY","deltaValueX","deltaValueY","easingX","easingY","endValueX","endValueY","moveX","moveY","scaleX","scaleY","$87700f1592e85ac3$export$2e2bcd8739ae039","$7fb91ad676a8d6b3$var$GridElement","ext","_grid_remove_node","remover","ALIVE","VISIBLE","DIRTY","DEPTH_FLAG","alive","setId","setFlags","clearFlags","getFlags","andMask","setExt","extensionObject","getExt","arg6","arg7","arg8","arg9","visible","VISIBLE_LOCK","visibleLock","dirty","depthFlagEnabled","DEPTH_FLAG_ENABLED","depthFlag","sync","setPosition","WRAP_EXTENTS","USERDEF","LAST_FLAG","allocFlag","flag","$7fb91ad676a8d6b3$export$2e2bcd8739ae039","$776748689202dbe3$var$Grid","grid","offsx","offsy","kx","ky","stride","verifyIntersection","log2","_remove","forEachInRegion","flagsAndMask","flagsValue","j0","j1","selectInRegion","countInRegion","selectFirst","$776748689202dbe3$export$2e2bcd8739ae039","$f40c750fc020de04$var$Container","viewportBounds","scene","elementCount","drawCount","ldraw","setViewportBounds","drawElement","syncZ","__zvalue","_zvalue","depthFlagChanged","$f40c750fc020de04$export$2e2bcd8739ae039","$d4defdc7111e0d4b$var$Viewport","initialWidth","initialHeight","centerRatioX","centerRatioY","focusFactorX","focusFactorY","focusRect","focusOffsX","focusOffsY","focusAxisX","focusAxisY","padding","focusBounds","screenBounds","tmpPoint","containerWidth","containerHeight","ENABLED","setContainerBounds","updateScreenBounds","updateBounds","topLeft","TOP_LEFT","setPadding","truncateToContainer","ws","hs","setOffsets","setScale","getScale","setGlobalScale","getGlobalScale","setCenter","setScreenPosition","getX","getY","getOffsetX","getOffsetY","getWidth","getHeight","focusX","focusY","updateForced","setFocusRect","setFocusOffsets","setFocusAxes","enabledX","enabledY","setFocusFactor","valueX","valueY","applyClip","applyTransform","toWorldSpace","refX","refY","toScreenSpace","$d4defdc7111e0d4b$export$2e2bcd8739ae039","$254bd1369df89714$var$Element","_shaderProgram","GridElement","destroyLater","disposeLater","shaderChanged","getDebugColor","renderWith","renderFunction","debugColors","$254bd1369df89714$export$2e2bcd8739ae039","$3e41f12d32855284$var$tempPoint","$3e41f12d32855284$var$Group","children","Element","wrapExtents","addChild","ltranslate","getChild","_dx","_dy","getOffsets","$3e41f12d32855284$export$2e2bcd8739ae039","$5ab7719ddef2fb4d$var$Scene","minWidth","minHeight","maxHeight","containers","viewports","groupList","groups","disposalQueue","fupdater","updater","synchronizer","lupdater","destroyer","disposeQueued","setContainer","getContainer","setViewport","getViewport","addGroup","_removeGroup","removeGroup","viewportIndex","drawContainers","updateViewports","$5ab7719ddef2fb4d$export$2e2bcd8739ae039","$4bca4ca5248f01b3$var$Updater","__update","__context","__preupdate","__postupdate","_update","_sync","_destroy","preUpdate","postUpdate","$4bca4ca5248f01b3$export$2e2bcd8739ae039","$6c15c283d8e64b60$export$2e2bcd8739ae039","Container","$406b7fe2d31108f7$export$2e2bcd8739ae039","divisorX","divisorY","$ca4d09a0a1f9f59b$var$Mask","$ca4d09a0a1f9f59b$export$2e2bcd8739ae039","$9543ee6c8181f3e5$var$Label","_dirty","textWidth","textHeight","_align","_valign","textOffsetX","textOffsetY","renderText","setText","align","valign","setFont","$9543ee6c8181f3e5$export$2e2bcd8739ae039","$8a7c3aa5e6841159$export$2e2bcd8739ae039","handlers","_callOnKeyboardEvent","callOnKeyboardEvent","_action","_keyCode","_keyState","$0e65125930c826b8$export$2e2bcd8739ae039","_callOnPointerEvent","callOnPointerEvent","_p","_pointers","$482cc68f8af5a1d2$var$ScreenControls","Handler","hoverFlag","zindexFlag","lastFrame","hover","zindex","findTarget","filterHover","_ref","pointerDeactivate","pointerActivate","_refh","focusLock","pointerUpdate","keyArgs","keyboardEvents","keyDown","keyUp","$482cc68f8af5a1d2$export$2e2bcd8739ae039","$6e6eb1db0e5ead92$export$2e2bcd8739ae039","isPressed","wasPressed","unpressedImg","pressedImg","hitbox","_onButtonDown","_onButtonUp","_onTap","_onChange","Group","_default_onChange","setImage","setKeyCode","pointerX","pointerY","setStatus","updateStatus","onChange","onButtonDown","onButtonUp","onTap","$5d97cf48c80e8356$export$2e2bcd8739ae039","unpressedImgInner","pressedImgInner","angleSteps","radiusSteps","rdirx","rdiry","dirx","diry","frdirx","frdiry","fdirx","fdiry","fmagnitude","fangle","dispx","dispy","radius","maxRadius","deadZoneX","deadZoneY","limitX1","limitY1","limitX2","limitY2","renderStick","bindKeys","up","down","right","keysEnabled","setLimits","setImageInner","setAngleSteps","setRadiusSteps","setDeadZone","atan2","setDirection","freezeState","lastValid","$0c291afd56aedbbe$var$world","SCENE_MAIN","SCENE_HUD","LAYER_BG0","LAYER_BG1","LAYER_BG2","LAYER_BG3","LAYER_BG4","LAYER_MAIN","LAYER_FG0","LAYER_FG1","LAYER_FG2","LAYER_FG3","LAYER_FG4","LAYER_MASK","LAYER_HUD_BG0","LAYER_HUD_BG1","LAYER_HUD_BG2","LAYER_HUD_MAIN","LAYER_HUD_FG0","LAYER_HUD_FG1","LAYER_HUD_FG2","_scenes","activeScene","_viewports","activeViewport","activeContainer","activeGroup","lastGroup","lastElement","worldWidth","worldHeight","createScene","createViewport","selectScene","getScene","selectViewport","throwErrors","selectContainer","showMasks","allMasks","createGroup","endGroup","containerIndex","createMask","mask","createLabel","createUpdater","$0c291afd56aedbbe$export$2e2bcd8739ae039","$6b5a44b2ae07d0f3$var$r","$6b5a44b2ae07d0f3$export$2e2bcd8739ae039","$187e6cadde24f89b$var$res","total","__resIdMustNotExist","custom","drawFunction","path","images","configOptions","resOptions","animation","id1","trans","srcSeq","dstSeq","spritefont","optsA","optsB","sfx","sfxm","music","$187e6cadde24f89b$export$2e2bcd8739ae039","$7e05eb29a72f8b10$var$Gamepad","sticks","_visible","layer","addStick","outerDrawable","innerDrawable","stick","addButton","unpressedDrawable","pressedDrawable","$7e05eb29a72f8b10$export$2e2bcd8739ae039","$577f6e5b2363ecac$var$input","_gamepads","activeGamepad","lastButton","lastStick","cursor","_enabled","_handler","_element","element","native","removeProperty","_handler_callback","hthis","keyboard","keybState","createGamepad","layerIndex","selectGamepad","getGamepad","debugGamepad","$577f6e5b2363ecac$export$2e2bcd8739ae039","$ed3307f835533332$var$SUPER_TYPE_MASK","$ed3307f835533332$var$collider","FLAG_EXCLUDE","contactRules","truncationRules","maskLayer","flagsAnd","contact","v0x","v0y","v1x","v1y","v2x","v2y","w0","delta0","w1","delta1","w2","t_dx","t_dy","sceneIndex","firstUpdate","later","_run","setVisible","_setVisible","_setValue","_setFlags","_clearFlags","primaryType","secondaryType","truncate","getContactFlags","boundsA","boundsB","numFlags","Contact","TOP","BOTTOM","calc","store0","v0a","v1a","v1b","attemptSelect","swapped","load0","save1","load1","resolveXpos","single","resolveYpos","resolveYneg","resolveXneg","commit","scan","offs","collisionItems","allowsTruncation","sv","HORIZONTAL","VERTICAL","$ed3307f835533332$export$2e2bcd8739ae039","$3c88906e521b9e55$export$773cc7fa6f8304c3","$3c88906e521b9e55$export$f965ae91e38a1274","$3c88906e521b9e55$export$43caf9889c228507","$3c88906e521b9e55$export$a79e2b3ea5d10ee0","$3c88906e521b9e55$export$b7e3ae3d7c15e42e","$3c88906e521b9e55$export$5fa227701309b621","$5eaf60761b941187$export$4c85e640eb41c31b","$5eaf60761b941187$export$19342e026b58ebb7","Schema","$5eaf60761b941187$export$14416b8d99d47caa","Template","$5eaf60761b941187$export$816be348776d53c1","$5eaf60761b941187$export$7c09191825db112d","$5eaf60761b941187$export$c1b1a45ed915aad9","$5eaf60761b941187$export$e1dae5660003ffa7","$5eaf60761b941187$export$c57e9b2d8b9e4de","$5eaf60761b941187$export$a92776769f460054","$5eaf60761b941187$export$e9e0d96f49f57c33","$5eaf60761b941187$export$8d01c972ee8b14a9","$5eaf60761b941187$export$7c4f444dab5ed59","$5eaf60761b941187$export$ce30dbb46644d06c","$5eaf60761b941187$export$462bb059fed9d9e5","$5eaf60761b941187$export$cb01d642ebc0a347","$5eaf60761b941187$export$eff95f126aa67cfb","$5eaf60761b941187$export$5431306cf43de24a","$5eaf60761b941187$export$573ab5fe783d8aac","$5eaf60761b941187$export$e9a269813a6315a4","$5eaf60761b941187$export$85990f0f98a390bb","$5eaf60761b941187$export$fe264c04f294fd15","$5eaf60761b941187$export$1034c64782e66715","$5eaf60761b941187$export$54c2e3dc7acea9f5","$5eaf60761b941187$export$8fbd1ac8e83536df","$5eaf60761b941187$export$a428cd33b25d5283","$5eaf60761b941187$export$5b12bf1653c0dd85","$5eaf60761b941187$export$c79fc6492f3af13d","$5eaf60761b941187$export$ac4bca90992eed1","$5eaf60761b941187$export$c9b44e90c5031de0","$5eaf60761b941187$export$3dc3622b48e72adc","$5eaf60761b941187$export$79f93ddd76e66d40","$5eaf60761b941187$export$cea96571ebbff9dd","$5eaf60761b941187$export$deefd61317ad2797","$5eaf60761b941187$export$5a2130c936f86fb8","$5eaf60761b941187$export$cfb3877ce19bb838","$5eaf60761b941187$export$ef2184bd89960b14","$5eaf60761b941187$export$38af1803e3442a7f","$5eaf60761b941187$export$d5c6c08dc2d3ca7","$5eaf60761b941187$export$3386beb5bc3bfa","$5eaf60761b941187$export$42a852a2b6b56249","$5eaf60761b941187$export$eeaa45a7d92663a6","$5eaf60761b941187$export$cc55614734af2d87","$5eaf60761b941187$export$eb2fcfdbd7ba97d4","$5eaf60761b941187$export$f35845279390eafd","$5eaf60761b941187$export$db77ccec0bb4ccac","$5eaf60761b941187$export$991dcf7284de63d","$5eaf60761b941187$export$b04be29aa201d4f5","$5eaf60761b941187$export$474b8119f9aaf6a9","$5eaf60761b941187$export$63d5558963a08ef6","$5eaf60761b941187$export$f9b7ad1c9b000a93","$5eaf60761b941187$export$353f5b6fc5456de1","$5eaf60761b941187$export$85a6520672683043","$5eaf60761b941187$export$2e2bcd8739ae039","$3c88906e521b9e55$exports","froxel","globals","glx","glsl","System","Timer","Random","KeyCode","Canvas","Perf","Log","Shader","ShaderProgram","Framebuffer","Texture","Wrappers","Resources","Linkable","List","PriorityQueue","Matrix","Rect","Vec2","TFunction","Bounds2","Point2","Easing","Anim","Boot","Grid","Scene","Viewport","Updater","SimpleContainer","GridContainer","Mask","Label","KeyboardHandler","PointerHandler","ScreenControls","Button","Stick","fxl"],"version":3,"file":"froxel.js.map"}