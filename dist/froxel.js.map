{"mappings":"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","sources":["../../../Users/Master/AppData/Local/Yarn/Data/global/node_modules/@parcel/scope-hoisting/lib/helpers.js","./src/system/config.js","./src/system/globals.js","./src/system/keycodes.js","./node_modules/@rsthn/rin/alpha.js","./node_modules/@rsthn/rin/main.js","./node_modules/@rsthn/rin/class.js","./node_modules/@rsthn/rin/event.js","./node_modules/@rsthn/rin/event-dispatcher.js","./node_modules/@rsthn/rin/model.js","./node_modules/@rsthn/rin/model-regex.js","./node_modules/@rsthn/rin/model-constraints.js","./node_modules/@rsthn/rin/model-list.js","./node_modules/@rsthn/rin/schema.js","./node_modules/@rsthn/rin/flattenable.js","./node_modules/@rsthn/rin/collection.js","./node_modules/@rsthn/rin/template.js","./src/utils/recycler.js","./src/utils/linkable.js","./src/utils/list.js","./src/system/timer.js","./src/math/matrix.js","./src/system/log.js","./src/system/canvas.js","./src/system/system.js","./src/system/perf.js","./src/system/idrawable.js","./src/system/iupdateable.js","./src/resources/resources.js","./src/resources/drawable.js","./src/resources/placeholder.js","./src/resources/spritesheet.js","./src/resources/spritesheet-animation.js","./src/resources/spritefont.js","./src/resources/sound.js","./src/resources/sound-array.js","./src/resources/wrappers.js","./src/utils/priority-queue.js","./src/math/rect.js","./src/math/vec2.js","./src/math/tfunction.js","./src/anim/easing.js","./src/anim/anim.js","./src/spatial/quadtree-item.js","./src/spatial/quadtree-node.js","./src/spatial/quadtree.js","./src/flow/boot.js","./src/flow/element.js","./src/flow/container.js","./src/flow/viewport.js","./src/flow/scene.js","./src/flow/group.js","./src/flow/keyboard-handler.js","./src/flow/pointer-handler.js","./src/flow/screen-controls.js","./src/flow/button.js","./src/main.js","./src/_export.js"],"sourcesContent":["var $parcel$global =\n  typeof globalThis !== 'undefined'\n    ? globalThis\n    : typeof self !== 'undefined'\n    ? self\n    : typeof window !== 'undefined'\n    ? window\n    : typeof global !== 'undefined'\n    ? global\n    : {};\n\nfunction $parcel$interopDefault(a) {\n  return a && a.__esModule ? a.default : a;\n}\n\nfunction $parcel$defineInteropFlag(a) {\n  Object.defineProperty(a, '__esModule', {value: true});\n}\n\nfunction $parcel$export(e, n, v) {\n  Object.defineProperty(e, n, {get: v, enumerable: true});\n}\n\nfunction $parcel$exportWildcard(dest, source) {\n  Object.keys(source).forEach(function(key) {\n    if (key === 'default' || key === '__esModule') {\n      return;\n    }\n\n    Object.defineProperty(dest, key, {\n      enumerable: true,\n      get: function get() {\n        return source[key];\n      },\n    });\n  });\n\n  return dest;\n}\n\nfunction $parcel$missingModule(name) {\n  var err = new Error(\"Cannot find module '\" + name + \"'\");\n  err.code = 'MODULE_NOT_FOUND';\n  throw err;\n}\n","/*\n**\tsystem/config.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tContains configuration constants. Can be extended as needed from other modules.\n*/\n\nexport default\n{\n\tFPS:\t\t\t\t\t60,\n\tANTIALIAS:\t\t\t\tfalse,\n\tBACKGROUND:\t\t\t\t'#000',\n\n\tORIENTATION:\t\t\t0,\n\tWIDTH: \t\t\t\t\t360,\n\tHEIGHT: \t\t\t\t640,\n\n\tORIGINAL_TILE_SIZE:\t\t32,\n\tTILE_SIZE: \t\t\t\t64,\n\n\tBOARD_WIDTH:\t\t\t10,\n\tBOARD_HEIGHT:\t\t\t5,\n\n\tSCALE:\t\t\t\t\t1,\n\n\tinit: function ()\n\t{\n\t\tthis.SCALE = this.TILE_SIZE / this.ORIGINAL_TILE_SIZE;\n\t}\n};\n","/*\n**\tsystem/globals.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport C from './config';\n\n/*\n**\tGlobal functions and definitions.\n*/\n\n/*\n**\tVariables and behavior flags, can be extended as needed from other modules.\n*/\nexport default\n{\n\tarea: null,\n\tviewport: null,\n\n\tdebugHitbox: false,\n\tdebugBounds: false,\n\tdebugImage: false\n};\n\n\n/*\n**\tConverts the given pixel-value to actual screen pixels taking into account the current scale.\n**\n**\t>> float px (float value);\n*/\nglobal.px = function(value)\n{\n\treturn value*C.SCALE;\n};\n\n\n/*\n**\tDisposes an object, first by checking if it has a 'dispose' method, and if not, tried to check\n**\twith a '__dtor' method.\n**\n**\t>> dispose (object obj, string reason);\n**\t>> dispose (object obj);\n*/\nglobal.dispose = function (obj, reason)\n{\n\tif (!obj) return;\n\n\tif ('dispose' in obj)\n\t{\n\t\tobj.dispose(reason);\n\t\treturn;\n\t}\n\n\tif ('__dtor' in obj) obj.__dtor();\n};\n\n\n/*\n**\tCreates a global AudioContext if supported.\n*/\nif ('AudioContext' in global)\n\tglobal.audioContext = new AudioContext();\nelse\n\tglobal.audioContext = null;\n\n\n/*\n**\tSimilar to fetch() but uses XMLHttpRequest, as in some mobile browsers normal mode does not work well for ArrayBuffers.\n**\n**\t>> Promise fetchd (string url, object options);\n**\t>> Promise fetchd (string url);\n*/\nglobal.fetchd = function (url, options)\n{\n\treturn new Promise ((resolve, reject) =>\n\t{\n\t\tif (!options) options = { };\n\t\tif (!('responseType' in options)) options.responseType = 'arraybuffer';\n\n\t\tvar request = new XMLHttpRequest();\n\t\trequest.open('GET', url, true);\n\n\t\tfor (var i in options) request[i] = options[i];\n\n\t\trequest.onload = function() {\n\t\t\tresolve (request.response);\n\t\t};\n\n\t\trequest.onerror = function() {\n\t\t\treject ('Unable to fetch specified resource.');\n\t\t};\n\n\t\trequest.send();\n\t});\n};\n\n\n/*\n**\tLoads an arraybuffer from the specified URL and converts it to a AudioBuffer using the global audioContext.\n**\n**\t>> Promise fetchAudioBuffer (string url);\n*/\nglobal.fetchAudioBuffer = function (url)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tif (!global.audioContext)\n\t\t{\n\t\t\treject ('AudioContext is not available.');\n\t\t\treturn;\n\t\t}\n\n\t\tfetchd(url)\n\t\t.then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))\n\t\t.then(audioBuffer => resolve(audioBuffer))\n\t\t.catch(err => reject(err));\n\t});\n};\n\n\n/*\n**\tReturns the value as an integer.\n**\n**\tint int (T value);\n*/\nglobal.int = function (value)\n{\n\treturn ~~value;\n};\n\n\n/*\n**\tReturns the value as a boolean.\n**\n**\tbool bool (T value);\n*/\nglobal.bool = function (value)\n{\n\tif (value === true || value === false)\n\t\treturn value;\n\n\tif (value == 'true')\n\t\treturn true;\n\n\tif (value == 'false')\n\t\treturn false;\n\n\treturn !(!value);\n};\n\n\n/*\n**\tReturns the value as a floating point number.\n**\n**\tfloat float (T value);\n*/\nglobal.float = function (value)\n{\n\treturn parseFloat(value);\n};\n\n\n/*\n**\tReturns the value with 2 digits of precision.\n**\n**\tfloat float2 (float value);\n*/\nglobal.float2 = function (value)\n{\n\treturn (~~(value*100))/100;\n};\n\n\n/*\n**\tReturns the value with 3 digits of precision.\n**\n**\tfloat float3 (float value);\n*/\nglobal.float3 = function (value)\n{\n\treturn (~~(value*1000))/1000;\n};\n\n\n/*\n**\tReturns the value with 4 digits of precision.\n**\n**\tfloat float4 (float value);\n*/\nglobal.float4 = function (value)\n{\n\treturn (~~(value*10000))/10000;\n};\n\n\n/*\n**\tConverts the given value to radians.\n**\n**\tfloat rad (float value);\n*/\nglobal.rad = function (value)\n{\n\treturn value*Math.PI / 180;\n};\n\n\n/*\n**\tReturns a random integer value from 0 to 0xFFFF (inclusive).\n**\n**\tint rand ();\n*/\nglobal.rand = function ()\n{\n\treturn int(Math.random()*0x10000);\n};\n\n\n/*\n**\tReturns a random float from 0 to 1 (non-inclusive).\n**\n**\tfloat randf ();\n*/\nglobal.randf = function ()\n{\n\treturn Math.random();\n};\n\n\n/*\n**\tReturns a random float within the given (non-inclusive) range.\n**\n**\tfloat randrf (float a, float b);\n*/\nglobal.randrf = function (a, b)\n{\n\tlet t = Math.random();\n\treturn t*b + (1-t)*a;\n};\n\n\n/*\n**\tReturns a random integer within the given range (inclusive).\n**\n**\tint randr (int a, int b);\n*/\nglobal.randr = function (a, b)\n{\n\tlet t = Math.random();\n\treturn ~~(t*b + (1-t)*a);\n};\n\n\n/*\n**\tReturns a table of random float numbers within the given range (non-inclusive).\n**\n**\tarray randtf (float a, float b, int n);\n*/\nglobal.randtf = function (a, b, n)\n{\n\tvar list = [ ];\n\n\tfor (var i = 0; i < n; i++)\n\t\tlist.push(randrf(a, b));\n\n\treturn list;\n};\n\n\n/*\n**\tReturns the high-resolution 'now' counter in milliseconds.\n**\n**\tint hrnow();\n*/\nglobal.hrnow = function ()\n{\n\treturn ~~performance.now();\n};\n\n\n/*\n**\tReturns a function that produces a random integer value within the given (inclusive) range.\n**\n**\tfunction randvar (int a, int b);\n*/\nglobal.randvar = function (a, b)\n{\n\treturn function() { return randr(a, b); };\n};\n\n\n/*\n**\tReturns a function that returns an item from the specified array at some random index within the\n**\tgiven inclusive range.\n**\n**\tfunction randitem (array arr, int a, int b);\n**\tfunction randitem (array arr, int a);\n**\tfunction randitem (array arr);\n*/\nglobal.randitem = function (arr, a, b)\n{\n\tif (!a) a = 0;\n\tif (!b) b = arr.length - 1;\n\n\treturn function() { return arr[randr(a, b)]; };\n};\n\n\n/*\n**\tReturns the parameter 't' where two line segments intersect.\n**\n**\tfloat getLineSegmentIntersection (float ls1_x1, float ls1_y1, float ls1_x2, float ls1_y2, float ls2_x1, float ls2_y1, float ls2_x2, float ls2_y2);\n*/\nglobal.getLineSegmentIntersection = function (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2)\n{\n\t// Case #1: Identical segments.\n\tif (ls1_x1 == ls2_x1 && ls1_y1 == ls2_y1 && ls1_x2 == ls2_x2 && ls1_y2 == ls2_y2)\n\t\treturn 0;\n\n\tlet inf = 2.0;\n\n\tvar dyA = ls1_y2 - ls1_y1;\n\tvar dxA = ls1_x2 - ls1_x1;\n\tvar dyB = ls2_y2 - ls2_y1;\n\tvar dxB = ls2_x2 - ls2_x1;\n\n\t// Case #2: Horizontal vs. Horizontal\n\tif (dyA == 0 && dyB == 0)\n\t{\n\t\tif (ls1_y1 != ls2_y1) return inf;\n\n\t\tvar x1 = Math.max(ls1_x1, ls2_x1);\n\t\tvar x2 = Math.min(ls1_x2, ls2_x2);\n\n\t\tif (x1 > x2) return inf;\n\n\t\treturn (x1 - ls1_x1) / dxA;\n\t}\n\n\t// Case #3: Vertical vs. Vertical\n\tif (dxA == 0 && dxB == 0)\n\t{\n\t\tif (ls1_x1 != ls2_x1) return inf;\n\n\t\tvar y1 = Math.max(ls1_y1, ls2_y1);\n\t\tvar y2 = Math.min(ls1_y2, ls2_y2);\n\n\t\tif (y1 > y2) return inf;\n\n\t\treturn (y1 - ls1_y1) / dyA;\n\t}\n\n\t// Case #4: Vertical vs. Horizontal or Sloped\n\tif (dxA == 0)\n\t{\n\t\tvar tA = (dyB*(ls1_x1 - ls2_x1) + dxB*(ls2_y1 - ls1_y1)) / (dxB * dyA);\n\t\tif (0 > tA || tA > 1) return inf;\n\n\t\tvar tB = (ls1_x1 - ls2_x1) / dxB; \n\t\tif (0 > tB || tB > 1) return inf;\n\n\t\treturn tA;\n\t}\n\n\t// Case #5: Regular line segments.\n\tvar a = dyA*(ls2_x1 - ls1_x1) + dxA*(ls1_y1 - ls2_y1);\n\tvar b = dyB*dxA - dxB*dyA;\n\n\tif (b == 0) return inf;\n\n\tvar tB = a / b;\n\tif (0 > tB || tB > 1) return inf;\n\n\tvar tA = (dxB*tB + ls2_x1 - ls1_x1) / dxA;\n\tif (0 > tA || tA > 1) return inf;\n\n\treturn tA;\n};\n\n\n/*\n**\tReturns boolean if the line segments intersect.\n**\n**\tbool lineSegmentIntersects (float ls1_x1, float ls1_y1, float ls1_x2, float ls1_y2, float ls2_x1, float ls2_y1, float ls2_x2, float ls2_y2);\n*/\nglobal.lineSegmentIntersects = function (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2)\n{\n\tlet t = getLineSegmentIntersection (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2);\n\treturn t >= 0 && t <= 1.0;\n};\n\n/*\n**\tRotates a point (2d) by the given angle and returns an object.\n**\n**\t>> Object{x,y} rotatePoint (Object{x,y} angle, x, y);\n**\t>> Object{x,y} rotatePoint (float angle, x, y);\n*/\nglobal.rotatePoint = function (angle, x, y)\n{\n\tif (Rin.typeOf(angle) == \"object\")\n\t\treturn { x: x*angle.x + y*angle.y, y: y*angle.x - x*angle.y };\n\telse\n\t\treturn { x: x*Math.cos(angle) + y*Math.sin(angle), y: y*Math.cos(angle) - x*Math.sin(angle) };\n};\n\n\n/*\n**\tReturns a value snapped to a step within the given range.\n**\n**\tfloat stepValue (float value, float minValue, float maxValue, int numSteps);\n*/\nglobal.stepValue = function (value, minValue, maxValue, numSteps)\n{\n\treturn ((Math.round(numSteps * (value - minValue) / (maxValue - minValue))) / numSteps) * (maxValue - minValue) + minValue;\n};\n\n\n/*\n**\tReturns a value that is a factor of the specified step.\n**\n**\tfloat alignValue (float value, float step);\n*/\nglobal.alignValue = function (value, step)\n{\n\treturn Math.round(value/step)*step;\n};\n","/*\n**\tsystem/keycodes.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nexport default\n{\n\tBACKSPACE: 8,\n\tTAB: 9,\n\tENTER: 13,\n\tESC: 27,\n\tSPACE: 32,\n\n\tPGUP: 33,\n\tPGDN: 34,\n\n\tEND: 35,\n\tHOME: 36,\n\n\tINS: 45,\n\tDEL: 46,\n\n\tLEFT: 37,\n\tUP: 38,\n\tRIGHT: 39,\n\tDOWN: 40,\n\n\tNUM_PLUS: 107,\n\tNUM_MINUS: 109,\n\tNUM_ASTERISK: 106,\n\tNUM_SLASH: 111,\n\tNUM_DOT: 110,\n\n\tNUM_0: 96,\n\tNUM_1: 97,\n\tNUM_2: 98,\n\tNUM_3: 99,\n\tNUM_4: 100,\n\tNUM_5: 101,\n\tNUM_6: 102,\n\tNUM_7: 103,\n\tNUM_8: 104,\n\tNUM_9: 105,\n\n\tD0: 48,\n\tD1: 49,\n\tD2: 50,\n\tD3: 51,\n\tD4: 52,\n\tD5: 53,\n\tD6: 54,\n\tD7: 55,\n\tD8: 56,\n\tD9: 57,\n\n\tA: 65,\tB: 66,\tC: 67,\tD: 68,\tE: 69,\tF: 70,\tG: 71,\tH: 72,\tI: 73,\tJ: 74,\tK: 75,\tL: 76,\tM: 77,\tN: 78,\n\tO: 79,\tP: 80,\tQ: 81,\tR: 82,\tS: 83,\tT: 84,\tU: 85,\tV: 86,\tW: 87,\tX: 88,\tY: 89,\tZ: 90\n};\n","/*\r\n**\trin/alpha\r\n**\r\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nlet Rin = module.exports = { };\r\n\r\n/**\r\n**\tInvokes the specified function 'fn' 10ms later.\r\n**\r\n**\t>> void invokeLater (function fn);\r\n*/\r\nRin.invokeLater = function (fn)\r\n{\r\n\tif (fn) setTimeout (function() { fn(); }, 10);\r\n};\r\n\r\n\r\n/**\r\n**\tWaits for the specified amount of milliseconds. Returns a Promise.\r\n**\r\n**\t>> Promise wait (int millis);\r\n*/\r\nRin.wait = function (millis)\r\n{\r\n\treturn new Promise(function (resolve, reject) {\r\n\t\tsetTimeout (resolve, millis);\r\n\t});\r\n};\r\n\r\n\r\n/**\r\n**\tReturns the type of an element 'o', properly detects arrays and null types. The return string is always in lowercase.\r\n**\r\n**\t>> string typeOf (any o);\r\n*/\r\nRin.typeOf = function (o)\r\n{\r\n\tif (o instanceof Array)\r\n\t\treturn \"array\";\r\n\r\n\tif (o === null)\r\n\t\treturn \"null\";\r\n\r\n\treturn (typeof(o)).toString().toLowerCase();\r\n};\r\n\r\n\r\n/**\r\n**\tReturns boolean indicating if the type of the element is an array or an object.\r\n**\r\n**\t>> bool isArrayOrObject (any o);\r\n*/\r\nRin.isArrayOrObject = function (o)\r\n{\r\n\tswitch (Rin.typeOf(o))\r\n\t{\r\n\t\tcase \"array\": case \"object\":\r\n\t\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\n\r\n/**\r\n**\tCreates a clone (deep copy) of the specified element. The element can be an array, an object or a primitive type.\r\n**\r\n**\t>> T clone (T elem);\r\n*/\r\nRin.clone = function (elem)\r\n{\r\n\tvar o;\r\n\r\n\tif (Rin.typeOf(elem) == \"array\")\r\n\t{\r\n\t\to = [ ];\r\n\r\n\t\tfor (let i = 0; i < elem.length; i++)\r\n\t\t\to.push (Rin.clone(elem[i]));\r\n\t}\r\n\telse if (Rin.typeOf(elem) == \"object\")\r\n\t{\r\n\t\to = { };\r\n\r\n\t\tfor (let i in elem)\r\n\t\t\to[i] = Rin.clone(elem[i]);\r\n\t}\r\n\telse\r\n\t{\r\n\t\to = elem;\r\n\t}\r\n\r\n\treturn o;\r\n};\r\n\r\n\r\n/**\r\n**\tMerges all given elements into the first one, object fields are cloned.\r\n**\r\n**\t>> T merge (T... elems)\r\n*/\r\nRin.merge = function (output, ...objs)\r\n{\r\n\tif (Rin.typeOf(output) == \"array\")\r\n\t{\r\n\t\tfor (let i = 0; i < objs.length; i++)\r\n\t\t{\r\n\t\t\tlet arr = objs[i];\r\n\r\n\t\t\tif (Rin.typeOf(arr) != \"array\")\r\n\t\t\t{\r\n\t\t\t\toutput.push(arr);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tfor (let j = 0; j < arr.length; j++)\r\n\t\t\t\t{\r\n\t\t\t\t\toutput.push(Rin.clone(arr[j]));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse if (Rin.typeOf(output) == \"object\")\r\n\t{\r\n\t\tfor (let i = 0; i < objs.length; i++)\r\n\t\t{\r\n\t\t\tlet obj = objs[i];\r\n\t\t\tif (Rin.typeOf(obj) != \"object\") continue;\r\n\r\n\t\t\tfor (let field in obj)\r\n\t\t\t{\r\n\t\t\t\tif (Rin.isArrayOrObject(obj[field]))\r\n\t\t\t\t{\r\n\t\t\t\t\tif (field in output)\r\n\t\t\t\t\t\tRin.merge(output[field], obj[field]);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\toutput[field] = Rin.clone(obj[field]);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\toutput[field] = obj[field];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn output;\r\n};\r\n\r\n\r\n/**\r\n**\tAssigns all fields from the specified objects into the first one.\r\n**\r\n**\t>> object override (object output, object... objs)\r\n*/\r\nRin.override = function (output, ...objs)\r\n{\r\n\tfor (let i = 0; i < objs.length; i++)\r\n\t{\r\n\t\tfor (let j in objs[i])\r\n\t\t{\r\n\t\t\toutput[j] = objs[i][j];\r\n\t\t}\r\n\t}\r\n\r\n\treturn output;\r\n};\r\n\r\n\r\n/*\r\n**\tCompares two objects and returns `true` if all properties in \"partial\" find a match in \"full\".\r\n*/\r\nRin.partialCompare = function (full, partial)\r\n{\r\n\tif (full == null || partial == null) return false;\r\n\r\n\tif (full === partial)\r\n\t\treturn true;\r\n\r\n\tfor (var i in partial)\r\n\t{\r\n\t\tif (full[i] != partial[i])\r\n\t\t\treturn false;\r\n\t}\r\n\r\n\treturn true;\r\n};\r\n\r\n\r\n/*\r\n**\tPerforms a partial search for an object (o) in the specified array and returns its index or `false` if the\r\n**\tobject was not found. When `getObject` is set to `true` the object will be returned instead of an index, or\r\n**\t`null` if not found.\r\n*/\r\nRin.arrayFind = function (arr, o, getObject)\r\n{\r\n\tfor (var i = 0; arr && i < arr.length; i++)\r\n\t{\r\n\t\tif (this.partialCompare (arr[i], o))\r\n\t\t\treturn getObject ? arr[i] : i;\r\n\t}\r\n\r\n\treturn getObject ? null : false;\r\n};\r\n\r\n\r\n/*\r\n**\tTraverses the given object attempting to find the index/key that does an identical match with the specified value,\r\n**\tif not found returns -1, otherwise the index/key where the value was found.\r\n**\r\n**\t>> int indexOf (array container, T value)\r\n**\t>> string indexOf (object container, T value)\r\n*/\r\nRin.indexOf = function (container, value, forceArray=false)\r\n{\r\n\tif (forceArray)\r\n\t{\r\n\t\tfor (let i = 0; i < container.length; i++)\r\n\t\t{\r\n\t\t\tif (container[i] === value)\r\n\t\t\t\treturn i;\r\n\t\t}\r\n\t\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tfor (let i in container)\r\n\t{\r\n\t\tif (container[i] === value)\r\n\t\t\treturn i;\r\n\t}\r\n\r\n\treturn -1;\r\n};\r\n\r\n\r\n/**\r\n**\tEscapes a string using HTML entities.\r\n**\r\n**\t>> string escape (string str);\r\n*/\r\nRin.escape = function (str)\r\n{\r\n\treturn (str+\"\").replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\r\n};\r\n\r\n\r\n/**\r\n**\tVerifies if the specified object is of class `m`, if not it will create a new instance of `m` passing `o` as parameter.\r\n**\r\n**\t>> object ensureTypeOf (class m, object o);\r\n*/\r\nRin.ensureTypeOf = function (m, o)\r\n{\r\n\tif (!o || !m || o instanceof m)\r\n\t\treturn o;\r\n\r\n\tif (o.isInstanceOf && m.prototype.className)\r\n\t{\r\n\t\tif (o.isInstanceOf (m.prototype.className))\r\n\t\t\treturn o;\r\n\t}\r\n\r\n\treturn new m (o);\r\n};\r\n\r\n\r\n/**\r\n**\tVerifies if the specified object is of class `m`, returns boolean.\r\n**\r\n**\t>> bool isTypeOf (class m, object o);\r\n*/\r\nRin.isTypeOf = function (m, o)\r\n{\r\n\tif (!o || !m || o instanceof m)\r\n\t\treturn true;\r\n\r\n\tif (o.isInstanceOf && m.prototype.className)\r\n\t{\r\n\t\tif (o.isInstanceOf (m.prototype.className))\r\n\t\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\n\r\n/**\r\n**\tSerializes an object and returns its JSON string representation.\r\n**\r\n**\t>> string serialize (object o);\r\n*/\r\nRin.serialize = function (o)\r\n{\r\n\treturn JSON.stringify(o);\r\n};\r\n\r\n\r\n/**\r\n**\tDeserializes a string in JSON format and returns the result.\r\n**\r\n**\t>> any deserialize (string s);\r\n*/\r\nRin.deserialize = function (s)\r\n{\r\n\treturn JSON.parse(s);\r\n};\r\n\r\n\r\n/**\r\n**\tChains a new function to an existing one on some object, such that invoking the function on the object will cause\r\n**\tboth functions to run (order would be oldFunction then newFunction).\r\n**\r\n**\tIf the `conditional` flag is set to `true`, the second function will be run only if the first one returns non-false.\r\n**\tReturns an object with a single method 'unhook' which will revert the changes to leave only the original function.\r\n**\r\n**\t>> object{function unhook} hook (Object object, String functionName, function newFunction, bool conditional=false);\r\n*/\r\nRin.hookAppend = function (object, functionName, newFunction, conditional=true)\r\n{\r\n\tconst oldFunction = object[functionName];\r\n\r\n\tif (conditional)\r\n\t{\r\n\t\tobject[functionName] = function (...args) {\r\n\t\t\tif (oldFunction.apply (this, args) !== false)\r\n\t\t\t\treturn newFunction.apply (this, args);\r\n\t\t};\r\n\t}\r\n\telse\r\n\t{\r\n\t\tobject[functionName] = function (...args) {\r\n\t\t\toldFunction.apply (this, args);\r\n\t\t\treturn newFunction.apply (this, args);\r\n\t\t};\r\n\t}\r\n\r\n\treturn { \r\n\t\tunhook: function() {\r\n\t\t\tobject[functionName] = oldFunction;\r\n\t\t}\r\n\t};\r\n};\r\n\r\n\r\n/**\r\n**\tChains a new function to an existing one on some object, such that invoking the function on the object will cause\r\n**\tboth functions to run (order would be oldFunction then newFunction).\r\n**\r\n**\tIf the `conditional` flag is set to `true`, the second function will be run only if the first one returns non-false.\r\n**\tReturns an object with a single method 'unhook' which will revert the changes to leave only the original function.\r\n**\r\n**\t>> object{function unhook} hook (Object object, String functionName, function newFunction, bool conditional=false);\r\n*/\r\nRin.hookPrepend = function (object, functionName, newFunction, conditional=true)\r\n{\r\n\tconst oldFunction = object[functionName];\r\n\r\n\tif (conditional)\r\n\t{\r\n\t\tobject[functionName] = function (...args) {\r\n\t\t\tif (newFunction.apply (this, args) !== false)\r\n\t\t\t\treturn oldFunction.apply (this, args);\r\n\t\t};\r\n\t}\r\n\telse\r\n\t{\r\n\t\tobject[functionName] = function (...args) {\r\n\t\t\tnewFunction.apply (this, args);\r\n\t\t\treturn oldFunction.apply (this, args);\r\n\t\t};\r\n\t}\r\n\r\n\treturn { \r\n\t\tunhook: function() {\r\n\t\t\tobject[functionName] = oldFunction;\r\n\t\t}\r\n\t};\r\n};\r\n","/*\r\n**\trin/main\r\n**\r\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nlet Rin = require('./alpha');\r\n\r\nRin.Rin = Rin;\r\nRin.Class = require('./class');\r\n\r\nRin.Event = require('./event');\r\nRin.EventDispatcher = require('./event-dispatcher');\r\n\r\nRin.Model = require('./model');\r\nRin.ModelList = require('./model-list');\r\n\r\nRin.Schema = require('./schema');\r\nRin.Flattenable = require('./flattenable');\r\nRin.Collection = require('./collection');\r\n\r\nRin.Template = require('./template');\r\n\r\n/* ---- */\r\nObject.assign (module.exports, Rin);\r\n","/*\r\n**\trin/class\r\n**\r\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nlet Rin = require('./alpha');\r\n\r\n/**\r\n**\tBase class used to easily create classes and sub-classes with complex multiple inheritance and\r\n**\tsupport for calls to parent class methods.\r\n*/\r\n\r\nlet Class = module.exports = function ()\r\n{\r\n};\r\n\r\n\r\n/**\r\n**\tReference to the class itself.\r\n*/\r\nClass._class = Class;\r\n\r\n\r\n/**\r\n**\tContains the methods of each of the super classes.\r\n*/\r\nClass._super = { };\r\n\r\n\r\n/**\r\n**\tName of the class, if none specified the class will be considered \"final\" and will not be inheritable.\r\n*/\r\nClass.prototype.className = \"Class\";\r\n\r\n\r\n/**\r\n**\tClass constructor, should initialize the state of the instance. Invoked when the `new` keyword is used with the class.\r\n*/\r\nClass.prototype.__ctor = function ()\r\n{\r\n};\r\n\r\n\r\n/**\r\n**\tClass destructor, should clear the instance state and release any used resources, invoked when the global `dispose`\r\n**\tfunction is called with the instance as parameter.\r\n*/\r\nClass.prototype.__dtor = function ()\r\n{\r\n};\r\n\r\n\r\n/**\r\n**\tReturns true if the object is an instance of the specified class (verifies inheritance), the parameter can be a class\r\n**\tname, a class constructor or a class instance, in any case the appropriate checks will be done.\r\n**\r\n**\t>> bool isInstanceOf (string className);\r\n**\t>> bool isInstanceOf (constructor classConstructor);\r\n**\t>> bool isInstanceOf (object classInstance);\r\n*/\r\nClass.prototype.isInstanceOf = function (className)\r\n{\r\n\tclassName = Rin.typeOf(className) == \"string\" ? className : (className.prototype ? className.prototype.className : className.constructor.prototype.className);\r\n\treturn className in this._super ? true : this.className == className;\r\n};\r\n\r\n\r\n/**\r\n**\tInternal method to ensure the _super field of an instance is ready to be used.\r\n**\r\n**\t>> void _initSuperRefs ();\r\n*/\r\nClass.prototype._initSuperRefs = function ()\r\n{\r\n\tvar _super = this.constructor._super;\r\n\tvar _newSuper = { };\r\n\r\n\tfor (let i in _super)\r\n\t{\r\n\t\tlet o = { };\r\n\r\n\t\tlet _prot = _super[i].prototype;\r\n\t\tfor (let j in _prot)\r\n\t\t{\r\n\t\t\tif (Rin.typeOf(_prot[j]) == \"function\")\r\n\t\t\t\to[j] = _prot[j].bind(this);\r\n\t\t}\r\n\r\n\t\t_newSuper[i] = o;\r\n\t}\r\n\r\n\tthis._super = _newSuper;\r\n};\r\n\r\n\r\n/**\r\n**\tExtends the class with the specified prototype. The prototype can be a function (class constructor) or an object. Note that the\r\n**\tclass will be modified (and returned) instead of creating a new class. Must be called at the class-level (**not** instance level).\r\n**\tWhen a class is provided all fields starting with uppercase at the class-level will not be inherited, this is used to create constants\r\n**\ton classes without having them to be copied to derived classes.\r\n**\r\n**\t>> class inherit (constructor classConstructor);\r\n**\t>> class inherit (object obj);\r\n*/\r\nClass.inherit = function (proto)\r\n{\r\n\tvar self = this._class;\r\n\r\n\tvar _super = self._super;\r\n\tvar _class = self._class;\r\n\r\n\tif (Rin.typeOf(proto) == \"function\")\r\n\t{\r\n\t\t// Move constants (uppercased properties) to the class-level instead of prototype-level.\r\n\t\tfor (let i in proto._class)\r\n\t\t\tif (!/^[A-Z]/.test(i)) self[i] = proto._class[i];\r\n\r\n\t\t// Combine methods and properties.\r\n\t\tRin.override (self.prototype, proto._class.prototype);\r\n\r\n\t\t// Combine super methods.\r\n\t\tRin.override (_super, proto._class._super);\r\n\r\n\t\t// Add new super reference if className specified in inherited prototypes.\r\n\t\tif (proto._class.prototype.className)\r\n\t\t\t_super[proto._class.prototype.className] = proto._class;\r\n\t}\r\n\telse\r\n\t{\r\n\t\tRin.override (self.prototype, proto);\r\n\t}\r\n\r\n\tself._super = _super;\r\n\tself._class = _class;\r\n\r\n\treturn self;\r\n};\r\n\r\n\r\n/**\r\n**\tInternal method used to extend a class with one or more prototypes.\r\n**\r\n**\t>> class _extend (object base, object[] protos);\r\n*/\r\nClass.prototype._extend = function (base, protos)\r\n{\r\n\tvar _class = function (...args)\r\n\t{\r\n\t\tthis._initSuperRefs();\r\n\t\tthis.__ctor.apply(this, args);\r\n\t};\r\n\r\n\t_class._class = _class;\r\n\t_class._super = { };\r\n\r\n\tClass.inherit.call (_class, base);\r\n\r\n\tdelete _class.prototype.className;\r\n\r\n\tfor (let i = 0; i < protos.length; i++)\r\n\t\t_class.inherit (protos[i]);\r\n\r\n\tdelete _class._super.Class;\r\n\r\n\tif (\"classInit\" in _class.prototype)\r\n\t\t_class.prototype.classInit();\r\n\r\n\treturn _class;\r\n};\r\n\r\n\r\n/**\r\n**\tCreates a new class with the specified prototypes each of which can be a class constructor or an object.\r\n**\r\n**\t>> constructor extend (object... protos);\r\n*/\r\nClass.extend = function (...protos)\r\n{\r\n\treturn this._class.prototype._extend (this, protos);\r\n};\r\n\r\n\r\n/**\r\n**\tCreates a new instance of a class resulting from extending the self class with the specified prototype.\r\n**\r\n**\t>> object create (object proto);\r\n*/\r\nClass.create = function (proto)\r\n{\r\n\treturn new (this.extend(proto)) ();\r\n};\r\n","/*\r\n**\trin/event\r\n**\r\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nlet Rin = require('./alpha');\r\nlet Class = require('./class');\r\n\r\n/**\r\n**\tHolds the information about a triggered event. It also provides a mechanism to allow asynchronous\r\n**\tevent propagation to ensure the event chain order.\r\n*/\r\n\r\nmodule.exports = Class.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"Event\",\r\n\r\n\t/**\r\n\t**\tSource of the event.\r\n\t*/\r\n\tsource: null,\r\n\r\n\t/**\r\n\t**\tName of the event.\r\n\t*/\r\n\tname: null,\r\n\r\n\t/**\r\n\t**\tArguments of the event.\r\n\t*/\r\n\targs: null,\r\n\r\n\t/**\r\n\t**\tIndicates if the last event handler wants to use async mode.\r\n\t*/\r\n\t_async: false,\r\n\r\n\t/**\r\n\t**\tQueue of all handlers to invoke.\r\n\t*/\r\n\tlist: null,\r\n\r\n\t/**\r\n\t**\tNext event to be executed in the event chain.\r\n\t*/\r\n\tnext: null,\r\n\r\n\t/**\r\n\t**\tReturn values from event handlers.\r\n\t*/\r\n\tret: null,\r\n\r\n\t/**\r\n\t**\tOriginal root event.\r\n\t*/\r\n\toriginal: null,\r\n\r\n\t/**\r\n\t**\tIndex of the current event handler.\r\n\t*/\r\n\ti: -1,\r\n\r\n\t/**\r\n\t**\tContructs an event object with the specified parameters. Source is the event-dispatcher object, list is\r\n\t**\tan array with all the listeners to invoke. The eventName and eventArgs are the event information to be\r\n\t**\tpassed to each handler and if a callback is specified (cbHandler+cbContext) it will be executed once all\r\n\t**\tthe event handlers have been processed.\r\n\t**\r\n\t**\tEvent __ctor (source: EventDispatcher, list: Array, eventName: string, eventArgs: map, cbHandler: function, cbContext: object);\r\n\t*/\r\n\t__ctor: function (source, list, eventName, eventArgs, cbHandler, cbContext)\r\n\t{\r\n\t\tthis.source = source;\r\n\r\n\t\tthis.name = eventName;\r\n\t\tthis.args = eventArgs;\r\n\r\n\t\tthis.cbHandler = cbHandler;\r\n\t\tthis.cbContext = cbContext;\r\n\r\n\t\tthis.list = list;\r\n\t\tthis.reset();\r\n\t},\r\n\r\n\t/**\r\n\t**\tResets the event to its initial state. An event object can be reused by resetting it and then\r\n\t**\tinvoking the resume event.\r\n\t**\r\n\t**\tEvent reset ();\r\n\t*/\r\n\treset: function ()\r\n\t{\r\n\t\tthis.next = null;\r\n\t\tthis.ret = [];\r\n\r\n\t\tthis._async = false;\r\n\t\tthis.i = -1;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tChanges the source of the event.\r\n\t**\r\n\t**\tEvent setSource (object value);\r\n\t*/\r\n\tsetSource: function (value)\r\n\t{\r\n\t\tthis.source = value;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tSets the internal asynchronous flag. Should be called before a handler returns. If a handler\r\n\t**\tcalls this method it should also call resume() when async operations are finished.\r\n\t**\r\n\t**\tEvent wait ();\r\n\t*/\r\n\twait: function ()\r\n\t{\r\n\t\tthis._async = true;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tResumes event propagation. Should be called manually by event handlers that also call wait().\r\n\t**\r\n\t**\tEvent resume ();\r\n\t*/\r\n\tresume: function ()\r\n\t{\r\n\t\tthis._async = false;\r\n\r\n\t\twhile (!this._async)\r\n\t\t{\r\n\t\t\tif (++this.i >= this.list.length)\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tif (this.list[this.i].silent)\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tif (Rin.typeOf(this.list[this.i].handler) == \"string\")\r\n\t\t\t{\r\n\t\t\t\tif (this.list[this.i].context)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (!this.list[this.i].context[this.list[this.i].handler])\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\tif (this.list[this.i].context[this.list[this.i].handler] (this, this.args, this.list[this.i].data) === false)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tif (global[this.list[this.i].handler].call (null, this, this.args, this.list[this.i].data) === false)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (this.list[this.i].handler.call (this.list[this.i].context, this, this.args, this.list[this.i].data) === false)\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._async)\r\n\t\t\treturn this;\r\n\r\n\t\tif (this.i >= this.list.length && this.next) this.next.resume();\r\n\r\n\t\tif (this.cbHandler)\r\n\t\t\tthis.cbHandler.call (this.cbContext);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tSets the \"original\" property of the event to indicate where the original event comes from.\r\n\t**\r\n\t**\tEvent from (event: Event);\r\n\t*/\r\n\tfrom: function (event)\r\n\t{\r\n\t\tthis.original = event;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tEnqueues the specified event to be executed upon the current event process is finished. The \"original\"\r\n\t**\tproperty of the chained event will be set to the current event.\r\n\t**\r\n\t**\tEvent enqueueEvent (event: Event);\r\n\t*/\r\n\tenqueue: function (event)\r\n\t{\r\n\t\tif (!event) return this;\r\n\r\n\t\tvar evt;\r\n\t\tfor (evt = this; evt.next != null; evt = evt.next);\r\n\r\n\t\tevt.next = event;\r\n\t\tevent.from (this);\r\n\r\n\t\treturn this;\r\n\t}\r\n});\r\n","/*\r\n**\trin/event-dispatcher\r\n**\r\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nlet Class = require('./class');\r\nlet Event = require('./event');\r\n\r\n/**\r\n**\tEvent dispatcher allows several event listeners to be attached, these will be invoked whenever the\r\n**\tevent that is being listened to is triggered.\r\n*/\r\n\r\nmodule.exports = Class.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"EventDispatcher\",\r\n\r\n\t/**\r\n\t**\tListeners attached to this event dispatcher. Grouped by event name.\r\n\t*/\r\n\tlisteners: null,\r\n\r\n\t/**\r\n\t**\tNamespace for event dispatching. Defaults to null. Can be modified using setNamespace().\r\n\t*/\r\n\tnamespace: null,\r\n\r\n\t/**\r\n\t**\tInitializes the event dispatcher.\r\n\t**\r\n\t**\tEventDispatcher __ctor ();\r\n\t*/\r\n\t__ctor: function ()\r\n\t{\r\n\t\tthis.listeners = { };\r\n\t},\r\n\r\n\t/**\r\n\t**\tSets the event dispatching namespace. Used to force all events dispatched to have the specified namespace.\r\n\t**\r\n\t**\tEventDispatcher setNamespace (value: string);\r\n\t*/\r\n\tsetNamespace: function (value)\r\n\t{\r\n\t\tthis.namespace = value;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tAdds an event listener for a specified event to the event dispatcher. The event name can have an optional\r\n\t**\tnamespace indicator which is added to the beginning of the event name and separated using a colon (:). This\r\n\t**\tindicator can be used to later trigger or remove all handlers of an specific namespace.\r\n\t**\r\n\t**\tEventDispatcher addEventListener (eventName: string, handler: function, context: object, data: object);\r\n\t*/\r\n\taddEventListener: function (eventName, handler, context, data)\r\n\t{\r\n\t\teventName = eventName.split(\":\");\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tif (!this.listeners[name])\r\n\t\t\tthis.listeners[name] = [];\r\n\r\n\t\tthis.listeners[name].push ({ ns: ns, handler: handler, context: context, data: data, silent: 0 });\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tRemoves an event listener from the event dispatcher. If only the name is provided all handlers with the\r\n\t**\tspecified name will be removed. If a context is provided without a handler then any handler matching the\r\n\t**\tcontext will be removed. Special event name \"*\" can be used to match all event names.\r\n\t**\r\n\t**\tEventDispatcher removeEventListener (eventName: string, handler: function, context: object);\r\n\t*/\r\n\tremoveEventListener: function (eventName, handler, context)\r\n\t{\r\n\t\teventName = eventName.split(\":\");\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tif (name == \"*\")\r\n\t\t{\r\n\t\t\tfor (var j in this.listeners)\r\n\t\t\t{\r\n\t\t\t\tvar list = this.listeners[j];\r\n\r\n\t\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar k = true;\r\n\r\n\t\t\t\t\tif (handler)\r\n\t\t\t\t\t\tk = k && list[i].handler === handler;\r\n\r\n\t\t\t\t\tif (context)\r\n\t\t\t\t\t\tk = k && list[i].context === context;\r\n\r\n\t\t\t\t\tif (ns)\r\n\t\t\t\t\t\tk = k && list[i].ns == ns;\r\n\r\n\t\t\t\t\tif (k) list.splice(i--, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (!this.listeners[name])\r\n\t\t\t\treturn this;\r\n\r\n\t\t\tvar list = this.listeners[name];\r\n\r\n\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t{\r\n\t\t\t\tvar k = true;\r\n\r\n\t\t\t\tif (handler)\r\n\t\t\t\t\tk = k && list[i].handler === handler;\r\n\r\n\t\t\t\tif (context)\r\n\t\t\t\t\tk = k && list[i].context === context;\r\n\r\n\t\t\t\tif (ns)\r\n\t\t\t\t\tk = k && list[i].ns == ns;\r\n\r\n\t\t\t\tif (k) list.splice(i--, 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tPrepares an event with the specified parameters for its later usage. The event is started when\r\n\t**\tthe resume() method is called. If a callback is specified it will be executed once all event\r\n\t**\thandlers have been processed.\r\n\t**\r\n\t**\tEvent prepareEvent (eventName: string, eventArgs: map, cbHandler: function, cbContext: object);\r\n\t**\tEvent prepareEvent (eventName: string, eventArgs: map);\r\n\t*/\r\n\tprepareEvent: function (eventName, eventArgs, cbHandler, cbContext)\r\n\t{\r\n\t\tvar list = [];\r\n\r\n\t\teventName = eventName.split(\":\");\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tif (this.listeners[name])\r\n\t\t\tlist = list.concat (this.listeners[name]);\r\n\r\n\t\tif (this.listeners[\"*\"])\r\n\t\t\tlist = list.concat (this.listeners[\"*\"]);\r\n\r\n\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\tif (list[i].silent) list.splice (i--, 1);\r\n\r\n\t\tif (ns)\r\n\t\t{\r\n\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t\tif (list[i].ns != ns) list.splice (i--, 1);\r\n\t\t}\r\n\r\n\t\treturn new Event (this, list, name, eventArgs, cbHandler, cbContext);\r\n\t},\r\n\r\n\t/**\r\n\t**\tSilences or unsilences all handlers attached to an event such that if the event fires the handler(s) will\r\n\t**\tnot be invoked. It is recommended to use a namespace to ensure other handlers will continue to be run.\r\n\t**\r\n\t**\tEventDispatcher silence (eventName: string);\r\n\t*/\r\n\tsilence: function (eventName, value)\r\n\t{\r\n\t\teventName = eventName.split(\":\");\r\n\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tvalue = value === false ? -1 : 1;\r\n\r\n\t\tif (name == \"*\")\r\n\t\t{\r\n\t\t\tfor (var j in this.listeners)\r\n\t\t\t{\r\n\t\t\t\tvar list = this.listeners[j];\r\n\r\n\t\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (ns && list[i].ns != ns)\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\tlist[i].silent += value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (!this.listeners[name])\r\n\t\t\t\treturn this;\r\n\r\n\t\t\tvar list = this.listeners[name];\r\n\r\n\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t{\r\n\t\t\t\tif (ns && list[i].ns != ns)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tlist[i].silent += value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tDispatches an event to the respective listeners. If a callback is specified it will be executed once\r\n\t**\tall event handlers have been processed.\r\n\t**\r\n\t**\tEvent dispatchEvent (eventName: string, eventArgs: map, cbHandler: function, cbContext: object);\r\n\t**\tEvent dispatchEvent (eventName: string, eventArgs: map);\r\n\t*/\r\n\tdispatchEvent: function (eventName, eventArgs, cbHandler, cbContext)\r\n\t{\r\n\t\treturn this.prepareEvent(this.namespace ? this.namespace+':'+eventName : eventName, eventArgs, cbHandler, cbContext).resume();\r\n\t}\r\n});\r\n","/*\n**\trin/model\n**\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nlet Rin = require('./alpha');\nlet EventDispatcher = require('./event-dispatcher');\n\n/**\n**\tA model is a high-integrity data object used to store properties and more importantly to provide event support to notify of any\n**\tkind of change that occurs to the model's properties. Integrity of the model is maintained by optionally using property constraints.\n*/\n\nlet _Model = module.exports = EventDispatcher.extend\n({\n\t/**\n\t**\tName of the class.\n\t*/\n\tclassName: \"Model\",\n\n\t/**\n\t**\tDefault properties for the model. Can be a map with the property name and its default value or a function\n\t**\treturning a map with dynamic default values. This is used to reset the model to its initial state.\n\t*/\n\tdefaults: null,\n\n\t/**\n\t**\tModel property contraints. A map with the property name and an object specifying the constraints of the\n\t**\tproperty. This is used to determine the type, format and behavior of each property in the model.\n\t*/\n\tconstraints: null,\n\n\t/**\n\t**\tProperties of the model.\n\t*/\n\tdata: null,\n\n\t/**\n\t**\tArray with the name of the properties that have changed. Populated prior modelChanged event.\n\t*/\n\tchangedList: null,\n\n\t/**\n\t**\tSilent mode indicator. While in silent mode events will not be dispatched.\n\t*/\n\t_silent: 0,\n\n\t/**\n\t**\tCurrent nesting level of the set() method. This is used to determine when all the property\n\t**\tchanges are done.\n\t*/\n\t_level: 0,\n\n\t/**\n\t**\tInitializes the model and sets the properties to the specified data object.\n\t**\n\t**\t>> Model __ctor (object data);\n\t**\t>> Model __ctor (object data, object defaults);\n\t*/\n\t__ctor: function (data, defaults)\n\t{\n\t\tthis._super.EventDispatcher.__ctor();\n\n\t\tthis.data = { };\n\n\t\tif (defaults != null)\n\t\t{\n\t\t\tthis.reset (defaults);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar o = null;\n\n\t\t\tif (!this.defaults && this.constraints)\n\t\t\t{\n\t\t\t\tvar o = { };\n\n\t\t\t\tfor (var i in this.constraints)\n\t\t\t\t{\n\t\t\t\t\tvar j = this.constraints[i];\n\t\t\t\t\tif (j.def === null || j.def === undefined)\n\t\t\t\t\t{\n\t\t\t\t\t\to[i] = null;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof(j.def) == \"function\")\n\t\t\t\t\t\to[i] = j.def();\n\t\t\t\t\telse\n\t\t\t\t\t\to[i] = j.def;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.reset(o);\n\t\t}\n\n\t\tthis.init();\n\n\t\tif (data != null)\n\t\t\tthis.set (arguments[0], true);\n\n\t\tif (this.constraints) this.update();\n\n\t\tthis.ready();\n\t},\n\n\t/**\n\t**\tResets the model to its default state and triggers update events. If a map is provided the defaults of\n\t**\tthe model will be set to the specified map.\n\t**\n\t**\t>> Model reset (object defaults, [bool nsilent=true]);\n\t**\t>> Model reset ([bool nsilent=true]);\n\t*/\n\treset: function (defaults, nsilent)\n\t{\n\t\tif (!this.defaults)\n\t\t{\n\t\t\tif (!defaults || (Rin.typeOf(defaults) != \"object\" && Rin.typeOf(defaults) != \"function\"))\n\t\t\t\treturn this;\n\n\t\t\tthis.defaults = defaults;\n\t\t}\n\n\t\tif (Rin.typeOf(this.defaults) == \"function\")\n\t\t\tthis.data = this.defaults();\n\t\telse\n\t\t\tthis.data = Rin.clone(this.defaults);\n\n\t\treturn (nsilent === false || defaults === false) ? this : this.update(null, true);\n\t},\n\n\t/**\n\t**\tInitializes the model. Called before the model properties are set.\n\t**\n\t**\t>> void init ();\n\t*/\n\tinit: function ()\n\t{\n\t},\n\n\t/**\n\t**\tInitialization epilogue. Called after initialization and after model properties are set.\n\t**\n\t**\t>> void ready ();\n\t*/\n\tready: function ()\n\t{\n\t},\n\n\t/**\n\t**\tEnables or disables silent mode. When the model is in silent mode events will not be dispatched.\n\t**\n\t**\t>> Model silent (value: bool);\n\t*/\n\tsilent: function (value)\n\t{\n\t\tthis._silent += value ? 1 : -1;\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tValidates a property name and value against the constraints defined in the model (if any). Returns the\n\t**\tfinal value if successful or throws an empty exception if errors occur.\n\t**\n\t**\t>> T _validate (string name, T value);\n\t*/\n\t_validate: function (name, value)\n\t{\n\t\tif (!this.constraints || !this.constraints[name])\n\t\t\treturn value;\n\n\t\tvar constraints = this.constraints[name];\n\n\t\tvar nvalue = value;\n\n\t\tfor (var ctname in constraints)\n\t\t{\n\t\t\tif (!_Model.Constraints[ctname])\n\t\t\t\tcontinue;\n\n\t\t\ttry {\n\t\t\t\tnvalue = _Model.Constraints[ctname] (this, constraints[ctname], name, nvalue);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tif (e.message == \"null\")\n\t\t\t\t\tbreak;\n\n\t\t\t\tthrow new Error (`Constraint [${ctname}:${constraints[ctname]}] failed on property '${name}'.`);\n\t\t\t}\n\t\t}\n\n\t\treturn nvalue;\n\t},\n\n\t/**\n\t**\tSets the value of a property and returns the value set. This method is internally used to set properties\n\t**\tone at a time. If constraints are present in the model for the specified property all constraints will be\n\t**\tverified. When constraint errors occur the constraintError event will be raised and the property value\n\t**\twill not be changed.\n\t**\n\t**\t>> T _set (string name, T value);\n\t*/\n\t_set: function (name, value)\n\t{\n\t\tif (!this.constraints || !this.constraints[name])\n\t\t{\n\t\t\tthis.data[name] = value;\n\t\t\treturn value;\n\t\t}\n\n\t\tvar constraints = this.constraints[name];\n\n\t\tvar cvalue = this.data[name];\n\t\tvar nvalue = value;\n\n\t\tfor (var ctname in constraints)\n\t\t{\n\t\t\tif (!_Model.Constraints[ctname])\n\t\t\t\tcontinue;\n\n\t\t\ttry {\n\t\t\t\tnvalue = _Model.Constraints[ctname] (this, constraints[ctname], name, nvalue);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tif (e.message == \"null\")\n\t\t\t\t\tbreak;\n\n\t\t\t\tif (!this._silent)\n\t\t\t\t\tthis.dispatchEvent (\"constraintError\", { constraint: ctname, message: e.message, name: name, value: value });\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn (this.data[name] = nvalue);\n\t},\n\n\t/**\n\t**\tTriggers property events to indicate a property is changing. First triggers \"propertyChanging\" and then\n\t**\t\"propertyChanged\". If the first event returns false the second event will not be triggered.\n\t**\n\t**\t>> void _propertyEvent (string name, T prev, T value, bool direct=false);\n\t*/\n\t_propertyEvent: function (name, prev, value, direct)\n\t{\n\t\tvar temp = { name: name, old: prev, value: value, level: this._level };\n\n\t\tvar evt = this.dispatchEvent (\"propertyChanging\", temp);\n\n\t\tif (!direct)\n\t\t\ttemp.value = this._set (name, temp.value);\n\t\telse\n\t\t\tthis.data[name] = temp.value;\n\n\t\tif (evt != null && evt.ret.length && evt.ret[0] === false)\n\t\t\treturn;\n\n\t\tthis.dispatchEvent (\"propertyChanged.\" + name, temp);\n\t\tthis.dispatchEvent (\"propertyChanged\", temp);\n\n\t\tthis.changedList.push (name);\n\t},\n\n\t/**\n\t**\tSets one or more properties of the model. Possible arguments can be two strings or a map.\n\t**\n\t**\t>> Model set (string name, T value, bool force=true);\n\t**\t>> Model set (string name, T value, bool silent=false);\n\t**\t>> Model set (string name, T value);\n\t**\t>> Model set (object data);\n\t*/\n\tset: function ()\n\t{\n\t\tvar n = arguments.length;\n\t\tvar force = false, silent = false;\n\n\t\tif ((n > 2 || (n == 2 && Rin.typeOf(arguments[0]) == \"object\")) && Rin.typeOf(arguments[n-1]) == \"boolean\")\n\t\t{\n\t\t\tforce = arguments[--n];\n\t\t\tif (force === false) silent = true;\n\t\t}\n\n\t\tif (this._level == 0)\n\t\t{\n\t\t\tthis.changedList = [];\n\t\t}\n\n\t\tthis._level++;\n\n\t\tif (n == 2)\n\t\t{\n\t\t\tif (this.data[arguments[0]] != arguments[1] || force)\n\t\t\t{\n\t\t\t\tif (!this._silent && !silent)\n\t\t\t\t\tthis._propertyEvent (arguments[0], this.data[arguments[0]], this._validate (arguments[0], arguments[1]));\n\t\t\t\telse\n\t\t\t\t\tthis._set (arguments[0], arguments[1]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (var i in arguments[0])\n\t\t\t{\n\t\t\t\tif (this.data[i] != arguments[0][i] || force)\n\t\t\t\t{\n\t\t\t\t\tif (!this._silent && !silent)\n\t\t\t\t\t\tthis._propertyEvent (i, this.data[i], this._validate (i, arguments[0][i]));\n\t\t\t\t\telse\n\t\t\t\t\t\tthis._set (i, arguments[0][i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!--this._level && this.changedList.length && !silent && !this._silent)\n\t\t\tthis.dispatchEvent (\"modelChanged\", { fields: this.changedList });\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns true if the given key exists in the model.\n\t**\n\t**\t>> boolean has (string name);\n\t*/\n\thas: function (name)\n\t{\n\t\treturn name in this.data;\n\t},\n\n\t/**\n\t**\tReturns the value of a property. If no name is specified the whole map of properties will be returned.\n\t**\tIf a boolean value of \"true\" is provided the properties map will be returned but first will be compacted\n\t**\tusing the default data to ensure only valid properties are present.\n\t**\n\t**\t>> T get (string name);\n\t**\t>> object get ();\n\t**\t>> object get (true);\n\t**\t>> object get (false);\n\t**\t\n\t*/\n\tget: function (name, def)\n\t{\n\t\tif (arguments.length == 0 || name === false)\n\t\t\treturn this.data;\n\n\t\tif (arguments.length == 1 && name === true)\n\t\t\treturn this.flatten ();\n\n\t\tif (arguments.length == 2)\n\t\t\treturn this.data[name] === undefined ? def : this.data[name];\n\n\t\treturn this.data[name];\n\t},\n\n\t/**\n\t**\tReturns the value of a property as an integer number.\n\t**\n\t**\t>> int getInt (string name, [int def]);\n\t*/\n\tgetInt: function (name, def)\n\t{\n\t\tif (arguments.length == 2)\n\t\t\treturn this.data[name] === undefined ? def : parseInt (this.data[name]);\n\n\t\treturn parseInt (this.data[name]);\n\t},\n\n\t/**\n\t**\tReturns the value of a property as a floating point number.\n\t**\n\t**\t>> float getFloat (string name, [float def]);\n\t*/\n\tgetFloat: function (name, def)\n\t{\n\t\tif (arguments.length == 2)\n\t\t\treturn this.data[name] === undefined ? def : parseFloat (this.data[name]);\n\n\t\treturn parseFloat (this.data[name]);\n\t},\n\n\t/**\n\t**\tReturns the value of a property as a boolean value (true or false).\n\t**\n\t**\t>> bool getBool (string name, [bool def]);\n\t**\t\n\t*/\n\tgetBool: function (name, def)\n\t{\n\t\tif (arguments.length == 2)\n\t\t\tname = this.data[name] === undefined ? def : this.data[name];\n\t\telse\n\t\t\tname = this.data[name];\n\n\t\tif (name === \"true\" || name === true)\n\t\t\treturn true;\n\n\t\tif (name === \"false\" || name === false)\n\t\t\treturn false;\n\n\t\treturn parseInt (name) ? true : false;\n\t},\n\n\t/**\n\t**\tReturns a reference object for a model property. The resulting object contains two methods\n\t**\tnamed \"get\" and \"set\" to modify the value of the property.\n\t**\n\t**\t>> object getReference (string name);\n\t*/\n\tgetReference: function (name)\n\t{\t\n\t\tvar m = this;\n\n\t\treturn {\n\t\t\tget: function() {\n\t\t\t\treturn m.get(name);\n\t\t\t},\n\n\t\t\tset: function(value) {\n\t\t\t\tm.set(name, value);\n\t\t\t}\n\t\t};\n\t},\n\n\t/**\n\t**\tSets or returns a constraint given the property name. \n\t**\n\t**\t>> Model constraint (string field, string constraint, T value);\n\t**\t>> Model constraint (string field, object constraint);\n\t**\t>> Model constraint (object constraints);\n\t**\t>> object constraint (string field);\n\t*/\n\tconstraint: function (field, constraint, value)\n\t{\n\t\tif (arguments.length == 3 || arguments.length == 2 || (arguments.length == 1 && Rin.typeOf(field) == \"object\"))\n\t\t{\n\t\t\tif (this.constraints === this.constructor.prototype.constraints)\n\t\t\t\tthis.constraints = Rin.clone (this.constraints);\n\n\t\t\tswitch (arguments.length)\n\t\t\t{\n\t\t\t\tcase 1:\n\t\t\t\t\tRin.override (this.constraints, field);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\t\t\t\t\tRin.override (this.constraints[field], constraint);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 3:\n\t\t\t\t\tthis.constraints[field][constraint] = value;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\treturn !field ? this : this.constraints[field];\n\t},\n\n\t/**\n\t**\tReturns a compact version of the model properties. That is, a map only with validated properties that are\n\t**\talso present in the default data map. Returns null if the object is not compliant. If the \"safe\" parameter\n\t**\tis set one last property named \"class\" will be attached, this specifies the original classPath of the object.\n\t**\n\t**\t>> object flatten ([bool safe=false]);\n\t*/\n\tflatten: function (safe, rsafe)\n\t{\n\t\tif (safe)\n\t\t{\n\t\t\tvar data = this.flatten(false, true);\n\t\t\tif (data == null) return null;\n\n\t\t\tdata[\"class\"] = this.classPath;\n\t\t\treturn data;\n\t\t}\n\n\t\tif (!this.constraints && !this.defaults)\n\t\t\treturn this.data;\n\n\t\tif (!this.isCompliant())\n\t\t\treturn { };\n\n\t\tvar constraints = this.constraints;\n\t\tvar keys = this.defaults ? (Rin.typeOf(this.defaults) == \"function\" ? this.defaults() : this.defaults) : this.constraints;\n\n\t\tvar data = { };\n\n\t\tfor (var i in this.data)\n\t\t{\n\t\t\tif (!(i in keys)) continue;\n\n\t\t\tif (constraints && constraints[i])\n\t\t\t{\n\t\t\t\tvar ct = constraints[i];\n\n\t\t\t\tif (ct.model)\n\t\t\t\t{\n\t\t\t\t\tdata[i] = this.data[i] ? this.data[i].flatten(rsafe) : null;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (ct.arrayof)\n\t\t\t\t{\n\t\t\t\t\tdata[i] = [];\n\n\t\t\t\t\tfor (var j = 0; j < this.data[i].length; j++)\n\t\t\t\t\t\tdata[i][j] = this.data[i][j] ? this.data[i][j].flatten(rsafe) : null;\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (ct.cls)\n\t\t\t\t{\n\t\t\t\t\tdata[i] = this.data[i] ? this.data[i].flatten() : null;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdata[i] = this.data[i];\n\t\t}\n\n\t\treturn data;\n\t},\n\n\t/**\n\t**\tRemoves a property or a list of properties.\n\t**\n\t**\t>> void remove (string name, [bool nsilent=true]);\n\t**\t>> void remove (array name, [bool nsilent=true]);\n\t*/\n\tremove: function (name, nsilent)\n\t{\n\t\tif (Rin.typeOf(name) == \"array\")\n\t\t{\n\t\t\tfor (var i = 0; i < name.length; i++)\n\t\t\t\tdelete this.data[name[i]];\n\n\t\t\tif (nsilent !== false && !this._silent)\n\t\t\t\tthis.dispatchEvent (\"propertyRemoved\", { fields: name });\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdelete this.data[name];\n\n\t\t\tif (nsilent !== false && !this._silent)\n\t\t\t\tthis.dispatchEvent (\"propertyRemoved\", { fields: [name] });\n\t\t}\n\t},\n\n\t/**\n\t**\tTriggers data change events for one or more properties. Ensure that silent mode is not enabled or else\n\t**\tthis method will have no effect. If no parameters are provided a full update will be triggered on all of\n\t**\tthe model properties.\n\t**\n\t**\t>> Model update (array fields);\n\t**\t>> Model update (string name);\n\t**\t>> Model update (bool forceModelChanged);\n\t**\t>> Model update ();\n\t*/\n\tupdate: function (fields, direct)\n\t{\n\t\tif (this._silent) return this;\n\n\t\tif (this._level == 0)\n\t\t{\n\t\t\tthis.changedList = [];\n\t\t}\n\n\t\tthis._level++;\n\n\t\tif (fields && Rin.typeOf(fields) == 'string')\n\t\t{\n\t\t\tthis._propertyEvent (fields, this.data[fields], this.data[fields], direct);\n\t\t}\n\t\telse if (fields && Rin.typeOf(fields) == 'array')\n\t\t{\n\t\t\tfor (var i of fields)\n\t\t\t\tthis._propertyEvent (i, this.data[i], this.data[i], direct);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (var i in this.data)\n\t\t\t\tthis._propertyEvent (i, this.data[i], this.data[i], direct);\n\t\t}\n\n\t\tif (!--this._level && !this._silent && (this.changedList.length != 0 || fields === true))\n\t\t\tthis.dispatchEvent (\"modelChanged\", { fields: this.changedList });\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tValidates one or mode model properties using the defined constraints. If no parameters are provided all of\n\t**\tthe properties in the model will be validated.\n\t**\n\t**\t>> Model validate (array fields);\n\t**\t>> Model validate (string name);\n\t**\t>> Model validate ();\n\t*/\n\tvalidate: function (fields)\n\t{\n\t\tif (!this.constraints) return this;\n\n\t\tif (fields && Rin.typeOf(fields) == \"string\")\n\t\t{\n\t\t\tthis._set (fields, this.data[fields])\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (var i in this.data)\n\t\t\t{\n\t\t\t\tif (fields && Rin.indexOf(fields, i) == -1)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis._set (i, this.data[i])\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tValidates all the properties in the model and returns a boolean indicating if all of them comply with the\n\t**\tconstraints defined in the model.\n\t**\n\t**\t>> bool isCompliant ();\n\t*/\n\tisCompliant: function ()\n\t{\n\t\tif (!this.constraints) return true;\n\n\t\ttry\n\t\t{\n\t\t\tfor (var i in this.data)\n\t\t\t\tthis._validate (i, this.data[i]);\n\n\t\t\treturn true;\n\t\t}\n\t\tcatch (e) {\n\t\t}\n\n\t\treturn false;\n\t},\n\n\t/**\n\t**\tRegisters an event handler for changes in a specific property of the model.\n\t**\n\t**\t>> void observe (string property, function handler, object context);\n\t*/\n\tobserve: function (property, handler, context)\n\t{\n\t\tthis.addEventListener (\"propertyChanged.\" + property, handler, context);\n\t},\n\n\t/**\n\t**\tUnregisters an event handler from changes in a specific property of the model.\n\t**\n\t**\t>> void unobserve (string property, function handler, object context);\n\t*/\n\tunobserve: function (property, handler, context)\n\t{\n\t\tthis.removeEventListener (\"propertyChanged.\" + property, handler, context);\n\t},\n\n\t/**\n\t**\tSerializes the model into a string.\n\t**\n\t**\tstring toString ();\n\t*/\n\ttoString: function ()\n\t{\n\t\treturn Rin.serialize(this.get (true));\n\t}\n});\n\n\n/**\n**\tImport model constraints.\n*/\n\n_Model.Constraints = require('./model-constraints');\n","/*\n**\trin/model-regex\n**\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tCommon regular expressions for pattern validation.\n*/\n\nmodule.exports =\n{\n\temail: /^[_a-z0-9-]+(\\.[_a-z0-9-]+)*@[a-z0-9-]+(\\.[a-z0-9-]+)+$/i,\n\turl: /^[\\w-]+:\\/\\/[\\w-]+(\\.\\w+)+.*$/,\n\turlNoProt: /^[\\w-]+(\\.\\w+)+.*$/,\n\tname: /^[-A-Za-z0-9_.]+$/,\n\tuname: /^['\\pL\\pN ]+$/,\n\ttext: /^[^&<>{}]*$/,\n\tutext: /^([\\r\\n\\pL\\pN\\pS &!@#$%*\\[\\]()_+=;',.\\/?:\"~-]+)$/\n};\n","/*\n**\trin/model-constraints\n**\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nlet Rin = require('./alpha');\nlet Regex = require('./model-regex');\n\n/**\n**\tMap of model constraint handlers. Each function should accept parameters (in order): the model object (model), the constraint value (ctval),\n**\tthe property name (name), the property value (value) and return the corrected value once verified or throw an exception if errors occur.\n*/\n\nmodule.exports =\n{\n\t/**\n\t**\tUtility function (not a handler) to get the real value given a reference string. If the value is not a string, the value itself will\n\t**\tbe returned, if it is a string starting with '#' the model property will be returned, if starts with '@' the object property will be\n\t**\treturned, otherwise the contents of the string will eval'd and returned.\n\t*/\n\t_getref: function (value, obj)\n\t{\n\t\tif (typeof(value) == \"string\")\n\t\t{\n\t\t\tif (value.substr(0, 1) == \"#\")\t\t\tvalue = obj.get(value.substr(1));\n\t\t\telse if (value.substr(0, 1) == \"@\")\t\tvalue = obj[value.substr(1)];\n\n\t\t\tif (typeof(value) == \"string\")\n\t\t\t\treturn eval(value);\n\n\t\t\treturn value;\n\t\t}\n\t\telse\n\t\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the new value is of the valid type before storing it on the property. When possible if the\n\t**\tinput is of compatible type it will be converted to the target type.\n\t*/\n\ttype: function (model, ctval, name, value)\n\t{\n\t\tswitch (ctval)\n\t\t{\n\t\t\tcase \"int\":\n\t\t\t\tvalue = parseInt(value);\n\t\t\t\tif (isNaN(value)) throw new Error (ctval);\n\t\t\t\tbreak;\n\n\t\t\tcase \"float\":\n\t\t\t\tvalue = parseFloat(value);\n\t\t\t\tif (isNaN(value)) throw new Error (ctval);\n\t\t\t\tbreak;\n\n\t\t\tcase \"string\":\n\t\t\t\tvalue = (value === null || value === undefined) ? \"\" : value.toString();\n\t\t\t\tbreak;\n\n\t\t\tcase \"bit\":\n\t\t\t\tif (value === true || value === false) {\n\t\t\t\t\tvalue = value ? 1 : 0;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tvalue = parseInt(value);\n\t\t\t\tif (isNaN(value)) throw new Error (ctval);\n\n\t\t\t\tvalue = value ? 1 : 0;\n\t\t\t\tbreak;\n\n\t\t\tcase \"array\":\n\t\t\t\tif (Rin.typeOf(value) == \"array\")\n\t\t\t\t\tbreak;\n\n\t\t\t\tif (value === null || value === undefined)\n\t\t\t\t{\n\t\t\t\t\tvalue = [];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tthrow new Error (ctval);\n\t\t\t\tbreak;\n\n\t\t\tcase \"bool\":\n\t\t\t\tif (value === \"true\" || value === true) {\n\t\t\t\t\tvalue = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (value === \"false\" || value === false) {\n\t\t\t\t\tvalue = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tthrow new Error (ctval);\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the field is of the specified model type.\n\t*/\n\tmodel: function (model, ctval, name, value)\n\t{\n\t\tvar mclass = this._getref(ctval, model);\n\t\tif (!mclass) throw new Error (ctval);\n\n\t\tif (!value)\n\t\t\treturn new mclass();\n\n\t\treturn mclass.ensure (value);\n\t},\n\n\n\t/**\n\t**\tVerifies that the field is of the specified class.\n\t*/\n\tcls: function (model, ctval, name, value)\n\t{\n\t\tvar mclass = this._getref(ctval, model);\n\t\tif (!value) return new mclass();\n\n\t\treturn Rin.ensureTypeOf(mclass, value);\n\t},\n\n\n\t/**\n\t**\tVerifies that the array contents are of the specified class. Returns error if the class does not exist\n\t**\tor if the field is not an array. Therefore a type:array constraint should be used before this one.\n\t*/\n\tarrayof: function (model, ctval, name, value)\n\t{\n\t\tvar mclass = this._getref(ctval, model);\n\t\tif (!value) value = [];\n\n\t\tif (!mclass || Rin.typeOf(value) != \"array\")\n\t\t\tthrow new Error (ctval);\n\n\t\tfor (var i = 0; i < value.length; i++)\n\t\t\tvalue[i] = Rin.ensureTypeOf(mclass, value[i]);\n\t\t\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the array contents are not null. Returns error if the field is not an array, therefore a\n\t**\ttype:array constraint should be used before this one.\n\t*/\n\tarraynull: function (model, ctval, name, value)\n\t{\n\t\tvar remove = false;\n\n\t\tif (Rin.typeOf(ctval) == \"object\")\n\t\t{\n\t\t\tif (ctval.remove) remove = ctval.remove;\n\t\t\tctval = ctval.value;\n\t\t}\n\n\t\tif (ctval) return value;\n\n\t\tif (Rin.typeOf(value) != \"array\")\n\t\t\tthrow new Error (ctval);\n\n\t\tfor (var i = 0; i < value.length; i++)\n\t\t{\n\t\t\tif (value[i] == null)\n\t\t\t{\n\t\t\t\tif (remove)\n\t\t\t\t\tvalue.splice (i--, 1);\n\t\t\t\telse\n\t\t\t\t\tthrow new Error (ctval);\n\t\t\t}\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the array contents are all compliant. Returns error if the field is not an array, therefore\n\t**\ta type:array constraint should be used before this one.\n\t*/\n\tarraycompliant: function (model, ctval, name, value)\n\t{\n\t\tvar remove = false;\n\n\t\tif (Rin.typeOf(ctval) == \"object\")\n\t\t{\n\t\t\tif (ctval.remove) remove = ctval.remove;\n\t\t\tctval = ctval.value;\n\t\t}\n\n\t\tif (!ctval) return value;\n\n\t\tif (Rin.typeOf(value) != \"array\")\n\t\t\tthrow new Error (ctval);\n\n\t\tfor (var i = 0; i < value.length; i++)\n\t\t{\n\t\t\tif (value[i] == null)\n\t\t\t\tcontinue;\n\n\t\t\tif (!value[i].isCompliant())\n\t\t\t{\n\t\t\t\tif (remove)\n\t\t\t\t\tvalue.splice (i--, 1);\n\t\t\t\telse\n\t\t\t\t\tthrow new Error (ctval);\n\t\t\t}\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the presense of the field.\n\t*/\n\trequired: function (model, ctval, name, value)\n\t{\n\t\tif (value === null || value === undefined)\n\t\t\tthrow new Error (ctval ? \"\" : \"null\");\n\n\t\tswitch (Rin.typeOf(value))\n\t\t{\n\t\t\tcase \"array\":\n\t\t\t\tif (value.length == 0) throw new Error (ctval ? \"\" : \"null\");\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tif (value.toString().length == 0) throw new Error (ctval ? \"\" : \"null\");\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the minimum length of the field.\n\t*/\n\tminlen: function (model, ctval, name, value)\n\t{\n\t\tif (value.toString().length < ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the maximum length of the field.\n\t*/\n\tmaxlen: function (model, ctval, name, value)\n\t{\n\t\tif (value.toString().length > ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the minimum value of the field.\n\t*/\n\tminval: function (model, ctval, name, value)\n\t{\n\t\tif (parseFloat(value) < ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the maximum value of the field.\n\t*/\n\tmaxval: function (model, ctval, name, value)\n\t{\n\t\tif (parseFloat(value) > ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the minimum number of items in the array.\n\t*/\n\tmincount: function (model, ctval, name, value)\n\t{\n\t\tif (Rin.typeOf(value) != \"array\" || value.length < ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the maximum number of items in the array.\n\t*/\n\tmaxcount: function (model, ctval, name, value)\n\t{\n\t\tif (Rin.typeOf(value) != \"array\" || value.length > ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the format of the field using a regular expression. The constraint value should be the name of\n\t**\tone of the Model.Regex regular expressions.\n\t*/\n\tpattern: function (model, ctval, name, value)\n\t{\n\t\tif (!Regex[ctval].test (value.toString()))\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the field is inside the specified set of options. The set can be an array or a string with\n\t**\tthe options separated by vertical bar (|). The comparison is case-sensitive.\n\t*/\n\tinset: function (model, ctval, name, value)\n\t{\n\t\tif (Rin.typeOf(ctval) != \"array\")\n\t\t{\n\t\t\tif (!new RegExp(\"^(\"+ctval.toString()+\")$\").test (value.toString()))\n\t\t\t\tthrow new Error (ctval);\n\n\t\t\treturn value;\n\t\t}\n\n\t\tif (ctval.indexOf(value.toString()) == -1)\n\t\t\tthrow new Error (ctval.join(\"|\"));\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tSets the field to upper case.\n\t*/\n\tupper: function (model, ctval, name, value)\n\t{\n\t\treturn ctval ? value.toString().toUpperCase() : value;\n\t},\n\n\n\t/**\n\t**\tSets the field to lower case.\n\t*/\n\tlower: function (model, ctval, name, value)\n\t{\n\t\treturn ctval ? value.toString().toLowerCase() : value;\n\t}\n};\n","/*\n**\trin/model-list\n**\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nlet Rin = require('./alpha');\nlet Model = require('./model');\n\n/**\n**\tGeneric list for models.\n*/\n\nmodule.exports = Model.extend\n({\n\t/**\n\t**\tName of the class.\n\t*/\n\tclassName: \"ModelList\",\n\n\t/**\n\t**\tClass of the items in the list, can be overriden by child classes to impose a more strict constraint.\n\t*/\n\titemt: Model,\n\n\t/**\n\t**\tMirror of data.contents\n\t*/\n\tcontents: null,\n\n\t/**\n\t**\tIDs of every item in the contents.\n\t*/\n\titemId: null,\n\n\t/**\n\t**\tAutoincremental ID for the next item to be added.\n\t*/\n\tnextId: null,\n\n\t/**\n\t**\tDefault properties of the model.\n\t*/\n\tdefaults:\n\t{\n\t\tcontents: null\n\t},\n\n\t/**\n\t**\tConstraints of the model to ensure integrity.\n\t*/\n\tconstraints:\n\t{\n\t\tcontents: {\n\t\t\ttype: \"array\",\n\t\t\tarrayof: \"@itemt\"\n\t\t}\n\t},\n\n\t/**\n\t**\tConstructor.\n\t*/\n\t__ctor: function (...args)\n\t{\n\t\tthis.itemId = [];\n\t\tthis.nextId = 0;\n\n\t\tthis._super.Model.__ctor(...args);\n\t},\n\n\t/**\n\t**\tInitialization epilogue. Called after initialization and after model properties are set.\n\t*/\n\tready: function ()\n\t{\n\t\tthis._eventGroup = \"ModelList_\" + Date.now() + \":modelChanged\";\n\n\t\tthis.contents = this.data.contents;\n\t},\n\n\t/**\n\t**\tConnects the event handlers to the item.\n\t**\n\t**\t>> Model _bind (int iid, Model item);\n\t*/\n\t_bind: function (iid, item)\n\t{\n\t\tif (item && item.addEventListener) item.addEventListener (this._eventGroup, this._onItemEvent, this, iid);\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tDisconnects the event handlers from the item.\n\t**\n\t**\t>> Model _unbind (Model item);\n\t*/\n\t_unbind: function (item)\n\t{\n\t\tif (item && item.removeEventListener) item.removeEventListener (this._eventGroup);\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tHandler for item events.\n\t**\n\t**\t>> Model _onItemEvent (Event evt, object args, int iid);\n\t*/\n\t_onItemEvent: function (evt, args, iid)\n\t{\n\t\tthis.prepareEvent (\"itemChanged\", { id: iid, item: evt.source }).from (evt)\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\t},\n\n\t/**\n\t**\tReturns the number of items in the list.\n\t**\n\t**\t>> int length ();\n\t*/\n\tlength: function ()\n\t{\n\t\treturn this.data.contents.length;\n\t},\n\n\t/**\n\t**\tClears the contents of the list.\n\t**\n\t**\t>> void clear ();\n\t*/\n\tclear: function ()\n\t{\n\t\tfor (var i = 0; i < this.data.contents; i++)\n\t\t\tthis._unbind (this.data.contents[i]);\n\n\t\tthis.itemId = [];\n\t\tthis.nextId = 0;\n\n\t\tthis.data.contents = [];\n\n\t\tthis.prepareEvent (\"itemsCleared\")\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\t},\n\n\t/**\n\t**\tSets the contents of the list with the specified array. All items will be ensured to be of the same model\n\t**\ttype as the one specified in the list.\n\t**\n\t**\t>> void setData (array data);\n\t*/\n\tsetData: function (data)\n\t{\n\t\tthis.clear();\n\t\tif (!data) return;\n\n\t\tfor (var i = 0; i < data.length; i++)\n\t\t{\n\t\t\tvar item = Rin.ensureTypeOf(this.itemt, data[i]);\n\n\t\t\tthis.itemId.push(this.nextId++);\n\t\t\tthis.data.contents.push(item);\n\n\t\t\tthis._bind(this.nextId-1, item);\n\t\t}\n\n\t\tthis.prepareEvent (\"itemsChanged\")\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\t},\n\n\t/**\n\t**\tReturns the raw array contents of the list.\n\t**\n\t**\t>> array getData ();\n\t*/\n\tgetData: function ()\n\t{\n\t\treturn this.data.contents;\n\t},\n\n\t/**\n\t**\tReturns the item at the specified index or null if the index is out of bounds.\n\t**\n\t**\t>> Model getAt (int index);\n\t*/\n\tgetAt: function (index)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn null;\n\n\t\treturn this.data.contents[index];\n\t},\n\n\t/**\n\t**\tRemoves and returns the item at the specified index. Returns null if the index is out of bounds.\n\t**\n\t**\t>> Model removeAt (int index);\n\t*/\n\tremoveAt: function (index)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn null;\n\n\t\tlet item = this.data.contents.splice(index, 1)[0];\n\t\tlet id = this.itemId.splice(index, 1)[0];\n\n\t\tthis._unbind (item);\n\n\t\tthis.prepareEvent (\"itemRemoved\", { id: id, item: item })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume();\n\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tSets the item at the specified index. Returns false if the index is out of bounds, true otherwise. The\n\t**\titem will be ensured to be of the model defined in the list.\n\t**\n\t**\t>> bool setAt (int index, Model item);\n\t*/\n\tsetAt: function (index, item)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn false;\n\n\t\titem = Rin.ensureTypeOf(this.itemt, item);\n\n\t\tthis._unbind(this.data.contents[index]);\n\t\tthis.data.contents[index] = item;\n\t\tthis._bind(this.itemId[index], item);\n\n\t\tthis.prepareEvent (\"itemChanged\", { id: this.itemId[index], item: item })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tNotifies a change in the item at the specified index. Returns false if the index is out of bounds.\n\t**\n\t**\t>> bool updateAt (int index);\n\t*/\n\tupdateAt: function (index)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn false;\n\n\t\tthis.prepareEvent (\"itemChanged\", { id: this.itemId[index], item: this.data.contents[index] })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tAdds an item to the bottom of the list. Returns null if the item is not an object or a model. The item\n\t**\twill be ensured to be of the model specified in the list.\n\t**\n\t**\t>> Model push (Model item);\n\t*/\n\tpush: function (item)\n\t{\n\t\tif (item && Rin.typeOf(item) != \"object\")\n\t\t\treturn null;\n\n\t\titem = Rin.ensureTypeOf(this.itemt, item);\n\n\t\tthis.itemId.push(this.nextId++);\n\t\tthis.data.contents.push (item);\n\t\tthis._bind(this.nextId-1, item);\n\n\t\tthis.prepareEvent (\"itemAdded\", { id: this.itemId[this.itemId.length-1], item: item, position: 'tail' })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tRemoves and returns an item from the bottom of the list.\n\t**\n\t**\t>> Model pop ();\n\t*/\n\tpop: function ()\n\t{\n\t\treturn this._unbind(this.data.contents.pop());\n\t},\n\n\t/**\n\t**\tAdds an item to the top of the list. Returns null if the item is not an object or a model. The item\n\t**\twill be ensured to be of the model specified in the list.\n\t**\n\t**\t>> Model unshift (Model item);\n\t*/\n\tunshift: function (item)\n\t{\n\t\tif (item && Rin.typeOf(item) != \"object\")\n\t\t\treturn null;\n\n\t\titem = Rin.ensureTypeOf(this.itemt, item);\n\n\t\tthis.itemId.unshift(this.nextId++);\n\t\tthis.data.contents.unshift (item);\n\t\tthis._bind(this.nextId-1, item);\n\n\t\tthis.prepareEvent (\"itemAdded\", { id: this.itemId[0], item: item, position: 'head' })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tRemoves and returns an item from the top of the list.\n\t**\n\t**\t>> Model shift ();\n\t*/\n\tshift: function ()\n\t{\n\t\treturn this._unbind(this.data.contents.shift());\n\t},\n\n\t/**\n\t**\tSearches for an item matching the specified partial definition and returns its index. Returns -1 if the\n\t**\titem was not found. If retObject is set to true the object will be returned instead of its index and null\n\t**\twill be returned when the item is not found.\n\t**\n\t**\tint|object find (object data, bool retObject=false);\n\t*/\n\tfind: function (data, retObject)\n\t{\n\t\tvar contents = this.data.contents;\n\n\t\tfor (var i = 0; i < contents.length; i++)\n\t\t{\n\t\t\tif (Rin.partialCompare (contents[i].data, data))\n\t\t\t\treturn retObject ? contents[i] : i;\n\t\t}\n\n\t\treturn retObject ? null : -1;\n\t}\n});\n","/*\r\n**\trin/schema\r\n**\r\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nlet Rin = require('./alpha');\r\n\r\n/**\r\n**\tThe utility functions in this module allow to create a very strict serialization/deserialization schema\r\n**\tto ensure that all values are of the specific type when stored in string format.\r\n*/\r\n\r\nlet Schema = module.exports =\r\n{\r\n\tType: function (proto)\r\n    {\r\n\t\tlet tmp =\r\n\t\t{\r\n            flatten: function (value, context) {\r\n                return value;\r\n            },\r\n\r\n            unflatten: function (value, context) {\r\n                return value;\r\n            }\r\n        };\r\n\r\n        return proto ? Rin.override(tmp, proto) : tmp;\r\n    },\r\n\r\n\tString: function()\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\tflatten: function (value, context) {\r\n\t\t\t\treturn value != null ? value.toString() : null;\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn value != null ? value.toString() : null;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tInteger: function()\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\tflatten: function (value, context) {\r\n\t\t\t\treturn ~~value;\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn ~~value;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tNumber: function (precision)\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\t_precision: precision,\r\n\t\t\t_round: false,\r\n\r\n\t\t\tprecision: function (value)\r\n\t\t\t{\r\n\t\t\t\tthis._precision = ~~value;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tflatten: function (value, context)\r\n\t\t\t{\r\n\t\t\t\tvalue = parseFloat(value);\r\n\r\n\t\t\t\tif (this._precision > 0)\r\n\t\t\t\t\tvalue = (~~(value*Math.pow(10, this._precision))) / Math.pow(10, this._precision);\r\n\r\n\t\t\t\treturn value;\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn parseFloat(value);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tBool: function (compact)\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\t_compact: compact,\r\n\r\n\t\t\tcompact: function(value)\r\n\t\t\t{\r\n\t\t\t\tthis._compact = value;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tflatten: function (value, context) {\r\n\t\t\t\tvalue = ~~value;\r\n\t\t\t\treturn this._compact ? (value > 0 ? 1 : 0) : (value > 0 ? true : false);\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn (~~value) ? true : false;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tSharedString: function()\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\tflatten: function (value, context)\r\n\t\t\t{\r\n\t\t\t\tif (value == null) return 0;\r\n\r\n\t\t\t\tvalue = value.toString();\r\n\r\n                if (!(\"strings\" in context))\r\n                {\r\n                    context.strings_map = { };\r\n                    context.strings = [ ];\r\n                }\r\n\r\n                if (!(value in context.strings_map))\r\n                {\r\n                    context.strings.push(value);\r\n                    context.strings_map[value] = context.strings.length;\r\n                }\r\n\r\n                return context.strings_map[value];\r\n            },\r\n\r\n\t\t\tunflatten: function (value, context)\r\n\t\t\t{\r\n                return value == null || value == 0 ? null : context.strings[~~value - 1];\r\n            }\r\n        });\r\n    },\r\n\r\n\tArray: function (type)\r\n    {\r\n        return Schema.Type({\r\n\r\n\t\t\titemType: type,\r\n\t\t\t_debug: false,\r\n\r\n\t\t\tdebug: function(v) {\r\n\t\t\t\tthis._debug = v;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n            of: function (type) {\r\n                this.itemType = type;\r\n                return this;\r\n            },\r\n\r\n\t\t\tflatten: function (value, context)\r\n\t\t\t{\r\n\t\t\t\tif (value == null) return null;\r\n\r\n                let o = [ ];\r\n                \r\n                for (let i = 0; i < value.length; i++)\r\n                    o.push(this.itemType.flatten(value[i], context));\r\n\r\n                return o;\r\n            },\r\n\r\n\t\t\tunflatten: async function (value, context)\r\n\t\t\t{\r\n\t\t\t\tif (value == null) return null;\r\n\r\n                let o = [ ];\r\n\r\n\t\t\t\tfor (let i = 0; i < value.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\to.push(await this.itemType.unflatten(value[i], context));\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            }\r\n        });\r\n    },\r\n\r\n    Object: function()\r\n    {\r\n        return Schema.Type({\r\n\r\n            properties: [ ],\r\n\r\n            property: function (name, type, defvalue=null)\r\n            {\r\n                this.properties.push({ name: name, type: type, defvalue: defvalue });\r\n                return this;\r\n            },\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t{\r\n\t\t\t\t\to = { };\r\n\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\to[this.properties[i].name] = this.properties[i].type.flatten(value[this.properties[i].name], context);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\to = [ ];\r\n\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\to.push(this.properties[i].type.flatten(value[this.properties[i].name], context));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n            \r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o = { };\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t{\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\to[this.properties[i].name] = await this.properties[i].type.unflatten(this.properties[i].name in value ? value[this.properties[i].name] : this.properties[i].defvalue, context);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\to[this.properties[i].name] = await this.properties[i].type.unflatten(i in value ? value[i] : this.properties[i].defvalue, context);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            }\r\n        });\r\n\t},\r\n\r\n    Class: function (classConstructor)\r\n    {\r\n\t\treturn Schema.Type\r\n\t\t({\r\n            _constructor: classConstructor,\r\n\r\n            constructor: function (classConstructor)\r\n            {\r\n                this._constructor = classConstructor;\r\n                return this;\r\n            },\r\n\r\n            flatten: function (value, context)\r\n            {\r\n                return value == null ? null : value.flatten(context);\r\n            },\r\n\r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\treturn value == null ? null : await (new this._constructor()).unflatten(value, context);\r\n            }\r\n        });\r\n\t},\r\n\r\n\t/*\r\n\t**\tUsed when you want to specify just a single property.\r\n\t*/\r\n    Property: function(name, type)\r\n    {\r\n        return Schema.Type({\r\n\r\n\t\t\tproperty: name,\r\n\t\t\ttype: type,\r\n\r\n\t\t\tname: function (name)\r\n\t\t\t{\r\n\t\t\t\tthis.property = name;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tis: function (type)\r\n\t\t\t{\r\n\t\t\t\tthis.type = type;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t{\r\n\t\t\t\t\to = { };\r\n\t\t\t\t\to[this.property] = this.type.flatten(value[this.property], context);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\to = this.type.flatten(value[this.property], context);\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n\r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o = { };\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t\to[this.property] = await this.type.unflatten(value[this.property], context);\r\n\t\t\t\telse\r\n\t\t\t\t\to[this.property] = await this.type.unflatten(value, context);\r\n\r\n                return o;\r\n            }\r\n        });\r\n\t},\r\n\r\n    Map: function()\r\n    {\r\n        return Schema.Type({\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t\treturn value;\r\n\r\n\t\t\t\tlet o = [ ];\r\n\r\n\t\t\t\tfor (let i in value)\r\n\t\t\t\t{\r\n\t\t\t\t\to.push(i);\r\n\t\t\t\t\to.push(value[i]);\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n\r\n            unflatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t\treturn value;\r\n\r\n\t\t\t\tlet o = { };\r\n\r\n\t\t\t\tfor (let i = 0; i < value.length; i += 2)\r\n\t\t\t\t\to[value[i]] = value[i+1];\r\n\r\n                return o;\r\n            }\r\n        });\r\n\t}\r\n};\r\n","/*\r\n**\trin/flattenable\r\n**\r\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nlet Class = require('./class');\r\n\r\n/**\r\n**\tClass used to add flattening and unflattening capabilities to any object. A \"flat\" object is an object composed\r\n**\tonly of native types, that is: `null,` `boolean`, `integer`, `number`, `array` or `object`.\r\n*/\r\n\r\nmodule.exports = Class.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"Flattenable\",\r\n\r\n\t/**\r\n\t**\tType schema used to flatten/unflatten the contents of this class. See Schema class for more information.\r\n\t*/\r\n\ttypeSchema: null,\r\n\r\n\t/**\r\n\t**\tReturns the flattened contents of the object.\r\n\t*/\r\n\tflatten: function (context)\r\n\t{\r\n\t\treturn this.typeSchema.flatten(this, context);\r\n\t},\r\n\r\n\t/**\r\n\t**\tUnflattens the given object and overrides the local contents.\r\n\t*/\r\n\tunflatten: async function (value, context)\r\n\t{\r\n\t\tObject.assign(this, await this.typeSchema.unflatten(value, context));\r\n\t\tawait this.onUnflattened();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecuted when the unflatten() method is called on the object.\r\n\t*/\r\n\tonUnflattened: async function ()\r\n\t{\r\n\t}\r\n});\r\n","/*\r\n**\trin/collection\r\n**\r\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nlet Flattenable = require('./flattenable');\r\nlet Schema = require('./schema');\r\nlet Rin = require('./alpha');\r\n\r\n/**\r\n**\tFlattenable collection class, used to store items and manipulate them. The items should also be flattenable.\r\n*/\r\n\r\nmodule.exports = Flattenable.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"Collection\",\r\n\r\n\t/**\r\n\t**\tDescribes the type schema of the underlying items.\r\n\t*/\r\n\titemTypeSchema: null,\r\n\r\n\t/**\r\n\t**\tArray of items.\r\n\t*/\r\n\titems: null, /* Array */\r\n\r\n\t/**\r\n\t**\tConstructs the collection.\r\n\t*/\r\n\t__ctor: function (itemTypeSchema)\r\n\t{\r\n\t\tif (!itemTypeSchema) itemTypeSchema = this.itemTypeSchema;\r\n\r\n\t\tif (itemTypeSchema)\r\n\t\t\tthis.typeSchema = Schema.Property('items').is(Schema.Array().of(itemTypeSchema));\r\n\r\n\t\tthis.reset();\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecuted after the collection has been unflattened, re-adds the items to ensure onItemAdded() is called.\r\n\t*/\r\n\tonUnflattened: function()\r\n\t{\r\n\t\tlet items = this.items;\r\n\t\tthis.reset();\r\n\r\n\t\tfor (let i of items)\r\n\t\t\tthis.add(i);\r\n\t},\r\n\r\n\t/*\r\n\t**\tResets the collection to empty. Note that onItemRemoved will not be called.\r\n\t*/\r\n\treset: function ()\r\n\t{\r\n\t\tthis.items = [];\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tClears the contents of the collection (removes each item manually, onItemRemoved will be called).\r\n\t*/\r\n\tclear: function ()\r\n\t{\r\n\t\tvar items = this.items;\r\n\t\tthis.reset();\r\n\r\n\t\tfor (var i = 0; i < items.length; i++)\r\n\t\t\tthis.onItemRemoved (items[i], 0);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tSorts the collection. A comparison function should be provided, or the name of a property to sort by.\r\n\t**\r\n\t**\tObject sort (fn: Function)\r\n\t**\tObject sort (prop: string, [desc:bool=false])\r\n\t*/\r\n\tsort: function (fn, desc)\r\n\t{\r\n\t\tif (typeof(fn) != \"function\")\r\n\t\t{\r\n\t\t\tthis.items.sort(function(a, b)\r\n\t\t\t{\r\n\t\t\t\treturn (a[fn] <= b[fn] ? -1 : 1) * (desc === true ? -1 : 1);\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis.items.sort(fn);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tSearches for an item with the specified fields and returns it. The \"inc\" object is the \"inclusive\" map, meaning all fields must match\r\n\t**\tand the optional \"exc\" is the exclusive map, meaning not even one field should match.\r\n\t**\r\n\t**\tObject findItem (inc: Object, exc: Object);\r\n\t*/\t\r\n\tfindItem: function (inc, exc)\r\n\t{\r\n\t\tif (!this.items) return null;\r\n\r\n\t\tfor (var i = 0; i < this.items.length; i++)\r\n\t\t{\r\n\t\t\tif (exc && Rin.partialCompare(this.items[i], exc))\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tif (Rin.partialCompare(this.items[i], inc))\r\n\t\t\t\treturn this.items[i];\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the container array.\r\n\t*/\r\n\tgetItems: function ()\r\n\t{\r\n\t\treturn this.items;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the number of items in the collection.\r\n\t*/\r\n\tlength: function ()\r\n\t{\r\n\t\treturn this.items.length;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns true if the collection is empty.\r\n\t*/\r\n\tisEmpty: function ()\r\n\t{\r\n\t\treturn !this.items.length;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the index of the specified item, or -1 if not found.\r\n\t*/\r\n\tindexOf: function (item)\r\n\t{\r\n\t\treturn this.items.indexOf(item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the item at the specified index, or null if not found. When `relative` is true, negative offsets are allowed such that -1 refers to the last item.\r\n\t*/\r\n\tgetAt: function (index, relative=false)\r\n\t{\r\n\t\tif (index < 0 && relative == true)\r\n\t\t\tindex += this.items.length;\r\n\r\n\t\treturn index >= 0 && index < this.items.length ? this.items[index] : null;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the first item in the collection.\r\n\t*/\r\n\tfirst: function ()\r\n\t{\r\n\t\treturn this.getAt(0);\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the last item in the collection.\r\n\t*/\r\n\tlast: function ()\r\n\t{\r\n\t\treturn this.getAt(-1, true);\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item at the specified index, effectively moving the remaining items to the right.\r\n\t*/\r\n\taddAt: function (index, item)\r\n\t{\r\n\t\tif (!item || !this.onBeforeItemAdded (item))\r\n\t\t\treturn this;\r\n\r\n\t\tif (index < 0) index = 0;\r\n\t\tif (index > this.items.length) index = this.items.length;\r\n\r\n\t\tif (index == 0)\r\n\t\t{\r\n\t\t\tthis.items.unshift(item);\r\n\t\t}\r\n\t\telse if (index == this.items.length)\r\n\t\t{\r\n\t\t\tthis.items.push(item);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar tmp = this.items.splice(0, index);\r\n\t\t\ttmp.push(item);\r\n\r\n\t\t\tthis.items = tmp.concat(this.items);\r\n\t\t}\r\n\r\n\t\tthis.onItemAdded (item);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item to the start of the collection, onBeforeItemAdded and onItemAdded will be triggered.\r\n\t*/\r\n\tunshift: function (item)\r\n\t{\r\n\t\treturn this.addAt(0, item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item to the end of the collection, onBeforeItemAdded and onItemAdded will be triggered.\r\n\t*/\r\n\tpush: function (item)\r\n\t{\r\n\t\treturn this.addAt(this.items.length, item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item to the end of the collection, onBeforeItemAdded and onItemAdded will be triggered.\r\n\t*/\r\n\tadd: function (item)\r\n\t{\r\n\t\treturn this.push(item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves the item at the specified index. When `relative` is true, negative offsets are allowed such that -1 refers to the last item.\r\n\t*/\r\n\tremoveAt: function (index, relative=false)\r\n\t{\r\n\t\tif (index < 0 && relative == true)\r\n\t\t\tindex += this.items.length;\r\n\r\n\t\tif (index < 0 || index >= this.items.length)\r\n\t\t\treturn null;\r\n\r\n\t\tvar item = this.items[index];\r\n\t\tthis.items.splice (index, 1);\r\n\t\tthis.onItemRemoved (item, index);\r\n\r\n\t\treturn item;\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves an item from the end of the collection.\r\n\t*/\r\n\tpop: function (item)\r\n\t{\r\n\t\treturn this.removeAt(-1, true);\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves an item from the start of the collection.\r\n\t*/\r\n\tshift: function (item)\r\n\t{\r\n\t\treturn this.removeAt(0);\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves the specified item from the collection.\r\n\t*/\r\n\tremove: function (item)\r\n\t{\r\n\t\treturn this.removeAt (this.indexOf(item));\r\n\t},\r\n\r\n\t/*\r\n\t**\tRuns the specified callback for each of the items in the collection, if false is returned by the callback this function\r\n\t**\twill exit immediately. Parameters to the callback are: (item, index, collection).\r\n\t*/\r\n\tforEach: function (callback)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = 0; i < this.items.length; i++)\r\n\t\t\tif (callback (this.items[i], i, this) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecutes a method call with the specified parameters on each of the items in the collection, if false is returned by the\r\n\t**\titem's method this function will exit immediately.\r\n\t*/\r\n\tforEachCall: function (method, ...args)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = 0; i < this.items.length; i++)\r\n\t\t\tif (this.items[i][method] (...args) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExactly the same as forEach but in reverse order.\r\n\t*/\r\n\tforEachRev: function (callback)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = this.items.length-1; i >= 0; i--)\r\n\t\t\tif (callback (this.items[i], i, this) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExactly the same as forEachCall but in reverse order.\r\n\t*/\r\n\tforEachRevCall: function (method, ...args)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = this.items.length-1; i >= 0; i--)\r\n\t\t\tif (this.items[i][method] (...args) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tHandler for the beforeItemAdded event. If returns false the item will not be added.\r\n\t*/\r\n\tonBeforeItemAdded: function (item)\r\n\t{\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/*\r\n\t**\tHandler for the itemAdded event.\r\n\t*/\r\n\tonItemAdded: function (item)\r\n\t{\r\n\t},\r\n\r\n\t/*\r\n\t**\tHandler for the itemRemoved event.\r\n\t*/\r\n\tonItemRemoved: function (item)\r\n\t{\r\n\t}\r\n});\r\n","/*\n**\trin/template\n**\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nlet Rin = require('./alpha');\n\n/**\n**\tTemplating module. The template formats available are shown below, note that the sym-open and sym-close symbols are by\n**\tdefault the square brackets, however those can be modified since are just parameters.\n**\n**\tHTML Escaped Output:\t\t\t[data.value]\t\t\t\t\tEscapes HTML characters from the output.\n**\tRaw Output:\t\t\t\t\t\t[!data.value]\t\t\t\t\tDoes not escape HTML characters from the output (used to output direct HTML).\n**\tDouble-Quoted Escaped Output:\t[data.value]\t\t\t\t\tEscapes HTML characters and surrounds with double quotes.\n**\tImmediate Reparse:\t\t\t\t[<....] [@....] \"...\" '...'\t\tReparses the contents as if parseTemplate() was called again.\n**\tImmediate Output:\t\t\t\t[:...]\t\t\t\t\t\t\tTakes the contents and outputs exactly as-is without format and optionally surrounded by the\n**\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsym-open and sym-close symbols when the first character is not '<', sym_open or space.\n**\tFiltered Output:\t\t\t\t[functionName ... <expr> ...]\tRuns a function call, 'expr' can be any of the allowed formats shown here (nested if desired),\n**\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfunctionName should map to one of the available expression functions registered in the\n**\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tRin.Template.functions map, each of which have their own parameters.\n*/\n\nlet Template = module.exports =\n{\n\t/*\n\t**\tStrict mode flag. When set, any undefined expression function will trigger an exception.\n\t*/\n\tstrict: false,\n\n\t/**\n\t**\tParses a template and returns the compiled 'parts' structure to be used by the 'expand' method.\n\t**\n\t**\t>> array parseTemplate (string template, char sym_open, char sym_close, bool is_tpl=false);\n\t*/\n\tparseTemplate: function (template, sym_open, sym_close, is_tpl=false, root=1)\n\t{\n\t\tlet nflush = 'string', flush = null, state = 0, count = 0;\n\t\tlet str = '', parts = [], mparts = parts, nparts = false;\n\n\t\tif (is_tpl === true)\n\t\t{\n\t\t\ttemplate = template.trim();\n\t\t\tnflush = 'identifier';\n\t\t\tstate = 10;\n\n\t\t\tmparts.push(parts = []);\n\t\t}\n\n\t\ttemplate += \"\\0\";\n\n\t\tfunction unescape (value)\n\t\t{\n\t\t\tif (typeof(value) == 'object')\n\t\t\t{\n\t\t\t\tif (value instanceof Array)\n\t\t\t\t{\n\t\t\t\t\tfor (let i = 0; i < value.length; i++)\n\t\t\t\t\t\tunescape(value[i]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvalue.data = unescape(value.data);\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < value.length; i++)\n\t\t\t{\n\t\t\t\tif (value[i] == '\\\\')\n\t\t\t\t{\n\t\t\t\t\tlet r = value[i+1];\n\n\t\t\t\t\tswitch (r)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase 'n': r = \"\\n\"; break;\n\t\t\t\t\t\tcase 'r': r = \"\\r\"; break;\n\t\t\t\t\t\tcase 'f': r = \"\\f\"; break;\n\t\t\t\t\t\tcase 'v': r = \"\\v\"; break;\n\t\t\t\t\t\tcase 't': r = \"\\t\"; break;\n\t\t\t\t\t\tcase 's': r = \"\\s\"; break;\n\t\t\t\t\t\tcase '\"': r = \"\\\"\"; break;\n\t\t\t\t\t\tcase \"'\": r = \"\\'\"; break;\n\t\t\t\t\t}\n\n\t\t\t\t\tvalue = value.substr(0, i) + r + value.substr(i+2);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\n\t\tfunction emit (type, data)\n\t\t{\n\t\t\tif (type == 'template')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, sym_open, sym_close, true, 0);\n\t\t\t}\n\t\t\telse if (type == 'parse')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, sym_open, sym_close, false, 0);\n\t\t\t\ttype = 'base-string';\n\n\t\t\t\tif (Rin.typeOf(data) == 'array')\n\t\t\t\t{\n\t\t\t\t\ttype = data[0].type;\n\t\t\t\t\tdata = data[0].data;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (type == 'parse-trim-merge')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data.trim().split('\\n').map(i => i.trim()).join(\"\\n\"), sym_open, sym_close, false, 0);\n\t\t\t}\n\t\t\telse if (type == 'parse-merge')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, sym_open, sym_close, false, 0);\n\t\t\t}\n\t\t\telse if (type == 'parse-merge-alt')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, '{', '}', false, 0);\n\t\t\t}\n\n\t\t\tif (type == 'parse-merge' || type == 'parse-merge-alt' || type == 'parse-trim-merge')\n\t\t\t{\n\t\t\t\tfor (let i = 0; i < data.length; i++)\n\t\t\t\t{\n\t\t\t\t\tparts.push(data[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t\tparts.push({ type: type, data: data });\n\n\t\t\tif (nparts)\n\t\t\t{\n\t\t\t\tmparts.push(parts = []);\n\t\t\t\tnparts = false;\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = 0; i < template.length; i++)\n\t\t{\n\t\t\tif (template[i] == '\\\\')\n\t\t\t{\n\t\t\t\tstr += '\\\\';\n\t\t\t\tstr += template[++i];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (state)\n\t\t\t{\n\t\t\t\tcase 0:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '<')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 1; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'parse-merge';\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '@')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 1; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'parse-trim-merge';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == ':')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 12; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'string';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 1; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'template';\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tstr += template[i];\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\n\t\t\t\tcase 1:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 0;\n\t\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 10:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '.')\n\t\t\t\t\t{\n\t\t\t\t\t\temit (nflush, str);\n\t\t\t\t\t\temit ('access', '.');\n\n\t\t\t\t\t\tnflush = 'identifier';\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i].match(/[\\t\\n\\r\\f\\v ]/) != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\tnflush = 'identifier';\n\t\t\t\t\t\tnparts = true;\n\n\t\t\t\t\t\twhile (template[i].match(/[\\t\\n\\r\\f\\v ]/) != null) i++;\n\t\t\t\t\t\ti--;\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '<')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 11; count = 1; nflush = 'parse-merge';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '@')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 11; count = 1; nflush = 'parse-trim-merge';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '\"')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 14; count = 1; nflush = 'parse-merge';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '\\'')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 15; count = 1; nflush = 'parse-merge';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '`')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 16; count = 1; nflush = 'parse-merge-alt';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == ':')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 13; count = 1; nflush = 'string';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) emit (nflush, str);\n\t\t\t\t\t\tstate = 11; count = 1; str = ''; nflush = 'parse';\n\t\t\t\t\t\tstr += template[i];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (nflush != 'identifier')\n\t\t\t\t\t{\n\t\t\t\t\t\temit (nflush, str);\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tnflush = 'identifier';\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\t\n\t\t\t\tcase 11:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 12:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (str.length != 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (!(str[0] == '<' || str[0] == '[' || str[0] == ' '))\n\t\t\t\t\t\t\t\t\tstr = sym_open + str + sym_close;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tstate = 0;\n\t\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 13:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!(str[0] == '<' || str[0] == '[' || str[0] == ' '))\n\t\t\t\t\t\t\t\tstr = sym_open + str + sym_close;\n\n\t\t\t\t\t\t\tstate = 10;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 14:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == '\"')\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + '\"');\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 15:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == '\\'')\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + '\\'');\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 16:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == '`')\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + '`');\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (flush)\n\t\t\t{\n\t\t\t\temit (flush, str);\n\t\t\t\tflush = str = '';\n\t\t\t}\n\t\t}\n\n\t\tif (!is_tpl)\n\t\t{\n\t\t\tlet i = 0;\n\t\t\twhile (i < mparts.length)\n\t\t\t{\n\t\t\t\tif (mparts[i].type == 'string' && mparts[i].data == '')\n\t\t\t\t\tmparts.splice(i, 1);\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\ti = mparts.length-1;\n\t\t\twhile (i > 0)\n\t\t\t{\n\t\t\t\tif (mparts[i].type == 'string' && mparts[i].data == '')\n\t\t\t\t\tmparts.splice(i--, 1);\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (mparts.length == 0)\n\t\t\t\tmparts.push({ type: 'string', data: '' });\n\t\t}\n\n\t\tif (root)\n\t\t\tunescape(mparts);\n\n\t\treturn mparts;\n\t},\n\n\t/**\n\t**\tParses a template and returns the compiled 'parts' structure to be used by the 'expand' method. This\n\t**\tversion assumes the sym_open and sym_close chars are [ and ] respectively.\n\t**\n\t**\t>> array parse (string template);\n\t*/\n\tparse: function (template)\n\t{\n\t\treturn this.parseTemplate(template.trim(), '[', ']', false);\n\t},\n\n\t/**\n\t**\tRemoves all static parts from a parsed template.\n\t**\n\t**\t>> array clean (array parts);\n\t*/\n\tclean: function (parts)\n\t{\n\t\tfor (let i = 0; i < parts.length; i++)\n\t\t{\n\t\t\tif (parts[i].type != 'template')\n\t\t\t{\n\t\t\t\tparts.splice(i, 1);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\n\t\treturn parts;\n\t},\n\n\t/**\n\t**\tExpands a template using the given data object, ret can be set to 'text' or 'obj' allowing to expand the template as\n\t**\ta string (text) or an array of objects (obj) respectively. If none provided it will be expanded as text.\n\t**\n\t**\t>> string/array expand (array parts, object data, string ret='text', string mode='base-string');\n\t*/\n\texpand: function (parts, data, ret='text', mode='base-string')\n\t{\n\t\tlet s = [];\n\n\t\t// Expand variable parts.\n\t\tif (mode == 'var')\n\t\t{\n\t\t\tlet escape = true;\n\t\t\tlet quote = false;\n\n\t\t\tlet root = data;\n\t\t\tlet last = null;\n\t\t\tlet first = true;\n\t\t\tlet str = '';\n\n\t\t\tfor (let i = 0; i < parts.length && data != null; i++)\n\t\t\t{\n\t\t\t\tswitch (parts[i].type)\n\t\t\t\t{\n\t\t\t\t\tcase 'identifier':\n\t\t\t\t\tcase 'string':\n\t\t\t\t\t\tstr += parts[i].data;\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'template':\n\t\t\t\t\t\tlast = this.expand(parts[i].data, root, 'arg', 'template');\n\t\t\t\t\t\tstr += typeof(last) != 'object' ? last : '';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'base-string':\n\t\t\t\t\t\tstr += this.expand(parts[i].data, root, 'arg', 'base-string');\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'access':\n\t\t\t\t\t\tif (!last || typeof(last) != 'object')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (str == '') str = 'this';\n\n\t\t\t\t\t\t\twhile (true)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (str[0] == '!')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t\tescape = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if (str[0] == '$')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t\tquote = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (str != 'this' && data != null)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet tmp = data;\n\t\t\t\t\t\t\t\tdata = (str in data) ? data[str] : null;\n\n\t\t\t\t\t\t\t\tif (data === null && first)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (str in Template.functions)\n\t\t\t\t\t\t\t\t\t\tdata = Template.functions[str] (null, null, tmp);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfirst = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdata = last;\n\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile (str != '')\n\t\t\t{\n\t\t\t\tif (str[0] == '!')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\tescape = false;\n\t\t\t\t}\n\t\t\t\telse if (str[0] == '$')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\tquote = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (str != 'this')\n\t\t\t{\n\t\t\t\tlet failed = false;\n\n\t\t\t\tif (data != null)\n\t\t\t\t{\n\t\t\t\t\tif (!(str in data))\n\t\t\t\t\t{\n\t\t\t\t\t\tfailed = true;\n\t\t\t\t\t\tdata = null;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tdata = data[str];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tfailed = true;\n\n\t\t\t\tif (failed && parts.length == 1)\n\t\t\t\t{\n\t\t\t\t\tif (Template.strict == true)\n\t\t\t\t\t\tthrow new Error ('Expression function `'+str+'` not found.');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (typeof(data) == 'string')\n\t\t\t{\n\t\t\t\tif (escape)\n\t\t\t\t\tdata = data.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n\n\t\t\t\tif (quote)\n\t\t\t\t\tdata = '\"' + data + '\"';\n\t\t\t}\n\n\t\t\ts.push(data);\n\t\t}\n\n\t\t// Expand variable parts and returns a reference to it.\n\t\tif (ret == 'varref')\n\t\t{\n\t\t\tlet root = data;\n\t\t\tlet last = null;\n\t\t\tlet first = true;\n\t\t\tlet str = '';\n\n\t\t\tfor (let i = 0; i < parts.length && data != null; i++)\n\t\t\t{\n\t\t\t\tswitch (parts[i].type)\n\t\t\t\t{\n\t\t\t\t\tcase 'identifier':\n\t\t\t\t\tcase 'string':\n\t\t\t\t\t\tstr += parts[i].data;\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'template':\n\t\t\t\t\t\tlast = this.expand(parts[i].data, root, 'arg', 'template');\n\t\t\t\t\t\tstr += typeof(last) != 'object' ? last : '';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'base-string':\n\t\t\t\t\t\tstr += this.expand(parts[i].data, root, 'arg', 'base-string');\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'access':\n\t\t\t\t\t\tif (!last || typeof(last) != 'object')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (str == '') str = 'this';\n\n\t\t\t\t\t\t\twhile (true)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (str[0] == '!')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if (str[0] == '$')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (str != 'this' && data != null)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet tmp = data;\n\t\t\t\t\t\t\t\tdata = (str in data) ? data[str] : null;\n\n\t\t\t\t\t\t\t\tif (data === null && first)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (str in Template.functions)\n\t\t\t\t\t\t\t\t\t\tdata = Template.functions[str] (null, null, tmp);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfirst = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdata = last;\n\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile (str != '')\n\t\t\t{\n\t\t\t\tif (str[0] == '!')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t}\n\t\t\t\telse if (str[0] == '$')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn str != 'this' ? [data, str] : null;\n\t\t}\n\n\t\t// Expand function parts.\n\t\tif (mode == 'fn')\n\t\t{\n\t\t\tvar args = [];\n\n\t\t\targs.push(Template.expand(parts[0], data, 'text', 'base-string'));\n\n\t\t\tif ('_'+args[0] in Template.functions)\n\t\t\t\targs[0] = '_'+args[0];\n\n\t\t\tif (!(args[0] in Template.functions))\n\t\t\t{\n\t\t\t\tif (Template.strict == true)\n\t\t\t\t\tthrow new Error ('Expression function `'+args[0]+'` not found.');\n\n\t\t\t\treturn `(Unknown: ${args[0]})`;\n\t\t\t}\n\n\t\t\tif (args[0][0] == '_')\n\t\t\t\treturn Template.functions[args[0]] (parts, data);\n\n\t\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\t\targs.push(Template.expand(parts[i], data, 'arg', 'base-string'));\n\n\t\t\ts.push(Template.functions[args[0]] (args, parts, data));\n\t\t}\n\n\t\t// Template mode.\n\t\tif (mode == 'template')\n\t\t{\n\t\t\tif (parts.length == 1)\n\t\t\t{\n\t\t\t\tif (parts[0].length == 1 && parts[0][0].type == 'string')\n\t\t\t\t\treturn parts[0][0].data;\n\n\t\t\t\tif (parts[0].length == 1 && parts[0][0].type == 'identifier')\n\t\t\t\t{\n\t\t\t\t\tlet name = parts[0][0].data;\n\n\t\t\t\t\tif (name in Template.functions || '_'+name in Template.functions)\n\t\t\t\t\t\treturn Template.expand(parts, data, ret, 'fn');\n\t\t\t\t}\n\t\n\t\t\t\treturn Template.expand(parts[0], data, ret, 'var');\n\t\t\t}\n\n\t\t\treturn Template.expand(parts, data, ret, 'fn');\n\t\t}\n\n\t\t// Expand parts.\n\t\tif (mode == 'base-string')\n\t\t{\n\t\t\tlet index = -1;\n\n\t\t\tfor (let i of parts)\n\t\t\t{\n\t\t\t\tlet tmp = null;\n\t\t\t\tindex++;\n\n\t\t\t\tswitch (i.type)\n\t\t\t\t{\n\t\t\t\t\tcase 'template':\n\t\t\t\t\t\ttmp = Template.expand(i.data, data, ret, 'template');\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'string': case 'identifier':\n\t\t\t\t\t\ttmp = i.data;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'base-string':\n\t\t\t\t\t\ttmp = Template.expand(i.data, data, ret, 'base-string');\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (ret == 'void')\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (ret == 'last' && index != parts.length-1)\n\t\t\t\t\tcontinue;\n\n\t\t\t\ts.push(tmp);\n\t\t\t}\n\t\t}\n\n\t\t// Return types for direct objects.\n\t\tif (ret == 'obj') return s;\n\n\t\tif (ret == 'last')\n\t\t{\n\t\t\tif (typeOf(s) == 'Rose\\\\Arry')\n\t\t\t\ts = s[0];\n\n\t\t\treturn s;\n\t\t}\n\n\t\t// When the output is not really needed.\n\t\tif (ret == 'void') return null;\n\n\t\t// Return as argument ('object' if only one, or string if more than one), that is, the first item in the result.\n\t\tif (ret == 'arg')\n\t\t{\n\t\t\tif (Rin.typeOf(s) == 'array')\n\t\t\t{\n\t\t\t\tif (s.length != 1)\n\t\t\t\t\treturn s.join('');\n\n\t\t\t\treturn s[0];\n\t\t\t}\n\n\t\t\treturn s;\n\t\t}\n\n\t\tif (ret == 'text' && Rin.typeOf(s) == 'array')\n\t\t{\n\t\t\tlet f = (e => e != null && typeof(e) == 'object' ? ('map' in e ? e.map(f).join('') : ('join' in e ? e.join('') : e.toString())) : e);\n\t\t\ts = s.map(f).join('');\n\t\t}\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tParses the given template and returns a function that when called with an object will expand the template.\n\t**\n\t**\t>> object compile (string template);\n\t*/\n\tcompile: function (template)\n\t{\n\t\ttemplate = Template.parse(template);\n\n\t\treturn function (data=null, mode='text') {\n\t\t\treturn Template.expand(template, data ? data : { }, mode);\n\t\t};\n\t},\n\n\t/**\n\t**\tParses and expands the given template immediately.\n\t**\n\t**\t>> object eval (string template, object data, string mode='text');\n\t*/\n\teval: function (template, data=null, mode='text')\n\t{\n\t\ttemplate = Template.parse(template);\n\t\treturn Template.expand(template, data ? data : { }, mode);\n\t},\n\n\t/**\n\t**\tExpands the template as 'arg' and returns the result.\n\t**\n\t**\t>> object value (string parts, object data);\n\t*/\n\tvalue: function (parts, data=null)\n\t{\n\t\treturn Rin.typeOf(parts) != 'array' ? parts : Template.expand(parts, data ? data : { }, 'arg');\n\t},\n\n\t/**\n\t**\tRegisters an expression function.\n\t**\n\t**\t>> object register (string name, function fn);\n\t*/\n\tregister: function (name, fn)\n\t{\n\t\tTemplate.functions[name] = fn;\n\t},\n\n\t/**\n\t**\tCalls an expression function.\n\t**\n\t**\t>> object call (string name, object args, object data);\n\t*/\n\t'call': function (name, args, data=null)\n\t{\n\t\tif (name in Template.functions)\n\t\t\treturn Template.functions[name] (args, null, data);\n\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tReturns a map given a 'parts' array having values of the form \"name: value\" or \":name value\".\n\t**\n\t**\t>> Map getNamedValues (array parts, object data, int i=1, bool expanded=true);\n\t*/\n\tgetNamedValues: function (parts, data, i=1, expanded=true)\n\t{\n\t\tlet s = { };\n\t\tlet mode = 0;\n\t\n\t\tfor (; i < parts.length; i += 2)\n\t\t{\n\t\t\tlet key = Template.expand(parts[i], data, 'arg');\n\n\t\t\tif (!mode) {\n\t\t\t\tif (key.startsWith(':')) mode = 1; else mode = key.endsWith(':') ? 2 : 3;\n\t\t\t}\n\n\t\t\tif (mode == 1)\n\t\t\t\tkey = key.substr(1);\n\t\t\telse if (mode == 2)\n\t\t\t\tkey = key.substr(0, key.length-1);\n\n\t\t\tif (expanded)\n\t\t\t\ts[key] = Template.expand(parts[i+1], data, 'arg');\n\t\t\telse\n\t\t\t\ts[key] = parts[i+1];\n\t\t}\n\n\t\treturn s;\n\t}\n};\n\n\n/**\n**\tTemplate functions, functions that are used to format data. Each function takes three parameters (args, parts and data). By default the function arguments\n**\tare expanded and passed via 'args' for convenience, however if the function name starts with '_' the 'args' parameter will be skipped and only (parts, data)\n**\twill be available, each 'part' must be expanded manually by calling Template.expand.\n*/\n\nTemplate.functions =\n{\n\t/**\n\t**\tExpression functions.\n\t*/\n\t'null': function(args) { return null; },\n\t'true': function(args) { return true; },\n\t'false': function(args) { return false; },\n\n\t'len': function(args) { return args[1].toString().length; },\n\t'int': function(args) { return ~~args[1]; },\n\t'str': function(args) { return args[1].toString(); },\n\t'float': function(args) { return parseFloat(args[1]); },\n\t'chr': function(args) { return String.fromCharCode(args[1]); },\n\t'ord': function(args) { return args[1].toString().charCodeAt(0); },\n\n\t'not': function(args) { return !args[1]; },\n\t'neg': function(args) { return -args[1]; },\n\t'abs': function(args) { return Math.abs(args[1]); },\n\n\t'and': function(args) { for (let i = 1; i < args.length; i++) if (!args[i]) return false; return true; },\n\t'or': function(args) { for (let i = 1; i < args.length; i++) if (~~args[i]) return true; return false; },\n\n\t'eq': function(args) { return args[1] == args[2]; },\n\t'ne': function(args) { return args[1] != args[2]; },\n\t'lt': function(args) { return args[1] < args[2]; },\n\t'le': function(args) { return args[1] <= args[2]; },\n\t'gt': function(args) { return args[1] > args[2]; },\n\t'ge': function(args) { return args[1] >= args[2]; },\n\t'isnotnull': function(args) { return !!args[1]; },\n\t'isnull': function(args) { return !args[1]; },\n\t'iszero': function(args) { return parseInt(args[1]) == 0; },\n\n\t'eq?': function(args) { return args[1] == args[2]; },\n\t'ne?': function(args) { return args[1] != args[2]; },\n\t'lt?': function(args) { return args[1] < args[2]; },\n\t'le?': function(args) { return args[1] <= args[2]; },\n\t'gt?': function(args) { return args[1] > args[2]; },\n\t'ge?': function(args) { return args[1] >= args[2]; },\n\t'notnull?': function(args) { return !!args[1]; },\n\t'null?': function(args) { return !args[1]; },\n\t'zero?': function(args) { return parseInt(args[1]) == 0; },\n\n\t'typeof': function(args) { return Rin.typeOf(args[1]); },\n\n\t'*': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x *= args[i]; return x; },\n\t'/': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x /= args[i]; return x; },\n\t'+': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= -args[i]; return x; },\n\t'-': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= args[i]; return x; },\n\t'mul': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x *= args[i]; return x; },\n\t'div': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x /= args[i]; return x; },\n\t'sum': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= -args[i]; return x; },\n\t'sub': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= args[i]; return x; },\n\t'mod': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x %= args[i]; return x; },\n\t'pow': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x = Math.pow(x, args[i]); return x; },\n\n\t/**\n\t**\tReturns the JSON representation of the expression.\n\t**\n\t**\tjson <expr>\n\t*/\n\t'json': function (args)\n\t{\n\t\treturn JSON.stringify(args[1]);\n\t},\n\n\t/**\n\t**\tSets one or more variables in the data context.\n\t**\n\t**\tset <var-name> <expr> [<var-name> <expr>]*\n\t*/\n\t'_set': function (parts, data)\n\t{\n\t\tfor (let i = 1; i+1 < parts.length; i += 2)\n\t\t{\n\t\t\tlet value = Template.value(parts[i+1], data);\n\n\t\t\tif (parts[i].length > 1)\n\t\t\t{\n\t\t\t\tlet ref = Template.expand(parts[i], data, 'varref');\n\t\t\t\tif (ref != null) ref[0][ref[1]] = value;\n\t\t\t}\n\t\t\telse\n\t\t\t\tdata[Template.value(parts[i], data)] = value;\n\t\t}\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tRemoves one or more variables from the data context.\n\t**\n\t**\tunset <var-name> [<var-name>]*\n\t*/\n\t'_unset': function (parts, data)\n\t{\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t{\n\t\t\tif (parts[i].length > 1)\n\t\t\t{\n\t\t\t\tlet ref = Template.expand(parts[i], data, 'varref');\n\t\t\t\tif (ref != null) delete ref[0][ref[1]];\n\t\t\t}\n\t\t\telse\n\t\t\t\tdelete data[Template.value(parts[i], data)];\n\t\t}\n\n\t\treturn null;\n\t},\n\n\n\t/**\n\t**\tReturns the expression without white-space on the left or right. The expression can be a string or an array.\n\t**\n\t**\ttrim <expr>\n\t*/\n\t'trim': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.trim()) : args[1].trim()) : '';\n\t},\n\n\t/**\n\t**\tReturns the expression in uppercase. The expression can be a string or an array.\n\t**\n\t**\tupper <expr>\n\t*/\n\t'upper': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.toUpperCase()) : args[1].toUpperCase()) : '';\n\t},\n\n\t/**\n\t**\tReturns the expression in lower. The expression can be a string or an array.\n\t**\n\t**\tlower <expr>\n\t*/\n\t'lower': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.toLowerCase()) : args[1].toLowerCase()) : '';\n\t},\n\n\t/**\n\t**\tReturns a sub-string of the given string.\n\t**\n\t**\tsubstr <start> <count> <string>\n\t**\tsubstr <start> <string>\n\t*/\n\t'substr': function (args)\n\t{\n\t\tlet s = args[args.length-1].toString();\n\n\t\tlet start = 0;\n\t\tlet count = null;\n\n\t\tif (args.length == 4)\n\t\t{\n\t\t\tstart = ~~(args[1]);\n\t\t\tcount = ~~(args[2]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstart = ~~(args[1]);\n\t\t\tcount = null;\n\t\t}\n\n\t\tif (start < 0) start += s.length;\n\t\tif (count < 0) count += s.length;\n\n\t\tif (count === null)\n\t\t\tcount = s.length - start;\n\n\t\treturn s.substr(start, count);\n\t},\n\n\t/**\n\t**\tReplaces a matching string with the given replacement string in a given text.\n\t**\n\t**\treplace <search> <replacement> <text>\n\t*/\n\t'replace': function (args)\n\t{\n\t\treturn args[3].split(args[1]).join(args[2]);\n\t},\n\n\t/**\n\t**\tConverts all new-line chars in the expression to <br/>, the expression can be a string or an array.\n\t**\n\t**\tnl2br <expr>\n\t*/\n\t'nl2br': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.replace(/\\n/g, \"<br/>\")) : args[1].replace(/\\n/g, \"<br/>\")) : '';\n\t},\n\n\t/**\n\t**\tReturns the expression inside an XML tag named 'tag-name', the expression can be a string or an array.\n\t**\n\t**\t% <tag-name> <expr>\n\t*/\n\t'%': function (args)\n\t{\n\t\targs.shift();\n\t\tvar name = args.shift();\n\n\t\tlet s = '';\n\n\t\tfor (let i = 0; i < args.length; i++)\n\t\t{\n\t\t\tif (Rin.typeOf(args[i]) == 'array')\n\t\t\t{\n\t\t\t\ts += `<${name}>`;\n\t\t\t\t\n\t\t\t\tfor (let j = 0; j < args[i].length; j++)\n\t\t\t\t\ts += args[i][j];\n\n\t\t\t\ts += `</${name}>`;\n\t\t\t}\n\t\t\telse\n\t\t\t\ts += `<${name}>${args[i]}</${name}>`;\n\t\t}\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tReturns the expression inside an XML tag named 'tag-name', attributes are supported.\n\t**\n\t**\t%% <tag-name> [<attr> <value>]* [<content>]\n\t*/\n\t'%%': function (args)\n\t{\n\t\targs.shift();\n\t\tvar name = args.shift();\n\n\t\tlet attr = '';\n\t\tlet text = '';\n\n\t\tfor (let i = 0; i < args.length; i += 2)\n\t\t{\n\t\t\tif (i+1 < args.length)\n\t\t\t\tattr += ` ${args[i]}=\"${args[i+1]}\"`;\n\t\t\telse\n\t\t\t\ttext = args[i];\n\t\t}\n\n\t\treturn text ? `<${name}${attr}>${text}</${name}>` : `<${name}${attr}/>`;\n\t},\n\n\t/**\n\t**\tJoins the given array expression into a string. The provided string-expr will be used as separator.\n\t**\n\t**\tjoin <string-expr> <array-expr>\n\t*/\n\t'join': function (args)\n\t{\n\t\tif (args[2] && Rin.typeOf(args[2]) == 'array')\n\t\t\treturn args[2].join(args[1]);\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tSplits the given expression by the specified string. Returns an array.\n\t**\n\t**\tsplit <string-expr> <expr>\n\t*/\n\t'split': function (args)\n\t{\n\t\tif (args[2] && typeof(args[2]) == \"string\")\n\t\t\treturn args[2].split(args[1]);\n\n\t\treturn [];\n\t},\n\n\t/**\n\t**\tReturns an array with the keys of the given object-expr.\n\t**\n\t**\tkeys <object-expr>\n\t*/\n\t'keys': function (args)\n\t{\n\t\tif (args[1] && typeof(args[1]) == \"object\")\n\t\t\treturn Object.keys(args[1]);\n\n\t\treturn [];\n\t},\n\n\t/**\n\t**\tReturns an array with the values of the given object-expr.\n\t**\n\t**\tvalues <object-expr>\n\t*/\n\t'values': function (args)\n\t{\n\t\tif (args[1] && typeof(args[1]) == \"object\")\n\t\t\treturn Object.values(args[1]);\n\n\t\treturn [];\n\t},\n\n\t/**\n\t**\tConstructs an array obtained by expanding the given template for each of the items in the list-expr, the mandatory varname\n\t**\tparameter (namely 'i') indicates the name of the variable that will contain the data of each item as the list-expr is\n\t**\ttraversed. Extra variables i# and i## (suffix '#' and '##') are introduced to denote the index/key and numeric index\n\t**\tof the current item respectively, note that the later will always have a numeric value.\n\t**\n\t**\teach <varname> <list-expr> <template>\n\t*/\n\t'_each': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\n\t\tlet s = [];\n\t\tlet j = 0;\n\n\t\tif (!list) return s;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\ts.push(Template.expand(parts[3], data, 'text'));\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tExpands the given template for each of the items in the list-expr, the mandatory varname parameter (namely 'i') indicates the name of the variable\n\t**\tthat will contain the data of each item as the list-expr is traversed. Extra variables i# and i## (suffix '#' and '##') are introduced to denote\n\t**\tthe index/key and numeric index of the current item respectively, note that the later will always have a numeric value.\n\t**\n\t**\tDoes not produce any output (returns null).\n\t**\n\t**\tforeach <varname> <list-expr> <template>\n\t*/\n\t'_foreach': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\n\t\tlet j = 0;\n\n\t\tif (!list) return null;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\tTemplate.expand(parts[3], data, 'text');\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tReturns the valueA if the expression is true otherwise valueB, this is a short version of the 'if' function with the\n\t**\tdifference that the result is 'obj' instead of text.\n\t**\n\t**\t? <expr> <valueA> [<valueB>]\n\t*/\n\t'_?': function (parts, data)\n\t{\n\t\tif (Template.expand(parts[1], data, 'arg'))\n\t\t\treturn Template.expand(parts[2], data, 'arg');\n\n\t\tif (parts.length > 3)\n\t\t\treturn Template.expand(parts[3], data, 'arg');\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tReturns the valueA if it is not null (or empty or zero), otherwise returns valueB.\n\t**\n\t**\t?? <valueA> <valueB>\n\t*/\n\t'_??': function (parts, data)\n\t{\n\t\tlet value = Template.expand(parts[1], data, 'arg');\n\t\tif (value) return value;\n\t\n\t\treturn Template.expand(parts[2], data, 'arg');\n\t},\n\n\t/**\n\t**\tReturns the value if the expression is true, supports 'elif' and 'else' as well. The result of this function is always text.\n\t**\n\t**\tif <expr> <value> [elif <expr> <value>] [else <value>]\n\t*/\n\t'_if': function (parts, data)\n\t{\n\t\tfor (let i = 0; i < parts.length; i += 3)\n\t\t{\n\t\t\tif (Template.expand(parts[i], data, 'arg') == 'else')\n\t\t\t\treturn Template.expand(parts[i+1], data, 'text');\n\n\t\t\tif (Template.expand(parts[i+1], data, 'arg'))\n\t\t\t\treturn Template.expand(parts[i+2], data, 'text');\n\t\t}\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tLoads the expression value and attempts to match one case.\n\t**\n\t**\tswitch <expr> <case1> <value1> ... <caseN> <valueN> default <defvalue> \n\t*/\n\t'_switch': function (parts, data)\n\t{\n\t\tlet value = Template.expand(parts[1], data, 'arg');\n\n\t\tfor (let i = 2; i < parts.length; i += 2)\n\t\t{\n\t\t\tlet case_value = Template.expand(parts[i], data, 'arg');\n\t\t\tif (case_value == value || case_value == 'default')\n\t\t\t\treturn Template.expand(parts[i+1], data, 'text');\n\t\t}\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tExits the current inner most loop.\n\t**\n\t**\tbreak\n\t*/\n\t'_break': function (parts, data)\n\t{\n\t\tthrow new Error('EXC_BREAK');\n\t},\n\n\t/**\n\t**\tSkips execution and continues the next cycle of the current inner most loop.\n\t**\n\t**\tcontinue\n\t*/\n\t'_continue': function (parts, data)\n\t{\n\t\tthrow new Error('EXC_CONTINUE');\n\t},\n\n\t/**\n\t**\tConstructs an array with the results of repeating the specified template for a number of times.\n\t**\n\t**\trepeat <varname:i> [from <number>] [to <number>] [count <number>] [step <number>] <template>\n\t*/\n\t'_repeat': function (parts, data)\n\t{\n\t\tif (parts.length < 3 || (parts.length & 1) != 1)\n\t\t\treturn '(`repeat`: Wrong number of parameters)';\n\n\t\tlet var_name = Template.value(parts[1], data);\n\t\tlet count = null;\n\t\tlet from = 0, to = null;\n\t\tlet step = null;\n\n\t\tfor (let i = 2; i < parts.length-1; i+=2)\n\t\t{\n\t\t\tlet value = Template.value(parts[i], data);\n\n\t\t\tswitch (value.toLowerCase())\n\t\t\t{\n\t\t\t\tcase 'from':\n\t\t\t\t\tfrom = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'to':\n\t\t\t\t\tto = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'count':\n\t\t\t\t\tcount = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'step':\n\t\t\t\t\tstep = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tlet tpl = parts[parts.length-1];\n\t\tlet arr = [];\n\n\t\tif (to !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = from > to ? -1 : 1;\n\n\t\t\tif (step < 0)\n\t\t\t{\n\t\t\t\tfor (let i = from; i >= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfor (let i = from; i <= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (count !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\n\t\t\tfor (let i = from; count > 0; count--, i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t} catch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\t\n\t\t\tfor (let i = from; ; i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdelete data[var_name];\n\t\treturn arr;\n\t},\n\n\t/**\n\t**\tRepeats the specified template for a number of times.\n\t**\n\t**\tfor <varname:i> [from <number>] [to <number>] [count <number>] [step <number>] <template>\n\t*/\n\t'_for': function (parts, data)\n\t{\n\t\tif (parts.length < 3 || (parts.length & 1) != 1)\n\t\t\treturn '(`for`: Wrong number of parameters)';\n\n\t\tlet var_name = Template.value(parts[1], data);\n\t\tlet count = null;\n\t\tlet from = 0; to = null;\n\t\tlet step = null;\n\n\t\tfor (let i = 2; i < parts.length-1; i+=2)\n\t\t{\n\t\t\tvalue = Template.value(parts[i], data);\n\n\t\t\tswitch (value.toLowerCase())\n\t\t\t{\n\t\t\t\tcase 'from':\n\t\t\t\t\tfrom = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'to':\n\t\t\t\t\tto = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'count':\n\t\t\t\t\tcount = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'step':\n\t\t\t\t\tstep = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tlet tpl = parts[parts.length-1];\n\n\t\tif (to !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = from > to ? -1 : 1;\n\n\t\t\tif (step < 0)\n\t\t\t{\n\t\t\t\tfor (let i = from; i >= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfor (let i = from; i <= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (count !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\n\t\t\tfor (let i = from; count > 0; count--, i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\t\n\t\t\tfor (let i = from; ; i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdelete data[var_name];\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tRepeats the specified template infinitely until a \"break\" is found.\n\t**\n\t**\tloop <template>\n\t*/\n\t'_loop': function (parts, data)\n\t{\n\t\tif (parts.length < 2)\n\t\t\treturn '(`loop`: Wrong number of parameters)';\n\n\t\tlet tpl = parts[1];\n\n\t\twhile (true)\n\t\t{\n\t\t\ttry {\n\t\t\t\tTemplate.value(tpl, data);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tlet name = e.message;\n\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tWrites the specified arguments to the console.\n\t**\n\t**\techo <expr> [<expr>...]\n\t*/\n\t'_echo': function (parts, data)\n\t{\n\t\tlet s = '';\n\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\ts += Template.expand(parts[i], data, 'arg');\n\n\t\tconsole.log(s);\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tConstructs a list from the given arguments and returns it.\n\t**\n\t**\t# <expr> [<expr>...]\n\t*/\n\t'_#': function (parts, data)\n\t{\n\t\tlet s = [];\n\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\ts.push(Template.expand(parts[i], data, 'arg'));\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tConstructs a non-expanded list from the given arguments and returns it.\n\t**\n\t**\t## <expr> [<expr>...]\n\t*/\n\t'_##': function (parts, data)\n\t{\n\t\tlet s = [];\n\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\ts.push(parts[i]);\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tConstructs an associative array (dictionary) and returns it.\n\t**\n\t**\t& <name>: <expr> [<name>: <expr>...]\n\t**\t& :<name> <expr> [:<name> <expr>...]\n\t*/\n\t'_&': function (parts, data)\n\t{\n\t\treturn Template.getNamedValues (parts, data, 1, true);\n\t},\n\n\t/**\n\t**\tConstructs a non-expanded associative array (dictionary) and returns it.\n\t**\n\t**\t&& <name>: <expr> [<name>: <expr>...]\n\t**\t&& :<name> <expr> [:<name> <expr>...]\n\t*/\n\t'_&&': function (parts, data)\n\t{\n\t\treturn Template.getNamedValues (parts, data, 1, false);\n\t},\n\n\t/**\n\t**\tReturns true if the specified map contains all the specified keys. If it fails the global variable `err` will contain an error message.\n\t**\n\t**\tcontains <expr> <name> [<name>...]\n\t*/\n\t'contains': function (args, parts, data)\n\t{\n\t\tlet value = args[1];\n\n\t\tif (typeof(value) != 'object')\n\t\t{\n\t\t\tdata.err = 'Argument is not a Map';\n\t\t\treturn false;\n\t\t}\n\n\t\tlet s = '';\n\n\t\tfor (let i = 2; i < args.length; i++)\n\t\t{\n\t\t\tif (!(args[i] in value))\n\t\t\t\ts += ', '+args[i];\n\t\t}\n\n\t\tif (s != '')\n\t\t{\n\t\t\tdata.err = s.substr(1);\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tReturns true if the specified map has the specified key. Returns boolean.\n\t**\n\t**\thas <name> <expr>\n\t*/\n\t'has': function (args, parts, data)\n\t{\n\t\tlet value = args[2];\n\n\t\tif (Rin.typeOf(value) != 'object')\n\t\t\treturn false;\n\n\t\treturn args[1] in value;\n\t},\n\n\t/**\n\t**\tReturns a new array/map contaning the transformed values of the array/map (evaluating the template). And just as in 'each', the i# and i## variables be available.\n\t**\n\t**\tmap <varname> <list-expr> <template>\n\t*/\n\t'_map': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\t\tif (!list) return list;\n\n\t\tlet arrayMode = Rin.typeOf(list) == 'array' ? true : false;\n\t\tlet output = arrayMode ? [] : {};\n\t\tlet j = 0;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\tif (arrayMode)\n\t\t\t\toutput.push(Template.expand(parts[3], data, 'arg'));\n\t\t\telse\n\t\t\t\toutput[i] = Template.expand(parts[3], data, 'arg');\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn output;\n\t},\n\n\t/**\n\t**\tReturns a new array/map contaning the elements where the template evaluates to non-zero. Just as in 'each', the i# and i## variables be available.\n\t**\n\t**\tfilter <varname> <list-expr> <template>\n\t*/\n\t'_filter': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\t\tif (!list) return list;\n\n\t\tlet arrayMode = Rin.typeOf(list) == 'array' ? true : false;\n\t\tlet output = arrayMode ? [] : {};\n\t\tlet j = 0;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\tif (~~Template.expand(parts[3], data, 'arg'))\n\t\t\t{\n\t\t\t\tif (arrayMode)\n\t\t\t\t\toutput.push(list[i]);\n\t\t\t\telse\n\t\t\t\t\toutput[i] = list[i];\n\t\t\t}\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn output;\n\t},\n\n\t/**\n\t**\tExpands the specified template string with the given data. The sym_open and sym_close will be '{' and '}' respectively.\n\t**\tIf no data is provided, current data parameter will be used.\n\t**\n\t**\texpand <template> <data>\n\t*/\n\t'expand': function (args, parts, data)\n\t{\n\t\treturn Template.expand (Template.parseTemplate (args[1], '{', '}'), args.length == 3 ? args[2] : data);\n\t},\n\n\t/**\n\t**\tCalls a function described by the given parameter.\n\t**\n\t**\tcall <function> <args...>\n\t*/\n\t'_call': function (parts, data)\n\t{\n\t\tlet ref = Template.expand(parts[1], data, 'varref');\n\n\t\tif (!ref || typeof(ref[0][ref[1]]) != 'function')\n\t\t\tthrow new Error ('Expression is not a function: ' + Template.expand(parts[1], data, 'obj').map(i => i == null ? '.' : i).join(''));\n\n\t\tlet args = [];\n\n\t\tfor (let i = 2; i < parts.length; i++)\n\t\t\targs.push(Template.value(parts[i], data));\n\n\t\treturn ref[0][ref[1]] (...args);\n\t},\n};\n","/*\n**\tutils/recycler.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst recyclingFacilities = { };\n\nconst Recycler = { };\nexport default Recycler;\n\n/**\n**\tAttaches recycling methods (alloc, dispose) to the specified class. Class should have methods __reinit to reinitialize the\n**\tobject and __dtor to destroy it.\n**\n**\t>> void attachTo (function classConstructor, int maxPoolSize=1024);\n*/\n\nRecycler.attachTo = function (_class, _maxPoolSize)\n{\n\tif (!_maxPoolSize) _maxPoolSize = 1024;\n\n\tif (!_class.prototype.className)\n\t\tthrow new Error ('Unable to attach recycler functions to unnamed class.');\n\n\trecyclingFacilities[_class.prototype.className] = _class;\n\n\t_class.recyclerPool = [ ];\n\n\t_class.prototype.objectId = 0;\n\t_class.nextObjectId = 0;\n\n\t_class.createdItems = 0;\n\t_class.restoredItems = 0;\n\t_class.recycledItems = 0;\n\n\t_class.alloc = function()\n\t{\n\t\tvar item;\n\n\t\tif (!this.recyclerPool.length)\n\t\t{\n\t\t\titem = new _class ();\n\t\t\t_class.createdItems++;\n\t\t}\n\t\telse\n\t\t{\n\t\t\titem = this.recyclerPool.pop();\n\t\t\t_class.restoredItems++;\n\t\t}\n\n\t\tif (\"__reinit\" in item)\n\t\t\titem.__reinit.apply(item, arguments);\n\n\t\titem.objectId = ++this.nextObjectId;\n\t\tthis.nextObjectId = this.nextObjectId & 0x3FFFFFFF;\n\n\t\treturn item;\n\t};\n\n\t_class.free = function(item)\n\t{\n\t\tif (item) item.dispose();\n\t};\n\n\t_class.prototype.dispose = function (reason)\n\t{\n\t\tif (this.objectId == 0)\n\t\t{\n\t\t\tconsole.error ('Already disposed (' + _class.prototype.className + '): ' + reason + ' / ' + this.disposeReason);\n\t\t\treturn;\n\t\t}\n\n\t\tif (\"__dtor\" in this) this.__dtor();\n\n\t\t_class.recycledItems++;\n\n\t\tthis.objectId = 0;\n\t\tthis.disposeReason = reason;\n\n\t\tif (_class.recyclerPool.length < _maxPoolSize)\n\t\t\t_class.recyclerPool.push (this);\n\t};\n};\n\n\n/**\n**\tShows stats about all recycling facilities using console.debug.\n**\n**\tvoid showStats();\n*/\n\nRecycler.showStats = function ()\n{\n\tconsole.group(\"Recycling Facilities\");\n\n\tfor (var i in recyclingFacilities)\n\t{\n\t\tvar c = recyclingFacilities[i];\n\t\tconsole.debug (i + \": created=\" + c.createdItems + \", restored=\" + c.restoredItems + \", recycled=\" + c.recycledItems + \", available=\" + c.recyclerPool.length);\n\t}\n\n\tconsole.groupEnd();\n};\n","/*\n**\tutils/linkable.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Recycler from './recycler.js';\n\n/**\n**\tGeneric class for linkable items such as required by linked lists. The responsibility of this class is\n**\tto wrap a value into a linkable object.\n*/\n\nconst Linkable = Class.extend\n({\n\tclassName: \"Linkable\",\n\n\t/**\n\t**\tPointer to the previous item in the chain.\n\t*/\n\tprev: null, /* Linkable */\n\n\t/**\n\t**\tPointer to the next item in the chain.\n\t*/\n\tnext: null, /* Linkable */\n\n\t/**\n\t**\tWrapped value.\n\t*/\n\tvalue: null,\n\n\t/**\n\t**\tConstructs the linkable to wrap the specified value.\n\t*/\n\t__ctor: function (value)\n\t{\n\t\tthis.value = value;\n\t\tthis.clear();\n\t},\n\n\t/**\n\t**\tInitializes the linkable item. Makes sure the previous and next pointers are clear.\n\t*/\n\t__reinit: function (value)\n\t{\n\t\tthis.value = value;\n\t\tthis.clear();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tDestructor.\n\t*/\n\t__dtor: function ()\n\t{\n\t},\n\n\t/**\n\t**\tSets the previous/next connection pointers to null. Returns `this`.\n\t*/\n\tclear: function () /*Linkable*/\n\t{\n\t\tthis.next = this.prev = null;\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tLinks the item such that it will be located after the given reference.\n\t*/\n\tlinkAfter: function (/*Linkable*/ref)\n\t{\n\t\tthis.prev = ref;\n\t\tthis.next = ref ? ref.next : null;\n\n\t\tif (ref)\n\t\t{\n\t\t\tif (ref.next) ref.next.prev = this;\n\t\t\tref.next = this;\n\t\t}\n\t},\n\n\t/**\n\t**\tLinks the item such that it will be located before the given reference.\n\t*/\n\tlinkBefore: function (/*Linkable*/ref)\n\t{\n\t\tthis.prev = ref ? ref.prev : null;\n\t\tthis.next = ref;\n\n\t\tif (ref)\n\t\t{\n\t\t\tif (ref.prev) ref.prev.next = this;\n\t\t\tref.prev = this;\n\t\t}\n\t},\n\n\t/**\n\t**\tUnlinks the item by linking the `prev` and `next` together (when available) and returns `this`.\n\t*/\n\tunlink: function () /*Linkable*/\n\t{\n\t\tif (this.prev) this.prev.next = this.next;\n\t\tif (this.next) this.next.prev = this.prev;\n\n\t\treturn this.clear ();\n\t}\n});\n\nRecycler.attachTo (Linkable);\n\nexport default Linkable;\n","/*\n**\tutils/list.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Linkable from './linkable.js';\n\n/**\n**\tImplementation of a linked list.\n*/\n\nexport default Class.extend\n({\n\t/**\n\t**\tName of the class (for inheritance purposes).\n\t*/\n\tclassName: \"List\",\n\n\t/**\n\t**\tPointer to the first item in the list.\n\t*/\n\ttop: null, /* Linkable */\n\n\t/**\n\t**\tPointer to the last item in the list.\n\t*/\n\tbottom: null, /* Linkable */\n\n\t/**\n\t**\tCount of items in the list.\n\t*/\n\tcount: 0,\n\n\t/**\n\t**\tConstructor of the list.\n\t*/\n\t__ctor: function ()\n\t{\n\t\tthis.top = null;\n\t\tthis.bottom = null;\n\t\tthis.count = 0;\n\t},\n\n\t/**\n\t**\tTraverses the list and destroys all nodes. The actual values are maintained. To destroy the\n\t**\tlist contents call clear() instead.\n\t*/\n\t__dtor: function ()\n\t{\n\t\tthis.reset();\n\t},\n\n\t/**\n\t**\tTraverses the list and destroys all nodes and values.\n\t*/\n\tclear: function () /*List*/\n\t{\n\t\tvar item, nextItem;\n\n\t\tfor (item = this.top; item != null; item = nextItem)\n\t\t{\n\t\t\tnextItem = item.next;\n\n\t\t\tdispose(item.value);\n\t\t\tdispose(item);\n\t\t}\n\n\t\tthis.top = this.bottom = null;\n\t\tthis.count = 0;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tTraverses the list and destroys all nodes. Values are preserved.\n\t*/\n\treset: function ()\n\t{\n\t\tvar item, nextItem;\n\n\t\tfor (item = this.top; item != null; item = nextItem)\n\t\t{\n\t\t\tnextItem = item.next;\n\t\t\tdispose(item);\n\t\t}\n\n\t\tthis.top = this.bottom = null;\n\t\tthis.count = 0;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns an item given its index.\n\t*/\n\tgetAt: function (index) /*(value)*/\n\t{\n\t\tvar item = null;\n\n\t\tfor (item = this.top; item && index--; item = item.next);\n\n\t\treturn item != null ? item.value : null;\n\t},\n\n\t/**\n\t**\tReturns the node at the given index.\n\t*/\n\tgetNodeAt: function (index) /*Linkable*/\n\t{\n\t\tvar item = null;\n\n\t\tfor (item = this.top; item && index--; item = item.next);\n\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tReturns the node of an item given another element to compare, uses identical comparison to match the item.\n\t*/\n\tsgetNode: function (value) /*Linkable*/\n\t{\n\t\tfor (var item = this.top; item; item = item.next)\n\t\t\tif (item.value == value) return item;\n\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tRemoves the given item from the list and returns the item.\n\t*/\n\tremove: function (/*Linkable*/item) /*any*/\n\t{\n\t\tif (item != null && !('isInstanceOf' in item && item.isInstanceOf(Linkable)))\n\t\t\titem = this.sgetNode(item);\n\n\t\tif (!item) return null;\n\n\t\tif (!item.prev) this.top = item.next;\n\t\tif (!item.next) this.bottom = item.prev;\n\n\t\tthis.count--;\n\n\t\tvar value = item.unlink().value;\n\t\tdispose(item);\n\n\t\treturn value;\n\t},\n\n\t/**\n\t**\tAdds an item before the given reference.\n\t*/\n\tinsertBefore: function (/*Linkable*/ref, /*any*/value) /*List*/\n\t{\n\t\tif (!ref) return this;\n\n\t\tvar item = Linkable.alloc(value);\n\n\t\titem.linkBefore (ref);\n\n\t\tif (ref == this.top) this.top = item;\n\t\tthis.count++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t**\tAdds an item after the given reference.\n\t*/\n\tinsertAfter: function (/*Linkable*/ref, /*any*/value) /*List*/\n\t{\n\t\tif (!ref) return this;\n\n\t\tvar item = Linkable.alloc(value);\n\n\t\titem.linkAfter (ref);\n\n\t\tif (ref == this.bottom) this.bottom = item;\n\t\tthis.count++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t**\tAdds an item to the top of the list.\n\t*/\n\tunshift: function (value) /* List */\n\t{\n\t\tvar item = Linkable.alloc(value);\n\n\t\titem.linkBefore (this.top);\n\t\tif (!this.bottom) this.bottom = item;\n\n\t\tthis.top = item;\n\t\tthis.count++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t**\tRemoves an item from the top of the list.\n\t*/\n\tshift: function () /*any*/\n\t{\n\t\tvar item = this.top;\n\t\tif (!item) return null;\n\n\t\tif (!(this.top = item.next)) this.bottom = null;\n\t\tthis.count--;\n\n\t\tvar value = item.unlink().value;\n\t\tdispose(item);\n\n\t\treturn value;\n\t},\n\n\t/**\n\t**\tAdds an item to the bottom of the list.\n\t*/\n\tpush: function (value) /* List */\n\t{\n\t\tvar item = Linkable.alloc(value);\n\n\t\titem.linkAfter (this.bottom);\n\t\tif (!this.top) this.top = item;\n\n\t\tthis.bottom = item;\n\t\tthis.count++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t**\tRemoves an item from the bottom of the list.\n\t*/\n\tpop: function () /*any*/\n\t{\n\t\tvar item = this.bottom;\n\t\tif (!item) return null;\n\n\t\tif (!(this.bottom = item.prev)) this.top = null;\n\t\tthis.count--;\n\n\t\tvar value = item.unlink().value;\n\t\tdispose(item);\n\n\t\treturn value;\n\t},\n\n\t/**\n\t**\tAppends all contents of a given list to the list.\n\t*/\n\tappend: function (/*List*/list) /*List*/\n\t{\n\t\tfor (var i = list.top; i; i = i.next)\n\t\t\tthis.push(i.value);\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tTraverses the list calling the specified function for each item.\n\t*/\n\tforEach: function(fn)\n\t{\n\t\tlet ni;\n\t\n\t\tfor (let i = this.top; i; i = ni)\n\t\t{\n\t\t\tni = i.next;\n\t\t\tif (fn (i.value, i, this) === false) return false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/*\n\t**\tTraverses the list in reverse order, calling the specified function for each item.\n\t*/\n\tforEachRev: function(fn)\n\t{\n\t\tlet ni;\n\t\n\t\tfor (let i = this.bottom; i; i = ni)\n\t\t{\n\t\t\tni = i.prev;\n\t\t\tif (fn (i.value, i, this) === false) return false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/*\n\t**\tReturns the first item where the filter function returns true.\n\t*/\n\tfind: function (filter)\n\t{\n\t\tlet item = null;\n\n\t\tthis.forEach(function(elem) { if (filter(elem)) { item = elem; return false; } });\n\t\treturn item;\n\t},\n\n\t/*\n\t**\tReturns an array with all items where the filter function returns true.\n\t*/\n\tfilter: function (filter)\n\t{\n\t\tlet list = [];\n\n\t\tthis.forEach(function(elem) { if (filter(elem)) list.push(elem); } );\n\t\treturn list;\n\t}\n});\n","/*\n**\tsystem/timer.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tTimer class.\n**\n**\tTimer __constructor (float interval, function callback);\n*/\nconst Timer = function (interval, callback)\n{\n\tthis.callback = callback;\n\tthis.interval = interval;\n};\n\n/**\n**\tTimeout handler.\n**\n**\tvoid onTimeout();\n*/\nTimer.prototype.onTimeout = function ()\n{\n\tif (!this.isRunning) return;\n\n\tthis.rTime = hrnow() - this.startTime;\n\n\tvar tError = this.rTime - (this.sTime + this.interval);\n\tif (tError < 0)\n\t{\n\t\tthis.runAfter(-tError);\n\t\treturn;\n\t}\n\n\tthis.sTime += this.interval * (1 + int(tError / this.interval));\n\n\tthis.tDelta = tError < 0 ? this.interval : (this.rTime - this.lTime);\n\tthis.lTime = this.rTime;\n\n\tthis.callback (this.tDelta, this);\n\tthis.runAfter((this.sTime + this.interval) - (hrnow() - this.startTime));\n};\n\n\n/**\n**\tTimer start handler (overridable).\n**\n**\tvoid onStart();\n*/\nTimer.prototype.onStart = function ()\n{\n};\n\n\n/**\n**\tStarts the timer. When immediate is `true` the callback will be executed immediately. The scale parameter is used to control when to\n**\ttrigger the first timeout, set to timeInterval*scale.\n**\n**\tvoid start (bool immediate=false, float scale=1.0);\n*/\nTimer.prototype.start = function (immediate=false, scale=1.0)\n{\n\tthis.startTime = hrnow();\n\n\tthis.sTime = 0;\n\tthis.lTime = 0;\n\n\tthis.lastTime = hrnow();\n\tthis.isRunning = true;\n\n\tthis.onStart();\n\n\tif (immediate)\n\t\tthis.callback (0, this);\n\n\tthis.runAfter(this.interval*scale);\n};\n\n\n/**\n**\tExecutes the timer onTimeout() after the specified amount of milliseconds.\n**\n**\tvoid runAfter (int timeout);\n*/\nTimer.prototype.runAfter = function (timeout)\n{\n\tif (process.browser)\n\t\trequestAnimationFrame(() => this.onTimeout());\n\telse\n\t\tsetTimeout (() => this.onTimeout(), 0);\n};\n\n/**\n**\tStops the timer.\n**\n**\tvoid stop();\n*/\nTimer.prototype.stop = function ()\n{\n\tthis.isRunning = false;\n};\n\nexport default Timer;\n","/*\n**\tmath/matrix.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tRepresents a 3x3 matrix. Provides an interface to manipulate 3x3 matrices.\n*/\n\n/**\n**\tConstructs a Matrix object. The components are set to the identity matrix.\n*/\n\nconst Matrix = function ()\n{\n\tthis.data = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n};\n\nexport default Matrix;\n\n\n/**\n**\tReturns a string representation of the matrix.\n**\n**\t>> string toString()\n*/\nMatrix.prototype.toString = function ()\n{\n\treturn `[${this.data[0]}, ${this.data[3]}, ${this.data[6]}]\\n[${this.data[1]}, ${this.data[4]}, ${this.data[7]}]\\n[${this.data[2]}, ${this.data[5]}, ${this.data[8]}]\\n`;\n};\n\n\n/**\n**\tFills the matrix with zeroes.\n*/\nMatrix.prototype.zero = function()\n{\n\tthis.data.fill(0);\n\treturn this;\n};\n\n/**\n**\tFills the matrix with the specified value.\n*/\nMatrix.prototype.fill = function (value)\n{\n\tthis.data.fill(value);\n\treturn this;\n};\n\n/**\n**\tSets all matrix elements to a given value.\n**\n**\t>> Matrix set (float value);\n*/\nMatrix.prototype.set = function (value)\n{\n\tif (value instanceof Matrix)\n\t{\n\t\tfor (let i = 0; i < 9; i++)\n\t\t\tthis.data[i] = value.data[i];\n\t}\n\telse if (value instanceof Array)\n\t{\n\t\tfor (let i = 0; i < 9; i++)\n\t\t\tthis.data[i] = value[i];\n\t}\n\telse\n\t{\n\t\tabort();\n\t}\n\n\treturn this;\n};\n\n\n/**\n**\tSets the matrix to the identity matrix.\n**\n**\t>> Matrix identity();\n*/\nMatrix.prototype.identity = function ()\n{\n\tthis.data.fill(0);\n\tthis.data[0] = this.data[4] = this.data[8] = 1;\n\treturn this;\n};\n\n\n/**\n**\tMultiplies all elements in the matrix by a given scalar.\n**\n**\t>> Matrix scalef (float f);\n*/\nMatrix.prototype.scalef = function (f)\n{\n\tfor (let i = 0; i < 9; i++) this.data[i] *= f;\n\treturn this;\n};\n\n\n/**\n**\tReturns a new matrix with the same values as this one.\n**\n**\t>> Matrix clone();\n*/\nMatrix.prototype.clone = function ()\n{\n\tvar matr = new Matrix ();\n\n\tfor (var i = 0; i < 9; i++) matr.data[i] = this.data[i];\n\treturn matr;\n};\n\n\n/**\n**\tAppends two matrices (the current one and the given one) by using matrix multiplication.\n**\n**\tMatrix append (Matrix matr);\n*/\nMatrix.prototype.append = function (matr)\n{\n\tvar i, j, k, m, temp = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n\n\tif (matr instanceof Matrix)\n\t\tmatr = matr.data;\n\n\tfor (j = 0; j < 3; j++)\n\t{\n\t\tfor (i = 0; i < 3; i++)\n\t\t{\n\t\t\tm = 0;\n\n\t\t\tfor (k = 0; k < 3; k++) {\n\t\t\t\tm += matr[j*3+k] * this.data[k*3+i];\n\t\t\t}\n\n\t\t\ttemp[j*3+i] = m;\n\t\t}\n\t}\n\n\tfor (i = 0; i < 9; i++) this.data[i] = temp[i];\n\treturn this;\n};\n\n/**\n**\tCreates a translation matrix and appends it to the current matrix.\n**\n**\t>> Matrix translate (float x, float y);\n*/\nMatrix.prototype.translate = function (x, y)\n{\n\tif (x == 0 && y == 0)\n\t\treturn this;\n\n\treturn this.append ([\n\t\t1, 0, 0,\n\t\t0, 1, 0,\n\t\tx, y, 1\n\t]);\n};\n\n/**\n**\tCreates a rotation matrix for the given angle (in radians) and appends it to the current matrix.\n**\n**\t>> Matrix rotate (float angle);\n*/\nMatrix.prototype.rotate = function (angle)\n{\n\tif (angle == 0)\n\t\treturn this;\n\n\treturn this.append ([\n\t\tMath.cos(angle), -Math.sin(angle), 0,\n\t\tMath.sin(angle), Math.cos(angle), 0,\n\t\t0, 0, 1\n\t]);\n};\n\n\n/**\n**\tCreates a scale transformation matrix and appends it to the current matrix.\n**\n**\t>> Matrix scale (float sx, float sy);\n*/\n\nMatrix.prototype.scale = function (sx, sy)\n{\n\tif (sx == 1 && sy == 1)\n\t\treturn this;\n\n\treturn this.append ([\n\t\tsx, 0, 0,\n\t\t0, sy, 0,\n\t\t0, 0, 1\n\t]);\n};\n\n\n/**\n**\tApplies the matrix to a vector to transform it and returns a new vector.\n**\n**\t>> Object{x,y} applyTo (float x, float y);\n*/\n\nMatrix.prototype.applyTo = function (x, y)\n{\n\tvar nx = this.data[0]*x + this.data[3]*y + this.data[6];\n\tvar ny = this.data[1]*x + this.data[4]*y + this.data[7];\n\n\treturn { x:nx, y:ny };\n};\n\n\n/**\n**\tReturns the transpose of the matrix.\n**\n**\t>> Matrix transpose();\n*/\n\nMatrix.prototype.transpose = function ()\n{\n\tvar temp = [0, 0, 0, 0, 0, 0, 0, 0, 0];\n\n\tfor (var j = 0; j < 3; j++)\n\tfor (var i = 0; i < 3; i++)\n\t\ttemp[j*3+i] = this.data[i*3+j];\n\n\tfor (let i = 0; i < 9; i++)\n\t\tthis.data[i] = temp[i];\n\n\treturn this;\n};\n\n/**\n**\tReturns the determinant of the matrix.\n**\n**\t>> float det();\n*/\n\nMatrix.prototype.det = function ()\n{\n\treturn\tthis.data[0] * (this.data[4]*this.data[8] - this.data[5]*this.data[7]) -\n\t\t\tthis.data[1] * (this.data[3]*this.data[8] - this.data[5]*this.data[6]) +\n\t\t\tthis.data[2] * (this.data[3]*this.data[7] - this.data[4]*this.data[6])\n\t\t\t;\n};\n\n\n/**\n**\tReturns the adjoint of the matrix as a new matrix.\n**\n**\t>> Matrix adj();\n*/\n\nMatrix.prototype.adj = function () // violet:verify\n{\n\tvar t = this.transpose();\n\tvar d = [];\n\n\td[0] = (t.data[4]*t.data[8] - t.data[5]*t.data[7]);\n\td[1] = -(t.data[3]*t.data[8] - t.data[5]*t.data[6]);\n\td[2] = (t.data[3]*t.data[7] - t.data[4]*t.data[6]);\n\n\td[3] = -(t.data[1]*t.data[8] - t.data[2]*t.data[7]);\n\td[4] = (t.data[0]*t.data[8] - t.data[2]*t.data[6]);\n\td[5] = -(t.data[0]*t.data[7] - t.data[1]*t.data[6]);\n\n\td[6] = (t.data[1]*t.data[5] - t.data[2]*t.data[4]);\n\td[7] = -(t.data[0]*t.data[5] - t.data[2]*t.data[3]);\n\td[8] = (t.data[0]*t.data[4] - t.data[1]*t.data[3]);\n\n\tt.data = d;\n\treturn t;\n};\n\n\n/**\n**\tReturns the inverse of the matrix as a new matrix.\n**\n**\tMatrix inverse();\n*/\n\nMatrix.prototype.inverse = function ()\n{\n\tvar det = this.det();\n\tif (!det) return null;\n\n\treturn this.adj().scalef(1/det);\n};\n","/*\n**\tsystem/log.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport System from './system.js';\n\n/**\n**\tLogging module to show logs on the system display buffer.\n*/\n\nconst Log =\n{\n\tenabled: false,\n\n\tdata: [ ],\n\tcount: 0,\n\tmaxsize: 30,\n\tdebugEcho: false,\n\n\tcolor: '#fff',\n\tbackground: '#000',\n\n\tvars: { },\n\n\t/**\n\t**\tWrites a message to the log buffer, ensure logging has been enabled by calling enable() or any messages will be ignored.\n\t*/\n\twrite: function (msg)\n\t{\n\t\tthis.data.push(msg);\n\t\tthis.count++;\n\n\t\twhile (this.data.length > this.maxsize)\n\t\t\tthis.data.shift();\n\n\t\tif (this.debugEcho)\n\t\t\tconsole.debug(this.count + \": \" + msg);\n\t},\n\n\t/**\n\t**\tClears the current log buffer.\n\t*/\n\tclear: function ()\n\t{\n\t\tthis.data = [];\n\t\tthis.count = 0;\n\t},\n\n\t/**\n\t**\tEnables on-screen logging, must be called first before any call to write() or logging messages will be ignored.\n\t*/\n\tenable: function (x, y, fontSize, showFps, showIndex)\n\t{\n\t\tif (this.enabled) return;\n\t\tthis.enabled = true;\n\n\t\tif (!x) x = 0;\n\t\tif (!y) y = 0;\n\n\t\tif (!fontSize) fontSize = 8.5;\n\n\t\tif (showFps === false) y -= 16;\n\n\t\tlet _y = y;\n\n\t\tSystem.drawQueueAdd ({ draw: function (tmp, g)\n\t\t{\n\t\t\tg.clear();\n\n\t\t\tg.font(\"normal \"+fontSize+\"pt 'Bitstream Vera Sans Mono', monospace\");\n\t\t\tg.textBaseline('top');\n\n\t\t\tvar _time = ((System.perf.lastTime - System.perf.startTime) / 1000);\n\t\t\tvar _frames = System.perf.numFrames;\n\t\t\tvar s = '';\n\n\t\t\ty = _y;\n\n\t\t\tif (showFps !== false)\n\t\t\t{\n\t\t\t\ts = 'fps: '+(_frames/_time).toFixed(2) + ', dt: ' + (1000/(_frames/_time)).toFixed(2) + ' ms, update: ' + (System.perf.updateTime/_frames).toFixed(2) + ' ms, draw: ' + (System.perf.drawTime/_frames).toFixed(2) + ' ms';\n\n\t\t\t\tif (Log.background) {\n\t\t\t\t\tg.fillStyle(Log.background);\n\t\t\t\t\tg.fillRect (x+8 - 3, y+10-1, g.measureText(s) + 6, fontSize+4);\n\t\t\t\t}\n\n\t\t\t\tg.fillStyle(Log.color);\n\t\t\t\tg.fillText(s, x+8, y+10);\n\t\t\t}\n\n\t\t\ts = '';\n\n\t\t\tfor (let i in Log.vars)\n\t\t\t\ts += i + '=' + Log.vars[i] + '  ';\n\n\t\t\tif (s)\n\t\t\t{\n\t\t\t\ty += 24;\n\n\t\t\t\tif (Log.background) {\n\t\t\t\t\tg.fillStyle(Log.background);\n\t\t\t\t\tg.fillRect (x+8 - 3, y+10-1, g.measureText(s) + 6, fontSize+4);\n\t\t\t\t}\n\n\t\t\t\tg.fillStyle(Log.color);\n\t\t\t\tg.fillText(s, x+8, y+10);\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < Log.data.length; i++)\n\t\t\t{\n\t\t\t\ts = (showIndex !== false ? \"#\" + (Log.count-Log.data.length+i+1) + \": \" : \"> \") + Log.data[i];\n\n\t\t\t\tif (Log.background) {\n\t\t\t\t\tg.fillStyle(Log.background);\n\t\t\t\t\tg.fillRect (x+8 - 3, y+16 + (fontSize+4)*(i+1) - 1, g.measureText(s) + 6, fontSize+4);\n\t\t\t\t}\n\n\t\t\t\tg.fillStyle(Log.color);\n\t\t\t\tg.fillText(s, x+8, y+16 + (fontSize+4)*(i+1));\n\t\t\t}\n\t\t}});\n\t}\n};\n\nexport default Log;\n","/*\n**\tsystem/canvas.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rin } from '@rsthn/rin';\nimport Matrix from '../math/matrix.js';\nimport Log from './log.js';\nimport System from './system.js';\n\n/**\n**\tConstructs a canvas object. If the Canvas DOM element is not provided a new element will be created and attached to the page.\n**\n**\t>> Canvas Canvas (Object options=null);\n*/\nconst Canvas = function (options=null)\n{\n\tlet opts = {\n\t\telem: null,\n\t\tgl: false,\n\t\tbackground: '#000',\n\t\twidth: 0,\n\t\theight: 0,\n\t\thidden: true,\n\t\tabsolute: false,\n\t\tantialias: false,\n\t\t...options\n\t};\n\n\t// Create canvas element if required.\n\tif (opts.elem == null)\n\t{\n\t\tthis.elem = global.document ? global.document.createElement (\"canvas\") : Rin.clone(Canvas.passThruCanvas);\n\n\t\tif (global.document && opts.hidden != true)\n\t\t{\n\t\t\tglobal.document.body.appendChild (this.elem);\n\n\t\t\tif (opts.absolute === true) {\n\t\t\t\tthis.elem.style.position = 'absolute';\n\t\t\t\tthis.elem.style.left = '0';\n\t\t\t\tthis.elem.style.top = '0';\n\t\t\t}\n\t\t}\n\t}\n\telse\n\t{\n\t\tthis.elem = elem;\n\t}\n\n\tif (!this.elem.getContext) return;\n\n\tif (opts.gl === true)\n\t{\n\t\tthis.gl = this.elem.getContext(\"webgl2\");\n\t\tthis.context = null;\n\n\t\tLog.write(this.gl.getParameter(this.gl.VERSION));\n\t\tLog.write(this.gl.getParameter(this.gl.SHADING_LANGUAGE_VERSION));\n\n\t\tthis.initGl();\n\t}\n\telse\n\t{\n\t\tthis.context = this.elem.getContext(\"2d\");\n\t\tthis.gl = null;\n\t}\n\n\tthis.antialias = opts.antialias;\n\tthis.setBackground (opts.background);\n\n\t// State stack support.\n\tthis.matrixStack = [];\n\tthis.alphaStack = [];\n\n\tthis.matr = new Matrix ();\n\tthis.transform = new Matrix ();\n\n\t// Default alpha value.\n\tthis._alpha = 1.0;\n\tthis._globalScale = 1.0;\n\n\t// Set initial transformation matrix.\n\tthis.matr.identity();\n\n\tthis.updateTransform();\n\tthis.strokeStyle(\"#fff\");\n\tthis.fillStyle(\"#fff\");\n\n\tthis.resize(opts.width, opts.height);\n};\n\nCanvas.passThruCanvas = \n{\n\tparentNode: null,\n\n\timageSmoothingEnabled: true,\n\n\tstyle: {\n\t},\n\n\twidth: 950,\n\theight: 540,\n\n\tgetContext: function (renderingContext) {\n\t\treturn this;\n\t},\n\n\tpushClip: function() {\n\t},\n\n\tpopClip: function() {\n\t},\n\n\tscale: function (sx, sy) {\n\t},\n\n\trotate: function (angle) {\n\t},\n\n\ttranslate: function (x, y) {\n\t},\n\n\tsetTransform: function (a, b, c, d, e, f) {\n\t},\n\n\tupdateTransform: function () {\n\t},\n\n\ttoDataURL: function (mime, params) {\n\t\treturn '';\n\t},\n\n\tbeginPath: function () {\n\t},\n\n\tmoveTo: function (x, y) {\n\t},\n\n\tclosePath: function() {\n\t},\n\n\tlineTo: function() {\n\t},\n\n\trect: function(x, y, w, h) {\n\t},\n\n\tfill: function() {\n\t},\n\n\tstroke: function() {\n\t},\n\n\tfillRect: function(x, y, w, h) {\n\t},\n\n\tstrokeRect: function(x, y, w, h) {\n\t},\n\n\tclip: function() {\n\t},\n\n\tquadraticCurveTo: function (cpx, cpy, x, y) {\n\t},\n\n\tbezierCurveTo: function (cx1, cy1, cx2, cy2, x, y) {\n\t},\n\n\tarc: function (x, y, r, sA, eA, cw) {\n\t},\n\n\tarcTo: function (x1, y1, x2, y2, r) {\n\t},\n\n\tfillText: function (text, x, y, maxWidth) {\n\t},\n\n\tstrokeText: function (text, x, y, maxWidth) {\n\t},\n\n\tmeasureText: function (text) {\n\t\treturn { width: 0 };\n\t},\n\n\tcreateImageData: function (w, h) {\n\t\treturn { width: w, height: h };\n\t},\n\n\tgetImageData: function (x, y, w, h) {\n\t\treturn { width: w, height: h, data: [] };\n\t},\n\n\tputImageData: function (data, x, y) {\n\t},\n\n\tdrawImage: function (...args) {\n\t},\n\n\tgetBoundingClientRect: function () {\n\t\treturn { left: 0, top: 0 };\n\t}\n};\n\n\n/**\n**\tCompiles a shader and attaches it to the program.\n*/\n\nCanvas.prototype.buildShader = function (program, type, source)\n{\n\tconst gl = this.gl;\n\n\tconst shader = gl.createShader(type);\n\tgl.shaderSource(shader, source);\n\tgl.compileShader(shader);\n\n\tif (!gl.getShaderParameter(shader, gl.COMPILE_STATUS))\n\t\tthrow new Error ('compilerShader: ' + gl.getShaderInfoLog(shader));\n\n\tgl.attachShader(program, shader);\n};\n\n\n/**\n**\tInitializes the OpenGL ES context.\n*/\nCanvas.prototype.initGl = function ()\n{\n\tlet gl = this.gl;\n\n\tthis.gl_array_buffer = gl.createBuffer();\n\tgl.bindBuffer (gl.ARRAY_BUFFER, this.gl_array_buffer);\n\tgl.bufferData (gl.ARRAY_BUFFER, new Float32Array ([0, 0, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\n\n\tthis.gl_program = gl.createProgram();\n\n\tthis.buildShader (this.gl_program, gl.VERTEX_SHADER,\n\t`#version 300 es\n\n\t\tin vec2 location;\n\n\t\tuniform vec2 screen_size;\n\t\tuniform vec2 texture_size;\n\t\tuniform mat3 location_matrix;\n\t\tuniform mat3 texture_matrix;\n\t\tuniform mat3 current_matrix;\n\t\tuniform sampler2D texture;\n\n\t\tout vec2 f_texcoords;\n\n\t\tvoid main() {\n\t\t\tgl_Position = vec4(((vec2(current_matrix*location_matrix*vec3(location, 1.0))/screen_size)*2.0-vec2(1.0, 1.0))*vec2(1.0, -1.0), 0.0, 1.0);\n\t\t\tf_texcoords = vec2(texture_matrix*vec3(location, 1.0))/texture_size;\n\t\t}\n\t`);\n\n\tthis.buildShader (this.gl_program, gl.FRAGMENT_SHADER,\n\t`#version 300 es\n\n\t\tprecision highp float;\n\n\t\tuniform sampler2D tex;\n\t\tin vec2 f_texcoords;\n\n\t\tout vec4 color;\n\n\t\tvoid main() {\n\t\t\tcolor = texture(tex, f_texcoords);\n\t\t}\n\t`);\n\n\tgl.linkProgram (this.gl_program);\n\n\tif (!gl.getProgramParameter(this.gl_program, gl.LINK_STATUS))\n\t\tthrow new Error ('linkProgram: ' + gl.getProgramInfoLog(program));\n\n\tgl.useProgram (this.gl_program);\n\n\t/* **** */\n\tgl.clearColor (0, 0, 0, 0);\n\n\tgl.disable (gl.DEPTH_TEST);\n\tgl.clearDepth (0.0);\n\tgl.depthFunc (gl.GEQUAL);\n\n\tgl.enable (gl.BLEND);\n\tgl.blendFunc (gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\n\t/* **** */\n\tthis.gl_attrib_location = gl.getAttribLocation(this.gl_program, 'location');\n\tthis.gl_uniform_screen_size = gl.getUniformLocation(this.gl_program, 'screen_size');\n\tthis.gl_uniform_texture_size = gl.getUniformLocation(this.gl_program, 'texture_size');\n\tthis.gl_uniform_texture = gl.getUniformLocation(this.gl_program, 'texture');\n\tthis.gl_uniform_matrix = gl.getUniformLocation(this.gl_program, 'location_matrix');\n\tthis.gl_uniform_current_matrix = gl.getUniformLocation(this.gl_program, 'current_matrix');\n\tthis.gl_uniform_texture_matrix = gl.getUniformLocation(this.gl_program, 'texture_matrix');\n\n\tgl.enableVertexAttribArray (this.gl_attrib_location);\n\tgl.vertexAttribPointer (this.gl_attrib_location, 2, gl.FLOAT, gl.FALSE, 2*Float32Array.BYTES_PER_ELEMENT, 0*Float32Array.BYTES_PER_ELEMENT);\n\n\t/* *** */\n\tthis.location_matrix = new Matrix();\n\tthis.texture_matrix = new Matrix();\n\n\t// drawImage (Image img, float x, float y);\n\t// drawImage (Image img, float x, float y, float w, float h);\n\t// drawImage (Image img, float sx, float sy, float sw, float sh, float dx, float dy, float dw, float dh);\n\tthis.drawImage = function (...args)\n\t{\n\t\tconst img = args[0];\n\t\tconst sx = args[1];\n\t\tconst sy = args[2];\n\n\t\tif (!img.gl_ready)\n\t\t\treturn;\n\n\t\tif (this.gl_active_texture != img.gl_texture)\n\t\t{\n\t\t\tthis.gl.activeTexture(gl.TEXTURE0);\n\t\t\tthis.gl.bindTexture(gl.TEXTURE_2D, img.gl_texture);\n\t\t\tthis.gl.uniform1i(this.gl_uniform_texture, 0);\n\t\t\tthis.gl.uniform2fv(this.gl_uniform_texture_size, [img.width, img.height]);\n\n\t\t\tthis.gl_active_texture = img.gl_texture;\n\t\t}\n\n\t\t// [3] image, x, y\n\t\tif (args.length == 3)\n\t\t{\n\t\t\tif (sx == 0 && sy == 0)\n\t\t\t{\n\t\t\t\tthis.location_matrix.identity();\n\t\t\t\tthis.location_matrix.scale(img.width, img.height);\n\n\t\t\t\tthis.gl.uniformMatrix3fv(this.gl_uniform_current_matrix, false, this.transform.data);\n\t\t\t\tthis.gl.uniformMatrix3fv(this.gl_uniform_matrix, false, this.location_matrix.data);\n\t\t\t\tthis.gl.uniformMatrix3fv(this.gl_uniform_texture_matrix, false, this.location_matrix.data);\n\t\t\t\tthis.gl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.location_matrix.identity();\n\t\t\tthis.location_matrix.translate(sx, sy);\n\t\t\tthis.location_matrix.scale(img.width, img.height);\n\n\t\t\tthis.texture_matrix.identity();\n\t\t\tthis.texture_matrix.scale(img.width, img.height);\n\n\t\t\tthis.gl.uniformMatrix3fv(this.gl_uniform_current_matrix, false, this.transform.data);\n\t\t\tthis.gl.uniformMatrix3fv(this.gl_uniform_matrix, false, this.location_matrix.data);\n\t\t\tthis.gl.uniformMatrix3fv(this.gl_uniform_texture_matrix, false, this.texture_matrix.data);\n\t\t\tthis.gl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst sw = args[3];\n\t\tconst sh = args[4];\n\n\t\t// [5] image, x, y, width, height\n\t\tif (args.length == 5)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// [9] image, sx, sy, sw, sh, dx, dy, dw, dh\n\t\tconst dx = args[5];\n\t\tconst dy = args[6];\n\t\tconst dw = args[7];\n\t\tconst dh = args[8];\n\n\t\tthis.location_matrix.identity();\n\t\tthis.location_matrix.translate(dx, dy);\n\t\tthis.location_matrix.scale(dw, dh);\n\n\t\tthis.texture_matrix.identity();\n\t\tthis.texture_matrix.translate(sx, sy);\n\t\tthis.texture_matrix.scale(sw, sh);\n\n\t\tthis.gl.uniformMatrix3fv(this.gl_uniform_current_matrix, false, this.transform.data);\n\t\tthis.gl.uniformMatrix3fv(this.gl_uniform_matrix, false, this.location_matrix.data);\n\t\tthis.gl.uniformMatrix3fv(this.gl_uniform_texture_matrix, false, this.texture_matrix.data);\n\t\tthis.gl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\t};\n};\n\n/**\n**\tPrepares an image to use it on the canvas. Used only if gl is not null.\n*/\nCanvas.prototype.prepareImage = function (image)\n{\n\tlet gl = this.gl;\n\tif (gl == null) return false;\n\n\tlet texture = gl.createTexture();\n\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\n\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n\timage.gl_texture = texture;\n\timage.gl_ready = true;\n\n\treturn true;\n};\n\n/**\n**\tApplies the current config to the canvas (usually called after a reset on the canvas).\n**\n**\t>> void applyConfig();\n*/\n\nCanvas.prototype.applyConfig = function ()\n{\n\tif (this.antialias == false)\n\t{\n\t\tif (this.context != null)\n\t\t\tthis.context.imageSmoothingEnabled = false;\n\n\t\tthis.elem.style.imageRendering = \"crisp-edges\";\n\t}\n\telse\n\t{\n\t\tif (this.context != null)\n\t\t\tthis.context.imageSmoothingEnabled = true;\n\n\t\tthis.elem.style.imageRendering = \"auto\";\n\t}\n};\n\n\n/**\n**\tDisposes the resources used by the canvas. The DOMElement will also be removed from the document.\n**\n**\t>> void dispose();\n*/\n\nCanvas.prototype.dispose = function ()\n{\n\tif (this.elem.parentNode)\n\t\tthis.elem.parentNode.removeChild (this.elem);\n\n\tthis.matrixStack = null;\n\tthis.alphaStack = null;\n\n\tthis.matr = null;\n\tthis.context = null;\n\tthis.elem = null;\n};\n\n\n/**\n**\tSets the default background color of the canvas. Does not cause a canvas clear.\n**\n**\t>> void setBackground (string color);\n*/\n\nCanvas.prototype.setBackground = function (color, canvasColor)\n{\n\tthis.elem.style.background = color;\n\tthis.backgroundColor = canvasColor ? canvasColor : color;\n};\n\n\n/**\n**\tSets the canvas size.\n**\n**\t>> Canvas resize (float width, float height);\n*/\n\nCanvas.prototype.resize = function (width, height)\n{\n\tlet rect = this.elem.getBoundingClientRect();\n\n\tif (!width) width = rect.width;\n\tif (!height) height = rect.height;\n\n\tthis.elem.width = width;\n\tthis.elem.height = height;\n\n\tthis.width = this.elem.width;\n\tthis.height = this.elem.height;\n\n\tthis._width = ~~(this.width / this._globalScale);\n\tthis._height = ~~(this.height / this._globalScale);\n\n\tif (this.gl != null)\n\t{\n\t\tthis.gl.viewport (0, 0, width, height);\n\n\t\tif (this.gl_uniform_screen_size)\n\t\t\tthis.gl.uniform2fv (this.gl_uniform_screen_size, [width, height]);\n\n\t\tthis.gl.enable(this.gl.SCISSOR_TEST);\n\t\tthis.gl.scissor(0, 0, width, height);\n\t}\n\n\tthis.applyConfig();\n\treturn this;\n};\n\n\n/**\n**\tSets the global canvas scale.\n**\n**\t>> Canvas globalScale (float value);\n*/\n\nCanvas.prototype.globalScale = function (value)\n{\n\tthis._globalScale = value;\n\n\tthis._width = ~~(this.width / this._globalScale);\n\tthis._height = ~~(this.height / this._globalScale);\n\n\tthis.loadIdentity();\n\tthis.scale(value, value);\n\n\treturn this;\n};\n\n\n/**\n**\tGets or sets the flipped status of the canvas. Indicates if the canvas was flipped (i.e. xy is now yx).\n**\n**\t>> Canvas flipped (bool value);\n**\t>> Canvas flipped (bool value);\n*/\n\nCanvas.prototype.flipped = function (value)\n{\n\tif (value)\n\t{\n\t\tthis._width = ~~(this.height / this._globalScale);\n\t\tthis._height = ~~(this.width / this._globalScale);\n\t}\n\telse\n\t{\n\t\tthis._width = ~~(this.width / this._globalScale);\n\t\tthis._height = ~~(this.height / this._globalScale);\n\t}\n\n\tthis.isFlipped = value;\n\treturn this;\n};\n\n\n/**\n**\tSaves the clip state of the canvas.\n**\n**\t>> Canvas pushClip();\n*/\n\nCanvas.prototype.pushClip = function ()\n{\n\tif (this.gl != null)\n\t\t;\n\telse\n\t\tthis.context.save();\n\n\treturn this;\n};\n\n\n/**\n**\tRestores the clip state of the canvas.\n**\n**\t>> Canvas popClip();\n*/\n\nCanvas.prototype.popClip = function ()\n{\n\tif (this.gl != null)\n\t{\n\t\tthis.gl.scissor(0, 0, this.width, this.height);\n\t}\n\telse\n\t\tthis.context.restore();\n\n\treturn this;\n};\n\n\n/**\n**\tReturns the image on the canvas as a string in DATA-URI format.\n**\n**\t>> string toDataUrl (string mime);\n*/\n\nCanvas.prototype.toDataUrl = function (mime='image/png', params=null)\n{\n\treturn this.elem.toDataURL (mime, params);\n};\n\n\n/**\n**\tReturns the image as a Base-64 encoded PNG string.\n**\n**\t>> string toPng64();\n*/\n\nCanvas.prototype.toPng64 = function ()\n{\n\treturn this.elem.toDataURL(\"image/png\").substr(22);\n};\n\n\n/**\n**\tSets or returns an attribute of the canvas context.\n**\n**\t>> Canvas _contextAttribute (string name);\n**\t>> Canvas _contextAttribute (string name, string value);\n*/\n\nCanvas.prototype._contextAttribute = function (name, value)\n{\n\tif (!this.context) return;\n\n\tif (value !== undefined)\n\t{\n\t\tthis.context[name] = value;\n\t\treturn this;\n\t}\n\n\treturn this.context[name];\n};\n\n\n/**\n**\tSets or returns the current fill style (default black).\n**\n**\t>> Canvas fillStyle (string value);\n*/\n\nCanvas.prototype.fillStyle = function (value)\n{\n\treturn this._contextAttribute (\"fillStyle\", value);\n};\n\n\n/**\n**\tSets or returns the current stroke style (default black).\n**\n**\t>> Canvas strokeStyle (string value);\n*/\n\nCanvas.prototype.strokeStyle = function (value)\n{\n\treturn this._contextAttribute (\"strokeStyle\", value);\n};\n\n\n/**\n**\tSets or returns the current line cap style (butt, round, square. butt is default).\n**\n**\t>> Canvas lineCap (string value);\n**\t>> string lineCap ();\n*/\n\nCanvas.prototype.lineCap = function (value)\n{\n\treturn this._contextAttribute (\"lineCap\", value);\n};\n\n\n/**\n**\tSets or returns the current line join style (bevel, round, miter. miter is default).\n**\n**\t>> Canvas lineJoin (string value);\n**\t>> string lineJoin ();\n*/\n\nCanvas.prototype.lineJoin = function (value)\n{\n\treturn this._contextAttribute (\"lineJoin\", value);\n};\n\n\n/**\n**\tSets or returns the current line width value (default 1).\n**\n**\t>> Canvas lineWidth (float value);\n**\t>> float lineWidth ();\n*/\n\nCanvas.prototype.lineWidth = function (value)\n{\n\treturn this._contextAttribute (\"lineWidth\", value);\n};\n\n\n/**\n**\tSets or returns the current miter limit value (default 10).\n**\n**\t>> Canvas miterLimit (float value);\n**\t>> float miterLimit ();\n*/\n\nCanvas.prototype.miterLimit = function (value)\n{\n\treturn this._contextAttribute (\"miterLimit\", value);\n};\n\n\n/**\n**\tSets or returns the current shadow color value (default black).\n**\n**\t>> Canvas shadowColor (string value);\n**\t>> string shadowColor ();\n*/\n\nCanvas.prototype.shadowColor = function (value)\n{\n\treturn this._contextAttribute (\"shadowColor\", value);\n};\n\n\n/**\n**\tSets or returns the current shadow X offset (default 0).\n**\n**\t>> Canvas shadowOffsetX (float value);\n**\t>> float shadowOffsetX ();\n*/\n\nCanvas.prototype.shadowOffsetX = function (value)\n{\n\treturn this._contextAttribute (\"shadowOffsetX\", value);\n};\n\n\n/**\n**\tSets or returns the current shadow Y offset (default 0).\n**\n**\t>> Canvas shadowOffsetY (float value);\n**\t>> float shadowOffsetY ();\n*/\n\nCanvas.prototype.shadowOffsetY = function (value)\n{\n\treturn this._contextAttribute (\"shadowOffsetY\", value);\n};\n\n\n/**\n**\tSets or returns the current shadow blue value (default 0).\n**\n**\t>> Canvas shadowBlur (string value);\n**\t>> string shadowBlur ();\n*/\n\nCanvas.prototype.shadowBlur = function (value)\n{\n\treturn this._contextAttribute (\"shadowBlur\", value);\n};\n\n\n/**\n**\tSets or returns the current font settings.\n**\n**\t>> Canvas font (string value);\n**\t>> string font ();\n*/\n\nCanvas.prototype.font = function (value)\n{\n\treturn this._contextAttribute (\"font\", value);\n};\n\n\n/**\n**\tSets or returns the current text align settings (start, end, left, right, center).\n**\n**\t>> Canvas textAlign (string value);\n**\t>> string textAlign ();\n*/\n\nCanvas.prototype.textAlign = function (value)\n{\n\treturn this._contextAttribute (\"textAlign\", value);\n};\n\n\n/**\n**\tSets or returns the current text base line settings (alphabetic, bottom, hanging, ideographic, middle, top. Alphabetic is default).\n**\n**\t>> Canvas textBaseline (string value);\n**\t>> string textBaseline ();\n*/\n\nCanvas.prototype.textBaseline = function (value)\n{\n\treturn this._contextAttribute (\"textBaseline\", value);\n};\n\n\n/**\n**\tSets or returns the current global alpha value.\n**\n**\t>> Canvas globalAlpha (float value);\n**\t>> float globalAlpha ();\n*/\n\nCanvas.prototype.globalAlpha = function (value)\n{\n\tif (value !== undefined)\n\t\tthis._alpha = value;\n\telse\n\t\treturn this._alpha;\n\n\treturn this.alpha(1.0);\n};\n\n\n/**\n**\tSets or returns the relative alpha value for subsequent drawing operations.\n**\n**\t>> Canvas alpha (float value);\n**\t>> float alpha ();\n*/\n\nCanvas.prototype.alpha = function (value)\n{\n\tthis._alpha *= value;\n\n\tif (this.context)\n\t\tthis.context.globalAlpha = this._alpha;\n\n\treturn this;\n};\n\n\n/**\n**\tSets or returns the current global composite operation value (source-atop, source-in, source-out, source-over, destination-atop,\n**\tdestination-in, destination-out, destination-over, lighter, copy, xor).\n**\n**\t>> Canvas globalCompositeOperation (string value);\n**\t>> string globalCompositeOperation ();\n*/\n\nCanvas.prototype.globalCompositeOperation = function (value)\n{\n\treturn this._contextAttribute (\"globalCompositeOperation\", value);\n};\n\n\n/**\n**\tUpdates the underlying canvas or webgl transformation matrix. \n**\n**\t>> Canvas updateTransform();\n*/\n\nCanvas.prototype.updateTransform = function()\n{\n\tthis.setTransform (this.matr.data[0], this.matr.data[1], this.matr.data[3], this.matr.data[4], this.matr.data[6], this.matr.data[7]);\n\treturn this;\n};\n\n\n/**\n**\tSets the canvas or webgl transformation matrix to the given one.\n**\n**\t>> Canvas setTransform (float a, float b, float c, float d, float e, float f);\n*/\n\nCanvas.prototype.setTransform = function (a, b, c, d, e, f)\n{\n\tif (this.context == null)\n\t{\n\t\tthis.transform.data[0] = a;\n\t\tthis.transform.data[1] = b;\n\t\tthis.transform.data[2] = 0;\n\t\tthis.transform.data[3] = c;\n\t\tthis.transform.data[4] = d;\n\t\tthis.transform.data[5] = 0;\n\t\tthis.transform.data[6] = Math.ceil(e);\n\t\tthis.transform.data[7] = Math.ceil(f);\n\t\tthis.transform.data[8] = 1;\n\n\t\treturn this;\n\t}\n\n\tthis.context.setTransform (a, b, c, d, Math.ceil(e), Math.ceil(f));\n\treturn this;\n};\n\n\n/**\n**\tDraws a filled rectangle on the canvas.\n**\n**\t>> Canvas fillRect (float x, float y, float w, float h);\n*/\n\nCanvas.prototype.fillRect = function (x, y, w, h)\n{\n\tthis.context.fillRect (x, y, w, h);\n\treturn this;\n};\n\n\n/**\n**\tDraws an stroked rectangle on the canvas.\n**\n**\t>> Canvas strokeRect (float x, float y, float w, float h);\n*/\n\nCanvas.prototype.strokeRect = function (x, y, w, h)\n{\n\tthis.context.strokeRect (x, y, w, h);\n\treturn this;\n};\n\n\n/**\n**\tClears a rectangle on the canvas. All pixels will be erased.\n**\n**\t>> Canvas clearRect (float x, float y, float w, float h);\n*/\n\nCanvas.prototype.clearRect = function (x, y, w, h)\n{\n\tthis.context.clearRect (x, y, w, h);\n\treturn this;\n};\n\n\n/**\n**\tStarts a new path. Any previous path points will be cleared.\n**\n**\t>> Canvas beginPath();\n*/\n\nCanvas.prototype.beginPath = function ()\n{\n\tthis.context.beginPath ();\n\treturn this;\n};\n\n\n/**\n**\tCreates a new point in the current path.\n**\n**\t>> Canvas moveTo (float x, float y);\n*/\n\nCanvas.prototype.moveTo = function (x, y)\n{\n\tthis.context.moveTo (x, y);\n\treturn this;\n};\n\n\n/**\n**\tCreates a new point from the first path point to the last, and finishes the path.\n**\n**\t>> Canvas closePath();\n*/\n\nCanvas.prototype.closePath = function ()\n{\n\tthis.context.closePath ();\n\treturn this;\n};\n\n\n/**\n**\tDraws a line from the last point on the path to the given point.\n**\n**\t>> Canvas lineTo (float x, float y);\n*/\n\nCanvas.prototype.lineTo = function (x, y)\n{\n\tthis.context.lineTo (x, y);\n\treturn this;\n};\n\n\n/**\n**\tCreates a hollow rectangle path on the canvas for subsequent stroke or fill.\n**\n**\t>> Canvas rect (float x, float y, float w, float h);\n*/\n\nCanvas.prototype.rect = function (x, y, w, h)\n{\n\tthis.context.rect (x, y, w, h);\n\treturn this;\n};\n\n\n/**\n**\tFills the active path with the current fill style or with the one given in the value parameter.\n**\n**\t>> Canvas fill (string value);\n**\t>> Canvas fill ();\n*/\n\nCanvas.prototype.fill = function (value)\n{\n\tif (value) this.fillStyle (value);\n\tthis.context.fill ();\n\treturn this;\n};\n\n\n/**\n**\tStrokes the active path with the current stroke style or with the one given in the value parameter.\n**\n**\t>> Canvas stroke (string value);\n**\t>> Canvas stroke ();\n*/\n\nCanvas.prototype.stroke = function (value)\n{\n\tif (value) this.strokeStyle (value);\n\tthis.context.stroke ();\n\treturn this;\n};\n\n\n/*\n**\tClips a region of the canvas so that only the region will be used for drawing. Coordinates must be in logical screen space.\n**\n**\t>> Canvas clip();\n*/\n\nCanvas.prototype.clip = function (x, y, width, height)\n{\n\tif (this.gl != null)\n\t{\n\t\tx *= this._globalScale;\n\t\ty *= this._globalScale;\n\t\twidth *= this._globalScale;\n\t\theight *= this._globalScale;\n\n\t\tif (this.isFlipped)\n\t\t\tthis.gl.scissor(this.width-y-height-1, this.height-x-width-1, height, width);\n\t\telse\n\t\t\tthis.gl.scissor(x, this.height-y-height-1, width, height);\n\t}\n\telse\n\t{\n\t\tthis.beginPath();\n\t\tthis.rect(x, y, width, height);\n\t\tthis.context.clip();\n\t}\n\n\treturn this;\n};\n\n\n/**\n**\tAdds points of a quadratic curve to the active path. A control points and one reference point must be provided.\n**\n**\t>> Canvas quadraticCurveTo (float cpx, float cpy, float x, float y);\n*/\n\nCanvas.prototype.quadraticCurveTo = function (cpx, cpy, x, y)\n{\n\tthis.context.quadraticCurveTo (cpx, cpy, x, y);\n\treturn this;\n};\n\n\n/**\n**\tAdds points of a bezier curve to the active path. Two control points and one reference point must be provided.\n**\n**\t>> Canvas bezierCurveTo (float cx1, float cy1, float cx2, float cy2, float x, float y);\n*/\n\nCanvas.prototype.bezierCurveTo = function (cx1, cy1, cx2, cy2, x, y)\n{\n\tthis.context.bezierCurveTo (cx1, cy1, cx2, cy2, x, y);\n\treturn this;\n};\n\n\n/**\n**\tAdds points of an arc the the active path. Used to draw a circle of part of it.\n**\n**\t>> Canvas arc (float x, float y, float r, float sA, float eA, float cw);\n*/\n\nCanvas.prototype.arc = function (x, y, r, sA, eA, cw)\n{\n\tthis.context.arc (x, y, r, sA, eA, cw);\n\treturn this;\n};\n\n\n/**\n**\tAdds points of an arc to the active path. Used to create an arc between two points.\n**\n**\t>> Canvas arcTo (float x1, float y1, float x2, float y2, float r);\n*/\n\nCanvas.prototype.arcTo = function (x1, y1, x2, y2, r)\n{\n\tthis.context.arcTo (x1, y1, x2, y2, r);\n\treturn this;\n};\n\n\n/**\n**\tDraws filled text on the canvas with the active font, and fillStyle properties.\n**\n**\t>> Canvas fillText (string text, float x, float y, float maxWidth=1000)\n*/\n\nCanvas.prototype.fillText = function (text, x, y, maxWidth)\n{\n\tthis.context.fillText (text, x, y, maxWidth ? maxWidth : 1000);\n\treturn this;\n};\n\n\n/**\n**\tDraws stroked text on the canvas with the active font, and fillStyle properties.\n**\n**\t>> Canvas strokeText (string text, float x, float y, float maxWidth=1000);\n*/\n\nCanvas.prototype.strokeText = function (text, x, y, maxWidth)\n{\n\tthis.context.strokeText (text, x, y, maxWidth ? maxWidth : 1000);\n\treturn this;\n};\n\n\n/**\n**\tMeasures the width of the given text using active font properties.\n**\n**\t>> float measureText (string text);\n*/\n\nCanvas.prototype.measureText = function (text)\n{\n\treturn this.context.measureText (text).width;\n};\n\n\n/**\n**\tReturns a new image data object with the specified size.\n**\n**\t>> ImageData createImageData (float w, float h);\n*/\n\nCanvas.prototype.createImageData = function (w, h)\n{\n\treturn this.context.createImageData (w, h);\n};\n\n\n/**\n**\tReturns an image data object with the pixels of a rectangular area of the canvas.\n**\n**\t>> ImageData getImageData (float x, float y, float w, float h);\n*/\n\nCanvas.prototype.getImageData = function (x, y, w, h)\n{\n\treturn this.context.getImageData (x, y, w, h);\n};\n\n\n/**\n**\tPuts image data on the canvas at the specified location.\n**\n**\t>> Canvas putImageData (ImageData data, float x, float y);\n*/\n\nCanvas.prototype.putImageData = function (data, x, y)\n{\n\tthis.context.putImageData (data, x, y);\n\treturn this;\n};\n\n\n/**\n**\tDraws an image on the canvas.\n**\n**\tCanvas drawImage (Image img, float x, float y);\n**\tCanvas drawImage (Image img, float x, float y, float w, float h);\n**\tCanvas drawImage (Image img, float sx, float sy, float sw, float sh, float dx, float dy, float dw, float dh);\n*/\n\nCanvas.prototype.drawImage = function (...args)\n{\n\tif (args.length == 3)\n\t{\n\t\tthis.context.drawImage (args[0], ~~args[1], ~~args[2]);\n\t}\n\telse if (args.length == 5)\n\t{\n\t\tthis.context.drawImage (args[0], ~~args[1], ~~args[2], ~~args[3], ~~args[4]);\n\t}\n\telse if (args.length == 9)\n\t{\n\t\tvar a3 = ~~args[3];\n\t\tvar a4 = ~~args[4];\n\t\tif (!a3 || !a4) return this;\n\n\t\tvar a7 = ~~args[7];\n\t\tvar a8 = ~~args[8];\n\t\tif (!a7 || !a8) return this;\n\n\t\tthis.context.drawImage (args[0], ~~args[1], ~~args[2], a3, a4, ~~args[5], ~~args[6], a7, a8);\n\t}\n\n\treturn this;\n};\n\n\n/**\n**\tClears the entire canvas. If the backgroundColor parameter is set the canvas will be cleared manually by using\n**\tthe fillRect method.\n**\n**\t>> Canvas clear (string backgroundColor);\n**\t>> Canvas clear ();\n*/\n\nCanvas.prototype.clear = function (backgroundColor)\n{\n\tif (this.gl != null)\n\t{\n\t\tthis.gl.clear(this.gl.DEPTH_BUFFER_BIT | this.gl.COLOR_BUFFER_BIT);\n\t\tthis.gl_active_texture = null;\n\n\t\treturn this;\n\t}\n\n\tif (backgroundColor)\n\t{\n\t\tthis.globalCompositeOperation(\"source-over\").globalAlpha(1.0).fillStyle(backgroundColor !== true ? backgroundColor : this.backgroundColor).fillRect(0, 0, this._width, this._height);\n\t}\n\telse\n\t{\n\t\tthis.elem.width = this.width;\n\t\tthis.applyConfig();\n\t}\n\n\tthis.updateTransform();\n\treturn this;\n};\n\n\n/**\n**\tResets the context drawing properties to their initial values.\n**\n**\t>> Canvas reset (bool clearPath);\n**\t>> Canvas reset ();\n*/\n\nCanvas.prototype.reset = function (clearPath)\n{\n\tthis.fillStyle(\"#000000\").strokeStyle(\"#000000\").lineCap(\"butt\").lineJoin(\"miter\")\n\t.lineWidth(\"1\").miterLimit(\"10\").shadowColor(\"#000000\").shadowOffsetX(\"0\")\n\t.shadowOffsetY(\"0\").shadowBlur(\"0\").globalAlpha(\"1.0\").globalCompositeOperation(\"source-over\");\n\n\tif (clearPath) this.beginPath().closePath();\n\n\treturn this;\n};\n\n\n/**\n**\tPushes the current transformation matrix into the matrix stack.\n**\n**\t>> Canvas pushMatrix();\n*/\n\nCanvas.prototype.pushMatrix = function ()\n{\n\tthis.matrixStack.push (this.matr);\n\tthis.matr = this.matr.clone();\n\n\treturn this;\n};\n\n\n/**\n**\tPops a matrix from the matrix stack into the transformation matrix.\n**\n**\t>> Canvas popMatrix();\n*/\n\nCanvas.prototype.popMatrix = function ()\n{\n\tthis.matr = this.matrixStack.pop ();\n\treturn this.updateTransform ();\n};\n\n\n/**\n**\tPushes the current global alpha into the stack.\n**\n**\t>> Canvas pushAlpha();\n*/\n\nCanvas.prototype.pushAlpha = function ()\n{\n\tthis.alphaStack.push (this.globalAlpha());\n\treturn this;\n};\n\n\n/**\n**\tPops an alpha from the stack into the global alpha.\n**\n**\t>> Canvas popAlpha();\n*/\n\nCanvas.prototype.popAlpha = function ()\n{\n\tthis.globalAlpha(this.alphaStack.pop());\n\treturn this;\n};\n\n\n/**\n**\tSets the transformation matrix to identity.\n**\n**\t>> Canvas loadIdentity();\n*/\n\nCanvas.prototype.loadIdentity = function ()\n{\n\tthis.matr.identity ();\n\treturn this.updateTransform ();\n};\n\n\n/**\n**\tSets the transformation matrix to the specified one.\n**\n**\t>> Canvas loadMatrix (Matrix matr);\n*/\n\nCanvas.prototype.loadMatrix = function (matr)\n{\n\tthis.matr.set(matr);\n\treturn this.updateTransform ();\n};\n\n\n/**\n**\tReturns a copy of the current transformation matrix object.\n**\n**\t>> Matrix getMatrix();\n*/\n\nCanvas.prototype.getMatrix = function ()\n{\n\treturn this.matr.clone();\n};\n\n\n/**\n**\tAppends a matrix to the current transformation matrix.\n**\n**\t>> Canvas appendMatrix (Matrix matr);\n*/\n\nCanvas.prototype.appendMatrix = function (matr)\n{\n\tthis.matr.append (matr);\n\treturn this.updateTransform ();\n};\n\n\n/**\n**\tSets scaling factors for subsequent drawing operations. If the useNative is not set then scale with the current\n**\ttransformation matrix will be performed.\n**\n**\t>> Canvas scale (float sx, float sy, bool useNative=false);\n*/\n\nCanvas.prototype.scale = function (sx, sy, useNative)\n{\n\tif (useNative) {\n\t\tthis.context.scale (sx, sy);\n\t\treturn this;\n\t}\n\n\tthis.matr.scale (sx, sy);\n\treturn this.updateTransform();\n};\n\n\n/**\n**\tSets rotation factor for subsequent drawing operations. The angle is in radians. If useNative is not set\n**\tthen rotation with the transformation matrix will be used.\n**\n**\t>> Canvas rotate (float angle, bool useNative=false);\n*/\n\nCanvas.prototype.rotate = function (angle, useNative)\n{\n\tif (useNative) {\n\t\tthis.context.rotate (angle);\n\t\treturn this;\n\t}\n\n\tthis.matr.rotate (angle);\n\treturn this.updateTransform();\n};\n\n\n/**\n**\tMoves starting point to an specified location. If the useNative parameter is not set then translation with\n**\tthe transformation matrix will be done.\n**\n**\t>> Canvas translate (float x, float y, bool useNative=false);\n*/\n\nCanvas.prototype.translate = function (x, y, useNative)\n{\n\tif (useNative) {\n\t\tthis.context.translate (x, y);\n\t\treturn this;\n\t}\n\n\tthis.matr.translate (x, y);\n\treturn this.updateTransform();\n};\n\n\n/**\n**\tCreates a hollow ellipse path on the canvas for subsequent stroke or fill.\n**\n**\t>> Canvas ellipse (float x, float y, float w, float h);\n*/\n\nCanvas.prototype.ellipse = function (x, y, w, h)\n{\n\tvar ox = (w/2)*.5522848, oy = (h/2)*.5522848;\n\tvar xe = x+w-1, ye = y+h-1, xm = x+w/2, ym = y+h/2;\n\n\tthis.beginPath ().moveTo(x, ym);\n\tthis.bezierCurveTo (x, ym - oy, xm - ox, y, xm, y);\n\tthis.bezierCurveTo (xm + ox, y, xe, ym - oy, xe, ym);\n\tthis.bezierCurveTo (xe, ym + oy, xm + ox, ye, xm, ye);\n\tthis.bezierCurveTo (xm - ox, ye, x, ym + oy, x, ym);\n\tthis.closePath ();\n\n\treturn this;\n};\n\n\n/**\n**\tCreates a hollow circle path on the canvas for subsequent stroke or fill. If the stroke param is set the circle\n**\twill be drawn with the specified stroke color.\n**\n**\t>> Canvas circle (float x, float y, float r, string strokeColor);\n**\t>> Canvas circle (float x, float y, float r);\n*/\n\nCanvas.prototype.circle = function (x, y, r, stroke)\n{\n\tthis.beginPath();\n\tthis.arc(x, y, r, 0, 2*Math.PI);\n\tthis.closePath();\n\n\tif (stroke) this.stroke(stroke);\n\n\treturn this;\n};\n\n\n/**\n**\tDraws a line for subsequent stroke or fill. If the stroke param is set the line will be drawn with\n**\tthe specified stroke color.\n**\n**\t>> Canvas line (float x1, float y1, float x2, float y2, string strokeColor);\n**\t>> Canvas line (float x1, float y1, float x2, float y2);\n*/\n\nCanvas.prototype.line = function (x1, y1, x2, y2, stroke)\n{\n\tthis.beginPath();\n\tthis.moveTo(x1, y1);\n\tthis.lineTo(x2, y2);\n\tthis.closePath();\n\n\tif (stroke) this.stroke(stroke);\n\treturn this;\n};\n\n\n/**\n**\tAttaches internal listeners for mouse/pointer events on the canvas object, this is called automatically when\n**\tattaching handlers to the canvas. The actual handlers are added or removed using the addPointerHandler and\n**\tremovePointerHandler respectively.\n**\n**\t>> Canvas enablePointerEvents();\n*/\n\nCanvas.prototype.enablePointerEvents = function()\n{\n\tif (this.pointerHandler) return this;\n\n\tthis.pointerScale = { sx: 1, sy: 1 };\n\tthis.pointerOffset = { x: 0, y: 0 };\n\n\tvar _ = this;\n\n\tvar _evt =\n\t{\n\t\taction: '',\n\t\tbuttons: 0, lbuttons: 0,\n\t\tx: 0, y: 0,\n\n\t\tcontainedBy: function (x, y, w, h) {\n\t\t\treturn this.x >= x && this.x <= (x+w-1) && this.y >= y && this.y <= (y+h-1);\n\t\t}\n\t};\n\n\tthis.pointerHandlers = [];\n\n\tthis.pointerHandler = function (code, evt)\n\t{\n\t\tvar rect = this.elem.getBoundingClientRect();\n\n\t\t_evt.action = code;\n\t\t_evt.buttons = evt.buttons;\n\t\t_evt.x = _evt.rx = ~~(evt.clientX - rect.left);\n\t\t_evt.y = _evt.ry = ~~(evt.clientY - rect.top);\n\n\t\t_evt.x = ((_evt.x - _.pointerOffset.x) - 0.0*_.pointerScale.sx) / _.pointerScale.sx;\n\t\t_evt.y = ((_evt.y - _.pointerOffset.y) - 0.0*_.pointerScale.sy) / _.pointerScale.sy;\n\n\t\t_evt.dragging = false;\n\n\t\tif (_evt.buttons && !_evt.lbuttons)\n\t\t{\n\t\t\t_evt.sx = _evt.x;\n\t\t\t_evt.sy = _evt.y;\n\n\t\t\t_evt.ldx = _evt.ldy = 0;\n\t\t}\n\n\t\tif (_evt.buttons && _evt.lbuttons)\n\t\t{\n\t\t\t_evt.dragging = true;\n\n\t\t\t_evt.dx = _evt.x - _evt.sx;\n\t\t\t_evt.dy = _evt.y - _evt.sy;\n\t\t\t\n\t\t\t_evt.ddx = _evt.dx - _evt.ldx;\n\t\t\t_evt.ddy = _evt.dy - _evt.ldy;\n\n\t\t\t_evt.ldx = _evt.dx;\n\t\t\t_evt.ldy = _evt.dy;\n\t\t}\n\n\t\t_evt.lbuttons = _evt.buttons;\n\n\t\tfor (var i = 0; i < this.pointerHandlers.length; i++)\n\t\t{\n\t\t\tif (this.pointerHandlers[i][1].call(this.pointerHandlers[i][2], _evt) === false)\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tthis.elem.onmousedown = function(evt) {  _.pointerHandler('DOWN', evt); };\n\tthis.elem.onmouseup = function(evt) { _.pointerHandler('UP', evt); };\n\tthis.elem.onmousemove = function(evt) { _.pointerHandler('MOVE', evt); };\n\n\treturn this;\n};\n\n\n/**\n**\tSets the pointer scaling factors.\n**\n**\t>> Canvas setPointerScale (float sx, float sy);\n*/\n\nCanvas.prototype.setPointerScale = function (sx, sy)\n{\n\tthis.pointerScale = { sx: sx, sy: sy };\n\treturn this;\n};\n\n\n/**\n**\tSets the pointer offset that is applied after scaling.\n**\n**\t>> Canvas setPointerOffset (float x, float y);\n*/\n\nCanvas.prototype.setPointerOffset = function (x, y)\n{\n\tthis.pointerOffset = { x: x, y: y };\n\treturn this;\n};\n\n\n/**\n**\tAdds a pointer event handler, returns the handler reference id for later removal.\n**\n**\t>> string addPointerHandler (function callback, object context);\n**\t>> string addPointerHandler (function callback);\n*/\n\nCanvas.prototype.addPointerHandler = function (callback, context)\n{\n\tthis.enablePointerEvents();\n\n\tthis.pointerHandlers.push ([this.pointerHandlers.length+\"_\"+~~(Math.random()*1e6), callback, context]);\n\n\treturn this.pointerHandlers[this.pointerHandlers.length-1][0];\n};\n\n\n/**\n**\tRemoves a previously attached pointer event handler.\n**\n**\t>> void removePointerHandler (string id);\n*/\n\nCanvas.prototype.removePointerHandler = function (id)\n{\n\tif (!this.pointerHandlers) return;\n\n\tfor (var i = 0; i < this.pointerHandlers.length; i++)\n\t{\n\t\tif (this.pointerHandlers[i][0] == id)\n\t\t{\n\t\t\tthis.pointerHandlers.splice(i, 1);\n\t\t\tbreak;\n\t\t}\n\t}\n};\n\n\n/**\n**\tDraws an image resource on the canvas (as obtained by Resources.load).\n**\n**\t>> Canvas drawImageEx (Resource image, [float x, float y, float width, float height]);\n*/\n\nCanvas.prototype.drawImageResource = function (image, x=0, y=0, width=null, height=null)\n{\n\tif (width == null)\n\t\treturn this.drawImage (image.data, 0, 0, image.data.width, image.data.height, x, y, image.width, image.height);\n\n\treturn this.drawImage (image.data, 0, 0, image.data.width, image.data.height, x, y, width, height);\n};\n\n/*\n**\tExecutes the draw function on a new canvas of the specified width and height, renders it into an image and runs the\n**\tcompleted callback with the ready image object.\n*/\nCanvas.renderImage = function (width, height, draw, completed)\n{\n\tlet g = new Canvas({ width: width, height: height });\n\n\tdraw(g);\n\n\tlet img = new Image();\n\timg.onload = () => {\n\t\tSystem.displayBuffer.prepareImage(img);\n\t\tcompleted(img);\n\t};\n\n\timg.src = g.toDataUrl();\n\tg.dispose();\n};\n\nexport default Canvas;\n","/*\n**\tsystem/system.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport KeyCodes from './keycodes.js';\nimport List from '../utils/list.js';\nimport Linkable from '../utils/linkable.js';\nimport Timer from './timer.js';\nimport Canvas from './canvas.js';\n\n/*\n**\tSystem object.\n*/\n\nconst System =\n{\n\t/*\n\t**\tSystem flags.\n\t*/\n\tflags:\n\t{\n\t\trenderingEnabled: false,\n\t\trenderingPaused: false\n\t},\n\n\t/*\n\t**\tEvent codes.\n\t*/\n\tEVT_KEY_DOWN:\t\t\t0x001,\n\tEVT_KEY_UP:\t\t\t\t0x002,\n\n\tEVT_POINTER_DOWN: \t\t0x010,\n\tEVT_POINTER_UP: \t\t0x011,\n\tEVT_POINTER_MOVE: \t\t0x012,\n\tEVT_POINTER_DRAG_START:\t0x013,\n\tEVT_POINTER_DRAG_MOVE:\t0x014,\n\tEVT_POINTER_DRAG_STOP:\t0x015,\n\n\t/*\n\t**\tDisplay orientations.\n\t*/\n\tDEFAULT:\t0,\n\tLANDSCAPE:\t1,\n\tPORTRAIT:\t2,\n\tAUTOMATIC:\t3,\n\n\t/*\n\t**\tDefault options of the rendering system.\n\t*/\n\tdefaultOptions:\n\t{\n\t\tbackground: \"#000\",\n\t\tgl: false,\n\n\t\tcanvas: null,\n\t\tcanvas2: null,\n\n\t\tfps: 144,\n\t\tminFps: 15,\n\n\t\tcontext: null,\n\t\tantialias: true,\n\n\t\tscreenWidth: null,\n\t\tscreenHeight: null,\n\n\t\torientation: 0,\n\n\t\textraScaleFactor: 1,\n\t\tfullscreen: false\n\t},\n\n\t/*\n\t**\tScreen resolution, obtained automatically when the system is initialized.\n\t*/\n\tscreenWidth: 0, screenHeight: 0,\n\n\t/*\n\t**\tCurrent screen orientation.\n\t*/\n\torientation: 0,\n\n\t/*\n\t**\tCoordinates of the screen's offset (for letter-box effect when the screen does not fit tightly).\n\t*/\n\toffsX: 0, offsY: 0,\n\n\t/*\n\t**\tDevice pixel ratio, canvas backing store ratio and resulting canvas ratio (devicePixelRatio / backingStoreRatio).\n\t*/\n\tdevicePixelRatio: 1, backingStoreRatio: 1, canvasPixelRatio: 1, canvasScaleFactor: 1, scaleFactor: 1,\n\n\t/*\n\t**\tInitial transformation matrix. Should be used (if needed) instead of loadIdentity() since the System does some transformations first.\n\t*/\n\tinitialMatrix: null,\n\n\t/*\n\t**\tDisplay buffer for the renderer (either 2d or webgl).\n\t*/\n\tdisplayBuffer: null,\n\n\t/*\n\t**\tSecondry display buffer (always 2d).\n\t*/\n\tdisplayBuffer2: null,\n\n\t/*\n\t**\tSmall (320x240) temporal display buffer.\n\t*/\n\ttempDisplayBuffer: null,\n\n\t/*\n\t**\tMap with the status of all keys (along with other flags).\n\t*/\n\tkeyState: { time: 0, shift: false, ctrl: false, alt: false, keyCode: 0 },\n\n\t/*\n\t**\tCurrent status of all pointers. The related object is known as the Pointer State, and has the following fields:\n\t**\tid, isActive, isDragging, sx, sy, x, y, dx, dy, button\n\t*/\n\tpointerState: { },\n\n\t/*\n\t**\tThe update method of all objects will be executed when the system update() method is called.\n\t*/\n\tupdateQueue: null, /*List*/\n\n\t/*\n\t**\tThe draw method of all objects will be executed when the system draw() method is called.\n\t*/\n\tdrawQueue: null, /*List*/\n\n\t/*\n\t**\tTime scale, the frame delta is multiplied by this value before each system cycle.\n\t*/\n\ttimeScale: 1,\n\n\t/*\n\t**\tFrame interval in milliseconds.\n\t*/\n\tframeInterval: 0,\n\n\t/*\n\t**\tFixed frame interval in milliseconds, when set to non-zero value the frame delta will be set to this value.\n\t*/\n\tfixedFrameInterval: 0,\n\n\t/*\n\t**\tMaximum frame interval in milliseconds, if the frameDelta exceeds this it will be truncated to this value.\n\t*/\n\tmaxFrameInterval: 0,\n\n\t/*\n\t**\tLast frame delta in seconds and milliseconds (float, int).\n\t*/\n\tframeDelta: 0,\n\tframeDeltaMillis: 0,\n\n\t/*\n\t**\tLogical system time (updated on each cycle by the calculated frameDelta).\n\t*/\n\tframeTime: 0,\n\tframeTimeMillis: 0,\n\n\t/*\n\t**\tCurrent frame number.\n\t*/\n\tframeNumber: 0,\n\n\t/*\n\t**\tIndicates if the drawing or update process is taking place.\n\t*/\n\tframeUpdateInProgress: false,\n\tframeDrawInProgress: false,\n\n\t/*\n\t**\tRendering time data.\n\t*/\n\tperf:\n\t{\n\t\t/*\n\t\t**\tTime of the first frame drawn.\n\t\t*/\n\t\tstartTime: 0,\n\n\t\t/*\n\t\t**\tTime of the last frame drawn.\n\t\t*/\n\t\tlastTime: 0,\n\n\t\t/*\n\t\t**\tNumber of frames drawn in total since startTime.\n\t\t*/\n\t\tnumFrames: 0,\n\n\t\t/*\n\t\t**\tTotal time accumulated in each update and draw operation.\n\t\t*/\n\t\tupdateTime: 0,\n\t\tdrawTime: 0,\n\n\t\t/*\n\t\t**\tCount of samples in current perf data.\n\t\t*/\n\t\tnumSamples: 0,\n\n\t\t/*\n\t\t**\tNumber of samples to accumulate (report window size).\n\t\t*/\n\t\twindowSize: 500,\n\n\t\t/*\n\t\t**\tSnapshot data updated when numSamples is windowSize.\n\t\t*/\n\t\tsnapStartTime: 0,\n\t\tsnapNumFrames: 0,\n\t\tsnapUpdateTime: 0,\n\t\tsnapDrawTime: 0\n\t},\n\n\t/*\n\t**\tInitializes the system with the specified configuration.\n\t*/\n\tinit: function (opts)\n\t{\n\t\t// Load options from defaults and from the specified ones.\n\t\tvar o = { };\n\n\t\tObject.assign(o, this.defaultOptions);\n\t\tif (opts) Object.assign(o, opts);\n\n\t\tthis.options = o;\n\n\t\t// Set default orientation if both target sizes were specified.\n\t\tif (o.screenWidth && o.screenHeight && o.orientation == System.DEFAULT)\n\t\t{\n\t\t\to.orientation = o.screenWidth > o.screenHeight ? System.LANDSCAPE : System.PORTRAIT;\n\t\t}\n\n\t\tthis.orientation = o.orientation;\n\n\t\tthis.updateQueue = new List();\n\t\tthis.drawQueue = new List();\n\n\t\t// Attach frame event handlers.\n\t\tthis.frameInterval = int(1000 / o.fps);\n\t\tthis.maxFrameInterval = int(1000 / o.minFps);\n\n\t\tglobal.onresize = this.onWindowResized.bind(this);\n\n\t\tthis.frameTimer = new Timer (this.frameInterval, this.onFrame.bind(this), true);\n\n\t\t// Setup canvas buffer.\n\t\tthis.displayBuffer = new Canvas ({ gl: o.gl, elem: o.canvas, absolute: true, hidden: false, antialias: o.antialias, background: o.background });\n\t\tthis.displayBuffer2 = new Canvas ({ gl: false, elem: o.canvas2, absolute: true, hidden: false, antialias: o.antialias, background: 'none' });\n\n\t\tthis.displayBuffer2.elem.style.pointerEvents = 'none';\n\n\t\tthis.tempDisplayBuffer = new Canvas ({ hidden: true, antialias: o.antialias }).resize(320, 240);\n\n\t\tvar display0 = this.displayBuffer.elem;\n\n\t\t// Obtain device display ratios.\n\t\tthis.devicePixelRatio = global.devicePixelRatio || 1;\n\n\t\tthis.backingStoreRatio = o.gl == true ? 1 : (this.displayBuffer.context.webkitBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.displayBuffer.context.mozBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.displayBuffer.context.msBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.displayBuffer.context.oBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.displayBuffer.context.backingStorePixelRatio || 1);\n\n\t\tthis.canvasPixelRatio = this.devicePixelRatio / this.backingStoreRatio;\n\n\t\tSystem.onWindowResized (true);\n\n\t\t// Attach keyboard event handlers.\n\t\tvar _this = this;\n\n\t\tglobal.onkeydown = function (evt)\n\t\t{\n\t\t\tif (evt.target !== global.document.body)\n\t\t\t\treturn;\n\n\t\t\tif (_this.keyState[evt.keyCode])\n\t\t\t\treturn false;\n\n\t\t\t_this.keyState[evt.keyCode] = true;\n\n\t\t\t_this.keyState.keyCode = evt.keyCode;\n\t\t\t_this.keyState.startTime = System.now(true);\n\n\t\t\tswitch (evt.keyCode)\n\t\t\t{\n\t\t\t\tcase 16: // SHIFT\n\t\t\t\t\t_this.keyState.shift = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 17: // CTRL\n\t\t\t\t\t_this.keyState.ctrl = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 18: // ALT\n\t\t\t\t\t_this.keyState.alt = true;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// CTRL+TAB should always be handled by the browser.\n\t\t\tif (_this.keyState.ctrl && evt.keyCode == KeyCodes.TAB)\n\t\t\t{\n\t\t\t\t_this.keyState[evt.keyCode] = false;\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (_this.onKeyboardEvent (_this.EVT_KEY_DOWN, evt.keyCode, _this.keyState) === false)\n\t\t\t\treturn false;\n\t\t};\n\n\t\tglobal.onkeyup = function (evt)\n\t\t{\n\t\t\tif (evt.target !== global.document.body)\n\t\t\t\treturn;\n\n\t\t\tif (!_this.keyState[evt.keyCode])\n\t\t\t\treturn false;\n\n\t\t\t_this.keyState[evt.keyCode] = false;\n\t\t\t_this.keyState.endTime = System.now(true);\n\t\t\t_this.keyState.keyCode = evt.keyCode;\n\n\t\t\tswitch (evt.keyCode)\n\t\t\t{\n\t\t\t\tcase 16: // SHIFT\n\t\t\t\t\t_this.keyState.shift = false;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 17: // CTRL\n\t\t\t\t\t_this.keyState.ctrl = false;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 18: // ALT\n\t\t\t\t\t_this.keyState.alt = false;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (_this.onKeyboardEvent (_this.EVT_KEY_UP, evt.keyCode, _this.keyState) === false)\n\t\t\t\treturn false;\n\t\t};\n\n\t\t// Converts pointer coordinates from physical space to screen space.\n\n\t\tconst pointerConvX = function (x, y)\n\t\t{\n\t\t\treturn System.reverseRender ? ~~(System.screenWidth-1 - (y-System.offsY)/System.canvasScaleFactor) : ~~((x-System.offsX)/System.canvasScaleFactor);\n\t\t};\n\n\t\tconst pointerConvY = function (x, y)\n\t\t{\n\t\t\treturn System.reverseRender ? ~~((x-System.offsX)/System.canvasScaleFactor) : ~~((y-System.offsY)/System.canvasScaleFactor);\n\t\t};\n\n\t\t// Attach pointer event handlers if pointer-events are available.\n\t\tif (\"ontouchstart\" in global)\n\t\t{\n\t\t\tdisplay0.ontouchstart = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tvar touches = evt.changedTouches;\n\n\t\t\t\tfor (var i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointerState[touches[i].identifier])\n\t\t\t\t\t{\n\t\t\t\t\t\tSystem.pointerState[touches[i].identifier] = {\n\t\t\t\t\t\t\t\tid: touches[i].identifier, isActive: false, isDragging: false,\n\t\t\t\t\t\t\t\tsx: 0, sy: 0, x: 0, y: 0, dx: 0, dy: 0, button: 0\n\t\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tvar p = System.pointerState[touches[i].identifier];\n\n\t\t\t\t\tp.isActive = true;\n\t\t\t\t\tp.isDragging = false;\n\t\t\t\t\tp.button = 1;\n\n\t\t\t\t\tp.startTime = System.now(true);\n\n\t\t\t\t\tp.x = p.sx = pointerConvX(touches[i].clientX, touches[i].clientY);\n\t\t\t\t\tp.y = p.sy = pointerConvY(touches[i].clientX, touches[i].clientY);\n\n\t\t\t\t\tSystem.onPointerEvent (System.EVT_POINTER_DOWN, p, System.pointerState);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchend = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tvar touches = evt.changedTouches;\n\n\t\t\t\tfor (var i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointerState[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tvar p = System.pointerState[touches[i].identifier];\n\n\t\t\t\t\tp.endTime = System.now(true);\n\t\t\t\t\tp.deltaTime = p.endTime - p.startTime;\n\n\t\t\t\t\tp.x = pointerConvX(touches[i].clientX, touches[i].clientY)\n\t\t\t\t\tp.y = pointerConvY(touches[i].clientX, touches[i].clientY)\n\n\t\t\t\t\tif (p.isDragging)\n\t\t\t\t\t\tSystem.onPointerEvent (System.EVT_POINTER_DRAG_STOP, p, System.pointerState);\n\n\t\t\t\t\tSystem.onPointerEvent (System.EVT_POINTER_UP, p, System.pointerState);\n\n\t\t\t\t\tp.isActive = false;\n\t\t\t\t\tp.isDragging = false;\n\n\t\t\t\t\tp.button = 0;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchcancel = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tvar touches = evt.changedTouches;\n\n\t\t\t\tfor (var i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointerState[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tvar p = System.pointerState[touches[i].identifier];\n\n\t\t\t\t\tp.x = pointerConvX(touches[i].clientX, touches[i].clientY);\n\t\t\t\t\tp.y = pointerConvY(touches[i].clientX, touches[i].clientY);\n\n\t\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.EVT_POINTER_DRAG_STOP : System.EVT_POINTER_UP, p, System.pointerState);\n\n\t\t\t\t\tp.isActive = false;\n\t\t\t\t\tp.isDragging = false;\n\n\t\t\t\t\tp.button = 0;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchmove = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tvar touches = evt.changedTouches;\n\n\t\t\t\tfor (var i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointerState[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tvar p = System.pointerState[touches[i].identifier];\n\n\t\t\t\t\tif (p.isActive && !p.isDragging)\n\t\t\t\t\t{\n\t\t\t\t\t\tSystem.onPointerEvent (System.EVT_POINTER_DRAG_START, p, System.pointerState);\n\t\t\t\t\t\tp.isDragging = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tp.x = pointerConvX(touches[i].clientX, touches[i].clientY);\n\t\t\t\t\tp.y = pointerConvY(touches[i].clientX, touches[i].clientY);\n\n\t\t\t\t\tp.dx = p.x - p.sx;\n\t\t\t\t\tp.dy = p.y - p.sy;\n\n\t\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.EVT_POINTER_DRAG_MOVE : System.EVT_POINTER_MOVE, p, System.pointerState);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\t\t// Attach mouse event handlers when pointer-events are not available.\n\t\telse\n\t\t{\n\t\t\tdisplay0.onmousedown = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointerState[0])\n\t\t\t\t{\n\t\t\t\t\tSystem.pointerState[0] = {\n\t\t\t\t\t\t\tid: 0, isActive: false, isDragging: false, button: 0,\n\t\t\t\t\t\t\tsx: 0, sy: 0, x: 0, y: 0, dx: 0, dy: 0,\n\t\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tvar p = System.pointerState[0];\n\n\t\t\t\tp.isActive = true;\n\t\t\t\tp.isDragging = false;\n\t\t\t\tp.button = evt.which;\n\n\t\t\t\tp.x = p.sx = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = p.sy = pointerConvY(evt.clientX, evt.clientY);\n\n\t\t\t\tSystem.onPointerEvent (System.EVT_POINTER_DOWN, p, System.pointerState);\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.onmouseup = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointerState[0])\n\t\t\t\t\treturn false;\n\n\t\t\t\tvar p = System.pointerState[0];\n\n\t\t\t\tp.x = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = pointerConvY(evt.clientX, evt.clientY);\n\n\t\t\t\tif (p.isDragging)\n\t\t\t\t\tSystem.onPointerEvent (System.EVT_POINTER_DRAG_STOP, p, System.pointerState);\n\n\t\t\t\tSystem.onPointerEvent (System.EVT_POINTER_UP, p, System.pointerState);\n\n\t\t\t\tp.isActive = false;\n\t\t\t\tp.isDragging = false;\n\n\t\t\t\tp.button = 0;\n\t\t\t};\n\n\t\t\tdisplay0.onmousemove = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointerState[0])\n\t\t\t\t\treturn false;\n\n\t\t\t\tvar p = System.pointerState[0];\n\n\t\t\t\tif (p.isActive && !p.isDragging)\n\t\t\t\t{\n\t\t\t\t\tSystem.onPointerEvent (System.EVT_POINTER_DRAG_START, p, System.pointerState);\n\t\t\t\t\tp.isDragging = true;\n\t\t\t\t}\n\n\t\t\t\tp.x = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = pointerConvY(evt.clientX, evt.clientY);\n\n\t\t\t\tp.dx = p.x - p.sx;\n\t\t\t\tp.dy = p.y - p.sy;\n\n\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.EVT_POINTER_DRAG_MOVE : System.EVT_POINTER_MOVE, p, System.pointerState);\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\t},\n\n\t/*\n\t**\tReturns the current time in milliseconds or seconds if asSeconds is set to true.\n\t*/\n\tnow: function(asSeconds)\n\t{\n\t\tvar value = hrnow();\n\t\treturn asSeconds ? (value / 1000) : value;\n\t},\n\n\t/*\n\t**\tReturns the current logical time in seconds (same as reading System.frameTime).\n\t*/\n\ttime: function()\n\t{\n\t\treturn this.frameTime;\n\t},\n\n\t/*\n\t**\tStarts the system and enables rendering and updates.\n\t*/\n\tstart: function()\n\t{\n\t\tthis.onWindowResized();\n\n\t\tthis.flags.renderingPaused = false;\n\t\tthis.frameTimer.start();\n\t},\n\n\t/*\n\t**\tStops the system by disabling both rendering and updates.\n\t*/\n\tstop: function()\n\t{\n\t\tthis.flags.renderingPaused = true;\n\t\tthis.frameTimer.stop();\n\t},\n\n\t/*\n\t**\tDisables updates, but continues to render.\n\t*/\n\tpause: function()\n\t{\n\t\tthis.flags.renderingPaused = true;\n\t},\n\n\t/*\n\t**\tResumes updates if previously stopped with `pause()`.\n\t*/\n\tresume: function()\n\t{\n\t\tthis.flags.renderingPaused = false;\n\t\tthis.resetPerf();\n\t},\n\n\t/*\n\t**\tExecuted when a frame needs to be rendered to the display buffer.\n\t*/\n\tonFrame: function(delta, timer)\n\t{\n\t\tvar now = this.now();\n\t\tvar tmp;\n\n\t\tif (delta > this.maxFrameInterval)\n\t\t\tdelta = this.maxFrameInterval;\n\n\t\tif (this.fixedFrameInterval != 0)\n\t\t\tdelta = this.fixedFrameInterval;\n\n\t\tif (!this.flags.renderingEnabled || this.flags.renderingPaused)\n\t\t{\n\t\t\tthis.frameDrawInProgress = true;\n\t\t\ttry {\n\t\t\t\tthis.displayBuffer.clear();\n\t\t\t\tthis.draw (this.displayBuffer, this.displayBuffer2);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tconsole.error(\"DRAW ERROR: \\n\" + e + \"\\n\" + e.stack);\n\t\t\t}\t\n\t\t\tthis.frameDrawInProgress = false;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.perf.numFrames == 0)\n\t\t{\n\t\t\tthis.perf.startTime = now - this.frameInterval;\n\t\t\tthis.perf.lastTime = now;\n\t\t}\n\n\t\tdelta *= this.timeScale;\n\n\t\tthis.frameDeltaMillis = delta;\n\t\tthis.frameDelta = delta / 1000.0;\n\t\tthis.frameTimeMillis += this.frameDeltaMillis;\n\t\tthis.frameTime += this.frameDelta;\n\t\tthis.frameNumber++;\n\n\t\t/* ~ */\n\t\tthis.frameUpdateInProgress = true;\n\t\ttmp = hrnow();\n\t\ttry {\n\t\t\tthis.update (this.frameDelta, this.frameDeltaMillis);\n\t\t}\n\t\tcatch (e) {\n\t\t\tSystem.stop();\n\t\t\tthrow e;\n\t\t}\n\t\tthis.perf.updateTime += hrnow() - tmp;\n\t\tthis.frameUpdateInProgress = false;\n\n\t\t/* ~ */\n\t\tthis.frameDrawInProgress = true;\n\t\ttmp = hrnow();\n\t\ttry {\n\t\t\tthis.displayBuffer.clear();\n\t\t\tthis.draw (this.displayBuffer, this.displayBuffer2);\n\t\t}\n\t\tcatch (e) {\n\t\t\tSystem.stop();\n\t\t\tthrow e;\n\t\t}\t\n\t\tthis.perf.drawTime += hrnow() - tmp;\n\t\tthis.frameDrawInProgress = false;\n\n\t\tthis.perf.lastTime = now;\n\t\tthis.perf.numFrames++;\n\n\t\t/*\n\t\tthis.perf.numSamples++;\n\n\t\tif (this.perf.numSamples == this.perf.windowSize)\n\t\t{\n\t\t\tthis.perf.snapStartTime = this.perf.lastTime;\n\t\t\tthis.perf.snapNumFrames = this.perf.numFrames;\n\t\t\tthis.perf.snapUpdateTime = this.perf.updateTime;\n\t\t\tthis.perf.snapDrawTime = this.perf.drawTime;\n\t\t}\n\n\t\tif (this.perf.numSamples == 2*this.perf.windowSize)\n\t\t{\n\t\t\tthis.perf.startTime = this.perf.snapStartTime;\n\t\t\tthis.perf.numFrames -= this.perf.snapNumFrames;\n\t\t\tthis.perf.updateTime -= this.perf.snapUpdateTime;\n\t\t\tthis.perf.drawTime -= this.perf.snapDrawTime;\n\n\t\t\tthis.perf.numSamples = 0;\n\t\t}\n\t\t*/\n\t},\n\n\t/*\n\t**\tExecuted when the size of the window has changed. Will cause a full buffer rendering.\n\t*/\n\tonWindowResized: function(notRendering=false)\n\t{\n\t\tif ('document' in global)\n\t\t{\n\t\t\tif (this.options.fullscreen)\n\t\t\t{\n\t\t\t\tthis._screenWidth = int(global.screen.width);\n\t\t\t\tthis._screenHeight = int(global.screen.height);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._screenWidth = global.innerWidth;\n\t\t\t\tthis._screenHeight = global.innerHeight;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._screenWidth = this.options.screenWidth;\n\t\t\tthis._screenHeight = this.options.screenHeight;\n\n\t\t\tif (this.options.screenWidth == null && this.options.screenHeight == null)\n\t\t\t\tthrow new Error ('At least one screen dimension must be specified in headless mode.');\n\t\t}\n\n\t\tif ((this._screenWidth < this._screenHeight && this.orientation == System.LANDSCAPE) || (this._screenWidth > this._screenHeight && this.orientation == System.PORTRAIT))\n\t\t{\n\t\t\tthis.screenWidth = this._screenHeight;\n\t\t\tthis.screenHeight = this._screenWidth;\n\n\t\t\tthis.reverseRender = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.screenWidth = this._screenWidth;\n\t\t\tthis.screenHeight = this._screenHeight;\n\n\t\t\tthis.reverseRender = false;\n\t\t}\n\n\t\t// ***\n\t\tlet targetScreenWidth = this.options.screenWidth;\n\t\tlet targetScreenHeight = this.options.screenHeight;\n\n\t\tif (targetScreenWidth == null || targetScreenHeight == null)\n\t\t{\n\t\t\tif (targetScreenWidth == null)\n\t\t\t{\n\t\t\t\ttargetScreenWidth = int(this.screenWidth * (this.options.screenHeight / this.screenHeight));\n\t\t\t}\n\t\t\telse if (targetScreenHeight == null)\n\t\t\t{\n\t\t\t\ttargetScreenHeight = int(this.screenHeight * (this.options.screenWidth / this.screenWidth));\n\t\t\t}\n\t\t}\n\n\t\t// ***\n\t\tlet screenWidth = targetScreenWidth;\n\t\tlet screenHeight = targetScreenHeight;\n\n\t\tif (this.orientation == System.AUTOMATIC && screenWidth && screenHeight)\n\t\t{\n\t\t\tif ((screenWidth > screenHeight && this.screenWidth < this.screenHeight) || (screenWidth < screenHeight && this.screenWidth > this.screenHeight))\n\t\t\t{\n\t\t\t\tscreenWidth = screenHeight;\n\t\t\t\tscreenHeight = targetScreenWidth;\n\t\t\t}\n\t\t}\n\n\t\t// ***\n\t\tthis.canvasScaleFactor = 1;\n\n\t\tif (screenWidth && screenHeight)\n\t\t{\n\t\t\tthis.canvasScaleFactor = Math.min (this.screenWidth / screenWidth, this.screenHeight / screenHeight);\n\t\t}\n\t\telse if (screenWidth)\n\t\t{\n\t\t\tthis.canvasScaleFactor = this.screenWidth / screenWidth;\n\t\t}\n\t\telse if (screenHeight)\n\t\t{\n\t\t\tthis.canvasScaleFactor = this.screenHeight / screenHeight;\n\t\t}\n\n\t\t// ***\n\t\tlet _screenWidth = this.screenWidth;\n\t\tlet _screenHeight = this.screenHeight;\n\n\t\tif (screenWidth) this.screenWidth = screenWidth;\n\t\tif (screenHeight) this.screenHeight = screenHeight;\n\n\t\tthis.offsX = int((_screenWidth - this.screenWidth*this.canvasScaleFactor)*0.5);\n\t\tthis.offsY = int((_screenHeight - this.screenHeight*this.canvasScaleFactor)*0.5);\n\n\t\tif (this.reverseRender)\n\t\t{\n\t\t\tlet tmp = this.offsX;\n\t\t\tthis.offsX = this.offsY;\n\t\t\tthis.offsY = tmp;\n\t\t}\n\n\t\tthis.scaleFactor = this.canvasScaleFactor * this.canvasPixelRatio;\n\t\tthis.scaleFactor = ~~(0.7 + this.scaleFactor);\n\n\t\tthis.flags.renderingEnabled = false;\n\n\t\tif ('document' in global)\n\t\t\tglobal.document.body.style.backgroundColor = this.displayBuffer.backgroundColor;\n\n\t\tif (!this.reverseRender)\n\t\t{\n\t\t\tthis.displayBuffer.resize (this.screenWidth*this.scaleFactor, this.screenHeight*this.scaleFactor);\n\t\t\tthis.displayBuffer.elem.style.width = (this.screenWidth*this.canvasScaleFactor) + \"px\";\n\t\t\tthis.displayBuffer.elem.style.height = (this.screenHeight*this.canvasScaleFactor) + \"px\";\n\n\t\t\tthis.displayBuffer2.resize (this.screenWidth*this.scaleFactor, this.screenHeight*this.scaleFactor);\n\t\t\tthis.displayBuffer2.elem.style.width = (this.screenWidth*this.canvasScaleFactor) + \"px\";\n\t\t\tthis.displayBuffer2.elem.style.height = (this.screenHeight*this.canvasScaleFactor) + \"px\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.displayBuffer.resize (this.screenHeight*this.scaleFactor, this.screenWidth*this.scaleFactor);\n\t\t\tthis.displayBuffer.elem.style.width = (this.screenHeight*this.canvasScaleFactor) + \"px\";\n\t\t\tthis.displayBuffer.elem.style.height = (this.screenWidth*this.canvasScaleFactor) + \"px\";\n\n\t\t\tthis.displayBuffer2.resize (this.screenHeight*this.scaleFactor, this.screenWidth*this.scaleFactor);\n\t\t\tthis.displayBuffer2.elem.style.width = (this.screenHeight*this.canvasScaleFactor) + \"px\";\n\t\t\tthis.displayBuffer2.elem.style.height = (this.screenWidth*this.canvasScaleFactor) + \"px\";\n\t\t}\n\n\t\tthis.displayBuffer.elem.style.marginLeft = this.offsX + \"px\";\n\t\tthis.displayBuffer.elem.style.marginTop = this.offsY + \"px\";\n\n\t\tthis.displayBuffer2.elem.style.marginLeft = this.offsX + \"px\";\n\t\tthis.displayBuffer2.elem.style.marginTop = this.offsY + \"px\";\n\n\t\tthis.displayBuffer.loadIdentity();\n\t\tthis.displayBuffer2.loadIdentity();\n\n\t\tif (this.scaleFactor != 1) {\n\t\t\tthis.displayBuffer.globalScale(this.scaleFactor);\n\t\t\tthis.displayBuffer2.globalScale(this.scaleFactor);\n\t\t}\n\n\t\tif (this.reverseRender)\n\t\t{\n\t\t\tthis.displayBuffer.rotate(Math.PI/2);\n\t\t\tthis.displayBuffer.translate(-this.screenWidth, 0);\n\t\t\tthis.displayBuffer.flipped(true);\n\n\t\t\tthis.displayBuffer2.rotate(Math.PI/2);\n\t\t\tthis.displayBuffer2.translate(-this.screenWidth, 0);\n\t\t\tthis.displayBuffer2.flipped(true);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.displayBuffer.flipped(false);\n\t\t\tthis.displayBuffer2.flipped(false);\n\t\t}\n\n\t\t/* *** */\n\t\tthis.scaleFactor *= this.options.extraScaleFactor;\n\n\t\tthis.integerScaleFactor = ~~(this.scaleFactor + 0.9);\n\t\tthis.resetPerf();\n\n\t\tthis.initialMatrix = this.displayBuffer.getMatrix();\n\n\t\tif (notRendering != true)\n\t\t{\n\t\t\tthis.flags.renderingEnabled = true;\n\t\t\tthis.onCanvasResized (this.screenWidth, this.screenHeight);\n\t\t}\n\t},\n\n\t/*\n\t**\tEvent triggered when the canvas was resized by the system.\n\t*/\n\tonCanvasResized: function (screenWidth, screenHeight)\n\t{\n\t},\n\n\t/*\n\t**\tResets the performance data.\n\t*/\n\tresetPerf: function()\n\t{\n\t\tthis.perf.numFrames = 0;\n\t},\n\n\t/*\n\t**\tAdds the specified handler to the update queue. Must have method update (deltaTime: int).\n\t*/\n\tupdateQueueAdd: function (/*object*/handler)\n\t{\n\t\tthis.updateQueue.push (handler);\n\t\treturn this.updateQueue.bottom;\n\t},\n\n\t/*\n\t**\tRemoves the specified handler from the update queue.\n\t*/\n\tupdateQueueRemove: function (/*object*/handler)\n\t{\n\t\tthis.updateQueue.remove (handler instanceof Linkable ? handler : this.updateQueue.sgetNode(handler));\n\t},\n\n\t/*\n\t**\tAdds the specified handler to the draw queue. Must have method draw (canvas: Canvas).\n\t*/\n\tdrawQueueAdd: function (/*object*/handler)\n\t{\n\t\tthis.drawQueue.push (handler);\n\t\treturn this.drawQueue.bottom;\n\t},\n\n\t/*\n\t**\tRemoves the specified handler from the draw queue.\n\t*/\n\tdrawQueueRemove: function (/*object*/handler)\n\t{\n\t\tthis.drawQueue.remove (handler instanceof Linkable ? handler : this.drawQueue.sgetNode(handler));\n\t},\n\n\t/*\n\t**\tAdds the specified handler to the update and draw queues. Must have both update (deltaTime: int) and draw (canvas: Canvas) methods. Returns `obj`.\n\t*/\n\tqueueAdd: function (/*object*/handler)\n\t{\n\t\tthis.updateQueue.push (handler);\n\t\tthis.drawQueue.push (handler);\n\t\treturn handler;\n\t},\n\n\t/*\n\t**\tRemoves the specified handler from the update and draw queues.\n\t*/\n\tqueueRemove: function (/*object*/handler)\n\t{\n\t\tthis.updateQueue.remove (this.updateQueue.sgetNode(handler));\n\t\tthis.drawQueue.remove (this.drawQueue.sgetNode(handler));\n\t},\n\n\t/*\n\t**\tRuns an update cycle, all objects in the updateQueue will be updated.\n\t*/\n\tupdate: function (dts, dtm)\n\t{\n\t\tvar next;\n\n\t\tfor (var elem = this.updateQueue.top; elem; elem = next)\n\t\t{\n\t\t\tnext = elem.next;\n\t\t\telem.value.update(dts, dtm);\n\t\t}\n\t},\n\n\t/*\n\t**\tRuns a rendering cycle, all objects in the drawQueue will be drawn.\n\t*/\n\tdraw: function (canvas, canvas2)\n\t{\n\t\tvar next;\n\n\t\tfor (var elem = this.drawQueue.top; elem; elem = next)\n\t\t{\n\t\t\tnext = elem.next;\n\t\t\telem.value.draw(canvas, canvas2);\n\t\t}\n\t},\n\n\t/*\n\t**\tInterpolates numeric values between two objects (`src` and `dst`) using the specified `duration` and `easing` function. Note that all four parameters\n\t**\t`src`, `dst`, `duration` and `easing` must be objects having the same number of values.\n\t*/\n\tinterpolate: function (src, dst, duration, easing, callback/* function(data, isFinished) */)\n\t{\n\t\tlet time = { };\n\t\tlet data = { };\n\t\tlet count = 0;\n\n\t\tfor (let x in src)\n\t\t{\n\t\t\ttime[x] = 0.0;\n\t\t\tdata[x] = src[x]\n\t\t\tcount++;\n\t\t}\n\n\t\tlet interpolator =\n\t\t{\n\t\t\tupdate: function(dt)\n\t\t\t{\n\t\t\t\tfor (let x in time)\n\t\t\t\t{\n\t\t\t\t\tif (time[x] == duration[x])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\ttime[x] += dt;\n\t\t\t\t\tif (time[x] >= duration[x])\n\t\t\t\t\t{\n\t\t\t\t\t\ttime[x] = duration[x];\n\t\t\t\t\t\tcount--;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet t = easing[x] (time[x] / duration[x]);\n\t\t\t\t\tdata[x] = (1-t)*src[x] + t*dst[x];\n\t\t\t\t}\n\n\t\t\t\tcallback (data, count == 0);\n\n\t\t\t\tif (count == 0)\n\t\t\t\t\tSystem.updateQueueRemove(interpolator);\n\t\t\t}\n\t\t};\n\n\t\tSystem.updateQueueAdd(interpolator);\n\t\tinterpolator.update(0);\n\t},\n\n\t/*\n\t**\tEvent triggered when a keyboard event is detected by the system, `action` is one of the EVT_KEY_* constants,\n\t**\t`keyCode` is one of the `KeyCodes` constants and `keyState` a reference to `System.keyState`.\n\t*/\n\tonKeyboardEvent: function (action, keyCode, keyState)\n\t{\n\t},\n\n\t/*\n\t**\tEvent triggered when a pointer event is detected by the system, `action` is one of the EVT_POINTER_* constants,\n\t**\t`pointer` contains the pointer state, and `pointers` a reference to `System.pointerState`.\n\t*/\n\tonPointerEvent: function (action, pointer, pointers)\n\t{\n\t}\n};\n\nexport default System;\n","/*\n**\tsystem/perf.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tSmall utility class for performance tracking.\n**\n**\t>> Perf __constructor (float accumSize, float expectedValue);\n**\t>> Perf __constructor (float accumSize);\n*/\n\nconst Perf = function (accumSize, expectedValue)\n{\n\tthis.data = [ ];\n\tthis.accumSize = accumSize;\n\n\tthis.expectedValue = expectedValue;\n\n\tthis.stdSum = 0;\n\tthis.stdCount = 0;\n};\n\nexport default Perf;\n\n/**\n**\tMarks the start time of the performance test.\n**\n**\t>> void begin();\n*/\n\nPerf.prototype.begin = function ()\n{\n\tthis.startTime = performance.now();\n};\n\n\n/**\n**\tMarks the end time of the performance test, the elapsed time is fed into the tracker.\n**\n**\t>> void end();\n*/\n\nPerf.prototype.end = function ()\n{\n\tthis.feed (performance.now() - this.startTime);\n};\n\n\n/**\n**\tFeeds a value into the tracker, auto-generates a report using console.log when the number of samples\n**\treaches the accumSize specified in the constructor.\n**\n**\t>> void feed (float value);\n*/\n\nPerf.prototype.feed = function (value)\n{\n\tthis.data.push(value);\n\n\tif (this.data.length != this.accumSize)\n\t\treturn;\n\n\tthis.report();\n\tthis.data = [ ];\n};\n\n\n/**\n**\tShows a report using console.log, if the returnString parameter is set to true, the report string will be returned\n**\tinstead of printed. After a call to this method instance variables 'min', 'max', 'avg' and 'std' will be populated.\n**\n**\t>> void report (bool returnString=false);\n*/\n\nPerf.prototype.report = function (returnString)\n{\n\tvar min = null;\n\tvar max = null;\n\tvar avg = 0;\n\tvar std = 0;\n\n\tfor (var i = 0; i < this.data.length; i++)\n\t{\n\t\tmin = min === null ? this.data[i] : Math.min(min, this.data[i]);\n\t\tmax = max === null ? this.data[i] : Math.max(max, this.data[i]);\n\t\tavg += this.data[i];\n\t}\n\n\tavg /= this.data.length;\n\n\tvar e = this.expectedValue !== undefined ? this.expectedValue : avg;\n\n\tfor (var i = 0; i < this.data.length; i++) std += Math.pow(this.data[i] - e, 2);\n\n\tstd = Math.sqrt(std / this.data.length);\n\n\tthis.stdSum += std;\n\tthis.stdCount++;\n\n\tvar out = \"N: \" + this.stdCount + \", MIN: \" + min + \", MAX: \" + max + \", AVG: \" + avg.toFixed(2) + (this.expectedValue !== undefined ? \", E: \" + this.expectedValue : \"\") + \", STDDEV: \" + std.toFixed(2) + \", AVG_STDDEV: \" + (this.stdSum / this.stdCount).toFixed(2);\n\n\tthis.min = min;\n\tthis.max = max;\n\tthis.avg = avg;\n\tthis.std = std;\n\n\tif (returnString === true)\n\t\treturn out;\n\n\tconsole.log(out);\n};\n","/*\n**\tsystem/idrawable\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\n\nexport default Class.extend\n({\n\tclassName: \"IDrawable\",\n\n\twidth: null,\n\theight: null,\n\n\t__ctor: function (width, height)\n\t{\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t},\n\n\tdraw: function (g, x=0, y=0, width=null, height=null)\n\t{\n\t},\n\n\tgetDrawable: function ()\n\t{\n\t\treturn this;\n\t}\n});\n","/*\n**\tsystem/iupdateable\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\n\nexport default Class.extend\n({\n\tclassName: \"IUpdateable\",\n\n\t__ctor: function ()\n\t{\n\t},\n\n\tupdate: function (dt)\n\t{\n\t}\n});\n","/*\n**\tresources/resources.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rin } from '@rsthn/rin';\nimport System from '../system/system.js';\nimport Canvas from '../system/canvas.js';\n\nconst Resources = { };\nexport default Resources;\n\nimport * as Wrappers from './wrappers.js';\n\n/**\n**\tProvides functionality to load and manipulate resources (images, audio, etc).\n*/\nObject.assign(Resources,\n{\n\t/**\n\t**\tIndicates if integer scaling is enabled when calling resizeImage(), when enabled, applies only to up-scaling, and images will always be up-scaled\n\t**\tto integer factors only and the drawImageEx will take care of drawing it slighly resized to the target canvas. If disabled the images will be\n\t**\tdown or up-scaled using the half/double method and will eventually end up having the specified target size.\n\t*/\n\tintegerScaling: true,\n\n\t/**\n\t**\tDefault for the 'pixelated' parameter of image resources.\n\t*/\n\tpixelated: false,\n\n\t/**\n\t**\tInitializes all wrappers and loads the specified options object.\n\t*/\n\tinit: function (opts=null)\n\t{\n\t\tif (opts)\n\t\t\tObject.assign(this, opts);\n\t},\n\n\t/**\n\t**\tLoads a list of resources. The list parameter is a map with elements as shown in the example below,\n\t**\tthe callback can be optionally specified and it will be called with the index of the element being\n\t**\tloaded and the total number of elements to load.\n\t**\n\t**\t{ type: \"image\", wrapper: \"\", src: \"assets/ui/btn-left.png\", width: 64, [ height: 64 ], scale: 1, pixelated: false, original: false }\n\t**\t{ type: \"images\", wrapper: \"\", src: \"assets/ui/##.png\", count: 16, width: 64, [ height: 64 ], pixelated: false }\n\t**\t{ type: \"audio\", wrapper: \"\", src: \"assets/ui/tap.wav\" }\n\t**\t{ type: \"audios\", wrapper: \"\", src: \"assets/ui/snd-##.wav\", count: 4 }\n\t**\t{ type: \"json\", wrapper: \"\", src: \"assets/config.json\" }\n\t**\t{ type: \"object\", wrapper: \"\" }\n\t*/\n\tload: function (list, callback, completeCallback, keyList, index)\n\t{\n\t\tif (!keyList)\n\t\t{\n\t\t\tkeyList = Object.keys(list);\n\t\t\tlist.__original = Rin.clone(list);\n\t\t\tindex = 0;\n\t\t}\n\n\t\tif (callback) callback (index, keyList.length, index / keyList.length);\n\n\t\tif (index == keyList.length)\n\t\t{\n\t\t\tif (completeCallback) completeCallback(list);\n\t\t\treturn;\n\t\t}\n\n\t\tvar r = list[keyList[index]];\n\n\t\tr.resName = keyList[index];\n\n\t\tswitch (r.type)\n\t\t{\n\t\t\t// *********************\n\t\t\tcase \"image\":\n\t\t\t\tr.data = new Image ();\n\n\t\t\t\tr.data.onload = function ()\n\t\t\t\t{\n\t\t\t\t\tvar ratio = r.data.width / r.data.height;\n\n\t\t\t\t\tif (r.scale)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.width = ~~(r.data.width*r.scale);\n\t\t\t\t\t\tr.height = ~~(r.data.height*r.scale);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!r.width && !r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.width = r.data.width;\n\t\t\t\t\t\tr.height = r.data.height;\n\t\t\t\t\t}\n\t\t\t\t\telse if (r.width && !r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.height = int(r.width / ratio);\n\t\t\t\t\t}\n\t\t\t\t\telse if (!r.width && r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.width = int(ratio * r.height);\n\t\t\t\t\t}\n\n\t\t\t\t\tr.owidth = r.data.width;\n\t\t\t\t\tr.oheight = r.data.height;\n\n\t\t\t\t\tif (r.pixelated === null || !r.hasOwnProperty('pixelated'))\n\t\t\t\t\t\tr.pixelated = Resources.pixelated;\n\n\t\t\t\t\tif (r.data.width != r.width || r.data.height != r.height || (r.original !== true && System.scaleFactor != 1))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (r.original === true)\n\t\t\t\t\t\t\tr.data = Resources.resizeImage (r, r.width, r.height, r.pixelated, true);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tr.data = Resources.resizeImage (r, r.width * (r.pixelated ? System.integerScaleFactor : System.scaleFactor), r.height * (r.pixelated ? System.integerScaleFactor : System.scaleFactor), r.pixelated, true);\n\t\t\t\t\t}\n\n\t\t\t\t\tr.rscale = r.data.width / r.width;\n\n\t\t\t\t\t// Used to prevent a delay when rendering an image for the first time on some browsers.\n\t\t\t\t\tSystem.tempDisplayBuffer.drawImage(r.data, 0, 0);\n\n\t\t\t\t\tSystem.displayBuffer.prepareImage(r.data);\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\n\t\t\t\t\tResources.load (list, callback, completeCallback, keyList, index+1);\n\t\t\t\t};\n\n\t\t\t\tr.data.onerror = function () {\n\t\t\t\t\tconsole.error (\"Error: Unable to load: \" + r.resName);\n\t\t\t\t};\n\n\t\t\t\tr.data.src = r.src + \"?r=\" + Math.random();\n\t\t\t\tbreak;\n\n\t\t\t// *********************\n\t\t\tcase \"images\":\n\n\t\t\t\tvar src = r.src;\n\n\t\t\t\tvar d0 = src.indexOf(\"#\");\n\t\t\t\tvar d1 = src.lastIndexOf(\"#\");\n\t\t\t\tvar dN = d1 - d0 + 1;\n\n\t\t\t\tif (d0 == -1)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'src' attribute requires one or more '#' marks.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!r.count)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'count' attribute was not found.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tr._i = 0;\n\t\t\t\tr.data = [ ];\n\n\t\t\t\tvar cb = function ()\n\t\t\t\t{\n\t\t\t\t\tif (r._i == r.count)\n\t\t\t\t\t{\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\t\tResources.load (list, callback, completeCallback, keyList, index + 1);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar tmp = { type: \"image\", width: r.width, height: r.height, scale: r.scale };\n\n\t\t\t\t\ttmp.src = r.src.substr(0, d0) + ((r._i++) / Math.pow(10,dN)).toFixed(dN).substr(2) + r.src.substr(d1+1);\n\t\t\t\t\ttmp.data = new Image ();\n\t\t\t\t\ttmp.resName = r.resName + \"#\" + (r._i - 1);\n\n\t\t\t\t\ttmp.data.onload = function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar ratio = tmp.data.width / tmp.data.height;\n\n\t\t\t\t\t\tif (tmp.scale)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = ~~(tmp.data.width*tmp.scale);\n\t\t\t\t\t\t\ttmp.height = ~~(tmp.data.height*tmp.scale);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!tmp.width && !tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = tmp.data.width;\n\t\t\t\t\t\t\ttmp.height = tmp.data.height;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (tmp.width && !tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.height = int(tmp.width / ratio);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!tmp.width && tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = int(ratio * tmp.height);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (r._i == 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tr.owidth = tmp.data.width;\n\t\t\t\t\t\t\tr.oheight = tmp.data.height;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (tmp.data.width != tmp.width || tmp.data.height != tmp.height || (tmp.original !== true && System.scaleFactor != 1))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (r.pixelated === null || !r.hasOwnProperty('pixelated'))\n\t\t\t\t\t\t\t\tr.pixelated = Resources.pixelated;\n\n\t\t\t\t\t\t\tif (tmp.original === true)\n\t\t\t\t\t\t\t\ttmp.data = Resources.resizeImage (tmp, tmp.width, tmp.height, r.pixelated, true);\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\ttmp.data = Resources.resizeImage (tmp, tmp.width * (r.pixelated ? System.integerScaleFactor : System.scaleFactor), tmp.height * (r.pixelated ? System.integerScaleFactor : System.scaleFactor), r.pixelated, true);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttmp.rscale = tmp.data.width / tmp.width;\n\n\t\t\t\t\t\tif (r._i == 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tr.width = tmp.width;\n\t\t\t\t\t\t\tr.height = tmp.height;\n\t\t\t\t\t\t\tr.rscale = tmp.rscale;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tSystem.tempDisplayBuffer.drawImage(tmp.data, 0, 0);\n\t\t\t\t\t\tSystem.displayBuffer.prepareImage(tmp.data);\n\n\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\tcb();\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.onerror = function () {\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName);\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.src = tmp.src + \"?r=\" + Math.random();\n\t\t\t\t};\n\n\t\t\t\tcb();\n\t\t\t\tbreak;\n\n\t\t\tcase \"audio\":\n\n\t\t\t\tif (!r.track) r.track = \"sfx\";\n\n\t\t\t\tif (global.plugins && global.plugins.NativeAudio && r.track == \"sfx\")\n\t\t\t\t{\n\t\t\t\t\tr.engine = Wrappers.Sound.ENGINE_NATIVEAUDIO;\n\t\t\t\t\tr.data = \"snd_\" + index;\n\n\t\t\t\t\tglobal.plugins.NativeAudio.preloadSimple(r.data, r.src,\n\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\t\t\tResources.load (list, callback, completeCallback, keyList, index + 1);\t\t\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction(e) {\n\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load (sfx): \" + r.resName + \"\\n\" + e);\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (global.audioContext)\n\t\t\t\t{\n\t\t\t\t\tr.engine = Wrappers.Sound.ENGINE_WEBAUDIO;\n\n\t\t\t\t\tfetchAudioBuffer (r.src + \"?r=\" + Math.random())\n\t\t\t\t\t.then (audioBuffer => {\n\t\t\t\t\t\tr.data = audioBuffer;\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\t\tResources.load (list, callback, completeCallback, keyList, index + 1);\t\t\n\t\t\t\t\t})\n\t\t\t\t\t.catch (err => {\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName);\n\t\t\t\t\t});\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tr.data = new Audio ();\n\t\t\t\tr.engine = Wrappers.Sound.ENGINE_HTML5;\n\n\t\t\t\tr.data.oncanplaythrough = function ()\n\t\t\t\t{\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\tResources.load (list, callback, completeCallback, keyList, index + 1);\n\t\t\t\t};\n\n\t\t\t\tr.data.onerror = function ()\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName);\n\t\t\t\t};\n\n\t\t\t\tr.data.src = r.src + \"?r=\" + Math.random();\n\t\t\t\tbreak;\n\n\t\t\tcase \"audios\":\n\n\t\t\t\tvar src = r.src;\n\n\t\t\t\tvar d0 = src.indexOf(\"#\");\n\t\t\t\tvar d1 = src.lastIndexOf(\"#\");\n\t\t\t\tvar dN = d1 - d0 + 1;\n\n\t\t\t\tif (d0 == -1)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'src' attribute requires one or more '#' marks.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!r.count)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'count' attribute was not found.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tr._i = 0;\n\t\t\t\tr.data = [ ];\n\n\t\t\t\tvar cb = function ()\n\t\t\t\t{\n\t\t\t\t\tif (r._i == r.count)\n\t\t\t\t\t{\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\t\tResources.load (list, callback, completeCallback, keyList, index + 1);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar tmp = { type: \"audio\", track: r.track };\n\n\t\t\t\t\ttmp.src = r.src.substr(0, d0) + ((r._i++) / Math.pow(10,dN)).toFixed(dN).substr(2) + r.src.substr(d1+1);\n\t\t\t\t\ttmp.resName = r.resName + \"#\" + (r._i - 1);\n\n\t\t\t\t\tif (!tmp.track) tmp.track = \"sfx\";\n\n\t\t\t\t\tif (global.plugins && global.plugins.NativeAudio && tmp.track == \"sfx\")\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_NATIVEAUDIO;\n\t\t\t\t\t\ttmp.data = \"snd_\" + index + \"_\" + r._i;\n\t\n\t\t\t\t\t\tglobal.plugins.NativeAudio.preloadSimple(tmp.data, tmp.src,\n\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\t\t\tcb();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfunction(e) {\n\t\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load (sfx): \" + tmp.resName + \"\\n\" + e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (global.audioContext)\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_WEBAUDIO;\n\n\t\t\t\t\t\tfetchAudioBuffer (tmp.src + \"?r=\" + Math.random())\n\t\t\t\t\t\t.then (audioBuffer => {\n\t\t\t\t\t\t\ttmp.data = audioBuffer;\n\t\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\t\tcb();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch (err => {\n\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\ttmp.data = new Audio ();\n\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_HTML5;\n\n\t\t\t\t\ttmp.data.oncanplaythrough = function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\tcb();\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.onerror = function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName);\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.src = tmp.src + \"?r=\" + Math.random();\n\t\t\t\t};\n\n\t\t\t\tcb();\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"json\":\n\n\t\t\t\tfetchd (r.src + \"?r=\" + Math.random(), { responseType: 'json' }).then(function(json)\n\t\t\t\t{\n\t\t\t\t\tr.data = json;\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\tResources.load (list, callback, completeCallback, keyList, index + 1);\n\t\t\t\t})\n\t\t\t\t.catch(function(err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName + \". Error: \" + err);\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"object\":\n\t\t\t\tr.data = { };\n\n\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\tResources.load (list, callback, completeCallback, keyList, index + 1);\n\t\t\t\tbreak;\n\t\t}\n\t},\n\n\t/**\n\t**\tUnloads the specified list of resources.\n\t*/\n\tunload: function (list)\n\t{\n\t\tvar __original;\n\n\t\tfor (var i in list)\n\t\t{\n\t\t\tif (i == \"__original\")\n\t\t\t{\n\t\t\t\t__original = list[i];\n\t\t\t\tdelete list[i];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (list[i].r)\n\t\t\t{\n\t\t\t\tdispose(list[i]);\n\t\t\t\tlist[i] = list[i].r;\n\t\t\t}\n\n\t\t\tswitch (list[i].type)\n\t\t\t{\n\t\t\t\tcase \"audio\":\n\t\t\t\t\t// violet: unload audio if using NativeAudio\n\t\t\t\t\t// global.plugins.NativeAudio.unload\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"audios\":\n\t\t\t\t\t// violet: unload audio if using NativeAudio\n\t\t\t\t\t// global.plugins.NativeAudio.unload\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"images\":\n\t\t\t\t\tfor (var j = 0; j < list[i].data.length; j++)\n\t\t\t\t\t\tdispose (list[i].data[j]);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tdispose (list[i].data);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tlist[i].data = null;\n\t\t\tdelete list[i];\n\t\t}\n\n\t\tfor (var i in __original)\n\t\t\tlist[i] = __original[i];\n\t},\n\n\t/**\n\t**\tExecutes post-load actions on a resource.\n\t*/\n\tonLoaded: function (list, index)\n\t{\n\t\tvar r = list[index];\n\t\tif (!r.wrapper || !(r.wrapper in Wrappers)) return;\n\n\t\tlist[index] = new Wrappers[r.wrapper] (r);\n\t},\n\n\t/**\n\t**\tResizes the given image to the specified size.\n\t*/\n\tresizeImage: function (image, dw, dh, pixelated, discardOriginal)\n\t{\n\t\tvar sw = image.data.width;\n\t\tvar sh = image.data.height;\n\n\t\tdw = int(dw);\n\t\tdh = int(dh);\n\n\t\tif (sw == dw && sh == dh)\n\t\t\treturn image.data;\n\n\t\tif (!this.integerScaling && pixelated) pixelated = null;\n\n\t\tif (!pixelated)\n\t\t{\n\t\t\tpixelated = pixelated === null ? false : true;\n\n\t\t\tvar temp = new Canvas ({ hidden: true, antialias: pixelated }).resize (sw, sh);\n\t\t\ttemp.drawImage (image.data, 0, 0);\n\n\t\t\twhile (true)\n\t\t\t{\n\t\t\t\tvar tw = sw >> 1;\n\t\t\t\tvar th = sh >> 1;\n\n\t\t\t\tif (tw <= dw || th <= dh)\n\t\t\t\t\tbreak;\n\n\t\t\t\tvar output = new Canvas ({ hidden: true, antialias: pixelated }).resize (tw, th);\n\t\t\t\toutput.drawImage (temp.elem, 0, 0, tw, th);\n\t\t\t\ttemp.dispose ();\n\n\t\t\t\tsw = tw;\n\t\t\t\tsh = th;\n\n\t\t\t\ttemp = output;\n\t\t\t}\n\n\t\t\tvar output = new Canvas ({ hidden: true, antialias: pixelated }).resize (dw, dh);\n\t\t\toutput.drawImage (temp.elem, 0, 0, dw, dh);\n\t\t\ttemp.dispose ();\n\n\t\t\tif (discardOriginal)\n\t\t\t\tdispose (image.data);\n\n\t\t\treturn output.elem;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (~~(dw / sw) > 0)\n\t\t\t{\n\t\t\t\tvar ratio = ~~((dw / sw) + 0.9);\n\n\t\t\t\tdw = ratio * sw;\n\t\t\t\tdh = ratio * sh;\n\n\t\t\t\tvar rep_x = dw / sw;\n\t\t\t\tvar rep_y = dh / sh;\n\n\t\t\t\tvar output = new Canvas ({ hidden: true, antialias: false }).resize (dw, dh);\n\n\t\t\t\tvar temp = new Canvas ({ hidden: true, antialias: false }).resize (sw, sh);\n\t\t\t\ttemp.drawImage (image.data, 0, 0);\n\n\t\t\t\tfor (var j = 0; j < sh; j++)\n\t\t\t\t{\n\t\t\t\t\tvar s = temp.getImageData(0, j, sw, 1).data;\n\t\t\t\t\tvar sp = 0;\n\n\t\t\t\t\tfor (var i = 0; i < sw && sp < s.length; i++, sp += 4)\n\t\t\t\t\t{\n\t\t\t\t\t\toutput.fillStyle(\"rgba(\"+s[sp]+\",\"+s[sp+1]+\",\"+s[sp+2]+\",\"+(s[sp+3] / 255)+\")\");\n\t\t\t\t\t\toutput.fillRect(i*rep_x, j*rep_y, rep_x, rep_y);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttemp.dispose();\n\n\t\t\t\treturn output.elem;\n\t\t\t}\n\n\t\t\treturn this.resizeImage (image, dw, dh, null, discardOriginal);\n\t\t}\n\t},\n\n\t/**\n\t**\tFlips an image horizontally.\n\t*/\n\tflipImageHorz: function (image)\n\t{\n\t\tvar temp = new Canvas ({ hidden: true }).resize (image.data.width, image.data.height);\n\n\t\ttemp.translate(image.data.width, 0);\n\t\ttemp.scale(-1, 1);\n\n\t\ttemp.drawImage (image.data, 0, 0);\n\n\t\treturn temp.elem;\n\t},\n\n\t/**\n\t**\tForces the browser to show a download dialog.\n\t*/\n\tshowDownload: function (filename, dataUrl)\n\t{\n\t\tvar link = document.createElement(\"a\");\n\t\tlink.href = dataUrl;\n\n\t\tlink.style.display = 'none';\n\t\tlink.download = filename;\n\t\tlink.target = \"_blank\";\n\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t},\n\n\t/**\n\t**\tForces the browser to show a file selection dialog.\n\t*/\n\tshowFilePicker: function (allowMultiple, accept, callback)\n\t{\n\t\tvar input = document.createElement(\"input\");\n\n\t\tinput.type = \"file\";\n\t\tinput.accept = accept;\n\t\tinput.style.display = 'none';\n\t\tinput.multiple = allowMultiple;\n\n\t\tdocument.body.appendChild(input);\n\n\t\tinput.onchange = function ()\n\t\t{\n\t\t\tcallback(input.files);\n\t\t};\n\n\t\tdocument.body.onfocus = function ()\n\t\t{\n\t\t\tdocument.body.onfocus = null;\n\t\t\tdocument.body.removeChild(input);\n\t\t};\n\n\t\tinput.click();\n\t},\n\n\t/**\n\t**\tLoads a URL using FileReader and returns as a dataURL.\n\t*/\n\tloadAsDataURL: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsDataURL(file);\n\t},\n\n\t/**\n\t**\tLoads a URL using FileReader and returns as text.\n\t*/\n\tloadAsText: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsText(file);\n\t},\n\n\t/**\n\t**\tLoads a URL using FileReader and returns as an array buffer.\n\t*/\n\tloadAsArrayBuffer: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsArrayBuffer(file);\n\t},\n\n\t/**\n\t**\tLoads an array of URLs using FileReader and returns them as data url.\n\t*/\n\tloadAllAsDataURL: function (fileList, callback)\n\t{\n\t\tvar result = [];\n\n\t\tif (!fileList || !fileList.length)\n\t\t{\n\t\t\tcallback(result);\n\t\t\treturn;\n\t\t}\n\n\t\tvar loadNext = function (i)\n\t\t{\n\t\t\tif (i == fileList.length)\n\t\t\t{\n\t\t\t\tcallback(result);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tResources.loadAsDataURL (fileList[i], function(url) {\n\t\t\t\tresult.push({ name: fileList[i].name, size: fileList[i].size, url: url });\n\t\t\t\tloadNext(i+1);\n\t\t\t});\n\t\t};\n\n\t\tloadNext(0);\n\t}\n});\n","/*\n**\tresources/drawable\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport IDrawable from '../system/idrawable.js';\nimport Resources from './resources.js';\n\nexport default IDrawable.extend\n({\n\tclassName: \"Drawable\",\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"image\")\n\t\t\tthrow new Error (\"Resource is not an image.\");\n\n\t\tthis._super.IDrawable.__ctor(r.width, r.height);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\t},\n\n\tdraw: function (g, x=0, y=0, width=null, height=null)\n\t{\n\t\tif (width == null)\n\t\t\tg.drawImageResource (this.r, x, y);\n\t\telse\n\t\t\tg.drawImageResource (this.r, x, y, width, height);\n\t}\n});\n\n/**\n**\tCreates a descriptor for an image resource.\n*/\nResources.Image = function (src, opts=null)\n{\n\treturn { type: \"image\", wrapper: \"Drawable\", src: src, pixelated: null, ...opts };\n};\n","/*\n**\tresources/placeholder.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport IDrawable from '../system/idrawable.js';\nimport Canvas from '../system/canvas.js';\nimport Resources from './resources.js';\n\nexport default IDrawable.extend\n({\n\tclassName: \"Placeholder\",\n\n\twidth: null,\n\theight: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"object\")\n\t\t\tthrow new Error (\"Resource is not an object.\");\n\n\t\tthis._super.IDrawable.__ctor(r.width, r.height);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tthis.data = null;\n\n\t\tCanvas.renderImage(r.width, r.height,\n\t\t(g) => {\n\t\t\tg.fillStyle(this.r.color);\n\t\t\tg.fillRect(0, 0, r.width, r.height);\n\t\t},\n\t\t(img) => {\n\t\t\tthis.data = img;\n\t\t});\n\t},\n\n\tdraw: function (g, x=0, y=0, width=null, height=null)\n\t{\n\t\tif (!this.data)\n\t\t\treturn;\n\n\t\tg.drawImageResource (this, x, y, width, height);\n\t}\n});\n\n/**\n**\tCreates a descriptor for a placeholder.\n*/\nResources.Placeholder = function (width, height, color='#ff0000', opts=null)\n{\n\treturn { type: \"object\", wrapper: \"Placeholder\", width: width, height: height, color: color, ...opts };\n};\n","/*\n**\tresources/spritesheet.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Canvas from '../system/canvas.js';\n\n/*\n\tIf source is \"image\":\n\t\tconfig: {\n\t\t\tsheetWidth: int, frameWidth: int, frameHeight: int?, numFrames: int?\n\t\t\t--OR--\n\t\t\tnumFrames: int, frameWidth: int, frameHeight: int?\n\t\t}\n\n\tIf source is \"images\":\n\t\tconfig: {\n\t\t\tframeWidth: int, frameHeight: int\n\t\t}\n\t\t\n\tNOTE: The sheetWidth, frameWidth and frameHeight should reflect the real image size. The system will automatically scale it if the source image is smaller/bigger.\n*/\n\nexport default Class.extend\n({\n\tclassName: \"Spritesheet\",\n\n\twidth: 0, height: 0,\n\n\tnumCols: 0, numFrames: 0,\n\n\tdrawableCache: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif ((r.type != \"image\" && r.type != \"images\"))\n\t\t\tthrow new Error (\"Resource is not a sprite sheet.\");\n\n\t\tvar r_scale, v_scale;\n\n\t\tif (r.type == \"image\")\n\t\t{\n\t\t\tif (!r.config.sheetWidth && (!r.config.numFrames || !r.config.frameWidth))\n\t\t\t\tthrow new Error (\"Required sheetWidth or numFrames+frameWidth\");\n\n\t\t\tif (!r.config.sheetWidth)\n\t\t\t\tr.config.sheetWidth = r.config.numFrames * r.config.frameWidth;\n\n\t\t\tif (!r.config.frameHeight)\n\t\t\t\tr.config.frameHeight = r.data.height;\n\n\t\t\tr_scale = r.data.width / r.config.sheetWidth;\n\t\t\tv_scale = r.width / r.config.sheetWidth;\n\t\t}\n\t\telse // r.type == \"images\"\n\t\t{\n\t\t\tif (!r.config) r.config = { };\n\n\t\t\tif (!r.config.frameWidth)\n\t\t\t\tr.config.frameWidth = r.data[0].width;\n\n\t\t\tif (!r.config.frameHeight)\n\t\t\t\tr.config.frameHeight = r.data[0].height;\n\n\t\t\tr_scale = r.data[0].data.width / r.config.frameWidth;\n\t\t\tv_scale = r.data[0].width / r.config.frameWidth;\n\t\t}\n\n\t\tvar _width = r.config.frameWidth;\n\t\tvar _height = r.config.frameHeight;\n\n\t\tthis.r_frameWidth = (_width * r_scale);\n\t\tthis.r_frameHeight = (_height * r_scale);\n\n\t\tthis.width = (_width * v_scale);\n\t\tthis.height = (_height * v_scale);\n\n\t\tif (r.type == \"image\")\n\t\t{\n\t\t\tthis.numCols = ~~(r.data.width / this.r_frameWidth);\n\t\t\tthis.numRows = Math.ceil(r.data.height / this.r_frameHeight);\n\n\t\t\tthis.numFrames = r.config.numFrames || (this.numCols * this.numRows);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.numCols = this.numRows = 0;\n\t\t\tthis.numFrames = r.data.length;\n\t\t}\n\n\t\tthis.drawableCache = { };\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\t},\n\n\tdrawFrame: function (g, x, y, frame, width=0, height=0)\n\t{\n\t\tif (frame < 0 || frame >= this.numFrames)\n\t\t\treturn;\n\n\t\tif (!width) width = this.width;\n\t\tif (!height) height = this.height;\n\n\t\tif (this.numCols != 0)\n\t\t{\n\t\t\tvar j = ~~(frame / this.numCols) * this.r_frameHeight;\n\t\t\tvar i =  (frame % this.numCols) * this.r_frameWidth;\n\n\t\t\tg.drawImage (this.r.data, i, j, this.r_frameWidth, this.r_frameHeight, x, y, width, height);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tg.drawImage (this.r.data[frame].data, 0, 0, this.r_frameWidth, this.r_frameHeight, x, y, width, height);\n\t\t}\n\t},\n\n\tgetDrawable: function (frameIndex)\n\t// OR getDrawable: function (x, y)\n\t{\n\t\tif (arguments.length == 2)\n\t\t\tframeIndex = arguments[1]*this.numCols + arguments[0];\n\n\t\tif (!this.drawableCache[frameIndex])\n\t\t{\n\t\t\tthis.drawableCache[frameIndex] =\n\t\t\t{\n\t\t\t\twidth: this.width,\n\t\t\t\theight: this.height,\n\n\t\t\t\tframeIndex: frameIndex,\n\t\t\t\tr: this,\n\n\t\t\t\tdraw: function (g, x=0, y=0, width=0, height=0)\n\t\t\t\t{\n\t\t\t\t\tg.drawFrame (this.r, x, y, this.frameIndex, width, height);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\treturn this.drawableCache[frameIndex];\n\t}\n});\n\nCanvas.prototype.drawFrame = function (r, x, y, frameIndex, width, height)\n{\n\tr.drawFrame (this, x, y, frameIndex, width, height);\n};\n","/*\n**\tresources/spritesheet-animation.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Spritesheet from './spritesheet.js';\nimport System from '../system/system.js';\n\n/*\n\tanim: {\n\t\tdef: string, fps: int?,\n\n\t\tseq: {\n\t\t\tseq1: { loop: bool?, group: [ [int, int, ...], ... ] },\n\t\t\tseq2: { loop: bool?, group: [ [int, int, ...], ... ] },\n\t\t\tseq2: { loop: bool?, group: \"0,12\" },\n\t\t\tseq2: { loop: bool?, group: \"4 1 1 2 3\" },\n\t\t},\n\n\t\ttrans: {\n\t\t\tseq1: {\n\t\t\t\tseq2: [ seq_name, seq_name, ... ]\n\t\t\t}\n\t\t}\n\t}\n\n\tNOTE: When specifying a group such as \"0,12\" it means to draw tiles 0 and the 12 in that single frame.\n*/\n\nexport const Animation = Class.extend\n({\n\tseq: null, seq_i: 0,\n\ttrans: null, trans_i: 0, trans_t: null,\n\n\tqueue: null,\n\n\tfps: 0, frameMillis: 0, time: 0,\n\n\tframeNumber: -1,\n\n\tfinished: false,\n\tpaused: false,\n\n\twidth: null,\n\theight: null,\n\n\tfinishedCallback: null,\n\tfinishedCallbackChain: null,\n\n\tframeCallback: null,\n\n\t__ctor: function (anim, seq, fps)\n\t{\n\t\tthis.anim = anim;\n\t\tthis.queue = [ ];\n\n\t\tthis.seq = seq;\n\t\tthis.trans = null;\n\n\t\tthis.width = anim.width;\n\t\tthis.height = anim.height;\n\n\t\tthis.fps = fps;\n\n\t\tthis.setFps (this.seq.fps || this.fps);\n\t},\n\n\t__dtor: function ()\n\t{\n\t},\n\n\tsetFps: function (fps)\n\t{\n\t\tthis.frameMillis = ~~(1000 / fps);\n\t\tthis.time = 0;\n\n\t\treturn this;\n\t},\n\n\tsetPaused: function (value)\n\t{\n\t\tthis.paused = value;\n\t\treturn this;\n\t},\n\n\tsetInitialDelay: function (dt)\n\t{\n\t\tthis.time = -dt*1000.0;\n\t\treturn this;\n\t},\n\n\tonFinished: function (callback)\n\t{\n\t\tthis.finishedCallback = callback;\n\t\treturn this;\n\t},\n\n\tthen: function (callback)\n\t{\n\t\tif (this.finishedCallback !== this.thenCallback)\n\t\t{\n\t\t\tthis.finishedCallback = this.thenCallback;\n\t\t\tthis.finishedCallbackChain = [];\n\t\t}\n\n\t\tthis.finishedCallbackChain.push(callback);\n\t\treturn this;\n\t},\n\n\tthenCallback: function ()\n\t{\n\t\tif (!this.finishedCallbackChain.length)\n\t\t\treturn false;\n\n\t\tlet callback = this.finishedCallbackChain.shift();\n\t\tcallback.call(this);\n\t},\n\n\tonFrame: function (fn)\n\t{\n\t\tthis.frameCallback = fn;\n\t\treturn this;\n\t},\n\n\tsetFrame: function (i)\n\t{\n\t\tthis.seq_i = i % this.seq.group.length;\n\t\treturn this;\n\t},\n\n\tgetFrame: function (normalized)\n\t{\n\t\treturn normalized === true ? (this.seq_i / (this.seq.group.length-1)) : this.seq_i;\n\t},\n\n\tgetLength: function ()\n\t{\n\t\treturn this.seq.group.length;\n\t},\n\n\tdraw: function (g, x=0, y=0)\n\t{\n\t\tif (this.time < 0)\n\t\t{\n\t\t\tif (!this.paused)\n\t\t\t{\n\t\t\t\tthis.time += this.frameNumber == System.frameNumber ? 0 : System.frameDeltaMillis;\n\t\t\t\tthis.frameNumber = System.frameNumber;\n\t\t\t}\n\n\t\t\tif (this.time > 0) this.time = 0;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.seq_i == this.seq.group.length)\n\t\t{\n\t\t\tvar t = this.seq.group[this.seq_i-1];\n\n\t\t\tif (g != null)\n\t\t\t{\n\t\t\t\tfor (var i = 0; i < t.length; i++)\n\t\t\t\t\tg.drawFrame (this.anim, x, y, t[i]);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tvar t = this.seq.group[this.seq_i];\n\n\t\tif (g != null)\n\t\t{\n\t\t\tfor (var i = 0; i < t.length; i++)\n\t\t\t\tg.drawFrame (this.anim, x, y, t[i]);\n\t\t}\n\n\t\tif (!this.paused)\n\t\t{\n\t\t\tthis.time += this.frameNumber == System.frameNumber ? 0 : System.frameDeltaMillis;\n\t\t\tthis.frameNumber = System.frameNumber;\n\t\t}\n\n\t\tif (this.time >= this.frameMillis)\n\t\t{\n\t\t\tconst frameIndex = this.seq_i;\n\n\t\t\tthis.time -= this.frameMillis;\n\t\t\tthis.seq_i++;\n\n\t\t\tif (this.seq_i == this.seq.group.length)\n\t\t\t{\n\t\t\t\tif (this.trans != null)\n\t\t\t\t{\n\t\t\t\t\tif (++this.trans_i == this.trans.length)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.trans = null;\n\t\t\t\t\t\tthis.seq = this.trans_t;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tthis.seq = this.trans[this.trans_i];\n\n\t\t\t\t\tthis.seq_i = 0;\n\t\t\t\t\tthis.time = 0;\n\n\t\t\t\t\tthis.finished = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (this.seq.loop)\n\t\t\t\t\t\tthis.seq_i = 0;\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.finished = true;\n\n\t\t\t\t\t\tif (this.finishedCallback)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.finishedCallback(this) === false)\n\t\t\t\t\t\t\t\tthis.finishedCallback = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.queue.length)\n\t\t\t\t\t\tthis.use(this.queue.shift(), true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.frameCallback)\n\t\t\t{\n\t\t\t\tif (this.frameCallback(frameIndex, this.seq.group.length-1, this) === false)\n\t\t\t\t\tthis.frameCallback = null;\n\t\t\t}\n\t\t}\n\t},\n\n\tadvance: function ()\n\t{\n\t\tthis.setPaused (false);\n\t\tthis.draw (null, 0, 0);\n\t},\n\n\tgetName: function ()\n\t{\n\t\treturn (this.trans == null ? this.seq : this.trans_t).name;\n\t},\n\n\tuse: function (seqName, force=false)\n\t{\n\t\tvar seq = this.trans == null ? this.seq : this.trans_t;\n\n\t\tif (seq.name == seqName && !this.finished && force !== true)\n\t\t\treturn this;\n\n\t\tif (seq.trans && seq.trans[seqName])\n\t\t{\n\t\t\tthis.trans_t = this.anim.a.seq[seqName];\n\n\t\t\tthis.trans = seq.trans[seqName];\n\t\t\tthis.trans_i = 0;\n\n\t\t\tthis.seq = this.trans[this.trans_i];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.seq = this.anim.a.seq[seqName];\n\t\t\tthis.setFps (this.seq.fps || this.fps);\n\t\t}\n\n\t\tthis.seq_i = 0;\n\t\tthis.time = 0;\n\n\t\tthis.finished = false;\n\t\treturn this;\n\t},\n\n\tsetQueue: function (list)\n\t{\n\t\tthis.queue = list;\n\t\tthis.use(this.queue.shift(), true);\n\t},\n\n\tenqueue: function (seqName, force=false)\n\t{\n\t\tlet seq = this.trans == null ? this.seq : this.trans_t;\n\n\t\tlet lastName = this.queue.length > 0 ? this.queue[this.queue.length-1] : seq.name;\n\n\t\tif (seq.name == seqName && seq.loop)\n\t\t\treturn this;\n\n\t\tif (lastName == seqName && !force)\n\t\t\treturn this;\n\n\t\tif (seq.loop || this.finished)\n\t\t{\n\t\t\tthis.use(seqName, true);\n\t\t\treturn this;\n\t\t}\n\n\t\tthis.queue.push(seqName);\n\t\treturn this;\n\t}\n});\n\n\nexport default Spritesheet.extend\n({\n\tclassName: \"SpritesheetAnimation\",\n\n\t__ctor: function (r)\n\t{\n\t\tif (!r.anim) throw new Error (\"Animation descriptors not found.\");\n\n\t\tthis._super.Spritesheet.__ctor (r);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tvar t = this.a = this.r.anim;\n\n\t\tif (t.initialized) return;\n\n\t\tif (!t.def) t.def = \"def\";\n\n\t\tif (!t.seq) t.seq = { };\n\n\t\tif (!t.seq[t.def] && (t.def == \"def\" || t.def == \"defloop\"))\n\t\t{\n\t\t\tvar p = { loop: (t.def == \"def\" ? false : true), group: [ ] };\n\n\t\t\tfor (var i = 0; i < this.numFrames; i++)\n\t\t\t{\n\t\t\t\tp.group.push([i]);\n\t\t\t}\n\n\t\t\tt.seq[t.def] = p;\n\t\t}\n\n\t\tif (!t.seq[t.def])\n\t\t\tthrow new Error (\"Undefined default sequence: \" + t.def);\n\n\t\tif (!t.fps) t.fps = 25;\n\n\t\tt.def = t.seq[t.def];\n\n\t\tvar frameIndex = 0;\n\n\t\tfor (var i in t.seq)\n\t\t{\n\t\t\tt.seq[i].name = i;\n\n\t\t\tif (!t.seq[i].loop)\n\t\t\t\tt.seq[i].loop = false;\n\n\t\t\tif (typeof(t.seq[i].group) == \"string\")\n\t\t\t{\n\t\t\t\tvar a, b, c;\n\n\t\t\t\tif (t.seq[i].group.indexOf(\" \") != -1)\n\t\t\t\t{\n\t\t\t\t\ta = t.seq[i].group.split(\" \");\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\tfor (var j in a)\n\t\t\t\t\t\tt.seq[i].group.push([int(a[j])]);\n\t\t\t\t}\n\t\t\t\telse if (t.seq[i].group.indexOf(\",\") != -1)\n\t\t\t\t{\n\t\t\t\t\tc = t.seq[i].group.split(\",\");\n\t\t\t\t\t\n\t\t\t\t\ta = int(c[0]);\n\t\t\t\t\tb = int(c[1]);\n\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\tfor (c = a; c <= b; c++)\n\t\t\t\t\t\tt.seq[i].group.push([c]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ta = int(t.seq[i].group);\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\twhile (a--) t.seq[i].group.push([frameIndex++]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (t.trans)\n\t\t{\n\t\t\tfor (var i in t.trans)\n\t\t\t{\n\t\t\t\tt.seq[i].trans = t.trans[i];\n\n\t\t\t\tfor (var j in t.trans[i])\n\t\t\t\t{\n\t\t\t\t\tfor (var k = 0; k < t.trans[i][j].length; k++)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar n = t.trans[i][j][k];\n\n\t\t\t\t\t\tif (!t.seq[n]) throw new Error (\"Undefined sequence: \" + n);\n\t\t\t\t\t\tt.trans[i][j][k] = t.seq[n];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tt.initialized = true;\n\t},\n\n\tgetDrawable: function (initialseq=null, fps=null)\n\t{\n\t\treturn new Animation (this, initialseq ? this.a.seq[initialseq] : this.a.def, fps || this.a.fps);\n\t},\n\n\tgetSequence: function (initialseq=null)\n\t{\n\t\treturn initialseq ? this.a.seq[initialseq] : this.a.def;\n\t}\n});\n","/*\n**\tresources/spritefont.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Canvas from '../system/canvas.js';\n\n/*\n\tfont: {\n\t\tsheetWidth: int, sheetHeight: int, charWidth: int, charHeight: int, charset: string, widths: [char, width, ...]\n\t}\n*/\n\nexport default Class.extend\n({\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"image\" || !r.font)\n\t\t\tthrow new Error (\"Resource is not a sprite font.\");\n\n\t\tvar r_scale = r.data.width / r.font.sheetWidth;\n\t\tvar v_scale = r.width / r.font.sheetWidth;\n\n\t\tthis.r_charWidth = (r.font.charWidth * r_scale);\n\t\tthis.r_charHeight = (r.font.charHeight * r_scale);\n\n\t\tthis.charWidth = (r.font.charWidth * v_scale);\n\t\tthis.charHeight = (r.font.charHeight * v_scale);\n\n\t\tvar cols = ~~(r.font.sheetWidth / r.font.charWidth);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tvar n = r.font.charset.length;\n\t\tvar k = 0;\n\t\tvar y = 0;\n\n\t\tthis.charTable = { };\n\n\t\tthis.charTable[\" \"] = { charWidth: this.charWidth >> 1, r_charWidth: this.r_charWidth };\n\n\t\twhile (k < n)\n\t\t{\n\t\t\tvar x = 0;\n\n\t\t\tfor (var i = 0; i < cols && k < n; i++)\n\t\t\t{\n\t\t\t\tvar c = r.font.charset[k++];\n\n\t\t\t\tthis.charTable[c] = { x: x, y: y, charWidth: this.charWidth, r_charWidth: this.r_charWidth };\n\n\t\t\t\tx += this.r_charWidth;\n\t\t\t}\n\n\t\t\ty += this.r_charHeight;\n\t\t}\n\n\t\tif (!r.font.widths) return;\n\n\t\tvar n = r.font.widths.length;\n\n\t\tfor (var i = 0; i < n; i += 2)\n\t\t{\n\t\t\tvar w1 = (r.font.widths[i] * v_scale);\n\t\t\tvar w2 = (r.font.widths[i] * r_scale);\n\n\t\t\tvar s = r.font.widths[i+1];\n\n\t\t\tfor (var j = 0; j < s.length; j++)\n\t\t\t{\n\t\t\t\tthis.charTable[s[j]].charWidth = w1;\n\t\t\t\tthis.charTable[s[j]].r_charWidth = w2;\n\t\t\t}\n\t\t}\n\t},\n\n\tdraw: function (g, x, y, text)\n\t{\n\t\tvar n = text.length;\n\n\t\tfor (var i = 0; i < n; i++)\n\t\t{\n\t\t\tif (text[i] == \" \")\n\t\t\t{\n\t\t\t\tx += this.charTable[text[i]].charWidth;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar c = this.charTable[text[i]];\n\t\t\tif (!c) continue;\n\n\t\t\tg.drawImage (this.r.data, c.x, c.y, c.r_charWidth, this.r_charHeight, x, y, c.charWidth, this.charHeight);\n\n\t\t\tx += c.charWidth;\n\t\t}\n\t},\n\n\tmeasureWidth: function (text)\n\t{\n\t\tvar n = text.length;\n\t\tvar x = 0;\n\n\t\tfor (var i = 0; i < n; i++)\n\t\t{\n\t\t\tvar c = this.charTable[text[i]];\n\t\t\tif (!c) continue;\n\n\t\t\tx += c.charWidth;\n\t\t}\n\n\t\treturn x;\n\t},\n\n\tmeasureHeight: function (text)\n\t{\n\t\treturn this.charHeight;\n\t}\n});\n\n\nCanvas.prototype.drawText = function (r, x, y, text)\n{\n\tr.draw (this, x, y, text.toString());\n};\n\nCanvas.prototype.drawTextAligned = function (r, x, y, w, h, ax, ay, text)\n{\n\ttext = text.toString();\n\n\tif (ax == 0) // Align-Center\n\t\tx = x + ((w - r.measureWidth(text)) >> 1);\n\telse if (ax < 0) // Align-Left\n\t\tx = x - ax - 1;\n\telse if (ax > 0) // Align-Right\n\t\tx = x + w - ax + 1 - r.measureWidth(text);\n\n\tif (ay == 0) // Align-Center\n\t\ty = y + ((h - r.measureHeight(text)) >> 1);\n\telse if (ay < 0) // Align-Top\n\t\ty = y - ay - 1;\n\telse if (ay > 0) // Align-Bottom\n\t\ty = y + h - ay + 1 - r.measureHeight(text);\n\n\tr.draw (this, x, y, text);\n};\n\nCanvas.prototype.drawTextAligned2 = function (r, bounds, ax, ay, text)\n{\n\tthis.drawTextAligned (r, bounds.x1, bounds.y1, bounds.width(), bounds.height(), ax, ay, text);\n};\n","/*\n**\tresources/sound.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Resources from './resources.js';\n\n/*\n\ttrack: string (music|sfx)\n*/\n\nconst Sound = Class.extend\n({\n\tr: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"audio\")\n\t\t\tthrow new Error (\"Resource is not audio.\");\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tthis.track = Sound[this.r.track.toUpperCase()];\n\t},\n\n\tplay: function (callback, volume)\n\t{\n\t\treturn Sound.play (this, callback, volume);\n\t},\n\n\tplayLoop: function (callback, volume)\n\t{\n\t\treturn Sound.playLoop (this, callback, volume);\n\t}\n});\n\nSound.ENGINE_HTML5 = 1;\nSound.ENGINE_WEBAUDIO = 2;\nSound.ENGINE_NATIVEAUDIO = 3;\n\nObject.assign(Sound,\n{\n\tMASTER: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tSFX: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tMUSIC: {\n\t\tenabled: true,\n\t\tvolume: 0.8\n\t},\n\n\tVOICE: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tMAX_POOL_SIZE: 100,\n\n\tpool: [ ],\n\tactive: [ ],\n\n\tregister: function (node)\n\t{\n\t\tif (node.registered) return;\n\n\t\tnode.registered = true;\n\t\tthis.active.push(node);\n\t},\n\n\tunregister: function (node)\n\t{\n\t\tif (!node.registered) return;\n\n\t\tnode.registered = false;\n\n\t\tvar i = Sound.active.indexOf(node);\n\t\tif (i == -1) return;\n\n\t\tSound.active.splice(i, 1);\n\t},\n\n\tupdateNode: function (node, cmd)\n\t{\n\t\tswitch (node.snd.r.engine)\n\t\t{\n\t\t\tcase Sound.ENGINE_WEBAUDIO:\n\t\t\t\treturn this.updateNode_webaudio(node, cmd);\n\n\t\t\tcase Sound.ENGINE_NATIVEAUDIO:\n\t\t\t\treturn this.updateNode_nativeaudio(node, cmd);\n\t\t}\n\n\t\treturn this.updateNode_audio(node, cmd);\n\t},\n\n\t// Web Audio.\n\talloc_webaudio: function (node)\n\t{\n\t\tnode.gainNode = audioContext.createGain();\n\t\tnode.gainNode.gain.value = 0;\n\t\tnode.gainNode.connect(audioContext.destination);\n\n\t\tnode.res = audioContext.createBufferSource();\n\t\tnode.res.buffer = node.snd.r.data;\n\t\tnode.res.loop = false;\n\t\tnode.res.connect(node.gainNode);\n\t\tnode.res.node = node;\n\t},\n\n\tfree_webaudio: function (node)\n\t{\n\t\tif (!node.res) return;\n\n\t\tnode.gainNode.disconnect();\n\n\t\tnode.res = null;\n\t\tnode.gainNode = null;\n\t},\n\n\t// Native Audio (Cordova plugin).\n\talloc_nativeaudio: function (node)\n\t{\n\t\tnode.res = true;\n\t},\n\n\tfree_nativeaudio: function (node)\n\t{\n\t\tnode.res = false;\n\t},\n\n\t// HTML5 Audio.\n\talloc_audio: function (node)\n\t{\n\t\tif (!this.pool.length)\n\t\t\titem = node.cloneNode();\n\t\telse\n\t\t\titem = this.pool.pop();\n\n\t\titem._src = node.src;\n\t\treturn item;\n\t},\n\n\tfree_audio: function (node)\n\t{\n\t\tif (this.pool.length == this.MAX_POOL_SIZE)\n\t\t\treturn;\n\n\t\t//BUG: This causes a GET request of \"/null\" on Chromium.\n\t\t//node.src = null;\n\n\t\tthis.pool.push(node);\n\t},\n\n\t/* *********************** */\n\tupdateNode_webaudio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tvar volume = Sound.MASTER.volume * node.snd.track.volume * node.volume;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t\tSound.alloc_webaudio(node);\n\n\t\t\t\tnode.playTime = hrnow();\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.onended = Sound.onended_webaudio;\n\t\t\t\tnode.gainNode.gain.value = volume;\n\n\t\t\t\ttry {\n\t\t\t\t\tnode.res.start(0, node.startTime/1000.0);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_webaudio(node);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.gainNode.gain.value = volume;\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\n\t\t\t\t\tSound.free_webaudio(node);\n\t\n\t\t\t\t\tif (node.callback) node.callback();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\t\t\t\tnode.res.onended = null;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tnode.res.stop();\n\n\t\t\t\tSound.free_webaudio(node);\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime += hrnow() - node.playTime;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = true;\n\t\t\t\tnode.res.onended = null;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tnode.res.stop();\n\n\t\t\t\tSound.free_webaudio(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.loop = false;\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_webaudio: function (e)\n\t{\n\t\tvar node = e.currentTarget.node;\n\n\t\tif (node.playing && node.loop != 0)\n\t\t{\n\t\t\tSound.free_webaudio(node);\n\n\t\t\tif (node.loop != -1)\n\t\t\t\tnode.loop--;\n\n\t\t\tnode.startTime = 0;\n\t\t\tnode.playing = false;\n\t\t\tnode.pause = false;\n\n\t\t\tSound.updateNode_webaudio (node, 'play');\n\t\t\treturn;\n\t\t}\n\n\t\tnode.res.onended = null;\n\t\tnode.res.volume = 0;\n\n\t\tSound.updateNode_webaudio (node, 'stop');\n\t},\n\n\t/* *********************** */\n\tupdateNode_nativeaudio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t\tSound.alloc_nativeaudio(node);\n\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\ttry {\n\t\t\t\t\tglobal.plugins.NativeAudio.play (node.snd.r.data, null, null, function() { Sound.onended_nativeaudio(node); } );\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_nativeaudio(node);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tglobal.plugins.NativeAudio.stop (node.snd.r.data, null);\n\n\t\t\t\tSound.free_nativeaudio(node);\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_nativeaudio: function (node)\n\t{\n\t\tSound.updateNode_nativeaudio (node, 'stop');\n\t},\n\n\tupdateNode_audio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tvar volume = Sound.MASTER.volume * node.snd.track.volume * node.volume;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t{\n\t\t\t\t\tnode.res = Sound.alloc_audio (node.snd.r.data);\n\t\t\t\t\tnode.res.node = node;\n\t\t\t\t\tnode.res.src = node.res._src;\n\t\t\t\t}\n\n\t\t\t\tnode.playTime = hrnow();\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.onended = Sound.onended_audio;\n\t\t\t\tnode.res.currentTime = node.startTime/1000.0;\n\t\t\t\tnode.res.volume = volume;\n\n\t\t\t\ttry {\n\t\t\t\t\tnode.res.play();\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_audio (node.res);\n\t\t\t\t\tnode.res = null;\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.res.volume = volume;\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\n\t\t\t\t\tSound.free_audio (node.res);\n\t\t\t\t\tnode.res = null;\n\t\n\t\t\t\t\tif (node.callback) node.callback();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tSound.unregister (node);\n\t\t\t\tnode.res.pause();\n\n\t\t\t\tSound.free_audio (node.res);\n\t\t\t\tnode.res = null;\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime += hrnow() - node.playTime;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = true;\n\n\t\t\t\tSound.unregister (node);\n\t\t\t\tnode.res.pause();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_audio: function (e)\n\t{\n\t\tvar node = e.currentTarget.node;\n\n\t\tif (node.playing && node.loop != 0)\n\t\t{\n\t\t\tif (node.loop != -1)\n\t\t\t\tnode.loop--;\n\n\t\t\tnode.startTime = 0;\n\t\t\tnode.playing = false;\n\t\t\tnode.pause = false;\n\n\t\t\tSound.updateNode_audio (node, 'play');\n\t\t\treturn;\n\t\t}\n\n\t\tnode.res.onended = null;\n\t\tnode.res.volume = 0;\n\n\t\tSound.updateNode_audio (node, 'stop');\n\t},\n\n\t/* *************************************** */\n\t/* PUBLIC */\n\n\tenableTrack: function (track)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.enabled = true;\n\t},\n\n\tdisableTrack: function (track)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.enabled = false;\n\t},\n\n\tsetVolume: function (track, value)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.volume = value;\n\t},\n\n\tcreateNode: function (snd, volume)\n\t{\n\t\tvar node = { };\n\n\t\tnode.startVolume = volume;\n\t\tnode.volume = volume;\n\t\tnode.snd = snd;\n\t\tnode.loop = 0;\n\t\tnode.playing = false;\n\t\tnode.paused = false;\n\t\tnode.startTime = 0;\n\t\tnode.playTime = 0;\n\t\tnode.callback = null;\n\t\tnode.timer = null;\n\t\tnode.res = null;\n\n\t\treturn node;\n\t},\n\n\tplay: function (snd, completeCallback, volume)\n\t{\n\t\tif (!this.MASTER.enabled || !snd || !snd.track.enabled)\n\t\t\treturn null;\n\n\t\tvar volume = (volume !== undefined && volume !== null) ? volume : 1.0;\n\n\t\tvar node = this.createNode(snd, volume);\n\t\tnode.callback = completeCallback;\n\n\t\treturn this.updateNode(node, 'play');\n\t},\n\n\tplayLoop: function (snd, completeCallback, volume)\n\t{\n\t\tif (!this.MASTER.enabled || !snd || !snd.track.enabled)\n\t\t\treturn null;\n\n\t\tvolume = (volume !== undefined && volume !== null) ? volume : 1.0;\n\t\n\t\tvar node = this.createNode(snd, volume);\n\t\tnode.callback = completeCallback;\n\t\tnode.loop = -1;\n\n\t\treturn this.updateNode(node, 'play');\n\t},\n\n\tstop: function (node, callback)\n\t{\n\t\tif (!node) return null;\n\n\t\tif (callback && callback !== true) node.callback = callback;\n\t\treturn this.updateNode(node, callback === true ? 'stop' : 'softstop');\n\t},\n\n\tpause: function (node)\n\t{\n\t\tif (!node) return null;\n\n\t\treturn this.updateNode(node, 'pause');\n\t},\n\n\tresume: function (node)\n\t{\n\t\tif (!node) return null;\n\n\t\treturn this.updateNode (node, 'play');\n\t},\n\n\tfadeOut: function (node, millis, callback)\n\t{\n\t\tif (!node) return;\n\n\t\tif (!node.playing || node.timer)\n\t\t{\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar startTime = hrnow();\n\t\tnode.startVolume = node.volume;\n\n\t\tnode.timer = setInterval (function()\n\t\t{\n\t\t\tvar t = ((hrnow() - startTime) / millis);\n\t\t\tif (t > 1) t = 1;\n\n\t\t\tnode.volume = node.startVolume*(1-t);\n\t\t\tSound.updateNode(node, 'setvolume');\n\n\t\t\tif (t == 1)\n\t\t\t{\n\t\t\t\tclearInterval (node.timer);\n\t\t\t\tnode.timer = null;\n\n\t\t\t\tif (callback === true)\n\t\t\t\t\tSound.updateNode(node, 'stop');\n\t\t\t\telse\n\t\t\t\t\tSound.updateNode(node, 'pause');\n\n\t\t\t\tif (callback && callback !== true)\n\t\t\t\t\tcallback();\n\t\t\t}\n\t\t},\n\t\t50);\n\t},\n\n\tfadeIn: function (node, millis, callback)\n\t{\n\t\tif (!node) return;\n\n\t\tif (node.playing || node.timer)\n\t\t{\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar startTime = hrnow();\n\n\t\tnode.volume = 0;\n\t\tthis.updateNode(node, 'play');\n\n\t\tnode.timer = setInterval (function()\n\t\t{\n\t\t\tvar t = ((hrnow() - startTime) / millis);\n\t\t\tif (t > 1) t = 1;\n\n\t\t\tnode.volume = node.startVolume*t;\n\t\t\tSound.updateNode(node, 'setvolume');\n\n\t\t\tif (t == 1)\n\t\t\t{\n\t\t\t\tclearInterval (node.timer);\n\t\t\t\tnode.timer = null;\n\n\t\t\t\tif (callback) callback();\n\t\t\t}\n\t\t},\n\t\t50);\n\t}\n});\n\n/**\n**\tCreates a descriptor for an audio resource.\n*/\nResources.Audio = function (src, opts=null)\n{\n\treturn { type: \"audio\", wrapper: \"Sound\", src: src, ...opts };\n};\n\nexport default Sound;\n","/*\n**\tresources/sound-array.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Sound from './sound.js';\n\n/*\n\ttrack: string (music|sfx)\n\tmode: sequential|random\n*/\n\nexport default Class.extend\n({\n\tr: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"audios\")\n\t\t\tthrow new Error (\"Resource is not audios.\");\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tif (!this.r.track)\n\t\t\tthis.r.track = \"sfx\";\n\n\t\tif (!this.r.mode)\n\t\t\tthis.r.mode = \"random\";\n\n\t\tthis.track = Sound[this.r.track.toUpperCase()];\n\n\t\tthis.sounds = [];\n\t\tthis.lastIndex = -1;\n\n\t\tfor (var i = 0; i < this.r.data.length; i++)\n\t\t{\n\t\t\tthis.sounds.push(new Sound (Object.assign (this.r.data[i], { track: this.r.track })));\n\t\t}\n\t},\n\n\tgetRandomSound: function ()\n\t{\n\t\tif (this.r.mode == \"random\")\n\t\t\treturn this.sounds[randr(0, this.sounds.length-1)];\n\n\t\tthis.lastIndex = ++this.lastIndex % this.sounds.length;\n\t\treturn this.sounds[this.lastIndex];\n\t},\n\n\tplay: function (callback, volume)\n\t{\n\t\treturn Sound.play (this.getRandomSound(), callback, volume);\n\t},\n\n\tplayLoop: function (callback, volume)\n\t{\n\t\treturn Sound.playLoop (this.getRandomSound(), callback, volume);\n\t},\n\n\tplayAt: function (index, callback, volume)\n\t{\n\t\treturn Sound.play (this.sounds[index % this.sounds.length], callback, volume);\n\t},\n\n\tplayLoopAt: function (index, callback, volume)\n\t{\n\t\treturn Sound.playLoop (this.sounds[index % this.sounds.length], callback, volume);\n\t}\n});\n","/*\n**\tresources/wrappers.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport _Drawable from './drawable.js'; export const Drawable = _Drawable;\nimport _Placeholder from './placeholder.js'; export const Placeholder = _Placeholder;\nimport _Spritesheet from './spritesheet.js'; export const Spritesheet = _Spritesheet;\nimport _SpritesheetAnimation from './spritesheet-animation.js'; export const SpritesheetAnimation = _SpritesheetAnimation;\nimport _SpriteFont from './spritefont.js'; export const SpriteFont = _SpriteFont;\nimport _Sound from './sound.js'; export const Sound = _Sound;\nimport _SoundArray from './sound-array.js'; export const SoundArray = _SoundArray;\n","/*\n**\tutils/priority-queue.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\n\nexport default Class.extend\n({\n\tclassName: 'PriorityQueue',\n\n\tqueue: null,\n\torder: null,\n\n\t__ctor: function()\n\t{\n\t\tthis.queue = { };\n\t},\n\n\tadd: function (object)\n\t{\n\t\tif (object == null)\n\t\t\treturn null;\n\n\t\tif (!(\"priority\" in object))\n\t\t\tthrow new Error (\"PriorityQueue (add): Object has no `priority` property.\");\n\n\t\tif (!(object.priority in this.queue))\n\t\t{\n\t\t\tthis.queue[object.priority] = { is_dirty: false, list: [ ] };\n\t\t\tthis.order = Object.keys(this.queue).sort((a,b) => a-b);\n\t\t}\n\n\t\tif (this.queue[object.priority].list.indexOf(object) === -1)\n\t\t\tthis.queue[object.priority].list.push(object);\n\n\t\treturn object;\n\t},\n\n\tremove: function (object)\n\t{\n\t\tif (object == null)\n\t\t\treturn null;\n\n\t\tif (!(\"priority\" in object))\n\t\t\tthrow new Error (\"PriorityQueue (remove): Object has no `priority` property.\");\n\n\t\tif (!(object.priority in this.queue))\n\t\t\treturn object;\n\n\t\tvar i = this.queue[object.priority].list.indexOf(object);\n\t\tif (i === -1) return object;\n\n\t\tthis.queue[object.priority].is_dirty = true;\n\t\tthis.queue[object.priority].list[i] = null;\n\n\t\treturn object;\n\t},\n\n\tcleanup: function()\n\t{\n\t\tfor (var i in this.queue)\n\t\t{\n\t\t\tvar q = this.queue[i];\n\n\t\t\tif (q.is_dirty == false)\n\t\t\t\tcontinue;\n\n\t\t\tfor (var j = 0; j < q.list.length; j++)\n\t\t\t{\n\t\t\t\tif (q.list[j] == null)\n\t\t\t\t\tq.list[j--].splice(1, 0);\n\t\t\t}\n\n\t\t\tq.is_dirty = false;\n\t\t}\n\t},\n\n\tforEach: function (callback)\n\t{\n\t\tvar is_dirty = false;\n\t\tvar is_complete = false;\n\n\t\tfor (var i = 0; !is_complete && i < this.order.length; i++)\n\t\t{\n\t\t\tvar list = this.queue[this.order[i]].list;\n\n\t\t\tfor (var j = 0; !is_complete && j < list.length; j++)\n\t\t\t{\n\t\t\t\tif (list[j] != null)\n\t\t\t\t{\n\t\t\t\t\tif (callback(list[j]) === false)\n\t\t\t\t\t\tis_complete = true;\n\t\t\t\t}\n\n\t\t\t\tif (list[j] == null)\n\t\t\t\t\tis_dirty = true;\n\t\t\t}\n\t\t}\n\n\t\tif (is_dirty) this.cleanup();\n\t},\n\n\tforEachRev: function (callback)\n\t{\n\t\tvar is_dirty = false;\n\t\tvar is_complete = false;\n\n\t\tfor (var i = this.order.length-1; !is_complete && i >= 0; i--)\n\t\t{\n\t\t\tvar list = this.queue[this.order[i]].list;\n\n\t\t\tfor (var j = list.length-1; !is_complete && j >= 0; j--)\n\t\t\t{\n\t\t\t\tif (list[j] != null)\n\t\t\t\t{\n\t\t\t\t\tif (callback(list[j]) === false)\n\t\t\t\t\t\tis_complete = true;\n\t\t\t\t}\n\n\t\t\t\tif (list[j] == null)\n\t\t\t\t\tis_dirty = true;\n\t\t\t}\n\t\t}\n\n\t\tif (is_dirty) this.cleanup();\n\t},\n\n\tforEachAsync: function (callback)\n\t{\n\t\tvar _ = this;\n\n\t\tvar is_dirty = false;\n\t\tvar is_complete = false;\n\n\t\tvar i = -1;\n\t\tvar j = -1;\n\n\t\tvar list = null;\n\n\t\tvar next_j = function()\n\t\t{\n\t\t\tj++;\n\n\t\t\tif (!is_complete && j < list.length)\n\t\t\t{\n\t\t\t\tif (list[j] != null)\n\t\t\t\t{\n\t\t\t\t\tif (callback(list[j], next_j) === false)\n\t\t\t\t\t\tis_complete = true;\n\t\t\t\t}\n\n\t\t\t\tif (list[j] == null)\n\t\t\t\t\tis_dirty = true;\n\n\t\t\t\tif (is_complete) next_j();\n\t\t\t}\n\t\t\telse\n\t\t\t\tnext_i();\n\t\t};\n\n\t\tvar next_i = function()\n\t\t{\n\t\t\ti++;\n\n\t\t\tif (!is_complete && i < _.order.length)\n\t\t\t{\n\t\t\t\tlist = _.queue[_.order[i]].list;\n\t\t\t\tj = -1;\n\t\t\t\tnext_j();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (is_dirty) _.cleanup();\n\t\t\t}\n\t\t};\n\n\t\tnext_i();\n\t},\n\n\tforEachRevAsync: function (callback)\n\t{\n\t}\n});\n","/*\n**\tmath/rect.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Recycler from '../utils/recycler.js';\n\n/**\n**\tRepresents a 2D rectangle.\n*/\n\nconst Rect = function ()\n{\n};\n\nexport default Rect;\n\nRect.prototype.className = 'Rect';\n\n/**\n**\tCoordinates of the rectangle (cx and cy are for the center). Note that this fields are readonly they should be modified\n**\tthrough methods only.\n*/\nRect.prototype.cx = 0;\nRect.prototype.cy = 0;\nRect.prototype.x1 = 0;\nRect.prototype.y1 = 0;\nRect.prototype.x2 = 0;\nRect.prototype.y2 = 0;\n\n/**\n**\tInitializes the rect (takes 0, 2 or 4 parameters).\n*/\nRect.prototype.__reinit = function (...args)\n{\n\tswitch (args.length)\n\t{\n\t\tcase 0: this.Rect0.apply(this, args); break;\n\t\tcase 2: this.Rect2.apply(this, args); break;\n\t\tcase 4: this.Rect4.apply(this, args); break;\n\t}\n\n\treturn this;\n};\n\n/**\n**\tConstructs a rectangle object. All values are set to zero.\t \n*/\nRect.prototype.Rect0 = function ()\n{\n\tthis.x1 = this.y1 = this.x2 = this.y2 = this.cx = this.cy = 0;\n};\n\n/**\n**\tConstructs a rectangle object with the given coordinates.\t \n*/\nRect.prototype.Rect4 = function (x1, y1, x2, y2)\n{\n\tthis.set (x1, y1, x2, y2);\n};\n\n/**\n**\tConstructs a rectangle object with the given size (centers at zero).\t \n*/\nRect.prototype.Rect2 = function (w, h)\n{\n\tthis.set (0, 0, 0, 0);\n\tthis.resize (w, h);\n};\n\n/**\n**\tClones the rect and returns a new object.\t \n*/\nRect.prototype.clone = function ()\n{\n\treturn Rect.alloc (this.x1, this.y1, this.x2, this.y2);\n};\n\nRect.prototype.zero = function ()\n{\n\tthis.cx = 0; this.cy = 0;\n\tthis.x1 = 0; this.y1 = 0;\n\tthis.x2 = 0; this.y2 = 0;\n\n\treturn this;\n};\n\nRect.prototype.reset = function ()\n{\n\tthis.cx = null; this.cy = null;\n\tthis.x1 = null; this.y1 = null;\n\tthis.x2 = null; this.y2 = null;\n\n\treturn this;\n};\n\nRect.prototype.extendWithPoint2 = function (x, y)\n{\n\tif (this.x1 === null || x < this.x1) this.x1 = x;\n\tif (this.y1 === null || y < this.y1) this.y1 = y;\n\tif (this.x2 === null || x > this.x2) this.x2 = x;\n\tif (this.y2 === null || y > this.y2) this.y2 = y;\n\n\tthis.cx = (this.x1 + this.x2) / 2;\n\tthis.cy = (this.y1 + this.y2) / 2;\n\n\treturn this;\n};\n\nRect.prototype.extendWithPoint1 = function (p)\n{\n\treturn this.extendWithPoint2(p.x, p.y);\n};\n\nRect.prototype.extendWithPoint = function (...args)\n{\n\tif (args.length == 2)\n\t\treturn this.extendWithPoint2(args[0], args[1]);\n\telse\n\t\treturn this.extendWithPoint1(args[0]);\n};\n\n/**\n**\tTranslates the rectangle by the given deltas.\t \n*/\nRect.prototype.translate = function (dx, dy)\n{\n\tthis.x1 += dx; this.y1 += dy;\n\tthis.x2 += dx; this.y2 += dy;\n\tthis.cx += dx; this.cy += dy;\n\n\treturn this;\n};\n\n/**\n**\tMoves the center of the rectangle to the specified position.\t \n*/\nRect.prototype.centerAt = function (x, y, normalized=false)\n{\n\tif (normalized == true)\n\t{\n\t\tx = this.x1 + x*(this.x2 - this.x1);\n\t\ty = this.y1 + y*(this.y2 - this.y1);\n\t}\n\n\treturn this.translate (x - this.cx, y - this.cy);\n};\n\n/**\n**\tSets the coordinates of the rectangle.\t \n*/\nRect.prototype.set = function (...args)\n{\n\tswitch (args.length)\n\t{\n\t\tcase 1: return this.set1 (...args);\n\t\tcase 4: return this.set4 (...args);\n\t}\n};\n\n/**\n**\tSets the coordinates of the rectangle.\t \n*/\nRect.prototype.set4 = function (x1, y1, x2, y2)\n{\n\tthis.cx = (x1 + x2) / 2;\n\tthis.cy = (y1 + y2) / 2;\n\n\tthis.x1 = x1;\n\tthis.y1 = y1;\n\tthis.x2 = x2;\n\tthis.y2 = y2;\n\n\treturn this;\n};\n\n/**\n**\tCopies the coordinates of a given rectangle.\t \n*/\nRect.prototype.set1 = function (r)\n{\n\treturn this.set4 (r.x1, r.y1, r.x2, r.y2);\n};\n\n/**\n**\tReturns true if the specified rect is equal to the current rect.\n*/\nRect.prototype.equals = function (...args)\n{\n\tswitch (args.length)\n\t{\n\t\tcase 1: return this.equals1.apply(this, args);\n\t\tcase 4: return this.equals4.apply(this, args);\n\t}\n};\n\n/**\n**\tReturns true if the specified rect is equal to the current rect.\n*/\nRect.prototype.equals1 = function (r)\n{\n\treturn this.x1 == r.x1 && this.x2 == r.x2 && this.y1 == r.y1 && this.y2 == r.y2;\n};\n\n/**\n**\tReturns true if the specified rectangle is equal to the current rect.\n*/\nRect.prototype.equals4 = function (x1, y1, x2, y2)\n{\n\treturn x1 == this.x1 && x2 == this.x2 && y1 == this.y1 && y2 == this.y2;\n};\n\n/**\n**\tReturns a bool indicating if the specified rectangle object is contained by the current rectangle.\n*/\nRect.prototype.contains = function (...args)\n{\n\tswitch (args.length)\n\t{\n\t\tcase 1: return this.contains1.apply(this, args);\n\t\tcase 4: return this.contains4.apply(this, args);\n\t}\n};\n\n/**\n**\tReturns a bool indicating if the specified rectangle object is contained by the current rectangle.\n*/\nRect.prototype.contains1 = function (b)\n{\n\treturn b.equals(Math.max(this.x1, b.x1), Math.max(this.y1, b.y1), Math.min(this.x2, b.x2), Math.min(this.y2, b.y2));\n};\n\n/**\n**\tReturns a bool indicating if the rectangle defined by the specified coordinates is contained by the current rectangle.\n*/\nRect.prototype.contains4 = function (x1, y1, x2, y2)\n{\n\treturn (x1 == Math.max(this.x1, x1)) && (y1 == Math.max(this.y1, y1)) && (x2 == Math.min(this.x2, x2)) && (y2 == Math.min(this.y2, y2));\n};\n\n/**\n**\tReturns a bool indicating if the specified rectangle object is contained by the current rectangle.\n*/\nRect.prototype.setAsUnion = function (...args)\n{\n\tswitch (args.length)\n\t{\n\t\tcase 1: return this.setAsUnion1.apply(this, args);\n\t\tcase 4: return this.setAsUnion4.apply(this, args);\n\t}\n};\n\n/**\n**\tSets the rect to the union box formed by the current rect and the given one. The resulting bounding box will contain any\n**\tpoint from either rect.\n*/\nRect.prototype.setAsUnion1 = function (b)\n{\n\treturn this.setAsUnion4 (b.x1, b.y1, b.x2, b.y2);\n};\n\n/**\n**\tSets the rect to the union box formed by the current rect and the given one. The resulting bounding box will contain any\n**\tpoint from either rect.\n*/\nRect.prototype.setAsUnion4 = function (x1, y1, x2, y2)\n{\n\tthis.x1 = Math.min(this.x1, x1);\n\tthis.y1 = Math.min(this.y1, y1);\n\tthis.x2 = Math.max(this.x2, x2);\n\tthis.y2 = Math.max(this.y2, y2);\n\n\treturn this;\n};\n\n/**\n**\tReturns a bool indicating if the rectangles intersect or not.\n*/\nRect.prototype.intersects = function (...args)\n{\n\tswitch (args.length)\n\t{\n\t\tcase 1: return this.intersects1.apply(this, args);\n\t\tcase 4: return this.intersects4.apply(this, args);\n\t}\n};\n\n/**\n**\tReturns a bool indicating if the rectangles intersect or not.\n*/\nRect.prototype.intersects1 = function (b)\n{\n\treturn this.intersects4 (b.x1, b.y1, b.x2, b.y2);\n};\n\n/**\n**\tReturns a bool indicating if the rectangles intersect or not.\n*/\nRect.prototype.intersects4 = function (x1, y1, x2, y2)\n{\n\tvar _x1 = Math.max(this.x1, x1);\n\tvar _y1 = Math.max(this.y1, y1);\n\tvar _x2 = Math.min(this.x2, x2);\n\tvar _y2 = Math.min(this.y2, y2);\n\n\treturn Math.max(0, _y2-_y1) * Math.max(0, _x2-_x1) > 0;\n};\n\n/**\n**\tSets the rect to the intersection box formed by the current rect and the given one. The resulting bounding box contains any point\n**\tthat's contained simultaneously in both rects.\n*/\nRect.prototype.setAsIntersection = function (...args)\n{\n\tswitch (args.length)\n\t{\n\t\tcase 1: return this.setAsIntersection1.apply(this, args);\n\t\tcase 4: return this.setAsIntersection4.apply(this, args);\n\t}\n};\n\n/**\n**\tSets the rect to the intersection box formed by the current rect and the given one. The resulting bounding box contains any\n**\tpoint that's contained simultaneously in both rects.\n*/\nRect.prototype.setAsIntersection1 = function (b)\n{\n\treturn this.setAsIntersection4 (b.x1, b.y1, b.x2, b.y2);\n};\n\n/**\n**\tSets the rect to the intersection box formed by the current rect and the given one. The resulting bounding box contains any point\n**\tthat's contained simultaneously in both rects.\n*/\nRect.prototype.setAsIntersection4 = function (x1, y1, x2, y2)\n{\n\tthis.x1 = Math.max(this.x1, x1);\n\tthis.y1 = Math.max(this.y1, y1);\n\tthis.x2 = Math.min(this.x2, x2);\n\tthis.y2 = Math.min(this.y2, y2);\n\n\treturn Math.max(0, this.y2-this.y1) * Math.max(0, this.x2-this.x1) > 0;\n};\n\n/**\n**\tResizes the rect to the given size using center or top-left as reference.\t \n*/\nRect.prototype.resize = function (w, h, normalized=false, topLeftRelative=false)\n{\n\tif (normalized == true)\n\t{\n\t\tw *= (this.x2 - this.x1);\n\t\th *= (this.y2 - this.y1);\n\t}\n\n\tif (topLeftRelative == true)\n\t{\n\t\tthis.x2 = this.x1 + w;\n\t\tthis.y2 = this.y1 + h;\n\t}\n\telse\n\t{\n\t\tw /= 2; h /= 2;\n\n\t\tthis.x1 = this.cx - w; this.y1 = this.cy - h;\n\t\tthis.x2 = this.cx + w; this.y2 = this.cy + h;\n\t}\n\n\treturn this;\n};\n\n/**\n**\tResizes the rect using the specified deltas (relative to center or top-left).\n*/\nRect.prototype.resizeBy = function (dw, dh, topLeftRelative=false)\n{\n\tif (topLeftRelative == true)\n\t{\n\t\tthis.x2 += dw;\n\t\tthis.y2 += dh;\n\t}\n\telse\n\t{\n\t\tdw /= 2; dh /= 2;\n\n\t\tthis.x1 -= dw; this.y1 -= dh;\n\t\tthis.x2 += dw; this.y2 += dh;\n\t}\n\n\treturn this;\n};\n\n/**\n**\tReturns the width of the rectangle.\t \n*/\nRect.prototype.width = function ()\n{\n\treturn this.x2 - this.x1;\n};\n\n/**\n**\tReturns the height of the rectangle.\t \n*/\nRect.prototype.height = function ()\n{\n\treturn this.y2 - this.y1;\n};\n\n/**\n**\tReturns the normalized center-X of the rect.\n*/\nRect.prototype.ncx = function ()\n{\n\treturn (this.cx - this.x1) / (this.x2 - this.x1);\n};\n\n/**\n**\tReturns the normalized center-Y of the rect.\n*/\nRect.prototype.ncy = function ()\n{\n\treturn (this.cy - this.y1) / (this.y2 - this.y1);\n};\n\n/**\n**\tReturns true if the rect is a right rectangle (x1 < x2 and y1 < y2).\n*/\nRect.prototype.isRight = function ()\n{\n\treturn this.x1 <= this.x2 && this.y1 <= this.y2;\n};\n\n/**\n**\tReturns true if the specified point is within the rectangle. The tol parameter is used to specify a tolerance value in pixels.\n*/\nRect.prototype.containsPoint = function (x, y, tol=0)\n{\n\treturn (this.x1-tol <= x && x <= this.x2+tol) && (this.y1-tol <= y && y <= this.y2+tol);\n};\n\n/**\n**\tReturns the area of the rectangle. Strict mode specifies if area is returned only if the rectangle is a right rectangle. \t \n*/\nRect.prototype.area = function (strict)\n{\n\treturn strict ? (this.isRight() ? (this.y2-this.y1)*(this.x2-this.x1) : 0) : ((this.y2-this.y1)*(this.x2-this.x1));\n};\n\n/**\n**\tSets the components to their lower-integer parts.\n*/\nRect.prototype.floor = function()\n{\n\tthis.x1 = Math.floor(this.x1);\n\tthis.y1 = Math.floor(this.y1);\n\tthis.x2 = Math.floor(this.x2);\n\tthis.y2 = Math.floor(this.y2);\n\tthis.cx = Math.floor(this.cx);\n\tthis.cy = Math.floor(this.cy);\n\treturn this;\n};\n\n/**\n**\tSets the components to their upper-integer parts.\n*/\nRect.prototype.ceil = function()\n{\n\tthis.x1 = Math.ceil(this.x1);\n\tthis.y1 = Math.ceil(this.y1);\n\tthis.x2 = Math.ceil(this.x2);\n\tthis.y2 = Math.ceil(this.y2);\n\tthis.cx = Math.ceil(this.cx);\n\tthis.cy = Math.ceil(this.cy);\n\treturn this;\n};\n\n/**\n**\tReturns the string representation of the rect coordinates.\n*/\nRect.prototype.toString = function ()\n{\n\treturn \"(Rect: \" + this.x1.toFixed(2) + \", \" + this.y1.toFixed(2) + \", \" + this.x2.toFixed(2) + \", \" + this.y2.toFixed(2) + \")\";\n};\n\nRect.prototype.flatten = function ()\n{\n\treturn [this.x1, this.y1, this.x2, this.y2];\n};\n\nRect.prototype.unflatten = function (o)\n{\n\tthis.set (o[0], o[1], o[2], o[3]);\n\treturn this;\n};\n\n/* ********************************************************** */\nRecycler.attachTo (Rect);\n","/*\n**\tmath/vec2.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tRepresentation of a vector in 2D space, that is a tuple with two components x and y.\n*/\n\nconst Vec2 = function ()\n{\n\tswitch (arguments.length)\n\t{\n\t\tcase 0: return this.Vec2_0.apply(this, arguments);\n\t\tcase 1: return this.Vec2_1.apply(this, arguments);\n\t\tcase 2: return this.Vec2_2.apply(this, arguments);\n\t}\n};\n\nexport default Vec2;\n\n/**\n**\tCoordinate value of the X-axis. \t \n*/\nVec2.prototype.x = 0;\n\n/**\n**\tCoordinate value of the Y-axis.\n*/\nVec2.prototype.y = 0;\n\n/**\n**\tConstructs a vector object. Components are set to zero.\n*/\nVec2.prototype.Vec2_0 = function ()\n{\n\tthis.x = this.y = 0;\n};\n\n/**\n**\tConstructs a vector object with the given components.\n*/\nVec2.prototype.Vec2_2 = function (x, y)\n{\n\tthis.x = x; this.y = y;\n};\n\n/**\n**\tConstructs a vector object with the components from the specified vector.\n*/\nVec2.prototype.Vec2_1 = function (b)\n{\n\tthis.x = b.x; this.y = b.y;\n};\n\n/**\n**\tClones the vector and returns a new object.\n*/\nVec2.prototype.clone = function () /* Vec2 */\n{\n\treturn new Vec2 (this.x, this.y);\n};\n\n/**\n**\tSets the components of the vector. (vec2 or x,y)\n*/\nVec2.prototype.set = function (x, y) /* Vec2 */\n{\n\tif (arguments.length == 1)\n\t\tthis.x = x.x, this.y = x.y;\n\telse\n\t\tthis.x = x, this.y = y;\n\n\treturn this;\n};\n\n/**\n**\tSets the components of the vector to zero.\n*/\nVec2.prototype.zero = function ()\n{\n\treturn this.set (0, 0);\n};\n\n/**\n**\tReturns true if the vector is zero.\n*/\nVec2.prototype.isZero = function ()\n{\n\treturn this.x == 0 && this.y == 0;\n};\n\n/**\n**\tReturns true if the coordinates have the same components as the vector. (vec2 or x,y)\n*/\nVec2.prototype.equals = function (x, y)\n{\n\tif (arguments.length == 1)\n\t\treturn this.x == x.x && this.y == x.y;\n\telse\n\t\treturn this.x == x && this.y == y;\n};\n\n/**\n**\tNegates the vector, that is changing the sign of each component in the vector.\n*/\nVec2.prototype.neg = function ()\n{\n\tthis.x = -this.x; this.y = -this.y;\n\treturn this;\n};\n\n/**\n**\tInverts the vector by changing each component to its reciprocal.\n*/\nVec2.prototype.inv = function ()\n{\n\tthis.x = 1 / this.x; this.y = 1 / this.y;\n\treturn this;\n};\n\n/**\n**\tChanges the components of the vector to their absolute value.\n*/\nVec2.prototype.abs = function ()\n{\n\tthis.x = this.x < 0 ? -this.x : this.x;\n\tthis.y = this.y < 0 ? -this.y : this.y;\n\treturn this;\n};\n\n/**\n**\tAdds the given value to all components of the vector. (vec2 or x,y)\n*/\nVec2.prototype.translate = function (dx, dy)\n{\n\tif (arguments.length == 1)\n\t\tthis.x += dx.x, this.y += dx.y;\n\telse\n\t\tthis.x += dx, this.y += dy;\n\n\treturn this;\n};\n\n/**\n**\tAdds given values to the components of the vector. (vec2 or x,y)\n*/\nVec2.prototype.add = function (dx, dy)\n{\n\tif (arguments.length == 1)\n\t\tthis.x += dx.x, this.y += dx.y;\n\telse\n\t\tthis.x += dx, this.y += dy;\n\n\treturn this;\n};\n\n/**\n**\tSubtracts given values from the components of the vector. (vec2 or x,y)\n*/\nVec2.prototype.sub = function (dx, dy)\n{\n\tif (arguments.length == 1)\n\t\tthis.x -= dx.x, this.y -= dx.y;\n\telse\n\t\tthis.x -= dx, this.y -= dy;\n\n\treturn this;\n};\n\n/**\n**\tScales both components of the vector by the given factor (fx or fx, fy).\n*/\nVec2.prototype.scale = function (fx, fy)\n{\n\tif (arguments.length == 1)\n\t\tthis.x *= fx, this.y *= fx;\n\telse\n\t\tthis.x *= fx, this.y *= fy;\n\n\treturn this;\n};\n\n/**\n**\tSets the components to their integer parts.\n*/\nVec2.prototype.floor = function ()\n{\n\tthis.x = ~~this.x;\n\tthis.y = ~~this.y;\n\n\treturn this;\n};\n\n/**\n**\tSets the components to their fractional parts.\n*/\nVec2.prototype.fract = function ()\n{\n\tthis.x = this.x - ~~this.x;\n\tthis.y = this.y - ~~this.y;\n\n\treturn this;\n};\n\n/**\n**\tReturns the dot product of the vector and the provided values (x, y).\n*/\nVec2.prototype.dot = function (x, y)\n{\n\tif (arguments.length == 2)\n\t\treturn this.x*x + this.y*y;\n\telse\n\t\treturn this.x*x.x + this.y*x.y;\n};\n\n/**\n**\tReturns the magnitude of the vector.\n*/\nVec2.prototype.magnitude = function ()\n{\n\treturn Math.sqrt(this.x*this.x + this.y*this.y);\n};\n\n/**\n**\tNormalizes the vector. That is achieved by dividing each component of the Vector by its\n**\tmagnitude in order to obtain a unit vector.\n*/\nVec2.prototype.normalize = function ()\n{\n\treturn this.isZero() ? this : this.scale (1 / this.magnitude());\n};\n\n/**\n**\tSets the vector to its major-axis.\n*/\nVec2.prototype.majorAxis = function ()\n{\n\tif (Math.abs(this.x) > Math.abs(this.y)) this.y = 0; else this.x = 0;\n\treturn this;\n};\n\n/**\n**\tSets the vector to its minor-axis.\n*/\nVec2.prototype.minorAxis = function ()\n{\n\tif (Math.abs(this.x) < Math.abs(this.y)) this.y = 0; else this.x = 0;\n\treturn this;\n};\n\n/**\n**\tSets the vector to its sign-vector representation.\n*/\nVec2.prototype.sign = function ()\n{\n\tthis.x = !this.x ? 0 : (this.x < 0 ? -1 : 1);\n\tthis.y = !this.y ? 0 : (this.y < 0 ? -1 : 1);\n\treturn this;\n};\n\n/**\n**\tReturns the string representation of the vector.\n*/\nVec2.prototype.toString = function ()\n{\n\treturn `(${this.x}, ${this.y})`;\n};\n","/*\n**\tmath/tfunction.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\n\n/**\n**\tDescribes a function dependent of time (t-function), multiple sampling points (t,y) can be added, this class\n**\tprovides methods to access any value for a given time, or the integral of a time range.\n*/\n\nconst TFunction = Class.extend\n({\n\tclassName: 'TFunction',\n\n\t/**\n\t**\tContains the time values (t) in the t-function, for each time value there is a corresponding y and f.\n\t*/\n\tt: null,\n\n\t/**\n\t**\tContains the values (y) for each of the time values (t) in the t-function.\n\t*/\n\ty: null,\n\n\t/**\n\t**\tContains the easing function (f) for each of the time values (t).\n\t*/\n\tf: null,\n\n\t/**\n\t**\tConstructs the time function with an initial value.\n\t**\n\t**\t@param value:float Initial value of the t-function for t=0, defaults to 0.\n\t*/\n\t__ctor: function (value)\n\t{\n\t\tthis.reset (value);\n\t},\n\n\t/**\n\t**\tResets the t-function to its initial state.\n\t**\n\t**\t@param value:float Initial value of the t-function for time=0, if none provided zero will be assumed.\n\t**\n\t**\t@returns TFunction\n\t*/\n\treset: function (value=0)\n\t{\n\t\tthis.t = [0];\n\t\tthis.y = [value];\n\t\tthis.f = [null];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tResets the t-function and copies data from the specified source.\n\t**\n\t**\t@param src:TFunction Source TFunction.\n\t**\t@param t0:float Initial time, if none specified will be assumed to be the min time of the source.\n\t**\t@param t1:float Final time, if none specified will be assumed to the the max time of the source.\n\t**\n\t**\t@returns TFunction or null if the specified time range could not be resolved.\n\t*/\n\tcopyFrom: function (src, t0, t1)\n\t{\n\t\tthis.t = [];\n\t\tthis.y = [];\n\t\tthis.f = [];\n\n\t\tif (t0 == null && t1 == null)\n\t\t{\n\t\t\tfor (let i = 0; i < src.t.length; i++)\n\t\t\t{\n\t\t\t\tthis.t.push(src.t[i]);\n\t\t\t\tthis.y.push(src.y[i]);\n\t\t\t\tthis.f.push(src.f[i]);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\tif (t0 == null) t0 = src.t[0];\n\t\tif (t1 == null) t1 = src.t[src.t.length-1];\n\n\t\tif (t0 < src.t[0]) t0 = src.t[0];\n\n\t\tlet i0 = src.find(t0);\n\t\tlet i1 = src.find(t1);\n\n\t\tif (i0 == null) return null;\n\t\tif (i1 == null) return null;\n\n\t\tif (src.t[i0] != t0) {\n\t\t\tthis.set(t0, src.getAt(t0), src.f[i0]);\n\t\t\ti0++;\n\t\t}\n\n\t\tfor (let i = i0; i <= i1; i++)\n\t\t\tthis.set(src.t[i], src.y[i], src.f[i]);\n\n\t\tif (src.t[i1] != t1)\n\t\t{\n\t\t\tlet dt = (t1 - src.t[i1]) / Math.ceil(Math.log(t1 - src.t[i1]));\n\t\t\tlet t = this.t[this.t.length-1];\n\n\t\t\tif (dt <= 0) dt = 1;\ndt = t1-t; // Force just one step.\n\t\t\twhile (t != t1)\n\t\t\t{\n\t\t\t\tif (t+dt > t1)\n\t\t\t\t\tdt = t1 - t;\n\n\t\t\t\tt += dt;\n\t\t\t\tthis.set(float4(t), src.getAt(t), src.f[i1]);\n\t\t\t}\n\t\t}\n\t\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tCreates a new t-function with the same values as this.\n\t**\n\t**\t@param t0:float Initial time, if none specified will be assumed to be the min time of the source.\n\t**\t@param t1:float Final time, if none specified will be assumed to the the max time of the source.\n\t**\n\t**\t@returns TFunction\n\t*/\n\tclone: function (t0, t1)\n\t{\n\t\treturn (new TFunction()).copyFrom(this, t0, t1);\n\t},\n\n\t\t/**\n\t**\tReturns the maximum time value in the t-function plus the given delta.\n\t**\n\t**\t@param delta:float Delta value to add to the result.\n\t**\t@returns float\n\t*/\n\tendTime: function (delta=0)\n\t{\n\t\treturn this.t[this.t.length-1] + delta;\n\t},\n\n\t/**\n\t**\tReturns the start time of the t-function plus the given delta.\n\t**\n\t**\t@param delta:float Delta value to add to the result.\n\t**\t@returns float\n\t*/\n\tstartTime: function (delta=0)\n\t{\n\t\treturn this.t[0] + delta;\n\t},\n\n\t/**\n\t**\tFinds the index of a sampling point whose sampling range contains the given time.\n\t** \n\t**\t@param time:float Time value to search.\n\t**\n\t**\t@returns int Index of the sampling point or `null` if not within range.\n\t*/\n\tfind: function (time)\n\t{\n\t\tif (time < this.t[0])\n\t\t\treturn null;\n\n\t\tconst n = this.t.length;\n\n\t\tfor (let i = 1; i < n; i++)\n\t\t{\n\t\t\tif (time < this.t[i])\n\t\t\t\treturn i-1;\n\t\t}\n\n\t\treturn n-1;\n\t},\n\n\t/**\n\t**\tSets a sampling point (t,y).\n\t**\n\t**\t@param t:float Time value of the sampling point.\n\t**\t@param y:float Y-value for the given t.\n\t**\n\t**\t@returns bool Indicates if operation was successful.\n\t*/\n\tset: function (t, y, f=null)\n\t{\n\t\tlet i = this.find(t);\n\t\tif (i == null) return false;\n\n\t\tif (this.t[i] == t)\n\t\t{\n\t\t\tthis.y[i] = y;\n\t\t\tif (f != null) this.f[i] = f;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ti++;\n\t\t\tthis.t.splice(i, 0, t);\n\t\t\tthis.y.splice(i, 0, y);\n\t\t\tthis.f.splice(i, 0, f);\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tReturns the last Y-value in the t-function.\n\t**\n\t**\t@returns float Y-value.\n\t*/\n\tget: function ()\n\t{\n\t\treturn this.y[this.y.length-1];\n\t},\n\n\t/**\n\t**\tReturns the Y-value in the t-function corresponding to some point in time (t).\n\t**\n\t**\t@param t:float Time (t) value.\n\t**\n\t**\t@returns float Y-value.\n\t*/\n\tgetAt: function (t)\n\t{\n\t\tlet i0 = this.find(t);\n\t\tif (i0 == null) return 0;\n\n\t\tlet i1 = i0 + 1;\n\n\t\tif (this.t[i0] == t || i1 >= this.t.length || this.y[i0] == this.y[i1] || this.f[i0] == null)\n\t\t\treturn this.y[i0];\n\n\t\tif (this.f[i0] == null)\n\t\t\treturn this.y[i0];\n\n\t\tlet x = t;\n\t\tlet x0 = this.t[i0];\n\t\tlet x1 = this.t[i1];\n\t\tlet y0 = this.y[i0];\n\t\tlet y1 = this.y[i1];\n\n\t\tt = (x - x0) / (x1 - x0);\n\t\tt = this.f[i0](t);\n\n\t\treturn t*y1 + (1-t)*y0;\n\t},\n\n\t/**\n\t**\tReturns the approximate definite integral of the t-function for the given time range.\n\t**\n\t**\t@param t0:float Initial time value.\n\t**\t@param t1:float Final time value.\n\t**\t@param c0:float Constant of integration, default is 0.\n\t**\n\t**\t@returns float Definite integral of t-function from t0 to t1.\n\t*/\n\tintegral: function (t0=null, t1=null, c0=0)\n\t{\n\t\tif (t0 == null) t0 = this.t[0];\n\t\tif (t1 == null) t1 = this.t[this.t.length-1];\n\n\t\tif (t0 < this.t[0]) t0 = this.t[0];\n\n\t\tlet sign = 1;\n\n\t\tif (t0 > t1) {\n\t\t\tlet tmp; tmp = t0; t0 = t1; t1 = tmp;\n\t\t\tsign = -1;\n\t\t}\n\n\t\tlet accum = c0;\n\n\t\tfor (let time = t0; time < t1; )\n\t\t{\n\t\t\tlet i0 = this.find(time);\n\t\t\tif (i0 == null) return 0;\n\n\t\t\tlet i1 = i0 + 1;\n\n\t\t\tlet x0 = Math.max(this.t[i0], time);\n\t\t\tlet x1 = Math.min(i1 < this.t.length ? this.t[i1] : t1, t1);\n\n\t\t\tlet y0 = this.getAt(x0);\n\t\t\tlet y1 = this.getAt(x1);\n\n\t\t\tlet dx = x1 - x0;\n\t\t\tlet dy = y1 - y0;\n\n\t\t\tif (this.f[i0] == null)\n\t\t\t\taccum += y0*dx;\n\t\t\telse\n\t\t\t\taccum += 0.5*dy*(x1+x0) - x0*dy + y0*dx;\n\n\t\t\ttime += dx;\n\t\t}\n\n\t\treturn sign*accum;\n\t},\n\n\t/**\n\t**\tReturns the approximate definite second integral of the t-function for the given time range.\n\t**\n\t**\t@param t0:float Initial time value.\n\t**\t@param t1:float Final time value.\n\t**\t@param c0:float Constant of integration, default is 0.\n\t**\n\t**\t@returns float Definite second integral of t-function from t0 to t1.\n\t*/\n\tsecond_integral: function (t0=null, t1=null, c0=0)\n\t{\n\t\tif (t0 == null) t0 = this.t[0];\n\t\tif (t1 == null) t1 = this.t[this.t.length-1];\n\n\t\tlet a0 = TFunction.Temp1.copyFrom(this, this.t[0], t0).integrate(c0).integral();\n\t\tlet a1 = TFunction.Temp2.copyFrom(this, this.t[0], t1).integrate(c0).integral();\n\n\t\treturn a1 - a0;\n\t},\n\n\t/**\n\t**\tTransforms the t-function to its integral. For every sampling range in the t-function their Y-value will be set to the integral\n\t**\tof the sampling range plus any previous integrals.\n\t**\n\t**\t@param c0:float Constant of integration, if none specified 0 will be assumed.\n\t**\n\t**\t@returns TFunction\n\t*/\n\tintegrate: function (c0=0)\n\t{\n\t\tlet y = [];\n\n\t\ty.push(c0);\n\n\t\tfor (let i = 1; i < this.t.length; i++)\n\t\t\ty.push(y[i-1] + this.integral(this.t[i-1], this.t[i]));\n\n\t\tthis.y = y;\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tTransforms the t-function Y-values to the accumulated sum of each Y-value plus the given c0.\n\t**\n\t**\t@returns TFunction\n\t*/\n\taccumulate: function (c0=0)\n\t{\n\t\tthis.y[0] += c0;\n\n\t\tfor (let i = 1; i < this.t.length; i++)\n\t\t\tthis.y[i] += this.y[i-1];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tRemoves all sampling-points located before the given index.\n\t**\n\t**\t@returns TFunction\n\t*/\n\tchopLeft: function (i)\n\t{\n\t\tthis.t.splice(0, i);\n\t\tthis.f.splice(0, i);\n\t\tthis.y.splice(0, i);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tRemoves all sampling-points located after the given index.\n\t**\n\t**\t@returns TFunction\n\t*/\n\tchopRight: function (i)\n\t{\n\t\tthis.t.splice(i+1, this.t.length-i-1);\n\t\tthis.f.splice(i+1, this.f.length-i-1);\n\t\tthis.y.splice(i+1, this.y.length-i-1);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tMaps the Y-value to other Y-values using the specified mapping function. The mapping function will receive four\n\t**\tparameters: y, t, and i where 'y' is the y-value, 't' the t-value, 'i' the index.\n\t**\n\t**\t@returns TFunction\n\t*/\n\tmap: function (fn)\n\t{\n\t\tfor (let i = 0; i < this.y.length; i++)\n\t\t\tthis.y[i] = fn (this.y[i], this.t[i], i);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns a string representation of the variable state.\n\t**\n\t**\t@returns string\n\t*/\n\ttoString: function(c0=0)\n\t{\n\t\tlet s = '';\n\t\tlet n = 10;\n\n\t\tconst pad = function (value, n, char)\n\t\t{\n\t\t\tvalue = value.toString();\n\n\t\t\tif (char == null) char = ' ';\n\t\t\tchar = char[0];\n\n\t\t\twhile (value.length < n)\n\t\t\t\tvalue += char;\n\n\t\t\treturn value;\n\t\t};\n\n\t\ts += '\\n';\n\t\ts += pad(' Time', n) + ' ' + pad(' Value', n) + ' ' + pad(' Integral', n) + '\\n';\n\t\ts += pad('', n, '-') + ' ' + pad('', n, '-') + ' ' + pad('', n, '-') + '\\n';\n\n\t\tfor (let i = 0; i < this.t.length; i++)\n\t\t{\n\t\t\ts += pad(' '+float4(this.t[i]), n) + ' ' + pad(' '+float4(this.y[i]), n) + ' ' + pad(' '+float4(this.integral(this.t[0], this.t[i], c0)), n) + '\\n';\n\t\t}\n\n\t\treturn s;\n\t}\n});\n\nTFunction.Temp1 = new TFunction();\nTFunction.Temp2 = new TFunction();\n\nexport default TFunction;\n","/*\n**\tfroxel/anim/easing.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tCollection of useful easing functions.\n*/\n\nconst Easing =\n{\n\t/* ******************************************** */\n\tLinear:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tBack:\n\t{\n\t\tk: 1.70158,\n\n\t\tIN: function (t, k)\n\t\t{\n\t\t\tif (k === undefined) k = Easing.Back.k;\n\t\t\treturn t*t*((k+1)*t - k);\n\t\t},\n\n\t\tOUT: function (t, k)\n\t\t{\n\t\t\treturn 1 - Easing.Back.IN(1 - t, k);\n\t\t},\n\n\t\tIN_OUT: function (t, k)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Back.IN(t*2, k)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Back.OUT((t-0.5)*2, k)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tBounce:\n\t{\n\t\tgetConst: function (t)\n\t\t{\n\t\t\tif (t < 1.0/2.75)\n\t\t\t\treturn 7.5625 * t * t;\n\t\t\telse if (t < 2.0/2.75)\n\t\t\t\treturn 7.5625 * (t -= 1.5/2.75)*t + 0.75;\n\t\t\telse if (t < 2.5/2.75)\n\t\t\t\treturn 7.5625 * (t -= 2.250/2.75) * t + 0.9375;\n\n\t\t\treturn 7.5625 * (t -= 2.625/2.75) * t + 0.984375;\n\t\t},\n\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Bounce.getConst(1-t);\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn Easing.Bounce.getConst(t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn (1 - Easing.Bounce.getConst(1-2*t))/2;\n\t\t\telse\n\t\t\t\treturn (Easing.Bounce.getConst((t-0.5)*2)/2)+0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tCirc:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Math.sqrt(1 - t*t);\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Circ.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\t\treturn Easing.Circ.IN(t*2)/2;\n\t\t\t\telse\n\t\t\t\t\treturn Easing.Circ.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tCubic:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Cubic.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Cubic.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Cubic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tExpo:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn Math.pow(2, 12*(t-1));\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn -Math.pow(2, -12*t) + 1;\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif ((t *= 2) < 1)\n\t\t\t\treturn Math.pow (2, 12 * (t - 1)) / 2;\n\t\t\telse\n\t\t\t\treturn (-Math.pow (2, -12 * (t - 1)) + 2) / 2;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tPower:\n\t{\n\t\tp: 12,\n\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn Math.pow(t, Easing.Power.p);\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Power.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Power.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Power.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tQuad:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quad.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Quad.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Quad.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tQuartic:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t*t;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quartic.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Quartic.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Quartic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tQuintic:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t*t*t;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quintic.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\t\treturn Easing.Quintic.IN(t*2)/2;\n\t\t\t\telse\n\t\t\t\t\treturn Easing.Quintic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tSine:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Math.sin (1.5708 * (1 - t));\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn Math.sin (1.5708 * t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn (Math.cos (3.1416*t) - 1) / -2;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tStep:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t}\n\t}\n};\n\nexport default Easing;\n","/*\n**\tfroxel/anim/anim.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rin, Class } from '@rsthn/rin';\n\n/**\n**\tClass to animate properties using rules.\n*/\n\nconst Anim = Class.extend\n({\n\tlist: null,\n\n\tinitialData: null,\n\tdata: null,\n\n\tstack: null,\n\tblock: null,\n\n\ttimeScale: 1, time: 0, blockTime: 0,\n\tindex: 0,\n\n\tpaused: false,\n\tfinished: false,\n\n\tfinishedCallback: null,\n\tfinishedCallbackChain: null,\n\n\t__ctor: function ()\n\t{\n\t\tthis.list = [ ];\n\t\tthis.stack = [ ];\n\n\t\tthis.initialData = { };\n\t\tthis.data = { };\n\n\t\tthis.reset();\n\t},\n\n\t__dtor: function ()\n\t{\n\t},\n\n\tclone: function (target=null)\n\t{\n\t\tif (!target) target = new Anim();\n\n\t\ttarget.list = Rin.clone(this.list);\n\t\ttarget.initialData = this.initialData;\n\n\t\treturn target.reset();\n\t},\n\n\tonFinished: function (callback)\n\t{\n\t\tthis.finishedCallback = callback;\n\t\treturn this;\n\t},\n\n\tthen: function (callback)\n\t{\n\t\tif (this.finishedCallback !== this.thenCallback)\n\t\t{\n\t\t\tthis.finishedCallback = this.thenCallback;\n\t\t\tthis.finishedCallbackChain = [];\n\t\t}\n\n\t\tthis.finishedCallbackChain.push(callback);\n\t\treturn this;\n\t},\n\n\tthenCallback: function ()\n\t{\n\t\tif (!this.finishedCallbackChain.length)\n\t\t\treturn false;\n\n\t\tlet callback = this.finishedCallbackChain.shift();\n\t\tcallback.call(this);\n\t},\n\n\t// Clears the animation rules and resets the object. Does not set data to initial state.\n\tclear: function ()\n\t{\n\t\tthis.list = [ ];\n\n\t\tthis.stack.length = 0;\n\t\tthis.blockTime = 0;\n\n\t\tthis.time = 0;\n\t\tthis.index = 0;\n\n\t\tthis.block = this.list;\n\n\t\tthis.paused = false;\n\t\tthis.finished = false;\n\n\t\treturn this;\n\t},\n\n\t// Clears the animation object and resets the output data to its initial state.\n\treset: function ()\n\t{\n\t\tthis.clear();\n\n\t\tfor (let i in this.initialData)\n\t\t\tthis.data[i] = this.initialData[i];\n\n\t\treturn this;\n\t},\n\n\t// Sets the initial data.\n\tinitial: function (data)\n\t{\n\t\tthis.initialData = data;\n\t\treturn this.reset();\n\t},\n\n\t// Sets the time scale (animation speed).\n\tspeed: function (value)\n\t{\n\t\tthis.timeScale = value > 0.0 ? value : 1.0;\n\t\treturn this;\n\t},\n\n\t// Sets the output data object.\n\toutput: function (data)\n\t{\n\t\tthis.data = data;\n\t\treturn this;\n\t},\n\n\t// Pauses the animation.\n\tpause: function ()\n\t{\n\t\tthis.paused = true;\n\t\treturn this;\n\t},\n\n\t// Resumes the animation.\n\tresume: function ()\n\t{\n\t\tthis.finished = false;\n\t\tthis.paused = false;\n\t\treturn this;\n\t},\n\n\tgetValue: function (value, fieldName)\n\t{\n\t\tlet curr = this.data[fieldName];\n\n\t\tif (value === null)\n\t\t\tvalue = curr;\n\n\t\tif (typeof(value) == 'string')\n\t\t{\n\t\t\tswitch(value[0])\n\t\t\t{\n\t\t\t\tcase '+':\n\t\t\t\t\tvalue = curr + Number(value.substr(1));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase '-':\n\t\t\t\t\tvalue = curr - Number(value.substr(1));\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tvalue = Number(value);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (typeof(value) == 'function')\n\t\t\tvalue = value.call(this, this.data[fieldName], this.data, this);\n\n\t\treturn value;\n\t},\n\n\t// Updates the animation by the specified delta time, ensure the time is specified in the same units as the duration of the actions.\n\tupdate: function (dt)\n\t{\n\t\tif (this.paused) return false;\n\n\t\tif (this.index >= this.block.length)\n\t\t\treturn true;\n\n\t\tlet i = 0;\n\t\tlet _block;\n\t\tlet _index;\n\t\tlet _blockTime;\n\t\tlet _break = false;\n\n\t\tthis.time += dt*this.timeScale*Anim.timeScale;\n\n\t\twhile (this.index < this.block.length && !_break)\n\t\t{\n\t\t\tlet cmd = this.block[this.index];\n\t\t\tlet duration;\n\n\t\t\tswitch (cmd.op)\n\t\t\t{\n\t\t\t\tcase \"parallel\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd.blocks.length = 0;\n\t\t\t\t\t\tcmd.started = true;\n\n\t\t\t\t\t\tfor (i = 0; i < cmd.block.length; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcmd.blocks.push([cmd.block[i]]);\n\t\t\t\t\t\t\tcmd.indices[i] = 0;\n\t\t\t\t\t\t\tcmd.blockTimes[i] = this.blockTime;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t_block = this.block;\n\t\t\t\t\t_index = this.index;\n\t\t\t\t\t_blockTime = this.blockTime;\n\n\t\t\t\t\tlet n = 0;\n\t\t\t\t\tlet blockTime = _blockTime;\n\n\t\t\t\t\tfor (i = 0; i < cmd.blocks.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.block = cmd.blocks[i];\n\t\t\t\t\t\tthis.index = cmd.indices[i];\n\t\t\t\t\t\tthis.blockTime = cmd.blockTimes[i];\n\n\t\t\t\t\t\tif (this.update(0) === true)\n\t\t\t\t\t\t\tn++;\n\n\t\t\t\t\t\tif (this.blockTime > blockTime)\n\t\t\t\t\t\t\tblockTime = this.blockTime;\n\n\t\t\t\t\t\tcmd.blockTimes[i] = this.blockTime;\n\t\t\t\t\t\tcmd.blocks[i] = this.block;\n\t\t\t\t\t\tcmd.indices[i] = this.index;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.block = _block;\n\t\t\t\t\tthis.index = _index;\n\t\t\t\t\tthis.blockTime = _blockTime;\n\n\t\t\t\t\tif (cmd.fn) cmd.fn.call(this);\n\n\t\t\t\t\tif (n != cmd.blocks.length)\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\tcmd.started = false;\n\n\t\t\t\t\tthis.blockTime = blockTime;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"serial\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd._block = cmd.block;\n\t\t\t\t\t\tcmd._index = 0;\n\t\t\t\t\t\tcmd._blockTime = this.blockTime;\n\n\t\t\t\t\t\tcmd.started = true;\n\t\t\t\t\t}\n\n\t\t\t\t\t_block = this.block;\n\t\t\t\t\t_index = this.index;\n\t\t\t\t\t_blockTime = this.blockTime;\n\n\t\t\t\t\tthis.block = cmd._block;\n\t\t\t\t\tthis.index = cmd._index;\n\t\t\t\t\tthis.blockTime = cmd._blockTime;\n\n\t\t\t\t\ti = this.update(0);\n\n\t\t\t\t\tcmd._block = this.block;\n\t\t\t\t\tcmd._index = this.index;\n\t\t\t\t\tcmd._blockTime = this.blockTime;\n\n\t\t\t\t\tthis.block = _block;\n\t\t\t\t\tthis.index = _index;\n\t\t\t\t\tthis.blockTime = _blockTime;\n\n\t\t\t\t\tif (cmd.fn) cmd.fn.call(this);\n\n\t\t\t\t\tif (i !== true) return false;\n\n\t\t\t\t\tcmd.started = false;\n\n\t\t\t\t\tthis.blockTime = cmd._blockTime;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"repeat\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd._block = cmd.block;\n\t\t\t\t\t\tcmd._index = 0;\n\t\t\t\t\t\tcmd._blockTime = this.blockTime;\n\t\t\t\t\t\tcmd._count = cmd.count;\n\n\t\t\t\t\t\tcmd.started = true;\n\t\t\t\t\t}\n\n\t\t\t\t\t_block = this.block;\n\t\t\t\t\t_index = this.index;\n\t\t\t\t\t_blockTime = this.blockTime;\n\n\t\t\t\t\tthis.block = cmd._block;\n\t\t\t\t\tthis.index = cmd._index;\n\t\t\t\t\tthis.blockTime = cmd._blockTime;\n\n\t\t\t\t\ti = this.update(0);\n\n\t\t\t\t\tcmd._block = this.block;\n\t\t\t\t\tcmd._index = this.index;\n\t\t\t\t\tcmd._blockTime = this.blockTime;\n\n\t\t\t\t\tthis.block = _block;\n\t\t\t\t\tthis.index = _index;\n\t\t\t\t\tthis.blockTime = _blockTime;\n\n\t\t\t\t\tif (cmd.fn) cmd.fn.call(this);\n\n\t\t\t\t\tif (i !== true) return false;\n\n\t\t\t\t\tif (cmd._count <= 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd.started = false;\n\n\t\t\t\t\t\tthis.blockTime = cmd._blockTime;\n\t\t\t\t\t\tthis.index++;\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd._index = 0;\n\t\t\t\t\t\tcmd._count--;\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"set\":\n\t\t\t\t\tthis.data[cmd.field] = this.getValue(cmd.value, cmd.field);\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"restart\":\n\t\t\t\t\tthis.index = 0;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"wait\":\n\t\t\t\t\tduration = Rin.typeOf(cmd.duration) == \"string\" ? this.data[cmd.duration] : cmd.duration;\n\n\t\t\t\t\tif (this.time < this.blockTime + duration)\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\tthis.blockTime += duration;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"range\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd._startValue = this.getValue(cmd.startValue, cmd.field);\n\t\t\t\t\t\tcmd._endValue = this.getValue(cmd.endValue, cmd.field);\n\n\t\t\t\t\t\tcmd.started = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tduration = Rin.typeOf(cmd.duration) == \"string\" ? this.data[cmd.duration] : cmd.duration;\n\n\t\t\t\t\tif (this.time < this.blockTime + duration)\n\t\t\t\t\t\tdt = (this.time - this.blockTime) / duration;\n\t\t\t\t\telse\n\t\t\t\t\t\tdt = 1;\n\n\t\t\t\t\tif (cmd.easing && dt != 1.0)\n\t\t\t\t\t\tthis.data[cmd.field] = cmd.easing(dt)*(cmd._endValue - cmd._startValue) + cmd._startValue;\n\t\t\t\t\telse\n\t\t\t\t\t\tthis.data[cmd.field] = dt*(cmd._endValue - cmd._startValue) + cmd._startValue;\n\n\t\t\t\t\tif (dt != 1) return false;\n\n\t\t\t\t\tcmd.started = false;\n\n\t\t\t\t\tthis.blockTime += duration;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"rand\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd.started = true;\n\t\t\t\t\t\tcmd.last = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tduration = Rin.typeOf(cmd.duration) == \"string\" ? this.data[cmd.duration] : cmd.duration;\n\n\t\t\t\t\tif (this.time < this.blockTime + duration)\n\t\t\t\t\t\tdt = (this.time - this.blockTime) / duration;\n\t\t\t\t\telse\n\t\t\t\t\t\tdt = 1;\n\n\t\t\t\t\tif (cmd.easing && dt != 1)\n\t\t\t\t\t\tcmd.cur = ~~(cmd.easing(dt)*cmd.count);\n\t\t\t\t\telse\n\t\t\t\t\t\tcmd.cur = ~~(dt*cmd.count);\n\n\t\t\t\t\tif (cmd.cur != cmd.last)\n\t\t\t\t\t{\n\t\t\t\t\t\twhile (true) {\n\t\t\t\t\t\t\ti = ~~(Math.random()*(cmd.endValue - cmd.startValue + 1)) + cmd.startValue;\n\t\t\t\t\t\t\tif (i != this.data[cmd.field]) break;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.data[cmd.field] = i;\n\t\t\t\t\t\tcmd.last = cmd.cur;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (dt != 1) return false;\n\n\t\t\t\t\tcmd.started = false;\n\n\t\t\t\t\tthis.blockTime += duration;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"randt\":\n\t\t\t\t\tduration = Rin.typeOf(cmd.duration) == \"string\" ? this.data[cmd.duration] : cmd.duration;\n\n\t\t\t\t\tif (this.time < this.blockTime + duration)\n\t\t\t\t\t\tdt = (this.time - this.blockTime) / duration;\n\t\t\t\t\telse\n\t\t\t\t\t\tdt = 1;\n\n\t\t\t\t\tif (cmd.easing && dt != 1)\n\t\t\t\t\t\ti = cmd.easing(dt)*(cmd.count-1);\n\t\t\t\t\telse\n\t\t\t\t\t\ti = dt*(cmd.count-1);\n\n\t\t\t\t\tthis.data[cmd.field] = cmd.table[~~((i + cmd.count) % cmd.count)];\n\n\t\t\t\t\tif (dt != 1) return false;\n\n\t\t\t\t\tthis.blockTime += duration;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"play\":\n\t\t\t\t\t//if (cmd.snd instanceof Sound)\n\t\t\t\t\tcmd.snd.play();\n\t\t\t\t\t//else\n\t\t\t\t\t//cmd.snd.wrapper.play();\n\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"exec\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd.started = true;\n\t\t\t\t\t\tcmd.lastTime = this.time;\n\t\t\t\t\t}\n\n\t\t\t\t\tdt = this.time - cmd.lastTime;\n\t\t\t\t\tcmd.lastTime = this.time;\n\n\t\t\t\t\tif (cmd.fn.call(this, dt, this.data, this) === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd.started = false;\n\t\t\t\t\t\tthis.index++;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (this.block == this.list)\n\t\t{\n\t\t\tlet finished = this.finished;\n\t\t\tlet count = this.block.length;\n\n\t\t\tlet list = this.list;\n\t\t\tthis.finished = true;\n\n\t\t\tif (!finished && this.finishedCallback != null)\n\t\t\t{\n\t\t\t\tif (this.finishedCallback(this.data, this) === false)\n\t\t\t\t\tthis.finishedCallback = null;\n\n\t\t\t\tif (list !== this.list || this.block.length != count)\n\t\t\t\t{\n\t\t\t\t\tthis.resume();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t// Runs the subsequent commands in parallel. Should end the parallel block by calling end().\n\tparallel: function ()\n\t{\n\t\tlet block = [ ];\n\n\t\tthis.block.push({ op: \"parallel\", started: false, block: block, blocks: [ ], indices: [ ], blockTimes: [ ] });\n\n\t\tthis.stack.push (this.block);\n\t\tthis.block = block;\n\n\t\treturn this;\n\t},\n\n\t// Runs the subsequent commands in series. Should end the serial block by calling end().\n\tserial: function ()\n\t{\n\t\tlet block = [ ];\n\n\t\tthis.block.push({ op: \"serial\", started: false, block: block });\n\n\t\tthis.stack.push (this.block);\n\t\tthis.block = block;\n\n\t\treturn this;\n\t},\n\n\t// Repeats a block the specified number of times.\n\trepeat: function (count)\n\t{\n\t\tlet block = [ ];\n\n\t\tthis.block.push({ op: \"repeat\", started: false, block: block, count: count });\n\n\t\tthis.stack.push (this.block);\n\t\tthis.block = block;\n\n\t\treturn this;\n\t},\n\n\t// Sets the callback of the current block.\n\tcallback: function (fn)\n\t{\n\t\tlet block = this.stack[this.stack.length-1];\n\t\tblock[block.length-1].fn = fn;\n\n\t\treturn this;\n\t},\n\n\t// Ends a parallel(), serial() or repeat() block.\n\tend: function ()\n\t{\n\t\tthis.block = this.stack.pop();\n\t\treturn this;\n\t},\n\n\t// Sets the value of a variable.\n\tset: function (field, value)\n\t{\n\t\tthis.block.push({ op: \"set\", field: field, value: value });\n\t\treturn this;\n\t},\n\n\t// Restarts the current block.\n\trestart: function (duration)\n\t{\n\t\tthis.block.push({ op: \"restart\" });\n\t\treturn this;\n\t},\n\n\t// Waits for the specified duration.\n\twait: function (duration)\n\t{\n\t\tthis.block.push({ op: \"wait\", duration: duration });\n\t\treturn this;\n\t},\n\n\t// Sets the range of a variable.\n\trange: function (field, duration, startValue, endValue, easing)\n\t{\n\t\tthis.block.push({ op: \"range\", started: false, field: field, duration: duration, startValue: startValue, endValue: endValue, easing: easing ? easing : null });\n\t\treturn this;\n\t},\n\n\t// Generates a certain amount of random numbers in the given range (inclusive).\n\trand: function (field, duration, count, startValue, endValue, easing)\n\t{\n\t\tthis.block.push({ op: \"rand\", started: false, field: field, duration: duration, count: count, startValue: startValue, endValue: endValue, easing: easing ? easing : null });\n\t\treturn this;\n\t},\n\n\t// Generates a certain amount of random numbers in the given range (inclusive). This uses a static random table to determine the next values.\n\trandt: function (field, duration, count, startValue, endValue, easing)\n\t{\n\t\tlet table = [ ];\n\n\t\tfor (let i = 0; i < count; i++)\n\t\t\ttable.push ((i % (endValue - startValue + 1)) + startValue);\n\n\t\tfor (let i = count >> 2; i > 0; i--)\n\t\t{\n\t\t\tlet a = ~~(Math.random() * count);\n\t\t\tlet b = ~~(Math.random() * count);\n\n\t\t\tlet c = table[b];\n\t\t\ttable[b] = table[a];\n\t\t\ttable[a] = c;\n\t\t}\n\n\t\tthis.block.push({ op: \"randt\", field: field, duration: duration, count: count, startValue: startValue, endValue: endValue, table: table, easing: easing ? easing : null });\n\t\treturn this;\n\t},\n\n\t// Plays a sound.\n\tplay: function (snd)\n\t{\n\t\tthis.block.push({ op: \"play\", snd: snd });\n\t\treturn this;\n\t},\n\n\t// Executes a function.\n\texec: function (fn)\n\t{\n\t\tthis.block.push({ op: \"exec\", fn: fn, started: false });\n\t\treturn this;\n\t},\n\n\t/* ********************************************************** */\n\n\t// Sets X coordinate.\n\tsetX: function (value)\n\t{\n\t\treturn this.set('x', value);\n\t},\n\n\t// Sets Y coordinate.\n\tsetY: function (value)\n\t{\n\t\treturn this.set('y', value);\n\t},\n\n\t// Sets X and Y coordinates.\n\tposition: function (x, y)\n\t{\n\t\treturn this.set('x', x).set('y', y);\n\t},\n\n\t// Translates the X coordinate.\n\ttranslateX: function (duration, deltaValue, easing)\n\t{\n\t\treturn this.range('x', duration, null, (deltaValue < 0 ? '-' : '+') + Math.abs(deltaValue), easing);\n\t},\n\n\t// Translates the Y coordinate.\n\ttranslateY: function (duration, deltaValue, easing)\n\t{\n\t\treturn this.range('y', duration, null, (deltaValue < 0 ? '-' : '+') + Math.abs(deltaValue), easing);\n\t},\n\n\t// Translates the X and Y coordinates.\n\ttranslate: function (duration, deltaValueX, deltaValueY, easingX, easingY=null)\n\t{\n\t\treturn this.parallel()\n\t\t\t\t.range('x', duration, null, (deltaValueX < 0 ? '-' : '+') + Math.abs(deltaValueX), easingX)\n\t\t\t\t.range('y', duration, null, (deltaValueY < 0 ? '-' : '+') + Math.abs(deltaValueY), easingY ? easingY : easingX)\n\t\t\t\t.end();\n\t},\n\n\t// Sets the X and Y coordinates to the specified values.\n\tmoveTo: function (duration, endValueX, endValueY, easingX, easingY=null)\n\t{\n\t\treturn this.parallel()\n\t\t\t\t.range('x', duration, null, endValueX, easingX)\n\t\t\t\t.range('y', duration, null, endValueY, easingY ? easingY : easingX)\n\t\t\t\t.end();\n\t},\n\n\t// Scales the X coordinate.\n\tscaleX: function (duration, endValue, easing)\n\t{\n\t\treturn this.range('sx', duration, null, endValue, easing);\n\t},\n\n\t// Scales the Y coordinate.\n\tscaleY: function (duration, endValue, easing)\n\t{\n\t\treturn this.range('sy', duration, null, endValue, easing);\n\t},\n\n\t// Scales the X and Y coordinates.\n\tscale: function (duration, endValueX, endValueY, easingX, easingY=null)\n\t{\n\t\treturn this.parallel()\n\t\t\t\t.range('sx', duration, null, endValueX, easingX)\n\t\t\t\t.range('sy', duration, null, endValueY, easingY ? easingY : easingX)\n\t\t\t\t.end();\n\t},\n\n\t// Rotates a certain number of radians.\n\trotate: function (duration, deltaValue, easing)\n\t{\n\t\treturn this.range('angle', duration, null, (deltaValue < 0 ? '-' : '+') + Math.abs(deltaValue), easing);\n\t},\n});\n\n/*\n**\tGlobal time scale.\n*/\nAnim.timeScale = 1.0;\n\n// Sets the global time scale (animation speed).\nAnim.speed = function (value)\n{\n\tAnim.timeScale = value > 0.0 ? value : 1.0;\n};\n\nexport default Anim;\n","/*\n**\tspatial/quadtree-item.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Rect from '../math/rect.js';\n\n/*\n**\tSequence counter. Used to assign unique IDs to quad tree items.\n*/\nlet quadTreeItemID = 0;\n\n/*\n**\tBase class for items accepted by a QuadTree.\n*/\n\nconst QuadTreeItem = Class.extend\n({\n\t/*\n\t**\tName of the class (for inheritance purposes).\n\t*/\n\tclassName: \"QuadTreeItem\",\n\n\t/*\n\t**\tUnique ID of the quad-tree item.\n\t*/\n\tid: 0,\n\n\t/*\n\t**\tSelection index of the item. Updated by QuadTree to indicate in which order the item was selected.\n\t*/\n\tselectedIndex: 0,\n\n\t/*\n\t**\tBoundaries at which the item was inserted.\n\t*/\n\tinsertionBounds: null, /* Rect */\n\n\t/*\n\t**\tBoundaries of the last known position that was correct.\n\t*/\n\tlastBounds: null, /* Rect */\n\n\t/*\n\t**\tBounds of the element.\n\t*/\n\tbounds: null, /* Rect */\n\n\t/*\n\t**\tHitbox of the element for collision detection.\n\t*/\n\thitbox: null, /* Rect */\n\n\t/*\n\t**\tZ-index (layer ordering) of the item.\n\t*/\n\tzindex: 0,\n\n\t/*\n\t**\tIndicates if the item can be selected for futher operations.\n\t*/\n\t_visible: true,\n\n\t/*\n\t**\tFlags of the item (see FLAG_* constants).\n\t*/\n\tflags: 0,\n\n\t/*\n\t**\tNumber of nodes referencing this item.\n\t*/\n\tnumRefNodes: 0,\n\n\t/*\n\t**\tTag of the item.\n\t*/\n\ttag: null,\n\n\t/*\n\t**\tExecuted when the item is created.\n\t*/\n\t__ctor: function ()\n\t{\n\t\tthis.id = ++quadTreeItemID;\n\n\t\tthis.insertionBounds = Rect.alloc();\n\t\tthis.lastBounds = Rect.alloc();\n\t\tthis.bounds = Rect.alloc();\n\t\tthis.hitbox = Rect.alloc();\n\n\t\tthis.numRefNodes = 0;\n\t\tthis.zindex = 0;\n\n\t\tthis.flags = QuadTreeItem.FLAG_INITIAL;\n\t\tthis._visible = true;\n\t},\n\n\t/*\n\t**\tResets the object to its initial state.\n\t*/\n\t__reinit: function ()\n\t{\n\t\tthis.insertionBounds.zero();\n\t\tthis.lastBounds.zero();\n\t\tthis.bounds.zero();\n\t\tthis.hitbox.zero();\n\n\t\tthis.numRefNodes = 0;\n\t\tthis.zindex = 0;\n\n\t\tthis.flags = QuadTreeItem.FLAG_INITIAL;\n\t\tthis._visible = true;\n\n\t\tthis.tag = null;\n\t},\n\n\t/*\n\t**\tExecuted when the item is removed from the tree.\n\t*/\n\t__dtor: function ()\n\t{\n\t\tRect.free(this.insertionBounds);\n\t\tRect.free(this.lastBounds);\n\t\tRect.free(this.bounds);\n\t\tRect.free(this.hitbox);\n\t},\n\n\t/*\n\t**\tSets flag bits.\n\t*/\n\tsetFlags: function (value)\n\t{\n\t\tthis.flags |= value;\n\t},\n\n\t/*\n\t**\tClears flag bits.\n\t*/\n\tclearFlags: function (value)\n\t{\n\t\tthis.flags &= ~value;\n\t},\n\n\t/*\n\t**\tReturns the result of masking (bitwise AND) the flags by the specified flag bits.\n\t*/\n\tgetFlags: function (value)\n\t{\n\t\treturn this.flags & value;\n\t},\n\n\t/*\n\t**\tSets the tag of the item.\n\t*/\n\tsetTag: function (tag)\n\t{\n\t\tthis.tag = tag;\n\t},\n\n\t/*\n\t**\tReturns the tag of the item.\n\t*/\n\tgetTag: function()\n\t{\n\t\treturn this.tag;\n\t},\n\n\t/*\n\t**\tSets the z-index of the item.\n\t*/\n\tsetZIndex: function (value)\n\t{\n\t\tthis.zindex = value;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tReturns the Z-index of the item.\n\t*/\n\tgetZIndex: function ()\n\t{\n\t\treturn this.zindex;\n\t},\n\n\t/*\n\t**\tExecuted when the item is inserted on the tree.\n\t*/\n\tnotifyInserted: function (tree)\n\t{\n\t\tthis.flags |= QuadTreeItem.FLAG_ATTACHED;\n\t\tthis.insertionBounds.set (this.getBounds());\n\n\t\tif (this.flags & QuadTreeItem.FLAG_INITIAL)\n\t\t{\n\t\t\tthis.flags &= ~QuadTreeItem.FLAG_INITIAL;\n\t\t\tthis.lastBounds.set (this.getBounds());\n\t\t}\n\t},\n\n\t/*\n\t**\tExecuted when the item is removed from the tree.\n\t*/\n\tnotifyRemoved: function (tree)\n\t{\n\t\tthis.flags &= ~QuadTreeItem.FLAG_ATTACHED;\n\t},\n\n\t/*\n\t**\tExecuted when the item's position has been acnowledged.\n\t*/\n\tnotifyPosition: function ()\n\t{\n\t\tthis.lastBounds.set (this.getBounds());\n\t},\n\n\t/*\n\t**\tReturns the rect with the insertion bounds.\n\t*/\n\tgetInsertionBounds: function () /* Rect */\n\t{\n\t\treturn this.insertionBounds;\n\t},\n\n\t/*\n\t**\tReturns the rect with the last bounds.\n\t*/\n\tgetLastBounds: function () /* Rect */\n\t{\n\t\treturn this.lastBounds;\n\t},\n\n\t/*\n\t**\tReturns the physical bounds of the item.\n\t*/\n\tgetBounds: function () /* Rect */\n\t{\n\t\treturn this.bounds;\n\t},\n\n\t/*\n\t**\tReturns the hitbox of the item (used for collision detection). The hitbox must always be a sub-set of the bounds\n\t**\tof the item or collision detection might not work.\n\t*/\n\tgetHitbox: function () /* Rect */\n\t{\n\t\treturn this.hitbox;\n\t}\n});\n\n/*\n**\tExecuted when the item is removed from the tree.\n*/\nQuadTreeItem.FLAG_QUEUED\t\t=\t0x01;\nQuadTreeItem.FLAG_ATTACHED\t\t=\t0x02;\nQuadTreeItem.FLAG_SELECTED\t\t=\t0x04;\nQuadTreeItem.FLAG_INITIAL\t\t=\t0x08;\nQuadTreeItem.FLAG_ALWAYS_SELECT\t=\t0x10;\nQuadTreeItem.FLAG_NEVER_SELECT\t=\t0x20;\nQuadTreeItem.FLAG_CHILD\t\t\t=\t0x40;\nQuadTreeItem.FLAG_USERDEF\t\t=\t0x80;\n\nexport default QuadTreeItem;\n","/*\n**\tspatial/quadtree-node.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Rect from '../math/rect.js';\nimport Log from '../system/log.js';\nimport QuadTreeItem from './quadtree-item.js';\n\n/**\n**\tDescribes a node of the quad tree.\n*/\n\nconst QuadTreeNode = Class.extend\n({\n\t/**\n\t**\tName of the class (for inheritance purposes).\n\t*/\n\tclassName: \"QuadTreeNode\",\n\n\t/**\n\t**\tRegion covered by this node.\n\t*/\n\textents: null, /* Rect */\n\n\t/**\n\t**\tNumber of items stored in the node (and all of its sub-nodes).\n\t*/\n\tnumItems: 0, /* int */\n\n\t/**\n\t**\tLink to the first item of this node.\n\t*/\n\tinsertionPoint: null,\n\n\t/**\n\t**\tSub-nodes of the node. If the node is a branch subNode will not be null.\n\t*/\n\tsubNode: null, /* array[4] of QuadTreeNode */\n\n\t/**\n\t**\tIndicates if the node or a sub-node is dirty.\n\t*/\n\tisDirty: false,\n\n\t/**\n\t**\tTree containing this node.\n\t*/\n\ttree: null,\n\n\t/**\n\t**\tConstructs the tree node with the specified extents.\n\t*/\n\t__ctor: function (tree, x1, y1, x2, y2)\n\t{\n\t\tthis.tree = tree;\n\n\t\tthis.numItems = 0;\n\t\tthis.isDirty = false;\n\n\t\tthis.insertionPoint = null;\n\t\tthis.subNode = null;\n\n\t\tthis.extents = Rect.alloc(x1, y1, x2, y2);\n\t},\n\n\t/**\n\t**\tDestroys the node and all child nodes. Items are not removed, use clear() to properly remove items.\n\t*/\n\t__dtor: function ()\n\t{\n\t\tif (this.subNode != null)\n\t\t{\n\t\t\tfor (var i = 0; i < 4; i++)\n\t\t\t\tdispose(this.subNode[i]);\n\n\t\t\tthis.subNode = null;\n\t\t}\n\n\t\tthis.extents.dispose();\n\t},\n\n\t/**\n\t**\tRemoves all items and child nodes.\n\t*/\n\tclear: function ()\n\t{\n\t\tif (this.subNode != null)\n\t\t{\n\t\t\tfor (var i = 0; i < 4; i++)\n\t\t\t{\n\t\t\t\tthis.subNode[i].clear(this.tree.items);\n\t\t\t\tdispose(this.subNode[i]);\n\t\t\t}\n\n\t\t\tthis.subNode = null;\n\t\t\tthis.numItems = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar j = null;\n\n\t\t\tfor (var i = this.insertionPoint; i && this.numItems--; i = j)\n\t\t\t{\n\t\t\t\tj = i.next;\n\n\t\t\t\tvar k = this.tree.items.remove(i);\n\t\t\t\tk.numRefNodes--;\n\n\t\t\t\tif (k.numRefNodes == 0)\n\t\t\t\t{\n\t\t\t\t\tk.notifyRemoved(this.tree);\n\t\t\t\t\tdispose(k);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.insertionPoint = null;\n\t\t\tthis.numItems = 0;\n\t\t}\n\t},\n\n\t/**\n\t**\tReturns the extents of the node (Rect).\n\t*/\n\tgetExtents: function () /* Rect */\n\t{\n\t\treturn this.extents;\n\t},\n\n\t/**\n\t**\tReturns boolean indicating if the node is a leaf.\n\t*/\n\tisLeaf: function ()\n\t{\n\t\treturn this.subNode == null;\n\t},\n\n\t/**\n\t**\tReturns the sub-nodes of the node.\n\t*/\n\tgetSubNodes: function () /* Array[QuadTreeNode] or null if it is a leaf. */\n\t{\n\t\treturn this.subNode;\n\t},\n\n\t/**\n\t**\tAdds an item to the node or any of its sub-nodes. If the node exceeds the given capacity the node will be split in four sub-nodes.\n\t**\tReturns false if the item could not added because (a) it is outside the extents of the tree or (b) the node cannot be split.\n\t*/\n\taddItem: function (/*QuadTreeItem*/item, /*int*/capacity) /* bool */\n\t{\n\t\tif (!item.getBounds().intersects(this.extents))\n\t\t\treturn false;\n\n\t\tif (this.subNode != null)\n\t\t{\n\t\t\tvar result = false;\n\n\t\t\tfor (var i = 0; i < 4; i++)\n\t\t\t\tresult |= this.subNode[i].addItem (item, capacity);\n\n\t\t\tif (result)\n\t\t\t{\n\t\t\t\tthis.isDirty = true;\n\t\t\t\tthis.numItems++;\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\tif (this.numItems < capacity)\n\t\t{\n\t\t\tif (this.insertionPoint == null)\n\t\t\t{\n\t\t\t\tthis.tree.items.push (item);\n\t\t\t\tthis.insertionPoint = this.tree.items.bottom;\n\t\t\t}\n\t\t\telse\n\t\t\t\tthis.tree.items.insertAfter (this.insertionPoint, item);\n\n\t\t\tthis.isDirty = true;\n\t\t\tthis.numItems++;\n\n\t\t\tif (item.numRefNodes == 0)\n\t\t\t\titem.notifyInserted(this.tree);\n\n\t\t\titem.numRefNodes++;\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.extents.width() < 1 && this.extents.height() < 1)\n\t\t\tthrow new Error (\"Error: Unable to split node any further. Current size is \"+this.extents.width()+\" x \"+this.extents.height());\n\n\t\tthis.subNode = [\n\t\t\tnew QuadTreeNode (this.tree, this.extents.x1, this.extents.y1, this.extents.cx, this.extents.cy),\n\t\t\tnew QuadTreeNode (this.tree, this.extents.cx, this.extents.y1, this.extents.x2, this.extents.cy),\n\t\t\tnew QuadTreeNode (this.tree, this.extents.x1, this.extents.cy, this.extents.cx, this.extents.y2),\n\t\t\tnew QuadTreeNode (this.tree, this.extents.cx, this.extents.cy, this.extents.x2, this.extents.y2)\n\t\t];\n\n\t\tlet n = this.numItems;\n\t\tthis.numItems = 0;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tlet tmp = this.insertionPoint.next;\n\t\t\tlet cur = this.insertionPoint.value;\n\n\t\t\tcur.numRefNodes--;\n\n\t\t\tif (!this.addItem (cur, capacity))\n\t\t\t\tthrow new Error (\"Error: Shouldn't have happened. Unable to insert item on a sub-node of a just-split node.\");\n\n\t\t\tthis.tree.items.remove (this.insertionPoint);\n\t\t\tthis.insertionPoint = tmp;\n\t\t}\n\n\t\tthis.insertionPoint = null;\n\n\t\treturn this.addItem (item, capacity);\n\t},\n\n\t/**\n\t**\tRemoves an item from the node and/or its sub-nodes. Returns false if the node was not found.\n\t*/\n\tremoveItem: function (/*QuadTreeItem*/item)\n\t{\n\t\tif (!item.getInsertionBounds().intersects(this.extents))\n\t\t\treturn false;\n\n\t\tif (this.subNode != null)\n\t\t{\n\t\t\tvar result = false;\n\n\t\t\tfor (var i = 0; i < 4; i++)\n\t\t\t\tresult |= this.subNode[i].removeItem (item);\n\n\t\t\tif (result)\n\t\t\t{\n\t\t\t\tthis.isDirty = true;\n\t\t\t\tthis.numItems--;\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\tvar i = this.insertionPoint;\n\t\tvar n = this.numItems;\n\n\t\tfor (; i && n--; i = i.next)\n\t\t{\n\t\t\tif (i.value == item) break;\n\t\t}\n\n\t\tif (i == null) return false;\n\n\t\tthis.isDirty = true;\n\t\tthis.numItems--;\n\n\t\titem.numRefNodes--;\n\n\t\tif (i === this.insertionPoint)\n\t\t\tthis.insertionPoint = this.numItems ? i.next : null;\n\n\t\tthis.tree.items.remove(i);\n\n\t\tif (item.numRefNodes == 0)\n\t\t\titem.notifyRemoved(this.tree);\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tSelects items inside the specified region from the node and all sub-nodes.\n\t*/\n\tselectItems: function (/*Rect*/rect=null, filter=null)\n\t{\n\t\tif (rect && !rect.intersects(this.extents))\n\t\t\treturn;\n\n\t\tif (this.subNode != null)\n\t\t{\n\t\t\tfor (var i = 0; i < 4; i++)\n\t\t\t\tthis.subNode[i].selectItems (rect, filter);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar i = this.insertionPoint;\n\t\t\tvar n = this.numItems;\n\n\t\t\tfor (; i && n--; i = i.next)\n\t\t\t{\n\t\t\t\tif (!(i.value.flags & QuadTreeItem.FLAG_NEVER_SELECT) && (rect == null || (i.value._visible == true && i.value.getInsertionBounds().intersects(rect)) || (i.value.flags & QuadTreeItem.FLAG_ALWAYS_SELECT)))\n\t\t\t\t{\n\t\t\t\t\tif (filter && !filter(i.value))\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tif (!(i.value.flags & QuadTreeItem.FLAG_SELECTED))\n\t\t\t\t\t{\n\t\t\t\t\t\ti.value.flags |= QuadTreeItem.FLAG_SELECTED;\n\t\t\t\t\t\tthis.tree.selectedCount++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t**\tFinds all collisions and executes the specified handler. Before calling the handler the provided filter function will\n\t**\tbe used to determine if the two objects colliding actually represent a semantically correct collision.\n\t*/\n\tdetectCollisions: function (/*IQuadTreeHandler*/handler, forced=false)\n\t{\n\t\tif (!this.isDirty && !forced)\n\t\t\treturn;\n\n\t\tthis.isDirty = false;\n\n\t\tif (this.subNode != null)\n\t\t{\n\t\t\tfor (var i = 0; i < 4; i++)\n\t\t\t\tthis.subNode[i].detectCollisions (handler, forced);\n\n\t\t\treturn;\n\t\t}\n\n\t\tvar n = this.numItems;\n\t\tvar i_next;\n\n\t\tfor (var i = this.insertionPoint; i && n > 1; i = i_next)\n\t\t{\n\t\t\tvar i_next = i.next;\n\t\t\tvar m = --n;\n\n\t\t\tif (i.value._visible == false || (i.value.flags & QuadTreeItem.FLAG_NEVER_SELECT))\n\t\t\t\tcontinue;\n\n\t\t\tif (!handler.onFilterRequest (i.value))\n\t\t\t\tcontinue;\n\n\t\t\tvar rect = i.value.getBounds();\n\t\t\t//var hitboxes = i.value.getHitboxes();\n\t\t\tvar j_next;\n\n\t\t\tfor (var j = i.next; j && m-- > 0; j = j_next)\n\t\t\t{\n\t\t\t\tvar j_next = j.next;\n\n\t\t\t\tif (j.value._visible == false || (j.value.flags & QuadTreeItem.FLAG_NEVER_SELECT))\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (!handler.onFilterRequest (j.value))\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (!j.value.getBounds().intersects(rect))\n\t\t\t\t\tcontinue;\n\n\t\t\t\t//violet ADD THIS!!!\n\t\t\t\t//if (!j.value.queryCollision(hitboxes))\n\t\t\t\t//\tcontinue;\n\n\t\t\t\t// Following code is non-standard cherry. Required on JS because linkables might be recycled.\n\t\t\t\tvar iId = i.objectId;\n\t\t\t\tvar jId = j.objectId;\n\n\t\t\t\thandler.onCollision (i.value, j.value);\n\n\t\t\t\t// NOTE: Restarting the collision detector on this loop will cause an infinite loop if the collision\n\t\t\t\t// is not properly resolved by the handler. It is recommended to gather all collisions instead and\n\t\t\t\t// run a global solver.\n\n\t\t\t\tif (i.objectId != iId)\n\t\t\t\t{\n\t\t\t\t\ti_next = this.insertionPoint;\n\t\t\t\t\tn = this.numItems;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (j.objectId != jId)\n\t\t\t\t{\n\t\t\t\t\tj_next = i.next;\n\t\t\t\t\tm = n;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n\nexport default QuadTreeNode;\n","/*\n**\tspatial/quadtree.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport List from '../utils/list.js';\nimport QuadTreeNode from './quadtree-node.js';\nimport QuadTreeItem from './quadtree-item.js';\nimport Log from '../system/log.js';\n\n/*\n**\tImplemention of a quad tree for optimized storage of spatial items.\n*/\n\nconst QuadTree = Class.extend\n({\n\t/*\n\t**\tName of the class (for inheritance purposes).\n\t*/\n\tclassName: \"QuadTree\",\n\n\t/*\n\t**\tRoot node of the tree.\n\t*/\n\troot: null, /*QuadTreeNode*/\n\n\t/*\n\t**\tList of all inserted items, linearly grouped by node.\n\t*/\n\titems: null, /*List<QuadTreeItem>*/\n\n\t/*\n\t**\tList of items ordered by their position from back to front.\n\t*/\n\torderedItems: null, /*List<QuadTreeItem>*/\n\n\t/*\n\t**\tQueue of items to be updated on the next update cycle.\n\t*/\n\tupdateQueue: null, /*List<QuadTreeItem>*/\n\n\t/*\n\t**\tMaximum number of items per each node.\n\t*/\n\tnodeCapacity: 0,\n\n\t/*\n\t**\tNode pointing to the next selected item.\n\t*/\n\tnextItem: null, /*Linkable<QuadTreeItem>*/\n\n\t/*\n\t**\tNumber of remaining selected items. Read by using `getSelectedCount` after a call to `selectItems`.\n\t*/\n\tselectedCount: 0,\n\n\t/*\n\t**\tInternally used to update the selectedIndex property of QuadTreeItem.\n\t*/\n\tselectedIndex: 0,\n\n\t/*\n\t**\tDirection of traversal of selected items, forward (false) or backward (true).\n\t*/\n\tisReverse: false,\n\n\t/*\n\t**\tIndicates if the quad tree layer is visible.\n\t*/\n\tvisible: true,\n\n\t/*\n\t**\tDirection of the X, Y and Z coordinates (true=inverted). Used to alter ordering of items in the quad tree.\n\t*/\n\txd: false, yd: false, zd: false,\n\n\t/*\n\t**\tConstructs a quad tree for the specified region.\n\t*/\n\t__ctor: function (x1, y1, x2, y2, nodeCapacity)\n\t{\n\t\tthis.items = new List();\n\t\tthis.orderedItems = new List();\n\t\tthis.updateQueue = new List();\n\n\t\tthis.root = new QuadTreeNode (this, x1, y1, x2, y2);\n\t\tthis.nodeCapacity = nodeCapacity;\n\n\t\tthis.isReverse = false;\n\t\tthis.visible = true;\n\n\t\tthis.fnComparator = this.COMPARATOR_DEFAULT_YX;\n\t},\n\n\t/*\n\t**\tDestructs the tree, all nodes and all items.\n\t*/\n\t__dtor: function ()\n\t{\n\t\tthis.root.clear();\n\t\tdispose(this.root);\n\n\t\tdispose(this.items);\n\t\tdispose(this.orderedItems);\n\t\tdispose(this.updateQueue);\n\t},\n\n\t/*\n\t**\tReturns the root node of the quad tree.\n\t*/\n\tgetRoot: function () /*QuadTreeNode*/\n\t{\n\t\treturn this.root;\n\t},\n\n\t/*\n\t**\tReturns the extents of the quad tree.\n\t*/\n\tgetExtents: function () /*Rect*/\n\t{\n\t\treturn this.root.getExtents();\n\t},\n\n\t/*\n\t**\tSets the visibility of the QuadTree.\n\t*/\n\tsetVisible: function (value)\n\t{\n\t\tthis.visible = value;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tReturns the visibility of the QuadTree.\n\t*/\n\tgetVisible: function ()\n\t{\n\t\treturn this.visible;\n\t},\n\n\t/*\n\t**\tRemoves (and destroys) all items and all nodes from the tree.\n\t*/\n\tclear: function ()\n\t{\n\t\tthis.root.clear();\n\n\t\tthis.orderedItems.reset();\n\t\tthis.updateQueue.reset();\n\t},\n\n\t/*\n\t**\tSets the direction of the x, y or z axis.\n\t*/\n\tsetXd: function (value) { if (this.xd == value) return false; this.xd = value; return true; },\n\tsetYd: function (value) { if (this.yd == value) return false; this.yd = value; return true; },\n\tsetZd: function (value) { if (this.zd == value) return false; this.zd = value; return true; },\n\n\t/*\n\t**\tReturns the sign of the x, y or z axis.\n\t*/\n\tgetXd: function() { return this.xd; },\n\tgetYd: function() { return this.yd; },\n\tgetZd: function() { return this.zd; },\n\n\t/*\n\t**\tReturns true if \"a\" should be drawn before \"b\".\n\t*/\n\tfnComparator: null,\n\n\t/*\n\t**\tSets the comparator function used to determine the drawing order of items. Returns false if the provided comparator\n\t**\tis the same as the one currently being used.\n\t*/\n\tsetComparator: function (fnComparator)\n\t{\n\t\tif (this.fnComparator == fnComparator)\n\t\t\treturn false;\n\n\t\tthis.fnComparator = fnComparator;\n\t\treturn true;\n\t},\n\n\t/*\n\t**\tReturns true if \"a\" should be drawn before \"b\". Uses 2D-grid comparison. Z-Index specifies a virtual layer.\n\t*/\n\tCOMPARATOR_DEFAULT_YX: function (a, b, p, q)\n\t{\n\t\treturn ((p.zindex<q.zindex)^this.zd) || (p.zindex==q.zindex && (((a.y1<b.y1)^this.yd) || (a.y1==b.y1 && ((a.x1<b.x1)^this.xd))));\n\t},\n\n\t/*\n\t**\tReturns true if \"a\" should be drawn before \"b\". Uses 2D-grid comparison. Z-Index specifies a virtual layer.\n\t*/\n\tCOMPARATOR_DEFAULT_XY: function (a, b, p, q)\n\t{\n\t\treturn ((p.zindex<q.zindex)^this.zd) || (p.zindex==q.zindex && (((a.x1<b.x1)^this.xd) || (a.x1==b.x1 && ((a.y1<b.y1)^this.yd))));\n\t},\n\n\t/*\n\t**\tReturns true if \"a\" should be drawn before \"b\". Uses Manhattan distance function. Z-Index specifies a virtual layer.\n\t*/\n\tCOMPARATOR_MANHATTAN: function (a, b, p, q)\n\t{\n\t\treturn ((p.zindex < q.zindex) ^ this.zd) || (p.zindex == q.zindex && (a.cx + a.cy < b.cx + b.cy));\n\t},\n\n\t/*\n\t**\tReturns true if \"a\" should be drawn before \"b\" by comparing only the Y2 component. The Z-Index is arithmetically added to the Y2 value.\n\t*/\n\tCOMPARATOR_Y2: function (a, b, p, q)\n\t{\n\t\treturn ((p.zindex<q.zindex)^this.zd) || (p.zindex==q.zindex && (((a.y2<b.y2)^this.yd) || (a.y2==b.y2 && (a.x1<=b.x1)^this.xd)));\n\t},\n\n\t/*\n\t**\tReturns true if \"a\" should be drawn before \"b\" by comparing only the Y-axis. The Z-Index is arithmetically added to the Y1 value.\n\t*/\n\tCOMPARATOR_Y1: function (a, b, p, q)\n\t{\n\t\treturn ((a.y1 + p.zindex) < (b.y1 + q.zindex)) ^ this.yd;\n\t},\n\n\t/*\n\t**\tReturns true if \"a\" should be drawn before \"b\" by comparing only the Y-axis. The Z-Index is arithmetically added to the X2 value.\n\t*/\n\tCOMPARATOR_X2: function (a, b, p, q)\n\t{\n\t\treturn ((a.x2 + p.zindex) < (b.x2 + q.zindex)) ^ this.xd;\n\t},\n\n\t/*\n\t**\tReturns true if \"a\" should be drawn before \"b\" by comparing only the Y-axis. The Z-Index is arithmetically added to the X1 value.\n\t*/\n\tCOMPARATOR_X1: function (a, b, p, q)\n\t{\n\t\treturn ((a.x1 + p.zindex) < (b.x1 + q.zindex)) ^ this.xd;\n\t},\n\n\t/*\n\t**\tUsed for internal ordering. Returns true if item P is before item Q by comparing their position.\n\t*/\n\tisBefore: function (/*QuadTreeItem*/p, /*QuadTreeItem*/q)\n\t{\n\t\treturn this.fnComparator(p.insertionBounds, q.insertionBounds, p, q);\n\t},\n\n\t/*\n\t**\tAdds an item to the ordered list.\n\t*/\n\taddItemOrdered: function (/*QuadTreeItem*/item)\n\t{\n\t\tfor (var i = this.orderedItems.top; i; i = i.next)\n\t\t{\n\t\t\tif (this.isBefore (item, i.value))\n\t\t\t{\n\t\t\t\tthis.orderedItems.insertBefore (i, item);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.orderedItems.push (item);\n\t},\n\n\t/*\n\t**\tReorders the ordered-items-list using the current comparator. Should be called after changing the comparator or the axes sign.\n\t*/\n\treorderItems: function ()\n\t{\n\t\tvar tmp = this.orderedItems;\n\n\t\tthis.orderedItems = new List();\n\n\t\tfor (var i = tmp.top; i; i = i.next)\n\t\t\tthis.addItemOrdered(i.value);\n\n\t\tdispose(tmp);\n\t},\n\n\t/*\n\t**\tAdds an item to the tree, returns false if the operation was unsuccessful.\n\t*/\n\taddItem: function (/*QuadTreeItem*/item) /*bool*/\n\t{\n\t\tif (this.root.addItem (item, this.nodeCapacity))\n\t\t{\n\t\t\tthis.addItemOrdered (item);\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t},\n\n\t/*\n\t**\tRemoves an item from the tree. Returns false if the operation was unsuccessful.\n\t*/\n\tremoveItem: function (/*QuadTreeItem*/item) /*bool*/\n\t{\n\t\tif (!(item.flags & QuadTreeItem.FLAG_ATTACHED))\n\t\t\treturn true;\n\n\t\tif (!this.root.removeItem (item))\n\t\t\treturn false;\n\n\t\tthis.orderedItems.remove (this.orderedItems.sgetNode (item));\n\t\treturn true;\n\t},\n\n\t/*\n\t**\tAdds an item to the update queue to be processed on the next update cycle.\n\t*/\n\tupdateItem: function (/*QuadTreeItem*/item)\n\t{\n\t\tthis.removeItem(item);\n\n\t\tif (!this.addItem(item))\n\t\t\tthrow new Error ('Unable to re-attach item to quadtree.');\n\n\t\tif (item.flags & QuadTreeItem.FLAG_QUEUED)\n\t\t\treturn;\n\n\t\tthis.updateQueue.push (item);\n\t\titem.flags |= QuadTreeItem.FLAG_QUEUED;\n\t},\n\n\t/*\n\t**\tRuns an update cycle on the tree. Any queued item will be updated.\n\t*/\n\tupdate: function()\n\t{\n\t\tvar i;\n\n\t\twhile (i = this.updateQueue.pop())\n\t\t{\n\t\t\ti.flags &= ~QuadTreeItem.FLAG_QUEUED;\n\t\t\ti.notifyPosition();\n\t\t}\n\t},\n\n\t/*\n\t**\tReturns the list of ordered items.\n\t*/\n\tgetItems: function () /*List<QuadTreeItem>*/\n\t{\n\t\treturn this.orderedItems;\n\t},\n\n\t/*\n\t**\tSets the reverse-flag to report selected items from front-to-back (true) or back-to-front (false).\n\t*/\n\tsetReverse: function (value) /*QuadTree*/\n\t{\n\t\tthis.isReverse = value;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSelects all items that are within the specified region. Methods `getNextSelected` and `getCountSelected` can be used to determine the next\n\t**\titem and the number of remaining selected items. Returns the number of items selected.\n\t*/\n\tselectItems: function (/*Rect*/rect=null, filter=null, isReverse=null)\n\t{\n\t\tif (isReverse === null)\n\t\t\tisReverse = this.isReverse;\n\n\t\tthis.selectedCount = 0;\n\t\tthis.selectedIndex = 0;\n\n\t\tthis.root.selectItems (rect, filter);\n\n\t\tthis.nextItem = isReverse ? this.orderedItems.bottom : this.orderedItems.top;\n\t\treturn this.selectedCount;\n\t},\n\n\t/*\n\t**\tReturns the number of remaining selected items.\n\t*/\n\tgetCountSelected: function()\n\t{\n\t\treturn this.selectedCount;\n\t},\n\n\t/*\n\t**\tReturns the next selected item in the list or null if the end has been reached.\n\t*/\n\tgetNextSelected: function (isReverse=null) /*QuadTreeItem*/\n\t{\n\t\tif (isReverse === null)\n\t\t\tisReverse = this.isReverse;\n\n\t\twhile (this.nextItem != null && !(this.nextItem.value.flags & QuadTreeItem.FLAG_SELECTED))\n\t\t{\n\t\t\tthis.nextItem = isReverse ? this.nextItem.prev : this.nextItem.next;\n\t\t}\n\n\t\tvar ret = this.nextItem;\n\n\t\tif (this.nextItem)\n\t\t{\n\t\t\tthis.nextItem.value.flags &= ~QuadTreeItem.FLAG_SELECTED;\n\t\t\tthis.nextItem = isReverse ? this.nextItem.prev : this.nextItem.next;\n\t\t}\n\n\t\tif (ret != null)\n\t\t{\n\t\t\tret.value.selectedIndex = this.selectedIndex;\n\n\t\t\tthis.selectedIndex++;\n\t\t\tthis.selectedCount--;\n\n\t\t\treturn ret.value;\n\t\t}\n\n\t\treturn null;\n\t},\n\n\t/*\n\t**\tClears the FLAG_SELECTED from all currently selected items.\n\t*/\n\treleaseSelected: function ()\n\t{\n\t\twhile (this.selectedCount > 0) this.getNextSelected();\n\t},\n\n\t/*\n\t**\tReturns the number of items inside the specified region.\n\t*/\n\tcountItems: function (/*Rect*/rect=null, filter=null)\n\t{\n\t\tlet count = this.selectItems(rect, filter);\n\t\tthis.releaseSelected();\n\n\t\treturn count;\n\t},\n\n\t/*\n\t**\tDetects collisions between items and executes the methods of the specified handler. The handler object should implement:\n\t**\n\t**\tbool onFilterRequest (item)\n\t**\tbool onCollision (a, b)\n\t*/\n\tdetectCollisions: function (/*IQuadTreeHandler*/handler, forced=false)\n\t{\n\t\tthis.root.detectCollisions (handler, forced);\n\t},\n\n\t/*\n\t**\tReturns the items inside the specified region.\n\t*/\n\tselectItemsIntoArray: function (/*Rect*/rect, filter=null)\n\t{\n\t\tlet list = [];\n\n\t\tthis.selectItems(rect, filter);\n\n\t\twhile (this.getCountSelected())\n\t\t\tlist.push(this.getNextSelected());\n\n\t\treturn list;\n\t}\n});\n\nexport default QuadTree;\n","/*\n**\tflow/boot.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\n\nimport PriorityQueue from '../utils/priority-queue.js';\nimport System from '../system/system.js';\nimport Resources from '../resources/resources.js';\nimport C from '../system/config.js';\n\n/*\n**\t\n*/\n\nconst Boot =\n{\n\tmodules: new PriorityQueue(),\n\n\tinit: function ()\n\t{\n\t\tResources.integerScaling = false;\n\t\n\t\tSystem.init ({ antialias: C.ANTIALIAS, fullscreen: false, background: C.BACKGROUND, screenWidth: C.WIDTH, screenHeight: C.HEIGHT, orientation: C.ORIENTATION, fps: C.FPS, minFps: C.MIN_FPS || 15 });\n\t\n\t\tBoot.startup();\n\t},\n\n\tregister: function (module)\n\t{\n\t\treturn this.modules.add(module);\n\t},\n\n\tunregister: function (module)\n\t{\n\t\tthis.modules.remove(module);\n\t\tthis.modules.cleanup();\n\t},\n\n\tstartup: function ()\n\t{\n\t\tthis.modules.forEachAsync( (m,r) => { if (m.onStartup(r) !== false) r(); } );\n\t},\n\n\tshutdown: function ()\n\t{\n\t\tthis.modules.forEachAsyncRev( (m,r) => { if (m.onShutdown(r) !== false) r(); } );\n\t}\n};\n\n/*\n**\n*/\n\nBoot.Module = Class.extend\n({\n\tclassName: \"Module\",\n\n\tpriority: 5,\n\n\t__ctor: function()\n\t{\n\t\tBoot.register(this);\n\t},\n\n\t__dtor: function()\n\t{\n\t\tBoot.unregister(this);\n\t},\n\n\t/*\n\t**\tShould return false if the method is async and when finished should call next().\n\t*/\n\tonStartup: function (next)\n\t{\n\t},\n\n\t/*\n\t**\tShould return false if the method is async and when finished should call next().\n\t*/\n\tonShutdown: function (next)\n\t{\n\t}\n});\n\nexport default Boot;\n","/*\n**\tflow/element.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport G from '../system/globals.js'\nimport Rect from '../math/rect.js'\nimport Anim from '../anim/anim.js';\nimport Matrix from '../math/matrix.js';\nimport Log from '../system/log.js';\nimport QuadTreeItem from '../spatial/quadtree-item.js';\n\n/*\n**\n*/\n\nexport default QuadTreeItem.extend\n({\n\tclassName: 'Element',\n\n\t/*\n\t**\tIndicates if the element is visible, when set to `false`, the element will not be drawn.\n\t*/\n\t_visible: true,\n\n\t/*\n\t**\tIndicates if the element is active, when set to `false` the element will not be updated.\n\t*/\n\t_active: true,\n\n\t/*\n\t**\tControls whether bounding box creating is relative to the center (false) or to the top-left corner (true).\n\t*/\n\t_topLeftRelative: true,\n\n\t/*\n\t**\tAnimation related to the element.\n\t*/\n\tanim: null,\n\n\t/*\n\t**\tParent element to whom this element is related.\n\t*/\n\tparent: null,\n\n\t/*\n\t**\tContainer where this element is stored, and its related node. If `container` is false, it means the element doesn't need a container. These\n\t**\tare set by the parent container, do not modify directly.\n\t*/\n\tcontainer: null,\n\tnode: null,\n\n\t/*\n\t**\tElement type. Can be used to differentiate between elements.\n\t*/\n\ttype: 0,\n\n\t/*\n\t**\tElement initial status.\n\t*/\n\talpha: 1,\n\tangle: 0,\n\tx: 0, y: 0,\n\tsx: 1, sy: 1,\n\twidth: 0, height: 0,\n\n\t/*\n\t**\tTransformation matrix to place the object in world space.\n\t*/\n\ttransform: null,\n\ttransformDirty: false,\n\n\t/*\n\t**\tIndicates if the bounds, or hitbox of the element should be drawn (for debugging purposes).\n\t*/\n\tdebugBounds: false,\n\tdebugHitbox: false,\n\n\t/*\n\t**\tConstructor.\n\t*/\n\t__ctor: function(x=0, y=0, width=0, height=0)\n\t{\n\t\tthis._super.QuadTreeItem.__ctor();\n\n\t\tthis.anim = new Anim();\n\t\tthis.anim.output(this);\n\n\t\tthis.x = x;\n\t\tthis.y = y;\n\n\t\tthis.transform = new Matrix();\n\n\t\tthis.resize(width, height);\n\t\tthis.updateTransform(true);\n\t},\n\n\t/*\n\t**\tDestructs the element.\n\t*/\n\t__dtor: function()\n\t{\n\t\tthis._super.QuadTreeItem.__dtor();\n\t\tthis.remove();\n\n\t\tthis.anim = null;\n\t\tthis.transform = null;\n\t},\n\n\t/*\n\t**\tSets or returns the visible flag.\n\t*/\n\tvisible: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t{\n\t\t\t//if (this.container === null)\n\t\t\t//\treturn false;\n\n\t\t\treturn this._visible && (this.parent != null ? this.parent.visible() : true);\n\t\t}\n\n\t\tthis._visible = value;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets or returns the active flag.\n\t*/\n\tactive: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._active && (this.parent != null ? this.parent.active() : true);\n\n\t\tthis._active = value;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the width and height of the element.\n\t*/\n\tresize: function (width, height)\n\t{\n\t\tthis.width = width;\n\t\tthis.height = height;\n\n\t\tthis._updateBounds();\n\t},\n\n\t/*\n\t**\tUpdates the world-space bounding box.\n\t*/\n\t_updateBounds: function()\n\t{\n\t\tthis.bounds.zero();\n\t\tthis.bounds.translate (0, 0);\n\t\tthis.bounds.resizeBy (this.width, this.height, this._topLeftRelative);\n\n\t\t// violet: figure a way to optimize this\n\t\tlet p0 = this.transform.applyTo(this.bounds.x1, this.bounds.y1);\n\t\t//let p1 = this.transform.applyTo(this.bounds.x1, this.bounds.y2);\n\t\t//let p2 = this.transform.applyTo(this.bounds.x2, this.bounds.y1);\n\t\tlet p3 = this.transform.applyTo(this.bounds.x2, this.bounds.y2);\n\n\t\tthis.bounds.reset();\n\t\tthis.bounds.extendWithPoint(p0);\n\t\t//this.bounds.extendWithPoint(p1);\n\t\t//this.bounds.extendWithPoint(p2);\n\t\tthis.bounds.extendWithPoint(p3);\n\t},\n\n\t/*\n\t**\tUpdates the element's transformation matrix.\n\t*/\n\tupdateTransform: function(immediateTransformUpdate=false)\n\t{\n\t\tif (!immediateTransformUpdate)\n\t\t{\n\t\t\tthis.transformDirty = true;\n\t\t\treturn;\n\t\t}\n\n\t\t/* ** */\n\t\tif (this.parent != null)\n\t\t\tthis.transform.set(this.parent.transform);\n\t\telse\n\t\t\tthis.transform.identity();\n\n\t\tthis.transform.translate(this.x, this.y);\n\n\t\tif (this.sx != 0)\n\t\t\tthis.transform.scale(this.sx, 1.0);\n\n\t\tif (this.sy != 0)\n\t\t\tthis.transform.scale(1.0, this.sy);\n\n\t\tif (this.angle != 0)\n\t\t{\n\t\t\tthis.transform.translate(0.5*this.width, 0.5*this.height);\n\t\t\tthis.transform.rotate(this.angle);\n\t\t}\n\n\t\tthis.transformDirty = false;\n\n\t\tthis._updateBounds();\n\t\tthis.updatePosition();\n\t},\n\n\t/*\n\t**\tReturns the element's root (first parent) or itself if no parent is set.\n\t*/\n\tgetRoot: function()\n\t{\n\t\tlet item = this;\n\n\t\twhile (item.parent) item = item.parent;\n\t\treturn item;\n\t},\n\n\t/*\n\t**\tSets the parent of the element.\n\t*/\n\tsetParent: function(parent)\n\t{\n\t\tif (this.parent != null)\n\t\t{\n\t\t}\n\n\t\tthis.parent = parent;\n\t\tthis.transformDirty = true;\n\t},\n\n\t/*\n\t**\tReturns the X coordinate of the element, if `absolute` is true it will include any offset introduced by the parent.\n\t*/\n\tgetX: function(absolute=false)\n\t{\n\t\treturn (absolute && this.parent != null ? this.parent.getX(true) : 0) + this.x;\n\t},\n\n\t/*\n\t**\tReturns the Y coordinate of the element, if `absolute` is true it will include any offset introduced by the parent.\n\t*/\n\tgetY: function(absolute=false)\n\t{\n\t\treturn (absolute && this.parent != null ? this.parent.getY(true) : 0) + this.y;\n\t},\n\n\t/*\n\t**\tApplies the inverse transform of the element (including parent transform) to the specified point.\n\t*/\n\tinverseTransform: function (point)\n\t{\n\t\tif (this.parent != null)\n\t\t\tthis.parent.inverseTransform (point);\n//violet: check if this is ok\n\t\tpoint.x -= this.x;\n\t\tpoint.y -= this.y;\n\n\t\tpoint.x /= this.sx;\n\t\tpoint.y /= this.sy;\n\n\t\treturn point;\n\t},\n\n\t/*\n\t**\tChanges the animation object of the element.\n\t*/\n\tsetAnim: function (anim)\n\t{\n\t\tanim.clone(this.anim);\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tResets the animation object of the element.\n\t*/\n\tresetAnim: function (anim=null)\n\t{\n\t\tif (anim != null) this.setAnim (anim);\n\t\tthis.anim.reset();\n\t},\n\n\t/*\n\t**\tAdds the element to the specified container. Returns itself.\n\t*/\n\taddTo: function (container)\n\t{\n\t\tcontainer.add(this);\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tRemoves the element from the container (and parent element).\n\t*/\n\tremove: function()\n\t{\n\t\tif (this.parent != null)\n\t\t\tthis.parent.removeChild (this);\n\n\t\tif (this.container)\n\t\t{\n\t\t\tthis.container.remove (this);\n\t\t\tthis.container = null;\n\t\t\t// VIOLET: make some method on container to set null when removed\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tUpdates the position of the element in the container.\n\t*/\n\tupdatePosition: function()\n\t{\n\t\tif (this.container)\n\t\t\tthis.container.syncPosition(this);\n\t},\n\n\t/*\n\t**\tMoves the element by the specified deltas.\n\t*/\n\ttranslate: function (dx, dy, immediateTransformUpdate=false)\n\t{\n\t\tthis.x += dx;\n\t\tthis.y += dy;\n\n\t\tthis.bounds.translate (dx, dy);\n\n\t\tthis.updateTransform(immediateTransformUpdate);\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the position of the element.\n\t*/\n\tsetPosition: function (x, y, immediateTransformUpdate=false)\n\t{\n\t\treturn this.translate (x - this.x, y - this.y, immediateTransformUpdate);\n\t},\n\n\t/*\n\t**\tApplies the element's transform to the specified canvas.\n\t*/\n\tapplyTransform: function(g)\n\t{\n\t\tg.appendMatrix(this.transform);\n\n\t\tif (this.alpha != 1.0)\n\t\t\tg.alpha(this.alpha);\n\t},\n\n\t/*\n\t**\tCalled before the `elementDraw` operation to ensure the canvas is transformed based on the element's state.\n\t*/\n\tpreDraw: function(g)\n\t{\n\t\tg.pushMatrix();\n\t\tg.pushAlpha();\n\n\t\tthis.applyTransform(g);\n\t},\n\n\t/*\n\t**\tCalled after the `elementDraw` operation to restore the canvas transform.\n\t*/\n\tpostDraw: function(g)\n\t{\n\t\tif (G.debugBounds || this.debugBounds)\n\t\t{\n\t\t\tg.lineWidth(1);\n\t\t\tg.strokeStyle(\"yellow\");\n\t\t\tg.strokeRect(0.5, 0.5, this.width-1, this.height-1);\n\t\t}\n\n\t\tg.popAlpha();\n\t\tg.popMatrix();\n\n\t\tif (G.debugHitbox || this.debugHitbox)\n\t\t{\n\t\t\tif (!this.type)\n\t\t\t\tg.fillStyle(\"rgba(255,255,255,0.5)\");\n\t\t\telse\n\t\t\t\tg.fillStyle(\"rgba(0,255,255,0.5)\");\n\n\t\t\tg.fillRect(this.insertionBounds.x1, this.insertionBounds.y1, this.insertionBounds.width(), this.insertionBounds.height());\n\n\t\t\t// violet: remove this? or figure a better way to have this.\n\t\t\t/*if (this.highlight)\n\t\t\t{\n\t\t\t\tg.fillStyle(\"rgba(255,0,0,0.5)\");\n\t\t\t\tg.fillRect(this.highlight.x1, this.highlight.y1, this.highlight.width(), this.highlight.height());\n\t\t\t}*/\n\n\t\t\t//if (this.type) {\n\t\t\t//\tg.font('bold 3px monospace');\n\t\t\t//\tg.fillStyle('red');\n\t\t\t//\tg.fillText(this.selectedIndex, this.insertionBounds.x1, this.insertionBounds.y1);\n\t\t\t//}\n\t\t}\n\t},\n\n\t/*\n\t**\tDraws the element on the specified canvas. If the `_visible` flag is false, this method has no effect.\n\t*/\n\tdraw: function(g)\n\t{\n\t\tif (!this.visible()) return; // violet: optimize by returning immediately if elementDraw is the default one\n\n\t\tthis.preDraw(g);\n\t\tthis.elementDraw(g);\n\t\tthis.postDraw(g);\n\t},\n\n\t/*\n\t**\tUpdates the element by the specified amount of time `dt` (seconds). If `_active` flag is false, this method has no effect.\n\t*/\n\tupdate: function(dt)\n\t{\n\t\tif (!this.active()) return;\n\n\t\tif (!this.anim.update(dt) || this.transformDirty)\n\t\t{\n\t\t\tthis.updateTransform(true);\n//Log.vars.Y++;//violet: remove, was used to count transform updates\n\t\t}\n//\t\telse\n//Log.vars.X++;//violet: remove, was used to count transform updates\n\n\t\tthis.elementUpdate(dt);\n\t},\n\n\t/*\n\t**\tDraws the element to the specified canvas. Ensure draw operations are done in model-space.\n\t*/\n\telementDraw: function(g) /* @override */\n\t{\n\t},\n\n\t/*\n\t**\tUpdates the element. Parameter `dt` is the time delta measured in seconds.\n\t*/\n\telementUpdate: function(dt) /* @override */\n\t{\n\t},\n\n\t/*\n\t**\tExecuted when the item is added to a container.\n\t*/\n\tonAttached: function (container) /* @override */\n\t{\n\t},\n\n\t/*\n\t**\tExecuted when the item is removed from a container.\n\t*/\n\tonDetached: function (container) /* @override */\n\t{\n\t}\n});\n","/*\n**\tflow/container.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Element from './element.js';\nimport QuadTree from '../spatial/quadtree.js';\n\n/*\n**\tElement container class.\n*/\n\nexport default Class.extend(Element,\n{\n\tclassName: 'Container',\n\n\treverseDraw: false,\n\n\ttree: null,\n\tviewportBounds: null,\n\n\t__ctor: function (x1=-1e6, y1=-1e6, x2=1e6, y2=1e6, nodeCapacity=16)\n\t{\n\t\tthis._super.Element.__ctor();\n\n\t\tthis.container = false;\n\n\t\tthis.tree = new QuadTree (x1, y1, x2, y2, nodeCapacity);\n\t},\n\n\tgetTree: function()\n\t{\n\t\treturn this.tree;\n\t},\n\n\tadd: function(elem)\n\t{\n\t\tif (!this.tree.addItem(elem))\n\t\t\treturn elem;\n\n\t\telem.container = this;\n\n\t\telem.onAttached(this);\n\t\treturn elem;\n\t},\n\n\tremove: function(elem)\n\t{\n\t\tif (elem.container !== this)\n\t\t\treturn elem;\n\n\t\tthis.tree.removeItem(elem);\n\n\t\telem.onDetached(this);\n\t\treturn elem;\n\t},\n\n\tsyncPosition: function(elem)\n\t{\n\t\tif (!elem || elem.container !== this)\n\t\t\treturn;\n\n\t\tthis.tree.updateItem(elem);\n\t},\n\n\tsetViewportBounds: function(rect)\n\t{\n\t\tthis.viewportBounds = rect;\n\t},\n\n\telementDraw: function(g)\n\t{\n\t\tthis.tree.selectItems(this.viewportBounds, this.reverseDraw);\n\n\t\twhile (true)\n\t\t{\n\t\t\tlet elem = this.tree.getNextSelected();\n\t\t\tif (!elem) break;\n\n\t\t\telem.draw(g);\n\t\t}\n\n\t\tthis.containerDraw(g);\n\t},\n\n\telementUpdate: function(dt)\n\t{\n\t\tthis.tree.getItems().forEach((v) => v.update(dt));\n\t\tthis.containerUpdate(dt);\n\t\tthis.tree.update();\n\t},\n\n\tcontainerDraw: function(g) /* @override */\n\t{\n\t},\n\n\tcontainerUpdate: function(dt) /* @override */\n\t{\n\t},\n});\n","/*\n**\tflow/viewport.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tViewport class controls the current visible rectangle of the world.\n*/\n\nimport Rect from '../math/rect.js';\nimport Log from '../system/log.js';\nimport { Class } from '@rsthn/rin';\n\nexport default Class.extend\n({\n\tclassName: 'Viewport',\n\n\t/*\n\t**\tDimensions of the viewport.\n\t*/\n\twidth: 0,\n\theight: 0,\n\n\t/*\n\t**\tPosition of the top-left corner of the viewport in screen space.\n\t*/\n\tsx: 0,\n\tsy: 0,\n\n\t/*\n\t**\tPosition of the center of the viewport in the world.\n\t*/\n\tx: 0,\n\ty: 0,\n\n\t/*\n\t**\tRatio for the viewport's center (value from -1 to 1), used when focusing to use a different focus point instead of the exact center.\n\t*/\n\tcenterRatioX: 0,\n\tcenterRatioY: 0,\n\n\t/*\n\t**\tPosition offsets, used to move the viewport around without affecting the focus point.\n\t*/\n\tdx: 0,\n\tdy: 0,\n\n\t/*\n\t**\tBoundaries of the world (automatically calculated from the world dimensions).\n\t*/\n\tworldX1: 0,\n\tworldY1: 0,\n\tworldX2: 0,\n\tworldY2: 0,\n\n\t/*\n\t**\tThe focus factor determines the ratio of a smaller viewport on which the current focus point must \n\t**\tbe contained. If the focus point is not inside the smaller viewport scrolling will be performed.\n\t*/\n\tfocusFactorX: 0,\n\tfocusFactorY: 0,\n\n\t/*\n\t**\tFocus target rectangle and its offsets. When the viewport is updated it will automatically focus on this rect.\n\t*/\n\tfocusRect: null,\n\tfocusOffsX: 0,\n\tfocusOffsY: 0,\n\n\t/*\n\t**\tIndicates if the viewport is enabled.\n\t*/\n\tenabled: false,\n\n\t/*\n\t**\tViewport scale.\n\t*/\n\tscale: 1,\n\n\t/*\n\t**\tBounds of the viewport in world space. Used to determine which elements lie inside the viewport.\n\t*/\n\tbounds: null,\n\n\t/*\n\t**\tBounds of the focus area of the viewport in world space. When the focusRect moves outside this area the viewport will be\n\t**\tpanned to keep it inside these bounds.\n\t*/\n\tfocusBounds: null,\n\n\t/*\n\t**\tBounds of the viewport in screen space for rendering.\n\t*/\n\tscreenBounds: null,\n\n\t/**\n\t**\tConstructs the viewport with the specified viewport and world dimensions. A focus factor can\n\t**\tbe specified as well, if none provided the default value is 0.4.\n\t*/\n\t__ctor: function (sx, sy, width, height, worldWidth, worldHeight, focusFactorX/*0.4*/, focusFactorY/*0.4*/)\n\t{\n\t\tthis.focusFactorX = focusFactorX == undefined ? 0.4 : focusFactorX;\n\t\tthis.focusFactorY = focusFactorY == undefined ? 0.4 : focusFactorY;\n\n\t\tthis.focusRect = null;\n\n\t\tthis.sx = sx;\n\t\tthis.sy = sy;\n\n\t\tif (width > worldWidth) width = worldWidth;\n\t\tif (height > worldHeight) height = worldHeight;\n\n\t\tthis.width = width;\n\t\tthis.height = height;\n\n\t\tworldWidth >>= 1;\n\t\tworldHeight >>= 1;\n\n\t\tthis.worldX1 = -worldWidth;\n\t\tthis.worldY1 = -worldHeight;\n\t\tthis.worldX2 = +worldWidth;\n\t\tthis.worldY2 = +worldHeight;\n\n\t\tthis.bounds = Rect.alloc();\n\t\tthis.focusBounds = Rect.alloc();\n\t\tthis.screenBounds = Rect.alloc();\n\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\n\t\tthis.enabled = true;\n\n\t\tthis.updateScreenBounds();\n\t\tthis.updateBounds();\n\t},\n\n\t/*\n\t**\tReturns the enabled flag of the viewport.\n\t*/\n\tisEnabled: function ()\n\t{\n\t\treturn this.enabled;\n\t},\n\n\t/*\n\t**\tSets the enabled flag of the viewport.\n\t*/\n\tsetEnabled: function (enabled)\n\t{\n\t\tthis.enabled = enabled;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tUpdates the bound rect of the viewport.\n\t*/\n\tupdateBounds: function ()\n\t{\n\t\tlet w = this.width >> 1;\n\t\tlet h = this.height >> 1;\n\n\t\tthis.bounds.set (this.x-(w/this.scale)+this.dx, this.y-(h/this.scale)+this.dy, this.x+(w/this.scale)+this.dx, this.y+(h/this.scale)+this.dy);\n\n\t\tthis.focusBounds.set (\n\t\t\tthis.x - (this.focusFactorX*w + this.centerRatioX*w)/this.scale, this.y - (this.focusFactorY*h + this.centerRatioY*h)/this.scale,\n\t\t\tthis.x + (this.focusFactorX*w + this.centerRatioX*w)/this.scale, this.y + (this.focusFactorY*h + this.centerRatioY*h)/this.scale\n\t\t);\n\t},\n\n\t/*\n\t**\tUpdates the screen bound rect of the viewport.\n\t*/\n\tupdateScreenBounds: function ()\n\t{\n\t\tthis.screenBounds.set (this.sx, this.sy, this.sx + (this.width-1), this.sy + (this.height-1));\n\t},\n\n\t/*\n\t**\tSets the size of the viewport.\n\t*/\n\tresize: function (width, height)\n\t{\n\t\tthis.width = width;\n\t\tthis.height = height;\n\n\t\tthis.updateScreenBounds();\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the center position of the viewport within the world.\n\t*/\n\tsetPosition: function (x, y)\n\t{\n\t\tthis.x = x;\n\t\tthis.y = y;\n\n\t\tthis.dx = 0;\n\t\tthis.dy = 0;\n\n\t\tthis.updateBounds();\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the position of the viewport relative to the current focus point.\n\t*/\n\tsetOffsets: function (dx, dy)\n\t{\n\t\tthis.dx = dx;\n\t\tthis.dy = dy;\n\n\t\tthis.updateBounds();\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the scale of the viewport.\n\t*/\n\tsetScale: function (value)\n\t{\n\t\tthis.scale = value;\n\n\t\tthis.updateScreenBounds();\n\t\tthis.updateBounds();\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the center ratio of the viewport.\n\t*/\n\tsetCenter: function (rx, ry)\n\t{\n\t\tthis.centerRatioX = rx;\n\t\tthis.centerRatioY = ry;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tMoves the viewport in the world, relative to the current focus point.\n\t*/\n\ttranslate: function (dx, dy)\n\t{\n\t\tthis.dx += dx;\n\t\tthis.dy += dy;\n\n\t\tthis.updateBounds();\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the screen position of the viewport.\n\t*/\n\tsetScreenPosition: function (sx, sy)\n\t{\n\t\tthis.sx = sx;\n\t\tthis.sy = sy;\n\n\t\tthis.updateScreenBounds();\n\t},\n\n\t/*\n\t**\tReturns the X position of the viewport inside the world. When `absolute` is true, the focus point X (without offset) will be returned.\n\t*/\n\tgetX: function (absolute=false)\n\t{\n\t\treturn this.x + (absolute ? 0 : this.dx);\n\t},\n\n\t/*\n\t**\tReturns the Y position of the viewport inside the world. When `absolute` is true, the focus point Y (without offset) will be returned.\n\t*/\n\tgetY: function (absolute=false)\n\t{\n\t\treturn this.y + (absolute ? 0 : this.dy);\n\t},\n\n\t/*\n\t**\tReturns the X position of the viewport inside the world relative to the current focus point.\n\t*/\n\tgetPositionX: function ()\n\t{\n\t\treturn this.dx;\n\t},\n\n\t/*\n\t**\tReturns the Y position of the viewport inside the world relative to the current focus point.\n\t*/\n\tgetPositionY: function ()\n\t{\n\t\treturn this.dy;\n\t},\n\n\t/*\n\t**\tReturns the width of the viewport.\n\t*/\n\tgetWidth: function ()\n\t{\n\t\treturn this.width;\n\t},\n\n\t/*\n\t**\tReturns the height of the viewport.\n\t*/\n\tgetHeight: function ()\n\t{\n\t\treturn this.height;\n\t},\n\n\t/*\n\t**\tReturns the bounds of the viewport in world-space.\n\t*/\n\tgetBounds: function ()\n\t{\n\t\treturn this.bounds;\n\t},\n\n\t/*\n\t**\tReturns the bounds of the viewport in screens-space.\n\t*/\n\tgetScreenBounds: function ()\n\t{\n\t\treturn this.screenBounds;\n\t},\n\n\t/*\n\t**\tReturns the bounds of the focus-area rectangle in world-space.\n\t*/\n\tgetFocusBounds: function ()\n\t{\n\t\treturn this.focusBounds;\n\t},\n\n\t/*\n\t**\tMoves the viewport to focus on the specified rectangle or point. If (i1,j1) is not specified then the viewport will be point-focused\n\t**\tto the given point (i0,j0). Also, if no focus factors are specified the default ones will be used.\n\t*/\n\tfocusOn: function (i0, j0, i1=null, j1=null, kx=null, ky=null)\n\t{\n\t\tif (kx === null) kx = this.focusFactorX;\n\t\tif (ky === null) ky = this.focusFactorY;\n\n\t\tif (i1 === null) i1 = i0;\n\t\tif (j1 === null) j1 = j0;\n\n\t\tlet w = this.width >> 1;\n\t\tlet h = this.height >> 1;\n\n\t\tlet x1 = this.x - (kx*w + this.centerRatioX*w)/this.scale;\n\t\tlet x2 = this.x + (kx*w + this.centerRatioX*w)/this.scale;\n\t\tlet y1 = this.y - (ky*h + this.centerRatioY*h)/this.scale;\n\t\tlet y2 = this.y + (ky*h + this.centerRatioY*h)/this.scale;\n\n\t\tif (x1 == x2)\n\t\t\ti0 = i1 = (i0 + i1) / 2;\n\n\t\tif (y1 == y2)\n\t\t\tj0 = j1 = (j0 + j1) / 2;\n\n\t\tlet nx = this.x;\n\t\tlet ny = this.y;\n\n\t\tif (i0 < x1) nx += (i0 - x1);\n\t\telse if (i1 > x2) nx += (i1 - x2);\n\n\t\tif (j0 < y1) ny += (j0 - y1);\n\t\telse if (j1 > y2) ny += (j1 - y2);\n\n\t\tx1 = nx - w;\n\t\tx2 = nx + w;\n\t\ty1 = ny - h;\n\t\ty2 = ny + h;\n\n\t\tif (x1 < this.worldX1) nx = this.worldX1 + w;\n\t\tif (x2 > this.worldX2) nx = this.worldX2 - w;\n\n\t\tif (y1 < this.worldY1) ny = this.worldY1 + h;\n\t\tif (y2 > this.worldY2) ny = this.worldY2 - h;\n\n\t\tthis.x = nx;\n\t\tthis.y = ny;\n\n\t\tthis.updateBounds();\n\t},\n\n\t/*\n\t**\tUpdates the viewport.\n\t*/\n\tupdate: function (dt)\n\t{\n\t\tif (this.focusRect != null)\n\t\t\tthis.focusOn (this.focusRect.x1, this.focusRect.y1, this.focusRect.x2, this.focusRect.y2);\n\t},\n\n\t/*\n\t**\tTracks a specified rectangle by maintaining focus on it (a call to `update` must be made on every frame update).\n\t*/\n\tsetFocusRect: function (/*Rect*/rect, offsX=0, offsY=0)\n\t{\n\t\tthis.focusRect = rect;\n\n\t\tthis.focusOffsX = offsX;\n\t\tthis.focusOffsY = offsY;\n\n\t\tthis.update(0);\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the focus factor of the viewport.\n\t*/\n\tsetFocusFactor: function (/*float*/valueX, /*float*/valueY)\n\t{\n\t\tthis.focusFactorX = valueX;\n\t\tthis.focusFactorY = valueY === undefined ? valueX : valueY;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tApplies the viewport transform to the specified display buffer.\n\t*/\n\tapplyTransform: function (g)\n\t{\n\t\tg.translate (this.screenBounds.cx, this.screenBounds.cy);\n\t\tg.scale (this.scale, this.scale);\n\t\tg.translate (-this.getX(), -this.getY());\n\n\t\tg.matr.data[6] = ~~g.matr.data[6];\n\t\tg.matr.data[7] = ~~g.matr.data[7];\n\t\tg.updateTransform();\n\t},\n\n\t/*\n\t**\tConverts a point from screen-space to world-space.\n\t*/\n\ttoWorldSpace: function (x, y, floor=false)\n\t{\n\t\tif (floor) {\n\t\t\tx = ((x - ~~this.screenBounds.cx) / this.scale) + ~~this.getX();\n\t\t\ty = ((y - ~~this.screenBounds.cy) / this.scale) + ~~this.getY();\n\t\t}\n\t\telse {\n\t\t\tx = ((x - this.screenBounds.cx) / this.scale) + this.getX();\n\t\t\ty = ((y - this.screenBounds.cy) / this.scale) + this.getY();\n\t\t}\n\n\t\treturn { x: x, y: y };\n\t},\n\n\t/*\n\t**\tConverts a point from world-space to screen-space.\n\t*/\n\ttoScreenSpace: function (x, y, floor=false)\n\t{\n\t\tif (floor) {\n\t\t\tx = (x - ~~this.getX()) * this.scale + ~~this.screenBounds.cx;\n\t\t\ty = (y - ~~this.getY()) * this.scale + ~~this.screenBounds.cy;\n\t\t}\n\t\telse {\n\t\t\tx = (x - this.getX()) * this.scale + this.screenBounds.cx;\n\t\t\ty = (y - this.getY()) * this.scale + this.screenBounds.cy;\n\t\t}\n\n\t\treturn { x: x, y: y };\n\t},\n});\n","/*\n**\tflow/scene.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Element from './element.js';\nimport Container from './container.js';\nimport Viewport from './viewport.js';\nimport Rect from '../math/rect.js';\n\n/*\n**\tAn scene is a set of containers and viewports in specific order.\n*/\n\nconst Scene = Element.extend\n({\n\tclassName: 'Scene',\n\n\t/*\n\t**\tList of containers.\n\t*/\n\tlayers: null,\n\n\t/*\n\t**\tList of viewports.\n\t*/\n\tviewports: null,\n\n\t/*\n\t**\tViewport bounds to select items.\n\t*/\n\tviewportBounds: null,\n\n\t/*\n\t**\tConstructs an empty scene.\n\t*/\n\t__ctor: function (numLayers=null)\n\t{\n\t\tthis._super.Element.__ctor();\n\n\t\tthis.layers = [];\n\n\t\tthis.viewports = [];\n\t\tthis.viewportBounds = Rect.alloc();\n\n\t\tthis.container = false;\n\t},\n\n\t/*\n\t**\tDestructs the instance.\n\t*/\n\t__dtor: function()\n\t{\n\t\tthis._super.Element.__dtor();\n\n\t\tthis.viewportBounds.dispose();\n\t},\n\n\t/*\n\t**\tSets a layer at the specified index.\n\t*/\n\tset: function (index, layer)\n\t{\n\t\tif (index < 0) return;\n\n\t\tif (!layer.isInstanceOf(Container))\n\t\t\tthrow new Error('Scene: Unable to set layer at index ' + index + ': argument is not a Container.');\n\n\t\tthis.layers[index] = layer;\n\t\treturn layer;\n\t},\n\n\t/*\n\t**\tReturns the layer at the specified index.\n\t*/\n\tget: function (index)\n\t{\n\t\treturn index < 0 || index >= this.layers.length ? null : this.layers[index];\n\t},\n\n\t/*\n\t**\tSets a viewport at the specified index.\n\t*/\n\tsetViewport: function (index, viewport)\n\t{\n\t\tif (index < 0) return;\n\n\t\tif (!viewport.isInstanceOf(Viewport))\n\t\t\tthrow new Error('Scene: Unable to set viewport at index ' + index + ': argument is not a Viewport.');\n\n\t\tthis.viewports[index] = viewport;\n\t\treturn viewport;\n\t},\n\n\t/*\n\t**\tReturns the viewport at the specified index.\n\t*/\n\tgetViewport: function (index)\n\t{\n\t\treturn index < 0 || index >= this.viewports.length ? null : this.viewports[index];\n\t},\n\n\t/*\n\t**\tDraws the layers in order.\n\t*/\n\telementDraw: function (g)\n\t{\n\t\tif (!this.viewports.length)\n\t\t{\n\t\t\tthis._sceneDraw(g, null);\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let viewportIndex = 0; viewportIndex < this.viewports.length; viewportIndex++)\n\t\t{\n\t\t\tlet viewport = this.viewports[viewportIndex];\n\t\t\tif (!viewport || !viewport.isEnabled()) continue;\n\n\t\t\tg.pushClip();\n\n\t\t\tlet area = viewport.getScreenBounds();\n\t\t\tg.clip(area.x1, area.y1, area.width()+1, area.height()+1);\n\n\t\t\tg.pushMatrix();\n\n\t\t\tviewport.applyTransform(g);\n\n// VIOLET : REMOVE THIS {\n/*area = viewport.getFocusBounds();\ng.beginPath();\ng.moveTo(area.x1, area.y1);\ng.lineTo(area.x2, area.y1);\ng.lineTo(area.x2, area.y2);\ng.lineTo(area.x1, area.y2);\ng.closePath();\ng.stroke('red');*/\n// }\n\t\t\tthis.viewportBounds.set(viewport.getBounds()).resizeBy(1, 1);\n\t\t\tthis._sceneDraw(g, this.viewportBounds);\n\n\t\t\tg.popMatrix();\n\t\t\tg.popClip();\n\t\t}\n\t},\n\n\t/*\n\t**\tActually draws the layers in the specified canvas.\n\t*/\n\t_sceneDraw: function (g, viewportBounds)\n\t{\n\t\ttry\n\t\t{\n\t\t\tfor (let i = 0; i < this.layers.length; i++)\n\t\t\t{\n\t\t\t\tif (!this.layers[i])\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis.layers[i].setViewportBounds(viewportBounds);\n\t\t\t\tthis.layers[i].draw(g);\n\t\t\t}\n\t\t}\n\t\tcatch (e) {\n\t\t\tif (e.message != \"SYS::FRAME_END\") {\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\t},\n\n\t/*\n\t**\tUpdates the viewports and layers.\n\t*/\n\telementUpdate: function (dt)\n\t{\n\t\ttry\n\t\t{\n\t\t\tfor (let i = 0; i < this.layers.length; i++)\n\t\t\t{\n\t\t\t\tif (!this.layers[i])\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis.layers[i].update(dt);\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < this.viewports.length; i++)\n\t\t\t{\n\t\t\t\tif (!this.viewports[i])\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis.viewports[i].update(dt);\n\t\t\t}\n\t\t}\n\t\tcatch (e) {\n\t\t\tif (e.message != \"SYS::FRAME_END\")\n\t\t\t\tthrow e;\n\t\t}\n\t}\n});\n\n/*\n**\tSome layer index constants for consistency.\n*/\n\nScene.LAYER_BACK0 \t\t= 0;\nScene.LAYER_BACK1 \t\t= 1;\nScene.LAYER_MAIN0 \t\t= 2;\nScene.LAYER_MAIN1 \t\t= 3;\nScene.LAYER_FRONT0 \t\t= 4;\nScene.LAYER_FRONT1 \t\t= 5;\nScene.LAYER_UI0 \t\t= 6;\nScene.LAYER_UI1 \t\t= 7;\nScene.LAYER_COLLISIONS\t= 8;\n\nexport default Scene;\n","/*\n**\tflow/group.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Element from './element.js';\n\n/*\n**\tGroups one or more elements into a single one.\n*/\n\nexport default Element.extend\n({\n\tclassName: 'Group',\n\n\tdebugHitbox: false,\n\thighlight: false,\n\n\t/*\n\t**\tArray of children related to the group.\n\t*/\n\tchildren: null,\n\n\t// violet: remove??\n\tundisposable: false,\n\n\t/*\n\t**\tConstructs an empty group element.\n\t*/\n\t__ctor: function (x, y, width=1, height=1)\n\t{\n\t\tthis._super.Element.__ctor(x, y, width, height);\n\t},\n\n\t/*\n\t**\tDestroys the group, all children and related elements.\n\t*/\n\t__dtor: function()\n\t{\n\t\tif (this.undisposable)\n\t\t\treturn;\n\n\t\tthis._super.Element.__dtor();\n\n\t\tif (this.children != null)\n\t\t{\n\t\t\tlet tmp = this.children;\n\t\t\tthis.children = null;\n\t\t\ttmp.forEach(i => dispose(i));\n\t\t}\n\t},\n\n\t/*\n\t**\tResets the animation object of the element.\n\t*/\n\tresetAnim: function (anim=null)\n\t{\n\t\tthis._super.Element.resetAnim(anim);\n\n\t\tif (this.children != null)\n\t\t\tthis.children.forEach(i => i.resetAnim());\n\t},\n\n\t/*\n\t**\tAdds a child element to the group.\n\t*/\n\taddChild: function (elem)\n\t{\n\t\tif (!elem) return elem;\n\n\t\tif (this.children == null)\n\t\t\tthis.children = [];\n\n\t\tthis.children.push (elem);\n\t\telem.setParent(this);\n\n\t\treturn elem;\n\t},\n\n\t/*\n\t**\tRemoves a child element from the group.\n\t*/\n\tremoveChild: function (elem)\n\t{\n\t\tif (elem == null || elem.parent !== this || this.children == null)\n\t\t\treturn elem;\n\n\t\tlet i = this.children.indexOf(elem);\n\t\tif (i === -1) return elem;\n\n\t\tthis.children.splice(i, 1);\n\t\telem.setParent(null);\n\n\t\treturn elem;\n\t},\n\n\t/*\n\t**\tUpdates the position of the element in the container.\n\t*/\n\tupdatePosition: function()\n\t{\n\t\tthis._super.Element.updatePosition();\n\n\t\tif (this.children != null)\n\t\t\tthis.children.forEach(elem => elem.updatePosition());\n\t},\n\n\t/*\n\t**\tUpdates the element's transformation matrix.\n\t*/\n\tupdateTransform: function(immediate=false)\n\t{\n\t\tthis._super.Element.updateTransform(immediate);\n\n\t\tif (this.children != null)\n\t\t\tthis.children.forEach(elem => elem.updateTransform(immediate));\n\t}\n});\n","/*\n**\tflow/keyboard-handler\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport PriorityQueue from '../utils/priority-queue.js';\nimport Boot from './boot.js';\nimport System from '../system/system.js';\n\n/**\n**\n*/\n\nexport default Boot.Module.create\n({\n\thandlers: null,\n\n\t__ctor: function ()\n\t{\n\t\tthis._super.Module.__ctor();\n\n\t\tthis.handlers = new PriorityQueue();\n\t},\n\n\tregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.add(handler);\n\n\t\t\tif ('init' in handler)\n\t\t\t\thandler.init();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"KeyboardHandler (register): \" + e.message);\n\t\t}\n\n\t\treturn handler;\n\t},\n\n\tunregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.remove(handler);\n\t\t\tthis.handlers.cleanup();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"KeyboardHandler (unregister): \" + e.message);\n\t\t}\n\t},\n\n\tonStartup: function()\n\t{\n\t\tSystem.onKeyboardEvent = (action, keyCode, keyState) =>\n\t\t{\n\t\t\tconst breakError = { };\n\n\t\t\ttry {\n\t\t\t\tthis.handlers.forEach((h) =>\n\t\t\t\t{\n\t\t\t\t\tif (h.onKeyboardEvent(action, keyCode, keyState) === false)\n\t\t\t\t\t\tthrow breakError;\n\t\t\t\t});\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tif (e !== breakError) throw e;\n\t\t\t}\n\t\t};\n\t},\n\n\tonShutdown: function()\n\t{\n\t\tSystem.onKeyboardEvent = null;\n\t}\n});\n","/*\n**\tflow/pointer-handler\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport PriorityQueue from '../utils/priority-queue.js';\nimport Boot from './boot.js';\nimport System from '../system/system.js';\n\n/**\n**\n*/\n\nexport default Boot.Module.create\n({\n\thandlers: null,\n\n\t__ctor: function ()\n\t{\n\t\tthis._super.Module.__ctor();\n\n\t\tthis.handlers = new PriorityQueue();\n\t},\n\n\tregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.add(handler);\n\n\t\t\tif ('init' in handler)\n\t\t\t\thandler.init();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"PointerHandler (register): \" + e.message);\n\t\t}\n\n\t\treturn handler;\n\t},\n\n\tunregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.remove(handler);\n\t\t\tthis.handlers.cleanup();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"PointerHandler (unregister): \" + e.message);\n\t\t}\n\t},\n\n\tonStartup: function()\n\t{\n\t\tSystem.onPointerEvent = (action, p, pointers) =>\n\t\t{\n\t\t\tconst breakError = { };\n\n\t\t\ttry {\n\t\t\t\tthis.handlers.forEach((h) =>\n\t\t\t\t{\n\t\t\t\t\tif (h.onPointerEvent(action, p, pointers) === false)\n\t\t\t\t\t\tthrow breakError;\n\t\t\t\t});\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tif (e !== breakError) throw e;\n\t\t\t}\n\t\t};\n\t},\n\n\tonShutdown: function()\n\t{\n\t\tSystem.onPointerEvent = null;\n\t}\n});\n","/*\n**\tflow/screen-controls\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport KeyboardHandler from './keyboard-handler.js';\nimport PointerHandler from './pointer-handler.js';\nimport System from '../system/system.js';\n\n/**\n**\n*/\n\nconst ScreenControls =\n({\n\tpriority: 5,\n\n\tlist: [ ],\n\n\thoverEnabled: false,\n\tzindexEnabled: false,\n\tlastFrame: 0,\n\n\t/*\n\t**\tAdds an item to the ScreenControls control list. The item should be an object with the following mandatory methods:\n\t**\n\t**\t\tbool containsPoint (float pointerX, float pointerY)\n\t**\t\tvoid pointerActivate (Object pointer)\n\t**\t\tvoid pointerDeactivate (Object pointer)\n\t**\t\tvoid pointerUpdate (float pointerX, float pointerY, Object pointer)\n\t**\t\tvoid hover (bool status, Object pointer)\n\t**\t\tbool focusLock\n\t*/\n\tadd: function (c)\n\t{\n\t\tif (this.zindexEnabled && !('zindex' in c))\n\t\t\tc.zindex = 0;\n\n\t\tif (this.list.indexOf(c) === -1)\n\t\t\tthis.list.push(c);\n\t},\n\n\tremove: function (c)\n\t{\n\t\tvar i = this.list.indexOf(c);\n\t\tif (i !== -1) this.list.splice(i, 1);\n\t},\n\n\tsetHoverEnabled: function (value)\n\t{\n\t\tthis.hoverEnabled = value;\n\t},\n\n\tsetZIndexEnabled: function (value)\n\t{\n\t\tthis.zindexEnabled = value;\n\t},\n\n\tfindTarget: function (x, y, filter)\n\t{\n\t\tif (this.zindexEnabled && this.lastFrame != System.frameNumber)\n\t\t{\n\t\t\tlet zindex = this.list[0].zindex;\n\n\t\t\tfor (let item of this.list)\n\t\t\t{\n\t\t\t\tif (item.zindex > zindex)\n\t\t\t\t{\n\t\t\t\t\tthis.list = this.list.sort((a,b) => b.zindex - a.zindex);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tzindex = item.zindex;\n\t\t\t}\n\n\t\t\tthis.lastFrame = System.frameNumber;\n\t\t}\n\n\t\tfor (let i in this.list)\n\t\t{\n\t\t\tif (!this.list[i]) continue;\n\n\t\t\tif (this.list[i] instanceof Array)\n\t\t\t{\n\t\t\t\talert('SHOULDN BE SUPPORTED');\n\t\t\t\tfor (let j = 0; j < this.list[i].length; j++)\n\t\t\t\t{\n\t\t\t\t\tif (filter != null && filter(this.list[i][j]) == false)\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tif (this.list[i][j].containsPoint(x, y))\n\t\t\t\t\t\treturn this.list[i][j];\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (filter != null && filter(this.list[i]) == false)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (this.list[i].containsPoint(x, y))\n\t\t\t\t\treturn this.list[i];\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t},\n\n\tonPointerEvent: function (action, p, pointers)\n\t{\n\t\tlet _continue = true;\n\t\tlet tmp = null;\n\n\t\tswitch (action)\n\t\t{\n\t\t\tcase System.EVT_POINTER_DOWN:\n\n\t\t\t\tif (p._ref != null)\n\t\t\t\t{\n\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\ttmp.pointerDeactivate(p);\n\t\t\t\t}\n\n\t\t\t\ttmp = this.findTarget(p.x, p.y);\n\t\t\t\tif (tmp != null)\n\t\t\t\t{\n\t\t\t\t\t(p._ref = tmp).pointerActivate(p);\n\t\t\t\t\t_continue = false;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.EVT_POINTER_DRAG_START:\n\t\t\t\tif (p._ref != null) _continue = false;\n\t\t\t\tbreak;\n\n\t\t\tcase System.EVT_POINTER_DRAG_MOVE:\n\t\t\t\tif (this.hoverEnabled)\n\t\t\t\t{\n\t\t\t\t\tif (p._refh != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (p._refh.containsPoint(p.x, p.y))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp = p._refh; p._refh = null;\n\t\t\t\t\t\t\ttmp.hover(false, p);\n\t\t\n\t\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, i => 'hover' in i);\n\t\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, i => 'hover' in i);\n\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (p._ref != null)\n\t\t\t\t{\n\t\t\t\t\tif (p._ref.containsPoint(p.x, p.y) || p._ref.focusLock == true)\n\t\t\t\t\t{\n\t\t\t\t\t\tp._ref.pointerUpdate (p.x, p.y, p);\n\t\t\t\t\t\t_continue = false;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\t\ttmp.pointerDeactivate(p);\n\t\n\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y);\n\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t(p._ref = tmp).pointerActivate(p);\n\t\t\t\t\t\t\t_continue = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttmp = this.findTarget(p.x, p.y);\n\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t{\n\t\t\t\t\t\t(p._ref = tmp).pointerActivate(p);\n\t\t\t\t\t\t_continue = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.EVT_POINTER_MOVE:\n\t\t\t\tif (this.hoverEnabled)\n\t\t\t\t{\n\t\t\t\t\tif (p._refh != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (p._refh.containsPoint(p.x, p.y))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp = p._refh; p._refh = null;\n\t\t\t\t\t\t\ttmp.hover(false, p);\n\t\t\n\t\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, i => 'hover' in i);\n\t\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, i => 'hover' in i);\n\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (p._ref == null) break;\n\n\t\t\t\tif (p._ref.containsPoint(p.x, p.y) || p._ref.focusLock == true)\n\t\t\t\t{\n\t\t\t\t\tp._ref.pointerUpdate (p.x, p.y, p);\n\t\t\t\t\t_continue = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\ttmp.pointerDeactivate(p);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.EVT_POINTER_DRAG_STOP:\n\t\t\t\tif (p._ref != null) _continue = false;\n\t\t\t\tbreak;\n\n\t\t\tcase System.EVT_POINTER_UP:\n\t\t\t\tif (p._ref != null)\n\t\t\t\t{\n\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\ttmp.pointerDeactivate(p);\n\n\t\t\t\t\t_continue = false;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn _continue;\n\t},\n\n\tonKeyboardEvent: function (action, keyCode, keyArgs)\n\t{\n\t\tswitch (action)\n\t\t{\n\t\t\tcase System.EVT_KEY_DOWN:\n\n\t\t\t\tfor (var i in this.list)\n\t\t\t\t{\n\t\t\t\t\tif (!this.list[i]) continue;\n\n\t\t\t\t\tif (this.list[i] instanceof Array)\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (var j = 0; j < this.list[i].length; j++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.list[i][j].keyCode == keyCode)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.list[i][j].pointerActivate({ });\n\t\t\t\t\t\t\t\tj = -1;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (j == -1) break;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.list[i].keyCode == keyCode)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.list[i].pointerActivate({ });\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.EVT_KEY_UP:\n\n\t\t\t\tfor (var i in this.list)\n\t\t\t\t{\n\t\t\t\t\tif (!this.list[i]) continue;\n\n\t\t\t\t\tif (this.list[i] instanceof Array)\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (var j = 0; j < this.list[i].length; j++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.list[i][j].keyCode == keyCode)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.list[i][j].pointerDeactivate({ });\n\t\t\t\t\t\t\t\tj = -1;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (j == -1) break;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.list[i].keyCode == keyCode)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.list[i].pointerDeactivate({ });\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\n\t\t\t\tbreak;\n\t\t}\n\t}\n});\n\nPointerHandler.register(ScreenControls);\nKeyboardHandler.register(ScreenControls);\n\nexport default ScreenControls;\n","/*\n**\tflow/button\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Group from './group.js';\nimport Element from './element.js';\nimport ScreenControls from './screen-controls.js';\n\n/**\n**\tButton class provides an easy way to add push-button support to the world.\n*/\n\nexport default Group.extend\n({\n\t/**\n\t**\tIndicates if once focus is obtained it is locked until the user releases it.\n\t*/\n\tfocusLock: false,\n\n\t/**\n\t**\tCurrent and last status of the button (0 for unpressed, 1 for pressed).\n\t*/\n\tstatus: 0, lstatus: 0,\n\n\t/**\n\t**\tImages for the unpressed and pressed statuses.\n\t*/\n\tunpressedImg: null,\n\tpressedImg: null,\n\n\t/*\n\t**\tIndicates if the button should trigger a key press for this key code.\n\t*/\n\tkeyCode: 0,\n\n\t/*\n\t**\tHitbox element.\n\t*/\n\tmask: 0,\n\n\t/**\n\t**\tCreates the button with the specified parameters. Automatically adds it to the screen controls.\n\t*/\n\t__ctor: function (x, y, unpressedImg, pressedImg=null, relativeToCenter=true)\n\t{\n\t\tthis._super.Group.__ctor(x, y, unpressedImg.width, unpressedImg.height);\n\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg || unpressedImg;\n\n\t\tthis.mask = new Element(0, 0, this.width, this.height);\n\t\tthis.addChild(this.mask);\n\n\t\tScreenControls.add(this);\n\t},\n\n\t/*\n\t**\tRemoves the button from the screen controls and destroys it.\n\t*/\n\t__dtor: function ()\n\t{\n\t\tthis._super.Group.__dtor();\n\t\tScreenControls.remove(this);\n\t},\n\n\t/*\n\t**\tExecuted when the item is added to a container.\n\t*/\n\tonAttached: function (container)\n\t{\n\t\tcontainer.add(this.mask);\n\t},\n\n\t/*\n\t**\tExecuted when the item is removed from a container.\n\t*/\n\tonDetached: function (container)\n\t{\n\t\t// VIOLET: container should set the 'container' property to null\n\t\tcontainer.remove(this.mask);\n\t\tthis.mask.container = null;\n\t},\n\n\t/*\n\t**\tChanges the pressed/unpressed images of the button.\n\t*/\n\tsetImage: function (unpressedImg, pressedImg=null)\n\t{\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg || unpressedImg;\n\t},\n\n\t/**\n\t**\tResets the button to its initial state.\n\t*/\n\treset: function ()\n\t{\n\t\tthis.status = this.lstatus = 0;\n\t\tthis.onChange (this.status, this.lstatus);\n\t},\n\n\t/**\n\t**\tDraws the element on the given graphics surface.\n\t*/\n\telementDraw: function (g)\n\t{\n\t\tif (this.status)\n\t\t\tthis.pressedImg.draw (g, 0, 0);\n\t\telse\n\t\t\tthis.unpressedImg.draw (g, 0, 0);\n\t},\n\n\t/**\n\t**\tButton pointer update event. Not required for the button control.\n\t*/\n\tpointerUpdate: function (pointerX, pointerY)\n\t{\n\t},\n\n\t/**\n\t**\tCalled when the EVT_POINTER_DOWN event starts within the bounding box of the button.\n\t*/\n\tpointerActivate: function (pointer)\n\t{\n\t\tthis.lstatus = this.status;\n\t\tthis.status = 1;\n\n\t\tthis.onChange (this.status, this.lstatus);\n\t},\n\n\t/**\n\t**\tCalled when the EVT_POINTER_UP event is fired with the \"_ref\" attribute pointing to this object.\n\t*/\n\tpointerDeactivate: function (pointer)\n\t{\n\t\tthis.lstatus = this.status;\n\t\tthis.status = 0;\n\n\t\tthis.onChange (this.status, this.lstatus);\n\t},\n\n\t/**\n\t**\tReturns true if the button contains the specified point.\n\t*/\n\tcontainsPoint: function(x, y)\n\t{\n\t\tif (!this.active() || !this.visible())\n\t\t\treturn false;\n\n\t\treturn this.mask.bounds.containsPoint(x, y);\n\t},\n\n\t/**\n\t**\tExecuted after any change in the status of the button. Be careful when overriding this, because when so, the onTap method will not work.\n\t*/\n\tonChange: function (status, lstatus) /* @override */\n\t{\n\t\tif (status != lstatus)\n\t\t{\n\t\t\tif (status)\n\t\t\t\tthis.onButtonDown();\n\t\t\telse\n\t\t\t\tthis.onButtonUp();\n\t\t}\n\n\t\tif (status == 0 && lstatus == 1) this.onTap();\n\t},\n\n\t/**\n\t**\tExecuted when the button is pressed. Works only if the onChange method was not overriden.\n\t*/\n\tonButtonDown: function () /* @override */\n\t{\n\t},\n\n\t/**\n\t**\tExecuted when the button is released. Works only if the onChange method was not overriden.\n\t*/\n\tonButtonUp: function () /* @override */\n\t{\n\t},\n\n\t/**\n\t**\tExecuted when the button is tapped (pressed and then released). Works only if the onChange method was not overriden.\n\t*/\n\tonTap: function () /* @override */\n\t{\n\t}\n});\n","/*\n**\tfroxel\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n// system\nimport _G from './system/globals.js'; export const G = _G;\nimport _C from './system/config.js'; export const C = _C;\nimport _System from './system/system.js'; export const System = _System;\nimport _Timer from './system/timer.js'; export const Timer = _Timer;\nimport _KeyCodes from './system/keycodes.js'; export const KeyCodes = _KeyCodes;\nimport _Canvas from './system/canvas.js'; export const Canvas = _Canvas;\nimport _Perf from './system/perf.js'; export const Perf = _Perf;\nimport _Log from './system/log.js'; export const Log = _Log;\nimport _IDrawable from './system/idrawable.js'; export const IDrawable = _IDrawable;\nimport _IUpdateable from './system/iupdateable.js'; export const IUpdateable = _IUpdateable;\n\n// resources\nimport * as _Wrappers from './resources/wrappers.js'; export const Wrappers = _Wrappers;\nimport _Resources from './resources/resources.js'; export const Resources = _Resources;\n\n// utils\nimport _Recycler from './utils/recycler.js'; export const Recycler = _Recycler;\nimport _Linkable from './utils/linkable.js'; export const Linkable = _Linkable;\nimport _List from './utils/list.js'; export const List = _List;\nimport _PriorityQueue from './utils/priority-queue.js'; export const PriorityQueue = _PriorityQueue;\n\n// math\nimport _Matrix from './math/matrix.js'; export const Matrix = _Matrix;\nimport _Rect from './math/rect.js'; export const Rect = _Rect;\nimport _Vec2 from './math/vec2.js'; export const Vec2 = _Vec2;\nimport _TFunction from './math/tfunction.js'; export const TFunction = _TFunction;\n\n// anim\nimport _Easing from './anim/easing.js'; export const Easing = _Easing;\nimport _Anim from './anim/anim.js'; export const Anim = _Anim;\n\n// spatial\nimport _QuadTreeItem from './spatial/quadtree-item.js'; export const QuadTreeItem = _QuadTreeItem;\nimport _QuadTreeNode from './spatial/quadtree-node.js'; export const QuadTreeNode = _QuadTreeNode;\nimport _QuadTree from './spatial/quadtree.js'; export const QuadTree = _QuadTree;\n\n// flow\nimport _Boot from './flow/boot.js'; export const Boot = _Boot;\n\nimport _Element from './flow/element.js'; export const Element = _Element;\nimport _Container from './flow/container.js'; export const Container = _Container;\nimport _Scene from './flow/scene.js'; export const Scene = _Scene;\nimport _Group from './flow/group.js'; export const Group = _Group;\nimport _Viewport from './flow/viewport.js'; export const Viewport = _Viewport;\n\nimport _KeyboardHandler from './flow/keyboard-handler'; export const KeyboardHandler = _KeyboardHandler;\nimport _PointerHandler from './flow/pointer-handler'; export const PointerHandler = _PointerHandler;\nimport _ScreenControls from './flow/screen-controls'; export const ScreenControls = _ScreenControls;\nimport _Button from './flow/button'; export const Button = _Button;\n\n\n/*\nimport _DisplayElement from './display-element.js';\nimport _Viewport from './viewport.js';\nimport _World from './world.js';\nimport _Controls from './controls.js';\n*/\n","/*\n**\t_export\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport * as _froxel from './main';\nexport default froxel = _froxel;\n"],"names":["$parcel$global","globalThis","self","window","global","$parcel$export","e","n","v","Object","defineProperty","get","enumerable","FPS","ANTIALIAS","BACKGROUND","ORIENTATION","WIDTH","HEIGHT","ORIGINAL_TILE_SIZE","TILE_SIZE","BOARD_WIDTH","BOARD_HEIGHT","SCALE","init","this","area","viewport","debugHitbox","debugBounds","debugImage","px","value","dispose","obj","reason","__dtor","audioContext","AudioContext","fetchd","url","options","Promise","resolve","reject","responseType","request","XMLHttpRequest","i","open","onload","response","onerror","send","fetchAudioBuffer","then","arrayBuffer","decodeAudioData","audioBuffer","catch","err","int","bool","float","parseFloat","float2","float3","float4","rad","Math","PI","rand","random","randf","randrf","a","b","t","randr","randtf","list","push","hrnow","performance","now","randvar","randitem","arr","length","getLineSegmentIntersection","ls1_x1","ls1_y1","ls1_x2","ls1_y2","ls2_x1","ls2_y1","ls2_x2","ls2_y2","dyA","dxA","dyB","dxB","x1","max","min","y1","tA","tB","lineSegmentIntersects","rotatePoint","angle","x","y","Rin","typeOf","cos","sin","stepValue","minValue","maxValue","numSteps","round","alignValue","step","BACKSPACE","TAB","ENTER","ESC","SPACE","PGUP","PGDN","END","HOME","INS","DEL","LEFT","UP","RIGHT","DOWN","NUM_PLUS","NUM_MINUS","NUM_ASTERISK","NUM_SLASH","NUM_DOT","NUM_0","NUM_1","NUM_2","NUM_3","NUM_4","NUM_5","NUM_6","NUM_7","NUM_8","NUM_9","D0","D1","D2","D3","D4","D5","D6","D7","D8","D9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","$b43e5b05f717ffe6e1b7300e19f71d1d$var$Rin","invokeLater","fn","setTimeout","wait","millis","o","Array","toString","toLowerCase","isArrayOrObject","clone","elem","merge","output","objs","j","field","override","partialCompare","full","partial","arrayFind","getObject","indexOf","container","forceArray","escape","str","replace","ensureTypeOf","m","isInstanceOf","prototype","className","isTypeOf","serialize","JSON","stringify","deserialize","s","parse","hookAppend","object","functionName","newFunction","conditional","oldFunction","args","apply","unhook","hookPrepend","$3cfc71de303eee1e948c94eb1134db65$var$Rin","$052b1f411531cbbe26727ba52a77541d$var$Class","_class","_super","__ctor","constructor","_initSuperRefs","_newSuper","_prot","bind","inherit","proto","test","_extend","base","protos","call","Class","classInit","extend","create","source","name","_async","next","ret","original","eventName","eventArgs","cbHandler","cbContext","reset","setSource","resume","silent","handler","context","data","from","event","enqueue","evt","Event","$ac7815888bc07ce55b0b361d50cb4c1f$var$Event","listeners","namespace","setNamespace","addEventListener","split","ns","removeEventListener","k","splice","prepareEvent","concat","silence","dispatchEvent","EventDispatcher","$f7d6a4f9a6064b55c0764ec34b3dfdc2$var$_Model","defaults","constraints","changedList","_silent","_level","def","undefined","set","arguments","update","ready","nsilent","$b43e5b05f717ffe6e1b7300e19f71d1d$exports","_validate","nvalue","ctname","Constraints","message","Error","_set","constraint","_propertyEvent","prev","direct","temp","old","level","force","fields","has","flatten","getInt","parseInt","getFloat","getBool","getReference","safe","rsafe","classPath","isCompliant","keys","ct","model","arrayof","cls","remove","validate","observe","property","unobserve","email","urlNoProt","uname","text","utext","Regex","module","exports","_getref","substr","eval","type","ctval","isNaN","mclass","ensure","arraynull","arraycompliant","required","minlen","maxlen","minval","maxval","mincount","maxcount","pattern","inset","RegExp","join","upper","toUpperCase","lower","Model","$ef5243bc6525c4841b6d2e0bc35372bb$var$Model","itemt","contents","itemId","nextId","_eventGroup","Date","_bind","iid","item","_onItemEvent","_unbind","id","clear","setData","getData","getAt","index","removeAt","setAt","updateAt","position","pop","unshift","shift","find","retObject","ModelList","$a69a2b3513a81e23bda58982208b78a8$var$Schema","Type","tmp","unflatten","String","Integer","Number","precision","_precision","_round","pow","Bool","compact","_compact","SharedString","strings_map","strings","itemType","_debug","debug","of","async","properties","defvalue","symbolic","classConstructor","_constructor","Property","is","Map","Schema","typeSchema","assign","onUnflattened","Flattenable","itemTypeSchema","items","add","onItemRemoved","sort","desc","findItem","inc","exc","getItems","isEmpty","relative","first","last","addAt","onBeforeItemAdded","onItemAdded","forEach","callback","forEachCall","method","forEachRev","forEachRevCall","Collection","$dba38e8a4d857a03d92455990d19777e$var$Template","strict","parseTemplate","template","sym_open","sym_close","is_tpl","root","nflush","flush","state","count","parts","mparts","nparts","emit","trim","map","match","unescape","r","clean","expand","mode","quote","functions","failed","f","compile","register","getNamedValues","expanded","key","startsWith","endsWith","null","true","false","len","chr","fromCharCode","ord","charCodeAt","not","neg","abs","and","or","eq","ne","lt","le","gt","ge","isnotnull","isnull","iszero","eq?","ne?","lt?","le?","gt?","ge?","notnull?","null?","zero?","typeof","*","/","+","-","mul","div","sum","sub","mod","json","ref","_unset","start","nl2br","%","%%","attr","values","_each","var_name","_foreach","_?","_??","_if","_switch","case_value","_break","_continue","_repeat","to","tpl","_for","_loop","_echo","console","log","_#","_##","_&","_&&","contains","_map","arrayMode","_filter","_call","Template","$194ff00ff419b7d5d0c9f54e529ee18f$var$recyclingFacilities","$194ff00ff419b7d5d0c9f54e529ee18f$export$default","_maxPoolSize","recyclerPool","objectId","nextObjectId","createdItems","restoredItems","recycledItems","alloc","__reinit","free","disposeReason","error","group","c","groupEnd","$de63c6cea9e937c787e6669e8b7367fa$export$default","linkAfter","linkBefore","unlink","attachTo","top","bottom","nextItem","getNodeAt","sgetNode","insertBefore","insertAfter","append","ni","filter","$c7fc636a51ef24ec0ac87c4b46f79252$export$default","interval","onTimeout","isRunning","rTime","startTime","tError","sTime","runAfter","tDelta","lTime","onStart","immediate","scale","lastTime","timeout","requestAnimationFrame","stop","$cfdf07c9c794ed7dda1152f9ad0dc88d$export$default","zero","fill","abort","identity","scalef","matr","translate","rotate","sx","sy","applyTo","transpose","det","adj","d","inverse","$c095d3677e4919554f005bfd818e9d8b$export$default","enabled","maxsize","debugEcho","color","background","vars","write","msg","enable","fontSize","showFps","showIndex","_y","drawQueueAdd","draw","g","font","textBaseline","_time","perf","_frames","numFrames","toFixed","$a742bfd07457dd01c7b3c95bc090b0ee$export$default","updateTime","drawTime","fillStyle","fillRect","measureText","fillText","$18f02cd3c01ba82b0ae213a40b3411fa$export$default","opts","gl","width","height","hidden","absolute","antialias","document","createElement","$3cfc71de303eee1e948c94eb1134db65$exports","passThruCanvas","body","appendChild","style","left","getContext","getParameter","VERSION","SHADING_LANGUAGE_VERSION","initGl","setBackground","matrixStack","alphaStack","transform","_alpha","_globalScale","updateTransform","strokeStyle","resize","parentNode","imageSmoothingEnabled","renderingContext","pushClip","popClip","setTransform","toDataURL","mime","params","beginPath","moveTo","closePath","lineTo","rect","w","h","stroke","strokeRect","clip","quadraticCurveTo","cpx","cpy","bezierCurveTo","cx1","cy1","cx2","cy2","arc","sA","eA","cw","arcTo","x2","y2","maxWidth","strokeText","createImageData","getImageData","putImageData","drawImage","getBoundingClientRect","buildShader","program","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","attachShader","gl_array_buffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","gl_program","createProgram","VERTEX_SHADER","FRAGMENT_SHADER","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","useProgram","clearColor","disable","DEPTH_TEST","clearDepth","depthFunc","GEQUAL","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","gl_attrib_location","getAttribLocation","gl_uniform_screen_size","getUniformLocation","gl_uniform_texture_size","gl_uniform_texture","gl_uniform_matrix","gl_uniform_current_matrix","gl_uniform_texture_matrix","enableVertexAttribArray","vertexAttribPointer","FLOAT","FALSE","BYTES_PER_ELEMENT","location_matrix","texture_matrix","img","gl_ready","gl_active_texture","gl_texture","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","uniform1i","uniform2fv","uniformMatrix3fv","drawArrays","TRIANGLE_STRIP","sw","sh","dx","dy","dw","dh","prepareImage","image","texture","createTexture","texImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","applyConfig","imageRendering","removeChild","canvasColor","backgroundColor","_width","_height","SCISSOR_TEST","scissor","globalScale","loadIdentity","flipped","isFlipped","save","restore","toDataUrl","toPng64","_contextAttribute","lineCap","lineJoin","lineWidth","miterLimit","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","textAlign","globalAlpha","alpha","globalCompositeOperation","ceil","clearRect","a3","a4","a7","a8","DEPTH_BUFFER_BIT","COLOR_BUFFER_BIT","clearPath","pushMatrix","popMatrix","pushAlpha","popAlpha","loadMatrix","getMatrix","appendMatrix","useNative","ellipse","ox","oy","xe","ye","xm","ym","circle","line","enablePointerEvents","pointerHandler","pointerScale","pointerOffset","_","_evt","action","buttons","lbuttons","containedBy","pointerHandlers","code","rx","clientX","ry","clientY","dragging","ldx","ldy","ddx","ddy","onmousedown","onmouseup","onmousemove","setPointerScale","setPointerOffset","addPointerHandler","removePointerHandler","drawImageResource","renderImage","completed","Image","displayBuffer","src","flags","renderingEnabled","renderingPaused","EVT_KEY_DOWN","EVT_KEY_UP","EVT_POINTER_DOWN","EVT_POINTER_UP","EVT_POINTER_MOVE","EVT_POINTER_DRAG_START","EVT_POINTER_DRAG_MOVE","EVT_POINTER_DRAG_STOP","DEFAULT","LANDSCAPE","PORTRAIT","AUTOMATIC","defaultOptions","canvas","canvas2","fps","minFps","screenWidth","screenHeight","orientation","extraScaleFactor","fullscreen","offsX","offsY","devicePixelRatio","backingStoreRatio","canvasPixelRatio","canvasScaleFactor","scaleFactor","initialMatrix","displayBuffer2","tempDisplayBuffer","keyState","time","ctrl","alt","keyCode","pointerState","updateQueue","drawQueue","timeScale","frameInterval","fixedFrameInterval","maxFrameInterval","frameDelta","frameDeltaMillis","frameTime","frameTimeMillis","frameNumber","frameUpdateInProgress","frameDrawInProgress","numSamples","windowSize","snapStartTime","snapNumFrames","snapUpdateTime","snapDrawTime","onresize","onWindowResized","frameTimer","onFrame","pointerEvents","display0","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","_this","onkeydown","target","onKeyboardEvent","onkeyup","endTime","pointerConvX","reverseRender","pointerConvY","ontouchstart","preventDefault","touches","changedTouches","identifier","isActive","isDragging","button","p","onPointerEvent","ontouchend","deltaTime","ontouchcancel","ontouchmove","which","asSeconds","pause","resetPerf","delta","timer","stack","notRendering","_screenWidth","screen","_screenHeight","innerWidth","innerHeight","targetScreenWidth","targetScreenHeight","marginLeft","marginTop","integerScaleFactor","onCanvasResized","updateQueueAdd","updateQueueRemove","drawQueueRemove","queueAdd","queueRemove","dts","dtm","interpolate","dst","duration","easing","interpolator","dt","pointer","pointers","$0f0d574922f872efb1550e174d32a641$export$default","accumSize","expectedValue","stdSum","stdCount","begin","end","feed","report","returnString","avg","std","sqrt","out","getDrawable","$f54301229ec8e69146530a6a9ae01343$export$default","integerScaling","pixelated","load","completeCallback","keyList","__original","resName","ratio","owidth","oheight","hasOwnProperty","resizeImage","rscale","onLoaded","d0","dN","d1","lastIndexOf","_i","cb","track","plugins","NativeAudio","engine","ENGINE_NATIVEAUDIO","preloadSimple","ENGINE_WEBAUDIO","Audio","ENGINE_HTML5","oncanplaythrough","unload","wrapper","discardOriginal","rep_x","rep_y","sp","tw","th","flipImageHorz","showDownload","filename","dataUrl","link","href","display","download","click","showFilePicker","allowMultiple","accept","input","multiple","onchange","files","onfocus","loadAsDataURL","file","reader","FileReader","result","readAsDataURL","loadAsText","readAsText","loadAsArrayBuffer","readAsArrayBuffer","loadAllAsDataURL","fileList","loadNext","size","IDrawable","Placeholder","numCols","drawableCache","r_scale","v_scale","config","sheetWidth","frameWidth","frameHeight","r_frameWidth","r_frameHeight","numRows","drawFrame","frame","frameIndex","$ee0366d80cdf44b2e47ac4bfeefa88ae$export$Animation","seq","seq_i","trans","trans_i","trans_t","queue","frameMillis","finished","paused","finishedCallback","finishedCallbackChain","frameCallback","anim","setFps","setPaused","setInitialDelay","onFinished","thenCallback","setFrame","getFrame","normalized","getLength","loop","use","advance","getName","seqName","setQueue","lastName","Spritesheet","initialized","initialseq","getSequence","r_charWidth","charWidth","r_charHeight","charHeight","cols","charset","charTable","widths","w1","w2","measureWidth","measureHeight","drawText","drawTextAligned","ax","ay","drawTextAligned2","bounds","$268469c1d69cf3b64bdd8d23cf2d7870$export$default","play","volume","playLoop","MASTER","SFX","MUSIC","VOICE","MAX_POOL_SIZE","pool","active","node","registered","unregister","updateNode","cmd","snd","updateNode_webaudio","updateNode_nativeaudio","updateNode_audio","alloc_webaudio","gainNode","createGain","gain","connect","destination","res","createBufferSource","buffer","free_webaudio","disconnect","alloc_nativeaudio","free_nativeaudio","alloc_audio","cloneNode","_src","free_audio","playing","playTime","onended","onended_webaudio","currentTarget","onended_nativeaudio","onended_audio","currentTime","enableTrack","disableTrack","setVolume","createNode","startVolume","fadeOut","setInterval","clearInterval","fadeIn","sounds","lastIndex","getRandomSound","playAt","playLoopAt","$b8a6185dc55af5ed70d98d8aa128380b$export$Drawable","$b8a6185dc55af5ed70d98d8aa128380b$export$Placeholder","$b8a6185dc55af5ed70d98d8aa128380b$export$Spritesheet","$b8a6185dc55af5ed70d98d8aa128380b$export$SpritesheetAnimation","$b8a6185dc55af5ed70d98d8aa128380b$export$SpriteFont","$b8a6185dc55af5ed70d98d8aa128380b$export$Sound","$b8a6185dc55af5ed70d98d8aa128380b$export$SoundArray","order","priority","is_dirty","cleanup","q","is_complete","forEachAsync","next_j","next_i","forEachRevAsync","$8fa65cf901fc165da6bcf10c3f72ace4$export$default","cx","cy","Rect0","Rect2","Rect4","extendWithPoint2","extendWithPoint1","extendWithPoint","centerAt","set1","set4","equals","equals1","equals4","contains1","contains4","setAsUnion","setAsUnion1","setAsUnion4","intersects","intersects1","intersects4","_x1","_y1","_x2","_y2","setAsIntersection","setAsIntersection1","setAsIntersection4","topLeftRelative","resizeBy","ncx","ncy","isRight","containsPoint","tol","floor","$c2385143810f8e75c47d71adc54042b3$export$default","Vec2_0","Vec2_1","Vec2_2","isZero","inv","fx","fy","fract","dot","magnitude","normalize","majorAxis","minorAxis","sign","$c123abff45dabf5b99c28050b9b9f34c$export$default","copyFrom","t0","t1","i0","i1","x0","y0","integral","c0","accum","second_integral","a0","Temp1","integrate","Temp2","accumulate","chopLeft","chopRight","pad","char","$04fc9b95dfde5d6ead4d7c302935aa17$export$default","Linear","IN","OUT","IN_OUT","Back","Bounce","getConst","Circ","Cubic","Expo","Power","Quad","Quartic","Quintic","Sine","Step","$3bdc6dd248b1488ae784c33e2fc85d39$export$default","initialData","block","blockTime","initial","speed","getValue","fieldName","curr","_block","_index","_blockTime","op","started","blocks","indices","blockTimes","_count","_startValue","startValue","_endValue","endValue","cur","table","parallel","serial","repeat","restart","range","randt","exec","setX","setY","translateX","deltaValue","translateY","deltaValueX","deltaValueY","easingX","easingY","endValueX","endValueY","scaleX","scaleY","$f4488b82cac25c298ad52c19b6b3297c$var$quadTreeItemID","$f4488b82cac25c298ad52c19b6b3297c$export$default","selectedIndex","insertionBounds","lastBounds","hitbox","zindex","_visible","numRefNodes","tag","FLAG_INITIAL","setFlags","clearFlags","getFlags","setTag","getTag","setZIndex","getZIndex","notifyInserted","tree","FLAG_ATTACHED","getBounds","notifyRemoved","notifyPosition","getInsertionBounds","getLastBounds","getHitbox","FLAG_QUEUED","FLAG_SELECTED","FLAG_ALWAYS_SELECT","FLAG_NEVER_SELECT","FLAG_CHILD","FLAG_USERDEF","$3828746ff56712c29d2f8c7d665df234$export$default","extents","numItems","insertionPoint","subNode","isDirty","getExtents","isLeaf","getSubNodes","addItem","capacity","removeItem","selectItems","selectedCount","detectCollisions","forced","i_next","onFilterRequest","j_next","iId","jId","onCollision","$ea77d4127a4dcf9374b60fb8b7a620bb$export$default","orderedItems","nodeCapacity","isReverse","visible","xd","yd","zd","fnComparator","COMPARATOR_DEFAULT_YX","getRoot","setVisible","getVisible","setXd","setYd","setZd","getXd","getYd","getZd","setComparator","COMPARATOR_DEFAULT_XY","COMPARATOR_MANHATTAN","COMPARATOR_Y2","COMPARATOR_Y1","COMPARATOR_X2","COMPARATOR_X1","isBefore","addItemOrdered","reorderItems","updateItem","setReverse","getCountSelected","getNextSelected","releaseSelected","countItems","selectItemsIntoArray","$115658c46d646d39ac43cc89972e18ca$export$default","modules","MIN_FPS","startup","onStartup","shutdown","forEachAsyncRev","onShutdown","Module","_active","_topLeftRelative","parent","transformDirty","QuadTreeItem","_updateBounds","p0","p3","immediateTransformUpdate","updatePosition","setParent","getX","getY","inverseTransform","point","setAnim","resetAnim","addTo","syncPosition","setPosition","applyTransform","preDraw","postDraw","elementDraw","elementUpdate","onAttached","onDetached","reverseDraw","viewportBounds","Element","getTree","setViewportBounds","containerDraw","containerUpdate","centerRatioX","centerRatioY","worldX1","worldY1","worldX2","worldY2","focusFactorX","focusFactorY","focusRect","focusOffsX","focusOffsY","focusBounds","screenBounds","worldWidth","worldHeight","updateScreenBounds","updateBounds","isEnabled","setEnabled","setOffsets","setScale","setCenter","setScreenPosition","getPositionX","getPositionY","getWidth","getHeight","getScreenBounds","getFocusBounds","focusOn","j0","j1","kx","ky","nx","ny","setFocusRect","setFocusFactor","valueX","valueY","toWorldSpace","toScreenSpace","$3d3039fb0d4916b212bce5677b0e701f$export$default","layers","viewports","numLayers","layer","setViewport","getViewport","viewportIndex","_sceneDraw","LAYER_BACK0","LAYER_BACK1","LAYER_MAIN0","LAYER_MAIN1","LAYER_FRONT0","LAYER_FRONT1","LAYER_UI0","LAYER_UI1","LAYER_COLLISIONS","highlight","children","undisposable","addChild","handlers","breakError","$eb8cbe83e7ec6771b1a5726fc638ed47$export$default","hoverEnabled","zindexEnabled","lastFrame","setHoverEnabled","setZIndexEnabled","findTarget","alert","_ref","pointerDeactivate","pointerActivate","_refh","hover","focusLock","pointerUpdate","keyArgs","status","lstatus","unpressedImg","pressedImg","mask","relativeToCenter","Group","setImage","onChange","pointerX","pointerY","onButtonDown","onButtonUp","onTap","$7d34be8d463e2ca1db325c31f9195886$export$G","$7d34be8d463e2ca1db325c31f9195886$export$C","$7d34be8d463e2ca1db325c31f9195886$export$System","$7d34be8d463e2ca1db325c31f9195886$export$Timer","$7d34be8d463e2ca1db325c31f9195886$export$KeyCodes","$7d34be8d463e2ca1db325c31f9195886$export$Canvas","$7d34be8d463e2ca1db325c31f9195886$export$Perf","$7d34be8d463e2ca1db325c31f9195886$export$Log","$7d34be8d463e2ca1db325c31f9195886$export$IDrawable","$7d34be8d463e2ca1db325c31f9195886$export$IUpdateable","$7d34be8d463e2ca1db325c31f9195886$export$Wrappers","$7d34be8d463e2ca1db325c31f9195886$export$Resources","$7d34be8d463e2ca1db325c31f9195886$export$Recycler","$7d34be8d463e2ca1db325c31f9195886$export$Linkable","$7d34be8d463e2ca1db325c31f9195886$export$List","$7d34be8d463e2ca1db325c31f9195886$export$PriorityQueue","$7d34be8d463e2ca1db325c31f9195886$export$Matrix","$7d34be8d463e2ca1db325c31f9195886$export$Rect","$7d34be8d463e2ca1db325c31f9195886$export$Vec2","$7d34be8d463e2ca1db325c31f9195886$export$TFunction","$7d34be8d463e2ca1db325c31f9195886$export$Easing","$7d34be8d463e2ca1db325c31f9195886$export$Anim","$7d34be8d463e2ca1db325c31f9195886$export$QuadTreeItem","$7d34be8d463e2ca1db325c31f9195886$export$QuadTreeNode","$7d34be8d463e2ca1db325c31f9195886$export$QuadTree","$7d34be8d463e2ca1db325c31f9195886$export$Boot","$7d34be8d463e2ca1db325c31f9195886$export$Element","$7d34be8d463e2ca1db325c31f9195886$export$Container","$7d34be8d463e2ca1db325c31f9195886$export$Scene","$7d34be8d463e2ca1db325c31f9195886$export$Group","$7d34be8d463e2ca1db325c31f9195886$export$Viewport","$7d34be8d463e2ca1db325c31f9195886$export$KeyboardHandler","$7d34be8d463e2ca1db325c31f9195886$export$PointerHandler","$7d34be8d463e2ca1db325c31f9195886$export$ScreenControls","$7d34be8d463e2ca1db325c31f9195886$export$Button","froxel"],"version":3,"file":"froxel.js.map"}