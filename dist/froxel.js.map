{"mappings":"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","sources":["src/system/random.js","src/system/keycode.js","src/utils/recycler.js","src/utils/linkable.js","src/utils/list.js","src/system/timer.js","src/math/vec2.js","src/math/matrix.js","src/system/shader.js","src/system/shader-program.js","src/system/canvas.js","src/system/system.js","src/system/log.js","src/system/globals.js","src/system/perf.js","src/system/framebuffer.js","src/resources/resources.js","src/resources/drawable.js","src/resources/placeholder.js","src/resources/spritesheet.js","src/resources/spritesheet-animation.js","src/resources/spritefont.js","src/resources/sound.js","src/resources/sound-array.js","src/resources/wrappers.js","src/utils/priority-queue.js","src/utils/callback.js","src/utils/handler.js","src/math/rect.js","src/math/tfunction.js","src/math/point2.js","src/math/bounds2.js","src/anim/easing.js","src/anim/block.js","src/anim/command.js","src/anim/parallel.js","src/anim/serial.js","src/anim/repeat.js","src/anim/set.js","src/anim/restart.js","src/anim/wait.js","src/anim/range.js","src/anim/rand.js","src/anim/randt.js","src/anim/anim.js","src/flow/boot.js","src/flow/grid-element.js","src/flow/grid.js","src/flow/container.js","src/flow/viewport.js","src/flow/element.js","src/flow/group.js","src/flow/scene.js","src/flow/updater.js","src/flow/simple-container.js","src/flow/grid-container.js","src/flow/mask.js","src/flow/label.js","src/flow/keyboard-handler.js","src/flow/pointer-handler.js","src/flow/screen-controls.js","src/flow/button.js","src/flow/stick.js","src/fxl/system.js","src/fxl/world.js","src/fxl/r.js","src/fxl/resources.js","src/fxl/gamepad.js","src/fxl/input.js","src/fxl/collider.js","src/fxl/fxl.js","src/main.js"],"sourcesContent":["/*\n**\tsystem/random.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\n\nconst rol16 = function (value, n) { return ((value << n) | ((value >>> (16 - n)) & ((1 << n) - 1))) & 0xFFFF; };\nconst ror16 = function (value, n) { return ((value >>> n) | ((value & ((1 << n) - 1)) << (16 - n))) & 0xFFFF; };\nconst add16 = function (value, x) { return (value + x) & 0xFFFF; };\nconst sub16 = function (value, x) { return (value - x) & 0xFFFF; };\nconst xor16 = function (value, x) { return (value ^ x) & 0xFFFF; };\n\n//!class Random\n\nconst Random = Class.extend\n({\n\t/**\n\t * \tSeed value of the generator. Remains constant throughout the life of the generator.\n\t * \t!seed: number;\n\t */\n\tseed: 0,\n\n\t/**\n\t * \tLast value returned by the generator.\n\t * \t!last: number;\n\t */\n\tlast: 0,\n\n\ta: 0, b: 0,\n\n\t/**\n\t * \tInitializes the instance of the pseudo-random number generator.\n\t * \t@param seed - Value to seed the random number generator. If none provided, default one (0xDAE7A5D3) will be used.\n\t *\n\t *\t!constructor (seed?: number);\n\t */\n\t__ctor: function(seed=0xDAE7A5D3)\n\t{\n\t\tthis.setSeed(seed);\n\t},\n\n\t/**\n\t * \tSets the seed of the pseudo-random number generator.\n\t * \t@param value - Seed value to use (32-bit unsigned integer).\n\t *\n\t *\t!setSeed (value: number) : Random;\n\t */\n\tsetSeed: function(value)\n\t{\n\t\tthis.seed = value;\n\n\t\tthis.a = (value >> 16) & 0xFFFF;\n\t\tthis.b = (value >> 0) & 0xFFFF;\n\n\t\tthis.last = ((this.a >> 4) & 0x00FF) | ((this.b << 4) & 0xFF00);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tGenerates a 16-bit unsigned integer.\n\t *\t!nextInt16 () : number;\n\t */\n\tnextInt16: function ()\n\t{\n\t\tlet value = this.last;\n\n\t\tvalue = add16(value, this.a);\n\t\tvalue = xor16(value, 0x1515);\n\n\t\tthis.a = xor16(this.a, 0x51A1);\n\t\tthis.a = sub16(this.a, this.b);\n\t\tthis.b = xor16(this.b, 0x1A15);\n\n\t\tvalue = rol16(value, this.b & 0x0F);\n\n\t\treturn ((this.last = value) & 0xFFFF);\n\t},\n\n\t/**\n\t * \tGenerates an 8-bit unsigned integer.\n\t * \t!nextInt8 () : number;\n\t */\n\tnextInt8: function ()\n\t{\n\t\treturn this.nextInt16() & 0xFF;\n\t},\n\n\t/**\n\t * \tGenerates a floating point number between 0 an 1 (inclusive).\n\t * \t!nextFloat () : number;\n\t */\n\tnextFloat: function ()\n\t{\n\t\treturn this.nextInt16() / 0xFFFF;\n\t}\n});\n\nexport default Random;\n","/*\n**\tsystem/keycode.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n//:/**\n//: * \tEnumeration of key codes supported by the system.\n//: */\n\n//!enum KeyCode\n\nexport default\n{\n\tBACKSPACE: 8,\n\t//!BACKSPACE\n\tTAB: 9,\n\t//!TAB\n\tENTER: 13,\n\t//!ENTER\n\tSHIFT: 16,\n\t//!SHIFT\n\tCTRL: 17,\n\t//!CTRL\n\tESC: 27,\n\t//!ESC\n\tSPACE: 32,\n\t//!SPACE\n\n\tPGUP: 33,\n\t//!PGUP\n\tPGDN: 34,\n\t//!PGDN\n\n\tEND: 35,\n\t//!END\n\tHOME: 36,\n\t//!HOME\n\n\tINS: 45,\n\t//!INS\n\tDEL: 46,\n\t//!DEL\n\n\tLEFT: 37,\n\t//!LEFT\n\tUP: 38,\n\t//!UP\n\tRIGHT: 39,\n\t//!RIGHT\n\tDOWN: 40,\n\t//!DOWN\n\n\tNUM_PLUS: 107,\n\t//!NUM_PLUS\n\tNUM_MINUS: 109,\n\t//!NUM_MINUS\n\tNUM_ASTERISK: 106,\n\t//!NUM_ASTERISK\n\tNUM_SLASH: 111,\n\t//!NUM_SLASH\n\tNUM_DOT: 110,\n\t//!NUM_DOT\n\n\tNUM_0: 96,\n\t//!NUM_0\n\tNUM_1: 97,\n\t//!NUM_1\n\tNUM_2: 98,\n\t//!NUM_2\n\tNUM_3: 99,\n\t//!NUM_3\n\tNUM_4: 100,\n\t//!NUM_4\n\tNUM_5: 101,\n\t//!NUM_5\n\tNUM_6: 102,\n\t//!NUM_6\n\tNUM_7: 103,\n\t//!NUM_7\n\tNUM_8: 104,\n\t//!NUM_8\n\tNUM_9: 105,\n\t//!NUM_9\n\n\tD0: 48,\n\t//!D0\n\tD1: 49,\n\t//!D1\n\tD2: 50,\n\t//!D2\n\tD3: 51,\n\t//!D3\n\tD4: 52,\n\t//!D4\n\tD5: 53,\n\t//!D5\n\tD6: 54,\n\t//!D6\n\tD7: 55,\n\t//!D7\n\tD8: 56,\n\t//!D8\n\tD9: 57,\n\t//!D9\n\n\tA: 65,\n\t//!A\n\tB: 66,\n\t//!B\n\tC: 67,\n\t//!C\n\tD: 68,\n\t//!D\n\tE: 69,\n\t//!E\n\tF: 70,\n\t//!F\n\tG: 71,\n\t//!G\n\tH: 72,\n\t//!H\n\tI: 73,\n\t//!I\n\tJ: 74,\n\t//!J\n\tK: 75,\n\t//!K\n\tL: 76,\n\t//!L\n\tM: 77,\n\t//!M\n\tN: 78,\n\t//!N\n\tO: 79,\n\t//!O\n\tP: 80,\n\t//!P\n\tQ: 81,\n\t//!Q\n\tR: 82,\n\t//!R\n\tS: 83,\n\t//!S\n\tT: 84,\n\t//!T\n\tU: 85,\n\t//!U\n\tV: 86,\n\t//!V\n\tW: 87,\n\t//!W\n\tX: 88,\n\t//!X\n\tY: 89,\n\t//!Y\n\tZ: 90,\n\t//!Z\n};\n","/*\n**\tutils/recycler.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nlet totalPreallocated = 0;\nconst recyclingFacilities = { };\n\nconst Recycler = { };\nglobal.Recycler = Recycler;\nexport default Recycler;\n\n//:/**\n//: * \tProvides functions to attach recycling functionality to any class for object pooling.\n//: */\n\n//!namespace Recycler\n\n/**\n * \tAttaches recycling methods (`allocate`, `alloc` and `free`) to the specified class. Class should implement method `init` to initialize the instance (and return itself)\n * \tand `__dtor` to destroy it.\n *\n * \t@param {*} maxPoolSize - Maximum number of instance to hold in the recycler.\n * \t@param {*} minPoolSize - Minimum number of instances to pre-allocate. Defaults to 0.375*`maxPoolSize` if not specified.\n * \n * \t!function attachTo (targetClass: any, maxPoolSize?: number, minPoolSize?: number) : any;\n */\n\nRecycler.attachTo = function (targetClass, maxPoolSize=8192, minPoolSize=null)\n{\n\tif (!targetClass.prototype.className)\n\t\tthrow new Error ('Unable to attach recycler methods to an unnamed class.');\n\n\tif (!('__dtor' in targetClass.prototype))\n\t\tthrow new Error ('Recycler: Class '+targetClass.prototype.className+' requires `__dtor` method.');\n\n\tif (!('init' in targetClass.prototype))\n\t\tthrow new Error ('Recycler: Class '+targetClass.prototype.className+' requires `init` method.');\n\n\tif (minPoolSize === null)\n\t\tminPoolSize = int(maxPoolSize * 0.375);\n\n\trecyclingFacilities[targetClass.prototype.className] = targetClass;\n\n\ttargetClass.recyclerPool = [ ];\n\ttargetClass.recyclerPoolMax = maxPoolSize;\n\n\ttargetClass.prototype.objectId = 0;\n\n\ttargetClass.recyclerNextObjectId = 0;\n\ttargetClass.recyclerCreated = 0;\n\ttargetClass.recyclerRecycled = 0;\n\ttargetClass.recyclerMissed = 0;\n\ttargetClass.recyclerLength = 0;\n\ttargetClass.recyclerActive = 0;\n\n\tfor (let i = 0; i < minPoolSize; i++)\n\t{\n\t\ttargetClass.recyclerPool.push(new targetClass ());\n\t\ttargetClass.recyclerLength++;\n\t\ttotalPreallocated++;\n\t}\n\n\t/**\n\t * \tAllocates a new instance of the class. To ensure correct instance state a call to `init` must be made later.\n\t * \t@returns {object}\n\t */\n\ttargetClass.allocate = function()\n\t{\n\t\tlet item;\n\n\t\tif (!this.recyclerLength)\n\t\t{\n\t\t\titem = new targetClass ();\n\t\t\ttargetClass.recyclerCreated++;\n\t\t}\n\t\telse\n\t\t{\n\t\t\titem = this.recyclerPool[--this.recyclerLength];\n\t\t\ttargetClass.recyclerRecycled++;\n\t\t}\n\n\t\ttargetClass.recyclerActive++;\n\n\t\titem.objectId = ++this.recyclerNextObjectId;\n\t\tthis.recyclerNextObjectId &= 0x7FFFFFFF;\n\n\t\treturn item;\n\t};\n\n\t/**\n\t * \tAllocates an instance and initializes it. Internally runs `allocate` first and then `init` with up to 10 parameters.\n\t * \t@param {any} a0..a9 \n\t * \t@returns {object}\n\t */\n\ttargetClass.alloc = function(a0=null, a1=null, a2=null, a3=null, a4=null, a5=null, a6=null, a7=null, a8=null, a9=null)\n\t{\n\t\treturn targetClass.allocate().init(a0, a1, a2, a3, a4, a5, a6, a7, a8, a9);\n\t};\n\n\t/**\n\t * \tReleases the self object and adds it back to the pool. Duplicate call to this method will result in an error.\n\t * \t@returns {object}\n\t */\n\ttargetClass.prototype.free = function()\n\t{\n\t\tif (this.objectId < 0)\n\t\t\treturn this;\n\n\t\tif (this.objectId == 0)\n\t\t{\n\t\t\tconsole.error ('ERROR: Already released instance of ' + targetClass.prototype.className);\n\t\t\treturn this;\n\t\t}\n\n\t\tthis.__dtor();\n\n\t\tthis.objectId = 0;\n\n\t\tif (targetClass.recyclerLength >= maxPoolSize)\n\t\t\ttargetClass.recyclerMissed++;\n\t\telse\n\t\t\ttargetClass.recyclerPool[targetClass.recyclerLength++] = this;\n\n\t\ttargetClass.recyclerActive--;\n\t\treturn this;\n\t};\n\n\t/**\n\t * \tSets a flag used to prevent the instance from being destroyed.\n\t * \t@returns {object}\n\t */\n\ttargetClass.prototype.lockInstance = function(value)\n\t{\n\t\tthis.objectId = Math.abs(this.objectId);\n\t\tif (value) this.objectId = -this.objectId;\n\t\treturn this;\n\t};\n};\n\n/**\n * \tShows stats about all recycling facilities (or just the specified one) using `console.debug`.\n * \t@param name - Name of the class to show.\n * \t!function showStats (name?: string) : void;\n */\nRecycler.showStats = function (name=null)\n{\n\tlet list = recyclingFacilities;\n\n\tconsole.log('Total Preallocated: ' + totalPreallocated);\n\n\tif (name === true)\n\t{\n\t\tconsole.group('Recycling Facilities');\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tlet c = list[i];\n\t\t\tif (!c.recyclerCreated) continue;\n\n\t\t\tconsole.debug (i + ': '+(100*(c.recyclerCreated/c.recyclerPoolMax)).toFixed(1)+'%  =>  overhead=' + c.recyclerCreated + ', active='+c.recyclerActive+', array=' + c.recyclerPool.length + ', recycled=' + c.recyclerRecycled + ', in-recycler=' + c.recyclerLength + ', missed=' + c.recyclerMissed + ', space=' + (c.recyclerPoolMax - c.recyclerLength));\n\t\t}\n\t\n\t\tconsole.groupEnd();\n\t\treturn;\n\t}\n\n\tif (name !== null)\n\t{\n\t\tif (typeof(name) === 'string')\n\t\t{\n\t\t\tlet c = recyclingFacilities[name];\n\t\t\tconsole.debug (name + ': '+(100*(c.recyclerCreated/c.recyclerPoolMax)).toFixed(1)+'%  =>  overhead=' + c.recyclerCreated + ', active='+c.recyclerActive+', array=' + c.recyclerPool.length + ', recycled=' + c.recyclerRecycled + ', in-recycler=' + c.recyclerLength + ', missed=' + c.recyclerMissed + ', space=' + (c.recyclerPoolMax - c.recyclerLength));\n\t\t\treturn;\n\t\t}\n\n\t\tlist = name;\n\t}\n\n\tconsole.group('Recycling Facilities');\n\n\tfor (let i in list)\n\t{\n\t\tlet c = list[i];\n\t\tconsole.debug (i + ': '+(100*(c.recyclerCreated/c.recyclerPoolMax)).toFixed(1)+'%  =>  overhead=' + c.recyclerCreated + ', active='+c.recyclerActive+', array=' + c.recyclerPool.length + ', recycled=' + c.recyclerRecycled + ', in-recycler=' + c.recyclerLength + ', missed=' + c.recyclerMissed + ', space=' + (c.recyclerPoolMax - c.recyclerLength));\n\t}\n\n\tconsole.groupEnd();\n};\n\n\n/**\n * \tCreate a new class extending the specified target class, this new class is a recycling facility and is placed under property `Pool` of the target class. This\n * \tmethod can be used instead of the usual `attachTo` when the target class construct/deconstruct methods need to remain untouched.\n *\n * \t@param {*} maxPoolSize - Maximum number of instance to hold in the recycler.\n * \t@param {*} minPoolSize - Minimum number of instances to pre-allocate. Defaults to 0.375*`maxPoolSize` if not specified.\n * \n *\t!function createPool (targetClass: any, maxPoolSize?: number, minPoolSize?: number) : any;\n */\nRecycler.createPool = function (targetClass, maxPoolSize=8192, minPoolSize=null)\n{\n\tconst name = targetClass.prototype.className;\n\tif (!name) throw new Error ('Unable to create pool sub-class on an unnamed class.');\n\n\tconst Pool = targetClass.extend\n\t({\n\t\tclassName: targetClass.prototype.className,\n\n\t\t__ctor: function () {\n\t\t},\n\n\t\tinit: function(a0=null, a1=null, a2=null, a3=null, a4=null, a5=null, a6=null, a7=null, a8=null, a9=null)\n\t\t{\n\t\t\tthis._super[name].__ctor(a0, a1, a2, a3, a4, a5, a6, a7, a8, a9);\n\t\t\treturn this;\n\t\t}\n\t});\n\n\tRecycler.attachTo(Pool, maxPoolSize, minPoolSize);\n\ttargetClass.Pool = Pool;\n\n\treturn targetClass;\n};\n","/*\n**\tutils/linkable.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Recycler from './recycler.js';\n\n//![import \"./recycler\"]\n\n//:/**\n//: * \tGeneric class for linkable items such as required by List. The responsibility of this class is to wrap a value into a linkable object.\n//: */\n\n//!class Linkable\n\nconst Linkable = Class.extend\n({\n\tclassName: \"Linkable\",\n\n\t/**\n\t * \tPointer to the previous item in the chain.\n\t * \t!readonly prev: Linkable;\n\t */\n\tprev: null, /* Linkable */\n\n\t/**\n\t * \tPointer to the next item in the chain.\n\t * \t!readonly next: Linkable;\n\t */\n\tnext: null, /* Linkable */\n\n\t/**\n\t * \tWrapped value.\n\t * \t!value: any;\n\t */\n\tvalue: null,\n\n\t/**\n\t * \tInitializes the linkable item and wraps the given value. Sets the `prev` and `next` pointers to null.\n\t * \t!constructor (value?: any);\n\t */\n\t__ctor: function (value)\n\t{\n\t\tthis.value = value;\n\t\tthis.clear();\n\t},\n\n\t/**\n\t * \tUnlinks the linkable item.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis.unlink();\n\t},\n\n\t/**\n\t * \tSets the previous/next connection pointers to null. Returns `this`.\n\t * \t!clear() : Linkable;\n\t */\n\tclear: function ()\n\t{\n\t\tthis.next = this.prev = null;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tLinks the item such that it will be located after the given reference.\n\t * \t!linkAfter (ref: Linkable) : Linkable;\n\t */\n\tlinkAfter: function (ref)\n\t{\n\t\tthis.prev = ref;\n\t\tthis.next = ref ? ref.next : null;\n\n\t\tif (ref)\n\t\t{\n\t\t\tif (ref.next) ref.next.prev = this;\n\t\t\tref.next = this;\n\t\t}\n\t},\n\n\t/**\n\t * \tLinks the item such that it will be located before the given reference.\n\t * \t!linkBefore (ref: Linkable) : Linkable;\n\t */\n\tlinkBefore: function (ref)\n\t{\n\t\tthis.prev = ref ? ref.prev : null;\n\t\tthis.next = ref;\n\n\t\tif (ref)\n\t\t{\n\t\t\tif (ref.prev) ref.prev.next = this;\n\t\t\tref.prev = this;\n\t\t}\n\t},\n\n\t/**\n\t * \tUnlinks the item by linking the `prev` and `next` together (when available) and returns `this`.\n\t * \t!unlink() : Linkable;\n\t */\n\tunlink: function () \n\t{\n\t\tif (this.prev) this.prev.next = this.next;\n\t\tif (this.next) this.next.prev = this.prev;\n\n\t\treturn this.clear();\n\t}\n});\n\n//!/class\n\n//!namespace Linkable\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a linkable item and wraps the given value. Sets the `prev` and `next` pointers to null.\n\t * \t!function alloc (value?: any) : Linkable;\n\t */\n\nRecycler.createPool (Linkable, 16384, 6144);\nexport default Linkable;\n","/*\n**\tutils/list.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rin, Class } from '@rsthn/rin';\nimport Linkable from './linkable.js';\nimport Recycler from './recycler.js';\n\n//![import \"./linkable\"]\n//![import \"./recycler\"]\n\n//:/**\n//: * \tImplementation of a generic linked list.\n//: */\n\n//!class List\n\nconst List = Class.extend\n({\n\t/**\n\t * \tName of the class (for inheritance purposes).\n\t */\n\tclassName: \"List\",\n\n\t/**\n\t * \tPointer to the first node in the list.\n\t * \t!top: Linkable;\n\t */\n\ttop: null,\n\n\t/**\n\t * \tPointer to the last node in the list.\n\t * \t!bottom: Linkable;\n\t */\n\tbottom: null,\n\n\t/**\n\t * \tNumber of values in the list.\n\t * \t!length: number;\n\t */\n\tlength: 0,\n\n\t/**\n\t * \tInitializes the instance to an empty list.\n\t * \t!constructor();\n\t */\n\t__ctor: function ()\n\t{\n\t\tthis.top = null;\n\t\tthis.bottom = null;\n\t\tthis.length = 0;\n\t},\n\n\t/**\n\t * \tTraverses the list and destroys all nodes. The actual values are maintained. To destroy the\n\t * \tlist contents call clear() instead.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis.reset();\n\t},\n\n\t/**\n\t * \tClones all contents and returns a new list.\n\t * \t!clone() : List;\n\t */\n\tclone: function()\n\t{\n\t\tlet list = List.Pool.alloc();\n\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tlist.push(Rin.clone(i.value));\n\n\t\treturn list;\n\t},\n\n\t/**\n\t * \tTraverses the list and destroys all nodes and values.\n\t * \t!clear() : List;\n\t */\n\tclear: function ()\n\t{\n\t\tlet i, ni;\n\n\t\tfor (i = this.top; i; i = ni)\n\t\t{\n\t\t\tni = i.next;\n\t\t\tdispose(i.free().value);\n\t\t}\n\n\t\tthis.top = this.bottom = null;\n\t\tthis.length = 0;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tTraverses the list, destroys all nodes **but** values are preserved.\n\t * \t!reset() : List;\n\t */\n\treset: function ()\n\t{\n\t\tlet i, ni;\n\n\t\tfor (i = this.top; i != null; i = ni)\n\t\t{\n\t\t\tni = i.next;\n\t\t\ti.free();\n\t\t}\n\n\t\tthis.top = this.bottom = null;\n\t\tthis.length = 0;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the first value in the list.\n\t * \t!first() : any;\n\t */\n\tfirst: function ()\n\t{\n\t\treturn this.top !== null ? this.top.value : null;\n\n\t},\n\t/**\n\t * \tReturns the last value in the list.\n\t * \t!last() : any;\n\t */\n\tlast: function ()\n\t{\n\t\treturn this.bottom !== null ? this.bottom.value : null;\n\t},\n\n\t/**\n\t * \tReturns a value given its index.\n\t * \t!getAt (index: number) : any;\n\t */\n\tgetAt: function (index)\n\t{\n\t\tlet i = null;\n\t\tfor (i = this.top; i && index-- > 0; i = i.next);\n\t\treturn i != null ? i.value : null;\n\t},\n\n\t/**\n\t * \tReturns the node at the given index.\n\t * \t!getNodeAt (index: number) : Linkable;\n\t */\n\tgetNodeAt: function (index)\n\t{\n\t\tlet i = null;\n\t\tfor (i = this.top; i && index--; i = i.next);\n\t\treturn i;\n\t},\n\n\t/**\n\t * \tReturns the node of a value given another value to compare, uses identical comparison (===) to match the value.\n\t * \t!sgetNode (value: any) : Linkable;\n\t */\n\tsgetNode: function (value)\n\t{\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tif (i.value === value) return i;\n\n\t\treturn null;\n\t},\n\n\t/**\n\t * \tRemoves the given value from the list and returns it.\n\t * \t!remove<T> (value: T) : T;\n\t */\n\tremove: function (i)\n\t{\n\t\tif (i != null && !Linkable.isInstance(i))\n\t\t\ti = this.sgetNode(i);\n\n\t\tif (!i) return null;\n\n\t\tif (!i.prev) this.top = i.next;\n\t\tif (!i.next) this.bottom = i.prev;\n\n\t\tthis.length--;\n\t\treturn i.free().value;\n\t},\n\n\t/**\n\t * \tAdds a value before the given reference node.\n\t * \t!insertBefore<T> (ref: Linkable, value: T) : T;\n\t */\n\tinsertBefore: function (ref, value)\n\t{\n\t\tif (!ref) return this;\n\n\t\tlet i = Linkable.Pool.alloc(value);\n\t\ti.linkBefore (ref);\n\n\t\tif (ref == this.top) this.top = i;\n\t\tthis.length++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * \tAdds a value after the given reference node.\n\t * \t!insertAfter<T> (ref: Linkable, value: T) : T;\n\t */\n\tinsertAfter: function (ref, value)\n\t{\n\t\tif (!ref) return this;\n\n\t\tlet i = Linkable.Pool.alloc(value);\n\t\ti.linkAfter (ref);\n\n\t\tif (ref == this.bottom) this.bottom = i;\n\t\tthis.length++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * \tAdds a value to the top of the list.\n\t * \t!unshift<T> (value: T) : T;\n\t */\n\tunshift: function (value)\n\t{\n\t\tlet i = Linkable.Pool.alloc(value);\n\n\t\ti.linkBefore (this.top);\n\t\tif (!this.bottom) this.bottom = i;\n\n\t\tthis.top = i;\n\t\tthis.length++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * \tRemoves a value from the top of the list.\n\t * \t!shift() : any;\n\t */\n\tshift: function ()\n\t{\n\t\tlet i = this.top;\n\t\tif (!i) return null;\n\n\t\tif (!(this.top = i.next)) this.bottom = null;\n\t\tthis.length--;\n\n\t\treturn i.free().value;\n\t},\n\n\t/**\n\t * \tAdds a value to the bottom of the list.\n\t * \t!push<T> (value: T) : T;\n\t */\n\tpush: function (value)\n\t{\n\t\tlet i = Linkable.Pool.alloc(value);\n\n\t\ti.linkAfter (this.bottom);\n\t\tif (!this.top) this.top = i;\n\n\t\tthis.bottom = i;\n\t\tthis.length++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * \tRemoves a value from the bottom of the list.\n\t * \t!pop() : any;\n\t */\n\tpop: function ()\n\t{\n\t\tlet i = this.bottom;\n\t\tif (!i) return null;\n\n\t\tif (!(this.bottom = i.prev)) this.top = null;\n\t\tthis.length--;\n\n\t\treturn i.free().value;\n\t},\n\n\t/**\n\t * \tAppends all contents of the given list to the current one.\n\t * \t!append (list: List) : List;\n\t */\n\tappend: function (list)\n\t{\n\t\tfor (let i = list.top; i; i = i.next)\n\t\t\tthis.push(i.value);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tTraverses the list calling the specified function for each value.\n\t * \t@param fn - Callback to execute, return `false` to stop the loop immediately.\n\t * \t!forEach(fn: (value: any, node: Linkable, list: List, context: object) => boolean, context?: object) : boolean;\n\t */\n\tforEach: function(fn, context=null)\n\t{\n\t\tlet ni;\n\t\n\t\tfor (let i = this.top; i; i = ni)\n\t\t{\n\t\t\tni = i.next;\n\t\t\tif (fn (i.value, i, this, context) === false) return false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tTraverses the list in reverse order, calling the specified function for each value.\n\t * \t@param fn - Callback to execute, return `false` to stop the loop immediately.\n\t * \t!forEachRev(fn: (value: any, node: Linkable, list: List, context: object) => boolean, context?: object) : boolean;\n\t */\n\tforEachRev: function(fn, context=null)\n\t{\n\t\tlet ni;\n\t\n\t\tfor (let i = this.bottom; i; i = ni)\n\t\t{\n\t\t\tni = i.prev;\n\t\t\tif (fn (i.value, i, this, context) === false) return false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tReturns the first value where the specified function returns `true`.\n\t * \t!find (fn: (value: any, context: object) => boolean, context?: object) : any;\n\t */\n\tfind: function (fn, context=null)\n\t{\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tif (fn(i.value, context)) return i.value;\n\n\t\treturn null;\n\t},\n\n\t/**\n\t * \tReturns an array with all values where the specified function returns `true`.\n\t * \t!filter (fn: (value: any, context: object) => boolean, context?: object) : Array<any>;\n\t */\n\tfilter: function (fn, context=null)\n\t{\n\t\tlet list = List.Pool.alloc();\n\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tif (fn(i.value, context)) list.push(i.value);\n\n\t\treturn list;\n\t},\n\n\t/**\n\t * \tReturns an array with all the values in the list.\n\t * \t!toArray() : Array<any>;\n\t */\n\ttoArray: function()\n\t{\n\t\tlet array = [];\n\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tarray.push(i.value);\n\n\t\treturn array;\n\t}\n});\n\n//!/class\n\n//!namespace List\n//!namespace Pool\n\n\t/**\n\t * \tAllocates an empty list.\n\t * \t!function alloc() : List;\n\t */\n\nRecycler.createPool (List, 16384, 6144);\nexport default List;\n","/*\n**\tsystem/timer.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n//!class Timer\n\n/**\n * \t@param vsync - Indicates if requestAnimationFrame should be used instead of setTimeout.\n * \t@param interval - Amount of milliseconds between timer activations.\n * \t@param callback - Function to execute on each timer activation.\n *\n * \t!constructor (vsync: boolean, interval: number, callback: (dt: number, timer: Timer) => void );\n */\nconst Timer = function (vsync, interval, callback)\n{\n\tthis.callback = callback;\n\tthis.interval = interval;\n\tthis.vsync = vsync;\n\tthis.handle = null;\n\n\tthis.isRunning = false;\n\tthis.startTime = 0;\n\tthis.rTime = 0;\n\tthis.sTime = 0;\n\tthis.lTime = 0;\n\tthis.tDelta = 0;\n\n\tthis._onTimeout = () => {\n\t\tthis.onTimeout();\n\t};\n\n\tthis._onTimeout_b = () => {\n\t\tthis.runNow();\n\t};\n};\n\n/**\n * \tTimer onTimeout handler.\n */\nTimer.prototype.onTimeout = function ()\n{\n\tif (!this.isRunning) return;\n\n\tthis.rTime = hrnow() - this.startTime;\n\n\tlet tError = this.rTime - (this.sTime + this.interval);\n\tif (tError < 0)\n\t{\n\t\tthis.runAfter(-tError);\n\t\treturn;\n\t}\n\n\tthis.sTime += this.interval * (1 + int(tError / this.interval));\n\n\tthis.tDelta = tError < 0 ? this.interval : (this.rTime - this.lTime);\n\tthis.lTime = this.rTime;\n\n\tthis.runAfter((this.sTime + this.interval) - (hrnow() - this.startTime));\n\tthis.callback(this.tDelta, this);\n};\n\n/**\n * \tStarts the timer and triggers `onStarted`.\n *\n * \t@param immediate - When `true` the callback will be executed immediately.\n * \t@param scale - Used to control when to trigger the first timeout, delay is timeInterval*scale.\n *\n * \t!start (immediate?: boolean, scale?: number) : void;\n */\nTimer.prototype.start = function (immediate=false, scale=1.0)\n{\n\tif (this.isRunning) return;\n\n\tthis.startTime = hrnow();\n\tthis.isRunning = true;\n\n\tthis.sTime = 0;\n\tthis.lTime = 0;\n\n\tthis.onStarted();\n\n\tif (immediate)\n\t\tthis.callback (0, this);\n\n\tthis.runAfter(this.interval*scale);\n};\n\n/**\n * \tExecutes the timer activation after the specified amount of milliseconds.\n *\n * \t!runAfter (timeout: number) : void;\n */\nTimer.prototype.runAfter = function (timeout)\n{\n\tif (process.browser && this.vsync)\n\t{\n\t\trequestAnimationFrame(this._onTimeout_b);\n\t\treturn;\n\t}\n\n\tif (this.handle)\n\t\tclearTimeout(this.handle);\n\n\tthis.handle = setTimeout(this._onTimeout, timeout);\n};\n\n/**\n * \tExecutes the timer activaton as soon as possible.\n *\n * \t!runNow() : void;\n */\nTimer.prototype.runNow = function ()\n{\n\tif (this.handle)\n\t\tclearTimeout(this.handle);\n\n\tthis.handle = setTimeout(this._onTimeout, 0);\n};\n\n/**\n * \tStops the timer and triggers `onStopped`.\n *\n * \t!stop() : void;\n */\nTimer.prototype.stop = function ()\n{\n\tif (!this.isRunning) return;\n\n\tif (this.handle)\n\t{\n\t\tclearTimeout(this.handle);\n\t\tthis.handle = null;\n\t}\n\n\tthis.isRunning = false;\n\tthis.onStopped();\n};\n\n/**\n * \tTimer started event handler.\n *\n * \t!onStarted() : void;\n */\nTimer.prototype.onStarted = function ()\n{\n};\n\n/**\n * \tTimer stopped event handler.\n *\n * \t!onStopped() : void;\n */\nTimer.prototype.onStopped = function ()\n{\n};\n\nexport default Timer;\n","/*\n**\tmath/vec2.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"../utils/recycler\"]\n\n//:/**\n//: * \tRepresentation of a vector in 2D space, that is, a float tuple with components x and y.\n//: */\n\n//!class Vec2\n\nconst Vec2 = Class.extend\n({\n\tclassName: 'Vec2',\n\n\t/**\n\t * \tCoordinates of the vector.\n\t * \t!x: number;\n\t * \t!y: number;\n\t */\n\tx: 0, y: 0,\n\n\t/**\n\t *\tConstructs the vector from another Vec2.\n\t * \t!constructor (value: Vec2);\n\t */\n\t/**\n\t *\tConstructs the vector with the specified coordinates.\n\t * \t!constructor (x?: number, y?: number);\n\t */\n\t__ctor: function (x=null, y=null)\n\t{\n\t\treturn this.set(x, y);\n\t},\n\n\t/**\n\t * \tClones the vector coordinates into a new Vec2 object.\n\t * \t!clone() : Vec2;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Vec2.Pool.alloc(this);\n\t},\n\n\t/**\n\t *\tSets the coordinates of the vector from a Vec2 object.\n\t *\t!set (value: Vec2) : Vec2;\n\t */\n\t/**\n\t *\tSets the coordinates of the vector.\n\t *\t!set (x: number, y: number) : Vec2;\n\t */\n\tset: function (x, y=null)\n\t{\n\t\tif (x === null) {\n\t\t\tx = 0;\n\t\t\ty = 0;\n\t\t}\n\t\telse if (y === null) {\n\t\t\tlet v = x;\n\t\t\tx = v.x;\n\t\t\ty = v.y;\n\t\t}\n\n\t\tthis.x = x;\n\t\tthis.y = y;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the X-coordinate of the vector.\n\t * \t!setX (x: number) : Vec2;\n\t */\n\tsetX: function (x)\n\t{\n\t\tthis.x = x;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the Y-coordinate of the vector.\n\t * \t!setY (y: number) : Vec2;\n\t */\n\tsetY: function (y)\n\t{\n\t\tthis.y = y;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the coordinates of the vector to zero.\n\t * \t!zero() : Vec2;\n\t */\n\tzero: function()\n\t{\n\t\treturn this.set(0, 0);\n\t},\n\n\t/**\n\t * \tReturns true if the vector coordinates are both zero.\n\t * \t!isZero() : boolean;\n\t */\n\tisZero: function()\n\t{\n\t\treturn this.x == 0 && this.y == 0;\n\t},\n\n\t/**\n\t *\tReturns true if the coordinates of the vector have the same values as the given Vec2.\n\t *\t!equals (value: Vec2) : boolean;\n\t */\n\t/**\n\t *\tReturns true if the coordinates of the vector have the same values as the given ones.\n\t *\t!equals (x: number, y: number) : boolean;\n\t */\n\tequals: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tlet v = x;\n\t\t\tx = v.x;\n\t\t\ty = v.y;\n\t\t}\n\n\t\treturn this.x == x && this.y == y;\n\t},\n\n\t/**\n\t * \tNegates the vector, that is changing the sign of each component in the vector.\n\t * \t!neg() : Vec2;\n\t */\n\tneg: function ()\n\t{\n\t\tthis.x = -this.x; this.y = -this.y;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tInverts the vector by changing each component to its reciprocal.\n\t * \t!inv() : Vec2;\n\t */\n\tinv: function ()\n\t{\n\t\tthis.x = 1 / this.x; this.y = 1 / this.y;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tChanges the components of the vector to their absolute value.\n\t * \t!abs() : Vec2;\n\t */\n\tabs: function ()\n\t{\n\t\tthis.x = this.x < 0 ? -this.x : this.x;\n\t\tthis.y = this.y < 0 ? -this.y : this.y;\n\t\treturn this;\n\t},\n\n\t/**\n\t *\tAdds the coordinates of the given Vec2 to the vector.\n\t *\t!translate (value: Vec2) : Vec2;\n\t */\n\t/**\n\t *\tAdds the given delta values to the vector.\n\t *\t!translate (dx: number, dy: number) : Vec2;\n\t */\n\ttranslate: function (dx, dy=null)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tlet v = dx;\n\t\t\tdx = v.x;\n\t\t\tdy = v.y;\n\t\t}\n\n\t\tthis.x += dx, this.y += dy;\n\t\treturn this;\n\t},\n\n\t/**\n\t *\tAdds the coordinates of the given Vec2 to the vector.\n\t *\t!add (value: Vec2) : Vec2;\n\t */\n\t/**\n\t *\tAdds the given delta values to the vector.\n\t *\t!add (dx: number, dy: number) : Vec2;\n\t */\n\tadd: function (dx, dy=null)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tlet v = dx;\n\t\t\tdx = v.x;\n\t\t\tdy = v.y;\n\t\t}\n\n\t\tthis.x += dx, this.y += dy;\n\t\treturn this;\n\t},\n\n\t/**\n\t *\tSubtracts the coordinates of the given Vec2 from the vector.\n\t *\t!sub (value: Vec2) : Vec2;\n\t */\n\t/**\n\t *\tSubtracts the given delta values from the vector.\n\t *\t!sub (dx: number, dy: number) : Vec2;\n\t */\n\tsub: function (dx, dy=null)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tlet v = dx;\n\t\t\tdx = v.x;\n\t\t\tdy = v.y;\n\t\t}\n\n\t\tthis.x -= dx, this.y -= dy;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tScales each components of the vector by the respective component of the given one.\n\t * \t!scale (k: number) : Vec2;\n\t */\n\t/**\n\t * \tScales both components of the vector by the given factor.\n\t * \t!scale (k: number) : Vec2;\n\t */\n\t/**\n\t * \tScales each components of the vector by the given factors.\n\t * \t!scale (fx: number, fy: number) : Vec2;\n\t */\n\tscale: function (fx, fy=null)\n\t{\n\t\tif (fy === null)\n\t\t{\n\t\t\tif (Vec2.isInstance(fx)) {\n\t\t\t\tlet v = fx;\n\t\t\t\tfx = v.x;\n\t\t\t\tfy = v.y;\n\t\t\t} else {\n\t\t\t\tfy = fx;\n\t\t\t}\n\t\t}\n\n\t\tthis.x *= fx, this.y *= fy;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the components to their integer parts.\n\t * \t!floor() : Vec2;\n\t */\n\tfloor: function ()\n\t{\n\t\tthis.x = int(this.x);\n\t\tthis.y = int(this.y);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the components to their fractional parts.\n\t * \t!fract() : Vec2;\n\t */\n\tfract: function ()\n\t{\n\t\tthis.x = this.x - int(this.x);\n\t\tthis.y = this.y - int(this.y);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the dot product of the vectors.\n\t * \t!dot (value: Vec2) : number;\n\t */\n\t/**\n\t * \tReturns the dot product of the vector and the given values.\n\t * \t!dot (x: number, y: number) : number;\n\t */\n\tdot: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tlet v = x;\n\t\t\tx = v.x;\n\t\t\ty = v.y;\n\t\t}\n\n\t\treturn this.x*x + this.y*y;\n\t},\n\n\t/**\n\t * \tReturns the magnitude of the vector.\n\t * \t!magnitude() : number;\n\t */\n\tmagnitude: function ()\n\t{\n\t\treturn Math.sqrt(this.x*this.x + this.y*this.y);\n\t},\n\n\t/**\n\t * \tNormalizes the vector by dividing each component by the vector magnitude to obtain a unit vector.\n\t * \t!normalize() : Vec2;\n\t */\n\tnormalize: function ()\n\t{\n\t\treturn this.isZero() ? this : this.scale (1 / this.magnitude());\n\t},\n\n\t/**\n\t * \tSets the vector to its major-axis, that is the component with the maximum absolute value.\n\t * \t!majorAxis() : Vec2;\n\t */\n\tmajorAxis: function ()\n\t{\n\t\tif (Math.abs(this.x) > Math.abs(this.y)) this.y = 0; else this.x = 0;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the vector to its minor-axis, that is the component with the minimum absolute value.\n\t * \t!minorAxis() : Vec2;\n\t */\n\tminorAxis: function ()\n\t{\n\t\tif (Math.abs(this.x) < Math.abs(this.y)) this.y = 0; else this.x = 0;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the vector to its sign-vector representation.\n\t * \t!sign() : Vec2;\n\t */\n\tsign: function ()\n\t{\n\t\tthis.x = !this.x ? 0 : (this.x < 0 ? -1 : 1);\n\t\tthis.y = !this.y ? 0 : (this.y < 0 ? -1 : 1);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the string representation of the coordinates of the vector.\n\t * \ttoString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn `(${this.x}, ${this.y})`;\n\t}\n});\n\n//!/class\n\n//!namespace Vec2\n//!namespace Pool\n\n/**\n *\tAllocates a vector from another Vec2.\n * \t!function alloc (value: Vec2) : Vec2;\n */\n/**\n *\tAllocates a vector with the specified coordinates.\n * \t!function alloc (x?: number, y?: number) : Vec2;\n */\n\nRecycler.createPool (Vec2, 4096, 2048);\nexport default Vec2;\n","/*\n**\tmath/matrix.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Recycler from '../utils/recycler.js';\nimport Vec2 from './vec2.js';\n\n//![import \"../utils/recycler\"]\n//![import \"./vec2\"]\n\nconst temp = new Float32Array(9).fill(0);\nconst temp2 = new Float32Array(9).fill(0);\n\n//:/**\n//: * \tRepresents a 3x3 matrix. Provides an interface to manipulate 3x3 matrices.\n//: */\n\n//!class Matrix\n\nconst Matrix = Class.extend\n({\n\tclassName: 'Matrix',\n\n\t/**\n\t * \tActual elements of the matrix.\n\t * \t!data: Float32Array\n\t */\n\tdata: null,\n\n\t/**\n\t * \tConstructs a new matrix copying the elements from the specified matrix.\n\t * \t!constructor(value: Matrix);\n\t */\n\t/**\n\t * \tConstructs a new matrix with the values from the specified array.\n\t * \t!constructor(value: Float32Array);\n\t */\n\t/**\n\t * \tConstructs a new matrix with the identity matrix values.\n\t * \t!constructor();\n\t */\n\t__ctor: function(value=null)\n\t{\n\t\tif (this.data === null)\n\t\t\tthis.data = new Float32Array(9);\n\n\t\tif (value !== null)\n\t\t\tthis.set(value);\n\t\telse\n\t\t\tthis.identity();\n\t},\n\n\t/**\n\t * \tFills the matrix with zeroes.\n\t * \t!zero() : Matrix;\n\t */\n\tzero: function()\n\t{\n\t\tthis.data.fill(0);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tFills the matrix with the specified value.\n\t * \t!fill (value: number) : Matrix;\n\t */\n\tfill: function (value)\n\t{\n\t\tthis.data.fill(value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCopies the specified matrix elements into the current one.\n\t * \t!set (value: Matrix) : Matrix;\n\t */\n\t/**\n\t * \tSets the matrix elements from the specified array.\n\t * \t!set (value: Float32Array) : Matrix;\n\t */\n\tset: function (value)\n\t{\n\t\tif (Matrix.isInstance(value))\n\t\t{\n\t\t\tfor (let i = 0; i < 9; i++) this.data[i] = value.data[i];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let i = 0; i < 9; i++) this.data[i] = value[i];\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the elements of the matrix to be the identity matrix.\n\t * \t!identity() : Matrix;\n\t */\n\tidentity: function (target=null)\n\t{\n\t\tif (target === null)\n\t\t\ttarget = this.data;\n\n\t\ttarget.fill(0);\n\t\ttarget[0] = target[4] = target[8] = 1;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMultiplies all elements in the matrix by a given scalar.\n\t * \t!scalef (scalar: number) : Matrix;\n\t */\n\tscalef: function (scalar)\n\t{\n\t\tfor (let i = 0; i < 9; i++) this.data[i] *= scalar;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns a clone of the matrix.\n\t * \t!clone() : Matrix;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Matrix.Pool.alloc(this);\n\t},\n\n\t/**\n\t * \tAppends the given matrix to the current one using matrix multiplication (self * matrix).\n\t * \t!append (matrix: Matrix) : Matrix;\n\t */\n\tappend: function (matr)\n\t{\n\t\tif (matr instanceof Matrix)\n\t\t\tmatr = matr.data;\n\n\t\tfor (let i = 0; i < 9; i++) temp[i] = this.data[i];\n\n\t\tthis.data[0] = matr[0]*temp[0] + matr[1]*temp[3] + matr[2]*temp[6];\n\t\tthis.data[1] = matr[0]*temp[1] + matr[1]*temp[4] + matr[2]*temp[7];\n\t\tthis.data[2] = matr[0]*temp[2] + matr[1]*temp[5] + matr[2]*temp[8];\n\t\tthis.data[3] = matr[3]*temp[0] + matr[4]*temp[3] + matr[5]*temp[6];\n\t\tthis.data[4] = matr[3]*temp[1] + matr[4]*temp[4] + matr[5]*temp[7];\n\t\tthis.data[5] = matr[3]*temp[2] + matr[4]*temp[5] + matr[5]*temp[8];\n\t\tthis.data[6] = matr[6]*temp[0] + matr[7]*temp[3] + matr[8]*temp[6];\n\t\tthis.data[7] = matr[6]*temp[1] + matr[7]*temp[4] + matr[8]*temp[7];\n\t\tthis.data[8] = matr[6]*temp[2] + matr[7]*temp[5] + matr[8]*temp[8];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCreates a translation matrix and appends it.\n\t * \t!translate (x: number, y: number) : Matrix;\n\t */\n\ttranslate: function (x, y)\n\t{\n\t\tif (x == 0 && y == 0)\n\t\t\treturn this;\n\n\t\tfor (let i = 0; i < 9; i++) temp[i] = this.data[i];\n\n\t\tthis.data[6] = x*temp[0] + y*temp[3] + temp[6];\n\t\tthis.data[7] = x*temp[1] + y*temp[4] + temp[7];\n\t\tthis.data[8] = x*temp[2] + y*temp[5] + temp[8];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCreates a rotation matrix for the given angle (in radians) and appends it.\n\t * \t!rotate (angle: number) : Matrix;\n\t */\n\trotate: function (angle)\n\t{\n\t\tif (angle == 0)\n\t\t\treturn this;\n\n\t\tthis.identity(temp2);\n\n\t\tlet cost = Math.cos(angle);\n\t\tlet sint = Math.sin(angle);\n\n\t\ttemp2[0] = cost;\n\t\ttemp2[1] = -sint;\n\t\ttemp2[3] = sint;\n\t\ttemp2[4] = cost;\n\n\t\treturn this.append(temp2);\n\t},\n\n\t/**\n\t * \tCreates a scaling matrix and appends it.\n\t * \t!scale (sx: number, sy: number) : Matrix;\n\t */\n\tscale: function (sx, sy)\n\t{\n\t\tif (sx == 1 && sy == 1)\n\t\t\treturn this;\n\n\t\tthis.identity(temp2);\n\n\t\ttemp2[0] = sx;\n\t\ttemp2[4] = sy;\n\n\t\treturn this.append(temp2);\n\t},\n\n\t/**\n\t * \tApplies the matrix to the specified vector (matrix-vector multiplication) and returns a new Vec2.\n\t * \t!applyTo (vect: Vec2) : Vec2;\n\t */\n\t/**\n\t * \tApplies the matrix to the specified coordinates (matrix-vector multiplication) and returns a new Vec2.\n\t * \t!applyTo (x: number, y: number) : Vec2;\n\t */\n\tapplyTo: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tconst v = x;\n\t\t\tx = v.x;\n\t\t\ty = v.y;\n\t\t}\n\n\t\tlet nx = this.data[0]*x + this.data[3]*y + this.data[6];\n\t\tlet ny = this.data[1]*x + this.data[4]*y + this.data[7];\n\n\t\treturn Vec2.Pool.alloc(nx, ny);\n\t},\n\n\t/**\n\t * \tTransposes the matrix.\n\t * \t!transpose() : Matrix;\n\t */\n\ttranspose: function ()\n\t{\n\t\ttemp.fill(0);\n\n\t\tfor (let j = 0; j < 3; j++)\n\t\tfor (let i = 0; i < 3; i++)\n\t\t\ttemp[j*3+i] = this.data[i*3+j];\n\n\t\tfor (let i = 0; i < 9; i++) this.data[i] = temp[i];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the determinant of the matrix.\n\t * \t!det() : number;\n\t */\n\tdet: function ()\n\t{\n\t\treturn\tthis.data[0] * (this.data[4]*this.data[8] - this.data[5]*this.data[7]) -\n\t\t\t\tthis.data[1] * (this.data[3]*this.data[8] - this.data[5]*this.data[6]) +\n\t\t\t\tthis.data[2] * (this.data[3]*this.data[7] - this.data[4]*this.data[6])\n\t\t\t\t;\n\t},\n\n\t/**\n\t * \tReturns a new matrix with the adjoint of the current matrix.\n\t * \t!adj() : Matrix;\n\t */\n\tadj: function () // violet:verify and fix\n\t{\n\t\t/*let t = this.transpose();\n\t\tlet d = Matrix.Pool.alloc();\n\n\t\td.data[0] = (t.data[4]*t.data[8] - t.data[5]*t.data[7]);\n\t\td.data[1] = -(t.data[3]*t.data[8] - t.data[5]*t.data[6]);\n\t\td.data[2] = (t.data[3]*t.data[7] - t.data[4]*t.data[6]);\n\n\t\td.data[3] = -(t.data[1]*t.data[8] - t.data[2]*t.data[7]);\n\t\td.data[4] = (t.data[0]*t.data[8] - t.data[2]*t.data[6]);\n\t\td.data[5] = -(t.data[0]*t.data[7] - t.data[1]*t.data[6]);\n\n\t\td.data[6] = (t.data[1]*t.data[5] - t.data[2]*t.data[4]);\n\t\td.data[7] = -(t.data[0]*t.data[5] - t.data[2]*t.data[3]);\n\t\td.data[8] = (t.data[0]*t.data[4] - t.data[1]*t.data[3]);\n\n\t\tt.data = d;\n\t\treturn t;*/\n\t\tthrow new Error('NOT IMPLEMENTED');\n\t},\n\n\t/**\n\t * \tReturns a new matrix with the inverse of the current matrix.\n\t * \t!inverse() : Matrix;\n\t */\n\tinverse: function ()\n\t{\n\t\tlet det = this.det();\n\t\tif (!det) return null;\n\n\t\treturn this.adj().scalef(1/det);\n\t},\n\n\t/**\n\t * \tReturns a string representation of the matrix.\n\t * \t!toString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn `[${this.data[0]}, ${this.data[3]}, ${this.data[6]}]\\n[${this.data[1]}, ${this.data[4]}, ${this.data[7]}]\\n[${this.data[2]}, ${this.data[5]}, ${this.data[8]}]\\n`;\n\t}\n});\n\n/**\n * \tSets the components of the specified array as the identity matrix.\n * \t!static loadIdentity (target: Float32Array) : void;\n */\nMatrix.loadIdentity = function (target)\n{\n\ttarget.fill(0);\n\ttarget[0] = target[4] = target[8] = 1;\n};\n\n//!/class\n\n//!namespace Matrix\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a new matrix copying the components from the specified matrix.\n\t * \t!function alloc (value: Matrix): Matrix;\n\t */\n\t/**\n\t * \tAllocates a new matrix with the values from the specified array.\n\t * \t!function alloc (value: Float32Array): Matrix;\n\t */\n\t/**\n\t * \tAllocates a new matrix with the identity matrix values.\n\t * \t!function alloc (): Matrix;\n\t */\n\nRecycler.createPool (Matrix, 4096, 1024);\nexport default Matrix;\n","/*\n**\tsystem/shader.js\n**\n**\tCopyright (c) 2021-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport globals from './globals.js';\n\n//![import \"./globals\"]\n\n//:/**\n//: * \tDescribes a shader object. The actual shader type is specified at construction.\n//: */\n\n//!class Shader\n\nconst Shader = Class.extend\n({\n\t/**\n\t * \tIdentifier of the shader.\n\t * \t!readonly id: string;\n\t */\n\tid: null,\n\n\t/**\n\t * \tType of the shader.\n\t * \t!readonly type: Shader.Type;\n\t */\n\ttype: 0,\n\n\t/**\n\t * \tSource code of the shader.\n\t */\n\tsourceCode: null,\n\n\t/**\n\t * \tShader GL identifier.\n\t * \t!readonly shaderId: number;\n\t */\n\tshaderId: null,\n\n\t/**\n\t *\tConstructs an empty shader. Attach GLSL code by using the `source` method.\n\t * \t!constructor (id: string, type: Shader.Type);\n\t */\n\t__ctor: function (id, type)\n\t{\n\t\tthis.id = id;\n\t\tthis.type = type;\n\n\t\tthis.sourceCode = '';\n\t\tthis.shaderId = null;\n\n\t\tShader.put(id, this);\n\t},\n\n\t/**\n\t * \tDestroys the shader.\n\t */\n\t__dtor: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (!gl) return;\n\n\t\tgl.deleteShader(this.shaderId);\n\t\tShader.remove(this.id);\n\t},\n\n\t/**\n\t * \tAppends GLSL code to the shader's source code buffer.\n\t * \t!source (value: string) : Shader;\n\t */\n\tsource: function (value)\n\t{\n\t\tthis.sourceCode += value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCompiles the shader. Errors can be obtained using getError() method.\n\t * \t!compile() : void;\n\t */\n\tcompile: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (!gl) return;\n\n\t\tthis.shaderId = gl.createShader (this.type === Shader.Type.VERTEX ? gl.VERTEX_SHADER : (this.type === Shader.Type.FRAGMENT ? gl.FRAGMENT_SHADER : gl.GEOMETRY_SHADER));\n\n\t\tgl.shaderSource(this.shaderId, this.sourceCode);\n\t\tgl.compileShader(this.shaderId);\n\t},\n\n\t/**\n\t * \tReturns the error of the last compile operation.\n\t * \t!getError() : string;\n\t */\n\tgetError: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (!gl) return '';\n\n\t\tif (this.shaderId === null)\n\t\t\treturn 'Shader has not been compiled.';\n\n\t\treturn gl.getShaderInfoLog(this.shaderId);\n\t}\n});\n\n//!/class\n\n/**\n * \tGlobal shader list.\n */\nShader.shaders = { };\n\n/**\n * \tStores a shader with the specified identifier in the global shader list.\n * \t!static put (id: string, shader: Shader) : void;\n */\nShader.put = function (id, shader)\n{\n\tthis.shaders[id] = shader;\n};\n\n/**\n * \tReturns a Shader from the global shader list given its identifier.\n * \t!static get (id: string) : Shader;\n */\nShader.get = function (id)\n{\n\treturn this.shaders[id];\n};\n\n/**\n * \tRemoves a shader from the global shader list.\n * \t!static remove (id: string) : void;\n */\nShader.remove = function (id)\n{\n\tdelete this.shaders[id];\n};\n\n//!namespace Shader\n\n//:/**\n//: * \tShader types.\n//: */\n\n//!enum Type\n\nShader.Type = {\n\tVERTEX: 0,\n\t//!VERTEX\n\tFRAGMENT: 1,\n\t//!FRAGMENT\n\tGEOMETRY: 2,\n\t//!GEOMETRY\n};\n\n//!/enum\n\nexport default Shader;\n","/*\n**\tsystem/shader-program.js\n**\n**\tCopyright (c) 2021-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Shader from './shader.js';\nimport globals from './globals.js';\n\n//![import \"./shader\"]\n//![import \"./globals\"]\n\n//:/**\n//: * \tDescribes a shader program.\n//: */\n\n//!class ShaderProgram\n\nconst ShaderProgram = Class.extend\n({\n\t/**\n\t * \tLocations of the generic uniforms.\n\t * \n\t *\t!readonly uniform_location_matrix: number;\n\t *\t!readonly uniform_transform_matrix: number;\n\t *\t!readonly uniform_texture_matrix: number;\n\t *\t!readonly uniform_resolution: number;\n\t *\t!readonly uniform_texture_size: number;\n\t *\t!readonly uniform_frame_size: number;\n\t *\t!readonly uniform_base_color: number;\n\t *\t!readonly uniform_time: number;\n\t *\t!readonly uniform_depth: number;\n\t *\t!readonly uniform_scale: number;\n\t *\t!readonly uniform_alpha: number;\n\t *\t!readonly uniform_texture_0: number;\n\t */\n\n\tuniform_location_matrix: 0, /* mat3 */\n\tuniform_transform_matrix: 0, /* mat3 */\n\tuniform_texture_matrix: 0, /* mat3 */\n\n\tuniform_resolution: 0, /* vec2 */\n\tuniform_texture_size: 0, /* vec2 */\n\tuniform_frame_size: 0, /* vec2 */\n\tuniform_base_color: 0, /* vec4 */\n\n\tuniform_time: 0, /* float */\n\tuniform_depth: 0, /* float */\n\tuniform_scale: 0, /* float */\n\tuniform_alpha: 0, /* float */\n\n\tuniform_texture_0: 0,\n\n\t/**\n\t * \tLocations of the generic attributes.\n\t * \t!readonly attrib_location: number;\n\t */\n\tattrib_location: 0x00, /* vec2 */\n\n\t/**\n\t * \tIdentifier of the program.\n\t * \t!readonly id: string;\n\t */\n\tid: null,\n\n\t/**\n\t * \tShaders attached to the program.\n\t * \t!readonly shaders: Array<Shader>;\n\t */\n\tshaders: null,\n\n\t/**\n\t * \tShader program GL identifier.\n\t * \t!readonly programId: number;\n\t */\n\tprogramId: null,\n\n\t/**\n\t *\tConstructs an empty shader program with the specified identifier. Attach shaders by using the `attach` method.\n\t * \t!constructor (id: string);\n\t */\n\t__ctor: function (id)\n\t{\n\t\tthis.id = id;\n\n\t\tthis.shaders = [];\n\t\tthis.programId = null;\n\n\t\tShaderProgram.put(id, this);\n\t},\n\n\t/**\n\t * \tDestroys the shader program.\n\t */\n\t__dtor: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (!gl) return this;\n\n\t\tgl.deleteProgram(this.programId);\n\t\tShaderProgram.remove(this.id);\n\t},\n\n\t/**\n\t * \tAttaches a shader to the shader program.\n\t * \t!attach (shader: Shader|string) : ShaderProgram;\n\t */\n\tattach: function (shader)\n\t{\n\t\tif (typeof(shader) === 'string')\n\t\t\tshader = Shader.get(shader);\n\n\t\tif (!shader)\n\t\t\tthrow new Error ('Unable to attach shader, invalid argument.');\n\n\t\tthis.shaders.push(shader);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tBinds the attribute locations to their predefined values.\n\t * \t!bindLocations (gl: WebGL2Context) : void;\n\t */\n\tbindLocations: function (gl)\n\t{\n\t\tgl.bindAttribLocation (this.programId, 0, 'location');\n\t},\n\n\t/**\n\t * \tLoads the locations of the predefined uniforms and attributes.\n\t * \t!loadLocations (gl: WebGL2Context) : void;\n\t */\n\tloadLocations: function (gl)\n\t{\n\t\tthis.uniform_location_matrix = gl.getUniformLocation (this.programId, 'm_location');\n\t\tthis.uniform_transform_matrix = gl.getUniformLocation (this.programId, 'm_transform');\n\t\tthis.uniform_texture_matrix = gl.getUniformLocation (this.programId, 'm_texture');\n\t\tthis.uniform_resolution = gl.getUniformLocation (this.programId, 'v_resolution');\n\t\tthis.uniform_texture_size = gl.getUniformLocation (this.programId, 'v_texture_size');\n\t\tthis.uniform_frame_size = gl.getUniformLocation (this.programId, 'v_frame_size');\n\t\tthis.uniform_base_color = gl.getUniformLocation (this.programId, 'v_base_color');\n\t\tthis.uniform_time = gl.getUniformLocation (this.programId, 'f_time');\n\t\tthis.uniform_depth = gl.getUniformLocation (this.programId, 'f_depth');\n\t\tthis.uniform_scale = gl.getUniformLocation (this.programId, 'f_scale');\n\t\tthis.uniform_alpha = gl.getUniformLocation (this.programId, 'f_alpha');\n\t\tthis.uniform_texture_0 = gl.getUniformLocation (this.programId, 'texture0');\n\n\t\tthis.attrib_location = gl.getAttribLocation (this.programId, 'location');\n\t},\n\n\t/**\n\t * \tLinks the shaders into the shader program. Completion can be obtained by calling `getStatus`.\n\t * \t!link() : ShaderProgram;\n\t */\n\tlink: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (!gl) return this;\n\n\t\tthis.programId = gl.createProgram();\n\n\t\tfor (let shader of this.shaders)\n\t\t\tgl.attachShader (this.programId, shader.shaderId);\n\n\t\tthis.bindLocations(gl);\n\t\tgl.linkProgram (this.programId);\n\t\tthis.loadLocations(gl);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tEnables the shader program to be used in the subsequent drawing operations.\n\t * \t!use() : void;\n\t */\n\tuse: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (!gl) return;\n\n\t\tgl.useProgram (this.programId);\n\t},\n\n\t/**\n\t * \tReturns the link status of the program.\n\t * \t!getStatus() : boolean;\n\t */\n\tgetStatus: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (!gl) return true;\n\n\t\treturn gl.getProgramParameter(this.programId, gl.LINK_STATUS);\n\t},\n\n\t/**\n\t * \tReturns the error of the last link operation.\n\t * \t!getError() : string;\n\t */\n\tgetError: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (!gl) return '';\n\n\t\tif (this.programId === null)\n\t\t\treturn 'Program has not been linked.';\n\n\t\treturn gl.getProgramInfoLog(this.programId);\n\t},\n\n\t/**\n\t * \tReturns the errors found in the program and all shaders.\n\t * \t!getAllErrors() : string;\n\t */\n\tgetAllErrors: function ()\n\t{\n\t\tlet e = '>> PROGRAM:\\n' + this.getError();\n\n\t\tfor (let shader of this.shaders)\n\t\t{\n\t\t\te += '\\n>> ' + (shader.type === Shader.Type.VERTEX ? 'vertex' : 'fragment').toUpperCase() + ':\\n' + shader.getError();\n\t\t}\n\n\t\treturn e;\n\t}\n});\n\n/**\n * \tGlobal shader program list.\n */\nShaderProgram.programs = { };\n\n/**\n * \tPuts a shader program in the global program list under the specified identifier.\n * \t!static put (id: string, shaderProgram: ShaderProgram) : void;\n */\nShaderProgram.put = function (id, shaderProgram)\n{\n\tthis.programs[id] = shaderProgram;\n};\n\n/**\n * \tReturns a shader program from the global program list given its identifier.\n * \t!static get (id: string) : ShaderProgram;\n */\nShaderProgram.get = function (id)\n{\n\treturn this.programs[id];\n};\n\n/**\n * \tRemoves a shader program from the global program list.\n * \t!static remove (id: string) : void;\n */\nShaderProgram.remove = function (id)\n{\n\tdelete this.programs[id];\n};\n\nexport default ShaderProgram;\n","/*\n**\tsystem/canvas.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rin } from '@rsthn/rin';\nimport Matrix from '../math/matrix.js';\nimport System from './system.js';\nimport List from '../utils/list.js';\nimport ShaderProgram from './shader-program.js';\nimport Shader from './shader.js';\nimport globals from './globals.js';\nimport Log from './log.js';\n\n//![import \"../math/matrix\"]\n//![import \"./system\"]\n//![import \"../utils/list\"]\n//![import \"./shader-program\"]\n//![import \"./shader\"]\n//![import \"./globals\"]\n//![import \"./log\"]\n\n//!namespace Canvas\n\n\t//!type Options =\n\n\t\t/**\n\t\t * \tActual HTML5 Canvas element, if `null` a new one will be created.\n\t\t * \t!elem: HTMLCanvasElement;\n\t\t */\n\t\t\n\t\t/**\n\t\t * \tWebGL enable flag.\n\t\t * \t!gl: boolean;\n\t\t */\n\n\t\t/**\n\t\t * \tBackground of the canvas element.\n\t\t * \t!background: string;\n\t\t */\n\n\t\t/**\n\t\t * \tWidth of the canvas.\n\t\t * \t!width: number;\n\t\t */\n\n\t\t/**\n\t\t * \tHeight of the canvas.\n\t\t * \t!height: number;\n\t\t */\n\n\t\t/**\n\t\t * \tIndicates if the canvas element should be hidden from view (not attached to the document body).\n\t\t * \t!hidden: boolean;\n\t\t */\n\n\t\t/**\n\t\t * \tSet to `true` to ensure the canvas is positioned absolutly to (0, 0).\n\t\t * \t!absolute: boolean;\n\t\t */\n\n\t\t/**\n\t\t * \tUsed to control the antialias property of the canvas.\n\t\t * \t!antialias: boolean;\n\t\t */\n\n\t//!/type\n\n//!/namespace\n\n//!class Canvas\n\n/**\n * \tConstructs a canvas object. If the Canvas DOM element is not provided a new element will be created and attached to the page.\n * \t!constructor (options: Canvas.Options);\n */\n\nconst Canvas = function (options=null)\n{\n\tlet opts = {\n\t\telem: null,\n\t\tgl: false,\n\t\tbackground: '#000000',\n\t\twidth: 0,\n\t\theight: 0,\n\t\thidden: true,\n\t\tabsolute: false,\n\t\tantialias: false,\n\t\t...options\n\t};\n\n\tconst headless = global.document ? false : true;\n\n\t// Create canvas element if required.\n\tif (opts.elem == null)\n\t{\n\t\tthis.elem = !headless ? global.document.createElement('canvas') : Rin.clone(Canvas.passThruCanvas);\n\n\t\tif (global.document && opts.hidden != true)\n\t\t{\n\t\t\tglobal.document.body.appendChild (this.elem);\n\n\t\t\tif (opts.absolute === true) {\n\t\t\t\tthis.elem.style.position = 'absolute';\n\t\t\t\tthis.elem.style.left = '0';\n\t\t\t\tthis.elem.style.top = '0';\n\t\t\t}\n\t\t}\n\t}\n\telse\n\t{\n\t\tthis.elem = opts.elem;\n\t}\n\n\tif (!this.elem.getContext) return;\n\n\tif (opts.gl === true && !headless)\n\t{\n\t\tthis.gl = this.elem.getContext('webgl2', { desynchronized: false, alpha: false });\n\t\tthis.context = null;\n\n\t\tLog.write(this.gl.getParameter(this.gl.VERSION) + ', ' + this.gl.getParameter(this.gl.SHADING_LANGUAGE_VERSION));\n\n\t\tglobals.gl = this.gl;\n\t}\n\telse\n\t{\n\t\tthis.context = this.elem.getContext('2d', { desynchronized: false });\n\t\tthis.gl = null;\n\t}\n\n\t// State stack support.\n\tthis.matrixStack = List.Pool.alloc();\n\tthis.alphaStack = List.Pool.alloc();\n\tthis.depthFlagStack = List.Pool.alloc();\n\tthis.shaderProgramStack = List.Pool.alloc();\n\n\tthis.matr = Matrix.Pool.alloc();\n\tthis.transform = Matrix.Pool.alloc();\n\n\t// Default context values.\n\tthis._globalScale = 1.0;\n\tthis._alpha = 1.0;\n\tthis._depthFlag = true;\n\tthis.shaderProgram = null;\n\n\t// Set initial transformation matrix.\n\tthis.updateTransform();\n\tthis.strokeStyle(\"#fff\");\n\tthis.fillStyle(\"#fff\");\n\n\tif (opts.width && opts.height)\n\tthis.resize (opts.width, opts.height);\n\n\tif (this.gl !== null)\n\t\tthis.initGl();\n\n\tthis.antialias = opts.antialias;\n\tthis.setBackground (opts.background);\n};\n\nCanvas.passThruCanvas = \n{\n\tparentNode: null,\n\n\timageSmoothingEnabled: true,\n\n\tstyle: {\n\t},\n\n\twidth: 960,\n\theight: 540,\n\n\tgetContext: function (renderingContext) {\n\t\treturn this;\n\t},\n\n\tpushClip: function() {\n\t},\n\n\tpopClip: function() {\n\t},\n\n\tscale: function (sx, sy) {\n\t},\n\n\trotate: function (angle) {\n\t},\n\n\ttranslate: function (x, y) {\n\t},\n\n\tsetTransform: function (a, b, c, d, e, f) {\n\t},\n\n\tupdateTransform: function () {\n\t},\n\n\ttoDataURL: function (mime, params) {\n\t\treturn '';\n\t},\n\n\tbeginPath: function () {\n\t},\n\n\tmoveTo: function (x, y) {\n\t},\n\n\tclosePath: function() {\n\t},\n\n\tlineTo: function() {\n\t},\n\n\trect: function(x, y, w, h) {\n\t},\n\n\tfill: function() {\n\t},\n\n\tstroke: function() {\n\t},\n\n\tfillRect: function(x, y, w, h) {\n\t},\n\n\tstrokeRect: function(x, y, w, h) {\n\t},\n\n\tclip: function() {\n\t},\n\n\tquadraticCurveTo: function (cpx, cpy, x, y) {\n\t},\n\n\tbezierCurveTo: function (cx1, cy1, cx2, cy2, x, y) {\n\t},\n\n\tarc: function (x, y, r, sA, eA, cw) {\n\t},\n\n\tarcTo: function (x1, y1, x2, y2, r) {\n\t},\n\n\tfillText: function (text, x, y, maxWidth) {\n\t},\n\n\tstrokeText: function (text, x, y, maxWidth) {\n\t},\n\n\tmeasureText: function (text) {\n\t\treturn { width: 0 };\n\t},\n\n\tcreateImageData: function (w, h) {\n\t\treturn { width: w, height: h };\n\t},\n\n\tgetImageData: function (x, y, w, h) {\n\t\treturn { width: w, height: h, data: [] };\n\t},\n\n\tputImageData: function (data, x, y) {\n\t},\n\n\tdrawImage: function (img, sx=0, sy=0, sw=null, sh=null, dx=null, dy=null, dw=null, dh=null, textureWidth=null, textureHeight=null, frameWidth=null, frameHeight=null) {\n\t},\n\n\tgetBoundingClientRect: function () {\n\t\treturn { left: 0, top: 0 };\n\t}\n};\n\n/**\n * \tInitializes the OpenGL ES context.\n */\nCanvas.prototype.initGl = function ()\n{\n\tlet gl = this.gl;\n\n\t// This code is required if \"desynchronized\" is set to true (for some reason).\n\t//if (navigator && navigator.userAgent.toLowerCase().indexOf('firefox') > -1)\n\t//\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n\t//else\n\t//\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);\n\n\t/**\n\t * \tCreate the default shader program.\n\t */\n\tthis.glDefaultProgram = new ShaderProgram('def');\n\n\t(new Shader ('def-vert', Shader.Type.VERTEX))\n\t.source(\n\t\t`#version 300 es\n\t\tprecision highp float;\n\n\t\tuniform mat3 m_location;\n\t\tuniform mat3 m_transform;\n\t\tuniform mat3 m_texture;\n\n\t\tuniform vec2 v_resolution;\n\t\tuniform vec2 v_texture_size;\n\t\tuniform vec2 v_frame_size;\n\n\t\tuniform float f_time;\n\t\tuniform float f_depth;\n\n\t\tuniform sampler2D texture0;\n\n\t\tin vec2 location;\n\t\tout vec2 texcoords;\n\n\t\tvoid main()\n\t\t{\n\t\t\tgl_Position = vec4(((vec2(m_transform * m_location * vec3(location, 1.0)) / v_resolution)*2.0 - vec2(1.0, 1.0)) * vec2(1.0, -1.0), f_depth / 16777216.0, 1.0);\n\t\t\ttexcoords = vec2(m_texture * vec3(location, 1.0)) / v_texture_size;\n\t\t}\n\t`)\n\t.compile();\n\n\t(new Shader ('def-frag', Shader.Type.FRAGMENT))\n\t.source(\n\t\t`#version 300 es\n\t\tprecision highp float;\n\n\t\tuniform sampler2D texture0;\n\t\tuniform float f_alpha;\n\t\tin vec2 texcoords;\n\n\t\tout vec4 color;\n\n\t\tvoid main()\n\t\t{\n\t\t\tcolor = texture(texture0, texcoords);\n\t\t\tcolor.a *= f_alpha;\n\n\t\t\tif (color.a == 0.0) discard;\n\t\t}\n\t`)\n\t.compile();\n\n\t/**\n\t * \tCreate repeat (tileable) shader program.\n\t */\n\tthis.glRepeatProgram = new ShaderProgram('repeat');\n\n\t(new Shader ('repeat-vert', Shader.Type.VERTEX))\n\t.source(\n\t\t`#version 300 es\n\t\tprecision highp float;\n\t\t\n\t\tuniform mat3 m_location;\n\t\tuniform mat3 m_transform;\n\t\tuniform mat3 m_texture;\n\t\t\n\t\tuniform vec2 v_resolution;\n\t\tuniform vec2 v_texture_size;\n\t\tuniform vec2 v_frame_size;\n\t\t\n\t\tuniform float f_time;\n\t\tuniform float f_depth;\n\t\t\n\t\tuniform sampler2D texture0;\n\t\t\n\t\tin vec2 location;\n\t\tout vec2 texcoords;\n\t\t\n\t\tout vec2 texoffs;\n\t\tout vec2 texsiz;\n\t\t\n\t\tvoid main()\n\t\t{\n\t\t\tgl_Position = vec4(((vec2(m_transform * m_location * vec3(location, 1.0)) / v_resolution)*2.0 - vec2(1.0, 1.0)) * vec2(1.0, -1.0), f_depth / 16777216.0, 1.0);\n\t\t\n\t\t\ttexcoords = vec2(\n\t\t\t\t(location.x*m_texture[0][0]/v_texture_size[0])*(m_location[0][0] / v_frame_size[0]),\n\t\t\t\t(location.y*m_texture[1][1]/v_texture_size[1])*(m_location[1][1] / v_frame_size[1])\n\t\t\t);\n\t\t\n\t\t\ttexoffs = vec2(m_texture[2][0]/v_texture_size[0], m_texture[2][1]/v_texture_size[1]);\n\t\t\ttexsiz = vec2(m_texture[0][0]/v_texture_size[0], m_texture[1][1]/v_texture_size[1]);\n\t\t}\n\t`)\n\t.compile();\n\n\t(new Shader ('repeat-frag', Shader.Type.FRAGMENT))\n\t.source(\n\t\t`#version 300 es\n\t\tprecision highp float;\n\t\t\n\t\tuniform mat3 m_texture;\n\t\tuniform vec2 v_texture_size;\n\t\t\n\t\tuniform sampler2D texture0;\n\t\tuniform float f_alpha;\n\t\t\n\t\tin vec2 texcoords;\n\t\tin vec2 texoffs;\n\t\tin vec2 texsiz;\n\t\t\n\t\tout vec4 color;\n\t\t\n\t\tvoid main()\n\t\t{\n\t\t\tcolor = texture(texture0, mod(texcoords, texsiz) + texoffs);\n\t\t\n\t\t\tcolor.a *= f_alpha;\n\t\t\tif (color.a == 0.0) discard;\n\t\t}\n\t`)\n\t.compile();\n\n\t/**\n\t * \tCreate the frame buffer blit shader program.\n\t */\n\tthis.glBlitProgram = new ShaderProgram('blit');\n\n\t(new Shader ('blit-vert', Shader.Type.VERTEX))\n\t.source(\n\t\t`#version 300 es\n\t\tprecision highp float;\n\n\t\tuniform mat3 m_location;\n\t\tuniform mat3 m_texture;\n\t\tuniform vec2 v_resolution;\n\t\tuniform vec2 v_texture_size;\n\n\t\tuniform sampler2D texture0;\n\n\t\tin vec2 location;\n\t\tout vec2 texcoords;\n\n\t\tvoid main()\n\t\t{\n\t\t\tgl_Position = vec4(((vec2(m_location * vec3(location, 1.0)) / v_resolution)*2.0 - vec2(1.0, 1.0)) * vec2(1.0, 1.0), 0.0, 1.0);\n\t\t\ttexcoords = vec2(m_texture * vec3(location, 1.0)) / v_texture_size;\n\t\t}\n\t`)\n\t.compile();\n\n\t(new Shader ('blit-frag', Shader.Type.FRAGMENT))\n\t.source(\n\t\t`#version 300 es\n\t\tprecision highp float;\n\n\t\tuniform sampler2D texture0;\n\t\tin vec2 texcoords;\n\n\t\tout vec4 color;\n\n\t\tvoid main()\n\t\t{\n\t\t\tcolor = texture(texture0, texcoords);\n\t\t}\n\t`)\n\t.compile();\n\n\t/* ****** */\n\tthis.glDefaultProgram.attach('def-vert');\n\tthis.glDefaultProgram.attach('def-frag');\n\n\tthis.glRepeatProgram.attach('repeat-vert');\n\tthis.glRepeatProgram.attach('repeat-frag');\n\n\tthis.glBlitProgram.attach('blit-vert');\n\tthis.glBlitProgram.attach('blit-frag');\n\n\tthis.glDefaultProgram.link();\n\tthis.glRepeatProgram.link();\n\tthis.glBlitProgram.link();\n\n\tif (!this.glDefaultProgram.getStatus())\n\t\tthrow new Error (this.glDefaultProgram.getAllErrors());\n\n\tif (!this.glRepeatProgram.getStatus())\n\t\tthrow new Error (this.glRepeatProgram.getAllErrors());\n\n\tif (!this.glBlitProgram.getStatus())\n\t\tthrow new Error (this.glBlitProgram.getAllErrors());\n\n\tthis.setShaderProgram(this.glDefaultProgram);\n\n\t/**\n\t * \tCreate the vertex buffer.\n\t */\n\tlet buffer = this.attrib_location_buffer = gl.createBuffer();\n\tgl.bindBuffer (gl.ARRAY_BUFFER, buffer);\n\tgl.bufferData (gl.ARRAY_BUFFER, new Float32Array ([0, 0, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\n\n\tgl.enableVertexAttribArray (this.shaderProgram.attrib_location);\n\tgl.vertexAttribPointer (this.shaderProgram.attrib_location, 2, gl.FLOAT, gl.FALSE, 2*Float32Array.BYTES_PER_ELEMENT, 0*Float32Array.BYTES_PER_ELEMENT);\n\n\t/**\n\t * \tSetup initial GL configuration.\n\t */\n\tgl.clearColor (0, 0, 0, 1.0);\n\n\tgl.enable (gl.DEPTH_TEST);\n\tgl.clearDepth (0.0);\n\tgl.depthFunc (gl.GEQUAL);\n\n\tgl.enable (gl.BLEND);\n\tgl.blendFunc (gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\n\t/**\n\t * \tSetup frame buffer.\n\t */\n\n\t/* *** */\n\tthis.m_location = new Float32Array(9).fill(0);\n\tthis.m_texture = new Float32Array(9).fill(0);\n\tthis.v_texture_size = new Float32Array(2).fill(0);\n\tthis.v_frame_size = new Float32Array(2).fill(0);\n\tthis.v_resolution = new Float32Array(2).fill(0);\n\tthis.zvalue = 0;\n\n\tMatrix.loadIdentity(this.m_location);\n\tMatrix.loadIdentity(this.m_texture);\n\n\t// drawImage (Image img, float x, float y);\n\t// drawImage (Image img, float x, float y, float w, float h);\n\t// drawImage (Image img, float sx, float sy, float sw, float sh, float dx, float dy, float dw, float dh);\n\t// drawImage (Image img, float sx, float sy, float sw, float sh, float dx, float dy, float dw, float dh, float textureWidth, float textureHeight, float frameWidth, float frameHeight);\n\tthis.drawImage = function (img, sx=0, sy=0, sw=null, sh=null, dx=null, dy=null, dw=null, dh=null, textureWidth=null, textureHeight=null, frameWidth=null, frameHeight=null)\n\t{\n\t\tif (!img.glTextureReady)\n\t\t\treturn;\n\n\t\tlet gl = this.gl;\n\t\tlet program = this.shaderProgram;\n\n\t\tif (textureWidth === null)\n\t\t{\n\t\t\ttextureWidth = img.width;\n\t\t\ttextureHeight = img.height;\n\t\t}\n\n\t\tif (frameWidth === null)\n\t\t{\n\t\t\tframeWidth = img.targetWidth;\n\t\t\tframeHeight = img.targetHeight;\n\t\t}\n\n\t\tgl.uniform2fv (program.uniform_resolution, this.v_resolution);\n\t\tgl.uniform1f (program.uniform_time, globals.time);\n\t\tgl.uniform1f (program.uniform_scale, this._globalScale);\n\t\tgl.uniform1f (program.uniform_alpha, this._alpha);\n\n\t\tif (this.glActiveTextureId !== img.glTextureId || this.glActiveShader !== program)\n\t\t{\n\t\t\tgl.activeTexture (gl.TEXTURE0);\n\t\t\tgl.bindTexture (gl.TEXTURE_2D, img.glTextureId);\n\t\t\tgl.uniform1i (program.uniform_texture_0, 0);\n\n\t\t\tthis.v_texture_size[0] = textureWidth;\n\t\t\tthis.v_texture_size[1] = textureHeight;\n\t\t\tgl.uniform2fv (program.uniform_texture_size, this.v_texture_size);\n\n\t\t\tthis.v_frame_size[0] = frameWidth;\n\t\t\tthis.v_frame_size[1] = frameHeight;\n\t\t\tgl.uniform2fv (program.uniform_frame_size, this.v_frame_size);\n\n\t\t\tthis.glActiveTextureId = img.glTextureId;\n\t\t\tthis.glActiveShader = program;\n\t\t}\n\n\t\t// [3] image, x, y\n\t\tif (sw === null)\n\t\t{\n\t\t\tthis.m_location[0] = textureWidth;\n\t\t\tthis.m_location[4] = textureHeight;\n\t\t\tthis.m_location[6] = sx;\n\t\t\tthis.m_location[7] = sy;\n\n\t\t\tthis.m_texture[0] = textureWidth;\n\t\t\tthis.m_texture[4] = textureHeight;\n\t\t\tthis.m_texture[6] = 0;\n\t\t\tthis.m_texture[7] = 0;\n\n\t\t\tgl.uniformMatrix3fv (program.uniform_transform_matrix, false, this.transform.data);\n\t\t\tgl.uniformMatrix3fv (program.uniform_location_matrix, false, this.m_location);\n\t\t\tgl.uniformMatrix3fv (program.uniform_texture_matrix, false, this.m_texture);\n\t\t\tgl.uniform1f (program.uniform_depth, this.zvalue);\n\t\t\tgl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\n\t\t\treturn;\n\t\t}\n\n\t\t// [5] image, x, y, width, height\n\t\tif (dx === null)\n\t\t{\n\t\t\tthis.m_location[0] = sw;\n\t\t\tthis.m_location[4] = sh;\n\t\t\tthis.m_location[6] = sx;\n\t\t\tthis.m_location[7] = sy;\n\n\t\t\tthis.m_texture[0] = textureWidth;\n\t\t\tthis.m_texture[4] = textureHeight;\n\t\t\tthis.m_texture[6] = 0;\n\t\t\tthis.m_texture[7] = 0;\n\n\t\t\tgl.uniformMatrix3fv (program.uniform_transform_matrix, false, this.transform.data);\n\t\t\tgl.uniformMatrix3fv (program.uniform_location_matrix, false, this.m_location);\n\t\t\tgl.uniformMatrix3fv (program.uniform_texture_matrix, false, this.m_texture);\n\t\t\tgl.uniform1f (program.uniform_depth, this.zvalue);\n\t\t\tgl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\n\t\t\treturn;\n\t\t}\n\n\t\t// [9] image, sx, sy, sw, sh, dx, dy, dw, dh\n\t\tthis.m_location[0] = dw;\n\t\tthis.m_location[4] = dh;\n\t\tthis.m_location[6] = dx;\n\t\tthis.m_location[7] = dy;\n\n\t\tthis.m_texture[0] = sw;\n\t\tthis.m_texture[4] = sh;\n\t\tthis.m_texture[6] = sx;\n\t\tthis.m_texture[7] = sy;\n\n\t\tgl.uniformMatrix3fv (program.uniform_transform_matrix, false, this.transform.data);\n\t\tgl.uniformMatrix3fv (program.uniform_location_matrix, false, this.m_location);\n\t\tgl.uniformMatrix3fv (program.uniform_texture_matrix, false, this.m_texture);\n\t\tgl.uniform1f (program.uniform_depth, this.zvalue);\n\t\tgl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\t};\n\n\t// drawRect (float x, float y, float w, float h);\n\tthis.drawRect = function (x, y, w, h)\n\t{\n\t\tlet gl = this.gl;\n\t\tlet program = this.shaderProgram;\n\n\t\tgl.uniform2fv (program.uniform_resolution, this.v_resolution);\n\t\tgl.uniform1f (program.uniform_time, globals.time);\n\t\tgl.uniform1f (program.uniform_scale, this._globalScale);\n\t\tgl.uniform1f (program.uniform_alpha, this._alpha);\n\n\t\tthis.glActiveTextureId = null;\n\n\t\tthis.v_texture_size[0] = w;\n\t\tthis.v_texture_size[1] = h;\n\t\tgl.uniform2fv (program.uniform_texture_size, this.v_texture_size);\n\n\t\tthis.m_location[0] = w;\n\t\tthis.m_location[4] = h;\n\t\tthis.m_location[6] = x;\n\t\tthis.m_location[7] = y;\n\n\t\tthis.m_texture[0] = w;\n\t\tthis.m_texture[4] = h;\n\t\tthis.m_texture[6] = 0;\n\t\tthis.m_texture[7] = 0;\n\n\t\tgl.uniformMatrix3fv (program.uniform_transform_matrix, false, this.transform.data);\n\t\tgl.uniformMatrix3fv (program.uniform_location_matrix, false, this.m_location);\n\t\tgl.uniformMatrix3fv (program.uniform_texture_matrix, false, this.m_texture);\n\t\tgl.uniform1f (program.uniform_depth, this.zvalue);\n\t\tgl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\t};\n};\n\n\n/**\n * \tPrepares an image to use it on the canvas. Used only when GL mode is active.\n * \t!prepareImage (image: HTMLImageElement) : boolean;\n */\nCanvas.prototype.prepareImage = function (image)\n{\n\tlet gl = this.gl;\n\tif (gl == null) return false;\n\n\tlet texture = gl.createTexture();\n\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\n\tgl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA8, image.width, image.height);\n\tgl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, image.width, image.height, gl.RGBA, gl.UNSIGNED_BYTE, image);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n\timage.glTextureId = texture;\n\timage.glTextureReady = true;\n\n\treturn true;\n};\n\n/**\n * \tConfigures the texture related to specified image to gl.REPEAT.\n * \t!setWrapRepeat (image: HTMLImageElement) : HTMLImageElement;\n */\nCanvas.prototype.setWrapRepeat = function (image)\n{\n\tlet gl = this.gl;\n\tif (gl == null || !image.glTextureReady) return image;\n\n\tgl.bindTexture(gl.TEXTURE_2D, image.glTextureId);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n\n\treturn image;\n};\n\n/**\n * \tApplies the current config to the canvas (usually called after a reset on the canvas).\n */\nCanvas.prototype.applyConfig = function ()\n{\n\tif (this.antialias == false)\n\t{\n\t\tif (this.context != null)\n\t\t\tthis.context.imageSmoothingEnabled = false;\n\n\t\tthis.elem.style.imageRendering = 'crisp-edges';\n\t}\n\telse\n\t{\n\t\tif (this.context != null)\n\t\t\tthis.context.imageSmoothingEnabled = true;\n\n\t\tthis.elem.style.imageRendering = 'auto';\n\t}\n};\n\n/**\n * \tDisposes the resources used by the canvas. The HTMLCanvasElement will also be removed from the document.\n */\nCanvas.prototype.dispose = function ()\n{\n\tif (this.elem.parentNode)\n\t\tthis.elem.parentNode.removeChild (this.elem);\n\n\tthis.matrixStack.free();\n\tthis.alphaStack.free();\n\tthis.depthFlagStack.free();\n\tthis.shaderProgramStack.free();\n\n\tthis.matr = null;\n\tthis.context = null;\n\tthis.elem = null;\n};\n\n/**\n * \tSets the default background color of the canvas. Does not cause a canvas clear.\n * \t!setBackground (color: string) : void;\n */\nCanvas.prototype.setBackground = function (color)\n{\n\tthis.elem.style.background = color;\n\tthis.backgroundColor = color;\n\n\tif (this.gl !== null)\n\t{\n\t\tif (color.length != 7)\n\t\t\tthrow new Error ('Canvas.setBackground: color parameter should be CSS-style hex-rgb with 6 digits.');\n\n\t\tlet r = parseInt(color.substr(1,2), 16) / 255.0;\n\t\tlet g = parseInt(color.substr(3,2), 16) / 255.0;\n\t\tlet b = parseInt(color.substr(5,2), 16) / 255.0;\n\n\t\tthis.gl.clearColor (r, g, b, 1.0);\n\t}\n};\n\n/**\n * \tSets the canvas size.\n * \t!resize (width: number, height: number) : Canvas;\n */\nCanvas.prototype.resize = function (width, height)\n{\n\tlet rect = this.elem.getBoundingClientRect();\n\n\tif (!width) width = rect.width;\n\tif (!height) height = rect.height;\n\n\tthis.elem.width = width;\n\tthis.elem.height = height;\n\n\tthis.width = this.elem.width;\n\tthis.height = this.elem.height;\n\n\tthis._width = int(this.width / this._globalScale);\n\tthis._height = int(this.height / this._globalScale);\n\n\tlet gl = this.gl;\n\tif (gl != null)\n\t{\n\t\tgl.enable (gl.SCISSOR_TEST);\n\t\tgl.scissor (0, 0, this.width, this.height);\n\t\tgl.viewport (0, 0, this.width, this.height);\n\n\t\tif (this.v_resolution)\n\t\t{\n\t\t\t//violet:hardware scaling\n\t\t\t//this.v_resolution[0] = this._width;\n\t\t\t//this.v_resolution[1] = this._height;\n\n\t\t\tthis.v_resolution[0] = this.width;\n\t\t\tthis.v_resolution[1] = this.height;\n\t\t}\n\t}\n\n\tthis.applyConfig();\n\treturn this;\n};\n\n/**\n * \tSets the global canvas scale.\n * \t!globalScale (value: number) : Canvas;\n */\nCanvas.prototype.globalScale = function (value)\n{\n\tthis._globalScale = value;\n\n\tthis._width = int(this.width / this._globalScale);\n\tthis._height = int(this.height / this._globalScale);\n\n\tthis.loadIdentity();\n\n\t//violet:hardware scaling\n\t//if (this.gl === null)\n\t\tthis.scale(value, value);\n\n\treturn this;\n};\n\n/**\n * \tSets the flipped status of the canvas, that is, if the canvas coordinates are flipped (i.e. `xy` is now `yx`).\n * \t!flipped (value: boolean) : Canvas;\n */\nCanvas.prototype.flipped = function (value)\n{\n\tif (value)\n\t{\n\t\tthis._width = int(this.height / this._globalScale);\n\t\tthis._height = int(this.width / this._globalScale);\n\t}\n\telse\n\t{\n\t\tthis._width = int(this.width / this._globalScale);\n\t\tthis._height = int(this.height / this._globalScale);\n\t}\n\n\tthis.isFlipped = value;\n\treturn this;\n};\n\n/**\n * \tSaves the clip state of the canvas. Works only in GL mode.\n * \t!pushClip() : Canvas;\n */\nCanvas.prototype.pushClip = function ()\n{\n\treturn this;\n};\n\n/**\n * \tRestores the clip state of the canvas. Works only in GL mode.\n * \t!popClip() : Canvas;\n */\nCanvas.prototype.popClip = function ()\n{\n\tif (this.gl != null)\n\t\tthis.gl.scissor(0, 0, this.width, this.height);\n\n\treturn this;\n};\n\n/**\n * \tReturns the image on the canvas as a string in DATA-URI format.\n * \t!toDataUrl (mime: string, params?: object) : string;\n */\nCanvas.prototype.toDataUrl = function (mime='image/png', params=null)\n{\n\treturn this.elem.toDataURL (mime, params);\n};\n\n/**\n * \tReturns the image as a Base-64 encoded PNG string.\n * \t!toPngBase64() : string;\n */\nCanvas.prototype.toPngBase64 = function ()\n{\n\treturn this.elem.toDataURL(\"image/png\").substr(22);\n};\n\n/**\n * \tSets or returns an attribute of the canvas context.\n */\nCanvas.prototype._contextAttribute = function (name, value=null)\n{\n\tif (!this.context) return;\n\n\tif (value !== null)\n\t{\n\t\tthis.context[name] = value;\n\t\treturn this;\n\t}\n\n\treturn this.context[name];\n};\n\n/**\n * \tSets the fill style.\n * \t!fillStyle (value: string) : Canvas;\n */\n/**\n * \tReturns the current fill style.\n * \t!fillStyle () : string;\n */\nCanvas.prototype.fillStyle = function (value)\n{\n\treturn this._contextAttribute (\"fillStyle\", value);\n};\n\n/**\n * \tSets the stroke style.\n * \t!strokeStyle (value: string) : Canvas;\n */\n/**\n * \tReturns the current strroke style.\n * \t!strokeStyle () : string;\n */\nCanvas.prototype.strokeStyle = function (value)\n{\n\treturn this._contextAttribute (\"strokeStyle\", value);\n};\n\n/**\n * \tSets the line cap style (Possible values are `butt`, `round`, or `square`. `butt` is default).\n * \t!lineCap (value: string) : Canvas;\n */\n/**\n * \tReturns the current line cap style.\n * \t!lineCap() : string;\n */\nCanvas.prototype.lineCap = function (value)\n{\n\treturn this._contextAttribute (\"lineCap\", value);\n};\n\n// violet\n\n/*\n**\tSets or returns the current line join style (bevel, round, miter. miter is default).\n**\n**\t>> Canvas lineJoin (string value);\n**\t>> string lineJoin ();\n*/\n\nCanvas.prototype.lineJoin = function (value)\n{\n\treturn this._contextAttribute (\"lineJoin\", value);\n};\n\n\n/*\n**\tSets or returns the current line width value (default 1).\n**\n**\t>> Canvas lineWidth (float value);\n**\t>> float lineWidth ();\n*/\n\nCanvas.prototype.lineWidth = function (value)\n{\n\treturn this._contextAttribute (\"lineWidth\", value);\n};\n\n\n/*\n**\tSets or returns the current miter limit value (default 10).\n**\n**\t>> Canvas miterLimit (float value);\n**\t>> float miterLimit ();\n*/\n\nCanvas.prototype.miterLimit = function (value)\n{\n\treturn this._contextAttribute (\"miterLimit\", value);\n};\n\n\n/*\n**\tSets or returns the current shadow color value (default black).\n**\n**\t>> Canvas shadowColor (string value);\n**\t>> string shadowColor ();\n*/\n\nCanvas.prototype.shadowColor = function (value)\n{\n\treturn this._contextAttribute (\"shadowColor\", value);\n};\n\n\n/*\n**\tSets or returns the current shadow X offset (default 0).\n**\n**\t>> Canvas shadowOffsetX (float value);\n**\t>> float shadowOffsetX ();\n*/\n\nCanvas.prototype.shadowOffsetX = function (value)\n{\n\treturn this._contextAttribute (\"shadowOffsetX\", value);\n};\n\n\n/*\n**\tSets or returns the current shadow Y offset (default 0).\n**\n**\t>> Canvas shadowOffsetY (float value);\n**\t>> float shadowOffsetY ();\n*/\n\nCanvas.prototype.shadowOffsetY = function (value)\n{\n\treturn this._contextAttribute (\"shadowOffsetY\", value);\n};\n\n\n/*\n**\tSets or returns the current shadow blue value (default 0).\n**\n**\t>> Canvas shadowBlur (string value);\n**\t>> string shadowBlur ();\n*/\n\nCanvas.prototype.shadowBlur = function (value)\n{\n\treturn this._contextAttribute (\"shadowBlur\", value);\n};\n\n\n/*\n**\tSets or returns the current font settings.\n**\n**\t>> Canvas font (string value);\n**\t>> string font ();\n*/\n\nCanvas.prototype.font = function (value)\n{\n\treturn this._contextAttribute (\"font\", value);\n};\n\n\n/*\n**\tSets or returns the current text align settings (start, end, left, right, center).\n**\n**\t>> Canvas textAlign (string value);\n**\t>> string textAlign ();\n*/\n\nCanvas.prototype.textAlign = function (value)\n{\n\treturn this._contextAttribute (\"textAlign\", value);\n};\n\n\n/*\n**\tSets or returns the current text base line settings (alphabetic, bottom, hanging, ideographic, middle, top. Alphabetic is default).\n**\n**\t>> Canvas textBaseline (string value);\n**\t>> string textBaseline ();\n*/\n\nCanvas.prototype.textBaseline = function (value)\n{\n\treturn this._contextAttribute (\"textBaseline\", value);\n};\n\n\n/*\n**\tSets or returns the current global alpha value.\n**\n**\t>> Canvas globalAlpha (float value);\n**\t>> float globalAlpha ();\n*/\n\nCanvas.prototype.globalAlpha = function (value=null)\n{\n\tif (value !== null)\n\t\tthis._alpha = value;\n\telse\n\t\treturn this._alpha;\n\n\treturn this.alpha(1.0);\n};\n\n\n/*\n**\tSets or returns the current global composite operation value (source-atop, source-in, source-out, source-over, destination-atop,\n**\tdestination-in, destination-out, destination-over, lighter, copy, xor).\n**\n**\t>> Canvas globalCompositeOperation (string value);\n**\t>> string globalCompositeOperation ();\n*/\nCanvas.prototype.globalCompositeOperation = function (value)\n{\n\treturn this._contextAttribute (\"globalCompositeOperation\", value);\n};\n\n/*\n**\tUpdates the underlying canvas or gl transformation matrix. \n**\n**\tCanvas updateTransform();\n*/\nCanvas.prototype.updateTransform = function()\n{\n\tthis.setTransform (this.matr.data[0], this.matr.data[1], this.matr.data[3], this.matr.data[4], this.matr.data[6], this.matr.data[7]);\n\treturn this;\n};\n\n/*\n**\tSets the canvas or gl transformation matrix to the given one.\n**\n**\tCanvas setTransform (float a, float b, float c, float d, float e, float f)\n*/\nCanvas.prototype.setTransform = function (a, b, c, d, e, f)\n{\n\tif (this.context === null)\n\t{\n\t\tthis.transform.data[0] = a;\n\t\tthis.transform.data[1] = b;\n\t\tthis.transform.data[2] = 0;\n\t\tthis.transform.data[3] = c;\n\t\tthis.transform.data[4] = d;\n\t\tthis.transform.data[5] = 0;\n\t\tthis.transform.data[6] = int(e);//Math.ceil(e);\n\t\tthis.transform.data[7] = int(f);//Math.ceil(f);\n\t\tthis.transform.data[8] = 1;\n\n\t\treturn this;\n\t}\n\n\t//this.context.setTransform (a, b, c, d, Math.ceil(e), Math.ceil(f));\n\tthis.context.setTransform (a, b, c, d, int(e), int(f));\n\treturn this;\n};\n\n/*\n**\tDraws a filled rectangle on the canvas.\n**\n**\tCanvas fillRect (float x, float y, float w, float h)\n*/\nCanvas.prototype.fillRect = function (x, y, w, h)\n{\n\tthis.context.fillRect (x, y, w, h);\n\treturn this;\n};\n\n/*\n**\tDraws an stroked rectangle on the canvas.\n**\n**\tCanvas strokeRect (float x, float y, float w, float h)\n*/\nCanvas.prototype.strokeRect = function (x, y, w, h)\n{\n\tthis.context.strokeRect (x, y, w, h);\n\treturn this;\n};\n\n/*\n**\tClears a rectangle on the canvas. All pixels will be erased.\n**\n**\tCanvas clearRect (float x, float y, float w, float h)\n*/\nCanvas.prototype.clearRect = function (x, y, w, h)\n{\n\tthis.context.clearRect (x, y, w, h);\n\treturn this;\n};\n\n/*\n**\tStarts a new path. Any previous path points will be cleared.\n**\n**\tCanvas beginPath()\n*/\nCanvas.prototype.beginPath = function ()\n{\n\tthis.context.beginPath ();\n\treturn this;\n};\n\n/*\n**\tCreates a new point in the current path.\n**\n**\tCanvas moveTo (float x, float y)\n*/\nCanvas.prototype.moveTo = function (x, y)\n{\n\tthis.context.moveTo (x, y);\n\treturn this;\n};\n\n/*\n**\tCreates a new point from the first path point to the last, and finishes the path.\n**\n**\tCanvas closePath()\n*/\nCanvas.prototype.closePath = function ()\n{\n\tthis.context.closePath ();\n\treturn this;\n};\n\n/*\n**\tDraws a line from the last point on the path to the given point.\n**\n**\tCanvas lineTo (float x, float y)\n*/\nCanvas.prototype.lineTo = function (x, y)\n{\n\tthis.context.lineTo (x, y);\n\treturn this;\n};\n\n/*\n**\tCreates a hollow rectangle path on the canvas for subsequent stroke or fill.\n**\n**\tCanvas rect (float x, float y, float w, float h)\n*/\nCanvas.prototype.rect = function (x, y, w, h)\n{\n\tthis.context.rect (x, y, w, h);\n\treturn this;\n};\n\n/*\n**\tFills the active path with the current fill style or with the one given in the value parameter.\n**\n**\tCanvas fill (string value=null)\n*/\nCanvas.prototype.fill = function (value=null)\n{\n\tif (value) this.fillStyle (value);\n\tthis.context.fill ();\n\treturn this;\n};\n\n/*\n**\tStrokes the active path with the current stroke style or with the one given in the value parameter.\n**\n**\tCanvas stroke (string value=null)\n*/\nCanvas.prototype.stroke = function (value=null)\n{\n\tif (value) this.strokeStyle (value);\n\tthis.context.stroke ();\n\treturn this;\n};\n\n/*\n**\tClips a region of the canvas so that only the region will be used for drawing. Coordinates must be in logical screen space.\n**\n**\tCanvas clip()\n*/\nCanvas.prototype.clip = function (x, y, width, height)\n{\n\tif (this.gl !== null)\n\t{\n\t\tx *= this._globalScale;\n\t\ty *= this._globalScale;\n\t\twidth *= this._globalScale;\n\t\theight *= this._globalScale;\n\n\t\tif (this.isFlipped)\n\t\t\tthis.gl.scissor(this.width-y-height-1, this.height-x-width-1, height, width);\n\t\telse\n\t\t\tthis.gl.scissor(x, this.height-y-height-1, width, height);\n\t}\n\n\treturn this;\n};\n\n/*\n**\tAdds points of a quadratic curve to the active path. A control points and one reference point must be provided.\n**\n**\tCanvas quadraticCurveTo (float cpx, float cpy, float x, float y)\n*/\nCanvas.prototype.quadraticCurveTo = function (cpx, cpy, x, y)\n{\n\tthis.context.quadraticCurveTo (cpx, cpy, x, y);\n\treturn this;\n};\n\n/*\n**\tAdds points of a bezier curve to the active path. Two control points and one reference point must be provided.\n**\n**\tCanvas bezierCurveTo (float cx1, float cy1, float cx2, float cy2, float x, float y)\n*/\nCanvas.prototype.bezierCurveTo = function (cx1, cy1, cx2, cy2, x, y)\n{\n\tthis.context.bezierCurveTo (cx1, cy1, cx2, cy2, x, y);\n\treturn this;\n};\n\n/*\n**\tAdds points of an arc the the active path. Used to draw a circle of part of it.\n**\n**\tCanvas arc (float x, float y, float r, float sA, float eA, float cw)\n*/\nCanvas.prototype.arc = function (x, y, r, sA, eA, cw)\n{\n\tthis.context.arc (x, y, r, sA, eA, cw);\n\treturn this;\n};\n\n/*\n**\tAdds points of an arc to the active path. Used to create an arc between two points.\n**\n**\tCanvas arcTo (float x1, float y1, float x2, float y2, float r)\n*/\nCanvas.prototype.arcTo = function (x1, y1, x2, y2, r)\n{\n\tthis.context.arcTo (x1, y1, x2, y2, r);\n\treturn this;\n};\n\n/*\n**\tDraws filled text on the canvas with the active font, and fillStyle properties.\n**\n**\tCanvas fillText (string text, float x, float y, float maxWidth=1000)\n*/\nCanvas.prototype.fillText = function (text, x, y, maxWidth=1000)\n{\n\tthis.context.fillText (text, x, y, maxWidth);\n\treturn this;\n};\n\n/*\n**\tDraws stroked text on the canvas with the active font, and fillStyle properties.\n**\n**\tCanvas strokeText (string text, float x, float y, float maxWidth=1000)\n*/\nCanvas.prototype.strokeText = function (text, x, y, maxWidth=1000)\n{\n\tthis.context.strokeText (text, x, y, maxWidth);\n\treturn this;\n};\n\n\n/*\n**\tMeasures the width of the given text using active font properties.\n**\n**\tfloat measureText (string text)\n*/\nCanvas.prototype.measureText = function (text)\n{\n\treturn this.context.measureText(text).width;\n};\n\n\n/*\n**\tReturns a new image data object with the specified size.\n**\n**\tImageData createImageData (float w, float h)\n*/\nCanvas.prototype.createImageData = function (w, h)\n{\n\treturn this.context.createImageData (w, h);\n};\n\n\n/*\n**\tReturns an image data object with the pixels of a rectangular area of the canvas.\n**\n**\tImageData getImageData (float x, float y, float w, float h)\n*/\nCanvas.prototype.getImageData = function (x, y, w, h)\n{\n\treturn this.context.getImageData (x, y, w, h);\n};\n\n\n/*\n**\tPuts image data on the canvas at the specified location.\n**\n**\tCanvas putImageData (ImageData data, float x, float y)\n*/\nCanvas.prototype.putImageData = function (data, x, y)\n{\n\tthis.context.putImageData (data, x, y);\n\treturn this;\n};\n\n\n/*\n**\tDraws an image on the canvas.\n**\n**\tCanvas drawImage (Image img, float x, float y)\n**\tCanvas drawImage (Image img, float x, float y, float w, float h)\n**\tCanvas drawImage (Image img, float sx, float sy, float sw, float sh, float dx, float dy, float dw, float dh)\n*/\nCanvas.prototype.drawImage = function (img, sx=0, sy=0, sw=null, sh=null, dx=null, dy=null, dw=null, dh=null)\n{\n\tif (sw === null)\n\t{\n\t\tthis.context.drawImage (img, int(sx), int(sy));\n\t}\n\telse if (dx === null)\n\t{\n\t\tthis.context.drawImage (img, int(sx), int(sy), int(sw), int(sh));\n\t}\n\telse\n\t{\n\t\tlet a3 = int(sw);\n\t\tlet a4 = int(sh);\n\t\tif (!a3 || !a4) return this;\n\n\t\tlet a7 = int(dw);\n\t\tlet a8 = int(dh);\n\t\tif (!a7 || !a8) return this;\n\n\t\tthis.context.drawImage (img, int(sx), int(sy), a3, a4, int(dx), int(dy), a7, a8);\n\t}\n\n\treturn this;\n};\n\n\n/*\n**\tClears the entire canvas. If the backgroundColor parameter is set the canvas will be cleared manually by using\n**\tthe fillRect method.\n**\n**\tCanvas clear (string backgroundColor)\n**\tCanvas clear ()\n*/\n\nCanvas.prototype.clear = function (backgroundColor=null)\n{\n\tif (this.gl != null)\n\t{\n\t\tthis.gl.clear(this.gl.DEPTH_BUFFER_BIT | this.gl.COLOR_BUFFER_BIT);\n\t\tthis.glActiveTextureId = null;\n\n\t\treturn this;\n\t}\n\n\tif (backgroundColor)\n\t{\n\t\tthis.globalCompositeOperation(\"source-over\").globalAlpha(1.0).fillStyle(backgroundColor !== true ? backgroundColor : this.backgroundColor).fillRect(0, 0, this._width, this._height);\n\t}\n\telse\n\t{\n\t\tthis.elem.width = this.width;\n\t\tthis.applyConfig();\n\t}\n\n\tthis.updateTransform();\n\treturn this;\n};\n\n\n/*\n**\tIndicates that rendering is about to start. Used only in gl mode.\n*/\nCanvas.prototype.start = function ()\n{\n};\n\n/*\n**\tIndicates that rendering has ended. Used only in gl mode.\n*/\nCanvas.prototype.end = function ()\n{\n};\n\n/*\n**\tIndicates that rendering has been completed and any flush operation should be executed. Used only in gl mode.\n*/\nCanvas.prototype.flush = function ()\n{\n\tlet gl = this.gl;\n\tif (gl === null) return;\n\n\tgl.colorMask (false, false, false, true);\n\tgl.clear (gl.COLOR_BUFFER_BIT);\n\tgl.colorMask (true, true, true, true);\n\n\t// VIOLET: Add gl.flush() if not using RAF.\n};\n\n/**\n *\tBlits the specified texture to the active framebuffer.\n */\nCanvas.prototype.blit = function (texture, width, height, shaderProgram=null)\n{\n\tlet gl = this.gl;\n\tif (gl === null) return;\n\n\tshaderProgram = shaderProgram || this.glBlitProgram;\n\n\tthis.setShaderProgram(shaderProgram);\n\tgl.disable (gl.DEPTH_TEST);\n\n\t\tgl.activeTexture (gl.TEXTURE0);\n\t\tgl.bindTexture (gl.TEXTURE_2D, texture);\n\t\tgl.uniform1i (shaderProgram.uniform_texture_0, 0);\n\n\t\tgl.uniform2fv (shaderProgram.uniform_resolution, this.v_resolution);\n\t\tgl.uniform1f (shaderProgram.uniform_time, globals.time);\n\t\tgl.uniform1f (shaderProgram.uniform_scale, this._globalScale);\n\t\tgl.uniform1f (shaderProgram.uniform_alpha, this._alpha);\n\n\t\tthis.v_texture_size[0] = width;\n\t\tthis.v_texture_size[1] = height;\n\t\tgl.uniform2fv (shaderProgram.uniform_texture_size, this.v_texture_size);\n\n\t\tthis.m_location[0] = this.width;\n\t\tthis.m_location[4] = this.height;\n\t\tthis.m_location[6] = 0;\n\t\tthis.m_location[7] = 0;\n\n\t\tthis.m_texture[0] = this.width;\n\t\tthis.m_texture[4] = this.height;\n\t\tthis.m_texture[6] = 0;\n\t\tthis.m_texture[7] = 0;\n\n\t\tgl.uniformMatrix3fv (shaderProgram.uniform_location_matrix, false, this.m_location);\n\t\tgl.uniformMatrix3fv (shaderProgram.uniform_texture_matrix, false, this.m_texture);\n\t\tgl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\n\tthis.setShaderProgram(this.glDefaultProgram);\n\tgl.enable (gl.DEPTH_TEST);\n};\n\n/*\n**\tResets the context drawing properties to their initial values.\n**\n**\tCanvas reset (bool clearPath=false);\n*/\nCanvas.prototype.reset = function (clearPath=false)\n{\n\tthis.fillStyle(\"#000000\").strokeStyle(\"#000000\").lineCap(\"butt\").lineJoin(\"miter\")\n\t.lineWidth(\"1\").miterLimit(\"10\").shadowColor(\"#000000\").shadowOffsetX(\"0\")\n\t.shadowOffsetY(\"0\").shadowBlur(\"0\").globalAlpha(\"1.0\").globalCompositeOperation(\"source-over\");\n\n\tif (clearPath) this.beginPath().closePath();\n\n\treturn this;\n};\n\n/*\n**\tPushes the current transformation matrix into the matrix stack.\n*/\nCanvas.prototype.pushMatrix = function ()\n{\n\tthis.matrixStack.push(this.matr);\n\tthis.matr = this.matr.clone();\n\n\treturn this;\n};\n\n/*\n**\tPops a matrix from the matrix stack into the transformation matrix.\n*/\nCanvas.prototype.popMatrix = function ()\n{\n\tthis.matr.free();\n\tthis.matr = this.matrixStack.pop();\n\n\treturn this.updateTransform();\n};\n\n/*\n**\tSets or returns the relative alpha value for subsequent drawing operations.\n**\n**\t>> Canvas alpha (float value);\n**\t>> float alpha ();\n*/\n\nCanvas.prototype.alpha = function (value)\n{\n\tthis._alpha *= value;\n\n\tif (this.context && this.gl === null)\n\t\tthis.context.globalAlpha = this._alpha;\n\n\treturn this;\n};\n\n/*\n**\tPushes the current global alpha into the stack.\n*/\nCanvas.prototype.pushAlpha = function ()\n{\n\tthis.alphaStack.push (this.globalAlpha());\n\treturn this;\n};\n\n/*\n**\tPops an alpha from the stack into the global alpha.\n**\n**\t>> Canvas popAlpha();\n*/\nCanvas.prototype.popAlpha = function ()\n{\n\tthis.globalAlpha(this.alphaStack.pop());\n\treturn this;\n};\n\n/*\n**\tSets the depth-test flag.\n*/\nCanvas.prototype.setDepthFlag = function (value)\n{\n\tlet gl = this.gl;\n\tif (gl === null) return;\n\n\tif (value)\n\t{\n\t\tgl.enable (gl.DEPTH_TEST);\n\t\tthis._depthFlag = true;\n\t}\n\telse\n\t{\n\t\tgl.disable (gl.DEPTH_TEST);\n\t\tthis._depthFlag = false;\n\t}\n};\n\n/*\n**\tReturns the depth-test flag.\n*/\nCanvas.prototype.getDepthFlag = function ()\n{\n\treturn this._depthFlag;\n};\n\n/*\n**\tPushes the current depth-test flag into the depth flag stack. If a value is provided, the current flag will be pushed and set to the\n**\tgiven value only if they're different, when so, true will be returned.\n*/\nCanvas.prototype.pushDepthFlag = function (value=null)\n{\n\tif (value !== null)\n\t{\n\t\tvalue = !!value;\n\n\t\tif (value === this._depthFlag)\n\t\t\treturn false;\n\n\t\tthis.depthFlagStack.push(this._depthFlag);\n\t\tthis.setDepthFlag(value);\n\n\t\treturn true;\n\t}\n\n\tthis.depthFlagStack.push(this._depthFlag);\n};\n\n/*\n**\tPops the depth-test flag from the depth flag stack.\n*/\nCanvas.prototype.popDepthFlag = function ()\n{\n\tthis.setDepthFlag(this.depthFlagStack.pop());\n};\n\n/*\n**\tSets the active shader program.\n*/\nCanvas.prototype.setShaderProgram = function (program)\n{\n\tlet gl = this.gl;\n\tif (gl === null) return;\n\n\tthis.shaderProgram = program;\n\tthis.shaderProgram.use();\n};\n\n/*\n**\tReturns the current shader program.\n*/\nCanvas.prototype.getShaderProgram = function ()\n{\n\treturn this.shaderProgram;\n};\n\n/*\n**\tPushes the current shader program into the stack. If a value is provided, the current shader program will be pushed and set to the\n**\tgiven one only if they're different, when so, true will be returned.\n*/\nCanvas.prototype.pushShaderProgram = function (program=null)\n{\n\tif (program !== null)\n\t{\n\t\tif (program === this.shaderProgram)\n\t\t\treturn false;\n\n\t\tthis.shaderProgramStack.push(this.shaderProgram);\n\t\tthis.setShaderProgram(program);\n\n\t\treturn true;\n\t}\n\n\tthis.shaderProgramStack.push(this.shaderProgram);\n};\n\n/*\n**\tPops the shader program from the stack.\n*/\nCanvas.prototype.popShaderProgram = function ()\n{\n\tthis.setShaderProgram(this.shaderProgramStack.pop());\n};\n\n\n/*\n**\tSets the transformation matrix to identity.\n**\n**\t>> Canvas loadIdentity();\n*/\n\nCanvas.prototype.loadIdentity = function ()\n{\n\tthis.matr.identity();\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tSets the transformation matrix to the specified one.\n**\n**\t>> Canvas loadMatrix (Matrix matr);\n*/\n\nCanvas.prototype.loadMatrix = function (matr)\n{\n\tthis.matr.set(matr);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tReturns the current transformation matrix, when `clone` is set to true, a cloned matrix will be returned.\n**\n**\t>> Matrix getMatrix(bool clone=false);\n*/\n\nCanvas.prototype.getMatrix = function (clone=false)\n{\n\treturn clone ? this.matr.clone() : this.matr;\n};\n\n\n/*\n**\tAppends a matrix to the current transformation matrix.\n**\n**\t>> Canvas appendMatrix (Matrix matr);\n*/\n\nCanvas.prototype.appendMatrix = function (matr)\n{\n\tthis.matr.append(matr);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tSets scaling factors for subsequent drawing operations. If the useNative is not set then scale with the current\n**\ttransformation matrix will be performed.\n**\n**\t>> Canvas scale (float sx, float sy, bool useNative=false);\n*/\n\nCanvas.prototype.scale = function (sx, sy, useNative)\n{\n\tif (useNative) {\n\t\tthis.context.scale (sx, sy);\n\t\treturn this;\n\t}\n\n\tthis.matr.scale (sx, sy);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tSets rotation factor for subsequent drawing operations. The angle is in radians. If useNative is not set\n**\tthen rotation with the transformation matrix will be used.\n**\n**\t>> Canvas rotate (float angle, bool useNative=false);\n*/\n\nCanvas.prototype.rotate = function (angle, useNative)\n{\n\tif (useNative) {\n\t\tthis.context.rotate (angle);\n\t\treturn this;\n\t}\n\n\tthis.matr.rotate(angle);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tMoves starting point to an specified location. If the useNative parameter is not set then translation with\n**\tthe transformation matrix will be done.\n**\n**\t>> Canvas translate (float x, float y, bool useNative=false);\n*/\n\nCanvas.prototype.translate = function (x, y, useNative)\n{\n\tif (useNative) {\n\t\tthis.context.translate(x, y);\n\t\treturn this;\n\t}\n\n\tthis.matr.translate(x, y);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tCreates a hollow ellipse path on the canvas for subsequent stroke or fill.\n**\n**\t>> Canvas ellipse (float x, float y, float w, float h);\n*/\n\nCanvas.prototype.ellipse = function (x, y, w, h)\n{\n\tvar ox = (w/2)*.5522848, oy = (h/2)*.5522848;\n\tvar xe = x+w-1, ye = y+h-1, xm = x+w/2, ym = y+h/2;\n\n\tthis.beginPath ().moveTo(x, ym);\n\tthis.bezierCurveTo (x, ym - oy, xm - ox, y, xm, y);\n\tthis.bezierCurveTo (xm + ox, y, xe, ym - oy, xe, ym);\n\tthis.bezierCurveTo (xe, ym + oy, xm + ox, ye, xm, ye);\n\tthis.bezierCurveTo (xm - ox, ye, x, ym + oy, x, ym);\n\tthis.closePath ();\n\n\treturn this;\n};\n\n\n/*\n**\tCreates a hollow circle path on the canvas for subsequent stroke or fill. If the stroke param is set the circle\n**\twill be drawn with the specified stroke color.\n**\n**\t>> Canvas circle (float x, float y, float r, string strokeColor);\n**\t>> Canvas circle (float x, float y, float r);\n*/\n\nCanvas.prototype.circle = function (x, y, r, stroke)\n{\n\tthis.beginPath();\n\tthis.arc(x, y, r, 0, 2*Math.PI);\n\tthis.closePath();\n\n\tif (stroke) this.stroke(stroke);\n\n\treturn this;\n};\n\n\n/*\n**\tDraws a line for subsequent stroke or fill. If the stroke param is set the line will be drawn with\n**\tthe specified stroke color.\n**\n**\t>> Canvas line (float x1, float y1, float x2, float y2, string strokeColor);\n**\t>> Canvas line (float x1, float y1, float x2, float y2);\n*/\n\nCanvas.prototype.line = function (x1, y1, x2, y2, stroke)\n{\n\tthis.beginPath();\n\tthis.moveTo(x1, y1);\n\tthis.lineTo(x2, y2);\n\tthis.closePath();\n\n\tif (stroke) this.stroke(stroke);\n\treturn this;\n};\n\n\n/*\n**\tAttaches internal listeners for mouse/pointer events on the canvas object, this is called automatically when\n**\tattaching handlers to the canvas. The actual handlers are added or removed using the addPointerHandler and\n**\tremovePointerHandler respectively.\n**\n**\t>> Canvas enablePointerEvents();\n*/\n\nCanvas.prototype.enablePointerEvents = function()\n{\n\tif (this.pointerHandler) return this;\n\n\tthis.pointerScale = { sx: 1, sy: 1 };\n\tthis.pointerOffset = { x: 0, y: 0 };\n\n\tvar _ = this;\n\n\tvar _evt =\n\t{\n\t\taction: '',\n\t\tbuttons: 0, lbuttons: 0,\n\t\tx: 0, y: 0,\n\n\t\tcontainedBy: function (x, y, w, h) {\n\t\t\treturn this.x >= x && this.x <= (x+w-1) && this.y >= y && this.y <= (y+h-1);\n\t\t}\n\t};\n\n\tthis.pointerHandlers = [];\n\n\tthis.pointerHandler = function (code, evt)\n\t{\n\t\tvar rect = this.elem.getBoundingClientRect();\n\n\t\t_evt.action = code;\n\t\t_evt.buttons = evt.buttons;\n\t\t_evt.x = _evt.rx = int(evt.clientX - rect.left);\n\t\t_evt.y = _evt.ry = int(evt.clientY - rect.top);\n\n\t\t_evt.x = ((_evt.x - _.pointerOffset.x) - 0.0*_.pointerScale.sx) / _.pointerScale.sx;\n\t\t_evt.y = ((_evt.y - _.pointerOffset.y) - 0.0*_.pointerScale.sy) / _.pointerScale.sy;\n\n\t\t_evt.dragging = false;\n\n\t\tif (_evt.buttons && !_evt.lbuttons)\n\t\t{\n\t\t\t_evt.sx = _evt.x;\n\t\t\t_evt.sy = _evt.y;\n\n\t\t\t_evt.ldx = _evt.ldy = 0;\n\t\t}\n\n\t\tif (_evt.buttons && _evt.lbuttons)\n\t\t{\n\t\t\t_evt.dragging = true;\n\n\t\t\t_evt.dx = _evt.x - _evt.sx;\n\t\t\t_evt.dy = _evt.y - _evt.sy;\n\t\t\t\n\t\t\t_evt.ddx = _evt.dx - _evt.ldx;\n\t\t\t_evt.ddy = _evt.dy - _evt.ldy;\n\n\t\t\t_evt.ldx = _evt.dx;\n\t\t\t_evt.ldy = _evt.dy;\n\t\t}\n\n\t\t_evt.lbuttons = _evt.buttons;\n\n\t\tfor (var i = 0; i < this.pointerHandlers.length; i++)\n\t\t{\n\t\t\tif (this.pointerHandlers[i][1] (_evt, this.pointerHandlers[i][2]) === false)\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tthis.elem.onmousedown = function(evt) {  _.pointerHandler('DOWN', evt); };\n\tthis.elem.onmouseup = function(evt) { _.pointerHandler('UP', evt); };\n\tthis.elem.onmousemove = function(evt) { _.pointerHandler('MOVE', evt); };\n\n\treturn this;\n};\n\n\n/*\n**\tSets the pointer scaling factors.\n**\n**\t>> Canvas setPointerScale (float sx, float sy);\n*/\n\nCanvas.prototype.setPointerScale = function (sx, sy)\n{\n\tthis.pointerScale = { sx: sx, sy: sy };\n\treturn this;\n};\n\n\n/*\n**\tSets the pointer offset that is applied after scaling.\n**\n**\t>> Canvas setPointerOffset (float x, float y);\n*/\n\nCanvas.prototype.setPointerOffset = function (x, y)\n{\n\tthis.pointerOffset = { x: x, y: y };\n\treturn this;\n};\n\n\n/*\n**\tAdds a pointer event handler, returns the handler reference id for later removal.\n**\n**\t>> string addPointerHandler (function callback, object context);\n**\t>> string addPointerHandler (function callback);\n*/\n\nCanvas.prototype.addPointerHandler = function (callback, context)\n{\n\tthis.enablePointerEvents();\n\n\tthis.pointerHandlers.push ([this.pointerHandlers.length+\"_\"+int(Math.random()*1e6), callback, context]);\n\n\treturn this.pointerHandlers[this.pointerHandlers.length-1][0];\n};\n\n\n/*\n**\tRemoves a previously attached pointer event handler.\n**\n**\t>> void removePointerHandler (string id);\n*/\n\nCanvas.prototype.removePointerHandler = function (id)\n{\n\tif (!this.pointerHandlers) return;\n\n\tfor (var i = 0; i < this.pointerHandlers.length; i++)\n\t{\n\t\tif (this.pointerHandlers[i][0] == id)\n\t\t{\n\t\t\tthis.pointerHandlers.splice(i, 1);\n\t\t\tbreak;\n\t\t}\n\t}\n};\n\n/**\n * \tExecutes the `draw` function on a new canvas of the specified width and height. Renders it into an image and runs the completed callback with the ready HTMLImageElement object.\n * \t!static renderImage (width: number, height: number, draw: (g: Canvas) => void, completed: (img: HTMLImageElement) => void) : void;\n */\nCanvas.renderImage = function (width, height, draw, completed)\n{\n\tlet g = new Canvas({ width: width, height: height });\n\n\tdraw(g);\n\n\tlet img = new Image();\n\timg.onload = () => {\n\t\tSystem.renderer.prepareImage(img);\n\t\tcompleted(img);\n\t};\n\n\timg.src = g.toDataUrl();\n\tg.dispose();\n};\n\nexport default Canvas;\n","/*\n**\tsystem/system.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport KeyCode from './keycode.js';\nimport List from '../utils/list.js';\nimport Linkable from '../utils/linkable.js';\nimport Timer from './timer.js';\nimport Canvas from './canvas.js';\nimport Log from './log.js';\nimport globals from './globals.js';\n\n//![import \"./keycode\"]\n//![import \"../utils/list\"]\n//![import \"../utils/linkable\"]\n//![import \"./timer\"]\n//![import \"./canvas\"]\n//![import \"./globals\"]\n\n//!namespace System\n\n\t//:type DisplayOrientation = 'default'|'landscape'|'portrait'|'automatic';\n\n\t//!type Options =\n\n\t\t/**\n\t\t *\tBackground of the system canvas. Should be a full 7-digit HEX RGB color.\n\t\t *\t@default \"#000000\"\n\t\t *\t!background?: string;\n\t\t */\n\n\t\t/**\n\t\t * \tSet to `false` to disable WebGL mode.\n\t\t * \t@default true\n\t\t * \t!gl?: boolean;\n\t\t */\n\n\t\t/**\n\t\t *\tSet to `true` t o enable on-screen logging.\n\t\t *\t@default false\n\t\t *\t!log?: boolean,\n\t\t */\n\n\t\t/**\n\t\t *\tWhen `true` the renderer will not clear the buffer on each frame draw, thus allowing overdrawing on the previous frame.\n\t\t *\t@default false\n\t\t *\t!overdraw?: boolean,\n\t\t */\n\n\t\t/**\n\t\t *\tEnables or disables antialised canvas. Set to `false` when pixel-perfect is desired.\n\t\t *\t@default false\n\t\t *\t!antialias?: boolean;\n\t\t */\n\n\t\t/**\n\t\t *\tDesired orientaton of the display.\n\t\t *\t@default \"automatic\"\n\t\t *\t!orientation?: System.DisplayOrientation;\n\t\t */\n\n\t\t/**\n\t\t *\tDesired display width. When not specified (null) the maximum screen width to maintain the aspect ratio will be used.\n\t\t *\t@default null\n\t\t *\t!screenWidth?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tDesired display height. When not specified (null) the maximum screen height to maintain the aspect ratio will be used.\n\t\t *\t@default null\n\t\t *\t!screenHeight?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tTarget frames per second (FPS). Used to determine delay between frames.\n\t\t *\t@default 144\n\t\t *\t!fps?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tMinimum allowed frames per second (FPS). If system FPS drops below this value, the `frameDelta` property of System will be truncated to 1/minFps.\n\t\t *\t@default 10\n\t\t *\t!minFps?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tSelects which rendering mechanism to use either requestAnimationFrame when `true` or setTimeout when `false`.\n\t\t *\t@default true\n\t\t *\t!vsync?: boolean;\n\t\t */\n\n\t\t/**\n\t\t *\tExtra scale factor used to resize images. Use only when you want to render higher resolution images possibly for a very high DPI display.\n\t\t *\t@default 1\n\t\t *\t!extraScaleFactor?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tIndicates which method to use to find the target resolution, using `fullscreen` object when `true`, or the `window` object when `false`.\n\t\t *\t@default false\n\t\t *\t!fullscreen?: boolean;\n\t\t */\n\t  \n\t//!/type\n\n//!/namespace\n\n//!class System\n\nconst System =\n{\n\t/**\n\t * \tRenderer status flags.\n\t */\n\tflags:\n\t{\n\t\trenderingEnabled: false,\n\t\trenderingPaused: false\n\t},\n\n\t/**\n\t * \tDefault options of the rendering system.\n\t */\n\tdefaultOptions:\n\t{\n\t\tbackground: \"#000000\",\n\t\tgl: true,\n\t\tlog: false,\n\n\t\toverdraw: false,\n\t\tantialias: true,\n\t\torientation: 0,\n\n\t\tfps: 144,\n\t\tminFps: 15,\n\t\tvsync: true,\n\n\t\tscreenWidth: null,\n\t\tscreenHeight: null,\n\n\t\textraScaleFactor: 1,\n\t\tfullscreen: false\n\t},\n\n\t/**\n\t * \tScreen width, available only after the system has been initialized.\n\t * \t!static readonly screenWidth: number;\n\t */\n\tscreenWidth: 0,\n\n\t/**\n\t * \tScreen height, available only after the system has been initialized.\n\t * \t!static readonly screenHeight: number;\n\t */\n\tscreenHeight: 0,\n\n\t/**\n\t * \tCurrent display orientation.\n\t * \t!static readonly orientation: System.DisplayOrientation;\n\t */\n\torientation: 0,\n\n\t/**\n\t * \tCoordinates of the screen's offset (for letter-box effect when the screen does not fit tightly).\n\t */\n\toffsX: 0, offsY: 0,\n\n\t/**\n\t * \tDevice pixel ratio, canvas backing store ratio and resulting canvas ratio (devicePixelRatio / backingStoreRatio).\n\t */\n\tdevicePixelRatio: 1, backingStoreRatio: 1, canvasPixelRatio: 1, canvasScaleFactor: 1, scaleFactor: 1,\n\n\t/**\n\t * \tInitial transformation matrix. Should be used (if needed) instead of `loadIdentity` since the System does some transformations first.\n\t * \t!static readonly initialMatrix: Matrix;\n\t */\n\tinitialMatrix: null,\n\n\t/**\n\t * \tPrimary renderer.\n\t * \t!static readonly renderer: Canvas;\n\t */\n\trenderer: null,\n\n\t/**\n\t * \tSecondary display buffer (always 2D). Has the same initial transformation matrix as the primary display buffer.\n\t * \t!static readonly displayBuffer2: Canvas;\n\t */\n\tdisplayBuffer2: null,\n\n\t/**\n\t * \tTerciary display buffer (always 2D). Is assured to have 1:1 with the screen size, initial transformation matrix not applied.\n\t * \t!static readonly displayBuffer3: Canvas;\n\t */\n\tdisplayBuffer3: null,\n\n\t/**\n\t * \tSmall (320x240) temporal display buffer. Used to preload images.\n\t */\n\ttempDisplayBuffer: null,\n\n\t/**\n\t * \tMap with the status of all keys (along with other flags).\n\t */\n\tkeyState: { time: 0, shift: false, ctrl: false, alt: false, keyCode: 0 },\n\n\t/**\n\t * \tCurrent status of all pointers. The related object is known as the Pointer State, and has the following fields: id, isActive, isDragging, sx, sy, x, y, dx, dy, and button.\n\t */\n\tpointerState: { },\n\n\t/**\n\t * \tThe update method of all objects will be executed when the system update() method is called.\n\t */\n\tupdateQueue: null,\n\n\t/**\n\t * \tThe draw method of all objects will be executed when the system draw() method is called.\n\t */\n\tdrawQueue: null, /*List*/\n\n\t/**\n\t * \tThe frame delta is multiplied by this value before each system cycle (defaults to 1).\n\t * \t!static timeScale: number;\n\t */\n\ttimeScale: 1,\n\n\t/**\n\t * \tFrame interval in milliseconds.\n\t * \t!static readonly frameInterval: number;\n\t */\n\tframeInterval: 0,\n\n\t/**\n\t * \tFixed frame interval in milliseconds, when set to non-zero value the frame delta will always be set to this value.\n\t * \t!static fixedFrameInterval: number;\n\t */\n\tfixedFrameInterval: 0,\n\n\t/**\n\t * \tMaximum frame interval in milliseconds, if the `frameDelta` exceeds this, it will be truncated to this value. Controlled by the `minFps` value\n\t * \tof the system initialization options.\n\t * \t!static readonly maxFrameInterval: number;\n\t */\n\tmaxFrameInterval: 0,\n\n\t/**\n\t * \tLast frame delta in seconds.\n\t * \t!static readonly frameDelta: number;\n\t */\n\tframeDelta: 0,\n\n\t/**\n\t * \tLogical system time in seconds. Updated on each cycle by the calculated `frameDelta`.\n\t * \t!static readonly frameTime: number;\n\t */\n\tframeTime: 0,\n\n\t/**\n\t * \tCurrent frame number.\n\t * \t!static readonly frameNumber: number;\n\t */\n\tframeNumber: 0,\n\n\t/**\n\t * \tRendering performance data.\n\t */\n\tperf:\n\t{\n\t\t/**\n\t\t * \tCurrent time range.\n\t\t */\n\t\tstartTime: 0,\n\t\tlastTime: 0,\n\n\t\t/**\n\t\t * \tNumber of frames drawn in the current time range.\n\t\t */\n\t\tnumFrames: 0,\n\n\t\t/**\n\t\t * \tNumber of update and draw samples averaged in total.\n\t\t */\n\t\tnumSamples: 0,\n\n\t\t/**\n\t\t * \tTotal time spent in update, draw and extra respectively in the current time range.\n\t\t */\n\t\tupdateTimeTotal: 0,\n\t\tdrawTimeTotal: 0,\n\t\textraTimeTotal: 0,\n\n\t\t/**\n\t\t * \tCalculated values for the last time range. The updateTime and drawTime are in microseconds.\n\t\t */\n\t\tfps: 0,\n\t\taverageFps: 0,\n\t\taverageUpdateTime: 0,\n\t\taverageDrawTime: 0,\n\t\taverageExtraTime: 0\n\t},\n\n\t/**\n\t * \tInitializes the system with the specified configuration options.\n\t * \t!static init (options: System.Options) : void;\n\t */\n\tinit: function (options=null)\n\t{\n\t\tlet self = this;\n\n\t\tlet o = { ...this.defaultOptions, ...options };\n\t\tthis.options = o;\n\n\t\t// Set default orientation if both target sizes were specified.\n\t\tif (o.screenWidth && o.screenHeight && o.orientation == 'default')\n\t\t\to.orientation = o.screenWidth > o.screenHeight ? 'landscape' : 'portrait';\n\n\t\tthis.orientation = o.orientation;\n\n\t\tthis.updateQueue = List.Pool.alloc();\n\t\tthis.drawQueue = List.Pool.alloc();\n\n\t\t// Attach frame event handlers.\n\t\tthis.frameInterval = 1000 / o.fps;\n\t\tthis.maxFrameInterval = 1000 / o.minFps;\n\n\t\tglobal.onresize = function() { self.onWindowResized(); };\n\n\t\tthis.frameTimer = new Timer (o.vsync, this.frameInterval, (delta) => this.onFrame(delta));\n\n\t\t// Setup canvas buffer.\n\t\tthis.renderer = new Canvas ({ gl: o.gl, elem: null, absolute: true, hidden: false, antialias: o.antialias, background: o.background });\n\n\t\tthis.displayBuffer2 = new Canvas ({ gl: false, elem: null, absolute: true, hidden: false, antialias: o.antialias, background: 'none' });\n\t\tthis.displayBuffer2.elem.style.pointerEvents = 'none';\n\n\t\tthis.displayBuffer3 = new Canvas ({ gl: false, elem: null, absolute: true, hidden: false, antialias: o.antialias, background: 'none' });\n\t\tthis.displayBuffer3.elem.style.pointerEvents = 'none';\n\n\t\tthis.tempDisplayBuffer = new Canvas ({ hidden: true, antialias: o.antialias }).resize(320, 240);\n\n\t\tlet display0 = this.renderer.elem;\n\n\t\t// Obtain device display ratios.\n\t\tthis.devicePixelRatio = global.devicePixelRatio || 1;\n\n\t\tthis.backingStoreRatio = o.gl === true ? 1 : (this.renderer.context.webkitBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.renderer.context.mozBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.renderer.context.msBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.renderer.context.oBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.renderer.context.backingStorePixelRatio || 1);\n\n\t\tthis.canvasPixelRatio = this.devicePixelRatio / this.backingStoreRatio;\n\n\t\tSystem.onWindowResized(true);\n\n\t\t// Attach keyboard event handlers.\n\t\tglobal.onkeydown = function (evt)\n\t\t{\n\t\t\tif (evt.target !== global.document.body)\n\t\t\t\treturn;\n\n\t\t\tif (self.keyState[evt.keyCode])\n\t\t\t\treturn false;\n\n\t\t\tself.keyState[evt.keyCode] = true;\n\n\t\t\tself.keyState.keyCode = evt.keyCode;\n\t\t\tself.keyState.startTime = hrnow();\n\n\t\t\tswitch (evt.keyCode)\n\t\t\t{\n\t\t\t\tcase 16: // SHIFT\n\t\t\t\t\tself.keyState.shift = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 17: // CTRL\n\t\t\t\t\tself.keyState.ctrl = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 18: // ALT\n\t\t\t\t\tself.keyState.alt = true;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// CTRL+TAB should always be handled by the browser.\n\t\t\tif (self.keyState.ctrl && evt.keyCode == KeyCode.TAB)\n\t\t\t{\n\t\t\t\tself.keyState[evt.keyCode] = false;\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (self.onKeyboardEvent (self.KeyboardEventType.KEY_DOWN, evt.keyCode, self.keyState) === false)\n\t\t\t\treturn false;\n\t\t};\n\n\t\tglobal.onkeyup = function (evt)\n\t\t{\n\t\t\tif (evt.target !== global.document.body)\n\t\t\t\treturn;\n\n\t\t\tif (!self.keyState[evt.keyCode])\n\t\t\t\treturn false;\n\n\t\t\tself.keyState[evt.keyCode] = false;\n\t\t\tself.keyState.endTime = hrnow();\n\t\t\tself.keyState.keyCode = evt.keyCode;\n\n\t\t\tswitch (evt.keyCode)\n\t\t\t{\n\t\t\t\tcase 16: // SHIFT\n\t\t\t\t\tself.keyState.shift = false;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 17: // CTRL\n\t\t\t\t\tself.keyState.ctrl = false;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 18: // ALT\n\t\t\t\t\tself.keyState.alt = false;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (self.onKeyboardEvent (self.KeyboardEventType.KEY_UP, evt.keyCode, self.keyState) === false)\n\t\t\t\treturn false;\n\t\t};\n\n\t\t// Converts pointer coordinates from physical space to screen space.\n\n\t\tconst pointerConvX = function (x, y)\n\t\t{\n\t\t\treturn System.reverseRender ? int(System.screenWidth-1 - (y-System.offsY)/System.canvasScaleFactor) : int((x-System.offsX)/System.canvasScaleFactor);\n\t\t};\n\n\t\tconst pointerConvY = function (x, y)\n\t\t{\n\t\t\treturn System.reverseRender ? int((x-System.offsX)/System.canvasScaleFactor) : int((y-System.offsY)/System.canvasScaleFactor);\n\t\t};\n\n\t\t// Attach pointer event handlers if pointer-events are available.\n\t\tif (\"ontouchstart\" in global)\n\t\t{\n\t\t\tdisplay0.ontouchstart = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tlet touches = evt.changedTouches;\n\n\t\t\t\tfor (let i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointerState[touches[i].identifier])\n\t\t\t\t\t{\n\t\t\t\t\t\tSystem.pointerState[touches[i].identifier] = {\n\t\t\t\t\t\t\t\tid: touches[i].identifier, isActive: false, isDragging: false,\n\t\t\t\t\t\t\t\tsx: 0, sy: 0, x: 0, y: 0, dx: 0, dy: 0, button: 0\n\t\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tlet p = System.pointerState[touches[i].identifier];\n\n\t\t\t\t\tp.isActive = true;\n\t\t\t\t\tp.isDragging = false;\n\t\t\t\t\tp.button = 1;\n\n\t\t\t\t\tp.startTime = hrnow();\n\n\t\t\t\t\tp.x = p.sx = pointerConvX(touches[i].clientX, touches[i].clientY);\n\t\t\t\t\tp.y = p.sy = pointerConvY(touches[i].clientX, touches[i].clientY);\n\n\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DOWN, p, System.pointerState);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchend = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tlet touches = evt.changedTouches;\n\n\t\t\t\tfor (let i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointerState[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tlet p = System.pointerState[touches[i].identifier];\n\n\t\t\t\t\tp.endTime = hrnow();\n\t\t\t\t\tp.deltaTime = p.endTime - p.startTime;\n\n\t\t\t\t\tp.x = pointerConvX(touches[i].clientX, touches[i].clientY)\n\t\t\t\t\tp.y = pointerConvY(touches[i].clientX, touches[i].clientY)\n\n\t\t\t\t\tif (p.isDragging)\n\t\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DRAG_STOP, p, System.pointerState);\n\n\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_UP, p, System.pointerState);\n\n\t\t\t\t\tp.isActive = false;\n\t\t\t\t\tp.isDragging = false;\n\n\t\t\t\t\tp.button = 0;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchcancel = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tlet touches = evt.changedTouches;\n\n\t\t\t\tfor (let i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointerState[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tlet p = System.pointerState[touches[i].identifier];\n\n\t\t\t\t\tp.x = pointerConvX(touches[i].clientX, touches[i].clientY);\n\t\t\t\t\tp.y = pointerConvY(touches[i].clientX, touches[i].clientY);\n\n\t\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.PointerEventType.POINTER_DRAG_STOP : System.PointerEventType.POINTER_UP, p, System.pointerState);\n\n\t\t\t\t\tp.isActive = false;\n\t\t\t\t\tp.isDragging = false;\n\n\t\t\t\t\tp.button = 0;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchmove = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tlet touches = evt.changedTouches;\n\n\t\t\t\tfor (let i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointerState[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tlet p = System.pointerState[touches[i].identifier];\n\n\t\t\t\t\tif (p.isActive && !p.isDragging)\n\t\t\t\t\t{\n\t\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DRAG_START, p, System.pointerState);\n\t\t\t\t\t\tp.isDragging = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tp.x = pointerConvX(touches[i].clientX, touches[i].clientY);\n\t\t\t\t\tp.y = pointerConvY(touches[i].clientX, touches[i].clientY);\n\n\t\t\t\t\tp.dx = p.x - p.sx;\n\t\t\t\t\tp.dy = p.y - p.sy;\n\n\t\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.PointerEventType.POINTER_DRAG_MOVE : System.PointerEventType.POINTER_MOVE, p, System.pointerState);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\t\t// Attach mouse event handlers when pointer-events are not available.\n\t\telse\n\t\t{\n\t\t\tdisplay0.oncontextmenu = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.onmousedown = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointerState[0])\n\t\t\t\t{\n\t\t\t\t\tSystem.pointerState[0] = {\n\t\t\t\t\t\t\tid: 0, isActive: false, isDragging: false, button: 0,\n\t\t\t\t\t\t\tsx: 0, sy: 0, x: 0, y: 0, dx: 0, dy: 0,\n\t\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlet p = System.pointerState[0];\n\n\t\t\t\tp.isActive = true;\n\t\t\t\tp.isDragging = false;\n\t\t\t\tp.button = evt.which;\n\n\t\t\t\tp.x = p.sx = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = p.sy = pointerConvY(evt.clientX, evt.clientY);\n\n\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DOWN, p, System.pointerState);\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.onmouseup = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointerState[0])\n\t\t\t\t\treturn false;\n\n\t\t\t\tlet p = System.pointerState[0];\n\n\t\t\t\tp.x = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = pointerConvY(evt.clientX, evt.clientY);\n\n\t\t\t\tif (p.isDragging)\n\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DRAG_STOP, p, System.pointerState);\n\n\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_UP, p, System.pointerState);\n\n\t\t\t\tp.isActive = false;\n\t\t\t\tp.isDragging = false;\n\n\t\t\t\tp.button = 0;\n\t\t\t};\n\n\t\t\tdisplay0.onmousemove = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointerState[0])\n\t\t\t\t\treturn false;\n\n\t\t\t\tlet p = System.pointerState[0];\n\n\t\t\t\tif (p.isActive && !p.isDragging)\n\t\t\t\t{\n\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DRAG_START, p, System.pointerState);\n\t\t\t\t\tp.isDragging = true;\n\t\t\t\t}\n\n\t\t\t\tp.x = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = pointerConvY(evt.clientX, evt.clientY);\n\n\t\t\t\tp.dx = p.x - p.sx;\n\t\t\t\tp.dy = p.y - p.sy;\n\n\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.PointerEventType.POINTER_DRAG_MOVE : System.PointerEventType.POINTER_MOVE, p, System.pointerState);\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\t// Enable log if flag is set.\n\t\tif (o.log === true) Log.enable();\n\t},\n\n\t/**\n\t * \tReturns the current logical time in seconds (same as reading `System.frameTime`).\n\t * \t!static time() : number;\n\t */\n\ttime: function()\n\t{\n\t\treturn this.frameTime;\n\t},\n\n\t/**\n\t * \tStarts the system and enables rendering and updates.\n\t * \t!static start() : void;\n\t */\n\tstart: function()\n\t{\n\t\tthis.onWindowResized();\n\n\t\tthis.flags.renderingPaused = false;\n\t\tthis.frameTimer.start();\n\t},\n\n\t/**\n\t * \tStops the system by disabling both rendering and updates.\n\t * \t!static stop() : void;\n\t */\n\tstop: function()\n\t{\n\t\tthis.flags.renderingPaused = true;\n\t\tthis.frameTimer.stop();\n\t},\n\n\t/**\n\t * \tPauses the system by disabling updates, but rendering will be continued.\n\t * \t!static pause() : void;\n\t */\n\tpause: function()\n\t{\n\t\tthis.flags.renderingPaused = true;\n\t},\n\n\t/**\n\t * \tResumes the system after previously being paused with `pause` method.\n\t * \t!static resume() : void;\n\t */\n\tresume: function()\n\t{\n\t\tthis.flags.renderingPaused = false;\n\t\tthis.resetPerf();\n\t},\n\n\t/**\n\t * \tExecuted when a frame needs to be rendered to the display buffer.\n\t * \tstatic onFrame (delta: number) : void;\n\t */\n\tonFrame: function(delta)\n\t{\n\t\tlet now = hrnow()\n\t\tlet tmp;\n\n\t\tif (delta > this.maxFrameInterval)\n\t\t\tdelta = this.maxFrameInterval;\n\n\t\tif (this.fixedFrameInterval !== 0)\n\t\t\tdelta = this.fixedFrameInterval;\n\n\t\tif (!this.flags.renderingEnabled || this.flags.renderingPaused)\n\t\t{\n\t\t\tthis.draw();\n\t\t\treturn;\n\t\t}\n\n\t\tdelta *= this.timeScale;\n\n\t\tthis.frameDelta = delta / 1000.0;\n\t\tthis.frameTime += this.frameDelta;\n\t\tglobals.time = this.frameTime;\n\n\t\tthis.frameNumber++;\n\n\t\t/* ~ */\n\t\ttmp = hrnow();\n\t\tthis.update (this.frameDelta);\n\t\tthis.perf.updateTimeTotal += hrnow() - tmp;\n\n\t\t/* ~ */\n\t\ttmp = hrnow();\n\t\tthis.draw();\n\t\tthis.perf.drawTimeTotal += hrnow() - tmp;\n\n\t\t/* ~ */\n\t\tthis.perf.lastTime = now;\n\t\tthis.perf.numFrames++;\n\n\t\tdelta = this.perf.lastTime - this.perf.startTime;\n\t\tif (delta > 1000)\n\t\t{\n\t\t\tthis.perf.fps = int(this.perf.numFrames*1000 / delta);\n\n\t\t\t//this.perf.extraTimeTotal = delta - this.perf.updateTimeTotal - this.perf.drawTimeTotal;\n\n\t\t\tthis.perf.averageFps = int(((this.perf.averageFps*this.perf.numSamples) + this.perf.fps) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.averageUpdateTime = int(((this.perf.averageUpdateTime*this.perf.numSamples) + (this.perf.updateTimeTotal*1000 / this.perf.numFrames)) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.averageDrawTime = int(((this.perf.averageDrawTime*this.perf.numSamples) + (this.perf.drawTimeTotal*1000 / this.perf.numFrames)) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.averageExtraTime = int(((this.perf.averageExtraTime*this.perf.numSamples) + (this.perf.extraTimeTotal*1000 / this.perf.numFrames)) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.numSamples++;\n\n\t\t\tthis.perf.startTime = now;\n\t\t\tthis.perf.lastTime = now;\n\t\t\tthis.perf.numFrames = 0;\n\t\t\tthis.perf.updateTimeTotal = 0;\n\t\t\tthis.perf.drawTimeTotal = 0;\n\t\t\tthis.perf.extraTimeTotal = 0;\n\t\t}\n\t},\n\n\t/**\n\t * \tExecuted when the size of the window has changed.\n\t * \tstatic onWindowResized (notRendering: boolean = false) : void;\n\t */\n\tonWindowResized: function(notRendering=false)\n\t{\n\t\t// Determine size of the screen.\n\t\tif ('document' in global)\n\t\t{\n\t\t\tif (this.options.fullscreen)\n\t\t\t{\n\t\t\t\tthis._screenWidth = int(global.screen.width);\n\t\t\t\tthis._screenHeight = int(global.screen.height);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._screenWidth = global.innerWidth;\n\t\t\t\tthis._screenHeight = global.innerHeight;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._screenWidth = this.options.screenWidth;\n\t\t\tthis._screenHeight = this.options.screenHeight;\n\n\t\t\tif (this.options.screenWidth == null && this.options.screenHeight == null)\n\t\t\t\tthrow new Error ('At least one screen dimension must be specified in headless mode.');\n\t\t}\n\n\t\t// Flip dimensions to ensure the desired orientation.\n\t\tif ((this._screenWidth < this._screenHeight && this.orientation == 'landscape') || (this._screenWidth > this._screenHeight && this.orientation == 'portrait'))\n\t\t{\n\t\t\tthis.screenWidth = this._screenHeight;\n\t\t\tthis.screenHeight = this._screenWidth;\n\n\t\t\tthis.reverseRender = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.screenWidth = this._screenWidth;\n\t\t\tthis.screenHeight = this._screenHeight;\n\n\t\t\tthis.reverseRender = false;\n\t\t}\n\n\t\t// Get target screen dimensions.\n\t\tlet targetScreenWidth = this.options.screenWidth;\n\t\tlet targetScreenHeight = this.options.screenHeight;\n\n\t\tif (targetScreenWidth === null || targetScreenHeight === null)\n\t\t{\n\t\t\tif (targetScreenWidth === null && targetScreenHeight === null)\n\t\t\t{\n\t\t\t\ttargetScreenWidth = this.screenWidth;\n\t\t\t\ttargetScreenHeight = this.screenHeight;\n\t\t\t}\n\t\t\telse if (targetScreenWidth === null)\n\t\t\t{\n\t\t\t\ttargetScreenWidth = int(0.5 + this.screenWidth * (this.options.screenHeight / this.screenHeight));\n\t\t\t}\n\t\t\telse if (targetScreenHeight === null)\n\t\t\t{\n\t\t\t\ttargetScreenHeight = int(0.5 + this.screenHeight * (this.options.screenWidth / this.screenWidth));\n\t\t\t}\n\t\t}\n\n\t\t// ***\n\t\tlet screenWidth = targetScreenWidth;\n\t\tlet screenHeight = targetScreenHeight;\n\n\t\tif (this.orientation === 'automatic' && screenWidth && screenHeight)\n\t\t{\n\t\t\tif ((screenWidth > screenHeight && this.screenWidth < this.screenHeight) || (screenWidth < screenHeight && this.screenWidth > this.screenHeight))\n\t\t\t{\n\t\t\t\tscreenWidth = screenHeight;\n\t\t\t\tscreenHeight = targetScreenWidth;\n\t\t\t}\n\t\t}\n\n\t\t// ***\n\t\tthis.canvasScaleFactor = 1;\n\n\t\tif (screenWidth && screenHeight)\n\t\t{\n\t\t\tthis.canvasScaleFactor = Math.min(this.screenWidth / screenWidth, this.screenHeight / screenHeight);\n\t\t}\n\t\telse if (screenWidth)\n\t\t{\n\t\t\tthis.canvasScaleFactor = this.screenWidth / screenWidth;\n\t\t}\n\t\telse if (screenHeight)\n\t\t{\n\t\t\tthis.canvasScaleFactor = this.screenHeight / screenHeight;\n\t\t}\n\n\t\t// ***\n\t\tlet _screenWidth = this.screenWidth;\n\t\tlet _screenHeight = this.screenHeight;\n\n\t\tif (screenWidth) this.screenWidth = screenWidth;\n\t\tif (screenHeight) this.screenHeight = screenHeight;\n\n\t\tthis.offsX = int((_screenWidth - this.screenWidth*this.canvasScaleFactor)*0.5);\n\t\tthis.offsY = int((_screenHeight - this.screenHeight*this.canvasScaleFactor)*0.5);\n\n\t\tif (this.reverseRender)\n\t\t{\n\t\t\tlet tmp = this.offsX;\n\t\t\tthis.offsX = this.offsY;\n\t\t\tthis.offsY = tmp;\n\t\t}\n\n\t\tthis.scaleFactor = this.canvasScaleFactor * this.canvasPixelRatio;\n\t\tthis.scaleFactor = int(0.7 + this.scaleFactor);\n\n\t\tthis.flags.renderingEnabled = false;\n\n\t\t/*\n\t\t**\tIf the scale is not exact, the final canvas size might not fit the entire screen perfectly (will always be a little smaller in\n\t\t**\tsuch a case), when that happens the body's background color will be quite noticeable, to mitigate that we set the body background\n\t\t**\tto the same color as the primary canvas.\n\t\t*/\n\t\tif ('document' in global)\n\t\t\tglobal.document.body.style.backgroundColor = this.renderer.backgroundColor;\n\n\t\t/*\n\t\t**\tResize all display buffers.\n\t\t*/\n\t\tif (!this.reverseRender)\n\t\t{\n\t\t\tthis.renderer.resize (this.screenWidth*this.scaleFactor, this.screenHeight*this.scaleFactor);\n\t\t\tthis.renderer.elem.style.width = int(this.screenWidth*this.canvasScaleFactor+0.5) + \"px\";\n\t\t\tthis.renderer.elem.style.height = int(this.screenHeight*this.canvasScaleFactor+0.5) + \"px\";\n\n\t\t\tthis.displayBuffer2.resize (this.screenWidth*this.scaleFactor, this.screenHeight*this.scaleFactor);\n\t\t\tthis.displayBuffer2.elem.style.width = int(this.screenWidth*this.canvasScaleFactor+0.5) + \"px\";\n\t\t\tthis.displayBuffer2.elem.style.height = int(this.screenHeight*this.canvasScaleFactor+0.5) + \"px\";\n\n\t\t\tthis.displayBuffer3.resize (_screenWidth, _screenHeight);\n\t\t\tthis.displayBuffer3.elem.style.width = _screenWidth + \"px\";\n\t\t\tthis.displayBuffer3.elem.style.height = _screenHeight + \"px\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.renderer.resize (this.screenHeight*this.scaleFactor, this.screenWidth*this.scaleFactor);\n\t\t\tthis.renderer.elem.style.width = int(this.screenHeight*this.canvasScaleFactor+0.5) + \"px\";\n\t\t\tthis.renderer.elem.style.height = int(this.screenWidth*this.canvasScaleFactor+0.5) + \"px\";\n\n\t\t\tthis.displayBuffer2.resize (this.screenHeight*this.scaleFactor, this.screenWidth*this.scaleFactor);\n\t\t\tthis.displayBuffer2.elem.style.width = int(this.screenHeight*this.canvasScaleFactor+0.5) + \"px\";\n\t\t\tthis.displayBuffer2.elem.style.height = int(this.screenWidth*this.canvasScaleFactor+0.5) + \"px\";\n\n\t\t\tthis.displayBuffer3.resize (_screenHeight, _screenWidth);\n\t\t\tthis.displayBuffer3.elem.style.width = _screenHeight + \"px\";\n\t\t\tthis.displayBuffer3.elem.style.height = _screenWidth + \"px\";\n\t\t}\n\n\t\tthis.renderer.elem.style.marginLeft = this.offsX + \"px\";\n\t\tthis.renderer.elem.style.marginTop = this.offsY + \"px\";\n\n\t\tthis.displayBuffer2.elem.style.marginLeft = this.offsX + \"px\";\n\t\tthis.displayBuffer2.elem.style.marginTop = this.offsY + \"px\";\n\n\t\tthis.renderer.loadIdentity();\n\t\tthis.displayBuffer2.loadIdentity();\n\t\tthis.displayBuffer3.loadIdentity();\n\n\t\tif (this.scaleFactor != 1)\n\t\t{\n\t\t\tthis.renderer.globalScale(this.scaleFactor);\n\t\t\tthis.displayBuffer2.globalScale(this.scaleFactor);\n\t\t}\n\n\t\tif (this.reverseRender)\n\t\t{\n\t\t\tthis.renderer.rotate(Math.PI/2);\n\t\t\tthis.renderer.translate(-this.screenWidth, 0);\n\t\t\tthis.renderer.flipped(true);\n\n\t\t\tthis.displayBuffer2.rotate(Math.PI/2);\n\t\t\tthis.displayBuffer2.translate(-this.screenWidth, 0);\n\t\t\tthis.displayBuffer2.flipped(true);\n\n\t\t\tthis.displayBuffer3.rotate(Math.PI/2);\n\t\t\tthis.displayBuffer3.translate(-_screenWidth, 0);\n\t\t\tthis.displayBuffer3.flipped(true);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.renderer.flipped(false);\n\t\t\tthis.displayBuffer2.flipped(false);\n\t\t\tthis.displayBuffer3.flipped(false);\n\t\t}\n\n\t\t/* *** */\n\t\tthis.scaleFactor *= this.options.extraScaleFactor;\n\n\t\tthis.integerScaleFactor = int(this.scaleFactor + 0.5); //0.9\n\t\tthis.resetPerf();\n\n\t\tif (this.initialMatrix)\n\t\t\tthis.initialMatrix.free();\n\n\t\tthis.initialMatrix = this.renderer.getMatrix(true);\n\n\t\tif (notRendering != true)\n\t\t{\n\t\t\tthis.flags.renderingEnabled = true;\n\t\t\tthis.onCanvasResized (this.screenWidth, this.screenHeight);\n\t\t}\n\t},\n\n\t/**\n\t * \tEvent triggered when the canvas was resized by the system. Can be overriden.\n\t * \t!static onCanvasResized (screenWidth: number, screenHeight: number) : void;\n\t */\n\tonCanvasResized: function (screenWidth, screenHeight)\n\t{\n\t},\n\n\t/**\n\t * \tResets the performance data.\n\t */\n\tresetPerf: function()\n\t{\n\t\tthis.perf.startTime = hrnow();\n\t\tthis.perf.lastTime = hrnow();\n\n\t\tthis.perf.numFrames = 0;\n\t\tthis.perf.updateTimeTotal = 0;\n\t\tthis.perf.drawTimeTotal = 0;\n\t\tthis.perf.extraTimeTotal = 0;\n\n\t\tthis.perf.numSamples = 0;\n\t\tthis.perf.fps = 0;\n\t\tthis.perf.averageFps = 0;\n\t\tthis.perf.averageUpdateTime = 0;\n\t\tthis.perf.averageDrawTime = 0;\n\t\tthis.perf.averageExtraTime = 0;\n\t},\n\n\t/**\n\t * \tAdds the specified update handler to the system.\n\t * \t!updateQueueAdd (handler: { update: (dt: number) => void }) : Linkable;\n\t */\n\tupdateQueueAdd: function (handler)\n\t{\n\t\tthis.updateQueue.push (handler);\n\t\treturn this.updateQueue.bottom;\n\t},\n\n\t/**\n\t * \tRemoves the specified update handler from the system.\n\t * \t!updateQueueRemove (handler: { update: (dt: number) => void }) : void;\n\t */\n\t/**\n\t * \tRemoves the specified update handler node from the system.\n\t * \t!updateQueueRemove (node: Linkable) : void;\n\t */\n\tupdateQueueRemove: function (handler)\n\t{\n\t\tthis.updateQueue.remove (Linkable.isInstance(handler) ? handler : this.updateQueue.sgetNode(handler));\n\t},\n\n\t/**\n\t * \tAdds the specified draw handler to the system.\n\t * \t!drawQueueAdd (handler: { draw: (g: Canvas) => void }) : Linkable;\n\t */\n\tdrawQueueAdd: function (handler)\n\t{\n\t\tthis.drawQueue.push (handler);\n\t\treturn this.drawQueue.bottom;\n\t},\n\n\t/**\n\t * \tRemoves the specified draw handler from the system.\n\t * \t!drawQueueRemove (handler: { draw: (g: Canvas) => void }) : void;\n\t */\n\t/**\n\t * \tRemoves the specified draw handler node from the system.\n\t * \t!drawQueueRemove (node: Linkable) : void;\n\t */\n\tdrawQueueRemove: function (handler)\n\t{\n\t\tthis.drawQueue.remove (Linkable.isInstance(handler) ? handler : this.drawQueue.sgetNode(handler));\n\t},\n\n\t/**\n\t * \tAdds the specified handler to the update and draw queues.\n\t * \t!queueAdd (handler: { update: (dt: number) => void, draw: (g: Canvas) => void }) : void;\n\t */\n\tqueueAdd: function (handler)\n\t{\n\t\tthis.updateQueue.push (handler);\n\t\tthis.drawQueue.push (handler);\n\t},\n\n\t/**\n\t *\tRemoves the specified handler from the update and draw queues.\n\t * \t!queueRemove (handler: { update: (dt: number) => void, draw: (g: Canvas) => void }) : void;\n\t */\n\tqueueRemove: function (handler)\n\t{\n\t\tthis.updateQueue.remove (this.updateQueue.sgetNode(handler));\n\t\tthis.drawQueue.remove (this.drawQueue.sgetNode(handler));\n\t},\n\n\t/**\n\t * \tRuns an update cycle. All objects in the `updateQueue` will have their `update method called.\n\t */\n\tupdate: function (dt)\n\t{\n\t\ttry\n\t\t{\n\t\t\tlet next;\n\n\t\t\tfor (let elem = this.updateQueue.top; elem; elem = next)\n\t\t\t{\n\t\t\t\tnext = elem.next;\n\n\t\t\t\tif (elem.value.update(dt) === false)\n\t\t\t\t\tthis.updateQueueRemove(elem);\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tSystem.stop();\n\t\t\tthrow e;\n\t\t}\t\n\t},\n\n\t/**\n\t * \tRuns a rendering cycle. All objects in the `drawQueue` will have their `draw` method called.\n\t */\n\tdraw: function ()\n\t{\n\t\tif (this.renderer.gl !== null)\n\t\t\tthis.renderer.start();\n\n\t\tif (!this.options.overdraw)\n\t\t{\n\t\t\tthis.renderer.clear();\n\t\t\tthis.displayBuffer2.clear();\n\t\t\tthis.displayBuffer3.clear();\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tlet next;\n\n\t\t\tfor (let elem = this.drawQueue.top; elem; elem = next)\n\t\t\t{\n\t\t\t\tnext = elem.next;\n\t\t\t\telem.value.draw(this.renderer);\n\t\t\t}\n\n\t\t\tif (this.renderer.gl !== null)\n\t\t\t{\n\t\t\t\tthis.renderer.flush();\n\t\t\t\tthis.renderer.end();\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tSystem.stop();\n\t\t\tthrow e;\n\t\t}\t\n\t},\n\n\t/**\n\t * \tInterpolates numeric values between two objects (`src` and `dst`) using the specified `duration` and `easing` function. Note that all four parameters `src`, `dst`,\n\t * \t`duration` and `easing` must be objects having the same number of values.\n\t * \t!interpolate (src: object, dst: object, duration: object, easing: object, callback: (data: object, isFinished: boolean) => void) : void;\n\t */\n\tinterpolate: function (src, dst, duration, easing, callback)\n\t{\n\t\t//violet: not optimized\n\t\tlet time = { };\n\t\tlet data = { };\n\t\tlet count = 0;\n\n\t\tfor (let x in src)\n\t\t{\n\t\t\ttime[x] = 0.0;\n\t\t\tdata[x] = src[x]\n\t\t\tcount++;\n\t\t}\n\n\t\tlet interpolator =\n\t\t{\n\t\t\tupdate: function(dt)\n\t\t\t{\n\t\t\t\tfor (let x in time)\n\t\t\t\t{\n\t\t\t\t\tif (time[x] == duration[x])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\ttime[x] += dt;\n\t\t\t\t\tif (time[x] >= duration[x])\n\t\t\t\t\t{\n\t\t\t\t\t\ttime[x] = duration[x];\n\t\t\t\t\t\tcount--;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet t = easing[x] (time[x] / duration[x]);\n\t\t\t\t\tdata[x] = (1-t)*src[x] + t*dst[x];\n\t\t\t\t}\n\n\t\t\t\tcallback (data, count == 0);\n\n\t\t\t\tif (count == 0)\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t};\n\n\t\tSystem.updateQueueAdd(interpolator);\n\t\tinterpolator.update(0);\n\t},\n\n\t/**\n\t * \tEvent triggered when a keyboard event is detected by the system.\n\t * \tonKeyboardEvent (action: KeyboardEventType, keyCode: number, keyState: object) : void;\n\t */\n\tonKeyboardEvent: function (action, keyCode, keyState)\n\t{\n\t},\n\n\t/**\n\t * \tEvent triggered when a pointer event is detected by the system.\n\t * \tonPointerEvent (action: PointerEventType, pointer: object, pointers: object) : void;\n\t */\n\tonPointerEvent: function (action, pointer, pointers)\n\t{\n\t}\n};\n\n//!/class\n\n//!namespace System\n\n\t//!enum KeyboardEventType\n\tSystem.KeyboardEventType = {\n\t\tKEY_DOWN: 0x001,\n\t\tKEY_UP: 0x002,\n\n\t\t//!KEY_DOWN\n\t\t//!KEY_UP\n\t};\n\t//!/enum\n\n\t//!enum PointerEventType\n\tSystem.PointerEventType = {\n\t\tPOINTER_DOWN: \t\t0x010,\n\t\tPOINTER_UP: \t\t0x011,\n\t\tPOINTER_MOVE: \t\t0x012,\n\t\tPOINTER_DRAG_START:\t0x013,\n\t\tPOINTER_DRAG_MOVE:\t0x014,\n\t\tPOINTER_DRAG_STOP:\t0x015,\n\n\t\t//!POINTER_DOWN\n\t\t//!POINTER_UP\n\t\t//!POINTER_MOVE\n\t\t//!POINTER_DRAG_START\n\t\t//!POINTER_DRAG_MOVE\n\t\t//!POINTER_DRAG_STOP\n\t};\n\t//!/enum\n\n//!/namespace\n\nexport default System;\n","/*\n**\tsystem/log.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport System from './system.js';\nimport List from '../utils/list.js';\n\n//![import \"./system\"]\n//![import \"../utils/list\"]\n\n//:/**\n//: * \tLogging module to show logs on the system display buffer.\n//: */\n\n//!namespace Log\n\nconst Log =\n{\n\t/**\n\t * \tIndicates if the log module is enabled.\n\t *\t!let activated: boolean;\n\t */\n\tactivated: false,\n\n\t/**\n\t * \tIndicates if the log module is paused.\n\t * \t!let paused: boolean;\n\t */\n\tpaused: false,\n\n\t/**\n\t * \tMaximum number of entries to show in the screen.\n\t * \t!let maxsize: number;\n\t */\n\tmaxsize: 30,\n\n\tdata: List.Pool.alloc(),\n\tcount: 0,\n\n\n\t/**\n\t * \tIndicates if output showuld also be passed to `console.debug` as secondary echo.\n\t * \t!let debugEcho: boolean;\n\t */\n\tdebugEcho: false,\n\n\t/**\n\t * \tForeground (text) color.\n\t * \t!let color: string;\n\t */\n\tcolor: '#fff',\n\n\t/**\n\t * \tBackground color.\n\t * \t!let background: string;\n\t */\n\tbackground: '#cf266a',\n\n\t/**\n\t * \tDebugging variables to show continuously at the top of the log output.\n\t * \t!let vars: object;\n\t */\n\tvars: { },\n\n\t/**\n\t * \tWrites a message to the log buffer, ensure logging has been enabled by calling `enable` first or any messages will be ignored.\n\t * \t!function write (msg: string) : void;\n\t */\n\twrite: function (msg)\n\t{\n\t\tthis.data.push(msg);\n\t\tthis.count++;\n\n\t\twhile (this.data.length > this.maxsize)\n\t\t\tthis.data.shift();\n\n\t\tif (this.debugEcho)\n\t\t\tconsole.debug(this.count + \": \" + msg);\n\t},\n\n\t/**\n\t * \tClears the current log buffer.\n\t * \t!function clear () : void;\n\t */\n\tclear: function ()\n\t{\n\t\tthis.data.reset();\n\t\tthis.count = 0;\n\t},\n\n\t/**\n\t * \tEnables on-screen logging for cool stuff.\n\t *\n\t * \t@param x - X-coordinate of the top-left corner.\n\t * \t@param y - Y-coordinate of the top-left corner.\n\t * \t@param fontSize - Desired font size in `pt` units.\n\t * \t@param showFps - Set to `true` to show FPS.\n\t * \t@param showIndex - Set to `true to show the message index.\n\t *\n\t * \t!function enable (x?: number, y?: number, fontSize?: number, showFps?: boolean, showIndex?: boolean) : void;\n\t */\n\tenable: function (x=0, y=0, fontSize=9.5, showFps=true, showIndex=true)\n\t{\n\t\tif (this.activated) return;\n\t\tthis.activated = true;\n\n\t\tif (!showFps) y -= 16;\n\t\tlet _y = y;\n\n\t\tSystem.drawQueueAdd ({ draw: function ()\n\t\t{\n\t\t\tif (Log.paused) return;\n\n\t\t\tlet tmp = hrnow();\n\n\t\t\tconst g = System.displayBuffer3;\n\n\t\t\tg.font('bold '+fontSize+'pt Monospace');\n\t\t\tg.textBaseline('top');\n\n\t\t\tlet s = '';\n\n\t\t\ty = _y;\n\n\t\t\tif (showFps !== false && System.perf.fps != 0)\n\t\t\t{\n\t\t\t\ts = 'fps: ' + System.perf.fps + '/' + System.perf.averageFps + ', update: ' + System.perf.averageUpdateTime + ', draw: ' + System.perf.averageDrawTime + ', extra: ' + System.perf.averageExtraTime;\n\n\t\t\t\tif (Log.background) {\n\t\t\t\t\tg.fillStyle(Log.background);\n\t\t\t\t\tg.fillRect (x-3, y-1, g.measureText(s)+6, fontSize+5);\n\t\t\t\t}\n\n\t\t\t\tg.fillStyle(Log.color);\n\t\t\t\tg.fillText(s, x, y);\n\t\t\t}\n\n\t\t\ts = '';\n\n\t\t\tfor (let i in Log.vars)\n\t\t\t\ts += i + ': ' + Log.vars[i] + '  ';\n\n\t\t\tif (s !== '')\n\t\t\t{\n\t\t\t\ty += 24;\n\n\t\t\t\tif (Log.background) {\n\t\t\t\t\tg.fillStyle(Log.background);\n\t\t\t\t\tg.fillRect (x-3, y-1, g.measureText(s)+6, fontSize+5);\n\t\t\t\t}\n\n\t\t\t\tg.fillStyle(Log.color);\n\t\t\t\tg.fillText(s, x, y);\n\t\t\t}\n\n\t\t\tlet i = 0;\n\t\t\tfor (let ii = Log.data.top; ii; ii = ii.next, i++)\n\t\t\t{\n\t\t\t\ts = (showIndex ? \"#\" + (Log.count-Log.data.length+i+1) + \": \" : \"> \") + ii.value;\n\n\t\t\t\tif (Log.background) {\n\t\t\t\t\tg.fillStyle(Log.background);\n\t\t\t\t\tg.fillRect (x-3, y-1+7 + (fontSize+5)*(i+1) - 1, g.measureText(s)+6, fontSize+5);\n\t\t\t\t}\n\n\t\t\t\tg.fillStyle(Log.color);\n\t\t\t\tg.fillText(s, x, y-1+7 + (fontSize+5)*(i+1));\n\t\t\t}\n\n\t\t\ttmp = (hrnow() - tmp);\n\t\t\tSystem.perf.drawTimeTotal -= tmp;\n\t\t\tSystem.perf.extraTimeTotal += tmp;\n\t\t}});\n\t},\n\n\t/**\n\t * \tPauses log rendering.\n\t * \t!function pause () : void;\n\t */\n\tpause: function ()\n\t{\n\t\tthis.paused = true;\n\t\treturn;\n\t},\n\n\t/**\n\t * \tResumes log rendering.\n\t * \t!function resume () : void;\n\t */\n\tresume: function ()\n\t{\n\t\tthis.paused = false;\n\t\treturn;\n\t}\n};\n\nexport default Log;\n","/*\n**\tsystem/globals.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Random from './random.js';\nimport Log from './log.js';\n\n//![import \"./random\"]\n//![import \"./log\"]\n//![import \"../flow/viewport\"]\n\n//:/**\n//: * \tGlobal functions and definitions.\n//: */\n\n//!namespace globals\n\n/*\n**\tVariables and behavior flags, can be extended as needed from other modules.\n*/\nconst globals =\n{\n\t/**\n\t * \tRenderer's GL context.\n\t * \t!let gl: WebGL2RenderingContext;\n\t */\n\tgl: null,\n\n\t/**\n\t * \tGlobal system time, updated once per frame. Mirrors the `System.frameTime` property.\n\t *\t!let time: number;\n\t */\n\ttime: 0,\n\n\t/**\n\t * \tActive viewport (if any). Set by the `draw` method of the `Scene` class.\n\t * \t!let viewport: Viewport;\n\t */\n\tviewport: null,\n\n\t/**\n\t * \tIndicates if the element bounds should be drawn. Used by the `Element` class.\n\t * \t!let debugBounds: boolean;\n\t */\n\tdebugBounds: false,\n\n\t/**\n\t * \tGlobal random generators. Only `rand0` is used by the global random functions. The `rand1` and `rand2` can be used manually if desired.\n\t *\n\t * \t!const rand0: Random;\n\t * \t!const rand1: Random;\n\t * \t!const rand2: Random;\n\t */\n\trand0: new Random(),\n\trand1: new Random(),\n\trand2: new Random()\n};\n\nexport default globals;\n\n//!/namespace\n\n//!declare global\n\n/**\n * \tConverts the given pixel-value to actual screen pixels taking into account the current scale.\n *\n * \t!function px (value: number) : number;\n */\nglobal.px = function(value)\n{\n\treturn value*C.SCALE;\n};\n\n/**\n * \tDisposes an object by running the first method that is found in the following order: `free`, `dispose` and finally `__dtor`.\n *\n *\t!function dispose (obj: object) : void;\n */\nglobal.dispose = function (obj)\n{\n\tif (!obj) return;\n\n\tif ('free' in obj)\n\t\treturn obj.free();\n\n\tif ('dispose' in obj)\n\t\treturn obj.dispose();\n\n\tif ('__dtor' in obj)\n\t\tobj.__dtor();\n};\n\n/**\n * \tGlobal audio context obtained when the system is initialized.\n *\n * \t!let audioContext: AudioContext;\n */\nif ('AudioContext' in global)\n{\n\tglobal.audioContext = new AudioContext({ latencyHint: 'interactive', sampleRate: 44100 });\n\tLog.write('AudioContext: baseLatency=' + ~~(global.audioContext.baseLatency*1000) + ' ms' );\n}\nelse\n\tglobal.audioContext = null;\n\n/**\n * \tSimilar to `fetch` but uses XMLHttpRequest because in some mobile browsers regular mode does not work well with ArrayBuffers.\n *\n * \t!function fetchd (url: string, options?: object) : Promise<object>;\n */\nglobal.fetchd = function (url, options)\n{\n\treturn new Promise ((resolve, reject) =>\n\t{\n\t\tif (!options) options = { };\n\t\tif (!('responseType' in options)) options.responseType = 'arraybuffer';\n\n\t\tvar request = new XMLHttpRequest();\n\t\trequest.open('GET', url, true);\n\n\t\tfor (let i in options) request[i] = options[i];\n\n\t\trequest.onload = function() {\n\t\t\tresolve (request.response);\n\t\t};\n\n\t\trequest.onerror = function() {\n\t\t\treject ('Unable to fetch specified resource.');\n\t\t};\n\n\t\trequest.send();\n\t});\n};\n\n/**\n * \tLoads an arraybuffer from the specified URL and converts it to a AudioBuffer using the global audioContext.\n *\n * \t!function fetchAudioBuffer (url: string) : Promise<AudioBuffer>;\n */\nglobal.fetchAudioBuffer = function (url)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tif (!global.audioContext)\n\t\t{\n\t\t\treject ('AudioContext is not available.');\n\t\t\treturn;\n\t\t}\n\n\t\tfetchd(url)\n\t\t.then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))\n\t\t.then(audioBuffer => resolve(audioBuffer))\n\t\t.catch(err => reject(err));\n\t});\n};\n\n\n/**\n * \tReturns the value as an integer.\n *\n *\t!function int (value: number|string) : number;\n */\nglobal.int = function (value)\n{\n\treturn value >> 0;\n};\n\n/**\n * \tReturns the value as a boolean.\n *\n * \t!function bool (value: number|string|boolean) : number;\n */\nglobal.bool = function (value)\n{\n\tif (value === true || value === false)\n\t\treturn value;\n\n\tif (value == 'true')\n\t\treturn true;\n\n\tif (value == 'false')\n\t\treturn false;\n\n\treturn !(!value);\n};\n\n/**\n * \tReturns the value as a floating point number.\n *\n * \t!function float (value: number|string) : number;\n */\nglobal.float = function (value)\n{\n\treturn parseFloat(value);\n};\n\n/**\n * \tReturns the value truncated to 2 digits of precision.\n *\n * \t!function float2 (value: number) : number;\n */\nglobal.float2 = function (value)\n{\n\treturn (int(value*100))/100;\n};\n\n/**\n * \tReturns the value truncated to 3 digits of precision.\n *\n * \t!function float3 (value: number) : number;\n */\nglobal.float3 = function (value)\n{\n\treturn (int(value*1000))/1000;\n};\n\n/**\n * \tReturns the value truncated to 4 digits of precision.\n *\n * \t!function float4 (value: number) : number;\n */\nglobal.float4 = function (value)\n{\n\treturn (int(value*10000))/10000;\n};\n\n/**\n * \tConverts the given value to radians.\n *\n * \t!function rad (value: number) : number;\n */\nglobal.rad = function (value)\n{\n\treturn value*Math.PI / 180;\n};\n\n/**\n * \tConverts the given value to degrees.\n *\n * \t!function deg (value: number) : number;\n */\nglobal.deg = function (value)\n{\n\treturn (value/Math.PI)*180;\n};\n\n/**\n * \tReturns a random integer value from 0 to 0xFFFF (inclusive).\n *\n * \t!function rand() : number;\n */\nglobal.rand = function ()\n{\n\treturn globals.rand0.nextInt16();\n};\n\n/**\n * \tReturns a random float from 0 to 1 (inclusive).\n *\n * \t!function randf() : number;\n */\nglobal.randf = function ()\n{\n\treturn globals.rand0.nextFloat();\n};\n\n/**\n * \tReturns a random float within the given (inclusive) range.\n *\n * \t!function randrf (startValue: number, endValue: number) : number;\n */\nglobal.randrf = function (a, b)\n{\n\tlet t = globals.rand0.nextFloat();\n\treturn t*b + (1-t)*a;\n};\n\n/**\n * \tReturns a random integer within the given range (inclusive).\n *\n * \t!function randr (startValue: number, endValue: number) : number;\n */\nglobal.randr = function (a, b)\n{\n\tlet t = globals.rand0.nextFloat();\n\treturn Math.round(t*b + (1-t)*a);\n};\n\n/**\n * \tReturns a table (array) of N random float numbers within the given range (inclusive).\n *\n * \t!function randtf (startValue: number, endValue: number, n: number) : Array<number>;\n */\nglobal.randtf = function (a, b, n)\n{\n\tvar list = [ ];\n\n\tfor (var i = 0; i < n; i++)\n\t\tlist.push(randrf(a, b));\n\n\treturn list;\n};\n\n/**\n * \tReturns the high-resolution `now` counter in milliseconds (includes possibly microseconds in fractional part).\n *\n * \t!function hrnow () : number;\n */\nglobal.hrnow = function ()\n{\n\treturn performance.now();\n};\n\n/**\n * \tReturns a function that when called produces a random integer value within the given (inclusive) range.\n *\n * \t!function randvar (startValue: number, endValue: number) : () => number;\n */\nglobal.randvar = function (a, b)\n{\n\treturn function() { return randr(a, b); };\n};\n\n/**\n * \tReturns a function that when called returns an item from the specified array at some random index within the (inclusive) range.\n *\n * \t!function randitem (arr: Array<any>, startValue?: number, endValue?: number) : () => any;\n */\nglobal.randitem = function (arr, a, b)\n{\n\tif (!a) a = 0;\n\tif (!b) b = arr.length - 1;\n\n\treturn function() { return arr[randr(a, b)]; };\n};\n\n/**\n * \tReturns the parameter 't' where two line segments intersect.\n *\n * \t!function getLineSegmentIntersection (ls1_x1: number, ls1_y1: number, ls1_x2: number, ls1_y2: number, ls2_x1: number, ls2_y1: number, ls2_x2: number, ls2_y2: number) : number;\n */\nglobal.getLineSegmentIntersection = function (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2)\n{\n\t// Case #1: Identical segments.\n\tif (ls1_x1 == ls2_x1 && ls1_y1 == ls2_y1 && ls1_x2 == ls2_x2 && ls1_y2 == ls2_y2)\n\t\treturn 0;\n\n\tlet inf = 2.0;\n\n\tvar dyA = ls1_y2 - ls1_y1;\n\tvar dxA = ls1_x2 - ls1_x1;\n\tvar dyB = ls2_y2 - ls2_y1;\n\tvar dxB = ls2_x2 - ls2_x1;\n\n\t// Case #2: Horizontal vs. Horizontal\n\tif (dyA == 0 && dyB == 0)\n\t{\n\t\tif (ls1_y1 != ls2_y1) return inf;\n\n\t\tvar x1 = Math.max(ls1_x1, ls2_x1);\n\t\tvar x2 = Math.min(ls1_x2, ls2_x2);\n\n\t\tif (x1 > x2) return inf;\n\n\t\treturn (x1 - ls1_x1) / dxA;\n\t}\n\n\t// Case #3: Vertical vs. Vertical\n\tif (dxA == 0 && dxB == 0)\n\t{\n\t\tif (ls1_x1 != ls2_x1) return inf;\n\n\t\tvar y1 = Math.max(ls1_y1, ls2_y1);\n\t\tvar y2 = Math.min(ls1_y2, ls2_y2);\n\n\t\tif (y1 > y2) return inf;\n\n\t\treturn (y1 - ls1_y1) / dyA;\n\t}\n\n\t// Case #4: Vertical vs. Horizontal or Sloped\n\tif (dxA == 0)\n\t{\n\t\tvar tA = (dyB*(ls1_x1 - ls2_x1) + dxB*(ls2_y1 - ls1_y1)) / (dxB * dyA);\n\t\tif (0 > tA || tA > 1) return inf;\n\n\t\tvar tB = (ls1_x1 - ls2_x1) / dxB; \n\t\tif (0 > tB || tB > 1) return inf;\n\n\t\treturn tA;\n\t}\n\n\t// Case #5: Regular line segments.\n\tvar a = dyA*(ls2_x1 - ls1_x1) + dxA*(ls1_y1 - ls2_y1);\n\tvar b = dyB*dxA - dxB*dyA;\n\n\tif (b == 0) return inf;\n\n\tvar tB = a / b;\n\tif (0 > tB || tB > 1) return inf;\n\n\tvar tA = (dxB*tB + ls2_x1 - ls1_x1) / dxA;\n\tif (0 > tA || tA > 1) return inf;\n\n\treturn tA;\n};\n\n/**\n * \tReturns boolean indicating if the line segments intersect.\n *\n * \t!function lineSegmentIntersects (ls1_x1: number, ls1_y1: number, ls1_x2: number, ls1_y2: number, ls2_x1: number, ls2_y1: number, ls2_x2: number, ls2_y2: number) : boolean;\n */\nglobal.lineSegmentIntersects = function (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2)\n{\n\tlet t = getLineSegmentIntersection (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2);\n\treturn t >= 0 && t <= 1.0;\n};\n\n/**\n * \tRotates a point (2d) by the given angle and returns an object having x and y properties.\n * \n * \t!function rotatePoint (angle: number, x: number, y: number) : { x: number, y: number };\n */\nglobal.rotatePoint = function (angle, x, y)\n{\n\treturn { x: x*Math.cos(angle) + y*Math.sin(angle), y: y*Math.cos(angle) - x*Math.sin(angle) };\n};\n\n/**\n * \tReturns a value snapped to a step within the given range.\n * \n * \t!function stepValue (value: number, minValue: number, maxValue: number, numSteps: number) : number;\n */\nglobal.stepValue = function (value, minValue, maxValue, numSteps)\n{\n\treturn ((Math.round(numSteps * (value - minValue) / (maxValue - minValue))) / numSteps) * (maxValue - minValue) + minValue;\n};\n\n/**\n * \tReturns a value that is a factor of the specified step.\n * \n * \t!function alignValue (value: number, step: number) : number;\n */\nglobal.alignValue = function (value, step)\n{\n\treturn Math.round(value/step)*step;\n};\n\n/**\n * \tNumber of bits for fixed-point number (default is 8).\n * \n * \t!let FIXED_POINT_BITS : number;\n*/\nglobal.FIXED_POINT_BITS = 8;\n\n/**\n * \tReturns a fixed-point upscaled value.\n * \n * \t!function upscale (value: number) : number;\n */\nglobal.upscale = function (value)\n{\n\treturn (value * (1 << FIXED_POINT_BITS)) >> 0;\n};\n\n/**\n * \tDownscales a fixed-point value to its integer part.\n * \n * \t!function downscale (value: number) : number;\n */\nglobal.downscale = function (value)\n{\n\treturn value >> FIXED_POINT_BITS;\n};\n\n/**\n * \tDownscales a fixed-point value to floating point.\n * \n * \t!function downscalef (value: number) : number;\n */\nglobal.downscalef = function (value)\n{\n\treturn value / (1 << FIXED_POINT_BITS);\n};\n\n/**\n * \tAligns a value to its fixed point floating point representation such that downscaling results in an integer.\n * \n * \t!function falign (value: number) : number;\n */\nglobal.falign = function (value)\n{\n\treturn downscalef(upscale(value));\n};\n\n/**\n * \tReturns the value having the minimum absolute value.\n * \n * \t!function absmin (a: number, b: number) : number;\n */\nglobal.absmin = function(a, b)\n{\n\treturn Math.abs(a) < Math.abs(b) ? a : b;\n};\n\n/**\n * \tReturns the value having the maximum absolute value.\n * \n * \t!function absmax (a: number, b: number) : number;\n */\nglobal.absmax = function(a, b)\n{\n\treturn Math.abs(a) > Math.abs(b) ? a : b;\n};\n","/*\n**\tsystem/perf.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n//!class Perf\n\n/**\n * \tInitializes the performance monitoring instance.\n *\n * \t@param accumSize - Maximum amount of samples to accumulate.\n * \t@param expectedValue - Expected value (average) of resulting samples.\n * \n * \t!constructor (accumSize: number, expectedValue?: number);\n */\nconst Perf = function (accumSize, expectedValue=null)\n{\n\tthis.data = [ ];\n\tthis.accumSize = accumSize;\n\n\tthis.expectedValue = expectedValue;\n\n\tthis.lastFeed = 0;\n\tthis.lastUpdate = 0;\n\n\tthis.stdSum = 0;\n\tthis.stdCount = 0;\n};\n\nexport default Perf;\n\n/**\n * \tMarks the start time of a performance test.\n * \t!begin() : void;\n */\nPerf.prototype.begin = function () {\n\tthis.startTime = performance.now();\n};\n\n/**\n * \tMarks the end time of the performance test, the elapsed time is fed into the monitor.\n * \t!end() : void;\n */\nPerf.prototype.end = function () {\n\tthis.feed (performance.now() - this.startTime);\n};\n\n/**\n * \tFeeds a value into the monitor, auto-generates a report using `console.log` when the number of samples reaches the `accumSize` specified in the constructor.\n * \t!feed (value: number) : void;\n */\nPerf.prototype.feed = function (value)\n{\n\tthis.data.push(value);\n\tthis.lastFeed++;\n\n\tif (this.data.length != this.accumSize)\n\t\treturn;\n\n\tthis.report();\n\tthis.data = [ ];\n};\n\n/**\n * \tUpdates the `min`, `max`, `avg` `std`, `stdSum` and `stdCount` fields of the object.\n * \t!update () : void;\n */\nPerf.prototype.update = function ()\n{\n\tlet min = null;\n\tlet max = null;\n\tlet avg = 0;\n\tlet std = 0;\n\n\tfor (let i = 0; i < this.data.length; i++)\n\t{\n\t\tmin = min === null ? this.data[i] : Math.min(min, this.data[i]);\n\t\tmax = max === null ? this.data[i] : Math.max(max, this.data[i]);\n\t\tavg += this.data[i];\n\t}\n\n\tavg /= this.data.length;\n\n\tlet e = this.expectedValue !== null ? this.expectedValue : avg;\n\n\tfor (let i = 0; i < this.data.length; i++) std += Math.pow(this.data[i] - e, 2);\n\n\tstd = Math.sqrt(std / this.data.length);\n\n\tthis.stdSum += std;\n\tthis.stdCount++;\n\n\tthis.min = min;\n\tthis.max = max;\n\tthis.avg = avg;\n\tthis.std = std;\n\n\tthis.lastUpdate = this.lastFeed;\n\treturn this;\n};\n\n/**\n * \tReturns a report string with the values selected by the specified flags.\n * \t!report (flags: Perf.Flags) : string;\n */\nPerf.prototype.report = function (flags=255)\n{\n\tlet out = '';\n\n\tif (this.lastUpdate != this.lastFeed)\n\t\tthis.update();\n\n\tif (flags & Perf.Flags.SAMPLES) out += 'n: ' + this.stdCount;\n\tif (flags & Perf.Flags.MIN) out += (out != '' ? ', ' : '') + 'min: ' + this.min;\n\tif (flags & Perf.Flags.MAX) out += (out != '' ? ', ' : '') + 'max: ' + this.max;\n\tif (flags & Perf.Flags.AVG) out += (out != '' ? ', ' : '') + 'avg: ' + this.avg.toFixed(2);\n\tif (flags & Perf.Flags.EXPECTED) out += (out != '' ? ', ' : '') + (this.expectedValue !== undefined ? 'e: ' + this.expectedValue : '');\n\tif (flags & Perf.Flags.STDDEV) out += (out != '' ? ', ' : '') + 'stddev: ' + this.std.toFixed(2);\n\tif (flags & Perf.Flags.AVG_STDDEV) out += (out != '' ? ', ' : '') + 'avg_stddev: ' + (this.stdSum / this.stdCount).toFixed(2)\n\n\treturn out;\n};\n\n//!/class\n\n//!namespace Perf\n//!enum Flags\n\nPerf.Flags = {\n\tSAMPLES: 1,\n\t//!SAMPLES\n\tMIN: 2,\n\t//!MIN\n\tMAX: 4,\n\t//!MAX\n\tAVG: 8,\n\t//!AVG\n\tEXPECTED: 16,\n\t//!EXPECTED\n\tSTDDEV: 32,\n\t//!STDDEV\n\tAVG_STDDEV: 64,\n\t//!AVG_STDDEV\n\tALL: 255,\n\t//!ALL\n};\n\n//!/enum\n","/*\n**\tsystem/framebuffer.js\n**\n**\tCopyright (c) 2021-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport globals from './globals.js';\nimport System from './system.js';\n\n//![import \"./globals\"]\n//![import \"./system\"]\n\n/*\n *\tDescribes a GL framebuffer.\n */\n\nconst Framebuffer = Class.extend\n({\n\t/**\n\t *\tShader GL identifier.\n\t */\n\tframebufferId: null,\n\n\t/**\n\t *\tAttachments of the framebuffer.\n\t */\n\tattachments: null,\n\n\t/**\n\t *\tType of each attachment.\n\t */\n\tattachmentTypes: null,\n\n\t/**\n\t *\tWidth of the framebuffer.\n\t */\n\twidth: 0,\n\n\t/**\n\t *\tHeight of the framebuffer.\n\t */\n\theight: 0,\n\n\t/**\n\t *\tEnabled draw buffers.\n\t */\n\tdrawBuffers: null,\n\tdrawBufferIds: null,\n\n\t/**\n\t *\tConstructs a GL framebuffer.\n\t *\n\t * \t@param {number} width\n\t * \t@param {number} height\n\t */\n\t__ctor: function (width=null, height=null)\n\t{\n\t\tif (globals.gl === null)\n\t\t\treturn;\n\n\t\tif (attachmentPointIds[0] === null)\n\t\t\tinitAttachmentPointIds(globals.gl);\n\n\t\tthis.framebufferId = globals.gl.createFramebuffer();\n\n\t\tthis.drawBuffers = [];\n\t\tthis.drawBufferIds = [];\n\n\t\t//violet:hardware scaling\n\t\t//this.width = width || System.screenWidth;\n\t\t//this.height = height || System.screenHeight;\n\n\t\tthis.width = width || System.renderer.width;\n\t\tthis.height = height || System.renderer.height;\n\n\t   \tthis.attachments = new Array(Framebuffer.MAX_ATTACHMENT_POINTS).fill(null);\n\t   \tthis.attachmentTypes = new Array(Framebuffer.MAX_ATTACHMENT_POINTS).fill(null);\n\t},\n\n\t/**\n\t * \tDestroys the framebuffer and all attached textures.\n\t */\n\t__dtor: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return;\n\n\t\tfor (let i = 0; i < this.attachments.length; i++)\n\t\t{\n\t\t\tif (this.attachments[i] !== null)\n\t\t\t{\n\t\t\t\tif (this.attachmentTypes[i] === Framebuffer.TEXTURE)\n\t\t\t\t\tgl.deleteTexture(this.attachments[i]);\n\t\t\t\telse\n\t\t\t\t\tgl.deleteRenderbuffer(this.attachments[i]);\n\t\t\t}\n\t\t}\n\n\t\tgl.deleteFramebuffer(this.frameBufferId);\n\t},\n\n\t/**\n\t * \tAttaches a texture to a framebuffer attachment point.\n\t *\n\t * \t@param {number} attachmentPoint\n\t * \t@param {any} texture\n\t * \t@param {number} type\n\t */\n\tattach: function (attachmentPoint, texture, type=null)\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return;\n\n\t\tif (type === null)\n\t\t\ttype = attachmentPoint < Framebuffer.DEPTH ? Framebuffer.TEXTURE : Framebuffer.RENDERBUFFER;\n\n\t\tthis.attachments[attachmentPoint] = texture;\n\t\tthis.attachmentTypes[attachmentPoint] = type;\n\n\t\tif (attachmentPoint < Framebuffer.DEPTH && this.drawBuffers.indexOf(attachmentPoint) === -1)\n\t\t{\n\t\t\tthis.drawBuffers.push(attachmentPoint);\n\t\t\tthis.drawBufferIds.push(attachmentPointIds[attachmentPoint]);\n\t\t}\n\n\t\tlet prev = gl.getParameter(gl.FRAMEBUFFER_BINDING);\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, this.framebufferId);\n\n\t\tswitch (type)\n\t\t{\n\t\t\tcase Framebuffer.TEXTURE:\n\t\t\t\tgl.framebufferTexture2D (gl.FRAMEBUFFER, attachmentPointIds[attachmentPoint], gl.TEXTURE_2D, texture, 0);\n\t\t\t\tbreak;\n\n\t\t\tcase Framebuffer.RENDERBUFFER:\n\t\t\t\tgl.framebufferRenderbuffer (gl.FRAMEBUFFER, attachmentPointIds[attachmentPoint], gl.RENDERBUFFER, texture);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, prev);\n\t},\n\n\t/**\n\t * \tCreates a new color buffer texture.\n\t *\n\t * \t@param {number} width\n\t * \t@param {number} height\n\t * \t@returns {GLTexture}\n\t */\n\tcreateColorBuffer: function (attachmentPoint, width=null, height=null)\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return null;\n\n\t\tif (width === null) width = this.width;\n\t\tif (height === null) height = this.height;\n\n\t\tlet tex = gl.createTexture();\n\t\tgl.bindTexture (gl.TEXTURE_2D, tex);\n\n\t\tgl.texStorage2D (gl.TEXTURE_2D, 1, gl.RGBA8, width, height);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n\t\tthis.attach(attachmentPoint, tex);\n\t\treturn tex;\n\t},\n\n\t/**\n\t * \tCreates a new depth buffer texture.\n\t *\n\t * \t@param {number} width\n\t * \t@param {number} height\n\t * \t@returns {GLTexture}\n\t */\n\tcreateDepthBuffer: function (width=null, height=null)\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return null;\n\n\t\tif (width === null) width = this.width;\n\t\tif (height === null) height = this.height;\n\n\t\tlet tex = gl.createRenderbuffer();\n\t\tgl.bindRenderbuffer (gl.RENDERBUFFER, tex);\n\t\tgl.renderbufferStorage (gl.RENDERBUFFER, gl.DEPTH_COMPONENT24, width, height);\n\n\t\tthis.attach(Framebuffer.DEPTH, tex);\n\t\treturn tex;\n\t},\n\n\t/**\n\t * \tCreates a new stencil buffer texture.\n\t *\n\t * \t@param {number} width\n\t * \t@param {number} height\n\t * \t@returns {GLTexture}\n\t */\n\tcreateStencilBuffer: function (width=null, height=null)\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return null;\n\n\t\tif (width === null) width = this.width;\n\t\tif (height === null) height = this.height;\n\n\t\tlet tex = gl.createTexture();\n\t\tgl.bindTexture (gl.TEXTURE_2D, tex);\n\n\t\tgl.texStorage2D (gl.TEXTURE_2D, 1, gl.DEPTH_STENCIL, width, height);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n\t\tthis.attach(Framebuffer.DEPTH_STENCIL, tex);\n\t\treturn tex;\n\t},\n\n\t/**\n\t * \tReturns a texture from the specified attachment point.\n\t * \t@param {number} attachmentPoint \n\t */\n\tgetTexture: function (attachmentPoint)\n\t{\n\t\tif (this.attachmentTypes[attachmentPoint] !== Framebuffer.TEXTURE)\n\t\t\treturn null;\n\n\t\treturn this.attachments[attachmentPoint];\n\t},\n\n\t/**\n\t * \tReturns a renderbuffer from the specified attachment point.\n\t * \t@param {number} attachmentPoint \n\t */\n\tgetRenderBuffer: function (attachmentPoint)\n\t{\n\t\tif (this.attachmentTypes[attachmentPoint] !== Framebuffer.RENDERBUFFER)\n\t\t\treturn null;\n\n\t\treturn this.attachments[attachmentPoint];\n\t},\n\n\t/**\n\t *\tBinds the framebuffer for further operations.\n\t */\n\tbind: function()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return;\n\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, this.framebufferId);\n\n\t\tgl.drawBuffers (this.drawBufferIds);\n\t\tgl.viewport (0, 0, this.width, this.height);\n\t},\n\n\t/**\n\t *\tBinds the default framebuffer.\n\t */\n\tunbind: function()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return;\n\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, null);\n\n\t\tgl.drawBuffers (defaultDrawBuffers);\n\t\tgl.viewport (0, 0, System.renderer.width, System.renderer.height);\n\t},\n\n\t/**\n\t *\tReturns the status of the framebuffer. Returns true if the framebuffer is complete.\n\t */\n\tisComplete: function()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return true;\n\n\t\tlet prev = gl.getParameter(gl.FRAMEBUFFER_BINDING);\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, this.framebufferId);\n\t\tlet result = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, prev);\n\n\t\treturn result === gl.FRAMEBUFFER_COMPLETE;\n\t}\n\n});\n\n/**\n *\tTypes of attachment objects.\n */\nFramebuffer.TEXTURE = 1;\nFramebuffer.RENDERBUFFER = 2;\n\n/**\n *\tAvailable attachment points.\n */\nFramebuffer.COLOR0\t\t\t= 0;\nFramebuffer.COLOR1\t\t\t= 1;\nFramebuffer.COLOR2\t\t\t= 2;\nFramebuffer.COLOR3\t\t\t= 3;\nFramebuffer.COLOR4\t\t\t= 4;\nFramebuffer.COLOR5\t\t\t= 5;\nFramebuffer.COLOR6\t\t\t= 6;\nFramebuffer.COLOR7\t\t\t= 7;\nFramebuffer.DEPTH \t\t\t= 8;\nFramebuffer.STENCIL \t\t= 9;\nFramebuffer.DEPTH_STENCIL\t= 10;\n\nFramebuffer.MAX_ATTACHMENT_POINTS = 11;\n\n/**\n *\tGL framebuffer attachment point IDs.\n */\nconst attachmentPointIds = new Array(Framebuffer.MAX_ATTACHMENT_POINTS).fill(null);\nconst defaultDrawBuffers = new Array(1).fill(null);\n\n/**\n * \tInitializes the attachment point IDs.\n */\nconst initAttachmentPointIds = function (gl)\n{\n\tdefaultDrawBuffers[0] = gl.BACK;\n\n\tattachmentPointIds[Framebuffer.COLOR0] = gl.COLOR_ATTACHMENT0;\n\tattachmentPointIds[Framebuffer.COLOR1] = gl.COLOR_ATTACHMENT1;\n\tattachmentPointIds[Framebuffer.COLOR2] = gl.COLOR_ATTACHMENT2;\n\tattachmentPointIds[Framebuffer.COLOR3] = gl.COLOR_ATTACHMENT3;\n\tattachmentPointIds[Framebuffer.COLOR4] = gl.COLOR_ATTACHMENT4;\n\tattachmentPointIds[Framebuffer.COLOR5] = gl.COLOR_ATTACHMENT5;\n\tattachmentPointIds[Framebuffer.COLOR6] = gl.COLOR_ATTACHMENT6;\n\tattachmentPointIds[Framebuffer.COLOR7] = gl.COLOR_ATTACHMENT7;\n\tattachmentPointIds[Framebuffer.DEPTH] = gl.DEPTH_ATTACHMENT;\n\tattachmentPointIds[Framebuffer.STENCIL] = gl.STENCIL_ATTACHMENT;\n\tattachmentPointIds[Framebuffer.DEPTH_STENCIL] = gl.DEPTH_STENCIL_ATTACHMENT;\n};\n\nexport default Framebuffer;\n","/*\n**\tresources/resources.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rin } from '@rsthn/rin';\nimport System from '../system/system.js';\nimport Canvas from '../system/canvas.js';\nimport Log from '../system/log.js';\n\n//![import \"../system/system\"]\n//![import \"../system/canvas\"]\n//![import \"../system/log\"]\n\nconst Resources = { };\nexport default Resources;\n\nimport * as Wrappers from './wrappers.js';\n\nlet reported = false;\n\n/**\n * \tProvides functionality to load and manipulate resources (images, audio, etc).\n */\n\n//!class Resources\n\nObject.assign(Resources,\n{\n\t/**\n\t * \tIndicates if integer scaling is enabled. When `true` calling `resizeImage` will cause images to be up-scaled to integer factors. If `false` images will be\n\t * \tdown or up-scaled using the half/double method and will eventually end up having the exact target size.\n\t *\n\t * \t@default true\n\t * \t!static integerScaling: boolean;\n\t */\n\tintegerScaling: true,\n\n\t/**\n\t * \tDefault value for the `pixelated` parameter of image resources.\n\t * \n\t * \t@default false\n\t * \t!static pixelated: boolean;\n\t */\n\tpixelated: false,\n\n\t/**\n\t * \tInitializes all wrappers and loads the specified options object.\n\t * \t!static init (options?: object) : void;\n\t */\n\tinit: function (opts=null)\n\t{\n\t\tif (opts)\n\t\t\tObject.assign(this, opts);\n\t},\n\n\t/**\n\t * \tLoads a list of resources. The list parameter is actually a dictionary with objects as shown in the example below.\n\t *\n\t * \t{ type: \"image\", wrapper: \"\", src: \"assets/ui/btn-left.png\", width: 64, [ height: 64 ], scale: 1, pixelated: false, original: false }\n\t * \t{ type: \"images\", wrapper: \"\", src: \"assets/ui/##.png\", count: 16, width: 64, [ height: 64 ], pixelated: false }\n\t * \t{ type: \"audio\", wrapper: \"\", src: \"assets/ui/tap.wav\", track: \"sfx|music\" }\n\t * \t{ type: \"audios\", wrapper: \"\", src: \"assets/ui/snd-##.wav\", count: 4 }\n\t * \t{ type: \"json\", wrapper: \"\", src: \"assets/config.json\" }\n\t * \t{ type: \"data\", wrapper: \"\", src: \"assets/config.dat\" }\n\t * \t{ type: \"text\", wrapper: \"\", src: \"assets/config.frag\" }\n\t * \t{ type: \"object\", wrapper: \"\" }\n\t * \n\t * \t@param list - Map of resources to load.\n\t * \t@param progressCallback - Executed once for every resource loaded.\n\t * \t@param completeCallback - Executed when all resources have been loaded.\n\t * \t!static load (list: { [id: string] : object }, progressCallback: (index: number, count: number, ratio: number) => void, completeCallback: (list: { [id: string] : object }) => void) : void;\n\t*/\n\tload: function (list, progressCallback, completeCallback, keyList, index)\n\t{\n\t\tif (!keyList)\n\t\t{\n\t\t\tkeyList = Object.keys(list);\n\n\t\t\tfor (let i in keyList)\n\t\t\t{\n\t\t\t\tif (!('__loaded' in list[keyList[i]]))\n\t\t\t\t\tlist[keyList[i]].__clone = Rin.clone(list[keyList[i]]);\n\t\t\t}\n\n\t\t\tindex = 0;\n\t\t}\n\n\t\twhile (index < keyList.length && ('__loaded' in list[keyList[index]]))\n\t\t\tindex++;\n\n\t\tif (progressCallback)\n\t\t\tprogressCallback (index, keyList.length, index / keyList.length);\n\n\t\tif (index == keyList.length)\n\t\t{\n\t\t\tif (completeCallback)\n\t\t\t\tcompleteCallback(list);\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet r = list[keyList[index]];\n\n\t\tr.resName = keyList[index];\n\n\t\tswitch (r.type)\n\t\t{\n\t\t\tcase \"image\":\n\t\t\t\tr.data = new Image ();\n\n\t\t\t\tr.data.onload = function ()\n\t\t\t\t{\n\t\t\t\t\tvar ratio = r.data.width / r.data.height;\n\n\t\t\t\t\tif (r.scale)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.width = int(r.data.width*r.scale);\n\t\t\t\t\t\tr.height = int(r.data.height*r.scale);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!r.width && !r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.width = r.data.width;\n\t\t\t\t\t\tr.height = r.data.height;\n\t\t\t\t\t}\n\t\t\t\t\telse if (r.width && !r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.height = int(r.width / ratio);\n\t\t\t\t\t}\n\t\t\t\t\telse if (!r.width && r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.width = int(ratio * r.height);\n\t\t\t\t\t}\n\n\t\t\t\t\tr.owidth = r.data.width;\n\t\t\t\t\tr.oheight = r.data.height;\n\n\t\t\t\t\tif (r.pixelated === null || !r.hasOwnProperty('pixelated'))\n\t\t\t\t\t\tr.pixelated = Resources.pixelated;\n\n\t\t\t\t\tif (r.data.width != r.width || r.data.height != r.height || (r.original !== true && System.scaleFactor != 1))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (r.original === true)\n\t\t\t\t\t\t\tr.data = Resources.resizeImage (r, r.width, r.height, r.pixelated, true);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tr.data = Resources.resizeImage (r, r.width * (r.pixelated ? System.integerScaleFactor : System.scaleFactor), r.height * (r.pixelated ? System.integerScaleFactor : System.scaleFactor), r.pixelated, true);\n\t\t\t\t\t}\n\n\t\t\t\t\tr.rscale = r.data.width / r.width;\n\n\t\t\t\t\tr.data.targetWidth = r.width;\n\t\t\t\t\tr.data.targetHeight = r.height;\n\n\t\t\t\t\t// Pre-draw on an offscreen canvas, used to prevent a delay when rendering an image for the first time on some browsers.\n\t\t\t\t\tSystem.tempDisplayBuffer.drawImage(r.data, 0, 0);\n\n\t\t\t\t\tSystem.renderer.prepareImage(r.data);\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index+1);\n\t\t\t\t};\n\n\t\t\t\tr.data.onerror = function () {\n\t\t\t\t\tconsole.error (\"Error: Unable to load: \" + r.resName);\n\t\t\t\t};\n\n\t\t\t\tr.data.src = r.src + \"?r=\" + Math.random();\n\t\t\t\tbreak;\n\n\t\t\tcase \"images\":\n\n\t\t\t\tvar src = r.src;\n\n\t\t\t\tvar d0 = src.indexOf(\"#\");\n\t\t\t\tvar d1 = src.lastIndexOf(\"#\");\n\t\t\t\tvar dN = d1 - d0 + 1;\n\n\t\t\t\tif (d0 == -1)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'src' attribute requires one or more '#' marks.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!r.count)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'count' attribute was not found.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tr._i = 0;\n\t\t\t\tr.data = [ ];\n\n\t\t\t\tvar cb = function ()\n\t\t\t\t{\n\t\t\t\t\tif (r._i == r.count)\n\t\t\t\t\t{\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar tmp = { type: \"image\", width: r.width, height: r.height, scale: r.scale };\n\n\t\t\t\t\ttmp.src = r.src.substr(0, d0) + ((r._i++) / Math.pow(10,dN)).toFixed(dN).substr(2) + r.src.substr(d1+1);\n\t\t\t\t\ttmp.data = new Image ();\n\t\t\t\t\ttmp.resName = r.resName + \"#\" + (r._i - 1);\n\n\t\t\t\t\ttmp.data.onload = function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar ratio = tmp.data.width / tmp.data.height;\n\n\t\t\t\t\t\tif (tmp.scale)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = int(tmp.data.width*tmp.scale);\n\t\t\t\t\t\t\ttmp.height = int(tmp.data.height*tmp.scale);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!tmp.width && !tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = tmp.data.width;\n\t\t\t\t\t\t\ttmp.height = tmp.data.height;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (tmp.width && !tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.height = int(tmp.width / ratio);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!tmp.width && tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = int(ratio * tmp.height);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (r._i == 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tr.owidth = tmp.data.width;\n\t\t\t\t\t\t\tr.oheight = tmp.data.height;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (tmp.data.width != tmp.width || tmp.data.height != tmp.height || (tmp.original !== true && System.scaleFactor != 1))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (r.pixelated === null || !r.hasOwnProperty('pixelated'))\n\t\t\t\t\t\t\t\tr.pixelated = Resources.pixelated;\n\n\t\t\t\t\t\t\tif (tmp.original === true)\n\t\t\t\t\t\t\t\ttmp.data = Resources.resizeImage (tmp, tmp.width, tmp.height, r.pixelated, true);\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\ttmp.data = Resources.resizeImage (tmp, tmp.width * (r.pixelated ? System.integerScaleFactor : System.scaleFactor), tmp.height * (r.pixelated ? System.integerScaleFactor : System.scaleFactor), r.pixelated, true);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttmp.rscale = tmp.data.width / tmp.width;\n\n\t\t\t\t\t\ttmp.data.targetWidth = tmp.width;\n\t\t\t\t\t\ttmp.data.targetHeight = tmp.height;\n\t\n\t\t\t\t\t\tif (r._i == 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tr.width = tmp.width;\n\t\t\t\t\t\t\tr.height = tmp.height;\n\t\t\t\t\t\t\tr.rscale = tmp.rscale;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tSystem.tempDisplayBuffer.drawImage(tmp.data, 0, 0);\n\t\t\t\t\t\tSystem.renderer.prepareImage(tmp.data);\n\n\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\tcb();\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.onerror = function () {\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName);\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.src = tmp.src + \"?r=\" + Math.random();\n\t\t\t\t};\n\n\t\t\t\tcb();\n\t\t\t\tbreak;\n\n\t\t\tcase \"audio\":\n\n\t\t\t\tif (!r.track) r.track = \"sfx\";\n\n\t\t\t\tif (global.plugins && global.plugins.NativeAudio && r.track == \"sfx\")\n\t\t\t\t{\n\t\t\t\t\tif (!reported) {\n\t\t\t\t\t\tLog.write('ENGINE_NATIVEAUDIO');\n\t\t\t\t\t\treported = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tr.engine = Wrappers.Sound.ENGINE_NATIVEAUDIO;\n\t\t\t\t\tr.data = \"snd_\" + index;\n\n\t\t\t\t\tglobal.plugins.NativeAudio.preloadSimple(r.data, r.src,\n\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\t\t\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction(e) {\n\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load (sfx): \" + r.resName + \"\\n\" + e);\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (global.audioContext)\n\t\t\t\t{\n\t\t\t\t\tif (!reported) {\n\t\t\t\t\t\tLog.write('ENGINE_WEBAUDIO');\n\t\t\t\t\t\treported = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tr.engine = Wrappers.Sound.ENGINE_WEBAUDIO;\n\n\t\t\t\t\tfetchAudioBuffer (r.src + \"?r=\" + Math.random())\n\t\t\t\t\t.then (audioBuffer => {\n\t\t\t\t\t\tr.data = audioBuffer;\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\t\t\n\t\t\t\t\t})\n\t\t\t\t\t.catch (err => {\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName);\n\t\t\t\t\t});\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!reported) {\n\t\t\t\t\tLog.write('ENGINE_HTML5');\n\t\t\t\t\treported = true;\n\t\t\t\t}\n\n\t\t\t\tr.data = new Audio ();\n\t\t\t\tr.engine = Wrappers.Sound.ENGINE_HTML5;\n\n\t\t\t\tr.data.oncanplaythrough = function ()\n\t\t\t\t{\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t};\n\n\t\t\t\tr.data.onerror = function ()\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName);\n\t\t\t\t};\n\n\t\t\t\tr.data.src = r.src + \"?r=\" + Math.random();\n\t\t\t\tbreak;\n\n\t\t\tcase \"audios\":\n\n\t\t\t\tvar src = r.src;\n\n\t\t\t\tvar d0 = src.indexOf(\"#\");\n\t\t\t\tvar d1 = src.lastIndexOf(\"#\");\n\t\t\t\tvar dN = d1 - d0 + 1;\n\n\t\t\t\tif (d0 == -1)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'src' attribute requires one or more '#' marks.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!r.count)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'count' attribute was not found.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tr._i = 0;\n\t\t\t\tr.data = [ ];\n\n\t\t\t\tvar cb = function ()\n\t\t\t\t{\n\t\t\t\t\tif (r._i == r.count)\n\t\t\t\t\t{\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar tmp = { type: \"audio\", track: r.track };\n\n\t\t\t\t\ttmp.src = r.src.substr(0, d0) + ((r._i++) / Math.pow(10,dN)).toFixed(dN).substr(2) + r.src.substr(d1+1);\n\t\t\t\t\ttmp.resName = r.resName + \"#\" + (r._i - 1);\n\n\t\t\t\t\tif (!tmp.track) tmp.track = \"sfx\";\n\n\t\t\t\t\tif (global.plugins && global.plugins.NativeAudio && tmp.track == \"sfx\")\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_NATIVEAUDIO;\n\t\t\t\t\t\ttmp.data = \"snd_\" + index + \"_\" + r._i;\n\t\n\t\t\t\t\t\tglobal.plugins.NativeAudio.preloadSimple(tmp.data, tmp.src,\n\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\t\t\tcb();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfunction(e) {\n\t\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load (sfx): \" + tmp.resName + \"\\n\" + e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (global.audioContext)\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_WEBAUDIO;\n\n\t\t\t\t\t\tfetchAudioBuffer (tmp.src + \"?r=\" + Math.random())\n\t\t\t\t\t\t.then (audioBuffer => {\n\t\t\t\t\t\t\ttmp.data = audioBuffer;\n\t\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\t\tcb();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch (err => {\n\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\ttmp.data = new Audio ();\n\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_HTML5;\n\n\t\t\t\t\ttmp.data.oncanplaythrough = function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\tcb();\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.onerror = function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName);\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.src = tmp.src + \"?r=\" + Math.random();\n\t\t\t\t};\n\n\t\t\t\tcb();\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"json\":\n\n\t\t\t\tfetchd (r.src + \"?r=\" + Math.random(), { responseType: 'json' }).then(function(json)\n\t\t\t\t{\n\t\t\t\t\tr.data = json;\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t})\n\t\t\t\t.catch(function(err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName + \". Error: \" + err);\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"data\":\n\n\t\t\t\tfetchd (r.src + \"?r=\" + Math.random()).then(function(arraybuffer)\n\t\t\t\t{\n\t\t\t\t\tr.data = arraybuffer;\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t})\n\t\t\t\t.catch(function(err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName + \". Error: \" + err);\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"text\":\n\n\t\t\t\tfetchd (r.src + \"?r=\" + Math.random()).then(function(arrayBuffer)\n\t\t\t\t{\n\t\t\t\t\tr.data = String.fromCharCode.apply(null, new Uint8Array(arrayBuffer));\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t})\n\t\t\t\t.catch(function(err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName + \". Error: \" + err);\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"object\":\n\t\t\t\tr.data = { };\n\n\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\tbreak;\n\t\t}\n\t},\n\n\t/**\n\t * \tUnloads the specified list of resources.\n\t * \t!static unload (list: { [id: string] : object }) : void;\n\t */\n\tunload: function (list)\n\t{\n\t\tthrow new Error('IMPLEMENTED UNLOAD!');\n\n\t\tvar __original;\n\n\t\tfor (var i in list)\n\t\t{\n\t\t\tif (i == \"__original\")\n\t\t\t{\n\t\t\t\t__original = list[i];\n\t\t\t\tdelete list[i];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (list[i].r)\n\t\t\t{\n\t\t\t\tdispose(list[i]);\n\t\t\t\tlist[i] = list[i].r;\n\t\t\t}\n\n\t\t\tswitch (list[i].type)\n\t\t\t{\n\t\t\t\tcase \"audio\":\n\t\t\t\t\t// violet: unload audio if using NativeAudio\n\t\t\t\t\t// global.plugins.NativeAudio.unload\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"audios\":\n\t\t\t\t\t// violet: unload audio if using NativeAudio\n\t\t\t\t\t// global.plugins.NativeAudio.unload\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"images\":\n\t\t\t\t\tfor (var j = 0; j < list[i].data.length; j++)\n\t\t\t\t\t\tdispose (list[i].data[j]);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tdispose (list[i].data);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tlist[i].data = null;\n\t\t\tdelete list[i];\n\t\t}\n\n\t\tfor (var i in __original)\n\t\t\tlist[i] = __original[i];\n\t},\n\n\t/**\n\t * \tExecutes post-load actions on a resource.\n\t */\n\tonLoaded: function (list, index)\n\t{\n\t\tvar r = list[index];\n\t\tif (!r.wrapper || !(r.wrapper in Wrappers)) return;\n\n\t\tlist[index] = new Wrappers[r.wrapper] (r);\n\t\tlist[index].__loaded = true;\n\t},\n\n\t/**\n\t * \tResizes the given image to the specified size.\n\t * \t!static resizeImage (image: HTMLImageElement, targetWidth: number, targetHeight: number, pixelated?: boolean, discardOriginal?: boolean) : HTMLImageElement;\n\t */\n\tresizeImage: function (image, dw, dh, pixelated, discardOriginal)\n\t{\n\t\tvar sw = image.data.width;\n\t\tvar sh = image.data.height;\n\n\t\tdw = int(dw);\n\t\tdh = int(dh);\n\n\t\tif (sw == dw && sh == dh)\n\t\t\treturn image.data;\n\n\t\tif (!this.integerScaling && pixelated) pixelated = null;\n\n\t\tif (!pixelated)\n\t\t{\n\t\t\tpixelated = pixelated === null ? false : true;\n\n\t\t\tvar temp = new Canvas ({ hidden: true, antialias: pixelated }).resize (sw, sh);\n\t\t\ttemp.drawImage (image.data, 0, 0);\n\n\t\t\twhile (true)\n\t\t\t{\n\t\t\t\tvar tw = sw >> 1;\n\t\t\t\tvar th = sh >> 1;\n\n\t\t\t\tif (tw <= dw || th <= dh)\n\t\t\t\t\tbreak;\n\n\t\t\t\tvar output = new Canvas ({ hidden: true, antialias: pixelated }).resize (tw, th);\n\t\t\t\toutput.drawImage (temp.elem, 0, 0, tw, th);\n\t\t\t\ttemp.dispose ();\n\n\t\t\t\tsw = tw;\n\t\t\t\tsh = th;\n\n\t\t\t\ttemp = output;\n\t\t\t}\n\n\t\t\tvar output = new Canvas ({ hidden: true, antialias: pixelated }).resize (dw, dh);\n\t\t\toutput.drawImage (temp.elem, 0, 0, dw, dh);\n\t\t\ttemp.dispose ();\n\n\t\t\tif (discardOriginal)\n\t\t\t\tdispose (image.data);\n\n\t\t\treturn output.elem;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (int(dw / sw) > 0)\n\t\t\t{\n\t\t\t\tvar ratio = int((dw / sw) + 0.9);\n\n\t\t\t\tdw = ratio * sw;\n\t\t\t\tdh = ratio * sh;\n\n\t\t\t\tvar rep_x = dw / sw;\n\t\t\t\tvar rep_y = dh / sh;\n\n\t\t\t\tvar output = new Canvas ({ hidden: true, antialias: false }).resize (dw, dh);\n\n\t\t\t\tvar temp = new Canvas ({ hidden: true, antialias: false }).resize (sw, sh);\n\t\t\t\ttemp.drawImage (image.data, 0, 0);\n\n\t\t\t\tfor (var j = 0; j < sh; j++)\n\t\t\t\t{\n\t\t\t\t\tvar s = temp.getImageData(0, j, sw, 1).data;\n\t\t\t\t\tvar sp = 0;\n\n\t\t\t\t\tfor (var i = 0; i < sw && sp < s.length; i++, sp += 4)\n\t\t\t\t\t{\n\t\t\t\t\t\toutput.fillStyle(\"rgba(\"+s[sp]+\",\"+s[sp+1]+\",\"+s[sp+2]+\",\"+(s[sp+3] / 255)+\")\");\n\t\t\t\t\t\toutput.fillRect(i*rep_x, j*rep_y, rep_x, rep_y);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttemp.dispose();\n\n\t\t\t\treturn output.elem;\n\t\t\t}\n\n\t\t\treturn this.resizeImage (image, dw, dh, null, discardOriginal);\n\t\t}\n\t},\n\n\t/**\n\t * \tFlips an image horizontally.\n\t * \t!static flipImageHorz (image: HTMLImageElement) : HTMLImageElement;\n\t */\n\tflipImageHorz: function (image)\n\t{\n\t\tvar temp = new Canvas ({ hidden: true }).resize (image.data.width, image.data.height);\n\n\t\ttemp.translate(image.data.width, 0);\n\t\ttemp.scale(-1, 1);\n\n\t\ttemp.drawImage (image.data, 0, 0);\n\n\t\treturn temp.elem;\n\t},\n\n\t/**\n\t * \tForces the browser to show a download dialog.\n\t * \t!static showDownload (filename: string, dataUrl: string) : void;\n\t */\n\tshowDownload: function (filename, dataUrl)\n\t{\n\t\tvar link = document.createElement(\"a\");\n\t\tlink.href = dataUrl;\n\n\t\tlink.style.display = 'none';\n\t\tlink.download = filename;\n\t\tlink.target = \"_blank\";\n\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t},\n\n\t/**\n\t * \tForces the browser to show a file selection dialog.\n\t * \t!static showFilePicker (allowMultiple, accept, callback)\n\t */\n\tshowFilePicker: function (allowMultiple, accept, callback)\n\t{\n\t\tvar input = document.createElement(\"input\");\n\n\t\tinput.type = \"file\";\n\t\tinput.accept = accept;\n\t\tinput.style.display = 'none';\n\t\tinput.multiple = allowMultiple;\n\n\t\tdocument.body.appendChild(input);\n\n\t\tinput.onchange = function ()\n\t\t{\n\t\t\tcallback(input.files);\n\t\t};\n\n\t\tdocument.body.onfocus = function ()\n\t\t{\n\t\t\tdocument.body.onfocus = null;\n\t\t\tdocument.body.removeChild(input);\n\t\t};\n\n\t\tinput.click();\n\t},\n\n\t/**\n\t * \tLoads a file using FileReader and returns the result as a dataURL.\n\t * \t!static loadAsDataURL (file: File, callback: (dataUrl: string) => void) : void;\n\t */\n\tloadAsDataURL: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsDataURL(file);\n\t},\n\n\t/**\n\t * \tLoads a file using FileReader and returns the result as text.\n\t * \t!static loadAsText (file: File, callback: (text: string) => void) : void;\n\t */\n\tloadAsText: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsText(file);\n\t},\n\n\t/**\n\t * \tLoads a file using FileReader and returns the result as an array buffer.\n\t * \t!static loadAsArrayBuffer (file: File, callback: (buff: ArrayBuffer) => void) : void;\n\t */\n\tloadAsArrayBuffer: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsArrayBuffer(file);\n\t},\n\n\t/**\n\t * \tLoads an array of File objects using FileReader and returns them as data URLs.\n\t * \t!static loadAllAsDataURL (fileList: Array<File>, callback: (urlList: Array<String>) => void) : void;\n\t */\n\tloadAllAsDataURL: function (fileList, callback)\n\t{\n\t\tvar result = [];\n\n\t\tif (!fileList || !fileList.length)\n\t\t{\n\t\t\tcallback(result);\n\t\t\treturn;\n\t\t}\n\n\t\tvar loadNext = function (i)\n\t\t{\n\t\t\tif (i == fileList.length)\n\t\t\t{\n\t\t\t\tcallback(result);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tResources.loadAsDataURL (fileList[i], function(url) {\n\t\t\t\tresult.push({ name: fileList[i].name, size: fileList[i].size, url: url });\n\t\t\t\tloadNext(i+1);\n\t\t\t});\n\t\t};\n\n\t\tloadNext(0);\n\t}\n});\n","/*\n**\tresources/drawable\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Resources from './resources.js';\n\n//![import \"./resources\"]\n\nexport default Class.extend\n({\n\tclassName: \"Drawable\",\n\n\twidth: null,\n\theight: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"image\")\n\t\t\tthrow new Error (\"Resource is not an image.\");\n\n\t\tthis.width = r.width;\n\t\tthis.height = r.height;\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\t},\n\n\tdraw: function (g, x=0, y=0, width=null, height=null)\n\t{\n\t\tg.drawImage (this.r.data, 0, 0, this.r.data.width, this.r.data.height, x, y, width || this.r.width, height || this.r.height,\n\t\t\tnull, null, this.width, this.height);\n\t},\n\n\tgetImage: function()\n\t{\n\t\treturn this.r.data;\n\t},\n\n\tgetDrawable: function()\n\t{\n\t\treturn this;\n\t}\n});\n\n/**\n * \tCreates a descriptor for an image resource.\n */\nResources.Image = function (src, opts=null)\n{\n\treturn { type: \"image\", wrapper: \"Drawable\", src: src, pixelated: null, ...opts };\n};\n","/*\n**\tresources/placeholder.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Canvas from '../system/canvas.js';\nimport Resources from './resources.js';\n\n//![import \"../system/canvas\"]\n//![import \"./resources\"]\n\nexport default Class.extend\n({\n\tclassName: \"Placeholder\",\n\n\twidth: null,\n\theight: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"object\")\n\t\t\tthrow new Error (\"Resource is not an object.\");\n\n\t\tthis.width = r.width;\n\t\tthis.height = r.height;\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tthis.data = null;\n\n\t\tCanvas.renderImage(r.width, r.height,\n\t\t(g) => {\n\t\t\tg.fillStyle(this.r.color);\n\t\t\tg.fillRect(0, 0, r.width, r.height);\n\t\t},\n\t\t(img) => {\n\t\t\tthis.data = img;\n\t\t});\n\t},\n\n\tdraw: function (g, x=0, y=0, width=null, height=null)\n\t{\n\t\tif (!this.data)\n\t\t\treturn;\n\n\t\tg.drawImage (this.data, 0, 0, this.data.width, this.data.height, x, y, width || this.width, height || this.height);\n\t},\n\n\tgetImage: function()\n\t{\n\t\treturn this.data;\n\t},\n\n\tgetDrawable: function()\n\t{\n\t\treturn this;\n\t}\n});\n\n/**\n**\tCreates a descriptor for a placeholder.\n*/\nResources.Placeholder = function (width, height, color='#ff0000', opts=null)\n{\n\treturn { type: \"object\", wrapper: \"Placeholder\", width: width, height: height, color: color, ...opts };\n};\n","/*\n**\tresources/spritesheet.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Canvas from '../system/canvas.js';\n\n//![import \"../system/canvas\"]\n\n/*\n\tIf source is \"image\":\n\t\tconfig: {\n\t\t\tsheetWidth: int, frameWidth: int, frameHeight: int?, numFrames: int?\n\t\t\t--OR--\n\t\t\tnumFrames: int, frameWidth: int, frameHeight: int?\n\t\t}\n\n\tIf source is \"images\":\n\t\tconfig: {\n\t\t\tframeWidth: int, frameHeight: int\n\t\t}\n\t\t\n\tNOTE: The sheetWidth, frameWidth and frameHeight should reflect the real image size. The system will automatically scale it if the source image is smaller/bigger.\n*/\n\nexport default Class.extend\n({\n\tclassName: 'Spritesheet',\n\n\twidth: 0,\n\theight: 0,\n\n\tnumCols: 0,\n\tnumFrames: 0,\n\n\tdrawableCache: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif ((r.type != 'image' && r.type != 'images'))\n\t\t\tthrow new Error ('Resource is not a sprite sheet.');\n\n\t\tvar r_scale, v_scale;\n\n\t\tif (r.type == 'image')\n\t\t{\n\t\t\tif (!r.config.sheetWidth && (!r.config.numFrames || !r.config.frameWidth))\n\t\t\t\tthrow new Error (r.resName + ': required sheetWidth or numFrames+frameWidth');\n\n\t\t\tif (!r.config.sheetWidth)\n\t\t\t\tr.config.sheetWidth = r.width; //r.config.numFrames * r.config.frameWidth;\n\n\t\t\tif (!r.config.frameHeight)\n\t\t\t\tr.config.frameHeight = r.data.height;\n\n\t\t\tr_scale = r.data.width / r.config.sheetWidth;\n\t\t\tv_scale = r.width / r.config.sheetWidth;\n\t\t}\n\t\telse // r.type == 'images'\n\t\t{\n\t\t\tif (!r.config) r.config = { };\n\n\t\t\tif (!r.config.frameWidth)\n\t\t\t\tr.config.frameWidth = r.data[0].width;\n\n\t\t\tif (!r.config.frameHeight)\n\t\t\t\tr.config.frameHeight = r.data[0].height;\n\n\t\t\tr_scale = r.data[0].data.width / r.config.frameWidth;\n\t\t\tv_scale = r.data[0].width / r.config.frameWidth;\n\t\t}\n\n\t\t// Physical frame dimensions.\n\t\tthis.frameWidth = (r.config.frameWidth * r_scale);\n\t\tthis.frameHeight = (r.config.frameHeight * r_scale);\n\n\t\t// Logical frame dimensions.\n\t\tthis.width = r.config.frameWidth * v_scale;\n\t\tthis.height = r.config.frameHeight * v_scale;\n\n\t\tif (r.type == 'image')\n\t\t{\n\t\t\tthis.numCols = int(r.data.width / this.frameWidth);\n\t\t\tthis.numRows = Math.ceil(r.data.height / this.frameHeight);\n\n\t\t\tthis.numFrames = r.config.numFrames || (this.numCols * this.numRows);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.numCols = this.numRows = 0;\n\t\t\tthis.numFrames = r.data.length;\n\t\t}\n\n\t\tthis.drawableCache = { };\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\t},\n\n\tdrawFrame: function (g, x, y, frame, width=0, height=0)\n\t{\n\t\tif (frame < 0 || frame >= this.numFrames)\n\t\t\treturn;\n\n\t\tif (!width) width = this.width;\n\t\tif (!height) height = this.height;\n\n\t\tif (this.numCols != 0)\n\t\t{\n\t\t\tvar j = int(frame / this.numCols) * this.frameHeight;\n\t\t\tvar i =  (frame % this.numCols) * this.frameWidth;\n\n\t\t\tg.drawImage (this.r.data, i, j, this.frameWidth, this.frameHeight, x, y, width, height, null, null, this.width, this.height);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tg.drawImage (this.r.data[frame].data, 0, 0, this.frameWidth, this.frameHeight, x, y, width, height, null, null, this.width, this.height);\n\t\t}\n\t},\n\n\tgetFrame: function (x, y=null)\n\t// OR getFrame: function (frameIndex)\n\t{\n\t\tlet frameIndex;\n\n\t\tif (y !== null)\n\t\t\tframeIndex = y*this.numCols+x;\n\t\telse\n\t\t\tframeIndex = x;\n\n\t\tif (frameIndex < 0 || frameIndex >= this.numFrames)\n\t\t\tthrow new Error ('frameIndex out of range');\n\n\t\tif (!this.drawableCache[frameIndex])\n\t\t{\n\t\t\tthis.drawableCache[frameIndex] =\n\t\t\t{\n\t\t\t\twidth: this.width,\n\t\t\t\theight: this.height,\n\n\t\t\t\tframeIndex: frameIndex,\n\t\t\t\tspritesheet: this,\n\n\t\t\t\tdraw: function (g, x=0, y=0, width=0, height=0)\n\t\t\t\t{\n\t\t\t\t\tg.drawFrame (this.spritesheet, x, y, this.frameIndex, width, height);\n\t\t\t\t},\n\n\t\t\t\tgetImage: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.spritesheet.r.data;\n\t\t\t\t},\n\n\t\t\t\tgetDrawable: function()\n\t\t\t\t{\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\treturn this.drawableCache[frameIndex];\n\t},\n\n\tgetImage: function()\n\t{\n\t\treturn this.r.data;\n\t},\n\n\tgetDrawable: function()\n\t{\n\t\treturn this.getFrame(0);\n\t}\n});\n\nCanvas.prototype.drawFrame = function (r, x, y, frameIndex, width, height)\n{\n\tr.drawFrame (this, x, y, frameIndex, width, height);\n};\n","/*\n**\tresources/spritesheet-animation.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Spritesheet from './spritesheet.js';\nimport System from '../system/system.js';\nimport List from '../utils/list.js';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"./spritesheet\"]\n//![import \"../system/system\"]\n//![import \"../utils/list\"]\n//![import \"../utils/recycler\"]\n\n/*\n\tanim: {\n\t\tdef: string, fps: int?,\n\n\t\tseq: {\n\t\t\tseq1: { loop: bool?, group: [ [int, int, ...], ... ] },\n\t\t\tseq2: { loop: bool?, group: [ [int, int, ...], ... ] },\n\t\t\tseq2: { loop: bool?, group: \"0-12\" },\n\t\t\tseq2: { loop: bool?, group: \"4 1 1 2 3\" },\n\t\t},\n\n\t\ttrans: {\n\t\t\tseq1: {\n\t\t\t\tseq2: [ seq_name, seq_name, ... ]\n\t\t\t}\n\t\t}\n\t}\n\n\tNOTE: When specifying a group such as \"0,12\" it means to draw tiles 0 and the 12 in that single frame.\n*/\n\nexport const Animation = Class.extend\n({\n\tclassName: 'Animation',\n\n\twidth: null,\n\theight: null,\n\n\tseq: null, seq_i: 0,\n\ttrans: null, trans_i: 0, trans_t: null,\n\n\tqueue: null,\n\n\tfps: 0, frameSeconds: 0, time: 0,\n\n\tframeNumber: -1,\n\n\tfinished: false,\n\t_paused: false,\n\n\tfinishedCallback: null,\n\tfinishedCallbackHandler: null,\n\tfinishedCallbackContext: null,\n\n\tframeCallback: null,\n\n\t__ctor: function (anim, seq, fps)\n\t{\n\t\tthis.anim = anim;\n\t\tthis.queue = List.Pool.alloc();\n\n\t\tthis.seq = seq;\n\t\tthis.seq_i = 0;\n\n\t\tthis.trans = null;\n\t\tthis.trans_i = 0;\n\t\tthis.trans_t = null;\n\n\t\tthis.width = anim.width;\n\t\tthis.height = anim.height;\n\n\t\tthis.frameNumber = -1;\n\t\tthis.finished = false;\n\t\tthis._paused = false;\n\n\t\tthis.finishedCallback = null;\n\t\tthis.finishedCallbackHandler = null;\n\t\tthis.finishedCallbackContext = null;\n\t\tthis.frameCallback = null;\n\n\t\tthis.fps = fps;\n\t\tthis.setFps (this.seq.fps || this.fps);\n\t},\n\n\t__dtor: function ()\n\t{\n\t\tthis.queue.free();\n\n\t\tif (this.finishedCallbackHandler)\n\t\t\tthis.finishedCallbackHandler.free();\n\n\t\tif (this.finishedCallbackContext)\n\t\t\tthis.finishedCallbackContext.free();\n\t},\n\n\tsetFps: function (fps)\n\t{\n\t\tthis.frameSeconds = 1.0 / fps;\n\t\tthis.time = 0;\n\n\t\treturn this;\n\t},\n\n\tpaused: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._paused;\n\n\t\tthis._paused = value;\n\t\treturn this;\n\t},\n\n\tsetInitialDelay: function (dt)\n\t{\n\t\tthis.time = -dt;\n\t\treturn this;\n\t},\n\n\tonFinished: function (callback)\n\t{\n\t\tthis.finishedCallback = callback;\n\t\treturn this;\n\t},\n\n\tthen: function (callback, context=null)\n\t{\n\t\tif (callback === false && this.finishedCallback === this.thenCallback)\n\t\t{\n\t\t\tthis.finishedCallbackHandler.clear();\n\t\t\tthis.finishedCallbackContext.clear();\n\t\t}\n\n\t\tif (!callback) return this;\n\n\t\tif (this.finishedCallback !== this.thenCallback)\n\t\t{\n\t\t\tthis.finishedCallback = this.thenCallback;\n\t\t\tthis.finishedCallbackHandler = List.Pool.alloc();\n\t\t\tthis.finishedCallbackContext = List.Pool.alloc();\n\t\t}\n\n\t\tthis.finishedCallbackHandler.push(callback);\n\t\tthis.finishedCallbackContext.push(context);\n\t\treturn this;\n\t},\n\n\tthenCallback: function ()\n\t{\n\t\tif (!this.finishedCallbackHandler.length)\n\t\t\treturn false;\n\n\t\tlet context = this.finishedCallbackContext.shift();\n\t\tthis.finishedCallbackHandler.shift()(this, context);\n\t},\n\n\tonFrame: function (fn)\n\t{\n\t\tthis.frameCallback = fn;\n\t\treturn this;\n\t},\n\n\tsetFrame: function (i)\n\t{\n\t\tthis.seq_i = int(i) % this.seq.group.length;\n\t\treturn this;\n\t},\n\n\tgetFrame: function (normalized)\n\t{\n\t\treturn normalized === true ? (this.seq_i / (this.seq.group.length-1)) : this.seq_i;\n\t},\n\n\tgetLength: function ()\n\t{\n\t\treturn this.seq.group.length;\n\t},\n\n\tdraw: function (g, x=0, y=0, width=0, height=0)\n\t{\n\t\tif (this.time < 0)\n\t\t{\n\t\t\tif (!this._paused)\n\t\t\t{\n\t\t\t\tthis.time += this.frameNumber === System.frameNumber ? 0 : System.frameDelta;\n\t\t\t\tthis.frameNumber = System.frameNumber;\n\t\t\t}\n\n\t\t\tif (this.time > 0) this.time = 0;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.seq_i === this.seq.group.length)\n\t\t{\n\t\t\tlet t = this.seq.group[this.seq_i-1];\n\n\t\t\tif (g != null)\n\t\t\t{\n\t\t\t\tfor (let i = 0; i < t.length; i++)\n\t\t\t\t\tg.drawFrame (this.anim, x, y, t[i], width, height);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet t = this.seq.group[this.seq_i];\n\n\t\tif (g != null)\n\t\t{\n\t\t\tfor (let i = 0; i < t.length; i++)\n\t\t\t\tg.drawFrame (this.anim, x, y, t[i], width, height);\n\t\t}\n\n\t\tif (!this._paused)\n\t\t{\n\t\t\tthis.time += this.frameNumber === System.frameNumber ? 0 : System.frameDelta;\n\t\t\tthis.frameNumber = System.frameNumber;\n\t\t}\n\n\t\tif (this.time >= this.frameSeconds)\n\t\t{\n\t\t\tconst frameIndex = this.seq_i;\n\n\t\t\tthis.time -= this.frameSeconds;\n\t\t\tthis.seq_i++;\n\n\t\t\tif (this.seq_i === this.seq.group.length)\n\t\t\t{\n\t\t\t\tif (this.trans != null)\n\t\t\t\t{\n\t\t\t\t\tif (++this.trans_i === this.trans.length)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.trans = null;\n\t\t\t\t\t\tthis.seq = this.trans_t;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tthis.seq = this.trans[this.trans_i];\n\n\t\t\t\t\tthis.setFps (this.seq.fps || this.fps);\n\n\t\t\t\t\tthis.seq_i = 0;\n\t\t\t\t\tthis.time = 0;\n\n\t\t\t\t\tthis.finished = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (this.seq.loop)\n\t\t\t\t\t\tthis.seq_i = 0;\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.finished = true;\n\n\t\t\t\t\t\tif (this.finishedCallback)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.finishedCallback(this) === false)\n\t\t\t\t\t\t\t\tthis.finishedCallback = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.queue.length)\n\t\t\t\t\t\tthis.use(this.queue.shift(), true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.frameCallback)\n\t\t\t{\n\t\t\t\tif (this.frameCallback(frameIndex, this.seq.group.length-1, this) === false)\n\t\t\t\t\tthis.frameCallback = null;\n\t\t\t}\n\t\t}\n\t},\n\n\tgetImage: function()\n\t{\n\t\treturn this.anim.getImage();\n\t},\n\n\tgetDrawable: function()\n\t{\n\t\treturn this;\n\t},\n\n\tadvance: function ()\n\t{\n\t\tthis.paused (false);\n\t\tthis.draw (null, 0, 0);\n\t},\n\n\tgetSequenceName: function ()\n\t{\n\t\treturn (this.trans === null ? this.seq : this.trans_t).name;\n\t},\n\n\tuse: function (seqName, force=false)\n\t{\n\t\tlet seq = this.trans === null ? this.seq : this.trans_t;\n\n\t\tif (seq.name === seqName && !this.finished && force !== true)\n\t\t\treturn false;\n\n\t\tif (seq.trans && seq.trans[seqName])\n\t\t{\n\t\t\tthis.trans_t = this.anim.a.seq[seqName];\n\n\t\t\tthis.trans = seq.trans[seqName];\n\t\t\tthis.trans_i = 0;\n\n\t\t\tthis.seq = this.trans[this.trans_i];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (force === true)\n\t\t\t\tthis.trans = null;\n\n\t\t\tthis.seq = this.anim.a.seq[seqName];\n\t\t}\n\n\t\tthis.setFps (this.seq.fps || this.fps);\n\n\t\tthis.seq_i = 0;\n\t\tthis.time = 0;\n\n\t\tthis.finished = false;\n\t\treturn true;\n\t},\n\n\tplay: function (name)\n\t{\n\t\tthis.use(name);\n\t\treturn this;\n\t},\n\n\tsetQueue: function (list)\n\t{\n\t\tif (!List.isInstance(list))\n\t\t\tthrow new Error('setQueue: Parameter must be an instance of List');\n\n\t\tif (this.queue != null)\n\t\t\tthis.queue.clear().free();\n\n\t\tthis.queue = list;\n\t\tthis.use(this.queue.shift(), true);\n\t},\n\n\tenqueue: function (seqName, force=false)\n\t{\n\t\tlet seq = this.trans === null ? this.seq : this.trans_t;\n\n\t\tlet lastName = this.queue.length > 0 ? this.queue[this.queue.length-1] : seq.name;\n\n\t\tif (seq.name === seqName && seq.loop)\n\t\t\treturn this;\n\n\t\tif (lastName === seqName && !force)\n\t\t\treturn this;\n\n\t\tif (seq.loop || this.finished)\n\t\t{\n\t\t\tthis.use(seqName, true);\n\t\t\treturn this;\n\t\t}\n\n\t\tthis.queue.push(seqName);\n\t\treturn this;\n\t}\n});\n\nRecycler.createPool(Animation);\n\n/* ********************************************************** */\nexport default Spritesheet.extend\n({\n\tclassName: 'SpritesheetAnimation',\n\n\tdefaultDrawable: null,\n\tsharedAnim: null,\n\n\tr: null,\n\ta: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (!r.anim) throw new Error (\"Animation descriptors not found.\");\n\n\t\tthis._super.Spritesheet.__ctor (r);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tlet t = this.a = this.r.anim;\n\n\t\tif (t.initialized) return;\n\n\t\tif (!t.def) t.def = 'def';\n\t\tif (!t.seq) t.seq = { };\n\n\t\t// Create default sequence if it wasn't defined.\n\t\tif (!t.seq[t.def] && (t.def == 'def' || t.def == 'defloop'))\n\t\t{\n\t\t\tlet p = { loop: (t.def == 'def' ? false : true), group: [ ] };\n\n\t\t\tfor (let i = 0; i < this.numFrames; i++) {\n\t\t\t\tp.group.push([i]);\n\t\t\t}\n\n\t\t\tt.seq[t.def] = p;\n\t\t}\n\n\t\tif (!t.seq[t.def])\n\t\t\tthrow new Error ('Undefined default sequence: ' + t.def);\n\n\t\tif (!t.fps) t.fps = 25;\n\n\t\tt.def = t.seq[t.def];\n\n\t\tlet frameIndex = 0;\n\n\t\tfor (let i in t.seq)\n\t\t{\n\t\t\tt.seq[i].name = i;\n\n\t\t\tif (!t.seq[i].loop)\n\t\t\t\tt.seq[i].loop = false;\n\n\t\t\tif (typeof(t.seq[i].group) == 'string')\n\t\t\t{\n\t\t\t\tlet a, b, c;\n\n\t\t\t\tif (t.seq[i].group.indexOf(' ') != -1)\n\t\t\t\t{\n\t\t\t\t\ta = t.seq[i].group.split(' ');\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\tfor (let j in a)\n\t\t\t\t\t\tt.seq[i].group.push([int(a[j])]);\n\t\t\t\t}\n\t\t\t\telse if (t.seq[i].group.indexOf('-') != -1)\n\t\t\t\t{\n\t\t\t\t\tc = t.seq[i].group.split('-');\n\t\t\t\t\t\n\t\t\t\t\ta = int(c[0]);\n\t\t\t\t\tb = int(c[1]);\n\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\tif (a < b) {\n\t\t\t\t\t\tfor (c = a; c <= b; c++)\n\t\t\t\t\t\t\tt.seq[i].group.push([c]);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tfor (c = a; c >= b; c--)\n\t\t\t\t\t\t\tt.seq[i].group.push([c]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ta = int(t.seq[i].group);\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\twhile (a--) t.seq[i].group.push([frameIndex++]);\n\t\t\t\t}\n\n\t\t\t\tt.seq[i].count = t.seq[i].group.length;\n\t\t\t}\n\t\t}\n\n\t\tif (t.trans)\n\t\t{\n\t\t\tfor (let i in t.trans)\n\t\t\t{\n\t\t\t\tt.seq[i].trans = t.trans[i];\n\n\t\t\t\tfor (let j in t.trans[i])\n\t\t\t\t{\n\t\t\t\t\tfor (let k = 0; k < t.trans[i][j].length; k++)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet n = t.trans[i][j][k];\n\n\t\t\t\t\t\tif (!t.seq[n]) throw new Error ('Undefined sequence: ' + n);\n\t\t\t\t\t\tt.trans[i][j][k] = t.seq[n];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tt.initialized = true;\n\t},\n\n\tgetSharedAnimation: function (initialseq=null)\n\t{\n\t\tif (this.sharedAnim === null)\n\t\t{\n\t\t\tthis.sharedAnim = Animation.Pool.alloc(this, initialseq ? this.a.seq[initialseq] : this.a.def, this.a.fps);\n\t\t\tthis.sharedAnim.lockInstance(true);\n\n\t\t\treturn this.sharedAnim;\n\t\t}\n\n\t\treturn this.sharedAnim.play(initialseq ? initialseq : this.a.def.name);\n\t},\n\n\tgetAnimation: function (initialseq=null, fps=null)\n\t{\n\t\treturn Animation.Pool.alloc(this, initialseq ? this.a.seq[initialseq] : this.a.def, fps || this.a.fps);\n\t},\n\n\tgetSequence: function (name)\n\t{\n\t\treturn this.a.seq[name];\n\t},\n\n\tgetImage: function()\n\t{\n\t\treturn this.r.data;\n\t},\n\n\tgetDrawable: function()\n\t{\n\t\tif (this.defaultDrawable === null)\n\t\t\tthis.defaultDrawable = this.getAnimation();\n\n\t\treturn this.defaultDrawable;\n\t}\n});\n","/*\n**\tresources/spritefont.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Canvas from '../system/canvas.js';\n\n//![import \"../system/canvas\"]\n\n/*\n\tfont: {\n\t\tsheetWidth: int?, charWidth: int, charHeight: int, charset: string, widths: [char, width, ...]\n\t}\n*/\n\nexport default Class.extend\n({\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != 'image' || !r.font)\n\t\t\tthrow new Error ('Resource is not a sprite font.');\n\n\t\tif (!r.font.sheetWidth)\n\t\t\tr.font.sheetWidth = r.width;\n\n\t\tlet r_scale = r.data.width / r.font.sheetWidth;\n\t\tlet v_scale = r.width / r.font.sheetWidth;\n\n\t\tthis.r_charWidth = (r.font.charWidth * r_scale);\n\t\tthis.r_charHeight = (r.font.charHeight * r_scale);\n\n\t\tthis.charWidth = (r.font.charWidth * v_scale);\n\t\tthis.charHeight = (r.font.charHeight * v_scale);\n\n\t\tthis.paddingX = (r.font.paddingX || 0) * v_scale;\n\t\tthis.paddingY = (r.font.paddingY || 0) * v_scale;\n\n\t\tthis.spacingX = (r.font.spacingX || 0) * v_scale;\n\t\tthis.spacingY = (r.font.spacingY || 0) * v_scale;\n\n\t\tlet cols = int(r.font.sheetWidth / r.font.charWidth);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tlet n = r.font.charset.length;\n\t\tlet k = 0;\n\t\tlet y = 0;\n\n\t\tthis.charTable = { };\n\n\t\tthis.charTable[' '] = { charWidth: int((this.charWidth + this.paddingX)*2/3), r_charWidth: this.r_charWidth };\n\n\t\twhile (k < n)\n\t\t{\n\t\t\tlet x = 0;\n\n\t\t\tfor (let i = 0; i < cols && k < n; i++)\n\t\t\t{\n\t\t\t\tlet c = r.font.charset[k++];\n\n\t\t\t\tthis.charTable[c] = { x: x, y: y, charWidth: this.charWidth, r_charWidth: this.r_charWidth };\n\n\t\t\t\tx += this.r_charWidth;\n\t\t\t}\n\n\t\t\ty += this.r_charHeight;\n\t\t}\n\n\t\tif (!r.font.widths) return;\n\n\t\tn = r.font.widths.length;\n\n\t\tfor (let i = 0; i < n; i += 2)\n\t\t{\n\t\t\tlet w1 = (r.font.widths[i] * v_scale);\n\t\t\tlet w2 = (r.font.widths[i] * r_scale);\n\n\t\t\tlet s = r.font.widths[i+1];\n\n\t\t\tfor (let j = 0; j < s.length; j++)\n\t\t\t{\n\t\t\t\tthis.charTable[s[j]].charWidth = w1;\n\t\t\t\tthis.charTable[s[j]].r_charWidth = w2;\n\t\t\t}\n\t\t}\n\t},\n\n\tdrawText: function (g, x, y, text)\n\t{\n\t\tlet n = text.length;\n\n\t\tlet pX = -2*this.paddingX + this.spacingX;\n\n\t\tx -= this.paddingX;\n\t\ty -= this.paddingY;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tif (text[i] == ' ')\n\t\t\t{\n\t\t\t\tx += this.charTable[text[i]].charWidth + pX;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet c = this.charTable[text[i]];\n\t\t\tif (!c) continue;\n\n\t\t\tg.drawImage (this.r.data, c.x, c.y, c.r_charWidth, this.r_charHeight, x, y, c.charWidth, this.charHeight, null, null, c.charWidth, this.charHeight);\n\n\t\t\tx += c.charWidth + pX;\n\t\t}\n\t},\n\n\tmeasureWidth: function (text)\n\t{\n\t\tlet n = text.length;\n\t\tlet x = 0;\n\n\t\tlet pX = -2*this.paddingX + this.spacingX;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tlet c = this.charTable[text[i]];\n\t\t\tif (!c) continue;\n\n\t\t\tx += c.charWidth + pX;\n\t\t}\n\n\t\treturn x;\n\t},\n\n\tmeasureHeight: function (text)\n\t{\n\t\treturn this.charHeight - 2*this.paddingY + this.spacingY;\n\t},\n\n\tgetImage: function()\n\t{\n\t\treturn this.r.data;\n\t}\n});\n\n\nCanvas.prototype.drawText = function (r, x, y, text)\n{\n\tr.drawText (this, x, y, text);\n};\n\nCanvas.prototype.drawTextAligned = function (r, x, y, w, h, ax, ay, text)\n{\n\tif (ax == 0) // Align-Center\n\t\tx = x + ((w - r.measureWidth(text)) >> 1);\n\telse if (ax < 0) // Align-Left\n\t\tx = x - ax - 1;\n\telse if (ax > 0) // Align-Right\n\t\tx = x + w - ax + 1 - r.measureWidth(text);\n\n\tif (ay == 0) // Align-Center\n\t\ty = y + ((h - r.measureHeight(text)) >> 1);\n\telse if (ay < 0) // Align-Top\n\t\ty = y - ay - 1;\n\telse if (ay > 0) // Align-Bottom\n\t\ty = y + h - ay + 1 - r.measureHeight(text);\n\n\tr.drawText (this, x, y, text);\n};\n\nCanvas.prototype.drawTextAligned2 = function (r, bounds, ax, ay, text)\n{\n\tthis.drawTextAligned (r, bounds.x1, bounds.y1, bounds.width(), bounds.height(), ax, ay, text);\n};\n","/*\n**\tresources/sound.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Resources from './resources.js';\n\n//![import \"./resources\"]\n\n/*\n\ttrack: string (music|sfx)\n*/\n\nconst Sound = Class.extend\n({\n\tr: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"audio\")\n\t\t\tthrow new Error (\"Resource is not audio.\");\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tthis.track = Sound[this.r.track.toUpperCase()];\n\t},\n\n\tplay: function (callback, volume)\n\t{\n\t\treturn Sound.play (this, callback, volume);\n\t},\n\n\tplayLoop: function (callback, volume)\n\t{\n\t\treturn Sound.playLoop (this, callback, volume);\n\t}\n});\n\nSound.ENGINE_HTML5 = 1;\nSound.ENGINE_WEBAUDIO = 2;\nSound.ENGINE_NATIVEAUDIO = 3;\n\nObject.assign(Sound,\n{\n\tMASTER: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tSFX: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tMUSIC: {\n\t\tenabled: true,\n\t\tvolume: 0.8\n\t},\n\n\tVOICE: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tMAX_POOL_SIZE: 100,\n\n\tpool: [ ],\n\tactive: [ ],\n\n\tregister: function (node)\n\t{\n\t\tif (node.registered) return;\n\n\t\tnode.registered = true;\n\t\tthis.active.push(node);\n\t},\n\n\tunregister: function (node)\n\t{\n\t\tif (!node.registered) return;\n\n\t\tnode.registered = false;\n\n\t\tvar i = Sound.active.indexOf(node);\n\t\tif (i == -1) return;\n\n\t\tSound.active.splice(i, 1);\n\t},\n\n\tupdateNode: function (node, cmd)\n\t{\n\t\tswitch (node.snd.r.engine)\n\t\t{\n\t\t\tcase Sound.ENGINE_WEBAUDIO:\n\t\t\t\treturn this.updateNode_webaudio(node, cmd);\n\n\t\t\tcase Sound.ENGINE_NATIVEAUDIO:\n\t\t\t\treturn this.updateNode_nativeaudio(node, cmd);\n\t\t}\n\n\t\treturn this.updateNode_audio(node, cmd);\n\t},\n\n\t// Web Audio.\n\talloc_webaudio: function (node)\n\t{\n\t\tnode.gainNode = audioContext.createGain();\n\t\tnode.gainNode.gain.value = 0;\n\t\tnode.gainNode.connect(audioContext.destination);\n\n\t\tnode.res = audioContext.createBufferSource();\n\t\tnode.res.buffer = node.snd.r.data;\n\t\tnode.res.loop = false;\n\t\tnode.res.connect(node.gainNode);\n\t\tnode.res.node = node;\n\t},\n\n\tfree_webaudio: function (node)\n\t{\n\t\tif (!node.res) return;\n\n\t\tnode.gainNode.disconnect();\n\n\t\tnode.res = null;\n\t\tnode.gainNode = null;\n\t},\n\n\t// Native Audio (Cordova plugin).\n\talloc_nativeaudio: function (node)\n\t{\n\t\tnode.res = true;\n\t},\n\n\tfree_nativeaudio: function (node)\n\t{\n\t\tnode.res = false;\n\t},\n\n\t// HTML5 Audio.\n\talloc_audio: function (node)\n\t{\n\t\tif (!this.pool.length)\n\t\t\titem = node.cloneNode();\n\t\telse\n\t\t\titem = this.pool.pop();\n\n\t\titem._src = node.src;\n\t\treturn item;\n\t},\n\n\tfree_audio: function (node)\n\t{\n\t\tif (this.pool.length == this.MAX_POOL_SIZE)\n\t\t\treturn;\n\n\t\t//BUG: This causes a GET request of \"/null\" on Chromium.\n\t\t//node.src = null;\n\n\t\tthis.pool.push(node);\n\t},\n\n\t/* *********************** */\n\tupdateNode_webaudio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tvar volume = Sound.MASTER.volume * node.snd.track.volume * node.volume;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t\tSound.alloc_webaudio(node);\n\n\t\t\t\tnode.playTime = hrnow();\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.onended = Sound.onended_webaudio;\n\t\t\t\tnode.gainNode.gain.value = volume;\n\n\t\t\t\ttry {\n\t\t\t\t\tnode.res.start(0, node.startTime/1000.0);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_webaudio(node);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.gainNode.gain.value = volume;\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\n\t\t\t\t\tSound.free_webaudio(node);\n\t\n\t\t\t\t\tif (node.callback) node.callback();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\t\t\t\tnode.res.onended = null;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tnode.res.stop();\n\n\t\t\t\tSound.free_webaudio(node);\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime += hrnow() - node.playTime;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = true;\n\t\t\t\tnode.res.onended = null;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tnode.res.stop();\n\n\t\t\t\tSound.free_webaudio(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.loop = false;\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_webaudio: function (e)\n\t{\n\t\tvar node = e.currentTarget.node;\n\n\t\tif (node.playing && node.loop != 0)\n\t\t{\n\t\t\tSound.free_webaudio(node);\n\n\t\t\tif (node.loop != -1)\n\t\t\t\tnode.loop--;\n\n\t\t\tnode.startTime = 0;\n\t\t\tnode.playing = false;\n\t\t\tnode.pause = false;\n\n\t\t\tSound.updateNode_webaudio (node, 'play');\n\t\t\treturn;\n\t\t}\n\n\t\tnode.res.onended = null;\n\t\tnode.res.volume = 0;\n\n\t\tSound.updateNode_webaudio (node, 'stop');\n\t},\n\n\t/* *********************** */\n\tupdateNode_nativeaudio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t\tSound.alloc_nativeaudio(node);\n\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\ttry {\n\t\t\t\t\tglobal.plugins.NativeAudio.play (node.snd.r.data, null, null, function() { Sound.onended_nativeaudio(node); } );\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_nativeaudio(node);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tglobal.plugins.NativeAudio.stop (node.snd.r.data, null);\n\n\t\t\t\tSound.free_nativeaudio(node);\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_nativeaudio: function (node)\n\t{\n\t\tSound.updateNode_nativeaudio (node, 'stop');\n\t},\n\n\tupdateNode_audio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tvar volume = Sound.MASTER.volume * node.snd.track.volume * node.volume;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t{\n\t\t\t\t\tnode.res = Sound.alloc_audio (node.snd.r.data);\n\t\t\t\t\tnode.res.node = node;\n\t\t\t\t\tnode.res.src = node.res._src;\n\t\t\t\t}\n\n\t\t\t\tnode.playTime = hrnow();\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.onended = Sound.onended_audio;\n\t\t\t\tnode.res.currentTime = node.startTime/1000.0;\n\t\t\t\tnode.res.volume = volume;\n\n\t\t\t\ttry {\n\t\t\t\t\tnode.res.play();\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_audio (node.res);\n\t\t\t\t\tnode.res = null;\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.res.volume = volume;\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\n\t\t\t\t\tSound.free_audio (node.res);\n\t\t\t\t\tnode.res = null;\n\t\n\t\t\t\t\tif (node.callback) node.callback();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tSound.unregister (node);\n\t\t\t\tnode.res.pause();\n\n\t\t\t\tSound.free_audio (node.res);\n\t\t\t\tnode.res = null;\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime += hrnow() - node.playTime;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = true;\n\n\t\t\t\tSound.unregister (node);\n\t\t\t\tnode.res.pause();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_audio: function (e)\n\t{\n\t\tvar node = e.currentTarget.node;\n\n\t\tif (node.playing && node.loop != 0)\n\t\t{\n\t\t\tif (node.loop != -1)\n\t\t\t\tnode.loop--;\n\n\t\t\tnode.startTime = 0;\n\t\t\tnode.playing = false;\n\t\t\tnode.pause = false;\n\n\t\t\tSound.updateNode_audio (node, 'play');\n\t\t\treturn;\n\t\t}\n\n\t\tnode.res.onended = null;\n\t\tnode.res.volume = 0;\n\n\t\tSound.updateNode_audio (node, 'stop');\n\t},\n\n\t/* *************************************** */\n\t/* PUBLIC */\n\n\tenableTrack: function (track)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.enabled = true;\n\t},\n\n\tdisableTrack: function (track)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.enabled = false;\n\t},\n\n\tsetVolume: function (track, value)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.volume = value;\n\t},\n\n\tcreateNode: function (snd, volume)\n\t{\n\t\tvar node = { };\n\n\t\tnode.startVolume = volume;\n\t\tnode.volume = volume;\n\t\tnode.snd = snd;\n\t\tnode.loop = 0;\n\t\tnode.playing = false;\n\t\tnode.paused = false;\n\t\tnode.startTime = 0;\n\t\tnode.playTime = 0;\n\t\tnode.callback = null;\n\t\tnode.timer = null;\n\t\tnode.res = null;\n\n\t\treturn node;\n\t},\n\n\tplay: function (snd, completeCallback, volume)\n\t{\n\t\tif (!this.MASTER.enabled || !snd || !snd.track.enabled)\n\t\t\treturn null;\n\n\t\tvar volume = (volume !== undefined && volume !== null) ? volume : 1.0;\n\n\t\tvar node = this.createNode(snd, volume);\n\t\tnode.callback = completeCallback;\n\n\t\treturn this.updateNode(node, 'play');\n\t},\n\n\tplayLoop: function (snd, completeCallback, volume)\n\t{\n\t\tif (!this.MASTER.enabled || !snd || !snd.track.enabled)\n\t\t\treturn null;\n\n\t\tvolume = (volume !== undefined && volume !== null) ? volume : 1.0;\n\t\n\t\tvar node = this.createNode(snd, volume);\n\t\tnode.callback = completeCallback;\n\t\tnode.loop = -1;\n\n\t\treturn this.updateNode(node, 'play');\n\t},\n\n\tstop: function (node, callback)\n\t{\n\t\tif (!node) return null;\n\n\t\tif (callback && callback !== true) node.callback = callback;\n\t\treturn this.updateNode(node, callback === true ? 'stop' : 'softstop');\n\t},\n\n\tpause: function (node)\n\t{\n\t\tif (!node) return null;\n\n\t\treturn this.updateNode(node, 'pause');\n\t},\n\n\tresume: function (node)\n\t{\n\t\tif (!node) return null;\n\n\t\treturn this.updateNode (node, 'play');\n\t},\n\n\tfadeOut: function (node, millis, callback)\n\t{\n\t\tif (!node) return;\n\n\t\tif (!node.playing || node.timer)\n\t\t{\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar startTime = hrnow();\n\t\tnode.startVolume = node.volume;\n\n\t\tnode.timer = setInterval (function()\n\t\t{\n\t\t\tvar t = ((hrnow() - startTime) / millis);\n\t\t\tif (t > 1) t = 1;\n\n\t\t\tnode.volume = node.startVolume*(1-t);\n\t\t\tSound.updateNode(node, 'setvolume');\n\n\t\t\tif (t == 1)\n\t\t\t{\n\t\t\t\tclearInterval (node.timer);\n\t\t\t\tnode.timer = null;\n\n\t\t\t\tif (callback === true)\n\t\t\t\t\tSound.updateNode(node, 'stop');\n\t\t\t\telse\n\t\t\t\t\tSound.updateNode(node, 'pause');\n\n\t\t\t\tif (callback && callback !== true)\n\t\t\t\t\tcallback();\n\t\t\t}\n\t\t},\n\t\t50);\n\t},\n\n\tfadeIn: function (node, millis, callback)\n\t{\n\t\tif (!node) return;\n\n\t\tif (node.playing || node.timer)\n\t\t{\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar startTime = hrnow();\n\n\t\tnode.volume = 0;\n\t\tthis.updateNode(node, 'play');\n\n\t\tnode.timer = setInterval (function()\n\t\t{\n\t\t\tvar t = ((hrnow() - startTime) / millis);\n\t\t\tif (t > 1) t = 1;\n\n\t\t\tnode.volume = node.startVolume*t;\n\t\t\tSound.updateNode(node, 'setvolume');\n\n\t\t\tif (t == 1)\n\t\t\t{\n\t\t\t\tclearInterval (node.timer);\n\t\t\t\tnode.timer = null;\n\n\t\t\t\tif (callback) callback();\n\t\t\t}\n\t\t},\n\t\t50);\n\t}\n});\n\n/**\n * \tCreates a descriptor for an audio resource.\n */\nResources.Audio = function (src, opts=null)\n{\n\treturn { type: \"audio\", wrapper: \"Sound\", src: src, ...opts };\n};\n\nexport default Sound;\n","/*\n**\tresources/sound-array.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Sound from './sound.js';\n\n//![import \"./sound.js\"]\n\n/*\n\ttrack: string (music|sfx)\n\tmode: sequential|random\n*/\n\nexport default Class.extend\n({\n\tr: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"audios\")\n\t\t\tthrow new Error (\"Resource is not audios.\");\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tif (!this.r.track)\n\t\t\tthis.r.track = \"sfx\";\n\n\t\tif (!this.r.mode)\n\t\t\tthis.r.mode = \"random\";\n\n\t\tthis.track = Sound[this.r.track.toUpperCase()];\n\n\t\tthis.sounds = [];\n\t\tthis.lastIndex = -1;\n\n\t\tfor (var i = 0; i < this.r.data.length; i++)\n\t\t{\n\t\t\tthis.sounds.push(new Sound (Object.assign (this.r.data[i], { track: this.r.track })));\n\t\t}\n\t},\n\n\tgetRandomSound: function ()\n\t{\n\t\tif (this.r.mode == \"random\")\n\t\t\treturn this.sounds[randr(0, this.sounds.length-1)];\n\n\t\tthis.lastIndex = ++this.lastIndex % this.sounds.length;\n\t\treturn this.sounds[this.lastIndex];\n\t},\n\n\tplay: function (callback, volume)\n\t{\n\t\treturn Sound.play (this.getRandomSound(), callback, volume);\n\t},\n\n\tplayLoop: function (callback, volume)\n\t{\n\t\treturn Sound.playLoop (this.getRandomSound(), callback, volume);\n\t},\n\n\tplayAt: function (index, callback, volume)\n\t{\n\t\treturn Sound.play (this.sounds[index % this.sounds.length], callback, volume);\n\t},\n\n\tplayLoopAt: function (index, callback, volume)\n\t{\n\t\treturn Sound.playLoop (this.sounds[index % this.sounds.length], callback, volume);\n\t}\n});\n","/*\n**\tresources/wrappers.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n//![[import './drawable']]\nimport _Drawable from './drawable.js'; export const Drawable = _Drawable;\n//![[import './placeholder']]\nimport _Placeholder from './placeholder.js'; export const Placeholder = _Placeholder;\n//![[import './spritesheet']]\nimport _Spritesheet from './spritesheet.js'; export const Spritesheet = _Spritesheet;\n//![[import './spritesheet-animation']]\nimport _SpritesheetAnimation from './spritesheet-animation.js'; export const SpritesheetAnimation = _SpritesheetAnimation;\n//![[import './spritefont']]\nimport _SpriteFont from './spritefont.js'; export const SpriteFont = _SpriteFont;\n//![[import './sound']]\nimport _Sound from './sound.js'; export const Sound = _Sound;\n//![[import './sound-array']]\nimport _SoundArray from './sound-array.js'; export const SoundArray = _SoundArray;\n","/*\n**\tutils/priority-queue.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\n\n//!class PriorityQueue\n\nexport default Class.extend\n({\n\tclassName: 'PriorityQueue',\n\n\tqueue: null,\n\tqueueKeys: null,\n\torder: null,\n\n\t/**\n\t * \tConstructs an priority queue.\n\t * \t!constructor();\n\t */\n\t__ctor: function()\n\t{\n\t\tthis.queue = { };\n\t\tthis.queueKeys = [];\n\t},\n\n\t/**\n\t * \tAdds an object to the priority queue.\n\t * \t!add (obj: { priority: number }) : object;\n\t */\n\tadd: function (object)\n\t{\n\t\tif (object == null)\n\t\t\treturn null;\n\n\t\tif (!('priority' in object))\n\t\t\tthrow new Error ('PriorityQueue (add): Object has no `priority` property.');\n\n\t\tif (!(object.priority in this.queue))\n\t\t{\n\t\t\tthis.queue[object.priority] = { is_dirty: false, list: [ ] };\n\t\t\tthis.queueKeys.push(object.priority);\n\n\t\t\tthis.order = Object.keys(this.queue).sort((a,b) => a-b);\n\t\t}\n\n\t\tif (this.queue[object.priority].list.indexOf(object) === -1)\n\t\t\tthis.queue[object.priority].list.push(object);\n\n\t\treturn object;\n\t},\n\n\t/**\n\t * \tMarks an object to be removed from the priority queue. Use `cleanup` to actually remove them.\n\t * \t!remove (obj: object) : object;\n\t */\n\tremove: function (object)\n\t{\n\t\tif (object == null)\n\t\t\treturn null;\n\n\t\tif (!('priority' in object))\n\t\t\tthrow new Error ('PriorityQueue (remove): Object has no `priority` property.');\n\n\t\tif (!(object.priority in this.queue))\n\t\t\treturn object;\n\n\t\tlet i = this.queue[object.priority].list.indexOf(object);\n\t\tif (i === -1) return object;\n\n\t\tthis.queue[object.priority].is_dirty = true;\n\t\tthis.queue[object.priority].list[i] = null;\n\n\t\treturn object;\n\t},\n\n\t/**\n\t * \tRuns a cleanup of the queue by removing any objects marked to be removed.\n\t * \t!cleanup() : void;\n\t */\n\tcleanup: function()\n\t{\n\t\tfor (let i = 0; i < this.queueKeys.length; i++)\n\t\t{\n\t\t\tlet q = this.queue[this.queueKeys[i]];\n\t\t\tif (!q.is_dirty) continue;\n\n\t\t\tfor (let j = 0; j < q.list.length; j++)\n\t\t\t{\n\t\t\t\tif (q.list[j] == null)\n\t\t\t\t{\n\t\t\t\t\tq.list.splice(j--, 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tq.is_dirty = false;\n\t\t}\n\t},\n\n\t/**\n\t * \tRuns the specified callback for each object in the queue. Executed in order of priority (from low number to high number).\n\t * \t@param callback - Return `false` to stop the forEach execution immediately.\n\t * \t!forEach (callback: (obj: object) => boolean) : void;\n\t */\n\tforEach: function (callback)\n\t{\n\t\tlet is_dirty = false;\n\t\tlet is_complete = false;\n\n\t\tfor (let i = 0; !is_complete && i < this.order.length; i++)\n\t\t{\n\t\t\tlet list = this.queue[this.order[i]].list;\n\n\t\t\tfor (let j = 0; !is_complete && j < list.length; j++)\n\t\t\t{\n\t\t\t\tif (list[j] != null)\n\t\t\t\t{\n\t\t\t\t\tif (callback(list[j]) === false)\n\t\t\t\t\t\tis_complete = true;\n\t\t\t\t}\n\n\t\t\t\tif (list[j] == null)\n\t\t\t\t\tis_dirty = true;\n\t\t\t}\n\t\t}\n\n\t\tif (is_dirty) this.cleanup();\n\t},\n\n\t/**\n\t * \tRuns the specified callback for each object in the queue. Executed in reverse order of priority (from high number to low number).\n\t * \t@param callback - Return `false` to stop the forEachRev execution immediately.\n\t * \t!forEachRev (callback: (obj: object) => boolean) : void;\n\t */\n\tforEachRev: function (callback)\n\t{\n\t\tlet is_dirty = false;\n\t\tlet is_complete = false;\n\n\t\tfor (let i = this.order.length-1; !is_complete && i >= 0; i--)\n\t\t{\n\t\t\tlet list = this.queue[this.order[i]].list;\n\n\t\t\tfor (let j = list.length-1; !is_complete && j >= 0; j--)\n\t\t\t{\n\t\t\t\tif (list[j] != null)\n\t\t\t\t{\n\t\t\t\t\tif (callback(list[j]) === false)\n\t\t\t\t\t\tis_complete = true;\n\t\t\t\t}\n\n\t\t\t\tif (list[j] == null)\n\t\t\t\t\tis_dirty = true;\n\t\t\t}\n\t\t}\n\n\t\tif (is_dirty) this.cleanup();\n\t},\n\n\t/**\n\t * \tRuns the specified callback for each object in the queue. Executed in order of priority (from low number to high number). When\n\t * \tthe cycle finishes the given `finishedCallback` will be executed.\n\t * \t@param callback - Return `false` to stop the forEachAsync execution immediately. Must manually execute `next` when finished.\n\t * \t!forEachAsync (callback: (obj: object, next: Function) => boolean) : void;\n\t */\n\tforEachAsync: function (callback, finishedCallback=null)\n\t{\n\t\tlet _ = this;\n\n\t\tlet is_dirty = false;\n\t\tlet is_complete = false;\n\n\t\tlet i = -1;\n\t\tlet j = -1;\n\n\t\tlet list = null;\n\n\t\tlet next_j = function()\n\t\t{\n\t\t\tj++;\n\n\t\t\tif (!is_complete && j < list.length)\n\t\t\t{\n\t\t\t\tif (list[j] != null)\n\t\t\t\t{\n\t\t\t\t\tif (callback(list[j], next_j) === false)\n\t\t\t\t\t\tis_complete = true;\n\t\t\t\t}\n\n\t\t\t\tif (list[j] == null)\n\t\t\t\t\tis_dirty = true;\n\n\t\t\t\tif (is_complete) next_j();\n\t\t\t}\n\t\t\telse\n\t\t\t\tnext_i();\n\t\t};\n\n\t\tlet next_i = function()\n\t\t{\n\t\t\ti++;\n\n\t\t\tif (!is_complete && i < _.order.length)\n\t\t\t{\n\t\t\t\tlist = _.queue[_.order[i]].list;\n\t\t\t\tj = -1;\n\t\t\t\tnext_j();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (is_dirty) _.cleanup();\n\t\t\t\tif (finishedCallback) finishedCallback();\n\t\t\t}\n\t\t};\n\n\t\tnext_i();\n\t},\n\n\t/**\n\t * \tRuns the specified callback for each object in the queue. Executed in reverse order of priority (from high number to low number). When\n\t * \tthe cycle finishes the given `finishedCallback` will be executed.\n\t * \t@param callback - Return `false` to stop the forEachRevAsync execution immediately. Must manually execute `next` when finished.\n\t * \t!forEachRevAsync (callback: (obj: object, next: Function) => boolean) : void;\n\t */\n\tforEachRevAsync: function (callback)\n\t{\n\t\talert('NOT IMPLEMENTED: forEachRevAsync');\n\t}\n});\n","/*\n**\tutils/callback.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Recycler from './recycler.js';\n\n//![import \"./recycler\"]\n\n//:/**\n//: * \tDefines a callback node. Contains a callback function, its context and up to four arguments.\n//: */\n\n//!class Callback\n\nconst Callback = Class.extend\n({\n\tclassName: 'Callback',\n\n\t/*\n\t**\tCallback and its context.\n\t*/\n\tcallback: null,\n\tcontext: null,\n\n\t/*\n\t**\tOptional arguments.\n\t*/\n\targ1: null,\n\targ2: null,\n\targ3: null,\n\targ4: null,\n\n\t/*\n\t**\tLink to the previous and next callback.\n\t*/\n\tprev: null,\n\tnext: null,\n\n\t/**\n\t * \tInitializes the callback with the specified arguments.\n\t * \t!constructor (callback: Function, context?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any);\n\t */\n\t__ctor: function (callback, context=null, arg1=null, arg2=null, arg3=null, arg4=null)\n\t{\n\t\tthis.callback = callback;\n\t\tthis.context = context;\n\n\t\tthis.arg1 = arg1;\n\t\tthis.arg2 = arg2;\n\t\tthis.arg3 = arg3;\n\t\tthis.arg4 = arg4;\n\n\t\tthis.prev = null;\n\t\tthis.next = null;\n\t},\n\n\t/*\n\t**\tDestructs the instance.\n\t*/\n\t__dtor: function()\n\t{\n\t\tthis.callback = null;\n\t\tthis.context = null;\n\n\t\tthis.arg1 = null;\n\t\tthis.arg2 = null;\n\t\tthis.arg3 = null;\n\t\tthis.arg4 = null;\n\n\t\tthis.prev = null;\n\t\tthis.next = null;\n\t},\n\n\t/*\n\t**\tReturns true if the specified arguments are the same as the callback. Compares from left to right. All null values are ignored.\n\t*/\n\tisEqual: function (callback=null, context=null, arg1=null, arg2=null, arg3=null, arg4=null)\n\t{\n\t\tif (callback !== null && Callback.isInstance(callback))\n\t\t{\n\t\t\treturn callback === this;\n\t\t}\n\n\t\tif (callback !== null && this.callback !== callback)\n\t\t\treturn false;\n\n\t\tif (context !== null && this.context !== context)\n\t\t\treturn false;\n\n\t\tif (arg1 !== null && this.arg1 !== arg1)\n\t\t\treturn false;\n\n\t\tif (arg2 !== null && this.arg2 !== arg2)\n\t\t\treturn false;\n\n\t\tif (arg3 !== null && this.arg3 !== arg3)\n\t\t\treturn false;\n\n\t\tif (arg4 !== null && this.arg4 !== arg4)\n\t\t\treturn false;\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tExecutes the callback. Returns `false` if the callback should be removed from the handler.\n\t * \t@param host - Host object.\n\t * \t!exec (host: Object) : boolean;\n\t */\n\texec: function(host)\n\t{\n\t\tif (this.callback !== null)\n\t\t\treturn this.callback (host, this.context, this.arg1, this.arg2, this.arg3, this.arg4);\n\n\t\treturn true;\n\t}\n});\n\n//!/class\n\n//!namespace Callback\n//!namespace Pool\n\n/**\n * \tAllocates a callback with the specified arguments.\n * \t!function alloc (callback: Function, context?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any) : Callback;\n */\n\nRecycler.createPool(Callback, 16384, 6144);\nexport default Callback;\n","/*\n**\tutils/handler.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Recycler from './recycler.js';\nimport Callback from './callback.js';\n\n//![import \"./recycler\"]\n//![import \"./callback\"]\n\n//:/**\n//: * \tThe handler class allows zero or more callbacks to be attached, such that when the `exec` method of the handler is invoked, all attached callbacks will also be executed.\n//: */\n\n//!class Handler\n\nconst Handler = Class.extend\n({\n\tclassName: 'Handler',\n\n\t/**\n\t * \tHandler host element.\n\t * \t!host: Object;\n\t */\n\thost: null,\n\n\t/**\n\t * \tTop and bottom of the linked list.\n\t */\n\ttop: null,\n\tbottom: null,\n\n\t/**\n\t * \tInitializes the Handler instance.\n\t * \t!constructor (host?: Object);\n\t */\n\t__ctor: function (host=null)\n\t{\n\t\tthis.host = host;\n\n\t\tthis.top = null;\n\t\tthis.bottom = null;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tRemoves all callbacks from the handler.\n\t*/\n\t__dtor: function()\n\t{\n\t\tthis.remove();\n\t},\n\n\t/**\n\t * \tAdds the specified callback to the handler.\n\t * \t!add (callback: Function, context?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any) : Callback;\n\t */\n\tadd: function(callback, context=null, arg1=null, arg2=null, arg3=null, arg4=null)\n\t{\n\t\tlet node = Callback.isInstance(callback) ? callback : Callback.Pool.alloc(callback, context, arg1, arg2, arg3, arg4);\n\n\t\tnode.prev = this.bottom;\n\n\t\tif (this.bottom !== null)\n\t\t\tthis.bottom.next = node;\n\n\t\tthis.bottom = node;\n\n\t\tif (this.top === null)\n\t\t\tthis.top = node;\n\n\t\treturn node;\n\t},\n\n\t/**\n\t * \tUnlinks a callback from the handler.\n\t * \t!unlink (node: Callback) : Handler;\n\t */\n\tunlink: function (node)\n\t{\n\t\tif (node.prev) node.prev.next = node.next;\n\t\tif (node.next) node.next.prev = node.prev;\n\n\t\tif (this.top === node)\n\t\t\tthis.top = node.next;\n\n\t\tif (this.bottom === node)\n\t\t\tthis.bottom = node.prev;\n\n\t\tnode.prev = null;\n\t\tnode.next = null;\n\n\t\tdispose(node);\n\t},\n\n\t/**\n\t * \tRemoves all callbacks matching the specified arguments.\n\t * \t!remove (callback?: Function, context?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any) : Handler;\n\t */\n\tremove: function(callback=null, context=null, arg1=null, arg2=null, arg3=null, arg4=null)\n\t{\n\t\tif (callback !== null && Callback.isInstance(callback))\n\t\t{\n\t\t\tthis.unlink(callback);\n\t\t\treturn this;\n\t\t}\n\n\t\tlet node = this.top;\n\n\t\twhile (node !== null)\n\t\t{\n\t\t\tlet next = node.next;\n\n\t\t\tif (node.isEqual(callback, context, arg1, arg2, arg3, arg4))\n\t\t\t\tthis.unlink(node);\n\n\t\t\tnode = next;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the first callback matching the specified arguments.\n\t * \t!find (callback: Function, context?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any) : Callback;\n\t */\n\tfind: function(callback, context=null, arg1=null, arg2=null, arg3=null, arg4=null)\n\t{\n\t\tlet node = this.top;\n\n\t\twhile (node !== null)\n\t\t{\n\t\t\tif (node.isEqual(callback, context, arg1, arg2, arg3, arg4))\n\t\t\t\treturn node;\n\n\t\t\tnode = node.next;\n\t\t}\n\n\t\treturn null;\n\t},\n\n\t/**\n\t * \tExecutes all callbacks in the handler.\n\t * \t!exec() : void;\n\t */\n\texec: function()\n\t{\n\t\tlet node = this.top;\n\n\t\twhile (node !== null)\n\t\t{\n\t\t\tlet next = node.next;\n\n\t\t\tif (node.exec(this.host) === false)\n\t\t\t\tthis.unlink(node);\n\n\t\t\tnode = next;\n\t\t}\n\t},\n\n\t/**\n\t * \tExecutes the first callback matching the specified arguments.\n\t * \t!execf (callback?: Function, context?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any) : void;\n\t */\n\texecf: function(callback=null, context=null, arg1=null, arg2=null, arg3=null, arg4=null)\n\t{\n\t\tlet node = this.top;\n\n\t\twhile (node !== null)\n\t\t{\n\t\t\tlet next = node.next;\n\n\t\t\tif (node.isEqual(callback, context, arg1, arg2, arg3, arg4))\n\t\t\t{\n\t\t\t\tif (node.exec(this.host) === false)\n\t\t\t\t\tthis.unlink(node);\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tnode = next;\n\t\t}\n\t},\n\n\t/**\n\t * \tExecutes the specified callback.\n\t * \t!execc (node: Callback) : void;\n\t */\n\texecc: function(node)\n\t{\n\t\tif (node.exec(this.host) === false)\n\t\t\tthis.unlink(node);\n\t}\n});\n\n//!/class\n\n//!namespace Handler\n//!namespace Pool\n\n/**\n * \tAllocates a new handler instance.\n * \t!function alloc (host?: Object) : Handler;\n */\n\nRecycler.createPool(Handler, 16384, 6144);\nexport default Handler;\n","/*\n**\tmath/rect.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"../utils/recycler\"]\n//![import \"./vec2\"]\n\n//:/**\n//: * \tRepresents a 2D rectangle.\n//: */\n\n//!class Rect\n\nconst Rect = Class.extend\n({\n\tclassName: 'Rect',\n\n\t/**\n\t * \tCoordinates of the rectangle (cx and cy are for the center). Note that this fields are readonly they should be\n\t * \tmodified through methods only.\n\t */\n\n\t/**\n\t * \t!readonly cx: number;\n\t */\n\tcx: 0,\n\t/**\n\t * \t!readonly cy: number;\n\t */\n\tcy: 0,\n\t/**\n\t * \t!readonly x1: number;\n\t */\n\tx1: 0,\n\t/**\n\t * \t!readonly y1: number;\n\t */\n\ty1: 0,\n\t/**\n\t * \t!readonly x2: number;\n\t */\n\tx2: 0,\n\t/**\n\t * \t!readonly y2: number;\n\t */\n\ty2: 0,\n\n\t/**\n\t * \tConstructs a rectangle of zero size, centered at (0, 0).\n\t * \t!constructor();\n\t */\n\t/**\n\t * \tConstructs a rectangle centered at (0, 0) with the specified size.\n\t * \t!constructor (width: number, height: number);\n\t */\n\t/**\n\t * \tConstructs a rectangle with the specified coordinates.\n\t * \t!constructor (x1: number, y1: number, x2: number, y2: number);\n\t */\n\t__ctor: function (x1=null, y1=null, x2=null, y2=null)\n\t{\n\t\tif (x1 === null)\n\t\t{\n\t\t\tthis.x1 = this.y1 = this.x2 = this.y2 = this.cx = this.cy = 0;\n\t\t\treturn this;\n\t\t}\n\n\t\tif (x2 === null)\n\t\t{\n\t\t\tthis.set (0, 0, 0, 0);\n\t\t\tthis.resize (x1, y1);\n\t\t\treturn this;\n\t\t}\n\n\t\treturn this.set(x1, y1, x2, y2);\n\t},\n\n\t/*\n\t**\tDestructor.\n\t*/\n\t__dtor: function ()\n\t{\n\t},\n\n\t/**\n\t * \tReturns a clone of the rectangle.\n\t * \t!clone() : Rect;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Rect.Rool.alloc(this.x1, this.y1, this.x2, this.y2);\n\t},\n\n\t/**\n\t * \tSets all coordinates of the rectangle to zero.\n\t * \t!zero() : Rect;\n\t */\n\tzero: function ()\n\t{\n\t\tthis.cx = 0; this.cy = 0;\n\t\tthis.x1 = 0; this.y1 = 0;\n\t\tthis.x2 = 0; this.y2 = 0;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets all coordinates of the rectangle to `null` for subsequent use with `extendWithPoint`.\n\t * \t!reset() : Rect;\n\t */\n\treset: function ()\n\t{\n\t\tthis.cx = null; this.cy = null;\n\t\tthis.x1 = null; this.y1 = null;\n\t\tthis.x2 = null; this.y2 = null;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tExtends the rectangle to contain the specified vector coordinates.\n\t * \t!extendWithPoint (v: Vec2) : Rect;\n\t */\n\t/**\n\t * \tExtends the rectangle to contain the specified point.\n\t * \t!extendWithPoint (x: number, y: number) : Rect;\n\t */\n\textendWithPoint: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tconst r = x;\n\t\t\tx = r.x;\n\t\t\ty = r.y;\n\t\t}\n\n\t\tif (this.x1 === null || x < this.x1) this.x1 = x;\n\t\tif (this.y1 === null || y < this.y1) this.y1 = y;\n\t\tif (this.x2 === null || x > this.x2) this.x2 = x;\n\t\tif (this.y2 === null || y > this.y2) this.y2 = y;\n\n\t\tthis.cx = (this.x1 + this.x2) / 2;\n\t\tthis.cy = (this.y1 + this.y2) / 2;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tTranslates the rectangle by the given deltas.\n\t * \t!translate (dx: number, dy: number) : Rect;\n\t */\n\ttranslate: function (dx, dy)\n\t{\n\t\tthis.x1 += dx; this.y1 += dy;\n\t\tthis.x2 += dx; this.y2 += dy;\n\t\tthis.cx += dx; this.cy += dy;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMoves the center of the rectangle to the specified position.\t \n\t * \t@param normalized - When `true` the arguments `x` and `y` are treated as normalized ranging from 0 to 1 (inclusive).\n\t * \t!centerAt (x: number, y: number, normalized?: false) : Rect;\n\t */\n\tcenterAt: function (x, y, normalized=false)\n\t{\n\t\tif (normalized == true)\n\t\t{\n\t\t\tx = this.x1 + x*(this.x2 - this.x1);\n\t\t\ty = this.y1 + y*(this.y2 - this.y1);\n\t\t}\n\n\t\treturn this.translate (x - this.cx, y - this.cy);\n\t},\n\n\t/**\n\t * \tCopies the coordinates of the specified rectangle.\n\t * \t!set (r: Rect) : Rect;\n\t */\n\t/**\n\t * \tSets the coordinates of the rectangle.\n\t * \t!set (x1: number, y1: number, x2: number, y2: number) : Rect;\n\t */\n\tset: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\tthis.cx = (x1 + x2) / 2;\n\t\tthis.cy = (y1 + y2) / 2;\n\n\t\tthis.x1 = x1;\n\t\tthis.y1 = y1;\n\t\tthis.x2 = x2;\n\t\tthis.y2 = y2;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns `true` if the given rectangle coordinates are equal.\n\t * \t!equals (r: Rect) : boolean;\n\t */\n\t/**\n\t * \tReturns `true` if the coordinates are equal.\n\t * \t!equals (x1: number, y1: number, x2: number, y2: number) : boolean;\n\t */\n\tequals: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\treturn x1 == this.x1 && x2 == this.x2 && y1 == this.y1 && y2 == this.y2;\n\t},\n\n\t/**\n\t * \tReturns `true` if the specified rectangle is contained in the current one.\n\t * \t!contains (r: Rect) : boolean;\n\t */\n\t/**\n\t * \tReturns `true` if the specified rectangle is contained in the current one.\n\t * \t!contains (x1: number, y1: number, x2: number, y2: number) : boolean;\n\t */\n\tcontains: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\treturn (x1 == Math.max(this.x1, x1)) && (y1 == Math.max(this.y1, y1)) && (x2 == Math.min(this.x2, x2)) && (y2 == Math.min(this.y2, y2));\n\t},\n\n\t/**\n\t * \tSets the coordinates of the rectangle to the union of it and the given one.\n\t * \t!setAsUnion (r: Rect) : Rect;\n\t */\n\t/**\n\t * \tSets the coordinates of the rectangle to the union of it and the given one.\n\t * \t!setAsUnion (x1: number, y1: number, x2: number, y2: number) : Rect;\n\t */\n\tsetAsUnion: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\tthis.x1 = Math.min(this.x1, x1);\n\t\tthis.y1 = Math.min(this.y1, y1);\n\t\tthis.x2 = Math.max(this.x2, x2);\n\t\tthis.y2 = Math.max(this.y2, y2);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns `true` if the rectangles intersect.\n\t * \t!intersects (r: Rect) : boolean;\n\t */\n\t/**\n\t * \tReturns `true` if the rectangles intersect.\n\t * \t!intersects (x1: number, y1: number, x2: number, y2: number) : boolean;\n\t */\n\tintersects: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\tlet _x1 = Math.max(this.x1, x1);\n\t\tlet _y1 = Math.max(this.y1, y1);\n\t\tlet _x2 = Math.min(this.x2, x2);\n\t\tlet _y2 = Math.min(this.y2, y2);\n\n\t\treturn Math.max(0, _y2-_y1) * Math.max(0, _x2-_x1) > 0;\n\t},\n\n\t/**\n\t * \tSets the coordinates of the rectangle to the intersection of it and the given one.\n\t * \t@returns Boolean indicating if the intersection is non-empty.\n\t * \t!setAsIntersection (r: Rect) : boolean;\n\t */\n\t/**\n\t * \tSets the coordinates of the rectangle to the intersection of it and the given one.\n\t * \t@returns Boolean indicating if the intersection is non-empty.\n\t * \t!setAsIntersection (x1: number, y1: number, x2: number, y2: number) : boolean;\n\t */\n\tsetAsIntersection: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\tthis.x1 = Math.max(this.x1, x1);\n\t\tthis.y1 = Math.max(this.y1, y1);\n\t\tthis.x2 = Math.min(this.x2, x2);\n\t\tthis.y2 = Math.min(this.y2, y2);\n\n\t\treturn Math.max(0, this.y2-this.y1) * Math.max(0, this.x2-this.x1) > 0;\n\t},\n\n\t/**\n\t * \tResizes the rectangle to the given size using its center or top-left corner as reference.\n\t * \t@param normalized - When `true` the `w` and `h` will be treated as normalized ranging from 0 to 1 (inclusive).\n\t * \t@param topLeftRelative - When `true` reference will be top-left corner, set to `false` to use the center.\n\t * \t!resize (w: number, h: number, normalized?: boolean, topLeftRelative?: boolean) : Rect;\n\t */\n\tresize: function (w, h, normalized=false, topLeftRelative=false)\n\t{\n\t\tif (normalized == true)\n\t\t{\n\t\t\tw *= (this.x2 - this.x1);\n\t\t\th *= (this.y2 - this.y1);\n\t\t}\n\n\t\tif (topLeftRelative == true)\n\t\t{\n\t\t\tthis.x2 = this.x1 + w;\n\t\t\tthis.y2 = this.y1 + h;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tw /= 2; h /= 2;\n\n\t\t\tthis.x1 = this.cx - w; this.y1 = this.cy - h;\n\t\t\tthis.x2 = this.cx + w; this.y2 = this.cy + h;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResizes the rectangle using the specified deltas, relative to its center or top-left corner.\n\t * \t@param topLeftRelative - When `true` reference will be top-left corner, set to `false` to use the center.\n\t * \t!resizeBy (dw: number, dh: number, topLeftRelative?: boolean) : Rect;\n\t */\n\tresizeBy: function (dw, dh, topLeftRelative=false)\n\t{\n\t\tif (topLeftRelative == true)\n\t\t{\n\t\t\tthis.x2 += dw;\n\t\t\tthis.y2 += dh;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdw /= 2; dh /= 2;\n\n\t\t\tthis.x1 -= dw; this.y1 -= dh;\n\t\t\tthis.x2 += dw; this.y2 += dh;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the width of the rectangle.\n\t * \t!width() : number;\n\t */\n\twidth: function ()\n\t{\n\t\treturn this.x2 - this.x1;\n\t},\n\n\t/**\n\t * \tReturns the height of the rectangle.\t \n\t * \t!height() : number;\n\t */\n\theight: function ()\n\t{\n\t\treturn this.y2 - this.y1;\n\t},\n\n\t/**\n\t * \tReturns the normalized center X-coordinate of the rectangle.\n\t * \t!ncx() : number;\n\t */\n\tncx: function ()\n\t{\n\t\treturn (this.cx - this.x1) / (this.x2 - this.x1);\n\t},\n\n\t/**\n\t * \tReturns the normalized center Y-coordinate of the rectangle.\n\t * \t!ncy() : number;\n\t */\n\tncy: function ()\n\t{\n\t\treturn (this.cy - this.y1) / (this.y2 - this.y1);\n\t},\n\n\t/**\n\t * \tReturns `true` if the rectangle is a right rectangle, that is: x1 < x2 and y1 < y2.\n\t * \t!isRight() : boolean;\n\t */\n\tisRight: function ()\n\t{\n\t\treturn this.x1 <= this.x2 && this.y1 <= this.y2;\n\t},\n\n\t/**\n\t * \tReturns `true` if the specified point is contained in the rectangle.\n\t * \t@param tol - Used to specify a tolerance value (default is zero).\n\t * \t!containsPoint (x: number, y: number, tol?: number) : boolean;\n\t */\n\tcontainsPoint: function (x, y, tol=0)\n\t{\n\t\treturn (this.x1-tol <= x && x <= this.x2+tol) && (this.y1-tol <= y && y <= this.y2+tol);\n\t},\n\n\t/**\n\t * \tReturns the area of the rectangle.\n\t * \t@param strict - Indicates if the area is returned only if the rectangle is a right rectangle. \t \n\t * \t!area (strict?: boolean) : number;\n\t */\n\tarea: function (strict)\n\t{\n\t\treturn strict ? (this.isRight() ? (this.y2-this.y1)*(this.x2-this.x1) : 0) : ((this.y2-this.y1)*(this.x2-this.x1));\n\t},\n\n\t/**\n\t * \tSets the components of the rectangle to their rounded-down integer parts.\n\t * \t!floor() : Rect;\n\t */\n\tfloor: function()\n\t{\n\t\tthis.x1 = Math.floor(this.x1);\n\t\tthis.y1 = Math.floor(this.y1);\n\t\tthis.x2 = Math.floor(this.x2);\n\t\tthis.y2 = Math.floor(this.y2);\n\t\tthis.cx = Math.floor(this.cx);\n\t\tthis.cy = Math.floor(this.cy);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the components of the rectangle to their rounded-up integer parts.\n\t * \t!ceil() : Rect;\n\t */\n\tceil: function()\n\t{\n\t\tthis.x1 = Math.ceil(this.x1);\n\t\tthis.y1 = Math.ceil(this.y1);\n\t\tthis.x2 = Math.ceil(this.x2);\n\t\tthis.y2 = Math.ceil(this.y2);\n\t\tthis.cx = Math.ceil(this.cx);\n\t\tthis.cy = Math.ceil(this.cy);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the string representation of the rectangle.\n\t * \t!toString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn \"(\" + this.x1.toFixed(2) + \", \" + this.y1.toFixed(2) + \", \" + this.x2.toFixed(2) + \", \" + this.y2.toFixed(2) + \")\";\n\t},\n\n\t/**\n\t * \tFlattens the rectangle.\n\t * \t!flatten() : Array<number>;\n\t */\n\tflatten: function ()\n\t{\n\t\treturn [this.x1, this.y1, this.x2, this.y2];\n\t},\n\n\t/**\n\t * \tUnflattens the rectangle.\n\t * \t!unflatten(input: Array<number>) : Rect;\n\t */\n\tunflatten: function (o)\n\t{\n\t\tthis.set (o[0], o[1], o[2], o[3]);\n\t\treturn this;\n\t}\n});\n\n//!/class\n\n//!namespace Rect\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a new rectangle of zero size.\n\t * \t!function alloc() : Rect;\n\t */\n\t/**\n\t * \tAllocates a new rectangle centered at (0, 0) with the specified size.\n\t * \t!function alloc (width: number, height: number) : Rect;\n\t */\n\t/**\n\t * \tAllocates a new rectangle with the specified coordinates.\n\t * \t!function alloc (x1: number, y1: number, x2: number, y2: number) : Rect;\n\t */\n\nRecycler.createPool (Rect, 4096, 2048);\nexport default Rect;\n","/*\n**\tmath/tfunction.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\n\n//:/**\n//: * \tDescribes a function dependent of time (t-function), multiple sampling points (t,y) can be added, this class\n//: * \tprovides methods to access any value for a given time, or the integral of a time range.\n//: */\n\n//!class TFunction\n\nconst TFunction = Class.extend\n({\n\tclassName: 'TFunction',\n\n\t/**\n\t * \tContains the time values `t` in the t-function, for each time value there is a corresponding `y` and `f`.\n\t * \t!t: Array<number>;\n\t */\n\tt: null,\n\n\t/**\n\t * \tContains the values (y) for each of the time values (t) in the t-function.\n\t * \t!y: Array<number>;\n\t */\n\ty: null,\n\n\t/**\n\t * \tContains the easing function (f) for each of the time values (t).\n\t * \t!f: Array< (t:number) => number >;\n\t */\n\tf: null,\n\n\t/**\n\t * \tConstructs the time function.\n\t * \t@param value - Initial value of the t-function for t=0, defaults to 0.\n\t * \t!constructor (value?: number);\n\t */\n\t__ctor: function (value=0)\n\t{\n\t\tthis.reset(value);\n\t},\n\n\t/**\n\t * \tResets the t-function to its initial state.\n\t * \t@param value - Initial value of the t-function for t=0. Default is 0.\n\t * \t!reset (value?: number) : TFunction;\n\t */\n\treset: function (value=0)\n\t{\n\t\tthis.t = [0];\n\t\tthis.y = [value];\n\t\tthis.f = [null];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResets the t-function and copies data from the specified source.\n\t * \t@param src - Source TFunction.\n\t * \t@param t0 - Initial time, if none specified will be assumed to be the min time of the source.\n\t * \t@param t1 - Final time, if none specified will be assumed to the the max time of the source.\n\t * \t@returns A TFunction or `null` if the specified time range could not be resolved.\n\t * \t!copyFrom (src: TFunction, t0: number, t1: number) : TFunction;\n\t */\n\tcopyFrom: function (src, t0, t1)\n\t{\n\t\tthis.t = [];\n\t\tthis.y = [];\n\t\tthis.f = [];\n\n\t\tif (t0 == null && t1 == null)\n\t\t{\n\t\t\tfor (let i = 0; i < src.t.length; i++)\n\t\t\t{\n\t\t\t\tthis.t.push(src.t[i]);\n\t\t\t\tthis.y.push(src.y[i]);\n\t\t\t\tthis.f.push(src.f[i]);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\tif (t0 == null) t0 = src.t[0];\n\t\tif (t1 == null) t1 = src.t[src.t.length-1];\n\n\t\tif (t0 < src.t[0]) t0 = src.t[0];\n\n\t\tlet i0 = src.find(t0);\n\t\tlet i1 = src.find(t1);\n\n\t\tif (i0 == null) return null;\n\t\tif (i1 == null) return null;\n\n\t\tif (src.t[i0] != t0) {\n\t\t\tthis.set(t0, src.getAt(t0), src.f[i0]);\n\t\t\ti0++;\n\t\t}\n\n\t\tfor (let i = i0; i <= i1; i++)\n\t\t\tthis.set(src.t[i], src.y[i], src.f[i]);\n\n\t\tif (src.t[i1] != t1)\n\t\t{\n\t\t\tlet dt = (t1 - src.t[i1]) / Math.ceil(Math.log(t1 - src.t[i1]));\n\t\t\tlet t = this.t[this.t.length-1];\n\n\t\t\tif (dt <= 0) dt = 1;\ndt = t1-t; // Force just one step.\n\t\t\twhile (t != t1)\n\t\t\t{\n\t\t\t\tif (t+dt > t1)\n\t\t\t\t\tdt = t1 - t;\n\n\t\t\t\tt += dt;\n\t\t\t\tthis.set(float4(t), src.getAt(t), src.f[i1]);\n\t\t\t}\n\t\t}\n\t\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCreates a new t-function with the same values as the current one.\n\t * \t@param t0 - Initial time, if none specified will be assumed to be the min time of the source.\n\t * \t@param t1 - Final time, if none specified will be assumed to the the max time of the source.\n\t * \t!clone (t0: number, t1: number) : TFunction;\n\t */\n\tclone: function (t0, t1)\n\t{\n\t\treturn (new TFunction()).copyFrom(this, t0, t1);\n\t},\n\n\t/**\n\t * \tReturns the maximum time value in the t-function plus the given delta.\n\t * \t@param delta - Delta value to add to the result.\n\t * \t!endTime (delta?: number) : number;\n\t */\n\tendTime: function (delta=0)\n\t{\n\t\treturn this.t[this.t.length-1] + delta;\n\t},\n\n\t/**\n\t * \tReturns the start time of the t-function plus the given delta.\n\t * \t@param delta - Delta value to add to the result.\n\t * \t!startTime (delta?: number) : number;\n\t */\n\tstartTime: function (delta=0)\n\t{\n\t\treturn this.t[0] + delta;\n\t},\n\n\t/**\n\t * \tFinds the index of a sampling point whose sampling range contains the given time.\n\t * \t@param time - Time value to search.\n\t * \t@returns Index of the sampling point or `null` if not within range.\n\t * \t!find (time: number) : number|null;\n\t */\n\tfind: function (time)\n\t{\n\t\tif (time < this.t[0])\n\t\t\treturn null;\n\n\t\tconst n = this.t.length;\n\n\t\tfor (let i = 1; i < n; i++)\n\t\t{\n\t\t\tif (time < this.t[i])\n\t\t\t\treturn i-1;\n\t\t}\n\n\t\treturn n-1;\n\t},\n\n\t/**\n\t * \tSets a sampling point (t,y).\n\t * \t@param t - Time value of the sampling point.\n\t * \t@param y - Y-value for the given t.\n\t * \t@param f - Easing function.\n\t * \t!set (t: number, y: number, f?: (t: number) => number) : TFunction;\n\t */\n\tset: function (t, y, f=null)\n\t{\n\t\tlet i = this.find(t);\n\t\tif (i == null) return false;\n\n\t\tif (this.t[i] == t)\n\t\t{\n\t\t\tthis.y[i] = y;\n\t\t\tif (f != null) this.f[i] = f;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ti++;\n\t\t\tthis.t.splice(i, 0, t);\n\t\t\tthis.y.splice(i, 0, y);\n\t\t\tthis.f.splice(i, 0, f);\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tReturns the last Y-value in the t-function.\n\t *\t!get() : number;\n\t */\n\tget: function ()\n\t{\n\t\treturn this.y[this.y.length-1];\n\t},\n\n\t/**\n\t * \tReturns the Y-value in the t-function corresponding to some point in time (t).\n\t * \t@param t - Time (t) value.\n\t * \t!getAt (t: number) : number;\n\t */\n\tgetAt: function (t)\n\t{\n\t\tlet i0 = this.find(t);\n\t\tif (i0 == null) return 0;\n\n\t\tlet i1 = i0 + 1;\n\n\t\tif (this.t[i0] == t || i1 >= this.t.length || this.y[i0] == this.y[i1] || this.f[i0] == null)\n\t\t\treturn this.y[i0];\n\n\t\tif (this.f[i0] == null)\n\t\t\treturn this.y[i0];\n\n\t\tlet x = t;\n\t\tlet x0 = this.t[i0];\n\t\tlet x1 = this.t[i1];\n\t\tlet y0 = this.y[i0];\n\t\tlet y1 = this.y[i1];\n\n\t\tt = (x - x0) / (x1 - x0);\n\t\tt = this.f[i0](t);\n\n\t\treturn t*y1 + (1-t)*y0;\n\t},\n\n\t/**\n\t * \tReturns the approximate definite integral of the t-function for the given time range.\n\t * \t@param t0 - Initial time value, defaults to minimum time of the t-function.\n\t * \t@param t1 - Final time value, defaults to the maximum time of the t-function.\n\t * \t@param c0 - Constant of integration, defaults to 0.\n\t * \t@returns Definite integral of t-function from t0 to t1.\n\t * \t!integral (t0?: number, t1?: number, c0?: number) : number;\n\t */\n\tintegral: function (t0=null, t1=null, c0=0)\n\t{\n\t\tif (t0 == null) t0 = this.t[0];\n\t\tif (t1 == null) t1 = this.t[this.t.length-1];\n\n\t\tif (t0 < this.t[0]) t0 = this.t[0];\n\n\t\tlet sign = 1;\n\n\t\tif (t0 > t1) {\n\t\t\tlet tmp; tmp = t0; t0 = t1; t1 = tmp;\n\t\t\tsign = -1;\n\t\t}\n\n\t\tlet accum = c0;\n\n\t\tfor (let time = t0; time < t1; )\n\t\t{\n\t\t\tlet i0 = this.find(time);\n\t\t\tif (i0 == null) return 0;\n\n\t\t\tlet i1 = i0 + 1;\n\n\t\t\tlet x0 = Math.max(this.t[i0], time);\n\t\t\tlet x1 = Math.min(i1 < this.t.length ? this.t[i1] : t1, t1);\n\n\t\t\tlet y0 = this.getAt(x0);\n\t\t\tlet y1 = this.getAt(x1);\n\n\t\t\tlet dx = x1 - x0;\n\t\t\tlet dy = y1 - y0;\n\n\t\t\tif (this.f[i0] == null)\n\t\t\t\taccum += y0*dx;\n\t\t\telse\n\t\t\t\taccum += 0.5*dy*(x1+x0) - x0*dy + y0*dx;\n\n\t\t\ttime += dx;\n\t\t}\n\n\t\treturn sign*accum;\n\t},\n\n\t/**\n\t * \tReturns the approximate definite second integral of the t-function for the given time range.\n\t * \t@param t0 - Initial time value, defaults to minimum time of the t-function.\n\t * \t@param t1 - Final time value, defaults to the maximum time of the t-function.\n\t * \t@param c0 - Constant of integration, defaults to 0.\n\t * \t@returns Definite second integral of t-function from t0 to t1.\n\t * \t!integral (t0?: number, t1?: number, c0?: number) : number;\n\t */\n\tsecond_integral: function (t0=null, t1=null, c0=0)\n\t{\n\t\tif (t0 == null) t0 = this.t[0];\n\t\tif (t1 == null) t1 = this.t[this.t.length-1];\n\n\t\tlet a0 = TFunction.Temp1.copyFrom(this, this.t[0], t0).integrate(c0).integral();\n\t\tlet a1 = TFunction.Temp2.copyFrom(this, this.t[0], t1).integrate(c0).integral();\n\n\t\treturn a1 - a0;\n\t},\n\n\t/**\n\t * \tTransforms the t-function to its integral. For every sampling range in the t-function their Y-value will be set to the integral\n\t * \tof the sampling range plus any previous integrals.\n\t *\n\t * \t@param c0 - Constant of integration. Defaults to 0.\n\t * \t!integrate (c0?: number) : TFunction;\n\t */\n\tintegrate: function (c0=0)\n\t{\n\t\tlet y = [];\n\n\t\ty.push(c0);\n\n\t\tfor (let i = 1; i < this.t.length; i++)\n\t\t\ty.push(y[i-1] + this.integral(this.t[i-1], this.t[i]));\n\n\t\tthis.y = y;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tTransforms the t-function Y-values to the accumulated sum of each Y-value plus the given c0.\n\t * \t@param c0 - Initial value (defaults to 0).\n\t * \t!accumulate(c0?: number) : TFunction;\n\t */\n\taccumulate: function (c0=0)\n\t{\n\t\tthis.y[0] += c0;\n\n\t\tfor (let i = 1; i < this.t.length; i++)\n\t\t\tthis.y[i] += this.y[i-1];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tRemoves all sampling-points located before the given index.\n\t *\t!chopLeft (i: number) : TFunction;\n\t */\n\tchopLeft: function (i)\n\t{\n\t\tthis.t.splice(0, i);\n\t\tthis.f.splice(0, i);\n\t\tthis.y.splice(0, i);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tRemoves all sampling-points located after the given index.\n\t * \t!chopRight (i: number) : TFunction;\n\t */\n\tchopRight: function (i)\n\t{\n\t\tthis.t.splice(i+1, this.t.length-i-1);\n\t\tthis.f.splice(i+1, this.f.length-i-1);\n\t\tthis.y.splice(i+1, this.y.length-i-1);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMaps the Y-value to other Y-values using the specified mapping function.\n\t * \t@param fn - Receives parameters `y` (y-value), `t` (t-value), and `i` (index).\n\t * \t!map (fn: (y: number, t: number, i: number) => number) : TFunction;\n\t */\n\tmap: function (fn)\n\t{\n\t\tfor (let i = 0; i < this.y.length; i++)\n\t\t\tthis.y[i] = fn (this.y[i], this.t[i], i);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns a string representation of the variable state.\n\t * \t!toString (c0?: number) : string;\n\t */\n\ttoString: function(c0=0)\n\t{\n\t\tlet s = '';\n\t\tlet n = 10;\n\n\t\tconst pad = function (value, n, char)\n\t\t{\n\t\t\tvalue = value.toString();\n\n\t\t\tif (char == null) char = ' ';\n\t\t\tchar = char[0];\n\n\t\t\twhile (value.length < n)\n\t\t\t\tvalue += char;\n\n\t\t\treturn value;\n\t\t};\n\n\t\ts += '\\n';\n\t\ts += pad(' Time', n) + ' ' + pad(' Value', n) + ' ' + pad(' Integral', n) + '\\n';\n\t\ts += pad('', n, '-') + ' ' + pad('', n, '-') + ' ' + pad('', n, '-') + '\\n';\n\n\t\tfor (let i = 0; i < this.t.length; i++)\n\t\t{\n\t\t\ts += pad(' '+float4(this.t[i]), n) + ' ' + pad(' '+float4(this.y[i]), n) + ' ' + pad(' '+float4(this.integral(this.t[0], this.t[i], c0)), n) + '\\n';\n\t\t}\n\n\t\treturn s;\n\t}\n});\n\nTFunction.Temp1 = new TFunction();\nTFunction.Temp2 = new TFunction();\n\nexport default TFunction;\n","/*\n**\tmath/point2.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"../utils/recycler\"]\n//![import \"./vec2\"]\n\n//:/**\n//: * \tRepresentation of a point in 2D space. The coordinate values are upscaled by a fixed number of bits to allow\n//: * \tsub-pixel translations (internally), but the public values will always be integers.\n//: */\n\n//!class Point2\n\nconst Point2 = Class.extend\n({\n\tclassName: 'Point2',\n\n\t/**\n\t * \tUpscaled coordinates of the point.\n\t * \t!readonly ux: number;\n\t * \t!readonly uy: number;\n\t */\n\tux: 0, uy: 0,\n\n\t/**\n\t * \tCoordinates of the point.\n\t * \t!readonly x: number;\n\t * \t!readonly y: number;\n\t */\n\tx: 0, y: 0,\n\n\t/**\n\t *\tConstructs the Point2 instance from another Point2.\n\t * \t!constructor (value: Point2);\n\t */\n\t/**\n\t *\tConstructs the Point2 instance from a Vec2.\n\t * \t!constructor (value: Vec2);\n\t */\n\t/**\n\t *\tConstructs the Point2 instance with the specified coordinates.\n\t * \t!constructor (x?: number, y?: number);\n\t */\n\t__ctor: function (x=null, y=null)\n\t{\n\t\treturn this.set(x, y);\n\t},\n\n\t/**\n\t *\tPopulates the downscaled coordinates.\n\t */\n\tdownscale: function ()\n\t{\n\t\tthis.x = downscale(this.ux);\n\t\tthis.y = downscale(this.uy);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tClones the point coordinates into a new Point2 object.\n\t * \t!clone() : Point2;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Point2.Pool.alloc(this);\n\t},\n\n\t/**\n\t *\tSets the coordinates of the point from another Point2.\n\t *\t!set (value: Point2) : Point2;\n\t */\n\t/**\n\t *\tSets the coordinates of the point from a Vec2 object.\n\t *\t!set (value: Vec2) : Point2;\n\t */\n\t/**\n\t *\tSets the coordinates of the point.\n\t *\t@param upscaled - When `true` the specified values are assumed to have already been upscaled.\n\t *\n\t *\t!set (x: number, y: number, upscaled?: boolean) : Point2;\n\t */\n\tset: function (x, y=null, upscaled=false)\n\t{\n\t\tif (x === null) {\n\t\t\tx = 0;\n\t\t\ty = 0;\n\t\t}\n\t\telse if (y === null)\n\t\t{\n\t\t\tif (Point2.isInstance(x)) {\n\t\t\t\ty = x.uy;\n\t\t\t\tx = x.ux;\n\t\t\t} else { // Point2\n\t\t\t\ty = upscale(x.y);\n\t\t\t\tx = upscale(x.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (!upscaled) {\n\t\t\t\tx = upscale(x);\n\t\t\t\ty = upscale(y);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux = x;\n\t\tthis.uy = y;\n\n\t\treturn this.downscale(this);\n\t},\n\n\t/**\n\t * \tSets the X-coordinate of the point.\n\t * \t!setX (x: number) : Point2;\n\t */\n\tsetX: function (x)\n\t{\n\t\tthis.ux = upscale(x);\n\t\treturn this.downscale(this);\n\t},\n\n\t/**\n\t * \tSets the Y-coordinate of the point.\n\t * \t!setY (y: number) : Point2;\n\t */\n\tsetY: function (y)\n\t{\n\t\tthis.uy = upscale(y);\n\t\treturn this.downscale(this);\n\t},\n\n\t/**\n\t * \tSets the coordinates of the point to zero.\n\t * \t!zero() : Point2;\n\t */\n\tzero: function()\n\t{\n\t\treturn this.set(0, 0);\n\t},\n\n\t/**\n\t * \tReturns true if the point coordinates are both zero.\n\t * \t!isZero() : boolean;\n\t */\n\tisZero: function()\n\t{\n\t\treturn this.x == 0 && this.y == 0;\n\t},\n\n\t/**\n\t *\tReturns true if the coordinates of the point have the same values as the given Point2.\n\t *\t!equals (value: Point2) : boolean;\n\t */\n\t/**\n\t *\tReturns true if the coordinates of the point have the same values as the given Vec2.\n\t *\t!equals (value: Vec2) : boolean;\n\t */\n\t/**\n\t *\tReturns true if the coordinates of the point have the same values as the given ones.\n\t *\t!equals (x: number, y: number) : boolean;\n\t */\n\tequals: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tif (Point2.isInstance(x)) {\n\t\t\t\ty = x.y;\n\t\t\t\tx = x.x;\n\t\t\t} else { // Point2\n\t\t\t\ty = int(x.y);\n\t\t\t\tx = int(x.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tx = int(x);\n\t\t\ty = int(y);\n\t\t}\n\n\t\treturn this.x == x && this.y == y;\n\t},\n\n\t/**\n\t *\tAdds the coordinates of the given Point2 to the point.\n\t *\t!add (value: Point2) : Point2;\n\t */\n\t/**\n\t *\tAdds the coordinates of the given Vec2 to the point.\n\t *\t!add (value: Vec2) : Point2;\n\t */\n\t/**\n\t *\tAdds the given delta values to the point.\n\t *\t@param upscaled - When `true` the specified values are assumed to have already been upscaled.\n\t *\t!add (dx: number, dy: number, upscaled?: boolean) : Point2;\n\t */\n\tadd: function (dx, dy=null, upscaled=false)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tif (Point2.isInstance(dx)) {\n\t\t\t\tdy = dx.uy;\n\t\t\t\tdx = dx.ux;\n\t\t\t} else { // Point2\n\t\t\t\tdy = upscale(dx.y);\n\t\t\t\tdx = upscale(dx.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (!upscaled) {\n\t\t\t\tdx = upscale(dx);\n\t\t\t\tdy = upscale(dy);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux += dx, this.uy += dy;\n\t\treturn this.downscale();\n\t},\n\n\t/**\n\t *\tSubtracts the coordinates of the given Point2 from the point.\n\t *\t!sub (value: Point2) : Point2;\n\t */\n\t/**\n\t *\tSubtracts the coordinates of the given Vec2 from the point.\n\t *\t!sub (value: Vec2) : Point2;\n\t */\n\t/**\n\t *\tSubtracts the given delta values from the point.\n\t *\t@param upscaled - When `true` the specified values are assumed to have already been upscaled.\n\t *\t!sub (dx: number, dy: number, upscaled?: boolean) : Point2;\n\t */\n\tsub: function (dx, dy, upscaled=false)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tif (Point2.isInstance(dx)) {\n\t\t\t\tdy = dx.uy;\n\t\t\t\tdx = dx.ux;\n\t\t\t} else { // Point2\n\t\t\t\tdy = upscale(dx.y);\n\t\t\t\tdx = upscale(dx.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (!upscaled) {\n\t\t\t\tdx = upscale(dx);\n\t\t\t\tdy = upscale(dy);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux -= dx, this.uy -= dy;\n\t\treturn this.downscale();\n\t},\n\n\t/**\n\t * \tReturns the string representation of the coordinates of the point.\n\t * \ttoString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn `(${this.x}, ${this.y})`;\n\t}\n});\n\n//!/class\n\n//!namespace Point2\n//!namespace Pool\n\n/**\n *\tAllocates a Point2 instance from another Point2.\n * \t!function alloc (value: Point2) : Point2;\n */\n/**\n *\tAllocates a Point2 instance from a Vec2.\n * \t!function alloc (value: Vec2) : Point2;\n */\n/**\n *\tAllocates a Point2 instance with the specified coordinates.\n * \t!function alloc (x?: number, y?: number) : Point2;\n */\n\nRecycler.createPool (Point2, 2048, 1024);\nexport default Point2;\n","/*\n**\tmath/bounds2.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Recycler from '../utils/recycler.js';\nimport Point2 from './point2.js';\nimport Rect from './rect.js';\n\n//![import \"../utils/recycler\"]\n//![import \"./point2\"]\n//![import \"./rect\"]\n\n//:/**\n//: * \tRepresentation of a bounding box in 2D space. The component values are upscaled by a fixed number of bits to allow sub-pixel\n//: * \ttranslations (internally), but the public values will always be integers.\n//: */\n\n//!class Bounds2\n\nconst Bounds2 = Class.extend\n({\n\tclassName: 'Bounds2',\n\n\t/**\n\t * \tCoordinates of the bounds (cx and cy are for the center). Note that this fields are read only and should be\n\t * \tmodified through methods only.\n\t */\n\n\t/**\n\t * \t!readonly cx: number;\n\t */\n\tcx: 0,\n\t/**\n\t * \t!readonly cy: number;\n\t */\n\tcy: 0,\n\t/**\n\t * \t!readonly x1: number;\n\t */\n\tx1: 0,\n\t/**\n\t * \t!readonly y1: number;\n\t */\n\ty1: 0,\n\t/**\n\t * \t!readonly x2: number;\n\t */\n\tx2: 0,\n\t/**\n\t * \t!readonly y2: number;\n\t */\n\ty2: 0,\n\n\t/**\n\t * \tUpscaled coordinates.\n\t */\n\tucx: 0, ucy: 0,\n\tux1: 0, uy1: 0,\n\tux2: 0, uy2: 0,\n\n\t//violet\n\n\t/*\n\t**\tInitializes the instance.\n\t**\n\t**\tBounds2 __ctor (Bounds2 b)\n\t**\tBounds2 __ctor (Rect r)\n\t**\tBounds2 __ctor (float width, float height)\n\t**\tBounds2 __ctor (float x1, float y1, float x2, float y2, bool upscaled=false)\n\t*/\n\t__ctor: function (x1=null, y1=null, x2=null, y2=null, upscaled=false)\n\t{\n\t\tif (x1 === null)\n\t\t{\n\t\t\tthis.ux1 = this.uy1 = this.ux2 = this.uy2 = this.ucx = this.ucy = 0;\n\t\t\treturn this.downscale();\n\t\t}\n\n\t\tif (y1 !== null && x2 === null)\n\t\t\treturn this.set(0, 0, 0, 0).resize(x1, y1);\n\n\t\treturn this.set(x1, y1, x2, y2, upscaled);\n\t},\n\n\t/*\n\t**\tPopulates the downscaled components.\n\t**\n\t**\tBounds2 downscale ()\n\t*/\n\tdownscale: function ()\n\t{\n\t\tthis.x1 = downscale(this.ux1);\n\t\tthis.y1 = downscale(this.uy1);\n\t\tthis.x2 = downscale(this.ux2);\n\t\tthis.y2 = downscale(this.uy2);\n\t\tthis.cx = downscale(this.ucx);\n\t\tthis.cy = downscale(this.ucy);\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tTruncates the components to remove fractional parts.\n\t**\n\t**\tBounds2 trunc ()\n\t*/\n\ttrunc: function ()\n\t{\n\t\tthis.ux1 = upscale(this.x1);\n\t\tthis.uy1 = upscale(this.y1);\n\t\tthis.ux2 = upscale(this.x2);\n\t\tthis.uy2 = upscale(this.y2);\n\t\tthis.ucx = upscale(this.cx);\n\t\tthis.ucy = upscale(this.cy);\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tClones the bounds and returns a new object.\n\t**\n\t**\tBounds2 clone ()\n\t*/\n\tclone: function ()\n\t{\n\t\treturn Bounds2.Pool.alloc(this.ux1, this.uy1, this.ux2, this.uy2, true);\n\t},\n\n\t/*\n\t**\tSets the components to zero.\n\t**\n\t**\tBounds2 zero ()\n\t*/\n\tzero: function ()\n\t{\n\t\tthis.ux1 = 0; this.uy1 = 0;\n\t\tthis.ux2 = 0; this.uy2 = 0;\n\t\tthis.ucx = 0; this.ucy = 0;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tResets the component values to `null` for subsequent use with `setAsUnion`.\n\t**\n\t**\tBounds2 reset ()\n\t*/\n\treset: function ()\n\t{\n\t\tthis.ux1 = null; this.uy1 = null;\n\t\tthis.ux2 = null; this.uy2 = null;\n\t\tthis.ucx = null; this.ucy = null;\n\n\t\tthis.x1 = null; this.y1 = null;\n\t\tthis.x2 = null; this.y2 = null;\n\t\tthis.cx = null; this.cy = null;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tTranslates the bounds by the given deltas.\n\t**\n\t**\tBounds2 translate (Point2 p)\n\t**\tBounds2 translate (Vec2 v)\n\t**\tBounds2 translate (float dx, float dy, bool upscaled=false)\n\t*/\n\ttranslate: function (dx, dy=null, upscaled=false)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tif (Point2.isInstance(dx)) {\n\t\t\t\tdy = dx.uy;\n\t\t\t\tdx = dx.ux;\n\t\t\t} else { // Vec2\n\t\t\t\tdy = upscale(dx.y);\n\t\t\t\tdx = upscale(dx.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (!upscaled) {\n\t\t\t\tdx = upscale(dx);\n\t\t\t\tdy = upscale(dy);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux1 += dx; this.uy1 += dy;\n\t\tthis.ux2 += dx; this.uy2 += dy;\n\t\tthis.ucx += dx; this.ucy += dy;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tSets the coordinates of the bounds.\n\t**\n\t**\tBounds2 set (Bounds2 b)\n\t**\tBounds2 set (Rect r)\n\t**\tBounds2 set (float x1, float y1, float x2, float y2, bool upscaled=false)\n\t*/\n\tset: function (x1, y1=null, x2=null, y2=null, upscaled=false)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.uy2;\n\t\t\t\tx2 = x1.ux2;\n\t\t\t\ty1 = x1.uy1;\n\t\t\t\tx1 = x1.ux1;\n\t\t\t} else {\n\t\t\t\ty2 = upscale(x1.y2);\n\t\t\t\tx2 = upscale(x1.x2);\n\t\t\t\ty1 = upscale(x1.y1);\n\t\t\t\tx1 = upscale(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!upscaled) {\n\t\t\t\tx1 = upscale(x1);\n\t\t\t\ty1 = upscale(y1);\n\t\t\t\tx2 = upscale(x2);\n\t\t\t\ty2 = upscale(y2);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux1 = x1;\n\t\tthis.uy1 = y1;\n\t\tthis.ux2 = x2;\n\t\tthis.uy2 = y2;\n\n\t\tthis.ucx = (x1 + x2) >> 1;\n\t\tthis.ucy = (y1 + y2) >> 1;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tAdds the specified coordinates to the current ones.\n\t**\n\t**\tBounds2 add (Bounds2 b)\n\t**\tBounds2 add (Rect r)\n\t**\tBounds2 add (float x1, float y1, float x2, float y2, bool upscaled=false)\n\t*/\n\tadd: function (x1, y1=null, x2=null, y2=null, upscaled=false)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.uy2;\n\t\t\t\tx2 = x1.ux2;\n\t\t\t\ty1 = x1.uy1;\n\t\t\t\tx1 = x1.ux1;\n\t\t\t} else {\n\t\t\t\ty2 = upscale(x1.y2);\n\t\t\t\tx2 = upscale(x1.x2);\n\t\t\t\ty1 = upscale(x1.y1);\n\t\t\t\tx1 = upscale(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!upscaled) {\n\t\t\t\tx1 = upscale(x1);\n\t\t\t\ty1 = upscale(y1);\n\t\t\t\tx2 = upscale(x2);\n\t\t\t\ty2 = upscale(y2);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux1 += x1;\n\t\tthis.uy1 += y1;\n\t\tthis.ux2 += x2;\n\t\tthis.uy2 += y2;\n\n\t\tthis.ucx += (x1 + x2) >> 1;\n\t\tthis.ucy += (y1 + y2) >> 1;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tReturns true if the integer coordinates have the same values as the given argument.\n\t**\n\t**\tbool equals (Bounds2 b)\n\t**\tbool equals (Rect r)\n\t**\tbool equals (float x1, float y1, float x2, float y2)\n\t*/\n\tequals: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.y2;\n\t\t\t\tx2 = x1.x2;\n\t\t\t\ty1 = x1.y1;\n\t\t\t\tx1 = x1.x1;\n\t\t\t} else {\n\t\t\t\ty2 = int(x1.y2);\n\t\t\t\tx2 = int(x1.x2);\n\t\t\t\ty1 = int(x1.y1);\n\t\t\t\tx1 = int(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx1 = int(x1);\n\t\t\ty1 = int(y1);\n\t\t\tx2 = int(x2);\n\t\t\ty2 = int(y2);\n\t\t}\n\n\t\treturn x1 == this.x1 && x2 == this.x2 && y1 == this.y1 && y2 == this.y2;\n\t},\n\n\t/*\n\t**\tReturns a bool indicating if the specified bounds are contained by the current bounds.\n\t**\n\t**\tbool contains (Bounds2 b)\n\t**\tbool contains (Rect r)\n\t**\tbool contains (float x1, float y1, float x2, float y2)\n\t*/\n\tcontains: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.y2;\n\t\t\t\tx2 = x1.x2;\n\t\t\t\ty1 = x1.y1;\n\t\t\t\tx1 = x1.x1;\n\t\t\t} else {\n\t\t\t\ty2 = int(x1.y2);\n\t\t\t\tx2 = int(x1.x2);\n\t\t\t\ty1 = int(x1.y1);\n\t\t\t\tx1 = int(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx1 = int(x1);\n\t\t\ty1 = int(y1);\n\t\t\tx2 = int(x2);\n\t\t\ty2 = int(y2);\n\t\t}\n\n\t\treturn (x1 == Math.max(this.x1, x1)) && (y1 == Math.max(this.y1, y1)) && (x2 == Math.min(this.x2, x2)) && (y2 == Math.min(this.y2, y2));\n\t},\n\n\t/*\n\t**\tExtends the coordinates to ensure the specified argument is contained.\n\t**\n\t**\tBounds2 setAsUnion (Bounds2 b)\n\t**\tBounds2 setAsUnion (Rect r)\n\t**\tBounds2 setAsUnion (Point2 p)\n\t**\tBounds2 setAsUnion (Vec2 v)\n\t**\tBounds2 setAsUnion (float x, float y)\n\t**\tBounds2 setAsUnion (float x1, float y1, float x2, float y2)\n\t*/\n\tsetAsUnion: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1))\n\t\t\t{\n\t\t\t\tthis.setAsUnion(x1.ux1, x1.uy1, true);\n\t\t\t\tthis.setAsUnion(x1.ux2, x1.uy2, true);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t\telse if (Rect.isInstance(x1))\n\t\t\t{\n\t\t\t\tthis.setAsUnion(x1.x1, x1.y1);\n\t\t\t\tthis.setAsUnion(x1.x2, x1.y2);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t\telse if (Point2.isInstance(x1))\n\t\t\t{\n\t\t\t\ty1 = x1.uy;\n\t\t\t\tx1 = x1.ux;\n\t\t\t}\n\t\t\telse // Vec2\n\t\t\t{\n\t\t\t\ty1 = upscale(x1.y);\n\t\t\t\tx1 = upscale(x1.x);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (y2 !== null)\n\t\t\t{\n\t\t\t\tthis.setAsUnion(x1, y1);\n\t\t\t\tthis.setAsUnion(x2, y2);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (x2 !== true)\n\t\t\t\t{\n\t\t\t\t\tx1 = upscale(x1);\n\t\t\t\t\ty1 = upscale(y1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.ux1 === null || x1 < this.ux1) this.ux1 = x1;\n\t\tif (this.uy1 === null || y1 < this.uy1) this.uy1 = y1;\n\t\tif (this.ux2 === null || x1 > this.ux2) this.ux2 = x1;\n\t\tif (this.uy2 === null || y1 > this.uy2) this.uy2 = y1;\n\n\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tReturns a bool indicating if the integer components of the bounds intersect with the specified argument.\n\t**\n\t**\tbool intersects (Bounds2 b)\n\t**\tbool intersects (Rect r)\n\t**\tbool intersects (float x1, float y1, float x2, float y2)\n\t*/\n\tintersects: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.y2;\n\t\t\t\tx2 = x1.x2;\n\t\t\t\ty1 = x1.y1;\n\t\t\t\tx1 = x1.x1;\n\t\t\t} else {\n\t\t\t\ty2 = int(x1.y2);\n\t\t\t\tx2 = int(x1.x2);\n\t\t\t\ty1 = int(x1.y1);\n\t\t\t\tx1 = int(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx1 = int(x1);\n\t\t\ty1 = int(y1);\n\t\t\tx2 = int(x2);\n\t\t\ty2 = int(y2);\n\t\t}\n\n\t\tlet _x1 = Math.max(this.x1, x1);\n\t\tlet _y1 = Math.max(this.y1, y1);\n\t\tlet _x2 = Math.min(this.x2, x2);\n\t\tlet _y2 = Math.min(this.y2, y2);\n\n\t\treturn Math.max(0, _y2-_y1) * Math.max(0, _x2-_x1) > 0;\n\t},\n\n\t/*\n\t**\tSets the bounds to the intersection formed by the current bounds and the given argument.\n\t**\n\t**\tBounds2 setAsIntersection (Bounds2 b)\n\t**\tBounds2 setAsIntersection (Rect r)\n\t**\tBounds2 setAsIntersection (float x1, float y1, float x2, float y2)\n\t*/\n\tsetAsIntersection: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.y2;\n\t\t\t\tx2 = x1.x2;\n\t\t\t\ty1 = x1.y1;\n\t\t\t\tx1 = x1.x1;\n\t\t\t} else {\n\t\t\t\ty2 = int(x1.y2);\n\t\t\t\tx2 = int(x1.x2);\n\t\t\t\ty1 = int(x1.y1);\n\t\t\t\tx1 = int(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx1 = int(x1);\n\t\t\ty1 = int(y1);\n\t\t\tx2 = int(x2);\n\t\t\ty2 = int(y2);\n\t\t}\n\n\t\tthis.ux1 = upscale(Math.max(this.x1, x1));\n\t\tthis.uy1 = upscale(Math.max(this.y1, y1));\n\t\tthis.ux2 = upscale(Math.min(this.x2, x2));\n\t\tthis.uy2 = upscale(Math.min(this.y2, y2));\n\n\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\n\t\tthis.downscale();\n\n\t\treturn Math.max(0, this.uy2-this.uy1) * Math.max(0, this.ux2-this.ux1) > 0;\n\t},\n\n\t/*\n\t**\tResizes the bounds to the given size using center or top-left as reference.\t \n\t**\n\t**\tBounds2 resize (float width, float height, bool topLeftRelative=false)\n\t*/\n\tresize: function (width, height, topLeftRelative=false)\n\t{\n\t\twidth = upscale(width);\n\t\theight = upscale(height);\n\n\t\tif (topLeftRelative === true)\n\t\t{\n\t\t\tthis.ux2 = this.ux1 + width;\n\t\t\tthis.uy2 = this.uy1 + height;\n\n\t\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\t\t}\n\t\telse\n\t\t{\n\t\t\twidth >>= 1; height >>= 1;\n\n\t\t\tthis.ux1 = this.ucx - width; this.uy1 = this.ucy - height;\n\t\t\tthis.ux2 = this.ucx + width; this.uy2 = this.ucy + height;\n\t\t}\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tResizes the bounds using the specified deltas (using the center or top-left corner as reference).\n\t**\n\t**\tBounds2 resizeBy (float dwidth, float dheight, bool topLeftRelative=false)\n\t*/\n\tresizeBy: function (dwidth, dheight, topLeftRelative=false)\n\t{\n\t\tdwidth = upscale(dwidth);\n\t\tdheight = upscale(dheight);\n\n\t\tif (topLeftRelative === true)\n\t\t{\n\t\t\tthis.ux2 += dwidth;\n\t\t\tthis.uy2 += dheight;\n\n\t\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdwidth >>= 1; dheight >>= 1;\n\n\t\t\tthis.ux1 -= dwidth; this.uy1 -= dheight;\n\t\t\tthis.ux2 += dwidth; this.uy2 += dheight;\n\t\t}\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tReturns the width of the bounds.\n\t**\n\t**\tint width ()\n\t*/\n\twidth: function ()\n\t{\n\t\treturn this.x2 - this.x1;\n\t},\n\n\t/*\n\t**\tReturns the height of the bounds.\n\t**\n\t**\tint height ()\n\t*/\n\theight: function ()\n\t{\n\t\treturn this.y2 - this.y1;\n\t},\n\n\t/*\n\t**\tReturns true if the bounds are in forward position (x1 < x2 and y1 < y2).\n\t**\n\t**\tbool isForward ()\n\t*/\n\tisForward: function ()\n\t{\n\t\treturn this.ux1 <= this.ux2 && this.uy1 <= this.uy2;\n\t},\n\n\t/*\n\t**\tReturns true if the specified point is within the bounds. The `tol` parameter is used to specify a tolerance value.\n\t**\n\t**\tbool containsPoint (float x, float y, float tol=0)\n\t*/\n\tcontainsPoint: function (x, y, tol=0)\n\t{\n\t\tx = upscale(x);\n\t\ty = upscale(y);\n\t\ttol = upscale(tol);\n\n\t\treturn (this.ux1-tol <= x && x <= this.ux2+tol) && (this.uy1-tol <= y && y <= this.uy2+tol);\n\t},\n\n\t/*\n\t**\tReturns the area of the bounds. When strict is true, the area will be returned only if the bounds are forward.\n\t**\n\t**\tint area (bool strict=false)\n\t*/\n\tarea: function (strict=false)\n\t{\n\t\treturn strict ? (this.isForward() ? (this.y2-this.y1)*(this.x2-this.x1) : 0) : ((this.y2-this.y1)*(this.x2-this.x1));\n\t},\n\n\t/*\n\t**\tReturns the string representation of the rect coordinates.\n\t*/\n\ttoString: function ()\n\t{\n\t\treturn '(' + this.x1 + ', ' + this.y1 + ', ' + this.x2 + ', ' + this.y2 + ')';\n\t},\n\n\t/*\n\t**\tFlattens the contents of the bounds.\n\t**\n\t**\tarray flatten ()\n\t*/\n\tflatten: function ()\n\t{\n\t\treturn [this.ux1, this.uy1, this.ux2, this.uy2];\n\t},\n\n\t/*\n\t**\tUnflattens the given array into the bounds object.\n\t**\n\t**\tBounds2 unflatten (array x);\n\t*/\n\tunflatten: function (x)\n\t{\n\t\tthis.ux1 = x[0];\n\t\tthis.uy1 = x[1];\n\t\tthis.ux2 = x[2];\n\t\tthis.uy2 = x[3];\n\n\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\n\t\treturn this.downscale();\n\t}\n});\n\n//!/class\n\n//!namespace Rect\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a new object of zero size.\n\t * \t!function alloc() : Bounds2;\n\t */\n\nRecycler.createPool (Bounds2, 8192, 3072);\nexport default Bounds2;\n","/*\n**\tfroxel/anim/easing.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tCollection of useful easing functions.\n*/\n\n//!namespace Easing\n\nconst Easing =\n{\n\t/* ******************************************** */\n\t//!namespace Linear\n\tLinear:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Back\n\tBack:\n\t{\n\t\tk: 1.70158,\n\n\t\t/**\n\t\t * \t!function IN (t: number, k?: number) : number;\n\t\t */\n\t\tIN: function (t, k=null)\n\t\t{\n\t\t\tif (k === null) k = Easing.Back.k;\n\t\t\treturn t*t*((k+1)*t - k);\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number, k?: number) : number;\n\t\t */\n\t\tOUT: function (t, k=null)\n\t\t{\n\t\t\treturn 1 - Easing.Back.IN(1 - t, k);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number, k?: number) : number;\n\t\t */\n\t\tIN_OUT: function (t, k=null)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Back.IN(t*2, k)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Back.OUT((t-0.5)*2, k)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Bounce\n\tBounce:\n\t{\n\t\tgetConst: function (t)\n\t\t{\n\t\t\tif (t < 1.0/2.75)\n\t\t\t\treturn 7.5625 * t * t;\n\t\t\telse if (t < 2.0/2.75)\n\t\t\t\treturn 7.5625 * (t -= 1.5/2.75)*t + 0.75;\n\t\t\telse if (t < 2.5/2.75)\n\t\t\t\treturn 7.5625 * (t -= 2.250/2.75) * t + 0.9375;\n\n\t\t\treturn 7.5625 * (t -= 2.625/2.75) * t + 0.984375;\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Bounce.getConst(1-t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn Easing.Bounce.getConst(t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn (1 - Easing.Bounce.getConst(1-2*t))/2;\n\t\t\telse\n\t\t\t\treturn (Easing.Bounce.getConst((t-0.5)*2)/2)+0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Circ\n\tCirc:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Math.sqrt(1 - t*t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Circ.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\t\treturn Easing.Circ.IN(t*2)/2;\n\t\t\t\telse\n\t\t\t\t\treturn Easing.Circ.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Cubic\n\tCubic:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Cubic.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Cubic.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Cubic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Expo\n\tExpo:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn Math.pow(2, 12*(t-1));\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn -Math.pow(2, -12*t) + 1;\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif ((t *= 2) < 1)\n\t\t\t\treturn Math.pow (2, 12 * (t - 1)) / 2;\n\t\t\telse\n\t\t\t\treturn (-Math.pow (2, -12 * (t - 1)) + 2) / 2;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Power\n\tPower:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number, p?: number) : number;\n\t\t */\n\t\tIN: function (t, p=12)\n\t\t{\n\t\t\treturn Math.pow(t, p);\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number, p?: number) : number;\n\t\t */\n\t\tOUT: function (t, p=12)\n\t\t{\n\t\t\treturn 1 - Easing.Power.IN(1 - t, p);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number, p?: number) : number;\n\t\t */\n\t\tIN_OUT: function (t, p=12)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Power.IN(t*2, p)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Power.OUT((t-0.5)*2, p)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Quad\n\tQuad:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quad.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Quad.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Quad.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Quartic\n\tQuartic:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t*t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quartic.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Quartic.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Quartic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Quintic\n\tQuintic:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t*t*t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quintic.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\t\treturn Easing.Quintic.IN(t*2)/2;\n\t\t\t\telse\n\t\t\t\t\treturn Easing.Quintic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Sine\n\tSine:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Math.sin (1.5708 * (1 - t));\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn Math.sin (1.5708 * t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn (Math.cos (3.1416*t) - 1) / -2;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Step\n\tStep:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t}\n\t}\n};\n\nexport default Easing;\n","/*\n**\tfroxel/anim/block.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport List from '../utils/list.js';\nimport Recycler from '../utils/recycler.js';\n\n//!class Block\n\nconst Block = Class.extend\n({\n\tclassName: 'Anim:Block',\n\n\tcommands: null,\n\n\tfirst: true,\n\tcurrent: false,\n\ttime: 0,\n\n\t/**\n\t * \tInitializes the block to its initial state.\n\t * \t!init() : Block;\n\t */\n\tinit: function()\n\t{\n\t\tthis.commands = List.Pool.alloc();\n\t\tthis.reset(0);\n\t\treturn this;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis.commands.free();\n\t},\n\n\t/**\n\t * \tAdds a command to the block.\n\t * \t!add (cmd: Command) : Command;\n\t */\n\tadd: function(cmd)\n\t{\n\t\tthis.commands.push(cmd);\n\t\treturn cmd;\n\t},\n\n\t/**\n\t * \tClones the block.\n\t * \t!clone() : Block;\n\t */\n\tclone: function()\n\t{\n\t\tthrow new Error('Method `clone` not implemented in Anim:Block');\n\t},\n\n\t/**\n\t * \tClears the block by removing all commands and resetting it to initial state.\n\t * \t!clear() : Block;\n\t */\n\tclear: function()\n\t{\n\t\tthis.commands.clear();\n\t\tthis.reset(0);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResets the block to its initial state. Does not remove commands.\n\t * \t!reset (time: number) : Block;\n\t */\n\treset: function (time=0)\n\t{\n\t\tthis.first = true;\n\t\tthis.current = null;\n\t\tthis.time = time;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the block to use the first command in the next call to `update`.\n\t * \t!restart() : Block;\n\t */\n\trestart: function()\n\t{\n\t\tthis.first = true;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns `true` if all commands in the block have been executed to completion.\n\t * \t!isFinished() : boolean;\n\t */\n\tisFinished: function()\n\t{\n\t\tif (this.first === true)\n\t\t{\n\t\t\tthis.current = this.commands.top;\n\t\t\tthis.first = false;\n\t\t}\n\n\t\treturn this.current === null;\n\t},\n\n\t/**\n\t * \tExecutes the next command in the block. Returns `true` when block execution is complete.\n\t * \t!update (anim: Anim) : boolean;\n\t */\n\tupdate: function (anim)\n\t{\n\t\twhile (!this.isFinished())\n\t\t{\n\t\t\tlet r = this.current.value.update(anim, this);\n\t\t\tif (r !== true) return r;\n\n\t\t\tthis.current = this.current.next;\n\t\t}\n\n\t\treturn true;\n\t}\n});\n\n/**\n * \tAllocates a new block.\n * \t!static alloc () : Block;\n */\n\n/**\n * \tAllocates a new block and initializes it.\n * \t!static calloc () : Block;\n */\n\nRecycler.attachTo(Block, 8192);\nexport default Block;\n","/*\n**\tfroxel/anim/command.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Recycler from '../utils/recycler.js';\n\n//!class Command\n\nconst Command = Class.extend\n({\n\tclassName: 'Anim:Command',\n\n\t/**\n\t * \tObject having the code of the operation to execute.\n\t */\n\top: null,\n\n\t/**\n\t * \tIndicates if execution of the command has started.\n\t */\n\tstarted: false,\n\n\t/**\n\t * \tField related to the command.\n\t */\n\tfield: null,\n\n\t/**\n\t * \tValue related to the field of the command.\n\t */\n\tvalue: null,\n\n\t/**\n\t * \tDuration of the command.\n\t */\n\tduration: 0, _duration: 0,\n\n\t/**\n\t * \tNumber of cicles of the command.\n\t */\n\tcount: 0, _count: 0,\n\n\t/**\n\t * \tInitial value for the command's field.\n\t */\n\tstartValue: 0, _startValue: 0,\n\n\t/**\n\t * \tFinal value for the command's field.\n\t */\n\tendValue: 0, _endValue: 0,\n\n\t/**\n\t * \tEasing function to use to interpolate values of the command's field.\n\t */\n\teasing: null,\n\n\t_cur: null,\n\t_last: null,\n\n\t/**\n\t * \tBlock where the command is stored.\n\t */\n\tblock: null, /* Block */\n\n\t/**\n\t * \tBlocks to execute (for commands having multiple blocks).\n\t */\n\tblocks: null, /* List<Block> */\n\n\t/**\n\t * \tTable with values.\n\t */\n\ttable: null,\n\n\t/**\n\t * \tSound resource.\n\t */\n\tsnd: null,\n\n\t/**\n\t * \tFunction to execute.\n\t */\n\tfn: null,\n\n\t/**\n\t * \tInitializes the command.\n\t * \t!init (op: object) : Command;\n\t */\n\tinit: function(op)\n\t{\n\t\tthis.op = op;\n\t\tthis.started = false;\n\n\t\tthis.block = null;\n\t\tthis.blocks = null;\n\t\n\t\tthis.table = null;\n\t\tthis.snd = null;\n\t\tthis.fn = null;\n\n\t\top.init(this, false);\n\t\treturn this;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tif (this.block !== null) this.block.clear().free();\n\t\tif (this.blocks !== null) this.blocks.clear().free();\n\t},\n\n\t/**\n\t * \tExecuted when the command properties are ready, to initialize the operation code.\n\t * \t!ready() : void;\n\t */\n\tready: function()\n\t{\n\t\tthis.op.init(this, true);\n\t},\n\n\t/**\n\t * \tUpdates the command execution.\n\t * \t!update (anim: Anim, block: Block) : boolean;\n\t */\n\tupdate: function(anim, block)\n\t{\n\t\treturn this.op.update(anim, block, this);\n\t}\n});\n\n/**\n * \tAllocates a new command.\n * \t!static alloc () : Command;\n */\n\n/**\n * \tAllocates a new command and initializes it.\n * \t!static calloc () : Command;\n */\n\nRecycler.attachTo(Command);\nexport default Command;\n","/*\n**\tfroxel/anim/parallel.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport List from '../utils/list.js';\nimport Block from './block.js';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t\tif (!postinit)\n\t\t{\n\t\t\tcmd.block = Block.alloc();\n\t\t\tcmd.blocks = List.Pool.alloc();\n\t\t\treturn;\n\t\t}\n\n\t\tlet i;\n\n\t\twhile ((i = cmd.block.commands.shift()) != null)\n\t\t{\n\t\t\tlet block = Block.alloc();\n\t\t\tblock.add(i);\n\t\t\tcmd.blocks.push(block);\n\t\t}\n\n\t\tcmd.block.free();\n\t\tcmd.block = null;\n\t},\n\n\tupdate: function (anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tfor (let i = cmd.blocks.top; i !== null; i = i.next)\n\t\t\t{\n\t\t\t\ti.value.reset (block.time);\n\t\t\t}\n\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet time = block.time;\n\t\tlet n = 0, m = 0;\n\n\t\tfor (let i = cmd.blocks.top; i !== null; i = i.next)\n\t\t{\n\t\t\tlet r = i.value.update(anim);\n\t\t\tif (r === true) n++; else if (r === null) m++;\n\n\t\t\tif (i.value.time > time)\n\t\t\t\ttime = i.value.time;\n\t\t}\n\n\t\tif ((n+m) != cmd.blocks.length)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time = time;\n\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/serial.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Block from './block.js';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t\tif (!postinit)\n\t\t\tcmd.block = Block.alloc();\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd.block.reset (block.time);\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet r = cmd.block.update(anim);\n\t\tif (r !== true) return r;\n\n\t\tcmd.started = false;\n\t\tblock.time = cmd.block.time;\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/serial.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Block from './block.js';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t\tif (!postinit)\n\t\t\tcmd.block = Block.alloc();\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd.block.reset (block.time);\n\t\t\tcmd._count = cmd.count;\n\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet r = cmd.block.update(anim);\n\t\tif (r !== true) return r;\n\n\t\tif (cmd._count <= 1)\n\t\t{\n\t\t\tcmd.started = false;\n\t\t\tblock.time = cmd.block.time;\n\t\t\treturn true;\n\t\t}\n\n\t\tcmd.block.restart();\n\t\tcmd._count--;\n\t\treturn false;\n\t}\n};\n","/*\n**\tfroxel/anim/set.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tanim.setValue(cmd.field, anim.getValue(cmd.field, cmd.value));\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/restart.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tblock.restart();\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/wait.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rin } from '@rsthn/rin';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._duration = Rin.typeOf(cmd.duration) === 'string' ? anim.getValue(cmd.duration) : cmd.duration;\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tif (anim.time < block.time + cmd._duration)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time += cmd._duration;\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/range.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rin } from '@rsthn/rin';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._startValue = anim.getValue(cmd.field, cmd.startValue);\n\t\t\tcmd._duration = Rin.typeOf(cmd.duration) === 'string' ? anim.getValue(cmd.duration) : cmd.duration;\n\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tcmd._endValue = anim.getValue(cmd.field, cmd.endValue, cmd._startValue);\n\n\t\tlet t = 1.0;\n\n\t\tif (anim.time < block.time + cmd._duration)\n\t\t\tt = (anim.time - block.time) / cmd._duration;\n\n\t\tif (cmd.easing && t != 1.0)\n\t\t\tanim.setValue(cmd.field, cmd.easing(t)*(cmd._endValue - cmd._startValue) + cmd._startValue);\n\t\telse\n\t\t\tanim.setValue(cmd.field, t*(cmd._endValue - cmd._startValue) + cmd._startValue);\n\n\t\tif (t != 1.0)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time += cmd._duration;\n\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/rand.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rin } from '@rsthn/rin';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._duration = Rin.typeOf(cmd.duration) === 'string' ? anim.getValue(cmd.duration) : cmd.duration;\n\t\t\tcmd._last = null;\n\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet t = 1.0;\n\n\t\tif (anim.time < block.time + cmd._duration)\n\t\t\tt = (anim.time - block.time) / cmd._duration;\n\n\t\tif (cmd.easing && t != 1.0)\n\t\t\tcmd._cur = int(cmd.easing(t)*cmd.count);\n\t\telse\n\t\t\tcmd._cur = int(t*cmd.count);\n\n\t\tif (cmd._cur != cmd._last)\n\t\t{\n\t\t\tlet val = anim.getValue(cmd.field);\n\n\t\t\twhile (true) {\n\t\t\t\tlet i = int(Math.random()*(cmd.endValue - cmd.startValue + 1)) + cmd.startValue;\n\t\t\t\tif (i != val) break;\n\t\t\t}\n\n\t\t\tanim.setValue(cmd.field, i);\n\t\t\tcmd._last = cmd._cur;\n\t\t}\n\n\t\tif (t != 1.0)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time += cmd._duration;\n\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/randt.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rin } from '@rsthn/rin';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t\tif (!postinit) return;\n\n\t\tlet table = [ ];\n\n\t\tfor (let i = 0; i < cmd.count; i++)\n\t\t\ttable.push ((i % (cmd.endValue - cmd.startValue + 1)) + cmd.startValue);\n\n\t\tfor (let i = cmd.count >> 2; i > 0; i--)\n\t\t{\n\t\t\tlet a = int(Math.random() * cmd.count);\n\t\t\tlet b = int(Math.random() * cmd.count);\n\n\t\t\tlet c = table[b];\n\t\t\ttable[b] = table[a];\n\t\t\ttable[a] = c;\n\t\t}\n\n\t\tcmd.table = table;\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._duration = Rin.typeOf(cmd.duration) === 'string' ? anim.getValue(cmd.duration) : cmd.duration;\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet t = 1.0;\n\t\tlet i;\n\n\t\tif (anim.time < block.time + cmd._duration)\n\t\t\tt = (anim.time - block.time) / cmd._duration;\n\n\t\tif (cmd.easing && t != 1.0)\n\t\t\ti = cmd.easing(t)*(cmd.count-1);\n\t\telse\n\t\t\ti = t*(cmd.count-1);\n\n\t\tanim.setValue(cmd.field, cmd.table[int((i + cmd.count) % cmd.count)]);\n\n\t\tif (t != 1.0)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time += cmd._duration;\n\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/anim.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport List from '../utils/list.js';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"../utils/list\"]\n//![import \"../utils/recycler\"]\n\nimport Block from './block.js';\nimport Command from './command.js';\n\n//![import \"./block\"]\n//![import \"./command\"]\n\nimport PARALLEL from './parallel.js';\nimport SERIAL from './serial.js';\nimport REPEAT from './repeat.js';\nimport SET from './set.js';\nimport RESTART from './restart.js';\nimport WAIT from './wait.js';\nimport RANGE from './range.js';\nimport RAND from './rand.js';\nimport RANDT from './randt.js';\n\n//:/**\n//: * \tClass to animate properties using commands.\n//: */\n\n//!class Anim\n\nconst Anim = Class.extend\n({\n\tclassName: 'Anim',\n\n\tinitialData: null,\n\tdata: null,\n\n\tblockStack: null,\n\tcmdStack: null,\n\n\ttimeScale: 1,\n\tblock: null,\n\ttime: 0,\n\n\tpaused: false,\n\tfinished: false,\n\n\tfinishedCallback: null,\n\tfinishedCallbackHandler: null,\n\tfinishedCallbackContext: null,\n\n\t__ctor: function ()\n\t{\n\t\t// VIOLET: Possibly optimize this.\n\t\tthis.initialData = { };\n\t\tthis.data = { };\n\n\t\tthis.block = Block.alloc();\n\t\tthis.blockStack = List.Pool.alloc();\n\t\tthis.cmdStack = List.Pool.alloc();\n\n\t\treturn this.reset();\n\t},\n\n\t__dtor: function ()\n\t{\n\t\tthis.block.free();\n\t\tthis.blockStack.clear().free();\n\t\tthis.cmdStack.clear().free();\n\n\t\tif (this.finishedCallbackHandler !== null)\n\t\t{\n\t\t\tthis.finishedCallbackHandler.free();\n\t\t\tthis.finishedCallbackHandler = null;\n\t\t}\n\n\t\tif (this.finishedCallbackContext !== null)\n\t\t{\n\t\t\tthis.finishedCallbackContext.free();\n\t\t\tthis.finishedCallbackContext = null;\n\t\t}\n\t},\n\n\tcopyTo: function (target)\n\t{\n\t\ttarget.block = this.block.clone();\n\t\ttarget.initialData = this.initialData;\n\n\t\treturn target.reset();\n\t},\n\n\tonFinished: function (callback)\n\t{\n\t\tthis.finishedCallback = callback;\n\t\treturn this;\n\t},\n\n\tthen: function (callback, context=null)\n\t{\n\t\tif (!callback) return this;\n\n\t\tif (this.finishedCallback !== this.thenCallback)\n\t\t{\n\t\t\tthis.finishedCallback = this.thenCallback;\n\n\t\t\tif (this.finishedCallbackHandler === null)\n\t\t\t{\n\t\t\t\tthis.finishedCallbackHandler = List.Pool.alloc();\n\t\t\t\tthis.finishedCallbackContext = List.Pool.alloc();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.finishedCallbackHandler.reset();\n\t\t\t\tthis.finishedCallbackContext.reset();\n\t\t\t}\n\t\t}\n\n\t\tthis.finishedCallbackHandler.push(callback);\n\t\tthis.finishedCallbackContext.push(context);\n\t\treturn this;\n\t},\n\n\tthenCallback: function ()\n\t{\n\t\tif (!this.finishedCallbackHandler.length)\n\t\t\treturn false;\n\n\t\tlet context = this.finishedCallbackContext.shift();\n\t\tthis.finishedCallbackHandler.shift()(this, context);\n\t},\n\n\t/*\n\t**\tClears the object, removes all commands and callbacks. The `initialData` and `data` objects aren't changed.\n\t*/\n\tclear: function ()\n\t{\n\t\tthis.blockStack.clear();\n\t\tthis.cmdStack.clear();\n\t\tthis.block.clear();\n\n\t\tthis.paused = false;\n\t\tthis.finished = false;\n\t\tthis.time = 0;\n\t\tthis.timeScale = 1;\n\n\t\tif (this.finishedCallbackHandler !== null)\n\t\t{\n\t\t\tthis.finishedCallbackHandler.free();\n\t\t\tthis.finishedCallbackHandler = null;\n\t\t}\n\n\t\tif (this.finishedCallbackContext !== null)\n\t\t{\n\t\t\tthis.finishedCallbackContext.free();\n\t\t\tthis.finishedCallbackContext = null;\n\t\t}\n\n\t\tthis.finishedCallback = null;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tResets the animation to its initial state.\n\t*/\n\treset: function ()\n\t{\n\t\tthis.blockStack.clear();\n\t\tthis.cmdStack.clear();\n\t\tthis.block.reset();\n\n\t\tthis.paused = false;\n\t\tthis.finished = false;\n\t\tthis.time = 0;\n\t\tthis.timeScale = 1;\n\n\t\tObject.assign (this.data, this.initialData);\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the initial data.\n\t*/\n\tinitial: function (data=null)\n\t{\n\t\tif (data !== null)\n\t\t\tthis.initialData = data;\n\n\t\tObject.assign (this.data, this.initialData);\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the time scale (animation speed).\n\t*/\n\tspeed: function (value)\n\t{\n\t\tthis.timeScale = value > 0.0 ? value : 1.0;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the output data object.\n\t*/\n\toutput: function (data)\n\t{\n\t\tthis.data = data;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tPauses the animation.\n\t*/\n\tpause: function ()\n\t{\n\t\tthis.paused = true;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tResumes the animation.\n\t*/\n\tresume: function ()\n\t{\n\t\tthis.finished = false;\n\t\tthis.paused = false;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the value of a field.\n\t*/\n\tsetValue: function (fieldName, value)\n\t{\n\t\tlet curr = this.data;\n\n\t\tif (typeof(fieldName) !== 'string')\n\t\t{\n\t\t\tif (typeof(fieldName) === 'function')\n\t\t\t{\n\t\t\t\tfieldName (this, value);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet i = 0;\n\n\t\t\t\twhile (curr !== null && i < fieldName.length-1)\n\t\t\t\t\tcurr = curr[fieldName[i++]];\n\n\t\t\t\tcurr[fieldName[i]] = value;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tcurr[fieldName] = value;\n\t},\n\n\t/*\n\t**\tReturns the value of a field. Performs special transforms to the value if certain prefix is found.\n\t*/\n\tgetValue: function (fieldName, value=null, initialValue=null)\n\t{\n\t\tlet curr = this.data;\n\t\t\n\t\tif (typeof(fieldName) !== 'string')\n\t\t{\n\t\t\tif (typeof(fieldName) === 'function')\n\t\t\t{\n\t\t\t\tcurr = fieldName (this, null);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet i = 0;\n\n\t\t\t\twhile (curr !== null && i < fieldName.length)\n\t\t\t\t\tcurr = curr[fieldName[i++]];\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tcurr = curr[fieldName];\n\n\t\tif (value === null)\n\t\t\tvalue = curr;\n\n\t\tif (initialValue === null)\n\t\t\tinitialValue = curr;\n\n\t\tif (typeof(value) === 'string')\n\t\t{\n\t\t\tswitch(value[0])\n\t\t\t{\n\t\t\t\tcase '+':\n\t\t\t\t\tvalue = initialValue + Number(value.substr(1));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase '-':\n\t\t\t\t\tvalue = initialValue - Number(value.substr(1));\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tvalue = Number(value);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\telse if (typeof(value) === 'function')\n\t\t\tvalue = value (curr, initialValue, this);\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * Updates the animation by the specified delta, which must be in the same unit as the duration of the commands.\n\t * Returns false when the animation has been completed.\n\t *\n\t * @param {number} dt\n\t * @returns {boolean}\n\t */\n\tupdate: function (dt, self=null)\n\t{\n\t\tif (self === null)\n\t\t\tself = this;\n\n\t\tif (self.paused || self.block.isFinished())\n\t\t\treturn false;\n\n\t\tself.time += dt*self.timeScale*Anim.timeScale;\n\n\t\tif (self.block.update(self) !== true)\n\t\t\treturn true;\n\n\t\tlet finished = self.finished;\n\t\tlet count = self.block.length;\n\t\tlet block = self.block;\n\n\t\tself.finished = true;\n\n\t\tif (!finished && self.finishedCallback !== null)\n\t\t{\n\t\t\tif (self.finishedCallback(self.data, self) === false)\n\t\t\t\tself.finishedCallback = null;\n\n\t\t\tif (self.block !== block || self.block.length != count)\n\t\t\t{\n\t\t\t\tself.resume();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t},\n\n\t/*\n\t**\tEnsures that the field name is correct for subsequent rules.\n\t*/\n\tprepareFieldName: function (value)\n\t{\n\t\tif (typeof(value) === 'function')\n\t\t\treturn value;\n\n\t\treturn value.indexOf('.') != -1 ? value.split('.') : value;\n\t},\n\n\t/* ****************************************************************************************** */\n\n\t/*\n\t**\tRuns the subsequent commands in parallel. Should end the parallel block by calling end().\n\t*/\n\tparallel: function ()\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(PARALLEL));\n\n\t\tthis.blockStack.push (this.block);\n\t\tthis.cmdStack.push (cmd);\n\n\t\tthis.block = cmd.block;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tRuns the subsequent commands in series. Should end the serial block by calling end().\n\t*/\n\tserial: function ()\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(SERIAL));\n\n\t\tthis.blockStack.push (this.block);\n\t\tthis.cmdStack.push (cmd);\n\n\t\tthis.block = cmd.block;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tRepeats a block the specified number of times.\n\t*/\n\trepeat: function (count)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(REPEAT));\n\t\tcmd.count = count;\n\n\t\tthis.blockStack.push (this.block);\n\t\tthis.cmdStack.push (cmd);\n\n\t\tthis.block = cmd.block;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tEnds a parallel(), serial() or repeat() block.\n\t*/\n\tend: function ()\n\t{\n\t\tthis.cmdStack.pop().ready();\n\t\tthis.block = this.blockStack.pop();\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the value of a variable.\n\t*/\n\tset: function (field, value)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(SET));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.value = value;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tRestarts the current block.\n\t*/\n\trestart: function ()\n\t{\n\t\tthis.block.add(Command.alloc(RESTART));\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tWaits for the specified duration.\n\t*/\n\twait: function (duration)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(WAIT));\n\n\t\tcmd.duration = duration;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the range of a variable.\n\t*/\n\trange: function (field, duration, startValue, endValue, easing=null)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(RANGE));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.duration = duration;\n\t\tcmd.startValue = startValue;\n\t\tcmd.endValue = endValue;\n\t\tcmd.easing = easing;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the range of a variable, using the current value as startValue.\n\t*/\n\trangeTo: function (field, duration, endValue, easing=null)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(RANGE));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.duration = duration;\n\t\tcmd.startValue = null;\n\t\tcmd.endValue = endValue;\n\t\tcmd.easing = easing;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tGenerates a certain amount of random numbers in the given range (inclusive).\n\t*/\n\trand: function (field, duration, count, startValue, endValue, easing=null)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(RAND));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.duration = duration;\n\t\tcmd.count = count;\n\t\tcmd.startValue = startValue;\n\t\tcmd.endValue = endValue;\n\t\tcmd.easing = easing;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tGenerates a certain amount of random numbers in the given range (inclusive). This uses a static random table to determine the next values.\n\t*/\n\trandt: function (field, duration, count, startValue, endValue, easing)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(RANDT));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.duration = duration;\n\t\tcmd.count = count;\n\t\tcmd.startValue = startValue;\n\t\tcmd.endValue = endValue;\n\t\tcmd.easing = easing;\n\n\t\tcmd.ready();\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tPlays a sound.\n\t*/\n\tplay: function (snd)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(PLAY));\n\t\tcmd.snd = snd;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tExecutes a function.\n\t*/\n\texec: function (fn)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(EXEC));\n\t\tcmd.fn = fn;\n\n\t\treturn this;\n\t},\n\n\t/* ********************************************************** */\n\n\t_bounds_x1: function (anim, value)\n\t{\n\t\tif (value === null)\n\t\t\treturn anim.data.bounds.x1;\n\n\t\tanim.data.translate(int(value) - anim.data.bounds.x1, 0);\n\t},\n\n\t_bounds_y1: function (anim, value)\n\t{\n\t\tif (value === null)\n\t\t\treturn anim.data.bounds.y1;\n\n\t\tanim.data.translate(0, int(value) - anim.data.bounds.y1);\n\t},\n\n\t/*\n\t**\tSets X coordinate.\n\t*/\n\tsetX: function (value)\n\t{\n\t\treturn this.set(this._bounds_x1, value);\n\t},\n\n\t/*\n\t**\tSets Y coordinate.\n\t*/\n\tsetY: function (value)\n\t{\n\t\treturn this.set(this._bounds_y1, value);\n\t},\n\n\t/*\n\t**\tSets X and Y coordinates.\n\t*/\n\tposition: function (x, y)\n\t{\n\t\treturn this.set(this._bounds_x1, x).set(this._bounds_y1, y);\n\t},\n\n\t/*\n\t**\tTranslates the X coordinate.\n\t*/\n\ttranslateX: function (duration, deltaValue, easing)\n\t{\n\t\treturn this.range(this._bounds_x1, duration, null, (deltaValue < 0 ? '-' : '+') + Math.abs(deltaValue), easing);\n\t},\n\n\t/*\n\t**\tTranslates the Y coordinate.\n\t*/\n\ttranslateY: function (duration, deltaValue, easing)\n\t{\n\t\treturn this.range(this._bounds_y1, duration, null, (deltaValue < 0 ? '-' : '+') + Math.abs(deltaValue), easing);\n\t},\n\n\t/*\n\t**\tTranslates the X and Y coordinates.\n\t*/\n\ttranslate: function (duration, deltaValueX, deltaValueY, easingX, easingY=null)\n\t{\n\t\treturn this.parallel()\n\t\t\t\t\t.range(this._bounds_x1, duration, null, (deltaValueX < 0 ? '-' : '+') + Math.abs(deltaValueX), easingX)\n\t\t\t\t\t.range(this._bounds_y1, duration, null, (deltaValueY < 0 ? '-' : '+') + Math.abs(deltaValueY), easingY ? easingY : easingX)\n\t\t\t\t.end();\n\t},\n\n\t/*\n\t**\tSets the X and Y coordinates to the specified values.\n\t*/\n\tmoveTo: function (duration, endValueX, endValueY, easingX, easingY=null)\n\t{\n\t\treturn this.parallel()\n\t\t\t\t.range(this._bounds_x1, duration, null, endValueX, easingX)\n\t\t\t\t.range(this._bounds_y1, duration, null, endValueY, easingY ? easingY : easingX)\n\t\t\t\t.end();\n\t},\n\n\t/*\n\t**\tSets the X coordinate to the specified value.\n\t*/\n\tmoveX: function (duration, endValue, easing=null)\n\t{\n\t\treturn this.range(this._bounds_x1, duration, null, endValue, easing);\n\t},\n\n\t/*\n\t**\tSets the Y coordinate to the specified value.\n\t*/\n\tmoveY: function (duration, endValue, easing=null)\n\t{\n\t\treturn this.range(this._bounds_y1, duration, null, endValue, easing);\n\t},\n\n\t/*\n\t**\tScales the X coordinate.\n\t*/\n\tscaleX: function (duration, endValue, easing)\n\t{\n\t\treturn this.range('sx', duration, null, endValue, easing);\n\t},\n\n\t/*\n\t**\tScales the Y coordinate.\n\t*/\n\tscaleY: function (duration, endValue, easing)\n\t{\n\t\treturn this.range('sy', duration, null, endValue, easing);\n\t},\n\n\t/*\n\t**\tScales the X and Y coordinates.\n\t*/\n\tscale: function (duration, endValueX, endValueY, easingX, easingY=null)\n\t{\n\t\treturn this.parallel()\n\t\t\t\t.range('sx', duration, null, endValueX, easingX)\n\t\t\t\t.range('sy', duration, null, endValueY, easingY ? easingY : easingX)\n\t\t\t\t.end();\n\t},\n\n\t/*\n\t**\tRotates a certain number of radians.\n\t*/\n\trotate: function (duration, deltaValue, easing)\n\t{\n\t\treturn this.range('angle', duration, null, (deltaValue < 0 ? '-' : '+') + Math.abs(deltaValue), easing);\n\t}\n});\n\n/*\n**\tGlobal time scale.\n*/\nAnim.timeScale = 1.0;\n\n/*\n**\tSets the global time scale (animation speed).\n*/\nAnim.speed = function (value)\n{\n\tAnim.timeScale = value > 0.0 ? value : 1.0;\n};\n\nRecycler.createPool(Anim, 8192);\nexport default Anim;\n","/*\n**\tflow/boot.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport PriorityQueue from '../utils/priority-queue.js';\n\n//![import \"../utils/priority-queue\"]\n\n//!class Boot\n\nconst Boot =\n{\n\tmodules: new PriorityQueue(),\n\n\t/**\n\t * \tRegisters a new boot module.\n\t * \t!static register (module: Boot.Module) : Boot.Module;\n\t */\n\tregister: function (module)\n\t{\n\t\treturn this.modules.add(module);\n\t},\n\n\t/**\n\t * \tRemoves a boot module.\n\t * \t!static unregister (module: Boot.Module) : void;\n\t */\n\tunregister: function (module)\n\t{\n\t\tthis.modules.remove(module);\n\t\tthis.modules.cleanup();\n\t},\n\n\t/**\n\t * \tExecutes the startup sequence.\n\t * \t!static startup (finishedCallback?: () => void) : void;\n\t */\n\tstartup: function (finishedCallback=null)\n\t{\n\t\tthis.modules.forEachAsync((m,r) => { if (m.onStartup(r) !== false) r(); }, finishedCallback);\n\t},\n\n\t/**\n\t * \tExecutes the shutdown sequence.\n\t * \t!static shutdown (finishedCallback?: () => void) : void;\n\t */\n\tshutdown: function (finishedCallback=null)\n\t{\n\t\tthis.modules.forEachAsyncRev( (m,r) => { if (m.onShutdown(r) !== false) r(); }, finishedCallback);\n\t}\n};\n\n//!/class\n\n//!namespace Boot\n//!interface Module\n\nBoot.Module = Class.extend\n({\n\tclassName: \"Module\",\n\n\t/**\n\t * \tPriority of the module (from 0 to 100), lower number means higher priority.\n\t * \t!priority: number;\n\t */\n\tpriority: 5,\n\n\t__ctor: function()\n\t{\n\t\tBoot.register(this);\n\t},\n\n\t__dtor: function()\n\t{\n\t\tBoot.unregister(this);\n\t},\n\n\t/**\n\t * \tShould return `false` if the method is async. When async ensure to call `next` once the operation is complete.\n\t * \t!onStartup (next: () => void) : boolean;\n\t */\n\tonStartup: function (next)\n\t{\n\t},\n\n\t/**\n\t * \tShould return `false` if the method is async. When async ensure to call `next` once the operation is complete.\n\t * \t!onShutdown (next: () => void) : boolean;\n\t */\n\tonShutdown: function (next)\n\t{\n\t}\n});\n\n//!/interface\n//!/namespace\n\nexport default Boot;\n","/*\n**\tflow/grid-element.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Bounds2 from '../math/bounds2.js';\nimport Handler from '../utils/handler.js';\n\n//![import \"../math/bounds2\"]\n//![import \"../utils/handler\"]\n\n//:/**\n//: * \tDescribes an element that can be added to a grid.\n//: */\n\n//!class GridElement\n\nconst GridElement = Class.extend\n({\n\t/*\n\t**\tName of the class (for inheritance purposes).\n\t*/\n\tclassName: 'GridElement',\n\n\t/**\n\t * \tIdentifier of the element (string).\n\t * \t!id: string;\n\t */\n\tid: null,\n\n\t/**\n\t * \tBounds of the element.\n\t * \t!bounds: Bounds2;\n\t */\n\tbounds: null,\n\n\t/**\n\t * \tFlags of the element (see constants of this class).\n\t * \t!flags: number;\n\t */\n\tflags: 0,\n\n\t/**\n\t * \tGeneric data of the element, used to store some value or object.\n\t * \t!data: object;\n\t */\n\tdata: null,\n\n\t/**\n\t * \tExtension object of the element, can be used to implement specific functionality.\n\t * \t!ext: object;\n\t */\n\text: null,\n\n\t/**\n\t * \tThe container where the element is stored.\n\t */\n\tcontainer: null,\n\n\t/**\n\t * \tRemoval callback node added by Grid.\n\t */\n\t_grid_remove_node: null,\n\n\t/**\n\t * \tRemover runs when the `remove` method of the element is called or when the element is destroyed.\n\t */\n\tremover: null,\n\n\t/**\n\t * \tConstructs the instance at the specified position and with the specified size.\n\t * \t!constructor (x: number, y: number, width: number, height: number);\n\t */\n\t__ctor: function (x, y, width, height)\n\t{\n\t\tthis.bounds = Bounds2.Pool.alloc();\n\n\t\tthis.bounds.translate (x, y);\n\t\tthis.bounds.resize (width, height, true);\n\n\t\tthis.flags = GridElement.ALIVE | GridElement.VISIBLE | GridElement.DIRTY | GridElement.DEPTH_FLAG;\n\t\tthis.data = null;\n\t\tthis.ext = null;\n\n\t\tthis.remover = Handler.Pool.alloc(this);\n\t},\n\n\t/**\n\t * \tRemoves the element from its container and destroys it.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.alive(false);\n\n\t\tif (this.data !== null)\n\t\t{\n\t\t\tdispose(this.data);\n\t\t\tthis.data = null;\n\t\t}\n\n\t\tthis.remover.exec();\n\t\tthis.remover.free();\n\n\t\tthis.bounds.free();\n\t},\n\n\t/**\n\t * \tSets the identifier of the element.\n\t * \t!setId (value: string) : GridElement;\n\t */\n\tsetId: function (value)\n\t{\n\t\tthis.id = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets bits of the element flags.\n\t * \t!setFlags (value: number) : GridElement;\n\t */\n\tsetFlags: function (value)\n\t{\n\t\tthis.flags |= value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tClears bits from the element flags.\n\t * \t!clearFlags (value: number) : GridElement;\n\t */\n\tclearFlags: function (value)\n\t{\n\t\tthis.flags &= ~value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns true if masking (bitwise AND) the flags by the specified flag bits results in the given value.\n\t * \t!getFlags (andMask: number, value?: number) : boolean;\n\t */\n\tgetFlags: function (andMask, value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn (this.flags & andMask) === andMask;\n\n\t\treturn (this.flags & andMask) === value;\n\t},\n\n\t/**\n\t * \tSets the generic data of the element. Will be disposed when the element is destroyed.\n\t * \t!setData (data: object) : GridElement;\n\t */\n\tsetData: function (data)\n\t{\n\t\tthis.data = data;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the generic data of the element.\n\t * \t!getData() : object;\n\t */\n\tgetData: function()\n\t{\n\t\treturn this.data;\n\t},\n\n\t/**\n\t * \tSets the extension object of the element.\n\t * \t!setExtension (extensionObject: object) : GridElement;\n\t */\n\tsetExt: function (extensionObject)\n\t{\n\t\tthis.ext = extensionObject;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the extension object of the element.\n\t * \t!getExt() : object;\n\t */\n\tgetExt: function()\n\t{\n\t\treturn this.ext;\n\t},\n\n\t/**\n\t * \tSets the visible flag.\n\t * \t!visible (value: boolean) : GridElement;\n\t */\n\t/**\n\t * \tReturns the visible flag.\n\t * \t!visible() : boolean;\n\t */\n\tvisible: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.VISIBLE);\n\n\t\tthis.flags &= ~GridElement.VISIBLE;\n\t\tif (value) this.flags |= GridElement.VISIBLE;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the alive flag.\n\t * \t!alive (value: boolean) : GridElement;\n\t */\n\t/**\n\t * \tReturns the alive flag.\n\t * \t!alive() : boolean;\n\t */\n\talive: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.ALIVE);\n\n\t\tthis.flags &= ~GridElement.ALIVE;\n\t\tif (value) this.flags |= GridElement.ALIVE;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the dirty flag.\n\t * \t!alive (value: boolean) : GridElement;\n\t */\n\t/**\n\t * \tReturns the dirty flag.\n\t * \t!alive() : boolean;\n\t */\n\tdirty: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.DIRTY);\n\n\t\tthis.flags &= ~GridElement.DIRTY;\n\t\tif (value) this.flags |= GridElement.DIRTY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the depth-flag-enabled flag.\n\t * \t!depthFlagEnabled (value: boolean) : GridElement;\n\t */\n\t/**\n\t * \tReturns the depth-flag-enabled flag.\n\t * \t!depthFlagEnabled() : boolean;\n\t */\n\tdepthFlagEnabled: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.DEPTH_FLAG_ENABLED);\n\n\t\tthis.flags &= ~GridElement.DEPTH_FLAG_ENABLED;\n\t\tif (value) this.flags |= GridElement.DEPTH_FLAG_ENABLED;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the depth-flag flag. To actually use the depth-test, you have to enable the depth-flag using `depthFlagEnabled`.\n\t * \t!depthFlagEnabled (value: boolean) : GridElement;\n\t */\n\t/**\n\t * \tReturns the depth-flag flag.\n\t * \t!depthFlagEnabled() : boolean;\n\t */\n\tdepthFlag: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.DEPTH_FLAG);\n\n\t\tthis.flags &= ~GridElement.DEPTH_FLAG;\n\t\tif (value) this.flags |= GridElement.DEPTH_FLAG;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tRemoves the element from the container and returns itself.\n\t * \t!remove() : GridElement;\n\t */\n\tremove: function()\n\t{\n\t\tthis.remover.exec();\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSyncs the actual location of the specified element with its storage location (if alive and dirty).\n\t * \t!sync() : GridElement;\n\t */\n\tsync: function()\n\t{\n\t\tif (this.container === null || !this.getFlags(GridElement.ALIVE | GridElement.DIRTY))\n\t\t\treturn this;\n\n\t\tthis.container.sync(this);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the width and height of the element.\n\t * \t!resize (width: number, height: number) : GridElement;\n\t */\n\tresize: function (width, height)\n\t{\n\t\tthis.flags |= GridElement.DIRTY;\n\t\tthis.bounds.resize (width, height, true);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResizes the element by the specified deltas.\n\t * \t!resizeBy (deltaWidth: number, deltaHeight: number) : GridElement;\n\t */\n\tresizeBy: function (dWidth, dHeight)\n\t{\n\t\treturn this.resize(this.bounds.width() + dWidth, this.bounds.height() + dHeight);\n\t},\n\n\t/**\n\t * \tMoves the element by the specified deltas.\n\t * \t@param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * \t!translate (dx: number, dy: number, upscaled?: boolean) : GridElement;\n\t */\n\ttranslate: function (dx, dy, upscaled=false)\n\t{\n\t\tthis.flags |= GridElement.DIRTY;\n\t\tthis.bounds.translate (dx, dy, upscaled);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the position of the element.\n\t * \t!setPosition (x: number, y: number) : GridElement;\n\t */\n\t/**\n\t * \tSets the position of the element.\n\t * \t!setPosition (pointer: {x:number,y:number}) : GridElement;\n\t */\n\tsetPosition: function (x, y=null)\n\t{\n\t\tif (y === null) {\n\t\t\ty = x.y;\n\t\t\tx = x.x;\n\t\t}\n\n\t\treturn this.translate (upscale(x)-this.bounds.ux1, upscale(y)-this.bounds.uy1, true);\n\t}\n});\n\n/*\n**\tGrid element flags.\n*/\nGridElement.ALIVE \t\t\t\t= \t0x0001;\nGridElement.VISIBLE \t\t\t= \t0x0002;\nGridElement.DIRTY \t\t\t\t= \t0x0004;\nGridElement.DEPTH_FLAG_ENABLED\t= \t0x0008;\nGridElement.DEPTH_FLAG\t\t\t= \t0x0010;\n\nGridElement.USERDEF\t\t=\t0x0100; /* Bits 8 to 30 : 23 flags  */\nGridElement.LAST_FLAG\t=\t0x0080;\n\n/**\n * \tClass-level function to allocate a new flag.\n * \t!static allocFlag() : number;\n */\nGridElement.allocFlag = function()\n{\n\tlet flag = GridElement.LAST_FLAG;\n\tif (flag === 0x4000_0000) throw new Error ('allocFlag: out of bit space to allocate another flag');\n\n\tflag <<= 1;\n\tGridElement.LAST_FLAG = flag;\n\n\treturn flag;\n};\n\nexport default GridElement;\n","/*\n**\tflow/grid.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport GridElement from './grid-element.js';\nimport List from '../utils/list.js';\n\n//![import \"./grid-element\"]\n//![import \"../utils/list\"]\n\n//:/**\n//: * \tDescribes an optimized data structure to store 2D spatially indexed elements.\n//: */\n\n//!class Grid\n\nconst Grid = Class.extend\n({\n\t/**\n\t * \tName of the class (for inheritance purposes).\n\t */\n\tclassName: 'Grid',\n\n\t/**\n\t * \tActual grid of data, stored linearly. Contains several entries each of which can be either null or a List containing grid elements.\n\t */\n\tgrid: null,\n\n\t/**\n\t * \tNumber of elements active in the grid.\n\t * \t!readonly count: number;\n\t */\n\tcount: 0,\n\n\t/**\n\t * \tThe X and Y offsets to be added to all input coordinates. Used to ensure that a negative coordinate always ends up positive, calculated\n\t * \tusing the width and height of the grid.\n\t */\n\toffsx: 0, offsy: 0,\n\n\t/**\n\t * \tDivisors for the X and Y coordinates respectively. All input coordinates (after offseting) will be divided by these values to map them\n\t * \tto a grid entry (list) where the element can be added.\n\t */\n\tkx: 0, ky: 0,\n\n\t/**\n\t * \tStride to calculate an index with a Y-coordinate.\n\t */\n\tstride: 0,\n\n\t/**\n\t * \tIndicates if the grid should match regions with exact precision by comparing region to element bounds intersection.\n\t * \t!verifyIntersection: boolean;\n\t */\n\tverifyIntersection: true,\n\n\t/**\n\t * \tConstructs a grid with the specified maximum width and height. The final effective coordinate range will be -(width/2) to (width/2)for X,\n\t * \tand -(height/2) to (height/2) for Y.\n\t * \n\t * \tNote that the width, height and divisors kx and ky will be converted to their closest base-2 value. This is done to ensure shifts can be used\n\t * \tto quickly divide the input coordinates.\n\t * \n\t * \t!constructor (width: number, height: number, kx: number, ky?: number);\n\t */\n\t__ctor: function (width, height, kx, ky=null)\n\t{\n\t\twidth = 1 << Math.ceil(Math.log2(width));\n\t\theight = 1 << Math.ceil(Math.log2(height));\n\n\t\tthis.offsx = width >> 1;\n\t\tthis.offsy = height >> 1;\n\n\t\tkx = Math.floor(Math.log2(kx));\n\t\tif (ky === null) ky = kx;\n\n\t\tthis.kx = kx;\n\t\tthis.ky = ky;\n\n\t\tlet w = width >> kx;\n\t\tlet h = height >> ky;\n\n\t\tthis.grid = new Array(w*h).fill(null);\n\t\tthis.stride = w;\n\t},\n\n\t/**\n\t * \tDestroys all lists and elements in the grid.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis.grid = null;\n\t},\n\n\t/**\n\t * \tDestroys all lists and elements in the grid.\n\t * \t!clear() : void;\n\t */\n\tclear: function()\n\t{\n\t\tfor (let i = 0; i < this.grid.length; i++)\n\t\t{\n\t\t\tif (this.grid[i] === null)\n\t\t\t\tcontinue;\n\n\t\t\tlet j;\n\n\t\t\twhile ((j = this.grid[i].shift()) !== null)\n\t\t\t{\n\t\t\t\tj.remover.remove(this._remove, this);\n\t\t\t\tj.container = null;\n\n\t\t\t\tdispose(j);\n\t\t\t}\n\n\t\t\tthis.grid[i].free();\n\t\t\tthis.grid[i] = null;\n\t\t}\n\n\t\tthis.count = 0;\n\t},\n\n\t/**\n\t * \tDestroys all lists in the grid. Elements will not be destroyed.\n\t * \t!reset() : void;\n\t */\n\treset: function()\n\t{\n\t\tfor (let i = 0; i < this.grid.length; i++)\n\t\t{\n\t\t\tif (this.grid[i] === null)\n\t\t\t\tcontinue;\n\n\t\t\tlet j;\n\n\t\t\twhile ((j = this.grid[i].shift()) !== null)\n\t\t\t{\n\t\t\t\tj.remover.remove(this._remove, this);\n\t\t\t\tj.container = null;\n\t\t\t}\n\n\t\t\tthis.grid[i].free();\n\t\t\tthis.grid[i] = null;\n\t\t}\n\n\t\tthis.count = 0;\n\t},\n\n\t/**\n\t * \tAdds an element to the grid. Returns `true` if successful, or `false` if the element is outside of the grid bounds.\n\t * \t!add (elem: GridElement) : boolean;\n\t */\n\tadd: function (elem)\n\t{\n\t\tif (!GridElement.isInstance(elem))\n\t\t\tthrow new Error ('argument must be a GridElement');\n\n\t\tlet i = int((elem.bounds.y1+this.offsy) >> this.ky) * this.stride + int((elem.bounds.x1+this.offsx) >> this.kx);\n\t\tif (i < 0 || i >= this.grid.length) return false;\n\n\t\tif (this.grid[i] === null)\n\t\t\tthis.grid[i] = List.Pool.alloc();\n\n\t\tthis.grid[i].push(elem);\n\t\tthis.count++;\n\n\t\telem.container = this;\n\t\telem._grid_remove_node = elem.remover.add(this._remove, this, i, this.grid[i].bottom);\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tCallback to remove an element from the grid (called by Handler).\n\t */\n\t_remove: function (elem, self, index, node)\n\t{\n\t\tself.grid[index].remove(node);\n\t\tself.count--;\n\n\t\telem.container = null;\n\t\treturn false;\n\t},\n\n\t/**\n\t * \tRemoves the element from the grid and returns it.\n\t * \t!remove (elem: GridElement) : GridElement;\n\t */\n\tremove: function (elem)\n\t{\n\t\telem.remover.execc(this._grid_remove_node);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tUpdates the storage location of the specified element. Returns `true` if successful, or `false` if the element is outside of the grid bounds (in\n\t * \twhich case the element will be removed), or if the element does not belong to this grid.\n\t * \t!sync (elem: GridElement) : boolean;\n\t */\n\tsync: function (elem)\n\t{\n\t\telem.clearFlags(GridElement.DIRTY);\n\n\t\tlet node = elem._grid_remove_node;\n\n\t\tlet i = int((elem.bounds.y1+this.offsy) >> this.ky) * this.stride + int((elem.bounds.x1+this.offsx) >> this.kx);\n\t\tif (i < 0 || i >= this.grid.length)\n\t\t{\n\t\t\telem.remover.execc(node);\n\t\t\treturn false;\n\t\t}\n\n\t\tif (node.arg1 === i)\n\t\t\treturn true;\n\n\t\tthis.grid[node.arg1].remove(node.arg2);\n\n\t\tif (this.grid[i] === null)\n\t\t\tthis.grid[i] = List.Pool.alloc();\n\n\t\tthis.grid[i].push(elem);\n\n\t\tnode.arg1 = i;\n\t\tnode.arg2 = this.grid[i].bottom;\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tExecutes the specified callback function for each element that intersects the given bounds and has the specified flags set. The process is immediately\n\t * \tstopped if the callback returns `false`.\n\t * \t!forEachInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number, callback: (elem: GridElement, context?: object) => boolean, context?: object) : void;\n\t */\n\tforEachInRegion: function (bounds, flagsAndMask, flagsValue, callback, context)\n\t{\n\t\tlet j0 = ((bounds.y1+this.offsy) - (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet j1 = ((bounds.y2+this.offsy) + (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet i0 = ((bounds.x1+this.offsx) - (1<<this.kx-1) >> this.kx);\n\t\tlet i1 = ((bounds.x2+this.offsx) + (1<<this.kx-1) >> this.kx);\n\n\t\tlet n = this.grid.length-1;\n\n\t\tif (j0 < 0) j0 = 0; if (j1 < 0) j1 = 0;\n\t\tif (i0 < 0) i0 = 0; if (i1 < 0) i1 = 0;\n\t\tif (j0 > n) j0 = n; if (j1 > n) j1 = n;\n\t\tif (i0 > n) i0 = n; if (i1 > n) i1 = n;\n\n\t\tfor (let j = j0; j <= j1; j += this.stride)\n\t\t{\n\t\t\tfor (let i = i0; i <= i1; i++)\n\t\t\t{\n\t\t\t\tlet k = j + i;\n\t\t\t\tif (k > n || this.grid[k] === null) continue;\n\n\t\t\t\tfor (let e = this.grid[k].top; e; e = e.next)\n\t\t\t\t{\n\t\t\t\t\t// First check the element flags.\n\t\t\t\t\tif (!e.value.getFlags(flagsAndMask, flagsValue)) continue;\n\n\t\t\t\t\t// Verify exact intersection only on elements located on the edges of the indexed-based approximated rectangle.\n\t\t\t\t\tif (this.verifyIntersection && (j <= j0+1 || i <= i0+1 || j >= j1-1 || i >= i1-1) && !e.value.bounds.intersects(bounds))\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tif (callback(e.value, context) === false)\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * \tCollects all elements that intersect the given bounds and have the specified flags set. Returns a new List, remember to call `free` after using it.\n\t * \t!selectInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : List;\n\t */\n\tselectInRegion: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\tlet j0 = ((bounds.y1+this.offsy) - (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet j1 = ((bounds.y2+this.offsy) + (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet i0 = ((bounds.x1+this.offsx) - (1<<this.kx-1) >> this.kx);\n\t\tlet i1 = ((bounds.x2+this.offsx) + (1<<this.kx-1) >> this.kx);\n\n\t\tlet n = this.grid.length-1;\n\n\t\tif (j0 < 0) j0 = 0; if (j1 < 0) j1 = 0;\n\t\tif (i0 < 0) i0 = 0; if (i1 < 0) i1 = 0;\n\t\tif (j0 > n) j0 = n; if (j1 > n) j1 = n;\n\t\tif (i0 > n) i0 = n; if (i1 > n) i1 = n;\n\n\t\tlet list = List.Pool.alloc();\n\n\t\tfor (let j = j0; j <= j1; j += this.stride)\n\t\t{\n\t\t\tfor (let i = i0; i <= i1; i++)\n\t\t\t{\n\t\t\t\tlet k = j + i;\n\t\t\t\tif (k > n || this.grid[k] === null) continue;\n\n\t\t\t\tfor (let e = this.grid[k].top; e; e = e.next)\n\t\t\t\t{\n\t\t\t\t\t// First check the element flags.\n\t\t\t\t\tif (!e.value.getFlags(flagsAndMask, flagsValue)) continue;\n\n\t\t\t\t\t// Verify exact intersection only on elements located on the edges of the indexed-based approximated rectangle.\n\t\t\t\t\tif (this.verifyIntersection && (j <= j0+1 || i <= i0+1 || j >= j1-1 || i >= i1-1) && !e.value.bounds.intersects(bounds))\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tlist.push(e.value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn list;\n\t},\n\n\t/**\n\t * \tCounts all elements that intersect the given bounds and have the specified flags set.\n\t * \t!countInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : number;\n\t */\n\tcountInRegion: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\tlet j0 = ((bounds.y1+this.offsy) - (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet j1 = ((bounds.y2+this.offsy) + (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet i0 = ((bounds.x1+this.offsx) - (1<<this.kx-1) >> this.kx);\n\t\tlet i1 = ((bounds.x2+this.offsx) + (1<<this.kx-1) >> this.kx);\n\n\t\tlet n = this.grid.length-1;\n\n\t\tif (j0 < 0) j0 = 0; if (j1 < 0) j1 = 0;\n\t\tif (i0 < 0) i0 = 0; if (i1 < 0) i1 = 0;\n\t\tif (j0 > n) j0 = n; if (j1 > n) j1 = n;\n\t\tif (i0 > n) i0 = n; if (i1 > n) i1 = n;\n\n\t\tlet m = 0;\n\n\t\tfor (let j = j0; j <= j1; j += this.stride)\n\t\t{\n\t\t\tfor (let i = i0; i <= i1; i++)\n\t\t\t{\n\t\t\t\tlet k = j + i;\n\t\t\t\tif (k > n || this.grid[k] === null) continue;\n\n\t\t\t\tfor (let e = this.grid[k].top; e; e = e.next)\n\t\t\t\t{\n\t\t\t\t\t// First check the element flags.\n\t\t\t\t\tif (!e.value.getFlags(flagsAndMask, flagsValue)) continue;\n\n\t\t\t\t\t// Verify exact intersection only on elements located on the edges of the indexed-based approximated rectangle.\n\t\t\t\t\tif (this.verifyIntersection && (j <= j0+1 || i <= i0+1 || j >= j1-1 || i >= i1-1) && !e.value.bounds.intersects(bounds))\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tm++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn m;\n\t},\n\n\t/**\n\t * \tReturns the first element that intersect the given bounds and have the specified flags set.\n\t * \t!selectFirst (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : GridElement;\n\t */\n\tselectFirst: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\tlet j0 = ((bounds.y1+this.offsy) - (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet j1 = ((bounds.y2+this.offsy) + (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet i0 = ((bounds.x1+this.offsx) - (1<<this.kx-1) >> this.kx);\n\t\tlet i1 = ((bounds.x2+this.offsx) + (1<<this.kx-1) >> this.kx);\n\n\t\tlet n = this.grid.length-1;\n\n\t\tif (j0 < 0) j0 = 0; if (j1 < 0) j1 = 0;\n\t\tif (i0 < 0) i0 = 0; if (i1 < 0) i1 = 0;\n\t\tif (j0 > n) j0 = n; if (j1 > n) j1 = n;\n\t\tif (i0 > n) i0 = n; if (i1 > n) i1 = n;\n\n\t\tfor (let j = j0; j <= j1; j += this.stride)\n\t\t{\n\t\t\tfor (let i = i0; i <= i1; i++)\n\t\t\t{\n\t\t\t\tlet k = j + i;\n\t\t\t\tif (k > n || this.grid[k] === null) continue;\n\n\t\t\t\tfor (let e = this.grid[k].top; e; e = e.next)\n\t\t\t\t{\n\t\t\t\t\t// First check the element flags.\n\t\t\t\t\tif (!e.value.getFlags(flagsAndMask, flagsValue)) continue;\n\n\t\t\t\t\t// Verify exact intersection only on elements located on the edges of the indexed-based approximated rectangle.\n\t\t\t\t\tif (this.verifyIntersection && (j <= j0+1 || i <= i0+1 || j >= j1-1 || i >= i1-1) && !e.value.bounds.intersects(bounds))\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\treturn e.value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n});\n\nexport default Grid;\n","/*\n**\tflow/container.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\n\n//:/**\n//: * \tA container is responsible to store elements for their subsequent rendering. The actual storage mechanism used can vary and must be implemented by derived\n//: * \tclasses (see `GridContainer` and `SimpleContainer`).\n//: */\n\n//!class Container\n\nconst Container = Class.extend\n({\n\tclassName: 'Container',\n\n\t/**\n\t * \tViewport bounds currently active. Set by the Scene class before calling `draw`.\n\t * \t!viewportBounds: Bounds2;\n\t */\n\tviewportBounds: null,\n\n\t/**\n\t * \tWidth of the container.\n\t * \t!width: number;\n\t */\n\twidth: 0,\n\n\t/**\n\t * \tHeight of the container.\n\t * \t!height: number;\n\t */\n\theight: 0,\n\n\t/**\n\t * \tDepth (z-value) of the container, calculated by the scene.\n\t * \t!zvalue: number;\n\t */\n\tzvalue: 0,\n\n\t/**\n\t * \tScene object to which this container belongs.\n\t * \t!scene: Scene;\n\t */\n\tscene: null,\n\n\t/**\n\t * \tFlags of the object (see constants at the bottom of this file).\n\t * \t!flags: number;\n\t */\n\tflags: 0,\n\n\t/**\n\t * \tCurrently active display buffer for rendering operations (used by drawElement).\n\t * \t!g: Canvas;\n\t */\n\tg: null,\n\n\t/**\n\t * \tTotal number of elements in the container.\n\t * \t!readonly elementCount: number;\n\t */\n\telementCount: 0,\n\n\t/**\n\t * \tTotal number of elements drawn on the last draw operation.\n\t * \t!readonly drawCount: number;\n\t */\n\tdrawCount: 0,\n\n\t/**\n\t * \tConstructs the container with the default size (32768 x 32768).\n\t * \tconstructor ();\n\t */\n\t/**\n\t * \tConstructs the container with the specified size.\n\t * \t!constructor (width: number, height: number);\n\t */\n\t__ctor: function (width=32768, height=32768)\n\t{\n\t\tthis.width = width;\n\t\tthis.height = height;\n\n\t\tthis.flags = Container.VISIBLE | Container.DEPTH_FLAG;\n\t},\n\n\t/**\n\t * \tDestroys the container.\n\t */\n\t__dtor: function()\n\t{\n\t},\n\n\t/**\n\t * \tReturns the value of the `visible` flag.\n\t * \t!visible() : boolean;\n\t */\n\t/**\n\t * \tSets the value of the `visible` flag.\n\t * \t!visible(value: boolean) : Container;\n\t */\n\tvisible: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Container.VISIBLE);\n\n\t\tthis.flags &= ~Container.VISIBLE;\n\t\tif (value) this.flags |= Container.VISIBLE;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the value of the `depthFlag` flag.\n\t * \t!depthFlag() : boolean;\n\t */\n\t/**\n\t * \tSets the value of the `depthFlag` flag.\n\t * \t!depthFlag(value: boolean) : Container;\n\t */\n\tdepthFlag: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Container.DEPTH_FLAG);\n\n\t\tthis.flags &= ~Container.DEPTH_FLAG;\n\t\tif (value) this.flags |= Container.DEPTH_FLAG;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the active viewport bounds.\n\t * \t!setViewportBounds (bounds: Bounds2) : Container;\n\t */\n\tsetViewportBounds: function (bounds)\n\t{\n\t\tthis.viewportBounds = bounds;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tDraws the specified element.\n\t * \t!drawElement (elem: Element, self: Container) : boolean;\n\t */\n\tdrawElement: function (elem, self)\n\t{\n\t\tself.drawCount++;\n\t\treturn elem.draw(self.g);\n\t},\n\n\t/**\n\t * \tUpdates the Z-value of the specified element. Should be called after adding an element and after/before every sync.\n\t * \t!syncZ (elem: Element) : void;\n\t */\n\tsyncZ: function (elem)\n\t{\n\t\telem.__zvalue = this.zvalue + ((elem._zvalue + elem.bounds.y2) & ((1 << 18) - 1));\n\t\t//elem.__zvalue = this.zvalue + (1 << 18) - ((elem._zvalue + elem.bounds.y2 + (1 << 18)) & ((1 << 18) - 1));\n\t},\n\n\t/**\n\t * \tSyncs the actual location of the specified element with its storage location. Returns true if successful.\n\t * \t!sync (elem: Element) : boolean;\n\t */\n\tsync: function (elem)\n\t{\n\t\tthrow new Error ('Container::sync not implemented');\n\t},\n\n\t/**\n\t * \tClears the container to empty. All contained elements will be destroyed.\n\t * \t!clear() : void;\n\t */\n\tclear: function() /* @override */\n\t{\n\t\tthrow new Error ('Container::clear not implemented');\n\t},\n\n\t/**\n\t * \tResets the container to empty. Contained elements are not destroyed. Use `clear` if that is your intention.\n\t * \t!reset() : void;\n\t */\n\treset: function() /* @override */\n\t{\n\t\tthrow new Error ('Container::reset not implemented');\n\t},\n\n\t/**\n\t * \tAdds an element to the container. Returns boolean indicating if successful.\n\t * \t!add (elem: Element) : boolean;\n\t */\n\tadd: function (elem) /* @override */\n\t{\n\t\tthrow new Error ('Container::add not implemented');\n\t},\n\n\t/**\n\t * \tRemoves an element from the container and returns it.\n\t * \t!remove (elem: Element) : Element;\n\t */\n\tremove: function (elem) /* @override */\n\t{\n\t\tthrow new Error ('Container::remove not implemented');\n\t},\n\n\t/**\n\t * \tPrepares the canvas with depth flag configuration and Z-value to draw the contained elements.\n\t * \t!draw (g: Canvas) : void;\n\t */\n\tdraw: function(g)\n\t{\n\t\tif (!this.visible()) return;\n\n\t\tlet depthFlagChanged = g.pushDepthFlag(this.flags & Container.DEPTH_FLAG);\n\n\t\tg.zvalue = this.zvalue;\n\n\t\tthis.drawCount = -1;\n\t\tthis.g = g;\n\n\t\tthis.render();\n\n\t\tif (depthFlagChanged) g.popDepthFlag();\n\t},\n\n\t/**\n\t * \tActually draws the contained elements.\n\t * \t!render() : void;\n\t */\n\trender: function()\n\t{\n\t\tthrow new Error ('Container::render not implemented');\n\t}\n});\n\n\n/*\n**\tConstants.\n*/\nContainer.VISIBLE = 0x001;\nContainer.DEPTH_FLAG = 0x002;\n\nexport default Container;\n","/*\n**\tflow/viewport.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Bounds2 from '../math/bounds2.js';\nimport Point2 from '../math/point2.js';\n\n//![import \"../math/point2\"]\n//![import \"../math/bounds2\"]\n//![import \"../math/rect\"]\n//![import \"../system/canvas\"]\n\n//:/**\n//: * \tViewport class controls the current visible rectangle of a container.\n//: */\n\n//!class Viewport\n\nconst Viewport = Class.extend\n({\n\tclassName: 'Viewport',\n\n\t/**\n\t * \tDimensions of the viewport.\n\t *\n\t * \t!readonly width: number;\n\t * \t!readonly height: number;\n\t */\n\twidth: 0, initialWidth: 0,\n\theight: 0, initialHeight: 0,\n\n\t/**\n\t * \tPosition of the top-left corner of the viewport in screen space.\n\t */\n\tsx: 0,\n\tsy: 0,\n\n\t/**\n\t * \tPosition of the center of the viewport in the container.\n\t */\n\tx: 0,\n\ty: 0,\n\n\t/**\n\t * \tRatio for the viewport's center (value from -1 to 1), used when focusing to use a different focus point instead of the exact center.\n\t */\n\tcenterRatioX: 0,\n\tcenterRatioY: 0,\n\n\t/**\n\t * \tPosition offset, used to move the viewport around without affecting the focus point.\n\t */\n\toffset: null,\n\n\t/**\n\t * \tBoundaries of the container, set by `setContainerBounds`.\n\t *\n\t * \t!readonly container: Bounds2;\n\t */\n\tcontainer: null,\n\n\t/**\n\t * \tThe focus factor determines the ratio of a smaller viewport on which the current focus point must  be contained. If the focus point is not inside the\n\t * \tsmaller viewport scrolling will be performed.\n\t */\n\tfocusFactorX: 0,\n\tfocusFactorY: 0,\n\n\t/**\n\t * \tFocus target rectangle and its offsets. When the viewport is updated it will automatically focus on this rect.\n\t */\n\tfocusRect: null,\n\tfocusOffsX: 0,\n\tfocusOffsY: 0,\n\n\t/**\n\t * \tEnabled focus axes. Used by the `update` method to figure which axis to update.\n\t */\n\tfocusAxisX: true,\n\tfocusAxisY: true,\n\n\t/**\n\t * \tFlags of the viewport.\n\t */\n\tflags: 0,\n\n\t/**\n\t * \tViewport scale.\n\t */\n\tscale: 1,\n\n\t/**\n\t * \tGlobal scale, used to scale the entire canvas including the viewport. Useful for debugging viewport bounds.\n\t */\n\tglobalScale: 1,\n\n\t/**\n\t * \tBounds of the viewport in world space. Used to determine which elements lie inside the viewport.\n\t *\n\t * \t!readonly bounds: Bounds2;\n\t */\n\tbounds: null,\n\n\t/**\n\t * \tExtra padding for the viewport bounds. Used to extend the viewport bounds without altering the original viewport size nor the world bounds.\n\t */\n\tpadding: null,\n\n\t/**\n\t * \tBounds of the focus area of the viewport in world space. When the `focusRect` moves outside this area the viewport will be panned to keep it inside these bounds.\n\t * \n\t * \t!readonly focusBounds: Bounds2;\n\t */\n\tfocusBounds: null,\n\n\t/**\n\t * \tBounds of the viewport in screen space, used as target rendering area.\n\t *\n\t *\t!readonly screenBounds: Bounds2;\n\t */\n\tscreenBounds: null,\n\n\t/**\n\t * \tTemporal Point2 object used as temporary result for `toWorldSpace` and `toScreenSpace`.\n\t */\n\ttmpPoint: null,\n\n\t/**\n\t * \tConstructs the viewport with the specified size and container dimensions.\n\t *\n\t * \t@param sx - Screen position X.\n\t * \t@param sy - Screen position Y.\n\t * \t@param width - Viewport width.\n\t * \t@param height - Viewport height.\n\t * \t@param containerWidth - Container width.\n\t * \t@param containerHeight - Container height.\n\t *\n\t * \t!constructor (sx: number, sy: number, width: number, height: number, containerWidth: number, containerHeight: number);\n\t */\n\t__ctor: function (sx, sy, width, height, containerWidth, containerHeight)\n\t{\n\t\tthis.focusFactorX = 0.4;\n\t\tthis.focusFactorY = 0.4;\n\t\tthis.focusRect = null;\n\n\t\tthis.sx = sx;\n\t\tthis.sy = sy;\n\t\tthis.width = this.initialWidth = width;\n\t\tthis.height = this.initialHeight = height;\n\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\n\t\tthis.bounds = Bounds2.Pool.alloc();\n\t\tthis.padding = null;\n\n\t\tthis.focusBounds = Bounds2.Pool.alloc();\n\t\tthis.screenBounds = Bounds2.Pool.alloc();\n\t\tthis.container = Bounds2.Pool.alloc();\n\t\tthis.offset = Point2.Pool.alloc();\n\n\t\tthis.flags = Viewport.ENABLED;\n\t\tthis.tmpPoint = Point2.Pool.alloc();\n\n\t\tthis.setContainerBounds(-containerWidth>>1, -containerHeight>>1, containerWidth>>1, containerHeight>>1);\n\n\t\tthis.updateScreenBounds();\n\t\tthis.updateBounds();\n\t},\n\n\t/**\n\t * \tDestructs the viewport.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis.bounds.free();\n\t\tthis.focusBounds.free();\n\t\tthis.screenBounds.free();\n\t\tthis.container.free();\n\t\tthis.tmpPoint.free();\n\n\t\tif (this.padding !== null)\n\t\t\tthis.padding.free();\n\t},\n\n\t/**\n\t * \tReturns the value of the `enabled` flag.\n\t *\n\t * \t!enabled() : boolean;\n\t */\n\t/**\n\t * \tSets the `enabled` flag.\n\t *\n\t * \t!enabled (value: boolean) : Viewport;\n\t */\n\tenabled: function(value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Viewport.ENABLED);\n\n\t\tthis.flags &= ~Viewport.ENABLED;\n\t\tif (value) this.flags |= Viewport.ENABLED;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the container bounds. Used to ensure the viewport bounds are never outside these limits.\n\t *\n\t * \t!setContainerBounds (x1: number, y1: number, x2: number, y2: number) : Viewport;\n\t */\n\tsetContainerBounds: function (x1, y1, x2, y2)\n\t{\n\t\tthis.width = this.initialWidth;\n\t\tthis.height = this.initialHeight;\n\n\t\tif (this.width > x2-x1) this.width = x2-x1;\n\t\tif (this.height > y2-y1) this.height = y2-y1;\n\n\t\tthis.container.set(x1, y1, x2, y2);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the viewport padding.\n\t *\n\t * \t!setPadding (value: number) : Viewport;\n\t */\n\t/**\n\t * \tSets the padding of each side of the viewport (left, top, right and bottom).\n\t *\n\t * \t!setPadding (x1: number, y1: number, x2: number, y2: number) : Viewport;\n\t */\n\tsetPadding: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (this.padding === null)\n\t\t\tthis.padding = Bounds2.Pool.alloc();\n\n\t\tif (y1 === null)\n\t\t{\n\t\t\tx2 = y2 = x1;\n\t\t\tx1 = y1 = -x1;\n\t\t}\n\n\t\tthis.padding.set(x1, y1, x2, y2);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tUpdates the bound rect of the viewport.\n\t */\n\tupdateBounds: function (truncateToContainer=false)\n\t{\n\t\tlet w = this.width >> 1;\n\t\tlet h = this.height >> 1;\n\n\t\tlet ws = (w/this.scale);\n\t\tlet hs = (h/this.scale);\n\n\t\tlet x1 = this.x-ws+this.offset.x;\n\t\tlet y1 = this.y-hs+this.offset.y;\n\t\tlet x2 = this.x+ws+this.offset.x;\n\t\tlet y2 = this.y+hs+this.offset.y;\n\n\t\tif (truncateToContainer)\n\t\t{\n\t\t\tif (x1 < this.container.x1)\n\t\t\t\tthis.offset.setX(this.container.x1 - this.x + ws);\n\t\t\telse if (x2 > this.container.x2)\n\t\t\t\tthis.offset.setX(this.container.x2 - this.x - ws);\n\n\t\t\tif (y1 < this.container.y1)\n\t\t\t\tthis.offset.setY(this.container.y1 - this.y + hs);\n\t\t\telse if (y2 > this.container.y2)\n\t\t\t\tthis.offset.setY(this.container.y2 - this.y - hs);\n\n\t\t\tx1 = this.x-ws+this.offset.x;\n\t\t\ty1 = this.y-hs+this.offset.y;\n\t\t\tx2 = this.x+ws+this.offset.x;\n\t\t\ty2 = this.y+hs+this.offset.y;\n\t\t}\n\n\t\tthis.bounds.set (x1, y1, x2, y2);\n\n\t\tif (this.padding !== null)\n\t\t\tthis.bounds.add (this.padding);\n\n\t\tthis.focusBounds.set (\n\t\t\tthis.x - (this.focusFactorX*w + this.centerRatioX*w)/this.scale, this.y - (this.focusFactorY*h + this.centerRatioY*h)/this.scale,\n\t\t\tthis.x + (this.focusFactorX*w + this.centerRatioX*w)/this.scale, this.y + (this.focusFactorY*h + this.centerRatioY*h)/this.scale\n\t\t);\n\t},\n\n\t/**\n\t * \tUpdates the screen bound rect of the viewport.\n\t */\n\tupdateScreenBounds: function ()\n\t{\n\t\tthis.screenBounds.set (this.sx, this.sy, this.sx + this.width, this.sy + this.height);\n\t},\n\n\t/**\n\t * \tResizes the viewport to the specified size.\n\t *\n\t * \t!resize (width: number, height: number) : Viewport;\n\t */\n\tresize: function (width, height)\n\t{\n\t\tthis.width = this.initialWidth = width;\n\t\tthis.height = this.initialHeight = height;\n\n\t\tthis.updateScreenBounds();\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResizes the viewport by the specified deltas.\n\t *\n\t * \t!resizeBy (dWidth: number, dHeight: number) : Viewport;\n\t */\n\tresizeBy: function (dWidth, dHeight)\n\t{\n\t\tthis.width += dWidth;\n\t\tthis.height += dHeight;\n\n\t\tthis.initialWidth = this.width;\n\t\tthis.initialHeight = this.height;\n\n\t\tthis.updateScreenBounds();\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the position of the viewport's center within the world and resets the relative offset to zero.\n\t * \n\t *\t!setPosition (x: number, y: number) : Viewport;\n\t */\n\tsetPosition: function (x, y)\n\t{\n\t\tthis.x = x;\n\t\tthis.y = y;\n\n\t\tthis.offset.set(0, 0);\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the position of the viewport relative to the current focus point.\n\t * \n\t * \t!setOffsets (dx: number, dy: number) : Viewport;\n\t */\n\tsetOffsets: function (dx, dy)\n\t{\n\t\tthis.offset.set(dx, dy);\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the scale of the viewport.\n\t * \n\t * \t!setScale (value: number) : Viewport;\n\t */\n\tsetScale: function (value)\n\t{\n\t\tthis.scale = value;\n\n\t\tthis.updateScreenBounds();\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the global scale of the viewport.\n\t * \n\t * \t!setGlobalScale (value: number) : Viewport;\n\t */\n\tsetGlobalScale: function (value)\n\t{\n\t\tthis.globalScale = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the center ratio of the viewport (values from -1 to 1, default is 0). Used to focus on a different point instead of the exact center.\n\t * \n\t * \t!setCenter (rx: number, ry: number) : Viewport;\n\t */\n\tsetCenter: function (rx, ry)\n\t{\n\t\tthis.centerRatioX = rx;\n\t\tthis.centerRatioY = ry;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMoves the viewport within the world. Values are relative to the current focus point.\n\t *\t@param truncateToContainer - When `true` the final viewport bounds will be ensured to not lie outside the container bounds.\n\t *\n\t * \t!translate (dx: number, dy: number, truncateToContainer?: boolean) : Viewport;\n\t */\n\ttranslate: function (dx, dy, truncateToContainer=false)\n\t{\n\t\tthis.offset.add(dx, dy);\n\n\t\tthis.updateBounds(truncateToContainer);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the screen position of the viewport.\n\t * \n\t * \t!setScreenPosition (sx: number, sy: number) : number;\n\t */\n\tsetScreenPosition: function (sx, sy)\n\t{\n\t\tthis.sx = sx;\n\t\tthis.sy = sy;\n\n\t\tthis.updateScreenBounds();\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the X coordinate of the viewport's focus point inside the world.\n\t * \t@param absolute - When `true`, the focus point X (without offset) will be returned.\n\t * \t\n\t * \t!getX (absolute?: boolean) : number;\n\t */\n\tgetX: function (absolute=false)\n\t{\n\t\treturn this.x + (absolute ? 0 : this.offset.x);\n\t},\n\n\t/**\n\t * \tReturns the Y coordinate of the viewport's focus point inside the world.\n\t * \t@param absolute - When `true`, the focus point Y (without offset) will be returned.\n\t * \t\n\t * \t!getY (absolute?: boolean) : number;\n\t */\n\tgetY: function (absolute=false)\n\t{\n\t\treturn this.y + (absolute ? 0 : this.offset.y);\n\t},\n\n\t/**\n\t * \tReturns the X position of the viewport inside the world relative to the current focus point.\n\t * \n\t * \t!getOffsetX() : void;\n\t */\n\tgetOffsetX: function ()\n\t{\n\t\treturn this.offset.x;\n\t},\n\n\t/**\n\t * \tReturns the Y position of the viewport inside the world relative to the current focus point.\n\t * \n\t * \t!getOffsetY() : void;\n\t */\n\tgetOffsetY: function ()\n\t{\n\t\treturn this.offset.y;\n\t},\n\n\t/**\n\t * \tReturns the width of the viewport.\n\t * \n\t * \t!getWidth() : number;\n\t */\n\tgetWidth: function ()\n\t{\n\t\treturn this.width;\n\t},\n\n\t/**\n\t * \tReturns the height of the viewport.\n\t * \n\t * \t!getHeight() : number;\n\t */\n\tgetHeight: function ()\n\t{\n\t\treturn this.height;\n\t},\n\n\t/**\n\t * \tMoves the viewport X coordinate to focus on the specified line or coordinate. Method `updateBounds` should be called afterwards.\n\t * \n\t * \t!focusX (x0: number, x1?: number, factor?: number) : Viewport;\n\t */\n\tfocusX: function (i0, i1=null, kx=null)\n\t{\n\t\tif (kx === null) kx = this.focusFactorX;\n\t\tif (i1 === null) i1 = i0;\n\n\t\tlet w = this.width >> 1;\n\n\t\tlet x1 = this.x - int((kx*w + this.centerRatioX*w)/this.scale);\n\t\tlet x2 = this.x + int((kx*w + this.centerRatioX*w)/this.scale);\n\n\t\tif (x1 == x2)\n\t\t\ti0 = i1 = (i0 + i1) >> 1;\n\n\t\tlet nx = this.x;\n\n\t\tif (i0 < x1) nx += (i0 - x1);\n\t\telse if (i1 > x2) nx += (i1 - x2);\n\n\t\tx1 = nx - w;\n\t\tx2 = nx + w;\n\n\t\tif (x1 < this.container.x1) nx = this.container.x1 + w;\n\t\tif (x2 > this.container.x2) nx = this.container.x2 - w;\n\n\t\tthis.x = nx;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMoves the viewport Y coordinate to focus on the specified line or coordinate. Method `updateBounds` should be called afterwards.\n\t * \n\t * \t!focusY (y0: number, y1?: number, factor?: number) : Viewport;\n\t */\n\tfocusY: function (j0, j1=null, ky=null)\n\t{\n\t\tif (ky === null) ky = this.focusFactorY;\n\t\tif (j1 === null) j1 = j0;\n\n\t\tlet h = this.height >> 1;\n\n\t\tlet y1 = this.y - int((ky*h + this.centerRatioY*h)/this.scale);\n\t\tlet y2 = this.y + int((ky*h + this.centerRatioY*h)/this.scale);\n\n\t\tif (y1 == y2)\n\t\t\tj0 = j1 = (j0 + j1) >> 1;\n\n\t\tlet ny = this.y;\n\n\t\tif (j0 < y1) ny += (j0 - y1);\n\t\telse if (j1 > y2) ny += (j1 - y2);\n\n\t\ty1 = ny - h;\n\t\ty2 = ny + h;\n\n\t\tif (y1 < this.container.y1) ny = this.container.y1 + h;\n\t\tif (y2 > this.container.y2) ny = this.container.y2 - h;\n\n\t\tthis.y = ny;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tUpdates the viewport to focus on the focusRect. Takes into account enabled axes.\n\t *\n\t * \t!update (dt?: number) : void;\n\t */\n\tupdate: function (dt=0)\n\t{\n\t\tif (this.focusRect === null)\n\t\t\treturn;\n\n\t\tif (this.focusAxisX)\n\t\t\tthis.focusX (this.focusRect.x1 + this.focusOffsX, this.focusRect.x2 + this.focusOffsX);\n\n\t\tif (this.focusAxisY)\n\t\t\tthis.focusY (this.focusRect.y1 + this.focusOffsY, this.focusRect.y2 + this.focusOffsY);\n\n\t\tthis.updateBounds();\n\t},\n\n\t/**\n\t * \tUpdates the viewport to focus on the focusRect ignoring the enabled axes.\n\t *\n\t * \t!updateForced (dt?: number) : void;\n\t */\n\tupdateForced: function (dt=0)\n\t{\n\t\tif (this.focusRect === null)\n\t\t\treturn;\n\n\t\tthis.focusX (this.focusRect.x1 + this.focusOffsX, this.focusRect.x2 + this.focusOffsX);\n\t\tthis.focusY (this.focusRect.y1 + this.focusOffsY, this.focusRect.y2 + this.focusOffsY);\n\n\t\tthis.updateBounds();\n\t},\n\n\t/**\n\t * \tTracks a specified rectangle by maintaining focus on it (a call to `update` must be made on every frame update).\n\t * \n\t * \t!setFocusRect (rect: Rect|Bounds2, offsX?: number, offsY? :number) : Viewport;\n\t */\n\tsetFocusRect: function (rect, offsX=0, offsY=0)\n\t{\n\t\tthis.focusRect = rect;\n\n\t\tthis.focusOffsX = offsX;\n\t\tthis.focusOffsY = offsY;\n\n\t\tthis.update(0);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the focus offsets of the viewport. Used to translate the viewport without altering the focus point.\n\t *\n\t * \t!setFocusOffsets (offsX: number, offsY: number) : Viewport;\n\t */\n\tsetFocusOffsets: function (offsX, offsY)\n\t{\n\t\tthis.focusOffsX = offsX;\n\t\tthis.focusOffsY = offsY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the enabled flag of the focus axes. Only enabled axes will be updated when calling `update`.\n\t * \n\t * \t!setFocusAxes (enabledX: boolean, enabledY: boolean) : Viewport;\n\t */\n\tsetFocusAxes: function (enabledX, enabledY)\n\t{\n\t\tthis.focusAxisX = enabledX;\n\t\tthis.focusAxisY = enabledY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the focus factor of the viewport (value from 0 to 1), that is, the ratio of the smaller focus viewport.\n\t * \n\t * \t!setFocusFactor (valueX: number, valueY: number) : Viewport;\n\t */\n\tsetFocusFactor: function (valueX, valueY)\n\t{\n\t\tthis.focusFactorX = valueX;\n\t\tthis.focusFactorY = valueY === undefined ? valueX : valueY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tApplies the viewport clipping area to the specified canvas.\n\t * \n\t * \t!applyClip (g: Canvas) : void;\n\t */\n\tapplyClip: function (g)\n\t{\n\t\tg.clip(this.screenBounds.x1, this.screenBounds.y1, this.screenBounds.width(), this.screenBounds.height());\n\t},\n\n\t/**\n\t * \tApplies the viewport transform to the specified canvas.\n\t * \n\t * \t!applyTransform (g: Canvas) : void;\n\t */\n\tapplyTransform: function (g)\n\t{\n\t\tlet cx = this.screenBounds.x1 + (this.screenBounds.width() >> 1);\n\t\tlet cy = this.screenBounds.y1 + (this.screenBounds.height() >> 1);\n\n\t\tg.translate (cx, cy);\n\n\t\tif (this.scale != 1.0)\n\t\t\tg.scale (this.scale, this.scale);\n\n\t\tif (this.globalScale != 1.0)\n\t\t\tg.scale (this.globalScale, this.globalScale);\n\n\t\tg.translate (-this.getX(), -this.getY());\n\t\tg.updateTransform();\n\t},\n\n\t/**\n\t * \tConverts a point from screen-space to world-space.\n\t * \t@returns Temporal Point2 object.\n\t *\n\t * \t!toWorldSpace (input: Point2|Vec2|{x:number,y:number}, floor?: boolean) : Point2;\n\t */\n\t/**\n\t * \tConverts a point from screen-space to world-space.\n\t * \t@returns Temporal Point2 object.\n\t *\n\t * \t!toWorldSpace (x: number, y: number, floor?: boolean) : Point2;\n\t */\n\ttoWorldSpace: function (x, y=null, floor=false)\n\t{\n\t\tif (y === null || y === true)\n\t\t{\n\t\t\tfloor = y === true;\n\t\t\ty = x.y;\n\t\t\tx = x.x;\n\t\t}\n\n\t\tlet cx = this.screenBounds.x1 + (this.screenBounds.width() >> 1);\n\t\tlet cy = this.screenBounds.y1 + (this.screenBounds.height() >> 1);\n\n\t\tif (floor) {\n\t\t\tx = ((x - int(cx)) / this.scale) + int(this.getX());\n\t\t\ty = ((y - int(cy)) / this.scale) + int(this.getY());\n\t\t}\n\t\telse {\n\t\t\tx = ((x - cx) / this.scale) + this.getX();\n\t\t\ty = ((y - cy) / this.scale) + this.getY();\n\t\t}\n\n\t\treturn this.tmpPoint.set(x, y);\n\t},\n\n\t/**\n\t * \tConverts a point from world-space to screen-space.\n\t * \t@returns Temporal Point2 object.\n\t *\n\t * \t!toScreenSpace (input: Point2|Vec2|{x:number,y:number}, floor?: boolean) : Point2;\n\t */\n\t/**\n\t * \tConverts a point from world-space to screen-space.\n\t * \t@returns Temporal Point2 object.\n\t *\n\t * \t!toScreenSpace (x: number, y: number, floor?: boolean) : Point2;\n\t */\n\ttoScreenSpace: function (x, y=null, floor=false)\n\t{\n\t\tif (y === null || y === true)\n\t\t{\n\t\t\tfloor = y === true;\n\t\t\ty = x.y;\n\t\t\tx = x.x;\n\t\t}\n\n\t\tlet cx = this.screenBounds.x1 + (this.screenBounds.width() >> 1);\n\t\tlet cy = this.screenBounds.y1 + (this.screenBounds.height() >> 1);\n\n\t\tif (floor) {\n\t\t\tx = (x - int(this.getX())) * this.scale + int(cx);\n\t\t\ty = (y - int(this.getY())) * this.scale + int(cy);\n\t\t}\n\t\telse {\n\t\t\tx = (x - this.getX()) * this.scale + cx;\n\t\t\ty = (y - this.getY()) * this.scale + cy;\n\t\t}\n\n\t\treturn this.tmpPoint.set(x, y);\n\t}\n});\n\n/*\n**\tConstants.\n*/\nViewport.ENABLED = 0x001;\n\nexport default Viewport;\n","/*\n**\tflow/element.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport GridElement from './grid-element.js';\nimport G from '../system/globals.js';\nimport Recycler from '../utils/recycler.js';\nimport System from '../system/system.js';\n\n//![import \"./grid-element\"]\n//![import \"../system/globals\"]\n//![import \"../utils/recycler\"]\n//![import \"./idrawable\"]\n\n//:/**\n//: * \tDescribes an element that can be rendered to the screen.\n//: */\n\n//!class Element extends GridElement\n\nconst Element = GridElement.extend\n({\n\tclassName: 'Element',\n\n\t/**\n\t * \tParent group to whom this element is related.\n\t * \t!group: Group;\n\t */\n\tgroup: null,\n\n\t/**\n\t * \tDrawable object to render to the display.\n\t * \t!img: IDrawable;\n\t */\n\timg: null,\n\n\t/**\n\t * \tIndicates if the bounds of the element should be drawn (for debugging purposes).\n\t * \t!debugBounds: boolean;\n\t */\n\tdebugBounds: false,\n\n\t/**\n\t * \tBasic depth (z-value) of the element (used for depth micro-adjustments).\n\t */\n\t_zvalue: 0,\n\n\t/**\n\t * \tActual depth (z-value) of the element, calculated by the container.\n\t */\n\t__zvalue: 0,\n\n\t/**\n\t * \tAlpha value of the element.\n\t */\n\t_alpha: 1.0,\n\n\t/**\n\t * \tElement shader program.\n\t */\n\t_shaderProgram: null,\n\n\t/**\n\t * \tFunction used to set the uniforms of the shader.\n\t */\n\t_uniformSetter: null,\n\n\t/**\n\t * \tConstructs a drawable element at the specified position with the given drawable.\n\t * \t!constructor (x: number, y: number, width: number, height: number, img?: IDrawable);\n\t */\n\t/**\n\t * \tConstructs a drawable element at the specified position with the given drawable.\n\t * \t!constructor (x: number, y: number, img?: IDrawable);\n\t */\n\t__ctor: function(x, y, width=null, height=null, img=null)\n\t{\n\t\tif (width === null)\n\t\t\twidth = height = 0;\n\n\t\tif (height === null)\n\t\t{\n\t\t\timg = width;\n\t\t\twidth = img.width;\n\t\t\theight = img.height;\n\t\t}\n\n\t\tthis._super.GridElement.__ctor(x, y, width, height);\n\t\tthis.img = img !== null ? img.getDrawable() : img;\n\n\t\tthis.group = null;\n\t\tthis.debugBounds = false;\n\n\t\tthis._zvalue = 0;\n\t\tthis.__zvalue = 0;\n\t\tthis._alpha = 1.0;\n\t\tthis._shaderProgram = null;\n\t},\n\n\t/**\n\t * \tDestroys the element.\n\t */\n\t__dtor: function()\n\t{\n\t\tif (this.img !== null)\n\t\t{\n\t\t\tdispose(this.img);\n\t\t\tthis.img = null;\n\t\t}\n\n\t\tthis._super.GridElement.__dtor();\n\t},\n\n\t/**\n\t * \tDestroys the element later by adding it to the scene's destruction queue. If the element has no container, it will be destroyed immediately.\n\t */\n\tdestroyLater: function()\n\t{\n\t\tif (!this.alive()) return;\n\n\t\tif (this.container !== null)\n\t\t\tthis.container.scene.disposeLater(this);\n\t\telse\n\t\t\tdispose(this);\n\t},\n\n\t/*\n\t**\tSets or returns the alpha value of the element.\n\t*/\n\talpha: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._alpha;\n\n\t\tthis._alpha = value;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets or returns the depth zvalue of the element.\n\t*/\n\tzvalue: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._zvalue;\n\n\t\tthis._zvalue = value;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets or returns the shader program of the element.\n\t*/\n\tshaderProgram: function (shaderProgram=false)\n\t{\n\t\tif (shaderProgram === false)\n\t\t\treturn this._shaderProgram;\n\n\t\tthis._shaderProgram = shaderProgram;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the uniform setter function.\n\t * \t@param { (elem, gl, pgm) => void } uniformSetter\n\t */\n\tuniformSetter: function (uniformSetter)\n\t{\n\t\tthis._uniformSetter = uniformSetter;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tDraws the element on the specified canvas.\n\t*/\n\tdraw: function(g)\n\t{\n\t\tlet shaderChanged = this._shaderProgram !== null ? g.pushShaderProgram(this._shaderProgram) : false;\n\t\tlet depthFlagChanged = this.depthFlagEnabled() ? g.pushDepthFlag(this.depthFlag()) : false;\n\n\t\tif (this._shaderProgram !== null && this._uniformSetter !== null && g.gl !== null)\n\t\t\tthis._uniformSetter (this, g.gl, g.getShaderProgram());\n\n\t\tg.zvalue = this.__zvalue;\n\n\t\tif (this._alpha != 1.0)\n\t\t{\n\t\t\tg.pushAlpha();\n\t\t\tg.alpha(this._alpha);\n\t\t}\n\n\t\tthis.render(g);\n\n\t\tif (depthFlagChanged) g.popDepthFlag();\n\t\tif (shaderChanged) g.popShaderProgram();\n\n\t\tif (this._alpha != 1.0)\n\t\t\tg.popAlpha();\n\n\t\t/* *********** */\n\t\tif (G.debugBounds || this.debugBounds)\n\t\t{\n\t\t\tlet g2 = System.displayBuffer2;\n\n\t\t\tg2.pushMatrix();\n\t\t\tg2.loadMatrix(g.getMatrix());\n\n\t\t\tg2.fillStyle(this.debugBounds === 1 ? 'rgba(255,255,0,0.5)' : 'rgba(0,255,255,0.5)');\n\t\t\tg2.fillRect(this.bounds.x1, this.bounds.y1, this.bounds.width(), this.bounds.height());\n\n\t\t\tg2.popMatrix();\n\t\t}\n\t},\n\n\t/**\n\t * \tRenders the element to the graphics surface. Called by `draw` after the required renderer configuration has been set.\n\t */\n\trender: function(g) /* @override */\n\t{\n\t\tthis.img.draw (g, this.bounds.x1, this.bounds.y1, this.bounds.width(), this.bounds.height());\n\t}\n});\n\n//!/class\n\n//!namespace Element\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a drawable element at the specified position with the given drawable.\n\t * \t!function alloc (x: number, y: number, width: number, height: number, img?: IDrawable) : Element;\n\t */\n\t/**\n\t * \tAllocates a drawable element at the specified position with the given drawable.\n\t * \t!function alloc (x: number, y: number, img?: IDrawable) : Element;\n\t */\n\nRecycler.createPool(Element);\nexport default Element;\n","/*\n**\tflow/group.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Element from './element.js';\nimport List from '../utils/list.js';\nimport Point2 from '../math/point2.js';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"./element\"]\n//![import \"../utils/list\"]\n//![import \"../math/point2\"]\n//![import \"../utils/recycler\"]\n\nconst tempPoint = Point2.Pool.alloc();\n\n//:/**\n//: * \tGroups one or more elements into a single one.\n//: */\n\n//!class Group extends Element\n\nconst Group = Element.extend\n({\n\tclassName: 'Group',\n\n\t/*\n\t**\tList of elements in to the group.\n\t*/\n\tchildren: null,\n\n\t/**\n\t * \tVirtual zero reference point.\n\t * \t!readonly ref: Point2;\n\t */\n\tref: null,\n\n\t/**\n\t * \tConstructs an empty Group element.\n\t * \t!constructor (id?: string);\n\t */\n\t__ctor: function (id=null)\n\t{\n\t\tthis._super.Element.__ctor(0, 0, 0, 0);\n\n\t\tthis.children = List.Pool.alloc();\n\t\tthis.bounds.reset();\n\n\t\tthis.ref = Point2.Pool.alloc();\n\t\tthis.setId(id);\n\t},\n\n\t/**\n\t * \tDestroys the group and all children.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis.children.free();\n\t\tthis.ref.free();\n\n\t\tthis._super.Element.__dtor();\n\t},\n\n\t/**\n\t * \tAdds the group itself and all children to the scene's destruction queue. If any element has no container, it will be destroyed immediately.\n\t * \t!destroyLater() : void;\n\t */\n\tdestroyLater: function()\n\t{\n\t\tif (!this.alive()) return;\n\n\t\tlet i;\n\n\t\twhile ((i = this.children.shift()) != null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.group = null;\n\t\t\ti.destroyLater();\n\t\t}\n\n\t\tthis._super.Element.destroyLater();\n\t},\n\n\t/**\n\t * \tRemoves and destroys all child elements.\n\t * \t!clear() : Group;\n\t */\n\tclear: function()\n\t{\n\t\tlet i;\n\n\t\twhile ((i = this.children.shift()) != null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.group = null;\n\t\t\tdispose(i);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tRemoves all child elements but does not destroy them.\n\t * \t!reset() : Group;\n\t */\n\treset: function()\n\t{\n\t\tlet i;\n\n\t\twhile ((i = this.children.shift()) != null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.group = null;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tAdds a child element to the group. If the element has its `id` property set, it will be added to the group as a\n\t * \tproperty, which can be accessed directly using the element identifier or using the `getChild` method.\n\t * \t!addChild (elem: Element) : Element;\n\t */\n\taddChild: function (elem)\n\t{\n\t\tif (!elem) return elem;\n\n\t\tlet initial = this.bounds.x1 === null;\n\n\t\tif (initial || elem.bounds.x1 < this.bounds.x1) this.ltranslate(elem.bounds.x1 - this.bounds.x1, 0);\n\t\tif (initial || elem.bounds.y1 < this.bounds.y1) this.ltranslate(0, elem.bounds.y1 - this.bounds.y1);\n\t\tif (initial || elem.bounds.x2 > this.bounds.x2) this.resizeBy(elem.bounds.x2 - this.bounds.x2, 0);\n\t\tif (initial || elem.bounds.y2 > this.bounds.y2) this.resizeBy(0, elem.bounds.y2 - this.bounds.y2);\n\n\t\tthis.children.push(elem);\n\n\t\tif (elem.id !== null)\n\t\t\tthis[elem.id] = elem;\n\n\t\telem.group = this;\n\t\telem.remover.add(this._remove, this, this.children.bottom);\n\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tReturn the child element matching the specified identifier.\n\t * \t!child (id: string) : Element;\n\t */\n\tgetChild: function (id)\n\t{\n\t\treturn this[id] || null;\n\t},\n\n\t/**\n\t * \tCallback to remove an element from the container (called by Handler).\n\t */\n\t_remove: function (elem, self, node)\n\t{\n\t\tself.children.remove(node);\n\t\telem.group = null;\n\n\t\tif (elem.id !== null)\n\t\t\tself[elem.id] = null;\n\n\t\treturn false;\n\t},\n\n\t/**\n\t * \tRemoves an element from the container and returns it.\n\t * \t!removeChild (elem: Element) : Element;\n\t */\n\tremoveChild: function (elem)\n\t{\n\t\tif (!elem || elem.group !== this)\n\t\t\treturn elem;\n\n\t\telem.remover.execf(this._remove, this);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tSyncs the actual location of the specified element with its storage location. Returns `true` if successful.\n\t */\n\tsync: function()\n\t{\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.sync();\n\n\t\treturn this._super.Element.sync();\n\t},\n\n\t/**\n\t * \tLocal group translation, moves only the group by the specified deltas. Child element remain in position.\n\t * \t@param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * \t!ltranslate (dx: number, dy: number, upscaled?: boolean) : Group;\n\t */\n\tltranslate: function (dx, dy, upscaled=false)\n\t{\n\t\treturn this._super.Element.translate(dx, dy, upscaled);\n\t},\n\n\t/**\n\t * \tMoves the group and all children by the specified deltas.\n\t * \t@param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * \t!ltranslate (dx: number, dy: number, upscaled?: boolean) : Group;\n\t */\n\ttranslate: function (dx, dy, upscaled=false)\n\t{\n\t\tlet _dx = this.bounds.x1;\n\t\tlet _dy = this.bounds.y1;\n\n\t\tthis._super.Element.translate(dx, dy, upscaled);\n\t\tthis.ref.add(dx, dy, upscaled);\n\n\t\t_dx = this.bounds.x1 - _dx;\n\t\t_dy = this.bounds.y1 - _dy;\n\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.translate(_dx, _dy);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns a temporal Point2, describing the extra offset introduced by the group when translating a child element by the specified deltas.\n\t * \t@param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * \t!getOffsets (dx: number, dy: number, upscaled?: boolean) : Point2;\n\t */\n\tgetOffsets: function (dx, dy, upscaled=false)\n\t{\n\t\ttempPoint.set(this.bounds.ux1, this.bounds.uy1, true);\n\n\t\tlet _dx = tempPoint.x;\n\t\tlet _dy = tempPoint.y;\n\n\t\ttempPoint.add(dx, dy, upscaled);\n\n\t\t_dx = tempPoint.x - _dx;\n\t\t_dy = tempPoint.y - _dy;\n\n\t\ttempPoint.set(_dx, _dy);\n\n\t\ttempPoint.x -= dx;\n\t\ttempPoint.y -= dy;\n\n\t\treturn tempPoint;\n\t},\n\n\t/**\n\t * \tSets bits of the element flags in the group and all children.\n\t * \t!setFlags (value: number) : Group;\n\t */\n\tsetFlags: function (value)\n\t{\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.setFlags(value);\n\n\t\treturn this._super.Element.setFlags(value);\n\t},\n\n\t/**\n\t * \tClears bits from the group and all children flags.\n\t * \t!clearFlags (value: number) : Group;\n\t */\n\tclearFlags: function (value)\n\t{\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.clearFlags(value);\n\n\t\treturn this._super.Element.clearFlags(value);\n\t},\n\n\t/**\n\t * \tSets the visible flag of the group and all children.\n\t * \t!visible (value: boolean) : Group;\n\t */\n\t/**\n\t * \tReturns the visible flag of the group.\n\t * \t!visible () : boolean;\n\t */\n\tvisible: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._super.Element.visible();\n\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.visible(value);\n\n\t\treturn this._super.Element.visible(value);\n\t},\n\n\t/**\n\t * \tOverride render method to do nothing.\n\t */\n\trender: function(g)\n\t{\n\t}\n});\n\n//!/class\n\n//!namespace Group\n//!namespace Pool\n\n\t/**\n\t * \tAllocates an empty Group element.\n\t * \t!function alloc (id?: string) : Group;\n\t */\n\nRecycler.createPool(Group);\nexport default Group;\n","/*\n**\tflow/scene.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport Container from './container.js';\nimport Viewport from './viewport.js';\nimport Group from './group.js';\nimport Bounds2 from '../math/bounds2.js';\nimport List from '../utils/list.js';\nimport Handler from '../utils/handler.js';\nimport globals from '../system/globals.js';\n\n//![import \"./container\"]\n//![import \"./viewport\"]\n//![import \"./group\"]\n//![import \"../math/bounds2\"]\n//![import \"../utils/list\"]\n//![import \"../utils/handler\"]\n//![import \"../system/globals\"]\n\n//:/**\n//: * \tA scene is a set of containers, viewports and groups. Rendering is done in their specific index-based order.\n//: */\n\n//!class Scene\n\nconst Scene = Class.extend\n({\n\tclassName: 'Scene',\n\n\t/**\n\t * \tMinimum dimensions of the scene (smallest container size).\n\t * \t!readonly minWidth: number;\n\t * \t!readonly minHeight: number;\n\t */\n\tminWidth: null,\n\tminHeight: null,\n\n\t/**\n\t * \tMaximum dimensions of the scene (largest container size).\n\t * \t!readonly maxWidth: number;\n\t * \t!readonly maxHeight: number;\n\t */\n\tmaxWidth: null,\n\tmaxHeight: null,\n\n\t/**\n\t * \tList of containers.\n\t */\n\tcontainers: null,\n\n\t/**\n\t * \tList of viewports.\n\t */\n\tviewports: null,\n\n\t/**\n\t * \tActive viewport bounds, used to select items in a visible region.\n\t * \t!readonly viewportBounds: Bounds2;\n\t */\n\tviewportBounds: null,\n\n\t/**\n\t * \tList of Group elements.\n\t */\n\tgroupList: null,\n\n\t/**\n\t * \tNamed Group elements.\n\t */\n\tgroups: null,\n\n\t/**\n\t * \tDisposal queue.\n\t */\n\tdisposalQueue: null,\n\n\t/**\n\t * \tFirst updater. Runs before any other update calls.\n\t * \t!readonly fupdater: Handler;\n\t */\n\tfupdater: null,\n\n\t/**\n\t * \tGeneral updater. Runs after the first updater and before synchronizer.\n\t * \t!readonly updater: Handler;\n\t */\n\tupdater: null,\n\n\t/**\n\t * \tSynchronizer. Run after general updater, and before viewport synchronization.\n\t * \t!readonly synchronizer: Handler;\n\t */\n\tsynchronizer: null,\n\n\t/**\n\t * \tLast updater. Runs after all other update calls.\n\t * \t!readonly lupdater: Handler;\n\t */\n\tlupdater: null,\n\n\t/**\n\t * \tDestroyer runs when the scene is destroyed.\n\t * \t!readonly destroyer: Handler;\n\t */\n\tdestroyer: null,\n\n\t/**\n\t * \tCurrent delta time. Set upon entering the `update` method. Reflects the same value as System.frameDelta.\n\t * \t!readonly dt: number;\n\t */\n\tdt: 0,\n\n\t/**\n\t * \tFlags of the object (see constants at the bottom of this file).\n\t */\n\tflags: 0,\n\n\t/**\n\t * \tTotal number of elements drawn on the last draw operation.\n\t * \t!readonly drawCount: number;\n\t */\n\tdrawCount: 0,\n\n\t/**\n\t * \tScene object pointing to itself.\n\t */\n\tscene: null,\n\n\t/**\n\t * \tBase depth (z-value) of the scene.\n\t * \t!readonly zvalue: number;\n\t */\n\tzvalue: null,\n\n\t/**\n\t * \tConstructs an empty scene with the specified index.\n\t * \t@param index - Index for the scene. Used to calculate the base z-value of the scene. Valid range is from 0 to 3.\n\t * \t!constructor (index: number);\n\t */\n\t__ctor: function(index)\n\t{\n\t\tthis.containers = [];\n\n\t\t/**\n\t\t * \tZ-value is a 24-bit value constructed as:\n\t\t *\t\t2-bits: Scene Index\n\t\t *\t\t4-bits: Container Index\n\t\t *\t\t18-bits: Element z-value\n\t\t */\n\t\tthis.zvalue = (index & 3) << (18+4);\n\n\t\tthis.viewports = [];\n\t\tthis.viewportBounds = Bounds2.Pool.alloc();\n\n\t\tthis.groupList = List.Pool.alloc();\n\t\tthis.groups = { };\n\n\t\tthis.disposalQueue = List.Pool.alloc();\n\n\t\tthis.fupdater = Handler.Pool.alloc(this);\n\t\tthis.updater = Handler.Pool.alloc(this);\n\t\tthis.synchronizer = Handler.Pool.alloc(this);\n\t\tthis.lupdater = Handler.Pool.alloc(this);\n\t\tthis.destroyer = Handler.Pool.alloc(this);\n\n\t\tthis.flags = Scene.VISIBLE;\n\t\tthis.scene = this;\n\t},\n\n\t/**\n\t * \tDestroys the instance along with all containers, viewports and groups.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.disposeQueued();\n\t\tthis.disposalQueue.free();\n\n\t\tthis.destroyer.exec();\n\t\tthis.destroyer.free();\n\n\t\tthis.fupdater.free();\n\t\tthis.updater.free();\n\t\tthis.synchronizer.free();\n\t\tthis.lupdater.free();\n\n\t\tlet i;\n\n\t\twhile ((i = this.groupList.shift()) !== null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.container = null;\n\t\t\tdispose(i);\n\t\t}\n\n\t\tfor (i = 0; i < this.containers.length; i++)\n\t\t{\n\t\t\tif (!this.containers[i]) continue;\n\n\t\t\tthis.containers[i].scene = null;\n\t\t\tdispose(this.containers[i]);\n\n\t\t\tthis.containers[i] = null;\n\t\t}\n\n\t\tfor (i = 0; i < this.viewports.length; i++)\n\t\t{\n\t\t\tif (!this.viewports[i]) continue;\n\n\t\t\tdispose(this.viewports[i]);\n\t\t\tthis.viewports[i] = null;\n\t\t}\n\n\t\tthis.viewportBounds.free();\n\t\tthis.groupList.free();\n\t},\n\n\t/**\n\t * \tClears the scene leaving only viewports.\n\t * \t!clear() : void;\n\t */\n\tclear: function()\n\t{\n\t\tthis.disposeQueued();\n\n\t\tlet i;\n\n\t\twhile ((i = this.groupList.shift()) !== null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.container = null;\n\t\t\tdispose(i);\n\t\t}\n\n\t\tfor (i = 0; i < this.containers.length; i++)\n\t\t{\n\t\t\tif (this.containers[i])\n\t\t\t\tthis.containers[i].clear();\n\t\t}\n\t},\n\n\t/**\n\t * \tReturns the value of the `visible` flag.\n\t * \t!visible() : boolean;\n\t */\n\t/**\n\t * \tSets the value of the `visible` flag.\n\t * \t!visible(value: boolean) : Container;\n\t */\n\tvisible: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Scene.VISIBLE);\n\n\t\tthis.flags &= ~Scene.VISIBLE;\n\t\tif (value) this.flags |= Scene.VISIBLE;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets a container at the specified index.\n\t * \t@param index - Index of the container, valid range is from 0 to 15.\n\t * \t!setContainer (index: number, container: Container) : Scene;\n\t */\n\tsetContainer: function (index, container)\n\t{\n\t\tif (index < 0) return this;\n\t\tindex &= 15;\n\n\t\tif (container === null)\n\t\t{\n\t\t\tthis.containers[index].scene = null;\n\t\t\tthis.containers[index] = null;\n\t\t\treturn this;\n\t\t}\n\n\t\tif (!Container.isInstance(container))\n\t\t\tthrow new Error('Scene: Unable to set container at index ' + index + ': argument is not a Container');\n\n\t\tif (this.minWidth === null || container.width < this.minWidth) this.minWidth = container.width;\n\t\tif (this.minHeight === null || container.height < this.minHeight) this.minHeight = container.height;\n\t\tif (this.maxWidth === null || container.width > this.maxWidth) this.maxWidth = container.width;\n\t\tif (this.maxHeight === null || container.height > this.maxHeight) this.maxHeight = container.height;\n\n\t\tcontainer.scene = this;\n\t\tcontainer.zvalue = this.zvalue + (index << 18);\n\n\t\tthis.containers[index] = container;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the container at the specified index.\n\t * \t!getContainer (index: number) : Container;\n\t */\n\tgetContainer: function (index)\n\t{\n\t\treturn index < 0 || index >= this.containers.length ? null : this.containers[index];\n\t},\n\n\t/**\n\t * \tSets a viewport at the specified index.\n\t * \t!setViewport (index: number, viewport: Viewport) : Scene;\n\t */\n\tsetViewport: function (index, viewport)\n\t{\n\t\tif (index < 0) return this;\n\n\t\tif (viewport !== null && !Viewport.isInstance(viewport))\n\t\t\tthrow new Error('Scene: Unable to set viewport at index ' + index + ': argument is not a Viewport.');\n\n\t\tthis.viewports[index] = viewport;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the viewport at the specified index.\n\t * \t!getViewport (index: number) : Viewport;\n\t */\n\tgetViewport: function (index)\n\t{\n\t\treturn index < 0 || index >= this.viewports.length ? null : this.viewports[index];\n\t},\n\n\t/**\n\t * \tAdds the given element to the disposal queue. To be destroyed on the next call to `disposeQueued`.\n\t * \t!disposeLater (elem: Element) : void;\n\t */\n\tdisposeLater: function (elem)\n\t{\n\t\tif (!elem.alive()) return;\n\n\t\tthis.disposalQueue.push(elem);\n\t\telem.alive(false);\n\t},\n\n\t/**\n\t * \tDisposes all elements in the disposal queue.\n\t * \t!disposeQueued() : void;\n\t */\n\tdisposeQueued: function ()\n\t{\n\t\tlet elem;\n\n\t\twhile ((elem = this.disposalQueue.shift()) !== null)\n\t\t\tdispose(elem);\n\t},\n\n\t/**\n\t * \tAdds a group to the scene.\n\t * \t!addGroup (group: Group) : boolean;\n\t */\n\taddGroup: function (group)\n\t{\n\t\tif (!Group.isInstance(group))\n\t\t\tthrow new Error ('argument must be a Group');\n\n\t\tthis.groupList.push(group);\n\n\t\tif (group.id !== null)\n\t\t\tthis.groups[group.id] = group;\n\n\t\tgroup.container = this;\n\t\tgroup.remover.add(this._removeGroup, this, this.groupList.bottom);\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tCallback to remove a group from the scene (called by Handler).\n\t */\n\t_removeGroup: function (group, self, node)\n\t{\n\t\tgroup.container = null;\n\t\tself.groupList.remove(node);\n\n\t\tif (group.id !== null)\n\t\t\tself.groups[group.id] = null;\n\n\t\treturn false;\n\t},\n\n\t/**\n\t * \tRemoves a group from the scene.\n\t * \t!removeGroup (group: Group) : Group;\n\t */\n\tremoveGroup: function (group)\n\t{\n\t\tgroup.remover.execf(this._remove, this);\n\t\treturn group;\n\t},\n\n\t/**\n\t * \tSyncs the actual location of the specified element with its storage location. Returns `true` if successful.\n\t * \t!sync (group: Group) : boolean;\n\t */\n\tsync: function (group)\n\t{\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tDraws the scene, by executing the `draw` method on each container. The entire scene will be drawn once for each viewport, and\n\t * \tthe visible region rules of each viewport will be applied.\n\t * \t!draw (g: Canvas) : void;\n\t */\n\tdraw: function (g)\n\t{\n\t\tif (!this.visible()) return;\n\n\t\tthis.drawCount = 0;\n\n\t\tif (!this.viewports.length)\n\t\t{\n\t\t\tthis.drawContainers(g, null);\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let viewportIndex = 0; viewportIndex < this.viewports.length; viewportIndex++)\n\t\t{\n\t\t\tlet viewport = this.viewports[viewportIndex];\n\t\t\tif (!viewport || !viewport.enabled()) continue;\n\n\t\t\tglobals.viewport = viewport;\n\n\t\t\tg.pushClip();\n\t\t\tg.pushMatrix();\n\n\t\t\tviewport.applyClip(g);\n\t\t\tviewport.applyTransform(g);\n\n\t\t\tthis.viewportBounds.set(viewport.bounds);//.resizeBy(2, 2);\n\t\t\tthis.drawContainers(g, this.viewportBounds);\n\n\t\t\tg.popMatrix();\n\t\t\tg.popClip();\n\t\t}\n\t},\n\n\t/**\n\t * \tDraws the scene containers and passes the specified viewport bounds to the container.\n\t * \t!drawContainers (g: Canvas, viewportBounds: Bounds2) : void;\n\t */\n\tdrawContainers: function (g, viewportBounds)\n\t{\n\t\ttry\n\t\t{\n\t\t\tfor (let i = 0; i < this.containers.length; i++)\n\t\t\t{\n\t\t\t\tif (!this.containers[i])\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis.containers[i].setViewportBounds(viewportBounds);\n\t\t\t\tthis.containers[i].draw(g);\n\n\t\t\t\tthis.drawCount += this.containers[i].drawCount;\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tif (e.message !== 'FRAME_END') {\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * \tUpdates the scene viewports.\n\t */\n\tupdateViewports: function ()\n\t{\n\t\tfor (let i = 0; i < this.viewports.length; i++)\n\t\t{\n\t\t\tif (!this.viewports[i])\n\t\t\t\tcontinue;\n\n\t\t\tthis.viewports[i].update(this.dt);\n\t\t}\n\t},\n\n\t/**\n\t * \tRuns a scene update cycle.\n\t * \t!update (dt: number) : void;\n\t */\n\tupdate: function (dt)\n\t{\n\t\tthis.dt = dt;\n\t\tthis.fupdater.exec();\n\n\t\tthis.updater.exec();\n\t\tthis.disposeQueued();\n\t\tthis.synchronizer.exec();\n\t\tthis.updateViewports();\n\n\t\tthis.lupdater.exec();\n\t}\n});\n\n\n/**\n * \tConstants.\n */\nScene.VISIBLE = 0x001;\n\nexport default Scene;\n","/*\n**\tflow/updater.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from '@rsthn/rin';\nimport List from '../utils/list.js';\nimport Element from './element.js';\n\n//![import \"../utils/list\"]\n//![import \"./element\"]\n\n//:/**\n//: * \tAn updater is used to update one or more elements and synchronize their position with their container.\n//: */\n\n//!class Updater\n\nconst Updater = Class.extend\n({\n\tclassName: 'Updater',\n\n\t/**\n\t * \tScene where the updater is attached.\n\t * \t!readonly scene: Scene;\n\t */\n\tscene: null,\n\n\t/**\n\t * \tList of elements.\n\t */\n\tlist: null,\n\n\t/**\n\t * \tCallback passed when constructing the updater.\n\t */\n\t__update: null,\n\t__context: null,\n\n\t/**\n\t * \tConstructs the updater linked to the specified scene.\n\t * \t!constructor (scene: Scene, update: (elem: Element, dt: number, context: object) => boolean, context?: object);\n\t */\n\t__ctor: function (scene, update=null, context=null)\n\t{\n\t\tthis.list = List.Pool.alloc();\n\t\tthis.scene = scene;\n\n\t\tthis.__update = update;\n\t\tthis.__context = context;\n\n\t\tthis.scene.updater.add(this._update, this);\n\t\tthis.scene.synchronizer.add(this._sync, this);\n\t\tthis.scene.destroyer.add(this._destroy, this);\n\t},\n\n\t/**\n\t * \tDestroys the instance. All elements will just be removed.\n\t */\n\t__dtor: function()\n\t{\n\t\tlet i;\n\n\t\tthis.scene.updater.remove(this._update, this);\n\t\tthis.scene.synchronizer.remove(this._sync, this);\n\t\tthis.scene.destroyer.remove(this._destroy, this);\n\n\t\twhile ((i = this.list.shift()) !== null) {\n\t\t\ti.remover.remove(this._remove, this);\n\t\t}\n\n\t\tthis.list.free();\n\t},\n\n\t_destroy: function (scene, self)\n\t{\n\t\tdispose(self);\n\t},\n\n\t/**\n\t * \tAdds an element to the updater.\n\t * \t!add (elem: Element) : boolean;\n\t */\n\tadd: function (elem)\n\t{\n\t\tif (!Element.isInstance(elem))\n\t\t\tthrow new Error ('argument must be an Element');\n\n\t\tthis.list.push(elem);\n\n\t\telem.remover.add(this._remove, this, this.list.bottom);\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tCallback to remove an element from the updater (called by Handler).\n\t */\n\t_remove: function (elem, self, node)\n\t{\n\t\tself.list.remove(node);\n\t\treturn false;\n\t},\n\n\t/**\n\t * \tRemoves an element from the updater.\n\t * \t!remove (elem: Element) : Element;\n\t */\n\tremove: function (elem)\n\t{\n\t\telem.remover.execf(this._remove, this);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tCallback for the synchronizer.\n\t */\n\t_sync: function (scene, self)\n\t{\n\t\tfor (let i = self.list.top; i; i = i.next)\n\t\t\ti.value.sync();\n\t},\n\n\t/**\n\t * \tCallback for the updater.\n\t */\n\t_update: function (scene, self)\n\t{\n\t\tself.update(scene.dt);\n\t},\n\n\t/**\n\t * \tRuns an update cycle.\n\t * \t!update (dt: number) : void;\n\t */\n\tupdate: function (dt)\n\t{\n\t\tif (this.__update !== null)\n\t\t{\n\t\t\tlet next = null;\n\t\t\tfor (let i = this.list.top; i; i = next)\n\t\t\t{\n\t\t\t\tnext = i.next;\n\n\t\t\t\tif (this.__update (i.value, dt, this.__context) === false)\n\t\t\t\t\tthis.remove(i.value);\n\t\t\t}\n\t\t}\n\t}\n});\n\nexport default Updater;\n","/*\n**\tflow/simple-container.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Container from './container.js';\nimport GridElement from './grid-element.js';\nimport Element from './element.js';\nimport List from '../utils/list.js';\n\n//![import \"./container\"]\n//![import \"./grid-element\"]\n//![import \"./element\"]\n//![import \"../utils/list\"]\n\n//:/**\n//: * \tA simple container is a container that uses a linked-list to storage the elements.\n//: */\n\n//!class SimpleContainer extends Container\n\nexport default Container.extend\n({\n\tclassName: 'SimpleContainer',\n\n\t/**\n\t * \tList containing the elements.\n\t * \t!readonly list: List;\n\t */\n\tlist: null,\n\n\t/**\n\t * \tConstructs the container with the specified size.\n\t * \t!constructor (width: number, height: number);\n\t */\n\t__ctor: function (width, height)\n\t{\n\t\tthis._super.Container.__ctor (width, height);\n\t\tthis.list = List.Pool.alloc();\n\t},\n\n\t/**\n\t * \tDestroys the container and all contained elements.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis.list.free();\n\n\t\tthis._super.Container.__dtor();\n\t},\n\n\t/**\n\t * \tSyncs the actual location of the specified element with its storage location. Returns true if successful.\n\t * \t!override sync (elem: Element) : boolean;\n\t */\n\tsync: function (elem)\n\t{\n\t\tthis.syncZ(elem);\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tClears the container to empty. All contained elements will be destroyed.\n\t * \t!override clear() : void;\n\t */\n\tclear: function()\n\t{\n\t\tlet i;\n\n\t\twhile ((i = this.list.shift()) !== null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.container = null;\n\t\t\tdispose(i);\n\t\t}\n\n\t\tthis.elementCount = 0;\n\t},\n\n\t/**\n\t * \tResets the container to empty. Contained elements are not destroyed. Use `clear` if that is your intention.\n\t * \t!override reset() : void;\n\t */\n\treset: function()\n\t{\n\t\tlet i;\n\n\t\twhile ((i = this.list.shift()) !== null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.container = null;\n\t\t}\n\n\t\tthis.elementCount = 0;\n\t},\n\n\t/**\n\t * \tAdds an element to the container. Returns boolean indicating if successful.\n\t * \t!override add (elem: Element) : boolean;\n\t */\n\tadd: function (elem)\n\t{\n\t\tif (!Element.isInstance(elem))\n\t\t\tthrow new Error ('argument must be an Element');\n\n\t\tthis.list.push(elem);\n\t\tthis.elementCount++;\n\n\t\telem.container = this;\n\t\telem.remover.add(this._remove, this, this.list.bottom);\n\n\t\tthis.syncZ(elem);\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tCallback to remove an element from the container (called by Handler).\n\t */\n\t_remove: function (elem, self, node)\n\t{\n\t\tself.list.remove(node);\n\t\tself.elementCount--;\n\n\t\telem.container = null;\n\t\treturn false;\n\t},\n\n\t/**\n\t * \tRemoves an element from the container and returns it.\n\t * \t!override remove (elem: Element) : Element;\n\t */\n\tremove: function (elem)\n\t{\n\t\telem.remover.execf(this._remove, this);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tActually draws the contained elements. Does not take the active viewport into account (hence simple container).\n\t * \t!override render() : void;\n\t */\n\trender: function()\n\t{\n\t\tlet flags = GridElement.ALIVE | GridElement.VISIBLE;\n\n\t\tfor (let i = this.list.top; i; i = i.next)\n\t\t{\n\t\t\tif (!i.value.getFlags(flags))\n\t\t\t\tcontinue;\n\n\t\t\tif (this.drawElement(i.value, this) === false)\n\t\t\t\tbreak;\n\t\t}\n\t}\n});\n","/*\n**\tflow/grid-container.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Container from './container.js';\nimport Grid from './grid.js';\nimport GridElement from './grid-element.js';\nimport Element from './element.js';\nimport globals from '../system/globals.js';\nimport System from '../system/system.js';\n\n//![import \"./container\"]\n//![import \"./grid\"]\n//![import \"./grid-element\"]\n//![import \"./element\"]\n//![import \"../system/globals\"]\n//![import \"../system/system\"]\n\n//:/**\n//: * \tA grid container is a container that uses an optimized spatial grid structure to store the elements.\n//: */\n\n//!class GridContainer extends Container\n\nexport default Container.extend\n({\n\tclassName: 'GridContainer',\n\n\t/**\n\t * \tGrid containing the elements.\n\t * \t!readonly grid: Grid;\n\t */\n\tgrid: null,\n\n\t/**\n\t * \tIndicates if the container bound should be drawn.\n\t * \t!debugBounds: boolean;\n\t */\n\tdebugBounds: false,\n\n\t/**\n\t * \tConstructs the grid container with the default size (32768x32768) and divisor (64).\n\t * \t!constructor ();\n\t */\n\t/**\n\t * \tConstructs the grid container with the specified size and divisor.\n\t * \t!constructor (width: number, height: number, divisor: number);\n\t */\n\t__ctor: function (width=32768, height=32768, divisor=64)\n\t{\n\t\tthis._super.Container.__ctor (width, height);\n\t\tthis.grid = new Grid (width, height, divisor);\n\t},\n\n\t/**\n\t * \tDestroys the container and all contained elements.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis._super.Container.__dtor();\n\t},\n\n\t/**\n\t * \tSyncs the actual location of the specified element with its storage location. Returns true if successful.\n\t * \t!override sync (elem: Element) : boolean;\n\t */\n\tsync: function (elem)\n\t{\n\t\tthis.syncZ(elem);\n\t\treturn this.grid.sync(elem);\n\t},\n\n\t/**\n\t * \tClears the container to empty. All contained elements will be destroyed.\n\t * \t!override clear() : void;\n\t */\n\tclear: function()\n\t{\n\t\tthis.grid.clear();\n\t},\n\n\t/**\n\t * \tResets the container to empty. Contained elements are not destroyed. Use `clear` if that is your intention.\n\t * \t!override reset() : void;\n\t */\n\treset: function()\n\t{\n\t\tthis.grid.reset();\n\t},\n\n\t/**\n\t * \tAdds an element to the container. Returns boolean indicating if successful.\n\t * \t!override add (elem: Element) : boolean;\n\t */\n\tadd: function (elem)\n\t{\n\t\tif (!Element.isInstance(elem))\n\t\t\tthrow new Error ('argument must be an Element');\n\n\t\tif (!this.grid.add(elem))\n\t\t\treturn false;\n\n\t\telem.container = this;\n\t\tthis.elementCount = this.grid.count;\n\n\t\tthis.syncZ(elem);\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tRemoves an element from the container and returns it.\n\t * \t!override remove (elem: Element) : Element;\n\t */\n\tremove: function (elem)\n\t{\n\t\tthis.grid.remove(elem);\n\t\tthis.elementCount = this.grid.count;\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tActually draws the contained elements.\n\t * \t!override render() : void;\n\t */\n\trender: function()\n\t{\n\t\tthis.grid.forEachInRegion(this.viewportBounds, GridElement.ALIVE | GridElement.VISIBLE, GridElement.ALIVE | GridElement.VISIBLE, this.drawElement, this);\n\n\t\tif (!this.debugBounds || this.viewportBounds === null)\n\t\t\treturn;\n\n\t\tlet g = System.displayBuffer2;\n\n\t\tg.pushMatrix();\n\t\tg.loadMatrix(this.g.getMatrix());\n\n\t\tlet y0 = ((this.viewportBounds.y1+this.grid.offsy - (1<<this.grid.ky-1)) >> this.grid.ky) * this.grid.stride;\n\t\tlet y1 = ((this.viewportBounds.y2+this.grid.offsy) + (1<<this.grid.ky-1) >> this.grid.ky) * this.grid.stride;\n\t\tlet x0 = ((this.viewportBounds.x1+this.grid.offsx - (1<<this.grid.kx-1)) >> this.grid.kx);\n\t\tlet x1 = ((this.viewportBounds.x2+this.grid.offsx) + (1<<this.grid.kx-1) >> this.grid.kx);\n\n\t\ty0 = (int(y0 / this.grid.stride) << this.grid.ky) - this.grid.offsy;\n\t\ty1 = (int(y1 / this.grid.stride) << this.grid.ky) - this.grid.offsy + (1 << this.grid.ky);\n\t\tx0 = (x0 << this.grid.kx) - this.grid.offsx;\n\t\tx1 = (x1 << this.grid.kx) - this.grid.offsx + (1 << this.grid.kx);\n\n\t\tg.fillStyle('rgba(255,0,0,0.2)');\n\t\tg.fillRect(x0, y0, x1-x0+1, y1-y0+1);\n\n\t\ty0 = this.viewportBounds.y1;\n\t\ty1 = this.viewportBounds.y2;\n\t\tx0 = this.viewportBounds.x1;\n\t\tx1 = this.viewportBounds.x2;\n\n\t\tg.lineWidth(1/System.canvasScaleFactor);\n\t\tg.strokeStyle('#fff');\n\t\tg.strokeRect(x0, y0, x1-x0+1, y1-y0+1);\n\n\t\tg.lineWidth(1/System.canvasScaleFactor);\n\t\tg.strokeStyle('#008');\n\t\tfor (let y = globals.viewport.container.y1+this.grid.offsy; y < globals.viewport.container.y2+this.grid.offsy; y += (1 << this.grid.ky))\n\t\tfor (let x = globals.viewport.container.x1+this.grid.offsx; x < globals.viewport.container.x2+this.grid.offsx; x += (1 << this.grid.kx))\n\t\t{\n\t\t\tg.strokeRect(x-this.grid.offsx, y-this.grid.offsy, (1 << this.grid.kx), (1 << this.grid.ky));\n\t\t}\n\n\t\tg.popMatrix();\n\t},\n\n\t/**\n\t * \tExecutes the specified callback for each element that intersects the given bounds and has the specified flags set. The process is\n\t * \timmediately stopped if the callback returns `false`.\n\t * \t!forEachInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number, callback: (elem: Element, context?: object) => boolean, context?: object) : void;\n\t */\n\tforEachInRegion: function (bounds, flagsAndMask, flagsValue, callback, context)\n\t{\n\t\tthis.grid.forEachInRegion (bounds, flagsAndMask, flagsValue, callback, context);\n\t},\n\n\t/**\n\t * \tCollects all elements that intersect the given bounds and have the specified flags set. Returns a new List, remember to call `free` after using it.\n\t * \t!selectInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : List;\n\t */\n\tselectInRegion: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\treturn this.grid.selectInRegion (bounds, flagsAndMask, flagsValue);\n\t},\n\n\t/**\n\t * \tCounts all elements that intersect the given bounds and have the specified flags set.\n\t * \t!countInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : number;\n\t */\n\tcountInRegion: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\treturn this.grid.countInRegion (bounds, flagsAndMask, flagsValue);\n\t},\n\n\t/**\n\t * \tReturns the first element that intersect the given bounds and have the specified flags set.\n\t * \t!selectFirst (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : Element;\n\t */\n\tselectFirst: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\treturn this.grid.selectFirst (bounds, flagsAndMask, flagsValue);\n\t}\n});\n","/*\n**\tflow/mask.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Element from './element.js';\nimport System from '../system/system.js';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"./element\"]\n//![import \"../system/system\"]\n//![import \"../utils/recycler\"]\n\n//:/**\n//: * \tDescribes an element mask. Used for collision detection.\n//: */\n\n//!class Mask extends Element\n\nconst Mask = Element.extend\n({\n\tclassName: 'Mask',\n\n\t/**\n\t * \tType of the mask (user defined).\n\t * \t!type: number;\n\t */\n\ttype: 0,\n\n\t/**\n\t * \tConstructs the Mask element.\n\t * \t!constructor (type: number, x: number, y: number, width: number, height: number);\n\t */\n\t__ctor: function(type, x, y, width, height)\n\t{\n\t\tthis._super.Element.__ctor(x, y, width, height);\n\n\t\tthis.type = type;\n\t},\n\n\t/**\n\t * \tDraws the element on the specified canvas.\n\t * \t!draw (g: Canvas) : void;\n\t */\n\tdraw: function(g)\n\t{\n\t\tlet g2 = System.displayBuffer2;\n\n\t\tg2.pushMatrix();\n\t\tg2.loadMatrix(g.getMatrix());\n\n\t\tg2.fillStyle('rgba(255,0,255,0.3)');\n\t\tg2.fillRect(this.bounds.x1, this.bounds.y1, this.bounds.width(), this.bounds.height());\n\n\t\tg2.popMatrix();\n\t}\n});\n\n//!/class\n\n//!namespace Mask\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a new Mask element.\n\t * \t!function alloc (type: number, x: number, y: number, width: number, height: number) : Mask;\n\t */\n\nRecycler.createPool(Mask);\nexport default Mask;\n","/*\n**\tflow/label.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Element from './element.js';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"./element\"]\n//![import \"../utils/recycler\"]\n\n//:/**\n//: * \tDescribes an element that can be rendered to the screen.\n//: */\n\n//!class Label extends Element\n\nconst Label = Element.extend\n({\n\tclassName: 'Label',\n\n\t/**\n\t * \tText to render.\n\t * \t!text: string;\n\t */\n\ttext: null,\n\n\t/**\n\t * \tSpritefont resource.\n\t * \t!font: object;\n\t */\n\tfont: null,\n\n\t/**\n\t * \tIndicates if the `text` property changed.\n\t */\n\t_dirty: false,\n\n\t/**\n\t * \tCurrent text dimensions.\n\t */\n\ttextWidth: null,\n\ttextHeight: null,\n\n\t/**\n\t * \tAlignment properties of the label.\n\t */\n\t_align: -1, /* -1=LEFT, 0=CENTER, 1=RIGHT */\n\t_valign: -1, /* -1=TOP, 0=MIDDLE, 1=BOTTOM */\n\n\t/**\t\n\t * Position offset for the text. Calculated based on alignment properties.\n\t */\n\ttextOffsetX: null,\n\ttextOffsetY: null,\n\n\t/**\n\t * \tConstructs a label element at the specified position with the given text.\n\t * \t!constructor (x: number, y: number, font: object, text: string);\n\t */\n\t__ctor: function(x, y, font, text)\n\t{\n\t\tthis._super.Element.__ctor(x, y, 4, 4);\n\n\t\tthis.text = text;\n\t\tthis.font = font;\n\n\t\tthis._align = -1;\n\t\tthis._valign = -1;\n\n\t\tthis._dirty = true;\n\t},\n\n\t/**\n\t * \tSets the horizontal alignment value of the label.\n\t * \t@param value - Use -1 for LEFT, 0 for CENTER, and 1 for RIGHT.\n\t * \t!align (value: number) : Label;\n\t */\n\talign: function(value)\n\t{\n\t\tif (this._align === value)\n\t\t\treturn this;\n\n\t\tthis._align = value;\n\t\tthis.textOffsetX = null;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the vertical alignment value of the label.\n\t * \t@param value - Use -1 for TOP, 0 for MIDDLE, and 1 for BOTTOM.\n\t * \t!valign (value: number) : Label;\n\t */\n\tvalign: function(value)\n\t{\n\t\tif (this._valign === value)\n\t\t\treturn this;\n\n\t\tthis._valign = value;\n\t\tthis.textOffsetY = null;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the text value of the label.\n\t * \t@param value\n\t * \t!setText (value: string) : Label;\n\t */\n\tsetText: function(value)\n\t{\n\t\tif (this.text === value)\n\t\t\treturn this;\n\n\t\tthis.text = value;\n\t\tthis._dirty = true;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tUpdates the text related properties (textWidth, textHeight, textOffsetX and textOffsetY). Automatically\n\t * \tcalled before the label is drawn. Recalculates only if text changed since last call.\n\t */\n\tupdate: function()\n\t{\n\t\tif (this._dirty)\n\t\t{\n\t\t\tthis.textWidth = this.font.measureWidth(this.text);\n\t\t\tthis.textHeight = this.font.measureHeight(this.text);\n\n\t\t\tthis.textOffsetX = null;\n\t\t\tthis.textOffsetY = null;\n\n\t\t\tthis._dirty = false;\n\t\t}\n\n\t\tif (this.textOffsetX === null) {\n\t\t\tif (this._align < 0) this.textOffsetX = 0;\n\t\t\telse if (this._align === 0) this.textOffsetX = -this.textWidth >> 1;\n\t\t\telse this.textOffsetX = -this.textWidth;\n\t\t}\n\n\t\tif (this.textOffsetY === null) {\n\t\t\tif (this._valign < 0) this.textOffsetY = 0;\n\t\t\telse if (this._valign === 0) this.textOffsetY = -this.textHeight >> 1;\n\t\t\telse this.textOffsetY = -this.textHeight;\n\t\t}\n\t},\n\n\t/**\n\t * \tRenders the element to the graphics surface.\n\t */\n\trender: function(g)\n\t{\n\t\tthis.update();\n\t\tthis.font.drawText (g, this.bounds.x1 + this.textOffsetX, this.bounds.y1 + this.textOffsetY, this.text);\n\t}\n});\n\n//!/class\n\n//!namespace Label\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a label element at the specified position with the given text.\n\t * \t!function alloc (x: number, y: number, font: object, text: string) : Label;\n\t */\n\n\nRecycler.createPool(Label);\nexport default Label;\n","/*\n**\tflow/keyboard-handler\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport PriorityQueue from '../utils/priority-queue.js';\nimport Boot from './boot.js';\nimport System from '../system/system.js';\n\n//![import \"../utils/priority-queue\"]\n//![import \"./boot\"]\n//![import \"../system/system\"]\n\n//!namespace KeyboardHandler\n\n\t//!interface EventHandler\n\n\t\t/**\n\t\t * \tHandler for keyboard events.\n\t\t * \t!onKeyboardEvent (action: System.KeyboardEventType, keyCode: number, keyState: object) : boolean;\n\t\t */\n\n\t//!/interface\n\n//!/namespace\n\n//:/**\n//: * \tUsed to attach keyboard event handlers to the system.\n//: */\n\n//!class KeyboardHandler\n\nexport default Boot.Module.create\n({\n\thandlers: null,\n\n\t__ctor: function ()\n\t{\n\t\tconst self = this;\n\n\t\tthis._super.Module.__ctor();\n\n\t\tthis.handlers = new PriorityQueue();\n\n\t\tthis._callOnKeyboardEvent = function (handler) {\n\t\t\treturn self.callOnKeyboardEvent(handler);\n\t\t};\n\t},\n\n\t/**\n\t * \tRegisters a new keyboard event handler.\n\t * \t!register (handler: KeyboardHandler.EventHandler) : KeyboardHandler.EventHandler;\n\t */\n\tregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.add(handler);\n\n\t\t\tif ('init' in handler)\n\t\t\t\thandler.init();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"KeyboardHandler (register): \" + e.message);\n\t\t}\n\n\t\treturn handler;\n\t},\n\n\t/**\n\t * \tRemoves a keyboard event handler.\n\t * \t!unregister (handler: KeyboardHandler.EventHandler) : void;\n\t */\n\tunregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.remove(handler);\n\t\t\tthis.handlers.cleanup();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"KeyboardHandler (unregister): \" + e.message);\n\t\t}\n\t},\n\n\tcallOnKeyboardEvent: function (handler)\n\t{\n\t\treturn handler.onKeyboardEvent(this._action, this._keyCode, this._keyState);\n\t},\n\n\tonStartup: function()\n\t{\n\t\tSystem.onKeyboardEvent = (action, keyCode, keyState) =>\n\t\t{\n\t\t\tthis._action = action;\n\t\t\tthis._keyCode = keyCode;\n\t\t\tthis._keyState = keyState;\n\n\t\t\tthis.handlers.forEach(this._callOnKeyboardEvent);\n\t\t};\n\t},\n\n\tonShutdown: function()\n\t{\n\t\tSystem.onKeyboardEvent = null;\n\t}\n});\n","/*\n**\tflow/pointer-handler\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport PriorityQueue from '../utils/priority-queue.js';\nimport Boot from './boot.js';\nimport System from '../system/system.js';\n\n//![import \"../utils/priority-queue\"]\n//![import \"./boot\"]\n//![import \"../system/system\"]\n\n//!namespace PointerHandler\n\n\t//!interface EventHandler\n\n\t\t/**\n\t\t * \tHandler for pointer events.\n\t\t * \t!onPointerEvent (action: System.PointerEventType, pointer: object, pointers: object) : boolean;\n\t\t */\n\n\t//!/interface\n\n//!/namespace\n\n//:/**\n//: * \tUsed to attach pointer event handlers to the system.\n//: */\n\n//!class PointerHandler\n\nexport default Boot.Module.create\n({\n\thandlers: null,\n\n\t__ctor: function ()\n\t{\n\t\tconst self = this;\n\n\t\tthis._super.Module.__ctor();\n\n\t\tthis.handlers = new PriorityQueue();\n\n\t\tthis._callOnPointerEvent = function (handler) {\n\t\t\treturn self.callOnPointerEvent(handler);\n\t\t};\n\t},\n\n\t/**\n\t * \tRegisters a new pointer event handler.\n\t * \t!register (handler: PointerHandler.EventHandler) : PointerHandler.EventHandler;\n\t */\n\tregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.add(handler);\n\n\t\t\tif ('init' in handler)\n\t\t\t\thandler.init();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"PointerHandler (register): \" + e.message);\n\t\t}\n\n\t\treturn handler;\n\t},\n\n\t/**\n\t * \tRemoves a pointer event handler.\n\t * \t!unregister (handler: PointerHandler.EventHandler) : void;\n\t */\n\tunregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.remove(handler);\n\t\t\tthis.handlers.cleanup();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"PointerHandler (unregister): \" + e.message);\n\t\t}\n\t},\n\n\tcallOnPointerEvent: function (handler)\n\t{\n\t\treturn handler.onPointerEvent(this._action, this._p, this._pointers);\n\t},\n\n\tonStartup: function()\n\t{\n\t\tSystem.onPointerEvent = (action, p, pointers) =>\n\t\t{\n\t\t\tthis._action = action;\n\t\t\tthis._p = p;\n\t\t\tthis._pointers = pointers;\n\n\t\t\tthis.handlers.forEach(this._callOnPointerEvent);\n\t\t};\n\t},\n\n\tonShutdown: function()\n\t{\n\t\tSystem.onPointerEvent = null;\n\t}\n});\n","/*\n**\tflow/screen-controls\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport KeyboardHandler from './keyboard-handler.js';\nimport PointerHandler from './pointer-handler.js';\nimport System from '../system/system.js';\n\n//![import \"./keyboard-handler\"]\n//![import \"./pointer-handler\"]\n//![import \"../system/system\"]\n\n/**\n**\n*/\n\nconst ScreenControls =\n({\n\tpriority: 5,\n\n\tlist: [ ],\n\tdummy: { },\n\n\thoverEnabled: false,\n\tzindexEnabled: false,\n\tlastFrame: 0,\n\n\t/*\n\t**\tAdds an item to the ScreenControls control list. The item should be an object with the following mandatory methods:\n\t**\n\t**\t\tbool containsPoint (float pointerX, float pointerY)\n\t**\t\tvoid pointerActivate (Object pointer)\n\t**\t\tvoid pointerDeactivate (Object pointer)\n\t**\t\tvoid pointerUpdate (float pointerX, float pointerY, Object pointer)\n\t**\t\tvoid hover (bool status, Object pointer)\n\t**\t\tbool focusLock\n\t**\n\t**\t\tbool keyboardEvents\n\t**\t\tbool keyDown (int keyCode, object keyArgs)\n\t**\t\tbool keyUp (int keyCode, object keyArgs)\n\t*/\n\tadd: function (c)\n\t{\n\t\tif (this.zindexEnabled && !('zindex' in c))\n\t\t\tc.zindex = 0;\n\n\t\tif (this.list.indexOf(c) === -1)\n\t\t\tthis.list.push(c);\n\t},\n\n\tremove: function (c)\n\t{\n\t\tvar i = this.list.indexOf(c);\n\t\tif (i !== -1) this.list.splice(i, 1);\n\t},\n\n\tsetHoverEnabled: function (value)\n\t{\n\t\tthis.hoverEnabled = value;\n\t},\n\n\tsetZIndexEnabled: function (value)\n\t{\n\t\tthis.zindexEnabled = value;\n\t},\n\n\tfindTarget: function (x, y, filter)\n\t{\n\t\tif (this.zindexEnabled && this.lastFrame != System.frameNumber)\n\t\t{\n\t\t\tlet zindex = this.list[0].zindex;\n\n\t\t\tfor (let item of this.list)\n\t\t\t{\n\t\t\t\tif (item.zindex > zindex)\n\t\t\t\t{\n\t\t\t\t\tthis.list = this.list.sort((a,b) => b.zindex - a.zindex);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tzindex = item.zindex;\n\t\t\t}\n\n\t\t\tthis.lastFrame = System.frameNumber;\n\t\t}\n\n\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t{\n\t\t\tif (!this.list[i]) continue;\n\n\t\t\tif (filter != null && filter(this.list[i]) === false)\n\t\t\t\tcontinue;\n\n\t\t\tif (this.list[i].containsPoint(x, y))\n\t\t\t\treturn this.list[i];\n\t\t}\n\n\t\treturn null;\n\t},\n\n\tfilterHover: function (i)\n\t{\n\t\treturn 'hover' in i;\n\t},\n\n\tonPointerEvent: function (action, p, pointers)\n\t{\n\t\tlet _continue = true;\n\t\tlet tmp = null;\n\n\t\tswitch (action)\n\t\t{\n\t\t\tcase System.PointerEventType.POINTER_DOWN:\n\n\t\t\t\tif (p._ref != null)\n\t\t\t\t{\n\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\ttmp.pointerDeactivate(p);\n\t\t\t\t}\n\n\t\t\t\ttmp = this.findTarget(p.x, p.y);\n\t\t\t\tif (tmp != null)\n\t\t\t\t{\n\t\t\t\t\t(p._ref = tmp).pointerActivate(p);\n\t\t\t\t\t_continue = false;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_DRAG_START:\n\t\t\t\tif (p._ref != null) _continue = false;\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_DRAG_MOVE:\n\t\t\t\tif (this.hoverEnabled)\n\t\t\t\t{\n\t\t\t\t\tif (p._refh != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (p._refh.containsPoint(p.x, p.y))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp = p._refh; p._refh = null;\n\t\t\t\t\t\t\ttmp.hover(false, p);\n\t\t\n\t\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, this.filterHover);\n\t\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, this.filterHover);\n\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (p._ref != null)\n\t\t\t\t{\n\t\t\t\t\tif (p._ref.containsPoint(p.x, p.y) || p._ref.focusLock == true)\n\t\t\t\t\t{\n\t\t\t\t\t\tp._ref.pointerUpdate (p.x, p.y, p);\n\t\t\t\t\t\t_continue = false;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\t\ttmp.pointerDeactivate(p);\n\t\n\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y);\n\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t(p._ref = tmp).pointerActivate(p);\n\t\t\t\t\t\t\t_continue = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttmp = this.findTarget(p.x, p.y);\n\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t{\n\t\t\t\t\t\t(p._ref = tmp).pointerActivate(p);\n\t\t\t\t\t\t_continue = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_MOVE:\n\t\t\t\tif (this.hoverEnabled)\n\t\t\t\t{\n\t\t\t\t\tif (p._refh != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (p._refh.containsPoint(p.x, p.y))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp = p._refh; p._refh = null;\n\t\t\t\t\t\t\ttmp.hover(false, p);\n\t\t\n\t\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, this.filterHover);\n\t\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, this.filterHover);\n\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (p._ref == null) break;\n\n\t\t\t\tif (p._ref.containsPoint(p.x, p.y) || p._ref.focusLock == true)\n\t\t\t\t{\n\t\t\t\t\tp._ref.pointerUpdate (p.x, p.y, p);\n\t\t\t\t\t_continue = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\ttmp.pointerDeactivate(p);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_DRAG_STOP:\n\t\t\t\tif (p._ref != null) _continue = false;\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_UP:\n\t\t\t\tif (p._ref != null)\n\t\t\t\t{\n\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\ttmp.pointerDeactivate(p);\n\n\t\t\t\t\t_continue = false;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn _continue;\n\t},\n\n\tonKeyboardEvent: function (action, keyCode, keyArgs)\n\t{\n\t\tswitch (action)\n\t\t{\n\t\t\tcase System.KeyboardEventType.KEY_DOWN:\n\n\t\t\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!this.list[i] || !this.list[i].keyboardEvents) continue;\n\n\t\t\t\t\tif (this.list[i].keyDown(keyCode, keyArgs) === false)\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.KeyboardEventType.KEY_UP:\n\n\t\t\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!this.list[i] || !this.list[i].keyboardEvents) continue;\n\n\t\t\t\t\tif (this.list[i].keyUp(keyCode, keyArgs) === false)\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n});\n\nPointerHandler.register(ScreenControls);\nKeyboardHandler.register(ScreenControls);\n\nexport default ScreenControls;\n","/*\n**\tflow/button\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Group from './group.js';\nimport Mask from './mask.js';\nimport ScreenControls from './screen-controls.js';\n\n//![import \"./group.js\"]\n//![import \"./mask.js\"]\n//![import \"./screen-controls.js\"]\n\n/**\n * \tButton class provides an easy way to add push-button support to the world.\n */\n\n//!class Button extends Group\n\nexport default Group.extend\n({\n\t/**\n\t * \tIndicates if once focus is obtained it is locked until the user releases it.\n\t * \t@default false\n\t *\t!focusLock: boolean;\n\t */\n\tfocusLock: false,\n\n\t/**\n\t * \tIndicates if keyboard events are enabled on this object.\n\t * \t@default true\n\t *\t!keyboardEvents: boolean;\n\t */\n\tkeyboardEvents: true,\n\n\t/**\n\t * \tCurrent pressed status of the button.\n\t *\t!isPressed: boolean;\n\t */\n\tisPressed: false,\n\n\t/**\n\t * \tPrevious pressed status of the button.\n\t *\t!wasPressed: boolean;\n\t */\n\twasPressed: false,\n\n\t/**\n\t * \tImage to draw when the button is unpressed.\n\t *\t!unpressedImg: IDrawable;\n\t */\n\tunpressedImg: null,\n\n\t/**\n\t * \tImage to draw when the button is pressed.\n\t *\t!pressedImg: IDrawable;\n\t */\n\tpressedImg: null,\n\n\t/**\n\t * \tKey code related to the button. Used only if not `null`.\n\t * \t@default null\n\t *\t!keyCode: System.KeyCode;\n\t */\n\tkeyCode: null,\n\n\t/**\n\t * \tHitbox element.\n\t * \t!readonly hitbox: Mask;\n\t */\n\thitbox: 0,\n\n\t/**\n\t * \tCreates the button with the specified parameters. Automatically adds it to the screen controls.\n\t * \t!constructor (container: Container, x: number, y: number, unpressedImg: IDrawable, pressedImg?: IDrawable);\n\t */\n\t__ctor: function (container, x, y, unpressedImg, pressedImg=null)\n\t{\n\t\tthis._super.Group.__ctor();\n\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg || unpressedImg;\n\n\t\tthis.hitbox = new Mask (0, x, y, unpressedImg.width, unpressedImg.height).visible(false);\n\t\tthis.addChild(this.hitbox);\n\n\t\tcontainer.add(this.hitbox);\n\t\tcontainer.add(this);\n\n\t\tScreenControls.add(this);\n\t},\n\n\t/**\n\t * \tRemoves the button from the screen controls and destroys it.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis._super.Group.__dtor();\n\t\tScreenControls.remove(this);\n\t},\n\n\t/**\n\t * \tChanges the pressed/unpressed images of the button.\n\t * \t!setImage (unpressedImg: IDrawable, pressedImg?: IDrawable);\n\t */\n\tsetImage: function (unpressedImg, pressedImg=null)\n\t{\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg || unpressedImg;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tChanges the key code of the button.\n\t * \t!setKeyCode (value: System.KeyCode) : Button;\n\t */\n\tsetKeyCode: function (value)\n\t{\n\t\tthis.keyCode = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResets the button to its initial state.\n\t * \t!reset() : void;\n\t */\n\treset: function ()\n\t{\n\t\tthis.onChange (this.isPressed = false, this.wasPressed = false);\n\t},\n\n\t/**\n\t * \tRenders the element to the graphics surface.\n\t * \t!override render (g: Canvas) : void;\n\t */\n\trender: function (g)\n\t{\n\t\tif (this.isPressed)\n\t\t\tthis.pressedImg.draw (g, this.bounds.x1, this.bounds.y1);\n\t\telse\n\t\t\tthis.unpressedImg.draw (g, this.bounds.x1, this.bounds.y1);\n\t},\n\n\t/**\n\t * \tButton pointer update event. Not required for the button control.\n\t * \t!pointerUpdate (pointerX: number, pointerY: number, pointer: object) : void;\n\t */\n\tpointerUpdate: function (pointerX, pointerY, pointer)\n\t{\n\t},\n\n\t/**\n\t * \tSets the pressed state of the button.\n\t * \t!setStatus (value: boolean) : Button;\n\t */\n\tsetStatus: function (value)\n\t{\n\t\tif ((this.isPressed && value) || (!this.isPressed && !value))\n\t\t\treturn this;\n\n\t\tthis.updateStatus (value);\n\t\tthis.onChange (this.isPressed, this.wasPressed);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMoves the `isPressed` value of the button to `wasPressed`, and updates `isPressed` with the given value. If none provided, `isPressed` is unchanged.\n\t *\t!updateStatus (value?: boolean) : Button;\n\t */\n\tupdateStatus: function (value=null)\n\t{\n\t\tthis.wasPressed = this.isPressed;\n\t\tthis.isPressed = value === null ? this.isPressed : value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCalled when the PointerEventType.POINTER_DOWN event starts within the bounding box of the button.\n\t * \t!pointerActivate (pointer: object) : void;\n\t */\n\tpointerActivate: function (pointer)\n\t{\n\t\tthis.setStatus(true);\n\t},\n\n\t/**\n\t * \tCalled when the PointerEventType.POINTER_UP event is fired with the \"_ref\" attribute pointing to this object.\n\t *\t!pointerDeactivate (pointer: object) : void;\n\t */\n\tpointerDeactivate: function (pointer)\n\t{\n\t\tthis.setStatus(false);\n\t},\n\n\t/**\n\t * \tReturns `true` if the button contains the specified point.\n\t * \t!containsPoint (x: number, y: number) : boolean;\n\t */\n\tcontainsPoint: function(x, y)\n\t{\n\t\tif (!this.visible())\n\t\t\treturn false;\n\n\t\treturn this.hitbox.bounds.containsPoint(x, y);\n\t},\n\n\t/**\n\t * \tExecuted after any change in the status of the button. Be careful when overriding this, because when so, the `onTap` method will not work.\n\t * \t!onChange (isPressed: boolean, wasPressed: boolean) : void;\n\t */\n\tonChange: function (isPressed, wasPressed)\n\t{\n\t\tif (isPressed != wasPressed)\n\t\t{\n\t\t\tif (isPressed)\n\t\t\t\tthis.onButtonDown();\n\t\t\telse\n\t\t\t\tthis.onButtonUp();\n\t\t}\n\n\t\tif (!isPressed && wasPressed) this.onTap();\n\t},\n\n\t/**\n\t * \tKey down event, handles the keys that control the button.\n\t * \t!keyDown (keyCode: System.KeyCode, keyArgs: object) : boolean|null;\n\t */\n\tkeyDown: function (keyCode, keyArgs)\n\t{\n\t\tif (keyCode === this.keyCode)\n\t\t{\n\t\t\tthis.pointerActivate();\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * \tKey up event, handles the keys that control the button.\n\t * \t!keyUp (keyCode: System.KeyCode, keyArgs: object) : boolean|null;\n\t */\n\tkeyUp: function (keyCode, keyArgs)\n\t{\n\t\tif (keyCode === this.keyCode)\n\t\t{\n\t\t\tthis.pointerDeactivate();\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * \tExecuted when the button is pressed. Works only if the `onChange` method was not overriden.\n\t * \t!onButtonDown: () => void;\n\t */\n\tonButtonDown: function ()\n\t{\n\t},\n\n\t/**\n\t * \tExecuted when the button is released. Works only if the onChange method was not overriden.\n\t * \t!onButtonUp: () => void;\n\t */\n\tonButtonUp: function ()\n\t{\n\t},\n\n\t/**\n\t * \tExecuted when the button is tapped (pressed and then released). Works only if the onChange method was not overriden.\n\t * \t!onTap: () => void;\n\t */\n\tonTap: function ()\n\t{\n\t}\n});\n","/*\n**\tflow/stick\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Group from './group.js';\nimport Mask from './mask.js';\nimport ScreenControls from './screen-controls.js';\nimport KeyCode from '../system/keycode.js';\n\n//![import \"./group\"]\n//![import \"./mask\"]\n//![import \"./screen-controls\"]\n//![import \"../system/keycode\"]\n\n/**\n * \tStick class provides an easy way to add directional control sticks to the world.\n */\n\n//!class Stick extends Group\n\nexport default Group.extend\n({\n\t/**\n\t * \tIndicates if once focus is obtained it is locked until the user releases it.\n\t * \t@default false\n\t *\t!focusLock: boolean;\n\t */\n\tfocusLock: false,\n\n\t/**\n\t * \tIndicates if keyboard events are enabled on this object.\n\t * \t@default true\n\t *\t!keyboardEvents: boolean;\n\t */\n\tkeyboardEvents: true,\n\n\t/**\n\t * \tCurrent pressed status of the stick.\n\t *\t!isPressed: boolean;\n\t */\n\tisPressed: false,\n\n\t/**\n\t * \tPrevious pressed status of the stick.\n\t *\t!wasPressed: boolean;\n\t */\n\twasPressed: false,\n\n\t\t/**\n\t\t * \tImage to draw when the stick is unpressed (outer circle).\n\t\t *\t!unpressedImg: IDrawable;\n\t\t */\n\t\tunpressedImg: null,\n\n\t\t/**\n\t\t * \tImage to draw when the stick is pressed (outer circle).\n\t\t *\t!pressedImg: IDrawable;\n\t\t */\n\t\tpressedImg: null,\n\n\t/**\n\t * \tImage to draw when the stick is unpressed (inner circle).\n\t *\t!unpressedImg: IDrawable;\n\t */\n\tunpressedImgInner: null,\n\n\t/**\n\t * \tImage to draw when the stick is pressed (inner circle).\n\t *\t!pressedImg: IDrawable;\n\t */\n\tpressedImgInner: null,\n\n\t\t/**\n\t\t * \tNumber of steps for the angle. Used to snap the stick movement to discrete steps.\n\t\t * \t!angleSteps: number;\n\t\t */\n\t\tangleSteps: 0,\n\n\t\t/**\n\t\t * \tNumber of steps for the radius of the stick. Used to snap the stick movement to discrete steps.\n\t\t * \t!radiusSteps: number;\n\t\t */\n\t\tradiusSteps: 0,\n\n\t/*\n\t**\tDirection (X and Y), magnitude and angle of the stick vector. The dirx and diry are normalized.\n\t*/\n\trdirx: 0,\n\trdiry: 0,\n\n\tdirx: 0,\n\tdiry: 0,\n\n\tmagnitude: 0,\n\tangle: 0,\n\n\t/*\n\t**\tFrozen stick state. Set by calling `freezeState`.\n\t*/\n\tfrdirx: 0, frdiry: 0, fdirx: 0, fdiry: 0, fmagnitude: 0, fangle: 0,\n\n\t/*\n\t**\tIndicates the displacement in X and Y directions of the inner stick. This is calculated when the update() method is called.\n\t*/\n\tdispx: 0, dispy: 0,\n\n\t/*\n\t**\tCurrent radius of the inner stick (how far it moved). And maximum radius that the inner stick can move.\n\t*/\n\tradius: 0, maxRadius: 0,\n\n\t/*\n\t**\tDead zone values for each axis.\n\t*/\n\tdeadZoneX: 0, deadZoneY: 0,\n\n\t/*\n\t**\tHitbox element.\n\t*/\n\thitbox: 0,\n\n\t/**\n\t * \tCreates the stick with the specified parameters. Automatically adds it to the screen controls.\n\t * \t!constructor (container: Container, x: number, y: number, maxRadius: number, unpressedImg: IDrawable, unpressedImgInner: IDrawable, pressedImg?: IDrawable, pressedImgInner?: IDrawable);\n\t */\n\t__ctor: function (container, x, y, maxRadius, unpressedImg, unpressedImgInner, pressedImg=null, pressedImgInner=null)\n\t{\n\t\tthis._super.Group.__ctor();\n\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg || unpressedImg;\n\n\t\tthis.unpressedImgInner = unpressedImgInner;\n\t\tthis.pressedImgInner = pressedImgInner || unpressedImgInner;\n\n\t\tthis.maxRadius = maxRadius;\n\n\t\tthis.deadZoneX = 0;\n\t\tthis.deadZoneY = 0;\n\n\t\tthis.hitbox = new Mask(0, x, y, unpressedImg.width, unpressedImg.height).visible(false);\n\t\tthis.addChild(this.hitbox);\n\n\t\tcontainer.add(this.hitbox);\n\t\tcontainer.add(this);\n\n\t\tScreenControls.add(this);\n\t},\n\n\t/**\n\t * \tRemoves the button from the screen controls and destroys it.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis._super.Group.__dtor();\n\t\tScreenControls.remove(this);\n\t},\n\n\t/**\n\t * \tChanges the pressed/unpressed images of the outer stick.\n\t * \t!setImage (unpressedImg: IDrawable, pressedImg?: IDrawable) : Stick;\n\t */\n\tsetImage: function (unpressedImg, pressedImg=null)\n\t{\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg || unpressedImg;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tChanges the pressed/unpressed images of the inner stick.\n\t * \t!setImageInner (unpressedImg: IDrawable, pressedImg?: IDrawable) : Stick;\n\t */\n\tsetImageInner: function (unpressedImg, pressedImg=null)\n\t{\n\t\tthis.unpressedImgInner = unpressedImg;\n\t\tthis.pressedImgInner = pressedImg || unpressedImg;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the number of angle-steps for the stick.\n\t * \t!setAngleSteps (n: number) : Stick;\n\t */\n\tsetAngleSteps: function (n)\n\t{\n\t\tthis.angleSteps = n;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the number of radius-steps for the stick.\n\t * \t!setRadiusSteps (n: number) : Stick;\n\t */\n\tsetRadiusSteps: function (n)\n\t{\n\t\tthis.radiusSteps = n;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the dead zone values (normalized).\n\t * \t!setDeadZone (deadZoneX: number, deadZoneY: number) : Stick;\n\t */\n\tsetDeadZone: function (deadZoneX, deadZoneY)\n\t{\n\t\tthis.deadZoneX = deadZoneX;\n\t\tthis.deadZoneY = deadZoneY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResets the button to its initial state.\n\t * \t!reset() : void;\n\t */\n\treset: function ()\n\t{\n\t\tthis.dispx = 0;\n\t\tthis.dispy = 0;\n\n\t\tthis.rdirx = 0;\n\t\tthis.rdiry = 0;\n\n\t\tthis.dirx = 0;\n\t\tthis.diry = 0;\n\t\tthis.magnitude = 0;\n\n\t\tthis.onChange(this.dirx, this.diry, this.magnitude, this.angle);\n\t},\n\n\t/**\n\t * \tRenders the element to the graphics surface.\n\t * \t!render (g: Canvas) : void;\n\t */\n\trender: function (g)\n\t{\n\t\tif (this.isPressed)\n\t\t{\n\t\t\tthis.pressedImg.draw (g, this.bounds.x1, this.bounds.y1);\n\t\t\tthis.pressedImgInner.draw (g, this.bounds.x1 + this.dispx, this.bounds.y1 + this.dispy);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.unpressedImg.draw (g, this.bounds.x1, this.bounds.y1);\n\t\t\tthis.unpressedImgInner.draw (g, this.bounds.x1, this.bounds.y1);\n\t\t}\n\t},\n\n\t/**\n\t * \tButton pointer update event. Not required for the button control.\n\t * \t!pointerUpdate (pointerX: number, pointerY: number, pointer: object) : void;\n\t */\n\tpointerUpdate: function (pointerX, pointerY)\n\t{\n\t\tlet dx = pointerX - this.bounds.cx;\n\t\tlet dy = pointerY - this.bounds.cy;\n\n\t\tthis.angle = Math.atan2(-dy, dx);\n\t\tthis.radius = Math.sqrt(dx*dx + dy*dy);\n\n\t\tif (this.radius > this.maxRadius)\n\t\t\tthis.radius = this.maxRadius;\n\n\t\tif (this.angleSteps)\n\t\t{\n\t\t\tlet fs = (2*Math.PI / this.angleSteps);\n\t\t\tthis.angle = int((this.angle + Math.PI + fs/2) / fs) * fs - Math.PI;\n\t\t}\n\n\t\tif (this.radiusSteps)\n\t\t{\n\t\t\tlet fs = (this.maxRadius / this.radiusSteps);\n\t\t\tthis.radius = int((this.radius + fs/2) / fs) * fs;\n\t\t}\n\n\t\tthis.rdirx = Math.min(1, Math.max(dx / this.maxRadius, -1));\n\t\tthis.rdiry = Math.min(1, Math.max(dy / this.maxRadius, -1));\n\n\t\tthis.dispx = this.radius * Math.cos(this.angle);\n\t\tthis.dispy = this.radius * -Math.sin(this.angle);\n\n\t\tif (this.radius > 0)\n\t\t{\n\t\t\tthis.dirx = this.dispx / this.radius;\n\t\t\tthis.diry = this.dispy / this.radius;\n\n\t\t\tthis.magnitude = this.radius / this.maxRadius;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.dirx = 0;\n\t\t\tthis.diry = 0;\n\n\t\t\tthis.magnitude = 0;\n\t\t}\n\n\t\tif (Math.abs(this.rdirx) < this.deadZoneX) {\n\t\t\tthis.rdirx = 0;\n\t\t\tthis.dirx = 0;\n\t\t}\n\n\t\tif (Math.abs(this.rdiry) < this.deadZoneY) {\n\t\t\tthis.rdiry = 0;\n\t\t\tthis.diry = 0;\n\t\t}\n\n\t\tthis.onChange(this.dirx, this.diry, this.magnitude, this.angle);\n\t},\n\n\t/**\n\t * \tCalled when the PointerEventType.POINTER_DOWN event starts within the bounding box of the stick.\n\t * \t!pointerActivate (pointer: object) : void;\n\t */\n\tpointerActivate: function (pointer)\n\t{\n\t\tthis.wasPressed = this.isPressed;\n\t\tthis.isPressed = 1;\n\n\t\tthis.pointerUpdate(pointer.x, pointer.y);\n\t},\n\n\t/**\n\t * \tCalled when the PointerEventType.POINTER_UP event is fired with the \"_ref\" attribute pointing to this object.\n\t *\t!pointerDeactivate (pointer: object) : void;\n\t */\n\tpointerDeactivate: function (pointer)\n\t{\n\t\tthis.wasPressed = this.isPressed;\n\t\tthis.isPressed = 0;\n\n\t\tthis.reset();\n\t},\n\n\t/**\n\t * \tReturns `true` if the stick contains the specified point.\n\t * \t!containsPoint (x: number, y: number) : boolean;\n\t */\n\tcontainsPoint: function(x, y)\n\t{\n\t\tif (!this.visible())\n\t\t\treturn false;\n\n\t\treturn this.hitbox.bounds.containsPoint(x, y);\n\t},\n\n\t/**\n\t * \tSets the direction of the stick, the provided deltas should be normalized in the [-1, 1] range.\n\t * \t!setDirection (dx: number, dy: number, deadZoneX?: number, deadZoneY?: number) : boolean;\n\t */\n\tsetDirection: function (dx, dy, deadZoneX=0.10, deadZoneY=0.10)\n\t{\n\t\tif (Math.abs(dx) < deadZoneX) dx = 0;\n\t\tif (Math.abs(dy) < deadZoneY) dy = 0;\n\n\t\tthis.wasPressed = this.isPressed;\n\t\tthis.isPressed = dx == 0 && dy == 0 ? 0 : 1;\n\n\t\tthis.pointerUpdate (this.bounds.cx + dx*this.maxRadius, this.bounds.cy + dy*this.maxRadius);\n\t\treturn false;\n\t},\n\n\t/**\n\t * \tSaves the current state of the stick in the f* variables (fdirx, fdiry, etc). When the `lastValid` parameter is true, the values will\n\t * \tbe saved on each field only if the current value is not zero.\n\t * \t!freezeState (lastValid?: boolean) : Stick;\n\t */\n\tfreezeState: function (lastValid=false)\n\t{\n\t\tthis.frdirx = lastValid ? (this.rdirx != 0 ? this.rdirx : this.frdirx) : this.rdirx;\n\t\tthis.frdiry = lastValid ? (this.rdiry != 0 ? this.rdiry : this.frdiry) : this.rdiry;\n\t\tthis.fdirx = lastValid ? (this.dirx != 0 ? this.dirx : this.fdirx) : this.dirx;\n\t\tthis.fdiry = lastValid ? (this.diry != 0 ? this.diry : this.fdiry) : this.diry;\n\t\tthis.fmagnitude = lastValid ? (this.magnitude != 0 ? this.magnitude : this.fmagnitude) : this.magnitude;\n\t\tthis.fangle = lastValid ? (this.angle != 0 ? this.angle : this.fangle) : this.angle;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tKey down event, handles the keys that control the direction of the stick.\n\t * \t!keyDown (keyCode: System.KeyCode, keyArgs: object) : boolean|null;\n\t */\n\tkeyDown: function (keyCode, keyArgs)\n\t{\n\t\tlet dx = 0;\n\t\tlet dy = 0;\n\n\t\tif (keyArgs[KeyCode.UP] === true) dy = -this.maxRadius;\n\t\tif (keyArgs[KeyCode.LEFT] === true) dx = -this.maxRadius;\n\t\tif (keyArgs[KeyCode.DOWN] === true) dy = this.maxRadius;\n\t\tif (keyArgs[KeyCode.RIGHT] === true) dx = this.maxRadius;\n\n\t\tif (keyCode === KeyCode.UP || keyCode === KeyCode.LEFT || keyCode === KeyCode.DOWN || keyCode === KeyCode.RIGHT)\n\t\t{\n\t\t\tdx = this.bounds.cx + dx;\n\t\t\tdy = this.bounds.cy + dy;\n\n\t\t\tthis.wasPressed = this.isPressed;\n\t\t\tthis.isPressed = 1;\n\n\t\t\tthis.pointerUpdate (dx, dy);\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * \tKey up event, handles the keys that control the direction of the stick.\n\t * \t!keyUp (keyCode: System.KeyCode, keyArgs: object) : boolean|null;\n\t */\n\tkeyUp: function (keyCode, keyArgs)\n\t{\n\t\tlet dx = 0;\n\t\tlet dy = 0;\n\n\t\tif (keyArgs[KeyCode.UP] === true) dy = -this.maxRadius;\n\t\tif (keyArgs[KeyCode.LEFT] === true) dx = -this.maxRadius;\n\t\tif (keyArgs[KeyCode.DOWN] === true) dy = this.maxRadius;\n\t\tif (keyArgs[KeyCode.RIGHT] === true) dx = this.maxRadius;\n\n\t\tif (keyCode === KeyCode.UP || keyCode === KeyCode.LEFT || keyCode === KeyCode.DOWN || keyCode === KeyCode.RIGHT)\n\t\t{\n\t\t\tthis.pointerUpdate (this.bounds.cx + dx, this.bounds.cy + dy);\n\n\t\t\tif (dx === 0 && dy === 0)\n\t\t\t{\n\t\t\t\tthis.wasPressed = this.isPressed;\n\t\t\t\tthis.isPressed = 0;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * \tExecuted after any change in the direction of the stick.\n\t * \t!onChange: (dirx: number, diry: number, magnitude: number, angle: number) => void;\n\t */\n\tonChange: function (dirx, diry, magnitude, angle)\n\t{\n\t}\n});\n","\nimport System from '../system/system.js';\nimport Resources from '../resources/resources.js';\nimport Boot from '../flow/boot.js';\nimport Handler from '../utils/handler.js';\n\n//!class sys\n\nconst system =\n{\n\t/**\n\t * \tIndicates if the system module has already been initialized.\n\t * \t!static readonly initialized: boolean;\n\t */\n\tinitialized: false,\n\n\t/**\n\t * \tScreen width (available after calling `init`).\n\t * \t!static readonly screenWidth: number;\n\t */\n\tscreenWidth: 0,\n\n\t/**\n\t * \tScreen height (available after calling `init`).\n\t * \t!static readonly screenHeight: number;\n\t */\n\tscreenHeight: 0,\n\n\t/**\n\t * \tPrimary renderer (available after calling `init`).\n\t * \t!static readonly renderer: Canvas;\n\t */\n\trenderer: null,\n\n\t/**\n\t * \tLogical system time (mirrors the value of System.frameTime).\n\t * \t!static readonly time: Number;\n\t */\n\ttime: 0,\n\n\t/**\n\t * \tLogical system delta time (mirrors the value of System.frameDelta).\n\t * \t!static readonly dt: Number;\n\t */\n\tdt: 0,\n\n\t/**\n\t * \tUpdate handler executed on every frame start.\n\t * \t!static readonly update: Handler;\n\t */\n\tupdate: null,\n\n\t/**\n\t * \tSystem initialization options.\n\t */\n\toptions:\n\t{\n\t\t/**\n\t\t * \tTells the system to enable WebGL support.\n\t\t */\n\t\tgl: true,\n\n\t\t/**\n\t\t * \tIndicates if on-screen logging should be enabled.\n\t\t */\n\t\tlog: false,\n\n\t\t/**\n\t\t * \tEnables or disables antialised canvas. Set to `false` when pixel-perfect is desired.\n\t\t */\n\t\tantialias: false,\n\n\t\t/**\n\t\t * \tBackground of the system canvas.\n\t\t */\n\t\tbackground: '#000000',\n\n\t\t/**\n\t\t * \tDesired orientaton of the display.\n\t\t */\n\t\torientation: 'automatic',\n\n\t\t/**\n\t\t * \tDesired display width. When not specified (null) the maximum screen width to maintain the aspect ratio will be used.\n\t\t */\n\t\tscreenWidth: null,\n\n\t\t/**\n\t\t * \tDesired display height. When not specified (null) the maximum screen height to maintain the aspect ratio will be used.\n\t\t */\n\t\tscreenHeight: null,\n\n\t\t/**\n\t\t * \tTarget frames per second (FPS). Used to determine delay between frames.\n\t\t */\n\t\tfps: 144,\n\n\t\t/**\n\t\t * \tMinimum allowed frames per second (FPS). If system FPS drops below this value, the `frameDelta` property of System will be truncated to 1/minFps.\n\t\t */\n\t\tminFps: 24\n\t},\n\n\t/**\n\t * \tInitializes the system with the specified options.\n\t * \t!static init (options: System.Options) : Promise<void>;\n\t */\n\t/**\n\t * \tInitializes the system using the default options.\n\t * \t!static init () : Promise<void>;\n\t */\n\tinit: function (options)\n\t{\n\t\treturn new Promise ((resolve, reject) =>\n\t\t{\n\t\t\tif (this.initialized)\n\t\t\t\treturn resolve();\n\n\t\t\tObject.assign(this.options, options);\n\n\t\t\tResources.init ({ pixelated: !this.antialias });\n\t\t\tSystem.init (this.options);\n\n\t\t\tSystem.updateQueueAdd\n\t\t\t({\n\t\t\t\tupdate: function(dt)\n\t\t\t\t{\n\t\t\t\t\tsystem.time = System.frameTime;\n\t\t\t\t\tsystem.dt = dt;\n\n\t\t\t\t\tsystem.update.host = dt;\n\t\t\t\t\tsystem.update.exec();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tBoot.startup(function()\n\t\t\t{\n\t\t\t\tSystem.start();\n\n\t\t\t\tsystem.screenWidth = System.screenWidth;\n\t\t\t\tsystem.screenHeight = System.screenHeight;\n\t\t\t\tsystem.renderer = System.renderer;\n\n\t\t\t\tsystem.update = Handler.Pool.alloc();\n\n\t\t\t\tsystem.initialized = true;\n\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n};\n\nexport default system;\n","\nimport System from '../system/system.js';\nimport Scene from '../flow/scene.js';\nimport Viewport from '../flow/viewport.js';\nimport Bounds2 from '../math/bounds2.js';\nimport GridContainer from '../flow/grid-container.js';\nimport Element from '../flow/element.js';\nimport Label from '../flow/label.js';\nimport Group from '../flow/group.js';\nimport Updater from '../flow/updater.js';\nimport SimpleContainer from '../flow/simple-container.js';\nimport Mask from '../flow/mask.js';\n\nimport system from './system.js';\n\n/**\n * \tWorld system allows to manage scenes containers, viewports and display elements.\n */\n\nconst world =\n{\n\t/**\n\t *\tBuilt-in scenes.\n\t */\n\tSCENE_MAIN: 0,\n\tSCENE_HUD: 1,\n\n\t/**\n\t *\tDefault layers for the SCENE_MAIN scene.\n\t */\n\tLAYER_BG0: 0,\n\tLAYER_BG1: 1,\n\tLAYER_BG2: 2,\n\tLAYER_BG3: 3,\n\tLAYER_MAIN: 4,\n\tLAYER_FG0: 5,\n\tLAYER_FG1: 6,\n\tLAYER_FG2: 7,\n\tLAYER_FG3: 8,\n\tLAYER_MASK: 9,\n\n\t/**\n\t *\tDefault layers for the SCENE_HUD scene.\n\t */\n\tLAYER_HUD_BG0: 0,\n\tLAYER_HUD_BG1: 1,\n\tLAYER_HUD_MAIN: 2,\n\tLAYER_HUD_FG0: 3,\n\tLAYER_HUD_FG1: 4,\n\n\t/**\n\t *\tScenes and active scene.\n\t */\n\t_scenes: [],\n\tactiveScene: null,\n\n\t/**\n\t *\tViewports and active viewport.\n\t */\n\t_viewports: [],\n\tactiveViewport: null,\n\n\t/**\n\t *\tActive container.\n\t */\n\tactiveContainer: null,\n\n\t/**\n\t *\tActive and last ended group.\n\t */\n\tactiveGroup: null,\n\tlastGroup: null,\n\n\t/**\n\t *\tLast element created.\n\t */\n\tlastElement: null,\n\n\t/**\n\t *\tDimensions of the world.\n\t */\n\tbounds: Bounds2.Pool.alloc(),\n\n\t/**\n\t * \tInitializes the world with the default scenes, viewports and layers.\n\t */\n\tinit: function (worldWidth=32768, worldHeight=32768, divisor=null)\n\t{\n\t\tif (divisor === null)\n\t\t\tdivisor = Math.max(worldWidth, worldHeight) / 512;\n\n\t\tif (divisor < 32)\n\t\t\tdivisor = 32;\n\n\t\tthis.bounds.zero().resize(worldWidth, worldHeight);\n\n\t\tthis.createScene(world.SCENE_MAIN);\n\t\tthis.setContainer(world.LAYER_BG0, new GridContainer (worldWidth, worldHeight, divisor));\n\t\tthis.setContainer(world.LAYER_BG1, new GridContainer (worldWidth, worldHeight, divisor));\n\t\tthis.setContainer(world.LAYER_BG2, new GridContainer (worldWidth, worldHeight, divisor));\n\t\tthis.setContainer(world.LAYER_BG3, new GridContainer (worldWidth, worldHeight, divisor));\n\t\tthis.setContainer(world.LAYER_MAIN, new GridContainer (worldWidth, worldHeight, divisor));\n\t\tthis.setContainer(world.LAYER_FG0, new GridContainer (worldWidth, worldHeight, divisor));\n\t\tthis.setContainer(world.LAYER_FG1, new GridContainer (worldWidth, worldHeight, divisor));\n\t\tthis.setContainer(world.LAYER_FG2, new GridContainer (worldWidth, worldHeight, divisor));\n\t\tthis.setContainer(world.LAYER_FG3, new GridContainer (worldWidth, worldHeight, divisor));\n\n\t\tthis.setContainer(world.LAYER_MASK, new GridContainer (worldWidth, worldHeight, divisor));\n\t\tthis.getContainer(world.LAYER_MASK).visible(false);\n\t\tthis.createViewport(0);\n\n\t\tthis.createScene(world.SCENE_HUD);\n\t\tthis.setContainer(world.LAYER_HUD_BG0, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_BG1, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_MAIN, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_FG0, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_FG1, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t},\n\n\t/**\n\t * \tCreates a scene for the system at the specified index and automatically selects it.\n\t */\n\tcreateScene: function (index)\n\t{\n\t\tif (this._scenes[index])\n\t\t{\n\t\t\tSystem.queueRemove(this._scenes[index]);\n\t\t\tglobal.dispose(this._scenes[index]);\n\t\t}\n\n\t\tthis._scenes[index] = new Scene(index);\n\t\tSystem.queueAdd(this._scenes[index]);\n\n\t\tthis.selectScene(index);\n\t},\n\n\t/**\n\t * \tReturns the scene at the specified index (or the active scene).\n\t */\n\tgetScene: function (index=null)\n\t{\n\t\tif (index === null)\n\t\t\treturn this.activeScene;\n\n\t\tif (index < 0 || index >= this._scenes.length)\n\t\t\treturn null;\n\n\t\treturn this._scenes[index];\n\t},\n\n\t/**\n\t *\tSelects the active scene for subsequence scene-level operations.\n\t */\n\tselectScene: function (index)\n\t{\n\t\tif (index < 0 || index >= this._scenes.length || !this._scenes[index])\n\t\t\treturn false;\n\n\t\tthis.activeScene = this._scenes[index];\n\t\tthis.activeContainer = null;\n\n\t\treturn true;\n\t},\n\n\t/**\n\t *\tCreates a viewport at the specified index, attaches it to the active scene and selects it. Use this after attaching all containers\n\t *\tto the scene or the maxWidth and maxHeight properties of the scene will not be properly set yet.\n\t */\n\tcreateViewport: function (index)\n\t{\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('createViewport: use `selectScene` first to select the active scene.');\n\n\t\tif (this._viewports[index])\n\t\t{\n\t\t\tglobal.dispose(this._viewports[index]);\n\t\t\tthis.activeScene.setViewport(index, null);\n\t\t}\n\n\t\tthis._viewports[index] = new Viewport(\n\t\t\t0, 0,\n\t\t\tsystem.screenWidth, system.screenHeight,\n\t\t\tthis.activeScene.maxWidth, this.activeScene.maxHeight\n\t\t);\n\n\t\tthis.activeScene.setViewport(index, this._viewports[index]);\n\n\t\tthis.selectViewport(index);\n\t},\n\n\t/**\n\t *\tReturns a viewport given its index (or the active viewport).\n\t */\n\tgetViewport: function (index=null)\n\t{\n\t\tif (index === null)\n\t\t\treturn this.activeViewport;\n\n\t\tif (index < 0 || index >= this._viewports.length)\n\t\t\treturn null;\n\n\t\treturn this._viewports[index];\n\t},\n\n\t/**\n\t *\tSelects the active viewport for subsequence viewport-level operations.\n\t */\n\tselectViewport: function (index)\n\t{\n\t\tif (index < 0 || index >= this._viewports.length || !this._viewports[index])\n\t\t\treturn false;\n\n\t\tthis.activeViewport = this._viewports[index];\n\t\treturn true;\n\t},\n\n\t/**\n\t *\tSets a container in the active scene and returns it.\n\t */\n\tsetContainer: function (index, container)\n\t{\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('setContainer: use `selectScene` first to select the active scene.');\n\n\t\tthis.activeScene.setContainer (index, container);\n\t\treturn container;\n\t},\n\n\t/**\n\t *\tReturns the container of the active scene at the specified index (or the active container).\n\t */\n\tgetContainer: function (index=null, throwErrors=false)\n\t{\n\t\tif (index === null)\n\t\t{\n\t\t\tif (this.activeContainer === null && throwErrors)\n\t\t\t\tthrow new Error ('getContainer: container index not specified and default container not set.');\n\n\t\t\treturn this.activeContainer;\n\t\t}\n\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('getContainer: use `selectScene` first to select the active scene.');\n\n\t\tlet container = this.activeScene.getContainer(index);\n\t\tif (container === null && throwErrors)\n\t\t\tthrow new Error ('getContainer: container index out of bounds.');\n\n\t\treturn container;\n\t},\n\n\t/**\n\t *\tSelects the active container.\n\t */\n\tselectContainer: function (index)\n\t{\n\t\tthis.activeContainer = this.getContainer(index, true);\n\t\treturn this.activeContainer !== null;\n\t},\n\n\t/**\n\t *\tCreates a group in the active scene and selects it as the active group.\n\t */\n\tcreateGroup: function(id=null)\n\t{\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('createGroup: use selectScene first to select the active scene.');\n\n\t\tthis.activeGroup = Group.Pool.alloc(id);\n\t\tthis.activeScene.addGroup (this.activeGroup);\n\n\t\treturn this.activeGroup;\n\t},\n\n\t/**\n\t *\tStores the activeGroup in `lastGroup` property, then nullifies activeGroup. If the coordinate parameters are provided the group will be translated to\n\t *\tthe specified position first.\n\t */\n\tendGroup: function(x=null, y=null)\n\t{\n\t\tif (x !== null)\n\t\t\tthis.activeGroup.translate(x, y);\n\n\t\tthis.lastGroup = this.activeGroup;\n\t\tthis.activeGroup = null;\n\n\t\treturn this.lastGroup.sync();\n\t},\n\n\t/**\n\t *\tCreates an Element with the given position and image, and adds it to the specified container (or the default one) in the\n\t *\tactive scene. If a group is active, the element will be attached to the group.\n\t */\n\tcreateElement: function (id, x, y, img=null, containerIndex=null)\n\t{\n\t\tif (typeof(id) !== 'string')\n\t\t{\n\t\t\tcontainerIndex = img;\n\t\t\timg = y;\n\t\t\ty = x;\n\t\t\tx = id;\n\t\t\tid = null;\n\t\t}\n\n\t\tlet container = this.getContainer(containerIndex);\n\n\t\tlet elem = Element.Pool.alloc(x, y, img);\n\t\tcontainer.add(elem.setId(id));\n\n\t\tif (this.activeGroup !== null)\n\t\t\tthis.activeGroup.addChild(elem);\n\n\t\tthis.lastElement = elem;\n\t\treturn elem;\n\t},\n\n\t/**\n\t *\tCreates a default element mask for the active group.\n\t */\n\tcreateMask: function (id, type=null, x=null, y=null, width=null, height=null, containerIndex=null)\n\t{\n\t\tif (typeof(id) !== 'string')\n\t\t{\n\t\t\tcontainerIndex = height;\n\t\t\theight = width;\n\t\t\twidth = y;\n\t\t\ty = x;\n\t\t\tx = type;\n\t\t\ttype = id;\n\t\t\tid = null;\n\t\t}\n\n\t\tlet container = this.getContainer(containerIndex || world.LAYER_MASK);\n\n\t\tif (x === null)\n\t\t{\n\t\t\tif (this.activeGroup === null)\n\t\t\t\tthrow new Error ('createMask: create a group first to use automatic masks');\n\n\t\t\tx = this.activeGroup.bounds.x1;\n\t\t\ty = this.activeGroup.bounds.y1;\n\t\t\twidth = this.activeGroup.bounds.width();\n\t\t\theight = this.activeGroup.bounds.height();\n\t\t}\n\n\t\tlet mask = Mask.Pool.alloc(type, x, y, width, height);\n\t\tcontainer.add(mask.setId(id));\n\n\t\tif (this.activeGroup !== null)\n\t\t\tthis.activeGroup.addChild(mask);\n\n\t\treturn mask;\n\t},\n\n\t/**\n\t *\tCreates a text element with the given position and text, and adds it to the specified container (or the default one) in the\n\t *\tactive scene. If a group is active, the element will be attached to the group.\n\t */\n\tcreateLabel: function (id, x, y, font, text, containerIndex=null)\n\t{\n\t\tif (typeof(id) !== 'string')\n\t\t{\n\t\t\tcontainerIndex = text;\n\t\t\ttext = font;\n\t\t\tfont = y;\n\t\t\ty = x;\n\t\t\tx = id;\n\t\t\tid = null;\n\t\t}\n\n\t\tlet container = this.getContainer(containerIndex);\n\n\t\tlet elem = Label.Pool.alloc(x, y, font, text);\n\t\tcontainer.add(elem.setId(id));\n\n\t\tif (this.activeGroup !== null)\n\t\t\tthis.activeGroup.addChild(elem);\n\n\t\tthis.lastElement = elem;\n\t\treturn elem;\n\t},\n\n\t/**\n\t *\tCreates a new updater, attaches it to the active scene and returns it.\n\t */\n\tcreateUpdater: function (update=null, context=null)\n\t{\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('createUpdater: use selectScene first to select the active scene.');\n\n\t\treturn new Updater (this.activeScene, update, context);\n\t}\n};\n\nexport default world;\n","\n/*\n**\tRegistered resources. Initially these are resource descriptors, but after a call to `res.load` these will be fully loaded resources.\n*/\n\nconst r = {\n};\n\nexport default r;\n","\nimport Resources from '../resources/resources.js';\n\nimport r from './r.js';\n\n/**\n * \tResource manager allows to specify resource descriptors to load them.\n */\n\n//!class res\n\nconst res =\n{\n\t/**\n\t * \tLoads all registered resources that have not been loaded yet.\n\t * \t!static load (progressCallback?: (level: number) => void) : Promise<void>;\n\t */\n\tload: function(progressCallback=null)\n\t{\n\t\treturn new Promise (function (resolve, reject)\n\t\t{\n\t\t\tResources.load (r,\n\t\t\t\tfunction (index, total, value) {\n\t\t\t\t\tif (progressCallback) progressCallback(value);\n\t\t\t\t},\n\t\t\t\tfunction () {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t},\n\n\t/**\n\t * \tReturns a resource given its identifier.\n\t * \t@param id - Resource identifier.\n\t * \t!static get (id: string) : object;\n\t */\n\tget: function (id)\n\t{\n\t\treturn r[id];\n\t},\n\n\t/**\n\t * \tChecks if the ID exists in the fxl `r` map, throws an error if it does.\n\t */\n\t__resIdMustNotExist: function (id)\n\t{\n\t\tif (id in r) throw new Error ('Resource identifier `' + id + '` is already in use');\n\t},\n\n\t/**\n\t * \tRegisters a solid-color placeholder resource.\n\t * \t@param id - Resource identifier.\n\t * \n\t * \t!static placeholder (id: string, color: string, width: number, height: number) : object;\n\t */\n\tplaceholder: function (id, color, width, height)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'object', wrapper: 'Placeholder', color: color, width: width, height: height };\n\t},\n\n\t/**\n\t * \tRegisters an image resource.\n\t * \t@param id - Resource identifier.\n\t * \n\t * \t!static image (id: string, path: string, opts?: object) : object;\n\t */\n\timage: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'image', wrapper: 'Drawable', src: path, pixelated: null, ...opts };\n\t},\n\n\t/**\n\t * \tRegisters an spritesheet resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static spritesheet (id: string, path: string, frameWidth: number, frameHeight: number, numFrames?: number, optsA?: object, optsB?: object) : object;\n\t */\n\tspritesheet: function (id, path, frameWidth, frameHeight, numFrames=0, optsA=null, optsB=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'image', wrapper: 'Spritesheet', src: path, pixelated: null,\n\t\t\tconfig: {\n\t\t\t\tframeWidth: frameWidth, frameHeight: frameHeight, numFrames: numFrames, ...optsA\n\t\t\t},\n\t\t\t...optsB\n\t\t};\n\t},\n\n\t/**\n\t * \tRegisters a spritesheet animation resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static animation (id: string, path: string, frameWidth: number, frameHeight: number, numFrames?: number, configOptions?: object, resOptions?: object) : object;\n\t */\n\tanimation: function (id, path, frameWidth, frameHeight, numFrames=null, configOptions=null, resOptions=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'image', wrapper: 'SpritesheetAnimation', src: path,\n\t\t\tconfig: {\n\t\t\t\tframeWidth: frameWidth, frameHeight: frameHeight, numFrames: numFrames, ...configOptions\n\t\t\t},\n\n\t\t\tanim: {\n\t\t\t\tdef: null, fps: 15, seq: { }, trans: { }\n\t\t\t},\n\n\t\t\t...resOptions,\n\n\t\t\tfps: function(value) {\n\t\t\t\tthis.anim.fps = value;\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\tseq: function(id, loop, group, fps=null)\n\t\t\t{\n\t\t\t\tthis.anim.seq[id] = { loop: loop, group: group };\n\n\t\t\t\tif (fps !== null)\n\t\t\t\t\tthis.anim.seq[id].fps = fps;\n\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\ttrans: function(srcSeq, dstSeq, group)\n\t\t\t{\n\t\t\t\tif (!(srcSeq in this.anim.trans))\n\t\t\t\t\tthis.anim.trans[srcSeq] = { };\n\n\t\t\t\tthis.anim.trans[srcSeq][dstSeq] = group;\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\tdef: function(value) {\n\t\t\t\tthis.anim.def = value;\n\t\t\t\treturn this;\n\t\t\t}\n\t\t};\n\t},\n\n\t/**\n\t * \tRegisters a spritefont animation resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static spritefont (id: string, path: string, charWidth: number, charHeight: number, charset: string, optsA?: object, optsB?: object) : object;\n\t */\n\tspritefont: function (id, path, charWidth, charHeight, charset, optsA=null, optsB=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\t\t\n\t\treturn r[id] = { type: 'image', wrapper: 'SpriteFont', src: path,\n\t\t\tfont: {\n\t\t\t\tcharWidth: charWidth, charHeight: charHeight, charset: charset, ...optsA\n\t\t\t},\n\t\t\t...optsB\n\t\t};\n\t},\n\n\t/**\n\t * \tRegisters a JSON data resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static json (id: string, path: string, opts?: object) : object;\n\t */\n\tjson: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'json', src: path, ...opts };\n\t},\n\n\t/**\n\t * \tRegisters a binary data resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static data (id: string, path: string, opts?: object) : object;\n\t */\n\tdata: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'data', src: path, ...opts };\n\t},\n\n\t/**\n\t * \tRegisters a text data resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static text (id: string, path: string, opts?: object) : object;\n\t */\n\ttext: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'text', src: path, ...opts };\n\t},\n\n\t/**\n\t * \tRegisters a sound effect audio resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static sfx (id: string, path: string, opts?: object) : object;\n\t */\n\tsfx: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'audio', wrapper: 'Sound', src: path, track: 'sfx', ...opts };\n\t},\n\n\t/**\n\t * \tRegisters a multi sound effect audio resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file. Ensure to add the \"#\" marks to replace the file index (i.e. \"sound-##.ogg\").\n\t * \t@param count - Number of sounds to load (from 0 to count-1).\n\t * \t@param mode - Playback mode, can be `sequential` (default) or `random`.\n\t * \n\t * \t!static sfxm (id: string, path: string, opts?: object) : object;\n\t */\n\tsfxm: function (id, path, count, mode='sequential')\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\t\treturn r[id] = { type: 'audios', wrapper: 'SoundArray', src: path, count: count, track: 'sfx', mode: mode };\n\t},\n\n\t/**\n\t * \tRegisters an music audio resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static music (id: string, path: string, opts?: object) : object;\n\t */\n\tmusic: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'audio', wrapper: 'Sound', src: path, track: 'music', ...opts };\n\t}\n};\n\nexport default res;\n","\nimport { Class } from '@rsthn/rin';\nimport Stick from '../flow/stick.js';\nimport Button from '../flow/button.js';\n\n/*\n**\tGamepads are input objects that allow sticks and buttons to be added to it.\n*/\n\nconst Gamepad = Class.extend\n({\n\t/*\n\t**\tContains the sticks of the gamepad.\n\t*/\n\tsticks: null,\n\n\t/*\n\t**\tContains the buttons of the gamepad.\n\t*/\n\tbuttons: null,\n\n\t/*\n\t**\tWorld scene where the container is defined.\n\t*/\n\tscene: null,\n\n\t/*\n\t**\tContainer where the gamepad controls will be defined.\n\t*/\n\tcontainer: null,\n\n\t/*\n\t**\tIndicates the visible state of the gamepad.\n\t*/\n\t_visible: true,\n\n\t/*\n\t**\tConstructs a new gamepad object.\n\t*/\n\t__ctor: function(scene, containerIndex)\n\t{\n\t\tthis.sticks = { };\n\t\tthis.buttons = { };\n\n\t\tthis.scene = scene;\n\n\t\tthis.layer = scene.getContainer(containerIndex);\n\t\tthis.layer.depthFlag(false);\n\t},\n\n\t/*\n\t**\tCreates a new stick control and adds it to the gamepad.\n\t*/\n\taddStick: function (id, x, y, outerDrawable, innerDrawable, maxRadius=0)\n\t{\n\t\tif (maxRadius == 0)\n\t\t\tmaxRadius = outerDrawable.width - innerDrawable.width;\n\n\t\tlet stick = new Stick (this.layer, x, y, maxRadius, outerDrawable, innerDrawable);\n\n\t\tthis.sticks[id] = stick;\n\t\tthis[id] = stick;\n\n\t\treturn stick;\n\t},\n\n\t/*\n\t**\tCreates a new button control and adds it to the gamepad.\n\t*/\n\taddButton: function (id, x, y, unpressedDrawable, pressedDrawable=null)\n\t{\n\t\tlet button = new Button (this.layer, x, y, unpressedDrawable, pressedDrawable);\n\n\t\tthis.buttons[id] = button;\n\t\tthis[id] = button;\n\n\t\treturn button;\n\t},\n\n\t/*\n\t**\tGets or sets the `visible` property of all gamepad controls.\n\t*/\n\tvisible: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._visible;\n\n\t\tthis._visible = value;\n\n\t\tfor (let i in this.sticks)\n\t\t\tthis.sticks[i].visible(value);\n\n\t\tfor (let i in this.buttons)\n\t\t\tthis.buttons[i].visible(value);\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the `visible` property of all masks to the specified value.\n\t*/\n\tshowMasks: function (value)\n\t{\n\t\tfor (let i in this.sticks)\n\t\t\tthis.sticks[i].hitbox.visible(value);\n\n\t\tfor (let i in this.buttons)\n\t\t\tthis.buttons[i].hitbox.visible(value);\n\n\t\treturn this;\n\t}\n});\n\nexport default Gamepad;\n","\nimport Gamepad from './gamepad.js';\nimport PointerHandler from '../flow/pointer-handler.js';\n\nimport world from './world.js';\nimport system from './system.js';\n\n/**\n *\tInput system allows to create gamepads.\n */\n\nconst input =\n{\n\t/**\n\t *\tRegistered gamepads.\n\t */\n\t_gamepads: [],\n\n\t/**\n\t *\tCurrently active gamepad.\n\t */\n\tactiveGamepad: null,\n\n\t/**\n\t * \tCursor object, used to control the state of the single-cursor input.\n\t */\n\tcursor:\n\t{\n\t\t/**\n\t\t *\tIndicates if the single-cursor input has been enabled.\n \t\t */\n\t\t_enabled: null,\n\n\t\t/**\n\t\t *\tHandler callback for cursor events.\n\t\t */\n\t\t_handler: null,\n\n\t\t/**\n\t\t *\tCursor element used when the single-cursor input is enabled.\n\t\t */\n\t\t_element: null,\n\n\t\t/**\n\t\t *\tPointer state related to the cursor when single-cursor input is enabled.\n\t\t */\n\t\tpointer: null,\n\n\t\t/**\n\t\t *\tSets or returns the specified element for the single-cursor input.\n\t\t *\t@param {Element} element?\n\t\t */\n\t\telement: function (element=false)\n\t\t{\n\t\t\tif (element === false)\n\t\t\t\treturn this._element;\n\n\t\t\tthis._element = element;\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t *\tHides or shows the native cursor.\n\t\t *\t@param {boolean} value\n\t\t */\n\t\tnative: function (value)\n\t\t{\n\t\t\tif (!value && system.renderer.elem.style.cursor !== 'none')\n\t\t\t\tsystem.renderer.elem.style.cursor = 'none';\n\t\t\telse if (value && system.renderer.elem.style.cursor === 'none')\n\t\t\t\tsystem.renderer.elem.style.removeProperty('cursor');\n\t\t},\n\n\t\t/**\n\t\t *\tEnables or disables the single-cursor input.\n\t\t *\t@param {boolean} value\n\t\t */\n\t\tenabled: function (value=null)\n\t\t{\n\t\t\tif (value === null)\n\t\t\t\treturn this._enabled;\n\n\t\t\tif (this._enabled === value)\n\t\t\t\treturn this;\n\n\t\t\tthis._enabled = value;\n\n\t\t\tif (value === true)\n\t\t\t{\n\t\t\t\tif (this._element !== null)\n\t\t\t\t\tsystem.renderer.elem.style.cursor = 'none';\n\n\t\t\t\tPointerHandler.register(this.pointerHandler);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsystem.renderer.elem.style.removeProperty('cursor');\n\t\t\t\tPointerHandler.unregister(this.pointerHandler);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t *\tSets the callback to execute when a cursor event happens.\n\t\t *\t@param { (action:number, pointer:object) => void } callback\n\t\t */\n\t\thandler: function (callback)\n\t\t{\n\t\t\tthis._handler = callback;\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * \tPointer event handler for single-cursor input.\n\t\t */\n\t\tpointerHandler:\n\t\t{\n\t\t\tpriority: 50,\n\n\t\t\tonPointerEvent: function (action, pointer, pointers)\n\t\t\t{\n\t\t\t\tif (!input.cursor._enabled)\n\t\t\t\t\treturn;\n\n\t\t\t\tinput.cursor.pointer = pointer;\n\n\t\t\t\tif (input.cursor._element !== null)\n\t\t\t\t\tinput.cursor._element.setPosition(pointer.x, pointer.y);\n\n\t\t\t\tif (input.cursor._handler !== null)\n\t\t\t\t\tinput.cursor._handler (action, pointer);\n\t\t\t},\n\t\t},\n\t},\n\n\t/*\n\t**\tCreates a gamepad object and attaches it to the active scene in the specified layer (defaults to world.LAYER_HUD_FG0).\n\t*/\n\tcreateGamepad: function (index, layerIndex=null)\n\t{\n\t\tif (world.activeScene === null)\n\t\t\tthrow new Error ('input.createGamepad: use world.selectScene first to select the active scene.');\n\n\t\tthis._gamepads[index] = new Gamepad (world.activeScene, layerIndex !== null ? layerIndex : world.LAYER_HUD_MAIN);\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tReturns a gamepad given its index.\n\t*/\n\tgetGamepad: function (index)\n\t{\n\t\tif (index < 0 || index >= this._gamepads.length)\n\t\t\treturn null;\n\n\t\treturn this._gamepads[index] || null;\n\t},\n\n\t/*\n\t**\tSelects the active gamepad for subsequent gamepad-level operations.\n\t*/\n\tselectGamepad: function (index)\n\t{\n\t\tthis.activeGamepad = this.getGamepad(index);\n\t\treturn true;\n\t},\n\n\t/*\n\t**\tSets the value of `debugBounds` on the specified gamepad. If index `null` is provided, all gamepads will be modified.\n\t*/\n\tdebugGamepad: function (index, value)\n\t{\n\t\tif (index === null)\n\t\t{\n\t\t\tfor (let i = 0; i < this._gamepads.length; i++)\n\t\t\t{\n\t\t\t\tif (!this._gamepads[i])\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis.debugGamepad(i, value);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis._gamepads[index].debug(value);\n\t},\n\n\t/*\n\t**\tAdds an stick control to the active gamepad.\n\t*/\n\tstick: function (id, x, y, outerDrawable, innerDrawable, maxRadius=0)\n\t{\n\t\tif (this.activeGamepad === null)\n\t\t\tthrow new Error ('input.addStick: use input.selectGamepad first to select the active gamepad.');\n\n\t\treturn this.activeGamepad.addStick (id, x, y, outerDrawable, innerDrawable, maxRadius);\n\t},\n\n\t/*\n\t**\tAdds a button control to the active gamepad.\n\t*/\n\tbutton: function (id, x, y, unpressedDrawable, pressedDrawable=null)\n\t{\n\t\tif (this.activeGamepad === null)\n\t\t\tthrow new Error ('input.addButton: use input.selectGamepad first to select the active gamepad.');\n\n\t\treturn this.activeGamepad.addButton (id, x, y, unpressedDrawable, pressedDrawable);\n\t}\n};\n\nexport default input;\n","\nimport Bounds2 from '../math/bounds2.js';\nimport GridElement from '../flow/grid-element.js';\nimport Handler from '../utils/handler.js';\n\nimport world from './world.js';\n\n/**\n * \tMask used to isolate the super-type of a type.\n */\nconst SUPER_TYPE_MASK = 0xFFFFF000;\n\n/**\n * \tThe collider system is responsible of detecting collisions and performing the respective actions.\n */\n\n//!class collider\n\nconst collider =\n{\n\t/**\n\t * \tFlag used to exclude from collision checks.\n\t *\t!static readonly FLAG_EXCLUDE: number;\n\t */\n\tFLAG_EXCLUDE: GridElement.allocFlag(),\n\n\t/**\n\t * \tContact rules, define what to do when certain types of elements are in contact.\n\t */\n\tcontactRules: { },\n\n\t/**\n\t * \tTruncation rules, indicate which type of elements are not allowed to penetrate each other.\n\t */\n\ttruncationRules: { },\n\n\t/**\n\t *\tScene where the mask layer is contained.\n\t */\n\tscene: null,\n\n\t/**\n\t *\tLayer containing the element masks.\n\t */\n\tmaskLayer: null,\n\n\t/**\n\t *\tFirst updater.\n\t *\t!static fupdater: Handler;\n\t */\n\tfupdater: null,\n\n\t/**\n\t *\tLast updater.\n\t *\t!static lupdater: Handler;\n\t */\n\tlupdater: null,\n\n\t/**\n\t *\tFlags used to filter elements.\n\t *\t!static flagsAnd: number;\n\t *\t!static flagsValue: number;\n\t */\n\tflagsAnd: 0,\n\tflagsValue: 0,\n\n\t/**\n\t *\tCurrent collider state fields.\n\t *\t!static state: {\n\t */\n\tstate:\n\t{\n\t\t/**\n\t\t * \tContact area.\n\t\t *\t!contact: Bounds2;\n\t\t */\n\t\tcontact: Bounds2.Pool.alloc(),\n\n\t\t/**\n\t\t * \tContact flags.\n\t\t * \t!flags: collider.Contact;\n\t\t */\n\t\tflags: 0,\n\n\t\t/**\n\t\t * \tFinal delta value for X-coordinate calculated by `translate`.\n\t\t *\t!dx: number;\n\t\t */\n\t\tdx: 0,\n\n\t\t/**\n\t\t * \tFinal delta value for Y-coordinate calculated by `translate`.\n\t\t *\t!dy: number;\n\t\t */\n\t\tdy: 0,\n\n\t\tbounds: Bounds2.Pool.alloc(),\n\n\t\tx: new Array(32).fill(0),\n\t\ty: new Array(32).fill(0),\n\t\tv0x: new Array(32).fill(0),\n\t\tv0y: new Array(32).fill(0),\n\t\tv1x: new Array(32).fill(0),\n\t\tv1y: new Array(32).fill(0),\n\t\tv2x: new Array(32).fill(0),\n\t\tv2y: new Array(32).fill(0),\n\n\t\tcount: 0,\n\t\ttarget: 0,\n\n\t\tv0: 0, w0: 0, delta0: 0,\n\t\tv1: 0, w1: 0, delta1: 0,\n\n\t\tw2: 0,\n\t\tt_dx: 0,\n\t\tt_dy: 0,\n\t},\n\t//:}\n\n\t/**\n\t *\tEnables the collider system on the specified scene and layer.\n\t * \t@param sceneIndex - Scene to attach the collider updater methods. Uses world.SCENE_MAIN if none specified.\n\t * \t@param layerIndex - Index within the scene of the layer where element masks are stored. Uses world.LAYER_MASK if none specified.\n\t * \t!static enable (sceneIndex?: number, layerIndex?: number) : void;\n\t */\n\tenable: function(sceneIndex=null, layerIndex=null)\n\t{\n\t\tthis.scene = world.getScene(sceneIndex || world.SCENE_MAIN);\n\t\tthis.maskLayer = this.scene.getContainer(layerIndex || world.LAYER_MASK);\n\n\t\tthis.flagsAnd = GridElement.ALIVE | GridElement.VISIBLE | collider.FLAG_EXCLUDE;\n\t\tthis.flagsValue = GridElement.ALIVE | GridElement.VISIBLE;\n\n\t\tthis.scene.fupdater.add(this.firstUpdate, this);\n\t\tthis.scene.lupdater.add(this.lastUpdate, this);\n\n\t\tthis.fupdater = Handler.Pool.alloc(this);\n\t\tthis.lupdater = Handler.Pool.alloc(this);\n\t},\n\n\t/**\n\t *\tDisables the collider system.\n\t *\t!static disable() : void;\n\t */\n\tdisable: function()\n\t{\n\t\tthis.scene.fupdater.remove(this.update, this);\n\t\tthis.maskLayer = null;\n\n\t\tthis.fupdater.free();\n\t\tthis.lupdater.free();\n\t},\n\n\t/**\n\t * \tRuns a first update cycle `fupdater` will be executed.\n\t */\n\tfirstUpdate: function(scene, self)\n\t{\n\t\tself.fupdater.exec();\n\t},\n\n\t/**\n\t * \tRuns a last update cycle `lupdater` will be executed.\n\t */\n\tlastUpdate: function(scene, self)\n\t{\n\t\tself.lupdater.exec();\n\t},\n\n\t/**\n\t * \tUtility object containing actions that are executed later on the next update cycle.\n\t * \t!static later: {\n\t */\n\tlater:\n\t{\n\t\t/**\n\t\t *\tRuns the specified callback.\n\t\t *\t!run (elem: Element, callback: Function, arg1?: any, arg2?: any, arg3?: any) : void;\n\t\t */\n\t\trun: function (elem, callback, arg1, arg2, arg3)\n\t\t{\n\t\t\tcollider.fupdater.add(this._run, elem, callback, arg1, arg2, arg3);\n\t\t},\n\n\t\t/**\n\t\t *\tSets the element's visibility flag.\n\t\t * \t!setVisible (elem: Element, value: boolean) : void;\n\t\t */\n\t\tsetVisible: function (elem, value)\n\t\t{\n\t\t\tcollider.fupdater.add(this._setVisible, elem, value);\n\t\t},\n\n\t\t/**\n\t\t *\tSets an attribute of an object to a given value.\n\t\t * \t!setValue (obj: Object, name: string, value: any) : void;\n\t\t */\n\t\tsetValue: function (obj, name, value)\n\t\t{\n\t\t\tcollider.fupdater.add(this._setValue, obj, name, value);\n\t\t},\n\n\t\t/**\n\t\t *\tSets the element's flags.\n\t\t *\t!setFlags (elem: Element, value: number) : void;\n\t\t */\n\t\tsetFlags: function (elem, value)\n\t\t{\n\t\t\tcollider.fupdater.add(this._setFlags, elem, value);\n\t\t},\n\n\t\t/**\n\t\t *\tClears the element's flags.\n\t\t * \t!clearFlags (elem: Element, value: number) : void;\n\t\t */\n\t\tclearFlags: function (elem, value)\n\t\t{\n\t\t\tcollider.fupdater.add(this._clearFlags, elem, value);\n\t\t},\n\n\t\t/* ******* */\n\n\t\t_run: function (host, elem, callback, arg1, arg2, arg3)\n\t\t{\n\t\t\tcallback (host, elem, arg1, arg2, arg3);\n\t\t\treturn false;\n\t\t},\n\n\t\t_setVisible: function (host, elem, value)\n\t\t{\n\t\t\telem.visible(value);\n\t\t\treturn false;\n\t\t},\n\n\t\t_setValue: function (host, obj, name, value)\n\t\t{\n\t\t\tobj[name] = value;\n\t\t\treturn false;\n\t\t},\n\n\t\t_setFlags: function (host, elem, value)\n\t\t{\n\t\t\telem.setFlags(value);\n\t\t\treturn false;\n\t\t},\n\n\t\t_clearFlags: function (host, elem, value)\n\t\t{\n\t\t\telem.clearFlags(value);\n\t\t\treturn false;\n\t\t}\n\t},\n\t//!}\n\n\t/**\n\t * \tAdds a contact rule.\n\t * \t@param primaryType - Type of the primary element.\n\t * \t@param secondaryType - Type of the secondary element.\n\t * \t@param callback - Callback to execute when contact is detected.\n\t * \t@param context - Optional value passed as last parameter to the callback.\n\t * \t!static contact (primaryType: number, secondaryType: number, callback: (primary: Mask, secondary: Mask, context?: any) => void, context?: any) : collider;\n\t */\n\tcontact: function (primaryType, secondaryType, callback, context=null)\n\t{\n\t\tif (!(primaryType in this.contactRules))\n\t\t\tthis.contactRules[primaryType] = { };\n\n\t\tthis.contactRules[primaryType][secondaryType] = { callback: callback, context: context };\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tAdds a truncation rule.\n\t * \t@param primaryType - Type or super-type of the primary element.\n\t * \t@param secondaryType - Type or super-type of the secondary element.\n\t * \t@param callback - Returns boolean indicating if the truncation rule should be applied.\n\t * \t@param context - Optional value passed as last parameter to the callback.\n\t * \t:static truncate (primaryType: number, secondaryType: number, callback?: (primary: Mask, secondary: Mask, context?: any) => void, context?: any) : collider;\n\t */\n\t/**\n\t * \tAdds a truncation rule.\n\t * \t@param primaryType - Type or super-type of the primary element.\n\t * \t@param secondaryType - Type or super-type of the secondary element.\n\t * \t@param value - Indicates the status of the truncation rule.\n\t * \t!static truncate (primaryType: number, secondaryType: number, value: boolean) : collider;\n\t */\n\ttruncate: function (primaryType, secondaryType, callback=null, context=null)\n\t{\n\t\tif (!(primaryType in this.truncationRules))\n\t\t\tthis.truncationRules[primaryType] = { };\n\n\t\tthis.truncationRules[primaryType][secondaryType] = { callback: callback, context: context };\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tLoads the contact flags in the collider state.\n\t *\t!static getContactFlags (boundsA: Bounds2, boundsB: Bounds2) : number;\n\t */\n\tgetContactFlags: function (boundsA, boundsB)\n\t{\n\t\tthis.state.contact.set(boundsA).setAsIntersection(boundsB);\n\t\tlet contact = this.state.contact;\n\n\t\tthis.state.flags = 0;\n\t\tthis.state.numFlags = 0;\n\n\t\tif (contact.x1 == boundsB.x1)\n\t\t{\n\t\t\tthis.state.flags |= collider.Contact.LEFT; // LEFT\n\t\t\tthis.state.numFlags++;\n\t\t}\n\n\t\tif (contact.x2 == boundsB.x2)\n\t\t{\n\t\t\tthis.state.flags |= collider.Contact.RIGHT; // RIGHT\n\t\t\tthis.state.numFlags++;\n\t\t}\n\n\t\tif (contact.y1 == boundsB.y1)\n\t\t{\n\t\t\tthis.state.flags |= collider.Contact.TOP; // TOP\n\t\t\tthis.state.numFlags++;\n\t\t}\n\n\t\tif (contact.y2 == boundsB.y2)\n\t\t{\n\t\t\tthis.state.flags |= collider.Contact.BOTTOM; // BOTTOM\n\t\t\tthis.state.numFlags++;\n\t\t}\n\n\t\treturn this.state.flags;\n\t},\n\n\tcalc: function (store0, sign, a, v0a, v1a, v1b)\n\t{\n\t\tlet n = this.state.count;\n\t\tlet delta = null;\n\t\tlet v = 0;\n\n\t\tif (sign > 0)\n\t\t{\n\t\t\tfor (let i = 0; i < n; i++)\n\t\t\t{\n\t\t\t\tif (!v0a[i] || !v1a[i] || a[i] < 0) continue;\n\n\t\t\t\tif (delta === null || a[i] > delta)\n\t\t\t\t\tdelta = a[i];\n\n\t\t\t\tv1a[i] = v1b[i] = 0;\n\t\t\t\tv += v0a[i];\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let i = 0; i < n; i++)\n\t\t\t{\n\t\t\t\tif (!v0a[i] || !v1a[i] || a[i] > 0) continue;\n\n\t\t\t\tif (delta === null || a[i] < delta)\n\t\t\t\t\tdelta = a[i];\n\n\t\t\t\tv1a[i] = v1b[i] = 0;\n\t\t\t\tv += v0a[i];\n\t\t\t}\n\t\t}\n\n\t\tif (delta === null)\n\t\t\tdelta = 0;\n\n\t\tif (store0) {\n\t\t\tthis.state.v0 = v;\n\t\t\tthis.state.w0 = Math.abs(delta);\n\t\t\tthis.state.delta0 = delta;\n\t\t} else {\n\t\t\tthis.state.v1 = v;\n\t\t\tthis.state.w1 = Math.abs(delta);\n\t\t\tthis.state.delta1 = delta;\n\t\t}\n\t},\n\n\tattemptSelect: function (swapped)\n\t{\n\t\tif (this.state.v1 + this.state.v0 === this.state.target)\n\t\t{\n\t\t\tif (this.state.w2 === null || this.state.w1 + this.state.w0 < this.state.w2)\n\t\t\t{\n\t\t\t\tthis.state.w2 = this.state.w1 + this.state.w0;\n\n\t\t\t\tif (!swapped) {\n\t\t\t\t\tthis.state.t_dx = this.state.delta1;\n\t\t\t\t\tthis.state.t_dy = this.state.delta0;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.state.t_dx = this.state.delta0;\n\t\t\t\t\tthis.state.t_dy = this.state.delta1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tload0: function()\n\t{\n\t\tlet n = this.state.count;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tthis.state.v1x[i] = this.state.v0x[i];\n\t\t\tthis.state.v1y[i] = this.state.v0y[i];\n\t\t}\n\t},\n\n\tsave1: function()\n\t{\n\t\tlet n = this.state.count;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tthis.state.v2x[i] = this.state.v1x[i];\n\t\t\tthis.state.v2y[i] = this.state.v1y[i];\n\t\t}\n\t},\n\n\tload1: function()\n\t{\n\t\tlet n = this.state.count;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tthis.state.v1x[i] = this.state.v2x[i];\n\t\t\tthis.state.v1y[i] = this.state.v2y[i];\n\t\t}\n\t},\n\n\tresolveXpos: function (single=false)\n\t{\n\t\tthis.calc (single, 1, this.state.x, this.state.v0x, this.state.v1x, this.state.v1y);\n\t\tif (single) return true;\n\n\t\tthis.save1();\n\t\tif (this.resolveYpos(true)) this.attemptSelect(false);\n\n\t\tthis.load1();\n\t\tif (this.resolveYneg(true)) this.attemptSelect(false);\n\n\t\tthis.load0();\n\t},\n\n\tresolveXneg: function (single=false)\n\t{\n\t\tthis.calc (single, -1, this.state.x, this.state.v0x, this.state.v1x, this.state.v1y);\n\t\tif (single) return true;\n\n\t\tthis.save1();\n\t\tif (this.resolveYpos(true)) this.attemptSelect(false);\n\n\t\tthis.load1();\n\t\tif (this.resolveYneg(true)) this.attemptSelect(false);\n\n\t\tthis.load0();\n\t},\n\n\tresolveYpos: function (single=false)\n\t{\n\t\tthis.calc (single, 1, this.state.y, this.state.v0y, this.state.v1y, this.state.v1x);\n\t\tif (single) return true;\n\n\t\tthis.save1();\n\t\tif (this.resolveXpos(true)) this.attemptSelect(true);\n\n\t\tthis.load1();\n\t\tif (this.resolveXneg(true)) this.attemptSelect(true);\n\n\t\tthis.load0();\n\t},\n\n\tresolveYneg: function (single=false)\n\t{\n\t\tthis.calc (single, -1, this.state.y, this.state.v0y, this.state.v1y, this.state.v1x);\n\t\tif (single) return true;\n\n\t\tthis.save1();\n\t\tif (this.resolveXpos(true)) this.attemptSelect(true);\n\n\t\tthis.load1();\n\t\tif (this.resolveXneg(true)) this.attemptSelect(true);\n\n\t\tthis.load0();\n\t},\n\n\t/**\n\t * \tCompletes the translation on the current group.\n\t */\n\tcommit: function ()\n\t{\n\t\tif (!this.state.group.alive())\n\t\t\treturn;\n\n\t\tthis.state.group.translate (this.state.dx, this.state.dy);\n\t\tthis.state.group.clearFlags (collider.FLAG_EXCLUDE);\n\t},\n\n\t/**\n\t * \tAttempts to move the specified group by the given deltas. Any collisions detected on the mask will trigger the respective actions.\n\t * \t@param mask - Mask element.\n\t * \t@param dx - X delta value.\n\t * \t@param dy - Y delta value.\n\t * \t!static translate (mask: Mask, dx: number, dy: number) : void;\n\t */\n\t/**\n\t * \tAttempts to move the specified group by the given deltas. Any collisions detected on the mask will trigger the respective actions.\n\t * \t@param mask - Mask element.\n\t * \t@param group - Group where the mask is stored.\n\t * \t@param dx - X delta value.\n\t * \t@param dy - Y delta value.\n\t * \t!static translate (mask: Mask, group: Group, dx: number, dy: number) : void;\n\t */\n\ttranslate: function (mask, group=null, dx=0, dy=0)\n\t{\n\t\tif (typeof(group) === 'number')\n\t\t{\n\t\t\tdy = dx;\n\t\t\tdx = group;\n\t\t\tgroup = null;\n\t\t}\n\n\t\tif (!group) group = mask.group;\n\n\t\tif (!group.alive() || !mask.alive())\n\t\t\treturn;\n\n\t\tthis.state.mask = mask;\n\t\tthis.state.group = group;\n\n\t\tthis.state.dx = downscalef(upscale(dx));\n\t\tthis.state.dy = downscalef(upscale(dy));\n\n\t\tif (!this.maskLayer || !mask.visible())\n\t\t\treturn this.commit();\n\n\t\tlet truncationRules = this.truncationRules[mask.type];\n\t\tif (!truncationRules)\n\t\t{\n\t\t\ttruncationRules = this.truncationRules[mask.type & SUPER_TYPE_MASK];\n\t\t\tif (!truncationRules)\n\t\t\t{\n\t\t\t\tthis.commit();\n\t\t\t\treturn this.scan(mask, group);\n\t\t\t}\n\t\t}\n\n\t\tthis.state.offs = group.getOffsets(this.state.dx, this.state.dy);\n\t\tthis.state.bounds.set(mask.bounds).translate(this.state.offs.x+this.state.dx, this.state.offs.y+this.state.dy);\n\n\t\tgroup.setFlags (collider.FLAG_EXCLUDE);\n\n\t\tlet collisionItems = this.maskLayer.selectInRegion(this.state.bounds, this.flagsAnd, this.flagsValue);\n\t\tif (collisionItems.length === 0)\n\t\t{\n\t\t\tcollisionItems.free();\n\t\t\treturn this.commit();\n\t\t}\n\n\t\tlet n = 0;\n\t\tlet v = 0;\n\n\t\twhile (true)\n\t\t{\n\t\t\tlet item = collisionItems.shift();\n\t\t\tif (item === null) break;\n\n\t\t\tlet allowsTruncation = truncationRules[item.type];\n\t\t\tif (!allowsTruncation)\n\t\t\t{\n\t\t\t\tallowsTruncation = truncationRules[item.type & SUPER_TYPE_MASK];\n\t\t\t\tif (!allowsTruncation) continue;\n\t\t\t}\n\n\t\t\tif (allowsTruncation.callback === false || (allowsTruncation.callback !== null && allowsTruncation.callback !== true && !allowsTruncation.callback(mask, item, allowsTruncation.context)))\n\t\t\t\tcontinue;\n\n\t\t\tlet width = Math.min(this.state.bounds.x2, item.bounds.x2) - Math.max(this.state.bounds.x1, item.bounds.x1);\n\t\t\tlet height = Math.min(this.state.bounds.y2, item.bounds.y2) - Math.max(this.state.bounds.y1, item.bounds.y1);\n\n\t\t\tthis.state.v0x[n] = 0;\n\t\t\tthis.state.v0y[n] = 0;\n\n\t\t\tif (Math.min(this.state.bounds.width(), item.bounds.width()) != width) {\n\t\t\t\tthis.state.x[n] = absmin(this.state.bounds.x2 - item.bounds.x1, this.state.bounds.x1 - item.bounds.x2);\n\t\t\t\tthis.state.v0x[n] = 1;\n\t\t\t}\n\n\t\t\tif (Math.min(this.state.bounds.height(), item.bounds.height()) != height) {\n\t\t\t\tthis.state.y[n] = absmin(this.state.bounds.y2 - item.bounds.y1, this.state.bounds.y1 - item.bounds.y2);\n\t\t\t\tthis.state.v0y[n] = 1;\n\t\t\t}\n\n\t\t\tlet sv = this.state.v0x[n] + this.state.v0y[n];\n\t\t\tv += sv;\n\n\t\t\tif (sv > 1) {\n\t\t\t\tthis.state.v0x[n] = sv;\n\t\t\t\tthis.state.v0y[n] = sv;\n\t\t\t}\n\n\t\t\tthis.state.v1x[n] = this.state.v0x[n];\n\t\t\tthis.state.v1y[n] = this.state.v0y[n];\n\n\t\t\tn++;\n\t\t}\n\n\t\tcollisionItems.free();\n\n\t\tif (v == 0)\n\t\t{\n\t\t\tthis.commit();\n\t\t\treturn this.scan(mask, group);\n\t\t}\n\n\t\tthis.state.target = v;\n\t\tthis.state.count = n;\n\t\tthis.state.w2 = null;\n\n\t\tthis.resolveXpos();\n\t\tthis.resolveXneg();\n\t\tthis.resolveYpos();\n\t\tthis.resolveYneg();\n\n\t\tif (this.state.w2 !== null)\n\t\t{\n\t\t\tlet contactRules = this.contactRules[mask.type];\n\t\t\tif (!contactRules) contactRules = this.contactRules[mask.type & SUPER_TYPE_MASK];\n\n\t\t\tif (contactRules)\n\t\t\t{\n\t\t\t\tthis.state.bounds.set(mask.bounds).translate(this.state.offs.x+this.state.dx-this.state.t_dx*0.5, this.state.offs.y+this.state.dy-this.state.t_dy*0.5);\n\n\t\t\t\tcollisionItems = this.maskLayer.selectInRegion(this.state.bounds, this.flagsAnd, this.flagsValue);\n\n\t\t\t\twhile (true)\n\t\t\t\t{\n\t\t\t\t\tlet item = collisionItems.shift();\n\t\t\t\t\tif (item === null) break;\n\t\t\n\t\t\t\t\tlet contact = contactRules[item.type];\n\t\t\t\t\tif (!contact)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontact = contactRules[item.type & SUPER_TYPE_MASK];\n\t\t\t\t\t\tif (!contact) continue;\n\t\t\t\t\t}\n\n\t\t\t\t\tcontact.callback (mask, item, contact.context);\n\t\t\t\t}\n\n\t\t\t\tcollisionItems.free();\n\t\t\t}\n\n\t\t\tthis.state.dx -= this.state.t_dx;\n\t\t\tthis.state.dy -= this.state.t_dy;\n\t\t}\n\n\t\tthis.commit();\n\t},\n\n\t/**\n\t *\tScans for collisions against the specified mask.\n\t * \t@param mask - Mask element.\n\t * \t!static scan (mask: Mask) : void;\n\t */\n\t/**\n\t *\tScans for collisions against the specified mask.\n\t * \t@param mask - Mask element.\n\t * \t@param group - Group where the mask is stored.\n\t * \t!static scan (mask: Mask, group: Group) : void;\n\t */\n\tscan: function (mask, group=null)\n\t{\n\t\tif (!group) group = mask.group;\n\n\t\tif (!group.alive() || !mask.alive())\n\t\t\treturn;\n\n\t\tthis.state.mask = mask;\n\t\tthis.state.group = group;\n\n\t\tif (!this.maskLayer || !mask.visible())\n\t\t\treturn;\n\n\t\tlet contactRules = this.contactRules[mask.type];\n\t\tif (!contactRules) contactRules = this.contactRules[mask.type & SUPER_TYPE_MASK];\n\t\tif (!contactRules) return;\n\t\n\t\tgroup.setFlags (collider.FLAG_EXCLUDE);\n\t\tlet collisionItems = this.maskLayer.selectInRegion(mask.bounds, this.flagsAnd, this.flagsValue);\n\t\tgroup.clearFlags (collider.FLAG_EXCLUDE);\n\n\t\twhile (true)\n\t\t{\n\t\t\tlet item = collisionItems.shift();\n\t\t\tif (item === null) break;\n\n\t\t\tlet contact = contactRules[item.type];\n\t\t\tif (!contact)\n\t\t\t{\n\t\t\t\tcontact = contactRules[item.type & SUPER_TYPE_MASK];\n\t\t\t\tif (!contact) continue;\n\t\t\t}\n\n\t\t\tcontact.callback (mask, item, contact.context);\n\t\t}\n\n\t\tcollisionItems.free();\n\t}\n};\n\n/**\n * \tContact flag bits.\n */\n\n//!/class\n\n//!namespace collider\n//!enum Contact\n\ncollider.Contact = {\n\t//!LEFT\n\tLEFT: 1,\n\t//!RIGHT\n\tRIGHT: 2,\n\t//!HORIZONTAL\n\tHORIZONTAL: 1|2,\n\t//!TOP\n\tTOP: 4,\n\t//!BOTTOM\n\tBOTTOM: 8,\n\t//!VERTICAL\n\tVERTICAL: 4|8,\n};\n\n//!/enum\n//!/namespace\n\nexport default collider;\n","//@ts-check\n\n//!namespace fxl\n\nimport _sys from './system.js';\n//![import \"./system\"]\nexport const sys = _sys;\n\nimport _world from './world.js';\n//![import \"./world\"]\nexport const world = _world;\n\nimport _r from './r.js';\n//![import \"./r\"]\nexport const r = _r;\n\nimport _res from './resources.js';\n//![import \"./resources\"]\nexport const res = _res;\n\nimport _input from './input.js';\n//![import \"./input\"]\nexport const input = _input;\n\nimport _collider from './collider.js';\n//![import \"./collider\"]\nexport const collider = _collider;\n\n//!// fxl ends\n","/*\n**\tfroxel\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n//!//@ts-check\n\n// *********************************************\n// rin\n\nimport * as _Rin from '@rsthn/rin';\nexport const Class = _Rin.Class;\nexport const Schema = _Rin.Schema;\nexport const Template = _Rin.Template;\n\n// *********************************************\n// system\n\n//![import \"system/globals\"]\nimport _globals from './system/globals.js'; export const globals = _globals;\n\n//![import \"system/system\"]\nimport _System from './system/system.js'; export const System = _System;\n\n//![import \"system/timer\"]\nimport _Timer from './system/timer.js'; export const Timer = _Timer;\n\n//![import \"system/random\"]\nimport _Random from './system/random.js'; export const Random = _Random;\n\n//![import \"system/keycode\"]\nimport _KeyCode from './system/keycode.js'; export const KeyCode = _KeyCode;\n\n//![import \"system/canvas\"]\nimport _Canvas from './system/canvas.js'; export const Canvas = _Canvas;\n\n//![import \"system/perf\"]\nimport _Perf from './system/perf.js'; export const Perf = _Perf;\n\n//![import \"system/log\"]\nimport _Log from './system/log.js'; export const Log = _Log;\n\n//![import \"system/shader\"]\nimport _Shader from './system/shader.js'; export const Shader = _Shader;\n\n//![import \"system/shader-program\"]\nimport _ShaderProgram from './system/shader-program.js'; export const ShaderProgram = _ShaderProgram;\n\n//![import \"system/framebuffer\"]\nimport _Framebuffer from './system/framebuffer.js'; export const Framebuffer = _Framebuffer;\n\n\n// *********************************************\n// resources\n\n//![import \"resources/wrappers\"]\nimport * as _Wrappers from './resources/wrappers.js'; export const Wrappers = _Wrappers;\n\n//![import \"resources/resources\"]\nimport _Resources from './resources/resources.js'; export const Resources = _Resources;\nimport _Sound from './resources/sound.js'; export const Sound = _Sound;\n\n\n// *********************************************\n// utils\n\n//![import \"utils/recycler\"]\nimport _Recycler from './utils/recycler.js'; export const Recycler = _Recycler;\n\n//![import \"utils/linkable\"]\nimport _Linkable from './utils/linkable.js'; export const Linkable = _Linkable;\n\n//![import \"utils/list\"]\nimport _List from './utils/list.js'; export const List = _List;\n\n//![import \"utils/priority-queue\"]\nimport _PriorityQueue from './utils/priority-queue.js'; export const PriorityQueue = _PriorityQueue;\n\n//![import \"utils/handler\"]\nimport _Handler from './utils/handler.js'; export const Handler = _Handler;\n\n\n// *********************************************\n// math\n\n//![import \"math/matrix\"]\nimport _Matrix from './math/matrix.js'; export const Matrix = _Matrix;\n\n//![import \"math/rect\"]\nimport _Rect from './math/rect.js'; export const Rect = _Rect;\n\n//![import \"math/vec2\"]\nimport _Vec2 from './math/vec2.js'; export const Vec2 = _Vec2;\n\n//![import \"math/tfunction\"]\nimport _TFunction from './math/tfunction.js'; export const TFunction = _TFunction;\n\n//![import \"math/bounds2\"]\nimport _Bounds2 from './math/bounds2.js'; export const Bounds2 = _Bounds2;\n\n//![import \"math/point2\"]\nimport _Point2 from './math/point2.js'; export const Point2 = _Point2;\n\n\n// *********************************************\n// anim\n\n//![import \"anim/easing\"]\nimport _Easing from './anim/easing.js'; export const Easing = _Easing;\n\n//![import \"anim/anim\"]\nimport _Anim from './anim/anim.js'; export const Anim = _Anim;\n\n\n// *********************************************\n// flow\n\n//![import \"flow/boot\"]\nimport _Boot from './flow/boot.js'; export const Boot = _Boot;\n\n//![import \"flow/grid-element\"]\nimport _GridElement from './flow/grid-element.js'; export const GridElement = _GridElement;\n\n//![import \"flow/grid\"]\nimport _Grid from './flow/grid.js'; export const Grid = _Grid;\n\n//![import \"flow/scene\"]\nimport _Scene from './flow/scene.js'; export const Scene = _Scene;\n\n//![import \"flow/viewport\"]\nimport _Viewport from './flow/viewport.js'; export const Viewport = _Viewport;\n\n//![import \"flow/updater\"]\nimport _Updater from './flow/updater.js'; export const Updater = _Updater;\n\n//![import \"flow/container\"]\nimport _Container from './flow/container.js'; export const Container = _Container;\n\n//![import \"flow/simple-container\"]\nimport _SimpleContainer from './flow/simple-container.js'; export const SimpleContainer = _SimpleContainer;\n\n//![import \"flow/grid-container\"]\nimport _GridContainer from './flow/grid-container.js'; export const GridContainer = _GridContainer;\n\n//![import \"flow/group\"]\nimport _Group from './flow/group.js'; export const Group = _Group;\n\n//![import \"flow/element\"]\nimport _Element from './flow/element.js'; export const Element = _Element;\n\n//![import \"flow/mask\"]\nimport _Mask from './flow/mask.js'; export const Mask = _Mask;\n\n//![import \"flow/label\"]\nimport _Label from './flow/label.js'; export const Label = _Label;\n\n//![import \"flow/keyboard-handler\"]\nimport _KeyboardHandler from './flow/keyboard-handler.js'; export const KeyboardHandler = _KeyboardHandler;\n\n//![import \"flow/pointer-handler\"]\nimport _PointerHandler from './flow/pointer-handler.js'; export const PointerHandler = _PointerHandler;\n\n//![import \"flow/screen-controls\"]\nimport _ScreenControls from './flow/screen-controls.js'; export const ScreenControls = _ScreenControls;\n\n//![import \"flow/button\"]\nimport _Button from './flow/button.js'; export const Button = _Button;\n\n//![import \"flow/stick\"]\nimport _Stick from './flow/stick.js'; export const Stick = _Stick;\n\n\n// *********************************************\n// fxl\n\n//![import \"fxl/fxl\"]\nimport * as fxl from './fxl/fxl.js';\nexport default fxl;\n\n//!export default fxl;\n"],"names":["$33108eea74d6d1f3$var$xor16","value","x","$33108eea74d6d1f3$export$2e2bcd8739ae039","$kEriQ$Class","extend","seed","last","a","b","__ctor","this","setSeed","nextInt16","$33108eea74d6d1f3$var$add16","$33108eea74d6d1f3$var$sub16","n","$33108eea74d6d1f3$var$rol16","nextInt8","nextFloat","$7eb2234b1003fee7$export$2e2bcd8739ae039","BACKSPACE","TAB","ENTER","SHIFT","CTRL","ESC","SPACE","PGUP","PGDN","END","HOME","INS","DEL","LEFT","UP","RIGHT","DOWN","NUM_PLUS","NUM_MINUS","NUM_ASTERISK","NUM_SLASH","NUM_DOT","NUM_0","NUM_1","NUM_2","NUM_3","NUM_4","NUM_5","NUM_6","NUM_7","NUM_8","NUM_9","D0","D1","D2","D3","D4","D5","D6","D7","D8","D9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","$6f66060da14975e0$var$totalPreallocated","$6f66060da14975e0$var$recyclingFacilities","$6f66060da14975e0$var$Recycler","$parcel$global","Recycler","$6f66060da14975e0$export$2e2bcd8739ae039","attachTo","targetClass","maxPoolSize","minPoolSize","prototype","className","Error","int","recyclerPool","recyclerPoolMax","objectId","recyclerNextObjectId","recyclerCreated","recyclerRecycled","recyclerMissed","recyclerLength","recyclerActive","i","push","allocate","item","alloc","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","init","free","console","error","__dtor","lockInstance","Math","abs","showStats","name","list","log","c","debug","toFixed","length","group","groupEnd","createPool","Pool","_super","$6dde9cde9b283b84$var$Linkable","prev","next","clear","unlink","linkAfter","ref","linkBefore","$6dde9cde9b283b84$export$2e2bcd8739ae039","$ea76a84cb7989119$var$List","top","bottom","reset","clone","$kEriQ$Rin","ni","dispose","first","getAt","index","getNodeAt","sgetNode","remove","isInstance","insertBefore","insertAfter","unshift","shift","pop","append","forEach","fn","context","forEachRev","find","filter","toArray","array","$ea76a84cb7989119$export$2e2bcd8739ae039","$c5738556a93e3917$var$Timer","vsync","interval","callback","handle","isRunning","startTime","rTime","sTime","lTime","tDelta","_onTimeout","onTimeout","_onTimeout_b","runNow","hrnow","tError","runAfter","start","immediate","scale","onStarted","timeout","requestAnimationFrame","clearTimeout","setTimeout","stop","onStopped","$c5738556a93e3917$export$2e2bcd8739ae039","$1e3cfd400b46bb18$var$Vec2","y","set","v","setX","setY","zero","isZero","equals","neg","inv","translate","dx","dy","add","sub","fx","fy","floor","fract","dot","magnitude","sqrt","normalize","majorAxis","minorAxis","sign","toString","$1e3cfd400b46bb18$export$2e2bcd8739ae039","$7e788108c0302d03$var$temp","Float32Array","fill","$7e788108c0302d03$var$temp2","$7e788108c0302d03$var$Matrix","data","identity","i1","target","scalef","scalar","matr","rotate","angle","cost","cos","sint","sin","sx","sy","applyTo","nx","ny","transpose","j","i2","det","adj","inverse","loadIdentity","$7e788108c0302d03$export$2e2bcd8739ae039","$6272b5584432459d$var$Shader","id","type","sourceCode","shaderId","put","gl","$45a016effe16834c$export$2e2bcd8739ae039","deleteShader","source","compile","createShader","Type","VERTEX","VERTEX_SHADER","FRAGMENT","FRAGMENT_SHADER","GEOMETRY_SHADER","shaderSource","compileShader","getError","getShaderInfoLog","shaders","shader","get","GEOMETRY","$6272b5584432459d$export$2e2bcd8739ae039","$da12c07099dff3cc$var$ShaderProgram","uniform_location_matrix","uniform_transform_matrix","uniform_texture_matrix","uniform_resolution","uniform_texture_size","uniform_frame_size","uniform_base_color","uniform_time","uniform_depth","uniform_scale","uniform_alpha","uniform_texture_0","attrib_location","programId","deleteProgram","attach","bindLocations","bindAttribLocation","loadLocations","getUniformLocation","getAttribLocation","link","createProgram","attachShader","linkProgram","use","useProgram","getStatus","getProgramParameter","LINK_STATUS","getProgramInfoLog","getAllErrors","e","toUpperCase","programs","shaderProgram","$da12c07099dff3cc$export$2e2bcd8739ae039","$ea9a11c9dc9edbe6$var$Canvas","options","opts","elem","background","width","height","hidden","absolute","antialias","headless","document","passThruCanvas","createElement","body","appendChild","style","position","left","getContext","desynchronized","alpha","$1472c2f6dd11cc70$export$2e2bcd8739ae039","write","getParameter","VERSION","SHADING_LANGUAGE_VERSION","matrixStack","alphaStack","depthFlagStack","shaderProgramStack","transform","_globalScale","_alpha","_depthFlag","updateTransform","strokeStyle","fillStyle","resize","initGl","setBackground","parentNode","imageSmoothingEnabled","renderingContext","pushClip","popClip","setTransform","d","f","toDataURL","mime","params","beginPath","moveTo","closePath","lineTo","rect","w","h","stroke","fillRect","strokeRect","clip","quadraticCurveTo","cpx","cpy","bezierCurveTo","cx1","cy1","cx2","cy2","arc","r","sA","eA","cw","arcTo","x1","y1","x2","y2","fillText","text","maxWidth","strokeText","measureText","createImageData","getImageData","putImageData","drawImage","img","sw","sh","dw","dh","textureWidth","textureHeight","frameWidth","frameHeight","getBoundingClientRect","gl1","glDefaultProgram","glRepeatProgram","glBlitProgram","setShaderProgram","buffer","attrib_location_buffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","enableVertexAttribArray","vertexAttribPointer","FLOAT","FALSE","BYTES_PER_ELEMENT","clearColor","enable","DEPTH_TEST","clearDepth","depthFunc","GEQUAL","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","m_location","m_texture","v_texture_size","v_frame_size","v_resolution","zvalue","glTextureReady","program","targetWidth","targetHeight","uniform2fv","uniform1f","time","glActiveTextureId","glTextureId","glActiveShader","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","uniform1i","uniformMatrix3fv","drawArrays","TRIANGLE_STRIP","drawRect","prepareImage","image","texture","createTexture","texStorage2D","RGBA8","texSubImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","setWrapRepeat","REPEAT","applyConfig","imageRendering","removeChild","color","backgroundColor","parseInt","substr","g","_width","_height","SCISSOR_TEST","scissor","viewport","globalScale","flipped","isFlipped","toDataUrl","toPngBase64","_contextAttribute","lineCap","lineJoin","lineWidth","miterLimit","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","clearRect","DEPTH_BUFFER_BIT","COLOR_BUFFER_BIT","end","flush","colorMask","blit","disable","clearPath","pushMatrix","popMatrix","pushAlpha","popAlpha","setDepthFlag","getDepthFlag","pushDepthFlag","popDepthFlag","getShaderProgram","pushShaderProgram","popShaderProgram","loadMatrix","getMatrix","appendMatrix","useNative","ellipse","ox","oy","xe","ye","xm","ym","circle","PI","line","enablePointerEvents","pointerHandler","pointerScale","pointerOffset","_","_evt","action","buttons","lbuttons","containedBy","pointerHandlers","code","evt","rx","clientX","ry","clientY","dragging","ldx","ldy","ddx","ddy","onmousedown","onmouseup","onmousemove","setPointerScale","setPointerOffset","addPointerHandler","random","removePointerHandler","splice","renderImage","draw","completed","Image","onload","$8227ace5b683e6b4$export$2e2bcd8739ae039","renderer","src","$ea9a11c9dc9edbe6$export$2e2bcd8739ae039","$8227ace5b683e6b4$var$System","flags","renderingEnabled","renderingPaused","defaultOptions","overdraw","orientation","fps","minFps","screenWidth","screenHeight","extraScaleFactor","fullscreen","offsX","offsY","devicePixelRatio","backingStoreRatio","canvasPixelRatio","canvasScaleFactor","scaleFactor","initialMatrix","displayBuffer2","displayBuffer3","tempDisplayBuffer","keyState","ctrl","alt","keyCode","pointerState","updateQueue","drawQueue","timeScale","frameInterval","fixedFrameInterval","maxFrameInterval","frameDelta","frameTime","frameNumber","perf","lastTime","numFrames","numSamples","updateTimeTotal","drawTimeTotal","extraTimeTotal","averageFps","averageUpdateTime","averageDrawTime","averageExtraTime","self","o","onresize","onWindowResized","frameTimer","delta","onFrame","pointerEvents","display0","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","onkeydown","onKeyboardEvent","KeyboardEventType","KEY_DOWN","onkeyup","endTime","KEY_UP","pointerConvX","reverseRender","pointerConvY","ontouchstart","preventDefault","touches","changedTouches","identifier","isActive","isDragging","button","p","onPointerEvent","PointerEventType","POINTER_DOWN","ontouchend","deltaTime","POINTER_DRAG_STOP","POINTER_UP","ontouchcancel","ontouchmove","POINTER_DRAG_START","POINTER_DRAG_MOVE","POINTER_MOVE","oncontextmenu","which","pause","resume","resetPerf","tmp","now","update","notRendering","_screenWidth","screen","_screenHeight","innerWidth","innerHeight","targetScreenWidth","targetScreenHeight","min","marginLeft","marginTop","integerScaleFactor","onCanvasResized","updateQueueAdd","handler","updateQueueRemove","drawQueueAdd","drawQueueRemove","queueAdd","queueRemove","dt","interpolate","dst","duration","easing","count","interpolator","t","pointer","pointers","$1472c2f6dd11cc70$var$Log","activated","paused","maxsize","debugEcho","vars","msg","fontSize","showFps","showIndex","_y","s","ii","$45a016effe16834c$var$globals","debugBounds","rand0","rand1","rand2","px","SCALE","obj","audioContext","AudioContext","latencyHint","sampleRate","baseLatency","fetchd","url","Promise","resolve","reject","responseType","request","XMLHttpRequest","open","response","onerror","send","fetchAudioBuffer","then","arrayBuffer","decodeAudioData","audioBuffer","catch","err","bool","float","parseFloat","float2","float3","float4","rad","deg","rand","randf","randrf","randr","round","randtf","performance","randvar","randitem","arr","getLineSegmentIntersection","ls1_x1","ls1_y1","ls1_x2","ls1_y2","ls2_x1","ls2_y1","ls2_x2","ls2_y2","dyA","dxA","dyB","dxB","max","tA","tB","lineSegmentIntersects","rotatePoint","stepValue","minValue","maxValue","numSteps","alignValue","step","FIXED_POINT_BITS","upscale","downscale","downscalef","falign","absmin","absmax","$e5fcd88cc5309f08$var$Perf","accumSize","expectedValue","lastFeed","lastUpdate","stdSum","stdCount","$e5fcd88cc5309f08$export$2e2bcd8739ae039","begin","feed","report","avg","std","pow","out","Flags","SAMPLES","MIN","MAX","AVG","EXPECTED","undefined","STDDEV","AVG_STDDEV","ALL","$24b2ad3ae4038682$var$Framebuffer","framebufferId","attachments","attachmentTypes","drawBuffers","drawBufferIds","$24b2ad3ae4038682$var$attachmentPointIds","$24b2ad3ae4038682$var$initAttachmentPointIds","createFramebuffer","Array","MAX_ATTACHMENT_POINTS","TEXTURE","deleteTexture","deleteRenderbuffer","deleteFramebuffer","frameBufferId","attachmentPoint","DEPTH","RENDERBUFFER","indexOf","FRAMEBUFFER_BINDING","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","framebufferRenderbuffer","createColorBuffer","tex","createDepthBuffer","createRenderbuffer","bindRenderbuffer","renderbufferStorage","DEPTH_COMPONENT24","createStencilBuffer","DEPTH_STENCIL","getTexture","getRenderBuffer","bind","unbind","$24b2ad3ae4038682$var$defaultDrawBuffers","isComplete","result","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","COLOR0","COLOR1","COLOR2","COLOR3","COLOR4","COLOR5","COLOR6","COLOR7","STENCIL","BACK","COLOR_ATTACHMENT0","COLOR_ATTACHMENT1","COLOR_ATTACHMENT2","COLOR_ATTACHMENT3","COLOR_ATTACHMENT4","COLOR_ATTACHMENT5","COLOR_ATTACHMENT6","COLOR_ATTACHMENT7","DEPTH_ATTACHMENT","STENCIL_ATTACHMENT","DEPTH_STENCIL_ATTACHMENT","$24b2ad3ae4038682$export$2e2bcd8739ae039","$4ce891f5c69e05a4$var$Resources","$4ce891f5c69e05a4$export$2e2bcd8739ae039","$4ce891f5c69e05a4$var$reported","Object","assign","integerScaling","pixelated","load","progressCallback","completeCallback","keyList","keys","__clone","resName","ratio","owidth","oheight","hasOwnProperty","original","resizeImage","rscale","onLoaded","d0","dN","d1","lastIndexOf","_i","cb","track","plugins","NativeAudio","engine","$962ed9d7301d41f5$exports","Sound","ENGINE_NATIVEAUDIO","preloadSimple","ENGINE_WEBAUDIO","Audio","ENGINE_HTML5","oncanplaythrough","json","arraybuffer","String","fromCharCode","apply","Uint8Array","unload","wrapper","__loaded","discardOriginal","temp","rep_x","rep_y","output","sp","tw","th","flipImageHorz","showDownload","filename","dataUrl","href","display","download","click","showFilePicker","allowMultiple","accept","input","multiple","onchange","files","onfocus","loadAsDataURL","file","reader","FileReader","readAsDataURL","loadAsText","readAsText","loadAsArrayBuffer","readAsArrayBuffer","loadAllAsDataURL","fileList","loadNext","size","$cfd798b4d0ac805f$export$2e2bcd8739ae039","getImage","getDrawable","$8f399e0dfe991542$export$2e2bcd8739ae039","Placeholder","$fd9a7f4344720f80$export$2e2bcd8739ae039","numCols","drawableCache","r_scale","v_scale","config","sheetWidth","numRows","ceil","drawFrame","frame","getFrame","frameIndex","spritesheet","$c920f072b2d17ee3$export$c35d437ae5945fcd","seq","seq_i","trans","trans_i","trans_t","queue","frameSeconds","finished","_paused","finishedCallback","finishedCallbackHandler","finishedCallbackContext","frameCallback","anim","setFps","setInitialDelay","onFinished","thenCallback","setFrame","normalized","getLength","loop","advance","getSequenceName","seqName","force","play","setQueue","enqueue","lastName","$c920f072b2d17ee3$export$2e2bcd8739ae039","defaultDrawable","sharedAnim","Spritesheet","initialized","def","split","k","getSharedAnimation","initialseq","getAnimation","getSequence","$c6042ce163f9804a$export$2e2bcd8739ae039","r_charWidth","charWidth","r_charHeight","charHeight","paddingX","paddingY","spacingX","spacingY","cols","charset","charTable","widths","w1","w2","drawText","pX","measureWidth","measureHeight","drawTextAligned","ax","ay","drawTextAligned2","bounds","$65d2b3a10215be8b$var$Sound","volume","playLoop","MASTER","enabled","SFX","MUSIC","VOICE","MAX_POOL_SIZE","pool","active","register","node","registered","unregister","updateNode","cmd","snd","updateNode_webaudio","updateNode_nativeaudio","updateNode_audio","alloc_webaudio","gainNode","createGain","gain","connect","destination","res","createBufferSource","free_webaudio","disconnect","alloc_nativeaudio","free_nativeaudio","alloc_audio","cloneNode","_src","free_audio","playing","playTime","onended","onended_webaudio","currentTarget","onended_nativeaudio","onended_audio","currentTime","enableTrack","disableTrack","setVolume","createNode","startVolume","timer","fadeOut","millis","setInterval","clearInterval","fadeIn","$65d2b3a10215be8b$export$2e2bcd8739ae039","$98da9e820325c982$export$2e2bcd8739ae039","mode","sounds","lastIndex","getRandomSound","playAt","playLoopAt","$962ed9d7301d41f5$export$f35845279390eafd","$962ed9d7301d41f5$export$84712d0562a614b8","$962ed9d7301d41f5$export$674d2eb4debbef0c","$962ed9d7301d41f5$export$7faa71ea66a694bb","$962ed9d7301d41f5$export$e1896ac0c4970221","$962ed9d7301d41f5$export$85990f0f98a390bb","$962ed9d7301d41f5$export$bc40a15752ef9732","$269819c585211764$export$2e2bcd8739ae039","queueKeys","order","object","priority","is_dirty","sort","cleanup","q","is_complete","forEachAsync","next_j","next_i","forEachRevAsync","alert","$8fbe7c62def81520$var$Callback","arg1","arg2","arg3","arg4","isEqual","exec","host","$8fbe7c62def81520$export$2e2bcd8739ae039","$6e8fae56d5c9e462$var$Handler","execf","execc","$6e8fae56d5c9e462$export$2e2bcd8739ae039","$9cd1b2dcba0587de$var$Rect","cx","cy","Rool","extendWithPoint","centerAt","contains","setAsUnion","intersects","_x1","_y1","_x2","_y2","setAsIntersection","topLeftRelative","resizeBy","ncx","ncy","isRight","containsPoint","tol","area","strict","flatten","unflatten","$9cd1b2dcba0587de$export$2e2bcd8739ae039","$7a42c96aa5a07952$var$TFunction","copyFrom","t0","t1","i0","x0","y0","integral","c0","accum","second_integral","Temp1","integrate","Temp2","accumulate","chopLeft","chopRight","map","n1","pad","char","$7a42c96aa5a07952$export$2e2bcd8739ae039","$ace8360e2cfa6e1b$var$Point2","ux","uy","upscaled","$ace8360e2cfa6e1b$export$2e2bcd8739ae039","$1c57a7a5c31212e2$var$Bounds2","ucx","ucy","ux1","uy1","ux2","uy2","trunc","dwidth","dheight","isForward","$1c57a7a5c31212e2$export$2e2bcd8739ae039","$ac8952ea217df100$var$Easing","Linear","IN","OUT","IN_OUT","Back","Bounce","getConst","Circ","Cubic","Expo","Power","Quad","Quartic","Quintic","Sine","Step","$ac8952ea217df100$export$2e2bcd8739ae039","$0a2ac68e8835ee7d$var$Block","commands","current","restart","isFinished","$0a2ac68e8835ee7d$export$2e2bcd8739ae039","$17ee904dcbcaf626$var$Command","op","started","field","_duration","_count","startValue","_startValue","endValue","_endValue","_cur","_last","block","blocks","table","ready","$17ee904dcbcaf626$export$2e2bcd8739ae039","$80d61c1edc9cb7c1$export$2e2bcd8739ae039","postinit","m","$84d383a09a16b4e4$export$2e2bcd8739ae039","$4b94c669024349bd$export$2e2bcd8739ae039","$e96263152fcfb753$export$2e2bcd8739ae039","setValue","getValue","$691aa130d5230084$export$2e2bcd8739ae039","$81fdab831c3a9480$export$2e2bcd8739ae039","typeOf","$76c619f4d354bea1$export$2e2bcd8739ae039","$542eca14b184acce$export$2e2bcd8739ae039","val","$abe2815fd5f3ff19$export$2e2bcd8739ae039","$bf36b1a5bc192e12$var$Anim","initialData","blockStack","cmdStack","copyTo","initial","speed","fieldName","curr","initialValue","Number","prepareFieldName","parallel","serial","repeat","wait","range","rangeTo","randt","PLAY","EXEC","_bounds_x1","_bounds_y1","translateX","deltaValue","translateY","deltaValueX","deltaValueY","easingX","easingY","endValueX","endValueY","moveX","moveY","scaleX","scaleY","$bf36b1a5bc192e12$export$2e2bcd8739ae039","$3b11994ec552f629$var$Boot","modules","module","startup","onStartup","shutdown","forEachAsyncRev","onShutdown","Module","$3b11994ec552f629$export$2e2bcd8739ae039","$476d0e7f54ba3113$var$GridElement","ext","container","_grid_remove_node","remover","ALIVE","VISIBLE","DIRTY","DEPTH_FLAG","alive","setId","setFlags","clearFlags","getFlags","andMask","setData","getData","setExt","extensionObject","getExt","visible","dirty","depthFlagEnabled","DEPTH_FLAG_ENABLED","depthFlag","sync","dWidth","dHeight","setPosition","USERDEF","LAST_FLAG","allocFlag","flag","$476d0e7f54ba3113$export$2e2bcd8739ae039","$f9df83ce147474f3$export$2e2bcd8739ae039","grid","offsx","offsy","kx","ky","stride","verifyIntersection","log2","_remove","forEachInRegion","flagsAndMask","flagsValue","j0","j1","selectInRegion","countInRegion","selectFirst","$d1d534f50952bc6d$var$Container","viewportBounds","scene","elementCount","drawCount","setViewportBounds","drawElement","syncZ","__zvalue","_zvalue","depthFlagChanged","render","$d1d534f50952bc6d$export$2e2bcd8739ae039","$1f915c67aedfcb32$var$Viewport","initialWidth","initialHeight","centerRatioX","centerRatioY","offset","focusFactorX","focusFactorY","focusRect","focusOffsX","focusOffsY","focusAxisX","focusAxisY","padding","focusBounds","screenBounds","tmpPoint","containerWidth","containerHeight","ENABLED","setContainerBounds","updateScreenBounds","updateBounds","setPadding","truncateToContainer","ws","hs","setOffsets","setScale","setGlobalScale","setCenter","setScreenPosition","getX","getY","getOffsetX","getOffsetY","getWidth","getHeight","focusX","focusY","updateForced","setFocusRect","setFocusOffsets","setFocusAxes","enabledX","enabledY","setFocusFactor","valueX","valueY","applyClip","applyTransform","toWorldSpace","toScreenSpace","$1f915c67aedfcb32$export$2e2bcd8739ae039","$ed5be6c2ecc39d20$var$Element","_shaderProgram","_uniformSetter","GridElement","destroyLater","disposeLater","uniformSetter","shaderChanged","g2","$ed5be6c2ecc39d20$export$2e2bcd8739ae039","$6a496304779e6a6f$var$tempPoint","$6a496304779e6a6f$var$Group","children","Element","addChild","ltranslate","getChild","_dx","_dy","getOffsets","$6a496304779e6a6f$export$2e2bcd8739ae039","$adf41e4c020767a4$var$Scene","minWidth","minHeight","maxHeight","containers","viewports","groupList","groups","disposalQueue","fupdater","updater","synchronizer","lupdater","destroyer","disposeQueued","setContainer","getContainer","setViewport","getViewport","addGroup","_removeGroup","removeGroup","viewportIndex","drawContainers","message","updateViewports","$adf41e4c020767a4$export$2e2bcd8739ae039","$0003129f6cdef4b9$export$2e2bcd8739ae039","__update","__context","_update","_sync","_destroy","$02bfd100113da117$export$2e2bcd8739ae039","Container","$ab2a25aece662a34$export$2e2bcd8739ae039","divisor","$df927cc629beded7$var$Mask","$df927cc629beded7$export$2e2bcd8739ae039","$9ac4344de7bd6d45$var$Label","_dirty","textWidth","textHeight","_align","_valign","textOffsetX","textOffsetY","align","valign","setText","$9ac4344de7bd6d45$export$2e2bcd8739ae039","$e59603c21bd46821$export$2e2bcd8739ae039","create","handlers","_callOnKeyboardEvent","callOnKeyboardEvent","_action","_keyCode","_keyState","$af7ce47de02fc2d8$export$2e2bcd8739ae039","_callOnPointerEvent","callOnPointerEvent","_p","_pointers","$63f749e9ad5ce2d0$var$ScreenControls","dummy","hoverEnabled","zindexEnabled","lastFrame","zindex","setHoverEnabled","setZIndexEnabled","findTarget","filterHover","_continue","_ref","pointerDeactivate","pointerActivate","_refh","hover","focusLock","pointerUpdate","keyArgs","keyboardEvents","keyDown","keyUp","$63f749e9ad5ce2d0$export$2e2bcd8739ae039","$2f0dc4add1e894f5$export$2e2bcd8739ae039","isPressed","wasPressed","unpressedImg","pressedImg","hitbox","Group","setImage","setKeyCode","onChange","pointerX","pointerY","setStatus","updateStatus","onButtonDown","onButtonUp","onTap","$aa69fed66c2ccf39$export$2e2bcd8739ae039","unpressedImgInner","pressedImgInner","angleSteps","radiusSteps","rdirx","rdiry","dirx","diry","frdirx","frdiry","fdirx","fdiry","fmagnitude","fangle","dispx","dispy","radius","maxRadius","deadZoneX","deadZoneY","setImageInner","setAngleSteps","setRadiusSteps","setDeadZone","atan2","fs","setDirection","freezeState","lastValid","$b6c74cb12796fb7f$var$system","$b6c74cb12796fb7f$export$2e2bcd8739ae039","$0b0065d0d6efcb9d$var$world","SCENE_MAIN","SCENE_HUD","LAYER_BG0","LAYER_BG1","LAYER_BG2","LAYER_BG3","LAYER_MAIN","LAYER_FG0","LAYER_FG1","LAYER_FG2","LAYER_FG3","LAYER_MASK","LAYER_HUD_BG0","LAYER_HUD_BG1","LAYER_HUD_MAIN","LAYER_HUD_FG0","LAYER_HUD_FG1","_scenes","activeScene","_viewports","activeViewport","activeContainer","activeGroup","lastGroup","lastElement","worldWidth","worldHeight","createScene","createViewport","selectScene","getScene","selectViewport","throwErrors","selectContainer","createGroup","endGroup","containerIndex","createMask","mask","createLabel","createUpdater","$0b0065d0d6efcb9d$export$2e2bcd8739ae039","$494fc6adce723614$export$2e2bcd8739ae039","$1295d1b42699c5b9$export$2e2bcd8739ae039","total","__resIdMustNotExist","placeholder","path","optsA","optsB","animation","configOptions","resOptions","srcSeq","dstSeq","spritefont","sfx","sfxm","music","$bda261992d3ee23f$export$2e2bcd8739ae039","sticks","_visible","layer","addStick","outerDrawable","innerDrawable","stick","addButton","unpressedDrawable","pressedDrawable","showMasks","$af647f85c3590fc0$var$input","_gamepads","activeGamepad","cursor","_enabled","_handler","_element","element","native","removeProperty","createGamepad","layerIndex","getGamepad","selectGamepad","debugGamepad","$af647f85c3590fc0$export$2e2bcd8739ae039","$336e2857cacd0310$var$collider","FLAG_EXCLUDE","contactRules","truncationRules","maskLayer","flagsAnd","state","contact","v0x","v0y","v1x","v1y","v2x","v2y","v0","w0","delta0","v1","delta1","t_dx","t_dy","sceneIndex","firstUpdate","later","run","_run","setVisible","_setVisible","_setValue","_setFlags","_clearFlags","primaryType","secondaryType","truncate","getContactFlags","boundsA","boundsB","numFlags","Contact","TOP","BOTTOM","calc","store0","v0a","v1a","v1b","attemptSelect","swapped","load0","save1","load1","resolveXpos","single","resolveYpos","resolveYneg","resolveXneg","commit","scan","offs","collisionItems","allowsTruncation","sv","HORIZONTAL","VERTICAL","$19f64daaa9117ac7$export$773cc7fa6f8304c3","$19f64daaa9117ac7$export$f965ae91e38a1274","$19f64daaa9117ac7$export$43caf9889c228507","$19f64daaa9117ac7$export$a79e2b3ea5d10ee0","$19f64daaa9117ac7$export$b7e3ae3d7c15e42e","$19f64daaa9117ac7$export$5fa227701309b621","$07c864e526abec17$export$4c85e640eb41c31b","$07c864e526abec17$export$19342e026b58ebb7","$kEriQ$Schema","$07c864e526abec17$export$14416b8d99d47caa","$kEriQ$Template","$07c864e526abec17$export$816be348776d53c1","$07c864e526abec17$export$e1dae5660003ffa7","$07c864e526abec17$export$c57e9b2d8b9e4de","$07c864e526abec17$export$a92776769f460054","$07c864e526abec17$export$e9e0d96f49f57c33","$07c864e526abec17$export$8d01c972ee8b14a9","$07c864e526abec17$export$7c4f444dab5ed59","$07c864e526abec17$export$ce30dbb46644d06c","$07c864e526abec17$export$462bb059fed9d9e5","$07c864e526abec17$export$cb01d642ebc0a347","$07c864e526abec17$export$eff95f126aa67cfb","$07c864e526abec17$export$573ab5fe783d8aac","$07c864e526abec17$export$e9a269813a6315a4","$07c864e526abec17$export$85990f0f98a390bb","$07c864e526abec17$export$fe264c04f294fd15","$07c864e526abec17$export$1034c64782e66715","$07c864e526abec17$export$54c2e3dc7acea9f5","$07c864e526abec17$export$8fbd1ac8e83536df","$07c864e526abec17$export$a428cd33b25d5283","$07c864e526abec17$export$5b12bf1653c0dd85","$07c864e526abec17$export$c79fc6492f3af13d","$07c864e526abec17$export$ac4bca90992eed1","$07c864e526abec17$export$c9b44e90c5031de0","$07c864e526abec17$export$3dc3622b48e72adc","$07c864e526abec17$export$79f93ddd76e66d40","$07c864e526abec17$export$cea96571ebbff9dd","$07c864e526abec17$export$deefd61317ad2797","$07c864e526abec17$export$5a2130c936f86fb8","$07c864e526abec17$export$cfb3877ce19bb838","$07c864e526abec17$export$ef2184bd89960b14","$07c864e526abec17$export$38af1803e3442a7f","$07c864e526abec17$export$d5c6c08dc2d3ca7","$07c864e526abec17$export$3386beb5bc3bfa","$07c864e526abec17$export$42a852a2b6b56249","$07c864e526abec17$export$eeaa45a7d92663a6","$07c864e526abec17$export$cc55614734af2d87","$07c864e526abec17$export$eb2fcfdbd7ba97d4","$07c864e526abec17$export$db77ccec0bb4ccac","$07c864e526abec17$export$991dcf7284de63d","$07c864e526abec17$export$b04be29aa201d4f5","$07c864e526abec17$export$474b8119f9aaf6a9","$07c864e526abec17$export$63d5558963a08ef6","$07c864e526abec17$export$f9b7ad1c9b000a93","$07c864e526abec17$export$353f5b6fc5456de1","$07c864e526abec17$export$85a6520672683043","$07c864e526abec17$export$2e2bcd8739ae039","$19f64daaa9117ac7$exports"],"version":3,"file":"froxel.js.map"}