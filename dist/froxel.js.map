{"mappings":"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","sources":["node_modules/.pnpm/rinn@2.0.41/node_modules/rinn/dist/src/model-constraints.js","node_modules/.pnpm/rinn@2.0.41/node_modules/rinn/dist/src/alpha.js","node_modules/.pnpm/rinn@2.0.41/node_modules/rinn/dist/src/model-regex.js","node_modules/.pnpm/rinn@2.0.41/node_modules/rinn/dist/src/class.js","node_modules/.pnpm/rinn@2.0.41/node_modules/rinn/dist/src/event.js","node_modules/.pnpm/rinn@2.0.41/node_modules/rinn/dist/src/event-dispatcher.js","node_modules/.pnpm/rinn@2.0.41/node_modules/rinn/dist/src/model.js","node_modules/.pnpm/rinn@2.0.41/node_modules/rinn/dist/src/model-list.js","node_modules/.pnpm/rinn@2.0.41/node_modules/rinn/dist/src/schema.js","node_modules/.pnpm/rinn@2.0.41/node_modules/rinn/dist/src/flattenable.js","node_modules/.pnpm/rinn@2.0.41/node_modules/rinn/dist/src/collection.js","node_modules/.pnpm/rinn@2.0.41/node_modules/rinn/dist/src/template.js","node_modules/.pnpm/rinn@2.0.41/node_modules/rinn/dist/src/main.js","src/main.js","src/system/random.js","src/system/keycode.js","src/utils/list.js","src/utils/linkable.js","src/utils/recycler.js","src/system/timer.js","src/system/canvas.js","src/math/matrix.js","src/math/vec2.js","src/system/shader-program.js","src/system/shader.js","src/system/system.js","src/system/log.js","src/system/globals.js","src/system/perf.js","src/system/framebuffer.js","src/flow/drawable.js","src/resources/drawable.js","src/resources/custom.js","src/resources/spritesheet.js","src/resources/spritesheet-animation.js","src/resources/spritefont.js","src/resources/sound.js","src/resources/resources.js","src/resources/sound-array.js","src/resources/wrappers.js","src/utils/priority-queue.js","src/utils/handler.js","src/utils/callback.js","src/math/rect.js","src/math/tfunction.js","src/math/bounds2.js","src/math/point2.js","src/anim/easing.js","src/anim/anim.js","src/flow/boot.js","src/fxl/system.js","src/anim/block.js","src/anim/command.js","src/anim/parallel.js","src/anim/serial.js","src/anim/repeat.js","src/anim/set.js","src/anim/restart.js","src/anim/wait.js","src/anim/range.js","src/anim/rand.js","src/anim/randt.js","src/flow/grid-element.js","src/flow/grid.js","src/flow/scene.js","src/flow/container.js","src/flow/viewport.js","src/flow/element.js","src/flow/group.js","src/flow/updater.js","src/flow/simple-container.js","src/flow/grid-container.js","src/flow/mask.js","src/flow/label.js","src/flow/keyboard-handler.js","src/flow/pointer-handler.js","src/flow/screen-controls.js","src/flow/button.js","src/flow/stick.js","src/fxl/world.js","src/fxl/r.js","src/fxl/resources.js","src/fxl/gamepad.js","src/fxl/input.js","src/fxl/collider.js","src/fxl/fxl.js"],"sourcesContent":["/*\n**\trinn/model-constraints.js\n**\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Rinn from './alpha.js';\nimport Regex from './model-regex.js';\n\n/**\n**\tMap of model constraint handlers. Each function should accept parameters (in order): the model object (model), the constraint value (ctval),\n**\tthe property name (name), the property value (value) and return the corrected value once verified or throw an exception if errors occur.\n*/\n\nexport default\n{\n\t/**\n\t**\tUtility function (not a handler) to get the real value given a reference string. If the value is not a string, the value itself will\n\t**\tbe returned, if it is a string starting with '#' the model property will be returned, if starts with '@' the object property will be\n\t**\treturned, otherwise the contents of the string will eval'd and returned.\n\t*/\n\t_getref: function (value, obj)\n\t{\n\t\tif (typeof(value) == \"string\")\n\t\t{\n\t\t\tif (value.substr(0, 1) == \"#\")\t\t\tvalue = obj.get(value.substr(1));\n\t\t\telse if (value.substr(0, 1) == \"@\")\t\tvalue = obj[value.substr(1)];\n\n\t\t\tif (typeof(value) == \"string\")\n\t\t\t\treturn eval(value);\n\n\t\t\treturn value;\n\t\t}\n\t\telse\n\t\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the new value is of the valid type before storing it on the property. When possible if the\n\t**\tinput is of compatible type it will be converted to the target type.\n\t*/\n\ttype: function (model, ctval, name, value)\n\t{\n\t\tswitch (ctval)\n\t\t{\n\t\t\tcase \"int\":\n\t\t\t\tvalue = parseInt(value);\n\t\t\t\tif (isNaN(value)) throw new Error (ctval);\n\t\t\t\tbreak;\n\n\t\t\tcase \"float\":\n\t\t\t\tvalue = parseFloat(value);\n\t\t\t\tif (isNaN(value)) throw new Error (ctval);\n\t\t\t\tbreak;\n\n\t\t\tcase \"string\":\n\t\t\t\tvalue = (value === null || value === undefined) ? \"\" : value.toString();\n\t\t\t\tbreak;\n\n\t\t\tcase \"bit\":\n\t\t\t\tif (value === true || value === false) {\n\t\t\t\t\tvalue = value ? 1 : 0;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tvalue = parseInt(value);\n\t\t\t\tif (isNaN(value)) throw new Error (ctval);\n\n\t\t\t\tvalue = value ? 1 : 0;\n\t\t\t\tbreak;\n\n\t\t\tcase \"array\":\n\t\t\t\tif (Rinn.typeOf(value) == \"array\")\n\t\t\t\t\tbreak;\n\n\t\t\t\tif (value === null || value === undefined)\n\t\t\t\t{\n\t\t\t\t\tvalue = [];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tthrow new Error (ctval);\n\t\t\t\tbreak;\n\n\t\t\tcase \"bool\":\n\t\t\t\tif (value === \"true\" || value === true) {\n\t\t\t\t\tvalue = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (value === \"false\" || value === false) {\n\t\t\t\t\tvalue = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tthrow new Error (ctval);\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the field is of the specified model type.\n\t*/\n\tmodel: function (model, ctval, name, value)\n\t{\n\t\tvar mclass = this._getref(ctval, model);\n\t\tif (!mclass) throw new Error (ctval);\n\n\t\tif (!value)\n\t\t\treturn new mclass();\n\n\t\treturn mclass.ensure (value);\n\t},\n\n\n\t/**\n\t**\tVerifies that the field is of the specified class.\n\t*/\n\tcls: function (model, ctval, name, value)\n\t{\n\t\tvar mclass = this._getref(ctval, model);\n\t\tif (!value) return new mclass();\n\n\t\treturn Rinn.ensureTypeOf(mclass, value);\n\t},\n\n\n\t/**\n\t**\tVerifies that the array contents are of the specified class. Returns error if the class does not exist\n\t**\tor if the field is not an array. Therefore a type:array constraint should be used before this one.\n\t*/\n\tarrayof: function (model, ctval, name, value)\n\t{\n\t\tvar mclass = this._getref(ctval, model);\n\t\tif (!value) value = [];\n\n\t\tif (!mclass || Rinn.typeOf(value) != \"array\")\n\t\t\tthrow new Error (ctval);\n\n\t\tfor (var i = 0; i < value.length; i++)\n\t\t\tvalue[i] = Rinn.ensureTypeOf(mclass, value[i]);\n\t\t\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the array contents are not null. Returns error if the field is not an array, therefore a\n\t**\ttype:array constraint should be used before this one.\n\t*/\n\tarraynull: function (model, ctval, name, value)\n\t{\n\t\tvar remove = false;\n\n\t\tif (Rinn.typeOf(ctval) == \"object\")\n\t\t{\n\t\t\tif (ctval.remove) remove = ctval.remove;\n\t\t\tctval = ctval.value;\n\t\t}\n\n\t\tif (ctval) return value;\n\n\t\tif (Rinn.typeOf(value) != \"array\")\n\t\t\tthrow new Error (ctval);\n\n\t\tfor (var i = 0; i < value.length; i++)\n\t\t{\n\t\t\tif (value[i] == null)\n\t\t\t{\n\t\t\t\tif (remove)\n\t\t\t\t\tvalue.splice (i--, 1);\n\t\t\t\telse\n\t\t\t\t\tthrow new Error (ctval);\n\t\t\t}\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the array contents are all compliant. Returns error if the field is not an array, therefore\n\t**\ta type:array constraint should be used before this one.\n\t*/\n\tarraycompliant: function (model, ctval, name, value)\n\t{\n\t\tvar remove = false;\n\n\t\tif (Rinn.typeOf(ctval) == \"object\")\n\t\t{\n\t\t\tif (ctval.remove) remove = ctval.remove;\n\t\t\tctval = ctval.value;\n\t\t}\n\n\t\tif (!ctval) return value;\n\n\t\tif (Rinn.typeOf(value) != \"array\")\n\t\t\tthrow new Error (ctval);\n\n\t\tfor (var i = 0; i < value.length; i++)\n\t\t{\n\t\t\tif (value[i] == null)\n\t\t\t\tcontinue;\n\n\t\t\tif (!value[i].isCompliant())\n\t\t\t{\n\t\t\t\tif (remove)\n\t\t\t\t\tvalue.splice (i--, 1);\n\t\t\t\telse\n\t\t\t\t\tthrow new Error (ctval);\n\t\t\t}\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the presense of the field.\n\t*/\n\trequired: function (model, ctval, name, value)\n\t{\n\t\tif (value === null || value === undefined)\n\t\t\tthrow new Error (ctval ? \"\" : \"null\");\n\n\t\tswitch (Rinn.typeOf(value))\n\t\t{\n\t\t\tcase \"array\":\n\t\t\t\tif (value.length == 0) throw new Error (ctval ? \"\" : \"null\");\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tif (value.toString().length == 0) throw new Error (ctval ? \"\" : \"null\");\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the minimum length of the field.\n\t*/\n\tminlen: function (model, ctval, name, value)\n\t{\n\t\tif (value.toString().length < ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the maximum length of the field.\n\t*/\n\tmaxlen: function (model, ctval, name, value)\n\t{\n\t\tif (value.toString().length > ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the minimum value of the field.\n\t*/\n\tminval: function (model, ctval, name, value)\n\t{\n\t\tif (parseFloat(value) < ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the maximum value of the field.\n\t*/\n\tmaxval: function (model, ctval, name, value)\n\t{\n\t\tif (parseFloat(value) > ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the minimum number of items in the array.\n\t*/\n\tmincount: function (model, ctval, name, value)\n\t{\n\t\tif (Rinn.typeOf(value) != \"array\" || value.length < ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the maximum number of items in the array.\n\t*/\n\tmaxcount: function (model, ctval, name, value)\n\t{\n\t\tif (Rinn.typeOf(value) != \"array\" || value.length > ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the format of the field using a regular expression. The constraint value should be the name of\n\t**\tone of the Model.Regex regular expressions.\n\t*/\n\tpattern: function (model, ctval, name, value)\n\t{\n\t\tif (!Regex[ctval].test (value.toString()))\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the field is inside the specified set of options. The set can be an array or a string with\n\t**\tthe options separated by vertical bar (|). The comparison is case-sensitive.\n\t*/\n\tinset: function (model, ctval, name, value)\n\t{\n\t\tif (Rinn.typeOf(ctval) != \"array\")\n\t\t{\n\t\t\tif (!new RegExp(\"^(\"+ctval.toString()+\")$\").test (value.toString()))\n\t\t\t\tthrow new Error (ctval);\n\n\t\t\treturn value;\n\t\t}\n\n\t\tif (ctval.indexOf(value.toString()) == -1)\n\t\t\tthrow new Error (ctval.join(\"|\"));\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tSets the field to upper case.\n\t*/\n\tupper: function (model, ctval, name, value)\n\t{\n\t\treturn ctval ? value.toString().toUpperCase() : value;\n\t},\n\n\n\t/**\n\t**\tSets the field to lower case.\n\t*/\n\tlower: function (model, ctval, name, value)\n\t{\n\t\treturn ctval ? value.toString().toLowerCase() : value;\n\t}\n};\n","/*\r\n**\trinn/alpha.js\r\n**\r\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nlet Rinn = { };\r\nexport default Rinn;\r\n\r\n/*\r\n**\tInvokes the specified function 'fn' 10ms later.\r\n**\r\n**\t>> void invokeLater (function fn);\r\n*/\r\nRinn.invokeLater = function (fn)\r\n{\r\n\tif (fn) setTimeout (function() { fn(); }, 10);\r\n};\r\n\r\n\r\n/*\r\n**\tWaits for the specified amount of milliseconds. Returns a Promise.\r\n**\r\n**\t>> Promise wait (int millis);\r\n*/\r\nRinn.wait = function (millis)\r\n{\r\n\treturn new Promise(function (resolve, reject) {\r\n\t\tsetTimeout (resolve, millis);\r\n\t});\r\n};\r\n\r\n\r\n/*\r\n**\tReturns the type of an element 'o', properly detects arrays and null types. The return string is always in lowercase.\r\n**\r\n**\t>> string typeOf (any o);\r\n*/\r\nRinn.typeOf = function (o)\r\n{\r\n\tif (o instanceof Array)\r\n\t\treturn \"array\";\r\n\r\n\tif (o === null)\r\n\t\treturn \"null\";\r\n\r\n\treturn (typeof(o)).toString().toLowerCase();\r\n};\r\n\r\n\r\n/*\r\n**\tReturns boolean indicating if the type of the element is an array or an object.\r\n**\r\n**\t>> bool isArrayOrObject (any o);\r\n*/\r\nRinn.isArrayOrObject = function (o)\r\n{\r\n\tswitch (Rinn.typeOf(o))\r\n\t{\r\n\t\tcase \"array\": case \"object\":\r\n\t\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\n\r\n/*\r\n**\tCreates a clone (deep copy) of the specified element. The element can be an array, an object or a primitive type.\r\n**\r\n**\t>> T clone (T elem);\r\n*/\r\nRinn.clone = function (elem)\r\n{\r\n\tlet o = Rinn.typeOf(elem);\r\n\r\n\tif (o === 'array')\r\n\t{\r\n\t\to = [ ];\r\n\r\n\t\tfor (let i = 0; i < elem.length; i++)\r\n\t\t\to.push (Rinn.clone(elem[i]));\r\n\t}\r\n\telse if (o === 'object')\r\n\t{\r\n\t\tif (('clone' in elem) && typeof(elem.clone) === 'function')\r\n\t\t\treturn elem.clone();\r\n\r\n\t\to = { };\r\n\r\n\t\tfor (let i in elem)\r\n\t\t\to[i] = Rinn.clone(elem[i]);\r\n\t}\r\n\telse\r\n\t{\r\n\t\to = elem;\r\n\t}\r\n\r\n\treturn o;\r\n};\r\n\r\n\r\n/*\r\n**\tMerges all given elements into the first one, object fields are cloned.\r\n**\r\n**\t>> T merge (T... elems)\r\n*/\r\nRinn.merge = function (output, ...objs)\r\n{\r\n\tif (Rinn.typeOf(output) == \"array\")\r\n\t{\r\n\t\tfor (let i = 0; i < objs.length; i++)\r\n\t\t{\r\n\t\t\tlet arr = objs[i];\r\n\r\n\t\t\tif (Rinn.typeOf(arr) != \"array\")\r\n\t\t\t{\r\n\t\t\t\toutput.push(arr);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tfor (let j = 0; j < arr.length; j++)\r\n\t\t\t\t{\r\n\t\t\t\t\toutput.push(Rinn.clone(arr[j]));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse if (Rinn.typeOf(output) == \"object\")\r\n\t{\r\n\t\tfor (let i = 0; i < objs.length; i++)\r\n\t\t{\r\n\t\t\tlet obj = objs[i];\r\n\t\t\tif (Rinn.typeOf(obj) != \"object\") continue;\r\n\r\n\t\t\tfor (let field in obj)\r\n\t\t\t{\r\n\t\t\t\tif (Rinn.isArrayOrObject(obj[field]))\r\n\t\t\t\t{\r\n\t\t\t\t\tif (field in output)\r\n\t\t\t\t\t\tRinn.merge(output[field], obj[field]);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\toutput[field] = Rinn.clone(obj[field]);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\toutput[field] = obj[field];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn output;\r\n};\r\n\r\n\r\n/*\r\n**\tAssigns all fields from the specified objects into the first one.\r\n**\r\n**\t>> object override (object output, object... objs)\r\n*/\r\nRinn.override = function (output, ...objs)\r\n{\r\n\tfor (let i = 0; i < objs.length; i++)\r\n\t{\r\n\t\tfor (let j in objs[i])\r\n\t\t{\r\n\t\t\toutput[j] = objs[i][j];\r\n\t\t}\r\n\t}\r\n\r\n\treturn output;\r\n};\r\n\r\n\r\n/*\r\n**\tCompares two objects and returns `true` if all properties in \"partial\" find a match in \"full\".\r\n*/\r\nRinn.partialCompare = function (full, partial)\r\n{\r\n\tif (full == null || partial == null) return false;\r\n\r\n\tif (full === partial)\r\n\t\treturn true;\r\n\r\n\tfor (var i in partial)\r\n\t{\r\n\t\tif (full[i] != partial[i])\r\n\t\t\treturn false;\r\n\t}\r\n\r\n\treturn true;\r\n};\r\n\r\n\r\n/*\r\n**\tPerforms a partial search for an object (o) in the specified array and returns its index or `false` if the\r\n**\tobject was not found. When `getObject` is set to `true` the object will be returned instead of an index, or\r\n**\t`null` if not found.\r\n*/\r\nRinn.arrayFind = function (arr, o, getObject)\r\n{\r\n\tfor (var i = 0; arr && i < arr.length; i++)\r\n\t{\r\n\t\tif (this.partialCompare (arr[i], o))\r\n\t\t\treturn getObject ? arr[i] : i;\r\n\t}\r\n\r\n\treturn getObject ? null : false;\r\n};\r\n\r\n\r\n/*\r\n**\tVerifies if the specified object is of class `m`, returns boolean.\r\n**\r\n**\t>> bool isTypeOf (object obj, class _class);\r\n*/\r\nRinn.isInstanceOf = function (obj, _class)\r\n{\r\n\tif (!obj || !_class || typeof(obj) !== 'object')\r\n\t\treturn false;\r\n\r\n\tif (obj instanceof _class)\r\n\t\treturn true;\r\n\r\n\tif ('isInstanceOf' in obj)\r\n\t\treturn obj.isInstanceOf(_class);\r\n\r\n\treturn false;\r\n};\r\n\r\n\r\n/*\r\n**\tTraverses the given object attempting to find the index/key that does an identical match with the specified value,\r\n**\tif not found returns -1, otherwise the index/key where the value was found.\r\n**\r\n**\t>> int indexOf (array container, T value)\r\n**\t>> string indexOf (object container, T value)\r\n*/\r\nRinn.indexOf = function (container, value, forceArray=false)\r\n{\r\n\tif (forceArray)\r\n\t{\r\n\t\tfor (let i = 0; i < container.length; i++)\r\n\t\t{\r\n\t\t\tif (container[i] === value)\r\n\t\t\t\treturn i;\r\n\t\t}\r\n\t\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tfor (let i in container)\r\n\t{\r\n\t\tif (container[i] === value)\r\n\t\t\treturn i;\r\n\t}\r\n\r\n\treturn -1;\r\n};\r\n\r\n\r\n/*\r\n**\tEscapes a string using HTML entities.\r\n**\r\n**\t>> string escape (string str);\r\n*/\r\nRinn.escape = function (str)\r\n{\r\n\treturn (str+\"\").replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\r\n};\r\n\r\n\r\n/*\r\n**\tVerifies if the specified object is of class `m`, if not it will create a new instance of `m` passing `o` as parameter.\r\n**\r\n**\t>> object ensureTypeOf (class m, object o);\r\n*/\r\nRinn.ensureTypeOf = function (m, o)\r\n{\r\n\tif (!o || !m || o instanceof m)\r\n\t\treturn o;\r\n\r\n\tif (o.isInstanceOf && m.prototype.className)\r\n\t{\r\n\t\tif (o.isInstanceOf (m.prototype.className))\r\n\t\t\treturn o;\r\n\t}\r\n\r\n\treturn new m (o);\r\n};\r\n\r\n\r\n/*\r\n**\tSerializes an object and returns its JSON string representation.\r\n**\r\n**\t>> string serialize (object o);\r\n*/\r\nRinn.serialize = function (o)\r\n{\r\n\treturn JSON.stringify(o);\r\n};\r\n\r\n\r\n/*\r\n**\tDeserializes a string in JSON format and returns the result.\r\n**\r\n**\t>> any deserialize (string s);\r\n*/\r\nRinn.deserialize = function (s)\r\n{\r\n\treturn JSON.parse(s);\r\n};\r\n\r\n\r\n/*\r\n**\tChains a new function to an existing one on some object, such that invoking the function on the object will cause\r\n**\tboth functions to run (order would be oldFunction then newFunction).\r\n**\r\n**\tIf the `conditional` flag is set to `true`, the second function will be run only if the first one returns non-false.\r\n**\tReturns an object with a single method 'unhook' which will revert the changes to leave only the original function.\r\n**\r\n**\t>> object{function unhook} hook (Object object, String functionName, function newFunction, bool conditional=false);\r\n*/\r\nRinn.hookAppend = function (object, functionName, newFunction, conditional=true)\r\n{\r\n\tconst oldFunction = object[functionName];\r\n\r\n\tif (conditional)\r\n\t{\r\n\t\tobject[functionName] = function (...args) {\r\n\t\t\tif (oldFunction.apply (this, args) !== false)\r\n\t\t\t\treturn newFunction.apply (this, args);\r\n\t\t};\r\n\t}\r\n\telse\r\n\t{\r\n\t\tobject[functionName] = function (...args) {\r\n\t\t\toldFunction.apply (this, args);\r\n\t\t\treturn newFunction.apply (this, args);\r\n\t\t};\r\n\t}\r\n\r\n\treturn { \r\n\t\tunhook: function() {\r\n\t\t\tobject[functionName] = oldFunction;\r\n\t\t}\r\n\t};\r\n};\r\n\r\n\r\n/*\r\n**\tChains a new function to an existing one on some object, such that invoking the function on the object will cause\r\n**\tboth functions to run (order would be oldFunction then newFunction).\r\n**\r\n**\tIf the `conditional` flag is set to `true`, the second function will be run only if the first one returns non-false.\r\n**\tReturns an object with a single method 'unhook' which will revert the changes to leave only the original function.\r\n**\r\n**\t>> object{function unhook} hook (Object object, String functionName, function newFunction, bool conditional=false);\r\n*/\r\nRinn.hookPrepend = function (object, functionName, newFunction, conditional=true)\r\n{\r\n\tconst oldFunction = object[functionName];\r\n\r\n\tif (conditional)\r\n\t{\r\n\t\tobject[functionName] = function (...args) {\r\n\t\t\tif (newFunction.apply (this, args) !== false)\r\n\t\t\t\treturn oldFunction.apply (this, args);\r\n\t\t};\r\n\t}\r\n\telse\r\n\t{\r\n\t\tobject[functionName] = function (...args) {\r\n\t\t\tnewFunction.apply (this, args);\r\n\t\t\treturn oldFunction.apply (this, args);\r\n\t\t};\r\n\t}\r\n\r\n\treturn { \r\n\t\tunhook: function() {\r\n\t\t\tobject[functionName] = oldFunction;\r\n\t\t}\r\n\t};\r\n};\r\n","/*\n**\trinn/model-regex.js\n**\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tCommon regular expressions for pattern validation.\n*/\n\nexport default\n{\n\temail: /^[_a-z0-9-]+(\\.[_a-z0-9-]+)*@[a-z0-9-]+(\\.[a-z0-9-]+)+$/i,\n\turl: /^[\\w-]+:\\/\\/[\\w-]+(\\.\\w+)+.*$/,\n\turlNoProt: /^[\\w-]+(\\.\\w+)+.*$/,\n\tname: /^[-A-Za-z0-9_.]+$/,\n\tuname: /^['\\pL\\pN ]+$/,\n\ttext: /^[^&<>{}]*$/,\n\tutext: /^([\\r\\n\\pL\\pN\\pS &!@#$%*\\[\\]()_+=;',.\\/?:\"~-]+)$/\n};\n","/*\r\n**\trinn/class.js\r\n**\r\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nimport Rinn from './alpha.js';\r\n\r\n/**\r\n * \tBase class used to create other classes with complex prototype based multiple inheritance while at the\r\n * \tsame time avoiding the prototype chain for faster access. Supports calling parent class methods.\r\n */\r\n\r\n//!class Class\r\nconst Class = function ()\r\n{\r\n};\r\n\r\n/**\r\n * \tReference to the class itself.\r\n */\r\nClass._class = Class;\r\n\r\n/**\r\n * \tContains the methods of each of the super classes.\r\n */\r\nClass._super = { };\r\n\r\n/**\r\n * \tName of the class, if none specified the class will be considered \"final\" and will not be inheritable.\r\n * \t@public @type {string}\r\n * \t!string className;\r\n */\r\nClass.prototype.className = 'Class';\r\n\r\n/**\r\n * \tClass constructor, should initialize the instance. Invoked when the `new` keyword is used with the class.\r\n * \t!__ctor() : Class;\r\n */\r\nClass.prototype.__ctor = function ()\r\n{\r\n};\r\n\r\n/**\r\n * \tClass destructor, should clear the instance and release any used resources, invoked when the global `dispose` function\r\n * \tis called with an instance as parameter.\r\n * \t!__dtor() : void;\r\n */\r\nClass.prototype.__dtor = function ()\r\n{\r\n};\r\n\r\n/**\r\n * \tReturns true if the object is an instance of the specified class, the parameter can be a class name (string), a constructor (function) or\r\n * \ta class instance (object), in any cases the appropriate checks will be done.\r\n *\r\n * \t@param {string|function|object} className\r\n * \t@returns {boolean}\r\n *\r\n * \t!isInstanceOf (className: string|function|object) : boolean;\r\n */\r\nClass.prototype.isInstanceOf = function (className)\r\n{\r\n\tif (className === null)\r\n\t\treturn false;\r\n\r\n\tif (typeof(className) === 'function')\r\n\t{\r\n\t\tclassName = className.prototype.className;\r\n\t}\r\n\telse if (typeof(className) !== 'string')\r\n\t{\r\n\t\tclassName = className.__proto__.className;\r\n\t}\r\n\r\n\treturn this.className === className ? true : this._super.hasOwnProperty(className);\r\n};\r\n\r\n/**\r\n * \tReturns true if the given object is an instance of the specified class, the parameter can be a class name (string), a constructor (function)\r\n * \tor a class instance (object), in any cases the appropriate checks will be done.\r\n *\r\n * \t@param {Object} object\r\n * \t@param {string|function|object} className\r\n *\r\n *\t!instanceOf (object: object, className: string|function|object) : boolean;\r\n */\r\nClass.instanceOf = function (object, className)\r\n{\r\n\tif (object === null || className === null)\r\n\t\treturn false;\r\n\r\n\treturn object.isInstanceOf(className);\r\n};\r\n\r\n/**\r\n * \tInternal method to ensure the _super field of an instance has all functions properly bound to the instance.\r\n */\r\nClass.prototype._initSuperRefs = function ()\r\n{\r\n\tlet _super = this.constructor._super;\r\n\tlet _newSuper = { };\r\n\r\n\tconst self = this;\r\n\r\n\tfor (let i in _super)\r\n\t{\r\n\t\tlet o = { };\r\n\r\n\t\tlet _prot = _super[i].prototype;\r\n\t\tfor (let j in _prot)\r\n\t\t{\r\n\t\t\tif (Rinn.typeOf(_prot[j]) !== 'function')\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\to[j] = (function(fn)\r\n\t\t\t{\r\n\t\t\t\treturn function (a00, a01, a02, a03, a04, a05, a06, a07, a08, a09, a0A) {\r\n\t\t\t\t\treturn fn.call(self, a00, a01, a02, a03, a04, a05, a06, a07, a08, a09, a0A);\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t(_prot[j]);\r\n\t\t}\r\n\r\n\t\t_newSuper[i] = o;\r\n\t}\r\n\r\n\tthis._super = _newSuper;\r\n};\r\n\r\n\r\n/*\r\n**\tExtends the class with the specified prototype. The prototype can be a function (class constructor) or an object. Note that the\r\n**\tclass will be modified (and returned) instead of creating a new class. Must be called at the class-level (**not** instance level).\r\n**\tWhen a class is provided all fields starting with uppercase at the class-level will not be inherited, this is used to create constants\r\n**\ton classes without having them to be copied to derived classes.\r\n**\r\n**\t>> class inherit (constructor classConstructor);\r\n**\t>> class inherit (object obj);\r\n*/\r\nClass.inherit = function (proto)\r\n{\r\n\tlet self = this._class;\r\n\r\n\tlet _super = self._super;\r\n\tlet _class = self._class;\r\n\r\n\tif (Rinn.typeOf(proto) === 'function')\r\n\t{\r\n\t\t// Move constants (uppercased properties) to the class-level instead of prototype-level.\r\n\t\tfor (let i in proto._class)\r\n\t\t\tif (!/^[A-Z]/.test(i)) self[i] = proto._class[i];\r\n\r\n\t\t// Combine methods and properties.\r\n\t\tRinn.override (self.prototype, proto._class.prototype);\r\n\r\n\t\t// Combine super references.\r\n\t\tRinn.override (_super, proto._class._super);\r\n\r\n\t\t// Add new super reference if className specified in inherited prototypes.\r\n\t\tif (proto._class.prototype.className)\r\n\t\t\t_super[proto._class.prototype.className] = proto._class;\r\n\t}\r\n\telse\r\n\t{\r\n\t\tRinn.override (self.prototype, proto);\r\n\t}\r\n\r\n\tself._super = _super;\r\n\tself._class = _class;\r\n\r\n\treturn self;\r\n};\r\n\r\n\r\n/*\r\n**\tInternal method used to extend a class with one or more prototypes.\r\n**\r\n**\t>> class _extend (object base, object[] protos);\r\n*/\r\nClass.prototype._extend = function (base, protos)\r\n{\r\n\tif (protos.length === 0)\r\n\t\treturn base;\r\n\r\n\t//VIOLET OPTIMIZE\r\n\tconst _class = function (...args)\r\n\t{\r\n\t\tthis._initSuperRefs();\r\n\t\tthis.__ctor.apply(this, args);\r\n\t};\r\n\r\n\t_class._class = _class;\r\n\t_class._super = { };\r\n\r\n\tClass.inherit.call (_class, base);\r\n\tdelete _class.prototype.className;\r\n\r\n\tfor (let i = 0; i < protos.length; i++)\r\n\t\t_class.inherit (protos[i]);\r\n\r\n\tdelete _class._super.Class;\r\n\r\n\tif ('classInit' in _class.prototype)\r\n\t\t_class.prototype.classInit();\r\n\r\n\t_class.isInstance = function(value) {\r\n\t\treturn Rinn.isInstanceOf(value, _class);\r\n\t};\r\n\r\n\treturn _class;\r\n};\r\n\r\n\r\n/**\r\n * \tCreates a new class with the specified prototypes each of which can be a class constructor (function) or an object.\r\n */\r\nClass.extend = function (...protos)\r\n{\r\n\treturn this._class.prototype._extend (this, protos);\r\n};\r\n\r\n\r\n/*\r\n**\tCreates a new instance of a class resulting from extending the self class with the specified prototype.\r\n**\r\n**\t>> object create (object proto);\r\n*/\r\nClass.create = function (proto)\r\n{\r\n\treturn new (this.extend(proto)) ();\r\n};\r\n\r\nexport default Class;\r\n","/*\r\n**\trinn/event.js\r\n**\r\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nimport Rinn from './alpha.js';\r\nimport Class from './class.js';\r\n\r\n/**\r\n**\tHolds the information about a triggered event. It also provides a mechanism to allow asynchronous\r\n**\tevent propagation to ensure the event chain order.\r\n*/\r\n\r\nexport default Class.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"Event\",\r\n\r\n\t/**\r\n\t**\tSource of the event.\r\n\t*/\r\n\tsource: null,\r\n\r\n\t/**\r\n\t**\tName of the event.\r\n\t*/\r\n\tname: null,\r\n\r\n\t/**\r\n\t**\tArguments of the event.\r\n\t*/\r\n\targs: null,\r\n\r\n\t/**\r\n\t**\tIndicates if the last event handler wants to use async mode.\r\n\t*/\r\n\t_async: false,\r\n\r\n\t/**\r\n\t**\tQueue of all handlers to invoke.\r\n\t*/\r\n\tlist: null,\r\n\r\n\t/**\r\n\t**\tNext event to be executed in the event chain.\r\n\t*/\r\n\tnext: null,\r\n\r\n\t/**\r\n\t**\tReturn values from event handlers.\r\n\t*/\r\n\tret: null,\r\n\r\n\t/**\r\n\t**\tOriginal root event.\r\n\t*/\r\n\toriginal: null,\r\n\r\n\t/**\r\n\t**\tIndex of the current event handler.\r\n\t*/\r\n\ti: -1,\r\n\r\n\t/**\r\n\t**\tContructs an event object with the specified parameters. Source is the event-dispatcher object, list is\r\n\t**\tan array with all the listeners to invoke. The eventName and eventArgs are the event information to be\r\n\t**\tpassed to each handler and if a callback is specified (cbHandler+cbContext) it will be executed once all\r\n\t**\tthe event handlers have been processed.\r\n\t**\r\n\t**\tEvent __ctor (source: EventDispatcher, list: Array, eventName: string, eventArgs: map, cbHandler: function, cbContext: object);\r\n\t*/\r\n\t__ctor: function (source, list, eventName, eventArgs, cbHandler, cbContext)\r\n\t{\r\n\t\tthis.source = source;\r\n\r\n\t\tthis.name = eventName;\r\n\t\tthis.args = eventArgs;\r\n\r\n\t\tthis.cbHandler = cbHandler;\r\n\t\tthis.cbContext = cbContext;\r\n\r\n\t\tthis.list = list;\r\n\t\tthis.reset();\r\n\t},\r\n\r\n\t/**\r\n\t**\tResets the event to its initial state. An event object can be reused by resetting it and then\r\n\t**\tinvoking the resume event.\r\n\t**\r\n\t**\tEvent reset ();\r\n\t*/\r\n\treset: function ()\r\n\t{\r\n\t\tthis.next = null;\r\n\t\tthis.ret = [];\r\n\r\n\t\tthis._async = false;\r\n\t\tthis.i = -1;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tChanges the source of the event.\r\n\t**\r\n\t**\tEvent setSource (object value);\r\n\t*/\r\n\tsetSource: function (value)\r\n\t{\r\n\t\tthis.source = value;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tSets the internal asynchronous flag. Should be called before a handler returns. If a handler\r\n\t**\tcalls this method it should also call resume() when async operations are finished.\r\n\t**\r\n\t**\tEvent wait ();\r\n\t*/\r\n\twait: function ()\r\n\t{\r\n\t\tthis._async = true;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tResumes event propagation. Should be called manually by event handlers that also call wait().\r\n\t**\r\n\t**\tEvent resume ();\r\n\t*/\r\n\tresume: function ()\r\n\t{\r\n\t\tthis._async = false;\r\n\r\n\t\twhile (!this._async)\r\n\t\t{\r\n\t\t\tif (++this.i >= this.list.length)\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tif (this.list[this.i].silent)\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tif (Rinn.typeOf(this.list[this.i].handler) == \"string\")\r\n\t\t\t{\r\n\t\t\t\tif (this.list[this.i].context)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (!this.list[this.i].context[this.list[this.i].handler])\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\tif (this.list[this.i].context[this.list[this.i].handler] (this, this.args, this.list[this.i].data) === false)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tif (global[this.list[this.i].handler].call (null, this, this.args, this.list[this.i].data) === false)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (this.list[this.i].handler.call (this.list[this.i].context, this, this.args, this.list[this.i].data) === false)\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._async)\r\n\t\t\treturn this;\r\n\r\n\t\tif (this.i >= this.list.length && this.next) this.next.resume();\r\n\r\n\t\tif (this.cbHandler)\r\n\t\t\tthis.cbHandler.call (this.cbContext);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tSets the \"original\" property of the event to indicate where the original event comes from.\r\n\t**\r\n\t**\tEvent from (event: Event);\r\n\t*/\r\n\tfrom: function (event)\r\n\t{\r\n\t\tthis.original = event;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tEnqueues the specified event to be executed upon the current event process is finished. The \"original\"\r\n\t**\tproperty of the chained event will be set to the current event.\r\n\t**\r\n\t**\tEvent enqueueEvent (event: Event);\r\n\t*/\r\n\tenqueue: function (event)\r\n\t{\r\n\t\tif (!event) return this;\r\n\r\n\t\tvar evt;\r\n\t\tfor (evt = this; evt.next != null; evt = evt.next);\r\n\r\n\t\tevt.next = event;\r\n\t\tevent.from (this);\r\n\r\n\t\treturn this;\r\n\t}\r\n});\r\n","/*\r\n**\trinn/event-dispatcher.js\r\n**\r\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nimport Class from './class.js';\r\nimport Event from './event.js';\r\n\r\n/**\r\n**\tEvent dispatcher allows several event listeners to be attached, these will be invoked whenever the\r\n**\tevent that is being listened to is triggered.\r\n*/\r\n\r\nexport default Class.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"EventDispatcher\",\r\n\r\n\t/**\r\n\t**\tListeners attached to this event dispatcher. Grouped by event name.\r\n\t*/\r\n\tlisteners: null,\r\n\r\n\t/**\r\n\t**\tNamespace for event dispatching. Defaults to null. Can be modified using setNamespace().\r\n\t*/\r\n\tnamespace: null,\r\n\r\n\t/**\r\n\t**\tInitializes the event dispatcher.\r\n\t**\r\n\t**\tEventDispatcher __ctor ();\r\n\t*/\r\n\t__ctor: function ()\r\n\t{\r\n\t\tthis.listeners = { };\r\n\t},\r\n\r\n\t/**\r\n\t**\tSets the event dispatching namespace. Used to force all events dispatched to have the specified namespace.\r\n\t**\r\n\t**\tEventDispatcher setNamespace (value: string);\r\n\t*/\r\n\tsetNamespace: function (value)\r\n\t{\r\n\t\tthis.namespace = value;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tAdds an event listener for a specified event to the event dispatcher. The event name can have an optional\r\n\t**\tnamespace indicator which is added to the beginning of the event name and separated using a colon (:). This\r\n\t**\tindicator can be used to later trigger or remove all handlers of an specific namespace.\r\n\t**\r\n\t**\tEventDispatcher addEventListener (eventName: string, handler: function, context: object, data: object);\r\n\t*/\r\n\taddEventListener: function (eventName, handler, context, data)\r\n\t{\r\n\t\teventName = eventName.split(\":\");\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tif (!this.listeners[name])\r\n\t\t\tthis.listeners[name] = [];\r\n\r\n\t\tthis.listeners[name].push ({ ns: ns, handler: handler, context: context, data: data, silent: 0 });\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tRemoves an event listener from the event dispatcher. If only the name is provided all handlers with the\r\n\t**\tspecified name will be removed. If a context is provided without a handler then any handler matching the\r\n\t**\tcontext will be removed. Special event name \"*\" can be used to match all event names.\r\n\t**\r\n\t**\tEventDispatcher removeEventListener (eventName: string, handler: function, context: object);\r\n\t*/\r\n\tremoveEventListener: function (eventName, handler, context)\r\n\t{\r\n\t\teventName = eventName.split(\":\");\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tif (name == \"*\")\r\n\t\t{\r\n\t\t\tfor (var j in this.listeners)\r\n\t\t\t{\r\n\t\t\t\tvar list = this.listeners[j];\r\n\r\n\t\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar k = true;\r\n\r\n\t\t\t\t\tif (handler)\r\n\t\t\t\t\t\tk = k && list[i].handler === handler;\r\n\r\n\t\t\t\t\tif (context)\r\n\t\t\t\t\t\tk = k && list[i].context === context;\r\n\r\n\t\t\t\t\tif (ns)\r\n\t\t\t\t\t\tk = k && list[i].ns == ns;\r\n\r\n\t\t\t\t\tif (k) list.splice(i--, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (!this.listeners[name])\r\n\t\t\t\treturn this;\r\n\r\n\t\t\tvar list = this.listeners[name];\r\n\r\n\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t{\r\n\t\t\t\tvar k = true;\r\n\r\n\t\t\t\tif (handler)\r\n\t\t\t\t\tk = k && list[i].handler === handler;\r\n\r\n\t\t\t\tif (context)\r\n\t\t\t\t\tk = k && list[i].context === context;\r\n\r\n\t\t\t\tif (ns)\r\n\t\t\t\t\tk = k && list[i].ns == ns;\r\n\r\n\t\t\t\tif (k) list.splice(i--, 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tPrepares an event with the specified parameters for its later usage. The event is started when\r\n\t**\tthe resume() method is called. If a callback is specified it will be executed once all event\r\n\t**\thandlers have been processed.\r\n\t**\r\n\t**\tEvent prepareEvent (eventName: string, eventArgs: map, cbHandler: function, cbContext: object);\r\n\t**\tEvent prepareEvent (eventName: string, eventArgs: map);\r\n\t*/\r\n\tprepareEvent: function (eventName, eventArgs, cbHandler, cbContext)\r\n\t{\r\n\t\tvar list = [];\r\n\r\n\t\teventName = eventName.split(\":\");\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tif (this.listeners[name])\r\n\t\t\tlist = list.concat (this.listeners[name]);\r\n\r\n\t\tif (this.listeners[\"*\"])\r\n\t\t\tlist = list.concat (this.listeners[\"*\"]);\r\n\r\n\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\tif (list[i].silent) list.splice (i--, 1);\r\n\r\n\t\tif (ns)\r\n\t\t{\r\n\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t\tif (list[i].ns != ns) list.splice (i--, 1);\r\n\t\t}\r\n\r\n\t\treturn new Event (this, list, name, eventArgs, cbHandler, cbContext);\r\n\t},\r\n\r\n\t/**\r\n\t**\tSilences or unsilences all handlers attached to an event such that if the event fires the handler(s) will\r\n\t**\tnot be invoked. It is recommended to use a namespace to ensure other handlers will continue to be run.\r\n\t**\r\n\t**\tEventDispatcher silence (eventName: string);\r\n\t*/\r\n\tsilence: function (eventName, value)\r\n\t{\r\n\t\teventName = eventName.split(\":\");\r\n\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tvalue = value === false ? -1 : 1;\r\n\r\n\t\tif (name == \"*\")\r\n\t\t{\r\n\t\t\tfor (var j in this.listeners)\r\n\t\t\t{\r\n\t\t\t\tvar list = this.listeners[j];\r\n\r\n\t\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (ns && list[i].ns != ns)\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\tlist[i].silent += value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (!this.listeners[name])\r\n\t\t\t\treturn this;\r\n\r\n\t\t\tvar list = this.listeners[name];\r\n\r\n\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t{\r\n\t\t\t\tif (ns && list[i].ns != ns)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tlist[i].silent += value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tDispatches an event to the respective listeners. If a callback is specified it will be executed once\r\n\t**\tall event handlers have been processed.\r\n\t**\r\n\t**\tEvent dispatchEvent (eventName: string, eventArgs: map, cbHandler: function, cbContext: object);\r\n\t**\tEvent dispatchEvent (eventName: string, eventArgs: map);\r\n\t*/\r\n\tdispatchEvent: function (eventName, eventArgs, cbHandler, cbContext)\r\n\t{\r\n\t\treturn this.prepareEvent(this.namespace ? this.namespace+':'+eventName : eventName, eventArgs, cbHandler, cbContext).resume();\r\n\t}\r\n});\r\n","/*\n**\trinn/model.js\n**\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Rinn from './alpha.js';\nimport EventDispatcher from './event-dispatcher.js';\n\n/**\n**\tA model is a high-integrity data object used to store properties and more importantly to provide event support to notify of any\n**\tkind of change that occurs to the model's properties. Integrity of the model is maintained by optionally using property constraints.\n*/\n\nlet _Model = EventDispatcher.extend\n({\n\t/**\n\t**\tName of the class.\n\t*/\n\tclassName: \"Model\",\n\n\t/**\n\t**\tDefault properties for the model. Can be a map with the property name and its default value or a function\n\t**\treturning a map with dynamic default values. This is used to reset the model to its initial state.\n\t*/\n\tdefaults: null,\n\n\t/**\n\t**\tModel property contraints. A map with the property name and an object specifying the constraints of the\n\t**\tproperty. This is used to determine the type, format and behavior of each property in the model.\n\t*/\n\tconstraints: null,\n\n\t/**\n\t**\tProperties of the model.\n\t*/\n\tdata: null,\n\n\t/**\n\t**\tArray with the name of the properties that have changed. Populated prior modelChanged event.\n\t*/\n\tchangedList: null,\n\n\t/**\n\t**\tSilent mode indicator. While in silent mode events will not be dispatched.\n\t*/\n\t_silent: 0,\n\n\t/**\n\t**\tCurrent nesting level of the set() method. This is used to determine when all the property\n\t**\tchanges are done.\n\t*/\n\t_level: 0,\n\n\t/**\n\t**\tInitializes the model and sets the properties to the specified data object.\n\t**\n\t**\t>> Model __ctor (object data);\n\t**\t>> Model __ctor (object data, object defaults);\n\t*/\n\t__ctor: function (data, defaults)\n\t{\n\t\tthis._super.EventDispatcher.__ctor();\n\n\t\tthis.data = { };\n\n\t\tif (defaults != null)\n\t\t{\n\t\t\tthis.reset (defaults, false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet o = null;\n\n\t\t\tif (!this.defaults && this.constraints)\n\t\t\t{\n\t\t\t\to = { };\n\n\t\t\t\tfor (let i in this.constraints)\n\t\t\t\t{\n\t\t\t\t\tlet j = this.constraints[i];\n\t\t\t\t\tif (j.def === null || j.def === undefined)\n\t\t\t\t\t{\n\t\t\t\t\t\to[i] = null;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof(j.def) === 'function')\n\t\t\t\t\t\to[i] = j.def();\n\t\t\t\t\telse\n\t\t\t\t\t\to[i] = j.def;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.reset(o);\n\t\t}\n\n\t\tthis.init();\n\n\t\tif (data != null)\n\t\t\tthis.set (data, true);\n\n\t\tif (this.constraints) this.update();\n\n\t\tthis.ready();\n\t},\n\n\t/**\n\t**\tResets the model to its default state and triggers update events. If a map is provided the defaults of\n\t**\tthe model will be set to the specified map.\n\t**\n\t**\t>> Model reset (object defaults, [bool nsilent=true]);\n\t**\t>> Model reset ([bool nsilent=true]);\n\t*/\n\treset: function (defaults, nsilent)\n\t{\n\t\tif (!this.defaults)\n\t\t{\n\t\t\tif (!defaults || (Rinn.typeOf(defaults) !== 'object' && Rinn.typeOf(defaults) !== 'function'))\n\t\t\t\treturn this;\n\n\t\t\tthis.defaults = defaults;\n\t\t}\n\n\t\tif (Rinn.typeOf(this.defaults) === 'function')\n\t\t\tthis.data = this.defaults();\n\t\telse\n\t\t\tthis.data = Rinn.clone(this.defaults);\n\n\t\treturn (nsilent === false || defaults === false) ? this : this.update(null, true);\n\t},\n\n\t/**\n\t**\tInitializes the model. Called before the model properties are set.\n\t**\n\t**\t>> void init ();\n\t*/\n\tinit: function ()\n\t{\n\t},\n\n\t/**\n\t**\tInitialization epilogue. Called after initialization and after model properties are set.\n\t**\n\t**\t>> void ready ();\n\t*/\n\tready: function ()\n\t{\n\t},\n\n\t/**\n\t**\tEnables or disables silent mode. When the model is in silent mode events will not be dispatched.\n\t**\n\t**\t>> Model silent (value: bool);\n\t*/\n\tsilent: function (value)\n\t{\n\t\tthis._silent += value ? 1 : -1;\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tValidates a property name and value against the constraints defined in the model (if any). Returns the\n\t**\tfinal value if successful or throws an empty exception if errors occur.\n\t**\n\t**\t>> T _validate (string name, T value);\n\t*/\n\t_validate: function (name, value)\n\t{\n\t\tif (!this.constraints || !this.constraints[name])\n\t\t\treturn value;\n\n\t\tvar constraints = this.constraints[name];\n\n\t\tvar nvalue = value;\n\n\t\tfor (var ctname in constraints)\n\t\t{\n\t\t\tif (!_Model.Constraints[ctname])\n\t\t\t\tcontinue;\n\n\t\t\ttry {\n\t\t\t\tnvalue = _Model.Constraints[ctname] (this, constraints[ctname], name, nvalue);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tif (e.message == \"null\")\n\t\t\t\t\tbreak;\n\n\t\t\t\tthrow new Error (`Constraint [${ctname}:${constraints[ctname]}] failed on property '${name}'.`);\n\t\t\t}\n\t\t}\n\n\t\treturn nvalue;\n\t},\n\n\t/**\n\t**\tSets the value of a property and returns the value set. This method is internally used to set properties\n\t**\tone at a time. If constraints are present in the model for the specified property all constraints will be\n\t**\tverified. When constraint errors occur the constraintError event will be raised and the property value\n\t**\twill not be changed.\n\t**\n\t**\t>> T _set (string name, T value);\n\t*/\n\t_set: function (name, value)\n\t{\n\t\tif (!this.constraints || !this.constraints[name])\n\t\t{\n\t\t\tthis.data[name] = value;\n\t\t\treturn value;\n\t\t}\n\n\t\tvar constraints = this.constraints[name];\n\n\t\tvar cvalue = this.data[name];\n\t\tvar nvalue = value;\n\n\t\tfor (var ctname in constraints)\n\t\t{\n\t\t\tif (!_Model.Constraints[ctname])\n\t\t\t\tcontinue;\n\n\t\t\ttry {\n\t\t\t\tnvalue = _Model.Constraints[ctname] (this, constraints[ctname], name, nvalue);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tif (e.message == \"null\")\n\t\t\t\t\tbreak;\n\n\t\t\t\tif (!this._silent)\n\t\t\t\t\tthis.dispatchEvent (\"constraintError\", { constraint: ctname, message: e.message, name: name, value: value });\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn (this.data[name] = nvalue);\n\t},\n\n\t/**\n\t**\tTriggers property events to indicate a property is changing. First triggers \"propertyChanging\" and then\n\t**\t\"propertyChanged\". If the first event returns false the second event will not be triggered.\n\t**\n\t**\t>> void _propertyEvent (string name, T prev, T value, bool direct=false);\n\t*/\n\t_propertyEvent: function (name, prev, value, direct)\n\t{\n\t\tvar temp = { name: name, old: prev, value: value, level: this._level };\n\n\t\tvar evt = this.dispatchEvent (\"propertyChanging\", temp);\n\n\t\tif (!direct)\n\t\t\ttemp.value = this._set (name, temp.value);\n\t\telse\n\t\t\tthis.data[name] = temp.value;\n\n\t\tif (evt != null && evt.ret.length && evt.ret[0] === false)\n\t\t\treturn;\n\n\t\tthis.dispatchEvent (\"propertyChanged.\" + name, temp);\n\t\tthis.dispatchEvent (\"propertyChanged\", temp);\n\n\t\tthis.changedList.push (name);\n\t},\n\n\t/**\n\t**\tSets one or more properties of the model. Possible arguments can be two strings or a map.\n\t**\n\t**\t>> Model set (string name, T value, bool force=true);\n\t**\t>> Model set (string name, T value, bool silent=false);\n\t**\t>> Model set (string name, T value);\n\t**\t>> Model set (object data);\n\t*/\n\tset: function ()\n\t{\n\t\tvar n = arguments.length;\n\t\tvar force = false, silent = false;\n\n\t\tif ((n > 2 || (n == 2 && Rinn.typeOf(arguments[0]) == \"object\")) && Rinn.typeOf(arguments[n-1]) == \"boolean\")\n\t\t{\n\t\t\tforce = arguments[--n];\n\t\t\tif (force === false) silent = true;\n\t\t}\n\n\t\tif (this._level == 0)\n\t\t{\n\t\t\tthis.changedList = [];\n\t\t}\n\n\t\tthis._level++;\n\n\t\tif (n == 2)\n\t\t{\n\t\t\tif (this.data[arguments[0]] != arguments[1] || force)\n\t\t\t{\n\t\t\t\tif (!this._silent && !silent)\n\t\t\t\t\tthis._propertyEvent (arguments[0], this.data[arguments[0]], this._validate (arguments[0], arguments[1]));\n\t\t\t\telse\n\t\t\t\t\tthis._set (arguments[0], arguments[1]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (var i in arguments[0])\n\t\t\t{\n\t\t\t\tif (this.data[i] != arguments[0][i] || force)\n\t\t\t\t{\n\t\t\t\t\tif (!this._silent && !silent)\n\t\t\t\t\t\tthis._propertyEvent (i, this.data[i], this._validate (i, arguments[0][i]));\n\t\t\t\t\telse\n\t\t\t\t\t\tthis._set (i, arguments[0][i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!--this._level && this.changedList.length && !silent && !this._silent)\n\t\t\tthis.dispatchEvent (\"modelChanged\", { fields: this.changedList });\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns true if the given key exists in the model.\n\t**\n\t**\t>> boolean has (string name);\n\t*/\n\thas: function (name)\n\t{\n\t\treturn name in this.data;\n\t},\n\n\t/**\n\t**\tReturns the value of a property. If no name is specified the whole map of properties will be returned.\n\t**\tIf a boolean value of \"true\" is provided the properties map will be returned but first will be compacted\n\t**\tusing the default data to ensure only valid properties are present.\n\t**\n\t**\t>> T get (string name);\n\t**\t>> object get ();\n\t**\t>> object get (true);\n\t**\t>> object get (false);\n\t**\t\n\t*/\n\tget: function (name, def)\n\t{\n\t\tif (arguments.length == 0 || name === false)\n\t\t\treturn this.data;\n\n\t\tif (arguments.length == 1 && name === true)\n\t\t\treturn this.flatten ();\n\n\t\tif (arguments.length == 2)\n\t\t\treturn this.data[name] === undefined ? def : this.data[name];\n\n\t\treturn this.data[name];\n\t},\n\n\t/**\n\t**\tReturns the value of a property as an integer number.\n\t**\n\t**\t>> int getInt (string name, [int def]);\n\t*/\n\tgetInt: function (name, def)\n\t{\n\t\tif (arguments.length == 2)\n\t\t\treturn this.data[name] === undefined ? def : parseInt (this.data[name]);\n\n\t\treturn parseInt (this.data[name]);\n\t},\n\n\t/**\n\t**\tReturns the value of a property as a floating point number.\n\t**\n\t**\t>> float getFloat (string name, [float def]);\n\t*/\n\tgetFloat: function (name, def)\n\t{\n\t\tif (arguments.length == 2)\n\t\t\treturn this.data[name] === undefined ? def : parseFloat (this.data[name]);\n\n\t\treturn parseFloat (this.data[name]);\n\t},\n\n\t/**\n\t**\tReturns the value of a property as a boolean value (true or false).\n\t**\n\t**\t>> bool getBool (string name, [bool def]);\n\t**\t\n\t*/\n\tgetBool: function (name, def)\n\t{\n\t\tif (arguments.length == 2)\n\t\t\tname = this.data[name] === undefined ? def : this.data[name];\n\t\telse\n\t\t\tname = this.data[name];\n\n\t\tif (name === \"true\" || name === true)\n\t\t\treturn true;\n\n\t\tif (name === \"false\" || name === false)\n\t\t\treturn false;\n\n\t\treturn parseInt (name) ? true : false;\n\t},\n\n\t/**\n\t**\tReturns a reference object for a model property. The resulting object contains two methods\n\t**\tnamed \"get\" and \"set\" to modify the value of the property.\n\t**\n\t**\t>> object getReference (string name);\n\t*/\n\tgetReference: function (name)\n\t{\t\n\t\tvar m = this;\n\n\t\treturn {\n\t\t\tget: function() {\n\t\t\t\treturn m.get(name);\n\t\t\t},\n\n\t\t\tset: function(value) {\n\t\t\t\tm.set(name, value);\n\t\t\t}\n\t\t};\n\t},\n\n\t/**\n\t**\tSets or returns a constraint given the property name. \n\t**\n\t**\t>> Model constraint (string field, string constraint, T value);\n\t**\t>> Model constraint (string field, object constraint);\n\t**\t>> Model constraint (object constraints);\n\t**\t>> object constraint (string field);\n\t*/\n\tconstraint: function (field, constraint, value)\n\t{\n\t\tif (arguments.length == 3 || arguments.length == 2 || (arguments.length == 1 && Rinn.typeOf(field) == \"object\"))\n\t\t{\n\t\t\tif (this.constraints === this.constructor.prototype.constraints)\n\t\t\t\tthis.constraints = Rinn.clone (this.constraints);\n\n\t\t\tswitch (arguments.length)\n\t\t\t{\n\t\t\t\tcase 1:\n\t\t\t\t\tRinn.override (this.constraints, field);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\t\t\t\t\tRinn.override (this.constraints[field], constraint);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 3:\n\t\t\t\t\tthis.constraints[field][constraint] = value;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\treturn !field ? this : this.constraints[field];\n\t},\n\n\t/**\n\t**\tReturns a compact version of the model properties. That is, a map only with validated properties that are\n\t**\talso present in the default data map. Returns null if the object is not compliant. If the \"safe\" parameter\n\t**\tis set one last property named \"class\" will be attached, this specifies the original classPath of the object.\n\t**\n\t**\t>> object flatten ([bool safe=false]);\n\t*/\n\tflatten: function (safe, rsafe)\n\t{\n\t\tif (safe)\n\t\t{\n\t\t\tvar data = this.flatten(false, true);\n\t\t\tif (data == null) return null;\n\n\t\t\tdata[\"class\"] = this.classPath;\n\t\t\treturn data;\n\t\t}\n\n\t\tif (!this.constraints && !this.defaults)\n\t\t\treturn this.data;\n\n\t\tif (!this.isCompliant())\n\t\t\treturn { };\n\n\t\tvar constraints = this.constraints;\n\t\tvar keys = this.defaults ? (Rinn.typeOf(this.defaults) == \"function\" ? this.defaults() : this.defaults) : this.constraints;\n\n\t\tvar data = { };\n\n\t\tfor (var i in this.data)\n\t\t{\n\t\t\tif (!(i in keys)) continue;\n\n\t\t\tif (constraints && constraints[i])\n\t\t\t{\n\t\t\t\tvar ct = constraints[i];\n\n\t\t\t\tif (ct.model)\n\t\t\t\t{\n\t\t\t\t\tdata[i] = this.data[i] ? this.data[i].flatten(rsafe) : null;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (ct.arrayof)\n\t\t\t\t{\n\t\t\t\t\tdata[i] = [];\n\n\t\t\t\t\tfor (var j = 0; j < this.data[i].length; j++)\n\t\t\t\t\t\tdata[i][j] = this.data[i][j] ? this.data[i][j].flatten(rsafe) : null;\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (ct.cls)\n\t\t\t\t{\n\t\t\t\t\tdata[i] = this.data[i] ? this.data[i].flatten() : null;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdata[i] = this.data[i];\n\t\t}\n\n\t\treturn data;\n\t},\n\n\t/**\n\t**\tRemoves a property or a list of properties.\n\t**\n\t**\t>> void remove (string name, [bool nsilent=true]);\n\t**\t>> void remove (array name, [bool nsilent=true]);\n\t*/\n\tremove: function (name, nsilent)\n\t{\n\t\tif (Rinn.typeOf(name) == \"array\")\n\t\t{\n\t\t\tfor (var i = 0; i < name.length; i++)\n\t\t\t\tdelete this.data[name[i]];\n\n\t\t\tif (nsilent !== false && !this._silent)\n\t\t\t\tthis.dispatchEvent (\"propertyRemoved\", { fields: name });\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdelete this.data[name];\n\n\t\t\tif (nsilent !== false && !this._silent)\n\t\t\t\tthis.dispatchEvent (\"propertyRemoved\", { fields: [name] });\n\t\t}\n\t},\n\n\t/**\n\t**\tTriggers data change events for one or more properties. Ensure that silent mode is not enabled or else\n\t**\tthis method will have no effect. If no parameters are provided a full update will be triggered on all of\n\t**\tthe model properties.\n\t**\n\t**\t>> Model update (array fields);\n\t**\t>> Model update (string name);\n\t**\t>> Model update (bool forceModelChanged);\n\t**\t>> Model update ();\n\t*/\n\tupdate: function (fields, direct)\n\t{\n\t\tif (this._silent) return this;\n\n\t\tif (this._level == 0)\n\t\t{\n\t\t\tthis.changedList = [];\n\t\t}\n\n\t\tthis._level++;\n\n\t\tif (fields && Rinn.typeOf(fields) == 'string')\n\t\t{\n\t\t\tthis._propertyEvent (fields, this.data[fields], this.data[fields], direct);\n\t\t}\n\t\telse if (fields && Rinn.typeOf(fields) == 'array')\n\t\t{\n\t\t\tfor (var i of fields)\n\t\t\t\tthis._propertyEvent (i, this.data[i], this.data[i], direct);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (var i in this.data)\n\t\t\t\tthis._propertyEvent (i, this.data[i], this.data[i], direct);\n\t\t}\n\n\t\tif (!--this._level && !this._silent && (this.changedList.length != 0 || fields === true))\n\t\t\tthis.dispatchEvent (\"modelChanged\", { fields: this.changedList });\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tValidates one or mode model properties using the defined constraints. If no parameters are provided all of\n\t**\tthe properties in the model will be validated.\n\t**\n\t**\t>> Model validate (array fields);\n\t**\t>> Model validate (string name);\n\t**\t>> Model validate ();\n\t*/\n\tvalidate: function (fields)\n\t{\n\t\tif (!this.constraints) return this;\n\n\t\tif (fields && Rinn.typeOf(fields) == \"string\")\n\t\t{\n\t\t\tthis._set (fields, this.data[fields])\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (var i in this.data)\n\t\t\t{\n\t\t\t\tif (fields && Rinn.indexOf(fields, i) == -1)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis._set (i, this.data[i])\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tValidates all the properties in the model and returns a boolean indicating if all of them comply with the\n\t**\tconstraints defined in the model.\n\t**\n\t**\t>> bool isCompliant ();\n\t*/\n\tisCompliant: function ()\n\t{\n\t\tif (!this.constraints) return true;\n\n\t\ttry\n\t\t{\n\t\t\tfor (var i in this.data)\n\t\t\t\tthis._validate (i, this.data[i]);\n\n\t\t\treturn true;\n\t\t}\n\t\tcatch (e) {\n\t\t}\n\n\t\treturn false;\n\t},\n\n\t/**\n\t**\tRegisters an event handler for changes in a specific property of the model.\n\t**\n\t**\t>> void observe (string property, function handler, object context);\n\t*/\n\tobserve: function (property, handler, context)\n\t{\n\t\tthis.addEventListener (\"propertyChanged.\" + property, handler, context);\n\t},\n\n\t/**\n\t**\tUnregisters an event handler from changes in a specific property of the model.\n\t**\n\t**\t>> void unobserve (string property, function handler, object context);\n\t*/\n\tunobserve: function (property, handler, context)\n\t{\n\t\tthis.removeEventListener (\"propertyChanged.\" + property, handler, context);\n\t},\n\n\t/**\n\t**\tAdds a propertyChanged event handler for the given property. The property name can have an event namespace prepended and separated by colon.\n\t**\n\t**\t>> void watch (string property, function handler);\n\t*/\n\twatch: function (property, handler)\n\t{\n\t\tproperty = property.split(':');\n\n\t\tif (property.length == 1)\n\t\t{\n\t\t\tproperty[1] = property[0];\n\t\t\tproperty[0] = 'watch';\n\t\t}\n\n\t\tthis.addEventListener (property[0]+\":propertyChanged.\"+property[1], function (evt, args) {\n\t\t\thandler (args.value, args, evt);\n\t\t});\n\t},\n\n\t/**\n\t**\tRemoves propertyChanged handlers related to the specified property. The property name can have an event namespace prepended and separated by colon.\n\t**\n\t**\t>> void unwatch (string property);\n\t*/\n\tunwatch: function (property)\n\t{\n\t\tproperty = property.split(':');\n\t\tif (property.length == 1)\n\t\t{\n\t\t\tproperty[1] = property[0];\n\t\t\tproperty[0] = 'watch';\n\t\t}\n\n\t\tthis.removeEventListener (property[0]+\":propertyChanged.\"+property[1]);\n\t},\n\n\t/**\n\t**\tSerializes the model into a string.\n\t**\n\t**\tstring toString ();\n\t*/\n\ttoString: function ()\n\t{\n\t\treturn Rinn.serialize(this.get (true));\n\t}\n});\n\n\n/**\n**\tImport model constraints.\n*/\n\nimport Constraints from './model-constraints.js';\n_Model.Constraints = Constraints;\n\nexport default _Model;\n","/*\n**\trinn/model-list.js\n**\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Rinn from './alpha.js';\nimport Model from './model.js';\n\n/**\n**\tGeneric list for models.\n*/\n\nexport default Model.extend\n({\n\t/**\n\t**\tName of the class.\n\t*/\n\tclassName: \"ModelList\",\n\n\t/**\n\t**\tClass of the items in the list, can be overriden by child classes to impose a more strict constraint.\n\t*/\n\titemt: Model,\n\n\t/**\n\t**\tMirror of data.contents\n\t*/\n\tcontents: null,\n\n\t/**\n\t**\tIDs of every item in the contents.\n\t*/\n\titemId: null,\n\n\t/**\n\t**\tAutoincremental ID for the next item to be added.\n\t*/\n\tnextId: null,\n\n\t/**\n\t**\tDefault properties of the model.\n\t*/\n\tdefaults:\n\t{\n\t\tcontents: null\n\t},\n\n\t/**\n\t**\tConstraints of the model to ensure integrity.\n\t*/\n\tconstraints:\n\t{\n\t\tcontents: {\n\t\t\ttype: \"array\",\n\t\t\tarrayof: \"@itemt\"\n\t\t}\n\t},\n\n\t/**\n\t**\tConstructor.\n\t*/\n\t__ctor: function (...args)\n\t{\n\t\tthis.itemId = [];\n\t\tthis.nextId = 0;\n\n\t\tthis._super.Model.__ctor(...args);\n\t},\n\n\t/**\n\t**\tInitialization epilogue. Called after initialization and after model properties are set.\n\t*/\n\tready: function ()\n\t{\n\t\tthis._eventGroup = \"ModelList_\" + Date.now() + \":modelChanged\";\n\n\t\tthis.contents = this.data.contents;\n\t},\n\n\t/**\n\t**\tConnects the event handlers to the item.\n\t**\n\t**\t>> Model _bind (int iid, Model item);\n\t*/\n\t_bind: function (iid, item)\n\t{\n\t\tif (item && item.addEventListener) item.addEventListener (this._eventGroup, this._onItemEvent, this, iid);\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tDisconnects the event handlers from the item.\n\t**\n\t**\t>> Model _unbind (Model item);\n\t*/\n\t_unbind: function (item)\n\t{\n\t\tif (item && item.removeEventListener) item.removeEventListener (this._eventGroup);\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tHandler for item events.\n\t**\n\t**\t>> Model _onItemEvent (Event evt, object args, int iid);\n\t*/\n\t_onItemEvent: function (evt, args, iid)\n\t{\n\t\tthis.prepareEvent (\"itemChanged\", { id: iid, item: evt.source }).from (evt)\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\t},\n\n\t/**\n\t**\tReturns the number of items in the list.\n\t**\n\t**\t>> int length ();\n\t*/\n\tlength: function ()\n\t{\n\t\treturn this.data.contents.length;\n\t},\n\n\t/**\n\t**\tClears the contents of the list.\n\t**\n\t**\t>> void clear ();\n\t*/\n\tclear: function ()\n\t{\n\t\tfor (var i = 0; i < this.data.contents; i++)\n\t\t\tthis._unbind (this.data.contents[i]);\n\n\t\tthis.itemId = [];\n\t\tthis.nextId = 0;\n\n\t\tthis.contents = this.data.contents = [];\n\n\t\tthis.prepareEvent (\"itemsCleared\")\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tSets the contents of the list with the specified array. All items will be ensured to be of the same model\n\t**\ttype as the one specified in the list.\n\t**\n\t**\t>> ModelList setData (array data);\n\t*/\n\tsetData: function (data)\n\t{\n\t\tthis.clear();\n\t\tif (!data) return this;\n\n\t\tfor (var i = 0; i < data.length; i++)\n\t\t{\n\t\t\tvar item = Rinn.ensureTypeOf(this.itemt, data[i]);\n\n\t\t\tthis.itemId.push(this.nextId++);\n\t\t\tthis.data.contents.push(item);\n\n\t\t\tthis._bind(this.nextId-1, item);\n\t\t}\n\n\t\tthis.prepareEvent (\"itemsChanged\")\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns the raw array contents of the list.\n\t**\n\t**\t>> array getData ();\n\t*/\n\tgetData: function ()\n\t{\n\t\treturn this.data.contents;\n\t},\n\n\t/**\n\t**\tReturns the item at the specified index or null if the index is out of bounds.\n\t**\n\t**\t>> Model getAt (int index);\n\t*/\n\tgetAt: function (index)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn null;\n\n\t\treturn this.data.contents[index];\n\t},\n\n\t/**\n\t**\tRemoves and returns the item at the specified index. Returns null if the index is out of bounds.\n\t**\n\t**\t>> Model removeAt (int index);\n\t*/\n\tremoveAt: function (index)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn null;\n\n\t\tlet item = this.data.contents.splice(index, 1)[0];\n\t\tlet id = this.itemId.splice(index, 1)[0];\n\n\t\tthis._unbind (item);\n\n\t\tthis.prepareEvent (\"itemRemoved\", { id: id, item: item })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume();\n\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tSets the item at the specified index. Returns false if the index is out of bounds, true otherwise. The\n\t**\titem will be ensured to be of the model defined in the list.\n\t**\n\t**\t>> bool setAt (int index, Model item);\n\t*/\n\tsetAt: function (index, item)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn false;\n\n\t\titem = Rinn.ensureTypeOf(this.itemt, item);\n\n\t\tthis._unbind(this.data.contents[index]);\n\t\tthis.data.contents[index] = item;\n\t\tthis._bind(this.itemId[index], item);\n\n\t\tthis.prepareEvent (\"itemChanged\", { id: this.itemId[index], item: item })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tNotifies a change in the item at the specified index. Returns false if the index is out of bounds.\n\t**\n\t**\t>> bool updateAt (int index);\n\t*/\n\tupdateAt: function (index)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn false;\n\n\t\tthis.prepareEvent (\"itemChanged\", { id: this.itemId[index], item: this.data.contents[index] })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tAdds an item to the bottom of the list. Returns null if the item is not an object or a model. The item\n\t**\twill be ensured to be of the model specified in the list.\n\t**\n\t**\t>> Model push (Model item);\n\t*/\n\tpush: function (item)\n\t{\n\t\tif (item && Rinn.typeOf(item) != \"object\")\n\t\t\treturn null;\n\n\t\titem = Rinn.ensureTypeOf(this.itemt, item);\n\n\t\tthis.itemId.push(this.nextId++);\n\t\tthis.data.contents.push (item);\n\t\tthis._bind(this.nextId-1, item);\n\n\t\tthis.prepareEvent (\"itemAdded\", { id: this.itemId[this.itemId.length-1], item: item, position: 'tail' })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tRemoves and returns an item from the bottom of the list.\n\t**\n\t**\t>> Model pop ();\n\t*/\n\tpop: function ()\n\t{\n\t\treturn this._unbind(this.data.contents.pop());\n\t},\n\n\t/**\n\t**\tAdds an item to the top of the list. Returns null if the item is not an object or a model. The item\n\t**\twill be ensured to be of the model specified in the list.\n\t**\n\t**\t>> Model unshift (Model item);\n\t*/\n\tunshift: function (item)\n\t{\n\t\tif (item && Rinn.typeOf(item) != \"object\")\n\t\t\treturn null;\n\n\t\titem = Rinn.ensureTypeOf(this.itemt, item);\n\n\t\tthis.itemId.unshift(this.nextId++);\n\t\tthis.data.contents.unshift (item);\n\t\tthis._bind(this.nextId-1, item);\n\n\t\tthis.prepareEvent (\"itemAdded\", { id: this.itemId[0], item: item, position: 'head' })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tRemoves and returns an item from the top of the list.\n\t**\n\t**\t>> Model shift ();\n\t*/\n\tshift: function ()\n\t{\n\t\treturn this._unbind(this.data.contents.shift());\n\t},\n\n\t/**\n\t**\tSearches for an item matching the specified partial definition and returns its index. Returns -1 if the\n\t**\titem was not found. If retObject is set to true the object will be returned instead of its index and null\n\t**\twill be returned when the item is not found.\n\t**\n\t**\tint|object find (object data, bool retObject=false);\n\t*/\n\tfind: function (data, retObject=false)\n\t{\n\t\tvar contents = this.data.contents;\n\n\t\tfor (var i = 0; i < contents.length; i++)\n\t\t{\n\t\t\tif (Rinn.partialCompare (contents[i].data, data))\n\t\t\t\treturn retObject ? contents[i] : i;\n\t\t}\n\n\t\treturn retObject ? null : -1;\n\t}\n});\n","/*\r\n**\trinn/schema\r\n**\r\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nimport Rinn from './alpha.js';\r\n\r\n/**\r\n**\tThe utility functions in this module allow to create a very strict serialization/deserialization schema\r\n**\tto ensure that all values are of the specific type when stored in string format.\r\n*/\r\n\r\nlet Schema =\r\n{\r\n\tType: function (proto)\r\n    {\r\n\t\tlet tmp =\r\n\t\t{\r\n            flatten: function (value, context) {\r\n                return value;\r\n            },\r\n\r\n            unflatten: function (value, context) {\r\n                return value;\r\n            }\r\n        };\r\n\r\n        return proto ? Rinn.override(tmp, proto) : tmp;\r\n    },\r\n\r\n\tString: function()\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\tflatten: function (value, context) {\r\n\t\t\t\treturn value != null ? value.toString() : null;\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn value != null ? value.toString() : null;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tInteger: function()\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\tflatten: function (value, context) {\r\n\t\t\t\treturn ~~value;\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn ~~value;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tNumber: function (precision)\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\t_precision: precision,\r\n\t\t\t_round: false,\r\n\r\n\t\t\tprecision: function (value)\r\n\t\t\t{\r\n\t\t\t\tthis._precision = ~~value;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tflatten: function (value, context)\r\n\t\t\t{\r\n\t\t\t\tvalue = parseFloat(value);\r\n\r\n\t\t\t\tif (this._precision > 0)\r\n\t\t\t\t\tvalue = (~~(value*Math.pow(10, this._precision))) / Math.pow(10, this._precision);\r\n\r\n\t\t\t\treturn value;\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn parseFloat(value);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tBool: function (compact)\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\t_compact: compact,\r\n\r\n\t\t\tcompact: function(value)\r\n\t\t\t{\r\n\t\t\t\tthis._compact = value;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tflatten: function (value, context) {\r\n\t\t\t\tvalue = ~~value;\r\n\t\t\t\treturn this._compact ? (value > 0 ? 1 : 0) : (value > 0 ? true : false);\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn (~~value) ? true : false;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tSharedString: function()\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\tflatten: function (value, context)\r\n\t\t\t{\r\n\t\t\t\tif (value == null) return 0;\r\n\r\n\t\t\t\tvalue = value.toString();\r\n\r\n                if (!(\"strings\" in context))\r\n                {\r\n                    context.index = { };\r\n                    context.strings = [ ];\r\n                }\r\n\r\n                if (!(value in context.index))\r\n                {\r\n                    context.strings.push(value);\r\n                    context.index[value] = context.strings.length;\r\n                }\r\n\r\n                return context.index[value];\r\n            },\r\n\r\n\t\t\tunflatten: function (value, context)\r\n\t\t\t{\r\n                return value == null || value == 0 ? null : context.strings[~~value - 1];\r\n            }\r\n        });\r\n    },\r\n\r\n\tArray: function (type)\r\n    {\r\n        return Schema.Type({\r\n\r\n\t\t\titemType: type,\r\n\t\t\t_debug: false,\r\n\t\t\t_filter: null,\r\n\r\n\t\t\tdebug: function(v) {\r\n\t\t\t\tthis._debug = v;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n            of: function (type) {\r\n                this.itemType = type;\r\n                return this;\r\n            },\r\n\r\n\t\t\tfilter: function (callback) {\r\n\t\t\t\tthis._filter = callback;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tflatten: function (value, context)\r\n\t\t\t{\r\n\t\t\t\tif (value == null) return null;\r\n\r\n                let o = [ ];\r\n\r\n                for (let i = 0; i < value.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (this._filter && !this._filter(value[i], i))\r\n\t\t\t\t\t\tcontinue;\r\n\r\n                    o.push(this.itemType.flatten(value[i], context));\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n\r\n\t\t\tunflatten: async function (value, context)\r\n\t\t\t{\r\n\t\t\t\tif (value == null) return null;\r\n\r\n                let o = [ ];\r\n\r\n\t\t\t\tfor (let i = 0; i < value.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\to.push(await this.itemType.unflatten(value[i], context));\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            }\r\n        });\r\n    },\r\n\r\n    Object: function()\r\n    {\r\n        return Schema.Type({\r\n\r\n            properties: [ ],\r\n\r\n            property: function (name, type, defvalue=null)\r\n            {\r\n                this.properties.push({ name: name, type: type, defvalue: defvalue });\r\n                return this;\r\n            },\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t{\r\n\t\t\t\t\to = { };\r\n\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (this.properties[i].name in value)\r\n\t\t\t\t\t\t\to[this.properties[i].name] = this.properties[i].type.flatten(value[this.properties[i].name], context);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\to[this.properties[i].name] = this.properties[i].type.flatten(this.properties[i].defvalue, context);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\to = [ ];\r\n\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (this.properties[i].name in value)\r\n\t\t\t\t\t\t\to.push(this.properties[i].type.flatten(value[this.properties[i].name], context));\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\to.push(this.properties[i].type.flatten(this.properties[i].defvalue, context));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n            \r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o = { };\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t{\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\to[this.properties[i].name] = await this.properties[i].type.unflatten(this.properties[i].name in value ? value[this.properties[i].name] : this.properties[i].defvalue, context);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\to[this.properties[i].name] = await this.properties[i].type.unflatten(i in value ? value[i] : this.properties[i].defvalue, context);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            }\r\n        });\r\n\t},\r\n\r\n    Class: function (classConstructor)\r\n    {\r\n\t\treturn Schema.Type\r\n\t\t({\r\n            _constructor: classConstructor,\r\n\r\n            constructor: function (classConstructor)\r\n            {\r\n                this._constructor = classConstructor;\r\n                return this;\r\n            },\r\n\r\n            flatten: function (value, context)\r\n            {\r\n                return value == null ? null : value.flatten(context);\r\n            },\r\n\r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\treturn value == null ? null : await (new this._constructor()).unflatten(value, context);\r\n            }\r\n        });\r\n\t},\r\n\r\n\t/*\r\n\t**\tUsed when you want to specify just a single property.\r\n\t*/\r\n    Property: function(name, type)\r\n    {\r\n        return Schema.Type({\r\n\r\n\t\t\tproperty: name,\r\n\t\t\ttype: type,\r\n\r\n\t\t\tname: function (name)\r\n\t\t\t{\r\n\t\t\t\tthis.property = name;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tis: function (type)\r\n\t\t\t{\r\n\t\t\t\tthis.type = type;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t{\r\n\t\t\t\t\to = { };\r\n\t\t\t\t\to[this.property] = this.type.flatten(value[this.property], context);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\to = this.type.flatten(value[this.property], context);\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n\r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o = { };\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t\to[this.property] = await this.type.unflatten(value[this.property], context);\r\n\t\t\t\telse\r\n\t\t\t\t\to[this.property] = await this.type.unflatten(value, context);\r\n\r\n                return o;\r\n            }\r\n        });\r\n\t},\r\n\r\n    Map: function()\r\n    {\r\n        return Schema.Type({\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t\treturn value;\r\n\r\n\t\t\t\tlet o = [ ];\r\n\r\n\t\t\t\tfor (let i in value)\r\n\t\t\t\t{\r\n\t\t\t\t\to.push(i);\r\n\t\t\t\t\to.push(value[i]);\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n\r\n            unflatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t\treturn value;\r\n\r\n\t\t\t\tlet o = { };\r\n\r\n\t\t\t\tfor (let i = 0; i < value.length; i += 2)\r\n\t\t\t\t\to[value[i]] = value[i+1];\r\n\r\n                return o;\r\n            }\r\n        });\r\n\t},\r\n\r\n    Selector: function ()\r\n    {\r\n        return Schema.Type({\r\n\r\n\t\t\tconditions: [],\r\n\t\t\tvalue: null,\r\n\r\n\t\t\twhen: function (value, type)\r\n\t\t\t{\r\n\t\t\t\tthis.conditions.push([ (val) => val === value, type ]);\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\twith: function (value)\r\n\t\t\t{\r\n\t\t\t\tthis.value = value;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tfor (let i of this.conditions)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (i[0](this.value) === true)\r\n\t\t\t\t\t\treturn i[1].flatten(value, context);\r\n\t\t\t\t}\r\n\r\n                return null;\r\n            },\r\n\r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tfor (let i of this.conditions)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (i[0](this.value) === true)\r\n\t\t\t\t\t\treturn await i[1].unflatten(value, context);\r\n\t\t\t\t}\r\n\r\n                return null;\r\n            }\r\n\r\n        });\r\n\t}\r\n};\r\n\r\nexport default Schema;\r\n","/*\r\n**\trinn/flattenable.js\r\n**\r\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nimport Class from './class.js';\r\n\r\n/**\r\n**\tClass used to add flattening and unflattening capabilities to any object. A \"flat\" object is an object composed\r\n**\tonly of native types, that is: `null,` `boolean`, `integer`, `number`, `array` or `object`.\r\n*/\r\n\r\nexport default Class.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"Flattenable\",\r\n\r\n\t/**\r\n\t**\tType schema used to flatten/unflatten the contents of this class. See Schema class for more information.\r\n\t*/\r\n\ttypeSchema: null,\r\n\r\n\t/**\r\n\t**\tReturns the flattened contents of the object.\r\n\t*/\r\n\tflatten: function (context)\r\n\t{\r\n\t\treturn this.typeSchema.flatten(this, context);\r\n\t},\r\n\r\n\t/**\r\n\t**\tUnflattens the given object and overrides the local contents.\r\n\t*/\r\n\tunflatten: async function (value, context)\r\n\t{\r\n\t\tObject.assign(this, await this.typeSchema.unflatten(value, context));\r\n\t\tawait this.onUnflattened();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecuted when the unflatten() method is called on the object.\r\n\t*/\r\n\tonUnflattened: async function ()\r\n\t{\r\n\t}\r\n});\r\n","/*\r\n**\trinn/collection.js\r\n**\r\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nimport Flattenable from './flattenable.js';\r\nimport Schema from './schema.js';\r\nimport Rinn from './alpha.js';\r\n\r\n/**\r\n**\tFlattenable collection class, used to store items and manipulate them. The items should also be flattenable.\r\n*/\r\n\r\nexport default Flattenable.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"Collection\",\r\n\r\n\t/**\r\n\t**\tDescribes the type schema of the underlying items.\r\n\t*/\r\n\titemTypeSchema: null,\r\n\r\n\t/**\r\n\t**\tArray of items.\r\n\t*/\r\n\titems: null, /* Array */\r\n\r\n\t/**\r\n\t**\tConstructs the collection.\r\n\t*/\r\n\t__ctor: function (itemTypeSchema)\r\n\t{\r\n\t\tif (!itemTypeSchema) itemTypeSchema = this.itemTypeSchema;\r\n\r\n\t\tif (itemTypeSchema)\r\n\t\t\tthis.typeSchema = Schema.Property('items').is(Schema.Array().of(itemTypeSchema));\r\n\r\n\t\tthis.reset();\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecuted after the collection has been unflattened, re-adds the items to ensure onItemAdded() is called.\r\n\t*/\r\n\tonUnflattened: function()\r\n\t{\r\n\t\tlet items = this.items;\r\n\t\tthis.reset();\r\n\r\n\t\tfor (let i of items)\r\n\t\t\tthis.add(i);\r\n\t},\r\n\r\n\t/**\r\n\t * \tExecuted when the value in `items` is changed.\r\n\t */\r\n\titemsReferenceChanged: function()\r\n\t{\r\n\t},\r\n\r\n\t/*\r\n\t**\tResets the collection to empty. Note that onItemRemoved will not be called.\r\n\t*/\r\n\treset: function ()\r\n\t{\r\n\t\tthis.items = [];\r\n\t\tthis.itemsReferenceChanged();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tClears the contents of the collection (removes each item manually, onItemRemoved will be called).\r\n\t*/\r\n\tclear: function ()\r\n\t{\r\n\t\tvar items = this.items;\r\n\t\tthis.reset();\r\n\r\n\t\tfor (var i = 0; i < items.length; i++)\r\n\t\t\tthis.onItemRemoved (items[i], 0);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tSorts the collection. A comparison function should be provided, or the name of a property to sort by.\r\n\t**\r\n\t**\tObject sort (fn: Function)\r\n\t**\tObject sort (prop: string, [desc:bool=false])\r\n\t*/\r\n\tsort: function (fn, desc)\r\n\t{\r\n\t\tif (typeof(fn) != \"function\")\r\n\t\t{\r\n\t\t\tthis.items.sort(function(a, b)\r\n\t\t\t{\r\n\t\t\t\treturn (a[fn] <= b[fn] ? -1 : 1) * (desc === true ? -1 : 1);\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis.items.sort(fn);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tSearches for an item with the specified fields and returns it. The \"inc\" object is the \"inclusive\" map, meaning all fields must match\r\n\t**\tand the optional \"exc\" is the exclusive map, meaning not even one field should match.\r\n\t**\r\n\t**\tObject findItem (inc: Object, exc: Object);\r\n\t*/\t\r\n\tfindItem: function (inc, exc)\r\n\t{\r\n\t\tif (!this.items) return null;\r\n\r\n\t\tfor (var i = 0; i < this.items.length; i++)\r\n\t\t{\r\n\t\t\tif (exc && Rinn.partialCompare(this.items[i], exc))\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tif (Rinn.partialCompare(this.items[i], inc))\r\n\t\t\t\treturn this.items[i];\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the container array.\r\n\t*/\r\n\tgetItems: function ()\r\n\t{\r\n\t\treturn this.items;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the number of items in the collection.\r\n\t*/\r\n\tlength: function ()\r\n\t{\r\n\t\treturn this.items.length;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns true if the collection is empty.\r\n\t*/\r\n\tisEmpty: function ()\r\n\t{\r\n\t\treturn !this.items.length;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the index of the specified item, or -1 if not found.\r\n\t*/\r\n\tindexOf: function (item)\r\n\t{\r\n\t\treturn this.items.indexOf(item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the item at the specified index, or null if not found. When `relative` is true, negative offsets are allowed such that -1 refers to the last item.\r\n\t*/\r\n\tgetAt: function (index, relative=false)\r\n\t{\r\n\t\tif (index < 0 && relative == true)\r\n\t\t\tindex += this.items.length;\r\n\r\n\t\treturn index >= 0 && index < this.items.length ? this.items[index] : null;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the first item in the collection.\r\n\t*/\r\n\tfirst: function ()\r\n\t{\r\n\t\treturn this.getAt(0);\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the last item in the collection.\r\n\t*/\r\n\tlast: function ()\r\n\t{\r\n\t\treturn this.getAt(-1, true);\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item at the specified index, effectively moving the remaining items to the right.\r\n\t*/\r\n\taddAt: function (index, item)\r\n\t{\r\n\t\tif (!item || !this.onBeforeItemAdded (item))\r\n\t\t\treturn this;\r\n\r\n\t\tif (index < 0) index = 0;\r\n\t\tif (index > this.items.length) index = this.items.length;\r\n\r\n\t\tif (index == 0)\r\n\t\t{\r\n\t\t\tthis.items.unshift(item);\r\n\t\t}\r\n\t\telse if (index == this.items.length)\r\n\t\t{\r\n\t\t\tthis.items.push(item);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar tmp = this.items.splice(0, index);\r\n\t\t\ttmp.push(item);\r\n\r\n\t\t\tthis.items = tmp.concat(this.items);\r\n\t\t\tthis.itemsReferenceChanged();\r\n\t\t}\r\n\r\n\t\tthis.onItemAdded (item);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item to the start of the collection, onBeforeItemAdded and onItemAdded will be triggered.\r\n\t*/\r\n\tunshift: function (item)\r\n\t{\r\n\t\treturn this.addAt(0, item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item to the end of the collection, onBeforeItemAdded and onItemAdded will be triggered.\r\n\t*/\r\n\tpush: function (item)\r\n\t{\r\n\t\treturn this.addAt(this.items.length, item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item to the end of the collection, onBeforeItemAdded and onItemAdded will be triggered.\r\n\t*/\r\n\tadd: function (item)\r\n\t{\r\n\t\treturn this.push(item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves the item at the specified index. When `relative` is true, negative offsets are allowed such that -1 refers to the last item.\r\n\t*/\r\n\tremoveAt: function (index, relative=false)\r\n\t{\r\n\t\tif (index < 0 && relative == true)\r\n\t\t\tindex += this.items.length;\r\n\r\n\t\tif (index < 0 || index >= this.items.length)\r\n\t\t\treturn null;\r\n\r\n\t\tvar item = this.items[index];\r\n\t\tthis.items.splice (index, 1);\r\n\t\tthis.onItemRemoved (item, index);\r\n\r\n\t\treturn item;\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves an item from the end of the collection.\r\n\t*/\r\n\tpop: function (item)\r\n\t{\r\n\t\treturn this.removeAt(-1, true);\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves an item from the start of the collection.\r\n\t*/\r\n\tshift: function (item)\r\n\t{\r\n\t\treturn this.removeAt(0);\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves the specified item from the collection.\r\n\t*/\r\n\tremove: function (item)\r\n\t{\r\n\t\treturn this.removeAt (this.indexOf(item));\r\n\t},\r\n\r\n\t/*\r\n\t**\tRuns the specified callback for each of the items in the collection, if false is returned by the callback this function\r\n\t**\twill exit immediately. Parameters to the callback are: (item, index, collection).\r\n\t*/\r\n\tforEach: function (callback)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = 0; i < this.items.length; i++)\r\n\t\t\tif (callback (this.items[i], i, this) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecutes a method call with the specified parameters on each of the items in the collection, if false is returned by the\r\n\t**\titem's method this function will exit immediately.\r\n\t*/\r\n\tforEachCall: function (method, ...args)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = 0; i < this.items.length; i++)\r\n\t\t\tif (this.items[i][method] (...args) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExactly the same as forEach but in reverse order.\r\n\t*/\r\n\tforEachRev: function (callback)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = this.items.length-1; i >= 0; i--)\r\n\t\t\tif (callback (this.items[i], i, this) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExactly the same as forEachCall but in reverse order.\r\n\t*/\r\n\tforEachRevCall: function (method, ...args)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = this.items.length-1; i >= 0; i--)\r\n\t\t\tif (this.items[i][method] (...args) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tHandler for the beforeItemAdded event. If returns false the item will not be added.\r\n\t*/\r\n\tonBeforeItemAdded: function (item)\r\n\t{\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/*\r\n\t**\tHandler for the itemAdded event.\r\n\t*/\r\n\tonItemAdded: function (item)\r\n\t{\r\n\t},\r\n\r\n\t/*\r\n\t**\tHandler for the itemRemoved event.\r\n\t*/\r\n\tonItemRemoved: function (item)\r\n\t{\r\n\t}\r\n});\r\n","/*\n**\trinn/template\n**\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Rinn from './alpha.js';\n\n/**\n**\tTemplating module. The template formats available are shown below, note that the sym-open and sym-close symbols are by\n**\tdefault the square brackets, however those can be modified since are just parameters.\n**\n**\tHTML Escaped Output:\t\t\t[data.value]\t\t\t\t\tEscapes HTML characters from the output.\n**\tRaw Output:\t\t\t\t\t\t[!data.value]\t\t\t\t\tDoes not escape HTML characters from the output (used to output direct HTML).\n**\tDouble-Quoted Escaped Output:\t[data.value]\t\t\t\t\tEscapes HTML characters and surrounds with double quotes.\n**\tImmediate Reparse:\t\t\t\t[<....] [@....] \"...\" '...'\t\tReparses the contents as if parseTemplate() was called again.\n**\tImmediate Output:\t\t\t\t[:...]\t\t\t\t\t\t\tTakes the contents and outputs exactly as-is without format and optionally surrounded by the\n**\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsym-open and sym-close symbols when the first character is not '<', sym_open or space.\n**\tFiltered Output:\t\t\t\t[functionName ... <expr> ...]\tRuns a function call, 'expr' can be any of the allowed formats shown here (nested if desired),\n**\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfunctionName should map to one of the available expression functions registered in the\n**\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tRinn.Template.functions map, each of which have their own parameters.\n*/\n\nlet Template =\n{\n\t/*\n\t**\tStrict mode flag. When set, any undefined expression function will trigger an exception.\n\t*/\n\tstrict: false,\n\n\t/**\n\t**\tParses a template and returns the compiled 'parts' structure to be used by the 'expand' method.\n\t**\n\t**\t>> array parseTemplate (string template, char sym_open, char sym_close, bool is_tpl=false);\n\t*/\n\tparseTemplate: function (template, sym_open, sym_close, is_tpl=false, root=1)\n\t{\n\t\tlet nflush = 'string', flush = null, state = 0, count = 0;\n\t\tlet str = '', parts = [], mparts = parts, nparts = false;\n\n\t\tif (is_tpl === true)\n\t\t{\n\t\t\ttemplate = template.trim();\n\t\t\tnflush = 'identifier';\n\t\t\tstate = 10;\n\n\t\t\tmparts.push(parts = []);\n\t\t}\n\n\t\ttemplate += \"\\0\";\n\n\t\tfunction unescape (value)\n\t\t{\n\t\t\tif (typeof(value) == 'object')\n\t\t\t{\n\t\t\t\tif (value instanceof Array)\n\t\t\t\t{\n\t\t\t\t\tfor (let i = 0; i < value.length; i++)\n\t\t\t\t\t\tunescape(value[i]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvalue.data = unescape(value.data);\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < value.length; i++)\n\t\t\t{\n\t\t\t\tif (value[i] == '\\\\')\n\t\t\t\t{\n\t\t\t\t\tlet r = value[i+1];\n\n\t\t\t\t\tswitch (r)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase 'n': r = \"\\n\"; break;\n\t\t\t\t\t\tcase 'r': r = \"\\r\"; break;\n\t\t\t\t\t\tcase 'f': r = \"\\f\"; break;\n\t\t\t\t\t\tcase 'v': r = \"\\v\"; break;\n\t\t\t\t\t\tcase 't': r = \"\\t\"; break;\n\t\t\t\t\t\tcase 's': r = \"\\s\"; break;\n\t\t\t\t\t\tcase '\"': r = \"\\\"\"; break;\n\t\t\t\t\t\tcase \"'\": r = \"\\'\"; break;\n\t\t\t\t\t}\n\n\t\t\t\t\tvalue = value.substr(0, i) + r + value.substr(i+2);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\n\t\tfunction emit (type, data)\n\t\t{\n\t\t\tif (type == 'template')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, sym_open, sym_close, true, 0);\n\t\t\t}\n\t\t\telse if (type == 'parse')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, sym_open, sym_close, false, 0);\n\t\t\t\ttype = 'base-string';\n\n\t\t\t\tif (Rinn.typeOf(data) == 'array')\n\t\t\t\t{\n\t\t\t\t\ttype = data[0].type;\n\t\t\t\t\tdata = data[0].data;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (type == 'parse-trim-merge')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data.trim().split('\\n').map(i => i.trim()).join(\"\\n\"), sym_open, sym_close, false, 0);\n\t\t\t}\n\t\t\telse if (type == 'parse-merge')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, sym_open, sym_close, false, 0);\n\t\t\t}\n\t\t\telse if (type == 'parse-merge-alt')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, '{', '}', false, 0);\n\t\t\t}\n\n\t\t\tif (type == 'parse-merge' || type == 'parse-merge-alt' || type == 'parse-trim-merge')\n\t\t\t{\n\t\t\t\tfor (let i = 0; i < data.length; i++)\n\t\t\t\t{\n\t\t\t\t\tparts.push(data[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t\tparts.push({ type: type, data: data });\n\n\t\t\tif (nparts)\n\t\t\t{\n\t\t\t\tmparts.push(parts = []);\n\t\t\t\tnparts = false;\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = 0; i < template.length; i++)\n\t\t{\n\t\t\tif (template[i] == '\\\\')\n\t\t\t{\n\t\t\t\tstr += '\\\\';\n\t\t\t\tstr += template[++i];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (state)\n\t\t\t{\n\t\t\t\tcase 0:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '<')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 1; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'parse-merge';\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '@')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 1; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'parse-trim-merge';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == ':')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 12; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'string';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 1; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'template';\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tstr += template[i];\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\n\t\t\t\tcase 1:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 0;\n\t\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 10:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '.')\n\t\t\t\t\t{\n\t\t\t\t\t\temit (nflush, str);\n\t\t\t\t\t\temit ('access', '.');\n\n\t\t\t\t\t\tnflush = 'identifier';\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i].match(/[\\t\\n\\r\\f\\v ]/) != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\tnflush = 'identifier';\n\t\t\t\t\t\tnparts = true;\n\n\t\t\t\t\t\twhile (template[i].match(/[\\t\\n\\r\\f\\v ]/) != null) i++;\n\t\t\t\t\t\ti--;\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '<')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 11; count = 1; nflush = 'parse-merge';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '@')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 11; count = 1; nflush = 'parse-trim-merge';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '\"')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 14; count = 1; nflush = 'parse-merge';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '\\'')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 15; count = 1; nflush = 'parse-merge';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '`')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 16; count = 1; nflush = 'parse-merge-alt';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == ':')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 13; count = 1; nflush = 'string';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) emit (nflush, str);\n\t\t\t\t\t\tstate = 11; count = 1; str = ''; nflush = 'parse';\n\t\t\t\t\t\tstr += template[i];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (nflush != 'identifier')\n\t\t\t\t\t{\n\t\t\t\t\t\temit (nflush, str);\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tnflush = 'identifier';\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\t\n\t\t\t\tcase 11:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 12:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (str.length != 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (!(str[0] == '<' || str[0] == '[' || str[0] == ' '))\n\t\t\t\t\t\t\t\t\tstr = sym_open + str + sym_close;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tstate = 0;\n\t\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 13:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!(str[0] == '<' || str[0] == '[' || str[0] == ' '))\n\t\t\t\t\t\t\t\tstr = sym_open + str + sym_close;\n\n\t\t\t\t\t\t\tstate = 10;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 14:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == '\"')\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + '\"');\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 15:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == '\\'')\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + '\\'');\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 16:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == '`')\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + '`');\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (flush)\n\t\t\t{\n\t\t\t\temit (flush, str);\n\t\t\t\tflush = str = '';\n\t\t\t}\n\t\t}\n\n\t\tif (!is_tpl)\n\t\t{\n\t\t\tlet i = 0;\n\t\t\twhile (i < mparts.length)\n\t\t\t{\n\t\t\t\tif (mparts[i].type == 'string' && mparts[i].data == '')\n\t\t\t\t\tmparts.splice(i, 1);\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\ti = mparts.length-1;\n\t\t\twhile (i > 0)\n\t\t\t{\n\t\t\t\tif (mparts[i].type == 'string' && mparts[i].data == '')\n\t\t\t\t\tmparts.splice(i--, 1);\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (mparts.length == 0)\n\t\t\t\tmparts.push({ type: 'string', data: '' });\n\t\t}\n\n\t\tif (root)\n\t\t\tunescape(mparts);\n\n\t\treturn mparts;\n\t},\n\n\t/**\n\t**\tParses a template and returns the compiled 'parts' structure to be used by the 'expand' method. This\n\t**\tversion assumes the sym_open and sym_close chars are [ and ] respectively.\n\t**\n\t**\t>> array parse (string template);\n\t*/\n\tparse: function (template)\n\t{\n\t\treturn this.parseTemplate(template.trim(), '[', ']', false);\n\t},\n\n\t/**\n\t**\tRemoves all static parts from a parsed template.\n\t**\n\t**\t>> array clean (array parts);\n\t*/\n\tclean: function (parts)\n\t{\n\t\tfor (let i = 0; i < parts.length; i++)\n\t\t{\n\t\t\tif (parts[i].type != 'template')\n\t\t\t{\n\t\t\t\tparts.splice(i, 1);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\n\t\treturn parts;\n\t},\n\n\t/**\n\t**\tExpands a template using the given data object, ret can be set to 'text' or 'obj' allowing to expand the template as\n\t**\ta string (text) or an array of objects (obj) respectively. If none provided it will be expanded as text.\n\t**\n\t**\t>> string/array expand (array parts, object data, string ret='text', string mode='base-string');\n\t*/\n\texpand: function (parts, data, ret='text', mode='base-string')\n\t{\n\t\tlet s = [];\n\n\t\t// Expand variable parts.\n\t\tif (mode == 'var')\n\t\t{\n\t\t\tlet escape = true;\n\t\t\tlet quote = false;\n\n\t\t\tlet root = data;\n\t\t\tlet last = null;\n\t\t\tlet first = true;\n\t\t\tlet str = '';\n\n\t\t\tfor (let i = 0; i < parts.length && data != null; i++)\n\t\t\t{\n\t\t\t\tswitch (parts[i].type)\n\t\t\t\t{\n\t\t\t\t\tcase 'identifier':\n\t\t\t\t\tcase 'string':\n\t\t\t\t\t\tstr += parts[i].data;\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'template':\n\t\t\t\t\t\tlast = this.expand(parts[i].data, root, 'arg', 'template');\n\t\t\t\t\t\tstr += typeof(last) != 'object' ? last : '';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'base-string':\n\t\t\t\t\t\tstr += this.expand(parts[i].data, root, 'arg', 'base-string');\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'access':\n\t\t\t\t\t\tif (!last || typeof(last) != 'object')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (str == '') str = 'this';\n\n\t\t\t\t\t\t\twhile (true)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (str[0] == '!')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t\tescape = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if (str[0] == '$')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t\tquote = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (str != 'this' && data != null)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet tmp = data;\n\t\t\t\t\t\t\t\tdata = (str in data) ? data[str] : null;\n\n\t\t\t\t\t\t\t\tif (data === null && first)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (str in Template.functions)\n\t\t\t\t\t\t\t\t\t\tdata = Template.functions[str] (null, null, tmp);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfirst = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdata = last;\n\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile (str != '')\n\t\t\t{\n\t\t\t\tif (str[0] == '!')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\tescape = false;\n\t\t\t\t}\n\t\t\t\telse if (str[0] == '$')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\tquote = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (str != 'this')\n\t\t\t{\n\t\t\t\tlet failed = false;\n\n\t\t\t\tif (data != null)\n\t\t\t\t{\n\t\t\t\t\tif (!(str in data))\n\t\t\t\t\t{\n\t\t\t\t\t\tfailed = true;\n\t\t\t\t\t\tdata = null;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tdata = data[str];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tfailed = true;\n\n\t\t\t\tif (failed && parts.length == 1)\n\t\t\t\t{\n\t\t\t\t\tif (Template.strict == true)\n\t\t\t\t\t\tthrow new Error ('Expression function `'+str+'` not found.');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (typeof(data) == 'string')\n\t\t\t{\n\t\t\t\tif (escape)\n\t\t\t\t\tdata = data.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n\n\t\t\t\tif (quote)\n\t\t\t\t\tdata = '\"' + data + '\"';\n\t\t\t}\n\n\t\t\ts.push(data);\n\t\t}\n\n\t\t// Expand variable parts and returns a reference to it.\n\t\tif (ret == 'varref')\n\t\t{\n\t\t\tlet root = data;\n\t\t\tlet last = null;\n\t\t\tlet first = true;\n\t\t\tlet str = '';\n\n\t\t\tfor (let i = 0; i < parts.length && data != null; i++)\n\t\t\t{\n\t\t\t\tswitch (parts[i].type)\n\t\t\t\t{\n\t\t\t\t\tcase 'identifier':\n\t\t\t\t\tcase 'string':\n\t\t\t\t\t\tstr += parts[i].data;\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'template':\n\t\t\t\t\t\tlast = this.expand(parts[i].data, root, 'arg', 'template');\n\t\t\t\t\t\tstr += typeof(last) != 'object' ? last : '';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'base-string':\n\t\t\t\t\t\tstr += this.expand(parts[i].data, root, 'arg', 'base-string');\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'access':\n\t\t\t\t\t\tif (!last || typeof(last) != 'object')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (str == '') str = 'this';\n\n\t\t\t\t\t\t\twhile (true)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (str[0] == '!')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if (str[0] == '$')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (str != 'this' && data != null)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet tmp = data;\n\t\t\t\t\t\t\t\tdata = (str in data) ? data[str] : null;\n\n\t\t\t\t\t\t\t\tif (data === null && first)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (str in Template.functions)\n\t\t\t\t\t\t\t\t\t\tdata = Template.functions[str] (null, null, tmp);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfirst = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdata = last;\n\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile (str != '')\n\t\t\t{\n\t\t\t\tif (str[0] == '!')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t}\n\t\t\t\telse if (str[0] == '$')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn str != 'this' ? [data, str] : null;\n\t\t}\n\n\t\t// Expand function parts.\n\t\tif (mode == 'fn')\n\t\t{\n\t\t\tvar args = [];\n\n\t\t\targs.push(Template.expand(parts[0], data, 'text', 'base-string'));\n\n\t\t\tif ('_'+args[0] in Template.functions)\n\t\t\t\targs[0] = '_'+args[0];\n\n\t\t\tif (!(args[0] in Template.functions))\n\t\t\t{\n\t\t\t\tif (Template.strict == true)\n\t\t\t\t\tthrow new Error ('Expression function `'+args[0]+'` not found.');\n\n\t\t\t\treturn `(Unknown: ${args[0]})`;\n\t\t\t}\n\n\t\t\tif (args[0][0] == '_')\n\t\t\t\treturn Template.functions[args[0]] (parts, data);\n\n\t\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\t\targs.push(Template.expand(parts[i], data, 'arg', 'base-string'));\n\n\t\t\ts.push(Template.functions[args[0]] (args, parts, data));\n\t\t}\n\n\t\t// Template mode.\n\t\tif (mode == 'template')\n\t\t{\n\t\t\tif (parts.length == 1)\n\t\t\t{\n\t\t\t\tif (parts[0].length == 1 && parts[0][0].type == 'string')\n\t\t\t\t\treturn parts[0][0].data;\n\n\t\t\t\tif (parts[0].length == 1 && parts[0][0].type == 'identifier')\n\t\t\t\t{\n\t\t\t\t\tlet name = parts[0][0].data;\n\n\t\t\t\t\tif (name in Template.functions || '_'+name in Template.functions)\n\t\t\t\t\t\treturn Template.expand(parts, data, ret, 'fn');\n\t\t\t\t}\n\t\n\t\t\t\treturn Template.expand(parts[0], data, ret, 'var');\n\t\t\t}\n\n\t\t\treturn Template.expand(parts, data, ret, 'fn');\n\t\t}\n\n\t\t// Expand parts.\n\t\tif (mode == 'base-string')\n\t\t{\n\t\t\tlet index = -1;\n\n\t\t\tfor (let i of parts)\n\t\t\t{\n\t\t\t\tlet tmp = null;\n\t\t\t\tindex++;\n\n\t\t\t\tswitch (i.type)\n\t\t\t\t{\n\t\t\t\t\tcase 'template':\n\t\t\t\t\t\ttmp = Template.expand(i.data, data, ret, 'template');\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'string': case 'identifier':\n\t\t\t\t\t\ttmp = i.data;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'base-string':\n\t\t\t\t\t\ttmp = Template.expand(i.data, data, ret, 'base-string');\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (ret == 'void')\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (ret == 'last' && index != parts.length-1)\n\t\t\t\t\tcontinue;\n\n\t\t\t\ts.push(tmp);\n\t\t\t}\n\t\t}\n\n\t\t// Return types for direct objects.\n\t\tif (ret == 'obj') return s;\n\n\t\tif (ret == 'last')\n\t\t{\n\t\t\tif (typeOf(s) == 'Rose\\\\Arry')\n\t\t\t\ts = s[0];\n\n\t\t\treturn s;\n\t\t}\n\n\t\t// When the output is not really needed.\n\t\tif (ret == 'void') return null;\n\n\t\t// Return as argument ('object' if only one, or string if more than one), that is, the first item in the result.\n\t\tif (ret == 'arg')\n\t\t{\n\t\t\tif (Rinn.typeOf(s) == 'array')\n\t\t\t{\n\t\t\t\tif (s.length != 1)\n\t\t\t\t\treturn s.join('');\n\n\t\t\t\treturn s[0];\n\t\t\t}\n\n\t\t\treturn s;\n\t\t}\n\n\t\tif (ret == 'text' && Rinn.typeOf(s) == 'array')\n\t\t{\n\t\t\tlet f = (e => e != null && typeof(e) == 'object' ? ('map' in e ? e.map(f).join('') : ('join' in e ? e.join('') : e.toString())) : e);\n\t\t\ts = s.map(f).join('');\n\t\t}\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tParses the given template and returns a function that when called with an object will expand the template.\n\t**\n\t**\t>> object compile (string template);\n\t*/\n\tcompile: function (template)\n\t{\n\t\ttemplate = Template.parse(template);\n\n\t\treturn function (data=null, mode='text') {\n\t\t\treturn Template.expand(template, data ? data : { }, mode);\n\t\t};\n\t},\n\n\t/**\n\t**\tParses and expands the given template immediately.\n\t**\n\t**\t>> object eval (string template, object data, string mode='text');\n\t*/\n\teval: function (template, data=null, mode='text')\n\t{\n\t\ttemplate = Template.parse(template);\n\t\treturn Template.expand(template, data ? data : { }, mode);\n\t},\n\n\t/**\n\t**\tExpands the template as 'arg' and returns the result.\n\t**\n\t**\t>> object value (string parts, object data);\n\t*/\n\tvalue: function (parts, data=null)\n\t{\n\t\treturn Rinn.typeOf(parts) != 'array' ? parts : Template.expand(parts, data ? data : { }, 'arg');\n\t},\n\n\t/**\n\t**\tRegisters an expression function.\n\t**\n\t**\t>> object register (string name, function fn);\n\t*/\n\tregister: function (name, fn)\n\t{\n\t\tTemplate.functions[name] = fn;\n\t},\n\n\t/**\n\t**\tCalls an expression function.\n\t**\n\t**\t>> object call (string name, object args, object data);\n\t*/\n\t'call': function (name, args, data=null)\n\t{\n\t\tif (name in Template.functions)\n\t\t\treturn Template.functions[name] (args, null, data);\n\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tReturns a map given a 'parts' array having values of the form \"name: value\" or \":name value\".\n\t**\n\t**\t>> Map getNamedValues (array parts, object data, int i=1, bool expanded=true);\n\t*/\n\tgetNamedValues: function (parts, data, i=1, expanded=true)\n\t{\n\t\tlet s = { };\n\t\tlet mode = 0;\n\t\n\t\tfor (; i < parts.length; i += 2)\n\t\t{\n\t\t\tlet key = Template.expand(parts[i], data, 'arg');\n\n\t\t\tif (!mode) {\n\t\t\t\tif (key.startsWith(':')) mode = 1; else mode = key.endsWith(':') ? 2 : 3;\n\t\t\t}\n\n\t\t\tif (mode == 1)\n\t\t\t\tkey = key.substr(1);\n\t\t\telse if (mode == 2)\n\t\t\t\tkey = key.substr(0, key.length-1);\n\n\t\t\tif (expanded)\n\t\t\t\ts[key] = Template.expand(parts[i+1], data, 'arg');\n\t\t\telse\n\t\t\t\ts[key] = parts[i+1];\n\t\t}\n\n\t\treturn s;\n\t}\n};\n\n\n/**\n**\tTemplate functions, functions that are used to format data. Each function takes three parameters (args, parts and data). By default the function arguments\n**\tare expanded and passed via 'args' for convenience, however if the function name starts with '_' the 'args' parameter will be skipped and only (parts, data)\n**\twill be available, each 'part' must be expanded manually by calling Template.expand.\n*/\n\nTemplate.functions =\n{\n\t/**\n\t**\tExpression functions.\n\t*/\n\t'global': function(args) { return globalThis; },\n\t'null': function(args) { return null; },\n\t'true': function(args) { return true; },\n\t'false': function(args) { return false; },\n\n\t'len': function(args) { return args[1].toString().length; },\n\t'int': function(args) { return ~~args[1]; },\n\t'str': function(args) { return args[1].toString(); },\n\t'float': function(args) { return parseFloat(args[1]); },\n\t'chr': function(args) { return String.fromCharCode(args[1]); },\n\t'ord': function(args) { return args[1].toString().charCodeAt(0); },\n\n\t'not': function(args) { return !args[1]; },\n\t'neg': function(args) { return -args[1]; },\n\t'abs': function(args) { return Math.abs(args[1]); },\n\n\t'and': function(args) { for (let i = 1; i < args.length; i++) if (!args[i]) return false; return true; },\n\t'or': function(args) { for (let i = 1; i < args.length; i++) if (~~args[i]) return true; return false; },\n\n\t'eq': function(args) { return args[1] == args[2]; },\n\t'ne': function(args) { return args[1] != args[2]; },\n\t'lt': function(args) { return args[1] < args[2]; },\n\t'le': function(args) { return args[1] <= args[2]; },\n\t'gt': function(args) { return args[1] > args[2]; },\n\t'ge': function(args) { return args[1] >= args[2]; },\n\t'isnotnull': function(args) { return !!args[1]; },\n\t'isnull': function(args) { return !args[1]; },\n\t'iszero': function(args) { return parseInt(args[1]) == 0; },\n\n\t'eq?': function(args) { return args[1] == args[2]; },\n\t'ne?': function(args) { return args[1] != args[2]; },\n\t'lt?': function(args) { return args[1] < args[2]; },\n\t'le?': function(args) { return args[1] <= args[2]; },\n\t'gt?': function(args) { return args[1] > args[2]; },\n\t'ge?': function(args) { return args[1] >= args[2]; },\n\t'notnull?': function(args) { return !!args[1]; },\n\t'null?': function(args) { return !args[1]; },\n\t'zero?': function(args) { return parseInt(args[1]) == 0; },\n\n\t'typeof': function(args) { return Rinn.typeOf(args[1]); },\n\n\t'*': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x *= args[i]; return x; },\n\t'/': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x /= args[i]; return x; },\n\t'+': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= -args[i]; return x; },\n\t'-': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= args[i]; return x; },\n\t'mul': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x *= args[i]; return x; },\n\t'div': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x /= args[i]; return x; },\n\t'sum': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= -args[i]; return x; },\n\t'sub': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= args[i]; return x; },\n\t'mod': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x %= args[i]; return x; },\n\t'pow': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x = Math.pow(x, args[i]); return x; },\n\n\t/**\n\t**\tReturns the JSON representation of the expression.\n\t**\n\t**\tdump <expr>\n\t*/\n\t'dump': function (args)\n\t{\n\t\treturn JSON.stringify(args[1]);\n\t},\n\n\t/**\n\t**\tSets one or more variables in the data context.\n\t**\n\t**\tset <var-name> <expr> [<var-name> <expr>]*\n\t*/\n\t'_set': function (parts, data)\n\t{\n\t\tfor (let i = 1; i+1 < parts.length; i += 2)\n\t\t{\n\t\t\tlet value = Template.value(parts[i+1], data);\n\n\t\t\tif (parts[i].length > 1)\n\t\t\t{\n\t\t\t\tlet ref = Template.expand(parts[i], data, 'varref');\n\t\t\t\tif (ref != null) ref[0][ref[1]] = value;\n\t\t\t}\n\t\t\telse\n\t\t\t\tdata[Template.value(parts[i], data)] = value;\n\t\t}\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tRemoves one or more variables from the data context.\n\t**\n\t**\tunset <var-name> [<var-name>]*\n\t*/\n\t'_unset': function (parts, data)\n\t{\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t{\n\t\t\tif (parts[i].length > 1)\n\t\t\t{\n\t\t\t\tlet ref = Template.expand(parts[i], data, 'varref');\n\t\t\t\tif (ref != null) delete ref[0][ref[1]];\n\t\t\t}\n\t\t\telse\n\t\t\t\tdelete data[Template.value(parts[i], data)];\n\t\t}\n\n\t\treturn null;\n\t},\n\n\n\t/**\n\t**\tReturns the expression without white-space on the left or right. The expression can be a string or an array.\n\t**\n\t**\ttrim <expr>\n\t*/\n\t'trim': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.trim()) : args[1].trim()) : '';\n\t},\n\n\t/**\n\t**\tReturns the expression in uppercase. The expression can be a string or an array.\n\t**\n\t**\tupper <expr>\n\t*/\n\t'upper': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.toUpperCase()) : args[1].toUpperCase()) : '';\n\t},\n\n\t/**\n\t**\tReturns the expression in lower. The expression can be a string or an array.\n\t**\n\t**\tlower <expr>\n\t*/\n\t'lower': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.toLowerCase()) : args[1].toLowerCase()) : '';\n\t},\n\n\t/**\n\t**\tReturns a sub-string of the given string.\n\t**\n\t**\tsubstr <start> <count> <string>\n\t**\tsubstr <start> <string>\n\t*/\n\t'substr': function (args)\n\t{\n\t\tlet s = args[args.length-1].toString();\n\n\t\tlet start = 0;\n\t\tlet count = null;\n\n\t\tif (args.length == 4)\n\t\t{\n\t\t\tstart = ~~(args[1]);\n\t\t\tcount = ~~(args[2]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstart = ~~(args[1]);\n\t\t\tcount = null;\n\t\t}\n\n\t\tif (start < 0) start += s.length;\n\t\tif (count < 0) count += s.length;\n\n\t\tif (count === null)\n\t\t\tcount = s.length - start;\n\n\t\treturn s.substr(start, count);\n\t},\n\n\t/**\n\t**\tReplaces a matching string with the given replacement string in a given text.\n\t**\n\t**\treplace <search> <replacement> <text>\n\t*/\n\t'replace': function (args)\n\t{\n\t\treturn args[3].split(args[1]).join(args[2]);\n\t},\n\n\t/**\n\t**\tConverts all new-line chars in the expression to <br/>, the expression can be a string or an array.\n\t**\n\t**\tnl2br <expr>\n\t*/\n\t'nl2br': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.replace(/\\n/g, \"<br/>\")) : args[1].replace(/\\n/g, \"<br/>\")) : '';\n\t},\n\n\t/**\n\t**\tReturns the expression inside an XML tag named 'tag-name', the expression can be a string or an array.\n\t**\n\t**\t% <tag-name> <expr>\n\t*/\n\t'%': function (args)\n\t{\n\t\targs.shift();\n\t\tvar name = args.shift();\n\n\t\tlet s = '';\n\n\t\tfor (let i = 0; i < args.length; i++)\n\t\t{\n\t\t\tif (Rinn.typeOf(args[i]) == 'array')\n\t\t\t{\n\t\t\t\ts += `<${name}>`;\n\t\t\t\t\n\t\t\t\tfor (let j = 0; j < args[i].length; j++)\n\t\t\t\t\ts += args[i][j];\n\n\t\t\t\ts += `</${name}>`;\n\t\t\t}\n\t\t\telse\n\t\t\t\ts += `<${name}>${args[i]}</${name}>`;\n\t\t}\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tReturns the expression inside an XML tag named 'tag-name', attributes are supported.\n\t**\n\t**\t%% <tag-name> [<attr> <value>]* [<content>]\n\t*/\n\t'%%': function (args)\n\t{\n\t\targs.shift();\n\t\tvar name = args.shift();\n\n\t\tlet attr = '';\n\t\tlet text = '';\n\n\t\tfor (let i = 0; i < args.length; i += 2)\n\t\t{\n\t\t\tif (i+1 < args.length)\n\t\t\t\tattr += ` ${args[i]}=\"${args[i+1]}\"`;\n\t\t\telse\n\t\t\t\ttext = args[i];\n\t\t}\n\n\t\treturn text ? `<${name}${attr}>${text}</${name}>` : `<${name}${attr}/>`;\n\t},\n\n\t/**\n\t**\tJoins the given array expression into a string. The provided string-expr will be used as separator.\n\t**\n\t**\tjoin <string-expr> <array-expr>\n\t*/\n\t'join': function (args)\n\t{\n\t\tif (args[2] && Rinn.typeOf(args[2]) == 'array')\n\t\t\treturn args[2].join(args[1]);\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tSplits the given expression by the specified string. Returns an array.\n\t**\n\t**\tsplit <string-expr> <expr>\n\t*/\n\t'split': function (args)\n\t{\n\t\tif (args[2] && typeof(args[2]) == \"string\")\n\t\t\treturn args[2].split(args[1]);\n\n\t\treturn [];\n\t},\n\n\t/**\n\t**\tReturns an array with the keys of the given object-expr.\n\t**\n\t**\tkeys <object-expr>\n\t*/\n\t'keys': function (args)\n\t{\n\t\tif (args[1] && typeof(args[1]) == \"object\")\n\t\t\treturn Object.keys(args[1]);\n\n\t\treturn [];\n\t},\n\n\t/**\n\t**\tReturns an array with the values of the given object-expr.\n\t**\n\t**\tvalues <object-expr>\n\t*/\n\t'values': function (args)\n\t{\n\t\tif (args[1] && typeof(args[1]) == \"object\")\n\t\t\treturn Object.values(args[1]);\n\n\t\treturn [];\n\t},\n\n\t/**\n\t**\tConstructs a string obtained by concatenating the expanded template for each of the items in the list-expr, the mandatory varname\n\t**\tparameter (namely 'i') indicates the name of the variable that will contain the data of each item as the list-expr is\n\t**\ttraversed. Extra variables i# and i## (suffix '#' and '##') are introduced to denote the index/key and numeric index\n\t**\tof the current item respectively, note that the later will always have a numeric value.\n\t**\n\t**\teach <varname> <list-expr> <template>\n\t*/\n\t'_each': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\n\t\tlet s = '';\n\t\tlet j = 0;\n\n\t\tif (!list) return s;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\ts += Template.expand(parts[3], data, 'text');\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tExpands the given template for each of the items in the list-expr, the mandatory varname parameter (namely 'i') indicates the name of the variable\n\t**\tthat will contain the data of each item as the list-expr is traversed. Extra variables i# and i## (suffix '#' and '##') are introduced to denote\n\t**\tthe index/key and numeric index of the current item respectively, note that the later will always have a numeric value.\n\t**\n\t**\tDoes not produce any output (returns null).\n\t**\n\t**\tforeach <varname> <list-expr> <template>\n\t*/\n\t'_foreach': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\n\t\tlet j = 0;\n\n\t\tif (!list) return null;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\tTemplate.expand(parts[3], data, 'text');\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tReturns the valueA if the expression is true otherwise valueB, this is a short version of the 'if' function with the\n\t**\tdifference that the result is 'obj' instead of text.\n\t**\n\t**\t? <expr> <valueA> [<valueB>]\n\t*/\n\t'_?': function (parts, data)\n\t{\n\t\tif (Template.expand(parts[1], data, 'arg'))\n\t\t\treturn Template.expand(parts[2], data, 'arg');\n\n\t\tif (parts.length > 3)\n\t\t\treturn Template.expand(parts[3], data, 'arg');\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tReturns the valueA if it is not null (or empty or zero), otherwise returns valueB.\n\t**\n\t**\t?? <valueA> <valueB>\n\t*/\n\t'_??': function (parts, data)\n\t{\n\t\tlet value = Template.expand(parts[1], data, 'arg');\n\t\tif (value) return value;\n\t\n\t\treturn Template.expand(parts[2], data, 'arg');\n\t},\n\n\t/**\n\t**\tReturns the value if the expression is true, supports 'elif' and 'else' as well. The result of this function is always text.\n\t**\n\t**\tif <expr> <value> [elif <expr> <value>] [else <value>]\n\t*/\n\t'_if': function (parts, data)\n\t{\n\t\tfor (let i = 0; i < parts.length; i += 3)\n\t\t{\n\t\t\tif (Template.expand(parts[i], data, 'arg') == 'else')\n\t\t\t\treturn Template.expand(parts[i+1], data, 'text');\n\n\t\t\tif (Template.expand(parts[i+1], data, 'arg'))\n\t\t\t\treturn Template.expand(parts[i+2], data, 'text');\n\t\t}\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tLoads the expression value and attempts to match one case.\n\t**\n\t**\tswitch <expr> <case1> <value1> ... <caseN> <valueN> default <defvalue> \n\t*/\n\t'_switch': function (parts, data)\n\t{\n\t\tlet value = Template.expand(parts[1], data, 'arg');\n\n\t\tfor (let i = 2; i < parts.length; i += 2)\n\t\t{\n\t\t\tlet case_value = Template.expand(parts[i], data, 'arg');\n\t\t\tif (case_value == value || case_value == 'default')\n\t\t\t\treturn Template.expand(parts[i+1], data, 'text');\n\t\t}\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tExits the current inner most loop.\n\t**\n\t**\tbreak\n\t*/\n\t'_break': function (parts, data)\n\t{\n\t\tthrow new Error('EXC_BREAK');\n\t},\n\n\t/**\n\t**\tSkips execution and continues the next cycle of the current inner most loop.\n\t**\n\t**\tcontinue\n\t*/\n\t'_continue': function (parts, data)\n\t{\n\t\tthrow new Error('EXC_CONTINUE');\n\t},\n\n\t/**\n\t**\tConstructs an array with the results of repeating the specified template for a number of times.\n\t**\n\t**\trepeat <varname:i> [from <number>] [to <number>] [count <number>] [step <number>] <template>\n\t*/\n\t'_repeat': function (parts, data)\n\t{\n\t\tif (parts.length < 3 || (parts.length & 1) != 1)\n\t\t\treturn '(`repeat`: Wrong number of parameters)';\n\n\t\tlet var_name = Template.value(parts[1], data);\n\t\tlet count = null;\n\t\tlet from = 0, to = null;\n\t\tlet step = null;\n\n\t\tfor (let i = 2; i < parts.length-1; i+=2)\n\t\t{\n\t\t\tlet value = Template.value(parts[i], data);\n\n\t\t\tswitch (value.toLowerCase())\n\t\t\t{\n\t\t\t\tcase 'from':\n\t\t\t\t\tfrom = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'to':\n\t\t\t\t\tto = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'count':\n\t\t\t\t\tcount = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'step':\n\t\t\t\t\tstep = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tlet tpl = parts[parts.length-1];\n\t\tlet arr = [];\n\n\t\tif (to !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = from > to ? -1 : 1;\n\n\t\t\tif (step < 0)\n\t\t\t{\n\t\t\t\tfor (let i = from; i >= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfor (let i = from; i <= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (count !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\n\t\t\tfor (let i = from; count > 0; count--, i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t} catch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\t\n\t\t\tfor (let i = from; ; i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdelete data[var_name];\n\t\treturn arr;\n\t},\n\n\t/**\n\t**\tRepeats the specified template for a number of times.\n\t**\n\t**\tfor <varname:i> [from <number>] [to <number>] [count <number>] [step <number>] <template>\n\t*/\n\t'_for': function (parts, data)\n\t{\n\t\tif (parts.length < 3 || (parts.length & 1) != 1)\n\t\t\treturn '(`for`: Wrong number of parameters)';\n\n\t\tlet var_name = Template.value(parts[1], data);\n\t\tlet count = null;\n\t\tlet from = 0; to = null;\n\t\tlet step = null;\n\n\t\tfor (let i = 2; i < parts.length-1; i+=2)\n\t\t{\n\t\t\tvalue = Template.value(parts[i], data);\n\n\t\t\tswitch (value.toLowerCase())\n\t\t\t{\n\t\t\t\tcase 'from':\n\t\t\t\t\tfrom = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'to':\n\t\t\t\t\tto = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'count':\n\t\t\t\t\tcount = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'step':\n\t\t\t\t\tstep = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tlet tpl = parts[parts.length-1];\n\n\t\tif (to !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = from > to ? -1 : 1;\n\n\t\t\tif (step < 0)\n\t\t\t{\n\t\t\t\tfor (let i = from; i >= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfor (let i = from; i <= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (count !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\n\t\t\tfor (let i = from; count > 0; count--, i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\t\n\t\t\tfor (let i = from; ; i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdelete data[var_name];\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tRepeats the specified template infinitely until a \"break\" is found.\n\t**\n\t**\tloop <template>\n\t*/\n\t'_loop': function (parts, data)\n\t{\n\t\tif (parts.length < 2)\n\t\t\treturn '(`loop`: Wrong number of parameters)';\n\n\t\tlet tpl = parts[1];\n\n\t\twhile (true)\n\t\t{\n\t\t\ttry {\n\t\t\t\tTemplate.value(tpl, data);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tlet name = e.message;\n\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tWrites the specified arguments to the console.\n\t**\n\t**\techo <expr> [<expr>...]\n\t*/\n\t'_echo': function (parts, data)\n\t{\n\t\tlet s = '';\n\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\ts += Template.expand(parts[i], data, 'arg');\n\n\t\tconsole.log(s);\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tConstructs a list from the given arguments and returns it.\n\t**\n\t**\t# <expr> [<expr>...]\n\t*/\n\t'_#': function (parts, data)\n\t{\n\t\tlet s = [];\n\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\ts.push(Template.expand(parts[i], data, 'arg'));\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tConstructs a non-expanded list from the given arguments and returns it.\n\t**\n\t**\t## <expr> [<expr>...]\n\t*/\n\t'_##': function (parts, data)\n\t{\n\t\tlet s = [];\n\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\ts.push(parts[i]);\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tConstructs an associative array (dictionary) and returns it.\n\t**\n\t**\t& <name>: <expr> [<name>: <expr>...]\n\t**\t& :<name> <expr> [:<name> <expr>...]\n\t*/\n\t'_&': function (parts, data)\n\t{\n\t\treturn Template.getNamedValues (parts, data, 1, true);\n\t},\n\n\t/**\n\t**\tConstructs a non-expanded associative array (dictionary) and returns it.\n\t**\n\t**\t&& <name>: <expr> [<name>: <expr>...]\n\t**\t&& :<name> <expr> [:<name> <expr>...]\n\t*/\n\t'_&&': function (parts, data)\n\t{\n\t\treturn Template.getNamedValues (parts, data, 1, false);\n\t},\n\n\t/**\n\t**\tReturns true if the specified map contains all the specified keys. If it fails the global variable `err` will contain an error message.\n\t**\n\t**\tcontains <expr> <name> [<name>...]\n\t*/\n\t'contains': function (args, parts, data)\n\t{\n\t\tlet value = args[1];\n\n\t\tif (typeof(value) != 'object')\n\t\t{\n\t\t\tdata.err = 'Argument is not a Map';\n\t\t\treturn false;\n\t\t}\n\n\t\tlet s = '';\n\n\t\tfor (let i = 2; i < args.length; i++)\n\t\t{\n\t\t\tif (!(args[i] in value))\n\t\t\t\ts += ', '+args[i];\n\t\t}\n\n\t\tif (s != '')\n\t\t{\n\t\t\tdata.err = s.substr(1);\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tReturns true if the specified map has the specified key. Returns boolean.\n\t**\n\t**\thas <name> <expr>\n\t*/\n\t'has': function (args, parts, data)\n\t{\n\t\tlet value = args[2];\n\n\t\tif (Rinn.typeOf(value) != 'object')\n\t\t\treturn false;\n\n\t\treturn args[1] in value;\n\t},\n\n\t/**\n\t**\tReturns a new array/map contaning the transformed values of the array/map (evaluating the template). And just as in 'each', the i# and i## variables be available.\n\t**\n\t**\tmap <varname> <list-expr> <template>\n\t*/\n\t'_map': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\t\tif (!list) return list;\n\n\t\tlet arrayMode = Rinn.typeOf(list) == 'array' ? true : false;\n\t\tlet output = arrayMode ? [] : {};\n\t\tlet j = 0;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\tif (arrayMode)\n\t\t\t\toutput.push(Template.expand(parts[3], data, 'arg'));\n\t\t\telse\n\t\t\t\toutput[i] = Template.expand(parts[3], data, 'arg');\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn output;\n\t},\n\n\t/**\n\t**\tReturns a new array/map contaning the elements where the template evaluates to non-zero. Just as in 'each', the i# and i## variables be available.\n\t**\n\t**\tfilter <varname> <list-expr> <template>\n\t*/\n\t'_filter': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\t\tif (!list) return list;\n\n\t\tlet arrayMode = Rinn.typeOf(list) == 'array' ? true : false;\n\t\tlet output = arrayMode ? [] : {};\n\t\tlet j = 0;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\tif (~~Template.expand(parts[3], data, 'arg'))\n\t\t\t{\n\t\t\t\tif (arrayMode)\n\t\t\t\t\toutput.push(list[i]);\n\t\t\t\telse\n\t\t\t\t\toutput[i] = list[i];\n\t\t\t}\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn output;\n\t},\n\n\t/**\n\t**\tExpands the specified template string with the given data. The sym_open and sym_close will be '{' and '}' respectively.\n\t**\tIf no data is provided, current data parameter will be used.\n\t**\n\t**\texpand <template> <data>\n\t*/\n\t'expand': function (args, parts, data)\n\t{\n\t\treturn Template.expand (Template.parseTemplate (args[1], '{', '}'), args.length == 3 ? args[2] : data);\n\t},\n\n\t/**\n\t**\tCalls a function described by the given parameter.\n\t**\n\t**\tcall <function> <args...>\n\t*/\n\t'_call': function (parts, data)\n\t{\n\t\tlet ref = Template.expand(parts[1], data, 'varref');\n\n\t\tif (!ref || typeof(ref[0][ref[1]]) != 'function')\n\t\t\tthrow new Error ('Expression is not a function: ' + Template.expand(parts[1], data, 'obj').map(i => i == null ? '.' : i).join(''));\n\n\t\tlet args = [];\n\n\t\tfor (let i = 2; i < parts.length; i++)\n\t\t\targs.push(Template.value(parts[i], data));\n\n\t\treturn ref[0][ref[1]] (...args);\n\t},\n};\n\nexport default Template;\n","/*\r\n**\trinn/main.js\r\n**\r\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nimport _Rinn from './alpha.js';\r\nimport _Class from './class.js';\r\nimport _Event from './event.js';\r\nimport _EventDispatcher from './event-dispatcher.js';\r\nimport _Model from './model.js';\r\nimport _ModelList from './model-list.js';\r\nimport _Schema from './schema.js';\r\nimport _Flattenable from './flattenable.js';\r\nimport _Collection from './collection.js';\r\nimport _Template from './template.js';\r\n\r\nexport const Rinn = _Rinn;\r\nexport const Class = _Class;\r\nexport const Event = _Event;\r\nexport const EventDispatcher = _EventDispatcher;\r\nexport const Model = _Model;\r\nexport const ModelList = _ModelList;\r\nexport const Schema = _Schema;\r\nexport const Flattenable = _Flattenable;\r\nexport const Collection = _Collection;\r\nexport const Template = _Template;\r\n","/*\n**\tfroxel\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n//!//@ts-check\n\n// *********************************************\n// rinn\n\nimport * as rinn from 'rinn';\nexport const Class = rinn.Class;\nexport const Schema = rinn.Schema;\nexport const Template = rinn.Template;\n\n// *********************************************\n// system\n\n//![import \"system/globals\"]\nimport _globals from './system/globals.js'; export const globals = _globals;\n\n//![import \"system/system\"]\nimport _System from './system/system.js'; export const System = _System;\n\n//![import \"system/timer\"]\nimport _Timer from './system/timer.js'; export const Timer = _Timer;\n\n//![import \"system/random\"]\nimport _Random from './system/random.js'; export const Random = _Random;\n\n//![import \"system/keycode\"]\nimport _KeyCode from './system/keycode.js'; export const KeyCode = _KeyCode;\n\n//![import \"system/canvas\"]\nimport _Canvas from './system/canvas.js'; export const Canvas = _Canvas;\n\n//![import \"system/perf\"]\nimport _Perf from './system/perf.js'; export const Perf = _Perf;\n\n//![import \"system/log\"]\nimport _Log from './system/log.js'; export const Log = _Log;\n\n//![import \"system/shader\"]\nimport _Shader from './system/shader.js'; export const Shader = _Shader;\n\n//![import \"system/shader-program\"]\nimport _ShaderProgram from './system/shader-program.js'; export const ShaderProgram = _ShaderProgram;\n\n//![import \"system/framebuffer\"]\nimport _Framebuffer from './system/framebuffer.js'; export const Framebuffer = _Framebuffer;\n\n\n// *********************************************\n// resources\n\n//![import \"resources/wrappers\"]\nimport * as _Wrappers from './resources/wrappers.js'; export const Wrappers = _Wrappers;\n\n//![import \"resources/resources\"]\nimport _Resources from './resources/resources.js'; export const Resources = _Resources;\nimport _Sound from './resources/sound.js'; export const Sound = _Sound;\n\n\n// *********************************************\n// utils\n\n//![import \"utils/recycler\"]\nimport _Recycler from './utils/recycler.js'; export const Recycler = _Recycler;\n\n//![import \"utils/linkable\"]\nimport _Linkable from './utils/linkable.js'; export const Linkable = _Linkable;\n\n//![import \"utils/list\"]\nimport _List from './utils/list.js'; export const List = _List;\n\n//![import \"utils/priority-queue\"]\nimport _PriorityQueue from './utils/priority-queue.js'; export const PriorityQueue = _PriorityQueue;\n\n//![import \"utils/handler\"]\nimport _Handler from './utils/handler.js'; export const Handler = _Handler;\n\n\n// *********************************************\n// math\n\n//![import \"math/matrix\"]\nimport _Matrix from './math/matrix.js'; export const Matrix = _Matrix;\n\n//![import \"math/rect\"]\nimport _Rect from './math/rect.js'; export const Rect = _Rect;\n\n//![import \"math/vec2\"]\nimport _Vec2 from './math/vec2.js'; export const Vec2 = _Vec2;\n\n//![import \"math/tfunction\"]\nimport _TFunction from './math/tfunction.js'; export const TFunction = _TFunction;\n\n//![import \"math/bounds2\"]\nimport _Bounds2 from './math/bounds2.js'; export const Bounds2 = _Bounds2;\n\n//![import \"math/point2\"]\nimport _Point2 from './math/point2.js'; export const Point2 = _Point2;\n\n\n// *********************************************\n// anim\n\n//![import \"anim/easing\"]\nimport _Easing from './anim/easing.js'; export const Easing = _Easing;\n\n//![import \"anim/anim\"]\nimport _Anim from './anim/anim.js'; export const Anim = _Anim;\n\n\n// *********************************************\n// flow\n\n//![import \"flow/boot\"]\nimport _Boot from './flow/boot.js'; export const Boot = _Boot;\n\n//![import \"flow/grid-element\"]\nimport _GridElement from './flow/grid-element.js'; export const GridElement = _GridElement;\n\n//![import \"flow/grid\"]\nimport _Grid from './flow/grid.js'; export const Grid = _Grid;\n\n//![import \"flow/scene\"]\nimport _Scene from './flow/scene.js'; export const Scene = _Scene;\n\n//![import \"flow/viewport\"]\nimport _Viewport from './flow/viewport.js'; export const Viewport = _Viewport;\n\n//![import \"flow/updater\"]\nimport _Updater from './flow/updater.js'; export const Updater = _Updater;\n\n//![import \"flow/container\"]\nimport _Container from './flow/container.js'; export const Container = _Container;\n\n//![import \"flow/simple-container\"]\nimport _SimpleContainer from './flow/simple-container.js'; export const SimpleContainer = _SimpleContainer;\n\n//![import \"flow/grid-container\"]\nimport _GridContainer from './flow/grid-container.js'; export const GridContainer = _GridContainer;\n\n//![import \"flow/group\"]\nimport _Group from './flow/group.js'; export const Group = _Group;\n\n//![import \"flow/drawable\"]\nimport _Drawable from './flow/drawable.js'; export const Drawable = _Drawable;\n\n//![import \"flow/element\"]\nimport _Element from './flow/element.js'; export const Element = _Element;\n\n//![import \"flow/mask\"]\nimport _Mask from './flow/mask.js'; export const Mask = _Mask;\n\n//![import \"flow/label\"]\nimport _Label from './flow/label.js'; export const Label = _Label;\n\n//![import \"flow/keyboard-handler\"]\nimport _KeyboardHandler from './flow/keyboard-handler.js'; export const KeyboardHandler = _KeyboardHandler;\n\n//![import \"flow/pointer-handler\"]\nimport _PointerHandler from './flow/pointer-handler.js'; export const PointerHandler = _PointerHandler;\n\n//![import \"flow/screen-controls\"]\nimport _ScreenControls from './flow/screen-controls.js'; export const ScreenControls = _ScreenControls;\n\n//![import \"flow/button\"]\nimport _Button from './flow/button.js'; export const Button = _Button;\n\n//![import \"flow/stick\"]\nimport _Stick from './flow/stick.js'; export const Stick = _Stick;\n\n\n// *********************************************\n// fxl\n\n//![import \"fxl/fxl\"]\nimport * as fxl from './fxl/fxl.js';\nexport default fxl;\n\n//!export default fxl;\n","/*\n**\tsystem/random.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\n\nconst XOR = (value, x) => (value ^ x) & 0x7FFFFFFF;\nconst SHR = (value, x) => (value >>> x)  & 0x7FFFFFFF;\nconst SHL = (value, x) => (value << x) & 0x7FFFFFFF;\n\n/**\n * Random number generator based on the WELL algorithm family.\n */\n\n//!class Random\n\nconst Random = Class.extend\n({\n\t/**\n\t * State of the generator.\n\t */\n\tstate: null,\n\n\t/**\n\t * Index of the next state value.\n\t */\n\tindex: 0,\n\n\t/**\n\t * \tSeed value of the generator. Remains constant throughout the life of the generator.\n\t * \t!readonly seed: number;\n\t */\n\tseed: 0,\n\n\t/**\n\t * \tInitializes the instance of the pseudo-random number generator.\n\t * \t@param seed - Value to seed the random number generator. If none provided, default one (0xDAE7A5D3) will be used.\n\t *\n\t *\t!constructor (seed?: number);\n\t */\n\t__ctor: function(seed=0xDAE7A5D3)\n\t{\n\t\tthis.state = [\n\t\t\t0xA5F7310C, 0xEF731CF3, 0xFA784322, 0x7834FC31,\n\t\t\t0xD9AF7813, 0xDE78AD13, 0x783F3418, 0xAA123176,\n\t\t\t0x871CF4D1, 0x73412FAB, 0xBAE6C710, 0x06F73481,\n\t\t\t0x8910CF15, 0x927CF813, 0xBCF7834F, 0x73F61193\n\t\t];\n\n\t\tthis.index = 0;\n\n\t\tthis.setSeed(seed);\n\t},\n\n\t/**\n\t * \tSets the seed of the pseudo-random number generator.\n\t * \t@param value - Seed value to use (32-bit unsigned integer).\n\t *\n\t *\t!setSeed (value: number) : Random;\n\t */\n\tsetSeed: function(value)\n\t{\n\t\tthis.seed = value;\n\n\t\tthis.state = [\n\t\t\t0xA5F7310C, 0xEF731CF3, 0xFA784322, 0x7834FC31,\n\t\t\t0xD9AF7813, 0xDE78AD13, 0x783F3418, 0xAA123176,\n\t\t\t0x871CF4D1, 0x73412FAB, 0xBAE6C710, 0x06F73481,\n\t\t\t0x8910CF15, 0x927CF813, 0xBCF7834F, 0x73F61193\n\t\t];\n\n\t\tfor (let i = 0; i < this.state.length; i++)\n\t\t\tthis.state[i] = XOR(this.state[i], this.seed);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tGenerates a 32-bit unsigned integer.\n\t *\t!nextInt32 () : number;\n\t */\n\tnextInt32: function ()\n\t{\n\t\tlet a, b, c, d;\n\n\t\ta = this.state[this.index];\n\t\tc = this.state[(this.index + 13) & 15];\n\t\tb = XOR(XOR(XOR(a, c), SHL(a, 16)), SHL(c, 15));\n\t\tc = this.state[(this.index + 9) & 15];\n\t\tc = XOR(c, SHR(c, 11));\n\t\ta = this.state[this.index] = XOR(b, c);\n\t\td = XOR(a, SHL(a, 5) & 0xDA442D24);\n\n\t\tthis.index = (this.index + 15) & 15;\n\t\ta = this.state[this.index];\n\n\t\tthis.state[this.index] = XOR(XOR(XOR(XOR(XOR(a, b), d), SHL(a, 2)), SHL(b, 18)), SHL(c, 28));\n\t\treturn this.state[this.index] & 0x7FFFFFFFF;\n\t},\n\n\t/**\n\t * \tGenerates a 16-bit unsigned integer.\n\t *\t!nextInt16 () : number;\n\t */\n\tnextInt16: function ()\n\t{\n\t\treturn this.nextInt32() & 0xFFFF;\n\t},\n\n\t/**\n\t * \tGenerates an 8-bit unsigned integer.\n\t * \t!nextInt8 () : number;\n\t */\n\tnextInt8: function ()\n\t{\n\t\treturn this.nextInt32() & 0xFF;\n\t},\n\n\t/**\n\t * \tGenerates a floating point number between 0 an 1 (inclusive).\n\t * \t!nextFloat () : number;\n\t */\n\tnextFloat: function ()\n\t{\n\t\treturn this.nextInt32() / 0x7FFFFFFF;\n\t}\n});\n\nexport default Random;\n","/*\n**\tsystem/keycode.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n//:/**\n//: * \tEnumeration of key codes supported by the system.\n//: */\n\n//!enum KeyCode\n\nexport default\n{\n\tBACKSPACE: 8,\n\t//!BACKSPACE\n\tTAB: 9,\n\t//!TAB\n\tENTER: 13,\n\t//!ENTER\n\tSHIFT: 16,\n\t//!SHIFT\n\tCTRL: 17,\n\t//!CTRL\n\tESC: 27,\n\t//!ESC\n\tSPACE: 32,\n\t//!SPACE\n\n\tPGUP: 33,\n\t//!PGUP\n\tPGDN: 34,\n\t//!PGDN\n\n\tEND: 35,\n\t//!END\n\tHOME: 36,\n\t//!HOME\n\n\tINS: 45,\n\t//!INS\n\tDEL: 46,\n\t//!DEL\n\n\tLEFT: 37,\n\t//!LEFT\n\tUP: 38,\n\t//!UP\n\tRIGHT: 39,\n\t//!RIGHT\n\tDOWN: 40,\n\t//!DOWN\n\n\tNUM_PLUS: 107,\n\t//!NUM_PLUS\n\tNUM_MINUS: 109,\n\t//!NUM_MINUS\n\tNUM_ASTERISK: 106,\n\t//!NUM_ASTERISK\n\tNUM_SLASH: 111,\n\t//!NUM_SLASH\n\tNUM_DOT: 110,\n\t//!NUM_DOT\n\n\tNUM_0: 96,\n\t//!NUM_0\n\tNUM_1: 97,\n\t//!NUM_1\n\tNUM_2: 98,\n\t//!NUM_2\n\tNUM_3: 99,\n\t//!NUM_3\n\tNUM_4: 100,\n\t//!NUM_4\n\tNUM_5: 101,\n\t//!NUM_5\n\tNUM_6: 102,\n\t//!NUM_6\n\tNUM_7: 103,\n\t//!NUM_7\n\tNUM_8: 104,\n\t//!NUM_8\n\tNUM_9: 105,\n\t//!NUM_9\n\n\tD0: 48,\n\t//!D0\n\tD1: 49,\n\t//!D1\n\tD2: 50,\n\t//!D2\n\tD3: 51,\n\t//!D3\n\tD4: 52,\n\t//!D4\n\tD5: 53,\n\t//!D5\n\tD6: 54,\n\t//!D6\n\tD7: 55,\n\t//!D7\n\tD8: 56,\n\t//!D8\n\tD9: 57,\n\t//!D9\n\n\tA: 65,\n\t//!A\n\tB: 66,\n\t//!B\n\tC: 67,\n\t//!C\n\tD: 68,\n\t//!D\n\tE: 69,\n\t//!E\n\tF: 70,\n\t//!F\n\tG: 71,\n\t//!G\n\tH: 72,\n\t//!H\n\tI: 73,\n\t//!I\n\tJ: 74,\n\t//!J\n\tK: 75,\n\t//!K\n\tL: 76,\n\t//!L\n\tM: 77,\n\t//!M\n\tN: 78,\n\t//!N\n\tO: 79,\n\t//!O\n\tP: 80,\n\t//!P\n\tQ: 81,\n\t//!Q\n\tR: 82,\n\t//!R\n\tS: 83,\n\t//!S\n\tT: 84,\n\t//!T\n\tU: 85,\n\t//!U\n\tV: 86,\n\t//!V\n\tW: 87,\n\t//!W\n\tX: 88,\n\t//!X\n\tY: 89,\n\t//!Y\n\tZ: 90,\n\t//!Z\n};\n","/*\n**\tutils/list.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rinn, Class } from 'rinn';\nimport Linkable from './linkable.js';\nimport Recycler from './recycler.js';\n\n//![import \"./linkable\"]\n//![import \"./recycler\"]\n\n//:/**\n//: * \tImplementation of a generic linked list.\n//: */\n\n//!class List\n\nconst List = Class.extend\n({\n\t/**\n\t * \tName of the class (for inheritance purposes).\n\t */\n\tclassName: \"List\",\n\n\t/**\n\t * \tPointer to the first node in the list.\n\t * \t!top: Linkable;\n\t */\n\ttop: null,\n\n\t/**\n\t * \tPointer to the last node in the list.\n\t * \t!bottom: Linkable;\n\t */\n\tbottom: null,\n\n\t/**\n\t * \tNumber of values in the list.\n\t * \t!length: number;\n\t */\n\tlength: 0,\n\n\t/**\n\t * \tInitializes the instance to an empty list.\n\t * \t!constructor();\n\t */\n\t__ctor: function ()\n\t{\n\t\tthis.top = null;\n\t\tthis.bottom = null;\n\t\tthis.length = 0;\n\t},\n\n\t/**\n\t * \tTraverses the list and destroys all nodes. The actual values are maintained. To destroy the\n\t * \tlist contents call clear() instead.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis.reset();\n\t},\n\n\t/**\n\t * \tClones all contents and returns a new list.\n\t * \t!clone() : List;\n\t */\n\tclone: function()\n\t{\n\t\tlet list = List.Pool.alloc();\n\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tlist.push(Rinn.clone(i.value));\n\n\t\treturn list;\n\t},\n\n\t/**\n\t * \tTraverses the list and destroys all nodes and values.\n\t * \t!clear() : List;\n\t */\n\tclear: function ()\n\t{\n\t\tlet i, ni;\n\n\t\tfor (i = this.top; i; i = ni)\n\t\t{\n\t\t\tni = i.next;\n\t\t\tdispose(i.free().value);\n\t\t}\n\n\t\tthis.top = this.bottom = null;\n\t\tthis.length = 0;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tTraverses the list, destroys all nodes **but** values are preserved.\n\t * \t!reset() : List;\n\t */\n\treset: function ()\n\t{\n\t\tlet i, ni;\n\n\t\tfor (i = this.top; i != null; i = ni)\n\t\t{\n\t\t\tni = i.next;\n\t\t\ti.free();\n\t\t}\n\n\t\tthis.top = this.bottom = null;\n\t\tthis.length = 0;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the first value in the list.\n\t * \t!first() : any;\n\t */\n\tfirst: function ()\n\t{\n\t\treturn this.top !== null ? this.top.value : null;\n\n\t},\n\t/**\n\t * \tReturns the last value in the list.\n\t * \t!last() : any;\n\t */\n\tlast: function ()\n\t{\n\t\treturn this.bottom !== null ? this.bottom.value : null;\n\t},\n\n\t/**\n\t * \tReturns a value given its index.\n\t * \t!getAt (index: number) : any;\n\t */\n\tgetAt: function (index)\n\t{\n\t\tlet i = null;\n\t\tfor (i = this.top; i && index-- > 0; i = i.next);\n\t\treturn i != null ? i.value : null;\n\t},\n\n\t/**\n\t * \tReturns the node at the given index.\n\t * \t!getNodeAt (index: number) : Linkable;\n\t */\n\tgetNodeAt: function (index)\n\t{\n\t\tlet i = null;\n\t\tfor (i = this.top; i && index--; i = i.next);\n\t\treturn i;\n\t},\n\n\t/**\n\t * \tReturns the node of a value given another value to compare, uses identical comparison (===) to match the value.\n\t * \t!sgetNode (value: any) : Linkable;\n\t */\n\tsgetNode: function (value)\n\t{\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tif (i.value === value) return i;\n\n\t\treturn null;\n\t},\n\n\t/**\n\t * \tRemoves the given value from the list and returns it.\n\t * \t!remove<T> (value: T) : T;\n\t */\n\tremove: function (i)\n\t{\n\t\tif (i != null && !Linkable.isInstance(i))\n\t\t\ti = this.sgetNode(i);\n\n\t\tif (!i) return null;\n\n\t\tif (!i.prev) this.top = i.next;\n\t\tif (!i.next) this.bottom = i.prev;\n\n\t\tthis.length--;\n\t\treturn i.free().value;\n\t},\n\n\t/**\n\t * \tAdds a value before the given reference node.\n\t * \t!insertBefore<T> (ref: Linkable, value: T) : T;\n\t */\n\tinsertBefore: function (ref, value)\n\t{\n\t\tif (!ref) return this;\n\n\t\tlet i = Linkable.Pool.alloc(value);\n\t\ti.linkBefore (ref);\n\n\t\tif (ref == this.top) this.top = i;\n\t\tthis.length++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * \tAdds a value after the given reference node.\n\t * \t!insertAfter<T> (ref: Linkable, value: T) : T;\n\t */\n\tinsertAfter: function (ref, value)\n\t{\n\t\tif (!ref) return this;\n\n\t\tlet i = Linkable.Pool.alloc(value);\n\t\ti.linkAfter (ref);\n\n\t\tif (ref == this.bottom) this.bottom = i;\n\t\tthis.length++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * \tAdds a value to the top of the list.\n\t * \t!unshift<T> (value: T) : T;\n\t */\n\tunshift: function (value)\n\t{\n\t\tlet i = Linkable.Pool.alloc(value);\n\n\t\ti.linkBefore (this.top);\n\t\tif (!this.bottom) this.bottom = i;\n\n\t\tthis.top = i;\n\t\tthis.length++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * \tRemoves a value from the top of the list.\n\t * \t!shift() : any;\n\t */\n\tshift: function ()\n\t{\n\t\tlet i = this.top;\n\t\tif (!i) return null;\n\n\t\tif (!(this.top = i.next)) this.bottom = null;\n\t\tthis.length--;\n\n\t\treturn i.free().value;\n\t},\n\n\t/**\n\t * \tAdds a value to the bottom of the list.\n\t * \t!push<T> (value: T) : T;\n\t */\n\tpush: function (value)\n\t{\n\t\tlet i = Linkable.Pool.alloc(value);\n\n\t\ti.linkAfter (this.bottom);\n\t\tif (!this.top) this.top = i;\n\n\t\tthis.bottom = i;\n\t\tthis.length++;\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * \tRemoves a value from the bottom of the list.\n\t * \t!pop() : any;\n\t */\n\tpop: function ()\n\t{\n\t\tlet i = this.bottom;\n\t\tif (!i) return null;\n\n\t\tif (!(this.bottom = i.prev)) this.top = null;\n\t\tthis.length--;\n\n\t\treturn i.free().value;\n\t},\n\n\t/**\n\t * \tAppends all contents of the given list to the current one.\n\t * \t!append (list: List) : List;\n\t */\n\tappend: function (list)\n\t{\n\t\tfor (let i = list.top; i; i = i.next)\n\t\t\tthis.push(i.value);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tTraverses the list calling the specified function for each value.\n\t * \t@param fn - Callback to execute, return `false` to stop the loop immediately.\n\t * \t!forEach(fn: (value: any, node: Linkable, list: List, context: object) => boolean, context?: object) : boolean;\n\t */\n\tforEach: function(fn, context=null)\n\t{\n\t\tlet ni;\n\t\n\t\tfor (let i = this.top; i; i = ni)\n\t\t{\n\t\t\tni = i.next;\n\t\t\tif (fn (i.value, i, this, context) === false) return false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tTraverses the list in reverse order, calling the specified function for each value.\n\t * \t@param fn - Callback to execute, return `false` to stop the loop immediately.\n\t * \t!forEachRev(fn: (value: any, node: Linkable, list: List, context: object) => boolean, context?: object) : boolean;\n\t */\n\tforEachRev: function(fn, context=null)\n\t{\n\t\tlet ni;\n\t\n\t\tfor (let i = this.bottom; i; i = ni)\n\t\t{\n\t\t\tni = i.prev;\n\t\t\tif (fn (i.value, i, this, context) === false) return false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tReturns the first value where the specified function returns `true`.\n\t * \t!find (fn: (value: any, context: object) => boolean, context?: object) : any;\n\t */\n\tfind: function (fn, context=null)\n\t{\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tif (fn(i.value, context)) return i.value;\n\n\t\treturn null;\n\t},\n\n\t/**\n\t * \tReturns an array with all values where the specified function returns `true`.\n\t * \t!filter (fn: (value: any, context: object) => boolean, context?: object) : Array<any>;\n\t */\n\tfilter: function (fn, context=null)\n\t{\n\t\tlet list = List.Pool.alloc();\n\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tif (fn(i.value, context)) list.push(i.value);\n\n\t\treturn list;\n\t},\n\n\t/**\n\t * \tReturns an array with all the values in the list.\n\t * \t!toArray() : Array<any>;\n\t */\n\ttoArray: function()\n\t{\n\t\tlet array = [];\n\n\t\tfor (let i = this.top; i; i = i.next)\n\t\t\tarray.push(i.value);\n\n\t\treturn array;\n\t}\n});\n\n//!/class\n\n//!namespace List\n//!namespace Pool\n\n\t/**\n\t * \tAllocates an empty list.\n\t * \t!function alloc() : List;\n\t */\n\nRecycler.createPool (List, 16384, 6144);\nexport default List;\n","/*\n**\tutils/linkable.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Recycler from './recycler.js';\n\n//![import \"./recycler\"]\n\n//:/**\n//: * \tGeneric class for linkable items such as required by List. The responsibility of this class is to wrap a value into a linkable object.\n//: */\n\n//!class Linkable\n\nconst Linkable = Class.extend\n({\n\tclassName: \"Linkable\",\n\n\t/**\n\t * \tPointer to the previous item in the chain.\n\t * \t!readonly prev: Linkable;\n\t */\n\tprev: null, /* Linkable */\n\n\t/**\n\t * \tPointer to the next item in the chain.\n\t * \t!readonly next: Linkable;\n\t */\n\tnext: null, /* Linkable */\n\n\t/**\n\t * \tWrapped value.\n\t * \t!value: any;\n\t */\n\tvalue: null,\n\n\t/**\n\t * \tInitializes the linkable item and wraps the given value. Sets the `prev` and `next` pointers to null.\n\t * \t!constructor (value?: any);\n\t */\n\t__ctor: function (value)\n\t{\n\t\tthis.value = value;\n\t\tthis.clear();\n\t},\n\n\t/**\n\t * \tUnlinks the linkable item.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis.unlink();\n\t},\n\n\t/**\n\t * \tSets the previous/next connection pointers to null. Returns `this`.\n\t * \t!clear() : Linkable;\n\t */\n\tclear: function ()\n\t{\n\t\tthis.next = this.prev = null;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tLinks the item such that it will be located after the given reference.\n\t * \t!linkAfter (ref: Linkable) : Linkable;\n\t */\n\tlinkAfter: function (ref)\n\t{\n\t\tthis.prev = ref;\n\t\tthis.next = ref ? ref.next : null;\n\n\t\tif (ref)\n\t\t{\n\t\t\tif (ref.next) ref.next.prev = this;\n\t\t\tref.next = this;\n\t\t}\n\t},\n\n\t/**\n\t * \tLinks the item such that it will be located before the given reference.\n\t * \t!linkBefore (ref: Linkable) : Linkable;\n\t */\n\tlinkBefore: function (ref)\n\t{\n\t\tthis.prev = ref ? ref.prev : null;\n\t\tthis.next = ref;\n\n\t\tif (ref)\n\t\t{\n\t\t\tif (ref.prev) ref.prev.next = this;\n\t\t\tref.prev = this;\n\t\t}\n\t},\n\n\t/**\n\t * \tUnlinks the item by linking the `prev` and `next` together (when available) and returns `this`.\n\t * \t!unlink() : Linkable;\n\t */\n\tunlink: function () \n\t{\n\t\tif (this.prev) this.prev.next = this.next;\n\t\tif (this.next) this.next.prev = this.prev;\n\n\t\treturn this.clear();\n\t}\n});\n\n//!/class\n\n//!namespace Linkable\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a linkable item and wraps the given value. Sets the `prev` and `next` pointers to null.\n\t * \t!function alloc (value?: any) : Linkable;\n\t */\n\nRecycler.createPool (Linkable, 16384, 6144);\nexport default Linkable;\n","/*\n**\tutils/recycler.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst recyclingFacilities = { };\nlet totalPreallocated = 0;\n\nconst Recycler = { };\nglobal.Recycler = Recycler;\nexport default Recycler;\n\n//:/**\n//: * \tProvides functions to attach recycling functionality to any class for object pooling.\n//: */\n\n//!namespace Recycler\n\n/**\n * \tAttaches recycling methods (`allocate`, `alloc` and `free`) to the specified class. Class should implement method `init` to initialize the instance (and return itself)\n * \tand `__dtor` to destroy it.\n *\n * \t@param {*} maxPoolSize - Maximum number of instance to hold in the recycler.\n * \t@param {*} minPoolSize - Minimum number of instances to pre-allocate. Defaults to 0.375*`maxPoolSize` if not specified.\n * \n * \t!function attachTo (targetClass: any, maxPoolSize?: number, minPoolSize?: number) : any;\n */\n\nRecycler.attachTo = function (targetClass, maxPoolSize=8192, minPoolSize=null)\n{\n\tif (!targetClass.prototype.className)\n\t\tthrow new Error ('Unable to attach recycler methods to an unnamed class.');\n\n\tif (!('__dtor' in targetClass.prototype))\n\t\tthrow new Error ('Recycler: Class '+targetClass.prototype.className+' requires `__dtor` method.');\n\n\tif (!('init' in targetClass.prototype))\n\t\tthrow new Error ('Recycler: Class '+targetClass.prototype.className+' requires `init` method.');\n\n\tif (minPoolSize === null)\n\t\tminPoolSize = int(maxPoolSize * 0.375);\n\n\trecyclingFacilities[targetClass.prototype.className] = targetClass;\n\n\ttargetClass.recyclerPool = [ ];\n\ttargetClass.recyclerPoolMax = maxPoolSize;\n\n\ttargetClass.prototype.objectId = 0;\n\n\ttargetClass.recyclerNextObjectId = 0;\n\ttargetClass.recyclerCreated = 0;\n\ttargetClass.recyclerRecycled = 0;\n\ttargetClass.recyclerMissed = 0;\n\ttargetClass.recyclerLength = 0;\n\ttargetClass.recyclerActive = 0;\n\n\tlet preallocated = false;\n\n\t/**\n\t * \tPreallocates instances according the the minPoolSize value.\n\t */\n\ttargetClass.preallocate = function (maximum=null)\n\t{\n\t\tif (preallocated)\n\t\t\treturn;\n\n\t\tlet n = maximum === null ? minPoolSize : Math.min(maximum, minPoolSize);\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\ttargetClass.recyclerPool.push(new targetClass ());\n\t\t\ttargetClass.recyclerLength++;\n\t\t\ttotalPreallocated++;\n\t\t}\n\n\t\tpreallocated = true;\n\t};\n\n\t/**\n\t * \tAllocates a new instance of the class. To ensure correct instance state a call to `init` must be made later.\n\t * \t@returns {object}\n\t */\n\ttargetClass.allocate = function()\n\t{\n\t\tlet item;\n\n\t\tif (!this.recyclerLength)\n\t\t{\n\t\t\titem = new targetClass ();\n\t\t\ttargetClass.recyclerCreated++;\n\t\t}\n\t\telse\n\t\t{\n\t\t\titem = this.recyclerPool[--this.recyclerLength];\n\t\t\ttargetClass.recyclerRecycled++;\n\t\t}\n\n\t\ttargetClass.recyclerActive++;\n\n\t\titem.objectId = ++this.recyclerNextObjectId;\n\t\tthis.recyclerNextObjectId &= 0x7FFFFFFF;\n\n\t\treturn item;\n\t};\n\n\t/**\n\t * \tAllocates an instance and initializes it. Internally runs `allocate` first and then `init` with up to 10 parameters.\n\t * \t@param {any} a0..a9 \n\t * \t@returns {object}\n\t */\n\ttargetClass.alloc = function(a0=null, a1=null, a2=null, a3=null, a4=null, a5=null, a6=null, a7=null, a8=null, a9=null)\n\t{\n\t\treturn targetClass.allocate().init(a0, a1, a2, a3, a4, a5, a6, a7, a8, a9);\n\t};\n\n\t/**\n\t * \tReleases the self object and adds it back to the pool. Duplicate call to this method will result in an error.\n\t * \t@returns {object}\n\t */\n\ttargetClass.prototype.free = function()\n\t{\n\t\tif (this.objectId < 0)\n\t\t\treturn this;\n\n\t\tif (this.objectId == 0)\n\t\t{\n\t\t\tconsole.error ('ERROR: Already released instance of ' + targetClass.prototype.className);\n\t\t\treturn this;\n\t\t}\n\n\t\tthis.__dtor();\n\n\t\tthis.objectId = 0;\n\n\t\tif (targetClass.recyclerLength >= maxPoolSize)\n\t\t\ttargetClass.recyclerMissed++;\n\t\telse\n\t\t\ttargetClass.recyclerPool[targetClass.recyclerLength++] = this;\n\n\t\ttargetClass.recyclerActive--;\n\t\treturn this;\n\t};\n\n\t/**\n\t * \tSets a flag used to prevent the instance from being destroyed.\n\t * \t@returns {object}\n\t */\n\ttargetClass.prototype.lockInstance = function(value)\n\t{\n\t\tthis.objectId = Math.abs(this.objectId);\n\t\tif (value) this.objectId = -this.objectId;\n\t\treturn this;\n\t};\n};\n\n/**\n * \tShows stats about all recycling facilities (or just the specified one) using `console.debug`.\n * \t@param name - Name of the class to show.\n * \t!function showStats (name?: string) : void;\n */\nRecycler.showStats = function (name=null)\n{\n\tlet list = recyclingFacilities;\n\n\tconsole.log('Total Preallocated: ' + totalPreallocated);\n\n\tif (name === true)\n\t{\n\t\tconsole.group('Recycling Facilities');\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tlet c = list[i];\n\t\t\tif (!c.recyclerCreated) continue;\n\n\t\t\tconsole.debug (i + ': '+(100*(c.recyclerCreated/c.recyclerPoolMax)).toFixed(1)+'%  =>  overhead=' + c.recyclerCreated + ', active='+c.recyclerActive+', array=' + c.recyclerPool.length + ', recycled=' + c.recyclerRecycled + ', in-recycler=' + c.recyclerLength + ', missed=' + c.recyclerMissed + ', space=' + (c.recyclerPoolMax - c.recyclerLength));\n\t\t}\n\t\n\t\tconsole.groupEnd();\n\t\treturn;\n\t}\n\n\tif (name !== null)\n\t{\n\t\tif (typeof(name) === 'string')\n\t\t{\n\t\t\tlet c = recyclingFacilities[name];\n\t\t\tconsole.debug (name + ': '+(100*(c.recyclerCreated/c.recyclerPoolMax)).toFixed(1)+'%  =>  overhead=' + c.recyclerCreated + ', active='+c.recyclerActive+', array=' + c.recyclerPool.length + ', recycled=' + c.recyclerRecycled + ', in-recycler=' + c.recyclerLength + ', missed=' + c.recyclerMissed + ', space=' + (c.recyclerPoolMax - c.recyclerLength));\n\t\t\treturn;\n\t\t}\n\n\t\tlist = name;\n\t}\n\n\tconsole.group('Recycling Facilities');\n\n\tfor (let i in list)\n\t{\n\t\tlet c = list[i];\n\t\tconsole.debug (i + ': '+(100*(c.recyclerCreated/c.recyclerPoolMax)).toFixed(1)+'%  =>  overhead=' + c.recyclerCreated + ', active='+c.recyclerActive+', array=' + c.recyclerPool.length + ', recycled=' + c.recyclerRecycled + ', in-recycler=' + c.recyclerLength + ', missed=' + c.recyclerMissed + ', space=' + (c.recyclerPoolMax - c.recyclerLength));\n\t}\n\n\tconsole.groupEnd();\n};\n\n\n/**\n * \tCreate a new class extending the specified target class, this new class is a recycling facility and is placed under property `Pool` of the target class. This\n * \tmethod can be used instead of the usual `attachTo` when the target class construct/deconstruct methods need to remain untouched.\n *\n * \t@param {*} maxPoolSize - Maximum number of instance to hold in the recycler.\n * \t@param {*} minPoolSize - Minimum number of instances to pre-allocate. Defaults to 0.375*`maxPoolSize` if not specified.\n * \n *\t!function createPool (targetClass: any, maxPoolSize?: number, minPoolSize?: number) : any;\n */\nRecycler.createPool = function (targetClass, maxPoolSize=8192, minPoolSize=null)\n{\n\tconst name = targetClass.prototype.className;\n\tif (!name) throw new Error ('Unable to create pool sub-class on an unnamed class.');\n\n\tconst Pool = targetClass.extend\n\t({\n\t\tclassName: targetClass.prototype.className,\n\n\t\t__ctor: function () {\n\t\t},\n\n\t\tinit: function(a0=null, a1=null, a2=null, a3=null, a4=null, a5=null, a6=null, a7=null, a8=null, a9=null)\n\t\t{\n\t\t\tthis._super[name].__ctor(a0, a1, a2, a3, a4, a5, a6, a7, a8, a9);\n\t\t\treturn this;\n\t\t}\n\t});\n\n\tRecycler.attachTo(Pool, maxPoolSize, minPoolSize);\n\ttargetClass.Pool = Pool;\n\n\treturn targetClass;\n};\n\n\n/**\n * \tRuns the preallocation process of all registered pools. Returns the total number of instances preallocated.\n * \t@param {number|null} maxPreallocationsPerPool\n * \t!function preallocate (maxPreallocationsPerPool?: number) : number;\n */\nRecycler.preallocate = function (maxPreallocationsPerPool=null)\n{\n\ttotalPreallocated = 0;\n\n\tfor (let i in recyclingFacilities)\n\t\trecyclingFacilities[i].preallocate(maxPreallocationsPerPool);\n\n\treturn totalPreallocated;\n}\n","/*\n**\tsystem/timer.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n//!class Timer\n\n/**\n * \t@param vsync - Indicates if requestAnimationFrame should be used instead of setTimeout.\n * \t@param interval - Amount of milliseconds between timer activations.\n * \t@param callback - Function to execute on each timer activation.\n *\n * \t!constructor (vsync: boolean, interval: number, callback: (dt: number, timer: Timer) => void );\n */\nconst Timer = function (vsync, interval, callback)\n{\n\tthis.callback = callback;\n\tthis.interval = interval;\n\tthis.vsync = vsync;\n\tthis.handle = null;\n\n\tthis.isRunning = false;\n\tthis.startTime = 0;\n\tthis.rTime = 0;\n\tthis.sTime = 0;\n\tthis.lTime = 0;\n\tthis.tDelta = 0;\n\n\tthis._onTimeout = () => {\n\t\tthis.onTimeout();\n\t};\n\n\tthis._onTimeout_b = () => {\n\t\tthis.runNow();\n\t};\n};\n\n/**\n * \tTimer onTimeout handler.\n */\nTimer.prototype.onTimeout = function ()\n{\n\tif (!this.isRunning) return;\n\n\tthis.rTime = hrnow() - this.startTime;\n\n\tlet tError = this.rTime - (this.sTime + this.interval);\n\tif (tError < 0)\n\t{\n\t\tthis.runAfter(-tError);\n\t\treturn;\n\t}\n\n\tthis.sTime += this.interval * (1 + int(tError / this.interval));\n\n\tthis.tDelta = tError < 0 ? this.interval : (this.rTime - this.lTime);\n\tthis.lTime = this.rTime;\n\n\tthis.runAfter((this.sTime + this.interval) - (hrnow() - this.startTime));\n\tthis.callback(this.tDelta, this);\n};\n\n/**\n * \tStarts the timer and triggers `onStarted`.\n *\n * \t@param immediate - When `true` the callback will be executed immediately.\n * \t@param scale - Used to control when to trigger the first timeout, delay is timeInterval*scale.\n *\n * \t!start (immediate?: boolean, scale?: number) : void;\n */\nTimer.prototype.start = function (immediate=false, scale=1.0)\n{\n\tif (this.isRunning) return;\n\n\tthis.startTime = hrnow();\n\tthis.isRunning = true;\n\n\tthis.sTime = 0;\n\tthis.lTime = 0;\n\n\tthis.onStarted();\n\n\tif (immediate)\n\t\tthis.callback (0, this);\n\n\tthis.runAfter(this.interval*scale);\n};\n\n/**\n * \tExecutes the timer activation after the specified amount of milliseconds.\n *\n * \t!runAfter (timeout: number) : void;\n */\nTimer.prototype.runAfter = function (timeout)\n{\n\tif (process.browser && this.vsync)\n\t{\n\t\trequestAnimationFrame(this._onTimeout_b);\n\t\treturn;\n\t}\n\n\tif (this.handle)\n\t\tclearTimeout(this.handle);\n\n\tthis.handle = setTimeout(this._onTimeout, timeout);\n};\n\n/**\n * \tExecutes the timer activaton as soon as possible.\n *\n * \t!runNow() : void;\n */\nTimer.prototype.runNow = function ()\n{\n\tif (this.handle)\n\t\tclearTimeout(this.handle);\n\n\tthis.handle = setTimeout(this._onTimeout, 0);\n};\n\n/**\n * \tStops the timer and triggers `onStopped`.\n *\n * \t!stop() : void;\n */\nTimer.prototype.stop = function ()\n{\n\tif (!this.isRunning) return;\n\n\tif (this.handle)\n\t{\n\t\tclearTimeout(this.handle);\n\t\tthis.handle = null;\n\t}\n\n\tthis.isRunning = false;\n\tthis.onStopped();\n};\n\n/**\n * \tTimer started event handler.\n *\n * \t!onStarted() : void;\n */\nTimer.prototype.onStarted = function ()\n{\n};\n\n/**\n * \tTimer stopped event handler.\n *\n * \t!onStopped() : void;\n */\nTimer.prototype.onStopped = function ()\n{\n};\n\nexport default Timer;\n","/*\n**\tsystem/canvas.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rinn } from 'rinn';\nimport Matrix from '../math/matrix.js';\nimport System from './system.js';\nimport List from '../utils/list.js';\nimport ShaderProgram from './shader-program.js';\nimport Shader from './shader.js';\nimport globals from './globals.js';\nimport Log from './log.js';\n\n//![import \"../math/matrix\"]\n//![import \"./system\"]\n//![import \"../utils/list\"]\n//![import \"./shader-program\"]\n//![import \"./shader\"]\n//![import \"./globals\"]\n//![import \"./log\"]\n\n//!namespace Canvas\n\n\t//!type Options =\n\n\t\t/**\n\t\t * \tActual HTML5 Canvas element, if `null` a new one will be created.\n\t\t * \t!elem: HTMLCanvasElement;\n\t\t */\n\t\t\n\t\t/**\n\t\t * \tWebGL enable flag.\n\t\t * \t!gl: boolean;\n\t\t */\n\n\t\t/**\n\t\t * \tBackground of the canvas element.\n\t\t * \t!background: string;\n\t\t */\n\n\t\t/**\n\t\t * \tWidth of the canvas.\n\t\t * \t!width: number;\n\t\t */\n\n\t\t/**\n\t\t * \tHeight of the canvas.\n\t\t * \t!height: number;\n\t\t */\n\n\t\t/**\n\t\t * \tIndicates if the canvas element should be hidden from view (not attached to the document body).\n\t\t * \t!hidden: boolean;\n\t\t */\n\n\t\t/**\n\t\t * \tSet to `true` to ensure the canvas is positioned absolutly to (0, 0).\n\t\t * \t!absolute: boolean;\n\t\t */\n\n\t\t/**\n\t\t * \tUsed to control the antialias property of the canvas.\n\t\t * \t!antialias: boolean;\n\t\t */\n\n\t//!/type\n\n//!/namespace\n\n//!class Canvas\n\n/**\n * \tConstructs a canvas object. If the Canvas DOM element is not provided a new element will be created and attached to the page.\n * \t!constructor (options: Canvas.Options);\n */\n\nconst Canvas = function (options=null)\n{\n\tlet opts = {\n\t\telem: null,\n\t\tgl: false,\n\t\tbackground: '#000000',\n\t\twidth: 0,\n\t\theight: 0,\n\t\thidden: true,\n\t\tabsolute: false,\n\t\tantialias: false,\n\t\t...options\n\t};\n\n\tconst headless = global.document ? false : true;\n\n\t// Create canvas element if required.\n\tif (opts.elem == null)\n\t{\n\t\tthis.elem = !headless ? global.document.createElement('canvas') : Rinn.clone(Canvas.passThruCanvas);\n\n\t\tif (global.document && opts.hidden != true)\n\t\t{\n\t\t\tglobal.document.body.appendChild (this.elem);\n\n\t\t\tif (opts.absolute === true) {\n\t\t\t\tthis.elem.style.position = 'absolute';\n\t\t\t\tthis.elem.style.left = '0';\n\t\t\t\tthis.elem.style.top = '0';\n\t\t\t}\n\t\t}\n\t}\n\telse\n\t{\n\t\tthis.elem = opts.elem;\n\t}\n\n\tif (!this.elem.getContext) return;\n\n\tif (opts.gl === true && !headless)\n\t{\n\t\tthis.gl = this.elem.getContext('webgl2', { desynchronized: false, alpha: false, stencil: true });\n\t\tthis.context = null;\n\n\t\tLog.write(this.gl.getParameter(this.gl.VERSION) + ', ' + this.gl.getParameter(this.gl.SHADING_LANGUAGE_VERSION));\n\n\t\tglobals.gl = this.gl;\n\t}\n\telse\n\t{\n\t\tthis.context = this.elem.getContext('2d', { desynchronized: false });\n\t\tthis.gl = null;\n\t}\n\n\t// State stack support.\n\tthis.matrixStack = List.Pool.alloc();\n\tthis.alphaStack = List.Pool.alloc();\n\tthis.depthFlagStack = List.Pool.alloc();\n\tthis.shaderProgramStack = List.Pool.alloc();\n\n\tthis.matr = Matrix.Pool.alloc();\n\tthis.transform = Matrix.Pool.alloc();\n\n\t// Default context values.\n\tthis._globalScale = 1.0;\n\tthis._alpha = 1.0;\n\tthis._depthFlag = true;\n\tthis.shaderProgram = null;\n\n\t// Set initial transformation matrix.\n\tthis.updateTransform();\n\tthis.strokeStyle(\"#fff\");\n\tthis.fillStyle(\"#fff\");\n\n\tif (opts.width && opts.height)\n\tthis.resize (opts.width, opts.height);\n\n\tif (this.gl !== null)\n\t\tthis.initGl();\n\n\tthis.antialias = opts.antialias;\n\tthis.setBackground (opts.background);\n};\n\nCanvas.passThruCanvas = \n{\n\tparentNode: null,\n\n\timageSmoothingEnabled: true,\n\n\tstyle: {\n\t},\n\n\twidth: 960,\n\theight: 540,\n\n\tgetContext: function (renderingContext) {\n\t\treturn this;\n\t},\n\n\tpushClip: function() {\n\t},\n\n\tpopClip: function() {\n\t},\n\n\tscale: function (sx, sy) {\n\t},\n\n\trotate: function (angle) {\n\t},\n\n\ttranslate: function (x, y) {\n\t},\n\n\tsetTransform: function (a, b, c, d, e, f) {\n\t},\n\n\tupdateTransform: function () {\n\t},\n\n\ttoDataURL: function (mime, params) {\n\t\treturn '';\n\t},\n\n\tbeginPath: function () {\n\t},\n\n\tmoveTo: function (x, y) {\n\t},\n\n\tclosePath: function() {\n\t},\n\n\tlineTo: function() {\n\t},\n\n\trect: function(x, y, w, h) {\n\t},\n\n\tfill: function() {\n\t},\n\n\tstroke: function() {\n\t},\n\n\tfillRect: function(x, y, w, h) {\n\t},\n\n\tstrokeRect: function(x, y, w, h) {\n\t},\n\n\tclip: function() {\n\t},\n\n\tquadraticCurveTo: function (cpx, cpy, x, y) {\n\t},\n\n\tbezierCurveTo: function (cx1, cy1, cx2, cy2, x, y) {\n\t},\n\n\tarc: function (x, y, r, sA, eA, cw) {\n\t},\n\n\tarcTo: function (x1, y1, x2, y2, r) {\n\t},\n\n\tfillText: function (text, x, y, maxWidth) {\n\t},\n\n\tstrokeText: function (text, x, y, maxWidth) {\n\t},\n\n\tmeasureText: function (text) {\n\t\treturn { width: 0 };\n\t},\n\n\tcreateImageData: function (w, h) {\n\t\treturn { width: w, height: h };\n\t},\n\n\tgetImageData: function (x, y, w, h) {\n\t\treturn { width: w, height: h, data: [] };\n\t},\n\n\tputImageData: function (data, x, y) {\n\t},\n\n\tdrawImage: function (img, sx=0, sy=0, sw=null, sh=null, dx=null, dy=null, dw=null, dh=null, textureWidth=null, textureHeight=null, frameWidth=null, frameHeight=null) {\n\t},\n\n\tgetBoundingClientRect: function () {\n\t\treturn { left: 0, top: 0 };\n\t}\n};\n\n/**\n * \tInitializes the OpenGL ES context.\n */\nCanvas.prototype.initGl = function ()\n{\n\tlet gl = this.gl;\n\n\t// This code is required if \"desynchronized\" is set to true (for some reason).\n\t//if (navigator && navigator.userAgent.toLowerCase().indexOf('firefox') > -1)\n\t//\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n\t//else\n\t//\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);\n\n\t/**\n\t * \tCreate the default shader program.\n\t */\n\tthis.glDefaultProgram = new ShaderProgram('def');\n\n\t(new Shader ('def-vert', Shader.Type.VERTEX))\n\t.source(\n\t\t`#version 300 es\n\t\tprecision highp float;\n\n\t\tuniform mat3 m_location;\n\t\tuniform mat3 m_transform;\n\t\tuniform mat3 m_texture;\n\n\t\tuniform vec2 v_resolution;\n\t\tuniform vec2 v_texture_size;\n\t\tuniform vec2 v_frame_size;\n\n\t\tuniform float f_time;\n\t\tuniform float f_depth;\n\n\t\tuniform sampler2D texture0;\n\n\t\tin vec2 location;\n\t\tout vec2 texcoords;\n\n\t\tvoid main()\n\t\t{\n\t\t\tgl_Position = vec4(((vec2(m_transform * m_location * vec3(location, 1.0)) / v_resolution)*2.0 - vec2(1.0, 1.0)) * vec2(1.0, -1.0), f_depth / 16777216.0, 1.0);\n\t\t\ttexcoords = vec2(m_texture * vec3(location, 1.0)) / v_texture_size;\n\t\t}\n\t`)\n\t.compile();\n\n\t(new Shader ('def-frag', Shader.Type.FRAGMENT))\n\t.source(\n\t\t`#version 300 es\n\t\tprecision highp float;\n\n\t\tuniform sampler2D texture0;\n\t\tuniform float f_alpha;\n\t\tin vec2 texcoords;\n\n\t\tout vec4 color;\n\n\t\tvoid main()\n\t\t{\n\t\t\tcolor = texture(texture0, texcoords);\n\t\t\tcolor.a *= f_alpha;\n\n\t\t\tif (color.a == 0.0) discard;\n\t\t}\n\t`)\n\t.compile();\n\n\t/**\n\t * \tCreate repeat (tileable) shader program.\n\t */\n\tthis.glRepeatProgram = new ShaderProgram('repeat');\n\n\t(new Shader ('repeat-vert', Shader.Type.VERTEX))\n\t.source(\n\t\t`#version 300 es\n\t\tprecision highp float;\n\t\t\n\t\tuniform mat3 m_location;\n\t\tuniform mat3 m_transform;\n\t\tuniform mat3 m_texture;\n\t\t\n\t\tuniform vec2 v_resolution;\n\t\tuniform vec2 v_texture_size;\n\t\tuniform vec2 v_frame_size;\n\t\t\n\t\tuniform float f_time;\n\t\tuniform float f_depth;\n\t\t\n\t\tuniform sampler2D texture0;\n\t\t\n\t\tin vec2 location;\n\t\tout vec2 texcoords;\n\t\t\n\t\tout vec2 texoffs;\n\t\tout vec2 texsiz;\n\t\t\n\t\tvoid main()\n\t\t{\n\t\t\tgl_Position = vec4(((vec2(m_transform * m_location * vec3(location, 1.0)) / v_resolution)*2.0 - vec2(1.0, 1.0)) * vec2(1.0, -1.0), f_depth / 16777216.0, 1.0);\n\t\t\n\t\t\ttexcoords = vec2(\n\t\t\t\t(location.x*m_texture[0][0]/v_texture_size[0])*(m_location[0][0] / v_frame_size[0]),\n\t\t\t\t(location.y*m_texture[1][1]/v_texture_size[1])*(m_location[1][1] / v_frame_size[1])\n\t\t\t);\n\t\t\n\t\t\ttexoffs = vec2(m_texture[2][0]/v_texture_size[0], m_texture[2][1]/v_texture_size[1]);\n\t\t\ttexsiz = vec2(m_texture[0][0]/v_texture_size[0], m_texture[1][1]/v_texture_size[1]);\n\t\t}\n\t`)\n\t.compile();\n\n\t(new Shader ('repeat-frag', Shader.Type.FRAGMENT))\n\t.source(\n\t\t`#version 300 es\n\t\tprecision highp float;\n\t\t\n\t\tuniform mat3 m_texture;\n\t\tuniform vec2 v_texture_size;\n\t\t\n\t\tuniform sampler2D texture0;\n\t\tuniform float f_alpha;\n\t\t\n\t\tin vec2 texcoords;\n\t\tin vec2 texoffs;\n\t\tin vec2 texsiz;\n\t\t\n\t\tout vec4 color;\n\t\t\n\t\tvoid main()\n\t\t{\n\t\t\tcolor = texture(texture0, mod(texcoords, texsiz) + texoffs);\n\t\t\n\t\t\tcolor.a *= f_alpha;\n\t\t\tif (color.a == 0.0) discard;\n\t\t}\n\t`)\n\t.compile();\n\n\t/**\n\t * \tCreate the frame buffer blit shader program.\n\t */\n\tthis.glBlitProgram = new ShaderProgram('blit');\n\n\t(new Shader ('blit-vert', Shader.Type.VERTEX))\n\t.source(\n\t\t`#version 300 es\n\t\tprecision highp float;\n\n\t\tuniform mat3 m_location;\n\t\tuniform mat3 m_texture;\n\t\tuniform vec2 v_resolution;\n\t\tuniform vec2 v_texture_size;\n\n\t\tuniform sampler2D texture0;\n\n\t\tin vec2 location;\n\t\tout vec2 texcoords;\n\n\t\tvoid main()\n\t\t{\n\t\t\tgl_Position = vec4(((vec2(m_location * vec3(location, 1.0)) / v_resolution)*2.0 - vec2(1.0, 1.0)) * vec2(1.0, 1.0), 0.0, 1.0);\n\t\t\ttexcoords = vec2(m_texture * vec3(location, 1.0)) / v_texture_size;\n\t\t}\n\t`)\n\t.compile();\n\n\t(new Shader ('blit-frag', Shader.Type.FRAGMENT))\n\t.source(\n\t\t`#version 300 es\n\t\tprecision highp float;\n\n\t\tuniform sampler2D texture0;\n\t\tin vec2 texcoords;\n\n\t\tout vec4 color;\n\n\t\tvoid main()\n\t\t{\n\t\t\tcolor = texture(texture0, texcoords);\n\t\t}\n\t`)\n\t.compile();\n\n\t/* ****** */\n\tthis.glDefaultProgram.attach('def-vert');\n\tthis.glDefaultProgram.attach('def-frag');\n\n\tthis.glRepeatProgram.attach('repeat-vert');\n\tthis.glRepeatProgram.attach('repeat-frag');\n\n\tthis.glBlitProgram.attach('blit-vert');\n\tthis.glBlitProgram.attach('blit-frag');\n\n\tthis.glDefaultProgram.link();\n\tthis.glRepeatProgram.link();\n\tthis.glBlitProgram.link();\n\n\tif (!this.glDefaultProgram.getStatus())\n\t\tthrow new Error (this.glDefaultProgram.getAllErrors());\n\n\tif (!this.glRepeatProgram.getStatus())\n\t\tthrow new Error (this.glRepeatProgram.getAllErrors());\n\n\tif (!this.glBlitProgram.getStatus())\n\t\tthrow new Error (this.glBlitProgram.getAllErrors());\n\n\tthis.setShaderProgram(this.glDefaultProgram);\n\n\t/**\n\t * \tCreate the vertex buffer.\n\t */\n\tlet buffer = this.attrib_location_buffer = gl.createBuffer();\n\tgl.bindBuffer (gl.ARRAY_BUFFER, buffer);\n\tgl.bufferData (gl.ARRAY_BUFFER, new Float32Array ([0,0,  0,1,  1,0,  1,1]), gl.STATIC_DRAW);\n\n\tgl.enableVertexAttribArray (this.shaderProgram.attrib_location);\n\tgl.vertexAttribPointer (this.shaderProgram.attrib_location, 2, gl.FLOAT, gl.FALSE, 2*Float32Array.BYTES_PER_ELEMENT, 0*Float32Array.BYTES_PER_ELEMENT);\n\n\t/**\n\t * \tSetup initial GL configuration.\n\t */\n\tgl.clearColor (0.0, 0.0, 0.0, 1.0);\n\n\tgl.enable (gl.DEPTH_TEST);\n\tgl.clearDepth (0.0);\n\tgl.depthFunc (gl.GEQUAL);\n\n\tgl.enable (gl.BLEND);\n\tgl.blendFunc (gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\n\t/**\n\t * \tSetup frame buffer.\n\t */\n\n\t/* *** */\n\tthis.m_location = new Float32Array(9).fill(0);\n\tthis.m_texture = new Float32Array(9).fill(0);\n\tthis.v_texture_size = new Float32Array(2).fill(0);\n\tthis.v_frame_size = new Float32Array(2).fill(0);\n\tthis.v_resolution = new Float32Array(2).fill(0);\n\tthis.zvalue = 0;\n\n\tMatrix.loadIdentity(this.m_location);\n\tMatrix.loadIdentity(this.m_texture);\n\n\t// drawImage (Image img, float x, float y);\n\t// drawImage (Image img, float x, float y, float w, float h);\n\t// drawImage (Image img, float sx, float sy, float sw, float sh, float dx, float dy, float dw, float dh);\n\t// drawImage (Image img, float sx, float sy, float sw, float sh, float dx, float dy, float dw, float dh, float textureWidth, float textureHeight, float frameWidth, float frameHeight);\n\tthis.drawImage = function (img, sx=0, sy=0, sw=null, sh=null, dx=null, dy=null, dw=null, dh=null, textureWidth=null, textureHeight=null, frameWidth=null, frameHeight=null)\n\t{\n\t\tif (!img.glTextureReady)\n\t\t\treturn;\n\n\t\tlet gl = this.gl;\n\t\tlet program = this.shaderProgram;\n\n\t\tif (textureWidth === null)\n\t\t{\n\t\t\ttextureWidth = img.width;\n\t\t\ttextureHeight = img.height;\n\t\t}\n\n\t\tif (frameWidth === null)\n\t\t{\n\t\t\tframeWidth = img.targetWidth;\n\t\t\tframeHeight = img.targetHeight;\n\t\t}\n\n\t\tgl.uniform2fv (program.uniform_resolution, this.v_resolution);\n\t\tgl.uniform1f (program.uniform_time, globals.time);\n\t\tgl.uniform1f (program.uniform_scale, this._globalScale);\n\t\tgl.uniform1f (program.uniform_alpha, this._alpha);\n\n\t\tif (this.glActiveTextureId !== img.glTextureId || this.glActiveShader !== program)\n\t\t{\n\t\t\tgl.activeTexture (gl.TEXTURE0);\n\t\t\tgl.bindTexture (gl.TEXTURE_2D, img.glTextureId);\n\t\t\tgl.uniform1i (program.uniform_texture_0, 0);\n\n\t\t\tthis.v_texture_size[0] = textureWidth;\n\t\t\tthis.v_texture_size[1] = textureHeight;\n\t\t\tgl.uniform2fv (program.uniform_texture_size, this.v_texture_size);\n\n\t\t\tthis.v_frame_size[0] = frameWidth;\n\t\t\tthis.v_frame_size[1] = frameHeight;\n\t\t\tgl.uniform2fv (program.uniform_frame_size, this.v_frame_size);\n\n\t\t\tthis.glActiveTextureId = img.glTextureId;\n\t\t\tthis.glActiveShader = program;\n\t\t}\n\n\t\t// [3] image, x, y\n\t\tif (sw === null)\n\t\t{\n\t\t\tthis.m_location[0] = textureWidth;\n\t\t\tthis.m_location[4] = textureHeight;\n\t\t\tthis.m_location[6] = sx;\n\t\t\tthis.m_location[7] = sy;\n\n\t\t\tthis.m_texture[0] = textureWidth;\n\t\t\tthis.m_texture[4] = textureHeight;\n\t\t\tthis.m_texture[6] = 0;\n\t\t\tthis.m_texture[7] = 0;\n\n\t\t\tgl.uniformMatrix3fv (program.uniform_transform_matrix, false, this.transform.data);\n\t\t\tgl.uniformMatrix3fv (program.uniform_location_matrix, false, this.m_location);\n\t\t\tgl.uniformMatrix3fv (program.uniform_texture_matrix, false, this.m_texture);\n\t\t\tgl.uniform1f (program.uniform_depth, this.zvalue);\n\t\t\tgl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\n\t\t\treturn;\n\t\t}\n\n\t\t// [5] image, x, y, width, height\n\t\tif (dx === null)\n\t\t{\n\t\t\tthis.m_location[0] = sw;\n\t\t\tthis.m_location[4] = sh;\n\t\t\tthis.m_location[6] = sx;\n\t\t\tthis.m_location[7] = sy;\n\n\t\t\tthis.m_texture[0] = textureWidth;\n\t\t\tthis.m_texture[4] = textureHeight;\n\t\t\tthis.m_texture[6] = 0;\n\t\t\tthis.m_texture[7] = 0;\n\n\t\t\tgl.uniformMatrix3fv (program.uniform_transform_matrix, false, this.transform.data);\n\t\t\tgl.uniformMatrix3fv (program.uniform_location_matrix, false, this.m_location);\n\t\t\tgl.uniformMatrix3fv (program.uniform_texture_matrix, false, this.m_texture);\n\t\t\tgl.uniform1f (program.uniform_depth, this.zvalue);\n\t\t\tgl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\n\t\t\treturn;\n\t\t}\n\n\t\t// [9] image, sx, sy, sw, sh, dx, dy, dw, dh\n\t\tthis.m_location[0] = dw;\n\t\tthis.m_location[4] = dh;\n\t\tthis.m_location[6] = dx;\n\t\tthis.m_location[7] = dy;\n\n\t\tthis.m_texture[0] = sw;\n\t\tthis.m_texture[4] = sh;\n\t\tthis.m_texture[6] = sx;\n\t\tthis.m_texture[7] = sy;\n\n\t\tgl.uniformMatrix3fv (program.uniform_transform_matrix, false, this.transform.data);\n\t\tgl.uniformMatrix3fv (program.uniform_location_matrix, false, this.m_location);\n\t\tgl.uniformMatrix3fv (program.uniform_texture_matrix, false, this.m_texture);\n\t\tgl.uniform1f (program.uniform_depth, this.zvalue);\n\t\tgl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\t};\n\n\t// drawRect (float x, float y, float w, float h);\n\tthis.drawRect = function (x, y, w, h)\n\t{\n\t\tlet gl = this.gl;\n\t\tlet program = this.shaderProgram;\n\n\t\tgl.uniform2fv (program.uniform_resolution, this.v_resolution);\n\t\tgl.uniform1f (program.uniform_time, globals.time);\n\t\tgl.uniform1f (program.uniform_scale, this._globalScale);\n\t\tgl.uniform1f (program.uniform_alpha, this._alpha);\n\n\t\tthis.glActiveTextureId = null;\n\n\t\tthis.v_texture_size[0] = w;\n\t\tthis.v_texture_size[1] = h;\n\t\tgl.uniform2fv (program.uniform_texture_size, this.v_texture_size);\n\n\t\tthis.m_location[0] = w;\n\t\tthis.m_location[4] = h;\n\t\tthis.m_location[6] = x;\n\t\tthis.m_location[7] = y;\n\n\t\tthis.m_texture[0] = w;\n\t\tthis.m_texture[4] = h;\n\t\tthis.m_texture[6] = 0;\n\t\tthis.m_texture[7] = 0;\n\n\t\tgl.uniformMatrix3fv (program.uniform_transform_matrix, false, this.transform.data);\n\t\tgl.uniformMatrix3fv (program.uniform_location_matrix, false, this.m_location);\n\t\tgl.uniformMatrix3fv (program.uniform_texture_matrix, false, this.m_texture);\n\t\tgl.uniform1f (program.uniform_depth, this.zvalue);\n\t\tgl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\t};\n};\n\n\n/**\n * \tPrepares an image to use it on the canvas. Used only when GL mode is active.\n * \t!prepareImage (image: HTMLImageElement) : boolean;\n */\nCanvas.prototype.prepareImage = function (image)\n{\n\tlet gl = this.gl;\n\tif (gl == null) return false;\n\n\tlet texture = gl.createTexture();\n\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\n\tgl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA8, image.width, image.height);\n\tgl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, image.width, image.height, gl.RGBA, gl.UNSIGNED_BYTE, image);\n\n\tif (!image.filter)\n\t\timage.filter = 'NEAREST';\n\n\tif (image.filter === 'NEAREST')\n\t{\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t}\n\telse\n\t{\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\t}\n\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n\timage.glTextureId = texture;\n\timage.glTextureReady = true;\n\n\treturn true;\n};\n\n/**\n * \tConfigures the texture related to specified image to gl.REPEAT.\n * \t!setWrapRepeat (image: HTMLImageElement) : HTMLImageElement;\n */\nCanvas.prototype.setWrapRepeat = function (image)\n{\n\tlet gl = this.gl;\n\tif (gl == null || !image.glTextureReady) return image;\n\n\tgl.bindTexture(gl.TEXTURE_2D, image.glTextureId);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n\n\treturn image;\n};\n\n/**\n * \tApplies the current config to the canvas (usually called after a reset on the canvas).\n */\nCanvas.prototype.applyConfig = function ()\n{\n\tif (this.antialias == false)\n\t{\n\t\tif (this.context != null)\n\t\t\tthis.context.imageSmoothingEnabled = false;\n\n\t\tthis.elem.style.imageRendering = 'crisp-edges';\n\t}\n\telse\n\t{\n\t\tif (this.context != null)\n\t\t\tthis.context.imageSmoothingEnabled = true;\n\n\t\tthis.elem.style.imageRendering = 'auto';\n\t}\n};\n\n/**\n * \tDisposes the resources used by the canvas. The HTMLCanvasElement will also be removed from the document.\n */\nCanvas.prototype.dispose = function ()\n{\n\tif (this.elem.parentNode)\n\t\tthis.elem.parentNode.removeChild (this.elem);\n\n\tthis.matrixStack.free();\n\tthis.alphaStack.free();\n\tthis.depthFlagStack.free();\n\tthis.shaderProgramStack.free();\n\n\tthis.matr = null;\n\tthis.context = null;\n\tthis.elem = null;\n};\n\n/**\n * \tSets the default background color of the canvas. Does not cause a canvas clear.\n * \t!setBackground (color: string) : void;\n */\nCanvas.prototype.setBackground = function (color)\n{\n\tthis.elem.style.background = color;\n\tthis.backgroundColor = color;\n\n\tif (this.gl !== null)\n\t{\n\t\tif (color.length != 7)\n\t\t\tthrow new Error ('Canvas.setBackground: color parameter should be CSS-style hex-rgb with 6 digits.');\n\n\t\tlet r = parseInt(color.substr(1,2), 16) / 255.0;\n\t\tlet g = parseInt(color.substr(3,2), 16) / 255.0;\n\t\tlet b = parseInt(color.substr(5,2), 16) / 255.0;\n\n\t\tthis.gl.clearColor (r, g, b, 1.0);\n\t}\n};\n\n/**\n * \tSets the canvas size.\n * \t!resize (width: number, height: number) : Canvas;\n */\nCanvas.prototype.resize = function (width, height)\n{\n\tlet rect = this.elem.getBoundingClientRect();\n\n\tif (!width) width = rect.width;\n\tif (!height) height = rect.height;\n\n\tthis.elem.width = width;\n\tthis.elem.height = height;\n\n\tthis.width = this.elem.width;\n\tthis.height = this.elem.height;\n\n\tthis._width = int(this.width / this._globalScale);\n\tthis._height = int(this.height / this._globalScale);\n\n\tlet gl = this.gl;\n\tif (gl != null)\n\t{\n\t\tgl.enable (gl.SCISSOR_TEST);\n\t\tgl.scissor (0, 0, this.width, this.height);\n\t\tgl.viewport (0, 0, this.width, this.height);\n\n\t\tif (this.v_resolution)\n\t\t{\n\t\t\t//violet:hardware scaling\n\t\t\t//this.v_resolution[0] = this._width;\n\t\t\t//this.v_resolution[1] = this._height;\n\n\t\t\tthis.v_resolution[0] = this.width;\n\t\t\tthis.v_resolution[1] = this.height;\n\t\t}\n\t}\n\n\tthis.applyConfig();\n\treturn this;\n};\n\n/**\n * \tSets the global canvas scale.\n * \t!globalScale (value: number) : Canvas;\n */\nCanvas.prototype.globalScale = function (value)\n{\n\tthis._globalScale = value;\n\n\tthis._width = int(this.width / this._globalScale);\n\tthis._height = int(this.height / this._globalScale);\n\n\tthis.loadIdentity();\n\n\t//violet:hardware scaling\n\t//if (this.gl === null)\n\t\tthis.scale(value, value);\n\n\treturn this;\n};\n\n/**\n * \tSets the flipped status of the canvas, that is, if the canvas coordinates are flipped (i.e. `xy` is now `yx`).\n * \t!flipped (value: boolean) : Canvas;\n */\nCanvas.prototype.flipped = function (value)\n{\n\tif (value)\n\t{\n\t\tthis._width = int(this.height / this._globalScale);\n\t\tthis._height = int(this.width / this._globalScale);\n\t}\n\telse\n\t{\n\t\tthis._width = int(this.width / this._globalScale);\n\t\tthis._height = int(this.height / this._globalScale);\n\t}\n\n\tthis.isFlipped = value;\n\treturn this;\n};\n\n/**\n * \tSaves the clip state of the canvas. Works only in GL mode.\n * \t!pushClip() : Canvas;\n */\nCanvas.prototype.pushClip = function ()\n{\n\treturn this;\n};\n\n/**\n * \tRestores the clip state of the canvas. Works only in GL mode.\n * \t!popClip() : Canvas;\n */\nCanvas.prototype.popClip = function ()\n{\n\tif (this.gl != null)\n\t\tthis.gl.scissor(0, 0, this.width, this.height);\n\n\treturn this;\n};\n\n/**\n * \tReturns the image on the canvas as a string in DATA-URI format.\n * \t!toDataUrl (mime: string, params?: object) : string;\n */\nCanvas.prototype.toDataUrl = function (mime='image/png', params=null)\n{\n\treturn this.elem.toDataURL (mime, params);\n};\n\n/**\n * \tReturns the image as a Base-64 encoded PNG string.\n * \t!toPngBase64() : string;\n */\nCanvas.prototype.toPngBase64 = function ()\n{\n\treturn this.elem.toDataURL(\"image/png\").substr(22);\n};\n\n/**\n * \tSets or returns an attribute of the canvas context.\n */\nCanvas.prototype._contextAttribute = function (name, value=null)\n{\n\tif (!this.context) return;\n\n\tif (value !== null)\n\t{\n\t\tthis.context[name] = value;\n\t\treturn this;\n\t}\n\n\treturn this.context[name];\n};\n\n/**\n * \tSets the fill style.\n * \t!fillStyle (value: string) : Canvas;\n */\n/**\n * \tReturns the current fill style.\n * \t!fillStyle () : string;\n */\nCanvas.prototype.fillStyle = function (value)\n{\n\treturn this._contextAttribute (\"fillStyle\", value);\n};\n\n/**\n * \tSets the stroke style.\n * \t!strokeStyle (value: string) : Canvas;\n */\n/**\n * \tReturns the current strroke style.\n * \t!strokeStyle () : string;\n */\nCanvas.prototype.strokeStyle = function (value)\n{\n\treturn this._contextAttribute (\"strokeStyle\", value);\n};\n\n/**\n * \tSets the line cap style (Possible values are `butt`, `round`, or `square`. `butt` is default).\n * \t!lineCap (value: string) : Canvas;\n */\n/**\n * \tReturns the current line cap style.\n * \t!lineCap() : string;\n */\nCanvas.prototype.lineCap = function (value)\n{\n\treturn this._contextAttribute (\"lineCap\", value);\n};\n\n// violet\n\n/*\n**\tSets or returns the current line join style (bevel, round, miter. miter is default).\n**\n**\t>> Canvas lineJoin (string value);\n**\t>> string lineJoin ();\n*/\n\nCanvas.prototype.lineJoin = function (value)\n{\n\treturn this._contextAttribute (\"lineJoin\", value);\n};\n\n\n/*\n**\tSets or returns the current line width value (default 1).\n**\n**\t>> Canvas lineWidth (float value);\n**\t>> float lineWidth ();\n*/\n\nCanvas.prototype.lineWidth = function (value)\n{\n\treturn this._contextAttribute (\"lineWidth\", value);\n};\n\n\n/*\n**\tSets or returns the current miter limit value (default 10).\n**\n**\t>> Canvas miterLimit (float value);\n**\t>> float miterLimit ();\n*/\n\nCanvas.prototype.miterLimit = function (value)\n{\n\treturn this._contextAttribute (\"miterLimit\", value);\n};\n\n\n/*\n**\tSets or returns the current shadow color value (default black).\n**\n**\t>> Canvas shadowColor (string value);\n**\t>> string shadowColor ();\n*/\n\nCanvas.prototype.shadowColor = function (value)\n{\n\treturn this._contextAttribute (\"shadowColor\", value);\n};\n\n\n/*\n**\tSets or returns the current shadow X offset (default 0).\n**\n**\t>> Canvas shadowOffsetX (float value);\n**\t>> float shadowOffsetX ();\n*/\n\nCanvas.prototype.shadowOffsetX = function (value)\n{\n\treturn this._contextAttribute (\"shadowOffsetX\", value);\n};\n\n\n/*\n**\tSets or returns the current shadow Y offset (default 0).\n**\n**\t>> Canvas shadowOffsetY (float value);\n**\t>> float shadowOffsetY ();\n*/\n\nCanvas.prototype.shadowOffsetY = function (value)\n{\n\treturn this._contextAttribute (\"shadowOffsetY\", value);\n};\n\n\n/*\n**\tSets or returns the current shadow blue value (default 0).\n**\n**\t>> Canvas shadowBlur (string value);\n**\t>> string shadowBlur ();\n*/\n\nCanvas.prototype.shadowBlur = function (value)\n{\n\treturn this._contextAttribute (\"shadowBlur\", value);\n};\n\n\n/*\n**\tSets or returns the current font settings.\n**\n**\t>> Canvas font (string value);\n**\t>> string font ();\n*/\n\nCanvas.prototype.font = function (value)\n{\n\treturn this._contextAttribute (\"font\", value);\n};\n\n\n/*\n**\tSets or returns the current text align settings (start, end, left, right, center).\n**\n**\t>> Canvas textAlign (string value);\n**\t>> string textAlign ();\n*/\n\nCanvas.prototype.textAlign = function (value)\n{\n\treturn this._contextAttribute (\"textAlign\", value);\n};\n\n\n/*\n**\tSets or returns the current text base line settings (alphabetic, bottom, hanging, ideographic, middle, top. Alphabetic is default).\n**\n**\t>> Canvas textBaseline (string value);\n**\t>> string textBaseline ();\n*/\n\nCanvas.prototype.textBaseline = function (value)\n{\n\treturn this._contextAttribute (\"textBaseline\", value);\n};\n\n\n/*\n**\tSets or returns the current global alpha value.\n**\n**\t>> Canvas globalAlpha (float value);\n**\t>> float globalAlpha ();\n*/\n\nCanvas.prototype.globalAlpha = function (value=null)\n{\n\tif (value !== null)\n\t\tthis._alpha = value;\n\telse\n\t\treturn this._alpha;\n\n\treturn this.alpha(1.0);\n};\n\n\n/*\n**\tSets or returns the current global composite operation value (source-atop, source-in, source-out, source-over, destination-atop,\n**\tdestination-in, destination-out, destination-over, lighter, copy, xor).\n**\n**\t>> Canvas globalCompositeOperation (string value);\n**\t>> string globalCompositeOperation ();\n*/\nCanvas.prototype.globalCompositeOperation = function (value)\n{\n\treturn this._contextAttribute (\"globalCompositeOperation\", value);\n};\n\n/*\n**\tUpdates the underlying canvas or gl transformation matrix. \n**\n**\tCanvas updateTransform();\n*/\nCanvas.prototype.updateTransform = function()\n{\n\tthis.setTransform (this.matr.data[0], this.matr.data[1], this.matr.data[3], this.matr.data[4], this.matr.data[6], this.matr.data[7]);\n\treturn this;\n};\n\n/*\n**\tSets the canvas or gl transformation matrix to the given one.\n**\n**\tCanvas setTransform (float a, float b, float c, float d, float e, float f)\n*/\nCanvas.prototype.setTransform = function (a, b, c, d, e, f)\n{\n\tif (this.context === null)\n\t{\n\t\tthis.transform.data[0] = a;\n\t\tthis.transform.data[1] = b;\n\t\tthis.transform.data[2] = 0;\n\t\tthis.transform.data[3] = c;\n\t\tthis.transform.data[4] = d;\n\t\tthis.transform.data[5] = 0;\n\t\tthis.transform.data[6] = int(e);//Math.ceil(e);\n\t\tthis.transform.data[7] = int(f);//Math.ceil(f);\n\t\tthis.transform.data[8] = 1;\n\n\t\treturn this;\n\t}\n\n\t//this.context.setTransform (a, b, c, d, Math.ceil(e), Math.ceil(f));\n\tthis.context.setTransform (a, b, c, d, int(e), int(f));\n\treturn this;\n};\n\n/*\n**\tDraws a filled rectangle on the canvas.\n**\n**\tCanvas fillRect (float x, float y, float w, float h)\n*/\nCanvas.prototype.fillRect = function (x, y, w, h)\n{\n\tthis.context.fillRect (x, y, w, h);\n\treturn this;\n};\n\n/*\n**\tDraws an stroked rectangle on the canvas.\n**\n**\tCanvas strokeRect (float x, float y, float w, float h)\n*/\nCanvas.prototype.strokeRect = function (x, y, w, h)\n{\n\tthis.context.strokeRect (x, y, w, h);\n\treturn this;\n};\n\n/*\n**\tClears a rectangle on the canvas. All pixels will be erased.\n**\n**\tCanvas clearRect (float x, float y, float w, float h)\n*/\nCanvas.prototype.clearRect = function (x, y, w, h)\n{\n\tthis.context.clearRect (x, y, w, h);\n\treturn this;\n};\n\n/*\n**\tStarts a new path. Any previous path points will be cleared.\n**\n**\tCanvas beginPath()\n*/\nCanvas.prototype.beginPath = function ()\n{\n\tthis.context.beginPath ();\n\treturn this;\n};\n\n/*\n**\tCreates a new point in the current path.\n**\n**\tCanvas moveTo (float x, float y)\n*/\nCanvas.prototype.moveTo = function (x, y)\n{\n\tthis.context.moveTo (x, y);\n\treturn this;\n};\n\n/*\n**\tCreates a new point from the first path point to the last, and finishes the path.\n**\n**\tCanvas closePath()\n*/\nCanvas.prototype.closePath = function ()\n{\n\tthis.context.closePath ();\n\treturn this;\n};\n\n/*\n**\tDraws a line from the last point on the path to the given point.\n**\n**\tCanvas lineTo (float x, float y)\n*/\nCanvas.prototype.lineTo = function (x, y)\n{\n\tthis.context.lineTo (x, y);\n\treturn this;\n};\n\n/*\n**\tCreates a hollow rectangle path on the canvas for subsequent stroke or fill.\n**\n**\tCanvas rect (float x, float y, float w, float h)\n*/\nCanvas.prototype.rect = function (x, y, w, h)\n{\n\tthis.context.rect (x, y, w, h);\n\treturn this;\n};\n\n/*\n**\tFills the active path with the current fill style or with the one given in the value parameter.\n**\n**\tCanvas fill (string value=null)\n*/\nCanvas.prototype.fill = function (value=null)\n{\n\tif (value) this.fillStyle (value);\n\tthis.context.fill ();\n\treturn this;\n};\n\n/*\n**\tStrokes the active path with the current stroke style or with the one given in the value parameter.\n**\n**\tCanvas stroke (string value=null)\n*/\nCanvas.prototype.stroke = function (value=null)\n{\n\tif (value) this.strokeStyle (value);\n\tthis.context.stroke ();\n\treturn this;\n};\n\n/*\n**\tClips a region of the canvas so that only the region will be used for drawing. Coordinates must be in logical screen space.\n**\n**\tCanvas clip()\n*/\nCanvas.prototype.clip = function (x, y, width, height)\n{\n\tif (this.gl !== null)\n\t{\n\t\tx *= this._globalScale;\n\t\ty *= this._globalScale;\n\t\twidth *= this._globalScale;\n\t\theight *= this._globalScale;\n\n\t\tif (this.isFlipped)\n\t\t\tthis.gl.scissor(this.width-y-height-1, this.height-x-width-1, height, width);\n\t\telse\n\t\t\tthis.gl.scissor(x, this.height-y-height-1, width, height);\n\t}\n\n\treturn this;\n};\n\n/*\n**\tAdds points of a quadratic curve to the active path. A control points and one reference point must be provided.\n**\n**\tCanvas quadraticCurveTo (float cpx, float cpy, float x, float y)\n*/\nCanvas.prototype.quadraticCurveTo = function (cpx, cpy, x, y)\n{\n\tthis.context.quadraticCurveTo (cpx, cpy, x, y);\n\treturn this;\n};\n\n/*\n**\tAdds points of a bezier curve to the active path. Two control points and one reference point must be provided.\n**\n**\tCanvas bezierCurveTo (float cx1, float cy1, float cx2, float cy2, float x, float y)\n*/\nCanvas.prototype.bezierCurveTo = function (cx1, cy1, cx2, cy2, x, y)\n{\n\tthis.context.bezierCurveTo (cx1, cy1, cx2, cy2, x, y);\n\treturn this;\n};\n\n/*\n**\tAdds points of an arc the the active path. Used to draw a circle of part of it.\n**\n**\tCanvas arc (float x, float y, float r, float sA, float eA, float cw)\n*/\nCanvas.prototype.arc = function (x, y, r, sA, eA, cw)\n{\n\tthis.context.arc (x, y, r, sA, eA, cw);\n\treturn this;\n};\n\n/*\n**\tAdds points of an arc to the active path. Used to create an arc between two points.\n**\n**\tCanvas arcTo (float x1, float y1, float x2, float y2, float r)\n*/\nCanvas.prototype.arcTo = function (x1, y1, x2, y2, r)\n{\n\tthis.context.arcTo (x1, y1, x2, y2, r);\n\treturn this;\n};\n\n/*\n**\tDraws filled text on the canvas with the active font, and fillStyle properties.\n**\n**\tCanvas fillText (string text, float x, float y, float maxWidth=1000)\n*/\nCanvas.prototype.fillText = function (text, x, y, maxWidth=1000)\n{\n\tthis.context.fillText (text, x, y, maxWidth);\n\treturn this;\n};\n\n/*\n**\tDraws stroked text on the canvas with the active font, and fillStyle properties.\n**\n**\tCanvas strokeText (string text, float x, float y, float maxWidth=1000)\n*/\nCanvas.prototype.strokeText = function (text, x, y, maxWidth=1000)\n{\n\tthis.context.strokeText (text, x, y, maxWidth);\n\treturn this;\n};\n\n\n/*\n**\tMeasures the width of the given text using active font properties.\n**\n**\tfloat measureText (string text)\n*/\nCanvas.prototype.measureText = function (text)\n{\n\treturn this.context.measureText(text).width;\n};\n\n\n/*\n**\tReturns a new image data object with the specified size.\n**\n**\tImageData createImageData (float w, float h)\n*/\nCanvas.prototype.createImageData = function (w, h)\n{\n\treturn this.context.createImageData (w, h);\n};\n\n\n/*\n**\tReturns an image data object with the pixels of a rectangular area of the canvas.\n**\n**\tImageData getImageData (float x, float y, float w, float h)\n*/\nCanvas.prototype.getImageData = function (x, y, w, h)\n{\n\treturn this.context.getImageData (x, y, w, h);\n};\n\n\n/*\n**\tPuts image data on the canvas at the specified location.\n**\n**\tCanvas putImageData (ImageData data, float x, float y)\n*/\nCanvas.prototype.putImageData = function (data, x, y)\n{\n\tthis.context.putImageData (data, x, y);\n\treturn this;\n};\n\n\n/*\n**\tDraws an image on the canvas.\n**\n**\tCanvas drawImage (Image img, float x, float y)\n**\tCanvas drawImage (Image img, float x, float y, float w, float h)\n**\tCanvas drawImage (Image img, float sx, float sy, float sw, float sh, float dx, float dy, float dw, float dh)\n*/\nCanvas.prototype.drawImage = function (img, sx=0, sy=0, sw=null, sh=null, dx=null, dy=null, dw=null, dh=null)\n{\n\tif (sw === null)\n\t{\n\t\tthis.context.drawImage (img, int(sx), int(sy));\n\t}\n\telse if (dx === null)\n\t{\n\t\tthis.context.drawImage (img, int(sx), int(sy), int(sw), int(sh));\n\t}\n\telse\n\t{\n\t\tlet a3 = int(sw);\n\t\tlet a4 = int(sh);\n\t\tif (!a3 || !a4) return this;\n\n\t\tlet a7 = int(dw);\n\t\tlet a8 = int(dh);\n\t\tif (!a7 || !a8) return this;\n\n\t\tthis.context.drawImage (img, int(sx), int(sy), a3, a4, int(dx), int(dy), a7, a8);\n\t}\n\n\treturn this;\n};\n\n\n/*\n**\tClears the entire canvas. If the backgroundColor parameter is set the canvas will be cleared manually by using\n**\tthe fillRect method.\n**\n**\tCanvas clear (string backgroundColor)\n**\tCanvas clear ()\n*/\n\nCanvas.prototype.clear = function (backgroundColor=null)\n{\n\tif (this.gl != null)\n\t{\n\t\tthis.gl.clear(this.gl.STENCIL_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT | this.gl.COLOR_BUFFER_BIT);\n\t\tthis.glActiveTextureId = null;\n\n\t\treturn this;\n\t}\n\n\tif (backgroundColor)\n\t{\n\t\tthis.globalCompositeOperation(\"source-over\").globalAlpha(1.0).fillStyle(backgroundColor !== true ? backgroundColor : this.backgroundColor).fillRect(0, 0, this._width, this._height);\n\t}\n\telse\n\t{\n\t\tthis.elem.width = this.width;\n\t\tthis.applyConfig();\n\t}\n\n\tthis.updateTransform();\n\treturn this;\n};\n\n\n/*\n**\tIndicates that rendering is about to start. Used only in GL mode.\n*/\nCanvas.prototype.start = function ()\n{\n};\n\n/*\n**\tIndicates that rendering has ended. Used only in GL mode.\n*/\nCanvas.prototype.end = function ()\n{\n};\n\n/*\n**\tIndicates that rendering has been completed and any flush operation should be executed. Used only in GL mode.\n*/\nCanvas.prototype.flush = function ()\n{\n\tlet gl = this.gl;\n\tif (gl === null) return;\n\n\tgl.colorMask (false, false, false, true);\n\tgl.clear (gl.COLOR_BUFFER_BIT);\n\tgl.colorMask (true, true, true, true);\n\n\t// VIOLET: Add gl.flush() if not using RAF.\n};\n\n/**\n *\tBlits the specified texture to the active framebuffer.\n */\nCanvas.prototype.blit = function (texture, width, height, shaderProgram=null)\n{\n\tlet gl = this.gl;\n\tif (gl === null) return;\n\n\tshaderProgram = shaderProgram || this.glBlitProgram;\n\n\tthis.setShaderProgram(shaderProgram);\n\tgl.disable (gl.DEPTH_TEST);\n\n\t\tgl.activeTexture (gl.TEXTURE0);\n\t\tgl.bindTexture (gl.TEXTURE_2D, texture);\n\t\tgl.uniform1i (shaderProgram.uniform_texture_0, 0);\n\n\t\tgl.uniform2fv (shaderProgram.uniform_resolution, this.v_resolution);\n\t\tgl.uniform1f (shaderProgram.uniform_time, globals.time);\n\t\tgl.uniform1f (shaderProgram.uniform_scale, this._globalScale);\n\t\tgl.uniform1f (shaderProgram.uniform_alpha, this._alpha);\n\n\t\tthis.v_texture_size[0] = width;\n\t\tthis.v_texture_size[1] = height;\n\t\tgl.uniform2fv (shaderProgram.uniform_texture_size, this.v_texture_size);\n\n\t\tthis.m_location[0] = this.width;\n\t\tthis.m_location[4] = this.height;\n\t\tthis.m_location[6] = 0;\n\t\tthis.m_location[7] = 0;\n\n\t\tthis.m_texture[0] = this.width;\n\t\tthis.m_texture[4] = this.height;\n\t\tthis.m_texture[6] = 0;\n\t\tthis.m_texture[7] = 0;\n\n\t\tgl.uniformMatrix3fv (shaderProgram.uniform_location_matrix, false, this.m_location);\n\t\tgl.uniformMatrix3fv (shaderProgram.uniform_texture_matrix, false, this.m_texture);\n\t\tgl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\n\tthis.setShaderProgram(this.glDefaultProgram);\n\tgl.enable (gl.DEPTH_TEST);\n};\n\n/*\n**\tResets the context drawing properties to their initial values.\n**\n**\tCanvas reset (bool clearPath=false);\n*/\nCanvas.prototype.reset = function (clearPath=false)\n{\n\tthis.fillStyle(\"#000000\").strokeStyle(\"#000000\").lineCap(\"butt\").lineJoin(\"miter\")\n\t.lineWidth(\"1\").miterLimit(\"10\").shadowColor(\"#000000\").shadowOffsetX(\"0\")\n\t.shadowOffsetY(\"0\").shadowBlur(\"0\").globalAlpha(\"1.0\").globalCompositeOperation(\"source-over\");\n\n\tif (clearPath) this.beginPath().closePath();\n\n\treturn this;\n};\n\n/*\n**\tPushes the current transformation matrix into the matrix stack.\n*/\nCanvas.prototype.pushMatrix = function ()\n{\n\tthis.matrixStack.push(this.matr);\n\tthis.matr = this.matr.clone();\n\n\treturn this;\n};\n\n/*\n**\tPops a matrix from the matrix stack into the transformation matrix.\n*/\nCanvas.prototype.popMatrix = function ()\n{\n\tthis.matr.free();\n\tthis.matr = this.matrixStack.pop();\n\n\treturn this.updateTransform();\n};\n\n/*\n**\tSets or returns the relative alpha value for subsequent drawing operations.\n**\n**\t>> Canvas alpha (float value);\n**\t>> float alpha ();\n*/\n\nCanvas.prototype.alpha = function (value)\n{\n\tthis._alpha *= value;\n\n\tif (this.context && this.gl === null)\n\t\tthis.context.globalAlpha = this._alpha;\n\n\treturn this;\n};\n\n/*\n**\tPushes the current global alpha into the stack.\n*/\nCanvas.prototype.pushAlpha = function ()\n{\n\tthis.alphaStack.push (this.globalAlpha());\n\treturn this;\n};\n\n/*\n**\tPops an alpha from the stack into the global alpha.\n**\n**\t>> Canvas popAlpha();\n*/\nCanvas.prototype.popAlpha = function ()\n{\n\tthis.globalAlpha(this.alphaStack.pop());\n\treturn this;\n};\n\n/*\n**\tSets the depth-test flag.\n*/\nCanvas.prototype.setDepthFlag = function (value)\n{\n\tlet gl = this.gl;\n\tif (gl === null) return;\n\n\tif (value)\n\t{\n\t\tgl.enable (gl.DEPTH_TEST);\n\t\tthis._depthFlag = true;\n\t}\n\telse\n\t{\n\t\tgl.disable (gl.DEPTH_TEST);\n\t\tthis._depthFlag = false;\n\t}\n};\n\n/*\n**\tReturns the depth-test flag.\n*/\nCanvas.prototype.getDepthFlag = function ()\n{\n\treturn this._depthFlag;\n};\n\n/*\n**\tPushes the current depth-test flag into the depth flag stack. If a value is provided, the current flag will be pushed and set to the\n**\tgiven value only if they're different, when so, true will be returned.\n*/\nCanvas.prototype.pushDepthFlag = function (value=null)\n{\n\tif (value !== null)\n\t{\n\t\tvalue = !!value;\n\n\t\tif (value === this._depthFlag)\n\t\t\treturn false;\n\n\t\tthis.depthFlagStack.push(this._depthFlag);\n\t\tthis.setDepthFlag(value);\n\n\t\treturn true;\n\t}\n\n\tthis.depthFlagStack.push(this._depthFlag);\n};\n\n/*\n**\tPops the depth-test flag from the depth flag stack.\n*/\nCanvas.prototype.popDepthFlag = function ()\n{\n\tthis.setDepthFlag(this.depthFlagStack.pop());\n};\n\n/*\n**\tSets the active shader program.\n*/\nCanvas.prototype.setShaderProgram = function (program)\n{\n\tlet gl = this.gl;\n\tif (gl === null) return;\n\n\tthis.shaderProgram = program;\n\tthis.shaderProgram.use();\n};\n\n/*\n**\tReturns the current shader program.\n*/\nCanvas.prototype.getShaderProgram = function ()\n{\n\treturn this.shaderProgram;\n};\n\n/*\n**\tPushes the current shader program into the stack. If a value is provided, the current shader program will be pushed and set to the\n**\tgiven one only if they're different, when so, true will be returned.\n*/\nCanvas.prototype.pushShaderProgram = function (program=null)\n{\n\tif (program !== null)\n\t{\n\t\tif (program === this.shaderProgram)\n\t\t\treturn false;\n\n\t\tthis.shaderProgramStack.push(this.shaderProgram);\n\t\tthis.setShaderProgram(program);\n\n\t\treturn true;\n\t}\n\n\tthis.shaderProgramStack.push(this.shaderProgram);\n};\n\n/*\n**\tPops the shader program from the stack.\n*/\nCanvas.prototype.popShaderProgram = function ()\n{\n\tthis.setShaderProgram(this.shaderProgramStack.pop());\n};\n\n\n/*\n**\tSets the transformation matrix to identity.\n**\n**\t>> Canvas loadIdentity();\n*/\n\nCanvas.prototype.loadIdentity = function ()\n{\n\tthis.matr.identity();\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tSets the transformation matrix to the specified one.\n**\n**\t>> Canvas loadMatrix (Matrix matr);\n*/\n\nCanvas.prototype.loadMatrix = function (matr)\n{\n\tthis.matr.set(matr);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tReturns the current transformation matrix, when `clone` is set to true, a cloned matrix will be returned.\n**\n**\t>> Matrix getMatrix(bool clone=false);\n*/\n\nCanvas.prototype.getMatrix = function (clone=false)\n{\n\treturn clone ? this.matr.clone() : this.matr;\n};\n\n\n/*\n**\tAppends a matrix to the current transformation matrix.\n**\n**\t>> Canvas appendMatrix (Matrix matr);\n*/\n\nCanvas.prototype.appendMatrix = function (matr)\n{\n\tthis.matr.append(matr);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tSets scaling factors for subsequent drawing operations. If the useNative is not set then scale with the current\n**\ttransformation matrix will be performed.\n**\n**\t>> Canvas scale (float sx, float sy, bool useNative=false);\n*/\n\nCanvas.prototype.scale = function (sx, sy, useNative)\n{\n\tif (useNative) {\n\t\tthis.context.scale (sx, sy);\n\t\treturn this;\n\t}\n\n\tthis.matr.scale (sx, sy);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tSets rotation factor for subsequent drawing operations. The angle is in radians. If useNative is not set\n**\tthen rotation with the transformation matrix will be used.\n**\n**\t>> Canvas rotate (float angle, bool useNative=false);\n*/\n\nCanvas.prototype.rotate = function (angle, useNative)\n{\n\tif (useNative) {\n\t\tthis.context.rotate (angle);\n\t\treturn this;\n\t}\n\n\tthis.matr.rotate(angle);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tMoves starting point to an specified location. If the useNative parameter is not set then translation with\n**\tthe transformation matrix will be done.\n**\n**\t>> Canvas translate (float x, float y, bool useNative=false);\n*/\n\nCanvas.prototype.translate = function (x, y, useNative)\n{\n\tif (useNative) {\n\t\tthis.context.translate(x, y);\n\t\treturn this;\n\t}\n\n\tthis.matr.translate(x, y);\n\treturn this.updateTransform();\n};\n\n\n/*\n**\tCreates a hollow ellipse path on the canvas for subsequent stroke or fill.\n**\n**\t>> Canvas ellipse (float x, float y, float w, float h);\n*/\n\nCanvas.prototype.ellipse = function (x, y, w, h)\n{\n\tvar ox = (w/2)*.5522848, oy = (h/2)*.5522848;\n\tvar xe = x+w-1, ye = y+h-1, xm = x+w/2, ym = y+h/2;\n\n\tthis.beginPath ().moveTo(x, ym);\n\tthis.bezierCurveTo (x, ym - oy, xm - ox, y, xm, y);\n\tthis.bezierCurveTo (xm + ox, y, xe, ym - oy, xe, ym);\n\tthis.bezierCurveTo (xe, ym + oy, xm + ox, ye, xm, ye);\n\tthis.bezierCurveTo (xm - ox, ye, x, ym + oy, x, ym);\n\tthis.closePath ();\n\n\treturn this;\n};\n\n\n/*\n**\tCreates a hollow circle path on the canvas for subsequent stroke or fill. If the stroke param is set the circle\n**\twill be drawn with the specified stroke color.\n**\n**\t>> Canvas circle (float x, float y, float r, string strokeColor);\n**\t>> Canvas circle (float x, float y, float r);\n*/\n\nCanvas.prototype.circle = function (x, y, r, stroke)\n{\n\tthis.beginPath();\n\tthis.arc(x, y, r, 0, 2*Math.PI);\n\tthis.closePath();\n\n\tif (stroke) this.stroke(stroke);\n\n\treturn this;\n};\n\n\n/*\n**\tDraws a line for subsequent stroke or fill. If the stroke param is set the line will be drawn with\n**\tthe specified stroke color.\n**\n**\t>> Canvas line (float x1, float y1, float x2, float y2, string strokeColor);\n**\t>> Canvas line (float x1, float y1, float x2, float y2);\n*/\n\nCanvas.prototype.line = function (x1, y1, x2, y2, stroke)\n{\n\tthis.beginPath();\n\tthis.moveTo(x1, y1);\n\tthis.lineTo(x2, y2);\n\tthis.closePath();\n\n\tif (stroke) this.stroke(stroke);\n\treturn this;\n};\n\n\n/*\n**\tAttaches internal listeners for mouse/pointer events on the canvas object, this is called automatically when\n**\tattaching handlers to the canvas. The actual handlers are added or removed using the addPointerHandler and\n**\tremovePointerHandler respectively.\n**\n**\t>> Canvas enablePointerEvents();\n*/\n\nCanvas.prototype.enablePointerEvents = function()\n{\n\tif (this.pointerHandler) return this;\n\n\tthis.pointerScale = { sx: 1, sy: 1 };\n\tthis.pointerOffset = { x: 0, y: 0 };\n\n\tvar _ = this;\n\n\tvar _evt =\n\t{\n\t\taction: '',\n\t\tbuttons: 0, lbuttons: 0,\n\t\tx: 0, y: 0,\n\n\t\tcontainedBy: function (x, y, w, h) {\n\t\t\treturn this.x >= x && this.x <= (x+w-1) && this.y >= y && this.y <= (y+h-1);\n\t\t}\n\t};\n\n\tthis.pointerHandlers = [];\n\n\tthis.pointerHandler = function (code, evt)\n\t{\n\t\tvar rect = this.elem.getBoundingClientRect();\n\n\t\t_evt.action = code;\n\t\t_evt.buttons = evt.buttons;\n\t\t_evt.x = _evt.rx = int(evt.clientX - rect.left);\n\t\t_evt.y = _evt.ry = int(evt.clientY - rect.top);\n\n\t\t_evt.x = ((_evt.x - _.pointerOffset.x) - 0.0*_.pointerScale.sx) / _.pointerScale.sx;\n\t\t_evt.y = ((_evt.y - _.pointerOffset.y) - 0.0*_.pointerScale.sy) / _.pointerScale.sy;\n\n\t\t_evt.dragging = false;\n\n\t\tif (_evt.buttons && !_evt.lbuttons)\n\t\t{\n\t\t\t_evt.sx = _evt.x;\n\t\t\t_evt.sy = _evt.y;\n\n\t\t\t_evt.ldx = _evt.ldy = 0;\n\t\t}\n\n\t\tif (_evt.buttons && _evt.lbuttons)\n\t\t{\n\t\t\t_evt.dragging = true;\n\n\t\t\t_evt.dx = _evt.x - _evt.sx;\n\t\t\t_evt.dy = _evt.y - _evt.sy;\n\t\t\t\n\t\t\t_evt.ddx = _evt.dx - _evt.ldx;\n\t\t\t_evt.ddy = _evt.dy - _evt.ldy;\n\n\t\t\t_evt.ldx = _evt.dx;\n\t\t\t_evt.ldy = _evt.dy;\n\t\t}\n\n\t\t_evt.lbuttons = _evt.buttons;\n\n\t\tfor (var i = 0; i < this.pointerHandlers.length; i++)\n\t\t{\n\t\t\tif (this.pointerHandlers[i][1] (_evt, this.pointerHandlers[i][2]) === false)\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tthis.elem.onmousedown = function(evt) {  _.pointerHandler('DOWN', evt); };\n\tthis.elem.onmouseup = function(evt) { _.pointerHandler('UP', evt); };\n\tthis.elem.onmousemove = function(evt) { _.pointerHandler('MOVE', evt); };\n\n\treturn this;\n};\n\n\n/*\n**\tSets the pointer scaling factors.\n**\n**\t>> Canvas setPointerScale (float sx, float sy);\n*/\n\nCanvas.prototype.setPointerScale = function (sx, sy)\n{\n\tthis.pointerScale = { sx: sx, sy: sy };\n\treturn this;\n};\n\n\n/*\n**\tSets the pointer offset that is applied after scaling.\n**\n**\t>> Canvas setPointerOffset (float x, float y);\n*/\n\nCanvas.prototype.setPointerOffset = function (x, y)\n{\n\tthis.pointerOffset = { x: x, y: y };\n\treturn this;\n};\n\n\n/*\n**\tAdds a pointer event handler, returns the handler reference id for later removal.\n**\n**\t>> string addPointerHandler (function callback, object context);\n**\t>> string addPointerHandler (function callback);\n*/\n\nCanvas.prototype.addPointerHandler = function (callback, context)\n{\n\tthis.enablePointerEvents();\n\n\tthis.pointerHandlers.push ([this.pointerHandlers.length+\"_\"+int(Math.random()*1e6), callback, context]);\n\n\treturn this.pointerHandlers[this.pointerHandlers.length-1][0];\n};\n\n\n/*\n**\tRemoves a previously attached pointer event handler.\n**\n**\t>> void removePointerHandler (string id);\n*/\n\nCanvas.prototype.removePointerHandler = function (id)\n{\n\tif (!this.pointerHandlers) return;\n\n\tfor (var i = 0; i < this.pointerHandlers.length; i++)\n\t{\n\t\tif (this.pointerHandlers[i][0] == id)\n\t\t{\n\t\t\tthis.pointerHandlers.splice(i, 1);\n\t\t\tbreak;\n\t\t}\n\t}\n};\n\n/**\n * \tExecutes the `draw` function on a new canvas of the specified width and height. Renders it into an image and runs the completed callback with the ready HTMLImageElement object.\n * \t!static renderImage (width: number, height: number, filter: 'NEAREST'|'LINEAR', draw: (g: Canvas) => void, completed: (img: HTMLImageElement) => void) : void;\n */\nCanvas.renderImage = function (width, height, draw, completed)\n{\n\tlet g = new Canvas({ width: width, height: height });\n\n\tdraw(g);\n\n\tlet img = new Image();\n\timg.onload = () => {\n\t\t//Violet: set other image properties.\n\t\timg.filter = 'NEAREST';\n\t\timg.rscale = 1.0;\n\t\tSystem.renderer.prepareImage(img);\n\t\tcompleted(img);\n\t};\n\n\timg.src = g.toDataUrl();\n\tg.dispose();\n};\n\nexport default Canvas;\n","/*\n**\tmath/matrix.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Recycler from '../utils/recycler.js';\nimport Vec2 from './vec2.js';\n\n//![import \"../utils/recycler\"]\n//![import \"./vec2\"]\n\nconst temp = new Float32Array(9).fill(0);\nconst temp2 = new Float32Array(9).fill(0);\n\n//:/**\n//: * \tRepresents a 3x3 matrix. Provides an interface to manipulate 3x3 matrices.\n//: */\n\n//!class Matrix\n\nconst Matrix = Class.extend\n({\n\tclassName: 'Matrix',\n\n\t/**\n\t * \tActual elements of the matrix.\n\t * \t!data: Float32Array\n\t */\n\tdata: null,\n\n\t/**\n\t * \tConstructs a new matrix copying the elements from the specified matrix.\n\t * \t!constructor(value: Matrix);\n\t */\n\t/**\n\t * \tConstructs a new matrix with the values from the specified array.\n\t * \t!constructor(value: Float32Array);\n\t */\n\t/**\n\t * \tConstructs a new matrix with the identity matrix values.\n\t * \t!constructor();\n\t */\n\t__ctor: function(value=null)\n\t{\n\t\tif (this.data === null)\n\t\t\tthis.data = new Float32Array(9);\n\n\t\tif (value !== null)\n\t\t\tthis.set(value);\n\t\telse\n\t\t\tthis.identity();\n\t},\n\n\t/**\n\t * \tFills the matrix with zeroes.\n\t * \t!zero() : Matrix;\n\t */\n\tzero: function()\n\t{\n\t\tthis.data.fill(0);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tFills the matrix with the specified value.\n\t * \t!fill (value: number) : Matrix;\n\t */\n\tfill: function (value)\n\t{\n\t\tthis.data.fill(value);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCopies the specified matrix elements into the current one.\n\t * \t!set (value: Matrix) : Matrix;\n\t */\n\t/**\n\t * \tSets the matrix elements from the specified array.\n\t * \t!set (value: Float32Array) : Matrix;\n\t */\n\tset: function (value)\n\t{\n\t\tif (Matrix.isInstance(value))\n\t\t{\n\t\t\tfor (let i = 0; i < 9; i++) this.data[i] = value.data[i];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let i = 0; i < 9; i++) this.data[i] = value[i];\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the elements of the matrix to be the identity matrix.\n\t * \t!identity() : Matrix;\n\t */\n\tidentity: function (target=null)\n\t{\n\t\tif (target === null)\n\t\t\ttarget = this.data;\n\n\t\ttarget.fill(0);\n\t\ttarget[0] = target[4] = target[8] = 1;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMultiplies all elements in the matrix by a given scalar.\n\t * \t!scalef (scalar: number) : Matrix;\n\t */\n\tscalef: function (scalar)\n\t{\n\t\tfor (let i = 0; i < 9; i++) this.data[i] *= scalar;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns a clone of the matrix.\n\t * \t!clone() : Matrix;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Matrix.Pool.alloc(this);\n\t},\n\n\t/**\n\t * \tAppends the given matrix to the current one using matrix multiplication (self * matrix).\n\t * \t!append (matrix: Matrix) : Matrix;\n\t */\n\tappend: function (matr)\n\t{\n\t\tif (matr instanceof Matrix)\n\t\t\tmatr = matr.data;\n\n\t\tfor (let i = 0; i < 9; i++) temp[i] = this.data[i];\n\n\t\tthis.data[0] = matr[0]*temp[0] + matr[1]*temp[3] + matr[2]*temp[6];\n\t\tthis.data[1] = matr[0]*temp[1] + matr[1]*temp[4] + matr[2]*temp[7];\n\t\tthis.data[2] = matr[0]*temp[2] + matr[1]*temp[5] + matr[2]*temp[8];\n\t\tthis.data[3] = matr[3]*temp[0] + matr[4]*temp[3] + matr[5]*temp[6];\n\t\tthis.data[4] = matr[3]*temp[1] + matr[4]*temp[4] + matr[5]*temp[7];\n\t\tthis.data[5] = matr[3]*temp[2] + matr[4]*temp[5] + matr[5]*temp[8];\n\t\tthis.data[6] = matr[6]*temp[0] + matr[7]*temp[3] + matr[8]*temp[6];\n\t\tthis.data[7] = matr[6]*temp[1] + matr[7]*temp[4] + matr[8]*temp[7];\n\t\tthis.data[8] = matr[6]*temp[2] + matr[7]*temp[5] + matr[8]*temp[8];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCreates a translation matrix and appends it.\n\t * \t!translate (x: number, y: number) : Matrix;\n\t */\n\ttranslate: function (x, y)\n\t{\n\t\tif (x == 0 && y == 0)\n\t\t\treturn this;\n\n\t\tfor (let i = 0; i < 9; i++) temp[i] = this.data[i];\n\n\t\tthis.data[6] = x*temp[0] + y*temp[3] + temp[6];\n\t\tthis.data[7] = x*temp[1] + y*temp[4] + temp[7];\n\t\tthis.data[8] = x*temp[2] + y*temp[5] + temp[8];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCreates a rotation matrix for the given angle (in radians) and appends it.\n\t * \t!rotate (angle: number) : Matrix;\n\t */\n\trotate: function (angle)\n\t{\n\t\tif (angle == 0)\n\t\t\treturn this;\n\n\t\tthis.identity(temp2);\n\n\t\tlet cost = Math.cos(angle);\n\t\tlet sint = Math.sin(angle);\n\n\t\ttemp2[0] = cost;\n\t\ttemp2[1] = -sint;\n\t\ttemp2[3] = sint;\n\t\ttemp2[4] = cost;\n\n\t\treturn this.append(temp2);\n\t},\n\n\t/**\n\t * \tCreates a scaling matrix and appends it.\n\t * \t!scale (sx: number, sy: number) : Matrix;\n\t */\n\tscale: function (sx, sy)\n\t{\n\t\tif (sx == 1 && sy == 1)\n\t\t\treturn this;\n\n\t\tthis.identity(temp2);\n\n\t\ttemp2[0] = sx;\n\t\ttemp2[4] = sy;\n\n\t\treturn this.append(temp2);\n\t},\n\n\t/**\n\t * \tApplies the matrix to the specified vector (matrix-vector multiplication) and returns a new Vec2.\n\t * \t!applyTo (vect: Vec2) : Vec2;\n\t */\n\t/**\n\t * \tApplies the matrix to the specified coordinates (matrix-vector multiplication) and returns a new Vec2.\n\t * \t!applyTo (x: number, y: number) : Vec2;\n\t */\n\tapplyTo: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tconst v = x;\n\t\t\tx = v.x;\n\t\t\ty = v.y;\n\t\t}\n\n\t\tlet nx = this.data[0]*x + this.data[3]*y + this.data[6];\n\t\tlet ny = this.data[1]*x + this.data[4]*y + this.data[7];\n\n\t\treturn Vec2.Pool.alloc(nx, ny);\n\t},\n\n\t/**\n\t * \tTransposes the matrix.\n\t * \t!transpose() : Matrix;\n\t */\n\ttranspose: function ()\n\t{\n\t\ttemp.fill(0);\n\n\t\tfor (let j = 0; j < 3; j++)\n\t\tfor (let i = 0; i < 3; i++)\n\t\t\ttemp[j*3+i] = this.data[i*3+j];\n\n\t\tfor (let i = 0; i < 9; i++) this.data[i] = temp[i];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the determinant of the matrix.\n\t * \t!det() : number;\n\t */\n\tdet: function ()\n\t{\n\t\treturn\tthis.data[0] * (this.data[4]*this.data[8] - this.data[5]*this.data[7]) -\n\t\t\t\tthis.data[1] * (this.data[3]*this.data[8] - this.data[5]*this.data[6]) +\n\t\t\t\tthis.data[2] * (this.data[3]*this.data[7] - this.data[4]*this.data[6])\n\t\t\t\t;\n\t},\n\n\t/**\n\t * \tReturns a new matrix with the adjoint of the current matrix.\n\t * \t!adj() : Matrix;\n\t */\n\tadj: function () // violet:verify and fix\n\t{\n\t\t/*let t = this.transpose();\n\t\tlet d = Matrix.Pool.alloc();\n\n\t\td.data[0] = (t.data[4]*t.data[8] - t.data[5]*t.data[7]);\n\t\td.data[1] = -(t.data[3]*t.data[8] - t.data[5]*t.data[6]);\n\t\td.data[2] = (t.data[3]*t.data[7] - t.data[4]*t.data[6]);\n\n\t\td.data[3] = -(t.data[1]*t.data[8] - t.data[2]*t.data[7]);\n\t\td.data[4] = (t.data[0]*t.data[8] - t.data[2]*t.data[6]);\n\t\td.data[5] = -(t.data[0]*t.data[7] - t.data[1]*t.data[6]);\n\n\t\td.data[6] = (t.data[1]*t.data[5] - t.data[2]*t.data[4]);\n\t\td.data[7] = -(t.data[0]*t.data[5] - t.data[2]*t.data[3]);\n\t\td.data[8] = (t.data[0]*t.data[4] - t.data[1]*t.data[3]);\n\n\t\tt.data = d;\n\t\treturn t;*/\n\t\tthrow new Error('NOT IMPLEMENTED');\n\t},\n\n\t/**\n\t * \tReturns a new matrix with the inverse of the current matrix.\n\t * \t!inverse() : Matrix;\n\t */\n\tinverse: function ()\n\t{\n\t\tlet det = this.det();\n\t\tif (!det) return null;\n\n\t\treturn this.adj().scalef(1/det);\n\t},\n\n\t/**\n\t * \tReturns a string representation of the matrix.\n\t * \t!toString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn `[${this.data[0]}, ${this.data[3]}, ${this.data[6]}]\\n[${this.data[1]}, ${this.data[4]}, ${this.data[7]}]\\n[${this.data[2]}, ${this.data[5]}, ${this.data[8]}]\\n`;\n\t}\n});\n\n/**\n * \tSets the components of the specified array as the identity matrix.\n * \t!static loadIdentity (target: Float32Array) : void;\n */\nMatrix.loadIdentity = function (target)\n{\n\ttarget.fill(0);\n\ttarget[0] = target[4] = target[8] = 1;\n};\n\n//!/class\n\n//!namespace Matrix\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a new matrix copying the components from the specified matrix.\n\t * \t!function alloc (value: Matrix): Matrix;\n\t */\n\t/**\n\t * \tAllocates a new matrix with the values from the specified array.\n\t * \t!function alloc (value: Float32Array): Matrix;\n\t */\n\t/**\n\t * \tAllocates a new matrix with the identity matrix values.\n\t * \t!function alloc (): Matrix;\n\t */\n\nRecycler.createPool (Matrix, 4096, 1024);\nexport default Matrix;\n","/*\n**\tmath/vec2.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"../utils/recycler\"]\n\n//:/**\n//: * \tRepresentation of a vector in 2D space, that is, a float tuple with components x and y.\n//: */\n\n//!class Vec2\n\nconst Vec2 = Class.extend\n({\n\tclassName: 'Vec2',\n\n\t/**\n\t * \tCoordinates of the vector.\n\t * \t!x: number;\n\t * \t!y: number;\n\t */\n\tx: 0, y: 0,\n\n\t/**\n\t *\tConstructs the vector from another Vec2.\n\t * \t!constructor (value: Vec2);\n\t */\n\t/**\n\t *\tConstructs the vector with the specified coordinates.\n\t * \t!constructor (x?: number, y?: number);\n\t */\n\t__ctor: function (x=null, y=null)\n\t{\n\t\treturn this.set(x, y);\n\t},\n\n\t/**\n\t * \tClones the vector coordinates into a new Vec2 object.\n\t * \t!clone() : Vec2;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Vec2.Pool.alloc(this);\n\t},\n\n\t/**\n\t *\tSets the coordinates of the vector from a Vec2 object.\n\t *\t!set (value: Vec2) : Vec2;\n\t */\n\t/**\n\t *\tSets the coordinates of the vector.\n\t *\t!set (x: number, y: number) : Vec2;\n\t */\n\tset: function (x, y=null)\n\t{\n\t\tif (x === null) {\n\t\t\tx = 0;\n\t\t\ty = 0;\n\t\t}\n\t\telse if (y === null) {\n\t\t\tlet v = x;\n\t\t\tx = v.x;\n\t\t\ty = v.y;\n\t\t}\n\n\t\tthis.x = x;\n\t\tthis.y = y;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the X-coordinate of the vector.\n\t * \t!setX (x: number) : Vec2;\n\t */\n\tsetX: function (x)\n\t{\n\t\tthis.x = x;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the Y-coordinate of the vector.\n\t * \t!setY (y: number) : Vec2;\n\t */\n\tsetY: function (y)\n\t{\n\t\tthis.y = y;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the coordinates of the vector to zero.\n\t * \t!zero() : Vec2;\n\t */\n\tzero: function()\n\t{\n\t\treturn this.set(0, 0);\n\t},\n\n\t/**\n\t * \tReturns true if the vector coordinates are both zero.\n\t * \t!isZero() : boolean;\n\t */\n\tisZero: function()\n\t{\n\t\treturn this.x == 0 && this.y == 0;\n\t},\n\n\t/**\n\t *\tReturns true if the coordinates of the vector have the same values as the given Vec2.\n\t *\t!equals (value: Vec2) : boolean;\n\t */\n\t/**\n\t *\tReturns true if the coordinates of the vector have the same values as the given ones.\n\t *\t!equals (x: number, y: number) : boolean;\n\t */\n\tequals: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tlet v = x;\n\t\t\tx = v.x;\n\t\t\ty = v.y;\n\t\t}\n\n\t\treturn this.x == x && this.y == y;\n\t},\n\n\t/**\n\t * \tNegates the vector, that is changing the sign of each component in the vector.\n\t * \t!neg() : Vec2;\n\t */\n\tneg: function ()\n\t{\n\t\tthis.x = -this.x; this.y = -this.y;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tInverts the vector by changing each component to its reciprocal.\n\t * \t!inv() : Vec2;\n\t */\n\tinv: function ()\n\t{\n\t\tthis.x = 1 / this.x; this.y = 1 / this.y;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tChanges the components of the vector to their absolute value.\n\t * \t!abs() : Vec2;\n\t */\n\tabs: function ()\n\t{\n\t\tthis.x = this.x < 0 ? -this.x : this.x;\n\t\tthis.y = this.y < 0 ? -this.y : this.y;\n\t\treturn this;\n\t},\n\n\t/**\n\t *\tAdds the coordinates of the given Vec2 to the vector.\n\t *\t!translate (value: Vec2) : Vec2;\n\t */\n\t/**\n\t *\tAdds the given delta values to the vector.\n\t *\t!translate (dx: number, dy: number) : Vec2;\n\t */\n\ttranslate: function (dx, dy=null)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tlet v = dx;\n\t\t\tdx = v.x;\n\t\t\tdy = v.y;\n\t\t}\n\n\t\tthis.x += dx, this.y += dy;\n\t\treturn this;\n\t},\n\n\t/**\n\t *\tRotates the vector by the specified angle.\n\t *\t!rotate (angle: number) : Vec2;\n\t */\n\trotate: function (angle)\n\t{\n\t\tlet x = this.x*Math.cos(angle) + this.y*Math.sin(angle);\n\t\tlet y = this.y*Math.cos(angle) - this.x*Math.sin(angle);\n\n\t\tthis.x = x;\n\t\tthis.y = y;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t *\tAdds the coordinates of the given Vec2 to the vector.\n\t *\t!add (value: Vec2) : Vec2;\n\t */\n\t/**\n\t *\tAdds the given delta values to the vector.\n\t *\t!add (dx: number, dy: number) : Vec2;\n\t */\n\tadd: function (dx, dy=null)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tlet v = dx;\n\t\t\tdx = v.x;\n\t\t\tdy = v.y;\n\t\t}\n\n\t\tthis.x += dx, this.y += dy;\n\t\treturn this;\n\t},\n\n\t/**\n\t *\tSubtracts the coordinates of the given Vec2 from the vector.\n\t *\t!sub (value: Vec2) : Vec2;\n\t */\n\t/**\n\t *\tSubtracts the given delta values from the vector.\n\t *\t!sub (dx: number, dy: number) : Vec2;\n\t */\n\tsub: function (dx, dy=null)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tlet v = dx;\n\t\t\tdx = v.x;\n\t\t\tdy = v.y;\n\t\t}\n\n\t\tthis.x -= dx, this.y -= dy;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tScales each components of the vector by the respective component of the given one.\n\t * \t!scale (k: number) : Vec2;\n\t */\n\t/**\n\t * \tScales both components of the vector by the given factor.\n\t * \t!scale (k: number) : Vec2;\n\t */\n\t/**\n\t * \tScales each components of the vector by the given factors.\n\t * \t!scale (fx: number, fy: number) : Vec2;\n\t */\n\tscale: function (fx, fy=null)\n\t{\n\t\tif (fy === null)\n\t\t{\n\t\t\tif (Vec2.isInstance(fx)) {\n\t\t\t\tlet v = fx;\n\t\t\t\tfx = v.x;\n\t\t\t\tfy = v.y;\n\t\t\t} else {\n\t\t\t\tfy = fx;\n\t\t\t}\n\t\t}\n\n\t\tthis.x *= fx, this.y *= fy;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the components to their integer parts.\n\t * \t!floor() : Vec2;\n\t */\n\tfloor: function ()\n\t{\n\t\tthis.x = int(this.x);\n\t\tthis.y = int(this.y);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the components to their fractional parts.\n\t * \t!fract() : Vec2;\n\t */\n\tfract: function ()\n\t{\n\t\tthis.x = this.x - int(this.x);\n\t\tthis.y = this.y - int(this.y);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the dot product of the vectors.\n\t * \t!dot (value: Vec2) : number;\n\t */\n\t/**\n\t * \tReturns the dot product of the vector and the given values.\n\t * \t!dot (x: number, y: number) : number;\n\t */\n\tdot: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tlet v = x;\n\t\t\tx = v.x;\n\t\t\ty = v.y;\n\t\t}\n\n\t\treturn this.x*x + this.y*y;\n\t},\n\n\t/**\n\t * \tReturns the magnitude of the vector.\n\t * \t!magnitude(squared: boolean) : number;\n\t */\n\tmagnitude: function (squared=false)\n\t{\n\t\treturn squared ? (this.x*this.x + this.y*this.y) : Math.sqrt(this.x*this.x + this.y*this.y);\n\t},\n\n\t/**\n\t * \tNormalizes the vector by dividing each component by the vector magnitude to obtain a unit vector.\n\t * \t!normalize() : Vec2;\n\t */\n\tnormalize: function ()\n\t{\n\t\treturn this.isZero() ? this : this.scale (1 / this.magnitude());\n\t},\n\n\t/**\n\t * \tSets the vector to its major-axis, that is the component with the maximum absolute value.\n\t * \t!majorAxis() : Vec2;\n\t */\n\tmajorAxis: function ()\n\t{\n\t\tif (Math.abs(this.x) > Math.abs(this.y)) this.y = 0; else this.x = 0;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the vector to its minor-axis, that is the component with the minimum absolute value.\n\t * \t!minorAxis() : Vec2;\n\t */\n\tminorAxis: function ()\n\t{\n\t\tif (Math.abs(this.x) < Math.abs(this.y)) this.y = 0; else this.x = 0;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the vector to its sign-vector representation.\n\t * \t!sign() : Vec2;\n\t */\n\tsign: function ()\n\t{\n\t\tthis.x = !this.x ? 0 : (this.x < 0 ? -1 : 1);\n\t\tthis.y = !this.y ? 0 : (this.y < 0 ? -1 : 1);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the string representation of the coordinates of the vector.\n\t * \ttoString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn `(${this.x}, ${this.y})`;\n\t}\n});\n\n//!/class\n\n//!namespace Vec2\n//!namespace Pool\n\n/**\n *\tAllocates a vector from another Vec2.\n * \t!function alloc (value: Vec2) : Vec2;\n */\n/**\n *\tAllocates a vector with the specified coordinates.\n * \t!function alloc (x?: number, y?: number) : Vec2;\n */\n\nRecycler.createPool (Vec2, 4096, 2048);\nexport default Vec2;\n","/*\n**\tsystem/shader-program.js\n**\n**\tCopyright (c) 2021-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Shader from './shader.js';\nimport globals from './globals.js';\n\n//![import \"./shader\"]\n//![import \"./globals\"]\n\n//:/**\n//: * \tDescribes a shader program.\n//: */\n\n//!class ShaderProgram\n\nconst ShaderProgram = Class.extend\n({\n\t/**\n\t * \tLocations of the generic uniforms.\n\t * \n\t *\t!readonly uniform_location_matrix: number; // m_location\n\t *\t!readonly uniform_transform_matrix: number; // m_transform\n\t *\t!readonly uniform_texture_matrix: number; // m_texture\n\t *\t!readonly uniform_resolution: number; // v_resolution\n\t *\t!readonly uniform_texture_size: number; // v_texture_size\n\t *\t!readonly uniform_frame_size: number; // v_frame_size\n\t *\t!readonly uniform_base_color: number; // v_base_color\n\t *\t!readonly uniform_time: number; // f_time\n\t *\t!readonly uniform_depth: number; // f_depth\n\t *\t!readonly uniform_scale: number; // f_scale\n\t *\t!readonly uniform_alpha: number; // f_alpha\n\t *\t!readonly uniform_texture_0: number; // texture0\n\t */\n\n\tuniform_location_matrix: 0, /* mat3 */\n\tuniform_transform_matrix: 0, /* mat3 */\n\tuniform_texture_matrix: 0, /* mat3 */\n\n\tuniform_resolution: 0, /* vec2 */\n\tuniform_texture_size: 0, /* vec2 */\n\tuniform_frame_size: 0, /* vec2 */\n\tuniform_base_color: 0, /* vec4 */\n\n\tuniform_time: 0, /* float */\n\tuniform_depth: 0, /* float */\n\tuniform_scale: 0, /* float */\n\tuniform_alpha: 0, /* float */\n\n\tuniform_texture_0: 0,\n\n\t/**\n\t * \tLocations of the generic attributes.\n\t * \t!readonly attrib_location: number;\n\t */\n\tattrib_location: 0x00, /* vec2 */\n\n\t/**\n\t * \tIdentifier of the program.\n\t * \t!readonly id: string;\n\t */\n\tid: null,\n\n\t/**\n\t * \tShaders attached to the program.\n\t * \t!readonly shaders: Array<Shader>;\n\t */\n\tshaders: null,\n\n\t/**\n\t * \tShader program GL identifier.\n\t * \t!readonly programId: number;\n\t */\n\tprogramId: null,\n\n\t/**\n\t *\tConstructs an empty shader program with the specified identifier. Attach shaders by using the `attach` method.\n\t * \t!constructor (id: string);\n\t */\n\t__ctor: function (id)\n\t{\n\t\tthis.id = id;\n\n\t\tthis.shaders = [];\n\t\tthis.programId = null;\n\n\t\tShaderProgram.put(id, this);\n\t},\n\n\t/**\n\t * \tDestroys the shader program.\n\t */\n\t__dtor: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (!gl) return this;\n\n\t\tgl.deleteProgram(this.programId);\n\t\tShaderProgram.remove(this.id);\n\t},\n\n\t/**\n\t * \tAttaches a shader to the shader program.\n\t * \t!attach (shader: Shader|string) : ShaderProgram;\n\t */\n\tattach: function (shader)\n\t{\n\t\tif (typeof(shader) === 'string')\n\t\t\tshader = Shader.get(shader);\n\n\t\tif (!shader)\n\t\t\tthrow new Error ('Unable to attach shader, invalid argument.');\n\n\t\tthis.shaders.push(shader);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tBinds the attribute locations to their predefined values.\n\t * \t!bindLocations (gl: WebGL2RenderingContext) : void;\n\t */\n\tbindLocations: function (gl)\n\t{\n\t\tgl.bindAttribLocation (this.programId, 0, 'location');\n\t},\n\n\t/**\n\t * \tLoads the locations of the predefined uniforms and attributes.\n\t * \t!loadLocations (gl: WebGL2RenderingContext) : void;\n\t */\n\tloadLocations: function (gl)\n\t{\n\t\tthis.uniform_location_matrix = gl.getUniformLocation (this.programId, 'm_location');\n\t\tthis.uniform_transform_matrix = gl.getUniformLocation (this.programId, 'm_transform');\n\t\tthis.uniform_texture_matrix = gl.getUniformLocation (this.programId, 'm_texture');\n\t\tthis.uniform_resolution = gl.getUniformLocation (this.programId, 'v_resolution');\n\t\tthis.uniform_texture_size = gl.getUniformLocation (this.programId, 'v_texture_size');\n\t\tthis.uniform_frame_size = gl.getUniformLocation (this.programId, 'v_frame_size');\n\t\tthis.uniform_base_color = gl.getUniformLocation (this.programId, 'v_base_color');\n\t\tthis.uniform_time = gl.getUniformLocation (this.programId, 'f_time');\n\t\tthis.uniform_depth = gl.getUniformLocation (this.programId, 'f_depth');\n\t\tthis.uniform_scale = gl.getUniformLocation (this.programId, 'f_scale');\n\t\tthis.uniform_alpha = gl.getUniformLocation (this.programId, 'f_alpha');\n\t\tthis.uniform_texture_0 = gl.getUniformLocation (this.programId, 'texture0');\n\n\t\tthis.attrib_location = gl.getAttribLocation (this.programId, 'location');\n\t},\n\n\t/**\n\t * \tLinks the shaders into the shader program. Completion can be obtained by calling `getStatus`.\n\t * \t!link() : ShaderProgram;\n\t */\n\tlink: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (!gl) return this;\n\n\t\tthis.programId = gl.createProgram();\n\n\t\tfor (let shader of this.shaders)\n\t\t\tgl.attachShader (this.programId, shader.shaderId);\n\n\t\tthis.bindLocations(gl);\n\t\tgl.linkProgram (this.programId);\n\t\tthis.loadLocations(gl);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tEnables the shader program to be used in the subsequent drawing operations.\n\t * \t!use() : void;\n\t */\n\tuse: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (!gl) return;\n\n\t\tgl.useProgram (this.programId);\n\t},\n\n\t/**\n\t * \tReturns the link status of the program.\n\t * \t!getStatus() : boolean;\n\t */\n\tgetStatus: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (!gl) return true;\n\n\t\treturn gl.getProgramParameter(this.programId, gl.LINK_STATUS);\n\t},\n\n\t/**\n\t * \tReturns the error of the last link operation.\n\t * \t!getError() : string;\n\t */\n\tgetError: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (!gl) return '';\n\n\t\tif (this.programId === null)\n\t\t\treturn 'Program has not been linked.';\n\n\t\treturn gl.getProgramInfoLog(this.programId);\n\t},\n\n\t/**\n\t * \tReturns the errors found in the program and all shaders.\n\t * \t!getAllErrors() : string;\n\t */\n\tgetAllErrors: function ()\n\t{\n\t\tlet e = '>> PROGRAM:\\n' + this.getError();\n\n\t\tfor (let shader of this.shaders)\n\t\t{\n\t\t\te += '\\n>> ' + (shader.type === Shader.Type.VERTEX ? 'vertex' : 'fragment').toUpperCase() + ':\\n' + shader.getError();\n\t\t}\n\n\t\treturn e;\n\t}\n});\n\n/**\n * \tGlobal shader program list.\n */\nShaderProgram.programs = { };\n\n/**\n * \tPuts a shader program in the global program list under the specified identifier.\n * \t!static put (id: string, shaderProgram: ShaderProgram) : void;\n */\nShaderProgram.put = function (id, shaderProgram)\n{\n\tthis.programs[id] = shaderProgram;\n};\n\n/**\n * \tReturns a shader program from the global program list given its identifier.\n * \t!static get (id: string) : ShaderProgram;\n */\nShaderProgram.get = function (id)\n{\n\treturn this.programs[id];\n};\n\n/**\n * \tRemoves a shader program from the global program list.\n * \t!static remove (id: string) : void;\n */\nShaderProgram.remove = function (id)\n{\n\tdelete this.programs[id];\n};\n\nexport default ShaderProgram;\n","/*\n**\tsystem/shader.js\n**\n**\tCopyright (c) 2021-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport globals from './globals.js';\n\n//![import \"./globals\"]\n\n//:/**\n//: * \tDescribes a shader object. The actual shader type is specified at construction.\n//: */\n\n//!class Shader\n\nconst Shader = Class.extend\n({\n\t/**\n\t * \tIdentifier of the shader.\n\t * \t!readonly id: string;\n\t */\n\tid: null,\n\n\t/**\n\t * \tType of the shader.\n\t * \t!readonly type: Shader.Type;\n\t */\n\ttype: 0,\n\n\t/**\n\t * \tSource code of the shader.\n\t */\n\tsourceCode: null,\n\n\t/**\n\t * \tShader GL identifier.\n\t * \t!readonly shaderId: number;\n\t */\n\tshaderId: null,\n\n\t/**\n\t *\tConstructs an empty shader. Attach GLSL code by using the `source` method.\n\t * \t!constructor (id: string, type: Shader.Type);\n\t */\n\t__ctor: function (id, type)\n\t{\n\t\tthis.id = id;\n\t\tthis.type = type;\n\n\t\tthis.sourceCode = '';\n\t\tthis.shaderId = null;\n\n\t\tShader.put(id, this);\n\t},\n\n\t/**\n\t * \tDestroys the shader.\n\t */\n\t__dtor: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (!gl) return;\n\n\t\tgl.deleteShader(this.shaderId);\n\t\tShader.remove(this.id);\n\t},\n\n\t/**\n\t * \tAppends GLSL code to the shader's source code buffer.\n\t * \t!source (value: string) : Shader;\n\t */\n\tsource: function (value)\n\t{\n\t\tthis.sourceCode += value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCompiles the shader. Errors can be obtained using getError() method.\n\t * \t!compile() : void;\n\t */\n\tcompile: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (!gl) return;\n\n\t\tthis.shaderId = gl.createShader (this.type === Shader.Type.VERTEX ? gl.VERTEX_SHADER : (this.type === Shader.Type.FRAGMENT ? gl.FRAGMENT_SHADER : gl.GEOMETRY_SHADER));\n\n\t\tgl.shaderSource(this.shaderId, this.sourceCode);\n\t\tgl.compileShader(this.shaderId);\n\t},\n\n\t/**\n\t * \tReturns the error of the last compile operation.\n\t * \t!getError() : string;\n\t */\n\tgetError: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (!gl) return '';\n\n\t\tif (this.shaderId === null)\n\t\t\treturn 'Shader has not been compiled.';\n\n\t\treturn gl.getShaderInfoLog(this.shaderId);\n\t}\n});\n\n//!/class\n\n/**\n * \tGlobal shader list.\n */\nShader.shaders = { };\n\n/**\n * \tStores a shader with the specified identifier in the global shader list.\n * \t!static put (id: string, shader: Shader) : void;\n */\nShader.put = function (id, shader)\n{\n\tthis.shaders[id] = shader;\n};\n\n/**\n * \tReturns a Shader from the global shader list given its identifier.\n * \t!static get (id: string) : Shader;\n */\nShader.get = function (id)\n{\n\treturn this.shaders[id];\n};\n\n/**\n * \tRemoves a shader from the global shader list.\n * \t!static remove (id: string) : void;\n */\nShader.remove = function (id)\n{\n\tdelete this.shaders[id];\n};\n\n//!namespace Shader\n\n//:/**\n//: * \tShader types.\n//: */\n\n//!enum Type\n\nShader.Type = {\n\tVERTEX: 0,\n\t//!VERTEX\n\tFRAGMENT: 1,\n\t//!FRAGMENT\n\tGEOMETRY: 2,\n\t//!GEOMETRY\n};\n\n//!/enum\n\nexport default Shader;\n","/*\n**\tsystem/system.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport KeyCode from './keycode.js';\nimport List from '../utils/list.js';\nimport Linkable from '../utils/linkable.js';\nimport Timer from './timer.js';\nimport Canvas from './canvas.js';\nimport Log from './log.js';\nimport globals from './globals.js';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"./keycode\"]\n//![import \"../utils/list\"]\n//![import \"../utils/linkable\"]\n//![import \"./timer\"]\n//![import \"./canvas\"]\n//![import \"./globals\"]\n\n//!namespace System\n\n\t//:type DisplayOrientation = 'default'|'landscape'|'portrait'|'automatic';\n\n\t//!type Options =\n\n\t\t/**\n\t\t *\tBackground of the system canvas. Should be a full 7-digit HEX RGB color.\n\t\t *\t@default \"#000000\"\n\t\t *\t!background?: string;\n\t\t */\n\n\t\t/**\n\t\t * \tSet to `false` to disable WebGL mode.\n\t\t * \t@default true\n\t\t * \t!gl?: boolean;\n\t\t */\n\n\t\t/**\n\t\t *\tSet to `true` t o enable on-screen logging.\n\t\t *\t@default false\n\t\t *\t!log?: boolean,\n\t\t */\n\n\t\t/**\n\t\t *\tWhen `true` the renderer will not clear the buffer on each frame draw, thus allowing overdrawing on the previous frame.\n\t\t *\t@default false\n\t\t *\t!overdraw?: boolean,\n\t\t */\n\n\t\t/**\n\t\t *\tEnables or disables antialised canvas. Set to `false` when pixel-perfect is desired.\n\t\t *\t@default false\n\t\t *\t!antialias?: boolean;\n\t\t */\n\n\t\t/**\n\t\t *\tDesired orientaton of the display.\n\t\t *\t@default \"automatic\"\n\t\t *\t!orientation?: System.DisplayOrientation;\n\t\t */\n\n\t\t/**\n\t\t *\tDesired display width. When not specified (null) the maximum screen width to maintain the aspect ratio will be used.\n\t\t *\t@default null\n\t\t *\t!screenWidth?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tDesired display height. When not specified (null) the maximum screen height to maintain the aspect ratio will be used.\n\t\t *\t@default null\n\t\t *\t!screenHeight?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tTarget frames per second (FPS). Used to determine delay between frames.\n\t\t *\t@default 144\n\t\t *\t!fps?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tMinimum allowed frames per second (FPS). If system FPS drops below this value, the `frameDelta` property of System will be truncated to 1/minFps.\n\t\t *\t@default 10\n\t\t *\t!minFps?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tSelects which rendering mechanism to use either requestAnimationFrame when `true` or setTimeout when `false`.\n\t\t *\t@default true\n\t\t *\t!vsync?: boolean;\n\t\t */\n\n\t\t/**\n\t\t *\tExtra scale factor used to resize images. Use only when you want to render higher resolution images possibly for a very high DPI display.\n\t\t *\t@default 1\n\t\t *\t!extraScaleFactor?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tMaximum scale factor that should be used in the system. A value of `null` will cause no limit.\n\t\t *\t@default null\n\t\t *\t!maxScaleFactor?: number;\n\t\t */\n\n\t\t/**\n\t\t *\tIndicates which method to use to find the target resolution, using `fullscreen` object when `true`, or the `window` object when `false`.\n\t\t *\t@default false\n\t\t *\t!fullscreen?: boolean;\n\t\t */\n\n\t\t/**\n\t\t * \tIndicates if recycler pool preallocation should be automatically executed. Additionally if this value is a number, it will be used as\n\t\t * \tmaximum preallocation parameter for the recycler.\n\t\t * \t@default true\n\t\t * \t!preallocate?: boolean|number;\n\t\t */\n\n\t//!/type\n\n//!/namespace\n\n//!class System\n\nconst System =\n{\n\t/**\n\t * \tRenderer status flags.\n\t */\n\tflags:\n\t{\n\t\trenderingEnabled: false,\n\t\trenderingPaused: false\n\t},\n\n\t/**\n\t * \tDefault options of the rendering system.\n\t */\n\tdefaultOptions:\n\t{\n\t\tbackground: \"#000000\",\n\t\tgl: true,\n\t\tlog: false,\n\n\t\toverdraw: false,\n\t\tantialias: true,\n\t\torientation: 0,\n\n\t\tfps: 144,\n\t\tminFps: 15,\n\t\tvsync: true,\n\n\t\tscreenWidth: null,\n\t\tscreenHeight: null,\n\n\t\textraScaleFactor: 1,\n\t\tmaxScaleFactor: null,\n\n\t\tfullscreen: false\n\t},\n\n\t/**\n\t * \tScreen width, available only after the system has been initialized.\n\t * \t!static readonly screenWidth: number;\n\t */\n\tscreenWidth: 0,\n\n\t/**\n\t * \tScreen height, available only after the system has been initialized.\n\t * \t!static readonly screenHeight: number;\n\t */\n\tscreenHeight: 0,\n\n\t/**\n\t * \tCurrent display orientation.\n\t * \t!static readonly orientation: System.DisplayOrientation;\n\t */\n\torientation: 0,\n\n\t/**\n\t * \tCoordinates of the screen's offset (for letter-box effect when the screen does not fit tightly).\n\t */\n\toffsX: 0, offsY: 0,\n\n\t/**\n\t * \tDevice pixel ratio, canvas backing store ratio and resulting canvas ratio (devicePixelRatio / backingStoreRatio).\n\t */\n\tdevicePixelRatio: 1, backingStoreRatio: 1, canvasPixelRatio: 1, canvasScaleFactor: 1, scaleFactor: 1,\n\n\t/**\n\t * \tInitial transformation matrix. Should be used (if needed) instead of `loadIdentity` since the System does some transformations first.\n\t * \t!static readonly initialMatrix: Matrix;\n\t */\n\tinitialMatrix: null,\n\n\t/**\n\t * \tPrimary renderer.\n\t * \t!static readonly renderer: Canvas;\n\t */\n\trenderer: null,\n\n\t/**\n\t * \tSecondary display buffer (always 2D). Has the same initial transformation matrix as the primary display buffer.\n\t * \t!static readonly displayBuffer2: Canvas;\n\t */\n\tdisplayBuffer2: null,\n\n\t/**\n\t * \tTerciary display buffer (always 2D). Is assured to have 1:1 with the screen size, initial transformation matrix not applied.\n\t * \t!static readonly displayBuffer3: Canvas;\n\t */\n\tdisplayBuffer3: null,\n\n\t/**\n\t * \tSmall (320x240) temporal display buffer. Used to preload images.\n\t */\n\ttempDisplayBuffer: null,\n\n\t/**\n\t * \tMap with the status of all keys (along with other flags).\n\t */\n\tkeyState: { time: 0, shift: false, ctrl: false, alt: false, keyCode: 0 },\n\n\t/**\n\t * \tCurrent status of all pointers. The related object is known as the Pointer State, and has the following fields: id, isActive, isDragging, sx, sy, x, y, dx, dy, button, wheelDelta and wheelAccum.\n\t */\n\tpointerState: { },\n\n\t/**\n\t * \tThe update method of all objects will be executed when the system update() method is called.\n\t */\n\tupdateQueue: null,\n\n\t/**\n\t * \tThe draw method of all objects will be executed when the system draw() method is called.\n\t */\n\tdrawQueue: null, /*List*/\n\n\t/**\n\t * \tThe frame delta is multiplied by this value before each system cycle (defaults to 1).\n\t * \t!static timeScale: number;\n\t */\n\ttimeScale: 1,\n\n\t/**\n\t * \tFrame interval in milliseconds.\n\t * \t!static readonly frameInterval: number;\n\t */\n\tframeInterval: 0,\n\n\t/**\n\t * \tFixed frame interval in milliseconds, when set to non-zero value the frame delta will always be set to this value.\n\t * \t!static fixedFrameInterval: number;\n\t */\n\tfixedFrameInterval: 0,\n\n\t/**\n\t * \tMaximum frame interval in milliseconds, if the `frameDelta` exceeds this, it will be truncated to this value. Controlled by the `minFps` value\n\t * \tof the system initialization options.\n\t * \t!static readonly maxFrameInterval: number;\n\t */\n\tmaxFrameInterval: 0,\n\n\t/**\n\t * \tLast frame delta in seconds.\n\t * \t!static readonly frameDelta: number;\n\t */\n\tframeDelta: 0,\n\n\t/**\n\t * \tLogical system time in seconds. Updated on each cycle by the calculated `frameDelta`.\n\t * \t!static readonly frameTime: number;\n\t */\n\tframeTime: 0,\n\n\t/**\n\t * \tCurrent frame number.\n\t * \t!static readonly frameNumber: number;\n\t */\n\tframeNumber: 0,\n\n\t/**\n\t * \tRendering performance data.\n\t */\n\tperf:\n\t{\n\t\t/**\n\t\t * \tCurrent time range.\n\t\t */\n\t\tstartTime: 0,\n\t\tlastTime: 0,\n\n\t\t/**\n\t\t * \tNumber of frames drawn in the current time range.\n\t\t */\n\t\tnumFrames: 0,\n\n\t\t/**\n\t\t * \tNumber of update and draw samples averaged in total.\n\t\t */\n\t\tnumSamples: 0,\n\n\t\t/**\n\t\t * \tTotal time spent in update, draw and extra respectively in the current time range.\n\t\t */\n\t\tupdateTimeTotal: 0,\n\t\tdrawTimeTotal: 0,\n\t\textraTimeTotal: 0,\n\n\t\t/**\n\t\t * \tCalculated values for the last time range. The updateTime and drawTime are in microseconds.\n\t\t */\n\t\tfps: 0,\n\t\taverageFps: 0,\n\t\taverageUpdateTime: 0,\n\t\taverageDrawTime: 0,\n\t\taverageExtraTime: 0\n\t},\n\n\t/**\n\t * \tInitializes the system with the specified configuration options.\n\t * \t!static init (options: System.Options) : void;\n\t */\n\tinit: function (options=null)\n\t{\n\t\tlet self = this;\n\n\t\tlet o = { ...this.defaultOptions, ...options };\n\t\tthis.options = o;\n\n\t\t// Execute recycler pool data preallocation.\n\t\tif (this.options.preallocate !== false)\n\t\t{\n\t\t\tif (this.options.preallocate === true)\n\t\t\t\tRecycler.preallocate();\n\t\t\telse\n\t\t\t\tRecycler.preallocate(this.options.preallocate);\n\t\t}\n\n\t\t// Set default orientation if both target sizes were specified.\n\t\tif (o.screenWidth && o.screenHeight && o.orientation == 'default')\n\t\t\to.orientation = o.screenWidth > o.screenHeight ? 'landscape' : 'portrait';\n\n\t\tthis.orientation = o.orientation;\n\n\t\tthis.updateQueue = List.Pool.alloc();\n\t\tthis.drawQueue = List.Pool.alloc();\n\n\t\t// Attach frame event handlers.\n\t\tthis.frameInterval = 1000 / o.fps;\n\t\tthis.maxFrameInterval = 1000 / o.minFps;\n\n\t\tglobal.onresize = function() { self.onWindowResized(); };\n\n\t\tthis.frameTimer = new Timer (o.vsync, this.frameInterval, (delta) => this.onFrame(delta));\n\n\t\t// Setup canvas buffer.\n\t\tthis.renderer = new Canvas ({ gl: o.gl, elem: null, absolute: true, hidden: false, antialias: o.antialias, background: o.background });\n\n\t\tthis.displayBuffer2 = new Canvas ({ gl: false, elem: null, absolute: true, hidden: false, antialias: o.antialias, background: 'none' });\n\t\tthis.displayBuffer2.elem.style.pointerEvents = 'none';\n\n\t\tthis.displayBuffer3 = new Canvas ({ gl: false, elem: null, absolute: true, hidden: false, antialias: o.antialias, background: 'none' });\n\t\tthis.displayBuffer3.elem.style.pointerEvents = 'none';\n\n\t\tthis.tempDisplayBuffer = new Canvas ({ hidden: true, antialias: o.antialias }).resize(320, 240);\n\n\t\tlet display0 = this.renderer.elem;\n\n\t\t// Obtain device display ratios.\n\t\tthis.devicePixelRatio = global.devicePixelRatio || 1;\n\n\t\tthis.backingStoreRatio = o.gl === true ? 1 : (this.renderer.context.webkitBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.renderer.context.mozBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.renderer.context.msBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.renderer.context.oBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.renderer.context.backingStorePixelRatio || 1);\n\n\t\tthis.canvasPixelRatio = this.devicePixelRatio / this.backingStoreRatio;\n\n\t\tSystem.onWindowResized(true);\n\n\t\t// Attach keyboard event handlers.\n\t\tglobal.onkeydown = function (evt)\n\t\t{\n\t\t\tif (evt.target !== global.document.body)\n\t\t\t\treturn;\n\n\t\t\tif (self.keyState[evt.keyCode])\n\t\t\t\treturn false;\n\n\t\t\tself.keyState[evt.keyCode] = true;\n\n\t\t\tself.keyState.keyCode = evt.keyCode;\n\t\t\tself.keyState.startTime = hrnow();\n\n\t\t\tswitch (evt.keyCode)\n\t\t\t{\n\t\t\t\tcase 16: // SHIFT\n\t\t\t\t\tself.keyState.shift = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 17: // CTRL\n\t\t\t\t\tself.keyState.ctrl = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 18: // ALT\n\t\t\t\t\tself.keyState.alt = true;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// CTRL+TAB should always be handled by the browser.\n\t\t\tif (self.keyState.ctrl && evt.keyCode == KeyCode.TAB)\n\t\t\t{\n\t\t\t\tself.keyState[evt.keyCode] = false;\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (self.onKeyboardEvent (self.KeyboardEventType.KEY_DOWN, evt.keyCode, self.keyState) === false)\n\t\t\t\treturn false;\n\t\t};\n\n\t\tglobal.onkeyup = function (evt)\n\t\t{\n\t\t\tif (evt.target !== global.document.body)\n\t\t\t\treturn;\n\n\t\t\tif (!self.keyState[evt.keyCode])\n\t\t\t\treturn false;\n\n\t\t\tself.keyState[evt.keyCode] = false;\n\t\t\tself.keyState.endTime = hrnow();\n\t\t\tself.keyState.keyCode = evt.keyCode;\n\n\t\t\tswitch (evt.keyCode)\n\t\t\t{\n\t\t\t\tcase 16: // SHIFT\n\t\t\t\t\tself.keyState.shift = false;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 17: // CTRL\n\t\t\t\t\tself.keyState.ctrl = false;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 18: // ALT\n\t\t\t\t\tself.keyState.alt = false;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (self.onKeyboardEvent (self.KeyboardEventType.KEY_UP, evt.keyCode, self.keyState) === false)\n\t\t\t\treturn false;\n\t\t};\n\n\t\t// Converts pointer coordinates from physical space to screen space.\n\n\t\tconst pointerConvX = function (x, y)\n\t\t{\n\t\t\treturn System.reverseRender ? int(System.screenWidth-1 - (y-System.offsY)/System.canvasScaleFactor) : int((x-System.offsX)/System.canvasScaleFactor);\n\t\t};\n\n\t\tconst pointerConvY = function (x, y)\n\t\t{\n\t\t\treturn System.reverseRender ? int((x-System.offsX)/System.canvasScaleFactor) : int((y-System.offsY)/System.canvasScaleFactor);\n\t\t};\n\n\t\t// Attach pointer event handlers if pointer-events are available.\n\t\tif (\"ontouchstart\" in global)\n\t\t{\n\t\t\tdisplay0.ontouchstart = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tlet touches = evt.changedTouches;\n\n\t\t\t\tfor (let i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointerState[touches[i].identifier])\n\t\t\t\t\t{\n\t\t\t\t\t\tSystem.pointerState[touches[i].identifier] = {\n\t\t\t\t\t\t\t\tid: touches[i].identifier, isActive: false, isDragging: false,\n\t\t\t\t\t\t\t\tsx: 0, sy: 0, x: 0, y: 0, dx: 0, dy: 0, button: 0,\n\t\t\t\t\t\t\t\twheelDelta: 0, wheelAccum: 0\n\t\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tlet p = System.pointerState[touches[i].identifier];\n\n\t\t\t\t\tp.isActive = true;\n\t\t\t\t\tp.isDragging = false;\n\t\t\t\t\tp.button = 1;\n\n\t\t\t\t\tp.startTime = hrnow();\n\n\t\t\t\t\tp.x = p.sx = pointerConvX(touches[i].clientX, touches[i].clientY);\n\t\t\t\t\tp.y = p.sy = pointerConvY(touches[i].clientX, touches[i].clientY);\n\n\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DOWN, p, System.pointerState);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchend = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tlet touches = evt.changedTouches;\n\n\t\t\t\tfor (let i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointerState[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tlet p = System.pointerState[touches[i].identifier];\n\n\t\t\t\t\tp.endTime = hrnow();\n\t\t\t\t\tp.deltaTime = p.endTime - p.startTime;\n\n\t\t\t\t\tp.x = pointerConvX(touches[i].clientX, touches[i].clientY)\n\t\t\t\t\tp.y = pointerConvY(touches[i].clientX, touches[i].clientY)\n\n\t\t\t\t\tif (p.isDragging)\n\t\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DRAG_STOP, p, System.pointerState);\n\n\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_UP, p, System.pointerState);\n\n\t\t\t\t\tp.isActive = false;\n\t\t\t\t\tp.isDragging = false;\n\n\t\t\t\t\tp.button = 0;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchcancel = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tlet touches = evt.changedTouches;\n\n\t\t\t\tfor (let i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointerState[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tlet p = System.pointerState[touches[i].identifier];\n\n\t\t\t\t\tp.x = pointerConvX(touches[i].clientX, touches[i].clientY);\n\t\t\t\t\tp.y = pointerConvY(touches[i].clientX, touches[i].clientY);\n\n\t\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.PointerEventType.POINTER_DRAG_STOP : System.PointerEventType.POINTER_UP, p, System.pointerState);\n\n\t\t\t\t\tp.isActive = false;\n\t\t\t\t\tp.isDragging = false;\n\n\t\t\t\t\tp.button = 0;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchmove = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tlet touches = evt.changedTouches;\n\n\t\t\t\tfor (let i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointerState[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tlet p = System.pointerState[touches[i].identifier];\n\n\t\t\t\t\tif (p.isActive && !p.isDragging)\n\t\t\t\t\t{\n\t\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DRAG_START, p, System.pointerState);\n\t\t\t\t\t\tp.isDragging = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tp.x = pointerConvX(touches[i].clientX, touches[i].clientY);\n\t\t\t\t\tp.y = pointerConvY(touches[i].clientX, touches[i].clientY);\n\n\t\t\t\t\tp.dx = p.x - p.sx;\n\t\t\t\t\tp.dy = p.y - p.sy;\n\n\t\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.PointerEventType.POINTER_DRAG_MOVE : System.PointerEventType.POINTER_MOVE, p, System.pointerState);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\t\t// Attach mouse event handlers when pointer-events are not available.\n\t\telse\n\t\t{\n\t\t\tdisplay0.oncontextmenu = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.onwheel = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointerState[0])\n\t\t\t\t{\n\t\t\t\t\tSystem.pointerState[0] = {\n\t\t\t\t\t\t\tid: 0, isActive: false, isDragging: false,\n\t\t\t\t\t\t\tsx: 0, sy: 0, x: 0, y: 0, dx: 0, dy: 0, button: 0,\n\t\t\t\t\t\t\twheelDelta: 0, wheelAccum: 0\n\t\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlet p = System.pointerState[0];\n\n\t\t\t\tp.x = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = pointerConvY(evt.clientX, evt.clientY);\n\t\t\t\tp.wheelDelta = evt.deltaY;\n\t\t\t\tp.wheelAccum += evt.deltaY;\n\n\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_WHEEL, p, System.pointerState);\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.onmousedown = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointerState[0])\n\t\t\t\t{\n\t\t\t\t\tSystem.pointerState[0] = {\n\t\t\t\t\t\t\tid: 0, isActive: false, isDragging: false,\n\t\t\t\t\t\t\tsx: 0, sy: 0, x: 0, y: 0, dx: 0, dy: 0, button: 0,\n\t\t\t\t\t\t\twheelDelta: 0, wheelAccum: 0\n\t\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlet p = System.pointerState[0];\n\n\t\t\t\tp.isActive = true;\n\t\t\t\tp.isDragging = false;\n\t\t\t\tp.button = evt.which;\n\n\t\t\t\tp.x = p.sx = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = p.sy = pointerConvY(evt.clientX, evt.clientY);\n\n\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DOWN, p, System.pointerState);\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.onmouseup = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointerState[0])\n\t\t\t\t\treturn false;\n\n\t\t\t\tlet p = System.pointerState[0];\n\n\t\t\t\tp.x = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = pointerConvY(evt.clientX, evt.clientY);\n\n\t\t\t\tif (p.isDragging)\n\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DRAG_STOP, p, System.pointerState);\n\n\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_UP, p, System.pointerState);\n\n\t\t\t\tp.isActive = false;\n\t\t\t\tp.isDragging = false;\n\n\t\t\t\tp.button = 0;\n\t\t\t};\n\n\t\t\tdisplay0.onmousemove = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointerState[0])\n\t\t\t\t\treturn false;\n\n\t\t\t\tlet p = System.pointerState[0];\n\n\t\t\t\tif (p.isActive && !p.isDragging)\n\t\t\t\t{\n\t\t\t\t\tSystem.onPointerEvent (System.PointerEventType.POINTER_DRAG_START, p, System.pointerState);\n\t\t\t\t\tp.isDragging = true;\n\t\t\t\t}\n\n\t\t\t\tp.x = pointerConvX(evt.clientX, evt.clientY);\n\t\t\t\tp.y = pointerConvY(evt.clientX, evt.clientY);\n\n\t\t\t\tp.dx = p.x - p.sx;\n\t\t\t\tp.dy = p.y - p.sy;\n\n\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.PointerEventType.POINTER_DRAG_MOVE : System.PointerEventType.POINTER_MOVE, p, System.pointerState);\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\t// Enable log if flag is set.\n\t\tif (o.log === true) Log.enable();\n\t},\n\n\t/**\n\t * \tReturns the current logical time in seconds (same as reading `System.frameTime`).\n\t * \t!static time() : number;\n\t */\n\ttime: function()\n\t{\n\t\treturn this.frameTime;\n\t},\n\n\t/**\n\t * \tStarts the system and enables rendering and updates.\n\t * \t!static start() : void;\n\t */\n\tstart: function()\n\t{\n\t\tthis.onWindowResized();\n\n\t\tthis.flags.renderingPaused = false;\n\t\tthis.frameTimer.start();\n\t},\n\n\t/**\n\t * \tStops the system by disabling both rendering and updates.\n\t * \t!static stop() : void;\n\t */\n\tstop: function()\n\t{\n\t\tthis.flags.renderingPaused = true;\n\t\tthis.frameTimer.stop();\n\t},\n\n\t/**\n\t * \tPauses the system by disabling updates, but rendering will be continued.\n\t * \t!static pause() : void;\n\t */\n\tpause: function()\n\t{\n\t\tthis.flags.renderingPaused = true;\n\t},\n\n\t/**\n\t * \tResumes the system after previously being paused with `pause` method.\n\t * \t!static resume() : void;\n\t */\n\tresume: function()\n\t{\n\t\tthis.flags.renderingPaused = false;\n\t\tthis.resetPerf();\n\t},\n\n\t/**\n\t * \tExecuted when a frame needs to be rendered to the display buffer.\n\t * \tstatic onFrame (delta: number) : void;\n\t */\n\tonFrame: function(delta)\n\t{\n\t\tlet now = hrnow()\n\t\tlet tmp;\n\n\t\tif (delta > this.maxFrameInterval)\n\t\t\tdelta = this.maxFrameInterval;\n\n\t\tif (this.fixedFrameInterval !== 0)\n\t\t\tdelta = this.fixedFrameInterval;\n\n\t\tif (!this.flags.renderingEnabled || this.flags.renderingPaused)\n\t\t{\n\t\t\tthis.draw();\n\t\t\treturn;\n\t\t}\n\n\t\tdelta *= this.timeScale;\n\n\t\tthis.frameDelta = delta / 1000.0;\n\t\tthis.frameTime += this.frameDelta;\n\t\tglobals.time = this.frameTime;\n\n\t\tthis.frameNumber++;\n\n\t\t/* ~ */\n\t\ttmp = hrnow();\n\t\tthis.update (this.frameDelta);\n\t\tthis.perf.updateTimeTotal += hrnow() - tmp;\n\n\t\t/* ~ */\n\t\ttmp = hrnow();\n\t\tthis.draw();\n\t\tthis.perf.drawTimeTotal += hrnow() - tmp;\n\n\t\t/* ~ */\n\t\tthis.perf.lastTime = now;\n\t\tthis.perf.numFrames++;\n\n\t\tdelta = this.perf.lastTime - this.perf.startTime;\n\t\tif (delta > 1000)\n\t\t{\n\t\t\tthis.perf.fps = int(this.perf.numFrames*1000 / delta);\n\n\t\t\t//this.perf.extraTimeTotal = delta - this.perf.updateTimeTotal - this.perf.drawTimeTotal;\n\n\t\t\tthis.perf.averageFps = int(((this.perf.averageFps*this.perf.numSamples) + this.perf.fps) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.averageUpdateTime = int(((this.perf.averageUpdateTime*this.perf.numSamples) + (this.perf.updateTimeTotal*1000 / this.perf.numFrames)) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.averageDrawTime = int(((this.perf.averageDrawTime*this.perf.numSamples) + (this.perf.drawTimeTotal*1000 / this.perf.numFrames)) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.averageExtraTime = int(((this.perf.averageExtraTime*this.perf.numSamples) + (this.perf.extraTimeTotal*1000 / this.perf.numFrames)) / (this.perf.numSamples + 1));\n\t\t\tthis.perf.numSamples++;\n\n\t\t\tthis.perf.startTime = now;\n\t\t\tthis.perf.lastTime = now;\n\t\t\tthis.perf.numFrames = 0;\n\t\t\tthis.perf.updateTimeTotal = 0;\n\t\t\tthis.perf.drawTimeTotal = 0;\n\t\t\tthis.perf.extraTimeTotal = 0;\n\t\t}\n\t},\n\n\t/**\n\t * \tExecuted when the size of the window has changed.\n\t * \tstatic onWindowResized (notRendering: boolean = false) : void;\n\t */\n\tonWindowResized: function(notRendering=false)\n\t{\n\t\t// Determine size of the screen.\n\t\tif ('document' in global)\n\t\t{\n\t\t\tif (this.options.fullscreen)\n\t\t\t{\n\t\t\t\tthis._screenWidth = int(global.screen.width);\n\t\t\t\tthis._screenHeight = int(global.screen.height);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._screenWidth = global.innerWidth;\n\t\t\t\tthis._screenHeight = global.innerHeight;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._screenWidth = this.options.screenWidth;\n\t\t\tthis._screenHeight = this.options.screenHeight;\n\n\t\t\tif (this.options.screenWidth == null && this.options.screenHeight == null)\n\t\t\t\tthrow new Error ('At least one screen dimension must be specified in headless mode.');\n\t\t}\n\n\t\t// Flip dimensions to ensure the desired orientation.\n\t\tif ((this._screenWidth < this._screenHeight && this.orientation == 'landscape') || (this._screenWidth > this._screenHeight && this.orientation == 'portrait'))\n\t\t{\n\t\t\tthis.screenWidth = this._screenHeight;\n\t\t\tthis.screenHeight = this._screenWidth;\n\n\t\t\tthis.reverseRender = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.screenWidth = this._screenWidth;\n\t\t\tthis.screenHeight = this._screenHeight;\n\n\t\t\tthis.reverseRender = false;\n\t\t}\n\n\t\t// Get target screen dimensions.\n\t\tlet targetScreenWidth = this.options.screenWidth;\n\t\tlet targetScreenHeight = this.options.screenHeight;\n\n\t\tif (targetScreenWidth === null || targetScreenHeight === null)\n\t\t{\n\t\t\tif (targetScreenWidth === null && targetScreenHeight === null)\n\t\t\t{\n\t\t\t\ttargetScreenWidth = this.screenWidth;\n\t\t\t\ttargetScreenHeight = this.screenHeight;\n\t\t\t}\n\t\t\telse if (targetScreenWidth === null)\n\t\t\t{\n\t\t\t\ttargetScreenWidth = int(0.5 + this.screenWidth * (this.options.screenHeight / this.screenHeight));\n\t\t\t}\n\t\t\telse if (targetScreenHeight === null)\n\t\t\t{\n\t\t\t\ttargetScreenHeight = int(0.5 + this.screenHeight * (this.options.screenWidth / this.screenWidth));\n\t\t\t}\n\t\t}\n\n\t\t// ***\n\t\tlet screenWidth = targetScreenWidth;\n\t\tlet screenHeight = targetScreenHeight;\n\n\t\tif (this.orientation === 'automatic' && screenWidth && screenHeight)\n\t\t{\n\t\t\tif ((screenWidth > screenHeight && this.screenWidth < this.screenHeight) || (screenWidth < screenHeight && this.screenWidth > this.screenHeight))\n\t\t\t{\n\t\t\t\tscreenWidth = screenHeight;\n\t\t\t\tscreenHeight = targetScreenWidth;\n\t\t\t}\n\t\t}\n\n\t\t// ***\n\t\tthis.canvasScaleFactor = 1;\n\n\t\tif (screenWidth && screenHeight)\n\t\t{\n\t\t\tthis.canvasScaleFactor = Math.min(this.screenWidth / screenWidth, this.screenHeight / screenHeight);\n\t\t}\n\t\telse if (screenWidth)\n\t\t{\n\t\t\tthis.canvasScaleFactor = this.screenWidth / screenWidth;\n\t\t}\n\t\telse if (screenHeight)\n\t\t{\n\t\t\tthis.canvasScaleFactor = this.screenHeight / screenHeight;\n\t\t}\n\n\t\t// ***\n\t\tlet _screenWidth = this.screenWidth;\n\t\tlet _screenHeight = this.screenHeight;\n\n\t\tif (screenWidth) this.screenWidth = screenWidth;\n\t\tif (screenHeight) this.screenHeight = screenHeight;\n\n\t\tthis.offsX = int((_screenWidth - this.screenWidth*this.canvasScaleFactor)*0.5);\n\t\tthis.offsY = int((_screenHeight - this.screenHeight*this.canvasScaleFactor)*0.5);\n\n\t\tif (this.reverseRender)\n\t\t{\n\t\t\tlet tmp = this.offsX;\n\t\t\tthis.offsX = this.offsY;\n\t\t\tthis.offsY = tmp;\n\t\t}\n\n\t\tthis.scaleFactor = this.canvasScaleFactor * this.canvasPixelRatio;\n\t\tthis.scaleFactor = int(0.7 + this.scaleFactor);\n\n\t\tif (this.options.maxScaleFactor > 0 && this.scaleFactor > this.options.maxScaleFactor)\n\t\t\tthis.scaleFactor = this.options.maxScaleFactor;\n\n\t\tthis.flags.renderingEnabled = false;\n\n\t\t/*\n\t\t**\tIf the scale is not exact, the final canvas size might not fit the entire screen perfectly (will always be a little smaller in\n\t\t**\tsuch a case), when that happens the body's background color will be quite noticeable, to mitigate that we set the body background\n\t\t**\tto the same color as the primary canvas.\n\t\t*/\n\t\tif ('document' in global)\n\t\t\tglobal.document.body.style.backgroundColor = this.renderer.backgroundColor;\n\n\t\t/*\n\t\t**\tResize all display buffers.\n\t\t*/\n\t\tif (!this.reverseRender)\n\t\t{\n\t\t\tthis.renderer.resize (this.screenWidth*this.scaleFactor, this.screenHeight*this.scaleFactor);\n\t\t\tthis.renderer.elem.style.width = int(this.screenWidth*this.canvasScaleFactor+0.5) + \"px\";\n\t\t\tthis.renderer.elem.style.height = int(this.screenHeight*this.canvasScaleFactor+0.5) + \"px\";\n\n\t\t\tthis.displayBuffer2.resize (this.screenWidth*this.scaleFactor, this.screenHeight*this.scaleFactor);\n\t\t\tthis.displayBuffer2.elem.style.width = int(this.screenWidth*this.canvasScaleFactor+0.5) + \"px\";\n\t\t\tthis.displayBuffer2.elem.style.height = int(this.screenHeight*this.canvasScaleFactor+0.5) + \"px\";\n\n\t\t\tthis.displayBuffer3.resize (_screenWidth, _screenHeight);\n\t\t\tthis.displayBuffer3.elem.style.width = _screenWidth + \"px\";\n\t\t\tthis.displayBuffer3.elem.style.height = _screenHeight + \"px\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.renderer.resize (this.screenHeight*this.scaleFactor, this.screenWidth*this.scaleFactor);\n\t\t\tthis.renderer.elem.style.width = int(this.screenHeight*this.canvasScaleFactor+0.5) + \"px\";\n\t\t\tthis.renderer.elem.style.height = int(this.screenWidth*this.canvasScaleFactor+0.5) + \"px\";\n\n\t\t\tthis.displayBuffer2.resize (this.screenHeight*this.scaleFactor, this.screenWidth*this.scaleFactor);\n\t\t\tthis.displayBuffer2.elem.style.width = int(this.screenHeight*this.canvasScaleFactor+0.5) + \"px\";\n\t\t\tthis.displayBuffer2.elem.style.height = int(this.screenWidth*this.canvasScaleFactor+0.5) + \"px\";\n\n\t\t\tthis.displayBuffer3.resize (_screenHeight, _screenWidth);\n\t\t\tthis.displayBuffer3.elem.style.width = _screenHeight + \"px\";\n\t\t\tthis.displayBuffer3.elem.style.height = _screenWidth + \"px\";\n\t\t}\n\n\t\tthis.renderer.elem.style.marginLeft = this.offsX + \"px\";\n\t\tthis.renderer.elem.style.marginTop = this.offsY + \"px\";\n\n\t\tthis.displayBuffer2.elem.style.marginLeft = this.offsX + \"px\";\n\t\tthis.displayBuffer2.elem.style.marginTop = this.offsY + \"px\";\n\n\t\tthis.renderer.loadIdentity();\n\t\tthis.displayBuffer2.loadIdentity();\n\t\tthis.displayBuffer3.loadIdentity();\n\n\t\tif (this.scaleFactor != 1)\n\t\t{\n\t\t\tthis.renderer.globalScale(this.scaleFactor);\n\t\t\tthis.displayBuffer2.globalScale(this.scaleFactor);\n\t\t}\n\n\t\tif (this.reverseRender)\n\t\t{\n\t\t\tthis.renderer.rotate(Math.PI/2);\n\t\t\tthis.renderer.translate(-this.screenWidth, 0);\n\t\t\tthis.renderer.flipped(true);\n\n\t\t\tthis.displayBuffer2.rotate(Math.PI/2);\n\t\t\tthis.displayBuffer2.translate(-this.screenWidth, 0);\n\t\t\tthis.displayBuffer2.flipped(true);\n\n\t\t\tthis.displayBuffer3.rotate(Math.PI/2);\n\t\t\tthis.displayBuffer3.translate(-_screenWidth, 0);\n\t\t\tthis.displayBuffer3.flipped(true);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.renderer.flipped(false);\n\t\t\tthis.displayBuffer2.flipped(false);\n\t\t\tthis.displayBuffer3.flipped(false);\n\t\t}\n\n\t\t/* *** */\n\t\tthis.scaleFactor *= this.options.extraScaleFactor;\n\n\t\tif (this.options.maxScaleFactor > 0 && this.scaleFactor > this.options.maxScaleFactor)\n\t\t\tthis.scaleFactor = this.options.maxScaleFactor;\n\n\t\tthis.integerScaleFactor = int(this.scaleFactor + 0.5); //0.9\n\t\tthis.resetPerf();\n\n\t\tif (this.initialMatrix)\n\t\t\tthis.initialMatrix.free();\n\n\t\tthis.initialMatrix = this.renderer.getMatrix(true);\n\n\t\tif (notRendering != true)\n\t\t{\n\t\t\tthis.flags.renderingEnabled = true;\n\t\t\tthis.onCanvasResized (this.screenWidth, this.screenHeight);\n\t\t}\n\t},\n\n\t/**\n\t * \tEvent triggered when the canvas was resized by the system. Can be overriden.\n\t * \t!static onCanvasResized (screenWidth: number, screenHeight: number) : void;\n\t */\n\tonCanvasResized: function (screenWidth, screenHeight)\n\t{\n\t},\n\n\t/**\n\t * \tResets the performance data.\n\t */\n\tresetPerf: function()\n\t{\n\t\tthis.perf.startTime = hrnow();\n\t\tthis.perf.lastTime = hrnow();\n\n\t\tthis.perf.numFrames = 0;\n\t\tthis.perf.updateTimeTotal = 0;\n\t\tthis.perf.drawTimeTotal = 0;\n\t\tthis.perf.extraTimeTotal = 0;\n\n\t\tthis.perf.numSamples = 0;\n\t\tthis.perf.fps = 0;\n\t\tthis.perf.averageFps = 0;\n\t\tthis.perf.averageUpdateTime = 0;\n\t\tthis.perf.averageDrawTime = 0;\n\t\tthis.perf.averageExtraTime = 0;\n\t},\n\n\t/**\n\t * \tAdds the specified update handler to the system.\n\t * \t!updateQueueAdd (handler: { update: (dt: number) => void }) : Linkable;\n\t */\n\tupdateQueueAdd: function (handler)\n\t{\n\t\tthis.updateQueue.push (handler);\n\t\treturn this.updateQueue.bottom;\n\t},\n\n\t/**\n\t * \tRemoves the specified update handler from the system.\n\t * \t!updateQueueRemove (handler: { update: (dt: number) => void }) : void;\n\t */\n\t/**\n\t * \tRemoves the specified update handler node from the system.\n\t * \t!updateQueueRemove (node: Linkable) : void;\n\t */\n\tupdateQueueRemove: function (handler)\n\t{\n\t\tthis.updateQueue.remove (Linkable.isInstance(handler) ? handler : this.updateQueue.sgetNode(handler));\n\t},\n\n\t/**\n\t * \tAdds the specified draw handler to the system.\n\t * \t!drawQueueAdd (handler: { draw: (g: Canvas) => void }) : Linkable;\n\t */\n\tdrawQueueAdd: function (handler)\n\t{\n\t\tthis.drawQueue.push (handler);\n\t\treturn this.drawQueue.bottom;\n\t},\n\n\t/**\n\t * \tRemoves the specified draw handler from the system.\n\t * \t!drawQueueRemove (handler: { draw: (g: Canvas) => void }) : void;\n\t */\n\t/**\n\t * \tRemoves the specified draw handler node from the system.\n\t * \t!drawQueueRemove (node: Linkable) : void;\n\t */\n\tdrawQueueRemove: function (handler)\n\t{\n\t\tthis.drawQueue.remove (Linkable.isInstance(handler) ? handler : this.drawQueue.sgetNode(handler));\n\t},\n\n\t/**\n\t * \tAdds the specified handler to the update and draw queues.\n\t * \t!queueAdd (handler: { update: (dt: number) => void, draw: (g: Canvas) => void }) : void;\n\t */\n\tqueueAdd: function (handler)\n\t{\n\t\tthis.updateQueue.push (handler);\n\t\tthis.drawQueue.push (handler);\n\t},\n\n\t/**\n\t *\tRemoves the specified handler from the update and draw queues.\n\t * \t!queueRemove (handler: { update: (dt: number) => void, draw: (g: Canvas) => void }) : void;\n\t */\n\tqueueRemove: function (handler)\n\t{\n\t\tthis.updateQueue.remove (this.updateQueue.sgetNode(handler));\n\t\tthis.drawQueue.remove (this.drawQueue.sgetNode(handler));\n\t},\n\n\t/**\n\t * \tRuns an update cycle. All objects in the `updateQueue` will have their `update method called.\n\t */\n\tupdate: function (dt)\n\t{\n\t\ttry\n\t\t{\n\t\t\tlet next;\n\n\t\t\tfor (let elem = this.updateQueue.top; elem; elem = next)\n\t\t\t{\n\t\t\t\tnext = elem.next;\n\n\t\t\t\tif (elem.value.update(dt) === false)\n\t\t\t\t\tthis.updateQueueRemove(elem);\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tSystem.stop();\n\t\t\tthrow e;\n\t\t}\t\n\t},\n\n\t/**\n\t * \tRuns a rendering cycle. All objects in the `drawQueue` will have their `draw` method called.\n\t */\n\tdraw: function ()\n\t{\n\t\tif (this.renderer.gl !== null)\n\t\t\tthis.renderer.start();\n\n\t\tif (!this.options.overdraw)\n\t\t{\n\t\t\tthis.renderer.clear();\n\t\t\tthis.displayBuffer2.clear();\n\t\t\tthis.displayBuffer3.clear();\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tlet next;\n\n\t\t\tfor (let elem = this.drawQueue.top; elem; elem = next)\n\t\t\t{\n\t\t\t\tnext = elem.next;\n\t\t\t\telem.value.draw(this.renderer);\n\t\t\t}\n\n\t\t\tif (this.renderer.gl !== null)\n\t\t\t{\n\t\t\t\tthis.renderer.flush();\n\t\t\t\tthis.renderer.end();\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tSystem.stop();\n\t\t\tthrow e;\n\t\t}\t\n\t},\n\n\t/**\n\t * \tInterpolates numeric values between two objects (`src` and `dst`) using the specified `duration` and `easing` function. Note that all four parameters `src`, `dst`,\n\t * \t`duration` and `easing` must be objects having the same number of values.\n\t * \t!interpolate (src: object, dst: object, duration: object, easing: object, callback: (data: object, isFinished: boolean) => void) : void;\n\t */\n\tinterpolate: function (src, dst, duration, easing, callback)\n\t{\n\t\t//violet: not optimized\n\t\tlet time = { };\n\t\tlet data = { };\n\t\tlet count = 0;\n\n\t\tfor (let x in src)\n\t\t{\n\t\t\ttime[x] = 0.0;\n\t\t\tdata[x] = src[x]\n\t\t\tcount++;\n\t\t}\n\n\t\tlet interpolator =\n\t\t{\n\t\t\tupdate: function(dt)\n\t\t\t{\n\t\t\t\tfor (let x in time)\n\t\t\t\t{\n\t\t\t\t\tif (time[x] == duration[x])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\ttime[x] += dt;\n\t\t\t\t\tif (time[x] >= duration[x])\n\t\t\t\t\t{\n\t\t\t\t\t\ttime[x] = duration[x];\n\t\t\t\t\t\tcount--;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet t = easing[x] (time[x] / duration[x]);\n\t\t\t\t\tdata[x] = (1-t)*src[x] + t*dst[x];\n\t\t\t\t}\n\n\t\t\t\tcallback (data, count == 0);\n\n\t\t\t\tif (count == 0)\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t};\n\n\t\tSystem.updateQueueAdd(interpolator);\n\t\tinterpolator.update(0);\n\t},\n\n\t/**\n\t * \tEvent triggered when a keyboard event is detected by the system.\n\t * \tonKeyboardEvent (action: KeyboardEventType, keyCode: number, keyState: object) : void;\n\t */\n\tonKeyboardEvent: function (action, keyCode, keyState)\n\t{\n\t},\n\n\t/**\n\t * \tEvent triggered when a pointer event is detected by the system.\n\t * \tonPointerEvent (action: PointerEventType, pointer: object, pointers: object) : void;\n\t */\n\tonPointerEvent: function (action, pointer, pointers)\n\t{\n\t}\n};\n\n//!/class\n\n//!namespace System\n\n\t//!enum KeyboardEventType\n\tSystem.KeyboardEventType = {\n\t\tKEY_DOWN: 0x001,\n\t\tKEY_UP: 0x002,\n\n\t\t//!KEY_DOWN\n\t\t//!KEY_UP\n\t};\n\t//!/enum\n\n\t//!enum PointerEventType\n\tSystem.PointerEventType = {\n\t\tPOINTER_DOWN: \t\t0x010,\n\t\tPOINTER_UP: \t\t0x011,\n\t\tPOINTER_MOVE: \t\t0x012,\n\t\tPOINTER_DRAG_START:\t0x013,\n\t\tPOINTER_DRAG_MOVE:\t0x014,\n\t\tPOINTER_DRAG_STOP:\t0x015,\n\t\tPOINTER_WHEEL:\t\t0x016,\n\n\t\t//!POINTER_DOWN\n\t\t//!POINTER_UP\n\t\t//!POINTER_MOVE\n\t\t//!POINTER_DRAG_START\n\t\t//!POINTER_DRAG_MOVE\n\t\t//!POINTER_DRAG_STOP\n\t\t//!POINTER_WHEEL\n\t};\n\t//!/enum\n\n//!/namespace\n\nexport default System;\n","/*\n**\tsystem/log.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport System from './system.js';\nimport List from '../utils/list.js';\n\n//![import \"./system\"]\n//![import \"../utils/list\"]\n\n//:/**\n//: * \tLogging module to show logs on the system display buffer.\n//: */\n\n//!namespace Log\n\nconst Log =\n{\n\t/**\n\t * \tIndicates if the log module is enabled.\n\t *\t!let activated: boolean;\n\t */\n\tactivated: false,\n\n\t/**\n\t * \tIndicates if the log module is paused.\n\t * \t!let paused: boolean;\n\t */\n\tpaused: false,\n\n\t/**\n\t * \tMaximum number of entries to show in the screen.\n\t * \t!let maxsize: number;\n\t */\n\tmaxsize: 30,\n\n\tdata: List.Pool.alloc(),\n\tcount: 0,\n\n\n\t/**\n\t * \tIndicates if output showuld also be passed to `console.debug` as secondary echo.\n\t * \t!let debugEcho: boolean;\n\t */\n\tdebugEcho: false,\n\n\t/**\n\t * \tForeground (text) color.\n\t * \t!let color: string;\n\t */\n\tcolor: '#fff',\n\n\t/**\n\t * \tBackground color.\n\t * \t!let background: string;\n\t */\n\tbackground: '#cf266a',\n\n\t/**\n\t * \tDebugging variables to show continuously at the top of the log output.\n\t * \t!let vars: object;\n\t */\n\tvars: { },\n\n\t/**\n\t * \tWrites a message to the log buffer, ensure logging has been enabled by calling `enable` first or any messages will be ignored.\n\t * \t!function write (msg: string) : void;\n\t */\n\twrite: function (msg)\n\t{\n\t\tthis.data.push(msg);\n\t\tthis.count++;\n\n\t\twhile (this.data.length > this.maxsize)\n\t\t\tthis.data.shift();\n\n\t\tif (this.debugEcho)\n\t\t\tconsole.debug(this.count + \": \" + msg);\n\t},\n\n\t/**\n\t * \tClears the current log buffer.\n\t * \t!function clear () : void;\n\t */\n\tclear: function ()\n\t{\n\t\tthis.data.reset();\n\t\tthis.count = 0;\n\t},\n\n\t/**\n\t * \tEnables on-screen logging for cool stuff.\n\t *\n\t * \t@param x - X-coordinate of the top-left corner.\n\t * \t@param y - Y-coordinate of the top-left corner.\n\t * \t@param fontSize - Desired font size in `pt` units.\n\t * \t@param showFps - Set to `true` to show FPS.\n\t * \t@param showIndex - Set to `true to show the message index.\n\t *\n\t * \t!function enable (x?: number, y?: number, fontSize?: number, showFps?: boolean, showIndex?: boolean) : void;\n\t */\n\tenable: function (x=0, y=0, fontSize=9.5, showFps=true, showIndex=true)\n\t{\n\t\tif (this.activated) return;\n\t\tthis.activated = true;\n\n\t\tif (!showFps) y -= 16;\n\t\tlet _y = y;\n\n\t\tSystem.drawQueueAdd ({ draw: function ()\n\t\t{\n\t\t\tif (Log.paused) return;\n\n\t\t\tlet tmp = hrnow();\n\n\t\t\tconst g = System.displayBuffer3;\n\n\t\t\tg.font('bold '+fontSize+'pt Monospace');\n\t\t\tg.textBaseline('top');\n\n\t\t\tlet s = '';\n\n\t\t\ty = _y;\n\n\t\t\tif (showFps !== false && System.perf.fps != 0)\n\t\t\t{\n\t\t\t\ts = 'fps: ' + System.perf.fps + '/' + System.perf.averageFps + ', update: ' + System.perf.averageUpdateTime + ', draw: ' + System.perf.averageDrawTime + ', extra: ' + System.perf.averageExtraTime;\n\n\t\t\t\tif (Log.background) {\n\t\t\t\t\tg.fillStyle(Log.background);\n\t\t\t\t\tg.fillRect (x-3, y-1, g.measureText(s)+6, fontSize+5);\n\t\t\t\t}\n\n\t\t\t\tg.fillStyle(Log.color);\n\t\t\t\tg.fillText(s, x, y);\n\t\t\t}\n\n\t\t\ts = '';\n\n\t\t\tfor (let i in Log.vars)\n\t\t\t\ts += i + ': ' + Log.vars[i] + '  ';\n\n\t\t\tif (s !== '')\n\t\t\t{\n\t\t\t\ty += 24;\n\n\t\t\t\tif (Log.background) {\n\t\t\t\t\tg.fillStyle(Log.background);\n\t\t\t\t\tg.fillRect (x-3, y-1, g.measureText(s)+6, fontSize+5);\n\t\t\t\t}\n\n\t\t\t\tg.fillStyle(Log.color);\n\t\t\t\tg.fillText(s, x, y);\n\t\t\t}\n\n\t\t\tlet i = 0;\n\t\t\tfor (let ii = Log.data.top; ii; ii = ii.next, i++)\n\t\t\t{\n\t\t\t\ts = (showIndex ? \"#\" + (Log.count-Log.data.length+i+1) + \": \" : \"> \") + ii.value;\n\n\t\t\t\tif (Log.background) {\n\t\t\t\t\tg.fillStyle(Log.background);\n\t\t\t\t\tg.fillRect (x-3, y-1+7 + (fontSize+5)*(i+1) - 1, g.measureText(s)+6, fontSize+5);\n\t\t\t\t}\n\n\t\t\t\tg.fillStyle(Log.color);\n\t\t\t\tg.fillText(s, x, y-1+7 + (fontSize+5)*(i+1));\n\t\t\t}\n\n\t\t\ttmp = (hrnow() - tmp);\n\t\t\tSystem.perf.drawTimeTotal -= tmp;\n\t\t\tSystem.perf.extraTimeTotal += tmp;\n\t\t}});\n\t},\n\n\t/**\n\t * \tPauses log rendering.\n\t * \t!function pause () : void;\n\t */\n\tpause: function ()\n\t{\n\t\tthis.paused = true;\n\t\treturn;\n\t},\n\n\t/**\n\t * \tResumes log rendering.\n\t * \t!function resume () : void;\n\t */\n\tresume: function ()\n\t{\n\t\tthis.paused = false;\n\t\treturn;\n\t}\n};\n\nexport default Log;\n","/*\n**\tsystem/globals.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Random from './random.js';\nimport Log from './log.js';\n\n//![import \"./random\"]\n//![import \"./log\"]\n//![import \"../flow/viewport\"]\n\n//:/**\n//: * \tGlobal functions and definitions.\n//: */\n\n//!namespace globals\n\n/*\n**\tVariables and behavior flags, can be extended as needed from other modules.\n*/\nconst globals =\n{\n\t/**\n\t * \tRenderer's GL context.\n\t * \t!let gl: WebGL2RenderingContext;\n\t */\n\tgl: null,\n\n\t/**\n\t * \tGlobal system time, updated once per frame. Mirrors the `System.frameTime` property.\n\t *\t!let time: number;\n\t */\n\ttime: 0,\n\n\t/**\n\t * \tActive viewport (if any). Set by the `draw` method of the `Scene` class.\n\t * \t!let viewport: Viewport;\n\t */\n\tviewport: null,\n\n\t/**\n\t * \tIndicates if the element bounds should be drawn. Used by the `Element` class.\n\t * \t!let debugBounds: boolean;\n\t */\n\tdebugBounds: false,\n\n\t/**\n\t * \tIndicates if the mask bounds should be drawn. Used by the `Mask` class.\n\t * \t!let debugMasks: boolean;\n\t */\n\tdebugMasks: false,\n\n\t/**\n\t * \tGlobal random generators. Only `rand0` is used by the global random functions. The `rand1` and `rand2` can be used manually if desired.\n\t *\n\t * \t!const rand0: Random;\n\t * \t!const rand1: Random;\n\t * \t!const rand2: Random;\n\t */\n\trand0: new Random(),\n\trand1: new Random(),\n\trand2: new Random()\n};\n\nexport default globals;\n\n//!/namespace\n\n//!declare global\n\n/**\n * \tConverts the given pixel-value to actual screen pixels taking into account the current scale.\n *\n * \t!function px (value: number) : number;\n */\nglobal.px = function(value)\n{\n\treturn value*C.SCALE;\n};\n\n/**\n * \tDisposes an object by running the first method that is found in the following order: `free`, `dispose` and finally `__dtor`.\n *\n *\t!function dispose (obj: object) : void;\n */\nglobal.dispose = function (obj)\n{\n\tif (obj === null || typeof(obj) !== 'object')\n\t\treturn;\n\n\tif ('free' in obj)\n\t\treturn obj.free();\n\n\tif ('dispose' in obj)\n\t\treturn obj.dispose();\n\n\tif ('__dtor' in obj)\n\t\tobj.__dtor();\n};\n\n/**\n * \tGlobal audio context obtained when the system is initialized.\n *\n * \t!let audioContext: AudioContext;\n */\nif ('AudioContext' in global)\n{\n\tglobal.audioContext = new AudioContext({ latencyHint: 'interactive', sampleRate: 44100 });\n\tLog.write('AudioContext: baseLatency=' + ~~(global.audioContext.baseLatency*1000) + ' ms' );\n}\nelse\n\tglobal.audioContext = null;\n\n/**\n * \tSimilar to `fetch` but uses XMLHttpRequest because in some mobile browsers regular mode does not work well with ArrayBuffers.\n *\n * \t!function fetchd (url: string, options?: object) : Promise<object>;\n */\nglobal.fetchd = function (url, options)\n{\n\treturn new Promise ((resolve, reject) =>\n\t{\n\t\tif (!options) options = { };\n\t\tif (!('responseType' in options)) options.responseType = 'arraybuffer';\n\n\t\tvar request = new XMLHttpRequest();\n\t\trequest.open('GET', url, true);\n\n\t\tfor (let i in options) request[i] = options[i];\n\n\t\trequest.onload = function() {\n\t\t\tresolve (request.response);\n\t\t};\n\n\t\trequest.onerror = function() {\n\t\t\treject ('Unable to fetch specified resource.');\n\t\t};\n\n\t\trequest.send();\n\t});\n};\n\n/**\n * \tLoads an arraybuffer from the specified URL and converts it to a AudioBuffer using the global audioContext.\n *\n * \t!function fetchAudioBuffer (url: string) : Promise<AudioBuffer>;\n */\nglobal.fetchAudioBuffer = function (url)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tif (!global.audioContext)\n\t\t{\n\t\t\treject ('AudioContext is not available.');\n\t\t\treturn;\n\t\t}\n\n\t\tfetchd(url)\n\t\t.then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))\n\t\t.then(audioBuffer => resolve(audioBuffer))\n\t\t.catch(err => reject(err));\n\t});\n};\n\n\n/**\n * \tReturns the value as an integer.\n *\n *\t!function int (value: number|string) : number;\n */\nglobal.int = function (value)\n{\n\treturn value >> 0;\n};\n\n/**\n * \tReturns the value as a boolean.\n *\n * \t!function bool (value: number|string|boolean) : number;\n */\nglobal.bool = function (value)\n{\n\tif (value === true || value === false)\n\t\treturn value;\n\n\tif (value == 'true')\n\t\treturn true;\n\n\tif (value == 'false')\n\t\treturn false;\n\n\treturn !(!value);\n};\n\n/**\n * \tReturns the value as a floating point number.\n *\n * \t!function float (value: number|string) : number;\n */\nglobal.float = function (value)\n{\n\treturn parseFloat(value);\n};\n\n/**\n * \tReturns the value truncated to 2 digits of precision.\n *\n * \t!function float2 (value: number) : number;\n */\nglobal.float2 = function (value)\n{\n\treturn (int(value*100))/100;\n};\n\n/**\n * \tReturns the value truncated to 3 digits of precision.\n *\n * \t!function float3 (value: number) : number;\n */\nglobal.float3 = function (value)\n{\n\treturn (int(value*1000))/1000;\n};\n\n/**\n * \tReturns the value truncated to 4 digits of precision.\n *\n * \t!function float4 (value: number) : number;\n */\nglobal.float4 = function (value)\n{\n\treturn (int(value*10000))/10000;\n};\n\n/**\n * \tConverts the given value to radians.\n *\n * \t!function rad (value: number) : number;\n */\nglobal.rad = function (value)\n{\n\treturn value*Math.PI / 180;\n};\n\n/**\n * \tConverts the given value to degrees.\n *\n * \t!function deg (value: number) : number;\n */\nglobal.deg = function (value)\n{\n\treturn (value/Math.PI)*180;\n};\n\n/**\n * \tReturns a random integer value from 0 to 0xFFFF (inclusive).\n *\n * \t!function rand() : number;\n */\nglobal.rand = function ()\n{\n\treturn globals.rand0.nextInt16();\n};\n\n/**\n * \tReturns a random float from 0 to 1 (inclusive).\n *\n * \t!function randf() : number;\n */\nglobal.randf = function ()\n{\n\treturn globals.rand0.nextFloat();\n};\n\n/**\n * \tReturns a random float within the given (inclusive) range.\n *\n * \t!function randrf (startValue: number, endValue: number) : number;\n */\nglobal.randrf = function (a, b)\n{\n\tlet t = globals.rand0.nextFloat();\n\treturn t*b + (1-t)*a;\n};\n\n/**\n * \tReturns a random integer within the given range (inclusive).\n *\n * \t!function randr (startValue: number, endValue: number) : number;\n */\nglobal.randr = function (a, b)\n{\n\tlet t = globals.rand0.nextFloat();\n\treturn Math.round(t*b + (1-t)*a);\n};\n\n/**\n * \tReturns a table (array) of N random float numbers within the given range (inclusive).\n *\n * \t!function randtf (startValue: number, endValue: number, n: number) : Array<number>;\n */\nglobal.randtf = function (a, b, n)\n{\n\tvar list = [ ];\n\n\tfor (var i = 0; i < n; i++)\n\t\tlist.push(randrf(a, b));\n\n\treturn list;\n};\n\n/**\n * \tReturns the high-resolution `now` counter in milliseconds (includes possibly microseconds in fractional part).\n *\n * \t!function hrnow () : number;\n */\nglobal.hrnow = function ()\n{\n\treturn performance.now();\n};\n\n/**\n * \tReturns a function that when called produces a random integer value within the given (inclusive) range.\n *\n * \t!function randvar (startValue: number, endValue: number) : () => number;\n */\nglobal.randvar = function (a, b)\n{\n\treturn function() { return randr(a, b); };\n};\n\n/**\n * \tReturns a function that when called returns an item from the specified array at some random index within the (inclusive) range.\n *\n * \t!function randitem (arr: Array<any>, startValue?: number, endValue?: number) : () => any;\n */\nglobal.randitem = function (arr, a=null, b=null)\n{\n\tif (a === null) a = 0;\n\tif (b === null) b = arr.length - 1;\n\n\treturn function() { return arr[randr(a, b)]; };\n};\n\n/**\n * \tReturns the parameter 't' where two line segments intersect.\n *\n * \t!function getLineSegmentIntersection (ls1_x1: number, ls1_y1: number, ls1_x2: number, ls1_y2: number, ls2_x1: number, ls2_y1: number, ls2_x2: number, ls2_y2: number) : number;\n */\nglobal.getLineSegmentIntersection = function (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2)\n{\n\t// Case #1: Identical segments.\n\tif (ls1_x1 == ls2_x1 && ls1_y1 == ls2_y1 && ls1_x2 == ls2_x2 && ls1_y2 == ls2_y2)\n\t\treturn 0;\n\n\tlet inf = 2.0;\n\n\tvar dyA = ls1_y2 - ls1_y1;\n\tvar dxA = ls1_x2 - ls1_x1;\n\tvar dyB = ls2_y2 - ls2_y1;\n\tvar dxB = ls2_x2 - ls2_x1;\n\n\t// Case #2: Horizontal vs. Horizontal\n\tif (dyA == 0 && dyB == 0)\n\t{\n\t\tif (ls1_y1 != ls2_y1) return inf;\n\n\t\tvar x1 = Math.max(ls1_x1, ls2_x1);\n\t\tvar x2 = Math.min(ls1_x2, ls2_x2);\n\n\t\tif (x1 > x2) return inf;\n\n\t\treturn (x1 - ls1_x1) / dxA;\n\t}\n\n\t// Case #3: Vertical vs. Vertical\n\tif (dxA == 0 && dxB == 0)\n\t{\n\t\tif (ls1_x1 != ls2_x1) return inf;\n\n\t\tvar y1 = Math.max(ls1_y1, ls2_y1);\n\t\tvar y2 = Math.min(ls1_y2, ls2_y2);\n\n\t\tif (y1 > y2) return inf;\n\n\t\treturn (y1 - ls1_y1) / dyA;\n\t}\n\n\t// Case #4: Vertical vs. Horizontal or Sloped\n\tif (dxA == 0)\n\t{\n\t\tvar tA = (dyB*(ls1_x1 - ls2_x1) + dxB*(ls2_y1 - ls1_y1)) / (dxB * dyA);\n\t\tif (0 > tA || tA > 1) return inf;\n\n\t\tvar tB = (ls1_x1 - ls2_x1) / dxB; \n\t\tif (0 > tB || tB > 1) return inf;\n\n\t\treturn tA;\n\t}\n\n\t// Case #5: Regular line segments.\n\tvar a = dyA*(ls2_x1 - ls1_x1) + dxA*(ls1_y1 - ls2_y1);\n\tvar b = dyB*dxA - dxB*dyA;\n\n\tif (b == 0) return inf;\n\n\tvar tB = a / b;\n\tif (0 > tB || tB > 1) return inf;\n\n\tvar tA = (dxB*tB + ls2_x1 - ls1_x1) / dxA;\n\tif (0 > tA || tA > 1) return inf;\n\n\treturn tA;\n};\n\n/**\n * \tReturns boolean indicating if the line segments intersect.\n *\n * \t!function lineSegmentIntersects (ls1_x1: number, ls1_y1: number, ls1_x2: number, ls1_y2: number, ls2_x1: number, ls2_y1: number, ls2_x2: number, ls2_y2: number) : boolean;\n */\nglobal.lineSegmentIntersects = function (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2)\n{\n\tlet t = getLineSegmentIntersection (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2);\n\treturn t >= 0 && t <= 1.0;\n};\n\n/**\n * \tRotates a point (2d) by the given angle and returns an object having x and y properties.\n * \n * \t!function rotatePoint (angle: number, x: number, y: number) : { x: number, y: number };\n */\nglobal.rotatePoint = function (angle, x, y)\n{\n\treturn { x: x*Math.cos(angle) + y*Math.sin(angle), y: y*Math.cos(angle) - x*Math.sin(angle) };\n};\n\n/**\n * \tReturns a value snapped to a step within the given range.\n * \n * \t!function stepValue (value: number, minValue: number, maxValue: number, numSteps: number) : number;\n */\nglobal.stepValue = function (value, minValue, maxValue, numSteps)\n{\n\treturn ((Math.round(numSteps * (value - minValue) / (maxValue - minValue))) / numSteps) * (maxValue - minValue) + minValue;\n};\n\n/**\n * \tReturns a value that is a factor of the specified step.\n * \n * \t!function alignValue (value: number, step: number) : number;\n */\nglobal.alignValue = function (value, step)\n{\n\treturn Math.round(value/step)*step;\n};\n\n/**\n * \tNumber of bits for fixed-point number (default is 8).\n * \n * \t!let FIXED_POINT_BITS : number;\n*/\nglobal.FIXED_POINT_BITS = 8;\n\n/**\n * \tReturns a fixed-point upscaled value.\n * \n * \t!function upscale (value: number) : number;\n */\nglobal.upscale = function (value)\n{\n\treturn (value * (1 << FIXED_POINT_BITS)) >> 0;\n};\n\n/**\n * \tDownscales a fixed-point value to its integer part.\n * \n * \t!function downscale (value: number) : number;\n */\nglobal.downscale = function (value)\n{\n\treturn value >> FIXED_POINT_BITS;\n};\n\n/**\n * \tDownscales a fixed-point value to floating point.\n * \n * \t!function downscalef (value: number) : number;\n */\nglobal.downscalef = function (value)\n{\n\treturn value / (1 << FIXED_POINT_BITS);\n};\n\n/**\n * \tAligns a value to its fixed point floating point representation such that downscaling results in an integer.\n * \n * \t!function falign (value: number) : number;\n */\nglobal.falign = function (value)\n{\n\treturn downscalef(upscale(value));\n};\n\n/**\n * \tReturns the value having the minimum absolute value.\n * \n * \t!function absmin (a: number, b: number) : number;\n */\nglobal.absmin = function(a, b)\n{\n\treturn Math.abs(a) < Math.abs(b) ? a : b;\n};\n\n/**\n * \tReturns the value having the maximum absolute value.\n * \n * \t!function absmax (a: number, b: number) : number;\n */\nglobal.absmax = function(a, b)\n{\n\treturn Math.abs(a) > Math.abs(b) ? a : b;\n};\n","/*\n**\tsystem/perf.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n//!class Perf\n\n/**\n * \tInitializes the performance monitoring instance.\n *\n * \t@param accumSize - Maximum amount of samples to accumulate.\n * \t@param expectedValue - Expected value (average) of resulting samples.\n * \n * \t!constructor (accumSize: number, expectedValue?: number);\n */\nconst Perf = function (accumSize, expectedValue=null)\n{\n\tthis.data = [ ];\n\tthis.accumSize = accumSize;\n\n\tthis.expectedValue = expectedValue;\n\n\tthis.lastFeed = 0;\n\tthis.lastUpdate = 0;\n\n\tthis.stdSum = 0;\n\tthis.stdCount = 0;\n};\n\nexport default Perf;\n\n/**\n * \tMarks the start time of a performance test.\n * \t!begin() : void;\n */\nPerf.prototype.begin = function () {\n\tthis.startTime = performance.now();\n};\n\n/**\n * \tMarks the end time of the performance test, the elapsed time is fed into the monitor.\n * \t!end() : void;\n */\nPerf.prototype.end = function () {\n\tthis.feed (performance.now() - this.startTime);\n};\n\n/**\n * \tFeeds a value into the monitor, auto-generates a report using `console.log` when the number of samples reaches the `accumSize` specified in the constructor.\n * \t!feed (value: number) : void;\n */\nPerf.prototype.feed = function (value)\n{\n\tthis.data.push(value);\n\tthis.lastFeed++;\n\n\tif (this.data.length != this.accumSize)\n\t\treturn;\n\n\tthis.report();\n\tthis.data = [ ];\n};\n\n/**\n * \tUpdates the `min`, `max`, `avg` `std`, `stdSum` and `stdCount` fields of the object.\n * \t!update () : void;\n */\nPerf.prototype.update = function ()\n{\n\tlet min = null;\n\tlet max = null;\n\tlet avg = 0;\n\tlet std = 0;\n\n\tfor (let i = 0; i < this.data.length; i++)\n\t{\n\t\tmin = min === null ? this.data[i] : Math.min(min, this.data[i]);\n\t\tmax = max === null ? this.data[i] : Math.max(max, this.data[i]);\n\t\tavg += this.data[i];\n\t}\n\n\tavg /= this.data.length;\n\n\tlet e = this.expectedValue !== null ? this.expectedValue : avg;\n\n\tfor (let i = 0; i < this.data.length; i++) std += Math.pow(this.data[i] - e, 2);\n\n\tstd = Math.sqrt(std / this.data.length);\n\n\tthis.stdSum += std;\n\tthis.stdCount++;\n\n\tthis.min = min;\n\tthis.max = max;\n\tthis.avg = avg;\n\tthis.std = std;\n\n\tthis.lastUpdate = this.lastFeed;\n\treturn this;\n};\n\n/**\n * \tReturns a report string with the values selected by the specified flags.\n * \t!report (flags: Perf.Flags) : string;\n */\nPerf.prototype.report = function (flags=255)\n{\n\tlet out = '';\n\n\tif (this.lastUpdate != this.lastFeed)\n\t\tthis.update();\n\n\tif (flags & Perf.Flags.SAMPLES) out += 'n: ' + this.stdCount;\n\tif (flags & Perf.Flags.MIN) out += (out != '' ? ', ' : '') + 'min: ' + this.min;\n\tif (flags & Perf.Flags.MAX) out += (out != '' ? ', ' : '') + 'max: ' + this.max;\n\tif (flags & Perf.Flags.AVG) out += (out != '' ? ', ' : '') + 'avg: ' + this.avg.toFixed(2);\n\tif (flags & Perf.Flags.EXPECTED) out += (out != '' ? ', ' : '') + (this.expectedValue !== undefined ? 'e: ' + this.expectedValue : '');\n\tif (flags & Perf.Flags.STDDEV) out += (out != '' ? ', ' : '') + 'stddev: ' + this.std.toFixed(2);\n\tif (flags & Perf.Flags.AVG_STDDEV) out += (out != '' ? ', ' : '') + 'avg_stddev: ' + (this.stdSum / this.stdCount).toFixed(2)\n\n\treturn out;\n};\n\n//!/class\n\n//!namespace Perf\n//!enum Flags\n\nPerf.Flags = {\n\tSAMPLES: 1,\n\t//!SAMPLES\n\tMIN: 2,\n\t//!MIN\n\tMAX: 4,\n\t//!MAX\n\tAVG: 8,\n\t//!AVG\n\tEXPECTED: 16,\n\t//!EXPECTED\n\tSTDDEV: 32,\n\t//!STDDEV\n\tAVG_STDDEV: 64,\n\t//!AVG_STDDEV\n\tALL: 255,\n\t//!ALL\n};\n\n//!/enum\n","/*\n**\tsystem/framebuffer.js\n**\n**\tCopyright (c) 2021-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport globals from './globals.js';\nimport System from './system.js';\n\n//![import \"./globals\"]\n//![import \"./system\"]\n\n/*\n *\tDescribes a GL framebuffer.\n */\n\nconst Framebuffer = Class.extend\n({\n\t/**\n\t *\tShader GL identifier.\n\t */\n\tframebufferId: null,\n\n\t/**\n\t *\tAttachments of the framebuffer.\n\t */\n\tattachments: null,\n\n\t/**\n\t *\tType of each attachment.\n\t */\n\tattachmentTypes: null,\n\n\t/**\n\t *\tWidth of the framebuffer.\n\t */\n\twidth: 0,\n\n\t/**\n\t *\tHeight of the framebuffer.\n\t */\n\theight: 0,\n\n\t/**\n\t *\tEnabled draw buffers.\n\t */\n\tdrawBuffers: null,\n\tdrawBufferIds: null,\n\n\t/**\n\t *\tConstructs a GL framebuffer.\n\t *\n\t * \t@param {number} width\n\t * \t@param {number} height\n\t */\n\t__ctor: function (width=null, height=null)\n\t{\n\t\tif (globals.gl === null)\n\t\t\treturn;\n\n\t\tif (attachmentPointIds[0] === null)\n\t\t\tinitAttachmentPointIds(globals.gl);\n\n\t\tthis.framebufferId = globals.gl.createFramebuffer();\n\n\t\tthis.drawBuffers = [];\n\t\tthis.drawBufferIds = [];\n\n\t\t//violet:hardware scaling\n\t\t//this.width = width || System.screenWidth;\n\t\t//this.height = height || System.screenHeight;\n\n\t\tthis.width = width || System.renderer.width;\n\t\tthis.height = height || System.renderer.height;\n\n\t   \tthis.attachments = new Array(Framebuffer.MAX_ATTACHMENT_POINTS).fill(null);\n\t   \tthis.attachmentTypes = new Array(Framebuffer.MAX_ATTACHMENT_POINTS).fill(null);\n\t},\n\n\t/**\n\t * \tDestroys the framebuffer and all attached textures.\n\t */\n\t__dtor: function ()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return;\n\n\t\tfor (let i = 0; i < this.attachments.length; i++)\n\t\t{\n\t\t\tif (this.attachments[i] !== null)\n\t\t\t{\n\t\t\t\tif (this.attachmentTypes[i] === Framebuffer.TEXTURE)\n\t\t\t\t\tgl.deleteTexture(this.attachments[i]);\n\t\t\t\telse\n\t\t\t\t\tgl.deleteRenderbuffer(this.attachments[i]);\n\t\t\t}\n\t\t}\n\n\t\tgl.deleteFramebuffer(this.frameBufferId);\n\t},\n\n\t/**\n\t * \tAttaches a texture to a framebuffer attachment point.\n\t *\n\t * \t@param {number} attachmentPoint\n\t * \t@param {any} texture\n\t * \t@param {number} type\n\t */\n\tattach: function (attachmentPoint, texture, type=null)\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return;\n\n\t\tif (type === null)\n\t\t\ttype = attachmentPoint < Framebuffer.DEPTH ? Framebuffer.TEXTURE : Framebuffer.RENDERBUFFER;\n\n\t\tthis.attachments[attachmentPoint] = texture;\n\t\tthis.attachmentTypes[attachmentPoint] = type;\n\n\t\tif (attachmentPoint < Framebuffer.DEPTH && this.drawBuffers.indexOf(attachmentPoint) === -1)\n\t\t{\n\t\t\tthis.drawBuffers.push(attachmentPoint);\n\t\t\tthis.drawBufferIds.push(attachmentPointIds[attachmentPoint]);\n\t\t}\n\n\t\tlet prev = gl.getParameter(gl.FRAMEBUFFER_BINDING);\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, this.framebufferId);\n\n\t\tswitch (type)\n\t\t{\n\t\t\tcase Framebuffer.TEXTURE:\n\t\t\t\tgl.framebufferTexture2D (gl.FRAMEBUFFER, attachmentPointIds[attachmentPoint], gl.TEXTURE_2D, texture, 0);\n\t\t\t\tbreak;\n\n\t\t\tcase Framebuffer.RENDERBUFFER:\n\t\t\t\tgl.framebufferRenderbuffer (gl.FRAMEBUFFER, attachmentPointIds[attachmentPoint], gl.RENDERBUFFER, texture);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, prev);\n\t},\n\n\t/**\n\t * \tCreates a new color buffer texture.\n\t *\n\t * \t@param {number} width\n\t * \t@param {number} height\n\t * \t@returns {GLTexture}\n\t */\n\tcreateColorBuffer: function (attachmentPoint, width=null, height=null)\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return null;\n\n\t\tif (width === null) width = this.width;\n\t\tif (height === null) height = this.height;\n\n\t\tlet tex = gl.createTexture();\n\t\tgl.bindTexture (gl.TEXTURE_2D, tex);\n\n\t\tgl.texStorage2D (gl.TEXTURE_2D, 1, gl.RGBA8, width, height);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n\t\tthis.attach(attachmentPoint, tex);\n\t\treturn tex;\n\t},\n\n\t/**\n\t * \tCreates a new depth buffer texture.\n\t *\n\t * \t@param {number} width\n\t * \t@param {number} height\n\t * \t@returns {GLTexture}\n\t */\n\tcreateDepthBuffer: function (width=null, height=null)\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return null;\n\n\t\tif (width === null) width = this.width;\n\t\tif (height === null) height = this.height;\n\n\t\tlet tex = gl.createRenderbuffer();\n\t\tgl.bindRenderbuffer (gl.RENDERBUFFER, tex);\n\t\tgl.renderbufferStorage (gl.RENDERBUFFER, gl.DEPTH_COMPONENT24, width, height);\n\n\t\tthis.attach(Framebuffer.DEPTH, tex);\n\t\treturn tex;\n\t},\n\n\t/**\n\t * \tCreates a new stencil buffer texture.\n\t *\n\t * \t@param {number} width\n\t * \t@param {number} height\n\t * \t@returns {GLTexture}\n\t */\n\tcreateStencilBuffer: function (width=null, height=null)\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return null;\n\n\t\tif (width === null) width = this.width;\n\t\tif (height === null) height = this.height;\n\n\t\tlet tex = gl.createTexture();\n\t\tgl.bindTexture (gl.TEXTURE_2D, tex);\n\n\t\tgl.texStorage2D (gl.TEXTURE_2D, 1, gl.DEPTH_STENCIL, width, height);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\tgl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n\t\tthis.attach(Framebuffer.DEPTH_STENCIL, tex);\n\t\treturn tex;\n\t},\n\n\t/**\n\t * \tReturns a texture from the specified attachment point.\n\t * \t@param {number} attachmentPoint \n\t */\n\tgetTexture: function (attachmentPoint)\n\t{\n\t\tif (this.attachmentTypes[attachmentPoint] !== Framebuffer.TEXTURE)\n\t\t\treturn null;\n\n\t\treturn this.attachments[attachmentPoint];\n\t},\n\n\t/**\n\t * \tReturns a renderbuffer from the specified attachment point.\n\t * \t@param {number} attachmentPoint \n\t */\n\tgetRenderBuffer: function (attachmentPoint)\n\t{\n\t\tif (this.attachmentTypes[attachmentPoint] !== Framebuffer.RENDERBUFFER)\n\t\t\treturn null;\n\n\t\treturn this.attachments[attachmentPoint];\n\t},\n\n\t/**\n\t *\tBinds the framebuffer for further operations.\n\t */\n\tbind: function()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return;\n\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, this.framebufferId);\n\n\t\tgl.drawBuffers (this.drawBufferIds);\n\t\tgl.viewport (0, 0, this.width, this.height);\n\t},\n\n\t/**\n\t *\tBinds the default framebuffer.\n\t */\n\tunbind: function()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return;\n\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, null);\n\n\t\tgl.drawBuffers (defaultDrawBuffers);\n\t\tgl.viewport (0, 0, System.renderer.width, System.renderer.height);\n\t},\n\n\t/**\n\t *\tReturns the status of the framebuffer. Returns true if the framebuffer is complete.\n\t */\n\tisComplete: function()\n\t{\n\t\tlet gl = globals.gl;\n\t\tif (gl === null) return true;\n\n\t\tlet prev = gl.getParameter(gl.FRAMEBUFFER_BINDING);\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, this.framebufferId);\n\t\tlet result = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n\t\tgl.bindFramebuffer (gl.FRAMEBUFFER, prev);\n\n\t\treturn result === gl.FRAMEBUFFER_COMPLETE;\n\t}\n\n});\n\n/**\n *\tTypes of attachment objects.\n */\nFramebuffer.TEXTURE = 1;\nFramebuffer.RENDERBUFFER = 2;\n\n/**\n *\tAvailable attachment points.\n */\nFramebuffer.COLOR0\t\t\t= 0;\nFramebuffer.COLOR1\t\t\t= 1;\nFramebuffer.COLOR2\t\t\t= 2;\nFramebuffer.COLOR3\t\t\t= 3;\nFramebuffer.COLOR4\t\t\t= 4;\nFramebuffer.COLOR5\t\t\t= 5;\nFramebuffer.COLOR6\t\t\t= 6;\nFramebuffer.COLOR7\t\t\t= 7;\nFramebuffer.DEPTH \t\t\t= 8;\nFramebuffer.STENCIL \t\t= 9;\nFramebuffer.DEPTH_STENCIL\t= 10;\n\nFramebuffer.MAX_ATTACHMENT_POINTS = 11;\n\n/**\n *\tGL framebuffer attachment point IDs.\n */\nconst attachmentPointIds = new Array(Framebuffer.MAX_ATTACHMENT_POINTS).fill(null);\nconst defaultDrawBuffers = new Array(1).fill(null);\n\n/**\n * \tInitializes the attachment point IDs.\n */\nconst initAttachmentPointIds = function (gl)\n{\n\tdefaultDrawBuffers[0] = gl.BACK;\n\n\tattachmentPointIds[Framebuffer.COLOR0] = gl.COLOR_ATTACHMENT0;\n\tattachmentPointIds[Framebuffer.COLOR1] = gl.COLOR_ATTACHMENT1;\n\tattachmentPointIds[Framebuffer.COLOR2] = gl.COLOR_ATTACHMENT2;\n\tattachmentPointIds[Framebuffer.COLOR3] = gl.COLOR_ATTACHMENT3;\n\tattachmentPointIds[Framebuffer.COLOR4] = gl.COLOR_ATTACHMENT4;\n\tattachmentPointIds[Framebuffer.COLOR5] = gl.COLOR_ATTACHMENT5;\n\tattachmentPointIds[Framebuffer.COLOR6] = gl.COLOR_ATTACHMENT6;\n\tattachmentPointIds[Framebuffer.COLOR7] = gl.COLOR_ATTACHMENT7;\n\tattachmentPointIds[Framebuffer.DEPTH] = gl.DEPTH_ATTACHMENT;\n\tattachmentPointIds[Framebuffer.STENCIL] = gl.STENCIL_ATTACHMENT;\n\tattachmentPointIds[Framebuffer.DEPTH_STENCIL] = gl.DEPTH_STENCIL_ATTACHMENT;\n};\n\nexport default Framebuffer;\n","/*\n**\tflow/drawable.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rinn, Class } from 'rinn';\n\n//:/**\n//: * \tDescribes an object that can be drawn to a Canvas.\n//: */\n\n//!class Drawable\n\nconst Drawable = Class.extend\n({\n\tclassName: 'Drawable',\n\n\t/**\n\t * Image resource.\n\t * @protected\n\t * !readonly resource: HTMLImageElement|Canvas;\n\t */\n\tresource: null,\n\n\t/**\n\t * Width of the drawable.\n\t * @protected\n\t * !readonly width: number;\n\t */\n\twidth: 0,\n\n\t/**\n\t * Height of the drawable.\n\t * @protected\n\t * !readonly height: number;\n\t */\n\theight: 0,\n\n\t/**\n\t * Frame X-position.\n\t * @protected\n\t * !readonly x: number;\n\t */\n\tx: 0,\n\n\t/**\n\t * Frame Y-position.\n\t * @protected\n\t * !readonly y: number;\n\t */\n\ty: 0,\n\n\t/**\n\t * Initializes the instance.\n\t * !construct();\n\t */\n\t__ctor: function (resource=null, width=null, height=null)\n\t{\n\t\tif (Rinn.isInstanceOf(resource, Drawable))\n\t\t{\n\t\t\tlet drawable = resource;\n\t\t\tthis.resource = drawable.resource;\n\t\t\tthis.width = width ?? drawable.width;\n\t\t\tthis.height = height ?? drawable.height;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.resource = resource;\n\t\t\tthis.width = resource ? (width ?? resource.targetWidth) : 0;\n\t\t\tthis.height = resource ? (height ?? resource.targetHeight) : 0;\n\t\t}\n\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\t},\n\n\t/**\n\t * Returns the actual independent drawable object.\n\t * !getDrawable(): Drawable;\n\t */\n\tgetDrawable: function()\n\t{\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the underlying Image object, can be used directly with Canvas.drawImage.\n\t * !getImage(): HTMLImageElement|Canvas;\n\t */\n\tgetImage: function()\n\t{\n\t\treturn this.resource;\n\t},\n\n\t/**\n\t * Draws the drawable on the given canvas.\n\t * !draw (g: Canvas, x?: number, y?: number, width?: number, height?: number) : void;\n\t */\n\tdraw: function (g, x=0, y=0, width=null, height=null)\n\t{\n\t\tg.drawImage (this.resource,\n\t\t\t\tthis.x, this.y, this.resource.width, this.resource.height,\n\t\t\t\tx, y, width ?? this.resource.targetWidth, height ?? this.resource.targetHeight,\n\t\t\t\tnull, null, this.width, this.height);\n\t},\n\n\t/**\n\t * Renders the drawable for the specified element.\n\t * !render (g: Canvas, elem: Element) : void;\n\t */\n\trender: function (g, elem)\n\t{\n\t\tthis.draw (g, elem.bounds.x1, elem.bounds.y1, elem.bounds.width(), elem.bounds.height());\n\t}\n});\n\n\n/**\n * Nine-Slice Drawable.\n */\nconst NineSlice = Drawable.extend\n({\n\tclassName: 'DrawableNineSlice',\n\n\tss: null,\n\tstartingIndex: 0,\n\n\t__ctor: function (spritesheet, startingIndex)\n\t{\n\t\tthis._super.Drawable.__ctor(spritesheet);\n\n\t\tif (spritesheet === null || !Class.instanceOf(spritesheet, 'Spritesheet'))\n\t\t\tthrow new Error('NineSlice: spritesheet required');\n\n\t\tthis.ss = spritesheet;\n\t\tthis.startingIndex = startingIndex;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.ss);\n\t},\n\n\tgetImage: function()\n\t{\n\t\treturn this.ss.getImage();\n\t},\n\n\tdraw: function (g, x=0, y=0, width=null, height=null)\n\t{\n\t\tconst k = this.startingIndex;\n\n\t\tlet leftWidth = this.ss.getFrame(k+0).width;\n\t\tlet rightWidth = this.ss.getFrame(k+2).width;\n\t\tlet midWidth = this.ss.getFrame(k+1).width;\n\n\t\tlet topHeight = this.ss.getFrame(k+0).height;\n\t\tlet bottomHeight = this.ss.getFrame(k+6).height;\n\t\tlet midHeight = this.ss.getFrame(k+3).height;\n\n\t\tlet n = int((width - leftWidth - rightWidth) / midWidth);\n\t\tlet m = int((height - topHeight - bottomHeight) / midHeight);\n\n\t\tlet x1 = x;\n\t\tlet y1 = y;\n\n\t\t// Corners\n\t\tthis.ss.getFrame(k+0).draw(g, x1, y1);\n\t\tthis.ss.getFrame(k+2).draw(g, x1 + leftWidth + n*midWidth, y1);\n\t\tthis.ss.getFrame(k+6).draw(g, x1, y1 + topHeight + m*midHeight);\n\t\tthis.ss.getFrame(k+8).draw(g, x1 + leftWidth + n*midWidth, y1 + topHeight + m*midHeight);\n\n\t\t// Top/Bottom\n\t\tfor (let i = 0; i < n; i++) {\n\t\t\tthis.ss.getFrame(k+1).draw(g, x1 + leftWidth + i*midWidth, y1);\n\t\t\tthis.ss.getFrame(k+7).draw(g, x1 + leftWidth + i*midWidth, y1 + topHeight + m*midHeight);\n\t\t}\n\n\t\t// Left/Right\n\t\tfor (let i = 0; i < m; i++) {\n\t\t\tthis.ss.getFrame(k+3).draw(g, x1, y1 + topHeight + i*midHeight);\n\t\t\tthis.ss.getFrame(k+5).draw(g, x1 + leftWidth + n*midWidth, y1 + topHeight + i*midHeight);\n\t\t}\n\n\t\t// Center\n\t\tfor (let j = 0; j < m; j++)\n\t\tfor (let i = 0; i < n; i++) {\n\t\t\tthis.ss.getFrame(k+4).draw(g, x1 + leftWidth + i*midWidth, y1 + topHeight + j*midHeight);\n\t\t}\n\t}\n});\n\nRecycler.createPool(NineSlice, 512);\n\n\n/**\n * Repeated drawable.\n */\nconst Repeated = Drawable.extend\n({\n\tclassName: 'DrawableRepeated',\n\n\tdrawable: null,\n\n\t__ctor: function (drawable)\n\t{\n\t\tthis._super.Drawable.__ctor(drawable);\n\n\t\tthis.drawable = drawable;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.drawable);\n\t},\n\n\tdraw: function (g, sx=0, sy=0, width=null, height=null)\n\t{\n\t\tlet img = this.drawable.getImage();\n\n\t\tlet h = height;\n\t\tlet w = width;\n\n\t\tlet ih = this.drawable.height;\n\t\tlet iw = this.drawable.width;\n\n\t\tlet rh = ih * img.rscale;\n\t\tlet rw = iw * img.rscale;\n\n\t\tlet x, y;\n\n\t\tfor (y = 0; y+ih < h; y += ih)\n\t\t{\n\t\t\tfor (x = 0; x+iw < w; x += iw)\n\t\t\t{\n\t\t\t\tg.drawImage (img,\n\t\t\t\t\t\tthis.drawable.x, this.drawable.y, rw, rh,\n\t\t\t\t\t\tsx + x, sy + y, iw, ih);\n\t\t\t}\n\n\t\t\tif (x < w)\n\t\t\t{\n\t\t\t\tg.drawImage (img,\n\t\t\t\t\tthis.drawable.x, this.drawable.y, (w-x)*img.rscale, rh,\n\t\t\t\t\tsx + x, sy + y, w-x, ih);\n\t\t\t}\n\t\t}\n\n\t\tif (y < h)\n\t\t{\n\t\t\tih = h-y;\n\t\t\trh = ih*img.rscale;\n\n\t\t\tfor (x = 0; x+iw < w; x += iw)\n\t\t\t{\n\t\t\t\tg.drawImage (img,\n\t\t\t\t\t\tthis.drawable.x, this.drawable.y, rw, rh,\n\t\t\t\t\t\tsx + x, sy + y, iw, ih);\n\t\t\t}\n\n\t\t\tif (x < w)\n\t\t\t{\n\t\t\t\tg.drawImage (img,\n\t\t\t\t\tthis.drawable.x, this.drawable.y, (w-x)*img.rscale, rh,\n\t\t\t\t\tsx + x, sy + y, w-x, ih);\n\t\t\t}\n\t\t}\n\t}\n});\n\nRecycler.createPool(Repeated, 512);\n\n\n/**\n * Clipped drawable.\n */\nconst Clipped = Drawable.extend\n({\n\tclassName: 'DrawableClipped',\n\n\tdrawable: null,\n\n\t__ctor: function (drawable)\n\t{\n\t\tthis._super.Drawable.__ctor(drawable);\n\n\t\tthis.drawable = drawable;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.drawable);\n\t},\n\n\tdraw: function (g, x=0, y=0, width=null, height=null)\n\t{\n\t\tlet img = this.getImage();\n\t\n\t\tg.drawImage (img,\n\t\t\t\tthis.drawable.x, this.drawable.y, width*img.rscale, height*img.rscale,\n\t\t\t\tx, y, width, height,\n\t\t\t\tnull, null,\n\t\t\t\tthis.width, this.height);\n\t}\n});\n\nRecycler.createPool(Clipped, 512);\n\n\n/**\n * Centered drawable.\n */\nconst Centered = Drawable.extend\n({\n\tclassName: 'DrawableCentered',\n\n\tdrawable: null,\n\toffsX: 0,\n\toffsY: 0,\n\n\t__ctor: function (drawable, offsX, offsY)\n\t{\n\t\tthis._super.Drawable.__ctor(drawable);\n\n\t\tthis.drawable = drawable;\n\t\tthis.offsX = offsX;\n\t\tthis.offsY = offsY;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.drawable);\n\t},\n\n\tdraw: function (g, x=0, y=0, width=null, height=null)\n\t{\n\t\tthis.drawable.draw(g, x+this.offsX+(width-this.width)*0.5, y+this.offsY+(height-this.height)*0.5, this.width, this.height);\n\t}\n});\n\nRecycler.createPool(Centered, 512);\n\n\n/**\n * Static drawable.\n */\nconst Static = Drawable.extend\n({\n\tclassName: 'DrawableStatic',\n\n\tdrawable: null,\n\toffsX: 0,\n\toffsY: 0,\n\n\t__ctor: function (drawable, offsX, offsY)\n\t{\n\t\tthis._super.Drawable.__ctor(drawable);\n\n\t\tthis.drawable = drawable;\n\t\tthis.offsX = offsX;\n\t\tthis.offsY = offsY;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tdispose(this.drawable);\n\t},\n\n\tdraw: function (g, x=0, y=0, width=null, height=null)\n\t{\n\t\tthis.drawable.draw(g, x+this.offsX, y+this.offsY, this.width, this.height);\n\t}\n});\n\nRecycler.createPool(Static, 512);\n\n\n/**\n * Drawable group.\n */\nconst Group = Drawable.extend\n({\n\tclassName: 'DrawableGroup',\n\n\tlist: null,\n\n\t__ctor: function (list)\n\t{\n\t\tthis._super.Drawable.__ctor();\n\n\t\tthis.list = list;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tif (this.list !== null)\n\t\t{\n\t\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\t\tdispose(this.list[i]);\n\n\t\t\tthis.list = null;\n\t\t}\n\t},\n\n\tdraw: function (g, x=0, y=0, width=null, height=null)\n\t{\n\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\tthis.list[i].draw(g, x, y, width, height);\n\t},\n\n\trender: function (g, elem)\n\t{\n\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\tthis.list[i].render(g, elem);\n\t}\n});\n\nRecycler.createPool(Group, 512);\n\n\n/**\n * Drawable made with a composition of tiles from a nine-slice spritesheet to create a rectangle.\n * !static nineSlice (spritesheet: Spritesheet, startingIndex?:number=0) : Drawable;\n */\nDrawable.nineSlice = function (spritesheet, startingIndex=0) { return NineSlice.Pool.alloc(spritesheet, startingIndex); }\n/**\n * Drawable made with a composition of tiles from a nine-slice spritesheet to create a rectangle.\n * !nineSlice (startingIndex?:number=0) : Drawable;\n */\nDrawable.prototype.nineSlice = function(startingIndex=0) { return NineSlice.Pool.alloc(this, startingIndex); }\n\n/**\n * Drawable tiles to the target size.\n * !static repeated (drawable: Drawable) : Drawable;\n */\nDrawable.repeated = function (drawable) { return Repeated.Pool.alloc(drawable); }\n/**\n * Drawable tiles to the target size.\n * !repeated () : Drawable;\n */\nDrawable.prototype.repeated = function () { return Repeated.Pool.alloc(this); }\n\n/**\n * Drawable clipped to the target size.\n * !static clipped (drawable: Drawable) : Drawable;\n */\nDrawable.clipped = function (drawable) { return Clipped.Pool.alloc(drawable); }\n/**\n * Drawable clipped to the target size.\n * !clipped () : Drawable;\n */\nDrawable.prototype.clipped = function () { return Clipped.Pool.alloc(this); }\n\n/**\n * Drawable centered to the target rectangle.\n * !static centered (drawable: Drawable, offsX?: number, offsY?: number) : Drawable;\n */\nDrawable.centered = function (drawable, offsX, offsY) { return Centered.Pool.alloc(drawable, offsX, offsY); }\n/**\n * Drawable centered to the target rectangle.\n * !centered (offsX?: number, offsY?: number) : Drawable;\n */\nDrawable.prototype.centered = function (offsX, offsY) { return Centered.Pool.alloc(this, offsX, offsY); }\n\n/**\n * Drawable as-is without stretching it.\n * !static static (drawable: Drawable, offsX?: number, offsY?: number) : Drawable;\n */\nDrawable.static = function (drawable, offsX, offsY) { return Static.Pool.alloc(drawable, offsX, offsY); }\n/**\n * Drawable as-is without stretching it.\n * !static (offsX?: number, offsY?: number) : Drawable;\n */\nDrawable.prototype.static = function (offsX, offsY) { return Static.Pool.alloc(this, offsX, offsY); }\n\n/**\n * Creates a drawable group.\n * !static group (...args) : Drawable;\n */\nDrawable.group = function (...args) { return Group.Pool.alloc(args); }\n\n\n//!/class\n\n//!namespace Drawable\n//!namespace Pool\n\n\t/**\n\t * Allocates a drawable object.\n\t * !function alloc () : Drawable;\n\t */\n\nRecycler.createPool(Drawable, 512);\nexport default Drawable;\n","/*\n**\tresources/drawable\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Drawable from '../flow/drawable.js';\n\nexport default Drawable.extend\n({\n\tclassName: 'DrawableResource',\n\n\tr: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type !== 'image')\n\t\t\tthrow new Error ('Resource is not an image.');\n\n\t\tthis._super.Drawable.__ctor(r.data, r.width, r.height);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\t}\n});\n","/*\n**\tresources/custom.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Canvas from '../system/canvas.js';\nimport Drawable from '../flow/drawable.js';\n\n//![import \"../system/canvas\"]\n\nexport default Drawable.extend\n({\n\tclassName: 'DrawableCustom',\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != 'object')\n\t\t\tthrow new Error ('Resource is not an object.');\n\n\t\tthis._super.Drawable.__ctor();\n\n\t\tthis.width = r.width;\n\t\tthis.height = r.height;\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tthis.data = null;\n\n\t\tCanvas.renderImage(r.width, r.height,\n\t\t(g) => {\n\t\t\tif (this.r.draw !== null && typeof(this.r.draw) === 'function') {\n\t\t\t\tthis.r.draw(g, this.r);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tg.fillStyle(this.r.color);\n\t\t\t\tg.fillRect(0, 0, this.r.width, this.r.height);\n\t\t\t}\n\t\t},\n\t\t(img) => {\n\t\t\tthis.data = img;\n\t\t});\n\t},\n\n\tdraw: function (g, x=0, y=0, width=null, height=null)\n\t{\n\t\tif (this.data !== null)\n\t\t\tg.drawImage (this.data, 0, 0, this.data.width, this.data.height, x, y, width ?? this.width, height ?? this.height);\n\t},\n\n\tgetImage: function()\n\t{\n\t\treturn this.data;\n\t}\n});\n","/*\n**\tresources/spritesheet.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Drawable from '../flow/drawable.js';\n\n/*\n\tIf source is \"image\":\n\t\tconfig: {\n\t\t\tsheetWidth: int, frameWidth: int, frameHeight: int?, numFrames: int?\n\t\t\t--OR--\n\t\t\tnumFrames: int, frameWidth: int, frameHeight: int?\n\t\t}\n\n\tIf source is \"images\":\n\t\tconfig: {\n\t\t\tframeWidth: int, frameHeight: int\n\t\t}\n\t\t\n\tNOTE: The sheetWidth, frameWidth and frameHeight should reflect the real image size. The system will automatically scale it if the source image is smaller/bigger.\n*/\n\nconst FrameDrawable = Drawable.extend\n({\n\tspritesheet: null,\n\tframeIndex: 0,\n\n\t__ctor: function (spritesheet, frameIndex)\n\t{\n\t\tthis._super.Drawable.__ctor(null, spritesheet.width, spritesheet.height);\n\n\t\tthis.spritesheet = spritesheet;\n\t\tthis.frameIndex = frameIndex;\n\n\t\tthis.width = spritesheet.width;\n\t\tthis.height = spritesheet.height;\n\t},\n\n\tdraw: function (g, x=0, y=0, width=null, height=null)\n\t{\n\t\tg.drawImage (this.resource,\n\t\t\t\tthis.x, this.y, this.spritesheet.frameWidth, this.spritesheet.frameHeight,\n\t\t\t\tx, y, width ?? this.width, height ?? this.height,\n\t\t\t\tnull, null, this.width, this.height);\n\t}\n});\n\nexport default Drawable.extend\n({\n\tclassName: 'Spritesheet',\n\n\tnumCols: 0,\n\tnumFrames: 0,\n\n\tframeCache: null,\n\n\t__ctor: function (r)\n\t{\n\t\tthis._super.Drawable.__ctor();\n\n\t\tif ((r.type != 'image' && r.type != 'images'))\n\t\t\tthrow new Error ('Resource is not a sprite sheet.');\n\n\t\tvar r_scale, v_scale;\n\n\t\tif (r.type == 'image')\n\t\t{\n\t\t\tif (!r.config.sheetWidth && (!r.config.numFrames || !r.config.frameWidth))\n\t\t\t\tthrow new Error (r.resName + ': required sheetWidth or numFrames+frameWidth');\n\n\t\t\tif (!r.config.sheetWidth)\n\t\t\t\tr.config.sheetWidth = r.width; //r.config.numFrames * r.config.frameWidth;\n\n\t\t\tif (!r.config.frameHeight)\n\t\t\t\tr.config.frameHeight = r.data.height;\n\n\t\t\tr_scale = r.data.width / r.config.sheetWidth;\n\t\t\tv_scale = r.width / r.config.sheetWidth;\n\t\t}\n\t\telse // r.type == 'images'\n\t\t{\n\t\t\tif (!r.config) r.config = { };\n\n\t\t\tif (!r.config.frameWidth)\n\t\t\t\tr.config.frameWidth = r.data[0].width;\n\n\t\t\tif (!r.config.frameHeight)\n\t\t\t\tr.config.frameHeight = r.data[0].height;\n\n\t\t\tr_scale = r.data[0].data.width / r.config.frameWidth;\n\t\t\tv_scale = r.data[0].width / r.config.frameWidth;\n\t\t}\n\n\t\t// Physical frame dimensions.\n\t\tthis.frameWidth = (r.config.frameWidth * r_scale);\n\t\tthis.frameHeight = (r.config.frameHeight * r_scale);\n\n\t\t// Logical frame dimensions.\n\t\tthis.width = r.config.frameWidth * v_scale;\n\t\tthis.height = r.config.frameHeight * v_scale;\n\n\t\tif (r.type == 'image')\n\t\t{\n\t\t\tthis.numCols = int(r.data.width / this.frameWidth);\n\t\t\tthis.numRows = Math.ceil(r.data.height / this.frameHeight);\n\n\t\t\tthis.numFrames = r.config.numFrames || (this.numCols * this.numRows);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.numCols = this.numRows = 0;\n\t\t\tthis.numFrames = r.data.length;\n\t\t}\n\n\t\tthis.frameCache = { };\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\t// Preload frameCache.\n\t\tfor (let i = 0; i < this.numFrames; i++)\n\t\t\tthis.getFrame(i);\n\t},\n\n\tgetFrame: function (x, y=null)\n\t{\n\t\tlet frameIndex = y !== null ? y*this.numCols+x : x;\n\t\tif (frameIndex < 0 || frameIndex >= this.numFrames)\n\t\t\tthrow new Error ('frameIndex out of range');\n\n\t\tif (this.frameCache[frameIndex])\n\t\t\treturn this.frameCache[frameIndex];\n\n\t\tlet frameObject = new FrameDrawable (this, frameIndex);\n\n\t\tif (this.numCols != 0)\n\t\t{\n\t\t\tframeObject.y = int(frameIndex / this.numCols) * this.frameHeight;\n\t\t\tframeObject.x = (frameIndex % this.numCols) * this.frameWidth;\n\t\t\tframeObject.resource = this.r.data;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tframeObject.resource = this.r.data[frameIndex].data;\n\t\t}\n\n\t\treturn this.frameCache[frameIndex] = frameObject;\n\t},\n\n\tgetImage: function()\n\t{\n\t\treturn this.getFrame(0).getImage();\n\t},\n\n\tgetDrawable: function()\n\t{\n\t\treturn this.getFrame(0);\n\t}\n});\n","/*\n**\tresources/spritesheet-animation.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Spritesheet from './spritesheet.js';\nimport System from '../system/system.js';\nimport List from '../utils/list.js';\nimport Recycler from '../utils/recycler.js';\nimport Drawable from '../flow/drawable.js';\n\n//![import \"./spritesheet\"]\n//![import \"../system/system\"]\n//![import \"../utils/list\"]\n//![import \"../utils/recycler\"]\n\n/*\n\tanim: {\n\t\tdef: string, fps: int?,\n\n\t\tseq: {\n\t\t\tseq1: { loop: bool?, group: [ [int, int, ...], ... ] },\n\t\t\tseq2: { loop: bool?, group: [ [int, int, ...], ... ] },\n\t\t\tseq2: { loop: bool?, group: \"0-12\" },\n\t\t\tseq2: { loop: bool?, group: \"4 1 1 2 3\" },\n\t\t},\n\n\t\ttrans: {\n\t\t\tseq1: {\n\t\t\t\tseq2: [ seq_name, seq_name, ... ]\n\t\t\t}\n\t\t}\n\t}\n\n\tNOTE: When specifying a group such as \"0,12\" it means to draw tiles 0 and the 12 in that single frame.\n*/\n\nexport const Animation = Drawable.extend\n({\n\tclassName: 'Animation',\n\n\tseq: null, seq_i: 0,\n\ttrans: null, trans_i: 0, trans_t: null,\n\n\tqueue: null,\n\n\tfps: 0, frameSeconds: 0, time: 0,\n\n\tframeNumber: -1,\n\n\tfinished: false,\n\t_paused: false,\n\n\tfinishedCallback: null,\n\tfinishedCallbackHandler: null,\n\tfinishedCallbackContext: null,\n\n\tframeCallback: null,\n\n\t__ctor: function (anim, seq, fps)\n\t{\n\t\tthis._super.Drawable.__ctor(anim.getImage(), anim.width, anim.height);\n\n\t\tthis.anim = anim;\n\t\tthis.queue = List.Pool.alloc();\n\n\t\tthis.seq = seq;\n\t\tthis.seq_i = 0;\n\n\t\tthis.trans = null;\n\t\tthis.trans_i = 0;\n\t\tthis.trans_t = null;\n\n\t\tthis.frameNumber = -1;\n\t\tthis.finished = false;\n\t\tthis._paused = false;\n\n\t\tthis.finishedCallback = null;\n\t\tthis.finishedCallbackHandler = null;\n\t\tthis.finishedCallbackContext = null;\n\t\tthis.frameCallback = null;\n\n\t\tthis.fps = fps;\n\t\tthis.setFps (this.seq.fps || this.fps);\n\t},\n\n\t__dtor: function ()\n\t{\n\t\tthis.queue.free();\n\n\t\tif (this.finishedCallbackHandler)\n\t\t\tthis.finishedCallbackHandler.free();\n\n\t\tif (this.finishedCallbackContext)\n\t\t\tthis.finishedCallbackContext.free();\n\t},\n\n\tsetFps: function (fps)\n\t{\n\t\tthis.frameSeconds = 1.0 / fps;\n\t\tthis.time = 0;\n\n\t\treturn this;\n\t},\n\n\tpaused: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._paused;\n\n\t\tthis._paused = value;\n\t\treturn this;\n\t},\n\n\tinitialDelay: function (dt)\n\t{\n\t\tthis.time = -dt;\n\t\treturn this;\n\t},\n\n\tonFinished: function (callback)\n\t{\n\t\tthis.finishedCallback = callback;\n\t\treturn this;\n\t},\n\n\tthen: function (callback, context=null)\n\t{\n\t\tif (callback === false && this.finishedCallback === this.thenCallback)\n\t\t{\n\t\t\tthis.finishedCallbackHandler.clear();\n\t\t\tthis.finishedCallbackContext.clear();\n\t\t}\n\n\t\tif (!callback) return this;\n\n\t\tif (this.finishedCallback !== this.thenCallback)\n\t\t{\n\t\t\tthis.finishedCallback = this.thenCallback;\n\t\t\tthis.finishedCallbackHandler = List.Pool.alloc();\n\t\t\tthis.finishedCallbackContext = List.Pool.alloc();\n\t\t}\n\n\t\tthis.finishedCallbackHandler.push(callback);\n\t\tthis.finishedCallbackContext.push(context);\n\t\treturn this;\n\t},\n\n\tthenCallback: function ()\n\t{\n\t\tif (!this.finishedCallbackHandler.length)\n\t\t\treturn false;\n\n\t\tlet context = this.finishedCallbackContext.shift();\n\t\tthis.finishedCallbackHandler.shift()(this, context);\n\t},\n\n\tonFrame: function (fn)\n\t{\n\t\tthis.frameCallback = fn;\n\t\treturn this;\n\t},\n\n\tsetFrame: function (i)\n\t{\n\t\tthis.seq_i = int(i) % this.seq.group.length;\n\t\treturn this;\n\t},\n\n\tgetFrame: function (normalized)\n\t{\n\t\treturn normalized === true ? (this.seq_i / (this.seq.group.length-1)) : this.seq_i;\n\t},\n\n\tgetLength: function ()\n\t{\n\t\treturn this.seq.group.length;\n\t},\n\n\tdraw: function (g, x=0, y=0, width=null, height=null)\n\t{\n\t\tif (this.time < 0)\n\t\t{\n\t\t\tif (!this._paused)\n\t\t\t{\n\t\t\t\tthis.time += this.frameNumber === System.frameNumber ? 0 : System.frameDelta;\n\t\t\t\tthis.frameNumber = System.frameNumber;\n\t\t\t}\n\n\t\t\tif (this.time > 0) this.time = 0;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.seq_i === this.seq.group.length)\n\t\t{\n\t\t\tlet t = this.seq.group[this.seq_i-1];\n\n\t\t\tif (g !== null)\n\t\t\t{\n\t\t\t\tfor (let i = 0; i < t.length; i++)\n\t\t\t\t\tthis.anim.getFrame(t[i]).draw(g, x, y, width, height);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet t = this.seq.group[this.seq_i];\n\n\t\tif (g !== null)\n\t\t{\n\t\t\tfor (let i = 0; i < t.length; i++)\n\t\t\t\tthis.anim.getFrame(t[i]).draw(g, x, y, width, height);\n\t\t}\n\n\t\tif (!this._paused)\n\t\t{\n\t\t\tthis.time += this.frameNumber === System.frameNumber ? 0 : System.frameDelta;\n\t\t\tthis.frameNumber = System.frameNumber;\n\t\t}\n\n\t\tif (this.time >= this.frameSeconds)\n\t\t{\n\t\t\tconst frameIndex = this.seq_i;\n\n\t\t\tthis.time -= this.frameSeconds;\n\t\t\tthis.seq_i++;\n\n\t\t\tif (this.seq_i === this.seq.group.length)\n\t\t\t{\n\t\t\t\tif (this.trans != null)\n\t\t\t\t{\n\t\t\t\t\tif (++this.trans_i === this.trans.length)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.trans = null;\n\t\t\t\t\t\tthis.seq = this.trans_t;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tthis.seq = this.trans[this.trans_i];\n\n\t\t\t\t\tthis.setFps (this.seq.fps || this.fps);\n\n\t\t\t\t\tthis.seq_i = 0;\n\t\t\t\t\tthis.time = 0;\n\n\t\t\t\t\tthis.finished = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (this.seq.loop)\n\t\t\t\t\t\tthis.seq_i = 0;\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.finished = true;\n\n\t\t\t\t\t\tif (this.finishedCallback)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.finishedCallback(this) === false)\n\t\t\t\t\t\t\t\tthis.finishedCallback = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.queue.length)\n\t\t\t\t\t\tthis.use(this.queue.shift(), true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.frameCallback)\n\t\t\t{\n\t\t\t\tif (this.frameCallback(frameIndex, this.seq.group.length-1, this) === false)\n\t\t\t\t\tthis.frameCallback = null;\n\t\t\t}\n\t\t}\n\t},\n\n\tgetImage: function()\n\t{\n\t\treturn this.anim.getImage();\n\t},\n\n\tgetDrawable: function()\n\t{\n\t\treturn this;\n\t},\n\n\tadvance: function ()\n\t{\n\t\tthis.paused (false);\n\t\tthis.draw (null, 0, 0);\n\t},\n\n\tgetSequenceName: function ()\n\t{\n\t\treturn (this.trans === null ? this.seq : this.trans_t).name;\n\t},\n\n\tuse: function (seqName, force=false)\n\t{\n\t\tlet seq = this.trans === null ? this.seq : this.trans_t;\n\n\t\tif (seq.name === seqName && !this.finished && force !== true)\n\t\t\treturn false;\n\n\t\tif (seq.trans && seq.trans[seqName])\n\t\t{\n\t\t\tthis.trans_t = this.anim.a.seq[seqName];\n\n\t\t\tthis.trans = seq.trans[seqName];\n\t\t\tthis.trans_i = 0;\n\n\t\t\tthis.seq = this.trans[this.trans_i];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (force === true)\n\t\t\t\tthis.trans = null;\n\n\t\t\tthis.seq = this.anim.a.seq[seqName];\n\t\t}\n\n\t\tthis.setFps (this.seq.fps || this.fps);\n\n\t\tthis.seq_i = 0;\n\t\tthis.time = 0;\n\n\t\tthis.finished = false;\n\t\treturn true;\n\t},\n\n\tplay: function (name)\n\t{\n\t\tthis.use(name);\n\t\treturn this;\n\t},\n\n\tsetQueue: function (list)\n\t{\n\t\tif (!List.isInstance(list))\n\t\t\tthrow new Error('setQueue: Parameter must be an instance of List');\n\n\t\tif (this.queue != null)\n\t\t\tthis.queue.clear().free();\n\n\t\tthis.queue = list;\n\t\tthis.use(this.queue.shift(), true);\n\t},\n\n\tenqueue: function (seqName, force=false)\n\t{\n\t\tlet seq = this.trans === null ? this.seq : this.trans_t;\n\n\t\tlet lastName = this.queue.length > 0 ? this.queue[this.queue.length-1] : seq.name;\n\n\t\tif (seq.name === seqName && seq.loop)\n\t\t\treturn this;\n\n\t\tif (lastName === seqName && !force)\n\t\t\treturn this;\n\n\t\tif (seq.loop || this.finished)\n\t\t{\n\t\t\tthis.use(seqName, true);\n\t\t\treturn this;\n\t\t}\n\n\t\tthis.queue.push(seqName);\n\t\treturn this;\n\t}\n});\n\nRecycler.createPool(Animation);\n\n/* ********************************************************** */\nexport default Spritesheet.extend\n({\n\tclassName: 'SpritesheetAnimation',\n\n\tdefaultDrawable: null,\n\tsharedAnim: null,\n\n\tr: null,\n\ta: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (!r.anim) throw new Error (\"Animation descriptors not found.\");\n\n\t\tthis._super.Spritesheet.__ctor (r);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tlet t = this.a = this.r.anim;\n\n\t\tif (t.initialized) return;\n\n\t\tif (!t.def) t.def = 'def';\n\t\tif (!t.seq) t.seq = { };\n\n\t\t// Create default sequence if it wasn't defined.\n\t\tif (!t.seq[t.def] && (t.def == 'def' || t.def == 'defloop'))\n\t\t{\n\t\t\tlet p = { loop: (t.def == 'def' ? false : true), group: [ ] };\n\n\t\t\tfor (let i = 0; i < this.numFrames; i++) {\n\t\t\t\tp.group.push([i]);\n\t\t\t}\n\n\t\t\tt.seq[t.def] = p;\n\t\t}\n\n\t\tif (!t.seq[t.def])\n\t\t\tthrow new Error ('Undefined default sequence: ' + t.def);\n\n\t\tif (!t.fps) t.fps = 25;\n\n\t\tt.def = t.seq[t.def];\n\n\t\tlet frameIndex = 0;\n\n\t\tfor (let i in t.seq)\n\t\t{\n\t\t\tt.seq[i].name = i;\n\n\t\t\tif (!t.seq[i].loop)\n\t\t\t\tt.seq[i].loop = false;\n\n\t\t\tif (typeof(t.seq[i].group) == 'string')\n\t\t\t{\n\t\t\t\tlet a, b, c;\n\n\t\t\t\tif (t.seq[i].group.indexOf(' ') != -1)\n\t\t\t\t{\n\t\t\t\t\ta = t.seq[i].group.split(' ');\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\tfor (let j in a)\n\t\t\t\t\t\tt.seq[i].group.push([int(a[j])]);\n\t\t\t\t}\n\t\t\t\telse if (t.seq[i].group.indexOf('-') != -1)\n\t\t\t\t{\n\t\t\t\t\tc = t.seq[i].group.split('-');\n\t\t\t\t\t\n\t\t\t\t\ta = int(c[0]);\n\t\t\t\t\tb = int(c[1]);\n\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\tif (a < b) {\n\t\t\t\t\t\tfor (c = a; c <= b; c++)\n\t\t\t\t\t\t\tt.seq[i].group.push([c]);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tfor (c = a; c >= b; c--)\n\t\t\t\t\t\t\tt.seq[i].group.push([c]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ta = int(t.seq[i].group);\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\twhile (a--) t.seq[i].group.push([frameIndex++]);\n\t\t\t\t}\n\n\t\t\t\tt.seq[i].count = t.seq[i].group.length;\n\t\t\t}\n\t\t}\n\n\t\tif (t.trans)\n\t\t{\n\t\t\tfor (let i in t.trans)\n\t\t\t{\n\t\t\t\tt.seq[i].trans = t.trans[i];\n\n\t\t\t\tfor (let j in t.trans[i])\n\t\t\t\t{\n\t\t\t\t\tfor (let k = 0; k < t.trans[i][j].length; k++)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet n = t.trans[i][j][k];\n\n\t\t\t\t\t\tif (!t.seq[n]) throw new Error ('Undefined sequence: ' + n);\n\t\t\t\t\t\tt.trans[i][j][k] = t.seq[n];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tt.initialized = true;\n\t},\n\n\tgetSharedAnimation: function (initialseq=null)\n\t{\n\t\tif (this.sharedAnim === null)\n\t\t{\n\t\t\tthis.sharedAnim = Animation.Pool.alloc(this, initialseq ? this.a.seq[initialseq] : this.a.def, this.a.fps);\n\t\t\tthis.sharedAnim.lockInstance(true);\n\n\t\t\treturn this.sharedAnim;\n\t\t}\n\n\t\treturn this.sharedAnim.play(initialseq ? initialseq : this.a.def.name);\n\t},\n\n\tgetAnimation: function (initialseq=null, fps=null)\n\t{\n\t\treturn Animation.Pool.alloc(this, initialseq ? this.a.seq[initialseq] : this.a.def, fps || this.a.fps);\n\t},\n\n\tgetSequence: function (name)\n\t{\n\t\treturn this.a.seq[name];\n\t},\n\n\tgetDrawable: function()\n\t{\n\t\tif (this.defaultDrawable === null)\n\t\t\tthis.defaultDrawable = this.getAnimation();\n\n\t\treturn this.defaultDrawable;\n\t}\n});\n","/*\n**\tresources/spritefont.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Canvas from '../system/canvas.js';\n\n//![import \"../system/canvas\"]\n\n/*\n\tfont: {\n\t\tsheetWidth: int?, charWidth: int, charHeight: int, charset: string, widths: [char, width, ...],\n\t\treverseDraw: bool?, paddingX: int?, paddingY: int?, spacingX: int?, spacingY: int?\n\t}\n*/\n\nexport default Class.extend\n({\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != 'image' || !r.font)\n\t\t\tthrow new Error ('Resource is not a sprite font.');\n\n\t\tif (!r.font.sheetWidth)\n\t\t\tr.font.sheetWidth = r.width;\n\n\t\tlet r_scale = r.data.width / r.font.sheetWidth;\n\t\tlet v_scale = r.width / r.font.sheetWidth;\n\n\t\tthis.r_charWidth = (r.font.charWidth * r_scale);\n\t\tthis.r_charHeight = (r.font.charHeight * r_scale);\n\n\t\tthis.charWidth = (r.font.charWidth * v_scale);\n\t\tthis.charHeight = (r.font.charHeight * v_scale);\n\n\t\tthis.paddingX = (r.font.paddingX || 0) * v_scale;\n\t\tthis.paddingY = (r.font.paddingY || 0) * v_scale;\n\n\t\tthis.spacingX = (r.font.spacingX || 0) * v_scale;\n\t\tthis.spacingY = (r.font.spacingY || 0) * v_scale;\n\n\t\tthis.reverseDraw = r.font.reverseDraw || false;\n\n\t\tlet cols = int(r.font.sheetWidth / r.font.charWidth);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tlet n = r.font.charset.length;\n\t\tlet k = 0;\n\t\tlet y = 0;\n\n\t\tthis.charTable = { };\n\n\t\twhile (k < n)\n\t\t{\n\t\t\tlet x = 0;\n\n\t\t\tfor (let i = 0; i < cols && k < n; i++)\n\t\t\t{\n\t\t\t\tlet c = r.font.charset[k++];\n\n\t\t\t\tthis.charTable[c] = { hidden: false, x: x, y: y, charWidth: this.charWidth, r_charWidth: this.r_charWidth, spacingX: 0 };\n\n\t\t\t\tx += this.r_charWidth;\n\t\t\t}\n\n\t\t\ty += this.r_charHeight;\n\t\t}\n\n\t\tif (!(' ' in this.charTable))\n\t\t\tthis.charTable[' '] = { hidden: true, charWidth: int((this.charWidth + this.paddingX)*2/3), r_charWidth: this.r_charWidth, spacingX: 0 };\n\n\t\tif (!r.font.widths) return;\n\n\t\tn = r.font.widths.length;\n\n\t\tfor (let i = 0; i < n; i += 2)\n\t\t{\n\t\t\tlet w = r.font.widths[i+1] * v_scale;\n\t\t\tlet s = r.font.widths[i];\n\n\t\t\tif (typeof(s) === 'number')\n\t\t\t\ts = String.fromCharCode(s);\n\n\t\t\tfor (let j = 0; j < s.length; j++)\n\t\t\t{\n\t\t\t\tif (s[j] in this.charTable)\n\t\t\t\t\tthis.charTable[s[j]].spacingX = w - this.charTable[s[j]].charWidth;\n\t\t\t}\n\t\t}\n\t},\n\n\tdrawText: function (g, x, y, text)\n\t{\n\t\tlet n = text.length;\n\n\t\tlet pX = -2*this.paddingX + this.spacingX;\n\n\t\tx -= this.paddingX;\n\t\ty -= this.paddingY;\n\n\t\tif (!this.reverseDraw)\n\t\t{\n\t\t\tfor (let i = 0; i < n; i++)\n\t\t\t{\n\t\t\t\tlet c = this.charTable[text[i]];\n\t\t\t\tif (!c) continue;\n\n\t\t\t\tif (!c.hidden)\n\t\t\t\t\tg.drawImage (this.r.data, c.x, c.y, c.r_charWidth, this.r_charHeight, x, y, c.charWidth, this.charHeight, null, null, c.charWidth, this.charHeight);\n\n\t\t\t\tx += c.charWidth + pX + c.spacingX;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let i = 0; i < n-1; i++)\n\t\t\t{\n\t\t\t\tlet c = this.charTable[text[i]];\n\t\t\t\tif (!c) continue;\n\n\t\t\t\tx += c.charWidth + pX;\n\t\t\t}\n\n\t\t\tfor (let i = n-1; i >= 0; i--)\n\t\t\t{\n\t\t\t\tlet c = this.charTable[text[i]];\n\t\t\t\tif (!c) continue;\n\n\t\t\t\tif (!c.hidden)\n\t\t\t\t\tg.drawImage (this.r.data, c.x, c.y, c.r_charWidth, this.r_charHeight, x, y, c.charWidth, this.charHeight, null, null, c.charWidth, this.charHeight);\n\n\t\t\t\tx -= c.charWidth + pX + c.spacingX;\n\t\t\t}\n\t\t}\n\t},\n\n\tmeasureWidth: function (text)\n\t{\n\t\tlet n = text.length;\n\t\tlet x = 0;\n\n\t\tlet pX = -2*this.paddingX + this.spacingX;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tlet c = this.charTable[text[i]];\n\t\t\tif (!c) continue;\n\n\t\t\tx += c.charWidth + pX + c.spacingX;\n\t\t}\n\n\t\treturn x;\n\t},\n\n\tmeasureHeight: function (text)\n\t{\n\t\treturn this.charHeight - 2*this.paddingY + this.spacingY;\n\t}\n});\n\n\nCanvas.prototype.drawText = function (r, x, y, text)\n{\n\tr.drawText (this, x, y, text);\n};\n\nCanvas.prototype.drawTextAligned = function (r, x, y, w, h, ax, ay, text)\n{\n\tif (ax == 0) // Align-Center\n\t\tx = x + ((w - r.measureWidth(text)) >> 1);\n\telse if (ax < 0) // Align-Left\n\t\tx = x - ax - 1;\n\telse if (ax > 0) // Align-Right\n\t\tx = x + w - ax + 1 - r.measureWidth(text);\n\n\tif (ay == 0) // Align-Center\n\t\ty = y + ((h - r.measureHeight(text)) >> 1);\n\telse if (ay < 0) // Align-Top\n\t\ty = y - ay - 1;\n\telse if (ay > 0) // Align-Bottom\n\t\ty = y + h - ay + 1 - r.measureHeight(text);\n\n\tr.drawText (this, x, y, text);\n};\n\nCanvas.prototype.drawTextAligned2 = function (r, bounds, ax, ay, text)\n{\n\tthis.drawTextAligned (r, bounds.x1, bounds.y1, bounds.width(), bounds.height(), ax, ay, text);\n};\n","/*\n**\tresources/sound.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Resources from './resources.js';\n\n//![import \"./resources\"]\n\n/*\n\ttrack: string (music|sfx)\n*/\n\nconst Sound = Class.extend\n({\n\tr: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"audio\")\n\t\t\tthrow new Error (\"Resource is not audio.\");\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tthis.track = Sound[this.r.track.toUpperCase()];\n\t},\n\n\tplay: function (callback, volume)\n\t{\n\t\treturn Sound.play (this, callback, volume);\n\t},\n\n\tplayLoop: function (callback, volume)\n\t{\n\t\treturn Sound.playLoop (this, callback, volume);\n\t}\n});\n\nSound.ENGINE_HTML5 = 1;\nSound.ENGINE_WEBAUDIO = 2;\nSound.ENGINE_NATIVEAUDIO = 3;\n\nObject.assign(Sound,\n{\n\tMASTER: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tSFX: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tMUSIC: {\n\t\tenabled: true,\n\t\tvolume: 0.8\n\t},\n\n\tVOICE: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tMAX_POOL_SIZE: 100,\n\n\tpool: [ ],\n\tactive: [ ],\n\n\tregister: function (node)\n\t{\n\t\tif (node.registered) return;\n\n\t\tnode.registered = true;\n\t\tthis.active.push(node);\n\t},\n\n\tunregister: function (node)\n\t{\n\t\tif (!node.registered) return;\n\n\t\tnode.registered = false;\n\n\t\tvar i = Sound.active.indexOf(node);\n\t\tif (i == -1) return;\n\n\t\tSound.active.splice(i, 1);\n\t},\n\n\tupdateNode: function (node, cmd)\n\t{\n\t\tswitch (node.snd.r.engine)\n\t\t{\n\t\t\tcase Sound.ENGINE_WEBAUDIO:\n\t\t\t\treturn this.updateNode_webaudio(node, cmd);\n\n\t\t\tcase Sound.ENGINE_NATIVEAUDIO:\n\t\t\t\treturn this.updateNode_nativeaudio(node, cmd);\n\t\t}\n\n\t\treturn this.updateNode_audio(node, cmd);\n\t},\n\n\t// Web Audio.\n\talloc_webaudio: function (node)\n\t{\n\t\tnode.gainNode = audioContext.createGain();\n\t\tnode.gainNode.gain.value = 0;\n\t\tnode.gainNode.connect(audioContext.destination);\n\n\t\tnode.res = audioContext.createBufferSource();\n\t\tnode.res.buffer = node.snd.r.data;\n\t\tnode.res.loop = false;\n\t\tnode.res.connect(node.gainNode);\n\t\tnode.res.node = node;\n\t},\n\n\tfree_webaudio: function (node)\n\t{\n\t\tif (!node.res) return;\n\n\t\tnode.gainNode.disconnect();\n\n\t\tnode.res = null;\n\t\tnode.gainNode = null;\n\t},\n\n\t// Native Audio (Cordova plugin).\n\talloc_nativeaudio: function (node)\n\t{\n\t\tnode.res = true;\n\t},\n\n\tfree_nativeaudio: function (node)\n\t{\n\t\tnode.res = false;\n\t},\n\n\t// HTML5 Audio.\n\talloc_audio: function (node)\n\t{\n\t\tif (!this.pool.length)\n\t\t\titem = node.cloneNode();\n\t\telse\n\t\t\titem = this.pool.pop();\n\n\t\titem._src = node.src;\n\t\treturn item;\n\t},\n\n\tfree_audio: function (node)\n\t{\n\t\tif (this.pool.length == this.MAX_POOL_SIZE)\n\t\t\treturn;\n\n\t\t//BUG: This causes a GET request of \"/null\" on Chromium.\n\t\t//node.src = null;\n\n\t\tthis.pool.push(node);\n\t},\n\n\t/* *********************** */\n\tupdateNode_webaudio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tvar volume = Sound.MASTER.volume * node.snd.track.volume * node.volume;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t\tSound.alloc_webaudio(node);\n\n\t\t\t\tnode.playTime = hrnow();\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.onended = Sound.onended_webaudio;\n\t\t\t\tnode.gainNode.gain.value = volume;\n\n\t\t\t\ttry {\n\t\t\t\t\tnode.res.start(0, node.startTime/1000.0);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_webaudio(node);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.gainNode.gain.value = volume;\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\n\t\t\t\t\tSound.free_webaudio(node);\n\t\n\t\t\t\t\tif (node.callback) node.callback();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\t\t\t\tnode.res.onended = null;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tnode.res.stop();\n\n\t\t\t\tSound.free_webaudio(node);\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime += hrnow() - node.playTime;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = true;\n\t\t\t\tnode.res.onended = null;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tnode.res.stop();\n\n\t\t\t\tSound.free_webaudio(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.loop = false;\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_webaudio: function (e)\n\t{\n\t\tvar node = e.currentTarget.node;\n\n\t\tif (node.playing && node.loop != 0)\n\t\t{\n\t\t\tSound.free_webaudio(node);\n\n\t\t\tif (node.loop != -1)\n\t\t\t\tnode.loop--;\n\n\t\t\tnode.startTime = 0;\n\t\t\tnode.playing = false;\n\t\t\tnode.pause = false;\n\n\t\t\tSound.updateNode_webaudio (node, 'play');\n\t\t\treturn;\n\t\t}\n\n\t\tnode.res.onended = null;\n\t\tnode.res.volume = 0;\n\n\t\tSound.updateNode_webaudio (node, 'stop');\n\t},\n\n\t/* *********************** */\n\tupdateNode_nativeaudio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t\tSound.alloc_nativeaudio(node);\n\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\ttry {\n\t\t\t\t\tglobal.plugins.NativeAudio.play (node.snd.r.data, null, null, function() { Sound.onended_nativeaudio(node); } );\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_nativeaudio(node);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tglobal.plugins.NativeAudio.stop (node.snd.r.data, null);\n\n\t\t\t\tSound.free_nativeaudio(node);\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_nativeaudio: function (node)\n\t{\n\t\tSound.updateNode_nativeaudio (node, 'stop');\n\t},\n\n\tupdateNode_audio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tvar volume = Sound.MASTER.volume * node.snd.track.volume * node.volume;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t{\n\t\t\t\t\tnode.res = Sound.alloc_audio (node.snd.r.data);\n\t\t\t\t\tnode.res.node = node;\n\t\t\t\t\tnode.res.src = node.res._src;\n\t\t\t\t}\n\n\t\t\t\tnode.playTime = hrnow();\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.onended = Sound.onended_audio;\n\t\t\t\tnode.res.currentTime = node.startTime/1000.0;\n\t\t\t\tnode.res.volume = volume;\n\n\t\t\t\ttry {\n\t\t\t\t\tnode.res.play();\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_audio (node.res);\n\t\t\t\t\tnode.res = null;\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.res.volume = volume;\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\n\t\t\t\t\tSound.free_audio (node.res);\n\t\t\t\t\tnode.res = null;\n\t\n\t\t\t\t\tif (node.callback) node.callback();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tSound.unregister (node);\n\t\t\t\tnode.res.pause();\n\n\t\t\t\tSound.free_audio (node.res);\n\t\t\t\tnode.res = null;\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime += hrnow() - node.playTime;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = true;\n\n\t\t\t\tSound.unregister (node);\n\t\t\t\tnode.res.pause();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_audio: function (e)\n\t{\n\t\tvar node = e.currentTarget.node;\n\n\t\tif (node.playing && node.loop != 0)\n\t\t{\n\t\t\tif (node.loop != -1)\n\t\t\t\tnode.loop--;\n\n\t\t\tnode.startTime = 0;\n\t\t\tnode.playing = false;\n\t\t\tnode.pause = false;\n\n\t\t\tSound.updateNode_audio (node, 'play');\n\t\t\treturn;\n\t\t}\n\n\t\tnode.res.onended = null;\n\t\tnode.res.volume = 0;\n\n\t\tSound.updateNode_audio (node, 'stop');\n\t},\n\n\t/* *************************************** */\n\t/* PUBLIC */\n\n\tenableTrack: function (track)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.enabled = true;\n\t},\n\n\tdisableTrack: function (track)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.enabled = false;\n\t},\n\n\tsetVolume: function (track, value)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.volume = value;\n\t},\n\n\tcreateNode: function (snd, volume)\n\t{\n\t\tvar node = { };\n\n\t\tnode.startVolume = volume;\n\t\tnode.volume = volume;\n\t\tnode.snd = snd;\n\t\tnode.loop = 0;\n\t\tnode.playing = false;\n\t\tnode.paused = false;\n\t\tnode.startTime = 0;\n\t\tnode.playTime = 0;\n\t\tnode.callback = null;\n\t\tnode.timer = null;\n\t\tnode.res = null;\n\n\t\treturn node;\n\t},\n\n\tplay: function (snd, completeCallback, volume)\n\t{\n\t\tif (!this.MASTER.enabled || !snd || !snd.track.enabled)\n\t\t\treturn null;\n\n\t\tvar volume = (volume !== undefined && volume !== null) ? volume : 1.0;\n\n\t\tvar node = this.createNode(snd, volume);\n\t\tnode.callback = completeCallback;\n\n\t\treturn this.updateNode(node, 'play');\n\t},\n\n\tplayLoop: function (snd, completeCallback, volume)\n\t{\n\t\tif (!this.MASTER.enabled || !snd || !snd.track.enabled)\n\t\t\treturn null;\n\n\t\tvolume = (volume !== undefined && volume !== null) ? volume : 1.0;\n\t\n\t\tvar node = this.createNode(snd, volume);\n\t\tnode.callback = completeCallback;\n\t\tnode.loop = -1;\n\n\t\treturn this.updateNode(node, 'play');\n\t},\n\n\tstop: function (node, callback)\n\t{\n\t\tif (!node) return null;\n\n\t\tif (callback && callback !== true) node.callback = callback;\n\t\treturn this.updateNode(node, callback === true ? 'stop' : 'softstop');\n\t},\n\n\tpause: function (node)\n\t{\n\t\tif (!node) return null;\n\n\t\treturn this.updateNode(node, 'pause');\n\t},\n\n\tresume: function (node)\n\t{\n\t\tif (!node) return null;\n\n\t\treturn this.updateNode (node, 'play');\n\t},\n\n\tfadeOut: function (node, millis, callback)\n\t{\n\t\tif (!node) return;\n\n\t\tif (!node.playing || node.timer)\n\t\t{\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar startTime = hrnow();\n\t\tnode.startVolume = node.volume;\n\n\t\tnode.timer = setInterval (function()\n\t\t{\n\t\t\tvar t = ((hrnow() - startTime) / millis);\n\t\t\tif (t > 1) t = 1;\n\n\t\t\tnode.volume = node.startVolume*(1-t);\n\t\t\tSound.updateNode(node, 'setvolume');\n\n\t\t\tif (t == 1)\n\t\t\t{\n\t\t\t\tclearInterval (node.timer);\n\t\t\t\tnode.timer = null;\n\n\t\t\t\tif (callback === true)\n\t\t\t\t\tSound.updateNode(node, 'stop');\n\t\t\t\telse\n\t\t\t\t\tSound.updateNode(node, 'pause');\n\n\t\t\t\tif (callback && callback !== true)\n\t\t\t\t\tcallback();\n\t\t\t}\n\t\t},\n\t\t50);\n\t},\n\n\tfadeIn: function (node, millis, callback)\n\t{\n\t\tif (!node) return;\n\n\t\tif (node.playing || node.timer)\n\t\t{\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar startTime = hrnow();\n\n\t\tnode.volume = 0;\n\t\tthis.updateNode(node, 'play');\n\n\t\tnode.timer = setInterval (function()\n\t\t{\n\t\t\tvar t = ((hrnow() - startTime) / millis);\n\t\t\tif (t > 1) t = 1;\n\n\t\t\tnode.volume = node.startVolume*t;\n\t\t\tSound.updateNode(node, 'setvolume');\n\n\t\t\tif (t == 1)\n\t\t\t{\n\t\t\t\tclearInterval (node.timer);\n\t\t\t\tnode.timer = null;\n\n\t\t\t\tif (callback) callback();\n\t\t\t}\n\t\t},\n\t\t50);\n\t}\n});\n\n/**\n * \tCreates a descriptor for an audio resource.\n */\nResources.Audio = function (src, opts=null)\n{\n\treturn { type: \"audio\", wrapper: \"Sound\", src: src, ...opts };\n};\n\nexport default Sound;\n","/*\n**\tresources/resources.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rinn } from 'rinn';\nimport System from '../system/system.js';\nimport Canvas from '../system/canvas.js';\nimport Log from '../system/log.js';\n\n//[import '../system/system']\n//[import '../system/canvas']\n//[import '../system/log']\n\nconst Resources = { };\n\nimport * as Wrappers from './wrappers.js';\n\nlet reported = false;\n\n\n//!namespace Resources\n\n\t//!type ConfigOptions =\n\n\t\t/**\n\t\t * Enables integer scaling. When enabled, calling `resizeImage` with `pixelated` parameter set to `true` will cause images to be resized to integer\n\t\t * factors. When disabled, images will be resized using the half/double method to eventually end up reaching the exact target size.\n\t\t *\n\t\t * @default true\n\t\t * !integerScalingEnabled?: boolean;\n\t\t */\n\t\t/**\n\t\t * Default value for the `pixelated` parameter of image resources. Controls whether to use integer scaling when resizing images. Also controls the default\n\t\t * scaling filter (LINEAR/NEAREST) the image will use when converted to a WebGL2 texture.\n\t\t * \n\t\t * @default false\n\t\t * !pixelated?: boolean;\n\t\t */\n\t\t/**\n\t\t * Default value for the `filter` parameter of image resources. When an image does not have the `pixelated` property nor `filter`, this value will be used.\n\t\t * \n\t\t * @default NEAREST\n\t\t * !filter?: 'LINEAR'|'NEAREST';\n\t\t */\n\t\t/**\n\t\t * Default value for the `original` parameter of image resources. When set to `true`, no resizing will take place on the image resource at all and the\n\t\t * original will be used as-is.\n\t\t * \n\t\t * @default false\n\t\t * !original?: boolean;\n\t\t */\n\n\t//!/type\n\n//!/namespace\n\n//:/**\n//: * Provides functionality to load and manipulate resources (images, audio, etc).\n//: */\n\n//!class Resources\n\nObject.assign(Resources,\n{\n\t/**\n\t * Enables integer scaling. When enabled, calling `resizeImage` with `pixelated` parameter set to `true` will cause images to be resized to integer\n\t * factors. When disabled, images will be resized using the half/double method to eventually end up reaching the exact target size.\n\t *\n\t * @default true\n\t * !static integerScalingEnabled: boolean;\n\t */\n\tintegerScalingEnabled: true,\n\n\t/**\n\t * Default value for the `pixelated` parameter of image resources. Controls whether to use integer scaling when resizing images. Also controls the default\n\t * scaling filter (LINEAR/NEAREST) the image will use when converted to a WebGL2 texture.\n\t * \n\t * @default false\n\t * !static pixelated: boolean;\n\t */\n\tpixelated: false,\n\n\t/**\n\t * Default value for the `filter` parameter of image resources. When an image does not have the `pixelated` property nor `filter`, this value will be used.\n\t * \n\t * @default LINEAR\n\t * !static filter: 'LINEAR'|'NEAREST';\n\t */\n\tfilter: 'LINEAR',\n\n\t/**\n\t * Default value for the `original` parameter of image resources. When set to `true`, no resizing will take place on the image resource at all and the\n\t * original will be used as-is.\n\t * \n\t * @default false\n\t * !static original: boolean;\n\t */\n\toriginal: false,\n\n\t/**\n\t * Configures the resources object with the specified options.\n\t * !static config (options: Resources.ConfigOptions) : void;\n\t */\n\tconfig: function (opts)\n\t{\n\t\tif (opts !== null)\n\t\t\tObject.assign(this, opts);\n\t},\n\n\t/**\n\t * Loads a list of resources. The list parameter is actually a dictionary with objects as shown in the example below.\n\t *\n\t * { type: \"image\", wrapper: \"\", src: \"assets/ui/btn-left.png\", width: 64, \\[ height: 64 \\], scale: 1, pixelated: false, filter: null, original: false }\n\t * { type: \"images\", wrapper: \"\", src: \"assets/ui/##.png\", count: 16, width: 64, \\[ height: 64 \\], pixelated: false }\n\t * { type: \"audio\", wrapper: \"\", src: \"assets/ui/tap.wav\", track: \"sfx|music\" }\n\t * { type: \"audios\", wrapper: \"\", src: \"assets/ui/snd-##.wav\", count: 4 }\n\t * { type: \"json\", wrapper: \"\", src: \"assets/config.json\" }\n\t * { type: \"data\", wrapper: \"\", src: \"assets/config.dat\" }\n\t * { type: \"text\", wrapper: \"\", src: \"assets/config.frag\" }\n\t * { type: \"object\", wrapper: \"\" }\n\t * \n\t * @param list - Map of resources to load.\n\t * @param progressCallback - Executed once for every resource loaded.\n\t * @param completeCallback - Executed when all resources have been loaded.\n\t * !static load (list: { \\[id: string\\] : object }, progressCallback: (index: number, count: number, ratio: number, name: string) => void, completeCallback: (list: { \\[id: string\\] : object }) => void) : void;\n\t */\n\tload: function (list, progressCallback, completeCallback, keyList, index)\n\t{\n\t\tif (!keyList)\n\t\t{\n\t\t\tkeyList = Object.keys(list);\n\n\t\t\tfor (let i in keyList)\n\t\t\t{\n\t\t\t\tif (!('__loaded' in list[keyList[i]]))\n\t\t\t\t\tlist[keyList[i]].__clone = Rinn.clone(list[keyList[i]]);\n\t\t\t}\n\n\t\t\tindex = 0;\n\t\t}\n\n\t\twhile (index < keyList.length && ('__loaded' in list[keyList[index]]))\n\t\t\tindex++;\n\n\t\tif (progressCallback)\n\t\t\tprogressCallback (index, keyList.length, index / keyList.length, keyList[index]);\n\n\t\tif (index == keyList.length)\n\t\t{\n\t\t\tif (completeCallback)\n\t\t\t\tcompleteCallback(list);\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet r = list[keyList[index]];\n\n\t\tr.resName = keyList[index];\n\n\t\tswitch (r.type)\n\t\t{\n\t\t\tcase \"image\":\n\t\t\t\tr.data = new Image ();\n\n\t\t\t\tr.data.onload = function ()\n\t\t\t\t{\n\t\t\t\t\tvar ratio = r.data.width / r.data.height;\n\n\t\t\t\t\tif (r.scale)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.width = int(r.data.width*r.scale);\n\t\t\t\t\t\tr.height = int(r.data.height*r.scale);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!r.width && !r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.width = r.data.width;\n\t\t\t\t\t\tr.height = r.data.height;\n\t\t\t\t\t}\n\t\t\t\t\telse if (r.width && !r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.height = int(r.width / ratio);\n\t\t\t\t\t}\n\t\t\t\t\telse if (!r.width && r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.width = int(ratio * r.height);\n\t\t\t\t\t}\n\n\t\t\t\t\tr.owidth = r.data.width;\n\t\t\t\t\tr.oheight = r.data.height;\n\n\t\t\t\t\tif (!r.hasOwnProperty('filter'))\n\t\t\t\t\t\tr.filter = !r.hasOwnProperty('pixelated') ? Resources.filter : (r.pixelated === true ? 'NEAREST' : Resources.filter);\n\n\t\t\t\t\tif (!r.hasOwnProperty('pixelated'))\n\t\t\t\t\t\tr.pixelated = Resources.pixelated;\n\n\t\t\t\t\tif (!r.hasOwnProperty('original'))\n\t\t\t\t\t\tr.original = Resources.original;\n\n\t\t\t\t\tif ((r.data.width != r.width || r.data.height != r.height) && r.original !== true)\n\t\t\t\t\t{\n//let t = hrnow();//violet\n\t\t\t\t\t\tr.data = Resources.resizeImage (r, r.width * (r.pixelated ? System.integerScaleFactor : System.scaleFactor), r.height * (r.pixelated ? System.integerScaleFactor : System.scaleFactor), r.pixelated, true);\n//console.log((hrnow() - t) + ': resize to ' + (r.width * (r.pixelated ? System.integerScaleFactor : System.scaleFactor)) + 'x' + (r.height * (r.pixelated ? System.integerScaleFactor : System.scaleFactor)));\n\t\t\t\t\t}\n\n\t\t\t\t\tr.rscale = r.data.width / r.width;\n\n\t\t\t\t\tr.data.rscale = r.rscale;\n\t\t\t\t\tr.data.filter = r.filter;\n\t\t\t\t\tr.data.targetWidth = r.width;\n\t\t\t\t\tr.data.targetHeight = r.height;\n\n\t\t\t\t\t// Pre-draw on an offscreen canvas, used to prevent a delay when rendering an image for the first time on some browsers.\n\t\t\t\t\tSystem.tempDisplayBuffer.drawImage(r.data, 0, 0);\n\t\t\t\t\tSystem.renderer.prepareImage(r.data);\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index+1);\n\t\t\t\t};\n\n\t\t\t\tr.data.onerror = function () {\n\t\t\t\t\tconsole.error (\"Error: Unable to load: \" + r.resName);\n\t\t\t\t};\n\n\t\t\t\tr.data.src = r.src + \"?r=\" + Math.random();\n\t\t\t\tbreak;\n\n\t\t\tcase \"images\":\n\n\t\t\t\tvar src = r.src;\n\n\t\t\t\tvar d0 = src.indexOf(\"#\");\n\t\t\t\tvar d1 = src.lastIndexOf(\"#\");\n\t\t\t\tvar dN = d1 - d0 + 1;\n\n\t\t\t\tif (d0 == -1)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'src' attribute requires one or more '#' marks.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!r.count)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'count' attribute was not found.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tr._i = 0;\n\t\t\t\tr.data = [ ];\n\n\t\t\t\tvar cb = function ()\n\t\t\t\t{\n\t\t\t\t\tif (r._i == r.count)\n\t\t\t\t\t{\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar tmp = { type: \"image\", width: r.width, height: r.height, scale: r.scale };\n\n\t\t\t\t\ttmp.src = r.src.substr(0, d0) + ((r._i++) / Math.pow(10,dN)).toFixed(dN).substr(2) + r.src.substr(d1+1);\n\t\t\t\t\ttmp.data = new Image ();\n\t\t\t\t\ttmp.resName = r.resName + \"#\" + (r._i - 1);\n\n\t\t\t\t\ttmp.data.onload = function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar ratio = tmp.data.width / tmp.data.height;\n\n\t\t\t\t\t\tif (tmp.scale)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = int(tmp.data.width*tmp.scale);\n\t\t\t\t\t\t\ttmp.height = int(tmp.data.height*tmp.scale);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!tmp.width && !tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = tmp.data.width;\n\t\t\t\t\t\t\ttmp.height = tmp.data.height;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (tmp.width && !tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.height = int(tmp.width / ratio);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!tmp.width && tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = int(ratio * tmp.height);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (r._i == 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tr.owidth = tmp.data.width;\n\t\t\t\t\t\t\tr.oheight = tmp.data.height;\n\n\t\t\t\t\t\t\tif (!r.hasOwnProperty('filter'))\n\t\t\t\t\t\t\t\tr.filter = !r.hasOwnProperty('pixelated') ? Resources.filter : (r.pixelated === true ? 'NEAREST' : Resources.filter);\n\n\t\t\t\t\t\t\tif (!r.hasOwnProperty('pixelated'))\n\t\t\t\t\t\t\t\tr.pixelated = Resources.pixelated;\n\n\t\t\t\t\t\t\tif (!r.hasOwnProperty('original'))\n\t\t\t\t\t\t\t\tr.original = Resources.original;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttmp.pixelated = r.pixelated;\n\t\t\t\t\t\ttmp.filter = r.filter;\n\t\t\t\t\t\ttmp.original = r.original;\n\n\t\t\t\t\t\tif ((tmp.data.width != tmp.width || tmp.data.height != tmp.height) && tmp.original !== true)\n\t\t\t\t\t\t{\n//let t = hrnow();//violet\n\t\t\t\t\t\t\ttmp.data = Resources.resizeImage (tmp, tmp.width * (r.pixelated ? System.integerScaleFactor : System.scaleFactor), tmp.height * (tmp.pixelated ? System.integerScaleFactor : System.scaleFactor), tmp.pixelated, true);\n//console.log((hrnow() - t) + ': resize to ' + (tmp.width * (r.pixelated ? System.integerScaleFactor : System.scaleFactor)) + 'x' + (tmp.height * (r.pixelated ? System.integerScaleFactor : System.scaleFactor)));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttmp.rscale = tmp.data.width / tmp.width;\n\n\t\t\t\t\t\ttmp.data.rscale = tmp.rscale;\n\t\t\t\t\t\ttmp.data.filter = tmp.filter;\n\t\t\t\t\t\ttmp.data.targetWidth = tmp.width;\n\t\t\t\t\t\ttmp.data.targetHeight = tmp.height;\n\n\t\t\t\t\t\tif (r._i == 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tr.width = tmp.width;\n\t\t\t\t\t\t\tr.height = tmp.height;\n\t\t\t\t\t\t\tr.rscale = tmp.rscale;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tSystem.tempDisplayBuffer.drawImage(tmp.data, 0, 0);\n\t\t\t\t\t\tSystem.renderer.prepareImage(tmp.data);\n\n\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\tcb();\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.onerror = function () {\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName);\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.src = tmp.src + \"?r=\" + Math.random();\n\t\t\t\t};\n\n\t\t\t\tcb();\n\t\t\t\tbreak;\n\n\t\t\tcase \"audio\":\n\n\t\t\t\tif (!r.track) r.track = \"sfx\";\n\n\t\t\t\tif (global.plugins && global.plugins.NativeAudio && r.track == \"sfx\")\n\t\t\t\t{\n\t\t\t\t\tif (!reported) {\n\t\t\t\t\t\tLog.write('ENGINE_NATIVEAUDIO');\n\t\t\t\t\t\treported = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tr.engine = Wrappers.Sound.ENGINE_NATIVEAUDIO;\n\t\t\t\t\tr.data = \"snd_\" + index;\n\n\t\t\t\t\tglobal.plugins.NativeAudio.preloadSimple(r.data, r.src,\n\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\t\t\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction(e) {\n\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load (sfx): \" + r.resName + \"\\n\" + e);\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (global.audioContext)\n\t\t\t\t{\n\t\t\t\t\tif (!reported) {\n\t\t\t\t\t\tLog.write('ENGINE_WEBAUDIO');\n\t\t\t\t\t\treported = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tr.engine = Wrappers.Sound.ENGINE_WEBAUDIO;\n\n\t\t\t\t\tfetchAudioBuffer (r.src + \"?r=\" + Math.random())\n\t\t\t\t\t.then (audioBuffer => {\n\t\t\t\t\t\tr.data = audioBuffer;\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\t\t\n\t\t\t\t\t})\n\t\t\t\t\t.catch (err => {\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName);\n\t\t\t\t\t});\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!reported) {\n\t\t\t\t\tLog.write('ENGINE_HTML5');\n\t\t\t\t\treported = true;\n\t\t\t\t}\n\n\t\t\t\tr.data = new Audio ();\n\t\t\t\tr.engine = Wrappers.Sound.ENGINE_HTML5;\n\n\t\t\t\tr.data.oncanplaythrough = function ()\n\t\t\t\t{\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t};\n\n\t\t\t\tr.data.onerror = function ()\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName);\n\t\t\t\t};\n\n\t\t\t\tr.data.src = r.src + \"?r=\" + Math.random();\n\t\t\t\tbreak;\n\n\t\t\tcase \"audios\":\n\n\t\t\t\tvar src = r.src;\n\n\t\t\t\tvar d0 = src.indexOf(\"#\");\n\t\t\t\tvar d1 = src.lastIndexOf(\"#\");\n\t\t\t\tvar dN = d1 - d0 + 1;\n\n\t\t\t\tif (d0 == -1)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'src' attribute requires one or more '#' marks.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!r.count)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'count' attribute was not found.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tr._i = 0;\n\t\t\t\tr.data = [ ];\n\n\t\t\t\tvar cb = function ()\n\t\t\t\t{\n\t\t\t\t\tif (r._i == r.count)\n\t\t\t\t\t{\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar tmp = { type: \"audio\", track: r.track };\n\n\t\t\t\t\ttmp.src = r.src.substr(0, d0) + ((r._i++) / Math.pow(10,dN)).toFixed(dN).substr(2) + r.src.substr(d1+1);\n\t\t\t\t\ttmp.resName = r.resName + \"#\" + (r._i - 1);\n\n\t\t\t\t\tif (!tmp.track) tmp.track = \"sfx\";\n\n\t\t\t\t\tif (global.plugins && global.plugins.NativeAudio && tmp.track == \"sfx\")\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_NATIVEAUDIO;\n\t\t\t\t\t\ttmp.data = \"snd_\" + index + \"_\" + r._i;\n\t\n\t\t\t\t\t\tglobal.plugins.NativeAudio.preloadSimple(tmp.data, tmp.src,\n\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\t\t\tcb();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfunction(e) {\n\t\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load (sfx): \" + tmp.resName + \"\\n\" + e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (global.audioContext)\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_WEBAUDIO;\n\n\t\t\t\t\t\tfetchAudioBuffer (tmp.src + \"?r=\" + Math.random())\n\t\t\t\t\t\t.then (audioBuffer => {\n\t\t\t\t\t\t\ttmp.data = audioBuffer;\n\t\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\t\tcb();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch (err => {\n\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\ttmp.data = new Audio ();\n\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_HTML5;\n\n\t\t\t\t\ttmp.data.oncanplaythrough = function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\tcb();\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.onerror = function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName);\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.src = tmp.src + \"?r=\" + Math.random();\n\t\t\t\t};\n\n\t\t\t\tcb();\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"json\":\n\n\t\t\t\tfetchd (r.src + \"?r=\" + Math.random(), { responseType: 'json' }).then(function(json)\n\t\t\t\t{\n\t\t\t\t\tr.data = json;\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t})\n\t\t\t\t.catch(function(err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName + \". Error: \" + err);\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"data\":\n\n\t\t\t\tfetchd (r.src + \"?r=\" + Math.random()).then(function(arraybuffer)\n\t\t\t\t{\n\t\t\t\t\tr.data = arraybuffer;\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t})\n\t\t\t\t.catch(function(err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName + \". Error: \" + err);\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"text\":\n\n\t\t\t\tfetchd (r.src + \"?r=\" + Math.random()).then(function(arrayBuffer)\n\t\t\t\t{\n\t\t\t\t\tr.data = String.fromCharCode.apply(null, new Uint8Array(arrayBuffer));\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\t})\n\t\t\t\t.catch(function(err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName + \". Error: \" + err);\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"object\":\n\t\t\t\tr.data = { };\n\n\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\tResources.load (list, progressCallback, completeCallback, keyList, index + 1);\n\t\t\t\tbreak;\n\t\t}\n\t},\n\n\t/**\n\t * Unloads the specified list of resources.\n\t * !static unload (list: { \\[id: string\\] : object }) : void;\n\t */\n\tunload: function (list)\n\t{\n\t\tthrow new Error('IMPLEMENTED UNLOAD!');\n\n\t\tvar __original;\n\n\t\tfor (var i in list)\n\t\t{\n\t\t\tif (i == \"__original\")\n\t\t\t{\n\t\t\t\t__original = list[i];\n\t\t\t\tdelete list[i];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (list[i].r)\n\t\t\t{\n\t\t\t\tdispose(list[i]);\n\t\t\t\tlist[i] = list[i].r;\n\t\t\t}\n\n\t\t\tswitch (list[i].type)\n\t\t\t{\n\t\t\t\tcase \"audio\":\n\t\t\t\t\t// violet: unload audio if using NativeAudio\n\t\t\t\t\t// global.plugins.NativeAudio.unload\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"audios\":\n\t\t\t\t\t// violet: unload audio if using NativeAudio\n\t\t\t\t\t// global.plugins.NativeAudio.unload\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"images\":\n\t\t\t\t\tfor (var j = 0; j < list[i].data.length; j++)\n\t\t\t\t\t\tdispose (list[i].data[j]);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tdispose (list[i].data);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tlist[i].data = null;\n\t\t\tdelete list[i];\n\t\t}\n\n\t\tfor (var i in __original)\n\t\t\tlist[i] = __original[i];\n\t},\n\n\t/**\n\t * Executes post-load actions on a resource.\n\t */\n\tonLoaded: function (list, index)\n\t{\n\t\tvar r = list[index];\n\t\tif (!r.wrapper || !(r.wrapper in Wrappers)) return;\n\n\t\tlist[index] = new Wrappers[r.wrapper] (r);\n\t\tlist[index].__loaded = true;\n\t},\n\n\t/**\n\t * Resizes the given image to the specified size.\n\t * !static resizeImage (image: HTMLImageElement, targetWidth: number, targetHeight: number, pixelated?: boolean, discardOriginal?: boolean) : HTMLImageElement;\n\t */\n\tresizeImage: function (image, dw, dh, pixelated, discardOriginal)\n\t{\n\t\tvar sw = image.data.width;\n\t\tvar sh = image.data.height;\n\n\t\tdw = int(dw);\n\t\tdh = int(dh);\n\n\t\tif (sw == dw && sh == dh)\n\t\t\treturn image.data;\n\n\t\tif (!this.integerScalingEnabled && pixelated) pixelated = null;\n\n\t\tif (!pixelated)\n\t\t{\n\t\t\tpixelated = pixelated === null ? false : true;\n\n\t\t\tvar temp = new Canvas ({ hidden: true, antialias: pixelated }).resize (sw, sh);\n\t\t\ttemp.drawImage (image.data, 0, 0);\n\n\t\t\twhile (true)\n\t\t\t{\n\t\t\t\tvar tw = sw >> 1;\n\t\t\t\tvar th = sh >> 1;\n\n\t\t\t\tif (tw <= dw || th <= dh)\n\t\t\t\t\tbreak;\n\n\t\t\t\tvar output = new Canvas ({ hidden: true, antialias: pixelated }).resize (tw, th);\n\t\t\t\toutput.drawImage (temp.elem, 0, 0, tw, th);\n\t\t\t\ttemp.dispose ();\n\n\t\t\t\tsw = tw;\n\t\t\t\tsh = th;\n\n\t\t\t\ttemp = output;\n\t\t\t}\n\n\t\t\tvar output = new Canvas ({ hidden: true, antialias: pixelated }).resize (dw, dh);\n\t\t\toutput.drawImage (temp.elem, 0, 0, dw, dh);\n\t\t\ttemp.dispose ();\n\n\t\t\tif (discardOriginal)\n\t\t\t\tdispose (image.data);\n\n\t\t\treturn output.elem;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (int(dw / sw) > 0)\n\t\t\t{\n\t\t\t\tvar ratio = int((dw / sw) + 0.9);\n\n\t\t\t\tdw = ratio * sw;\n\t\t\t\tdh = ratio * sh;\n\n\t\t\t\tvar rep_x = dw / sw;\n\t\t\t\tvar rep_y = dh / sh;\n\n\t\t\t\tvar output = new Canvas ({ hidden: true, antialias: false }).resize (dw, dh);\n\n\t\t\t\tvar temp = new Canvas ({ hidden: true, antialias: false }).resize (sw, sh);\n\t\t\t\ttemp.drawImage (image.data, 0, 0);\n\n\t\t\t\tfor (var j = 0; j < sh; j++)\n\t\t\t\t{\n\t\t\t\t\tvar s = temp.getImageData(0, j, sw, 1).data;\n\t\t\t\t\tvar sp = 0;\n\n\t\t\t\t\tfor (var i = 0; i < sw && sp < s.length; i++, sp += 4)\n\t\t\t\t\t{\n\t\t\t\t\t\toutput.fillStyle(\"rgba(\"+s[sp]+\",\"+s[sp+1]+\",\"+s[sp+2]+\",\"+(s[sp+3] / 255)+\")\");\n\t\t\t\t\t\toutput.fillRect(i*rep_x, j*rep_y, rep_x, rep_y);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttemp.dispose();\n\n\t\t\t\treturn output.elem;\n\t\t\t}\n\n\t\t\treturn this.resizeImage (image, dw, dh, null, discardOriginal);\n\t\t}\n\t},\n\n\t/**\n\t * Flips an image horizontally.\n\t * !static flipImageHorz (image: HTMLImageElement) : HTMLImageElement;\n\t */\n\tflipImageHorz: function (image)\n\t{\n\t\tvar temp = new Canvas ({ hidden: true }).resize (image.data.width, image.data.height);\n\n\t\ttemp.translate(image.data.width, 0);\n\t\ttemp.scale(-1, 1);\n\n\t\ttemp.drawImage (image.data, 0, 0);\n\t\treturn temp.elem;\n\t},\n\n\t/**\n\t * Flips an image vertically.\n\t * !static flipImageVert (image: HTMLImageElement) : HTMLImageElement;\n\t */\n\tflipImageVert: function (image)\n\t{\n\t\tvar temp = new Canvas ({ hidden: true }).resize (image.data.width, image.data.height);\n\n\t\ttemp.translate(0, image.data.height);\n\t\ttemp.scale(1, -1);\n\n\t\ttemp.drawImage (image.data, 0, 0);\n\t\treturn temp.elem;\n\t},\n\n\t/**\n\t * Forces the browser to show a download dialog.\n\t * !static showDownload (filename: string, dataUrl: string) : void;\n\t */\n\tshowDownload: function (filename, dataUrl)\n\t{\n\t\tvar link = document.createElement(\"a\");\n\t\tlink.href = dataUrl;\n\n\t\tlink.style.display = 'none';\n\t\tlink.download = filename;\n\t\tlink.target = \"_blank\";\n\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t},\n\n\t/**\n\t * Forces the browser to show a file selection dialog.\n\t * !static showFilePicker (allowMultiple: boolean, accept: string, callback: (files: Array<File>) => void) : void;\n\t */\n\tshowFilePicker: function (allowMultiple, accept, callback)\n\t{\n\t\tvar input = document.createElement(\"input\");\n\n\t\tinput.type = \"file\";\n\t\tinput.accept = accept;\n\t\tinput.style.display = 'none';\n\t\tinput.multiple = allowMultiple;\n\n\t\tdocument.body.appendChild(input);\n\n\t\tinput.onchange = function ()\n\t\t{\n\t\t\tcallback(input.files);\n\t\t};\n\n\t\tdocument.body.onfocus = function ()\n\t\t{\n\t\t\tdocument.body.onfocus = null;\n\t\t\tdocument.body.removeChild(input);\n\t\t};\n\n\t\tinput.click();\n\t},\n\n\t/**\n\t * Loads a file using FileReader and returns the result as a dataURL.\n\t * !static loadAsDataURL (file: File, callback: (dataUrl: string) => void) : void;\n\t */\n\tloadAsDataURL: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsDataURL(file);\n\t},\n\n\t/**\n\t * Loads a file using FileReader and returns the result as text.\n\t * !static loadAsText (file: File, callback: (text: string) => void) : void;\n\t */\n\tloadAsText: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsText(file);\n\t},\n\n\t/**\n\t * Loads a file using FileReader and returns the result as an array buffer.\n\t * !static loadAsArrayBuffer (file: File, callback: (buff: ArrayBuffer) => void) : void;\n\t */\n\tloadAsArrayBuffer: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsArrayBuffer(file);\n\t},\n\n\t/**\n\t * Loads an array of File objects using FileReader and returns them as data URLs.\n\t * !static loadAllAsDataURL (fileList: Array<File>, callback: (urlList: Array<{name:string, size:number, url:string}>) => void) : void;\n\t */\n\tloadAllAsDataURL: function (fileList, callback)\n\t{\n\t\tvar result = [];\n\n\t\tif (!fileList || !fileList.length)\n\t\t{\n\t\t\tcallback(result);\n\t\t\treturn;\n\t\t}\n\n\t\tvar loadNext = function (i)\n\t\t{\n\t\t\tif (i == fileList.length)\n\t\t\t{\n\t\t\t\tcallback(result);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tResources.loadAsDataURL (fileList[i], function(url) {\n\t\t\t\tresult.push({ name: fileList[i].name, size: fileList[i].size, url: url });\n\t\t\t\tloadNext(i+1);\n\t\t\t});\n\t\t};\n\n\t\tloadNext(0);\n\t}\n});\n\n//!/class\n\nexport default Resources;\n","/*\n**\tresources/sound-array.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Sound from './sound.js';\n\n//![import \"./sound.js\"]\n\n/*\n\ttrack: string (music|sfx)\n\tmode: sequential|random\n*/\n\nexport default Class.extend\n({\n\tr: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"audios\")\n\t\t\tthrow new Error (\"Resource is not audios.\");\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tif (!this.r.track)\n\t\t\tthis.r.track = \"sfx\";\n\n\t\tif (!this.r.mode)\n\t\t\tthis.r.mode = \"random\";\n\n\t\tthis.track = Sound[this.r.track.toUpperCase()];\n\n\t\tthis.sounds = [];\n\t\tthis.lastIndex = -1;\n\n\t\tfor (var i = 0; i < this.r.data.length; i++)\n\t\t{\n\t\t\tthis.sounds.push(new Sound (Object.assign (this.r.data[i], { track: this.r.track })));\n\t\t}\n\t},\n\n\tgetRandomSound: function ()\n\t{\n\t\tif (this.r.mode == \"random\")\n\t\t\treturn this.sounds[randr(0, this.sounds.length-1)];\n\n\t\tthis.lastIndex = ++this.lastIndex % this.sounds.length;\n\t\treturn this.sounds[this.lastIndex];\n\t},\n\n\tplay: function (callback, volume)\n\t{\n\t\treturn Sound.play (this.getRandomSound(), callback, volume);\n\t},\n\n\tplayLoop: function (callback, volume)\n\t{\n\t\treturn Sound.playLoop (this.getRandomSound(), callback, volume);\n\t},\n\n\tplayAt: function (index, callback, volume)\n\t{\n\t\treturn Sound.play (this.sounds[index % this.sounds.length], callback, volume);\n\t},\n\n\tplayLoopAt: function (index, callback, volume)\n\t{\n\t\treturn Sound.playLoop (this.sounds[index % this.sounds.length], callback, volume);\n\t}\n});\n","/*\n**\tresources/wrappers.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n//![import './drawable']\nimport _Drawable from './drawable.js'; export const Drawable = _Drawable;\n//![import './custom']\nimport _Custom from './custom.js'; export const Custom = _Custom;\n//![import './spritesheet']\nimport _Spritesheet from './spritesheet.js'; export const Spritesheet = _Spritesheet;\n//![import './spritesheet-animation']\nimport _SpritesheetAnimation from './spritesheet-animation.js'; export const SpritesheetAnimation = _SpritesheetAnimation;\n//![import './spritefont']\nimport _SpriteFont from './spritefont.js'; export const SpriteFont = _SpriteFont;\n//![import './sound']\nimport _Sound from './sound.js'; export const Sound = _Sound;\n//![import './sound-array']\nimport _SoundArray from './sound-array.js'; export const SoundArray = _SoundArray;\n","/*\n**\tutils/priority-queue.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\n\n//!class PriorityQueue\n\nexport default Class.extend\n({\n\tclassName: 'PriorityQueue',\n\n\tqueue: null,\n\tqueueKeys: null,\n\torder: null,\n\n\t/**\n\t * \tConstructs an priority queue.\n\t * \t!constructor();\n\t */\n\t__ctor: function()\n\t{\n\t\tthis.queue = { };\n\t\tthis.queueKeys = [];\n\t},\n\n\t/**\n\t * \tAdds an object to the priority queue.\n\t * \t!add (obj: { priority: number }) : object;\n\t */\n\tadd: function (object)\n\t{\n\t\tif (object == null)\n\t\t\treturn null;\n\n\t\tif (!('priority' in object))\n\t\t\tthrow new Error ('PriorityQueue (add): Object has no `priority` property.');\n\n\t\tif (!(object.priority in this.queue))\n\t\t{\n\t\t\tthis.queue[object.priority] = { is_dirty: false, list: [ ] };\n\t\t\tthis.queueKeys.push(object.priority);\n\n\t\t\tthis.order = Object.keys(this.queue).sort((a,b) => a-b);\n\t\t}\n\n\t\tif (this.queue[object.priority].list.indexOf(object) === -1)\n\t\t\tthis.queue[object.priority].list.push(object);\n\n\t\treturn object;\n\t},\n\n\t/**\n\t * \tMarks an object to be removed from the priority queue. Use `cleanup` to actually remove them.\n\t * \t!remove (obj: object) : object;\n\t */\n\tremove: function (object)\n\t{\n\t\tif (object == null)\n\t\t\treturn null;\n\n\t\tif (!('priority' in object))\n\t\t\tthrow new Error ('PriorityQueue (remove): Object has no `priority` property.');\n\n\t\tif (!(object.priority in this.queue))\n\t\t\treturn object;\n\n\t\tlet i = this.queue[object.priority].list.indexOf(object);\n\t\tif (i === -1) return object;\n\n\t\tthis.queue[object.priority].is_dirty = true;\n\t\tthis.queue[object.priority].list[i] = null;\n\n\t\treturn object;\n\t},\n\n\t/**\n\t * \tRuns a cleanup of the queue by removing any objects marked to be removed.\n\t * \t!cleanup() : void;\n\t */\n\tcleanup: function()\n\t{\n\t\tfor (let i = 0; i < this.queueKeys.length; i++)\n\t\t{\n\t\t\tlet q = this.queue[this.queueKeys[i]];\n\t\t\tif (!q.is_dirty) continue;\n\n\t\t\tfor (let j = 0; j < q.list.length; j++)\n\t\t\t{\n\t\t\t\tif (q.list[j] == null)\n\t\t\t\t{\n\t\t\t\t\tq.list.splice(j--, 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tq.is_dirty = false;\n\t\t}\n\t},\n\n\t/**\n\t * \tRuns the specified callback for each object in the queue. Executed in order of priority (from low number to high number).\n\t * \t@param callback - Return `false` to stop the forEach execution immediately.\n\t * \t!forEach (callback: (obj: object) => boolean) : void;\n\t */\n\tforEach: function (callback)\n\t{\n\t\tlet is_dirty = false;\n\t\tlet is_complete = false;\n\n\t\tfor (let i = 0; !is_complete && i < this.order.length; i++)\n\t\t{\n\t\t\tlet list = this.queue[this.order[i]].list;\n\n\t\t\tfor (let j = 0; !is_complete && j < list.length; j++)\n\t\t\t{\n\t\t\t\tif (list[j] != null)\n\t\t\t\t{\n\t\t\t\t\tif (callback(list[j]) === false)\n\t\t\t\t\t\tis_complete = true;\n\t\t\t\t}\n\n\t\t\t\tif (list[j] == null)\n\t\t\t\t\tis_dirty = true;\n\t\t\t}\n\t\t}\n\n\t\tif (is_dirty) this.cleanup();\n\t},\n\n\t/**\n\t * \tRuns the specified callback for each object in the queue. Executed in reverse order of priority (from high number to low number).\n\t * \t@param callback - Return `false` to stop the forEachRev execution immediately.\n\t * \t!forEachRev (callback: (obj: object) => boolean) : void;\n\t */\n\tforEachRev: function (callback)\n\t{\n\t\tlet is_dirty = false;\n\t\tlet is_complete = false;\n\n\t\tfor (let i = this.order.length-1; !is_complete && i >= 0; i--)\n\t\t{\n\t\t\tlet list = this.queue[this.order[i]].list;\n\n\t\t\tfor (let j = list.length-1; !is_complete && j >= 0; j--)\n\t\t\t{\n\t\t\t\tif (list[j] != null)\n\t\t\t\t{\n\t\t\t\t\tif (callback(list[j]) === false)\n\t\t\t\t\t\tis_complete = true;\n\t\t\t\t}\n\n\t\t\t\tif (list[j] == null)\n\t\t\t\t\tis_dirty = true;\n\t\t\t}\n\t\t}\n\n\t\tif (is_dirty) this.cleanup();\n\t},\n\n\t/**\n\t * \tRuns the specified callback for each object in the queue. Executed in order of priority (from low number to high number). When\n\t * \tthe cycle finishes the given `finishedCallback` will be executed.\n\t * \t@param callback - Return `false` to stop the forEachAsync execution immediately. Must manually execute `next` when finished.\n\t * \t!forEachAsync (callback: (obj: object, next: Function) => boolean) : void;\n\t */\n\tforEachAsync: function (callback, finishedCallback=null)\n\t{\n\t\tlet _ = this;\n\n\t\tlet is_dirty = false;\n\t\tlet is_complete = false;\n\n\t\tlet i = -1;\n\t\tlet j = -1;\n\n\t\tlet list = null;\n\n\t\tlet next_j = function()\n\t\t{\n\t\t\tj++;\n\n\t\t\tif (!is_complete && j < list.length)\n\t\t\t{\n\t\t\t\tif (list[j] != null)\n\t\t\t\t{\n\t\t\t\t\tif (callback(list[j], next_j) === false)\n\t\t\t\t\t\tis_complete = true;\n\t\t\t\t}\n\n\t\t\t\tif (list[j] == null)\n\t\t\t\t\tis_dirty = true;\n\n\t\t\t\tif (is_complete) next_j();\n\t\t\t}\n\t\t\telse\n\t\t\t\tnext_i();\n\t\t};\n\n\t\tlet next_i = function()\n\t\t{\n\t\t\ti++;\n\n\t\t\tif (!is_complete && i < _.order.length)\n\t\t\t{\n\t\t\t\tlist = _.queue[_.order[i]].list;\n\t\t\t\tj = -1;\n\t\t\t\tnext_j();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (is_dirty) _.cleanup();\n\t\t\t\tif (finishedCallback) finishedCallback();\n\t\t\t}\n\t\t};\n\n\t\tnext_i();\n\t},\n\n\t/**\n\t * \tRuns the specified callback for each object in the queue. Executed in reverse order of priority (from high number to low number). When\n\t * \tthe cycle finishes the given `finishedCallback` will be executed.\n\t * \t@param callback - Return `false` to stop the forEachRevAsync execution immediately. Must manually execute `next` when finished.\n\t * \t!forEachRevAsync (callback: (obj: object, next: Function) => boolean) : void;\n\t */\n\tforEachRevAsync: function (callback)\n\t{\n\t\talert('NOT IMPLEMENTED: forEachRevAsync');\n\t}\n});\n","/*\n**\tutils/handler.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Recycler from './recycler.js';\nimport Callback from './callback.js';\n\n//![import \"./recycler\"]\n//![import \"./callback\"]\n\n//:/**\n//: * \tThe handler class allows zero or more callbacks to be attached, such that when the `exec` method of the handler is invoked, all attached callbacks will also be executed.\n//: */\n\n//!class Handler\n\nconst Handler = Class.extend\n({\n\tclassName: 'Handler',\n\n\t/**\n\t * \tHandler host element or value.\n\t * \t!host: any;\n\t */\n\thost: null,\n\n\t/**\n\t * \tTop and bottom of the linked list.\n\t */\n\ttop: null,\n\tbottom: null,\n\n\t/**\n\t * \tInitializes the Handler instance.\n\t * \t!constructor (host?: any);\n\t */\n\t__ctor: function (host=null)\n\t{\n\t\tthis.host = host;\n\n\t\tthis.top = null;\n\t\tthis.bottom = null;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tRemoves all callbacks from the handler.\n\t*/\n\t__dtor: function()\n\t{\n\t\tthis.remove();\n\t},\n\n\t/**\n\t * \tAdds the specified callback to the handler.\n\t * \t!add (callback: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) : Callback;\n\t */\n\tadd: function (callback, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tlet node = Callback.isInstance(callback) ? callback : Callback.Pool.alloc(callback, arg0, arg1, arg2, arg3, arg4, arg5);\n\n\t\tnode.prev = this.bottom;\n\n\t\tif (this.bottom !== null)\n\t\t\tthis.bottom.next = node;\n\n\t\tthis.bottom = node;\n\n\t\tif (this.top === null)\n\t\t\tthis.top = node;\n\n\t\treturn node;\n\t},\n\n\t/**\n\t * \tUnlinks a callback from the handler.\n\t * \t!unlink (node: Callback) : Handler;\n\t */\n\tunlink: function (node)\n\t{\n\t\tif (node.prev) node.prev.next = node.next;\n\t\tif (node.next) node.next.prev = node.prev;\n\n\t\tif (this.top === node)\n\t\t\tthis.top = node.next;\n\n\t\tif (this.bottom === node)\n\t\t\tthis.bottom = node.prev;\n\n\t\tnode.prev = null;\n\t\tnode.next = null;\n\n\t\tdispose(node);\n\t},\n\n\t/**\n\t * \tRemoves all callbacks matching the specified arguments.\n\t * \t!remove (callback?: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) : Handler;\n\t */\n\tremove: function (callback=null, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tif (callback !== null && Callback.isInstance(callback))\n\t\t{\n\t\t\tthis.unlink(callback);\n\t\t\treturn this;\n\t\t}\n\n\t\tlet node = this.top;\n\n\t\twhile (node !== null)\n\t\t{\n\t\t\tlet next = node.next;\n\n\t\t\tif (node.isEqual(callback, arg0, arg1, arg2, arg3, arg4, arg5))\n\t\t\t\tthis.unlink(node);\n\n\t\t\tnode = next;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the first callback matching the specified arguments.\n\t * \t!find (callback: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) : Callback;\n\t */\n\tfind: function (callback, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tlet node = this.top;\n\n\t\twhile (node !== null)\n\t\t{\n\t\t\tif (node.isEqual(callback, arg0, arg1, arg2, arg3, arg4, arg5))\n\t\t\t\treturn node;\n\n\t\t\tnode = node.next;\n\t\t}\n\n\t\treturn null;\n\t},\n\n\t/**\n\t * \tExecutes all callbacks in the handler.\n\t * \t!exec(host?: any) : void;\n\t */\n\texec: function (host=null)\n\t{\n\t\tlet node = this.top;\n\n\t\thost = host ?? this.host;\n\n\t\twhile (node !== null)\n\t\t{\n\t\t\tlet next = node.next;\n\n\t\t\tif (node.exec(host) === false)\n\t\t\t\tthis.unlink(node);\n\n\t\t\tnode = next;\n\t\t}\n\t},\n\n\t/**\n\t * \tExecutes the first callback matching the specified arguments.\n\t * \t!execf (callback?: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) : void;\n\t */\n\texecf: function (callback=null, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tlet node = this.top;\n\n\t\twhile (node !== null)\n\t\t{\n\t\t\tlet next = node.next;\n\n\t\t\tif (node.isEqual(callback, arg0, arg1, arg2, arg3, arg4, arg5))\n\t\t\t{\n\t\t\t\tif (node.exec(this.host) === false)\n\t\t\t\t\tthis.unlink(node);\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tnode = next;\n\t\t}\n\t},\n\n\t/**\n\t * \tExecutes the specified callback.\n\t * \t!execc (node: Callback, host?: any) : void;\n\t */\n\texecc: function (node, host=null)\n\t{\n\t\tif (node.exec(host ?? this.host) === false)\n\t\t\tthis.unlink(node);\n\t}\n});\n\n//!/class\n\n//!namespace Handler\n//!namespace Pool\n\n/**\n * \tAllocates a new handler instance.\n * \t!function alloc (host?: Object) : Handler;\n */\n\nRecycler.createPool(Handler, 16384, 6144);\nexport default Handler;\n","/*\n**\tutils/callback.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Recycler from './recycler.js';\n\n//![import \"./recycler\"]\n\n//:/**\n//: * \tDefines a callback node. Contains a callback function, and up to six arguments.\n//: */\n\n//!class Callback\n\nconst Callback = Class.extend\n({\n\tclassName: 'Callback',\n\n\t/*\n\t**\tCallback function.\n\t*/\n\tcallback: null,\n\n\t/*\n\t**\tOptional arguments.\n\t*/\n\targ0: null,\n\targ1: null,\n\targ2: null,\n\targ3: null,\n\targ4: null,\n\targ5: null,\n\n\t/*\n\t**\tLink to the previous and next callback.\n\t*/\n\tprev: null,\n\tnext: null,\n\n\t/**\n\t * \tInitializes the callback with the specified arguments.\n\t * \t!constructor (callback: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any);\n\t */\n\t__ctor: function (callback, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tthis.callback = callback;\n\n\t\tthis.arg0 = arg0;\n\t\tthis.arg1 = arg1;\n\t\tthis.arg2 = arg2;\n\t\tthis.arg3 = arg3;\n\t\tthis.arg4 = arg4;\n\t\tthis.arg5 = arg5;\n\n\t\tthis.prev = null;\n\t\tthis.next = null;\n\t},\n\n\t/*\n\t**\tDestructs the instance.\n\t*/\n\t__dtor: function()\n\t{\n\t\tthis.callback = null;\n\n\t\tthis.arg0 = null;\n\t\tthis.arg1 = null;\n\t\tthis.arg2 = null;\n\t\tthis.arg3 = null;\n\t\tthis.arg4 = null;\n\t\tthis.arg5 = null;\n\n\t\tthis.prev = null;\n\t\tthis.next = null;\n\t},\n\n\t/*\n\t**\tReturns true if the specified arguments are the same as the callback. Compares from left to right. All null values are ignored.\n\t*/\n\tisEqual: function (callback=null, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null)\n\t{\n\t\tif (callback !== null && Callback.isInstance(callback))\n\t\t\treturn callback === this;\n\n\t\tif (callback !== null && this.callback !== callback)\n\t\t\treturn false;\n\n\t\tif (arg0 !== null && this.arg0 !== arg0)\n\t\t\treturn false;\n\n\t\tif (arg1 !== null && this.arg1 !== arg1)\n\t\t\treturn false;\n\n\t\tif (arg2 !== null && this.arg2 !== arg2)\n\t\t\treturn false;\n\n\t\tif (arg3 !== null && this.arg3 !== arg3)\n\t\t\treturn false;\n\n\t\tif (arg4 !== null && this.arg4 !== arg4)\n\t\t\treturn false;\n\n\t\tif (arg5 !== null && this.arg5 !== arg5)\n\t\t\treturn false;\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tExecutes the callback. Returns `false` if the callback has finished and should be removed.\n\t * \t@param host - Host object.\n\t * \t!exec (host: Object) : boolean;\n\t */\n\texec: function (host)\n\t{\n\t\tif (this.callback !== null)\n\t\t\treturn this.callback (host, this.arg0, this.arg1, this.arg2, this.arg3, this.arg4, this.arg5);\n\n\t\treturn true;\n\t}\n});\n\n//!/class\n\n//!namespace Callback\n//!namespace Pool\n\n/**\n * \tAllocates a callback with the specified arguments.\n * \t!function alloc (callback: Function, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) : Callback;\n */\n\nRecycler.createPool(Callback, 16384, 6144);\nexport default Callback;\n","/*\n**\tmath/rect.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"../utils/recycler\"]\n//![import \"./vec2\"]\n\n//:/**\n//: * \tRepresents a 2D rectangle.\n//: */\n\n//!class Rect\n\nconst Rect = Class.extend\n({\n\tclassName: 'Rect',\n\n\t/**\n\t * \tCoordinates of the rectangle (cx and cy are for the center). Note that this fields are readonly they should be\n\t * \tmodified through methods only.\n\t */\n\n\t/**\n\t * \t!readonly cx: number;\n\t */\n\tcx: 0,\n\t/**\n\t * \t!readonly cy: number;\n\t */\n\tcy: 0,\n\t/**\n\t * \t!readonly x1: number;\n\t */\n\tx1: 0,\n\t/**\n\t * \t!readonly y1: number;\n\t */\n\ty1: 0,\n\t/**\n\t * \t!readonly x2: number;\n\t */\n\tx2: 0,\n\t/**\n\t * \t!readonly y2: number;\n\t */\n\ty2: 0,\n\n\t/**\n\t * \tConstructs a rectangle of zero size, centered at (0, 0).\n\t * \t!constructor();\n\t */\n\t/**\n\t * \tConstructs a rectangle centered at (0, 0) with the specified size.\n\t * \t!constructor (width: number, height: number);\n\t */\n\t/**\n\t * \tConstructs a rectangle with the specified coordinates.\n\t * \t!constructor (x1: number, y1: number, x2: number, y2: number);\n\t */\n\t__ctor: function (x1=null, y1=null, x2=null, y2=null)\n\t{\n\t\tif (x1 === null)\n\t\t{\n\t\t\tthis.x1 = this.y1 = this.x2 = this.y2 = this.cx = this.cy = 0;\n\t\t\treturn this;\n\t\t}\n\n\t\tif (x2 === null)\n\t\t{\n\t\t\tthis.set (0, 0, 0, 0);\n\t\t\tthis.resize (x1, y1);\n\t\t\treturn this;\n\t\t}\n\n\t\treturn this.set(x1, y1, x2, y2);\n\t},\n\n\t/*\n\t**\tDestructor.\n\t*/\n\t__dtor: function ()\n\t{\n\t},\n\n\t/**\n\t * \tReturns a clone of the rectangle.\n\t * \t!clone() : Rect;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Rect.Rool.alloc(this.x1, this.y1, this.x2, this.y2);\n\t},\n\n\t/**\n\t * \tSets all coordinates of the rectangle to zero.\n\t * \t!zero() : Rect;\n\t */\n\tzero: function ()\n\t{\n\t\tthis.cx = 0; this.cy = 0;\n\t\tthis.x1 = 0; this.y1 = 0;\n\t\tthis.x2 = 0; this.y2 = 0;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets all coordinates of the rectangle to `null` for subsequent use with `extendWithPoint`.\n\t * \t!reset() : Rect;\n\t */\n\treset: function ()\n\t{\n\t\tthis.cx = null; this.cy = null;\n\t\tthis.x1 = null; this.y1 = null;\n\t\tthis.x2 = null; this.y2 = null;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tExtends the rectangle to contain the specified vector coordinates.\n\t * \t!extendWithPoint (v: Vec2) : Rect;\n\t */\n\t/**\n\t * \tExtends the rectangle to contain the specified point.\n\t * \t!extendWithPoint (x: number, y: number) : Rect;\n\t */\n\textendWithPoint: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tconst r = x;\n\t\t\tx = r.x;\n\t\t\ty = r.y;\n\t\t}\n\n\t\tif (this.x1 === null || x < this.x1) this.x1 = x;\n\t\tif (this.y1 === null || y < this.y1) this.y1 = y;\n\t\tif (this.x2 === null || x > this.x2) this.x2 = x;\n\t\tif (this.y2 === null || y > this.y2) this.y2 = y;\n\n\t\tthis.cx = (this.x1 + this.x2) / 2;\n\t\tthis.cy = (this.y1 + this.y2) / 2;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tTranslates the rectangle by the given deltas.\n\t * \t!translate (dx: number, dy: number) : Rect;\n\t */\n\ttranslate: function (dx, dy)\n\t{\n\t\tthis.x1 += dx; this.y1 += dy;\n\t\tthis.x2 += dx; this.y2 += dy;\n\t\tthis.cx += dx; this.cy += dy;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMoves the center of the rectangle to the specified position.\t \n\t * \t@param normalized - When `true` the arguments `x` and `y` are treated as normalized ranging from 0 to 1 (inclusive).\n\t * \t!centerAt (x: number, y: number, normalized?: false) : Rect;\n\t */\n\tcenterAt: function (x, y, normalized=false)\n\t{\n\t\tif (normalized == true)\n\t\t{\n\t\t\tx = this.x1 + x*(this.x2 - this.x1);\n\t\t\ty = this.y1 + y*(this.y2 - this.y1);\n\t\t}\n\n\t\treturn this.translate (x - this.cx, y - this.cy);\n\t},\n\n\t/**\n\t * \tCopies the coordinates of the specified rectangle.\n\t * \t!set (r: Rect) : Rect;\n\t */\n\t/**\n\t * \tSets the coordinates of the rectangle.\n\t * \t!set (x1: number, y1: number, x2: number, y2: number) : Rect;\n\t */\n\tset: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\tthis.cx = (x1 + x2) / 2;\n\t\tthis.cy = (y1 + y2) / 2;\n\n\t\tthis.x1 = x1;\n\t\tthis.y1 = y1;\n\t\tthis.x2 = x2;\n\t\tthis.y2 = y2;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns `true` if the given rectangle coordinates are equal.\n\t * \t!equals (r: Rect) : boolean;\n\t */\n\t/**\n\t * \tReturns `true` if the coordinates are equal.\n\t * \t!equals (x1: number, y1: number, x2: number, y2: number) : boolean;\n\t */\n\tequals: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\treturn x1 == this.x1 && x2 == this.x2 && y1 == this.y1 && y2 == this.y2;\n\t},\n\n\t/**\n\t * \tReturns `true` if the specified rectangle is contained in the current one.\n\t * \t!contains (r: Rect) : boolean;\n\t */\n\t/**\n\t * \tReturns `true` if the specified rectangle is contained in the current one.\n\t * \t!contains (x1: number, y1: number, x2: number, y2: number) : boolean;\n\t */\n\tcontains: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\treturn (x1 == Math.max(this.x1, x1)) && (y1 == Math.max(this.y1, y1)) && (x2 == Math.min(this.x2, x2)) && (y2 == Math.min(this.y2, y2));\n\t},\n\n\t/**\n\t * \tSets the coordinates of the rectangle to the union of it and the given one.\n\t * \t!setAsUnion (r: Rect) : Rect;\n\t */\n\t/**\n\t * \tSets the coordinates of the rectangle to the union of it and the given one.\n\t * \t!setAsUnion (x1: number, y1: number, x2: number, y2: number) : Rect;\n\t */\n\tsetAsUnion: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\tthis.x1 = Math.min(this.x1, x1);\n\t\tthis.y1 = Math.min(this.y1, y1);\n\t\tthis.x2 = Math.max(this.x2, x2);\n\t\tthis.y2 = Math.max(this.y2, y2);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns `true` if the rectangles intersect.\n\t * \t!intersects (r: Rect) : boolean;\n\t */\n\t/**\n\t * \tReturns `true` if the rectangles intersect.\n\t * \t!intersects (x1: number, y1: number, x2: number, y2: number) : boolean;\n\t */\n\tintersects: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\tlet _x1 = Math.max(this.x1, x1);\n\t\tlet _y1 = Math.max(this.y1, y1);\n\t\tlet _x2 = Math.min(this.x2, x2);\n\t\tlet _y2 = Math.min(this.y2, y2);\n\n\t\treturn Math.max(0, _y2-_y1) * Math.max(0, _x2-_x1) > 0;\n\t},\n\n\t/**\n\t * \tSets the coordinates of the rectangle to the intersection of it and the given one.\n\t * \t@returns Boolean indicating if the intersection is non-empty.\n\t * \t!setAsIntersection (r: Rect) : boolean;\n\t */\n\t/**\n\t * \tSets the coordinates of the rectangle to the intersection of it and the given one.\n\t * \t@returns Boolean indicating if the intersection is non-empty.\n\t * \t!setAsIntersection (x1: number, y1: number, x2: number, y2: number) : boolean;\n\t */\n\tsetAsIntersection: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tconst r = x1;\n\t\t\tx1 = r.x1; y1 = r.y1;\n\t\t\tx2 = r.x2; y2 = r.y2;\n\t\t}\n\n\t\tthis.x1 = Math.max(this.x1, x1);\n\t\tthis.y1 = Math.max(this.y1, y1);\n\t\tthis.x2 = Math.min(this.x2, x2);\n\t\tthis.y2 = Math.min(this.y2, y2);\n\n\t\treturn Math.max(0, this.y2-this.y1) * Math.max(0, this.x2-this.x1) > 0;\n\t},\n\n\t/**\n\t * \tResizes the rectangle to the given size using its center or top-left corner as reference.\n\t * \t@param topLeftRelative - When `true` reference will be top-left corner, set to `false` to use the center.\n\t * \t@param normalized - When `true` the `w` and `h` will be treated as normalized ranging from 0 to 1 (inclusive).\n\t * \t!resize (w: number, h: number, normalized?: boolean, topLeftRelative?: boolean) : Rect;\n\t */\n\tresize: function (w, h, topLeftRelative=false, normalized=false)\n\t{\n\t\tif (normalized == true)\n\t\t{\n\t\t\tw *= (this.x2 - this.x1);\n\t\t\th *= (this.y2 - this.y1);\n\t\t}\n\n\t\tif (topLeftRelative == true)\n\t\t{\n\t\t\tthis.x2 = this.x1 + w;\n\t\t\tthis.y2 = this.y1 + h;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tw /= 2; h /= 2;\n\n\t\t\tthis.x1 = this.cx - w; this.y1 = this.cy - h;\n\t\t\tthis.x2 = this.cx + w; this.y2 = this.cy + h;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResizes the rectangle using the specified deltas, relative to its center or top-left corner.\n\t * \t@param topLeftRelative - When `true` reference will be top-left corner, set to `false` to use the center.\n\t * \t!resizeBy (dw: number, dh: number, topLeftRelative?: boolean) : Rect;\n\t */\n\tresizeBy: function (dw, dh, topLeftRelative=false)\n\t{\n\t\tif (topLeftRelative == true)\n\t\t{\n\t\t\tthis.x2 += dw;\n\t\t\tthis.y2 += dh;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdw /= 2; dh /= 2;\n\n\t\t\tthis.x1 -= dw; this.y1 -= dh;\n\t\t\tthis.x2 += dw; this.y2 += dh;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the width of the rectangle.\n\t * \t!width() : number;\n\t */\n\twidth: function ()\n\t{\n\t\treturn this.x2 - this.x1;\n\t},\n\n\t/**\n\t * \tReturns the height of the rectangle.\t \n\t * \t!height() : number;\n\t */\n\theight: function ()\n\t{\n\t\treturn this.y2 - this.y1;\n\t},\n\n\t/**\n\t * \tReturns the normalized center X-coordinate of the rectangle.\n\t * \t!ncx() : number;\n\t */\n\tncx: function ()\n\t{\n\t\treturn (this.cx - this.x1) / (this.x2 - this.x1);\n\t},\n\n\t/**\n\t * \tReturns the normalized center Y-coordinate of the rectangle.\n\t * \t!ncy() : number;\n\t */\n\tncy: function ()\n\t{\n\t\treturn (this.cy - this.y1) / (this.y2 - this.y1);\n\t},\n\n\t/**\n\t * \tReturns `true` if the rectangle is a right rectangle, that is: x1 < x2 and y1 < y2.\n\t * \t!isRight() : boolean;\n\t */\n\tisRight: function ()\n\t{\n\t\treturn this.x1 <= this.x2 && this.y1 <= this.y2;\n\t},\n\n\t/**\n\t * \tReturns `true` if the specified point is contained in the rectangle.\n\t * \t@param tol - Used to specify a tolerance value (default is zero).\n\t * \t!containsPoint (x: number, y: number, tol?: number) : boolean;\n\t */\n\tcontainsPoint: function (x, y, tol=0)\n\t{\n\t\treturn (this.x1-tol <= x && x <= this.x2+tol) && (this.y1-tol <= y && y <= this.y2+tol);\n\t},\n\n\t/**\n\t * \tReturns the area of the rectangle.\n\t * \t@param strict - Indicates if the area is returned only if the rectangle is a right rectangle. \t \n\t * \t!area (strict?: boolean) : number;\n\t */\n\tarea: function (strict)\n\t{\n\t\treturn strict ? (this.isRight() ? (this.y2-this.y1)*(this.x2-this.x1) : 0) : ((this.y2-this.y1)*(this.x2-this.x1));\n\t},\n\n\t/**\n\t * \tSets the components of the rectangle to their rounded-down integer parts.\n\t * \t!floor() : Rect;\n\t */\n\tfloor: function()\n\t{\n\t\tthis.x1 = Math.floor(this.x1);\n\t\tthis.y1 = Math.floor(this.y1);\n\t\tthis.x2 = Math.floor(this.x2);\n\t\tthis.y2 = Math.floor(this.y2);\n\t\tthis.cx = Math.floor(this.cx);\n\t\tthis.cy = Math.floor(this.cy);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the components of the rectangle to their rounded-up integer parts.\n\t * \t!ceil() : Rect;\n\t */\n\tceil: function()\n\t{\n\t\tthis.x1 = Math.ceil(this.x1);\n\t\tthis.y1 = Math.ceil(this.y1);\n\t\tthis.x2 = Math.ceil(this.x2);\n\t\tthis.y2 = Math.ceil(this.y2);\n\t\tthis.cx = Math.ceil(this.cx);\n\t\tthis.cy = Math.ceil(this.cy);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the string representation of the rectangle.\n\t * \t!toString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn \"(\" + this.x1.toFixed(2) + \", \" + this.y1.toFixed(2) + \", \" + this.x2.toFixed(2) + \", \" + this.y2.toFixed(2) + \")\";\n\t},\n\n\t/**\n\t * \tFlattens the rectangle.\n\t * \t!flatten() : Array<number>;\n\t */\n\tflatten: function ()\n\t{\n\t\treturn [this.x1, this.y1, this.x2, this.y2];\n\t},\n\n\t/**\n\t * \tUnflattens the rectangle.\n\t * \t!unflatten(input: Array<number>) : Rect;\n\t */\n\tunflatten: function (o)\n\t{\n\t\tthis.set (o[0], o[1], o[2], o[3]);\n\t\treturn this;\n\t}\n});\n\n//!/class\n\n//!namespace Rect\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a new rectangle of zero size.\n\t * \t!function alloc() : Rect;\n\t */\n\t/**\n\t * \tAllocates a new rectangle centered at (0, 0) with the specified size.\n\t * \t!function alloc (width: number, height: number) : Rect;\n\t */\n\t/**\n\t * \tAllocates a new rectangle with the specified coordinates.\n\t * \t!function alloc (x1: number, y1: number, x2: number, y2: number) : Rect;\n\t */\n\nRecycler.createPool (Rect, 4096, 2048);\nexport default Rect;\n","/*\n**\tmath/tfunction.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\n\n//:/**\n//: * \tDescribes a function dependent of time (t-function), multiple sampling points (t,y) can be added, this class\n//: * \tprovides methods to access any value for a given time, or the integral of a time range.\n//: */\n\n//!class TFunction\n\nconst TFunction = Class.extend\n({\n\tclassName: 'TFunction',\n\n\t/**\n\t * \tContains the time values `t` in the t-function, for each time value there is a corresponding `y` and `f`.\n\t * \t!t: Array<number>;\n\t */\n\tt: null,\n\n\t/**\n\t * \tContains the values (y) for each of the time values (t) in the t-function.\n\t * \t!y: Array<number>;\n\t */\n\ty: null,\n\n\t/**\n\t * \tContains the easing function (f) for each of the time values (t).\n\t * \t!f: Array< (t:number) => number >;\n\t */\n\tf: null,\n\n\t/**\n\t * \tConstructs the time function.\n\t * \t@param value - Initial value of the t-function for t=0, defaults to 0.\n\t * \t!constructor (value?: number);\n\t */\n\t__ctor: function (value=0)\n\t{\n\t\tthis.reset(value);\n\t},\n\n\t/**\n\t * \tResets the t-function to its initial state.\n\t * \t@param value - Initial value of the t-function for t=0. Default is 0.\n\t * \t!reset (value?: number) : TFunction;\n\t */\n\treset: function (value=0)\n\t{\n\t\tthis.t = [0];\n\t\tthis.y = [value];\n\t\tthis.f = [null];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResets the t-function and copies data from the specified source.\n\t * \t@param src - Source TFunction.\n\t * \t@param t0 - Initial time, if none specified will be assumed to be the min time of the source.\n\t * \t@param t1 - Final time, if none specified will be assumed to the the max time of the source.\n\t * \t@returns A TFunction or `null` if the specified time range could not be resolved.\n\t * \t!copyFrom (src: TFunction, t0: number, t1: number) : TFunction;\n\t */\n\tcopyFrom: function (src, t0, t1)\n\t{\n\t\tthis.t = [];\n\t\tthis.y = [];\n\t\tthis.f = [];\n\n\t\tif (t0 == null && t1 == null)\n\t\t{\n\t\t\tfor (let i = 0; i < src.t.length; i++)\n\t\t\t{\n\t\t\t\tthis.t.push(src.t[i]);\n\t\t\t\tthis.y.push(src.y[i]);\n\t\t\t\tthis.f.push(src.f[i]);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\tif (t0 == null) t0 = src.t[0];\n\t\tif (t1 == null) t1 = src.t[src.t.length-1];\n\n\t\tif (t0 < src.t[0]) t0 = src.t[0];\n\n\t\tlet i0 = src.find(t0);\n\t\tlet i1 = src.find(t1);\n\n\t\tif (i0 == null) return null;\n\t\tif (i1 == null) return null;\n\n\t\tif (src.t[i0] != t0) {\n\t\t\tthis.set(t0, src.getAt(t0), src.f[i0]);\n\t\t\ti0++;\n\t\t}\n\n\t\tfor (let i = i0; i <= i1; i++)\n\t\t\tthis.set(src.t[i], src.y[i], src.f[i]);\n\n\t\tif (src.t[i1] != t1)\n\t\t{\n\t\t\tlet dt = (t1 - src.t[i1]) / Math.ceil(Math.log(t1 - src.t[i1]));\n\t\t\tlet t = this.t[this.t.length-1];\n\n\t\t\tif (dt <= 0) dt = 1;\ndt = t1-t; // Force just one step.\n\t\t\twhile (t != t1)\n\t\t\t{\n\t\t\t\tif (t+dt > t1)\n\t\t\t\t\tdt = t1 - t;\n\n\t\t\t\tt += dt;\n\t\t\t\tthis.set(float4(t), src.getAt(t), src.f[i1]);\n\t\t\t}\n\t\t}\n\t\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCreates a new t-function with the same values as the current one.\n\t * \t@param t0 - Initial time, if none specified will be assumed to be the min time of the source.\n\t * \t@param t1 - Final time, if none specified will be assumed to the the max time of the source.\n\t * \t!clone (t0: number, t1: number) : TFunction;\n\t */\n\tclone: function (t0, t1)\n\t{\n\t\treturn (new TFunction()).copyFrom(this, t0, t1);\n\t},\n\n\t/**\n\t * \tReturns the maximum time value in the t-function plus the given delta.\n\t * \t@param delta - Delta value to add to the result.\n\t * \t!endTime (delta?: number) : number;\n\t */\n\tendTime: function (delta=0)\n\t{\n\t\treturn this.t[this.t.length-1] + delta;\n\t},\n\n\t/**\n\t * \tReturns the start time of the t-function plus the given delta.\n\t * \t@param delta - Delta value to add to the result.\n\t * \t!startTime (delta?: number) : number;\n\t */\n\tstartTime: function (delta=0)\n\t{\n\t\treturn this.t[0] + delta;\n\t},\n\n\t/**\n\t * \tFinds the index of a sampling point whose sampling range contains the given time.\n\t * \t@param time - Time value to search.\n\t * \t@returns Index of the sampling point or `null` if not within range.\n\t * \t!find (time: number) : number|null;\n\t */\n\tfind: function (time)\n\t{\n\t\tif (time < this.t[0])\n\t\t\treturn null;\n\n\t\tconst n = this.t.length;\n\n\t\tfor (let i = 1; i < n; i++)\n\t\t{\n\t\t\tif (time < this.t[i])\n\t\t\t\treturn i-1;\n\t\t}\n\n\t\treturn n-1;\n\t},\n\n\t/**\n\t * \tSets a sampling point (t,y).\n\t * \t@param t - Time value of the sampling point.\n\t * \t@param y - Y-value for the given t.\n\t * \t@param f - Easing function.\n\t * \t!set (t: number, y: number, f?: (t: number) => number) : TFunction;\n\t */\n\tset: function (t, y, f=null)\n\t{\n\t\tlet i = this.find(t);\n\t\tif (i == null) return false;\n\n\t\tif (this.t[i] == t)\n\t\t{\n\t\t\tthis.y[i] = y;\n\t\t\tif (f != null) this.f[i] = f;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ti++;\n\t\t\tthis.t.splice(i, 0, t);\n\t\t\tthis.y.splice(i, 0, y);\n\t\t\tthis.f.splice(i, 0, f);\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tReturns the last Y-value in the t-function.\n\t *\t!get() : number;\n\t */\n\tget: function ()\n\t{\n\t\treturn this.y[this.y.length-1];\n\t},\n\n\t/**\n\t * \tReturns the Y-value in the t-function corresponding to some point in time (t).\n\t * \t@param t - Time (t) value.\n\t * \t!getAt (t: number) : number;\n\t */\n\tgetAt: function (t)\n\t{\n\t\tlet i0 = this.find(t);\n\t\tif (i0 == null) return 0;\n\n\t\tlet i1 = i0 + 1;\n\n\t\tif (this.t[i0] == t || i1 >= this.t.length || this.y[i0] == this.y[i1] || this.f[i0] == null)\n\t\t\treturn this.y[i0];\n\n\t\tif (this.f[i0] == null)\n\t\t\treturn this.y[i0];\n\n\t\tlet x = t;\n\t\tlet x0 = this.t[i0];\n\t\tlet x1 = this.t[i1];\n\t\tlet y0 = this.y[i0];\n\t\tlet y1 = this.y[i1];\n\n\t\tt = (x - x0) / (x1 - x0);\n\t\tt = this.f[i0](t);\n\n\t\treturn t*y1 + (1-t)*y0;\n\t},\n\n\t/**\n\t * \tReturns the approximate definite integral of the t-function for the given time range.\n\t * \t@param t0 - Initial time value, defaults to minimum time of the t-function.\n\t * \t@param t1 - Final time value, defaults to the maximum time of the t-function.\n\t * \t@param c0 - Constant of integration, defaults to 0.\n\t * \t@returns Definite integral of t-function from t0 to t1.\n\t * \t!integral (t0?: number, t1?: number, c0?: number) : number;\n\t */\n\tintegral: function (t0=null, t1=null, c0=0)\n\t{\n\t\tif (t0 == null) t0 = this.t[0];\n\t\tif (t1 == null) t1 = this.t[this.t.length-1];\n\n\t\tif (t0 < this.t[0]) t0 = this.t[0];\n\n\t\tlet sign = 1;\n\n\t\tif (t0 > t1) {\n\t\t\tlet tmp; tmp = t0; t0 = t1; t1 = tmp;\n\t\t\tsign = -1;\n\t\t}\n\n\t\tlet accum = c0;\n\n\t\tfor (let time = t0; time < t1; )\n\t\t{\n\t\t\tlet i0 = this.find(time);\n\t\t\tif (i0 == null) return 0;\n\n\t\t\tlet i1 = i0 + 1;\n\n\t\t\tlet x0 = Math.max(this.t[i0], time);\n\t\t\tlet x1 = Math.min(i1 < this.t.length ? this.t[i1] : t1, t1);\n\n\t\t\tlet y0 = this.getAt(x0);\n\t\t\tlet y1 = this.getAt(x1);\n\n\t\t\tlet dx = x1 - x0;\n\t\t\tlet dy = y1 - y0;\n\n\t\t\tif (this.f[i0] == null)\n\t\t\t\taccum += y0*dx;\n\t\t\telse\n\t\t\t\taccum += 0.5*dy*(x1+x0) - x0*dy + y0*dx;\n\n\t\t\ttime += dx;\n\t\t}\n\n\t\treturn sign*accum;\n\t},\n\n\t/**\n\t * \tReturns the approximate definite second integral of the t-function for the given time range.\n\t * \t@param t0 - Initial time value, defaults to minimum time of the t-function.\n\t * \t@param t1 - Final time value, defaults to the maximum time of the t-function.\n\t * \t@param c0 - Constant of integration, defaults to 0.\n\t * \t@returns Definite second integral of t-function from t0 to t1.\n\t * \t!integral (t0?: number, t1?: number, c0?: number) : number;\n\t */\n\tsecond_integral: function (t0=null, t1=null, c0=0)\n\t{\n\t\tif (t0 == null) t0 = this.t[0];\n\t\tif (t1 == null) t1 = this.t[this.t.length-1];\n\n\t\tlet a0 = TFunction.Temp1.copyFrom(this, this.t[0], t0).integrate(c0).integral();\n\t\tlet a1 = TFunction.Temp2.copyFrom(this, this.t[0], t1).integrate(c0).integral();\n\n\t\treturn a1 - a0;\n\t},\n\n\t/**\n\t * \tTransforms the t-function to its integral. For every sampling range in the t-function their Y-value will be set to the integral\n\t * \tof the sampling range plus any previous integrals.\n\t *\n\t * \t@param c0 - Constant of integration. Defaults to 0.\n\t * \t!integrate (c0?: number) : TFunction;\n\t */\n\tintegrate: function (c0=0)\n\t{\n\t\tlet y = [];\n\n\t\ty.push(c0);\n\n\t\tfor (let i = 1; i < this.t.length; i++)\n\t\t\ty.push(y[i-1] + this.integral(this.t[i-1], this.t[i]));\n\n\t\tthis.y = y;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tTransforms the t-function Y-values to the accumulated sum of each Y-value plus the given c0.\n\t * \t@param c0 - Initial value (defaults to 0).\n\t * \t!accumulate(c0?: number) : TFunction;\n\t */\n\taccumulate: function (c0=0)\n\t{\n\t\tthis.y[0] += c0;\n\n\t\tfor (let i = 1; i < this.t.length; i++)\n\t\t\tthis.y[i] += this.y[i-1];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tRemoves all sampling-points located before the given index.\n\t *\t!chopLeft (i: number) : TFunction;\n\t */\n\tchopLeft: function (i)\n\t{\n\t\tthis.t.splice(0, i);\n\t\tthis.f.splice(0, i);\n\t\tthis.y.splice(0, i);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tRemoves all sampling-points located after the given index.\n\t * \t!chopRight (i: number) : TFunction;\n\t */\n\tchopRight: function (i)\n\t{\n\t\tthis.t.splice(i+1, this.t.length-i-1);\n\t\tthis.f.splice(i+1, this.f.length-i-1);\n\t\tthis.y.splice(i+1, this.y.length-i-1);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMaps the Y-value to other Y-values using the specified mapping function.\n\t * \t@param fn - Receives parameters `y` (y-value), `t` (t-value), and `i` (index).\n\t * \t!map (fn: (y: number, t: number, i: number) => number) : TFunction;\n\t */\n\tmap: function (fn)\n\t{\n\t\tfor (let i = 0; i < this.y.length; i++)\n\t\t\tthis.y[i] = fn (this.y[i], this.t[i], i);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns a string representation of the variable state.\n\t * \t!toString (c0?: number) : string;\n\t */\n\ttoString: function(c0=0)\n\t{\n\t\tlet s = '';\n\t\tlet n = 10;\n\n\t\tconst pad = function (value, n, char)\n\t\t{\n\t\t\tvalue = value.toString();\n\n\t\t\tif (char == null) char = ' ';\n\t\t\tchar = char[0];\n\n\t\t\twhile (value.length < n)\n\t\t\t\tvalue += char;\n\n\t\t\treturn value;\n\t\t};\n\n\t\ts += '\\n';\n\t\ts += pad(' Time', n) + ' ' + pad(' Value', n) + ' ' + pad(' Integral', n) + '\\n';\n\t\ts += pad('', n, '-') + ' ' + pad('', n, '-') + ' ' + pad('', n, '-') + '\\n';\n\n\t\tfor (let i = 0; i < this.t.length; i++)\n\t\t{\n\t\t\ts += pad(' '+float4(this.t[i]), n) + ' ' + pad(' '+float4(this.y[i]), n) + ' ' + pad(' '+float4(this.integral(this.t[0], this.t[i], c0)), n) + '\\n';\n\t\t}\n\n\t\treturn s;\n\t}\n});\n\nTFunction.Temp1 = new TFunction();\nTFunction.Temp2 = new TFunction();\n\nexport default TFunction;\n","/*\n**\tmath/bounds2.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Recycler from '../utils/recycler.js';\nimport Point2 from './point2.js';\nimport Rect from './rect.js';\n\n//![import \"../utils/recycler\"]\n//![import \"./point2\"]\n//![import \"./rect\"]\n\n//:/**\n//: * \tRepresentation of a bounding box in 2D space. The component values are upscaled by a fixed number of bits to allow sub-pixel\n//: * \ttranslations (internally), but the public values will always be integers.\n//: */\n\n//!class Bounds2\n\nconst Bounds2 = Class.extend\n({\n\tclassName: 'Bounds2',\n\n\t/**\n\t * \tCoordinates of the bounds (cx and cy are for the center). Note that this fields are read only and should be\n\t * \tmodified through methods only.\n\t */\n\n\t/**\n\t * \t!readonly cx: number;\n\t */\n\tcx: 0,\n\t/**\n\t * \t!readonly cy: number;\n\t */\n\tcy: 0,\n\t/**\n\t * \t!readonly x1: number;\n\t */\n\tx1: 0,\n\t/**\n\t * \t!readonly y1: number;\n\t */\n\ty1: 0,\n\t/**\n\t * \t!readonly x2: number;\n\t */\n\tx2: 0,\n\t/**\n\t * \t!readonly y2: number;\n\t */\n\ty2: 0,\n\n\t/**\n\t * \tUpscaled coordinates.\n\t */\n\tucx: 0, ucy: 0,\n\tux1: 0, uy1: 0,\n\tux2: 0, uy2: 0,\n\n\t/**\n\t * !constructor (bounds: Bounds2);\n\t */\n\t/**\n\t * !constructor (rect: Rect);\n\t */\n\t/**\n\t * !constructor (width: number, height: number);\n\t */\n\t/**\n\t * !constructor (x1: number, y1: number, x2: number, y2: number, upscaled:boolean=false);\n\t */\n\t__ctor: function (x1=null, y1=null, x2=null, y2=null, upscaled=false)\n\t{\n\t\tif (x1 === null)\n\t\t{\n\t\t\tthis.ux1 = this.uy1 = this.ux2 = this.uy2 = this.ucx = this.ucy = 0;\n\t\t\treturn this.downscale();\n\t\t}\n\n\t\tif (y1 !== null && x2 === null)\n\t\t\treturn this.set(0, 0, 0, 0).resize(x1, y1);\n\n\t\treturn this.set(x1, y1, x2, y2, upscaled);\n\t},\n\n\t/**\n\t * Populates the downscaled components.\n\t */\n\tdownscale: function ()\n\t{\n\t\tthis.x1 = downscale(this.ux1);\n\t\tthis.y1 = downscale(this.uy1);\n\t\tthis.x2 = downscale(this.ux2);\n\t\tthis.y2 = downscale(this.uy2);\n\t\tthis.cx = downscale(this.ucx);\n\t\tthis.cy = downscale(this.ucy);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Truncates the components to remove fractional parts.\n\t * !trunc() : Bounds2;\n\t */\n\ttrunc: function ()\n\t{\n\t\tthis.ux1 = upscale(this.x1);\n\t\tthis.uy1 = upscale(this.y1);\n\t\tthis.ux2 = upscale(this.x2);\n\t\tthis.uy2 = upscale(this.y2);\n\t\tthis.ucx = upscale(this.cx);\n\t\tthis.ucy = upscale(this.cy);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Clones the bounds and returns a new object.\n\t * !clone() : Bounds2;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Bounds2.Pool.alloc(this.ux1, this.uy1, this.ux2, this.uy2, true);\n\t},\n\n\t/**\n\t * Sets the components to zero.\n\t * !zero() : Bounds2;\n\t */\n\tzero: function ()\n\t{\n\t\tthis.ux1 = 0; this.uy1 = 0;\n\t\tthis.ux2 = 0; this.uy2 = 0;\n\t\tthis.ucx = 0; this.ucy = 0;\n\n\t\treturn this.downscale();\n\t},\n\n\t/**\n\t * Resets the component values to `null` for subsequent use with `setAsUnion`.\n\t * !reset() : Bounds2;\n\t */\n\treset: function ()\n\t{\n\t\tthis.ux1 = null; this.uy1 = null;\n\t\tthis.ux2 = null; this.uy2 = null;\n\t\tthis.ucx = null; this.ucy = null;\n\n\t\tthis.x1 = null; this.y1 = null;\n\t\tthis.x2 = null; this.y2 = null;\n\t\tthis.cx = null; this.cy = null;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Translates the bounds by the given deltas.\n\t * !translate (point: Point2) : Bounds2;\n\t */\n\t/**\n\t * Translates the bounds by the given deltas.\n\t * !translate (vec: Vec2) : Bounds2;\n\t */\n\t/**\n\t * Translates the bounds by the given deltas.\n\t * !translate (dx: number, dy: number, upscaled:boolean=false) : Bounds2;\n\t */\n\ttranslate: function (dx, dy=null, upscaled=false)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tif (Point2.isInstance(dx)) {\n\t\t\t\tdy = dx.uy;\n\t\t\t\tdx = dx.ux;\n\t\t\t} else { // Vec2\n\t\t\t\tdy = upscale(dx.y);\n\t\t\t\tdx = upscale(dx.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (!upscaled) {\n\t\t\t\tdx = upscale(dx);\n\t\t\t\tdy = upscale(dy);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux1 += dx; this.uy1 += dy;\n\t\tthis.ux2 += dx; this.uy2 += dy;\n\t\tthis.ucx += dx; this.ucy += dy;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tSets the coordinates of the bounds.\n\t**\n\t**\tBounds2 set (Bounds2 b)\n\t**\tBounds2 set (Rect r)\n\t**\tBounds2 set (float x1, float y1, float x2, float y2, bool upscaled=false)\n\t*/\n\tset: function (x1, y1=null, x2=null, y2=null, upscaled=false)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.uy2;\n\t\t\t\tx2 = x1.ux2;\n\t\t\t\ty1 = x1.uy1;\n\t\t\t\tx1 = x1.ux1;\n\t\t\t} else {\n\t\t\t\ty2 = upscale(x1.y2);\n\t\t\t\tx2 = upscale(x1.x2);\n\t\t\t\ty1 = upscale(x1.y1);\n\t\t\t\tx1 = upscale(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!upscaled) {\n\t\t\t\tx1 = upscale(x1);\n\t\t\t\ty1 = upscale(y1);\n\t\t\t\tx2 = upscale(x2);\n\t\t\t\ty2 = upscale(y2);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux1 = x1;\n\t\tthis.uy1 = y1;\n\t\tthis.ux2 = x2;\n\t\tthis.uy2 = y2;\n\n\t\tthis.ucx = (x1 + x2) >> 1;\n\t\tthis.ucy = (y1 + y2) >> 1;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tAdds the specified coordinates to the current ones.\n\t**\n\t**\tBounds2 add (Bounds2 b)\n\t**\tBounds2 add (Rect r)\n\t**\tBounds2 add (float x1, float y1, float x2, float y2, bool upscaled=false)\n\t*/\n\tadd: function (x1, y1=null, x2=null, y2=null, upscaled=false)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.uy2;\n\t\t\t\tx2 = x1.ux2;\n\t\t\t\ty1 = x1.uy1;\n\t\t\t\tx1 = x1.ux1;\n\t\t\t} else {\n\t\t\t\ty2 = upscale(x1.y2);\n\t\t\t\tx2 = upscale(x1.x2);\n\t\t\t\ty1 = upscale(x1.y1);\n\t\t\t\tx1 = upscale(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!upscaled) {\n\t\t\t\tx1 = upscale(x1);\n\t\t\t\ty1 = upscale(y1);\n\t\t\t\tx2 = upscale(x2);\n\t\t\t\ty2 = upscale(y2);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux1 += x1;\n\t\tthis.uy1 += y1;\n\t\tthis.ux2 += x2;\n\t\tthis.uy2 += y2;\n\n\t\tthis.ucx += (x1 + x2) >> 1;\n\t\tthis.ucy += (y1 + y2) >> 1;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tReturns true if the integer coordinates have the same values as the given argument.\n\t**\n\t**\tbool equals (Bounds2 b)\n\t**\tbool equals (Rect r)\n\t**\tbool equals (float x1, float y1, float x2, float y2)\n\t*/\n\tequals: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.y2;\n\t\t\t\tx2 = x1.x2;\n\t\t\t\ty1 = x1.y1;\n\t\t\t\tx1 = x1.x1;\n\t\t\t} else {\n\t\t\t\ty2 = int(x1.y2);\n\t\t\t\tx2 = int(x1.x2);\n\t\t\t\ty1 = int(x1.y1);\n\t\t\t\tx1 = int(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx1 = int(x1);\n\t\t\ty1 = int(y1);\n\t\t\tx2 = int(x2);\n\t\t\ty2 = int(y2);\n\t\t}\n\n\t\treturn x1 == this.x1 && x2 == this.x2 && y1 == this.y1 && y2 == this.y2;\n\t},\n\n\t/*\n\t**\tReturns a bool indicating if the specified bounds are contained by the current bounds.\n\t**\n\t**\tbool contains (Bounds2 b)\n\t**\tbool contains (Rect r)\n\t**\tbool contains (float x1, float y1, float x2, float y2)\n\t*/\n\tcontains: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.y2;\n\t\t\t\tx2 = x1.x2;\n\t\t\t\ty1 = x1.y1;\n\t\t\t\tx1 = x1.x1;\n\t\t\t} else {\n\t\t\t\ty2 = int(x1.y2);\n\t\t\t\tx2 = int(x1.x2);\n\t\t\t\ty1 = int(x1.y1);\n\t\t\t\tx1 = int(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx1 = int(x1);\n\t\t\ty1 = int(y1);\n\t\t\tx2 = int(x2);\n\t\t\ty2 = int(y2);\n\t\t}\n\n\t\treturn (x1 == Math.max(this.x1, x1)) && (y1 == Math.max(this.y1, y1)) && (x2 == Math.min(this.x2, x2)) && (y2 == Math.min(this.y2, y2));\n\t},\n\n\t/*\n\t**\tExtends the coordinates to ensure the specified argument is contained.\n\t**\n\t**\tBounds2 setAsUnion (Bounds2 b)\n\t**\tBounds2 setAsUnion (Rect r)\n\t**\tBounds2 setAsUnion (Point2 p)\n\t**\tBounds2 setAsUnion (Vec2 v)\n\t**\tBounds2 setAsUnion (float x, float y)\n\t**\tBounds2 setAsUnion (float x1, float y1, float x2, float y2)\n\t*/\n\tsetAsUnion: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1))\n\t\t\t{\n\t\t\t\tthis.setAsUnion(x1.ux1, x1.uy1, true);\n\t\t\t\tthis.setAsUnion(x1.ux2, x1.uy2, true);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t\telse if (Rect.isInstance(x1))\n\t\t\t{\n\t\t\t\tthis.setAsUnion(x1.x1, x1.y1);\n\t\t\t\tthis.setAsUnion(x1.x2, x1.y2);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t\telse if (Point2.isInstance(x1))\n\t\t\t{\n\t\t\t\ty1 = x1.uy;\n\t\t\t\tx1 = x1.ux;\n\t\t\t}\n\t\t\telse // Vec2\n\t\t\t{\n\t\t\t\ty1 = upscale(x1.y);\n\t\t\t\tx1 = upscale(x1.x);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (y2 !== null)\n\t\t\t{\n\t\t\t\tthis.setAsUnion(x1, y1);\n\t\t\t\tthis.setAsUnion(x2, y2);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (x2 !== true)\n\t\t\t\t{\n\t\t\t\t\tx1 = upscale(x1);\n\t\t\t\t\ty1 = upscale(y1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.ux1 === null || x1 < this.ux1) this.ux1 = x1;\n\t\tif (this.uy1 === null || y1 < this.uy1) this.uy1 = y1;\n\t\tif (this.ux2 === null || x1 > this.ux2) this.ux2 = x1;\n\t\tif (this.uy2 === null || y1 > this.uy2) this.uy2 = y1;\n\n\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tReturns a bool indicating if the integer components of the bounds intersect with the specified argument.\n\t**\n\t**\tbool intersects (Bounds2 b)\n\t**\tbool intersects (Rect r)\n\t**\tbool intersects (float x1, float y1, float x2, float y2)\n\t*/\n\tintersects: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.y2;\n\t\t\t\tx2 = x1.x2;\n\t\t\t\ty1 = x1.y1;\n\t\t\t\tx1 = x1.x1;\n\t\t\t} else {\n\t\t\t\ty2 = int(x1.y2);\n\t\t\t\tx2 = int(x1.x2);\n\t\t\t\ty1 = int(x1.y1);\n\t\t\t\tx1 = int(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx1 = int(x1);\n\t\t\ty1 = int(y1);\n\t\t\tx2 = int(x2);\n\t\t\ty2 = int(y2);\n\t\t}\n\n\t\tlet _x1 = Math.max(this.x1, x1);\n\t\tlet _y1 = Math.max(this.y1, y1);\n\t\tlet _x2 = Math.min(this.x2, x2);\n\t\tlet _y2 = Math.min(this.y2, y2);\n\n\t\treturn Math.max(0, _y2-_y1) * Math.max(0, _x2-_x1) > 0;\n\t},\n\n\t/*\n\t**\tSets the bounds to the intersection formed by the current bounds and the given argument.\n\t**\n\t**\tBounds2 setAsIntersection (Bounds2 b)\n\t**\tBounds2 setAsIntersection (Rect r)\n\t**\tBounds2 setAsIntersection (float x1, float y1, float x2, float y2)\n\t*/\n\tsetAsIntersection: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\tif (Bounds2.isInstance(x1)) {\n\t\t\t\ty2 = x1.y2;\n\t\t\t\tx2 = x1.x2;\n\t\t\t\ty1 = x1.y1;\n\t\t\t\tx1 = x1.x1;\n\t\t\t} else {\n\t\t\t\ty2 = int(x1.y2);\n\t\t\t\tx2 = int(x1.x2);\n\t\t\t\ty1 = int(x1.y1);\n\t\t\t\tx1 = int(x1.x1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx1 = int(x1);\n\t\t\ty1 = int(y1);\n\t\t\tx2 = int(x2);\n\t\t\ty2 = int(y2);\n\t\t}\n\n\t\tthis.ux1 = upscale(Math.max(this.x1, x1));\n\t\tthis.uy1 = upscale(Math.max(this.y1, y1));\n\t\tthis.ux2 = upscale(Math.min(this.x2, x2));\n\t\tthis.uy2 = upscale(Math.min(this.y2, y2));\n\n\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\n\t\tthis.downscale();\n\n\t\treturn Math.max(0, this.uy2-this.uy1) * Math.max(0, this.ux2-this.ux1) > 0;\n\t},\n\n\t/*\n\t**\tResizes the bounds to the given size using center or top-left as reference.\t \n\t**\n\t**\tBounds2 resize (float width, float height, bool topLeftRelative=false)\n\t*/\n\tresize: function (width, height, topLeftRelative=false)\n\t{\n\t\twidth = width !== null ? upscale(width) : (this.ux2 - this.ux1);\n\t\theight = height !== null ? upscale(height) : (this.uy2 - this.uy1);\n\n\t\tif (topLeftRelative === true)\n\t\t{\n\t\t\tthis.ux2 = this.ux1 + width;\n\t\t\tthis.uy2 = this.uy1 + height;\n\n\t\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\t\t}\n\t\telse\n\t\t{\n\t\t\twidth >>= 1; height >>= 1;\n\n\t\t\tthis.ux1 = this.ucx - width; this.uy1 = this.ucy - height;\n\t\t\tthis.ux2 = this.ucx + width; this.uy2 = this.ucy + height;\n\t\t}\n\n\t\treturn this.downscale();\n\t},\n\n\t/*\n\t**\tResizes the bounds using the specified deltas (using the center or top-left corner as reference).\n\t**\n\t**\tBounds2 resizeBy (float dwidth, float dheight, bool topLeftRelative=false)\n\t*/\n\tresizeBy: function (dwidth, dheight, topLeftRelative=false)\n\t{\n\t\tdwidth = upscale(dwidth);\n\t\tdheight = upscale(dheight);\n\n\t\tif (topLeftRelative === true)\n\t\t{\n\t\t\tthis.ux2 += dwidth;\n\t\t\tthis.uy2 += dheight;\n\n\t\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdwidth >>= 1; dheight >>= 1;\n\n\t\t\tthis.ux1 -= dwidth; this.uy1 -= dheight;\n\t\t\tthis.ux2 += dwidth; this.uy2 += dheight;\n\t\t}\n\n\t\treturn this.downscale();\n\t},\n\n\t/**\n\t * Returns the width of the bounds.\n\t * !width(): number\n\t */\n\twidth: function ()\n\t{\n\t\treturn this.x2 - this.x1;\n\t},\n\n\t/**\n\t * Returns the height of the bounds.\n\t * !height(): number\n\t */\n\theight: function ()\n\t{\n\t\treturn this.y2 - this.y1;\n\t},\n\n\t/**\n\t * Returns true if the bounds are in forward position (x1 < x2 and y1 < y2).\n\t * !isForward() : boolean;\n\t */\n\tisForward: function ()\n\t{\n\t\treturn this.ux1 <= this.ux2 && this.uy1 <= this.uy2;\n\t},\n\n\t/**\n\t * Returns true if the specified point is within the bounds. The `tol` parameter is used to specify a tolerance value.\n\t * !containsPoint (x: number, y: number, tol:number=0) : boolean;\n\t */\n\tcontainsPoint: function (x, y, tol=0)\n\t{\n\t\tx = upscale(x);\n\t\ty = upscale(y);\n\t\ttol = upscale(tol);\n\n\t\treturn (this.ux1-tol <= x && x <= this.ux2+tol) && (this.uy1-tol <= y && y <= this.uy2+tol);\n\t},\n\n\t/**\n\t * Returns the area of the bounds. When strict is true, the area will be returned only if the bounds are forward.\n\t * !area (strict:boolean=false) : number;\n\t */\n\tarea: function (strict=false)\n\t{\n\t\treturn strict ? (this.isForward() ? (this.y2-this.y1)*(this.x2-this.x1) : 0) : ((this.y2-this.y1)*(this.x2-this.x1));\n\t},\n\n\t/**\n\t * Returns the string representation of the rect coordinates.\n\t * !toString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn '(' + this.x1 + ', ' + this.y1 + ', ' + this.x2 + ', ' + this.y2 + ')';\n\t},\n\n\t/**\n\t * Flattens the contents of the bounds.\n\t * !flatten() : \\[number,number,number,number\\];\n\t */\n\tflatten: function ()\n\t{\n\t\treturn [this.ux1, this.uy1, this.ux2, this.uy2];\n\t},\n\n\t/**\n\t * Unflattens the given array into the bounds object.\n\t * !unflatten (data: \\[number,number,number,number\\]) : Bounds2;\n\t */\n\tunflatten: function (x)\n\t{\n\t\tthis.ux1 = x[0];\n\t\tthis.uy1 = x[1];\n\t\tthis.ux2 = x[2];\n\t\tthis.uy2 = x[3];\n\n\t\tthis.ucx = (this.ux1 + this.ux2) >> 1;\n\t\tthis.ucy = (this.uy1 + this.uy2) >> 1;\n\n\t\treturn this.downscale();\n\t}\n});\n\n//!/class\n\n//!namespace Rect\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a new object of zero size.\n\t * \t!function alloc() : Bounds2;\n\t */\n\nRecycler.createPool (Bounds2, 8192, 3072);\nexport default Bounds2;\n","/*\n**\tmath/point2.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"../utils/recycler\"]\n//![import \"./vec2\"]\n\n//:/**\n//: * \tRepresentation of a point in 2D space. The coordinate values are upscaled by a fixed number of bits to allow\n//: * \tsub-pixel translations (internally), but the public values will always be integers.\n//: */\n\n//!class Point2\n\nconst Point2 = Class.extend\n({\n\tclassName: 'Point2',\n\n\t/**\n\t * \tUpscaled coordinates of the point.\n\t * \t!readonly ux: number;\n\t * \t!readonly uy: number;\n\t */\n\tux: 0, uy: 0,\n\n\t/**\n\t * \tCoordinates of the point.\n\t * \t!readonly x: number;\n\t * \t!readonly y: number;\n\t */\n\tx: 0, y: 0,\n\n\t/**\n\t *\tConstructs the Point2 instance from another Point2.\n\t * \t!constructor (value: Point2);\n\t */\n\t/**\n\t *\tConstructs the Point2 instance from a Vec2.\n\t * \t!constructor (value: Vec2);\n\t */\n\t/**\n\t *\tConstructs the Point2 instance with the specified coordinates.\n\t * \t!constructor (x?: number, y?: number);\n\t */\n\t__ctor: function (x=null, y=null)\n\t{\n\t\treturn this.set(x, y);\n\t},\n\n\t/**\n\t *\tPopulates the downscaled coordinates.\n\t */\n\tdownscale: function ()\n\t{\n\t\tthis.x = downscale(this.ux);\n\t\tthis.y = downscale(this.uy);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tClones the point coordinates into a new Point2 object.\n\t * \t!clone() : Point2;\n\t */\n\tclone: function ()\n\t{\n\t\treturn Point2.Pool.alloc(this);\n\t},\n\n\t/**\n\t *\tSets the coordinates of the point from another Point2.\n\t *\t!set (value: Point2) : Point2;\n\t */\n\t/**\n\t *\tSets the coordinates of the point from a Vec2 object.\n\t *\t!set (value: Vec2) : Point2;\n\t */\n\t/**\n\t *\tSets the coordinates of the point.\n\t *\t@param upscaled - When `true` the specified values are assumed to have already been upscaled.\n\t *\n\t *\t!set (x: number, y: number, upscaled?: boolean) : Point2;\n\t */\n\tset: function (x, y=null, upscaled=false)\n\t{\n\t\tif (x === null) {\n\t\t\tx = 0;\n\t\t\ty = 0;\n\t\t}\n\t\telse if (y === null)\n\t\t{\n\t\t\tif (Point2.isInstance(x)) {\n\t\t\t\ty = x.uy;\n\t\t\t\tx = x.ux;\n\t\t\t} else { // Point2\n\t\t\t\ty = upscale(x.y);\n\t\t\t\tx = upscale(x.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (!upscaled) {\n\t\t\t\tx = upscale(x);\n\t\t\t\ty = upscale(y);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux = x;\n\t\tthis.uy = y;\n\n\t\treturn this.downscale(this);\n\t},\n\n\t/**\n\t * \tSets the X-coordinate of the point.\n\t * \t!setX (x: number) : Point2;\n\t */\n\tsetX: function (x)\n\t{\n\t\tthis.ux = upscale(x);\n\t\treturn this.downscale(this);\n\t},\n\n\t/**\n\t * \tSets the Y-coordinate of the point.\n\t * \t!setY (y: number) : Point2;\n\t */\n\tsetY: function (y)\n\t{\n\t\tthis.uy = upscale(y);\n\t\treturn this.downscale(this);\n\t},\n\n\t/**\n\t * \tSets the coordinates of the point to zero.\n\t * \t!zero() : Point2;\n\t */\n\tzero: function()\n\t{\n\t\treturn this.set(0, 0);\n\t},\n\n\t/**\n\t * \tReturns true if the point coordinates are both zero.\n\t * \t!isZero() : boolean;\n\t */\n\tisZero: function()\n\t{\n\t\treturn this.x == 0 && this.y == 0;\n\t},\n\n\t/**\n\t *\tReturns true if the coordinates of the point have the same values as the given Point2.\n\t *\t!equals (value: Point2) : boolean;\n\t */\n\t/**\n\t *\tReturns true if the coordinates of the point have the same values as the given Vec2.\n\t *\t!equals (value: Vec2) : boolean;\n\t */\n\t/**\n\t *\tReturns true if the coordinates of the point have the same values as the given ones.\n\t *\t!equals (x: number, y: number) : boolean;\n\t */\n\tequals: function (x, y=null)\n\t{\n\t\tif (y === null)\n\t\t{\n\t\t\tif (Point2.isInstance(x)) {\n\t\t\t\ty = x.y;\n\t\t\t\tx = x.x;\n\t\t\t} else { // Point2\n\t\t\t\ty = int(x.y);\n\t\t\t\tx = int(x.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tx = int(x);\n\t\t\ty = int(y);\n\t\t}\n\n\t\treturn this.x == x && this.y == y;\n\t},\n\n\t/**\n\t *\tAdds the coordinates of the given Point2 to the point.\n\t *\t!add (value: Point2) : Point2;\n\t */\n\t/**\n\t *\tAdds the coordinates of the given Vec2 to the point.\n\t *\t!add (value: Vec2) : Point2;\n\t */\n\t/**\n\t *\tAdds the given delta values to the point.\n\t *\t@param upscaled - When `true` the specified values are assumed to have already been upscaled.\n\t *\t!add (dx: number, dy: number, upscaled?: boolean) : Point2;\n\t */\n\tadd: function (dx, dy=null, upscaled=false)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tif (Point2.isInstance(dx)) {\n\t\t\t\tdy = dx.uy;\n\t\t\t\tdx = dx.ux;\n\t\t\t} else { // Point2\n\t\t\t\tdy = upscale(dx.y);\n\t\t\t\tdx = upscale(dx.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (!upscaled) {\n\t\t\t\tdx = upscale(dx);\n\t\t\t\tdy = upscale(dy);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux += dx, this.uy += dy;\n\t\treturn this.downscale();\n\t},\n\n\t/**\n\t *\tSubtracts the coordinates of the given Point2 from the point.\n\t *\t!sub (value: Point2) : Point2;\n\t */\n\t/**\n\t *\tSubtracts the coordinates of the given Vec2 from the point.\n\t *\t!sub (value: Vec2) : Point2;\n\t */\n\t/**\n\t *\tSubtracts the given delta values from the point.\n\t *\t@param upscaled - When `true` the specified values are assumed to have already been upscaled.\n\t *\t!sub (dx: number, dy: number, upscaled?: boolean) : Point2;\n\t */\n\tsub: function (dx, dy, upscaled=false)\n\t{\n\t\tif (dy === null)\n\t\t{\n\t\t\tif (Point2.isInstance(dx)) {\n\t\t\t\tdy = dx.uy;\n\t\t\t\tdx = dx.ux;\n\t\t\t} else { // Point2\n\t\t\t\tdy = upscale(dx.y);\n\t\t\t\tdx = upscale(dx.x);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (!upscaled) {\n\t\t\t\tdx = upscale(dx);\n\t\t\t\tdy = upscale(dy);\n\t\t\t}\n\t\t}\n\n\t\tthis.ux -= dx, this.uy -= dy;\n\t\treturn this.downscale();\n\t},\n\n\t/**\n\t * \tReturns the string representation of the coordinates of the point.\n\t * \ttoString() : string;\n\t */\n\ttoString: function ()\n\t{\n\t\treturn `(${this.x}, ${this.y})`;\n\t}\n});\n\n//!/class\n\n//!namespace Point2\n//!namespace Pool\n\n/**\n *\tAllocates a Point2 instance from another Point2.\n * \t!function alloc (value: Point2) : Point2;\n */\n/**\n *\tAllocates a Point2 instance from a Vec2.\n * \t!function alloc (value: Vec2) : Point2;\n */\n/**\n *\tAllocates a Point2 instance with the specified coordinates.\n * \t!function alloc (x?: number, y?: number) : Point2;\n */\n\nRecycler.createPool (Point2, 2048, 1024);\nexport default Point2;\n","/*\n**\tfroxel/anim/easing.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tCollection of useful easing functions.\n*/\n\n//!namespace Easing\n\nconst Easing =\n{\n\t/* ******************************************** */\n\t//!namespace Linear\n\tLinear:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Back\n\tBack:\n\t{\n\t\tk: 1.70158,\n\n\t\t/**\n\t\t * \t!function IN (t: number, k?: number) : number;\n\t\t */\n\t\tIN: function (t, k=null)\n\t\t{\n\t\t\tif (k === null) k = Easing.Back.k;\n\t\t\treturn t*t*((k+1)*t - k);\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number, k?: number) : number;\n\t\t */\n\t\tOUT: function (t, k=null)\n\t\t{\n\t\t\treturn 1 - Easing.Back.IN(1 - t, k);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number, k?: number) : number;\n\t\t */\n\t\tIN_OUT: function (t, k=null)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Back.IN(t*2, k)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Back.OUT((t-0.5)*2, k)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Bounce\n\tBounce:\n\t{\n\t\tgetConst: function (t)\n\t\t{\n\t\t\tif (t < 1.0/2.75)\n\t\t\t\treturn 7.5625 * t * t;\n\t\t\telse if (t < 2.0/2.75)\n\t\t\t\treturn 7.5625 * (t -= 1.5/2.75)*t + 0.75;\n\t\t\telse if (t < 2.5/2.75)\n\t\t\t\treturn 7.5625 * (t -= 2.250/2.75) * t + 0.9375;\n\n\t\t\treturn 7.5625 * (t -= 2.625/2.75) * t + 0.984375;\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Bounce.getConst(1-t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn Easing.Bounce.getConst(t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn (1 - Easing.Bounce.getConst(1-2*t))/2;\n\t\t\telse\n\t\t\t\treturn (Easing.Bounce.getConst((t-0.5)*2)/2)+0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Circ\n\tCirc:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Math.sqrt(1 - t*t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Circ.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\t\treturn Easing.Circ.IN(t*2)/2;\n\t\t\t\telse\n\t\t\t\t\treturn Easing.Circ.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Cubic\n\tCubic:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Cubic.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Cubic.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Cubic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Expo\n\tExpo:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn Math.pow(2, 12*(t-1));\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn -Math.pow(2, -12*t) + 1;\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif ((t *= 2) < 1)\n\t\t\t\treturn Math.pow (2, 12 * (t - 1)) / 2;\n\t\t\telse\n\t\t\t\treturn (-Math.pow (2, -12 * (t - 1)) + 2) / 2;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Power\n\tPower:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number, p?: number) : number;\n\t\t */\n\t\tIN: function (t, p=12)\n\t\t{\n\t\t\treturn Math.pow(t, p);\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number, p?: number) : number;\n\t\t */\n\t\tOUT: function (t, p=12)\n\t\t{\n\t\t\treturn 1 - Easing.Power.IN(1 - t, p);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number, p?: number) : number;\n\t\t */\n\t\tIN_OUT: function (t, p=12)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Power.IN(t*2, p)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Power.OUT((t-0.5)*2, p)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Quad\n\tQuad:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quad.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Quad.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Quad.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Quartic\n\tQuartic:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t*t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quartic.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Quartic.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Quartic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Quintic\n\tQuintic:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t*t*t;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quintic.IN(1 - t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\t\treturn Easing.Quintic.IN(t*2)/2;\n\t\t\t\telse\n\t\t\t\t\treturn Easing.Quintic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Sine\n\tSine:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Math.sin (1.5708 * (1 - t));\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn Math.sin (1.5708 * t);\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn (Math.cos (3.1416*t) - 1) / -2;\n\t\t}\n\t},\n\t//!/namespace\n\n\t/* ******************************************** */\n\t//!namespace Step\n\tStep:\n\t{\n\t\t/**\n\t\t * \t!function IN (t: number) : number;\n\t\t */\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t},\n\n\t\t/**\n\t\t * \t!function OUT (t: number) : number;\n\t\t */\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t},\n\n\t\t/**\n\t\t * \t!function IN_OUT (t: number) : number;\n\t\t */\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t}\n\t}\n};\n\nexport default Easing;\n","/*\n**\tfroxel/anim/anim.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport List from '../utils/list.js';\nimport Recycler from '../utils/recycler.js';\nimport sys from '../fxl/system.js';\n\n//![import \"../utils/list\"]\n//![import \"../utils/recycler\"]\n\nimport Block from './block.js';\nimport Command from './command.js';\n\n//![import \"./block\"]\n//![import \"./command\"]\n\nimport PARALLEL from './parallel.js';\nimport SERIAL from './serial.js';\nimport REPEAT from './repeat.js';\nimport SET from './set.js';\nimport RESTART from './restart.js';\nimport WAIT from './wait.js';\nimport RANGE from './range.js';\nimport RAND from './rand.js';\nimport RANDT from './randt.js';\n\n//:/**\n//: * \tClass to animate properties using commands.\n//: */\n\n//!class Anim\n\nconst Anim = Class.extend\n({\n\tclassName: 'Anim',\n\n\tinitialData: null,\n\tdata: null,\n\n\tblockStack: null,\n\tcmdStack: null,\n\n\ttimeScale: 1,\n\tblock: null,\n\ttime: 0,\n\n\tpaused: false,\n\tfinished: false,\n\trunning: false,\n\n\tfinishedCallback: null,\n\tfinishedCallbackHandler: null,\n\tfinishedCallbackContext: null,\n\n\tautoDispose: false,\n\n\t__ctor: function ()\n\t{\n\t\t// VIOLET: Possibly optimize this { } objects.\n\t\tthis.initialData = { };\n\t\tthis.data = { };\n\n\t\tthis.block = Block.alloc();\n\t\tthis.blockStack = List.Pool.alloc();\n\t\tthis.cmdStack = List.Pool.alloc();\n\n\t\tthis.running = false;\n\t\tthis.autoDispose = false;\n\n\t\tthis.finishedCallback = null;\n\t\tthis.finishedCallbackHandler = null;\n\t\tthis.finishedCallbackContext = null;\n\n\t\treturn this.reset();\n\t},\n\n\t__dtor: function ()\n\t{\n\t\tthis.block.free();\n\t\tthis.blockStack.clear().free();\n\t\tthis.cmdStack.clear().free();\n\n\t\tif (this.finishedCallbackHandler !== null)\n\t\t{\n\t\t\tthis.finishedCallbackHandler.free();\n\t\t\tthis.finishedCallbackHandler = null;\n\t\t}\n\n\t\tif (this.finishedCallbackContext !== null)\n\t\t{\n\t\t\tthis.finishedCallbackContext.free();\n\t\t\tthis.finishedCallbackContext = null;\n\t\t}\n\t},\n\n\tcopyTo: function (target)\n\t{\n\t\ttarget.clear();\n\n\t\tdispose(target.block);\n\t\ttarget.block = this.block.clone();\n\n\t\ttarget.initialData = this.initialData;\n\t\treturn target.reset();\n\t},\n\n\tclone: function (autoDispose=false)\n\t{\n\t\tlet anim = new Anim();\n\t\tanim.autoDispose = autoDispose;\n\n\t\tthis.copyTo(anim);\n\t\treturn anim;\n\t},\n\n\tonFinished: function (callback)\n\t{\n\t\tthis.finishedCallback = callback;\n\t\treturn this;\n\t},\n\n\tthen: function (callback, context=null)\n\t{\n\t\tif (!callback) return this;\n\n\t\tif (this.finishedCallback !== this.thenCallback)\n\t\t{\n\t\t\tthis.finishedCallback = this.thenCallback;\n\n\t\t\tif (this.finishedCallbackHandler === null)\n\t\t\t{\n\t\t\t\tthis.finishedCallbackHandler = List.Pool.alloc();\n\t\t\t\tthis.finishedCallbackContext = List.Pool.alloc();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.finishedCallbackHandler.reset();\n\t\t\t\tthis.finishedCallbackContext.reset();\n\t\t\t}\n\t\t}\n\n\t\tthis.finishedCallbackHandler.push(callback);\n\t\tthis.finishedCallbackContext.push(context);\n\t\treturn this;\n\t},\n\n\tthenCallback: function ()\n\t{\n\t\tif (!this.finishedCallbackHandler.length)\n\t\t\treturn false;\n\n\t\tlet context = this.finishedCallbackContext.shift();\n\t\tthis.finishedCallbackHandler.shift()(this, context);\n\t},\n\n\t/*\n\t**\tClears the object, removes all commands and callbacks. The `initialData` and `data` objects aren't changed.\n\t*/\n\tclear: function ()\n\t{\n\t\tthis.blockStack.clear();\n\t\tthis.cmdStack.clear();\n\t\tthis.block.clear();\n\n\t\tthis.paused = false;\n\t\tthis.finished = false;\n\t\tthis.time = 0;\n\t\tthis.timeScale = 1;\n\n\t\tif (this.finishedCallbackHandler !== null)\n\t\t{\n\t\t\tthis.finishedCallbackHandler.free();\n\t\t\tthis.finishedCallbackHandler = null;\n\t\t}\n\n\t\tif (this.finishedCallbackContext !== null)\n\t\t{\n\t\t\tthis.finishedCallbackContext.free();\n\t\t\tthis.finishedCallbackContext = null;\n\t\t}\n\n\t\tthis.finishedCallback = null;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tResets the animation to its initial state.\n\t*/\n\treset: function ()\n\t{\n\t\tthis.blockStack.clear();\n\t\tthis.cmdStack.clear();\n\t\tthis.block.reset();\n\n\t\tthis.paused = false;\n\t\tthis.finished = false;\n\t\tthis.time = 0;\n\t\tthis.timeScale = 1;\n\n\t\tObject.assign (this.data, this.initialData);\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the initial data.\n\t*/\n\tinitial: function (data=null)\n\t{\n\t\tif (data !== null)\n\t\t\tthis.initialData = data;\n\n\t\tObject.assign (this.data, this.initialData);\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the time scale (animation speed).\n\t*/\n\tspeed: function (value)\n\t{\n\t\tthis.timeScale = value > 0.0 ? value : 1.0;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the output data object.\n\t*/\n\toutput: function (data)\n\t{\n\t\tthis.data = data;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tPauses the animation.\n\t*/\n\tpause: function ()\n\t{\n\t\tif (!this.paused)\n\t\t\tthis.paused = true;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tResumes the animation.\n\t*/\n\tresume: function ()\n\t{\n\t\tthis.finished = false;\n\t\tthis.paused = false;\n\n\t\tif (!this.running)\n\t\t\tthis.run(false);\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tBegins execution of the animation.\n\t*/\n\trun: function (reset=true)\n\t{\n\t\tif (this.running)\n\t\t\treturn this;\n\n\t\tif (reset == true)\n\t\t\tthis.reset();\n\n\t\tsys.update.add(this.update, this);\n\t\tthis.running = true;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the value of a field.\n\t*/\n\tsetValue: function (fieldName, value)\n\t{\n\t\tlet curr = this.data;\n\n\t\tif (typeof(fieldName) !== 'string')\n\t\t{\n\t\t\tif (typeof(fieldName) === 'function')\n\t\t\t{\n\t\t\t\tfieldName (this, value);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet i = 0;\n\n\t\t\t\twhile (curr !== null && i < fieldName.length-1)\n\t\t\t\t\tcurr = curr[fieldName[i++]];\n\n\t\t\t\tcurr[fieldName[i]] = value;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tcurr[fieldName] = value;\n\t},\n\n\t/*\n\t**\tReturns the value of a field. Performs special transforms to the value if certain prefix is found.\n\t*/\n\tgetValue: function (fieldName, value=null, initialValue=null)\n\t{\n\t\tlet curr = this.data;\n\t\t\n\t\tif (typeof(fieldName) !== 'string')\n\t\t{\n\t\t\tif (typeof(fieldName) === 'function')\n\t\t\t{\n\t\t\t\tcurr = fieldName (this, null);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet i = 0;\n\n\t\t\t\twhile (curr !== null && i < fieldName.length)\n\t\t\t\t\tcurr = curr[fieldName[i++]];\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tcurr = curr[fieldName];\n\n\t\tif (value === null)\n\t\t\tvalue = curr;\n\n\t\tif (initialValue === null)\n\t\t\tinitialValue = curr;\n\n\t\tif (typeof(value) === 'string')\n\t\t{\n\t\t\tswitch(value[0])\n\t\t\t{\n\t\t\t\tcase '+':\n\t\t\t\t\tvalue = initialValue + Number(value.substr(1));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase '-':\n\t\t\t\t\tvalue = initialValue - Number(value.substr(1));\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tvalue = Number(value);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\telse if (typeof(value) === 'function')\n\t\t\tvalue = value (curr, initialValue, this);\n\n\t\treturn value;\n\t},\n\n\t/**\n\t * Updates the animation by the specified delta, which must be in the same unit as the duration of the commands.\n\t * Returns false when the animation has been completed.\n\t *\n\t * @param {number} dt\n\t * @returns {boolean}\n\t */\n\tupdate: function (dt, self=null)\n\t{\n\t\tif (self === null)\n\t\t\tself = this;\n\n\t\tif (self.paused || self.block.isFinished())\n\t\t{\n\t\t\tself.running = false;\n\t\t\treturn false;\n\t\t}\n\n\t\tself.time += dt*self.timeScale*Anim.timeScale;\n\n\t\tif (self.block.update(self) !== true)\n\t\t\treturn true;\n\n\t\tlet finished = self.finished;\n\t\tlet count = self.block.length;\n\t\tlet block = self.block;\n\n\t\tself.finished = true;\n\n\t\tif (!finished && self.finishedCallback !== null)\n\t\t{\n\t\t\tif (self.finishedCallback(self.data, self) === false)\n\t\t\t\tself.finishedCallback = null;\n\n\t\t\tif (self.block !== block || self.block.length != count)\n\t\t\t{\n\t\t\t\tself.resume();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\tself.running = false;\n\n\t\tif (self.autoDispose)\n\t\t\tdispose(self);\n\n\t\treturn false;\n\t},\n\n\t/*\n\t**\tEnsures that the field name is correct for subsequent rules.\n\t*/\n\tprepareFieldName: function (value)\n\t{\n\t\tif (typeof(value) === 'function')\n\t\t\treturn value;\n\n\t\treturn value.indexOf('.') != -1 ? value.split('.') : value;\n\t},\n\n\t/* ****************************************************************************************** */\n\n\t/*\n\t**\tRuns the subsequent commands in parallel. Should end the parallel block by calling end().\n\t*/\n\tparallel: function ()\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(PARALLEL));\n\n\t\tthis.blockStack.push (this.block);\n\t\tthis.cmdStack.push (cmd);\n\n\t\tthis.block = cmd.block;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tRuns the subsequent commands in series. Should end the serial block by calling end().\n\t*/\n\tserial: function ()\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(SERIAL));\n\n\t\tthis.blockStack.push (this.block);\n\t\tthis.cmdStack.push (cmd);\n\n\t\tthis.block = cmd.block;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tRepeats a block the specified number of times.\n\t*/\n\trepeat: function (count)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(REPEAT));\n\t\tcmd.count = count;\n\n\t\tthis.blockStack.push (this.block);\n\t\tthis.cmdStack.push (cmd);\n\n\t\tthis.block = cmd.block;\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tEnds a parallel(), serial() or repeat() block.\n\t*/\n\tend: function ()\n\t{\n\t\tthis.cmdStack.pop().ready();\n\t\tthis.block = this.blockStack.pop();\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the value of a variable.\n\t*/\n\tset: function (field, value)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(SET));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.value = value;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tRestarts the current block.\n\t*/\n\trestart: function ()\n\t{\n\t\tthis.block.add(Command.alloc(RESTART));\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tWaits for the specified duration.\n\t*/\n\twait: function (duration)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(WAIT));\n\n\t\tcmd.duration = duration;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the range of a variable.\n\t*/\n\trange: function (field, duration, startValue, endValue, easing=null)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(RANGE));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.duration = duration;\n\t\tcmd.startValue = startValue;\n\t\tcmd.endValue = endValue;\n\t\tcmd.easing = easing;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tSets the range of a variable, using the current value as startValue.\n\t*/\n\trangeTo: function (field, duration, endValue, easing=null)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(RANGE));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.duration = duration;\n\t\tcmd.startValue = null;\n\t\tcmd.endValue = endValue;\n\t\tcmd.easing = easing;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tGenerates a certain amount of random numbers in the given range (inclusive).\n\t*/\n\trand: function (field, duration, count, startValue, endValue, easing=null)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(RAND));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.duration = duration;\n\t\tcmd.count = count;\n\t\tcmd.startValue = startValue;\n\t\tcmd.endValue = endValue;\n\t\tcmd.easing = easing;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tGenerates a certain amount of random numbers in the given range (inclusive). This uses a static random table to determine the next values.\n\t*/\n\trandt: function (field, duration, count, startValue, endValue, easing)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(RANDT));\n\n\t\tcmd.field = this.prepareFieldName(field);\n\t\tcmd.duration = duration;\n\t\tcmd.count = count;\n\t\tcmd.startValue = startValue;\n\t\tcmd.endValue = endValue;\n\t\tcmd.easing = easing;\n\n\t\tcmd.ready();\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tPlays a sound.\n\t*/\n\tplay: function (snd)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(PLAY));\n\t\tcmd.snd = snd;\n\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tExecutes a function.\n\t*/\n\texec: function (fn)\n\t{\n\t\tlet cmd = this.block.add(Command.alloc(EXEC));\n\t\tcmd.fn = fn;\n\n\t\treturn this;\n\t},\n\n\t/* ********************************************************** */\n\n\t_bounds_x1: function (anim, value)\n\t{\n\t\tif (value === null)\n\t\t\treturn anim.data.bounds.x1;\n\n\t\tanim.data.translate(int(value) - anim.data.bounds.x1, 0);\n\t},\n\n\t_bounds_y1: function (anim, value)\n\t{\n\t\tif (value === null)\n\t\t\treturn anim.data.bounds.y1;\n\n\t\tanim.data.translate(0, int(value) - anim.data.bounds.y1);\n\t},\n\n\t/*\n\t**\tSets X coordinate.\n\t*/\n\tsetX: function (value)\n\t{\n\t\treturn this.set(this._bounds_x1, value);\n\t},\n\n\t/*\n\t**\tSets Y coordinate.\n\t*/\n\tsetY: function (value)\n\t{\n\t\treturn this.set(this._bounds_y1, value);\n\t},\n\n\t/*\n\t**\tSets X and Y coordinates.\n\t*/\n\tposition: function (x, y)\n\t{\n\t\treturn this.set(this._bounds_x1, x).set(this._bounds_y1, y);\n\t},\n\n\t/*\n\t**\tTranslates the X coordinate.\n\t*/\n\ttranslateX: function (duration, deltaValue, easing)\n\t{\n\t\treturn this.range(this._bounds_x1, duration, null, (deltaValue < 0 ? '-' : '+') + Math.abs(deltaValue), easing);\n\t},\n\n\t/*\n\t**\tTranslates the Y coordinate.\n\t*/\n\ttranslateY: function (duration, deltaValue, easing)\n\t{\n\t\treturn this.range(this._bounds_y1, duration, null, (deltaValue < 0 ? '-' : '+') + Math.abs(deltaValue), easing);\n\t},\n\n\t/*\n\t**\tTranslates the X and Y coordinates.\n\t*/\n\ttranslate: function (duration, deltaValueX, deltaValueY, easingX, easingY=null)\n\t{\n\t\treturn this.parallel()\n\t\t\t\t\t.range(this._bounds_x1, duration, null, (deltaValueX < 0 ? '-' : '+') + Math.abs(deltaValueX), easingX)\n\t\t\t\t\t.range(this._bounds_y1, duration, null, (deltaValueY < 0 ? '-' : '+') + Math.abs(deltaValueY), easingY ? easingY : easingX)\n\t\t\t\t.end();\n\t},\n\n\t/*\n\t**\tSets the X and Y coordinates to the specified values.\n\t*/\n\tmoveTo: function (duration, endValueX, endValueY, easingX, easingY=null)\n\t{\n\t\treturn this.parallel()\n\t\t\t\t.range(this._bounds_x1, duration, null, endValueX, easingX)\n\t\t\t\t.range(this._bounds_y1, duration, null, endValueY, easingY ? easingY : easingX)\n\t\t\t\t.end();\n\t},\n\n\t/*\n\t**\tSets the X coordinate to the specified value.\n\t*/\n\tmoveX: function (duration, endValue, easing=null)\n\t{\n\t\treturn this.range(this._bounds_x1, duration, null, endValue, easing);\n\t},\n\n\t/*\n\t**\tSets the Y coordinate to the specified value.\n\t*/\n\tmoveY: function (duration, endValue, easing=null)\n\t{\n\t\treturn this.range(this._bounds_y1, duration, null, endValue, easing);\n\t},\n\n\t/*\n\t**\tScales the X coordinate.\n\t*/\n\tscaleX: function (duration, endValue, easing)\n\t{\n\t\treturn this.range('sx', duration, null, endValue, easing);\n\t},\n\n\t/*\n\t**\tScales the Y coordinate.\n\t*/\n\tscaleY: function (duration, endValue, easing)\n\t{\n\t\treturn this.range('sy', duration, null, endValue, easing);\n\t},\n\n\t/*\n\t**\tScales the X and Y coordinates.\n\t*/\n\tscale: function (duration, endValueX, endValueY, easingX, easingY=null)\n\t{\n\t\treturn this.parallel()\n\t\t\t\t.range('sx', duration, null, endValueX, easingX)\n\t\t\t\t.range('sy', duration, null, endValueY, easingY ? easingY : easingX)\n\t\t\t\t.end();\n\t},\n\n\t/*\n\t**\tRotates a certain number of radians.\n\t*/\n\trotate: function (duration, deltaValue, easing)\n\t{\n\t\treturn this.range('angle', duration, null, (deltaValue < 0 ? '-' : '+') + Math.abs(deltaValue), easing);\n\t}\n});\n\n/*\n**\tGlobal time scale.\n*/\nAnim.timeScale = 1.0;\n\n/*\n**\tSets the global time scale (animation speed).\n*/\nAnim.speed = function (value)\n{\n\tAnim.timeScale = value > 0.0 ? value : 1.0;\n};\n\nRecycler.createPool(Anim, 8192);\nexport default Anim;\n","/*\n**\tflow/boot.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport PriorityQueue from '../utils/priority-queue.js';\n\n//![import \"../utils/priority-queue\"]\n\n//!class Boot\n\nconst Boot =\n{\n\tmodules: new PriorityQueue(),\n\n\t/**\n\t * \tRegisters a new boot module.\n\t * \t!static register (module: Boot.Module) : Boot.Module;\n\t */\n\tregister: function (module)\n\t{\n\t\treturn this.modules.add(module);\n\t},\n\n\t/**\n\t * \tRemoves a boot module.\n\t * \t!static unregister (module: Boot.Module) : void;\n\t */\n\tunregister: function (module)\n\t{\n\t\tthis.modules.remove(module);\n\t\tthis.modules.cleanup();\n\t},\n\n\t/**\n\t * \tExecutes the startup sequence.\n\t * \t!static startup (finishedCallback?: () => void) : void;\n\t */\n\tstartup: function (finishedCallback=null)\n\t{\n\t\tthis.modules.forEachAsync((m,r) => { if (m.onStartup(r) !== false) r(); }, finishedCallback);\n\t},\n\n\t/**\n\t * \tExecutes the shutdown sequence.\n\t * \t!static shutdown (finishedCallback?: () => void) : void;\n\t */\n\tshutdown: function (finishedCallback=null)\n\t{\n\t\tthis.modules.forEachAsyncRev( (m,r) => { if (m.onShutdown(r) !== false) r(); }, finishedCallback);\n\t}\n};\n\n//!/class\n\n//!namespace Boot\n//!interface Module\n\nBoot.Module = Class.extend\n({\n\tclassName: \"Module\",\n\n\t/**\n\t * \tPriority of the module (from 0 to 100), lower number means higher priority.\n\t * \t!priority: number;\n\t */\n\tpriority: 5,\n\n\t__ctor: function()\n\t{\n\t\tBoot.register(this);\n\t},\n\n\t__dtor: function()\n\t{\n\t\tBoot.unregister(this);\n\t},\n\n\t/**\n\t * \tShould return `false` if the method is async. When async ensure to call `next` once the operation is complete.\n\t * \t!onStartup (next: () => void) : boolean;\n\t */\n\tonStartup: function (next)\n\t{\n\t},\n\n\t/**\n\t * \tShould return `false` if the method is async. When async ensure to call `next` once the operation is complete.\n\t * \t!onShutdown (next: () => void) : boolean;\n\t */\n\tonShutdown: function (next)\n\t{\n\t}\n});\n\n//!/interface\n//!/namespace\n\nexport default Boot;\n","/*\n**\tfxl/system.js\n**\n**\tCopyright (c) 2016-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport System from '../system/system.js';\nimport Resources from '../resources/resources.js';\nimport Boot from '../flow/boot.js';\nimport Handler from '../utils/handler.js';\n\n//!class sys\n\nconst system =\n{\n\t/**\n\t * Indicates if the system module has already been initialized.\n\t */\n\tinitialized: false,\n\n\t/**\n\t * Screen width (available after calling `init`).\n\t * !static readonly screenWidth: number;\n\t */\n\tscreenWidth: 0,\n\n\t/**\n\t * Screen height (available after calling `init`).\n\t * !static readonly screenHeight: number;\n\t */\n\tscreenHeight: 0,\n\n\t/**\n\t * Primary renderer (available after calling `init`).\n\t * !static readonly renderer: Canvas;\n\t */\n\trenderer: null,\n\n\t/**\n\t * Logical system time (mirrors the value of System.frameTime).\n\t * !static readonly time: Number;\n\t */\n\ttime: 0,\n\n\t/**\n\t * Logical system delta time (mirrors the value of System.frameDelta).\n\t * !static readonly dt: Number;\n\t */\n\tdt: 0,\n\n\t/**\n\t * Timeout update handler.\n\t */\n\t_timeout: null,\n\n\t/**\n\t * Interval update handler.\n\t */\n\t_interval: null,\n\n\t/**\n\t * Time span update handler.\n\t */\n\t_span: null,\n\n\t/**\n\t * Update handler executed on every frame start.\n\t * !static readonly update: Handler;\n\t */\n\tupdate: null,\n\n\t/**\n\t * Draw handler executed on every frame start.\n\t * !static readonly draw: Handler;\n\t */\n\tdraw: null,\n\n\t/**\n\t * Executed when the system is paused.\n\t * !static onPaused: (fromExternalEvent: boolean) => void;\n\t */\n\tonPaused: null,\n\n\t/**\n\t * Executed when the system is resumed.\n\t * !static onResumed: (fromExternalEvent: boolean) => void;\n\t */\n\tonResumed: null,\n\n\t/**\n\t * System initialization options.\n\t */\n\toptions:\n\t{\n\t\t/**\n\t\t * \tTells the system to enable WebGL support.\n\t\t */\n\t\tgl: true,\n\n\t\t/**\n\t\t * \tIndicates if on-screen logging should be enabled.\n\t\t */\n\t\tlog: false,\n\n\t\t/**\n\t\t * \tEnables or disables antialised canvas. Set to `false` when pixel-perfect is desired.\n\t\t */\n\t\tantialias: false,\n\n\t\t/**\n\t\t * \tBackground of the system canvas.\n\t\t */\n\t\tbackground: '#000000',\n\n\t\t/**\n\t\t * \tDesired orientaton of the display.\n\t\t */\n\t\torientation: 'automatic',\n\n\t\t/**\n\t\t * \tDesired display width. When not specified (null) the maximum screen width to maintain the aspect ratio will be used.\n\t\t */\n\t\tscreenWidth: null,\n\n\t\t/**\n\t\t * \tDesired display height. When not specified (null) the maximum screen height to maintain the aspect ratio will be used.\n\t\t */\n\t\tscreenHeight: null,\n\n\t\t/**\n\t\t * \tTarget frames per second (FPS). Used to determine delay between frames.\n\t\t */\n\t\tfps: 144,\n\n\t\t/**\n\t\t * \tMinimum allowed frames per second (FPS). If system FPS drops below this value, the `frameDelta` property of System will be truncated to 1/minFps.\n\t\t */\n\t\tminFps: 24,\n\n\t\t/**\n\t\t * \tIndicates if recycler pool preallocation should be automatically executed. Additionally if this value is a number, it will be used as\n\t\t * \tmaximum preallocation parameter for the recycler.\n\t\t */\n\t\tpreallocate: true\n\t},\n\n\t/**\n\t * Initializes the system with the specified options.\n\t * !static init (options: System.Options) : Promise<void>;\n\t */\n\t/**\n\t * Initializes the system using the default options.\n\t * !static init () : Promise<void>;\n\t */\n\tinit: function (options)\n\t{\n\t\treturn new Promise ((resolve, reject) =>\n\t\t{\n\t\t\tif (this.initialized)\n\t\t\t\treturn resolve();\n\n\t\t\tObject.assign(this.options, options);\n\n\t\t\tResources.config ({ pixelated: !this.options.antialias, filter: this.options.antialias ? 'LINEAR' : 'NEAREST' });\n\t\t\tSystem.init (this.options);\n\n\t\t\tSystem.updateQueueAdd\n\t\t\t({\n\t\t\t\tupdate: function(dt)\n\t\t\t\t{\n\t\t\t\t\tsystem.time = System.frameTime;\n\t\t\t\t\tsystem.dt = dt;\n\n\t\t\t\t\tsystem._timeout.exec(dt);\n\t\t\t\t\tsystem._interval.exec(dt);\n\t\t\t\t\tsystem._span.exec(dt);\n\n\t\t\t\t\tsystem.update.exec(dt);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tSystem.drawQueueAdd\n\t\t\t({\n\t\t\t\tdraw: function(g)\n\t\t\t\t{\n\t\t\t\t\tsystem.draw.exec(g);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tBoot.startup(function()\n\t\t\t{\n\t\t\t\tSystem.start();\n\n\t\t\t\tsystem.screenWidth = System.screenWidth;\n\t\t\t\tsystem.screenHeight = System.screenHeight;\n\t\t\t\tsystem.renderer = System.renderer;\n\n\t\t\t\tsystem._timeout = Handler.Pool.alloc();\n\t\t\t\tsystem._interval = Handler.Pool.alloc();\n\t\t\t\tsystem._span = Handler.Pool.alloc();\n\n\t\t\t\tsystem.update = Handler.Pool.alloc();\n\t\t\t\tsystem.draw = Handler.Pool.alloc();\n\n\t\t\t\twindow.onblur = function() {\n\t\t\t\t\tsystem.pause(true);\n\t\t\t\t};\n\n\t\t\t\twindow.onfocus = function() {\n\t\t\t\t\tsystem.resume(true);\n\t\t\t\t};\n\n\t\t\t\tsystem.initialized = true;\n\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Pauses the system.\n\t * !static pause (fromExternalEvent:boolean=false) : void;\n\t */\n\tpause: function (fromExternalEvent=false)\n\t{\n\t\tif (system.onPaused !== null)\n\t\t\tsystem.onPaused(fromExternalEvent);\n\t},\n\n\t/**\n\t * Resumes the system.\n\t * !static resume (fromExternalEvent:boolean=false) : void;\n\t */\n\tresume: function (fromExternalEvent=false)\n\t{\n\t\tif (system.onResumed !== null)\n\t\t\tsystem.onResumed(fromExternalEvent);\n\t},\n\n\t/**\n\t * Creates a timeout callback.\n\t * !static timeout (duration: number, callback: function, arg0?: any, arg1?: any, arg2?: any, arg3?: any) : void;\n\t */\n\ttimeout: function (duration, callback, arg0=null, arg1=null, arg2=null, arg3=null)\n\t{\n\t\tthis._timeout.add(this._updateTimeout, duration, callback, arg0, arg1, arg2, arg3);\n\t},\n\n\t_updateTimeout: function (dt, _, callback, arg0, arg1, arg2, arg3)\n\t{\n\t\tthis.arg0 -= dt;\n\t\tif (this.arg0 > 0) return true;\n\n\t\tcallback (arg0, arg1, arg2, arg3);\n\t\treturn false;\n\t},\n\n\t/**\n\t * Creates an interval callback.\n\t * !static interval (period: number, callback: function, arg0?: any, arg1?: any, arg2?: any) : void;\n\t */\n\tinterval: function (period, callback, arg0=null, arg1=null, arg2=null)\n\t{\n\t\tthis._interval.add(this._updateInterval, 0, period, callback, arg0, arg1, arg2);\n\t},\n\n\t_updateInterval: function (dt, _0, _1, callback, arg0, arg1, arg2)\n\t{\n\t\tthis.arg0 += dt;\n\t\tif (this.arg0 < this.arg1) return true;\n\n\t\tthis.arg0 -= this.arg1;\n\t\treturn callback (arg0, arg1, arg2);\n\t},\n\n\t/**\n\t * Creates a a time-span callback.\n\t * !static span (period: number, callback: function, arg0?: any, arg1?: any, arg2?: any) : void;\n\t */\n\tspan: function (duration, callback, arg0=null, arg1=null, arg2=null)\n\t{\n\t\tthis._span.add(this._updateSpan, 0, duration, callback, arg0, arg1, arg2);\n\t},\n\n\t_updateSpan: function (dt, _0, _1, callback, arg0, arg1, arg2)\n\t{\n\t\tthis.arg0 += dt;\n\t\tif (this.arg0 > this.arg1) this.arg0 = this.arg1;\n\n\t\tif (callback (this.arg0/this.arg1, arg0, arg1, arg2) === false)\n\t\t\treturn false;\n\n\t\treturn this.arg0 !== this.arg1;\n\t}\n};\n\nexport default system;\n","/*\n**\tfroxel/anim/block.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport List from '../utils/list.js';\nimport Recycler from '../utils/recycler.js';\n\n//!class Block\n\nconst Block = Class.extend\n({\n\tclassName: 'Anim:Block',\n\n\tcommands: null,\n\n\tfirst: true,\n\tcurrent: false,\n\ttime: 0,\n\n\t/**\n\t * \tInitializes the block to its initial state.\n\t * \t!init() : Block;\n\t */\n\tinit: function()\n\t{\n\t\tthis.commands = List.Pool.alloc();\n\t\tthis.reset(0);\n\t\treturn this;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis.commands.free();\n\t},\n\n\t/**\n\t * \tAdds a command to the block.\n\t * \t!add (cmd: Command) : Command;\n\t */\n\tadd: function(cmd)\n\t{\n\t\tthis.commands.push(cmd);\n\t\treturn cmd;\n\t},\n\n\t/**\n\t * \tClones the block.\n\t * \t!clone() : Block;\n\t */\n\tclone: function()\n\t{\n\t\tlet block = Block.alloc();\n\n\t\tfor (let node = this.commands.top; node !== null; node = node.next)\n\t\t\tblock.commands.push(node.value.clone());\n\n\t\treturn block;\n\t},\n\n\t/**\n\t * \tClears the block by removing all commands and resetting it to initial state.\n\t * \t!clear() : Block;\n\t */\n\tclear: function()\n\t{\n\t\tthis.commands.clear();\n\t\tthis.reset(0);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResets the block to its initial state. Does not remove commands.\n\t * \t!reset (time: number) : Block;\n\t */\n\treset: function (time=0)\n\t{\n\t\tthis.first = true;\n\t\tthis.current = null;\n\t\tthis.time = time;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the block to use the first command in the next call to `update`.\n\t * \t!restart() : Block;\n\t */\n\trestart: function()\n\t{\n\t\tthis.first = true;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns `true` if all commands in the block have been executed to completion.\n\t * \t!isFinished() : boolean;\n\t */\n\tisFinished: function()\n\t{\n\t\tif (this.first === true)\n\t\t{\n\t\t\tthis.current = this.commands.top;\n\t\t\tthis.first = false;\n\t\t}\n\n\t\treturn this.current === null;\n\t},\n\n\t/**\n\t * \tExecutes the next command in the block. Returns `true` when block execution is complete.\n\t * \t!update (anim: Anim) : boolean;\n\t */\n\tupdate: function (anim)\n\t{\n\t\twhile (!this.isFinished())\n\t\t{\n\t\t\tlet r = this.current.value.update(anim, this);\n\t\t\tif (r !== true) return r;\n\n\t\t\tthis.current = this.current.next;\n\t\t}\n\n\t\treturn true;\n\t}\n});\n\n/**\n * \tAllocates a new block.\n * \t!static alloc () : Block;\n */\n\n/**\n * \tAllocates a new block and initializes it.\n * \t!static calloc () : Block;\n */\n\nRecycler.attachTo(Block, 8192);\nexport default Block;\n","/*\n**\tfroxel/anim/command.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport List from '../utils/list.js';\nimport Recycler from '../utils/recycler.js';\n\n//!class Command\n\nconst Command = Class.extend\n({\n\tclassName: 'Anim:Command',\n\n\t/**\n\t * \tObject having the code of the operation to execute.\n\t */\n\top: null,\n\n\t/**\n\t * \tIndicates if execution of the command has started.\n\t */\n\tstarted: false,\n\n\t/**\n\t * \tField related to the command.\n\t */\n\tfield: null,\n\n\t/**\n\t * \tValue related to the field of the command.\n\t */\n\tvalue: null,\n\n\t/**\n\t * \tDuration of the command.\n\t */\n\tduration: 0, _duration: 0,\n\n\t/**\n\t * \tNumber of cicles of the command.\n\t */\n\tcount: 0, _count: 0,\n\n\t/**\n\t * \tInitial value for the command's field.\n\t */\n\tstartValue: 0, _startValue: 0,\n\n\t/**\n\t * \tFinal value for the command's field.\n\t */\n\tendValue: 0, _endValue: 0,\n\n\t/**\n\t * \tEasing function to use to interpolate values of the command's field.\n\t */\n\teasing: null,\n\n\t_cur: null,\n\t_last: null,\n\n\t/**\n\t * \tBlock where the command is stored.\n\t */\n\tblock: null, /* Block */\n\n\t/**\n\t * \tBlocks to execute (for commands having multiple blocks).\n\t */\n\tblocks: null, /* List<Block> */\n\n\t/**\n\t * \tTable with values.\n\t */\n\ttable: null,\n\n\t/**\n\t * \tSound resource.\n\t */\n\tsnd: null,\n\n\t/**\n\t * \tFunction to execute.\n\t */\n\tfn: null,\n\n\t/**\n\t * \tInitializes the command.\n\t * \t!init (op: object) : Command;\n\t */\n\tinit: function (op, autoInit)\n\t{\n\t\tthis.op = op;\n\t\tthis.started = false;\n\n\t\tthis.block = null;\n\t\tthis.blocks = null;\n\t\n\t\tthis.table = null;\n\t\tthis.snd = null;\n\t\tthis.fn = null;\n\n\t\tif (autoInit !== false)\n\t\t\top.init(this, false);\n\n\t\treturn this;\n\t},\n\n\t__dtor: function()\n\t{\n\t\tif (this.block !== null) this.block.clear().free();\n\t\tif (this.blocks !== null) this.blocks.clear().free();\n\t},\n\n\tclone: function()\n\t{\n\t\tlet cmd = Command.alloc(this.op, false);\n\n\t \tcmd.field = this.field\n\t \tcmd.value = this.value\n\t \tcmd.duration = this.duration\n\t \tcmd.count = this.count\n\t \tcmd.startValue = this.startValue\n\t \tcmd.endValue = this.endValue\n\t \tcmd.easing = this.easing;\n\t\tcmd.table = this.table;\n\t\tcmd.snd = this.snd;\n\t\tcmd.fn = this.fn;\n\n\t\tif (this.block !== null)\n\t\t\tcmd.block = this.block.clone();\n\n\t\tif (this.blocks !== null)\n\t\t{\n\t\t\tcmd.blocks = List.Pool.alloc();\n\n\t\t\tfor (let node = this.blocks.top; node !== null; node = node.next)\n\t\t\t\tcmd.blocks.push(node.value.clone());\n\t\t}\n\n\t\treturn cmd;\n\t},\n\n\t/**\n\t * \tExecuted when the command properties are ready, to initialize the operation code.\n\t * \t!ready() : void;\n\t */\n\tready: function()\n\t{\n\t\tthis.op.init(this, true);\n\t},\n\n\t/**\n\t * \tUpdates the command execution.\n\t * \t!update (anim: Anim, block: Block) : boolean;\n\t */\n\tupdate: function(anim, block)\n\t{\n\t\treturn this.op.update(anim, block, this);\n\t}\n});\n\n/**\n * \tAllocates a new command.\n * \t!static alloc () : Command;\n */\n\n/**\n * \tAllocates a new command and initializes it.\n * \t!static calloc () : Command;\n */\n\nRecycler.attachTo(Command);\nexport default Command;\n","/*\n**\tfroxel/anim/parallel.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport List from '../utils/list.js';\nimport Block from './block.js';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t\tif (!postinit)\n\t\t{\n\t\t\tcmd.block = Block.alloc();\n\t\t\tcmd.blocks = List.Pool.alloc();\n\t\t\treturn;\n\t\t}\n\n\t\tlet i;\n\n\t\twhile ((i = cmd.block.commands.shift()) != null)\n\t\t{\n\t\t\tlet block = Block.alloc();\n\t\t\tblock.add(i);\n\t\t\tcmd.blocks.push(block);\n\t\t}\n\n\t\tcmd.block.free();\n\t\tcmd.block = null;\n\t},\n\n\tupdate: function (anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tfor (let i = cmd.blocks.top; i !== null; i = i.next)\n\t\t\t{\n\t\t\t\ti.value.reset (block.time);\n\t\t\t}\n\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet time = block.time;\n\t\tlet n = 0, m = 0;\n\n\t\tfor (let i = cmd.blocks.top; i !== null; i = i.next)\n\t\t{\n\t\t\tlet r = i.value.update(anim);\n\t\t\tif (r === true) n++; else if (r === null) m++;\n\n\t\t\tif (i.value.time > time)\n\t\t\t\ttime = i.value.time;\n\t\t}\n\n\t\tif ((n+m) != cmd.blocks.length)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time = time;\n\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/serial.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Block from './block.js';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t\tif (!postinit)\n\t\t\tcmd.block = Block.alloc();\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd.block.reset (block.time);\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet r = cmd.block.update(anim);\n\t\tif (r !== true) return r;\n\n\t\tcmd.started = false;\n\t\tblock.time = cmd.block.time;\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/serial.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Block from './block.js';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t\tif (!postinit)\n\t\t\tcmd.block = Block.alloc();\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd.block.reset (block.time);\n\t\t\tcmd._count = cmd.count;\n\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet r = cmd.block.update(anim);\n\t\tif (r !== true) return r;\n\n\t\tif (cmd._count <= 1)\n\t\t{\n\t\t\tcmd.started = false;\n\t\t\tblock.time = cmd.block.time;\n\t\t\treturn true;\n\t\t}\n\n\t\tcmd.block.restart();\n\t\tcmd._count--;\n\t\treturn false;\n\t}\n};\n","/*\n**\tfroxel/anim/set.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tanim.setValue(cmd.field, anim.getValue(cmd.field, cmd.value));\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/restart.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tblock.restart();\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/wait.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rinn } from 'rinn';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._duration = Rinn.typeOf(cmd.duration) === 'string' ? anim.getValue(cmd.duration) : cmd.duration;\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tif (anim.time < block.time + cmd._duration)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time += cmd._duration;\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/range.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rinn } from 'rinn';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._startValue = anim.getValue(cmd.field, cmd.startValue);\n\t\t\tcmd._duration = Rinn.typeOf(cmd.duration) === 'string' ? anim.getValue(cmd.duration) : cmd.duration;\n\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tcmd._endValue = anim.getValue(cmd.field, cmd.endValue, cmd._startValue);\n\n\t\tlet t = 1.0;\n\n\t\tif (anim.time < block.time + cmd._duration)\n\t\t\tt = (anim.time - block.time) / cmd._duration;\n\n\t\tif (cmd.easing && t != 1.0)\n\t\t\tanim.setValue(cmd.field, cmd.easing(t)*(cmd._endValue - cmd._startValue) + cmd._startValue);\n\t\telse\n\t\t\tanim.setValue(cmd.field, t*(cmd._endValue - cmd._startValue) + cmd._startValue);\n\n\t\tif (t != 1.0)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time += cmd._duration;\n\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/rand.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rinn } from 'rinn';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._duration = Rinn.typeOf(cmd.duration) === 'string' ? anim.getValue(cmd.duration) : cmd.duration;\n\t\t\tcmd._last = null;\n\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet t = 1.0;\n\n\t\tif (anim.time < block.time + cmd._duration)\n\t\t\tt = (anim.time - block.time) / cmd._duration;\n\n\t\tif (cmd.easing && t != 1.0)\n\t\t\tcmd._cur = int(cmd.easing(t)*cmd.count);\n\t\telse\n\t\t\tcmd._cur = int(t*cmd.count);\n\n\t\tif (cmd._cur != cmd._last)\n\t\t{\n\t\t\tlet val = anim.getValue(cmd.field);\n\n\t\t\twhile (true) {\n\t\t\t\tlet i = int(Math.random()*(cmd.endValue - cmd.startValue + 1)) + cmd.startValue;\n\t\t\t\tif (i != val) break;\n\t\t\t}\n\n\t\t\tanim.setValue(cmd.field, i);\n\t\t\tcmd._last = cmd._cur;\n\t\t}\n\n\t\tif (t != 1.0)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time += cmd._duration;\n\n\t\treturn true;\n\t}\n};\n","/*\n**\tfroxel/anim/randt.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rinn } from 'rinn';\n\nexport default\n{\n\tinit: function(cmd, postinit=false)\n\t{\n\t\tif (!postinit) return;\n\n\t\tlet table = [ ];\n\n\t\tfor (let i = 0; i < cmd.count; i++)\n\t\t\ttable.push ((i % (cmd.endValue - cmd.startValue + 1)) + cmd.startValue);\n\n\t\tfor (let i = cmd.count >> 2; i > 0; i--)\n\t\t{\n\t\t\tlet a = int(Math.random() * cmd.count);\n\t\t\tlet b = int(Math.random() * cmd.count);\n\n\t\t\tlet c = table[b];\n\t\t\ttable[b] = table[a];\n\t\t\ttable[a] = c;\n\t\t}\n\n\t\tcmd.table = table;\n\t},\n\n\tupdate: function(anim, block, cmd)\n\t{\n\t\tif (cmd.started === false)\n\t\t{\n\t\t\tcmd._duration = Rinn.typeOf(cmd.duration) === 'string' ? anim.getValue(cmd.duration) : cmd.duration;\n\t\t\tcmd.started = true;\n\t\t}\n\n\t\tlet t = 1.0;\n\t\tlet i;\n\n\t\tif (anim.time < block.time + cmd._duration)\n\t\t\tt = (anim.time - block.time) / cmd._duration;\n\n\t\tif (cmd.easing && t != 1.0)\n\t\t\ti = cmd.easing(t)*(cmd.count-1);\n\t\telse\n\t\t\ti = t*(cmd.count-1);\n\n\t\tanim.setValue(cmd.field, cmd.table[int((i + cmd.count) % cmd.count)]);\n\n\t\tif (t != 1.0)\n\t\t\treturn false;\n\n\t\tcmd.started = false;\n\t\tblock.time += cmd._duration;\n\n\t\treturn true;\n\t}\n};\n","/*\n**\tflow/grid-element.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Bounds2 from '../math/bounds2.js';\nimport Handler from '../utils/handler.js';\n\n//![import \"../math/bounds2\"]\n//![import \"../utils/handler\"]\n\n//:/**\n//: * \tDescribes an element that can be added to a grid.\n//: */\n\n//!class GridElement\n\nconst GridElement = Class.extend\n({\n\t/*\n\t**\tName of the class (for inheritance purposes).\n\t*/\n\tclassName: 'GridElement',\n\n\t/**\n\t * \tIdentifier of the element (string).\n\t * \t!id: string;\n\t */\n\tid: null,\n\n\t/**\n\t * \tBounds of the element.\n\t * \t!bounds: Bounds2;\n\t */\n\tbounds: null,\n\n\t/**\n\t * \tFlags of the element (see constants of this class).\n\t * \t!flags: number;\n\t */\n\tflags: 0,\n\n\t/**\n\t * \tGeneric data of the element, used to store some value or object.\n\t * \t!data: object;\n\t */\n\tdata: null,\n\n\t/**\n\t * \tExtension object of the element, can be used to implement specific functionality.\n\t * \t!ext: object;\n\t */\n\text: null,\n\n\t/**\n\t * \tThe container where the element is stored.\n\t */\n\tcontainer: null,\n\n\t/**\n\t * \tRemoval callback node added by Grid.\n\t */\n\t_grid_remove_node: null,\n\n\t/**\n\t * \tRemover runs when the `remove` method of the element is called or when the element is destroyed.\n\t */\n\tremover: null,\n\n\t/**\n\t * \tConstructs the instance at the specified position and with the specified size.\n\t * \t!constructor (x: number, y: number, width: number, height: number);\n\t */\n\t__ctor: function (x, y, width, height)\n\t{\n\t\tthis.bounds = Bounds2.Pool.alloc();\n\n\t\tthis.bounds.translate (x, y);\n\t\tthis.bounds.resize (width, height, true);\n\n\t\tthis.flags = GridElement.ALIVE | GridElement.VISIBLE | GridElement.DIRTY | GridElement.DEPTH_FLAG;\n\t\tthis.data = null;\n\t\tthis.ext = null;\n\n\t\tthis.remover = Handler.Pool.alloc(this);\n\t},\n\n\t/**\n\t * \tRemoves the element from its container and destroys it.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.alive(false);\n\n\t\tif (this.data !== null)\n\t\t{\n\t\t\tdispose(this.data);\n\t\t\tthis.data = null;\n\t\t}\n\n\t\tthis.remover.exec();\n\t\tthis.remover.free();\n\n\t\tthis.bounds.free();\n\t},\n\n\t/**\n\t * \tSets the identifier of the element.\n\t * \t!setId (value: string) : GridElement;\n\t */\n\tsetId: function (value)\n\t{\n\t\tthis.id = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets bits of the element flags.\n\t * \t!setFlags (value: number) : GridElement;\n\t */\n\tsetFlags: function (value)\n\t{\n\t\tthis.flags |= value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tClears bits from the element flags.\n\t * \t!clearFlags (value: number) : GridElement;\n\t */\n\tclearFlags: function (value)\n\t{\n\t\tthis.flags &= ~value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns true if masking (bitwise AND) the flags by the specified flag bits results in the given value.\n\t * \t!getFlags (andMask: number, value?: number) : boolean;\n\t */\n\tgetFlags: function (andMask, value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn (this.flags & andMask) === andMask;\n\n\t\treturn (this.flags & andMask) === value;\n\t},\n\n\t/**\n\t * \tSets the generic data of the element. Will be disposed when the element is destroyed.\n\t * \t!setData (data: object) : GridElement;\n\t */\n\tsetData: function (data)\n\t{\n\t\tthis.data = data;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the generic data of the element.\n\t * \t!getData() : object;\n\t */\n\tgetData: function()\n\t{\n\t\treturn this.data;\n\t},\n\n\t/**\n\t * \tSets the extension object of the element. Calls to functions of this object should be done using the `exec` method.\n\t * \t!setExt (extensionObject: object) : GridElement;\n\t */\n\tsetExt: function (extensionObject)\n\t{\n\t\tthis.ext = extensionObject;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the extension object of the element.\n\t * \t!getExt() : object;\n\t */\n\tgetExt: function()\n\t{\n\t\treturn this.ext;\n\t},\n\n\t/**\n\t * Executes a function of the extension object.\n\t * @param {string} name\n\t * !exec (name: string, ...args: any) : any;\n\t */\n\texec: function(name, arg0=null, arg1=null, arg2=null, arg3=null, arg4=null, arg5=null, arg6=null, arg7=null, arg8=null, arg9=null)\n\t{\n\t\tif (this.ext === null || !this.ext.hasOwnProperty(name))\n\t\t\treturn false;\n\n\t\treturn this.ext[name] (this, arg0, arg1, arg2, arg3, arg4, arg5, arg6, arg7, arg8, arg9);\n\t},\n\n\t/**\n\t * Sets the visible flag.\n\t * @param {boolean} value - New visibility value.\n\t * @param {boolean} forced - When `true` forces to ignore the VISIBLE_LOCK flag.\n\t * !visible (value: boolean, forced: boolean=false) : GridElement;\n\t */\n\t/**\n\t * Returns the visible flag.\n\t * !visible() : boolean;\n\t */\n\tvisible: function (value=null, forced=false)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.VISIBLE);\n\n\t\tif (!forced && this.flags & GridElement.VISIBLE_LOCK)\n\t\t\treturn this;\n\n\t\tthis.flags &= ~GridElement.VISIBLE;\n\t\tif (value) this.flags |= GridElement.VISIBLE;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the visible-lock flag.\n\t * \t!visibleLock (value: boolean) : GridElement;\n\t */\n\t/**\n\t * \tReturns the visible-lock flag.\n\t * \t!visibleLock() : boolean;\n\t */\n\tvisibleLock: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.VISIBLE_LOCK);\n\n\t\tthis.flags &= ~GridElement.VISIBLE_LOCK;\n\t\tif (value) this.flags |= GridElement.VISIBLE_LOCK;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the alive flag.\n\t * \t!alive (value: boolean) : GridElement;\n\t */\n\t/**\n\t * \tReturns the alive flag.\n\t * \t!alive() : boolean;\n\t */\n\talive: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.ALIVE);\n\n\t\tthis.flags &= ~GridElement.ALIVE;\n\t\tif (value) this.flags |= GridElement.ALIVE;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the dirty flag.\n\t * \t!alive (value: boolean) : GridElement;\n\t */\n\t/**\n\t * \tReturns the dirty flag.\n\t * \t!alive() : boolean;\n\t */\n\tdirty: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.DIRTY);\n\n\t\tthis.flags &= ~GridElement.DIRTY;\n\t\tif (value) this.flags |= GridElement.DIRTY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the depth-flag-enabled flag.\n\t * \t!depthFlagEnabled (value: boolean) : GridElement;\n\t */\n\t/**\n\t * \tReturns the depth-flag-enabled flag.\n\t * \t!depthFlagEnabled() : boolean;\n\t */\n\tdepthFlagEnabled: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.DEPTH_FLAG_ENABLED);\n\n\t\tthis.flags &= ~GridElement.DEPTH_FLAG_ENABLED;\n\t\tif (value) this.flags |= GridElement.DEPTH_FLAG_ENABLED;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the depth-flag flag. To actually use the depth-test, you have to enable the depth-flag using `depthFlagEnabled`.\n\t * \t!depthFlagEnabled (value: boolean) : GridElement;\n\t */\n\t/**\n\t * \tReturns the depth-flag flag.\n\t * \t!depthFlagEnabled() : boolean;\n\t */\n\tdepthFlag: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & GridElement.DEPTH_FLAG);\n\n\t\tthis.flags &= ~GridElement.DEPTH_FLAG;\n\t\tif (value) this.flags |= GridElement.DEPTH_FLAG;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tRemoves the element from the container and returns itself.\n\t * \t!remove() : GridElement;\n\t */\n\tremove: function()\n\t{\n\t\tthis.remover.exec();\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSyncs the actual location of the specified element with its storage location (if alive and dirty).\n\t * \t!sync() : GridElement;\n\t */\n\tsync: function()\n\t{\n\t\tif (this.container === null || !this.getFlags(GridElement.ALIVE | GridElement.DIRTY))\n\t\t\treturn this;\n\n\t\tthis.container.sync(this);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the width and height of the element.\n\t * \t!resize (width: number, height: number) : GridElement;\n\t */\n\tresize: function (width, height)\n\t{\n\t\tthis.flags |= GridElement.DIRTY;\n\t\tthis.bounds.resize (width ?? this.bounds.width(), height ?? this.bounds.height(), true);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResizes the element by the specified deltas.\n\t * \t!resizeBy (deltaWidth: number, deltaHeight: number) : GridElement;\n\t */\n\tresizeBy: function (dWidth, dHeight)\n\t{\n\t\treturn this.resize(this.bounds.width() + dWidth, this.bounds.height() + dHeight);\n\t},\n\n\t/**\n\t * \tMoves the element by the specified deltas.\n\t * \t@param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * \t!translate (dx: number, dy: number, upscaled?: boolean) : GridElement;\n\t */\n\ttranslate: function (dx, dy, upscaled=false)\n\t{\n\t\tthis.flags |= GridElement.DIRTY;\n\t\tthis.bounds.translate (dx, dy, upscaled);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the position of the element. Any parameter set to `null` will cause it not to be changed.\n\t * \t!setPosition (x: number, y: number) : GridElement;\n\t */\n\t/**\n\t * \tSets the position of the element. Any parameter set to `null` will cause it not to be changed.\n\t * \t!setPosition (pointer: {x:number, y:number}) : GridElement;\n\t */\n\tsetPosition: function (x, y=false)\n\t{\n\t\tif (y === false) {\n\t\t\ty = x.y;\n\t\t\tx = x.x;\n\t\t}\n\n\t\treturn this.translate (x !== null ? upscale(x)-this.bounds.ux1 : 0, y !== null ? upscale(y)-this.bounds.uy1 : 0, true);\n\t}\n});\n\n/*\n**\tGrid element flags.\n*/\nGridElement.ALIVE \t\t\t\t= \t0x0001;\nGridElement.VISIBLE \t\t\t= \t0x0002;\nGridElement.VISIBLE_LOCK \t\t= \t0x0004;\nGridElement.DIRTY \t\t\t\t= \t0x0008;\nGridElement.DEPTH_FLAG_ENABLED\t= \t0x0010;\nGridElement.DEPTH_FLAG\t\t\t= \t0x0020;\n\nGridElement.USERDEF\t\t=\t0x0100; /* Bits 8 to 30 : 23 flags  */\nGridElement.LAST_FLAG\t=\t0x0080;\n\n/**\n * \tClass-level function to allocate a new flag.\n * \t!static allocFlag() : number;\n */\nGridElement.allocFlag = function()\n{\n\tlet flag = GridElement.LAST_FLAG;\n\tif (flag === 0x4000_0000) throw new Error ('allocFlag: out of bit space to allocate another flag');\n\n\tflag <<= 1;\n\tGridElement.LAST_FLAG = flag;\n\n\treturn flag;\n};\n\nexport default GridElement;\n","/*\n**\tflow/grid.js\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport GridElement from './grid-element.js';\nimport List from '../utils/list.js';\n\n//![import \"./grid-element\"]\n//![import \"../utils/list\"]\n\n//:/**\n//: * \tDescribes an optimized data structure to store 2D spatially indexed elements.\n//: */\n\n//!class Grid\n\nconst Grid = Class.extend\n({\n\t/**\n\t * \tName of the class (for inheritance purposes).\n\t */\n\tclassName: 'Grid',\n\n\t/**\n\t * \tActual grid of data, stored linearly. Contains several entries each of which can be either null or a List containing grid elements.\n\t */\n\tgrid: null,\n\n\t/**\n\t * \tNumber of elements active in the grid.\n\t * \t!readonly count: number;\n\t */\n\tcount: 0,\n\n\t/**\n\t * \tThe X and Y offsets to be added to all input coordinates. Used to ensure that a negative coordinate always ends up positive, calculated\n\t * \tusing the width and height of the grid.\n\t */\n\toffsx: 0, offsy: 0,\n\n\t/**\n\t * \tDivisors for the X and Y coordinates respectively. All input coordinates (after offseting) will be divided by these values to map them\n\t * \tto a grid entry (list) where the element can be added.\n\t */\n\tkx: 0, ky: 0,\n\n\t/**\n\t * \tStride to calculate an index with a Y-coordinate.\n\t */\n\tstride: 0,\n\n\t/**\n\t * \tIndicates if the grid should match regions with exact precision by comparing region to element bounds intersection.\n\t * \t!verifyIntersection: boolean;\n\t */\n\tverifyIntersection: true,\n\n\t/**\n\t * \tConstructs a grid with the specified maximum width and height. The final effective coordinate range will be -(width/2) to (width/2)for X,\n\t * \tand -(height/2) to (height/2) for Y.\n\t * \n\t * \tNote that the width, height and divisors kx and ky will be converted to their closest base-2 value. This is done to ensure shifts can be used\n\t * \tto quickly divide the input coordinates.\n\t * \n\t * \t!constructor (width: number, height: number, kx: number, ky?: number);\n\t */\n\t__ctor: function (width, height, kx, ky=null)\n\t{\n\t\twidth = 1 << Math.ceil(Math.log2(width));\n\t\theight = 1 << Math.ceil(Math.log2(height));\n\n\t\tthis.offsx = width >> 1;\n\t\tthis.offsy = height >> 1;\n\n\t\tif (ky === null)\n\t\t\tky = kx;\n\n\t\tkx = Math.floor(Math.log2(kx));\n\t\tky = Math.floor(Math.log2(ky));\n\n\t\tthis.kx = kx;\n\t\tthis.ky = ky;\n\n\t\tlet w = width >> kx;\n\t\tlet h = height >> ky;\n\n\t\tif (!w) {\n\t\t\tkx = Math.log2(width);\n\t\t\tw = 1;\n\t\t}\n\n\t\tif (!h) {\n\t\t\tky = Math.log2(height);\n\t\t\th = 1;\n\t\t}\n\n\t\tthis.grid = new Array(w*h).fill(null);\n\t\tthis.stride = w;\n\t},\n\n\t/**\n\t * \tDestroys all lists and elements in the grid.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis.grid = null;\n\t},\n\n\t/**\n\t * \tDestroys all lists and elements in the grid.\n\t * \t!clear() : void;\n\t */\n\tclear: function()\n\t{\n\t\tfor (let i = 0; i < this.grid.length; i++)\n\t\t{\n\t\t\tif (this.grid[i] === null)\n\t\t\t\tcontinue;\n\n\t\t\tlet j;\n\n\t\t\twhile ((j = this.grid[i].shift()) !== null)\n\t\t\t{\n\t\t\t\tj.remover.remove(this._remove, this);\n\t\t\t\tj.container = null;\n\n\t\t\t\tdispose(j);\n\t\t\t}\n\n\t\t\tthis.grid[i].free();\n\t\t\tthis.grid[i] = null;\n\t\t}\n\n\t\tthis.count = 0;\n\t},\n\n\t/**\n\t * \tDestroys all lists in the grid. Elements will not be destroyed.\n\t * \t!reset() : void;\n\t */\n\treset: function()\n\t{\n\t\tfor (let i = 0; i < this.grid.length; i++)\n\t\t{\n\t\t\tif (this.grid[i] === null)\n\t\t\t\tcontinue;\n\n\t\t\tlet j;\n\n\t\t\twhile ((j = this.grid[i].shift()) !== null)\n\t\t\t{\n\t\t\t\tj.remover.remove(this._remove, this);\n\t\t\t\tj.container = null;\n\t\t\t}\n\n\t\t\tthis.grid[i].free();\n\t\t\tthis.grid[i] = null;\n\t\t}\n\n\t\tthis.count = 0;\n\t},\n\n\t/**\n\t * \tAdds an element to the grid. Returns `true` if successful, or `false` if the element is outside of the grid bounds.\n\t * \t!add (elem: GridElement) : boolean;\n\t */\n\tadd: function (elem)\n\t{\n\t\tif (!GridElement.isInstance(elem))\n\t\t\tthrow new Error ('argument must be a GridElement');\n\n\t\tlet i = int((elem.bounds.y1+this.offsy) >> this.ky) * this.stride + int((elem.bounds.x1+this.offsx) >> this.kx);\n\t\tif (i < 0 || i >= this.grid.length) return false;\n\n\t\tif (this.grid[i] === null)\n\t\t\tthis.grid[i] = List.Pool.alloc();\n\n\t\tthis.grid[i].push(elem);\n\t\tthis.count++;\n\n\t\telem.container = this;\n\t\telem._grid_remove_node = elem.remover.add(this._remove, this, i, this.grid[i].bottom);\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tCallback to remove an element from the grid (called by Handler).\n\t */\n\t_remove: function (elem, self, index, node)\n\t{\n\t\tself.grid[index].remove(node);\n\t\tself.count--;\n\n\t\telem.container = null;\n\t\treturn false;\n\t},\n\n\t/**\n\t * \tRemoves the element from the grid and returns it.\n\t * \t!remove (elem: GridElement) : GridElement;\n\t */\n\tremove: function (elem)\n\t{\n\t\telem.remover.execc(this._grid_remove_node);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tUpdates the storage location of the specified element. Returns `true` if successful, or `false` if the element is outside of the grid bounds (in\n\t * \twhich case the element will be removed), or if the element does not belong to this grid.\n\t * \t!sync (elem: GridElement) : boolean;\n\t */\n\tsync: function (elem)\n\t{\n\t\telem.clearFlags(GridElement.DIRTY);\n\n\t\tlet node = elem._grid_remove_node;\n\n\t\tlet i = int((elem.bounds.y1+this.offsy) >> this.ky) * this.stride + int((elem.bounds.x1+this.offsx) >> this.kx);\n\t\tif (i < 0 || i >= this.grid.length)\n\t\t{\n\t\t\telem.remover.execc(node);\n\t\t\treturn false;\n\t\t}\n\n\t\tif (node.arg1 === i)\n\t\t\treturn true;\n\n\t\tthis.grid[node.arg1].remove(node.arg2);\n\n\t\tif (this.grid[i] === null)\n\t\t\tthis.grid[i] = List.Pool.alloc();\n\n\t\tthis.grid[i].push(elem);\n\n\t\tnode.arg1 = i;\n\t\tnode.arg2 = this.grid[i].bottom;\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tExecutes the specified callback function for each element that intersects the given bounds and has the specified flags set. The process is immediately\n\t * \tstopped if the callback returns `false`.\n\t * \t!forEachInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number, callback: (elem: GridElement, context?: object) => boolean, context?: object) : void;\n\t */\n\tforEachInRegion: function (bounds, flagsAndMask, flagsValue, callback, context)\n\t{\n\t\tlet j0 = ((bounds.y1+this.offsy) - (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet j1 = ((bounds.y2+this.offsy) + (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet i0 = ((bounds.x1+this.offsx) - (1<<this.kx-1) >> this.kx);\n\t\tlet i1 = ((bounds.x2+this.offsx) + (1<<this.kx-1) >> this.kx);\n\n\t\tlet n = this.grid.length-1;\n\n\t\tif (j0 < 0) j0 = 0; if (j1 < 0) j1 = 0;\n\t\tif (i0 < 0) i0 = 0; if (i1 < 0) i1 = 0;\n\t\tif (j0 > n) j0 = n; if (j1 > n) j1 = n;\n\t\tif (i0 > n) i0 = n; if (i1 > n) i1 = n;\n\n\t\tfor (let j = j0; j <= j1; j += this.stride)\n\t\t{\n\t\t\tfor (let i = i0; i <= i1; i++)\n\t\t\t{\n\t\t\t\tlet k = j + i;\n\t\t\t\tif (k > n || this.grid[k] === null) continue;\n\n\t\t\t\tfor (let e = this.grid[k].top; e; e = e.next)\n\t\t\t\t{\n\t\t\t\t\t// First check the element flags.\n\t\t\t\t\tif (!e.value.getFlags(flagsAndMask, flagsValue)) continue;\n\n\t\t\t\t\t// Verify exact intersection only on elements located on the edges of the indexed-based approximated rectangle.\n\t\t\t\t\tif (this.verifyIntersection && (j <= j0+1 || i <= i0+1 || j >= j1-1 || i >= i1-1) && !e.value.bounds.intersects(bounds))\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tif (callback(e.value, context) === false)\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * \tCollects all elements that intersect the given bounds and have the specified flags set. Returns a new List, remember to call `free` after using it.\n\t * \t!selectInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : List;\n\t */\n\tselectInRegion: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\tlet j0 = ((bounds.y1+this.offsy) - (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet j1 = ((bounds.y2+this.offsy) + (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet i0 = ((bounds.x1+this.offsx) - (1<<this.kx-1) >> this.kx);\n\t\tlet i1 = ((bounds.x2+this.offsx) + (1<<this.kx-1) >> this.kx);\n\n\t\tlet n = this.grid.length-1;\n\n\t\tif (j0 < 0) j0 = 0; if (j1 < 0) j1 = 0;\n\t\tif (i0 < 0) i0 = 0; if (i1 < 0) i1 = 0;\n\t\tif (j0 > n) j0 = n; if (j1 > n) j1 = n;\n\t\tif (i0 > n) i0 = n; if (i1 > n) i1 = n;\n\n\t\tlet list = List.Pool.alloc();\n\n\t\tfor (let j = j0; j <= j1; j += this.stride)\n\t\t{\n\t\t\tfor (let i = i0; i <= i1; i++)\n\t\t\t{\n\t\t\t\tlet k = j + i;\n\t\t\t\tif (k > n || this.grid[k] === null) continue;\n\n\t\t\t\tfor (let e = this.grid[k].top; e; e = e.next)\n\t\t\t\t{\n\t\t\t\t\t// First check the element flags.\n\t\t\t\t\tif (!e.value.getFlags(flagsAndMask, flagsValue)) continue;\n\n\t\t\t\t\t// Verify exact intersection only on elements located on the edges of the indexed-based approximated rectangle.\n\t\t\t\t\tif (this.verifyIntersection && (j <= j0+1 || i <= i0+1 || j >= j1-1 || i >= i1-1) && !e.value.bounds.intersects(bounds))\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tlist.push(e.value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn list;\n\t},\n\n\t/**\n\t * \tCounts all elements that intersect the given bounds and have the specified flags set.\n\t * \t!countInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : number;\n\t */\n\tcountInRegion: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\tlet j0 = ((bounds.y1+this.offsy) - (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet j1 = ((bounds.y2+this.offsy) + (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet i0 = ((bounds.x1+this.offsx) - (1<<this.kx-1) >> this.kx);\n\t\tlet i1 = ((bounds.x2+this.offsx) + (1<<this.kx-1) >> this.kx);\n\n\t\tlet n = this.grid.length-1;\n\n\t\tif (j0 < 0) j0 = 0; if (j1 < 0) j1 = 0;\n\t\tif (i0 < 0) i0 = 0; if (i1 < 0) i1 = 0;\n\t\tif (j0 > n) j0 = n; if (j1 > n) j1 = n;\n\t\tif (i0 > n) i0 = n; if (i1 > n) i1 = n;\n\n\t\tlet m = 0;\n\n\t\tfor (let j = j0; j <= j1; j += this.stride)\n\t\t{\n\t\t\tfor (let i = i0; i <= i1; i++)\n\t\t\t{\n\t\t\t\tlet k = j + i;\n\t\t\t\tif (k > n || this.grid[k] === null) continue;\n\n\t\t\t\tfor (let e = this.grid[k].top; e; e = e.next)\n\t\t\t\t{\n\t\t\t\t\t// First check the element flags.\n\t\t\t\t\tif (!e.value.getFlags(flagsAndMask, flagsValue)) continue;\n\n\t\t\t\t\t// Verify exact intersection only on elements located on the edges of the indexed-based approximated rectangle.\n\t\t\t\t\tif (this.verifyIntersection && (j <= j0+1 || i <= i0+1 || j >= j1-1 || i >= i1-1) && !e.value.bounds.intersects(bounds))\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tm++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn m;\n\t},\n\n\t/**\n\t * \tReturns the first element that intersect the given bounds and have the specified flags set.\n\t * \t!selectFirst (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : GridElement;\n\t */\n\tselectFirst: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\tlet j0 = ((bounds.y1+this.offsy) - (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet j1 = ((bounds.y2+this.offsy) + (1<<this.ky-1) >> this.ky) * this.stride;\n\t\tlet i0 = ((bounds.x1+this.offsx) - (1<<this.kx-1) >> this.kx);\n\t\tlet i1 = ((bounds.x2+this.offsx) + (1<<this.kx-1) >> this.kx);\n\n\t\tlet n = this.grid.length-1;\n\n\t\tif (j0 < 0) j0 = 0; if (j1 < 0) j1 = 0;\n\t\tif (i0 < 0) i0 = 0; if (i1 < 0) i1 = 0;\n\t\tif (j0 > n) j0 = n; if (j1 > n) j1 = n;\n\t\tif (i0 > n) i0 = n; if (i1 > n) i1 = n;\n\n\t\tfor (let j = j0; j <= j1; j += this.stride)\n\t\t{\n\t\t\tfor (let i = i0; i <= i1; i++)\n\t\t\t{\n\t\t\t\tlet k = j + i;\n\t\t\t\tif (k > n || this.grid[k] === null) continue;\n\n\t\t\t\tfor (let e = this.grid[k].top; e; e = e.next)\n\t\t\t\t{\n\t\t\t\t\t// First check the element flags.\n\t\t\t\t\tif (!e.value.getFlags(flagsAndMask, flagsValue)) continue;\n\n\t\t\t\t\t// Verify exact intersection only on elements located on the edges of the indexed-based approximated rectangle.\n\t\t\t\t\tif (this.verifyIntersection && (j <= j0+1 || i <= i0+1 || j >= j1-1 || i >= i1-1) && !e.value.bounds.intersects(bounds))\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\treturn e.value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n});\n\nexport default Grid;\n","/*\n**\tflow/scene.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Container from './container.js';\nimport Viewport from './viewport.js';\nimport Group from './group.js';\nimport Bounds2 from '../math/bounds2.js';\nimport List from '../utils/list.js';\nimport Handler from '../utils/handler.js';\nimport globals from '../system/globals.js';\n\n//![import \"./container\"]\n//![import \"./viewport\"]\n//![import \"./group\"]\n//![import \"../math/bounds2\"]\n//![import \"../utils/list\"]\n//![import \"../utils/handler\"]\n//![import \"../system/globals\"]\n\n//:/**\n//: * \tA scene is a set of containers, viewports and groups. Rendering is done in their specific index-based order.\n//: */\n\n//!class Scene\n\nconst Scene = Class.extend\n({\n\tclassName: 'Scene',\n\n\t/**\n\t * \tMinimum dimensions of the scene (smallest container size).\n\t * \t!readonly minWidth: number;\n\t * \t!readonly minHeight: number;\n\t */\n\tminWidth: null,\n\tminHeight: null,\n\n\t/**\n\t * \tMaximum dimensions of the scene (largest container size).\n\t * \t!readonly maxWidth: number;\n\t * \t!readonly maxHeight: number;\n\t */\n\tmaxWidth: null,\n\tmaxHeight: null,\n\n\t/**\n\t * \tList of containers.\n\t */\n\tcontainers: null,\n\n\t/**\n\t * \tList of viewports.\n\t */\n\tviewports: null,\n\n\t/**\n\t * \tActive viewport bounds, used to select items in a visible region.\n\t * \t!readonly viewportBounds: Bounds2;\n\t */\n\tviewportBounds: null,\n\n\t/**\n\t * \tList of Group elements.\n\t */\n\tgroupList: null,\n\n\t/**\n\t * \tNamed Group elements.\n\t */\n\tgroups: null,\n\n\t/**\n\t * \tDisposal queue.\n\t */\n\tdisposalQueue: null,\n\n\t/**\n\t * \tFirst updater. Runs before any other update calls.\n\t * \t!readonly fupdater: Handler;\n\t */\n\tfupdater: null,\n\n\t/**\n\t * \tGeneral updater. Runs after the first updater and before synchronizer.\n\t * \t!readonly updater: Handler;\n\t */\n\tupdater: null,\n\n\t/**\n\t * \tSynchronizer. Run after general updater, and before viewport synchronization.\n\t * \t!readonly synchronizer: Handler;\n\t */\n\tsynchronizer: null,\n\n\t/**\n\t * \tLast updater. Runs after all other update calls.\n\t * \t!readonly lupdater: Handler;\n\t */\n\tlupdater: null,\n\n\t/**\n\t * \tDestroyer runs when the scene is destroyed.\n\t * \t!readonly destroyer: Handler;\n\t */\n\tdestroyer: null,\n\n\t/**\n\t * \tCurrent delta time. Set upon entering the `update` method. Reflects the same value as System.frameDelta.\n\t * \t!readonly dt: number;\n\t */\n\tdt: 0,\n\n\t/**\n\t * \tFlags of the object (see constants at the bottom of this file).\n\t */\n\tflags: 0,\n\n\t/**\n\t * \tTotal number of elements drawn on the last draw operation.\n\t * \t!readonly drawCount: number;\n\t */\n\tdrawCount: 0,\n\n\t/**\n\t * \tScene object pointing to itself.\n\t */\n\tscene: null,\n\n\t/**\n\t * \tBase depth (z-value) of the scene.\n\t * \t!readonly zvalue: number;\n\t */\n\tzvalue: null,\n\n\t/**\n\t * \tConstructs an empty scene with the specified index.\n\t * \t@param index - Index for the scene. Used to calculate the base z-value of the scene. Valid range is from 0 to 3.\n\t * \t!constructor (index: number);\n\t */\n\t__ctor: function(index)\n\t{\n\t\tthis.containers = [];\n\n\t\t/**\n\t\t * \tZ-value is a 24-bit value constructed as:\n\t\t *\t\t2-bits: Scene Index\n\t\t *\t\t4-bits: Container Index\n\t\t *\t\t18-bits: Element z-value\n\t\t */\n\t\tthis.zvalue = (index & 3) << (18+4);\n\n\t\tthis.viewports = [];\n\t\tthis.viewportBounds = Bounds2.Pool.alloc();\n\n\t\tthis.groupList = List.Pool.alloc();\n\t\tthis.groups = { };\n\n\t\tthis.disposalQueue = List.Pool.alloc();\n\n\t\tthis.fupdater = Handler.Pool.alloc(this);\n\t\tthis.updater = Handler.Pool.alloc(this);\n\t\tthis.synchronizer = Handler.Pool.alloc(this);\n\t\tthis.lupdater = Handler.Pool.alloc(this);\n\t\tthis.destroyer = Handler.Pool.alloc(this);\n\n\t\tthis.flags = Scene.VISIBLE;\n\t\tthis.scene = this;\n\t},\n\n\t/**\n\t * \tDestroys the instance along with all containers, viewports and groups.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.disposeQueued();\n\t\tthis.disposalQueue.free();\n\n\t\tthis.destroyer.exec();\n\t\tthis.destroyer.free();\n\n\t\tthis.fupdater.free();\n\t\tthis.updater.free();\n\t\tthis.synchronizer.free();\n\t\tthis.lupdater.free();\n\n\t\tlet i;\n\n\t\twhile ((i = this.groupList.shift()) !== null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.container = null;\n\t\t\tdispose(i);\n\t\t}\n\n\t\tfor (i = 0; i < this.containers.length; i++)\n\t\t{\n\t\t\tif (!this.containers[i]) continue;\n\n\t\t\tthis.containers[i].scene = null;\n\t\t\tdispose(this.containers[i]);\n\n\t\t\tthis.containers[i] = null;\n\t\t}\n\n\t\tfor (i = 0; i < this.viewports.length; i++)\n\t\t{\n\t\t\tif (!this.viewports[i]) continue;\n\n\t\t\tdispose(this.viewports[i]);\n\t\t\tthis.viewports[i] = null;\n\t\t}\n\n\t\tthis.viewportBounds.free();\n\t\tthis.groupList.free();\n\t},\n\n\t/**\n\t * \tClears the scene leaving only viewports.\n\t * \t!clear() : void;\n\t */\n\tclear: function()\n\t{\n\t\tthis.disposeQueued();\n\n\t\tlet i;\n\n\t\twhile ((i = this.groupList.shift()) !== null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.container = null;\n\t\t\tdispose(i);\n\t\t}\n\n\t\tfor (i = 0; i < this.containers.length; i++)\n\t\t{\n\t\t\tif (this.containers[i])\n\t\t\t\tthis.containers[i].clear();\n\t\t}\n\t},\n\n\t/**\n\t * \tReturns the value of the `visible` flag.\n\t * \t!visible() : boolean;\n\t */\n\t/**\n\t * \tSets the value of the `visible` flag.\n\t * \t!visible(value: boolean) : Container;\n\t */\n\tvisible: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Scene.VISIBLE);\n\n\t\tthis.flags &= ~Scene.VISIBLE;\n\t\tif (value) this.flags |= Scene.VISIBLE;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets a container at the specified index.\n\t * \t@param index - Index of the container, valid range is from 0 to 15.\n\t * \t!setContainer (index: number, container: Container) : Scene;\n\t */\n\tsetContainer: function (index, container)\n\t{\n\t\tif (index < 0) return this;\n\t\tindex &= 15;\n\n\t\tif (container === null)\n\t\t{\n\t\t\tthis.containers[index].scene = null;\n\t\t\tthis.containers[index] = null;\n\t\t\treturn this;\n\t\t}\n\n\t\tif (!Container.isInstance(container))\n\t\t\tthrow new Error('Scene: Unable to set container at index ' + index + ': argument is not a Container');\n\n\t\tif (this.minWidth === null || container.width < this.minWidth) this.minWidth = container.width;\n\t\tif (this.minHeight === null || container.height < this.minHeight) this.minHeight = container.height;\n\t\tif (this.maxWidth === null || container.width > this.maxWidth) this.maxWidth = container.width;\n\t\tif (this.maxHeight === null || container.height > this.maxHeight) this.maxHeight = container.height;\n\n\t\tcontainer.scene = this;\n\t\tcontainer.zvalue = this.zvalue + (index << 18);\n\n\t\tthis.containers[index] = container;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the container at the specified index.\n\t * \t!getContainer (index: number) : Container;\n\t */\n\tgetContainer: function (index)\n\t{\n\t\treturn index < 0 || index >= this.containers.length ? null : this.containers[index];\n\t},\n\n\t/**\n\t * \tSets a viewport at the specified index.\n\t * \t!setViewport (index: number, viewport: Viewport) : Scene;\n\t */\n\tsetViewport: function (index, viewport)\n\t{\n\t\tif (index < 0) return this;\n\n\t\tif (viewport !== null && !Viewport.isInstance(viewport))\n\t\t\tthrow new Error('Scene: Unable to set viewport at index ' + index + ': argument is not a Viewport.');\n\n\t\tthis.viewports[index] = viewport;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the viewport at the specified index.\n\t * \t!getViewport (index: number) : Viewport;\n\t */\n\tgetViewport: function (index)\n\t{\n\t\treturn index < 0 || index >= this.viewports.length ? null : this.viewports[index];\n\t},\n\n\t/**\n\t * \tAdds the given element to the disposal queue. To be destroyed on the next call to `disposeQueued`.\n\t * \t!disposeLater (elem: Element) : void;\n\t */\n\tdisposeLater: function (elem)\n\t{\n\t\tif (!elem.alive()) return;\n\n\t\tthis.disposalQueue.push(elem);\n\t\telem.alive(false);\n\t},\n\n\t/**\n\t * \tDisposes all elements in the disposal queue.\n\t * \t!disposeQueued() : void;\n\t */\n\tdisposeQueued: function ()\n\t{\n\t\tlet elem;\n\n\t\twhile ((elem = this.disposalQueue.shift()) !== null)\n\t\t\tdispose(elem);\n\t},\n\n\t/**\n\t * \tAdds a group to the scene.\n\t * \t!addGroup (group: Group) : boolean;\n\t */\n\taddGroup: function (group)\n\t{\n\t\tif (!Group.isInstance(group))\n\t\t\tthrow new Error ('argument must be a Group');\n\n\t\tthis.groupList.push(group);\n\n\t\tif (group.id !== null)\n\t\t\tthis.groups[group.id] = group;\n\n\t\tgroup.container = this;\n\t\tgroup.remover.add(this._removeGroup, this, this.groupList.bottom);\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tCallback to remove a group from the scene (called by Handler).\n\t */\n\t_removeGroup: function (group, self, node)\n\t{\n\t\tgroup.container = null;\n\t\tself.groupList.remove(node);\n\n\t\tif (group.id !== null)\n\t\t\tself.groups[group.id] = null;\n\n\t\treturn false;\n\t},\n\n\t/**\n\t * \tRemoves a group from the scene.\n\t * \t!removeGroup (group: Group) : Group;\n\t */\n\tremoveGroup: function (group)\n\t{\n\t\tgroup.remover.execf(this._remove, this);\n\t\treturn group;\n\t},\n\n\t/**\n\t * \tSyncs the actual location of the specified element with its storage location. Returns `true` if successful.\n\t * \t!sync (group: Group) : boolean;\n\t */\n\tsync: function (group)\n\t{\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tDraws the scene, by executing the `draw` method on each container. The entire scene will be drawn once for each viewport, and\n\t * \tthe visible region rules of each viewport will be applied.\n\t * \t!draw (g: Canvas) : void;\n\t */\n\tdraw: function (g)\n\t{\n\t\tif (!this.visible()) return;\n\n\t\tthis.drawCount = 0;\n\n\t\tif (!this.viewports.length)\n\t\t{\n\t\t\tthis.drawContainers(g, null);\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let viewportIndex = 0; viewportIndex < this.viewports.length; viewportIndex++)\n\t\t{\n\t\t\tlet viewport = this.viewports[viewportIndex];\n\t\t\tif (!viewport || !viewport.enabled()) continue;\n\n\t\t\tglobals.viewport = viewport;\n\n\t\t\tg.pushClip();\n\t\t\tg.pushMatrix();\n\n\t\t\tviewport.applyClip(g);\n\t\t\tviewport.applyTransform(g);\n\n\t\t\tthis.viewportBounds.set(viewport.bounds);//.resizeBy(2, 2);\n\t\t\tthis.drawContainers(g, this.viewportBounds);\n\n\t\t\tg.popMatrix();\n\t\t\tg.popClip();\n\t\t}\n\t},\n\n\t/**\n\t * \tDraws the scene containers and passes the specified viewport bounds to the container.\n\t * \t!drawContainers (g: Canvas, viewportBounds: Bounds2) : void;\n\t */\n\tdrawContainers: function (g, viewportBounds)\n\t{\n\t\ttry\n\t\t{\n\t\t\tfor (let i = 0; i < this.containers.length; i++)\n\t\t\t{\n\t\t\t\tif (!this.containers[i])\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis.containers[i].setViewportBounds(viewportBounds);\n\t\t\t\tthis.containers[i].draw(g);\n\n\t\t\t\tthis.drawCount += this.containers[i].drawCount;\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tif (e.message !== 'FRAME_END') {\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * \tUpdates the scene viewports.\n\t */\n\tupdateViewports: function ()\n\t{\n\t\tfor (let i = 0; i < this.viewports.length; i++)\n\t\t{\n\t\t\tif (!this.viewports[i])\n\t\t\t\tcontinue;\n\n\t\t\tthis.viewports[i].update(this.dt);\n\t\t}\n\t},\n\n\t/**\n\t * \tRuns a scene update cycle.\n\t * \t!update (dt: number) : void;\n\t */\n\tupdate: function (dt)\n\t{\n\t\tthis.dt = dt;\n\t\tthis.fupdater.exec();\n\n\t\tthis.updater.exec();\n\t\tthis.disposeQueued();\n\t\tthis.synchronizer.exec();\n\t\tthis.updateViewports();\n\n\t\tthis.lupdater.exec();\n\t}\n});\n\n\n/**\n * \tConstants.\n */\nScene.VISIBLE = 0x001;\n\nexport default Scene;\n","/*\n**\tflow/container.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\n\n//:/**\n//: * \tA container is responsible to store elements for their subsequent rendering. The actual storage mechanism used can vary and must be implemented by derived\n//: * \tclasses (see `GridContainer` and `SimpleContainer`).\n//: */\n\n//!class Container\n\nconst Container = Class.extend\n({\n\tclassName: 'Container',\n\n\t/**\n\t * \tViewport bounds currently active. Set by the Scene class before calling `draw`.\n\t * \t!viewportBounds: Bounds2;\n\t */\n\tviewportBounds: null,\n\n\t/**\n\t * \tWidth of the container.\n\t * \t!width: number;\n\t */\n\twidth: 0,\n\n\t/**\n\t * \tHeight of the container.\n\t * \t!height: number;\n\t */\n\theight: 0,\n\n\t/**\n\t * \tDepth (z-value) of the container, calculated by the scene.\n\t * \t!zvalue: number;\n\t */\n\tzvalue: 0,\n\n\t/**\n\t * \tScene object to which this container belongs.\n\t * \t!scene: Scene;\n\t */\n\tscene: null,\n\n\t/**\n\t * \tFlags of the object (see constants at the bottom of this file).\n\t * \t!flags: number;\n\t */\n\tflags: 0,\n\n\t/**\n\t * \tCurrently active display buffer for rendering operations (used by drawElement).\n\t * \t!g: Canvas;\n\t */\n\tg: null,\n\n\t/**\n\t * \tTotal number of elements in the container.\n\t * \t!readonly elementCount: number;\n\t */\n\telementCount: 0,\n\n\t/**\n\t * \tTotal number of elements drawn on the last draw operation.\n\t * \t!readonly drawCount: number;\n\t */\n\tdrawCount: 0,\n\n\t/**\n\t * \tConstructs the container with the default size (32768 x 32768).\n\t * \tconstructor ();\n\t */\n\t/**\n\t * \tConstructs the container with the specified size.\n\t * \t!constructor (width: number, height: number);\n\t */\n\t__ctor: function (width=32768, height=32768)\n\t{\n\t\tthis.width = width;\n\t\tthis.height = height;\n\n\t\tthis.flags = Container.VISIBLE | Container.DEPTH_FLAG;\n\t},\n\n\t/**\n\t * \tDestroys the container.\n\t */\n\t__dtor: function()\n\t{\n\t},\n\n\t/**\n\t * \tReturns the value of the `visible` flag.\n\t * \t!visible() : boolean;\n\t */\n\t/**\n\t * \tSets the value of the `visible` flag.\n\t * \t!visible(value: boolean) : Container;\n\t */\n\tvisible: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Container.VISIBLE);\n\n\t\tthis.flags &= ~Container.VISIBLE;\n\t\tif (value) this.flags |= Container.VISIBLE;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the value of the `depthFlag` flag.\n\t * \t!depthFlag() : boolean;\n\t */\n\t/**\n\t * \tSets the value of the `depthFlag` flag.\n\t * \t!depthFlag(value: boolean) : Container;\n\t */\n\tdepthFlag: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Container.DEPTH_FLAG);\n\n\t\tthis.flags &= ~Container.DEPTH_FLAG;\n\t\tif (value) this.flags |= Container.DEPTH_FLAG;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the active viewport bounds.\n\t * \t!setViewportBounds (bounds: Bounds2) : Container;\n\t */\n\tsetViewportBounds: function (bounds)\n\t{\n\t\tthis.viewportBounds = bounds;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tDraws the specified element.\n\t * \t!drawElement (elem: Element, self: Container) : boolean;\n\t */\n\tdrawElement: function (elem, self)\n\t{\n\t\tself.drawCount++;\n\t\treturn elem.draw(self.g);\n\t},\n\n\t/**\n\t * \tUpdates the Z-value of the specified element. Should be called after adding an element and after/before every sync.\n\t * \t!syncZ (elem: Element) : void;\n\t */\n\tsyncZ: function (elem)\n\t{\n\t\telem.__zvalue = this.zvalue + ((elem._zvalue + elem.bounds.y2) & ((1 << 18) - 1));\n\t\t//elem.__zvalue = this.zvalue + (1 << 18) - ((elem._zvalue + elem.bounds.y2 + (1 << 18)) & ((1 << 18) - 1));\n\t},\n\n\t/**\n\t * \tSyncs the actual location of the specified element with its storage location. Returns true if successful.\n\t * \t!sync (elem: Element) : boolean;\n\t */\n\tsync: function (elem)\n\t{\n\t\tthrow new Error ('Container::sync not implemented');\n\t},\n\n\t/**\n\t * \tClears the container to empty. All contained elements will be destroyed.\n\t * \t!clear() : void;\n\t */\n\tclear: function() /* @override */\n\t{\n\t\tthrow new Error ('Container::clear not implemented');\n\t},\n\n\t/**\n\t * \tResets the container to empty. Contained elements are not destroyed. Use `clear` if that is your intention.\n\t * \t!reset() : void;\n\t */\n\treset: function() /* @override */\n\t{\n\t\tthrow new Error ('Container::reset not implemented');\n\t},\n\n\t/**\n\t * \tAdds an element to the container. Returns boolean indicating if successful.\n\t * \t!add (elem: Element) : boolean;\n\t */\n\tadd: function (elem) /* @override */\n\t{\n\t\tthrow new Error ('Container::add not implemented');\n\t},\n\n\t/**\n\t * \tRemoves an element from the container and returns it.\n\t * \t!remove (elem: Element) : Element;\n\t */\n\tremove: function (elem) /* @override */\n\t{\n\t\tthrow new Error ('Container::remove not implemented');\n\t},\n\n\t/**\n\t * \tPrepares the canvas with depth flag configuration and Z-value to draw the contained elements.\n\t * \t!draw (g: Canvas) : void;\n\t */\n\tdraw: function(g)\n\t{\n\t\tif (!this.visible()) return;\n\n\t\tlet depthFlagChanged = g.pushDepthFlag(this.flags & Container.DEPTH_FLAG);\n\n\t\tg.zvalue = this.zvalue;\n\n\t\tthis.drawCount = -1;\n\t\tthis.g = g;\n\n\t\tthis.render();\n\n\t\tif (depthFlagChanged) g.popDepthFlag();\n\t},\n\n\t/**\n\t * \tActually draws the contained elements.\n\t * \t!render() : void;\n\t */\n\trender: function()\n\t{\n\t\tthrow new Error ('Container::render not implemented');\n\t}\n});\n\n\n/*\n**\tConstants.\n*/\nContainer.VISIBLE = 0x001;\nContainer.DEPTH_FLAG = 0x002;\n\nexport default Container;\n","/*\n**\tflow/viewport.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Bounds2 from '../math/bounds2.js';\nimport Point2 from '../math/point2.js';\n\n//![import \"../math/point2\"]\n//![import \"../math/bounds2\"]\n//![import \"../math/rect\"]\n//![import \"../system/canvas\"]\n\n//:/**\n//: * \tViewport class controls the current visible rectangle of a container.\n//: */\n\n//!class Viewport\n\nconst Viewport = Class.extend\n({\n\tclassName: 'Viewport',\n\n\t/**\n\t * \tDimensions of the viewport.\n\t *\n\t * \t!readonly width: number;\n\t * \t!readonly height: number;\n\t */\n\twidth: 0, initialWidth: 0,\n\theight: 0, initialHeight: 0,\n\n\t/**\n\t * \tPosition of the top-left corner of the viewport in screen space.\n\t */\n\tsx: 0,\n\tsy: 0,\n\n\t/**\n\t * \tPosition of the center of the viewport in the container.\n\t */\n\tx: 0,\n\ty: 0,\n\n\t/**\n\t * \tRatio for the viewport's center (value from -1 to 1), used when focusing to use a different focus point instead of the exact center.\n\t */\n\tcenterRatioX: 0,\n\tcenterRatioY: 0,\n\n\t/**\n\t * \tPosition offset, used to move the viewport around without affecting the focus point.\n\t */\n\toffset: null,\n\n\t/**\n\t * \tBoundaries of the container, set by `setContainerBounds`.\n\t *\n\t * \t!readonly container: Bounds2;\n\t */\n\tcontainer: null,\n\n\t/**\n\t * \tThe focus factor determines the ratio of a smaller viewport on which the current focus point must  be contained. If the focus point is not inside the\n\t * \tsmaller viewport scrolling will be performed.\n\t */\n\tfocusFactorX: 0,\n\tfocusFactorY: 0,\n\n\t/**\n\t * \tFocus target rectangle and its offsets. When the viewport is updated it will automatically focus on this rect.\n\t */\n\tfocusRect: null,\n\tfocusOffsX: 0,\n\tfocusOffsY: 0,\n\n\t/**\n\t * \tEnabled focus axes. Used by the `update` method to figure which axis to update.\n\t */\n\tfocusAxisX: true,\n\tfocusAxisY: true,\n\n\t/**\n\t * \tFlags of the viewport.\n\t */\n\tflags: 0,\n\n\t/**\n\t * \tViewport scale.\n\t */\n\tscale: 1,\n\n\t/**\n\t * \tGlobal scale, used to scale the entire canvas including the viewport. Useful for debugging viewport bounds.\n\t */\n\tglobalScale: 1,\n\n\t/**\n\t * \tBounds of the viewport in world space. Used to determine which elements lie inside the viewport.\n\t *\n\t * \t!readonly bounds: Bounds2;\n\t */\n\tbounds: null,\n\n\t/**\n\t * \tExtra padding for the viewport bounds. Used to extend the viewport bounds without altering the original viewport size nor the world bounds.\n\t */\n\tpadding: null,\n\n\t/**\n\t * \tBounds of the focus area of the viewport in world space. When the `focusRect` moves outside this area the viewport will be panned to keep it inside these bounds.\n\t * \n\t * \t!readonly focusBounds: Bounds2;\n\t */\n\tfocusBounds: null,\n\n\t/**\n\t * \tBounds of the viewport in screen space, used as target rendering area.\n\t *\n\t *\t!readonly screenBounds: Bounds2;\n\t */\n\tscreenBounds: null,\n\n\t/**\n\t * \tTemporal Point2 object used as temporary result for `toWorldSpace` and `toScreenSpace`.\n\t */\n\ttmpPoint: null,\n\n\t/**\n\t * \tConstructs the viewport with the specified size and container dimensions.\n\t *\n\t * \t@param sx - Screen position X.\n\t * \t@param sy - Screen position Y.\n\t * \t@param width - Viewport width.\n\t * \t@param height - Viewport height.\n\t * \t@param containerWidth - Container width.\n\t * \t@param containerHeight - Container height.\n\t *\n\t * \t!constructor (sx: number, sy: number, width: number, height: number, containerWidth: number, containerHeight: number);\n\t */\n\t__ctor: function (sx, sy, width, height, containerWidth, containerHeight)\n\t{\n\t\tthis.focusFactorX = 0.4;\n\t\tthis.focusFactorY = 0.4;\n\t\tthis.focusRect = null;\n\n\t\tthis.sx = sx;\n\t\tthis.sy = sy;\n\t\tthis.width = this.initialWidth = width;\n\t\tthis.height = this.initialHeight = height;\n\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\n\t\tthis.bounds = Bounds2.Pool.alloc();\n\t\tthis.padding = null;\n\n\t\tthis.focusBounds = Bounds2.Pool.alloc();\n\t\tthis.screenBounds = Bounds2.Pool.alloc();\n\t\tthis.container = Bounds2.Pool.alloc();\n\t\tthis.offset = Point2.Pool.alloc();\n\n\t\tthis.flags = Viewport.ENABLED;\n\t\tthis.tmpPoint = Point2.Pool.alloc();\n\n\t\tthis.setContainerBounds(-containerWidth>>1, -containerHeight>>1, containerWidth>>1, containerHeight>>1);\n\n\t\tthis.updateScreenBounds();\n\t\tthis.updateBounds();\n\t},\n\n\t/**\n\t * \tDestructs the viewport.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis.bounds.free();\n\t\tthis.focusBounds.free();\n\t\tthis.screenBounds.free();\n\t\tthis.container.free();\n\t\tthis.tmpPoint.free();\n\n\t\tif (this.padding !== null)\n\t\t\tthis.padding.free();\n\t},\n\n\t/**\n\t * \tReturns the value of the `enabled` flag.\n\t *\n\t * \t!enabled() : boolean;\n\t */\n\t/**\n\t * \tSets the `enabled` flag.\n\t *\n\t * \t!enabled (value: boolean) : Viewport;\n\t */\n\tenabled: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Viewport.ENABLED);\n\n\t\tthis.flags &= ~Viewport.ENABLED;\n\t\tif (value) this.flags |= Viewport.ENABLED;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the value of the `topLeft` flag.\n\t * \t!topLeft() : boolean;\n\t */\n\t/**\n\t * \tSets the `topLeft` flag.\n\t * \t!topLeft (value: boolean) : Viewport;\n\t */\n\ttopLeft: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn !!(this.flags & Viewport.TOP_LEFT);\n\n\t\tthis.flags &= ~Viewport.TOP_LEFT;\n\t\tif (value) this.flags |= Viewport.TOP_LEFT;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the container bounds. Used to ensure the viewport bounds are never outside these limits.\n\t *\n\t * \t!setContainerBounds (x1: number, y1: number, x2: number, y2: number) : Viewport;\n\t */\n\t/**\n\t * \tSets the container bounds. Used to ensure the viewport bounds are never outside these limits.\n\t *\n\t * \t!setContainerBounds (v: Bounds2|Rect) : Viewport;\n\t */\n\tsetContainerBounds: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (y1 === null)\n\t\t{\n\t\t\ty2 = x1.y2;\n\t\t\tx2 = x1.x2;\n\t\t\ty1 = x1.y1;\n\t\t\tx1 = x1.x1;\n\t\t}\n\n\t\tthis.width = this.initialWidth;\n\t\tthis.height = this.initialHeight;\n\n\t\tif (this.width > x2-x1) this.width = x2-x1;\n\t\tif (this.height > y2-y1) this.height = y2-y1;\n\n\t\tthis.container.set(x1, y1, x2, y2);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the viewport padding.\n\t *\n\t * \t!setPadding (value: number) : Viewport;\n\t */\n\t/**\n\t * \tSets the padding of each side of the viewport (left, top, right and bottom).\n\t *\n\t * \t!setPadding (x1: number, y1: number, x2: number, y2: number) : Viewport;\n\t */\n\tsetPadding: function (x1, y1=null, x2=null, y2=null)\n\t{\n\t\tif (this.padding === null)\n\t\t\tthis.padding = Bounds2.Pool.alloc();\n\n\t\tif (y1 === null)\n\t\t{\n\t\t\tx2 = y2 = x1;\n\t\t\tx1 = y1 = -x1;\n\t\t}\n\n\t\tthis.padding.set(x1, y1, x2, y2);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tUpdates the bound rect of the viewport.\n\t */\n\tupdateBounds: function (truncateToContainer=false)\n\t{\n\t\tlet w, h, ws, hs;\n\t\tlet x1, y1, x2, y2;\n\n\t\tw = this.width >> 1;\n\t\th = this.height >> 1;\n\n\t\tws = (w/this.scale);\n\t\ths = (h/this.scale);\n\n\t\tx1 = this.x-ws+this.offset.x;\n\t\ty1 = this.y-hs+this.offset.y;\n\t\tx2 = this.x+ws+this.offset.x;\n\t\ty2 = this.y+hs+this.offset.y;\n\n\t\tif (truncateToContainer)\n\t\t{\n\t\t\tif (x1 < this.container.x1)\n\t\t\t\tthis.offset.setX(this.container.x1 - this.x + ws);\n\t\t\telse if (x2 > this.container.x2)\n\t\t\t\tthis.offset.setX(this.container.x2 - this.x - ws);\n\n\t\t\tif (y1 < this.container.y1)\n\t\t\t\tthis.offset.setY(this.container.y1 - this.y + hs);\n\t\t\telse if (y2 > this.container.y2)\n\t\t\t\tthis.offset.setY(this.container.y2 - this.y - hs);\n\n\t\t\tx1 = this.x-ws+this.offset.x;\n\t\t\ty1 = this.y-hs+this.offset.y;\n\t\t\tx2 = this.x+ws+this.offset.x;\n\t\t\ty2 = this.y+hs+this.offset.y;\n\t\t}\n\n\t\tthis.bounds.set (x1, y1, x2, y2);\n\n\t\tif (this.padding !== null)\n\t\t\tthis.bounds.add (this.padding);\n\n\t\tthis.focusBounds.set (\n\t\t\tthis.x - (this.focusFactorX*w + this.centerRatioX*w)/this.scale, this.y - (this.focusFactorY*h + this.centerRatioY*h)/this.scale,\n\t\t\tthis.x + (this.focusFactorX*w + this.centerRatioX*w)/this.scale, this.y + (this.focusFactorY*h + this.centerRatioY*h)/this.scale\n\t\t);\n\t},\n\n\t/**\n\t * \tUpdates the screen bound rect of the viewport.\n\t */\n\tupdateScreenBounds: function ()\n\t{\n\t\tthis.screenBounds.set (this.sx, this.sy, this.sx + this.width, this.sy + this.height);\n\t},\n\n\t/**\n\t * \tResizes the viewport to the specified size.\n\t *\n\t * \t!resize (width: number|null, height: number|null) : Viewport;\n\t */\n\tresize: function (width, height)\n\t{\n\t\tthis.width = this.initialWidth = width ?? this.width;\n\t\tthis.height = this.initialHeight = height ?? this.height;\n\n\t\tthis.updateScreenBounds();\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResizes the viewport by the specified deltas.\n\t *\n\t * \t!resizeBy (dWidth: number, dHeight: number) : Viewport;\n\t */\n\tresizeBy: function (dWidth, dHeight)\n\t{\n\t\tthis.width += dWidth;\n\t\tthis.height += dHeight;\n\n\t\tthis.initialWidth = this.width;\n\t\tthis.initialHeight = this.height;\n\n\t\tthis.updateScreenBounds();\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the position of the viewport's center within the world and resets the relative offset to zero.\n\t * Setting any parameter to `null` will cause it not to be changed.\n\t * \n\t * !setPosition (x: number|null, y: number|null) : Viewport;\n\t */\n\tsetPosition: function (x, y)\n\t{\n\t\tthis.x = x ?? this.x;\n\t\tthis.y = y ?? this.y;\n\n\t\tthis.offset.set(0, 0);\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the position of the viewport relative to the current focus point.\n\t * \n\t * \t!setOffsets (dx: number, dy: number) : Viewport;\n\t */\n\tsetOffsets: function (dx, dy)\n\t{\n\t\tthis.offset.set(dx, dy);\n\t\tthis.updateBounds();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the scale of the viewport.\n\t * \n\t * \t!setScale (value: number) : Viewport;\n\t */\n\tsetScale: function (value)\n\t{\n\t\tthis.scale = value;\n\t\tthis.updateBounds();\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the scale of the viewport.\n\t * \n\t * \t!getScale () : number;\n\t */\n\tgetScale: function ()\n\t{\n\t\treturn this.scale;\n\t},\n\n\t/**\n\t * \tSets the global scale of the viewport.\n\t * \n\t * \t!setGlobalScale (value: number) : Viewport;\n\t */\n\tsetGlobalScale: function (value)\n\t{\n\t\tthis.globalScale = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the global scale of the viewport.\n\t * \n\t * \t!getGlobalScale () : number;\n\t */\n\tgetGlobalScale: function ()\n\t{\n\t\treturn this.globalScale;\n\t},\n\n\t/**\n\t * \tSets the center ratio of the viewport (values from -1 to 1, default is 0). Used to focus on a different point instead of the exact center.\n\t * \n\t * \t!setCenter (rx: number, ry: number) : Viewport;\n\t */\n\tsetCenter: function (rx, ry)\n\t{\n\t\tthis.centerRatioX = rx;\n\t\tthis.centerRatioY = ry;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMoves the viewport within the world. Values are relative to the current focus point.\n\t *\t@param truncateToContainer - When `true` the final viewport bounds will be ensured to not lie outside the container bounds.\n\t *\n\t * \t!translate (dx: number, dy: number, truncateToContainer?: boolean) : Viewport;\n\t */\n\ttranslate: function (dx, dy, truncateToContainer=false)\n\t{\n\t\tthis.offset.add(dx, dy);\n\n\t\tthis.updateBounds(truncateToContainer);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the screen position of the viewport.\n\t * \n\t * \t!setScreenPosition (sx: number, sy: number) : number;\n\t */\n\tsetScreenPosition: function (sx, sy)\n\t{\n\t\tthis.sx = sx;\n\t\tthis.sy = sy;\n\n\t\tthis.updateScreenBounds();\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns the X coordinate of the viewport's focus point inside the world.\n\t * \t@param absolute - When `true`, the focus point X (without offset) will be returned.\n\t * \t\n\t * \t!getX (absolute?: boolean) : number;\n\t */\n\tgetX: function (absolute=false)\n\t{\n\t\treturn this.x + (absolute ? 0 : this.offset.x);\n\t},\n\n\t/**\n\t * \tReturns the Y coordinate of the viewport's focus point inside the world.\n\t * \t@param absolute - When `true`, the focus point Y (without offset) will be returned.\n\t * \t\n\t * \t!getY (absolute?: boolean) : number;\n\t */\n\tgetY: function (absolute=false)\n\t{\n\t\treturn this.y + (absolute ? 0 : this.offset.y);\n\t},\n\n\t/**\n\t * \tReturns the X position of the viewport inside the world relative to the current focus point.\n\t * \n\t * \t!getOffsetX() : void;\n\t */\n\tgetOffsetX: function ()\n\t{\n\t\treturn this.offset.x;\n\t},\n\n\t/**\n\t * \tReturns the Y position of the viewport inside the world relative to the current focus point.\n\t * \n\t * \t!getOffsetY() : void;\n\t */\n\tgetOffsetY: function ()\n\t{\n\t\treturn this.offset.y;\n\t},\n\n\t/**\n\t * \tReturns the width of the viewport.\n\t * \n\t * \t!getWidth() : number;\n\t */\n\tgetWidth: function ()\n\t{\n\t\treturn this.width;\n\t},\n\n\t/**\n\t * \tReturns the height of the viewport.\n\t * \n\t * \t!getHeight() : number;\n\t */\n\tgetHeight: function ()\n\t{\n\t\treturn this.height;\n\t},\n\n\t/**\n\t * \tMoves the viewport X coordinate to focus on the specified line or coordinate. Method `updateBounds` should be called afterwards.\n\t * \n\t * \t!focusX (x0: number, x1?: number, factor?: number) : Viewport;\n\t */\n\tfocusX: function (i0, i1=null, kx=null)\n\t{\n\t\tif (kx === null) kx = this.focusFactorX;\n\t\tif (i1 === null) i1 = i0;\n\n\t\tlet w = this.width >> 1;\n\n\t\tlet x1 = this.x - int((kx*w + this.centerRatioX*w)/this.scale);\n\t\tlet x2 = this.x + int((kx*w + this.centerRatioX*w)/this.scale);\n\n\t\tif (x1 == x2)\n\t\t\ti0 = i1 = (i0 + i1) >> 1;\n\n\t\tlet nx = this.x;\n\n\t\tif (i0 < x1) nx += (i0 - x1);\n\t\telse if (i1 > x2) nx += (i1 - x2);\n\n\t\tx1 = nx - w;\n\t\tx2 = nx + w;\n\n\t\tif (x1 < this.container.x1) nx = this.container.x1 + w;\n\t\tif (x2 > this.container.x2) nx = this.container.x2 - w;\n\n\t\tthis.x = nx;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMoves the viewport Y coordinate to focus on the specified line or coordinate. Method `updateBounds` should be called afterwards.\n\t * \n\t * \t!focusY (y0: number, y1?: number, factor?: number) : Viewport;\n\t */\n\tfocusY: function (j0, j1=null, ky=null)\n\t{\n\t\tif (ky === null) ky = this.focusFactorY;\n\t\tif (j1 === null) j1 = j0;\n\n\t\tlet h = this.height >> 1;\n\n\t\tlet y1 = this.y - int((ky*h + this.centerRatioY*h)/this.scale);\n\t\tlet y2 = this.y + int((ky*h + this.centerRatioY*h)/this.scale);\n\n\t\tif (y1 == y2)\n\t\t\tj0 = j1 = (j0 + j1) >> 1;\n\n\t\tlet ny = this.y;\n\n\t\tif (j0 < y1) ny += (j0 - y1);\n\t\telse if (j1 > y2) ny += (j1 - y2);\n\n\t\ty1 = ny - h;\n\t\ty2 = ny + h;\n\n\t\tif (y1 < this.container.y1) ny = this.container.y1 + h;\n\t\tif (y2 > this.container.y2) ny = this.container.y2 - h;\n\n\t\tthis.y = ny;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tUpdates the viewport to focus on the focusRect. Takes into account enabled axes.\n\t *\n\t * \t!update (dt?: number) : void;\n\t */\n\tupdate: function (dt=0)\n\t{\n\t\tif (this.focusRect === null)\n\t\t\treturn;\n\n\t\tif (this.focusAxisX)\n\t\t\tthis.focusX (this.focusRect.x1 + this.focusOffsX, this.focusRect.x2 + this.focusOffsX);\n\n\t\tif (this.focusAxisY)\n\t\t\tthis.focusY (this.focusRect.y1 + this.focusOffsY, this.focusRect.y2 + this.focusOffsY);\n\n\t\tthis.updateBounds();\n\t},\n\n\t/**\n\t * \tUpdates the viewport to focus on the focusRect ignoring the enabled axes.\n\t *\n\t * \t!updateForced (dt?: number) : void;\n\t */\n\tupdateForced: function (dt=0)\n\t{\n\t\tif (this.focusRect === null)\n\t\t\treturn;\n\n\t\tthis.focusX (this.focusRect.x1 + this.focusOffsX, this.focusRect.x2 + this.focusOffsX);\n\t\tthis.focusY (this.focusRect.y1 + this.focusOffsY, this.focusRect.y2 + this.focusOffsY);\n\n\t\tthis.updateBounds();\n\t},\n\n\t/**\n\t * \tTracks a specified rectangle by maintaining focus on it (a call to `update` must be made on every frame update).\n\t * \n\t * \t!setFocusRect (rect: Rect|Bounds2, offsX?: number, offsY? :number) : Viewport;\n\t */\n\tsetFocusRect: function (rect, offsX=0, offsY=0)\n\t{\n\t\tthis.focusRect = rect;\n\n\t\tthis.focusOffsX = offsX;\n\t\tthis.focusOffsY = offsY;\n\n\t\tthis.update(0);\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the focus offsets of the viewport. Used to translate the viewport without altering the focus point.\n\t *\n\t * \t!setFocusOffsets (offsX: number, offsY: number) : Viewport;\n\t */\n\tsetFocusOffsets: function (offsX, offsY)\n\t{\n\t\tthis.focusOffsX = offsX;\n\t\tthis.focusOffsY = offsY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the enabled flag of the focus axes. Only enabled axes will be updated when calling `update`.\n\t * \n\t * \t!setFocusAxes (enabledX: boolean, enabledY: boolean) : Viewport;\n\t */\n\tsetFocusAxes: function (enabledX, enabledY)\n\t{\n\t\tthis.focusAxisX = enabledX;\n\t\tthis.focusAxisY = enabledY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the focus factor of the viewport (value from 0 to 1), that is, the ratio of the smaller focus viewport.\n\t * \n\t * \t!setFocusFactor (valueX: number, valueY: number) : Viewport;\n\t */\n\tsetFocusFactor: function (valueX, valueY)\n\t{\n\t\tthis.focusFactorX = valueX;\n\t\tthis.focusFactorY = valueY === undefined ? valueX : valueY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tApplies the viewport clipping area to the specified canvas.\n\t * \n\t * \t!applyClip (g: Canvas) : void;\n\t */\n\tapplyClip: function (g)\n\t{\n\t\tg.clip(this.screenBounds.x1, this.screenBounds.y1, this.screenBounds.width(), this.screenBounds.height());\n\t},\n\n\t/**\n\t * \tApplies the viewport transform to the specified canvas.\n\t * \n\t * \t!applyTransform (g: Canvas) : void;\n\t */\n\tapplyTransform: function (g)\n\t{\n\t\tif (!(this.flags & Viewport.TOP_LEFT))\n\t\t\tg.translate (this.screenBounds.cx, this.screenBounds.cy);\n\t\telse\n\t\t\tg.translate (this.screenBounds.x1, this.screenBounds.y1);\n\n\t\tif (this.scale != 1.0)\n\t\t\tg.scale (this.scale, this.scale);\n\n\t\tif (this.globalScale != 1.0)\n\t\t\tg.scale (this.globalScale, this.globalScale);\n\n\t\tif (!(this.flags & Viewport.TOP_LEFT))\n\t\t\tg.translate (-this.bounds.cx, -this.bounds.cy);\n\t\telse\n\t\t\tg.translate (-this.bounds.x1, -this.bounds.y1);\n\n\t\tg.updateTransform();\n\t},\n\n\t/**\n\t * \tConverts a point from screen-space to world-space.\n\t * \t@returns Temporal Point2 object.\n\t *\n\t * \t!toWorldSpace (input: Point2|Vec2|{x:number,y:number}, floor?: boolean) : Point2;\n\t */\n\t/**\n\t * \tConverts a point from screen-space to world-space.\n\t * \t@returns Temporal Point2 object.\n\t *\n\t * \t!toWorldSpace (x: number, y: number, floor?: boolean) : Point2;\n\t */\n\ttoWorldSpace: function (x, y=null, floor=false)\n\t{\n\t\tif (y === null || y === true)\n\t\t{\n\t\t\tfloor = y === true;\n\t\t\ty = x.y;\n\t\t\tx = x.x;\n\t\t}\n\n\t\tlet refX, refY;\n\n\t\tif (!(this.flags & Viewport.TOP_LEFT))\n\t\t{\n\t\t\trefX = this.screenBounds.cx;\n\t\t\trefY = this.screenBounds.cy;\n\n\t\t\tif (floor) {\n\t\t\t\tx = ((x - int(refX)) / this.scale) + int(this.bounds.cx);\n\t\t\t\ty = ((y - int(refY)) / this.scale) + int(this.bounds.cy);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tx = ((x - refX) / this.scale) + this.bounds.cx;\n\t\t\t\ty = ((y - refY) / this.scale) + this.bounds.cy;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\trefX = this.screenBounds.x1;\n\t\t\trefY = this.screenBounds.y1;\n\n\t\t\tif (floor) {\n\t\t\t\tx = ((x - int(refX)) / this.scale) + int(this.bounds.x1);\n\t\t\t\ty = ((y - int(refY)) / this.scale) + int(this.bounds.y1);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tx = ((x - refX) / this.scale) + this.bounds.x1;\n\t\t\t\ty = ((y - refY) / this.scale) + this.bounds.y1;\n\t\t\t}\n\t\t}\n\n\t\treturn this.tmpPoint.set(x, y);\n\t},\n\n\t/**\n\t * \tConverts a point from world-space to screen-space.\n\t * \t@returns Temporal Point2 object.\n\t *\n\t * \t!toScreenSpace (input: Point2|Vec2|{x:number,y:number}, floor?: boolean) : Point2;\n\t */\n\t/**\n\t * \tConverts a point from world-space to screen-space.\n\t * \t@returns Temporal Point2 object.\n\t *\n\t * \t!toScreenSpace (x: number, y: number, floor?: boolean) : Point2;\n\t */\n\ttoScreenSpace: function (x, y=null, floor=false)\n\t{\n\t\tif (y === null || y === true)\n\t\t{\n\t\t\tfloor = y === true;\n\t\t\ty = x.y;\n\t\t\tx = x.x;\n\t\t}\n\n\t\tlet refX, refY;\n\n\t\tif (!(this.flags & Viewport.TOP_LEFT))\n\t\t{\n\t\t\trefX = this.screenBounds.cx;\n\t\t\trefY = this.screenBounds.cy;\n\n\t\t\tif (floor) {\n\t\t\t\tx = (x - int(this.bounds.cx)) * this.scale + int(refX);\n\t\t\t\ty = (y - int(this.bounds.cy)) * this.scale + int(refY);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tx = (x - this.bounds.cx) * this.scale + refX;\n\t\t\t\ty = (y - this.bounds.cy) * this.scale + refY;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\trefX = this.screenBounds.x1;\n\t\t\trefY = this.screenBounds.y1;\n\n\t\t\tif (floor) {\n\t\t\t\tx = (x - int(this.bounds.x1)) * this.scale + int(refX);\n\t\t\t\ty = (y - int(this.bounds.y1)) * this.scale + int(refY);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tx = (x - this.bounds.x1) * this.scale + refX;\n\t\t\t\ty = (y - this.bounds.y1) * this.scale + refY;\n\t\t\t}\n\t\t}\n\n\t\treturn this.tmpPoint.set(x, y);\n\t}\n});\n\n/*\n**\tConstants.\n*/\nViewport.ENABLED = 0x001;\nViewport.TOP_LEFT = 0x002;\n\nexport default Viewport;\n","/*\n**\tflow/element.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport GridElement from './grid-element.js';\nimport G from '../system/globals.js';\nimport Recycler from '../utils/recycler.js';\nimport System from '../system/system.js';\nimport Canvas from '../system/canvas.js';\nimport Drawable from './drawable.js';\n\n//![import \"./grid-element\"]\n//![import \"../system/globals\"]\n//![import \"../utils/recycler\"]\n//![import \"./drawable\"]\n\n//:/**\n//: * Describes an element that can be rendered to the screen.\n//: */\n\n//!class Element extends GridElement\n\nconst Element = GridElement.extend\n({\n\tclassName: 'Element',\n\n\t/**\n\t * Parent group to whom this element is related.\n\t * !group: Group;\n\t */\n\tgroup: null,\n\n\t/**\n\t * Drawable object to render to the display.\n\t * !img: Drawable;\n\t */\n\timg: null,\n\n\t/**\n\t * Indicates if the bounds of the element should be drawn (for debugging purposes). You can set it to a boolean or to a number from 1 to 7 to\n\t * draw the bounds with a different predefined color.\n\t * !debugBounds: boolean|number;\n\t */\n\tdebugBounds: false,\n\n\t/**\n\t * Basic depth (z-value) of the element (used for depth micro-adjustments).\n\t */\n\t_zvalue: 0,\n\n\t/**\n\t * Actual depth (z-value) of the element, calculated by the container.\n\t */\n\t__zvalue: 0,\n\n\t/**\n\t * Alpha value of the element.\n\t */\n\t_alpha: 1.0,\n\n\t/**\n\t * Element shader program.\n\t */\n\t_shaderProgram: null,\n\n\t/**\n\t * Function used to set the uniforms of the shader.\n\t */\n\t_uniformSetter: null,\n\n\t/**\n\t * Function used to render the element. Called by `draw` after rendering configuration has been set.\n\t * @type {(g:Canvas, elem:Element, img:Drawable) => void}\n\t */\n\trender: null,\n\n\t/**\n\t * Constructs a drawable element at the specified position with the given drawable.\n\t * !constructor (x: number, y: number, width: number, height: number, img?: Drawable);\n\t */\n\t/**\n\t * Constructs a drawable element at the specified position with the given drawable.\n\t * !constructor (x: number, y: number, img?: Drawable);\n\t */\n\t__ctor: function(x, y, width=null, height=null, img=null)\n\t{\n\t\tif (width === null)\n\t\t\twidth = height = 0;\n\n\t\tif (height === null)\n\t\t{\n\t\t\timg = width;\n\t\t\twidth = img.width;\n\t\t\theight = img.height;\n\t\t}\n\n\t\tthis._super.GridElement.__ctor(x, y, width, height);\n\t\tthis.img = img !== null ? img.getDrawable() : img;\n\n\t\tthis.group = null;\n\t\tthis.debugBounds = false;\n\n\t\tthis._zvalue = 0;\n\t\tthis.__zvalue = 0;\n\t\tthis._alpha = 1.0;\n\n\t\tthis._shaderProgram = null;\n\t\tthis._uniformSetter = null;\n\n\t\tthis.render = null;\n\t},\n\n\t/**\n\t * Destroys the element.\n\t */\n\t__dtor: function()\n\t{\n\t\tif (this.img !== null)\n\t\t{\n\t\t\tdispose(this.img);\n\t\t\tthis.img = null;\n\t\t}\n\n\t\tthis._super.GridElement.__dtor();\n\t},\n\n\t/**\n\t * Destroys the element later by adding it to the scene's destruction queue. If the element has no container, it will be destroyed immediately.\n\t * !destroyLater() : void;\n\t */\n\tdestroyLater: function()\n\t{\n\t\tif (!this.alive()) return;\n\n\t\tif (this.container !== null)\n\t\t\tthis.container.scene.disposeLater(this);\n\t\telse\n\t\t\tdispose(this);\n\t},\n\n\t/**\n\t * Returns the `debugBounds` of the element.\n\t * @returns {number}\n\t * !debug () : number;\n\t */\n\t/**\n\t * Sets the `debugBounds` of the element.\n\t * @param {boolean|number} value\n\t * @returns {Element}\n\t * !debug (value: number) : Element;\n\t */\n\tdebug: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this.debugBounds;\n\n\t\tthis.debugBounds = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the alpha value of the element.\n\t * @returns {number}\n\t * !alpha () : number;\n\t */\n\t/**\n\t * Sets the alpha value of the element.\n\t * @param {number} value\n\t * @returns {Element}\n\t * !alpha (value: number) : Element;\n\t */\n\talpha: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._alpha;\n\n\t\tthis._alpha = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the zvalue of the element.\n\t * @returns {number}\n\t * !zvalue () : number;\n\t */\n\t/**\n\t * Sets the zvalue of the element.\n\t * @param {number} value\n\t * @returns {Element}\n\t * !zvalue (value: number) : Element;\n\t */\n\tzvalue: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._zvalue;\n\n\t\tthis._zvalue = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Returns the shader program of the element.\n\t * @returns {ShaderProgram}\n\t * !shaderProgram () : ShaderProgram;\n\t */\n\t/**\n\t * Sets the shader program of the element.\n\t * @param {ShaderProgram} shaderProgram\n\t * @returns {Element}\n\t * !shaderProgram (shaderProgram: ShaderProgram) : Element;\n\t */\n\tshaderProgram: function (shaderProgram=false)\n\t{\n\t\tif (shaderProgram === false)\n\t\t\treturn this._shaderProgram;\n\n\t\tthis._shaderProgram = shaderProgram;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the uniform setter function.\n\t * @param { (elem:Element, gl:WebGLRenderingContext, pgm:ShaderProgram) => void } uniformSetter\n\t * @returns {Element}\n\t * !uniformSetter (uniformSetter: (elem:Element, gl:WebGLRenderingContext, pgm:ShaderProgram) => void) : Element;\n\t */\n\tuniformSetter: function (uniformSetter)\n\t{\n\t\tthis._uniformSetter = uniformSetter;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Draws the element on the specified canvas.\n\t * @param {Canvas} g\n\t */\n\tdraw: function(g)\n\t{\n\t\tif (this.img === null && this.render === null)\n\t\t\treturn;\n\n\t\tlet shaderChanged = this._shaderProgram !== null ? g.pushShaderProgram(this._shaderProgram) : false;\n\t\tlet depthFlagChanged = this.depthFlagEnabled() ? g.pushDepthFlag(this.depthFlag()) : false;\n\n\t\tif (this._shaderProgram !== null && this._uniformSetter !== null && g.gl !== null)\n\t\t\tthis._uniformSetter (this, g.gl, g.getShaderProgram());\n\n\t\tg.zvalue = this.__zvalue;\n\n\t\tif (this._alpha != 1.0)\n\t\t{\n\t\t\tg.pushAlpha();\n\t\t\tg.alpha(this._alpha);\n\t\t}\n\n\t\tif (this.render !== null)\n\t\t\tthis.render(g, this, this.img);\n\t\telse\n\t\t\tthis.img.render(g, this);\n\n\t\tif (depthFlagChanged) g.popDepthFlag();\n\t\tif (shaderChanged) g.popShaderProgram();\n\n\t\tif (this._alpha != 1.0)\n\t\t\tg.popAlpha();\n\n\t\t/* *********** */\n\t\tif (G.debugBounds || this.debugBounds)\n\t\t{\n\t\t\tlet g2 = System.displayBuffer2;\n\n\t\t\tg2.pushMatrix();\n\t\t\tg2.loadMatrix(g.getMatrix());\n\n\t\t\tg2.fillStyle(Element.getDebugColor(this.debugBounds));\n\t\t\tg2.fillRect(this.bounds.x1, this.bounds.y1, this.bounds.width(), this.bounds.height());\n\n\t\t\tg2.popMatrix();\n\t\t}\n\t},\n\n\t/**\n\t * Changes the function used to render the element.\n\t * @param { (g:Canvas, elem:Element, img:Drawable) => void } renderFunction\n\t * @returns {Element}\n\t */\n\trenderWith: function (renderFunction)\n\t{\n\t\tthis.render = renderFunction ?? null;\n\t\treturn this;\n\t}\n});\n\n/**\n * Colors for the bounds debugging.\n * !static debugColors : Array<string>;\n */\nElement.debugColors = [\n\t'rgba(0,255,255,0.35)', // Cyan\n\t'rgba(255,255,0,0.35)', // Yellow\n\t'rgba(255,0,0,0.35)', // Red\n\t'rgba(0,255,0,0.35)', // Green\n\t'rgba(0,0,255,0.35)', // Blue\n\t'rgba(255,0,255,0.35)', // Magenta\n\t'rgba(255,255,255,0.35)', // White\n\t'rgba(128,128,128,0.35)' // Gray\n];\n\n/**\n * Returns an RGBA color for the given `debugBounds` value.\n * !static getDebugColor (debugBounds: boolean|number) : string;\n */\nElement.getDebugColor = function (debugBounds)\n{\n\tif (debugBounds === true || debugBounds === false)\n\t\tdebugBounds = 0;\n\n\treturn Element.debugColors[(~~debugBounds) & 7];\n};\n\n//!/class\n\n//!namespace Element\n//!namespace Pool\n\n\t/**\n\t * Allocates a drawable element at the specified position with the given drawable.\n\t * !function alloc (x: number, y: number, width: number, height: number, img?: Drawable) : Element;\n\t */\n\t/**\n\t * Allocates a drawable element at the specified position with the given drawable.\n\t * !function alloc (x: number, y: number, img?: Drawable) : Element;\n\t */\n\nRecycler.createPool(Element);\nexport default Element;\n","/*\n**\tflow/group.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Element from './element.js';\nimport List from '../utils/list.js';\nimport Point2 from '../math/point2.js';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"./element\"]\n//![import \"../utils/list\"]\n//![import \"../math/point2\"]\n//![import \"../utils/recycler\"]\n\nconst tempPoint = Point2.Pool.alloc();\n\n//:/**\n//: * \tGroups one or more elements into a single one.\n//: */\n\n//!class Group extends Element\n\nconst Group = Element.extend\n({\n\tclassName: 'Group',\n\n\t/*\n\t**\tList of elements in to the group.\n\t*/\n\tchildren: null,\n\n\t/**\n\t * \tVirtual zero reference point.\n\t * \t!readonly ref: Point2;\n\t */\n\tref: null,\n\n\t/**\n\t * \tConstructs an empty Group element.\n\t * \t!constructor (id?: string);\n\t */\n\t__ctor: function (id=null)\n\t{\n\t\tthis._super.Element.__ctor(0, 0, 0, 0);\n\n\t\tthis.children = List.Pool.alloc();\n\t\tthis.bounds.reset();\n\n\t\tthis.ref = Point2.Pool.alloc();\n\t\tthis.setId(id);\n\t},\n\n\t/**\n\t * \tDestroys the group and all children.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis.children.free();\n\t\tthis.ref.free();\n\n\t\tthis._super.Element.__dtor();\n\t},\n\n\t/**\n\t * \tAdds the group itself and all children to the scene's destruction queue. If any element has no container, it will be destroyed immediately.\n\t * \t!destroyLater() : void;\n\t */\n\tdestroyLater: function()\n\t{\n\t\tif (!this.alive()) return;\n\n\t\tlet i;\n\n\t\twhile ((i = this.children.shift()) != null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.group = null;\n\t\t\ti.destroyLater();\n\t\t}\n\n\t\tthis._super.Element.destroyLater();\n\t},\n\n\t/**\n\t * \tRemoves and destroys all child elements.\n\t * \t!clear() : Group;\n\t */\n\tclear: function()\n\t{\n\t\tlet i;\n\n\t\twhile ((i = this.children.shift()) != null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.group = null;\n\t\t\tdispose(i);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tRemoves all child elements but does not destroy them.\n\t * \t!reset() : Group;\n\t */\n\treset: function()\n\t{\n\t\tlet i;\n\n\t\twhile ((i = this.children.shift()) != null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.group = null;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tAdds a child element to the group. If the element has its `id` property set, it will be added to the group as a\n\t * \tproperty, which can be accessed directly using the element identifier or using the `getChild` method.\n\t * \t!addChild (elem: Element) : Element;\n\t */\n\taddChild: function (elem, relative=false)\n\t{\n\t\tif (!elem) return elem;\n\n\t\tlet initial = this.bounds.x1 === null;\n\n\t\tif (initial) {\n\t\t\tif (initial || elem.bounds.x1 < this.bounds.x1) this.ltranslate(elem.bounds.x1 - this.bounds.x1, 0);\n\t\t\tif (initial || elem.bounds.y1 < this.bounds.y1) this.ltranslate(0, elem.bounds.y1 - this.bounds.y1);\n\t\t\tif (initial || elem.bounds.x2 > this.bounds.x2) this.resizeBy(elem.bounds.x2 - this.bounds.x2, 0);\n\t\t\tif (initial || elem.bounds.y2 > this.bounds.y2) this.resizeBy(0, elem.bounds.y2 - this.bounds.y2);\n\t\t}\n\n\t\tthis.children.push(elem);\n\n\t\tif (elem.id !== null)\n\t\t\tthis[elem.id] = elem;\n\n\t\tif (relative === true)\n\t\t\telem.translate(this.bounds.x1, this.bounds.y1);\n\n\t\telem.group = this;\n\t\telem.remover.add(this._remove, this, this.children.bottom);\n\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tReturn the child element matching the specified identifier.\n\t * \t!child (id: string) : Element;\n\t */\n\tgetChild: function (id)\n\t{\n\t\treturn this[id] || null;\n\t},\n\n\t/**\n\t * \tCallback to remove an element from the container (called by Handler).\n\t */\n\t_remove: function (elem, self, node)\n\t{\n\t\tself.children.remove(node);\n\t\telem.group = null;\n\n\t\tif (elem.id !== null)\n\t\t\tself[elem.id] = null;\n\n\t\treturn false;\n\t},\n\n\t/**\n\t * \tRemoves an element from the container and returns it.\n\t * \t!removeChild (elem: Element) : Element;\n\t */\n\tremoveChild: function (elem)\n\t{\n\t\tif (!elem || elem.group !== this)\n\t\t\treturn elem;\n\n\t\telem.remover.execf(this._remove, this);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tSyncs the actual location of the specified element with its storage location. Returns `true` if successful.\n\t */\n\tsync: function()\n\t{\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.sync();\n\n\t\treturn this._super.Element.sync();\n\t},\n\n\t/**\n\t * \tLocal group translation, moves only the group by the specified deltas. Child element remain in position.\n\t * \t@param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * \t!ltranslate (dx: number, dy: number, upscaled?: boolean) : Group;\n\t */\n\tltranslate: function (dx, dy, upscaled=false)\n\t{\n\t\treturn this._super.Element.translate(dx, dy, upscaled);\n\t},\n\n\t/**\n\t * \tMoves the group and all children by the specified deltas.\n\t * \t@param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * \t!ltranslate (dx: number, dy: number, upscaled?: boolean) : Group;\n\t */\n\ttranslate: function (dx, dy, upscaled=false)\n\t{\n\t\tlet _dx = this.bounds.x1;\n\t\tlet _dy = this.bounds.y1;\n\n\t\tthis._super.Element.translate(dx, dy, upscaled);\n\t\tthis.ref.add(dx, dy, upscaled);\n\n\t\t_dx = this.bounds.x1 - _dx;\n\t\t_dy = this.bounds.y1 - _dy;\n\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.translate(_dx, _dy);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tReturns a temporal Point2, describing the extra offset introduced by the group when translating a child element by the specified deltas.\n\t * \t@param upscaled - When `true` the `dx` and `dy` parameters are assumed to be upscaled.\n\t * \t!getOffsets (dx: number, dy: number, upscaled?: boolean) : Point2;\n\t */\n\tgetOffsets: function (dx, dy, upscaled=false)\n\t{\n\t\ttempPoint.set(this.bounds.ux1, this.bounds.uy1, true);\n\n\t\tlet _dx = tempPoint.x;\n\t\tlet _dy = tempPoint.y;\n\n\t\ttempPoint.add(dx, dy, upscaled);\n\n\t\t_dx = tempPoint.x - _dx;\n\t\t_dy = tempPoint.y - _dy;\n\n\t\ttempPoint.set(_dx, _dy);\n\n\t\ttempPoint.x -= dx;\n\t\ttempPoint.y -= dy;\n\n\t\treturn tempPoint;\n\t},\n\n\t/**\n\t * \tSets bits of the element flags in the group and all children.\n\t * \t!setFlags (value: number) : Group;\n\t */\n\tsetFlags: function (value)\n\t{\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.setFlags(value);\n\n\t\treturn this._super.Element.setFlags(value);\n\t},\n\n\t/**\n\t * \tClears bits from the group and all children flags.\n\t * \t!clearFlags (value: number) : Group;\n\t */\n\tclearFlags: function (value)\n\t{\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.clearFlags(value);\n\n\t\treturn this._super.Element.clearFlags(value);\n\t},\n\n\t/**\n\t * Sets the visible flag of the group and all children.\n\t * @param {boolean} value - New visibility value.\n\t * @param {boolean} forced - When `true` forces to ignore the VISIBLE_LOCK flag.\n\t * !visible (value: boolean, forced: boolean=false) : GridElement;\n\t */\n\t/**\n\t * Returns the visible flag.\n\t * !visible() : boolean;\n\t */\n\tvisible: function (value=null, forced=false)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._super.Element.visible();\n\n\t\tfor (let i = this.children.top; i; i = i.next)\n\t\t\ti.value.visible(value, forced);\n\n\t\treturn this._super.Element.visible(value, forced);\n\t}\n});\n\n//!/class\n\n//!namespace Group\n//!namespace Pool\n\n\t/**\n\t * \tAllocates an empty Group element.\n\t * \t!function alloc (id?: string) : Group;\n\t */\n\nRecycler.createPool(Group);\nexport default Group;\n","/*\n**\tflow/updater.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport List from '../utils/list.js';\nimport Element from './element.js';\n\n//![import \"../utils/list\"]\n//![import \"./element\"]\n\n//:/**\n//: * \tAn updater is used to update one or more elements and synchronize their position with their container.\n//: */\n\n//!class Updater\n\nconst Updater = Class.extend\n({\n\tclassName: 'Updater',\n\n\t/**\n\t * \tScene where the updater is attached.\n\t * \t!readonly scene: Scene;\n\t */\n\tscene: null,\n\n\t/**\n\t * \tList of elements.\n\t */\n\tlist: null,\n\n\t/**\n\t * \tCallback passed when constructing the updater.\n\t */\n\t__update: null,\n\t__context: null,\n\n\t/**\n\t * \tPre-update and post-update callbacks. Set using the `preupdate` and `postupdate` methods.\n\t */\n\t__preupdate: null,\n\t__postupdate: null,\n\n\t/**\n\t * \tConstructs the updater linked to the specified scene.\n\t * \t!constructor (scene: Scene, update: (elem: Element, dt: number, context: object) => boolean, context?: object);\n\t */\n\t__ctor: function (scene, update=null, context=null)\n\t{\n\t\tthis.list = List.Pool.alloc();\n\t\tthis.scene = scene;\n\n\t\tthis.__update = update;\n\t\tthis.__context = context;\n\n\t\tthis.__preupdate = null;\n\t\tthis.__postupdate = null;\n\n\t\tthis.scene.updater.add(this._update, this);\n\t\tthis.scene.synchronizer.add(this._sync, this);\n\t\tthis.scene.destroyer.add(this._destroy, this);\n\t},\n\n\t/**\n\t * \tDestroys the instance. All elements will just be removed.\n\t */\n\t__dtor: function()\n\t{\n\t\tlet i;\n\n\t\tthis.scene.updater.remove(this._update, this);\n\t\tthis.scene.synchronizer.remove(this._sync, this);\n\t\tthis.scene.destroyer.remove(this._destroy, this);\n\n\t\twhile ((i = this.list.shift()) !== null) {\n\t\t\ti.remover.remove(this._remove, this);\n\t\t}\n\n\t\tthis.list.free();\n\t},\n\n\t/**\n\t * \tDestroyer callback.\n\t */\n\t_destroy: function (scene, self)\n\t{\n\t\tdispose(self);\n\t},\n\n\n\t/**\n\t * \tResets the updater by removing all elements.\n\t * \t!reset () : Updater;\n\t */\n\treset: function ()\n\t{\n\t\twhile ((i = this.list.shift()) !== null) {\n\t\t\ti.remover.remove(this._remove, this);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tClears the updater by destroying all elements.\n\t * \t!clear () : Updater;\n\t */\n\tclear: function ()\n\t{\n\t\twhile ((i = this.list.shift()) !== null) {\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\tdispose(i);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the pre-update callback.\n\t * \t!preupdate (callback: (list: List, dt: number, updater: Updater) => Updater) : Updater;\n\t */\n\tpreUpdate: function (callback)\n\t{\n\t\tthis.__preupdate = callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the post-update callback.\n\t * \t!postupdate (callback: (list: List, dt: number, updater: Updater) => Updater) : Updater;\n\t */\n\tpostUpdate: function (callback)\n\t{\n\t\tthis.__postupdate = callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tAdds an element to the updater.\n\t * \t!add (elem: Element) : boolean;\n\t */\n\tadd: function (elem)\n\t{\n\t\tif (!Element.isInstance(elem))\n\t\t\tthrow new Error ('argument must be an Element');\n\n\t\tthis.list.push(elem);\n\n\t\telem.remover.add(this._remove, this, this.list.bottom);\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tCallback to remove an element from the updater (called by Handler).\n\t */\n\t_remove: function (elem, self, node)\n\t{\n\t\tself.list.remove(node);\n\t\treturn false;\n\t},\n\n\t/**\n\t * \tRemoves an element from the updater.\n\t * \t!remove (elem: Element) : Element;\n\t */\n\tremove: function (elem)\n\t{\n\t\telem.remover.execf(this._remove, this);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tCallback for the synchronizer.\n\t */\n\t_sync: function (scene, self)\n\t{\n\t\tfor (let i = self.list.top; i; i = i.next)\n\t\t\ti.value.sync();\n\t},\n\n\t/**\n\t * \tCallback for the updater.\n\t */\n\t_update: function (scene, self)\n\t{\n\t\tself.update(scene.dt);\n\t},\n\n\t/**\n\t * \tRuns an update cycle.\n\t * \t!update (dt: number) : void;\n\t */\n\tupdate: function (dt)\n\t{\n\t\tif (this.__preupdate !== null)\n\t\t\tthis.__preupdate (this.list, dt, this.__context);\n\n\t\tif (this.__update !== null)\n\t\t{\n\t\t\tlet next = null;\n\t\t\tfor (let i = this.list.top; i; i = next)\n\t\t\t{\n\t\t\t\tnext = i.next;\n\n\t\t\t\tif (this.__update (i.value, dt, this.__context) === false)\n\t\t\t\t\tthis.remove(i.value);\n\t\t\t}\n\t\t}\n\n\t\tif (this.__postupdate !== null)\n\t\t\tthis.__postupdate (this.list, dt, this.__context);\n\t}\n});\n\nexport default Updater;\n","/*\n**\tflow/simple-container.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Container from './container.js';\nimport GridElement from './grid-element.js';\nimport Element from './element.js';\nimport List from '../utils/list.js';\n\n//![import \"./container\"]\n//![import \"./grid-element\"]\n//![import \"./element\"]\n//![import \"../utils/list\"]\n\n//:/**\n//: * \tA simple container is a container that uses a linked-list to storage the elements.\n//: */\n\n//!class SimpleContainer extends Container\n\nexport default Container.extend\n({\n\tclassName: 'SimpleContainer',\n\n\t/**\n\t * List containing the elements.\n\t * !readonly list: List;\n\t */\n\tlist: null,\n\n\t/**\n\t * Constructs the container with the specified size.\n\t * !constructor (width: number, height: number);\n\t */\n\t__ctor: function (width, height)\n\t{\n\t\tthis._super.Container.__ctor (width, height);\n\t\tthis.list = List.Pool.alloc();\n\n\t\tthis.depthFlag(false);\n\t},\n\n\t/**\n\t * Destroys the container and all contained elements.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis.list.free();\n\n\t\tthis._super.Container.__dtor();\n\t},\n\n\t/**\n\t * Syncs the actual location of the specified element with its storage location. Returns true if successful.\n\t * !override sync (elem: Element) : boolean;\n\t */\n\tsync: function (elem)\n\t{\n\t\tthis.syncZ(elem);\n\t\treturn true;\n\t},\n\n\t/**\n\t * Clears the container to empty. All contained elements will be destroyed.\n\t * !override clear() : void;\n\t */\n\tclear: function()\n\t{\n\t\tlet i;\n\n\t\twhile ((i = this.list.shift()) !== null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.container = null;\n\t\t\tdispose(i);\n\t\t}\n\n\t\tthis.elementCount = 0;\n\t},\n\n\t/**\n\t * Resets the container to empty. Contained elements are not destroyed. Use `clear` if that is your intention.\n\t * !override reset() : void;\n\t */\n\treset: function()\n\t{\n\t\tlet i;\n\n\t\twhile ((i = this.list.shift()) !== null)\n\t\t{\n\t\t\ti.remover.remove(this._remove, this);\n\t\t\ti.container = null;\n\t\t}\n\n\t\tthis.elementCount = 0;\n\t},\n\n\t/**\n\t * Adds an element to the container. Returns boolean indicating if successful.\n\t * !override add (elem: Element) : boolean;\n\t */\n\tadd: function (elem)\n\t{\n\t\tif (!Element.isInstance(elem))\n\t\t\tthrow new Error ('argument must be an Element');\n\n\t\tthis.list.push(elem);\n\t\tthis.elementCount++;\n\n\t\telem.container = this;\n\t\telem.remover.add(this._remove, this, this.list.bottom);\n\n\t\tthis.syncZ(elem);\n\t\treturn true;\n\t},\n\n\t/**\n\t * Callback to remove an element from the container (called by Handler).\n\t */\n\t_remove: function (elem, self, node)\n\t{\n\t\tself.list.remove(node);\n\t\tself.elementCount--;\n\n\t\telem.container = null;\n\t\treturn false;\n\t},\n\n\t/**\n\t * Removes an element from the container and returns it.\n\t * !override remove (elem: Element) : Element;\n\t */\n\tremove: function (elem)\n\t{\n\t\telem.remover.execf(this._remove, this);\n\t\treturn elem;\n\t},\n\n\t/**\n\t * Actually draws the contained elements. Does not take the active viewport into account (hence simple container).\n\t * !override render() : void;\n\t */\n\trender: function()\n\t{\n\t\tlet flags = GridElement.ALIVE | GridElement.VISIBLE;\n\n\t\tfor (let i = this.list.top; i; i = i.next)\n\t\t{\n\t\t\tif (!i.value.getFlags(flags))\n\t\t\t\tcontinue;\n\n\t\t\tif (this.drawElement(i.value, this) === false)\n\t\t\t\tbreak;\n\t\t}\n\t}\n});\n","/*\n**\tflow/grid-container.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Container from './container.js';\nimport Grid from './grid.js';\nimport GridElement from './grid-element.js';\nimport Element from './element.js';\nimport globals from '../system/globals.js';\nimport System from '../system/system.js';\n\n//![import \"./container\"]\n//![import \"./grid\"]\n//![import \"./grid-element\"]\n//![import \"./element\"]\n//![import \"../system/globals\"]\n//![import \"../system/system\"]\n\n//:/**\n//: * \tA grid container is a container that uses an optimized spatial grid structure to store the elements.\n//: */\n\n//!class GridContainer extends Container\n\nexport default Container.extend\n({\n\tclassName: 'GridContainer',\n\n\t/**\n\t * \tGrid containing the elements.\n\t * \t!readonly grid: Grid;\n\t */\n\tgrid: null,\n\n\t/**\n\t * \tIndicates if the container bound should be drawn.\n\t * \t!debugBounds: boolean;\n\t */\n\tdebugBounds: false,\n\n\t/**\n\t * \tConstructs the grid container with the default size (32768x32768) and divisor (64).\n\t * \t!constructor ();\n\t */\n\t/**\n\t * \tConstructs the grid container with the specified size and divisor.\n\t * \t!constructor (width: number, height: number, divisorX: number, divisorY?: number);\n\t */\n\t__ctor: function (width=32768, height=32768, divisorX=64, divisorY=null)\n\t{\n\t\tthis._super.Container.__ctor (width, height);\n\t\tthis.grid = new Grid (width, height, divisorX, divisorY);\n\t},\n\n\t/**\n\t * \tDestroys the container and all contained elements.\n\t */\n\t__dtor: function()\n\t{\n\t\tthis.clear();\n\t\tthis._super.Container.__dtor();\n\t},\n\n\t/**\n\t * \tSyncs the actual location of the specified element with its storage location. Returns true if successful.\n\t * \t!override sync (elem: Element) : boolean;\n\t */\n\tsync: function (elem)\n\t{\n\t\tthis.syncZ(elem);\n\t\treturn this.grid.sync(elem);\n\t},\n\n\t/**\n\t * \tClears the container to empty. All contained elements will be destroyed.\n\t * \t!override clear() : void;\n\t */\n\tclear: function()\n\t{\n\t\tthis.grid.clear();\n\t},\n\n\t/**\n\t * \tResets the container to empty. Contained elements are not destroyed. Use `clear` if that is your intention.\n\t * \t!override reset() : void;\n\t */\n\treset: function()\n\t{\n\t\tthis.grid.reset();\n\t},\n\n\t/**\n\t * \tAdds an element to the container. Returns boolean indicating if successful.\n\t * \t!override add (elem: Element) : boolean;\n\t */\n\tadd: function (elem)\n\t{\n\t\tif (!Element.isInstance(elem))\n\t\t\tthrow new Error ('argument must be an Element');\n\n\t\tif (!this.grid.add(elem))\n\t\t\treturn false;\n\n\t\telem.container = this;\n\t\tthis.elementCount = this.grid.count;\n\n\t\tthis.syncZ(elem);\n\t\treturn true;\n\t},\n\n\t/**\n\t * \tRemoves an element from the container and returns it.\n\t * \t!override remove (elem: Element) : Element;\n\t */\n\tremove: function (elem)\n\t{\n\t\tthis.grid.remove(elem);\n\t\tthis.elementCount = this.grid.count;\n\t\treturn elem;\n\t},\n\n\t/**\n\t * \tActually draws the contained elements.\n\t * \t!override render() : void;\n\t */\n\trender: function()\n\t{\n\t\tthis.grid.forEachInRegion(this.viewportBounds, GridElement.ALIVE | GridElement.VISIBLE, GridElement.ALIVE | GridElement.VISIBLE, this.drawElement, this);\n\n\t\tif (!this.debugBounds || this.viewportBounds === null)\n\t\t\treturn;\n\n\t\tlet g = System.displayBuffer2;\n\n\t\tg.pushMatrix();\n\t\tg.loadMatrix(this.g.getMatrix());\n\n\t\tlet y0 = ((this.viewportBounds.y1+this.grid.offsy - (1<<this.grid.ky-1)) >> this.grid.ky) * this.grid.stride;\n\t\tlet y1 = ((this.viewportBounds.y2+this.grid.offsy) + (1<<this.grid.ky-1) >> this.grid.ky) * this.grid.stride;\n\t\tlet x0 = ((this.viewportBounds.x1+this.grid.offsx - (1<<this.grid.kx-1)) >> this.grid.kx);\n\t\tlet x1 = ((this.viewportBounds.x2+this.grid.offsx) + (1<<this.grid.kx-1) >> this.grid.kx);\n\n\t\ty0 = (int(y0 / this.grid.stride) << this.grid.ky) - this.grid.offsy;\n\t\ty1 = (int(y1 / this.grid.stride) << this.grid.ky) - this.grid.offsy + (1 << this.grid.ky);\n\t\tx0 = (x0 << this.grid.kx) - this.grid.offsx;\n\t\tx1 = (x1 << this.grid.kx) - this.grid.offsx + (1 << this.grid.kx);\n\n\t\tg.fillStyle('rgba(255,0,0,0.2)');\n\t\tg.fillRect(x0, y0, x1-x0+1, y1-y0+1);\n\n\t\ty0 = this.viewportBounds.y1;\n\t\ty1 = this.viewportBounds.y2;\n\t\tx0 = this.viewportBounds.x1;\n\t\tx1 = this.viewportBounds.x2;\n\n\t\tg.lineWidth(1/System.canvasScaleFactor);\n\t\tg.strokeStyle('#fff');\n\t\tg.strokeRect(x0, y0, x1-x0+1, y1-y0+1);\n\n\t\tg.lineWidth(1/System.canvasScaleFactor);\n\t\tg.strokeStyle('#008');\n\t\tfor (let y = globals.viewport.container.y1+this.grid.offsy; y < globals.viewport.container.y2+this.grid.offsy; y += (1 << this.grid.ky))\n\t\tfor (let x = globals.viewport.container.x1+this.grid.offsx; x < globals.viewport.container.x2+this.grid.offsx; x += (1 << this.grid.kx))\n\t\t{\n\t\t\tg.strokeRect(x-this.grid.offsx, y-this.grid.offsy, (1 << this.grid.kx), (1 << this.grid.ky));\n\t\t}\n\n\t\tg.popMatrix();\n\t},\n\n\t/**\n\t * \tExecutes the specified callback for each element that intersects the given bounds and has the specified flags set. The process is\n\t * \timmediately stopped if the callback returns `false`.\n\t * \t!forEachInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number, callback: (elem: Element, context?: object) => boolean, context?: object) : void;\n\t */\n\tforEachInRegion: function (bounds, flagsAndMask, flagsValue, callback, context)\n\t{\n\t\tthis.grid.forEachInRegion (bounds, flagsAndMask, flagsValue, callback, context);\n\t},\n\n\t/**\n\t * \tCollects all elements that intersect the given bounds and have the specified flags set. Returns a new List, remember to call `free` after using it.\n\t * \t!selectInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : List;\n\t */\n\tselectInRegion: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\treturn this.grid.selectInRegion (bounds, flagsAndMask, flagsValue);\n\t},\n\n\t/**\n\t * \tCounts all elements that intersect the given bounds and have the specified flags set.\n\t * \t!countInRegion (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : number;\n\t */\n\tcountInRegion: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\treturn this.grid.countInRegion (bounds, flagsAndMask, flagsValue);\n\t},\n\n\t/**\n\t * \tReturns the first element that intersect the given bounds and have the specified flags set.\n\t * \t!selectFirst (bounds: Bounds2|Rect, flagsAndMask: number, flagsValue: number) : Element;\n\t */\n\tselectFirst: function (bounds, flagsAndMask, flagsValue)\n\t{\n\t\treturn this.grid.selectFirst (bounds, flagsAndMask, flagsValue);\n\t}\n});\n","/*\n**\tflow/mask.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Element from './element.js';\nimport System from '../system/system.js';\nimport Recycler from '../utils/recycler.js';\nimport globals from '../system/globals.js';\n\n//![import \"./element\"]\n//![import \"../system/system\"]\n//![import \"../utils/recycler\"]\n\n//:/**\n//: * \tDescribes an element mask. Used for collision detection.\n//: */\n\n//!class Mask extends Element\n\nconst Mask = Element.extend\n({\n\tclassName: 'Mask',\n\n\t/**\n\t * \tType of the mask (user defined).\n\t * \t!type: number;\n\t */\n\ttype: 0,\n\n\t/**\n\t * \tConstructs the Mask element.\n\t * \t!constructor (type: number, x: number, y: number, width: number, height: number);\n\t */\n\t__ctor: function(type, x, y, width, height)\n\t{\n\t\tthis._super.Element.__ctor(x, y, width, height);\n\n\t\tthis.type = type;\n\t},\n\n\t/**\n\t * \tDraws the element on the specified canvas.\n\t * \t!draw (g: Canvas) : void;\n\t */\n\tdraw: function(g)\n\t{\n\t\tif (!globals.debugMasks && !this.debugBounds)\n\t\t\treturn;\n\n\t\tlet m = g.getMatrix();\n\t\tg = System.displayBuffer2;\n\n\t\tg.pushMatrix();\n\t\tg.loadMatrix(m);\n\t\tg.fillStyle(Element.getDebugColor(this.debugBounds));\n\t\tg.fillRect(this.bounds.x1, this.bounds.y1, this.bounds.width(), this.bounds.height());\n\t\tg.popMatrix();\n\t}\n});\n\n//!/class\n\n//!namespace Mask\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a new Mask element.\n\t * \t!function alloc (type: number, x: number, y: number, width: number, height: number) : Mask;\n\t */\n\nRecycler.createPool(Mask);\nexport default Mask;\n","/*\n**\tflow/label.js\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Element from './element.js';\nimport Recycler from '../utils/recycler.js';\n\n//![import \"./element\"]\n//![import \"../utils/recycler\"]\n\n//:/**\n//: * \tDescribes an element that can be rendered to the screen.\n//: */\n\n//!class Label extends Element\n\nconst Label = Element.extend\n({\n\tclassName: 'Label',\n\n\t/**\n\t * \tText to render.\n\t * \t!text: string;\n\t */\n\ttext: null,\n\n\t/**\n\t * \tSpritefont resource.\n\t * \t!font: object;\n\t */\n\tfont: null,\n\n\t/**\n\t * \tIndicates if the `text` property changed.\n\t */\n\t_dirty: false,\n\n\t/**\n\t * \tCurrent text dimensions.\n\t */\n\ttextWidth: null,\n\ttextHeight: null,\n\n\t/**\n\t * \tAlignment properties of the label.\n\t */\n\t_align: -1, /* -1=LEFT, 0=CENTER, 1=RIGHT */\n\t_valign: -1, /* -1=TOP, 0=MIDDLE, 1=BOTTOM */\n\n\t/**\t\n\t * Position offset for the text. Calculated based on alignment properties.\n\t */\n\ttextOffsetX: null,\n\ttextOffsetY: null,\n\n\t/**\n\t * \tConstructs a label element at the specified position with the given text.\n\t * \t!constructor (x: number, y: number, font: object, text: string);\n\t */\n\t__ctor: function(x, y, font, text)\n\t{\n\t\tthis._super.Element.__ctor(x, y, 4, 4);\n\n\t\tthis.text = text;\n\t\tthis.font = font;\n\n\t\tthis._align = -1;\n\t\tthis._valign = -1;\n\n\t\tthis.renderWith(this.renderText);\n\t\tthis._dirty = true;\n\t},\n\n\t/**\n\t * \tSets the horizontal alignment value of the label.\n\t * \t@param value - Use -1 for LEFT, 0 for CENTER, and 1 for RIGHT.\n\t * \t!align (value: number) : Label;\n\t */\n\talign: function(value)\n\t{\n\t\tif (this._align === value)\n\t\t\treturn this;\n\n\t\tthis._align = value;\n\t\tthis.textOffsetX = null;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the vertical alignment value of the label.\n\t * \t@param value - Use -1 for TOP, 0 for MIDDLE, and 1 for BOTTOM.\n\t * \t!valign (value: number) : Label;\n\t */\n\tvalign: function(value)\n\t{\n\t\tif (this._valign === value)\n\t\t\treturn this;\n\n\t\tthis._valign = value;\n\t\tthis.textOffsetY = null;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the text value of the label.\n\t * \t@param value\n\t * \t!setText (value: string) : Label;\n\t */\n\tsetText: function(value)\n\t{\n\t\tif (this.text === value)\n\t\t\treturn this;\n\n\t\tthis.text = value;\n\t\tthis._dirty = true;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the font to use.\n\t * \t@param font\n\t * \t!setFont (value: object) : Label;\n\t */\n\tsetFont: function(font)\n\t{\n\t\tif (this.font === font)\n\t\t\treturn this;\n\n\t\tthis.font = font;\n\t\tthis._dirty = true;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tUpdates the text related properties (textWidth, textHeight, textOffsetX and textOffsetY). Automatically\n\t * \tcalled before the label is drawn. Recalculates only if text changed since last call.\n\t */\n\tupdate: function()\n\t{\n\t\tif (this._dirty)\n\t\t{\n\t\t\tthis.textWidth = this.font.measureWidth(this.text);\n\t\t\tthis.textHeight = this.font.measureHeight(this.text);\n\n\t\t\tthis.textOffsetX = null;\n\t\t\tthis.textOffsetY = null;\n\n\t\t\tthis._dirty = false;\n\t\t}\n\n\t\tif (this.textOffsetX === null) {\n\t\t\tif (this._align < 0) this.textOffsetX = 0;\n\t\t\telse if (this._align === 0) this.textOffsetX = -this.textWidth >> 1;\n\t\t\telse this.textOffsetX = -this.textWidth;\n\t\t}\n\n\t\tif (this.textOffsetY === null) {\n\t\t\tif (this._valign < 0) this.textOffsetY = 0;\n\t\t\telse if (this._valign === 0) this.textOffsetY = -this.textHeight >> 1;\n\t\t\telse this.textOffsetY = -this.textHeight;\n\t\t}\n\t},\n\n\t/**\n\t * \tRenders the element to the graphics surface.\n\t */\n\trenderText: function(g, elem, img)\n\t{\n\t\telem.update();\n\t\telem.font.drawText (g, elem.bounds.x1 + elem.textOffsetX, elem.bounds.y1 + elem.textOffsetY, elem.text);\n\t}\n});\n\n//!/class\n\n//!namespace Label\n//!namespace Pool\n\n\t/**\n\t * \tAllocates a label element at the specified position with the given text.\n\t * \t!function alloc (x: number, y: number, font: object, text: string) : Label;\n\t */\n\n\nRecycler.createPool(Label);\nexport default Label;\n","/*\n**\tflow/keyboard-handler\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport PriorityQueue from '../utils/priority-queue.js';\nimport Boot from './boot.js';\nimport System from '../system/system.js';\n\n//![import \"../utils/priority-queue\"]\n//![import \"./boot\"]\n//![import \"../system/system\"]\n\n//!namespace KeyboardHandler\n\n\t//!interface EventHandler\n\n\t\t/**\n\t\t * \tHandler for keyboard events.\n\t\t * \t!onKeyboardEvent (action: System.KeyboardEventType, keyCode: number, keyState: object) : boolean;\n\t\t */\n\n\t//!/interface\n\n//!/namespace\n\n//:/**\n//: * \tUsed to attach keyboard event handlers to the system.\n//: */\n\n//!class KeyboardHandler\n\nexport default Boot.Module.create\n({\n\thandlers: null,\n\n\t__ctor: function ()\n\t{\n\t\tconst self = this;\n\n\t\tthis._super.Module.__ctor();\n\n\t\tthis.handlers = new PriorityQueue();\n\n\t\tthis._callOnKeyboardEvent = function (handler) {\n\t\t\treturn self.callOnKeyboardEvent(handler);\n\t\t};\n\t},\n\n\t/**\n\t * \tRegisters a new keyboard event handler.\n\t * \t!register (handler: KeyboardHandler.EventHandler) : KeyboardHandler.EventHandler;\n\t */\n\tregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.add(handler);\n\n\t\t\tif ('init' in handler)\n\t\t\t\thandler.init();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"KeyboardHandler (register): \" + e.message);\n\t\t}\n\n\t\treturn handler;\n\t},\n\n\t/**\n\t * \tRemoves a keyboard event handler.\n\t * \t!unregister (handler: KeyboardHandler.EventHandler) : void;\n\t */\n\tunregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.remove(handler);\n\t\t\tthis.handlers.cleanup();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"KeyboardHandler (unregister): \" + e.message);\n\t\t}\n\t},\n\n\tcallOnKeyboardEvent: function (handler)\n\t{\n\t\treturn handler.onKeyboardEvent(this._action, this._keyCode, this._keyState);\n\t},\n\n\tonStartup: function()\n\t{\n\t\tSystem.onKeyboardEvent = (action, keyCode, keyState) =>\n\t\t{\n\t\t\tthis._action = action;\n\t\t\tthis._keyCode = keyCode;\n\t\t\tthis._keyState = keyState;\n\n\t\t\tthis.handlers.forEach(this._callOnKeyboardEvent);\n\t\t};\n\t},\n\n\tonShutdown: function()\n\t{\n\t\tSystem.onKeyboardEvent = null;\n\t}\n});\n","/*\n**\tflow/pointer-handler\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport PriorityQueue from '../utils/priority-queue.js';\nimport Boot from './boot.js';\nimport System from '../system/system.js';\n\n//![import \"../utils/priority-queue\"]\n//![import \"./boot\"]\n//![import \"../system/system\"]\n\n//!namespace PointerHandler\n\n\t//!interface EventHandler\n\n\t\t/**\n\t\t * \tHandler for pointer events.\n\t\t * \t!onPointerEvent (action: System.PointerEventType, pointer: object, pointers: object) : boolean;\n\t\t */\n\n\t//!/interface\n\n//!/namespace\n\n//:/**\n//: * \tUsed to attach pointer event handlers to the system.\n//: */\n\n//!class PointerHandler\n\nexport default Boot.Module.create\n({\n\thandlers: null,\n\n\t__ctor: function ()\n\t{\n\t\tconst self = this;\n\n\t\tthis._super.Module.__ctor();\n\n\t\tthis.handlers = new PriorityQueue();\n\n\t\tthis._callOnPointerEvent = function (handler) {\n\t\t\treturn self.callOnPointerEvent(handler);\n\t\t};\n\t},\n\n\t/**\n\t * \tRegisters a new pointer event handler.\n\t * \t!register (handler: PointerHandler.EventHandler) : PointerHandler.EventHandler;\n\t */\n\tregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.add(handler);\n\n\t\t\tif ('init' in handler)\n\t\t\t\thandler.init();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"PointerHandler (register): \" + e.message);\n\t\t}\n\n\t\treturn handler;\n\t},\n\n\t/**\n\t * \tRemoves a pointer event handler.\n\t * \t!unregister (handler: PointerHandler.EventHandler) : void;\n\t */\n\tunregister: function (handler)\n\t{\n\t\ttry {\n\t\t\tthis.handlers.remove(handler);\n\t\t\tthis.handlers.cleanup();\n\t\t}\n\t\tcatch (e) {\n\t\t\tthrow new Error (\"PointerHandler (unregister): \" + e.message);\n\t\t}\n\t},\n\n\tcallOnPointerEvent: function (handler)\n\t{\n\t\treturn handler.onPointerEvent(this._action, this._p, this._pointers);\n\t},\n\n\tonStartup: function()\n\t{\n\t\tSystem.onPointerEvent = (action, p, pointers) =>\n\t\t{\n\t\t\tthis._action = action;\n\t\t\tthis._p = p;\n\t\t\tthis._pointers = pointers;\n\n\t\t\tthis.handlers.forEach(this._callOnPointerEvent);\n\t\t};\n\t},\n\n\tonShutdown: function()\n\t{\n\t\tSystem.onPointerEvent = null;\n\t}\n});\n","/*\n**\tflow/screen-controls\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport KeyboardHandler from './keyboard-handler.js';\nimport PointerHandler from './pointer-handler.js';\nimport System from '../system/system.js';\n\n//![import \"./keyboard-handler\"]\n//![import \"./pointer-handler\"]\n//![import \"../system/system\"]\n\n/**\n**\n*/\n\nconst ScreenControls =\n({\n\tpriority: 5,\n\n\tlist: [ ],\n\tdummy: { },\n\n\thoverEnabled: false,\n\tzindexEnabled: false,\n\tlastFrame: 0,\n\n\t/*\n\t**\tAdds an item to the ScreenControls control list. The item should be an object with the following mandatory methods:\n\t**\n\t**\t\tbool containsPoint (float pointerX, float pointerY)\n\t**\t\tvoid pointerActivate (Object pointer)\n\t**\t\tvoid pointerDeactivate (Object pointer)\n\t**\t\tvoid pointerUpdate (float pointerX, float pointerY, Object pointer)\n\t**\t\tvoid hover (bool status, Object pointer)\n\t**\t\tbool focusLock\n\t**\n\t**\t\tbool keyboardEvents\n\t**\t\tbool keyDown (int keyCode, object keyArgs)\n\t**\t\tbool keyUp (int keyCode, object keyArgs)\n\t*/\n\tadd: function (c)\n\t{\n\t\tif (this.zindexEnabled && !('zindex' in c))\n\t\t\tc.zindex = 0;\n\n\t\tif (this.list.indexOf(c) === -1)\n\t\t\tthis.list.push(c);\n\t},\n\n\tremove: function (c)\n\t{\n\t\tvar i = this.list.indexOf(c);\n\t\tif (i !== -1) this.list.splice(i, 1);\n\t},\n\n\tsetHoverEnabled: function (value)\n\t{\n\t\tthis.hoverEnabled = value;\n\t},\n\n\tsetZIndexEnabled: function (value)\n\t{\n\t\tthis.zindexEnabled = value;\n\t},\n\n\tfindTarget: function (x, y, filter)\n\t{\n\t\tif (this.zindexEnabled && this.lastFrame != System.frameNumber)\n\t\t{\n\t\t\tlet zindex = this.list[0].zindex;\n\n\t\t\tfor (let item of this.list)\n\t\t\t{\n\t\t\t\tif (item.zindex > zindex)\n\t\t\t\t{\n\t\t\t\t\tthis.list = this.list.sort((a,b) => b.zindex - a.zindex);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tzindex = item.zindex;\n\t\t\t}\n\n\t\t\tthis.lastFrame = System.frameNumber;\n\t\t}\n\n\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t{\n\t\t\tif (!this.list[i]) continue;\n\n\t\t\tif (filter != null && filter(this.list[i]) === false)\n\t\t\t\tcontinue;\n\n\t\t\tif (this.list[i].containsPoint(x, y))\n\t\t\t\treturn this.list[i];\n\t\t}\n\n\t\treturn null;\n\t},\n\n\tfilterHover: function (i)\n\t{\n\t\treturn 'hover' in i;\n\t},\n\n\tonPointerEvent: function (action, p, pointers)\n\t{\n\t\tlet _continue = true;\n\t\tlet tmp = null;\n\n\t\tswitch (action)\n\t\t{\n\t\t\tcase System.PointerEventType.POINTER_DOWN:\n\n\t\t\t\tif (p._ref != null)\n\t\t\t\t{\n\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\ttmp.pointerDeactivate(p);\n\t\t\t\t}\n\n\t\t\t\ttmp = this.findTarget(p.x, p.y);\n\t\t\t\tif (tmp != null)\n\t\t\t\t{\n\t\t\t\t\t(p._ref = tmp).pointerActivate(p);\n\t\t\t\t\t_continue = false;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_DRAG_START:\n\t\t\t\tif (p._ref != null) _continue = false;\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_DRAG_MOVE:\n\t\t\t\tif (this.hoverEnabled)\n\t\t\t\t{\n\t\t\t\t\tif (p._refh != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (p._refh.containsPoint(p.x, p.y))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp = p._refh; p._refh = null;\n\t\t\t\t\t\t\ttmp.hover(false, p);\n\t\t\n\t\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, this.filterHover);\n\t\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, this.filterHover);\n\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (p._ref != null)\n\t\t\t\t{\n\t\t\t\t\tif (p._ref.containsPoint(p.x, p.y) || p._ref.focusLock == true)\n\t\t\t\t\t{\n\t\t\t\t\t\tp._ref.pointerUpdate (p.x, p.y, p);\n\t\t\t\t\t\t_continue = false;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\t\ttmp.pointerDeactivate(p);\n\t\n\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y);\n\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t(p._ref = tmp).pointerActivate(p);\n\t\t\t\t\t\t\t_continue = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttmp = this.findTarget(p.x, p.y);\n\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t{\n\t\t\t\t\t\t(p._ref = tmp).pointerActivate(p);\n\t\t\t\t\t\t_continue = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_MOVE:\n\t\t\t\tif (this.hoverEnabled)\n\t\t\t\t{\n\t\t\t\t\tif (p._refh != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (p._refh.containsPoint(p.x, p.y))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp = p._refh; p._refh = null;\n\t\t\t\t\t\t\ttmp.hover(false, p);\n\t\t\n\t\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, this.filterHover);\n\t\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp = this.findTarget(p.x, p.y, this.filterHover);\n\t\t\t\t\t\tif (tmp != null)\n\t\t\t\t\t\t\t(p._refh = tmp).hover(true, p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (p._ref == null) break;\n\n\t\t\t\tif (p._ref.containsPoint(p.x, p.y) || p._ref.focusLock == true)\n\t\t\t\t{\n\t\t\t\t\tp._ref.pointerUpdate (p.x, p.y, p);\n\t\t\t\t\t_continue = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\ttmp.pointerDeactivate(p);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_DRAG_STOP:\n\t\t\t\tif (p._ref != null) _continue = false;\n\t\t\t\tbreak;\n\n\t\t\tcase System.PointerEventType.POINTER_UP:\n\t\t\t\tif (p._ref != null)\n\t\t\t\t{\n\t\t\t\t\ttmp = p._ref; p._ref = null;\n\t\t\t\t\ttmp.pointerDeactivate(p);\n\n\t\t\t\t\t_continue = false;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn _continue;\n\t},\n\n\tonKeyboardEvent: function (action, keyCode, keyArgs)\n\t{\n\t\tswitch (action)\n\t\t{\n\t\t\tcase System.KeyboardEventType.KEY_DOWN:\n\n\t\t\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!this.list[i] || !this.list[i].keyboardEvents) continue;\n\n\t\t\t\t\tif (this.list[i].keyDown(keyCode, keyArgs) === false)\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase System.KeyboardEventType.KEY_UP:\n\n\t\t\t\tfor (let i = 0; i < this.list.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!this.list[i] || !this.list[i].keyboardEvents) continue;\n\n\t\t\t\t\tif (this.list[i].keyUp(keyCode, keyArgs) === false)\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n});\n\nPointerHandler.register(ScreenControls);\nKeyboardHandler.register(ScreenControls);\n\nexport default ScreenControls;\n","/*\n**\tflow/button\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Group from './group.js';\nimport Mask from './mask.js';\nimport ScreenControls from './screen-controls.js';\n\n//![import \"./group.js\"]\n//![import \"./mask.js\"]\n//![import \"./screen-controls.js\"]\n\n/**\n * \tButton class provides an easy way to add push-button support to the world.\n */\n\n//!class Button extends Group\n\nexport default Group.extend\n({\n\t/**\n\t * \tIndicates if once focus is obtained it is locked until the user releases it.\n\t * \t@default false\n\t *\t!focusLock: boolean;\n\t */\n\tfocusLock: false,\n\n\t/**\n\t * \tIndicates if keyboard events are enabled on this object.\n\t * \t@default true\n\t *\t!keyboardEvents: boolean;\n\t */\n\tkeyboardEvents: true,\n\n\t/**\n\t * \tCurrent pressed status of the button.\n\t *\t!isPressed: boolean;\n\t */\n\tisPressed: false,\n\n\t/**\n\t * \tPrevious pressed status of the button.\n\t *\t!wasPressed: boolean;\n\t */\n\twasPressed: false,\n\n\t/**\n\t * \tImage to draw when the button is unpressed.\n\t *\t!unpressedImg: Drawable;\n\t */\n\tunpressedImg: null,\n\n\t/**\n\t * \tImage to draw when the button is pressed.\n\t *\t!pressedImg: Drawable;\n\t */\n\tpressedImg: null,\n\n\t/**\n\t * \tKey code related to the button. Used only if not `null`.\n\t * \t@default null\n\t *\t!keyCode: System.KeyCode;\n\t */\n\tkeyCode: null,\n\n\t/**\n\t * \tHitbox element.\n\t * \t!readonly hitbox: Mask;\n\t */\n\thitbox: null,\n\n\t/**\n\t * \tHandlers for the button events.\n\t */\n\t_onButtonDown: null,\n\t_onButtonUp: null,\n\t_onTap: null,\n\t_onChange: null,\n \n\t/**\n\t * \tCreates the button with the specified parameters. Automatically adds it to the screen controls.\n\t * \t!constructor (container: Container, x: number, y: number, unpressedImg?: Drawable, pressedImg?: Drawable);\n\t */\n\t__ctor: function (container, x, y, unpressedImg=null, pressedImg=null)\n\t{\n\t\tthis._super.Group.__ctor();\n\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg ?? unpressedImg;\n\t\tthis.hitbox = null;\n\n\t\tlet hitbox = Mask.Pool.alloc (0, x, y, this.unpressedImg ? this.unpressedImg.width : 16, this.unpressedImg ? this.unpressedImg.height : 16).visible(false).visibleLock(true).debug(2);\n\t\tthis.addChild(hitbox);\n\n\t\tcontainer.add(hitbox);\n\t\tcontainer.add(this);\n\n\t\tthis.hitbox = hitbox;\n\n\t\tthis._onButtonDown = null;\n\t\tthis._onButtonUp = null;\n\t\tthis._onTap = null;\n\t\tthis._onChange = this._default_onChange;\n\n\t\tthis.reset();\n\t\tScreenControls.add(this);\n\t},\n\n\t/**\n\t * \tRemoves the button from the screen controls and destroys it.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis._super.Group.__dtor();\n\t\tthis.hitbox.free();\n\t\tScreenControls.remove(this);\n\t},\n\n\t/**\n\t * \tSets the width and height of the button and the hitbox.\n\t * \t!resize (width: number, height: number) : GridElement;\n\t */\n\tresize: function (width, height)\n\t{\n\t\tthis._super.Group.resize(width, height);\n\n\t\tif (this.hitbox !== null)\n\t\t\tthis.hitbox.resize(width, height);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResizes the button and hitbox by the specified deltas.\n\t * \t!resizeBy (deltaWidth: number, deltaHeight: number) : GridElement;\n\t */\n\tresizeBy: function (dWidth, dHeight)\n\t{\n\t\tthis._super.Group.resizeBy(dWidth, dHeight);\n\n\t\tif (this.hitbox !== null)\n\t\t\tthis.hitbox.resizeBy(dWidth, dHeight);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tChanges the pressed/unpressed images of the button.\n\t * \t!setImage (unpressedImg: Drawable, pressedImg?: Drawable);\n\t */\n\tsetImage: function (unpressedImg, pressedImg=null)\n\t{\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg || unpressedImg;\n\n\t\tthis.reset();\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tChanges the key code of the button.\n\t * \t!setKeyCode (value: System.KeyCode) : Button;\n\t */\n\tsetKeyCode: function (value)\n\t{\n\t\tthis.keyCode = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResets the button to its initial state.\n\t * \t!reset() : void;\n\t */\n\treset: function ()\n\t{\n\t\tthis.img = this.unpressedImg;\n\t\tthis._onChange (this.isPressed = false, this.wasPressed = false, this);\n\t},\n\n\t/**\n\t * \tButton pointer update event. Not required for the button control.\n\t * \t!pointerUpdate (pointerX: number, pointerY: number, pointer: object) : void;\n\t */\n\tpointerUpdate: function (pointerX, pointerY, pointer)\n\t{\n\t},\n\n\t/**\n\t * \tSets the pressed state of the button.\n\t * \t!setStatus (value: boolean) : Button;\n\t */\n\tsetStatus: function (value)\n\t{\n\t\tif ((this.isPressed && value) || (!this.isPressed && !value))\n\t\t\treturn this;\n\n\t\tthis.updateStatus (value);\n\n\t\tthis.img = this.isPressed ? this.pressedImg : this.unpressedImg;\n\t\tthis._onChange (this.isPressed, this.wasPressed, this);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tMoves the `isPressed` value of the button to `wasPressed`, and updates `isPressed` with the given value. If none provided, `isPressed` is unchanged.\n\t *\t!updateStatus (value?: boolean) : Button;\n\t */\n\tupdateStatus: function (value=null)\n\t{\n\t\tthis.wasPressed = this.isPressed;\n\t\tthis.isPressed = value === null ? this.isPressed : value;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tCalled when the PointerEventType.POINTER_DOWN event starts within the bounding box of the button.\n\t * \t!pointerActivate (pointer: object) : void;\n\t */\n\tpointerActivate: function (pointer)\n\t{\n\t\tthis.setStatus(true);\n\t},\n\n\t/**\n\t * \tCalled when the PointerEventType.POINTER_UP event is fired with the \"_ref\" attribute pointing to this object.\n\t *\t!pointerDeactivate (pointer: object) : void;\n\t */\n\tpointerDeactivate: function (pointer)\n\t{\n\t\tthis.setStatus(false);\n\t},\n\n\t/**\n\t * \tReturns `true` if the button contains the specified point.\n\t * \t!containsPoint (x: number, y: number) : boolean;\n\t */\n\tcontainsPoint: function(x, y)\n\t{\n\t\tif (!this.visible())\n\t\t\treturn false;\n\n\t\treturn this.hitbox.bounds.containsPoint(x, y);\n\t},\n\n\t/**\n\t * \tExecuted after any change in the status of the button. Be careful when overriding this, because when so, the `onTap` method will not work.\n\t * \t!onChange (isPressed: boolean, wasPressed: boolean, button: Button) : void;\n\t */\n\t_default_onChange: function (isPressed, wasPressed, button)\n\t{\n\t\tif (isPressed != wasPressed)\n\t\t{\n\t\t\tif (isPressed && this._onButtonDown)\n\t\t\t\tthis._onButtonDown();\n\t\t\telse if (!isPressed && this._onButtonUp)\n\t\t\t\tthis._onButtonUp();\n\t\t}\n\n\t\tif (!isPressed && wasPressed && this._onTap)\n\t\t\tthis._onTap();\n\t},\n\n\t/**\n\t * \tKey down event, handles the keys that control the button.\n\t * \t!keyDown (keyCode: System.KeyCode, keyArgs: object) : boolean|null;\n\t */\n\tkeyDown: function (keyCode, keyArgs)\n\t{\n\t\tif (keyCode === this.keyCode)\n\t\t{\n\t\t\tthis.pointerActivate();\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * \tKey up event, handles the keys that control the button.\n\t * \t!keyUp (keyCode: System.KeyCode, keyArgs: object) : boolean|null;\n\t */\n\tkeyUp: function (keyCode, keyArgs)\n\t{\n\t\tif (keyCode === this.keyCode)\n\t\t{\n\t\t\tthis.pointerDeactivate();\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * \tSets the handler for the on-change event. Executed when the button state changes. Setting this callback will cause onButtonDown,\n\t * \tonButtonUp and onTap to no longer work. Set the callback to `null` to return it to the default state.\n\t * \n\t * \t!onChange: (callback: (isPressed: boolean, wasPressed: boolean, buttons: Button) => void) => Button;\n\t */\n\tonChange: function (callback)\n\t{\n\t\tthis._onChange = callback === null ? this._default_onChange : callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the handler for the button-down event. Executed when the button is pressed. Fired only if the `onChange` method was not overriden.\n\t * \t!onButtonDown: (callback: () => void) => Button;\n\t */\n\tonButtonDown: function (callback)\n\t{\n\t\tthis._onButtonDown = callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the handler for the button-up event. Executed when the button is released. Fired only if the `onChange` method was not overriden.\n\t * \t!onButtonUp: (callback: () => void) => Button;\n\t */\n\tonButtonUp: function (callback)\n\t{\n\t\tthis._onButtonUp = callback;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the handler for the on-tap event. Executed when the button is tapped (pressed and then released). Fired only if the `onChange` method was not overriden.\n\t * \t!onTap: (callback: () => void) => Button;\n\t */\n\tonTap: function (callback)\n\t{\n\t\tthis._onTap = callback;\n\t\treturn this;\n\t}\n});\n","/*\n**\tflow/stick\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Group from './group.js';\nimport Mask from './mask.js';\nimport ScreenControls from './screen-controls.js';\nimport KeyCode from '../system/keycode.js';\n\n//![import \"./group\"]\n//![import \"./mask\"]\n//![import \"./screen-controls\"]\n//![import \"../system/keycode\"]\n\n/**\n * \tStick class provides an easy way to add directional control sticks to the world.\n */\n\n//!class Stick extends Group\n\nexport default Group.extend\n({\n\t/**\n\t * \tIndicates if once focus is obtained it is locked until the user releases it.\n\t * \t@default true\n\t *\t!focusLock: boolean;\n\t */\n\tfocusLock: true,\n\n\t/**\n\t * \tIndicates if keyboard events are enabled on this object.\n\t * \t@default true\n\t *\t!keyboardEvents: boolean;\n\t */\n\tkeyboardEvents: true,\n\n\t/**\n\t * \tCurrent pressed status of the stick.\n\t *\t!isPressed: boolean;\n\t */\n\tisPressed: false,\n\n\t/**\n\t * \tPrevious pressed status of the stick.\n\t *\t!wasPressed: boolean;\n\t */\n\twasPressed: false,\n\n\t\t/**\n\t\t * \tImage to draw when the stick is unpressed (outer circle).\n\t\t *\t!unpressedImg: Drawable;\n\t\t */\n\t\tunpressedImg: null,\n\n\t\t/**\n\t\t * \tImage to draw when the stick is pressed (outer circle).\n\t\t *\t!pressedImg: Drawable;\n\t\t */\n\t\tpressedImg: null,\n\n\t/**\n\t * \tImage to draw when the stick is unpressed (inner circle).\n\t *\t!unpressedImg: Drawable;\n\t */\n\tunpressedImgInner: null,\n\n\t/**\n\t * \tImage to draw when the stick is pressed (inner circle).\n\t *\t!pressedImg: Drawable;\n\t */\n\tpressedImgInner: null,\n\n\t\t/**\n\t\t * \tNumber of steps for the angle. Used to snap the stick movement to discrete steps.\n\t\t * \t!angleSteps: number;\n\t\t */\n\t\tangleSteps: 0,\n\n\t\t/**\n\t\t * \tNumber of steps for the radius of the stick. Used to snap the stick movement to discrete steps.\n\t\t * \t!radiusSteps: number;\n\t\t */\n\t\tradiusSteps: 0,\n\n\t/*\n\t**\tDirection (X and Y), magnitude and angle of the stick vector. The dirx and diry are normalized.\n\t*/\n\trdirx: 0,\n\trdiry: 0,\n\n\tdirx: 0,\n\tdiry: 0,\n\n\tmagnitude: 0,\n\tangle: 0,\n\n\t/*\n\t**\tFrozen stick state. Set by calling `freezeState`.\n\t*/\n\tfrdirx: 0, frdiry: 0, fdirx: 0, fdiry: 0, fmagnitude: 0, fangle: 0,\n\n\t/*\n\t**\tIndicates the displacement in X and Y directions of the inner stick. This is calculated when the update() method is called.\n\t*/\n\tdispx: 0, dispy: 0,\n\n\t/*\n\t**\tCurrent radius of the inner stick (how far it moved). And maximum radius that the inner stick can move.\n\t*/\n\tradius: 0, maxRadius: 0,\n\n\t/*\n\t**\tDead zone values for each axis.\n\t*/\n\tdeadZoneX: 0, deadZoneY: 0,\n\n\t/*\n\t**\tHitbox element.\n\t*/\n\thitbox: 0,\n\n\t/**\n\t * \tHandlers for the stick events.\n\t */\n\t_onChange: null,\n \n\t/**\n\t * \tCreates the stick with the specified parameters. Automatically adds it to the screen controls.\n\t * \t!constructor (container: Container, x: number, y: number, maxRadius: number, unpressedImg: Drawable, unpressedImgInner: Drawable, pressedImg?: Drawable, pressedImgInner?: Drawable);\n\t */\n\t__ctor: function (container, x, y, maxRadius, unpressedImg, unpressedImgInner, pressedImg=null, pressedImgInner=null)\n\t{\n\t\tthis._super.Group.__ctor();\n\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg || unpressedImg;\n\n\t\tthis.unpressedImgInner = unpressedImgInner;\n\t\tthis.pressedImgInner = pressedImgInner || unpressedImgInner;\n\n\t\tthis.maxRadius = maxRadius;\n\n\t\tthis.deadZoneX = 0;\n\t\tthis.deadZoneY = 0;\n\n\t\tthis.hitbox = Mask.Pool.alloc (0, x, y, (this.unpressedImg ?? this.unpressedImgInner).width, (this.unpressedImg ?? this.unpressedImgInner).height).visible(false).visibleLock(true).debug(2);\n\t\tthis.addChild(this.hitbox);\n\n\t\tcontainer.add(this.hitbox);\n\t\tcontainer.add(this);\n\n\t\tthis._onChange = null;\n\n\t\tthis.renderWith(this.renderStick);\n\t\tScreenControls.add(this);\n\t},\n\n\t/**\n\t * \tRemoves the button from the screen controls and destroys it.\n\t */\n\t__dtor: function ()\n\t{\n\t\tthis._super.Group.__dtor();\n\t\tthis.hitbox.free();\n\t\tScreenControls.remove(this);\n\t},\n\n\t/**\n\t * \tChanges the pressed/unpressed images of the outer stick.\n\t * \t!setImage (unpressedImg: Drawable, pressedImg?: Drawable) : Stick;\n\t */\n\tsetImage: function (unpressedImg, pressedImg=null)\n\t{\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg || unpressedImg;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tChanges the pressed/unpressed images of the inner stick.\n\t * \t!setImageInner (unpressedImg: Drawable, pressedImg?: Drawable) : Stick;\n\t */\n\tsetImageInner: function (unpressedImg, pressedImg=null)\n\t{\n\t\tthis.unpressedImgInner = unpressedImg;\n\t\tthis.pressedImgInner = pressedImg || unpressedImg;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the number of angle-steps for the stick.\n\t * \t!setAngleSteps (n: number) : Stick;\n\t */\n\tsetAngleSteps: function (n)\n\t{\n\t\tthis.angleSteps = n;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the number of radius-steps for the stick.\n\t * \t!setRadiusSteps (n: number) : Stick;\n\t */\n\tsetRadiusSteps: function (n)\n\t{\n\t\tthis.radiusSteps = n;\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tSets the dead zone values (normalized).\n\t * \t!setDeadZone (deadZoneX: number, deadZoneY: number) : Stick;\n\t */\n\tsetDeadZone: function (deadZoneX, deadZoneY)\n\t{\n\t\tthis.deadZoneX = deadZoneX;\n\t\tthis.deadZoneY = deadZoneY;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tResets the button to its initial state.\n\t * \t!reset() : void;\n\t */\n\treset: function ()\n\t{\n\t\tthis.dispx = 0;\n\t\tthis.dispy = 0;\n\n\t\tthis.rdirx = 0;\n\t\tthis.rdiry = 0;\n\n\t\tthis.dirx = 0;\n\t\tthis.diry = 0;\n\t\tthis.magnitude = 0;\n\n\t\tif (this._onChange)\n\t\t\tthis._onChange (this.dirx, this.diry, this.magnitude, this.angle, this);\n\t},\n\n\t/**\n\t * \tRenders the stick in the canvas.\n\t * \t!renderStick (g: Canvas) : void;\n\t */\n\trenderStick: function (g, elem, img)\n\t{\n\t\tif (elem.isPressed)\n\t\t{\n\t\t\tif (elem.pressedImg)\n\t\t\t\telem.pressedImg.draw (g, elem.bounds.x1, elem.bounds.y1);\n\n\t\t\tif (elem.pressedImgInner)\n\t\t\t\telem.pressedImgInner.draw (g, elem.bounds.x1 + elem.dispx, elem.bounds.y1 + elem.dispy);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (elem.unpressedImg)\n\t\t\t\telem.unpressedImg.draw (g, elem.bounds.x1, elem.bounds.y1);\n\n\t\t\tif (elem.unpressedImgInner)\n\t\t\t\telem.unpressedImgInner.draw (g, elem.bounds.x1, elem.bounds.y1);\n\t\t}\n\t},\n\n\t/**\n\t * \tButton pointer update event. Not required for the button control.\n\t * \t!pointerUpdate (pointerX: number, pointerY: number, pointer: object) : void;\n\t */\n\tpointerUpdate: function (pointerX, pointerY)\n\t{\n\t\tlet dx, dy;\n\n\t\t/*if (true)\n\t\t{\n\t\t\tif (this.pointerRefX === null)\n\t\t\t{\n\t\t\t\tthis.pointerRefX = this.bounds.cx;\n\t\t\t\tthis.pointerRefY = this.bounds.cy;\n\t\t\t\tthis.pointerRefN = 0;\n\t\t\t}\n\n\t\t\tdx = pointerX - this.pointerRefX;\n\t\t\tdy = pointerY - this.pointerRefY;\n\n\t\t\tthis.pointerRefN++;\n\t\t\tthis.pointerRefX = (this.pointerRefX*this.pointerRefN + pointerX) / (this.pointerRefN+1);\n\t\t\tthis.pointerRefY = (this.pointerRefY*this.pointerRefN + pointerY) / (this.pointerRefN+1);\n\n\t\t\tthis.angle = Math.atan2(-dy, dx);\n\t\t\tthis.radius = this.maxRadius;\n\n\t\t\tthis.rdirx = Math.min(1, Math.max(dx / this.maxRadius, -1));\n\t\t\tthis.rdiry = Math.min(1, Math.max(dy / this.maxRadius, -1));\n\n\t\t\tthis.dispx = this.radius * Math.cos(this.angle);\n\t\t\tthis.dispy = this.radius * -Math.sin(this.angle);\n\n\t\t\tthis.dirx = this.dispx / this.radius;\n\t\t\tthis.diry = this.dispy / this.radius;\n\n\t\t\tthis.magnitude = 1.0;\n\n\t\t\tif (this._onChange)\n\t\t\t\tthis._onChange (this.dirx, this.diry, this.magnitude, this.angle, this);\n\n\t\t\treturn;\n\t\t}*/\n\n\t\tdx = pointerX - this.bounds.cx;\n\t\tdy = pointerY - this.bounds.cy;\n\n\t\tthis.angle = Math.atan2(-dy, dx);\n\t\tthis.radius = Math.sqrt(dx*dx + dy*dy);\n\n\t\tif (this.radius > this.maxRadius)\n\t\t\tthis.radius = this.maxRadius;\n\n\t\tif (this.angleSteps)\n\t\t{\n\t\t\tlet fs = (2*Math.PI / this.angleSteps);\n\t\t\tthis.angle = int((this.angle + Math.PI + fs/2) / fs) * fs - Math.PI;\n\t\t}\n\n\t\tif (this.radiusSteps)\n\t\t{\n\t\t\tlet fs = (this.maxRadius / this.radiusSteps);\n\t\t\tthis.radius = int((this.radius + fs/2) / fs) * fs;\n\t\t}\n\n\t\tthis.rdirx = Math.min(1, Math.max(dx / this.maxRadius, -1));\n\t\tthis.rdiry = Math.min(1, Math.max(dy / this.maxRadius, -1));\n\n\t\tthis.dispx = this.radius * Math.cos(this.angle);\n\t\tthis.dispy = this.radius * -Math.sin(this.angle);\n\n\t\tif (this.radius > 0)\n\t\t{\n\t\t\tthis.dirx = this.dispx / this.radius;\n\t\t\tthis.diry = this.dispy / this.radius;\n\n\t\t\tthis.magnitude = this.radius / this.maxRadius;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.dirx = 0;\n\t\t\tthis.diry = 0;\n\n\t\t\tthis.magnitude = 0;\n\t\t}\n\n\t\tif (Math.abs(this.rdirx) < this.deadZoneX) {\n\t\t\tthis.rdirx = 0;\n\t\t\tthis.dirx = 0;\n\t\t}\n\n\t\tif (Math.abs(this.rdiry) < this.deadZoneY) {\n\t\t\tthis.rdiry = 0;\n\t\t\tthis.diry = 0;\n\t\t}\n\n\t\tif (this._onChange)\n\t\t\tthis._onChange (this.dirx, this.diry, this.magnitude, this.angle, this);\n\t},\n\n\t/**\n\t * \tCalled when the PointerEventType.POINTER_DOWN event starts within the bounding box of the stick.\n\t * \t!pointerActivate (pointer: object) : void;\n\t */\n\tpointerActivate: function (pointer)\n\t{\n\t\tthis.wasPressed = this.isPressed;\n\t\tthis.isPressed = 1;\n\n\t\tthis.pointerUpdate(pointer.x, pointer.y);\n\t},\n\n\t/**\n\t * \tCalled when the PointerEventType.POINTER_UP event is fired with the \"_ref\" attribute pointing to this object.\n\t *\t!pointerDeactivate (pointer: object) : void;\n\t */\n\tpointerDeactivate: function (pointer)\n\t{\n\t\tthis.wasPressed = this.isPressed;\n\t\tthis.isPressed = 0;\n\n\t\tthis.reset();\n\t},\n\n\t/**\n\t * \tReturns `true` if the stick contains the specified point.\n\t * \t!containsPoint (x: number, y: number) : boolean;\n\t */\n\tcontainsPoint: function(x, y)\n\t{\n\t\tif (!this.visible())\n\t\t\treturn false;\n\n\t\treturn this.hitbox.bounds.containsPoint(x, y);\n\t},\n\n\t/**\n\t * \tSets the direction of the stick, the provided deltas should be normalized in the \\[-1, 1\\] range.\n\t * \t!setDirection (dx: number, dy: number, deadZoneX?: number, deadZoneY?: number) : boolean;\n\t */\n\tsetDirection: function (dx, dy, deadZoneX=0.10, deadZoneY=0.10)\n\t{\n\t\tif (Math.abs(dx) < deadZoneX) dx = 0;\n\t\tif (Math.abs(dy) < deadZoneY) dy = 0;\n\n\t\tthis.wasPressed = this.isPressed;\n\t\tthis.isPressed = dx == 0 && dy == 0 ? 0 : 1;\n\n\t\tthis.pointerUpdate (this.bounds.cx + dx*this.maxRadius, this.bounds.cy + dy*this.maxRadius);\n\t\treturn false;\n\t},\n\n\t/**\n\t * \tSaves the current state of the stick in the f* variables (fdirx, fdiry, etc). When the `lastValid` parameter is true, the values will\n\t * \tbe saved on each field only if the current value is not zero.\n\t * \t!freezeState (lastValid?: boolean) : Stick;\n\t */\n\tfreezeState: function (lastValid=false)\n\t{\n\t\tthis.frdirx = lastValid ? (this.rdirx != 0 ? this.rdirx : this.frdirx) : this.rdirx;\n\t\tthis.frdiry = lastValid ? (this.rdiry != 0 ? this.rdiry : this.frdiry) : this.rdiry;\n\t\tthis.fdirx = lastValid ? (this.dirx != 0 ? this.dirx : this.fdirx) : this.dirx;\n\t\tthis.fdiry = lastValid ? (this.diry != 0 ? this.diry : this.fdiry) : this.diry;\n\t\tthis.fmagnitude = lastValid ? (this.magnitude != 0 ? this.magnitude : this.fmagnitude) : this.magnitude;\n\t\tthis.fangle = lastValid ? (this.angle != 0 ? this.angle : this.fangle) : this.angle;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tKey down event, handles the keys that control the direction of the stick.\n\t * \t!keyDown (keyCode: System.KeyCode, keyArgs: object) : boolean|null;\n\t */\n\tkeyDown: function (keyCode, keyArgs)\n\t{\n\t\tlet dx = 0;\n\t\tlet dy = 0;\n\n\t\tif (keyArgs[KeyCode.UP] === true) dy = -this.maxRadius;\n\t\tif (keyArgs[KeyCode.LEFT] === true) dx = -this.maxRadius;\n\t\tif (keyArgs[KeyCode.DOWN] === true) dy = this.maxRadius;\n\t\tif (keyArgs[KeyCode.RIGHT] === true) dx = this.maxRadius;\n\n\t\tif (keyCode === KeyCode.UP || keyCode === KeyCode.LEFT || keyCode === KeyCode.DOWN || keyCode === KeyCode.RIGHT)\n\t\t{\n\t\t\tdx = this.bounds.cx + dx;\n\t\t\tdy = this.bounds.cy + dy;\n\n\t\t\tthis.wasPressed = this.isPressed;\n\t\t\tthis.isPressed = 1;\n\n\t\t\tthis.pointerUpdate (dx, dy);\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * \tKey up event, handles the keys that control the direction of the stick.\n\t * \t!keyUp (keyCode: System.KeyCode, keyArgs: object) : boolean|null;\n\t */\n\tkeyUp: function (keyCode, keyArgs)\n\t{\n\t\tlet dx = 0;\n\t\tlet dy = 0;\n\n\t\tif (keyArgs[KeyCode.UP] === true) dy = -this.maxRadius;\n\t\tif (keyArgs[KeyCode.LEFT] === true) dx = -this.maxRadius;\n\t\tif (keyArgs[KeyCode.DOWN] === true) dy = this.maxRadius;\n\t\tif (keyArgs[KeyCode.RIGHT] === true) dx = this.maxRadius;\n\n\t\tif (keyCode === KeyCode.UP || keyCode === KeyCode.LEFT || keyCode === KeyCode.DOWN || keyCode === KeyCode.RIGHT)\n\t\t{\n\t\t\tthis.pointerUpdate (this.bounds.cx + dx, this.bounds.cy + dy);\n\n\t\t\tif (dx === 0 && dy === 0)\n\t\t\t{\n\t\t\t\tthis.wasPressed = this.isPressed;\n\t\t\t\tthis.isPressed = 0;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * \tSets the handler for the on-change event. Executed after any change in the direction of the stick.\n\t * \t!onChange: (callback: (dirx: number, diry: number, magnitude: number, angle: number, stick: Stick) => void) => Stick;\n\t */\n\tonChange: function (callback)\n\t{\n\t\tthis._onChange = callback;\n\t\treturn this;\n\t}\n});\n","/*\n**\tfxl/world.js\n**\n**\tCopyright (c) 2016-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport System from '../system/system.js';\nimport Scene from '../flow/scene.js';\nimport Viewport from '../flow/viewport.js';\nimport Bounds2 from '../math/bounds2.js';\nimport GridContainer from '../flow/grid-container.js';\nimport Element from '../flow/element.js';\nimport Label from '../flow/label.js';\nimport Group from '../flow/group.js';\nimport Updater from '../flow/updater.js';\nimport SimpleContainer from '../flow/simple-container.js';\nimport Mask from '../flow/mask.js';\nimport system from './system.js';\nimport globals from '../system/globals.js';\n\n//!/**\n//! * \tWorld system allows to manage scenes, containers, viewports and display elements.\n//! */\n\n//!class world\n\nconst world =\n{\n\t/**\n\t * World scene constants.\n\t *\n\t * !static const SCENE_MAIN: number;\n\t * !static const SCENE_HUD: number;\n\t */\n\tSCENE_MAIN: 0,\n\tSCENE_HUD: 1,\n\n\t/**\n\t * Default layers for the SCENE_MAIN scene.\n\t *\n\t * !static const LAYER_BG0: number;\n\t * !static const LAYER_BG1: number;\n\t * !static const LAYER_BG2: number;\n\t * !static const LAYER_BG3: number;\n\t * !static const LAYER_BG4: number;\n\t * !static const LAYER_MAIN: number;\n\t * !static const LAYER_FG0: number;\n\t * !static const LAYER_FG1: number;\n\t * !static const LAYER_FG2: number;\n\t * !static const LAYER_FG3: number;\n\t * !static const LAYER_FG4: number;\n\t * !static const LAYER_MASK: number;\n\t */\n\tLAYER_BG0: 0,\n\tLAYER_BG1: 1,\n\tLAYER_BG2: 2,\n\tLAYER_BG3: 3,\n\tLAYER_BG4: 4,\n\tLAYER_MAIN: 5,\n\tLAYER_FG0: 6,\n\tLAYER_FG1: 7,\n\tLAYER_FG2: 8,\n\tLAYER_FG3: 9,\n\tLAYER_FG4: 10,\n\tLAYER_MASK: 11,\n\n\t/**\n\t * Default layers for the SCENE_HUD scene.\n\t *\n\t * !static const LAYER_HUD_BG0: number;\n\t * !static const LAYER_HUD_BG1: number;\n\t * !static const LAYER_HUD_BG2: number;\n\t * !static const LAYER_HUD_MAIN: number;\n\t * !static const LAYER_HUD_FG0: number;\n\t * !static const LAYER_HUD_FG1: number;\n\t * !static const LAYER_HUD_FG2: number;\n\t */\n \tLAYER_HUD_BG0: 0,\n\tLAYER_HUD_BG1: 1,\n\tLAYER_HUD_BG2: 2,\n\tLAYER_HUD_MAIN: 3,\n\tLAYER_HUD_FG0: 4,\n\tLAYER_HUD_FG1: 5,\n\tLAYER_HUD_FG2: 6,\n\n\t/**\n\t *\tRegistered scenes.\n\t */\n\t_scenes: [],\n\n\t/**\n\t * Active scene set by `selectScene`.\n\t * !static activeScene: Scene;\n\t */\n\tactiveScene: null,\n\n\t/**\n\t *\tRegistered viewports.\n\t */\n\t_viewports: [],\n\n\t/**\n\t * Active viewport set by `selectViewport`.\n\t * !static activeViewport: Viewport;\n\t */\n\tactiveViewport: null,\n\n\t/**\n\t * Active container set by `selectContainer`.\n\t * !static activeContainer: Container;\n\t */\n\tactiveContainer: null,\n\n\t/**\n\t * Currently active group (set by `createGroup`).\n\t * !static activeGroup: Group;\n\t */\n\tactiveGroup: null,\n\n\t/**\n\t * Last used group (set by `endGroup`).\n\t * !static lastGroup: Group;\n\t */\n\tlastGroup: null,\n\n\t/**\n\t * Last element created by `createElement`, or `createLabel`.\n\t * !static lastElement: Element;\n\t */\n\tlastElement: null,\n\n\t/**\n\t * Dimensions of the world.\n\t * !static readonly bounds: Bounds2;\n\t */\n\tbounds: Bounds2.Pool.alloc(),\n\n\t/**\n\t * Initializes the world with the default scenes, viewports and layers.\n\t * !static init (worldWidth?: number, worldHeight?: number, divisorX?: number, divisorY?: number) : void;\n\t */\n\tinit: function (worldWidth=32768, worldHeight=32768, divisorX=null, divisorY=null)\n\t{\n\t\tif (divisorX === null)\n\t\t\tdivisorX = Math.max(worldWidth, worldHeight) / 512;\n\n\t\tif (divisorX < 16)\n\t\t\tdivisorX = 16;\n\n\t\tif (divisorY !== null && divisorY < 16)\n\t\t\tdivisorY = 16;\n\n\t\tthis.bounds.zero().resize(worldWidth, worldHeight);\n\n\t\tthis.createScene(world.SCENE_MAIN);\n\t\tthis.setContainer(world.LAYER_BG0, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_BG1, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_BG2, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_BG3, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_BG4, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_MAIN, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_FG0, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_FG1, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_FG2, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_FG3, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.setContainer(world.LAYER_FG4, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\n\t\tthis.setContainer(world.LAYER_MASK, new GridContainer (worldWidth, worldHeight, divisorX, divisorY));\n\t\tthis.getContainer(world.LAYER_MASK).visible(false);\n\t\tthis.createViewport(0);\n\n\t\tthis.createScene(world.SCENE_HUD);\n\t\tthis.setContainer(world.LAYER_HUD_BG0, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_BG1, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_BG2, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_MAIN, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_FG0, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_FG1, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t\tthis.setContainer(world.LAYER_HUD_FG2, new SimpleContainer (system.screenWidth, system.screenHeight));\n\t},\n\n\t/**\n\t * Creates a scene at the specified index and automatically selects it.\n\t * !static createScene (index: number) : void;\n\t */\n\tcreateScene: function (index)\n\t{\n\t\tif (this._scenes[index])\n\t\t{\n\t\t\tSystem.queueRemove(this._scenes[index]);\n\t\t\tglobal.dispose(this._scenes[index]);\n\t\t}\n\n\t\tthis._scenes[index] = new Scene(index);\n\t\tSystem.queueAdd(this._scenes[index]);\n\n\t\tthis.selectScene(index);\n\t},\n\n\t/**\n\t * Returns the scene at the specified index (or the active scene if no index provided).\n\t * !static getScene (index?: number) : Scene;\n\t */\n\tgetScene: function (index=null)\n\t{\n\t\tif (index === null)\n\t\t\treturn this.activeScene;\n\n\t\tif (index < 0 || index >= this._scenes.length)\n\t\t\treturn null;\n\n\t\treturn this._scenes[index];\n\t},\n\n\t/**\n\t * Selects the active scene for subsequence scene-level operations.\n\t * !static selectScene (index: number) : boolean;\n\t */\n\tselectScene: function (index)\n\t{\n\t\tif (index < 0 || index >= this._scenes.length || !this._scenes[index])\n\t\t\treturn false;\n\n\t\tthis.activeScene = this._scenes[index];\n\t\tthis.activeContainer = null;\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * Creates a viewport at the specified index, attaches it to the active scene and selects it. Use this only after attaching all\n\t * containers to the scene or the `maxWidth` and `maxHeight` properties of the scene will not be properly set yet.\n\t *\n\t * !static createViewport (index: number) : void;\n\t */\n\tcreateViewport: function (index)\n\t{\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('createViewport: use `selectScene` first to select the active scene.');\n\n\t\tif (this._viewports[index])\n\t\t{\n\t\t\tglobal.dispose(this._viewports[index]);\n\t\t\tthis.activeScene.setViewport(index, null);\n\t\t}\n\n\t\tthis._viewports[index] = new Viewport(\n\t\t\t0, 0,\n\t\t\tsystem.screenWidth, system.screenHeight,\n\t\t\tthis.activeScene.maxWidth, this.activeScene.maxHeight\n\t\t);\n\n\t\tthis.activeScene.setViewport(index, this._viewports[index]);\n\n\t\tthis.selectViewport(index);\n\t},\n\n\t/**\n\t * Returns a viewport given its index (or the active viewport if no index provided).\n\t * !static getViewport (index?: number) : Viewport;\n\t */\n\tgetViewport: function (index=null)\n\t{\n\t\tif (index === null)\n\t\t\treturn this.activeViewport;\n\n\t\tif (index < 0 || index >= this._viewports.length)\n\t\t\treturn null;\n\n\t\treturn this._viewports[index];\n\t},\n\n\t/**\n\t * Selects the active viewport.\n\t * !static selectViewport (index: number) : boolean;\n\t */\n\tselectViewport: function (index)\n\t{\n\t\tif (index < 0 || index >= this._viewports.length || !this._viewports[index])\n\t\t\treturn false;\n\n\t\tthis.activeViewport = this._viewports[index];\n\t\treturn true;\n\t},\n\n\t/**\n\t * Sets a container in the active scene at the specified index and returns it.\n\t * !static setContainer (index: number, container: Container) : Container;\n\t */\n\tsetContainer: function (index, container)\n\t{\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('setContainer: use `selectScene` first to select the active scene.');\n\n\t\tthis.activeScene.setContainer (index, container);\n\t\treturn container;\n\t},\n\n\t/**\n\t * Returns the container at the specified index in the active scene (or the active container if no index provided).\n\t * !static getContainer (index?: number) : Container;\n\t */\n\tgetContainer: function (index=null, throwErrors=false)\n\t{\n\t\tif (index === null)\n\t\t{\n\t\t\tif (this.activeContainer === null && throwErrors)\n\t\t\t\tthrow new Error ('getContainer: container index not specified and default container not set.');\n\n\t\t\treturn this.activeContainer;\n\t\t}\n\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('getContainer: use `selectScene` first to select the active scene.');\n\n\t\tlet container = this.activeScene.getContainer(index);\n\t\tif (container === null && throwErrors)\n\t\t\tthrow new Error ('getContainer: container index out of bounds.');\n\n\t\treturn container;\n\t},\n\n\t/**\n\t * Selects the active container.\n\t * !static selectContainer (index: number) : boolean;\n\t */\n\tselectContainer: function (index)\n\t{\n\t\tthis.activeContainer = this.getContainer(index, true);\n\t\treturn this.activeContainer !== null;\n\t},\n\n\t/**\n\t * Changes the visibility of the LAYER_MASK to enable (or disable) mask bounds rendering.\n\t * @param {boolean} value\n\t * @param {boolean} allMasks If set to `false` only masks having `debugBounds` to non-false will be drawn.\n\t * !static showMasks (value: boolean, allMasks?: boolean) : void;\n\t */\n\tshowMasks: function (value, allMasks=true)\n\t{\n\t\tworld.getScene(world.SCENE_MAIN).getContainer(world.LAYER_MASK).visible(value);\n\t\tglobals.debugMasks = allMasks;\n\t},\n\n\t/**\n\t * Creates a group in the active scene and selects it as the active group.\n\t * !static createGroup (id?: string) : Group;\n\t */\n\tcreateGroup: function(id=null)\n\t{\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('createGroup: use selectScene first to select the active scene.');\n\n\t\tthis.activeGroup = Group.Pool.alloc(id);\n\t\tthis.activeScene.addGroup (this.activeGroup);\n\n\t\treturn this.activeGroup;\n\t},\n\n\t/**\n\t * If coordinates are provided the group will be translated to the specified position. It will then set `lastGroup`, and nullify `activeGroup`.\n\t * !static endGroup (x?: number, y?: number) : Group;\n\t */\n\tendGroup: function(x=null, y=null)\n\t{\n\t\tif (x !== null && y !== null)\n\t\t\tthis.activeGroup.translate(x, y);\n\n\t\tthis.lastGroup = this.activeGroup;\n\t\tthis.activeGroup = null;\n\n\t\treturn this.lastGroup.sync();\n\t},\n\n\t/**\n\t * Creates a named Element and adds it to the specified container (or the active one) in the active scene.\n\t * If a group is active, the element will be attached to the group.\n\t * \n\t * !static createElement (id: string, x: number, y: number, img?: Drawable, containerIndex?: number) : Element;\n\t */\n\t/**\n\t * Creates an Element and adds it to the specified container (or the active one) in the active scene.\n\t * If a group is active, the element will be attached to the group.\n\t * \n\t * !static createElement (x: number, y: number, img?: Drawable, containerIndex?: number) : Element;\n\t */\n\tcreateElement: function (id, x, y, img=null, containerIndex=null)\n\t{\n\t\tif (typeof(id) !== 'string')\n\t\t{\n\t\t\tcontainerIndex = img;\n\t\t\timg = y;\n\t\t\ty = x;\n\t\t\tx = id;\n\t\t\tid = null;\n\t\t}\n\n\t\tlet container = this.getContainer(containerIndex);\n\n\t\tlet elem = Element.Pool.alloc(x, y, img);\n\t\tcontainer.add(elem.setId(id));\n\n\t\tif (this.activeGroup !== null)\n\t\t\tthis.activeGroup.addChild(elem);\n\n\t\tthis.lastElement = elem;\n\t\treturn elem;\n\t},\n\n\t/**\n\t * Creates a named mask and adds it to the specified container or LAYER_MASK if none provided.\n\t * If a group is active, the mask will be attached to the group.\n\t * \n\t * !static createMask (id: string, type: number, x?: number, y?: number, width?: number, height?: number, containerIndex?: number) : Mask;\n\t */\n\tcreateMask: function (id, type, x=null, y=null, width=null, height=null, containerIndex=null)\n\t{\n\t\tlet container = this.getContainer(containerIndex || world.LAYER_MASK);\n\n\t\tif (x === null)\n\t\t{\n\t\t\tif (this.activeGroup === null)\n\t\t\t\tthrow new Error ('createMask: create a group first to use default masks.');\n\n\t\t\tx = this.activeGroup.bounds.x1;\n\t\t\ty = this.activeGroup.bounds.y1;\n\t\t\twidth = this.activeGroup.bounds.width();\n\t\t\theight = this.activeGroup.bounds.height();\n\t\t}\n\n\t\tlet mask = Mask.Pool.alloc(type, x, y, width, height);\n\t\tcontainer.add(mask.setId(id));\n\n\t\tif (this.activeGroup !== null)\n\t\t\tthis.activeGroup.addChild(mask);\n\n\t\treturn mask;\n\t},\n\n\t/**\n\t * Creates a named label element and adds it to the specified container (or the active one) in the active scene.\n\t * If a group is active, the label element will be attached to the group.\n\t * \n\t * !static createLabel (id: string, x: number, y: number, font: object, text: string, containerIndex?: number) : Label;\n\t */\n\t/**\n\t * Creates a label element and adds it to the specified container (or the active one) in the active scene.\n\t * If a group is active, the label element will be attached to the group.\n\t * \n\t * !static createLabel (x: number, y: number, font: object, text: string, containerIndex?: number) : Label;\n\t */\n\tcreateLabel: function (id, x, y, font, text, containerIndex=null)\n\t{\n\t\tif (typeof(id) !== 'string')\n\t\t{\n\t\t\tcontainerIndex = text;\n\t\t\ttext = font;\n\t\t\tfont = y;\n\t\t\ty = x;\n\t\t\tx = id;\n\t\t\tid = null;\n\t\t}\n\n\t\tlet container = this.getContainer(containerIndex);\n\n\t\tlet elem = Label.Pool.alloc(x, y, font, text);\n\t\tcontainer.add(elem.setId(id));\n\n\t\tif (this.activeGroup !== null)\n\t\t\tthis.activeGroup.addChild(elem);\n\n\t\tthis.lastElement = elem;\n\t\treturn elem;\n\t},\n\n\t/**\n\t * Creates a new updater, attaches it to the active scene and returns it.\n\t * !static createUpdater (update?: (elem: Element, dt: number, context: object) => boolean, context?: object) : Updater;\n\t */\n\tcreateUpdater: function (update=null, context=null)\n\t{\n\t\tif (this.activeScene === null)\n\t\t\tthrow new Error ('createUpdater: use selectScene first to select the active scene.');\n\n\t\treturn new Updater (this.activeScene, update, context);\n\t}\n};\n\n//!/class\n\nexport default world;\n","\n//!/**\n//! * Registered resources. Initially these are resource descriptors, but after a call to `res.load` these will be fully loaded resources.\n//! */\n//:declare const r : { \\[key: string\\]: any };\n\nconst r = {\n};\n\nexport default r;\n","\nimport Resources from '../resources/resources.js';\n\nimport r from './r.js';\n\n/**\n * \tResource manager allows to specify resource descriptors to load them.\n */\n\n//!class res\n\nconst res =\n{\n\t/**\n\t * Configures the resources object with the specified options.\n\t * !static config (options: Resources.ConfigOptions) : void;\n\t */\n\tconfig: function (opts)\n\t{\n\t\tResources.config(opts);\n\t},\n\n\t/**\n\t * \tLoads all registered resources that have not been loaded yet.\n\t * \t!static load (progressCallback?: (level: number, resourceName: string) => void) : Promise<void>;\n\t */\n\tload: function(progressCallback=null)\n\t{\n\t\treturn new Promise (function (resolve, reject)\n\t\t{\n\t\t\tResources.load (r,\n\t\t\t\tfunction (index, total, value, name) {\n\t\t\t\t\tif (progressCallback) progressCallback(value, name);\n\t\t\t\t},\n\t\t\t\tfunction () {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t},\n\n\t/**\n\t * \tReturns a resource given its identifier.\n\t * \t@param id - Resource identifier.\n\t * \t!static get (id: string) : object;\n\t */\n\tget: function (id)\n\t{\n\t\treturn r[id];\n\t},\n\n\t/**\n\t * \tChecks if the ID exists in the fxl `r` map, throws an error if it does.\n\t */\n\t__resIdMustNotExist: function (id)\n\t{\n\t\tif (id in r) throw new Error ('Resource identifier `' + id + '` is already in use');\n\t},\n\n\t/**\n\t * \tRegisters a solid-color resource.\n\t * \t@param id - Resource identifier.\n\t * \n\t * \t!static color (id: string, color: string, width: number, height: number) : object;\n\t */\n\tcolor: function (id, color, width, height)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'object', wrapper: 'Custom', color: color, width: width, height: height };\n\t},\n\n\t/**\n\t * \tRegisters a custom drawable resource.\n\t * \t@param id - Resource identifier.\n\t * \n\t * \t!static custom (id: string, width: number, height: number, drawFunction: (g: Canvas) => void) : object;\n\t */\n\tcustom: function (id, width, height, drawFunction, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'object', wrapper: 'Custom', width: width, height: height, draw: drawFunction, ...opts };\n\t},\n\n\t/**\n\t * \tRegisters an image resource.\n\t * \t@param id - Resource identifier.\n\t * \n\t * \t!static image (id: string, path: string, opts?: object) : object;\n\t */\n\timage: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'image', wrapper: 'Drawable', src: path, ...opts };\n\t},\n\n\t/**\n\t * \tRegisters a multi image resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file. Ensure to add the \"#\" marks to replace the file index (i.e. \"image-##.png\").\n\t * \t@param count - Number of images to load (from 0 to count-1).\n\t * \n\t * \t!static images (id: string, path: string, count: number, frameWidth?: number, frameHeight?: number, optsA?: object, optsB?: object) : object;\n\t */\n\timages: function (id, path, count, frameWidth=null, frameHeight=null, optsA=null, optsB=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\t\treturn r[id] = { type: 'images', wrapper: 'Spritesheet', src: path, count: count, width: frameWidth, height: frameHeight,\n\t\t\tconfig: {\n\t\t\t\tframeWidth: frameWidth, frameHeight: frameHeight, ...optsA\n\t\t\t},\n\t\t\t...optsB\n\t\t};\n\t},\n\n\t/**\n\t * \tRegisters an spritesheet resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static spritesheet (id: string, path: string, frameWidth: number, frameHeight: number, numFrames?: number, optsA?: object, optsB?: object) : object;\n\t */\n\tspritesheet: function (id, path, frameWidth, frameHeight, numFrames=0, optsA=null, optsB=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'image', wrapper: 'Spritesheet', src: path,\n\t\t\tconfig: {\n\t\t\t\tframeWidth: frameWidth, frameHeight: frameHeight, numFrames: numFrames, ...optsA\n\t\t\t},\n\t\t\t...optsB\n\t\t};\n\t},\n\n\t/**\n\t * \tRegisters a spritesheet animation resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static animation (id: string, path: string, frameWidth: number, frameHeight: number, numFrames?: number, configOptions?: object, resOptions?: object) : object;\n\t */\n\tanimation: function (id, path, frameWidth, frameHeight, numFrames=null, configOptions=null, resOptions=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'image', wrapper: 'SpritesheetAnimation', src: path,\n\t\t\tconfig: {\n\t\t\t\tframeWidth: frameWidth, frameHeight: frameHeight, numFrames: numFrames, ...configOptions\n\t\t\t},\n\n\t\t\tanim: {\n\t\t\t\tdef: null, fps: 15, seq: { }, trans: { }\n\t\t\t},\n\n\t\t\t...resOptions,\n\n\t\t\tfps: function(value) {\n\t\t\t\tthis.anim.fps = value;\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\tseq: function(id, loop, group, fps=null)\n\t\t\t{\n\t\t\t\tthis.anim.seq[id] = { loop: loop, group: group };\n\n\t\t\t\tif (fps !== null)\n\t\t\t\t\tthis.anim.seq[id].fps = fps;\n\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\ttrans: function(srcSeq, dstSeq, group)\n\t\t\t{\n\t\t\t\tif (!(srcSeq in this.anim.trans))\n\t\t\t\t\tthis.anim.trans[srcSeq] = { };\n\n\t\t\t\tthis.anim.trans[srcSeq][dstSeq] = group;\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\tdef: function(value) {\n\t\t\t\tthis.anim.def = value;\n\t\t\t\treturn this;\n\t\t\t}\n\t\t};\n\t},\n\n\t/**\n\t * \tRegisters a spritefont animation resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static spritefont (id: string, path: string, charWidth: number, charHeight: number, charset: string, optsA?: object, optsB?: object) : object;\n\t */\n\tspritefont: function (id, path, charWidth, charHeight, charset, optsA=null, optsB=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\t\t\n\t\treturn r[id] = { type: 'image', wrapper: 'SpriteFont', src: path,\n\t\t\tfont: {\n\t\t\t\tcharWidth: charWidth, charHeight: charHeight, charset: charset, ...optsA\n\t\t\t},\n\t\t\t...optsB\n\t\t};\n\t},\n\n\t/**\n\t * \tRegisters a JSON data resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static json (id: string, path: string, opts?: object) : object;\n\t */\n\tjson: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'json', src: path, ...opts };\n\t},\n\n\t/**\n\t * \tRegisters a binary data resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static data (id: string, path: string, opts?: object) : object;\n\t */\n\tdata: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'data', src: path, ...opts };\n\t},\n\n\t/**\n\t * \tRegisters a text data resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static text (id: string, path: string, opts?: object) : object;\n\t */\n\ttext: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'text', src: path, ...opts };\n\t},\n\n\t/**\n\t * \tRegisters a sound effect audio resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static sfx (id: string, path: string, opts?: object) : object;\n\t */\n\tsfx: function (id, path, opts=null)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'audio', wrapper: 'Sound', src: path, track: 'sfx', ...opts };\n\t},\n\n\t/**\n\t * \tRegisters a multi sound effect audio resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file. Ensure to add the \"#\" marks to replace the file index (i.e. \"sound-##.ogg\").\n\t * \t@param count - Number of sounds to load (from 0 to count-1).\n\t * \t@param mode - Playback mode, can be `sequential` (default) or `random`.\n\t * \n\t * \t!static sfxm (id: string, path: string, count: number, mode?: string) : object;\n\t */\n\tsfxm: function (id, path, count, mode='sequential')\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\t\treturn r[id] = { type: 'audios', wrapper: 'SoundArray', src: path, count: count, track: 'sfx', mode: mode };\n\t},\n\n\t/**\n\t * \tRegisters an music audio resource.\n\t * \t@param id - Resource identifier.\n\t * \t@param path - Path to the source file.\n\t * \n\t * \t!static music (id: string, path: string) : object;\n\t */\n\tmusic: function (id, path)\n\t{\n\t\tthis.__resIdMustNotExist(id);\n\n\t\treturn r[id] = { type: 'audio', wrapper: 'Sound', src: path, track: 'music' };\n\t}\n};\n\nexport default res;\n","/*\n**\tfxl/gamepad.js\n**\n**\tCopyright (c) 2016-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Class } from 'rinn';\nimport Stick from '../flow/stick.js';\nimport Button from '../flow/button.js';\n\n//![import '../flow/stick.js']\n//![import '../flow/button.js']\n\n/**\n * Gamepads are input objects that allow sticks and buttons to be added to it.\n */\n\n//!class Gamepad\n\nconst Gamepad = Class.extend\n({\n\t/**\n\t * Contains the sticks of the gamepad.\n\t * !readonly sticks: { \\[key:string\\]: Stick };\n\t */\n\tsticks: null,\n\n\t/**\n\t * Contains the buttons of the gamepad.\n\t * !readonly buttons: { \\[key:string\\]: Button };\n\t */\n\tbuttons: null,\n\n\t/**\n\t * World scene where the container is defined.\n\t */\n\tscene: null,\n\n\t/**\n\t * Container where the gamepad controls will be created.\n\t */\n\tcontainer: null,\n\n\t/**\n\t * Indicates the visible state of the gamepad.\n\t */\n\t_visible: true,\n\n\t/**\n\t * Constructs a new gamepad object.\n\t * !constructor (scene: Scene, containerIndex: number);\n\t */\n\t__ctor: function(scene, containerIndex)\n\t{\n\t\tthis.sticks = { };\n\t\tthis.buttons = { };\n\n\t\tthis.scene = scene;\n\t\tthis.layer = scene.getContainer(containerIndex);\n\t},\n\n\t/**\n\t * Creates a new stick control and adds it to the gamepad.\n\t * !addStick (id: string, x: number, y: number, outerDrawable: Drawable, innerDrawable: Drawable, maxRadius:number=0) : Stick;\n\t */\n\taddStick: function (id, x, y, outerDrawable, innerDrawable, maxRadius=0)\n\t{\n\t\tif (maxRadius == 0)\n\t\t\tmaxRadius = outerDrawable.width - innerDrawable.width;\n\n\t\tlet stick = new Stick (this.layer, x, y, maxRadius, outerDrawable, innerDrawable);\n\n\t\tthis.sticks[id] = stick;\n\t\tthis[id] = stick;\n\n\t\treturn stick;\n\t},\n\n\t/**\n\t * Creates a new button control and adds it to the gamepad.\n\t * !addButton (id: string, x: number, y: number, unpressedDrawable?: Drawable, pressedDrawable?: Drawable) : Button;\n\t */\n\taddButton: function (id, x, y, unpressedDrawable=null, pressedDrawable=null)\n\t{\n\t\tlet button = new Button (this.layer, x, y, unpressedDrawable, pressedDrawable);\n\n\t\tthis.buttons[id] = button;\n\t\tthis[id] = button;\n\n\t\treturn button;\n\t},\n\n\t/**\n\t * Returns the `visible` property of the gamepad.\n\t * !visible() : boolean;\n\t */\n\t/**\n\t * Sets the `visible` property of the gamepad.\n\t * !visible (value: boolean) : Gamepad;\n\t */\n\tvisible: function (value=null)\n\t{\n\t\tif (value === null)\n\t\t\treturn this._visible;\n\n\t\tthis._visible = value;\n\n\t\tfor (let i in this.sticks)\n\t\t\tthis.sticks[i].visible(value);\n\n\t\tfor (let i in this.buttons)\n\t\t\tthis.buttons[i].visible(value);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * Sets the `visible` property of all masks to the specified value.\n\t * !showMasks (value: boolean) : Gamepad;\n\t */\n\tshowMasks: function (value)\n\t{\n\t\tfor (let i in this.sticks)\n\t\t\tthis.sticks[i].hitbox.visible(value, true);\n\n\t\tfor (let i in this.buttons)\n\t\t\tthis.buttons[i].hitbox.visible(value, true);\n\n\t\treturn this;\n\t}\n});\n\n//!/class\n\nexport default Gamepad;\n","/*\n**\tfxl/input.js\n**\n**\tCopyright (c) 2016-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport PointerHandler from '../flow/pointer-handler.js';\nimport world from './world.js';\nimport system from './system.js';\nimport Gamepad from './gamepad.js';\n\n//!namespace input\n//:[import './gamepad.js']\n//!/namespace\n\n//!class input\n\n/**\n *\tInput system allows to create gamepads and manage the system cursor.\n */\n\nconst input =\n{\n\t/**\n\t * Registered gamepads.\n\t */\n\t_gamepads: [],\n\n\t/**\n\t * Currently active gamepad.\n\t * !static activeGamepad: input.Gamepad;\n\t */\n\tactiveGamepad: null,\n\n\t/**\n\t * Last created button.\n\t * !static lastButton: Button;\n\t */\n\tlastButton: null,\n\n\t/**\n\t * Last created stick.\n\t * !static lastStick: Stick;\n\t */\n\tlastStick: null,\n\n\t/**\n\t * Cursor object, used to control the state of the single-cursor input.\n\t */\n\tcursor:\n\t{\n\t\t/**\n\t\t * Indicates if the single-cursor input has been enabled.\n\t\t */\n\t\t_enabled: null,\n\n\t\t/**\n\t\t * Handler callback for cursor events.\n\t\t */\n\t\t_handler: null,\n\n\t\t/**\n\t\t * Cursor element used when the single-cursor input is enabled.\n\t\t */\n\t\t_element: null,\n\n\t\t/**\n\t\t * Pointer state related to the cursor when single-cursor input is enabled.\n\t\t */\n\t\tpointer: null,\n\n\t\t/**\n\t\t * Returns the element used for single-cursor input.\n\t\t */\n\t\telement: function (elem=false)\n\t\t{\n\t\t\tif (elem === false)\n\t\t\t\treturn this._element;\n\n\t\t\tthis._element = elem;\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Hides or shows the native cursor.\n\t\t */\n\t\tnative: function (value)\n\t\t{\n\t\t\tif (!value && system.renderer.elem.style.cursor !== 'none')\n\t\t\t\tsystem.renderer.elem.style.cursor = 'none';\n\t\t\telse if (value && system.renderer.elem.style.cursor === 'none')\n\t\t\t\tsystem.renderer.elem.style.removeProperty('cursor');\n\t\t},\n\n\t\t/**\n\t\t * Enables or disables the single-cursor input.\n\t\t */\n\t\tenabled: function (value=null)\n\t\t{\n\t\t\tif (value === null)\n\t\t\t\treturn this._enabled;\n\n\t\t\tif (this._enabled === value)\n\t\t\t\treturn this;\n\n\t\t\tthis._enabled = value;\n\n\t\t\tif (value === true)\n\t\t\t{\n\t\t\t\tif (this._element !== null)\n\t\t\t\t\tsystem.renderer.elem.style.cursor = 'none';\n\n\t\t\t\tPointerHandler.register(this.pointerHandler);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsystem.renderer.elem.style.removeProperty('cursor');\n\t\t\t\tPointerHandler.unregister(this.pointerHandler);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Sets the callback to execute when a cursor event happens.\n\t\t * @param { (action:number, pointer:object) => void } callback\n\t\t */\n\t\thandler: function (callback)\n\t\t{\n\t\t\tthis._handler = callback;\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Pointer event handler for single-cursor input.\n\t\t */\n\t\tpointerHandler:\n\t\t{\n\t\t\tpriority: 50,\n\n\t\t\tonPointerEvent: function (action, pointer, pointers)\n\t\t\t{\n\t\t\t\tif (!input.cursor._enabled)\n\t\t\t\t\treturn;\n\n\t\t\t\tinput.cursor.pointer = pointer;\n\n\t\t\t\tif (input.cursor._element !== null)\n\t\t\t\t\tinput.cursor._element.setPosition(pointer.x, pointer.y);\n\n\t\t\t\tif (input.cursor._handler !== null)\n\t\t\t\t\tinput.cursor._handler (action, pointer);\n\t\t\t},\n\t\t},\n\t},\n\n\t/**\n\t * Creates a gamepad object and attaches it to the SCENE_HUD in the specified layer (defaults to LAYER_HUD_MAIN).\n\t * !static createGamepad (index: number, layerIndex?: number) : input.Gamepad;\n\t */\n\tcreateGamepad: function (index, layerIndex=null)\n\t{\n\t\tlayerIndex = layerIndex !== null ? layerIndex : world.LAYER_HUD_MAIN;\n\n\t\tworld.selectScene(world.SCENE_HUD);\n\t\tworld.selectContainer(layerIndex);\n\n\t\tthis._gamepads[index] = new Gamepad (world.activeScene, layerIndex);\n\t\tthis.selectGamepad(index);\n\n\t\treturn this.activeGamepad;\n\t},\n\n\t/**\n\t * Returns a gamepad given its index.\n\t * !static getGamepad (index: number) : input.Gamepad;\n\t */\n\tgetGamepad: function (index)\n\t{\n\t\tif (index < 0 || index >= this._gamepads.length)\n\t\t\treturn null;\n\n\t\treturn this._gamepads[index] || null;\n\t},\n\n\t/**\n\t * Selects the active gamepad for subsequent gamepad-level operations.\n\t * !static selectGamepad (index: number) : boolean;\n\t */\n\tselectGamepad: function (index)\n\t{\n\t\tthis.activeGamepad = this.getGamepad(index);\n\t\treturn true;\n\t},\n\n\t/**\n\t * Sets the value of `debugBounds` on the specified gamepad. If index is `null`, all gamepads will be selected.\n\t * !static debugGamepad (index: number, value: boolean) : void;\n\t */\n\tdebugGamepad: function (index, value)\n\t{\n\t\tif (index === null)\n\t\t{\n\t\t\tfor (let i = 0; i < this._gamepads.length; i++)\n\t\t\t{\n\t\t\t\tif (!this._gamepads[i])\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis.debugGamepad(i, value);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis._gamepads[index].debug(value);\n\t},\n\n\t/**\n\t * Adds an stick control to the active gamepad.\n\t * !static stick (id: string, x: number, y: number, outerDrawable: Drawable, innerDrawable: Drawable, maxRadius?: number) : Stick;\n\t */\n\tstick: function (id, x, y, outerDrawable, innerDrawable, maxRadius=0)\n\t{\n\t\tif (this.activeGamepad === null)\n\t\t\tthrow new Error ('input.addStick: use input.selectGamepad first to select the active gamepad.');\n\n\t\treturn this.lastStick = this.activeGamepad.addStick (id, x, y, outerDrawable, innerDrawable, maxRadius);\n\t},\n\n\t/**\n\t * Adds a button control to the active gamepad.\n\t * !static button (id: string, x: number, y: number, unpressedDrawable?: Drawable, pressedDrawable?: Drawable) : Button;\n\t */\n\tbutton: function (id, x, y, unpressedDrawable=null, pressedDrawable=null)\n\t{\n\t\tif (this.activeGamepad === null)\n\t\t\tthrow new Error ('input.addButton: use input.selectGamepad first to select the active gamepad.');\n\n\t\treturn this.lastButton = this.activeGamepad.addButton (id, x, y, unpressedDrawable, pressedDrawable);\n\t}\n};\n\n//!/class\n\nexport default input;\n","\nimport Bounds2 from '../math/bounds2.js';\nimport GridElement from '../flow/grid-element.js';\nimport Handler from '../utils/handler.js';\n\nimport world from './world.js';\n\n/**\n * \tMask used to isolate the super-type of a type.\n */\nconst SUPER_TYPE_MASK = 0xFFFFF000;\n\n/**\n * \tThe collider system is responsible of detecting collisions and performing the respective actions.\n */\n\n//!class collider\n\nconst collider =\n{\n\t/**\n\t * \tFlag used to exclude from collision checks.\n\t *\t!static readonly FLAG_EXCLUDE: number;\n\t */\n\tFLAG_EXCLUDE: GridElement.allocFlag(),\n\n\t/**\n\t * \tContact rules, define what to do when certain types of elements are in contact.\n\t */\n\tcontactRules: { },\n\n\t/**\n\t * \tTruncation rules, indicate which type of elements are not allowed to penetrate each other.\n\t */\n\ttruncationRules: { },\n\n\t/**\n\t *\tScene where the mask layer is contained.\n\t */\n\tscene: null,\n\n\t/**\n\t *\tLayer containing the element masks.\n\t */\n\tmaskLayer: null,\n\n\t/**\n\t *\tFirst updater.\n\t *\t!static fupdater: Handler;\n\t */\n\tfupdater: null,\n\n\t/**\n\t *\tLast updater.\n\t *\t!static lupdater: Handler;\n\t */\n\tlupdater: null,\n\n\t/**\n\t *\tFlags used to filter elements.\n\t *\t!static flagsAnd: number;\n\t *\t!static flagsValue: number;\n\t */\n\tflagsAnd: 0,\n\tflagsValue: 0,\n\n\t/**\n\t *\tCurrent collider state fields.\n\t *\t!static state: {\n\t */\n\tstate:\n\t{\n\t\t/**\n\t\t * \tContact area.\n\t\t *\t!contact: Bounds2;\n\t\t */\n\t\tcontact: Bounds2.Pool.alloc(),\n\n\t\t/**\n\t\t * \tContact flags.\n\t\t * \t!flags: collider.Contact;\n\t\t */\n\t\tflags: 0,\n\n\t\t/**\n\t\t * \tFinal delta value for X-coordinate calculated by `translate`.\n\t\t *\t!dx: number;\n\t\t */\n\t\tdx: 0,\n\n\t\t/**\n\t\t * \tFinal delta value for Y-coordinate calculated by `translate`.\n\t\t *\t!dy: number;\n\t\t */\n\t\tdy: 0,\n\n\t\tbounds: Bounds2.Pool.alloc(),\n\n\t\tx: new Array(32).fill(0),\n\t\ty: new Array(32).fill(0),\n\t\tv0x: new Array(32).fill(0),\n\t\tv0y: new Array(32).fill(0),\n\t\tv1x: new Array(32).fill(0),\n\t\tv1y: new Array(32).fill(0),\n\t\tv2x: new Array(32).fill(0),\n\t\tv2y: new Array(32).fill(0),\n\n\t\tcount: 0,\n\t\ttarget: 0,\n\n\t\tv0: 0, w0: 0, delta0: 0,\n\t\tv1: 0, w1: 0, delta1: 0,\n\n\t\tw2: 0,\n\t\tt_dx: 0,\n\t\tt_dy: 0,\n\t},\n\t//:}\n\n\t/**\n\t *\tEnables the collider system on the specified scene and layer.\n\t * \t@param sceneIndex - Scene to attach the collider updater methods. Uses world.SCENE_MAIN if none specified.\n\t * \t@param layerIndex - Index within the scene of the layer where element masks are stored. Uses world.LAYER_MASK if none specified.\n\t * \t!static enable (sceneIndex?: number, layerIndex?: number) : void;\n\t */\n\tenable: function(sceneIndex=null, layerIndex=null)\n\t{\n\t\tthis.scene = world.getScene(sceneIndex || world.SCENE_MAIN);\n\t\tthis.maskLayer = this.scene.getContainer(layerIndex || world.LAYER_MASK);\n\n\t\tthis.flagsAnd = GridElement.ALIVE | GridElement.VISIBLE | collider.FLAG_EXCLUDE;\n\t\tthis.flagsValue = GridElement.ALIVE | GridElement.VISIBLE;\n\n\t\tthis.scene.fupdater.add(this.firstUpdate, this);\n\t\tthis.scene.lupdater.add(this.lastUpdate, this);\n\n\t\tthis.fupdater = Handler.Pool.alloc(this);\n\t\tthis.lupdater = Handler.Pool.alloc(this);\n\t},\n\n\t/**\n\t *\tDisables the collider system.\n\t *\t!static disable() : void;\n\t */\n\tdisable: function()\n\t{\n\t\tthis.scene.fupdater.remove(this.update, this);\n\t\tthis.maskLayer = null;\n\n\t\tthis.fupdater.free();\n\t\tthis.lupdater.free();\n\t},\n\n\t/**\n\t * \tRuns a first update cycle `fupdater` will be executed.\n\t */\n\tfirstUpdate: function(scene, self)\n\t{\n\t\tself.fupdater.exec();\n\t},\n\n\t/**\n\t * \tRuns a last update cycle `lupdater` will be executed.\n\t */\n\tlastUpdate: function(scene, self)\n\t{\n\t\tself.lupdater.exec();\n\t},\n\n\t/**\n\t * \tUtility object containing actions that are executed later on the next update cycle.\n\t * \t!static later: {\n\t */\n\tlater:\n\t{\n\t\t/**\n\t\t *\tRuns the specified callback.\n\t\t *\t!run (elem: Element, callback: Function, arg1?: any, arg2?: any, arg3?: any) : void;\n\t\t */\n\t\trun: function (elem, callback, arg1, arg2, arg3)\n\t\t{\n\t\t\tcollider.fupdater.add(this._run, elem, callback, arg1, arg2, arg3);\n\t\t},\n\n\t\t/**\n\t\t *\tSets the element's visibility flag.\n\t\t * \t!setVisible (elem: Element, value: boolean) : void;\n\t\t */\n\t\tsetVisible: function (elem, value)\n\t\t{\n\t\t\tcollider.fupdater.add(this._setVisible, elem, value);\n\t\t},\n\n\t\t/**\n\t\t *\tSets an attribute of an object to a given value.\n\t\t * \t!setValue (obj: Object, name: string, value: any) : void;\n\t\t */\n\t\tsetValue: function (obj, name, value)\n\t\t{\n\t\t\tcollider.fupdater.add(this._setValue, obj, name, value);\n\t\t},\n\n\t\t/**\n\t\t *\tSets the element's flags.\n\t\t *\t!setFlags (elem: Element, value: number) : void;\n\t\t */\n\t\tsetFlags: function (elem, value)\n\t\t{\n\t\t\tcollider.fupdater.add(this._setFlags, elem, value);\n\t\t},\n\n\t\t/**\n\t\t *\tClears the element's flags.\n\t\t * \t!clearFlags (elem: Element, value: number) : void;\n\t\t */\n\t\tclearFlags: function (elem, value)\n\t\t{\n\t\t\tcollider.fupdater.add(this._clearFlags, elem, value);\n\t\t},\n\n\t\t/* ******* */\n\n\t\t_run: function (host, elem, callback, arg1, arg2, arg3)\n\t\t{\n\t\t\tcallback (host, elem, arg1, arg2, arg3);\n\t\t\treturn false;\n\t\t},\n\n\t\t_setVisible: function (host, elem, value)\n\t\t{\n\t\t\telem.visible(value);\n\t\t\treturn false;\n\t\t},\n\n\t\t_setValue: function (host, obj, name, value)\n\t\t{\n\t\t\tobj[name] = value;\n\t\t\treturn false;\n\t\t},\n\n\t\t_setFlags: function (host, elem, value)\n\t\t{\n\t\t\telem.setFlags(value);\n\t\t\treturn false;\n\t\t},\n\n\t\t_clearFlags: function (host, elem, value)\n\t\t{\n\t\t\telem.clearFlags(value);\n\t\t\treturn false;\n\t\t}\n\t},\n\t//!}\n\n\t/**\n\t * \tAdds a contact rule.\n\t * \t@param primaryType - Type of the primary element.\n\t * \t@param secondaryType - Type of the secondary element.\n\t * \t@param callback - Callback to execute when contact is detected.\n\t * \t@param context - Optional value passed as last parameter to the callback.\n\t * \t!static contact (primaryType: number, secondaryType: number, callback: (primary: Mask, secondary: Mask, context?: any) => void, context?: any) : collider;\n\t */\n\tcontact: function (primaryType, secondaryType, callback, context=null)\n\t{\n\t\tif (!(primaryType in this.contactRules))\n\t\t\tthis.contactRules[primaryType] = { };\n\n\t\tthis.contactRules[primaryType][secondaryType] = { callback: callback, context: context };\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tAdds a truncation rule.\n\t * \t@param primaryType - Type or super-type of the primary element.\n\t * \t@param secondaryType - Type or super-type of the secondary element.\n\t * \t@param callback - Returns boolean indicating if the truncation rule should be applied.\n\t * \t@param context - Optional value passed as last parameter to the callback.\n\t * \t:static truncate (primaryType: number, secondaryType: number, callback?: (primary: Mask, secondary: Mask, context?: any) => void, context?: any) : collider;\n\t */\n\t/**\n\t * \tAdds a truncation rule.\n\t * \t@param primaryType - Type or super-type of the primary element.\n\t * \t@param secondaryType - Type or super-type of the secondary element.\n\t * \t@param value - Indicates the status of the truncation rule.\n\t * \t!static truncate (primaryType: number, secondaryType: number, value: boolean) : collider;\n\t */\n\ttruncate: function (primaryType, secondaryType, callback=null, context=null)\n\t{\n\t\tif (!(primaryType in this.truncationRules))\n\t\t\tthis.truncationRules[primaryType] = { };\n\n\t\tthis.truncationRules[primaryType][secondaryType] = { callback: callback, context: context };\n\t\treturn this;\n\t},\n\n\t/**\n\t * \tLoads the contact flags in the collider state.\n\t *\t!static getContactFlags (boundsA: Bounds2, boundsB: Bounds2) : number;\n\t */\n\tgetContactFlags: function (boundsA, boundsB)\n\t{\n\t\tthis.state.contact.set(boundsA).setAsIntersection(boundsB);\n\t\tlet contact = this.state.contact;\n\n\t\tthis.state.flags = 0;\n\t\tthis.state.numFlags = 0;\n\n\t\tif (contact.x1 == boundsB.x1)\n\t\t{\n\t\t\tthis.state.flags |= collider.Contact.LEFT; // LEFT\n\t\t\tthis.state.numFlags++;\n\t\t}\n\n\t\tif (contact.x2 == boundsB.x2)\n\t\t{\n\t\t\tthis.state.flags |= collider.Contact.RIGHT; // RIGHT\n\t\t\tthis.state.numFlags++;\n\t\t}\n\n\t\tif (contact.y1 == boundsB.y1)\n\t\t{\n\t\t\tthis.state.flags |= collider.Contact.TOP; // TOP\n\t\t\tthis.state.numFlags++;\n\t\t}\n\n\t\tif (contact.y2 == boundsB.y2)\n\t\t{\n\t\t\tthis.state.flags |= collider.Contact.BOTTOM; // BOTTOM\n\t\t\tthis.state.numFlags++;\n\t\t}\n\n\t\treturn this.state.flags;\n\t},\n\n\tcalc: function (store0, sign, a, v0a, v1a, v1b)\n\t{\n\t\tlet n = this.state.count;\n\t\tlet delta = null;\n\t\tlet v = 0;\n\n\t\tif (sign > 0)\n\t\t{\n\t\t\tfor (let i = 0; i < n; i++)\n\t\t\t{\n\t\t\t\tif (!v0a[i] || !v1a[i] || a[i] < 0) continue;\n\n\t\t\t\tif (delta === null || a[i] > delta)\n\t\t\t\t\tdelta = a[i];\n\n\t\t\t\tv1a[i] = v1b[i] = 0;\n\t\t\t\tv += v0a[i];\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let i = 0; i < n; i++)\n\t\t\t{\n\t\t\t\tif (!v0a[i] || !v1a[i] || a[i] > 0) continue;\n\n\t\t\t\tif (delta === null || a[i] < delta)\n\t\t\t\t\tdelta = a[i];\n\n\t\t\t\tv1a[i] = v1b[i] = 0;\n\t\t\t\tv += v0a[i];\n\t\t\t}\n\t\t}\n\n\t\tif (delta === null)\n\t\t\tdelta = 0;\n\n\t\tif (store0) {\n\t\t\tthis.state.v0 = v;\n\t\t\tthis.state.w0 = Math.abs(delta);\n\t\t\tthis.state.delta0 = delta;\n\t\t} else {\n\t\t\tthis.state.v1 = v;\n\t\t\tthis.state.w1 = Math.abs(delta);\n\t\t\tthis.state.delta1 = delta;\n\t\t}\n\t},\n\n\tattemptSelect: function (swapped)\n\t{\n\t\tif (this.state.v1 + this.state.v0 === this.state.target)\n\t\t{\n\t\t\tif (this.state.w2 === null || this.state.w1 + this.state.w0 < this.state.w2)\n\t\t\t{\n\t\t\t\tthis.state.w2 = this.state.w1 + this.state.w0;\n\n\t\t\t\tif (!swapped) {\n\t\t\t\t\tthis.state.t_dx = this.state.delta1;\n\t\t\t\t\tthis.state.t_dy = this.state.delta0;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.state.t_dx = this.state.delta0;\n\t\t\t\t\tthis.state.t_dy = this.state.delta1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tload0: function()\n\t{\n\t\tlet n = this.state.count;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tthis.state.v1x[i] = this.state.v0x[i];\n\t\t\tthis.state.v1y[i] = this.state.v0y[i];\n\t\t}\n\t},\n\n\tsave1: function()\n\t{\n\t\tlet n = this.state.count;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tthis.state.v2x[i] = this.state.v1x[i];\n\t\t\tthis.state.v2y[i] = this.state.v1y[i];\n\t\t}\n\t},\n\n\tload1: function()\n\t{\n\t\tlet n = this.state.count;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tthis.state.v1x[i] = this.state.v2x[i];\n\t\t\tthis.state.v1y[i] = this.state.v2y[i];\n\t\t}\n\t},\n\n\tresolveXpos: function (single=false)\n\t{\n\t\tthis.calc (single, 1, this.state.x, this.state.v0x, this.state.v1x, this.state.v1y);\n\t\tif (single) return true;\n\n\t\tthis.save1();\n\t\tif (this.resolveYpos(true)) this.attemptSelect(false);\n\n\t\tthis.load1();\n\t\tif (this.resolveYneg(true)) this.attemptSelect(false);\n\n\t\tthis.load0();\n\t},\n\n\tresolveXneg: function (single=false)\n\t{\n\t\tthis.calc (single, -1, this.state.x, this.state.v0x, this.state.v1x, this.state.v1y);\n\t\tif (single) return true;\n\n\t\tthis.save1();\n\t\tif (this.resolveYpos(true)) this.attemptSelect(false);\n\n\t\tthis.load1();\n\t\tif (this.resolveYneg(true)) this.attemptSelect(false);\n\n\t\tthis.load0();\n\t},\n\n\tresolveYpos: function (single=false)\n\t{\n\t\tthis.calc (single, 1, this.state.y, this.state.v0y, this.state.v1y, this.state.v1x);\n\t\tif (single) return true;\n\n\t\tthis.save1();\n\t\tif (this.resolveXpos(true)) this.attemptSelect(true);\n\n\t\tthis.load1();\n\t\tif (this.resolveXneg(true)) this.attemptSelect(true);\n\n\t\tthis.load0();\n\t},\n\n\tresolveYneg: function (single=false)\n\t{\n\t\tthis.calc (single, -1, this.state.y, this.state.v0y, this.state.v1y, this.state.v1x);\n\t\tif (single) return true;\n\n\t\tthis.save1();\n\t\tif (this.resolveXpos(true)) this.attemptSelect(true);\n\n\t\tthis.load1();\n\t\tif (this.resolveXneg(true)) this.attemptSelect(true);\n\n\t\tthis.load0();\n\t},\n\n\t/**\n\t * \tCompletes the translation on the current group.\n\t */\n\tcommit: function ()\n\t{\n\t\tif (!this.state.group.alive())\n\t\t\treturn;\n\n\t\tthis.state.group.translate (this.state.dx, this.state.dy);\n\t\tthis.state.group.clearFlags (collider.FLAG_EXCLUDE);\n\t},\n\n\t/**\n\t * \tAttempts to move the specified group by the given deltas. Any collisions detected on the mask will trigger the respective actions.\n\t * \t@param mask - Mask element.\n\t * \t@param dx - X delta value.\n\t * \t@param dy - Y delta value.\n\t * \t!static translate (mask: Mask, dx: number, dy: number) : void;\n\t */\n\t/**\n\t * \tAttempts to move the specified group by the given deltas. Any collisions detected on the mask will trigger the respective actions.\n\t * \t@param mask - Mask element.\n\t * \t@param group - Group where the mask is stored.\n\t * \t@param dx - X delta value.\n\t * \t@param dy - Y delta value.\n\t * \t!static translate (mask: Mask, group: Group, dx: number, dy: number) : void;\n\t */\n\ttranslate: function (mask, group=null, dx=0, dy=0)\n\t{\n\t\tif (typeof(group) === 'number')\n\t\t{\n\t\t\tdy = dx;\n\t\t\tdx = group;\n\t\t\tgroup = null;\n\t\t}\n\n\t\tif (!mask) return;\n\n\t\tif (!group) group = mask.group;\n\n\t\tif (!group.alive() || !mask.alive())\n\t\t\treturn;\n\n\t\tthis.state.mask = mask;\n\t\tthis.state.group = group;\n\n\t\tthis.state.dx = downscalef(upscale(dx));\n\t\tthis.state.dy = downscalef(upscale(dy));\n\n\t\tif (!this.maskLayer || !mask.visible())\n\t\t\treturn this.commit();\n\n\t\tlet truncationRules = this.truncationRules[mask.type];\n\t\tif (!truncationRules)\n\t\t{\n\t\t\ttruncationRules = this.truncationRules[mask.type & SUPER_TYPE_MASK];\n\t\t\tif (!truncationRules)\n\t\t\t{\n\t\t\t\tthis.commit();\n\t\t\t\treturn this.scan(mask, group);\n\t\t\t}\n\t\t}\n\n\t\tthis.state.offs = group.getOffsets(this.state.dx, this.state.dy);\n\t\tthis.state.bounds.set(mask.bounds).translate(this.state.offs.x+this.state.dx, this.state.offs.y+this.state.dy);\n\n\t\tgroup.setFlags (collider.FLAG_EXCLUDE);\n\n\t\tlet collisionItems = this.maskLayer.selectInRegion(this.state.bounds, this.flagsAnd, this.flagsValue);\n\t\tif (collisionItems.length === 0)\n\t\t{\n\t\t\tcollisionItems.free();\n\t\t\treturn this.commit();\n\t\t}\n\n\t\tlet n = 0;\n\t\tlet v = 0;\n\n\t\twhile (true)\n\t\t{\n\t\t\tlet item = collisionItems.shift();\n\t\t\tif (item === null) break;\n\n\t\t\tlet allowsTruncation = truncationRules[item.type];\n\t\t\tif (!allowsTruncation)\n\t\t\t{\n\t\t\t\tallowsTruncation = truncationRules[item.type & SUPER_TYPE_MASK];\n\t\t\t\tif (!allowsTruncation) continue;\n\t\t\t}\n\n\t\t\tif (allowsTruncation.callback === false || (allowsTruncation.callback !== null && allowsTruncation.callback !== true && !allowsTruncation.callback(mask, item, allowsTruncation.context)))\n\t\t\t\tcontinue;\n\n\t\t\tlet width = Math.min(this.state.bounds.x2, item.bounds.x2) - Math.max(this.state.bounds.x1, item.bounds.x1);\n\t\t\tlet height = Math.min(this.state.bounds.y2, item.bounds.y2) - Math.max(this.state.bounds.y1, item.bounds.y1);\n\n\t\t\tthis.state.v0x[n] = 0;\n\t\t\tthis.state.v0y[n] = 0;\n\n\t\t\tif (Math.min(this.state.bounds.width(), item.bounds.width()) != width) {\n\t\t\t\tthis.state.x[n] = absmin(this.state.bounds.x2 - item.bounds.x1, this.state.bounds.x1 - item.bounds.x2);\n\t\t\t\tthis.state.v0x[n] = 1;\n\t\t\t}\n\n\t\t\tif (Math.min(this.state.bounds.height(), item.bounds.height()) != height) {\n\t\t\t\tthis.state.y[n] = absmin(this.state.bounds.y2 - item.bounds.y1, this.state.bounds.y1 - item.bounds.y2);\n\t\t\t\tthis.state.v0y[n] = 1;\n\t\t\t}\n\n\t\t\tlet sv = this.state.v0x[n] + this.state.v0y[n];\n\t\t\tv += sv;\n\n\t\t\tif (sv > 1) {\n\t\t\t\tthis.state.v0x[n] = sv;\n\t\t\t\tthis.state.v0y[n] = sv;\n\t\t\t}\n\n\t\t\tthis.state.v1x[n] = this.state.v0x[n];\n\t\t\tthis.state.v1y[n] = this.state.v0y[n];\n\n\t\t\tn++;\n\t\t}\n\n\t\tcollisionItems.free();\n\n\t\tif (v == 0)\n\t\t{\n\t\t\tthis.commit();\n\t\t\treturn this.scan(mask, group);\n\t\t}\n\n\t\tthis.state.target = v;\n\t\tthis.state.count = n;\n\t\tthis.state.w2 = null;\n\n\t\tthis.resolveXpos();\n\t\tthis.resolveXneg();\n\t\tthis.resolveYpos();\n\t\tthis.resolveYneg();\n\n\t\tif (this.state.w2 !== null)\n\t\t{\n\t\t\tlet contactRules = this.contactRules[mask.type];\n\t\t\tif (!contactRules) contactRules = this.contactRules[mask.type & SUPER_TYPE_MASK];\n\n\t\t\tif (contactRules)\n\t\t\t{\n\t\t\t\tthis.state.bounds.set(mask.bounds).translate(this.state.offs.x+this.state.dx-this.state.t_dx*0.5, this.state.offs.y+this.state.dy-this.state.t_dy*0.5);\n\n\t\t\t\tcollisionItems = this.maskLayer.selectInRegion(this.state.bounds, this.flagsAnd, this.flagsValue);\n\n\t\t\t\twhile (mask.alive())\n\t\t\t\t{\n\t\t\t\t\tlet item = collisionItems.shift();\n\t\t\t\t\tif (item === null) break;\n\n\t\t\t\t\tif (!item.alive())\n\t\t\t\t\t\tcontinue;\n\t\t\n\t\t\t\t\tlet contact = contactRules[item.type];\n\t\t\t\t\tif (!contact)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontact = contactRules[item.type & SUPER_TYPE_MASK];\n\t\t\t\t\t\tif (!contact) continue;\n\t\t\t\t\t}\n\n\t\t\t\t\tcontact.callback (mask, item, contact.context);\n\t\t\t\t}\n\n\t\t\t\tcollisionItems.free();\n\t\t\t}\n\n\t\t\tthis.state.dx -= this.state.t_dx;\n\t\t\tthis.state.dy -= this.state.t_dy;\n\t\t}\n\n\t\tthis.commit();\n\t},\n\n\t/**\n\t *\tScans for collisions against the specified mask.\n\t * \t@param mask - Mask element.\n\t * \t!static scan (mask: Mask) : void;\n\t */\n\t/**\n\t *\tScans for collisions against the specified mask.\n\t * \t@param mask - Mask element.\n\t * \t@param group - Group where the mask is stored.\n\t * \t!static scan (mask: Mask, group: Group) : void;\n\t */\n\tscan: function (mask, group=null)\n\t{\n\t\tif (!group) group = mask.group;\n\n\t\tif (!group || !group.alive() || !mask.alive())\n\t\t\treturn;\n\n\t\tthis.state.mask = mask;\n\t\tthis.state.group = group;\n\n\t\tif (!this.maskLayer || !mask.visible())\n\t\t\treturn;\n\n\t\tlet contactRules = this.contactRules[mask.type];\n\t\tif (!contactRules) contactRules = this.contactRules[mask.type & SUPER_TYPE_MASK];\n\t\tif (!contactRules) return;\n\t\n\t\tgroup.setFlags (collider.FLAG_EXCLUDE);\n\t\tlet collisionItems = this.maskLayer.selectInRegion(mask.bounds, this.flagsAnd, this.flagsValue);\n\t\tgroup.clearFlags (collider.FLAG_EXCLUDE);\n\n\t\twhile (mask.alive())\n\t\t{\n\t\t\tlet item = collisionItems.shift();\n\t\t\tif (item === null) break;\n\n\t\t\tif (!item.alive())\n\t\t\t\tcontinue;\n\n\t\t\tlet contact = contactRules[item.type];\n\t\t\tif (!contact)\n\t\t\t{\n\t\t\t\tcontact = contactRules[item.type & SUPER_TYPE_MASK];\n\t\t\t\tif (!contact) continue;\n\t\t\t}\n\n\t\t\tcontact.callback (mask, item, contact.context);\n\t\t}\n\n\t\tcollisionItems.free();\n\t}\n};\n\n/**\n * \tContact flag bits.\n */\n\n//!/class\n\n//!namespace collider\n//!enum Contact\n\ncollider.Contact = {\n\t//!LEFT\n\tLEFT: 1,\n\t//!RIGHT\n\tRIGHT: 2,\n\t//!HORIZONTAL\n\tHORIZONTAL: 1|2,\n\t//!TOP\n\tTOP: 4,\n\t//!BOTTOM\n\tBOTTOM: 8,\n\t//!VERTICAL\n\tVERTICAL: 4|8,\n};\n\n//!/enum\n//!/namespace\n\nexport default collider;\n","//@ts-check\n\n//!namespace fxl\n\n//![import \"./system\"]\nimport _sys from './system.js';\nexport const sys = _sys;\n\n//![import \"./world\"]\nimport _world from './world.js';\nexport const world = _world;\n\n//![import \"./r\"]\nimport _r from './r.js';\nexport const r = _r;\n\n//![import \"./resources\"]\nimport _res from './resources.js';\nexport const res = _res;\n\n//![import \"./input\"]\nimport _input from './input.js';\nexport const input = _input;\n\n//![import \"./collider\"]\nimport _collider from './collider.js';\nexport const collider = _collider;\n\n//!/namespace\n"],"names":["$e7a70fea451c1d66$export$2e2bcd8739ae039","_getref","value","obj","substr","get","eval","type","model","ctval","name","parseInt","isNaN","Error","parseFloat","toString","$0523981e283b00ea$export$2e2bcd8739ae039","typeOf","mclass","this","ensure","cls","ensureTypeOf","arrayof","i","length","arraynull","remove","splice","arraycompliant","isCompliant","required","minlen","maxlen","minval","maxval","mincount","maxcount","pattern","$dWhFJ","default","test","inset","RegExp","indexOf","join","upper","toUpperCase","lower","toLowerCase","$0523981e283b00ea$var$Rinn","invokeLater","fn","setTimeout","wait","millis","Promise","resolve","reject","o","Array","isArrayOrObject","clone","elem","push","merge","output","objs","arr","j","i1","field","override","partialCompare","full","partial","arrayFind","getObject","isInstanceOf","_class","$a25e6679217b277b$export$2e2bcd8739ae039","email","url","urlNoProt","uname","text","utext","$f7ca18717c214cf2$var$Class","_super","prototype","className","__ctor","__dtor","__proto__","hasOwnProperty","instanceOf","object","_initSuperRefs","constructor","_newSuper","self","_prot","a00","a01","a02","a03","a04","a05","a06","a07","a08","a09","a0A","call","$f7ca18717c214cf2$export$2e2bcd8739ae039","extend","source","args","_async","list","next","ret","original","eventName","eventArgs","cbHandler","cbContext","listeners","namespace","setNamespace","handler","context","data","split","ns","removeEventListener","k","e","s","a","concat","l","silent","$2c6c6d67abdc2b7f$export$2e2bcd8739ae039","t","n","r","silence","dispatchEvent","prepareEvent","resume","$jT52r","parcelRequire","$a8b14ab12911b661$var$_Model","$764fa7261ccc826a$export$2e2bcd8739ae039","defaults","constraints","changedList","_silent","_level","EventDispatcher","reset","def","init","set","update","ready","nsilent","_validate","nvalue","ctname","Constraints","message","_set","constraint","_propertyEvent","prev","direct","temp","old","level","evt","arguments","force","fields","has","flatten","getInt","getFloat","getBool","getReference","m","safe","rsafe","class","classPath","keys","ct","validate","observe","property","addEventListener","unobserve","watch","unwatch","serialize","$a8b14ab12911b661$export$2e2bcd8739ae039","$7468b7763b89e914$export$2e2bcd8739ae039","itemt","contents","itemId","nextId","Model","_eventGroup","Date","now","_bind","iid","item","_onItemEvent","_unbind","id","from","enqueue","clear","setData","getData","getAt","index","removeAt","setAt","updateAt","position","pop","unshift","shift","find","retObject","$2dc29f9b761160bd$var$Schema","Type","proto","unflatten","tmp","Integer","precision","_precision","Math","pow","compact","_compact","strings","type1","itemType","_filter","debug","v","_debug","callback","async","properties","defvalue","symbolic","classConstructor1","_constructor","classConstructor","name1","type2","conditions","when","val","$2dc29f9b761160bd$export$2e2bcd8739ae039","$bf08d17deb8143a2$export$2e2bcd8739ae039","typeSchema","itemTypeSchema","items","Property","is","of","add","itemsReferenceChanged","onItemRemoved","desc","sort","b","inc","exc","getItems","isEmpty","relative","first","last","addAt","onBeforeItemAdded","onItemAdded","$826d32eb9d4eff74$var$Template","strict","parseTemplate","template","sym_open","sym_close","is_tpl","root","nflush","flush","state","count","str","parts","mparts","nparts","emit","trim","map","i2","match","unescape","parse","clean","expand","mode","escape","quote","functions","failed","replace","f","compile","register","getNamedValues","expanded","key","startsWith","endsWith","global","globalThis","null","true","false","len","int","float","chr","String","fromCharCode","ord","charCodeAt","not","neg","abs","and","or","eq","ne","lt","le","gt","ge","isnotnull","isnull","iszero","typeof","x","mul","div","sum","sub","mod","dump","JSON","stringify","ref","_unset","start","nl2br","attr","Object","values","_each","var_name","_foreach","_if","_switch","case_value","_break","_continue","_repeat","to","step","tpl","_for","_loop","_echo","console","log","contains","err","_map","arrayMode","_call","i3","$826d32eb9d4eff74$export$2e2bcd8739ae039","$bb627624112967de$export$eefcfe56efaaa57d","$bb627624112967de$export$4c85e640eb41c31b","$bb627624112967de$export$d61e24a684f9e51","$bb627624112967de$export$ec8b666c5fe2c75a","$bb627624112967de$export$a1edc412be3e1841","$bb627624112967de$export$59eced47f477f85a","$bb627624112967de$export$19342e026b58ebb7","$bb627624112967de$export$3a9581c9ade29768","$bb627624112967de$export$fb8073518f34e6ec","$17304fb0bb8e3d4f$export$2e2bcd8739ae039","$bb627624112967de$export$14416b8d99d47caa","$1vVeL","$09cb358c2aa81294$var$XOR","$09cb358c2aa81294$var$SHR","$09cb358c2aa81294$var$SHL","$09cb358c2aa81294$var$Random","Class","seed","setSeed","nextInt32","c","d","nextInt16","nextInt8","nextFloat","$09cb358c2aa81294$export$2e2bcd8739ae039","$6fd473ea64d5e91a$export$2e2bcd8739ae039","BACKSPACE","TAB","ENTER","SHIFT","CTRL","ESC","SPACE","PGUP","PGDN","END","HOME","INS","DEL","LEFT","UP","RIGHT","DOWN","NUM_PLUS","NUM_MINUS","NUM_ASTERISK","NUM_SLASH","NUM_DOT","NUM_0","NUM_1","NUM_2","NUM_3","NUM_4","NUM_5","NUM_6","NUM_7","NUM_8","NUM_9","D0","D1","D2","D3","D4","D5","D6","D7","D8","D9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","$3755e11d40ee463d$var$recyclingFacilities","$3755e11d40ee463d$var$totalPreallocated","$3755e11d40ee463d$var$Recycler","$parcel$global","Recycler","$3755e11d40ee463d$export$2e2bcd8739ae039","attachTo","targetClass","maxPoolSize","minPoolSize","recyclerPool","recyclerPoolMax","objectId","recyclerNextObjectId","recyclerCreated","recyclerRecycled","recyclerMissed","recyclerLength","recyclerActive","preallocated","preallocate","maximum","min","allocate","alloc","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","free","error","lockInstance","showStats","toFixed","group","groupEnd","createPool","Pool","maxPreallocationsPerPool","$284173a7f016deff$var$Linkable","unlink","linkAfter","linkBefore","$284173a7f016deff$export$2e2bcd8739ae039","$5ffbe5e8d10cd81c$var$List","top","bottom","Rinn","ni","dispose","getNodeAt","sgetNode","isInstance","insertBefore","insertAfter","append","forEach","forEachRev","filter","toArray","array","$5ffbe5e8d10cd81c$export$2e2bcd8739ae039","$aa13d5a33a29523b$var$Timer","vsync","interval","handle","isRunning","startTime","rTime","sTime","lTime","tDelta","_onTimeout","onTimeout","_onTimeout_b","runNow","hrnow","tError","runAfter","immediate","scale","onStarted","timeout","requestAnimationFrame","clearTimeout","stop","onStopped","$aa13d5a33a29523b$export$2e2bcd8739ae039","$81cb9504fb4d2922$var$Vec2","y","setX","setY","zero","isZero","equals","inv","translate","dx","dy","rotate","angle","cos","sin","fx","fy","floor","fract","dot","magnitude","squared","sqrt","normalize","majorAxis","minorAxis","sign","$81cb9504fb4d2922$export$2e2bcd8739ae039","$828cb24954f75093$var$temp","Float32Array","fill","$828cb24954f75093$var$temp2","$828cb24954f75093$var$Matrix","identity","target","scalef","scalar","matr","cost","sint","sx","sy","applyTo","nx","ny","transpose","det","adj","inverse","loadIdentity","$828cb24954f75093$export$2e2bcd8739ae039","$21de2c81276fb0c1$var$Shader","sourceCode","shaderId","put","gl","$b91bcfe7d0e9e859$export$2e2bcd8739ae039","deleteShader","createShader","VERTEX","VERTEX_SHADER","FRAGMENT","FRAGMENT_SHADER","GEOMETRY_SHADER","shaderSource","compileShader","getError","getShaderInfoLog","shaders","shader","GEOMETRY","$21de2c81276fb0c1$export$2e2bcd8739ae039","$6537756e185f4720$var$ShaderProgram","uniform_location_matrix","uniform_transform_matrix","uniform_texture_matrix","uniform_resolution","uniform_texture_size","uniform_frame_size","uniform_base_color","uniform_time","uniform_depth","uniform_scale","uniform_alpha","uniform_texture_0","attrib_location","programId","deleteProgram","attach","bindLocations","bindAttribLocation","loadLocations","getUniformLocation","getAttribLocation","link","createProgram","attachShader","linkProgram","use","useProgram","getStatus","getProgramParameter","LINK_STATUS","getProgramInfoLog","getAllErrors","programs","shaderProgram","$6537756e185f4720$export$2e2bcd8739ae039","$22f7193504a1f089$var$Canvas","options","opts","background","width","height","hidden","absolute","antialias","headless","document","passThruCanvas","createElement","body","appendChild","style","left","getContext","desynchronized","alpha","stencil","$e2086caaef68d463$export$2e2bcd8739ae039","write","getParameter","VERSION","SHADING_LANGUAGE_VERSION","matrixStack","alphaStack","depthFlagStack","shaderProgramStack","transform","_globalScale","_alpha","_depthFlag","updateTransform","strokeStyle","fillStyle","resize","initGl","setBackground","parentNode","imageSmoothingEnabled","renderingContext","pushClip","popClip","setTransform","toDataURL","mime","params","beginPath","moveTo","closePath","lineTo","rect","w","h","stroke","fillRect","strokeRect","clip","quadraticCurveTo","cpx","cpy","bezierCurveTo","cx1","cy1","cx2","cy2","arc","sA","eA","cw","arcTo","x1","y1","x2","y2","fillText","maxWidth","strokeText","measureText","createImageData","getImageData","putImageData","drawImage","img","sw","sh","dw","dh","textureWidth","textureHeight","frameWidth","frameHeight","getBoundingClientRect","gl1","glDefaultProgram","glRepeatProgram","glBlitProgram","setShaderProgram","buffer","attrib_location_buffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","enableVertexAttribArray","vertexAttribPointer","FLOAT","FALSE","BYTES_PER_ELEMENT","clearColor","enable","DEPTH_TEST","clearDepth","depthFunc","GEQUAL","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","m_location","m_texture","v_texture_size","v_frame_size","v_resolution","zvalue","glTextureReady","program","targetWidth","targetHeight","uniform2fv","uniform1f","time","glActiveTextureId","glTextureId","glActiveShader","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","uniform1i","uniformMatrix3fv","drawArrays","TRIANGLE_STRIP","drawRect","prepareImage","image","texture","createTexture","texStorage2D","RGBA8","texSubImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","setWrapRepeat","REPEAT","applyConfig","imageRendering","removeChild","color","backgroundColor","g","_width","_height","SCISSOR_TEST","scissor","viewport","globalScale","flipped","isFlipped","toDataUrl","toPngBase64","_contextAttribute","lineCap","lineJoin","lineWidth","miterLimit","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","clearRect","STENCIL_BUFFER_BIT","DEPTH_BUFFER_BIT","COLOR_BUFFER_BIT","end","colorMask","blit","disable","clearPath","pushMatrix","popMatrix","pushAlpha","popAlpha","setDepthFlag","getDepthFlag","pushDepthFlag","popDepthFlag","getShaderProgram","pushShaderProgram","popShaderProgram","loadMatrix","getMatrix","appendMatrix","useNative","ellipse","ox","oy","xe","ye","xm","ym","circle","PI","line","enablePointerEvents","pointerHandler","pointerScale","pointerOffset","_","_evt","action","buttons","lbuttons","containedBy","pointerHandlers","code","rx","clientX","ry","clientY","dragging","ldx","ldy","ddx","ddy","onmousedown","onmouseup","onmousemove","setPointerScale","setPointerOffset","addPointerHandler","random","removePointerHandler","renderImage","draw","completed","Image","onload","rscale","$fde096e7347cb963$export$2e2bcd8739ae039","renderer","src","$22f7193504a1f089$export$2e2bcd8739ae039","$fde096e7347cb963$var$System","flags","renderingEnabled","renderingPaused","defaultOptions","overdraw","orientation","fps","minFps","screenWidth","screenHeight","extraScaleFactor","maxScaleFactor","fullscreen","offsX","offsY","devicePixelRatio","backingStoreRatio","canvasPixelRatio","canvasScaleFactor","scaleFactor","initialMatrix","displayBuffer2","displayBuffer3","tempDisplayBuffer","keyState","ctrl","alt","keyCode","pointerState","updateQueue","drawQueue","timeScale","frameInterval","fixedFrameInterval","maxFrameInterval","frameDelta","frameTime","frameNumber","perf","lastTime","numFrames","numSamples","updateTimeTotal","drawTimeTotal","extraTimeTotal","averageFps","averageUpdateTime","averageDrawTime","averageExtraTime","onresize","onWindowResized","frameTimer","delta","onFrame","pointerEvents","display0","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","onkeydown","onKeyboardEvent","KeyboardEventType","KEY_DOWN","onkeyup","endTime","KEY_UP","pointerConvX","reverseRender","pointerConvY","ontouchstart","preventDefault","touches","changedTouches","identifier","isActive","isDragging","button","wheelDelta","wheelAccum","p","onPointerEvent","PointerEventType","POINTER_DOWN","ontouchend","deltaTime","POINTER_DRAG_STOP","POINTER_UP","ontouchcancel","ontouchmove","POINTER_DRAG_START","POINTER_DRAG_MOVE","POINTER_MOVE","oncontextmenu","onwheel","deltaY","POINTER_WHEEL","which","pause","resetPerf","notRendering","_screenWidth","screen","_screenHeight","innerWidth","innerHeight","targetScreenWidth","targetScreenHeight","marginLeft","marginTop","integerScaleFactor","onCanvasResized","updateQueueAdd","updateQueueRemove","drawQueueAdd","drawQueueRemove","queueAdd","queueRemove","dt","interpolate","dst","duration","easing","interpolator","pointer","pointers","$e2086caaef68d463$var$Log","activated","paused","maxsize","debugEcho","vars","msg","fontSize","showFps","showIndex","_y","ii","$b91bcfe7d0e9e859$var$globals","debugBounds","debugMasks","rand0","rand1","rand2","px","SCALE","audioContext","AudioContext","latencyHint","sampleRate","baseLatency","fetchd","responseType","request","XMLHttpRequest","open","response","onerror","send","fetchAudioBuffer","then","arrayBuffer","decodeAudioData","audioBuffer","catch","bool","float2","float3","float4","rad","deg","rand","randf","randrf","randr","round","randtf","performance","randvar","randitem","getLineSegmentIntersection","ls1_x1","ls1_y1","ls1_x2","ls1_y2","ls2_x1","ls2_y1","ls2_x2","ls2_y2","dyA","dxA","dyB","dxB","max","tA","tB","lineSegmentIntersects","rotatePoint","stepValue","minValue","maxValue","numSteps","alignValue","FIXED_POINT_BITS","upscale","downscale","downscalef","falign","absmin","absmax","$f19bc58388a66526$var$Perf","accumSize","expectedValue","lastFeed","lastUpdate","stdSum","stdCount","$f19bc58388a66526$export$2e2bcd8739ae039","begin","feed","report","avg","std","out","Flags","SAMPLES","MIN","MAX","AVG","EXPECTED","undefined","STDDEV","AVG_STDDEV","ALL","$4ef6348d85518192$var$Framebuffer","framebufferId","attachments","attachmentTypes","drawBuffers","drawBufferIds","$4ef6348d85518192$var$attachmentPointIds","$4ef6348d85518192$var$initAttachmentPointIds","createFramebuffer","MAX_ATTACHMENT_POINTS","TEXTURE","deleteTexture","deleteRenderbuffer","deleteFramebuffer","frameBufferId","attachmentPoint","DEPTH","RENDERBUFFER","FRAMEBUFFER_BINDING","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","framebufferRenderbuffer","createColorBuffer","tex","createDepthBuffer","createRenderbuffer","bindRenderbuffer","renderbufferStorage","DEPTH_COMPONENT24","createStencilBuffer","DEPTH_STENCIL","getTexture","getRenderBuffer","bind","unbind","$4ef6348d85518192$var$defaultDrawBuffers","isComplete","result","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","COLOR0","COLOR1","COLOR2","COLOR3","COLOR4","COLOR5","COLOR6","COLOR7","STENCIL","BACK","COLOR_ATTACHMENT0","COLOR_ATTACHMENT1","COLOR_ATTACHMENT2","COLOR_ATTACHMENT3","COLOR_ATTACHMENT4","COLOR_ATTACHMENT5","COLOR_ATTACHMENT6","COLOR_ATTACHMENT7","DEPTH_ATTACHMENT","STENCIL_ATTACHMENT","DEPTH_STENCIL_ATTACHMENT","$4ef6348d85518192$export$2e2bcd8739ae039","$9c01ee4e3248479e$var$Drawable","resource","drawable","getDrawable","getImage","render","bounds","$9c01ee4e3248479e$var$NineSlice","ss","startingIndex","spritesheet","Drawable","leftWidth","getFrame","rightWidth","midWidth","topHeight","bottomHeight","midHeight","$9c01ee4e3248479e$var$Repeated","ih","iw","rh","rw","$9c01ee4e3248479e$var$Clipped","$9c01ee4e3248479e$var$Centered","$9c01ee4e3248479e$var$Static","$9c01ee4e3248479e$var$Group","nineSlice","repeated","clipped","centered","static","$9c01ee4e3248479e$export$2e2bcd8739ae039","$02845dbdbf026744$export$2e2bcd8739ae039","wrapper","$bd7bbd108a331fae$export$2e2bcd8739ae039","$8652d779e3153a64$var$FrameDrawable","frameIndex","$8652d779e3153a64$export$2e2bcd8739ae039","numCols","frameCache","r_scale","v_scale","config","sheetWidth","resName","numRows","ceil","frameObject","$2d9d52b4ff4142ab$export$c35d437ae5945fcd","seq","seq_i","trans","trans_i","trans_t","queue","frameSeconds","finished","_paused","finishedCallback","finishedCallbackHandler","finishedCallbackContext","frameCallback","anim","setFps","initialDelay","onFinished","thenCallback","setFrame","normalized","getLength","loop","advance","getSequenceName","seqName","play","setQueue","lastName","$2d9d52b4ff4142ab$export$2e2bcd8739ae039","defaultDrawable","sharedAnim","Spritesheet","initialized","getSharedAnimation","initialseq","getAnimation","getSequence","$f4d79ecc7bc126e9$export$2e2bcd8739ae039","r_charWidth","charWidth","r_charHeight","charHeight","paddingX","paddingY","spacingX","spacingY","reverseDraw","cols","charset","charTable","widths","drawText","pX","measureWidth","measureHeight","drawTextAligned","ax","ay","drawTextAligned2","$68eb0e0111ce8878$var$Resources","$68eb0e0111ce8878$var$reported","assign","integerScalingEnabled","pixelated","load","progressCallback","completeCallback","keyList","__clone","ratio","owidth","oheight","resizeImage","onLoaded","d0","dN","d1","lastIndexOf","_i","cb","track","plugins","NativeAudio","engine","$3c032669d563ec95$exports","Sound","ENGINE_NATIVEAUDIO","preloadSimple","ENGINE_WEBAUDIO","Audio","ENGINE_HTML5","oncanplaythrough","json","arraybuffer","apply","Uint8Array","unload","__loaded","discardOriginal","rep_x","rep_y","sp","tw","th","flipImageHorz","flipImageVert","showDownload","filename","dataUrl","href","display","download","click","showFilePicker","allowMultiple","accept","input","multiple","onchange","files","onfocus","loadAsDataURL","file","reader","FileReader","readAsDataURL","loadAsText","readAsText","loadAsArrayBuffer","readAsArrayBuffer","loadAllAsDataURL","fileList","loadNext","size","$68eb0e0111ce8878$export$2e2bcd8739ae039","$689eb0292031c01c$var$Sound","volume","playLoop","MASTER","enabled","SFX","MUSIC","VOICE","MAX_POOL_SIZE","pool","active","node","registered","unregister","updateNode","cmd","snd","updateNode_webaudio","updateNode_nativeaudio","updateNode_audio","alloc_webaudio","gainNode","createGain","gain","connect","destination","res","createBufferSource","free_webaudio","disconnect","alloc_nativeaudio","free_nativeaudio","alloc_audio","cloneNode","_src","free_audio","playing","playTime","onended","onended_webaudio","currentTarget","onended_nativeaudio","onended_audio","currentTime","enableTrack","disableTrack","setVolume","createNode","startVolume","timer","fadeOut","setInterval","clearInterval","fadeIn","$689eb0292031c01c$export$2e2bcd8739ae039","$22fce242bea61ea1$export$2e2bcd8739ae039","sounds","lastIndex","getRandomSound","playAt","playLoopAt","$3c032669d563ec95$export$f35845279390eafd","$3c032669d563ec95$export$922ad9063d3cdee8","$3c032669d563ec95$export$674d2eb4debbef0c","$3c032669d563ec95$export$7faa71ea66a694bb","$3c032669d563ec95$export$e1896ac0c4970221","$3c032669d563ec95$export$85990f0f98a390bb","$3c032669d563ec95$export$bc40a15752ef9732","$b280b216ed4b8038$export$2e2bcd8739ae039","queueKeys","order","priority","is_dirty","cleanup","q","is_complete","forEachAsync","next_j","next_i","forEachRevAsync","alert","$9e32ad385ff5fde1$var$Callback","arg0","arg1","arg2","arg3","arg4","arg5","isEqual","exec","host","$9e32ad385ff5fde1$export$2e2bcd8739ae039","$45a34d9ad9468512$var$Handler","execf","execc","$45a34d9ad9468512$export$2e2bcd8739ae039","$b102a02d12056e55$var$Rect","cx","cy","Rool","extendWithPoint","centerAt","setAsUnion","intersects","_x1","_y1","_x2","_y2","setAsIntersection","topLeftRelative","resizeBy","ncx","ncy","isRight","containsPoint","tol","area","$b102a02d12056e55$export$2e2bcd8739ae039","$a07db0aab30c8926$var$TFunction","copyFrom","t0","t1","i0","x0","y0","integral","c0","accum","second_integral","Temp1","integrate","Temp2","accumulate","chopLeft","chopRight","n1","pad","char","$a07db0aab30c8926$export$2e2bcd8739ae039","$333d67efa04b2b0b$var$Point2","ux","uy","upscaled","$333d67efa04b2b0b$export$2e2bcd8739ae039","$33fa7ae7f1b4b0c7$var$Bounds2","ucx","ucy","ux1","uy1","ux2","uy2","trunc","dwidth","dheight","isForward","$33fa7ae7f1b4b0c7$export$2e2bcd8739ae039","$3569e5716b6e61f7$var$Easing","Linear","IN","OUT","IN_OUT","Back","Bounce","getConst","Circ","Cubic","Expo","Power","Quad","Quartic","Quintic","Sine","Step","$3569e5716b6e61f7$export$2e2bcd8739ae039","$03dacdb15d88825e$var$Boot","modules","module","startup","onStartup","shutdown","forEachAsyncRev","onShutdown","Module","$03dacdb15d88825e$export$2e2bcd8739ae039","$cf4285abf605e9c9$var$system","_timeout","_interval","_span","onPaused","onResumed","window","onblur","fromExternalEvent","_updateTimeout","period","_updateInterval","_0","_1","span","_updateSpan","$cf4285abf605e9c9$export$2e2bcd8739ae039","$8a234cbdd1616e86$var$Block","commands","current","block","restart","isFinished","$8a234cbdd1616e86$export$2e2bcd8739ae039","$e59415f90bae69ee$var$Command","op","started","_duration","_count","startValue","_startValue","endValue","_endValue","_cur","_last","blocks","table","autoInit","$e59415f90bae69ee$export$2e2bcd8739ae039","$52fe5271af6feef9$export$2e2bcd8739ae039","postinit","$28418ecd69cb7a00$export$2e2bcd8739ae039","$744608404c94ae00$export$2e2bcd8739ae039","$316a9b98407c8266$export$2e2bcd8739ae039","setValue","getValue","$12fac9c77770ec48$export$2e2bcd8739ae039","$9753a61aac9de17e$export$2e2bcd8739ae039","$7084299a5c2e7ef7$export$2e2bcd8739ae039","$2407cf27bf0f221f$export$2e2bcd8739ae039","$336a8399d6f4e247$export$2e2bcd8739ae039","$26e32f922146c7f0$var$Anim","initialData","blockStack","cmdStack","running","autoDispose","copyTo","initial","speed","run","fieldName","curr","initialValue","Number","prepareFieldName","parallel","serial","repeat","range","rangeTo","randt","PLAY","EXEC","_bounds_x1","_bounds_y1","translateX","deltaValue","translateY","deltaValueX","deltaValueY","easingX","easingY","endValueX","endValueY","moveX","moveY","scaleX","scaleY","$26e32f922146c7f0$export$2e2bcd8739ae039","$8d8e7c58165f35d0$var$GridElement","ext","container","_grid_remove_node","remover","ALIVE","VISIBLE","DIRTY","DEPTH_FLAG","alive","setId","setFlags","clearFlags","getFlags","andMask","setExt","extensionObject","getExt","arg6","arg7","arg8","arg9","visible","forced","VISIBLE_LOCK","visibleLock","dirty","depthFlagEnabled","DEPTH_FLAG_ENABLED","depthFlag","sync","dWidth","dHeight","setPosition","USERDEF","LAST_FLAG","allocFlag","flag","$8d8e7c58165f35d0$export$2e2bcd8739ae039","$7379a5ec690d13e4$var$Grid","grid","offsx","offsy","kx","ky","stride","verifyIntersection","log2","_remove","forEachInRegion","flagsAndMask","flagsValue","j0","j1","selectInRegion","countInRegion","selectFirst","$7379a5ec690d13e4$export$2e2bcd8739ae039","$c0ca59ea4341de78$var$Container","viewportBounds","scene","elementCount","drawCount","setViewportBounds","drawElement","syncZ","__zvalue","_zvalue","depthFlagChanged","$c0ca59ea4341de78$export$2e2bcd8739ae039","$36f8d9ddfdfdb2c5$var$Viewport","initialWidth","initialHeight","centerRatioX","centerRatioY","offset","focusFactorX","focusFactorY","focusRect","focusOffsX","focusOffsY","focusAxisX","focusAxisY","padding","focusBounds","screenBounds","tmpPoint","containerWidth","containerHeight","ENABLED","setContainerBounds","updateScreenBounds","updateBounds","topLeft","TOP_LEFT","setPadding","truncateToContainer","ws","hs","setOffsets","setScale","getScale","setGlobalScale","getGlobalScale","setCenter","setScreenPosition","getX","getY","getOffsetX","getOffsetY","getWidth","getHeight","focusX","focusY","updateForced","setFocusRect","setFocusOffsets","setFocusAxes","enabledX","enabledY","setFocusFactor","valueX","valueY","applyClip","applyTransform","toWorldSpace","refX","refY","toScreenSpace","$36f8d9ddfdfdb2c5$export$2e2bcd8739ae039","$96075e5e25a8b8bd$var$Element","_shaderProgram","_uniformSetter","GridElement","destroyLater","disposeLater","uniformSetter","shaderChanged","g2","getDebugColor","renderWith","renderFunction","debugColors","$96075e5e25a8b8bd$export$2e2bcd8739ae039","$3d21729d154fe9fa$var$tempPoint","$3d21729d154fe9fa$var$Group","children","Element","addChild","ltranslate","getChild","_dx","_dy","getOffsets","$3d21729d154fe9fa$export$2e2bcd8739ae039","$70f6e3c3a2801809$var$Scene","minWidth","minHeight","maxHeight","containers","viewports","groupList","groups","disposalQueue","fupdater","updater","synchronizer","lupdater","destroyer","disposeQueued","setContainer","getContainer","setViewport","getViewport","addGroup","_removeGroup","removeGroup","viewportIndex","drawContainers","updateViewports","$70f6e3c3a2801809$export$2e2bcd8739ae039","$f621b5dd5d2511c0$var$Updater","__update","__context","__preupdate","__postupdate","_update","_sync","_destroy","preUpdate","postUpdate","$f621b5dd5d2511c0$export$2e2bcd8739ae039","$e23387bae255f715$export$2e2bcd8739ae039","Container","$eae625b74bd4f8cd$export$2e2bcd8739ae039","divisorX","divisorY","$cb1f7d549b970dad$var$Mask","$cb1f7d549b970dad$export$2e2bcd8739ae039","$fe8bd36457f8e4df$var$Label","_dirty","textWidth","textHeight","_align","_valign","textOffsetX","textOffsetY","renderText","align","valign","setText","setFont","$fe8bd36457f8e4df$export$2e2bcd8739ae039","$e2643e71ae71ec0f$export$2e2bcd8739ae039","create","handlers","_callOnKeyboardEvent","callOnKeyboardEvent","_action","_keyCode","_keyState","$1ebcb7208b1d3955$export$2e2bcd8739ae039","_callOnPointerEvent","callOnPointerEvent","_p","_pointers","$3fcd3411b88f95db$var$ScreenControls","dummy","hoverEnabled","zindexEnabled","lastFrame","zindex","setHoverEnabled","setZIndexEnabled","findTarget","filterHover","_ref","pointerDeactivate","pointerActivate","_refh","hover","focusLock","pointerUpdate","keyArgs","keyboardEvents","keyDown","keyUp","$3fcd3411b88f95db$export$2e2bcd8739ae039","$1198e43a1b1a70e6$export$2e2bcd8739ae039","isPressed","wasPressed","unpressedImg","pressedImg","hitbox","_onButtonDown","_onButtonUp","_onTap","_onChange","Group","_default_onChange","setImage","setKeyCode","pointerX","pointerY","setStatus","updateStatus","onChange","onButtonDown","onButtonUp","onTap","$e311fd73aef87164$export$2e2bcd8739ae039","unpressedImgInner","pressedImgInner","angleSteps","radiusSteps","rdirx","rdiry","dirx","diry","frdirx","frdiry","fdirx","fdiry","fmagnitude","fangle","dispx","dispy","radius","maxRadius","deadZoneX","deadZoneY","_unpressedImg","_unpressedImg1","renderStick","setImageInner","setAngleSteps","setRadiusSteps","setDeadZone","atan2","fs","setDirection","freezeState","lastValid","$0a02b0fdb2ff6fc7$var$world","SCENE_MAIN","SCENE_HUD","LAYER_BG0","LAYER_BG1","LAYER_BG2","LAYER_BG3","LAYER_BG4","LAYER_MAIN","LAYER_FG0","LAYER_FG1","LAYER_FG2","LAYER_FG3","LAYER_FG4","LAYER_MASK","LAYER_HUD_BG0","LAYER_HUD_BG1","LAYER_HUD_BG2","LAYER_HUD_MAIN","LAYER_HUD_FG0","LAYER_HUD_FG1","LAYER_HUD_FG2","_scenes","activeScene","_viewports","activeViewport","activeContainer","activeGroup","lastGroup","lastElement","worldWidth","worldHeight","createScene","createViewport","selectScene","getScene","selectViewport","throwErrors","selectContainer","showMasks","allMasks","createGroup","endGroup","containerIndex","createMask","mask","createLabel","createUpdater","$0a02b0fdb2ff6fc7$export$2e2bcd8739ae039","$4d52c4e5e80ae305$var$r","$4d52c4e5e80ae305$export$2e2bcd8739ae039","$2ee1ae61bc160290$var$res","total","__resIdMustNotExist","custom","drawFunction","path","images","optsA","optsB","animation","id1","configOptions","resOptions","srcSeq","dstSeq","spritefont","sfx","sfxm","music","$2ee1ae61bc160290$export$2e2bcd8739ae039","$ff17ab5c944d50f9$var$Gamepad","sticks","_visible","layer","addStick","outerDrawable","innerDrawable","stick","addButton","unpressedDrawable","pressedDrawable","$ff17ab5c944d50f9$export$2e2bcd8739ae039","$fa684acf2c06fbb7$var$input","_gamepads","activeGamepad","lastButton","lastStick","cursor","_enabled","_handler","_element","element","native","removeProperty","createGamepad","layerIndex","selectGamepad","getGamepad","debugGamepad","$fa684acf2c06fbb7$export$2e2bcd8739ae039","$e0694b0a35335b44$var$SUPER_TYPE_MASK","$e0694b0a35335b44$var$collider","FLAG_EXCLUDE","contactRules","truncationRules","maskLayer","flagsAnd","contact","v0x","v0y","v1x","v1y","v2x","v2y","v0","w0","delta0","v1","w1","delta1","w2","t_dx","t_dy","sceneIndex","firstUpdate","later","_run","setVisible","_setVisible","_setValue","_setFlags","_clearFlags","primaryType","secondaryType","truncate","getContactFlags","boundsA","boundsB","numFlags","Contact","TOP","BOTTOM","calc","store0","v0a","v1a","v1b","attemptSelect","swapped","load0","save1","load1","resolveXpos","single","resolveYpos","resolveYneg","resolveXneg","commit","scan","offs","collisionItems","allowsTruncation","sv","HORIZONTAL","VERTICAL","$e0694b0a35335b44$export$2e2bcd8739ae039","$c66f8165c35d7ae1$export$773cc7fa6f8304c3","$c66f8165c35d7ae1$export$f965ae91e38a1274","$c66f8165c35d7ae1$export$43caf9889c228507","$c66f8165c35d7ae1$export$a79e2b3ea5d10ee0","$c66f8165c35d7ae1$export$b7e3ae3d7c15e42e","$c66f8165c35d7ae1$export$5fa227701309b621","$07eb01cb16db42c1$export$4c85e640eb41c31b","$07eb01cb16db42c1$export$19342e026b58ebb7","Schema","$07eb01cb16db42c1$export$14416b8d99d47caa","Template","$07eb01cb16db42c1$export$816be348776d53c1","$07eb01cb16db42c1$export$e1dae5660003ffa7","$07eb01cb16db42c1$export$c57e9b2d8b9e4de","$07eb01cb16db42c1$export$a92776769f460054","$07eb01cb16db42c1$export$e9e0d96f49f57c33","$07eb01cb16db42c1$export$8d01c972ee8b14a9","$07eb01cb16db42c1$export$7c4f444dab5ed59","$07eb01cb16db42c1$export$ce30dbb46644d06c","$07eb01cb16db42c1$export$462bb059fed9d9e5","$07eb01cb16db42c1$export$cb01d642ebc0a347","$07eb01cb16db42c1$export$eff95f126aa67cfb","$07eb01cb16db42c1$export$573ab5fe783d8aac","$07eb01cb16db42c1$export$e9a269813a6315a4","$07eb01cb16db42c1$export$85990f0f98a390bb","$07eb01cb16db42c1$export$fe264c04f294fd15","$07eb01cb16db42c1$export$1034c64782e66715","$07eb01cb16db42c1$export$54c2e3dc7acea9f5","$07eb01cb16db42c1$export$8fbd1ac8e83536df","$07eb01cb16db42c1$export$a428cd33b25d5283","$07eb01cb16db42c1$export$5b12bf1653c0dd85","$07eb01cb16db42c1$export$c79fc6492f3af13d","$07eb01cb16db42c1$export$ac4bca90992eed1","$07eb01cb16db42c1$export$c9b44e90c5031de0","$07eb01cb16db42c1$export$3dc3622b48e72adc","$07eb01cb16db42c1$export$79f93ddd76e66d40","$07eb01cb16db42c1$export$cea96571ebbff9dd","$07eb01cb16db42c1$export$deefd61317ad2797","$07eb01cb16db42c1$export$5a2130c936f86fb8","$07eb01cb16db42c1$export$cfb3877ce19bb838","$07eb01cb16db42c1$export$ef2184bd89960b14","$07eb01cb16db42c1$export$38af1803e3442a7f","$07eb01cb16db42c1$export$d5c6c08dc2d3ca7","$07eb01cb16db42c1$export$3386beb5bc3bfa","$07eb01cb16db42c1$export$42a852a2b6b56249","$07eb01cb16db42c1$export$eeaa45a7d92663a6","$07eb01cb16db42c1$export$cc55614734af2d87","$07eb01cb16db42c1$export$eb2fcfdbd7ba97d4","$07eb01cb16db42c1$export$f35845279390eafd","$07eb01cb16db42c1$export$db77ccec0bb4ccac","$07eb01cb16db42c1$export$991dcf7284de63d","$07eb01cb16db42c1$export$b04be29aa201d4f5","$07eb01cb16db42c1$export$474b8119f9aaf6a9","$07eb01cb16db42c1$export$63d5558963a08ef6","$07eb01cb16db42c1$export$f9b7ad1c9b000a93","$07eb01cb16db42c1$export$353f5b6fc5456de1","$07eb01cb16db42c1$export$85a6520672683043","$07eb01cb16db42c1$export$2e2bcd8739ae039","$c66f8165c35d7ae1$exports"],"version":3,"file":"froxel.js.map"}