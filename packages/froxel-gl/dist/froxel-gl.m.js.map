{"mappings":"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","sources":["src/shader-program.js","src/buffer.js","src/vertex-buffer.js","src/element-buffer.js","src/vertex-array-object.js","src/texture-object.js","src/webgl-canvas.js","src/uniform-buffer.js"],"sourcesContent":["\nimport WebGLCanvas from './webgl-canvas.js';\n\nexport default ShaderProgram;\n\n/**\n * Creates a WebGL GLSL Shader Program.\n * @param {WebGLCanvas} gl\n * @param {string} vertexShaderSource\n * @param {string} fragmentShaderSource\n */\nfunction ShaderProgram (gl, vertexShaderSource, fragmentShaderSource)\n{\n\t/**\n\t * Reference to the WebGLCanvas.\n\t * @readonly @type {WebGLCanvas}\n\t */\n\tthis.gl = gl;\n\n\t/**\n\t * Vertex shader resource object.\n\t * @readonly @type {WebGLShader}\n\t */\n\tthis.vertexShader = gl.createShader(gl.VERTEX_SHADER);\n\tgl.shaderSource(this.vertexShader, vertexShaderSource);\n\tgl.compileShader(this.vertexShader);\n\n\t/**\n\t * Fragment shader resource object.\n\t * @readonly @type {WebGLShader}\n\t */\n\tthis.fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n\tgl.shaderSource(this.fragmentShader, fragmentShaderSource);\n\tgl.compileShader(this.fragmentShader);\n\n\t/**\n\t * Shader program resource object.\n\t * @readonly @type {WebGLProgram}\n\t */\n\tthis.program = gl.createProgram();\n\tgl.attachShader(this.program, this.vertexShader);\n\tgl.attachShader(this.program, this.fragmentShader);\n};\n\n/**\n * Links the program and throws an error if there was any problem.\n * @throws {Error}\n * @returns {ShaderProgram}\n */\nShaderProgram.prototype.linkProgram = function()\n{\n\tfor (let attribName in ShaderProgram.attribLocations) {\n\t\tthis.gl.bindAttribLocation(this.program, ShaderProgram.attribLocations[attribName], attribName);\n\t}\n\n\tthis.gl.linkProgram (this.program);\n\tif (this.gl.getProgramParameter(this.program, this.gl.LINK_STATUS))\n\t{\n\t\tthis.gl.deleteShader(this.vertexShader)\n\t\tthis.gl.deleteShader(this.fragmentShader)\n\t\treturn this;\n\t}\n\n\tlet vertexError = this.gl.getShaderInfoLog(this.vertexShader);\n\tlet fragmentError = this.gl.getShaderInfoLog(this.fragmentShader);\n\n\tthrow new Error(\n\t\tvertexError ? ('• Vertex Shader:\\n' + vertexError + '\\n') : '' +\n\t\tfragmentError ? ('• Fragment Shader:\\n' + fragmentError) : ''\n\t);\n};\n\n/**\n * Binds an attribute location to the shader program.\n * @param {number} attribLocation\n * @param {string} attribName\n * @returns {ShaderProgram}\n */\nShaderProgram.prototype.bindAttribLocation = function (attribLocation, attribName)\n{\n\tthis.gl.bindAttribLocation(this.program, attribLocation, attribName);\n\treturn this;\n};\n\n/**\n * Map of global attribute locations.\n * @readonly @private\n * @type {Map<string, number>}\n */\nShaderProgram.attribLocations = new Map();\n\n/**\n * Binds a global attribute location to be applied to any newly created shader program.\n * @param {number} attribLocation\n * @param {string} attribName\n * @returns {ShaderProgram}\n */\nShaderProgram.bindAttribLocation = function (attribLocation, attribName)\n{\n\tthis.attribLocations[attribName] = attribLocation;\n\treturn this;\n};\n\n/**\n * Binds several global attribute locations to be applied to any newly created shader program.\n * @param {Map<string, number>} attribs\n * @returns {ShaderProgram}\n */\nShaderProgram.bindAttribLocations = function (attribs)\n{\n\tfor (let attribName in attribs) {\n\t\tthis.attribLocations[attribName] = attribs[attribName];\n\t}\n\n\treturn this;\n};\n\n/**\n * Activates the shader program for subsequent drawing operations.\n */\nShaderProgram.prototype.useProgram = function ()\n{\n\tthis.gl.useProgram(this.program);\n};\n\n/**\n * Returns the location of a uniform variable.\n * @param {string} uniformName\n * @returns {WebGLUniformLocation}\n */\nShaderProgram.prototype.getUniformLocation = function (uniformName)\n{\n\t// TODO Add cache here.\n\treturn this.gl.getUniformLocation(this.program, uniformName);\n};\n\n/**\n * Returns the location of one or more uniform variables.\n * @param {Array<string>} uniformNames\n * @returns { [key: string]: WebGLUniformLocation }\n */\nShaderProgram.prototype.getUniformLocations = function (uniformNames)\n{\n\tlet uniforms = { };\n\n\tfor (let uniformName of uniformNames) {\n\t\tuniforms[uniformName] = this.getUniformLocation(uniformName);\n\t}\n\n\treturn uniforms;\n};\n\n/**\n * Returns the index and offset of one or more uniform variables. Useful when using uniform block objects (UBO).\n * @param {Array<string>} uniformNames\n * @returns { [key: string]: { index: number, offset: number } }\n */\nShaderProgram.prototype.getUniformOffsets = function (uniformNames)\n{\n\tlet uniforms = { };\n\n\tlet indices = this.gl.getUniformIndices(this.program, uniformNames);\n\tlet offsets = this.gl.getActiveUniforms(this.program, indices, this.gl.UNIFORM_OFFSET);\n\n\tfor (let i in uniformNames) {\n\t\tuniforms[uniformNames[i]] = { index: indices[i], offset: offsets[i] };\n\t}\n\n\treturn uniforms;\n};\n\n/**\n * Returns the index of a uniform block.\n * @param {string} blockName\n * @returns {number}\n */\nShaderProgram.prototype.getUniformBlockIndex = function (blockName)\n{\n\t// TODO Add cache here?\n\treturn this.gl.getUniformBlockIndex(this.program, blockName);\n};\n\n/**\n * Returns the indices of one or more uniform blocks.\n * @param {Array<string>} blockNames\n * @returns { [key: string]: number }\n */\nShaderProgram.prototype.getUniformBlockIndices = function (blockNames)\n{\n\tlet indices = { };\n\n\tfor (let blockName of blockNames) {\n\t\tindices[blockName] = this.getUniformBlockIndex(blockName);\n\t}\n\n\treturn indices;\n};\n\n/**\n * Assigns a binding point for a uniform block given its name or index.\n * @param {number|string} blockIdentifier\n * @param {number} bindingIndex\n * @returns {ShaderProgram}\n */\nShaderProgram.prototype.uniformBlockBinding = function (blockIdentifier, bindingIndex)\n{\n\tif (typeof(blockIdentifier) === 'string')\n\t\tblockIdentifier = this.getUniformBlockIndex(blockIdentifier);\n\n\treturn this.gl.uniformBlockBinding (this.program, blockIdentifier, bindingIndex);\n};\n","\nimport WebGLCanvas from './webgl-canvas.js';\n\n/**\n * Represents a WebGL buffer.\n */\nexport default class Buffer\n{\n\t/**\n\t * Reference to the WebGLCanvas.\n\t * @readonly @type {WebGLCanvas}\n\t */\n\tgl;\n\n\t/**\n\t * Buffer target.\n\t * @type {number}\n\t */\n\ttarget;\n\n\t/**\n\t * Buffer usage mode.\n\t * @type {number}\n\t */\n\tusage;\n\n\t/**\n\t * Buffer object resource.\n\t * @type {WebGLBuffer}\n\t */\n\tbuffer;\n \n\t/**\n\t * Creates a WebGL buffer.\n\t * @param {WebGLCanvas} gl\n\t * @param {number} target\n\t * @param {number} usage\n\t */\n\tconstructor (gl, target, usage)\n\t{\n\t\tthis.gl = gl;\n\t\tthis.target = target;\n\t\tthis.usage = usage;\n\t\tthis.buffer = gl.createBuffer();\n\t}\n\n\t/**\n\t * Binds the buffer to its WebGL target.\n\t * @returns {Buffer}\n\t */\n\tbindBuffer()\n\t{\n\t\tthis.gl.bindBuffer(this.target, this.buffer);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Unbinds the buffer from its GPU buffer target.\n\t * @returns {Buffer}\n\t */\n\tunbindBuffer()\n\t{\n\t\tthis.gl.bindBuffer(this.target, null);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Initializes and creates the buffer object's data store.\n\t * @param {ArrayBufferView} srcData\n\t * @param {number} srcOffset?\n\t * @returns {Buffer}\n\t */\n\tbufferData (srcData, srcOffset=0)\n\t{\n\t\tthis.bindBuffer();\n\t\tthis.gl.bufferData(this.target, srcData, this.usage, srcOffset);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Updates a subset of the buffer object's data store. \n\t * @param {number} dstByteOffset\n\t * @param {ArrayBufferView} srcData\n\t * @param {number} srcOffset?\n\t * @param {number} length?\n\t * @returns {Buffer}\n\t */\n\tbufferSubData (dstByteOffset, srcData, srcOffset=0, length=0)\n\t{\n\t\tthis.bindBuffer();\n\t\tthis.gl.bufferSubData(this.target, dstByteOffset, srcData, srcOffset, length ? length : srcData.length);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Deletes the buffer.\n\t */\n\tdeleteBuffer()\n\t{\n\t\tthis.gl.deleteBuffer(this.buffer);\n\t}\n};\n","\nimport WebGLCanvas from './webgl-canvas.js';\nimport Buffer from './buffer.js';\n\nexport default class VertexBuffer extends Buffer\n{\n\t/**\n\t * Creates a VertexBuffer linked to the ARRAY_BUFFER target.\n\t * @param {WebGLCanvas} gl\n\t * @param {number} usage\n\t */\n\tconstructor (gl, usage)\n\t{\n\t\tsuper (gl, gl.ARRAY_BUFFER, usage);\n\t}\n};\n","\nimport WebGLCanvas from './webgl-canvas.js';\nimport Buffer from './buffer.js';\n\nexport default class ElementBuffer extends Buffer\n{\n\t/**\n\t * Creates a ElementBuffer linked to the ELEMENT_ARRAY_BUFFER target.\n\t * @param {WebGLCanvas} gl\n\t * @param {number} usage\n\t */\n\tconstructor (gl, usage)\n\t{\n\t\tsuper (gl, gl.ELEMENT_ARRAY_BUFFER, usage);\n\t}\n};\n","\nimport WebGLCanvas from './webgl-canvas.js';\n\nexport default VertexArrayObject;\n\n/**\n * Creates a Vertex Array Object (VAO).\n * @param {WebGLCanvas} gl\n */\nfunction VertexArrayObject (gl)\n{\n\t/**\n\t * Reference to the WebGLCanvas.\n\t * @readonly @type {WebGLCanvas}\n\t */\n\tthis.gl = gl;\n\n\t/**\n\t * Vertex array object resource.\n\t * @type {WebGLVertexArrayObject}\n\t */\n\tthis.vertexArray = gl.createVertexArray();\n};\n\n/**\n * Binds the vertex array object to the GPU.\n */\nVertexArrayObject.prototype.bindVertexArray = function()\n{\n\tthis.gl.bindVertexArray(this.vertexArray);\n};\n\n/**\n * Unbinds the vertex array object from the GPU.\n */\nVertexArrayObject.prototype.unbindVertexArray = function()\n{\n\tthis.gl.bindVertexArray(null);\n};\n","\nimport WebGLCanvas from './webgl-canvas.js';\n\n/**\n * @typedef {'NEAREST' | 'LINEAR'} TextureFilterType\n */\n/**\n * @typedef {'REPEAT' | 'CLAMP_TO_EDGE' | 'MIRRORED_REPEAT'} TextureWrapMode\n */\n\n/**\n * WebGLCanvas Texture Object.\n */\nexport default class TextureObject\n{\n\t/**\n\t * Reference to the WebGLCanvas.\n\t * @readonly @type {WebGLCanvas}\n\t */\n\tgl;\n\n\t/**\n\t * Texture object resource.\n\t * @readonly @type {WebGLTexture}\n\t */\n\ttexture;\n\n\t/**\n\t * Texture width (physical width).\n\t * @readonly @type {number}\n\t */\n\twidth;\n\n\t/**\n\t * Texture height (physical height).\n\t * @readonly @type {number}\n\t */\n\theight;\n\n\t/**\n\t * Target width originally requested (logical width).\n\t * @readonly @type {number}\n\t */\n\ttargetWidth;\n\n\t/**\n\t * Target height originally requested (logical height).\n\t * @readonly @type {number}\n\t */\n\ttargetHeight;\n\n\t/**\n\t * Scale of the texture (physical width / logical width).\n\t * @readonly @type {number}\n\t */\n\tscale;\n\n\t/**\n\t * Texture filter type. Defaults to `LINEAR`.\n\t * @readonly @type {TextureFilterType}\n\t */\n\tfilterType;\n\n\t/**\n\t * Texture wrap mode. Defaults to `CLAMP_TO_EDGE`.\n\t * @readonly @type {TextureWrapMode}\n\t */\n\twrapMode;\n\n\t/**\n\t * Number of mipmap levels (use 0 to disable). Default is `0`.\n\t * @readonly @type {number}\n\t */\n\tmipmapLevels;\n\n\t/**\n\t * Indicates if the texture storage has already been allocated.\n\t * @readonly @private @type {boolean}\n\t */\n\tallocated;\n\n\t/**\n\t * Creates an empty texture object of the specified size.\n\t * @param {WebGLCanvas} gl\n\t * @param {number} width - Physical texture width.\n\t * @param {number} height - Physical texture height.\n\t * @param {number} [targetWidth] - Logical texture width.\n\t * @param {number} [targetHeight] - Logical texture height.\n\t */\n\tconstructor (gl, width, height, targetWidth=null, targetHeight=null)\n\t{\n\t\tthis.gl = gl;\n\t\tthis.texture = gl.createTexture();\n\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.targetWidth = targetWidth ?? width;\n\t\tthis.targetHeight = targetHeight ?? height;\n\t\tthis.scale = this.width / this.targetWidth;\n\n\t\tthis.allocated = false;\n\t\tthis.mipmapLevels = 0;\n\t\tthis.wrapMode = 'CLAMP_TO_EDGE';\n\t\tthis.filterType = 'LINEAR';\n\t}\n\n\t/**\n\t * Binds the texture to the `TEXTURE_2D` target and allocates the texture storage if not allocated yet.\n\t * @returns {TextureObject}\n\t */\n\tbindTexture()\n\t{\n\t\tthis.gl.bindTexture (this.gl.TEXTURE_2D, this.texture);\n\t\tif (this.allocated !== false) return this;\n\n\t\tthis.allocated = null;\n\t\tthis.allocate();\n\t\treturn this;\n\t}\n\n\t/**\n\t * Allocates the texture storage.\n\t * @returns {TextureObject}\n\t */\n\tallocate()\n\t{\n\t\tif (this.allocated === true)\n\t\t\treturn this;\n\n\t\tthis.allocated = true;\n\t\tthis.bindTexture().applyFilter().applyWrap();\n\n\t\tif (this.mipmapLevels > 0)\n\t\t\tthis.gl.texStorage2D(this.gl.TEXTURE_2D, this.mipmapLevels, this.gl.RGBA8, this.width, this.height);\n\t\telse\n\t\t\tthis.gl.texStorage2D(this.gl.TEXTURE_2D, 1, this.gl.RGBA8, this.width, this.height);\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Applies the texture filter.\n\t * @private\n\t * @param {boolean} [bindTexture]\n\t * @returns {TextureObject}\n\t */\n\tapplyFilter (bindTexture=false)\n\t{\n\t\tif (bindTexture) this.bindTexture();\n\n\t\tlet minFilter = this.gl.LINEAR;\n\t\tlet magFilter = this.gl.LINEAR;\n\n\t\tif (this.filterType === 'NEAREST')\n\t\t\tminFilter = magFilter = this.gl.NEAREST;\n\n\t\tif (this.mipmapLevels > 0)\n\t\t{\n\t\t\tminFilter = this.gl.LINEAR_MIPMAP_LINEAR\n\n\t\t\tif (this.filterType === 'NEAREST')\n\t\t\t\tminFilter = this.gl.NEAREST_MIPMAP_LINEAR;\n\t\t}\n\n\t\tthis.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, minFilter);\n\t\tthis.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, magFilter);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Applies the texture wrap mode.\n\t * @private\n\t * @param {boolean} [bindTexture]\n\t * @returns {TextureObject}\n\t */\n\tapplyWrap (bindTexture=false)\n\t{\n\t\tif (bindTexture) this.bindTexture();\n\n\t\tlet wrapMode = this.gl.CLAMP_TO_EDGE;\n\n\t\tif (this.wrapMode === 'REPEAT')\n\t\t\twrapMode = this.gl.REPEAT;\n\t\telse if (this.wrap === 'MIRRORED_REPEAT')\n\t\t\twrapMode = this.gl.MIRRORED_REPEAT;\n\n\t\tthis.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, wrapMode);\n\t\tthis.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, wrapMode);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Sets the texture filter type.\n\t * @param {TextureFilterType} filterType\n\t * @returns {TextureObject}\n\t */\n\tsetFilter (filterType)\n\t{\n\t\tthis.filterType = filterType;\n\t\treturn this.allocated === true ? this.applyFilter(true) : this;\n\t}\n\n\t/**\n\t * Sets the texture wrap mode.\n\t * @param {TextureWrapMode} wrapMode\n\t * @returns {TextureObject}\n\t */\n\tsetWrapMode (wrapMode)\n\t{\n\t\tthis.wrapMode = wrapMode;\n\t\treturn this.allocated === true ? this.applyWrap(true) : this;\n\t}\n\n\t/**\n\t * Sets the number of mipmap levels. Valid only if texture data has not been allocated yet.\n\t * @param {number} numLevels\n\t * @returns {TextureObject}\n\t */\n\tsetMipmapLevels (numLevels)\n\t{\n\t\tif (this.allocated === true)\n\t\t\treturn this;\n\n\t\tthis.mipmapLevels = Math.max(0, numLevels);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Uploads data to the GPU from the specified image.\n\t * @param {HTMLImageElement} image\n\t * @param {number} [offsX] - Target X offset.\n\t * @param {number} [offsY] - Target Y offset;\n\t * @returns {TextureObject}\n\t */\n\tupload (image, offsX=0, offsY=0)\n\t{\n\t\tthis.bindTexture();\n\t\tthis.gl.texSubImage2D(this.gl.TEXTURE_2D, 0, offsX, offsY, Math.min(image.width, this.width), Math.min(image.height, this.height), this.gl.RGBA, this.gl.UNSIGNED_BYTE, image);\n\n\t\tif (this.mipmapLevels > 0)\n\t\t\tthis.gl.generateMipmap(this.gl.TEXTURE_2D);\n\n\t\treturn this;\n\t}\n};\n","\nimport ShaderProgram from './shader-program.js';\nimport VertexBuffer from './vertex-buffer.js';\nimport ElementBuffer from './element-buffer.js';\nimport VertexArrayObject from './vertex-array-object.js';\nimport { Mat3, Vec4 } from 'froxel-math';\nimport TextureObject from './texture-object.js';\n\nexport default WebGLCanvas;\n\n/**\n * @typedef {'default'|'landscape'|'portrait'|'automatic'|'strict'} WebGLCanvasOrientation\n */\n\n/**\n * @typedef {Object} WebGLCanvasOptions\n * @prop {boolean} [fullscreen] Positions the canvas to cover the entire screen. default `true`\n * @prop {boolean} [stencil] Indicates if the stencil buffer should be enabled. default `false`\n * @prop {string} [background] Background color, must be a 6-digit hex RGB value. default `000000`\n * @prop {number} [width] Width of the canvas, used only when `fullscreen` is `false`. default `960`\n * @prop {number} [height] Height of the canvas, used only when `fullscreen` is `false`. default `540`\n * @prop {WebGLCanvasOrientation} [orientation] Orientation of the canvas. Defaults to `AUTOMATIC`.\n * @prop {boolean} [antialias] Controls the antialias option, set to `false` for pixel-perfect output. Default is `true`.\n * @prop {number} [scaleFactorMax] Limit of the scale factor, used only when set to greater than zero.\n * @prop {number} [scaleFactorOffs] Offset used to increase the scale factor before the Math.floor operation. Default is `0.7`.\n */\n\nconst defaultOptions = {\n\tfullscreen: true,\n\tstencil: false,\n\tbackground: '000000',\n\twidth: 960,\n\theight: 540,\n\torientation: 'automatic',\n\tantialias: true,\n\tscaleFactorMax: 0,\n\tscaleFactorOffs: 0.7,\n};\n\n/**\n * List of active canvases. Registered when the WebGLCanvas is created, and removed when it is disposed.\n */\nconst activeCanvases = [\n];\n\n/**\n * Indicates if the auto-resizer has been attached to the window.\n */\nlet autoResizerAttached = false;\n\n/**\n * \n */\nfunction autoResizeCanvas (wgl)\n{\n\tlet fullWidth = wgl.options.width;\n\tlet fullHeight = wgl.options.height;\n\n\tif (wgl.options.fullscreen && ('document' in global)) {\n\t\tfullWidth = Math.floor(global.innerWidth);\n\t\tfullHeight = Math.floor(global.innerHeight);\n\t}\n\telse {\n\t\tif (wgl.options.width === null && wgl.options.height === null)\n\t\t\tthrow new Error ('At least one screen dimension must be specified in headless mode.');\n\t}\n\n\t// Flip dimensions to ensure the desired orientation.\n\tlet currentWidth = fullWidth;\n\tlet currentHeight = fullHeight;\n\tlet flipped = false;\n\n\tif ((fullWidth < fullHeight && wgl.options.orientation === 'landscape') || (fullWidth > fullHeight && wgl.options.orientation === 'portrait')) {\n\t\tcurrentWidth = fullHeight;\n\t\tcurrentHeight = fullWidth;\n\t\tflipped = true;\n\t}\n\n\t// Get target screen dimensions.\n\tlet targetWidth = wgl.options.width;\n\tlet targetHeight = wgl.options.height;\n\n\tif (targetWidth === null || targetHeight === null)\n\t{\n\t\tif (targetWidth === null && targetHeight === null) {\n\t\t\ttargetWidth = currentWidth;\n\t\t\ttargetHeight = currentHeight;\n\t\t}\n\t\telse if (targetWidth === null)\n\t\t\ttargetWidth = Math.floor(0.5 + currentWidth * (wgl.options.height / currentHeight));\n\t\telse\n\t\t\ttargetHeight = Math.floor(0.5 + currentHeight * (wgl.options.width / currentWidth));\n\t}\n\n\t// Handle `automatic` canvas orientation.\n\tlet screenWidth = targetWidth;\n\tlet screenHeight = targetHeight;\n\n\tif (wgl.options.orientation === 'automatic' && screenWidth && screenHeight)\n\t{\n\t\tif ((screenWidth > screenHeight && currentWidth < currentHeight) || (screenWidth < screenHeight && currentWidth > currentHeight)) {\n\t\t\tscreenWidth = targetHeight;\n\t\t\tscreenHeight = targetWidth;\n\t\t}\n\t}\n\n\t// Compute canvas scale factor.\n\tlet canvasScaleFactor = 1;\n\n\tif (screenWidth && screenHeight)\n\t\tcanvasScaleFactor = Math.min(currentWidth / screenWidth, currentHeight / screenHeight);\n\telse if (screenWidth)\n\t\tcanvasScaleFactor = currentWidth / screenWidth;\n\telse if (screenHeight)\n\t\tcanvasScaleFactor = currentHeight / screenHeight;\n\n\t// ***\n\tlet tmpWidth = currentWidth;\n\tlet tmpHeight = currentHeight;\n\n\tif (screenWidth) currentWidth = screenWidth;\n\tif (screenHeight) currentHeight = screenHeight;\n\n\tlet offsX = Math.floor((tmpWidth - currentWidth*canvasScaleFactor)*0.5);\n\tlet offsY = Math.floor((tmpHeight - currentHeight*canvasScaleFactor)*0.5);\n\n\tif (flipped) {\n\t\tlet tmp = offsX;\n\t\toffsX = offsY;\n\t\toffsY = tmp;\n\t}\n\n\tlet scaleFactor = canvasScaleFactor * global.devicePixelRatio;\n\tscaleFactor = Math.floor(wgl.options.scaleFactorOffs + scaleFactor);\n\n\tif (wgl.options.scaleFactorMax > 0 && scaleFactor > wgl.options.scaleFactorMax)\n\t\tscaleFactor = wgl.options.scaleFactorMax;\n\n\tif (wgl.options.fullscreen && ('document' in global))\n\t\tglobal.document.body.style.backgroundColor = wgl.canvas.style.backgroundColor;\n\n\twgl.resize(currentWidth, currentHeight, false);\n\n\tif (!flipped) {\n\t\twgl.canvas.style.width = Math.floor(currentWidth*canvasScaleFactor+0.5) + 'px';\n\t\twgl.canvas.style.height = Math.floor(currentHeight*canvasScaleFactor+0.5) + 'px';\n\t}\n\telse {\n\t\twgl.canvas.style.width = Math.floor(currentHeight*canvasScaleFactor+0.5) + 'px';\n\t\twgl.canvas.style.height = Math.floor(currentWidth*canvasScaleFactor+0.5) + 'px';\n\t}\n\n\twgl.canvas.style.marginLeft = offsX + 'px';\n\twgl.canvas.style.marginTop = offsY + 'px';\n\n\twgl.globalScale = scaleFactor;\n\twgl.isFlipped = flipped;\n\n\twgl.u.transform.identity();\n\twgl.u.transform.scale(scaleFactor, scaleFactor);\n\n\tif (flipped) {\n\t\twgl.u.transform.rotate(Math.PI/2);\n\t\twgl.u.transform.translate(-currentWidth, 0);\n\t}\n\n\twgl.updateViewport();\n\n\t//console.log('logical', wgl.width, wgl.height);\t\n\t//console.log('canvas-logical', wgl.canvas.width, wgl.canvas.height);\n\t//console.log('canvas-css', wgl.canvas.style.width, wgl.canvas.style.height);\n\t//console.log('phys', wgl.physWidth, wgl.physHeight);\n\t//console.log('webGl', wgl.gl.drawingBufferWidth, wgl.gl.drawingBufferHeight);\n\t//console.log('globalScale', wgl.globalScale);\n\t//console.log('canvasScaleFactor', canvasScaleFactor);\n\n\t/* *** */\n\t//if (options.maxScaleFactor > 0 && scaleFactor > options.maxScaleFactor)\n\t//\tscaleFactor = options.maxScaleFactor;\n\n\t//_this.integerScaleFactor = Math.floor(scaleFactor + 0.5); //0.9\n};\n\n/**\n * High performance WebGL2 Canvas.\n *\n * Default WebGL configuration is set as follows:\n *\n * - `DEPTH_TEST`: enabled, `clearDepth`: 0.0, `depthFunc`: GEQUAL\n * - `BLEND`: enabled, `blendEquationSeparate`: FUNC_ADD, FUNC_ADD, `blendFunc`: ONE, ONE_MINUS_SRC_ALPHA\n * - `UNPACK_PREMULTIPLY_ALPHA_WEBGL`: enabled\n * - `SCISSOR_TEST`: enabled\n *\n * @extends {WebGL2RenderingContext}\n * @param {WebGLCanvasOptions} [options]\n */\nfunction WebGLCanvas (options=null)\n{\n\tif (!autoResizerAttached)\n\t{\n\t\tglobal.onresize = function() {\n\t\t\tfor (let wgl of activeCanvases) autoResizeCanvas(wgl);\n\t\t};\n\n\t\tautoResizerAttached = true;\n\t}\n\n\tthis.init({ ...defaultOptions, ...options });\n\tactiveCanvases.push(this);\n}\n\n/**\n * Disposes the canvas and all related resources.\n */\nWebGLCanvas.prototype.dispose = function()\n{\n\tactiveCanvases.splice(activeCanvases.indexOf(this), 1);\n};\n\n/**\n * WebGL2 Context.\n * @private @readonly @type {WebGL2RenderingContext}\n */\nWebGLCanvas.prototype.gl = null;\n\n/**\n * @typedef {Object} WebGLCanvasUniforms\n * @prop {boolean} changed Indicates if the uniforms have changed.\n * @prop {Mat3} transform Initial transformation matrix.\n * @prop {Vec4} resolution Canvas resolution.\n */\n\n/**\n * Canvas uniforms.\n * @readonly @type {WebGLCanvasUniforms}\n */\nWebGLCanvas.prototype.u = null;\n\n/**\n * Underlying HTML5 canvas element.\n * @readonly @type {HTMLCanvasElement}\n */\nWebGLCanvas.prototype.canvas = null;\n\n/**\n * Logical width of the canvas.\n * @readonly @type {number}\n */\nWebGLCanvas.prototype.width = 0;\n\n/**\n * Logical height of the canvas.\n * @readonly @type {number}\n */\nWebGLCanvas.prototype.height = 0;\n\n/**\n * Physical canvas width.\n * @readonly @type {number}\n */\nWebGLCanvas.prototype.physWidth = 0;\n\n/**\n * Physical canvas height.\n * @readonly @type {number}\n */\nWebGLCanvas.prototype.physHeight = 0;\n\n/**\n * Indicates if the canvas is flipped.\n * @readonly @type {boolean}\n */\nWebGLCanvas.prototype.isFlipped = false;\n\n/**\n * Canvas global scale.\n * @readonly @type {number}\n */\nWebGLCanvas.prototype.globalScale = 1.0;\n\n\n/**\n * Initializes the instance.\n * @private\n */\nWebGLCanvas.prototype.init = function (options)\n{\n\tthis.canvas = document.createElement('canvas');\n\tthis.options = options;\n\n\tif (!options.fullscreen && (!options.width || !options.height))\n\t\tthrow new Error ('Option `width` or `height` is missing while `fullscreen` is `false`.');\n\n\tif (options.background.length != 6)\n\t\tthrow new Error ('Option `background` should be a 6-digit hex RGB (i.e. 000000).');\n\n\tthis.canvas.style.imageRendering = options.antialias ? 'auto' : 'crisp-edges';\n\tthis.canvas.style.backgroundColor = '#' + options.background;\n\n\tif (options.fullscreen) {\n\t\tthis.canvas.style.position = 'absolute';\n\t\tthis.canvas.style.left = '0px';\n\t\tthis.canvas.style.top = '0px';\n\t}\n\n\t// Get WebGL context and re-bind to the WebGLCanvas object.\n\tthis.gl = this.canvas.getContext('webgl2', { desynchronized: false, preserveDrawingBuffer: false, alpha: false, stencil: options.stencil });\n\n\tfor (let prop in this.gl)\n\t{\n\t\tlet val = this.gl[prop];\n\t\tswitch (typeof(val))\n\t\t{\n\t\t\tcase 'function':\n\t\t\t\tthis[prop] = val.bind(this.gl);\n\t\t\t\tbreak;\n\n\t\t\tcase 'number':\n\t\t\t\tthis[prop] = val;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tconsole.log(this.getParameter(this.VERSION) + ', ' + this.getParameter(this.SHADING_LANGUAGE_VERSION));\n\n\t// Initialize default configuration.\n\tthis.u = {\n\t\tchanged: true,\n\t\ttransform: Mat3.alloc(),\n\t\tresolution: Vec4.alloc()\n\t};\n\n\tthis.clearColor (parseInt(options.background.substring(0,2), 16)/255.0, parseInt(options.background.substring(2,4), 16)/255.0, parseInt(options.background.substring(4,6), 16)/255.0, 1.0);\n\tthis.colorMask (true, true, true, true);\n\n\tthis.enable (this.DEPTH_TEST);\n\tthis.clearDepth (0.0);\n\tthis.depthFunc (this.GEQUAL);\n\n\tthis.enable (this.BLEND);\n\tthis.pixelStorei (this.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\n\tthis.blendEquationSeparate (this.FUNC_ADD, this.FUNC_ADD);\n\tthis.blendFunc (this.ONE, this.ONE_MINUS_SRC_ALPHA);\n\n\tthis.enable (this.SCISSOR_TEST);\n\tautoResizeCanvas(this);\n};\n\n/**\n * Resizes the canvas to the specified logical size.\n * @param {number} width\n * @param {number} height\n */\nWebGLCanvas.prototype.resize = function (width, height, updateViewport=true)\n{\n\tthis.width = width;\n\tthis.height = height;\n\n\tif (updateViewport)\n\t\tthis.updateViewport();\n};\n\nWebGLCanvas.prototype.updateViewport = function ()\n{\n\tthis.physWidth = this.canvas.width = Math.floor((this.isFlipped ? this.height : this.width) * this.globalScale);\n\tthis.physHeight = this.canvas.height = Math.floor((this.isFlipped ? this.width : this.height) * this.globalScale);\n\n\tthis.scissor (0, 0, this.physWidth, this.physHeight);\n\tthis.viewport (0, 0, this.physWidth, this.physHeight);\n\n\t//violet:hardware scaling\n\t//this.v_resolution[0] = this._width;\n\t//this.v_resolution[1] = this._height;\n\tthis.u.resolution.set(this.physWidth, this.physHeight, this.isFlipped ? this.physHeight : this.physWidth, this.isFlipped ? this.physWidth : this.physHeight);\n\tthis.u.changed = true;\n};\n\n/**\n * Creates a shader program with the specified vertex and fragment shader source codes.\n * @param {string} vertexShaderSource\n * @param {string} fragmentShaderSource\n * @returns {ShaderProgram}\n */\nWebGLCanvas.prototype.createShaderProgram = function (vertexShaderSource, fragmentShaderSource) {\n\treturn new ShaderProgram (this, vertexShaderSource, fragmentShaderSource);\n};\n\n/**\n * Creates a new vertex array object.\n * @returns {VertexArrayObject}\n */\nWebGLCanvas.prototype.createVertexArrayObject = function () {\n\treturn new VertexArrayObject (this);\n};\n\n/**\n * Creates a new vertex buffer.\n * @param {number} usage Possible values are: `STATIC_DRAW`, `DYNAMIC_DRAW`, `STREAM_DRAW`, `STATIC_READ`, `DYNAMIC_READ`, `STREAM_READ`, `STATIC_COPY`, `DYNAMIC_COPY`, or `STREAM_COPY`.\n * @returns {VertexBuffer}\n */\nWebGLCanvas.prototype.createVertexBuffer = function (usage) {\n\treturn new VertexBuffer(this, usage);\n};\n\n/**\n * Creates a new element buffer.\n * @param {number} usage Possible values are: `STATIC_DRAW`, `DYNAMIC_DRAW`, `STREAM_DRAW`, `STATIC_READ`, `DYNAMIC_READ`, `STREAM_READ`, `STATIC_COPY`, `DYNAMIC_COPY`, or `STREAM_COPY`.\n * @returns {ElementBuffer}\n */\nWebGLCanvas.prototype.createElementBuffer = function (usage) {\n\treturn new ElementBuffer(this, usage);\n};\n\n/**\n * Creates a new texture object of the specified size.\n * @param {number} width - Physical texture width.\n * @param {number} height - Physical texture height.\n * @param {number} [targetWidth] - Logical texture width.\n * @param {number} [targetHeight] - Logical texture height.\n * @returns {TextureObject}\n */\nWebGLCanvas.prototype.createTextureObject = function (width, height, targetWidth=null, targetHeight=null) {\n\treturn new TextureObject (this, width, height, targetWidth, targetHeight);\n};\n\n/**\n * Loads an image from the specified URL.\n * @param {string} url\n * @returns {Promise<HTMLImageElement>}\n */\nWebGLCanvas.loadImage = function (url)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tlet img = new Image();\n\t\timg.onload = () => resolve(img);\n\t\timg.onerror = () => reject('Unable to load image: ' + url);\n\t\timg.src = url;\n\t});\n};\n\n/**\n * Loads an image from the specified URL and creates a texture.\n * @param {string} url\n * @param {number} [mipmapLevels] - Number of levels for mipmapping. Defaults to `0`.\n * @returns {Promise<TextureObject>}\n */\nWebGLCanvas.prototype.loadTextureFromUrl = async function (url, mipmapLevels=0)\n{\n\tlet image = await WebGLCanvas.loadImage(url);\n\tlet texture = this.createTextureObject(image.width, image.height);\n\ttexture.setMipmapLevels(mipmapLevels);\n\ttexture.upload(image);\n\treturn texture;\n};\n","\nimport WebGLCanvas from './webgl-canvas.js';\nimport Buffer from './buffer.js';\n\nexport default class UniformBuffer extends Buffer\n{\n\t/**\n\t * Uniforn block binding index. Set using `bindBufferBase`.\n\t * @readonly @type {number}\n\t */\n\tbindingIndex;\n\n\t/**\n\t * Creates a buffer linked to the UNIFORM_BUFFER target.\n\t * @param {WebGLCanvas} gl\n\t * @param {number} usage\n\t */\n\tconstructor (gl, usage)\n\t{\n\t\tsuper (gl, gl.UNIFORM_BUFFER, usage);\n\t}\n\n\t/**\n\t * Binds the buffer to the UNIFORM_BUFFER binding point at a given index. \n\t * @param {number} index\n\t * @returns {UniformBuffer}\n\t */\n\tbindBufferBase (index)\n\t{\n\t\t this.gl.bindBufferBase(this.target, this.bindingIndex = index, this.buffer);\n\t\t return this;\n\t}\n};\n"],"names":["$f833e504115047ce$export$2e2bcd8739ae039","$f833e504115047ce$var$ShaderProgram","gl","vertexShaderSource","fragmentShaderSource","this","vertexShader","createShader","VERTEX_SHADER","shaderSource","compileShader","fragmentShader","FRAGMENT_SHADER","program","createProgram","attachShader","prototype","linkProgram","attribName","attribLocations","bindAttribLocation","getProgramParameter","LINK_STATUS","deleteShader","vertexError","getShaderInfoLog","fragmentError","Error","attribLocation","Map","bindAttribLocations","attribs","useProgram","getUniformLocation","uniformName","getUniformLocations","uniformNames","uniforms","getUniformOffsets","indices","getUniformIndices","offsets","getActiveUniforms","UNIFORM_OFFSET","i","index","offset","getUniformBlockIndex","blockName","getUniformBlockIndices","blockNames","uniformBlockBinding","blockIdentifier","bindingIndex","$8130a8013106f3d1$export$2e2bcd8739ae039","target","usage","buffer","constructor","createBuffer","bindBuffer","unbindBuffer","bufferData","srcData","srcOffset","bufferSubData","dstByteOffset","length","deleteBuffer","$bae776f183aa91d1$export$2e2bcd8739ae039","super","ARRAY_BUFFER","$6d7095e563bd49c3$export$2e2bcd8739ae039","ELEMENT_ARRAY_BUFFER","$0215a91145a0632d$export$2e2bcd8739ae039","$0215a91145a0632d$var$VertexArrayObject","vertexArray","createVertexArray","bindVertexArray","unbindVertexArray","$275802465c2747aa$export$2e2bcd8739ae039","texture","width","height","targetWidth","targetHeight","scale","filterType","wrapMode","mipmapLevels","allocated","createTexture","bindTexture","TEXTURE_2D","allocate","applyFilter","applyWrap","texStorage2D","RGBA8","minFilter","LINEAR","magFilter","NEAREST","LINEAR_MIPMAP_LINEAR","NEAREST_MIPMAP_LINEAR","texParameteri","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","CLAMP_TO_EDGE","REPEAT","wrap","MIRRORED_REPEAT","TEXTURE_WRAP_S","TEXTURE_WRAP_T","setFilter","setWrapMode","setMipmapLevels","numLevels","Math","max","upload","image","offsX","offsY","texSubImage2D","min","RGBA","UNSIGNED_BYTE","generateMipmap","$87df07883f23e949$export$2e2bcd8739ae039","$87df07883f23e949$var$WebGLCanvas","$87df07883f23e949$var$defaultOptions","fullscreen","stencil","background","orientation","antialias","scaleFactorMax","scaleFactorOffs","$87df07883f23e949$var$activeCanvases","$87df07883f23e949$var$autoResizerAttached","$87df07883f23e949$var$autoResizeCanvas","wgl","fullWidth","options","fullHeight","$parcel$global","floor","innerWidth","innerHeight","currentWidth","currentHeight","flipped","screenWidth","screenHeight","canvasScaleFactor","tmpWidth","tmpHeight","tmp","scaleFactor","devicePixelRatio","document","body","style","backgroundColor","canvas","resize","marginLeft","marginTop","globalScale","isFlipped","u","transform","identity","rotate","PI","translate","updateViewport","onresize","init","push","dispose","splice","indexOf","physWidth","physHeight","createElement","imageRendering","position","left","top","getContext","desynchronized","preserveDrawingBuffer","alpha","prop","val","bind","console","log","getParameter","VERSION","SHADING_LANGUAGE_VERSION","changed","$k7heJ$Mat3","alloc","resolution","$k7heJ$Vec4","clearColor","parseInt","substring","colorMask","enable","DEPTH_TEST","clearDepth","depthFunc","GEQUAL","BLEND","pixelStorei","UNPACK_PREMULTIPLY_ALPHA_WEBGL","blendEquationSeparate","FUNC_ADD","blendFunc","ONE","ONE_MINUS_SRC_ALPHA","SCISSOR_TEST","scissor","viewport","set","createShaderProgram","createVertexArrayObject","createVertexBuffer","createElementBuffer","createTextureObject","loadImage","url","Promise","resolve","reject","img","Image","onload","onerror","src","loadTextureFromUrl","async","$f288cb122b1afd57$export$2e2bcd8739ae039","UNIFORM_BUFFER","bindBufferBase"],"version":3,"file":"froxel-gl.m.js.map"}