import{Mat3 as t,Vec4 as e}from"froxel-math";var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r=s;function s(t,e,i){this.gl=t,this.vertexShader=t.createShader(t.VERTEX_SHADER),t.shaderSource(this.vertexShader,e),t.compileShader(this.vertexShader),this.fragmentShader=t.createShader(t.FRAGMENT_SHADER),t.shaderSource(this.fragmentShader,i),t.compileShader(this.fragmentShader),this.program=t.createProgram(),t.attachShader(this.program,this.vertexShader),t.attachShader(this.program,this.fragmentShader)}s.prototype.linkProgram=function(){for(let t in s.attribLocations)this.gl.bindAttribLocation(this.program,s.attribLocations[t],t);if(this.gl.linkProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))return this.gl.deleteShader(this.vertexShader),this.gl.deleteShader(this.fragmentShader),this;let t=this.gl.getShaderInfoLog(this.vertexShader),e=this.gl.getShaderInfoLog(this.fragmentShader);throw new Error(t?"• Vertex Shader:\n"+t+"\n":""+e?"• Fragment Shader:\n"+e:"")},s.prototype.bindAttribLocation=function(t,e){return this.gl.bindAttribLocation(this.program,t,e),this},s.attribLocations=new Map,s.bindAttribLocation=function(t,e){return this.attribLocations[e]=t,this},s.bindAttribLocations=function(t){for(let e in t)this.attribLocations[e]=t[e];return this},s.prototype.getUniformLocation=function(t){return this.gl.getUniformLocation(this.program,t)},s.prototype.getUniformLocations=function(t){let e={};for(let i of t)e[i]=this.getUniformLocation(i);return e},s.prototype.useProgram=function(){this.gl.useProgram(this.program)};class o{gl;target;usage;buffer;constructor(t,e,i){this.gl=t,this.target=e,this.usage=i,this.buffer=t.createBuffer()}bindBuffer(){return this.gl.bindBuffer(this.target,this.buffer),this}bufferData(t,e=0){return this.gl.bindBuffer(this.target,this.buffer),this.gl.bufferData(this.target,t,this.usage,e),this}bufferSubData(t,e,i=0,r=0){return this.gl.bindBuffer(this.target,this.buffer),this.gl.bufferSubData(this.target,t,e,i,r||e.length),this}deleteBuffer(){this.gl.deleteBuffer(this.buffer)}}class a extends o{constructor(t,e){super(t,t.ARRAY_BUFFER,e)}}class h extends o{constructor(t,e){super(t,t.ELEMENT_ARRAY_BUFFER,e)}}var n=l;function l(t){this.gl=t,this.vertexArray=t.createVertexArray()}l.prototype.bindVertexArray=function(){this.gl.bindVertexArray(this.vertexArray)},l.prototype.unbindVertexArray=function(){this.gl.bindVertexArray(null)};var p=d;const c={fullscreen:!0,stencil:!1,background:"000000",width:960,height:540,orientation:"automatic",antialias:!0,scaleFactorMax:0,scaleFactorOffs:.7},f=[];let u=!1;function g(t){let e=t.options.width,r=t.options.height;if(t.options.fullscreen&&"document"in i)e=Math.floor(i.innerWidth),r=Math.floor(i.innerHeight);else if(null===t.options.width&&null===t.options.height)throw new Error("At least one screen dimension must be specified in headless mode.");let s=e,o=r,a=!1;(e<r&&"landscape"===t.options.orientation||e>r&&"portrait"===t.options.orientation)&&(s=r,o=e,a=!0);let h=t.options.width,n=t.options.height;null!==h&&null!==n||(null===h&&null===n?(h=s,n=o):null===h?h=Math.floor(.5+s*(t.options.height/o)):n=Math.floor(.5+o*(t.options.width/s)));let l=h,p=n;"automatic"===t.options.orientation&&l&&p&&(l>p&&s<o||l<p&&s>o)&&(l=n,p=h);let c=1;l&&p?c=Math.min(s/l,o/p):l?c=s/l:p&&(c=o/p);let f=s,u=o;l&&(s=l),p&&(o=p);let g=Math.floor(.5*(f-s*c)),d=Math.floor(.5*(u-o*c));if(a){let t=g;g=d,d=t}let b=c*i.devicePixelRatio;b=Math.floor(t.options.scaleFactorOffs+b),t.options.scaleFactorMax>0&&b>t.options.scaleFactorMax&&(b=t.options.scaleFactorMax),t.options.fullscreen&&"document"in i&&(i.document.body.style.backgroundColor=t.canvas.style.backgroundColor),t.resize(s,o,!1),a?(t.canvas.style.width=Math.floor(o*c+.5)+"px",t.canvas.style.height=Math.floor(s*c+.5)+"px"):(t.canvas.style.width=Math.floor(s*c+.5)+"px",t.canvas.style.height=Math.floor(o*c+.5)+"px"),t.canvas.style.marginLeft=g+"px",t.canvas.style.marginTop=d+"px",t.globalScale=b,t.isFlipped=a,t.u.transform.identity(),t.u.transform.scale(b,b),a&&(t.u.transform.rotate(Math.PI/2),t.u.transform.translate(-s,0)),t.updateViewport()}function d(t=null){u||(i.onresize=function(){for(let t of f)g(t)},u=!0),this.init({...c,...t}),f.push(this)}d.prototype.dispose=function(){f.splice(f.indexOf(this),1)},d.prototype.gl=null,d.prototype.u=null,d.prototype.canvas=null,d.prototype.width=0,d.prototype.height=0,d.prototype.physWidth=0,d.prototype.physHeight=0,d.prototype.isFlipped=!1,d.prototype.globalScale=1,d.prototype.init=function(i){if(this.canvas=document.createElement("canvas"),this.options=i,!(i.fullscreen||i.width&&i.height))throw new Error("Option `width` or `height` is missing while `fullscreen` is `false`.");if(6!=i.background.length)throw new Error("Option `background` should be a 6-digit hex RGB (i.e. 000000).");this.canvas.style.imageRendering=i.antialias?"auto":"crisp-edges",this.canvas.style.backgroundColor="#"+i.background,i.fullscreen&&(this.canvas.style.position="absolute",this.canvas.style.left="0px",this.canvas.style.top="0px"),this.gl=this.canvas.getContext("webgl2",{desynchronized:!1,preserveDrawingBuffer:!1,alpha:!1,stencil:i.stencil});for(let t in this.gl){let e=this.gl[t];switch(typeof e){case"function":this[t]=e.bind(this.gl);break;case"number":this[t]=e}}console.log(this.getParameter(this.VERSION)+", "+this.getParameter(this.SHADING_LANGUAGE_VERSION)),this.u={changed:!0,transform:t.alloc(),resolution:e.alloc()},this.clearColor(parseInt(i.background.substring(0,2),16)/255,parseInt(i.background.substring(2,4),16)/255,parseInt(i.background.substring(4,6),16)/255,1),this.enable(this.DEPTH_TEST),this.clearDepth(0),this.depthFunc(this.GEQUAL),this.enable(this.BLEND),this.pixelStorei(this.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.blendEquationSeparate(this.FUNC_ADD,this.FUNC_ADD),this.blendFunc(this.ONE,this.ONE_MINUS_SRC_ALPHA),this.enable(this.SCISSOR_TEST),g(this)},d.prototype.resize=function(t,e,i=!0){this.width=t,this.height=e,i&&this.updateViewport()},d.prototype.updateViewport=function(){this.physWidth=this.canvas.width=Math.floor((this.isFlipped?this.height:this.width)*this.globalScale),this.physHeight=this.canvas.height=Math.floor((this.isFlipped?this.width:this.height)*this.globalScale),this.scissor(0,0,this.physWidth,this.physHeight),this.viewport(0,0,this.physWidth,this.physHeight),this.u.resolution.set(this.physWidth,this.physHeight,this.isFlipped?this.physHeight:this.physWidth,this.isFlipped?this.physWidth:this.physHeight),this.u.changed=!0},d.prototype.createShaderProgram=function(t,e){return new r(this,t,e)},d.prototype.createVertexArrayObject=function(){return new n(this)},d.prototype.createVertexBuffer=function(t){return new a(this,t)},d.prototype.createElementBuffer=function(t){return new h(this,t)};export{p as WebGLCanvas,r as ShaderProgram,o as Buffer,a as VertexBuffer,h as ElementBuffer,n as VertexArrayObject};
//# sourceMappingURL=froxel-gl.m.js.map
